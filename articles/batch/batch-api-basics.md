---
title: "Обзор функций пакетной службы Azure для разработчиков | Документация Майкрософт"
description: "Ознакомьтесь с функциями пакетной службы и ее API-интерфейсов с точки зрения разработки."
services: batch
documentationcenter: .net
author: tamram
manager: timlt
editor: 
ms.assetid: 416b95f8-2d7b-4111-8012-679b0f60d204
ms.service: batch
ms.devlang: multiple
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: big-compute
ms.date: 06/28/2017
ms.author: tamram
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: c2f2a878414e4efd626d674ef9a182ae52eeb1ff
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="develop-large-scale-parallel-compute-solutions-with-batch"></a><span data-ttu-id="04d9d-103">Разработка решений для крупномасштабных параллельных вычислений с использованием пакетной службы</span><span class="sxs-lookup"><span data-stu-id="04d9d-103">Develop large-scale parallel compute solutions with Batch</span></span>

<span data-ttu-id="04d9d-104">В этом обзоре рассматриваются основные функции и ресурсы пакетной службы Azure, которые могут использовать разработчики при создании решений для крупномасштабных параллельных вычислительных нагрузок.</span><span class="sxs-lookup"><span data-stu-id="04d9d-104">In this overview of the core components of the Azure Batch service, we discuss the primary service features and resources that Batch developers can use to build large-scale parallel compute solutions.</span></span>

<span data-ttu-id="04d9d-105">Как при разработке распределенного вычислительного приложения или службы, которая отправляет прямые вызовы [REST API][batch_rest_api], так и при использовании одного из [пакетов SDK для пакетной службы](batch-apis-tools.md#azure-accounts-for-batch-development) вам понадобятся многие ресурсы и функции, описанные в этой статье.</span><span class="sxs-lookup"><span data-stu-id="04d9d-105">Whether you're developing a distributed computational application or service that issues direct [REST API][batch_rest_api] calls or you're using one of the [Batch SDKs](batch-apis-tools.md#azure-accounts-for-batch-development), you'll use many of the resources and features discussed in this article.</span></span>

> [!TIP]
> <span data-ttu-id="04d9d-106">Дополнительные сведения о пакетной службе Azure см. в [этой статье](batch-technical-overview.md).</span><span class="sxs-lookup"><span data-stu-id="04d9d-106">For a higher-level introduction to the Batch service, see [Basics of Azure Batch](batch-technical-overview.md).</span></span>
>
>

## <a name="batch-service-workflow"></a><span data-ttu-id="04d9d-107">Рабочий процесс пакетной службы</span><span class="sxs-lookup"><span data-stu-id="04d9d-107">Batch service workflow</span></span>
<span data-ttu-id="04d9d-108">Далее приводится обобщенная схема рабочего процесса практически для всех приложений и служб, использующих пакетную службу для обработки параллельных рабочих нагрузок.</span><span class="sxs-lookup"><span data-stu-id="04d9d-108">The following high-level workflow is typical of nearly all applications and services that use the Batch service for processing parallel workloads:</span></span>

1. <span data-ttu-id="04d9d-109">Отправьте **файлы данных**, которые необходимо обработать, в учетную запись [службы хранилища Azure][azure_storage].</span><span class="sxs-lookup"><span data-stu-id="04d9d-109">Upload the **data files** that you want to process to an [Azure Storage][azure_storage] account.</span></span> <span data-ttu-id="04d9d-110">В пакетную службу встроена поддержка доступа к хранилищу BLOB-объектов Azure, и эти файлы могут быть скачаны на [вычислительные узлы](#compute-node) в ходе выполнения задач.</span><span class="sxs-lookup"><span data-stu-id="04d9d-110">Batch includes built-in support for accessing Azure Blob storage, and your tasks can download these files to [compute nodes](#compute-node) when the tasks are run.</span></span>
2. <span data-ttu-id="04d9d-111">Отправьте **файлы приложения**, которые будут выполнять задачи.</span><span class="sxs-lookup"><span data-stu-id="04d9d-111">Upload the **application files** that your tasks will run.</span></span> <span data-ttu-id="04d9d-112">Это могут быть двоичные файлы или сценарии и их зависимости. Они выполняются с помощью задач в заданиях.</span><span class="sxs-lookup"><span data-stu-id="04d9d-112">These files can be binaries or scripts and their dependencies, and are executed by the tasks in your jobs.</span></span> <span data-ttu-id="04d9d-113">Эти файлы можно скачать из учетной записи службы хранения. Либо можно использовать [пакеты приложений](#application-packages) пакетной службы для развертывания приложений и управления ими.</span><span class="sxs-lookup"><span data-stu-id="04d9d-113">Your tasks can download these files from your Storage account, or you can use the [application packages](#application-packages) feature of Batch for application management and deployment.</span></span>
3. <span data-ttu-id="04d9d-114">Создайте [пул](#pool) вычислительных узлов.</span><span class="sxs-lookup"><span data-stu-id="04d9d-114">Create a [pool](#pool) of compute nodes.</span></span> <span data-ttu-id="04d9d-115">При создании пула указывается количество вычислительных узлов, их размер и операционная система.</span><span class="sxs-lookup"><span data-stu-id="04d9d-115">When you create a pool, you specify the number of compute nodes for the pool, their size, and the operating system.</span></span> <span data-ttu-id="04d9d-116">Каждая задача в задании выполняется на одном из узлов в пуле.</span><span class="sxs-lookup"><span data-stu-id="04d9d-116">When each task in your job runs, it's assigned to execute on one of the nodes in your pool.</span></span>
4. <span data-ttu-id="04d9d-117">Создайте [задание](#job).</span><span class="sxs-lookup"><span data-stu-id="04d9d-117">Create a [job](#job).</span></span> <span data-ttu-id="04d9d-118">Задание — это набор задач.</span><span class="sxs-lookup"><span data-stu-id="04d9d-118">A job manages a collection of tasks.</span></span> <span data-ttu-id="04d9d-119">Каждое задание назначается конкретному пулу, в котором будут выполняться задачи этого задания.</span><span class="sxs-lookup"><span data-stu-id="04d9d-119">You associate each job to a specific pool where that job's tasks will run.</span></span>
5. <span data-ttu-id="04d9d-120">Добавьте [задачи](#task) в задание.</span><span class="sxs-lookup"><span data-stu-id="04d9d-120">Add [tasks](#task) to the job.</span></span> <span data-ttu-id="04d9d-121">Каждая задача выполняет приложение или сценарий, загруженные для обработки файлов данных, скачанных из учетной записи службы хранилища.</span><span class="sxs-lookup"><span data-stu-id="04d9d-121">Each task runs the application or script that you uploaded to process the data files it downloads from your Storage account.</span></span> <span data-ttu-id="04d9d-122">Выходные данные каждой задачи после ее завершения могут быть отправлены в службу хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="04d9d-122">As each task completes, it can upload its output to Azure Storage.</span></span>
6. <span data-ttu-id="04d9d-123">Отслеживайте ход выполнения заданий и получайте выходные данные задач из службы хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="04d9d-123">Monitor job progress and retrieve the task output from Azure Storage.</span></span>

<span data-ttu-id="04d9d-124">В следующих разделах рассматриваются эти и другие ресурсы пакетной службы, которые позволяют использовать распределенные вычисления.</span><span class="sxs-lookup"><span data-stu-id="04d9d-124">The following sections discuss these and the other resources of Batch that enable your distributed computational scenario.</span></span>

> [!NOTE]
> <span data-ttu-id="04d9d-125">Для использования пакетной службы вам потребуется [учетная запись пакетной службы](#account).</span><span class="sxs-lookup"><span data-stu-id="04d9d-125">You need a [Batch account](#account) to use the Batch service.</span></span> <span data-ttu-id="04d9d-126">Кроме того, большинство решений пакетной службы предполагают наличие [учетной записи хранения Azure][azure_storage] для хранения и извлечения файлов.</span><span class="sxs-lookup"><span data-stu-id="04d9d-126">Most Batch solutions also use an [Azure Storage][azure_storage] account for file storage and retrieval.</span></span> <span data-ttu-id="04d9d-127">Сейчас пакетная служба поддерживает только учетные записи хранения **общего назначения**, как описано на шаге 5 раздела [о создании учетной записи хранения](../storage/common/storage-create-storage-account.md#create-a-storage-account) в статье [Об учетных записях хранения Azure](../storage/common/storage-create-storage-account.md).</span><span class="sxs-lookup"><span data-stu-id="04d9d-127">Batch currently supports only the **general-purpose** storage account type, as described in step 5 of [Create a storage account](../storage/common/storage-create-storage-account.md#create-a-storage-account) in [About Azure storage accounts](../storage/common/storage-create-storage-account.md).</span></span>
>
>

## <a name="batch-service-resources"></a><span data-ttu-id="04d9d-128">Ресурсы пакетной службы</span><span class="sxs-lookup"><span data-stu-id="04d9d-128">Batch service resources</span></span>
<span data-ttu-id="04d9d-129">Для всех решений, использующих пакетную службу, требуются такие ресурсы, как учетные записи, вычислительные узлы, пулы, задания и задачи.</span><span class="sxs-lookup"><span data-stu-id="04d9d-129">Some of the following resources--accounts, compute nodes, pools, jobs, and tasks--are required by all solutions that use the Batch service.</span></span> <span data-ttu-id="04d9d-130">Другие ресурсы, например расписания заданий и пакеты приложений, являются полезными дополнительными функциями.</span><span class="sxs-lookup"><span data-stu-id="04d9d-130">Others, like job schedules and application packages, are helpful, but optional, features.</span></span>

* [<span data-ttu-id="04d9d-131">Учетная запись.</span><span class="sxs-lookup"><span data-stu-id="04d9d-131">Account</span></span>](#account)
* [<span data-ttu-id="04d9d-132">Вычислительный узел.</span><span class="sxs-lookup"><span data-stu-id="04d9d-132">Compute node</span></span>](#compute-node)
* [<span data-ttu-id="04d9d-133">Пул.</span><span class="sxs-lookup"><span data-stu-id="04d9d-133">Pool</span></span>](#pool)
* [<span data-ttu-id="04d9d-134">Задание.</span><span class="sxs-lookup"><span data-stu-id="04d9d-134">Job</span></span>](#job)

  * [<span data-ttu-id="04d9d-135">Расписания заданий</span><span class="sxs-lookup"><span data-stu-id="04d9d-135">Job schedules</span></span>](#scheduled-jobs)
* [<span data-ttu-id="04d9d-136">Задача.</span><span class="sxs-lookup"><span data-stu-id="04d9d-136">Task</span></span>](#task)

  * [<span data-ttu-id="04d9d-137">Задача запуска</span><span class="sxs-lookup"><span data-stu-id="04d9d-137">Start task</span></span>](#start-task)
  * [<span data-ttu-id="04d9d-138">Задача диспетчера заданий</span><span class="sxs-lookup"><span data-stu-id="04d9d-138">Job manager task</span></span>](#job-manager-task)
  * [<span data-ttu-id="04d9d-139">Задачи подготовки и завершения заданий.</span><span class="sxs-lookup"><span data-stu-id="04d9d-139">Job preparation and release tasks</span></span>](#job-preparation-and-release-tasks)
  * [<span data-ttu-id="04d9d-140">Задачи с несколькими экземплярами</span><span class="sxs-lookup"><span data-stu-id="04d9d-140">Multi-instance task (MPI)</span></span>](#multi-instance-tasks)
  * [<span data-ttu-id="04d9d-141">Зависимости задачи</span><span class="sxs-lookup"><span data-stu-id="04d9d-141">Task dependencies</span></span>](#task-dependencies)
* [<span data-ttu-id="04d9d-142">Пакеты приложений</span><span class="sxs-lookup"><span data-stu-id="04d9d-142">Application packages</span></span>](#application-packages)

## <a name="account"></a><span data-ttu-id="04d9d-143">Учетная запись.</span><span class="sxs-lookup"><span data-stu-id="04d9d-143">Account</span></span>
<span data-ttu-id="04d9d-144">Учетная запись Пакетной службы — это уникально идентифицируемая сущность в Пакетной службе.</span><span class="sxs-lookup"><span data-stu-id="04d9d-144">A Batch account is a uniquely identified entity within the Batch service.</span></span> <span data-ttu-id="04d9d-145">Вся обработка данных привязана к учетной записи пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-145">All processing is associated with a Batch account.</span></span>

<span data-ttu-id="04d9d-146">Вы можете создать учетную запись пакетной службы Azure с помощью [портала](batch-account-create-portal.md) или программными средствами, например с помощью [библиотеки. NET управления пакетной службой](batch-management-dotnet.md).</span><span class="sxs-lookup"><span data-stu-id="04d9d-146">You can create an Azure Batch account using the [Azure portal](batch-account-create-portal.md) or programmatically, such as with the [Batch Management .NET library](batch-management-dotnet.md).</span></span> <span data-ttu-id="04d9d-147">При создании учетной записи можно связать учетную запись хранения Azure.</span><span class="sxs-lookup"><span data-stu-id="04d9d-147">When creating the account, you can associate an Azure storage account.</span></span>

### <a name="pool-allocation-mode"></a><span data-ttu-id="04d9d-148">Режим распределения пула</span><span class="sxs-lookup"><span data-stu-id="04d9d-148">Pool allocation mode</span></span>

<span data-ttu-id="04d9d-149">При создании учетной записи пакетной службы можно указать способ распределения [пулов](#pool) вычислительных узлов.</span><span class="sxs-lookup"><span data-stu-id="04d9d-149">When you create a Batch account, you can specify how [pools](#pool) of compute nodes are allocated.</span></span> <span data-ttu-id="04d9d-150">Вы можете выделить пулы вычислительных узлов в подписке, управляемой пакетной службой Azure, или же в собственной подписке.</span><span class="sxs-lookup"><span data-stu-id="04d9d-150">You can choose to allocate pools of compute nodes in a subscription managed by Azure Batch, or you can allocate them in your own subscription.</span></span> <span data-ttu-id="04d9d-151">Свойство *Режим выделения пула* учетной записи определяет, где должны выделяться пулы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-151">The *pool allocation mode* property for the account determines where pools are allocated.</span></span> 

<span data-ttu-id="04d9d-152">Чтобы решить, какой режим распределения пула следует использовать, определите, какой из них лучше всего соответствует вашему сценарию:</span><span class="sxs-lookup"><span data-stu-id="04d9d-152">To decide which pool allocation mode to use, consider which best fits your scenario:</span></span>

* <span data-ttu-id="04d9d-153">**Пакетная служба.** Это режим распределения пула, используемый по умолчанию. В нем пулы автоматически выделяются в подписках, управляемых Azure.</span><span class="sxs-lookup"><span data-stu-id="04d9d-153">**Batch Service**: Batch Service is the default pool allocation mode, in which pools are allocated behind the scenes in Azure-managed subscriptions.</span></span> <span data-ttu-id="04d9d-154">Учитывайте следующие основные моменты в отношении режима распределения пула "Пакетная служба":</span><span class="sxs-lookup"><span data-stu-id="04d9d-154">Keep in mind these key points about the Batch Service pool allocation mode:</span></span>

    - <span data-ttu-id="04d9d-155">Этот режим распределения пула поддерживает как пулы облачной службы, так и пулы виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="04d9d-155">The Batch Service pool allocation mode supports both Cloud Service and Virtual Machine pools.</span></span>
    - <span data-ttu-id="04d9d-156">Этот режим поддерживает проверку подлинности с общим ключом и [проверку подлинности Azure Active Directory](batch-aad-auth.md) (Azure AD).</span><span class="sxs-lookup"><span data-stu-id="04d9d-156">The Batch Service pool allocation mode supports both shared key authentication or [Azure Active Directory authentication](batch-aad-auth.md) (Azure AD).</span></span> 
    - <span data-ttu-id="04d9d-157">В пулах, выделенных в режиме "Пакетная служба", вы можете использовать специальные или низкоприоритетные вычислительные узлы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-157">You can use either dedicated or low-priority compute nodes in pools allocated with the Batch Service pool allocation mode.</span></span>
    - <span data-ttu-id="04d9d-158">Не используйте этот режим, если вы планируете создавать пулы виртуальных машин Azure из пользовательских образов виртуальных машин или использовать виртуальную сеть.</span><span class="sxs-lookup"><span data-stu-id="04d9d-158">Do not use the Batch Service pool allocation mode if you plan to create Azure virtual machine pools from custom VM images, or if you plan to use a virtual network.</span></span> <span data-ttu-id="04d9d-159">Вместо этого создайте учетную запись с режимом распределения пула "Пользовательская подписка".</span><span class="sxs-lookup"><span data-stu-id="04d9d-159">Create your account with the User Subscription pool allocation mode instead.</span></span>
    - <span data-ttu-id="04d9d-160">Пулы виртуальных машин, подготовленные в учетной записи с режимом распределения пула "Пользовательская подписка", должны быть созданы из образов виртуальных машин в [Azure Marketplace][vm_marketplace].</span><span class="sxs-lookup"><span data-stu-id="04d9d-160">Virtual Machine pools provisioned in an account created with the Batch Service pool allocation mode must be created from [Azure Virtual Machines Marketplace][vm_marketplace] images.</span></span>

* <span data-ttu-id="04d9d-161">**Пользовательская подписка.** При использовании этого режима пулы пакетной службы выделяются в подписке Azure, в которой создана учетная запись.</span><span class="sxs-lookup"><span data-stu-id="04d9d-161">**User subscription**: With the User Subscription pool allocation mode, Batch pools are allocated in the Azure subscription where the account is created.</span></span> <span data-ttu-id="04d9d-162">Учитывайте следующие основные моменты в отношении режима распределения пула "Пользовательская подписка":</span><span class="sxs-lookup"><span data-stu-id="04d9d-162">Keep in mind these key points about the User Subscription pool allocation mode:</span></span>
     
    - <span data-ttu-id="04d9d-163">Этот режим распределения пула поддерживает только пулы виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="04d9d-163">The User Subscription pool allocation mode supports only Virtual Machine pools.</span></span> <span data-ttu-id="04d9d-164">Она не поддерживает пулы облачных служб.</span><span class="sxs-lookup"><span data-stu-id="04d9d-164">It does not support Cloud Services pools.</span></span>
    - <span data-ttu-id="04d9d-165">Чтобы создать пулы виртуальных машин из пользовательских образов виртуальных машин или использовать с этими пулами виртуальную сеть, следует использовать этот режим.</span><span class="sxs-lookup"><span data-stu-id="04d9d-165">To create Virtual Machine pools from custom VM images or to use a virtual network with Virtual Machine pools, you must use the User Subscription pool allocation mode.</span></span>  
    - <span data-ttu-id="04d9d-166">Для пулов, выделенных в пользовательской подписке, необходимо использовать [проверку подлинности Azure Active Directory](batch-aad-auth.md).</span><span class="sxs-lookup"><span data-stu-id="04d9d-166">You must use [Azure Active Directory authentication](batch-aad-auth.md) with pools that are allocated in the user subscription.</span></span> 
    - <span data-ttu-id="04d9d-167">Если выбран этот режим распределения пула, необходимо настроить Azure Key Vault для учетной записи пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-167">You must set up an Azure key vault for your Batch account if the pool allocation mode is set to User Subscription.</span></span> 
    - <span data-ttu-id="04d9d-168">Вы можете использовать только специальные вычислительные узлы в пулах в учетных записях, созданных в режиме распределения пула "Пользовательская подписка".</span><span class="sxs-lookup"><span data-stu-id="04d9d-168">You can use only dedicated compute nodes in pools in an account created with the User Subscription pool allocation mode.</span></span> <span data-ttu-id="04d9d-169">Низкоприоритетные узлы не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="04d9d-169">Low-priority nodes are not supported.</span></span>
    - <span data-ttu-id="04d9d-170">Пулы виртуальных машин, подготовленные в учетной записи с режимом распределения пула "Пользовательская подписка", могут быть созданы из пользовательских образов, предоставленных вами, или из образов виртуальных машин в [Azure Marketplace][vm_marketplace].</span><span class="sxs-lookup"><span data-stu-id="04d9d-170">Virtual Machine pools provisioned in an account with the User Subscription pool allocation mode can be created either from [Azure Virtual Machines Marketplace][vm_marketplace] images, or from custom images that you provide.</span></span>

<span data-ttu-id="04d9d-171">В следующей таблице сравниваются режимы распределения пула "Пакетная служба" и "Пользовательская подписка".</span><span class="sxs-lookup"><span data-stu-id="04d9d-171">The following table compares the Batch Service and User Subscription pool allocation modes.</span></span>

| <span data-ttu-id="04d9d-172">**Режим распределения пула**</span><span class="sxs-lookup"><span data-stu-id="04d9d-172">**Pool allocation mode**</span></span>                 | <span data-ttu-id="04d9d-173">**Пакетная служба**</span><span class="sxs-lookup"><span data-stu-id="04d9d-173">**Batch Service**</span></span>                                                                                       | <span data-ttu-id="04d9d-174">**Пользовательская подписка**</span><span class="sxs-lookup"><span data-stu-id="04d9d-174">**User Subscription**</span></span>                                                              |
|-------------------------------------------|---------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------|
| <span data-ttu-id="04d9d-175">**Место распределения пула**</span><span class="sxs-lookup"><span data-stu-id="04d9d-175">**Pools are allocated in**</span></span>               | <span data-ttu-id="04d9d-176">Подписка, управляемая Azure</span><span class="sxs-lookup"><span data-stu-id="04d9d-176">An Azure-managed subscription</span></span>                                                                           | <span data-ttu-id="04d9d-177">Пользовательская подписка, в которой создана учетная запись пакетной службы</span><span class="sxs-lookup"><span data-stu-id="04d9d-177">The user subscription in which the Batch account is created</span></span>                        |
| <span data-ttu-id="04d9d-178">**Поддерживаемые конфигурации**</span><span class="sxs-lookup"><span data-stu-id="04d9d-178">**Supported configurations**</span></span>             | <ul><li><span data-ttu-id="04d9d-179">Конфигурация облачной службы</span><span class="sxs-lookup"><span data-stu-id="04d9d-179">Cloud Service Configuration</span></span></li><li><span data-ttu-id="04d9d-180">Конфигурация виртуальной машины (Linux и Windows)</span><span class="sxs-lookup"><span data-stu-id="04d9d-180">Virtual Machine Configuration (Linux and Windows)</span></span></li></ul> | <ul><li><span data-ttu-id="04d9d-181">Конфигурация виртуальной машины (Linux и Windows)</span><span class="sxs-lookup"><span data-stu-id="04d9d-181">Virtual Machine Configuration (Linux and Windows)</span></span></li></ul>                |
| <span data-ttu-id="04d9d-182">**Поддерживаемые образы виртуальных машин**</span><span class="sxs-lookup"><span data-stu-id="04d9d-182">**Supported VM images**</span></span>                  | <ul><li><span data-ttu-id="04d9d-183">Образы из Azure Marketplace</span><span class="sxs-lookup"><span data-stu-id="04d9d-183">Azure Marketplace images</span></span></li></ul>                                                              | <ul><li><span data-ttu-id="04d9d-184">Образы из Azure Marketplace</span><span class="sxs-lookup"><span data-stu-id="04d9d-184">Azure Marketplace images</span></span></li><li><span data-ttu-id="04d9d-185">Пользовательские образы</span><span class="sxs-lookup"><span data-stu-id="04d9d-185">Custom images</span></span></li></ul>                   |
| <span data-ttu-id="04d9d-186">**Поддерживаемые типы вычислительных узлов**</span><span class="sxs-lookup"><span data-stu-id="04d9d-186">**Supported compute node types**</span></span>         | <ul><li><span data-ttu-id="04d9d-187">Специальные узлы</span><span class="sxs-lookup"><span data-stu-id="04d9d-187">Dedicated nodes</span></span></li><li><span data-ttu-id="04d9d-188">Низкоприоритетные узлы</span><span class="sxs-lookup"><span data-stu-id="04d9d-188">Low-priority nodes</span></span></li></ul>                                            | <ul><li><span data-ttu-id="04d9d-189">Специальные узлы</span><span class="sxs-lookup"><span data-stu-id="04d9d-189">Dedicated nodes</span></span></li></ul>                                                  |
| <span data-ttu-id="04d9d-190">**Поддерживаемый тип проверки подлинности**</span><span class="sxs-lookup"><span data-stu-id="04d9d-190">**Supported authentication**</span></span>             | <ul><li><span data-ttu-id="04d9d-191">Общий ключ</span><span class="sxs-lookup"><span data-stu-id="04d9d-191">Shared Key</span></span></li><li><span data-ttu-id="04d9d-192">Azure AD</span><span class="sxs-lookup"><span data-stu-id="04d9d-192">Azure AD</span></span></li></ul>                                                           | <ul><li><span data-ttu-id="04d9d-193">Azure AD</span><span class="sxs-lookup"><span data-stu-id="04d9d-193">Azure AD</span></span></li></ul>                                                         |
| <span data-ttu-id="04d9d-194">**Требуется ли хранилище Azure Key Vault**</span><span class="sxs-lookup"><span data-stu-id="04d9d-194">**Azure Key Vault required**</span></span>             | <span data-ttu-id="04d9d-195">Нет</span><span class="sxs-lookup"><span data-stu-id="04d9d-195">No</span></span>                                                                                                      | <span data-ttu-id="04d9d-196">Да</span><span class="sxs-lookup"><span data-stu-id="04d9d-196">Yes</span></span>                                                                                |
| <span data-ttu-id="04d9d-197">**Квота на ядра**</span><span class="sxs-lookup"><span data-stu-id="04d9d-197">**Core quota**</span></span>                           | <span data-ttu-id="04d9d-198">Определяется по квоте на ядра для пакетной службы</span><span class="sxs-lookup"><span data-stu-id="04d9d-198">Determined by Batch core quota</span></span>                                                                          | <span data-ttu-id="04d9d-199">Определяется по квоте на ядра для подписки</span><span class="sxs-lookup"><span data-stu-id="04d9d-199">Determined by subscription core quota</span></span>                                              |
| <span data-ttu-id="04d9d-200">**Поддержка виртуальной сети Azure**</span><span class="sxs-lookup"><span data-stu-id="04d9d-200">**Azure Virtual Network (Vnet) support**</span></span> | <span data-ttu-id="04d9d-201">Пулы, созданные с использованием конфигурации облачной службы</span><span class="sxs-lookup"><span data-stu-id="04d9d-201">Pools created with the Cloud Service Configuration</span></span>                                                      | <span data-ttu-id="04d9d-202">Пулы, созданные с использованием конфигурации виртуальной машины</span><span class="sxs-lookup"><span data-stu-id="04d9d-202">Pools created with the Virtual Machine Configuration</span></span>                               |
| <span data-ttu-id="04d9d-203">**Поддерживаемая модель развертывания виртуальной сети**</span><span class="sxs-lookup"><span data-stu-id="04d9d-203">**Vnet deployment model supported**</span></span>      | <span data-ttu-id="04d9d-204">Виртуальные сети, созданные по классической модели развертывания</span><span class="sxs-lookup"><span data-stu-id="04d9d-204">Vnets created with classic deployment model</span></span>                                                             | <span data-ttu-id="04d9d-205">Виртуальные сети, созданные по классической модели развертывания или модели развертывания с помощью Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="04d9d-205">Vnets created with either the classic deployment model or Azure   Resource Manager</span></span> |

## <a name="azure-storage-account"></a><span data-ttu-id="04d9d-206">Учетная запись хранения Azure</span><span class="sxs-lookup"><span data-stu-id="04d9d-206">Azure Storage account</span></span>

<span data-ttu-id="04d9d-207">В большинстве решений пакетной службы для хранения файлов ресурсов и выходных файлов используется служба хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="04d9d-207">Most Batch solutions use Azure Storage for storing resource files and output files.</span></span>  

<span data-ttu-id="04d9d-208">Сейчас пакетная служба поддерживает только учетные записи хранения общего назначения, как описано в шаге 5 раздела о [создании учетной записи хранения](../storage/common/storage-create-storage-account.md#create-a-storage-account) в статье [Об учетных записях хранения Azure](../storage/common/storage-create-storage-account.md).</span><span class="sxs-lookup"><span data-stu-id="04d9d-208">Batch currently supports only the general-purpose storage account type, as described in step 5 of [Create a storage account](../storage/common/storage-create-storage-account.md#create-a-storage-account) in [About Azure storage accounts](../storage/common/storage-create-storage-account.md).</span></span> <span data-ttu-id="04d9d-209">В задачах пакетной службы (включая стандартные задачи, задачи запуска, задачи подготовки и прекращения заданий) необходимо указывать файлы ресурсов, которые находятся в учетных записях хранения общего назначения.</span><span class="sxs-lookup"><span data-stu-id="04d9d-209">Your Batch tasks (including standard tasks, start tasks, job preparation tasks, and job release tasks) must specify resource files that reside in general-purpose storage accounts.</span></span>


## <a name="compute-node"></a><span data-ttu-id="04d9d-210">Вычислительный узел.</span><span class="sxs-lookup"><span data-stu-id="04d9d-210">Compute node</span></span>
<span data-ttu-id="04d9d-211">Вычислительный узел — это виртуальная машина Azure или облачной службы, назначенная для обработки определенной рабочей нагрузки вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="04d9d-211">A compute node is an Azure virtual machine (VM) or cloud service VM that is dedicated to processing a portion of your application's workload.</span></span> <span data-ttu-id="04d9d-212">Размер узла определяет количество ядер ЦП, объем памяти и размер локальной файловой системы, которые выделяются узлу.</span><span class="sxs-lookup"><span data-stu-id="04d9d-212">The size of a node determines the number of CPU cores, memory capacity, and local file system size that is allocated to the node.</span></span> <span data-ttu-id="04d9d-213">Вы можете создавать пулы узлов Windows или Linux с помощью облачных служб Azure, образов виртуальных машин из [Azure Marketplace][vm_marketplace] или пользовательских образов, подготовленных вами.</span><span class="sxs-lookup"><span data-stu-id="04d9d-213">You can create pools of Windows or Linux nodes by using Azure Cloud Services, images from the [Azure Virtual Machines Marketplace][vm_marketplace], or custom images that you prepare.</span></span> <span data-ttu-id="04d9d-214">Дополнительные сведения см. в разделе [Пул](#pool) ниже.</span><span class="sxs-lookup"><span data-stu-id="04d9d-214">See the following [Pool](#pool) section for more information on these options.</span></span>

<span data-ttu-id="04d9d-215">На узлах может выполняться любой исполняемый файл или скрипт, поддерживаемый его операционной системой:</span><span class="sxs-lookup"><span data-stu-id="04d9d-215">Nodes can run any executable or script that is supported by the operating system environment of the node.</span></span> <span data-ttu-id="04d9d-216">скрипты \*EXE, \*CMD, \*BAT и PowerShell для Windows и двоичные файлы, скрипты оболочки и Python для Linux.</span><span class="sxs-lookup"><span data-stu-id="04d9d-216">This includes \*.exe, \*.cmd, \*.bat and PowerShell scripts for Windows--and binaries, shell, and Python scripts for Linux.</span></span>

<span data-ttu-id="04d9d-217">Для всех вычислительных узлов в пакетной службе характерно следующее:</span><span class="sxs-lookup"><span data-stu-id="04d9d-217">All compute nodes in Batch also include:</span></span>

* <span data-ttu-id="04d9d-218">Стандартная [структура папок](#files-and-directories) и связанные [переменные среды](#environment-settings-for-tasks), на которые могут ссылаться задачи.</span><span class="sxs-lookup"><span data-stu-id="04d9d-218">A standard [folder structure](#files-and-directories) and associated [environment variables](#environment-settings-for-tasks) that are available for reference by tasks.</span></span>
* <span data-ttu-id="04d9d-219">**брандмауэра**, настроенные для управления доступом.</span><span class="sxs-lookup"><span data-stu-id="04d9d-219">**Firewall** settings that are configured to control access.</span></span>
* <span data-ttu-id="04d9d-220">[Удаленный доступ](#connecting-to-compute-nodes) к узлам Windows (по протоколу RDP) и Linux (по протоколу SSH).</span><span class="sxs-lookup"><span data-stu-id="04d9d-220">[Remote access](#connecting-to-compute-nodes) to both Windows (Remote Desktop Protocol (RDP)) and Linux (Secure Shell (SSH)) nodes.</span></span>

## <a name="pool"></a><span data-ttu-id="04d9d-221">пул</span><span class="sxs-lookup"><span data-stu-id="04d9d-221">Pool</span></span>
<span data-ttu-id="04d9d-222">Пул — это коллекция узлов, на которых выполняется приложение.</span><span class="sxs-lookup"><span data-stu-id="04d9d-222">A pool is a collection of nodes that your application runs on.</span></span> <span data-ttu-id="04d9d-223">Пул может быть создан как вами (вручную), так и пакетной службой (автоматически) при указании выполняемых работ.</span><span class="sxs-lookup"><span data-stu-id="04d9d-223">The pool can be created manually by you, or automatically by the Batch service when you specify the work to be done.</span></span> <span data-ttu-id="04d9d-224">Вы можете создавать и изменять пулы в соответствии с потребностями ресурсов своего приложения.</span><span class="sxs-lookup"><span data-stu-id="04d9d-224">You can create and manage a pool that meets the resource requirements of your application.</span></span> <span data-ttu-id="04d9d-225">Пул может использоваться только той учетной записью пакетной службы, в которой он был создан.</span><span class="sxs-lookup"><span data-stu-id="04d9d-225">A pool can be used only by the Batch account in which it was created.</span></span> <span data-ttu-id="04d9d-226">Учетная запись Пакетной службы может содержать более одного пула.</span><span class="sxs-lookup"><span data-stu-id="04d9d-226">A Batch account can have more than one pool.</span></span>

<span data-ttu-id="04d9d-227">Пулы пакетной службы Azure основаны на базовой вычислительной платформе Azure.</span><span class="sxs-lookup"><span data-stu-id="04d9d-227">Azure Batch pools build on top of the core Azure compute platform.</span></span> <span data-ttu-id="04d9d-228">Они удобны для крупномасштабных операций выделения, установки приложений, распространения данных и мониторинга работоспособности. Кроме того, пулы позволяют выполнять [масштабирование](#scaling-compute-resources) — гибкое изменение числа вычислительных узлов в пуле.</span><span class="sxs-lookup"><span data-stu-id="04d9d-228">They provide large-scale allocation, application installation, data distribution, health monitoring, and flexible adjustment of the number of compute nodes within a pool ([scaling](#scaling-compute-resources)).</span></span>

<span data-ttu-id="04d9d-229">Каждому узлу, который добавляется в пул, присваивается уникальное имя и IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="04d9d-229">Every node that is added to a pool is assigned a unique name and IP address.</span></span> <span data-ttu-id="04d9d-230">При удалении узла из пула будут потеряны любые изменения, внесенные в операционную систему или файлы. Имя и IP-адрес удаленного узла освобождаются для использования в других целях.</span><span class="sxs-lookup"><span data-stu-id="04d9d-230">When a node is removed from a pool, any changes that are made to the operating system or files are lost, and its name and IP address are released for future use.</span></span> <span data-ttu-id="04d9d-231">Когда узел покидает пул, он перестает существовать.</span><span class="sxs-lookup"><span data-stu-id="04d9d-231">When a node leaves a pool, its lifetime is over.</span></span>

<span data-ttu-id="04d9d-232">При создании пула можно указать следующие атрибуты.</span><span class="sxs-lookup"><span data-stu-id="04d9d-232">When you create a pool, you can specify the following attributes.</span></span> <span data-ttu-id="04d9d-233">Некоторые параметры различаются в зависимости от режима выделения пула в [учетной записи](#account) пакетной службы:</span><span class="sxs-lookup"><span data-stu-id="04d9d-233">Some settings differ, depending on the pool allocation mode of the Batch [account](#account):</span></span>

- <span data-ttu-id="04d9d-234">операционная система и версия вычислительного узла;</span><span class="sxs-lookup"><span data-stu-id="04d9d-234">Compute node operating system and version</span></span>
- <span data-ttu-id="04d9d-235">тип вычислительного узла и целевое количество узлов;</span><span class="sxs-lookup"><span data-stu-id="04d9d-235">Compute node type and target number of nodes</span></span>
- <span data-ttu-id="04d9d-236">размер вычислительных узлов;</span><span class="sxs-lookup"><span data-stu-id="04d9d-236">Size of the compute nodes</span></span>
- <span data-ttu-id="04d9d-237">политика масштабирования;</span><span class="sxs-lookup"><span data-stu-id="04d9d-237">Scaling policy</span></span>
- <span data-ttu-id="04d9d-238">политика планирования задач;</span><span class="sxs-lookup"><span data-stu-id="04d9d-238">Task scheduling policy</span></span>
- <span data-ttu-id="04d9d-239">состояние взаимодействия между вычислительными узлами;</span><span class="sxs-lookup"><span data-stu-id="04d9d-239">Communication status for compute nodes</span></span>
- <span data-ttu-id="04d9d-240">задачи запуска для вычислительных узлов;</span><span class="sxs-lookup"><span data-stu-id="04d9d-240">Start tasks for compute nodes</span></span>
- <span data-ttu-id="04d9d-241">Пакеты приложений</span><span class="sxs-lookup"><span data-stu-id="04d9d-241">Application packages</span></span>
- <span data-ttu-id="04d9d-242">Конфигурация сети</span><span class="sxs-lookup"><span data-stu-id="04d9d-242">Network configuration</span></span>

<span data-ttu-id="04d9d-243">Каждый из этих параметров описан более подробно в следующих разделах.</span><span class="sxs-lookup"><span data-stu-id="04d9d-243">Each of these settings is described in more detail in the following sections.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="04d9d-244">Для учетных записей пакетной службы с режимом распределения пула "Пакетная служба" установлена квота по умолчанию, которая ограничивает количество ядер в учетной записи пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-244">Batch accounts created with the Batch Service pool allocation mode have a default quota that limits the number of cores in a Batch account.</span></span> <span data-ttu-id="04d9d-245">Число ядер соответствует количеству вычислительных узлов.</span><span class="sxs-lookup"><span data-stu-id="04d9d-245">The number of cores corresponds to the number of compute nodes.</span></span> <span data-ttu-id="04d9d-246">Дополнительные сведения о квотах по умолчанию и инструкцию по [увеличению квоты](batch-quota-limit.md#increase-a-quota) см. в статье [Квоты и ограничения пакетной службы Azure](batch-quota-limit.md).</span><span class="sxs-lookup"><span data-stu-id="04d9d-246">You can find the default quotas and instructions on how to [increase a quota](batch-quota-limit.md#increase-a-quota) in [Quotas and limits for the Azure Batch service](batch-quota-limit.md).</span></span> <span data-ttu-id="04d9d-247">Если пул не достигает целевого количества узлов, причиной может быть основная квота.</span><span class="sxs-lookup"><span data-stu-id="04d9d-247">If your pool is not achieving its target number of nodes, the core quota might be the reason.</span></span>
>
><span data-ttu-id="04d9d-248">В учетных записях пакетной службы, созданных в режиме распределения пула "Пользовательская подписка", квоты пакетной службы не соблюдаются.</span><span class="sxs-lookup"><span data-stu-id="04d9d-248">Batch accounts created with the User Subscription pool allocation mode do not observe the Batch service quotas.</span></span> <span data-ttu-id="04d9d-249">Вместо этого они совместно используют основную квоту для указанной подписки.</span><span class="sxs-lookup"><span data-stu-id="04d9d-249">Instead, they share in the core quota for the specified subscription.</span></span> <span data-ttu-id="04d9d-250">Дополнительные сведения см. в разделе [Ограничения виртуальных машин](../azure-subscription-service-limits.md#virtual-machines-limits) в статье [Подписка Azure, границы, квоты и ограничения службы](../azure-subscription-service-limits.md).</span><span class="sxs-lookup"><span data-stu-id="04d9d-250">For more information, see [Virtual Machines limits](../azure-subscription-service-limits.md#virtual-machines-limits) in [Azure subscription and service limits, quotas, and constraints](../azure-subscription-service-limits.md).</span></span>
>
>

### <a name="compute-node-operating-system-and-version"></a><span data-ttu-id="04d9d-251">Операционная система и версия вычислительного узла</span><span class="sxs-lookup"><span data-stu-id="04d9d-251">Compute node operating system and version</span></span>

<span data-ttu-id="04d9d-252">При создании пула пакетной службы можно указать конфигурацию виртуальной машины Azure и тип операционной системы, которую вы хотите запустить на каждом вычислительном узле в пуле.</span><span class="sxs-lookup"><span data-stu-id="04d9d-252">When you create a Batch pool, you can specify the Azure virtual machine configuration and the type of operating system you want to run on each compute node in the pool.</span></span> <span data-ttu-id="04d9d-253">В пакетной службе доступны два типа конфигураций:</span><span class="sxs-lookup"><span data-stu-id="04d9d-253">The two types of configurations available in Batch are:</span></span>

- <span data-ttu-id="04d9d-254">**Конфигурация виртуальной машины**, которая указывает, что пул состоит из виртуальных машин Azure.</span><span class="sxs-lookup"><span data-stu-id="04d9d-254">The **Virtual Machine Configuration**, which specifies that the pool is comprised of Azure virtual machines.</span></span> <span data-ttu-id="04d9d-255">Эти виртуальные машины могут быть созданы из образов Windows или Linux.</span><span class="sxs-lookup"><span data-stu-id="04d9d-255">These VMs may be created from either Linux or Windows images.</span></span> 

    <span data-ttu-id="04d9d-256">Создавая пул, основанный на конфигурации виртуальных машин, необходимо указать не только размер узлов и источник образов, которые использовались для их создания, но и **ссылку на образ виртуальной машины** и **номер SKU агента узла** пакетной службы для установки на узлах.</span><span class="sxs-lookup"><span data-stu-id="04d9d-256">When you create a pool based on the Virtual Machine Configuration, you must specify not only the size of the nodes and the source of the images used to create them, but also the **virtual machine image reference** and the Batch **node agent SKU** to be installed on the nodes.</span></span> <span data-ttu-id="04d9d-257">Дополнительные сведения об указании этих свойств пула см. в статье [Подготовка вычислительных узлов Linux в пулах пакетной службы Azure](batch-linux-nodes.md).</span><span class="sxs-lookup"><span data-stu-id="04d9d-257">For more information about specifying these pool properties, see [Provision Linux compute nodes in Azure Batch pools](batch-linux-nodes.md).</span></span>

- <span data-ttu-id="04d9d-258">**Конфигурация облачных служб**, которая указывает, что пул состоит из узлов облачных служб Azure.</span><span class="sxs-lookup"><span data-stu-id="04d9d-258">The **Cloud Services Configuration**, which specifies that the pool is comprised of Azure Cloud Services nodes.</span></span> <span data-ttu-id="04d9d-259">Облачные службы предоставляют *только* вычислительные узлы Windows.</span><span class="sxs-lookup"><span data-stu-id="04d9d-259">Cloud Services provide Windows compute nodes *only*.</span></span>

    <span data-ttu-id="04d9d-260">Доступные операционные системы пулов с конфигурацией облачных служб перечислены в статье [Таблица совместимости выпусков гостевых ОС Azure и пакетов SDK](../cloud-services/cloud-services-guestos-update-matrix.md).</span><span class="sxs-lookup"><span data-stu-id="04d9d-260">Available operating systems for Cloud Services Configuration pools are listed in the [Azure Guest OS releases and SDK compatibility matrix](../cloud-services/cloud-services-guestos-update-matrix.md).</span></span> <span data-ttu-id="04d9d-261">При создании пула, содержащего узлы облачных служб, необходимо указать размер узла и соответствующее *семейство ОС*.</span><span class="sxs-lookup"><span data-stu-id="04d9d-261">When you create a pool that contains Cloud Services nodes, you need to specify the node size and its *OS Family*.</span></span> <span data-ttu-id="04d9d-262">Облачные службы развертываются в Azure быстрее, чем виртуальные машины под управлением Windows.</span><span class="sxs-lookup"><span data-stu-id="04d9d-262">Cloud Services are deployed to Azure more quickly than virtual machines running Windows.</span></span> <span data-ttu-id="04d9d-263">Если вам нужны пулы вычислительных узлов Windows, вы можете обнаружить, что облачные службы предоставляют преимущества производительности с точки зрения времени развертывания.</span><span class="sxs-lookup"><span data-stu-id="04d9d-263">If you want pools of Windows compute nodes, you may find that Cloud Services provide a performance benefit in terms of deployment time.</span></span>

    * <span data-ttu-id="04d9d-264">*Семейство ОС* также определяет, какие версии .NET устанавливаются вместе с операционной системой.</span><span class="sxs-lookup"><span data-stu-id="04d9d-264">The *OS Family* also determines which versions of .NET are installed with the OS.</span></span>
    * <span data-ttu-id="04d9d-265">Вы можете выбрать для узлов *версию ОС*, так же как и для рабочих ролей в облачных службах (дополнительные сведения о рабочих ролях см. в разделе [Информация об облачных службах](../cloud-services/cloud-services-choose-me.md#tell-me-about-cloud-services) статьи [Стоит ли сделать выбор в пользу облачных служб или чего-то другого?](../cloud-services/cloud-services-choose-me.md)).</span><span class="sxs-lookup"><span data-stu-id="04d9d-265">As with worker roles within Cloud Services, you can specify an *OS Version* (for more information on worker roles, see the [Tell me about cloud services](../cloud-services/cloud-services-choose-me.md#tell-me-about-cloud-services) section in the [Cloud Services overview](../cloud-services/cloud-services-choose-me.md)).</span></span>
    * <span data-ttu-id="04d9d-266">Как и для рабочих ролей, мы рекомендуем указывать значение `*` в качестве *версии ОС*. Тогда узлы будут обновляться автоматически, и вам не нужно будет выполнять дополнительные действия при выходе новых версий.</span><span class="sxs-lookup"><span data-stu-id="04d9d-266">As with worker roles, we recommend that you specify `*` for the *OS Version* so that the nodes are automatically upgraded, and there is no work required to cater to newly released versions.</span></span> <span data-ttu-id="04d9d-267">Выбор конкретной версии ОС обычно нужен только для гарантии совместимости приложений. Это позволит протестировать обратную совместимость перед установкой обновлений.</span><span class="sxs-lookup"><span data-stu-id="04d9d-267">The primary use case for selecting a specific OS version is to ensure application compatibility, which allows backward compatibility testing to be performed before allowing the version to be updated.</span></span> <span data-ttu-id="04d9d-268">После успешной проверки вам понадобится обновить *версию ОС* для пула и установить новый образ ОС. Все выполняемые задачи будут при этом прерваны и повторно поставлены в очередь.</span><span class="sxs-lookup"><span data-stu-id="04d9d-268">After validation, the *OS Version* for the pool can be updated and the new OS image can be installed--any running tasks are interrupted and requeued.</span></span>

<span data-ttu-id="04d9d-269">При создании пула вам необходимо выбрать соответствующий **nodeAgentSkuId** в зависимости от ОС базового образа вашего VHD.</span><span class="sxs-lookup"><span data-stu-id="04d9d-269">When you create a pool, you need to select the appropriate **nodeAgentSkuId**, depending on the OS of the base image of your VHD.</span></span> <span data-ttu-id="04d9d-270">Вы можете получить сопоставление идентификаторов SKU доступных агентов узла с их ссылками на образы на ОС, вызвав операцию [List Supported Node Agent SKUs](https://docs.microsoft.com/rest/api/batchservice/list-supported-node-agent-skus) (Вывод списка поддерживаемых SKU агентов узла).</span><span class="sxs-lookup"><span data-stu-id="04d9d-270">You can get a mapping of available node agent SKU ID's to their OS Image references by calling the [List Supported Node Agent SKUs](https://docs.microsoft.com/rest/api/batchservice/list-supported-node-agent-skus) operation.</span></span>

<span data-ttu-id="04d9d-271">Дополнительные сведения о настройке режима выделения пула при создании учетной записи пакетной службы см. в разделе [Учетная запись](#account).</span><span class="sxs-lookup"><span data-stu-id="04d9d-271">See the [Account](#account) section for information on setting the pool allocation mode when you create a Batch account.</span></span>

#### <a name="custom-images-for-virtual-machine-pools"></a><span data-ttu-id="04d9d-272">Пользовательские образы для пулов виртуальных машин</span><span class="sxs-lookup"><span data-stu-id="04d9d-272">Custom images for Virtual Machine pools</span></span>

<span data-ttu-id="04d9d-273">Чтобы использовать пользовательский образ для подготовки пулов виртуальных машин, создайте учетную запись пакетной службы в режиме распределения пула "Пользовательская подписка".</span><span class="sxs-lookup"><span data-stu-id="04d9d-273">To use a custom image to provision Virtual Machine pools, create your Batch account with the User Subscription pool allocation mode.</span></span> <span data-ttu-id="04d9d-274">В этом режиме пулы пакетной службы выделяются для подписки, в которой находится учетная запись.</span><span class="sxs-lookup"><span data-stu-id="04d9d-274">With this mode, Batch pools are allocated into the subscription where the account resides.</span></span> <span data-ttu-id="04d9d-275">Дополнительные сведения о настройке режима выделения пула при создании учетной записи пакетной службы см. в разделе [Учетная запись](#account).</span><span class="sxs-lookup"><span data-stu-id="04d9d-275">See the [Account](#account) section for information on setting the pool allocation mode when you create a Batch account.</span></span>

<span data-ttu-id="04d9d-276">Чтобы использовать пользовательский образ, подготовьте его, сделав универсальным.</span><span class="sxs-lookup"><span data-stu-id="04d9d-276">To use a custom image, you'll need to prepare the image by generalizing it.</span></span> <span data-ttu-id="04d9d-277">Сведения о подготовке пользовательских образов под управлением Linux на основе виртуальных машин Azure см. в статье [Запись виртуальной машины Linux, работающей в Azure](../virtual-machines/linux/capture-image-nodejs.md).</span><span class="sxs-lookup"><span data-stu-id="04d9d-277">For information about preparing custom Linux images from Azure VMs, see [Capture an Azure Linux VM to use as a template](../virtual-machines/linux/capture-image-nodejs.md).</span></span> <span data-ttu-id="04d9d-278">Сведения о подготовке пользовательских образов под управлением Windows на основе виртуальных машин Azure см. в статье [Создание пользовательского образа виртуальной машины Azure с помощью PowerShell](../virtual-machines/windows/tutorial-custom-images.md).</span><span class="sxs-lookup"><span data-stu-id="04d9d-278">For information about preparing custom Windows images from Azure VMs, see [Create custom VM images with Azure PowerShell](../virtual-machines/windows/tutorial-custom-images.md).</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="04d9d-279">При подготовке пользовательского образа учитывайте следующие факторы:</span><span class="sxs-lookup"><span data-stu-id="04d9d-279">When preparing your custom image, keep in mind the following:</span></span>
> - <span data-ttu-id="04d9d-280">Убедитесь, что в базовом образе операционной системы, который используется для подготовки пулов пакетной службы, нет предварительно установленных расширений Azure, например расширения "Настраиваемый скрипт".</span><span class="sxs-lookup"><span data-stu-id="04d9d-280">Ensure that the base OS image you use to provision your Batch pools does not have any pre-installed Azure extensions, such as the Custom Script extension.</span></span> <span data-ttu-id="04d9d-281">Если образ содержит предварительно установленное расширение, могут возникнуть проблемы при развертывании виртуальной машины в Azure.</span><span class="sxs-lookup"><span data-stu-id="04d9d-281">If the image contains a pre-installed extension, Azure may encounter problems deploying the VM.</span></span>
> - <span data-ttu-id="04d9d-282">Убедитесь, что для базового образа операционной системы, предоставленного вами, по умолчанию используется временный диск, так как на текущем этапе для агента узла пакетной службы требуется этот временный диск.</span><span class="sxs-lookup"><span data-stu-id="04d9d-282">Ensure that the base OS image you provide uses the default temp drive, as the Batch node agent currently expects the default temp drive.</span></span>
>
>

<span data-ttu-id="04d9d-283">Чтобы создать пул конфигурации виртуальной машины с помощью пользовательского образа, потребуется одна или несколько стандартных учетных записей хранения Azure для хранения пользовательских образов VHD.</span><span class="sxs-lookup"><span data-stu-id="04d9d-283">To create a Virtual Machine Configuration pool using a custom image, you'll need one or more standard Azure Storage accounts to store your custom VHD images.</span></span> <span data-ttu-id="04d9d-284">Пользовательские образы хранятся в виде больших двоичных объектов.</span><span class="sxs-lookup"><span data-stu-id="04d9d-284">Custom images are stored as blobs.</span></span> <span data-ttu-id="04d9d-285">Чтобы сослаться на свои пользовательские образы при создании пула, укажите URI больших двоичных объектов VHD-файлов пользовательских образов для свойства [osDisk](https://docs.microsoft.com/rest/api/batchservice/add-a-pool-to-an-account#bk_osdisk) свойства [virtualMachineConfiguration](https://docs.microsoft.com/rest/api/batchservice/add-a-pool-to-an-account#bk_vmconf).</span><span class="sxs-lookup"><span data-stu-id="04d9d-285">To reference your custom images when you create a pool, specify the URIs of the custom image VHD blobs for the [osDisk](https://docs.microsoft.com/rest/api/batchservice/add-a-pool-to-an-account#bk_osdisk) property of the [virtualMachineConfiguration](https://docs.microsoft.com/rest/api/batchservice/add-a-pool-to-an-account#bk_vmconf) property.</span></span>

<span data-ttu-id="04d9d-286">Убедитесь, что учетные записи хранения соответствуют следующим критериям:</span><span class="sxs-lookup"><span data-stu-id="04d9d-286">Make sure that your storage accounts meet the following criteria:</span></span>   

- <span data-ttu-id="04d9d-287">Учетные записи хранения, содержащие большие двоичные объекты VHD-файлов пользовательских образов, должны находиться в той же подписке, что и учетная запись пакетной службы (подписка пользователя).</span><span class="sxs-lookup"><span data-stu-id="04d9d-287">The storage accounts containing the custom image VHD blobs need to be in the same subscription as the Batch account (the user subscription).</span></span>
- <span data-ttu-id="04d9d-288">Указанная учетная запись хранения должна быть в том же регионе, что и учетная запись пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-288">The specified storage accounts need to be in the same region as the Batch account.</span></span>
- <span data-ttu-id="04d9d-289">Сейчас поддерживаются только стандартные учетные записи хранения общего назначения.</span><span class="sxs-lookup"><span data-stu-id="04d9d-289">Only standard general-purpose storage accounts are currently supported.</span></span> <span data-ttu-id="04d9d-290">В дальнейшем будет поддерживаться хранилище Azure класса Premium.</span><span class="sxs-lookup"><span data-stu-id="04d9d-290">Azure Premium storage will be supported in the future.</span></span>
- <span data-ttu-id="04d9d-291">Вы можете указать одну учетную запись хранения с несколькими большими двоичными объектами пользовательских VHD-файлов или несколькими учетными записями хранения, каждая из которых имеет один большой двоичный объект.</span><span class="sxs-lookup"><span data-stu-id="04d9d-291">You can specify one storage account with multiple custom VHD blobs or multiple storage accounts each having a single blob.</span></span> <span data-ttu-id="04d9d-292">Мы советуем использовать несколько учетных записей хранения, чтобы получить лучшую производительность.</span><span class="sxs-lookup"><span data-stu-id="04d9d-292">We recommend you to use multiple storage accounts to get a better performance.</span></span>
- <span data-ttu-id="04d9d-293">Один уникальный большой двоичный объект VHD пользовательского образа может поддерживать до 40 экземпляров виртуальных машин Linux или до 20 экземпляров виртуальных машин Windows.</span><span class="sxs-lookup"><span data-stu-id="04d9d-293">One unique custom image VHD blob can support up to 40 Linux VM instances or 20 Windows VM instances.</span></span> <span data-ttu-id="04d9d-294">Необходимо будет создать копии большого двоичного объекта VHD для создания пулов с большим количеством виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="04d9d-294">You will need to create copies of the VHD blob to create pools with more VMs.</span></span> <span data-ttu-id="04d9d-295">Например, пулу с 200 виртуальными машинами Windows необходимо указать 10 уникальных больших двоичных объектов VHD для свойства **osDisk**.</span><span class="sxs-lookup"><span data-stu-id="04d9d-295">For example, a pool with 200 Windows VMs needs 10 unique VHD blobs specified for the **osDisk** property.</span></span>

<span data-ttu-id="04d9d-296">Чтобы создать пул из пользовательского образа, используя портал Azure:</span><span class="sxs-lookup"><span data-stu-id="04d9d-296">To create a pool from a custom image using the Azure portal:</span></span>

1. <span data-ttu-id="04d9d-297">Войдите в свою учетную запись пакетной службы на портале Azure.</span><span class="sxs-lookup"><span data-stu-id="04d9d-297">Navigate to your Batch account in the Azure portal.</span></span>
2. <span data-ttu-id="04d9d-298">В колонке **Параметры** выберите пункт меню **Пулы**.</span><span class="sxs-lookup"><span data-stu-id="04d9d-298">On the **Settings** blade, select the **Pools** menu item.</span></span>
3. <span data-ttu-id="04d9d-299">В колонке **Пулы** выберите команду **Добавить**, после чего отобразится колонка **Добавить пул**.</span><span class="sxs-lookup"><span data-stu-id="04d9d-299">On the **Pools** blade, select the **Add** command; the **Add pool** blade will be displayed.</span></span>
4. <span data-ttu-id="04d9d-300">В раскрывающемся списке **Тип образа** выберите **Пользовательский образ (Linux или Windows)**.</span><span class="sxs-lookup"><span data-stu-id="04d9d-300">Select **Custom Image (Linux/Windows)** from the **Image Type** dropdown.</span></span> <span data-ttu-id="04d9d-301">На портале отобразится средство выбора **пользовательского образа**.</span><span class="sxs-lookup"><span data-stu-id="04d9d-301">The portal displays the **Custom Image** picker.</span></span> <span data-ttu-id="04d9d-302">Выберите один или несколько VHD из одного контейнера и нажмите кнопку **Выбрать**.</span><span class="sxs-lookup"><span data-stu-id="04d9d-302">Choose one or more VHDs from the same container and click the **Select** button.</span></span> 
    <span data-ttu-id="04d9d-303">Поддержка нескольких VHD из разных учетных записей хранения и других контейнеров будет добавлена в будущем.</span><span class="sxs-lookup"><span data-stu-id="04d9d-303">Support for multiple VHDs from different storage accounts and different containers will be added in the future.</span></span>
5. <span data-ttu-id="04d9d-304">Выберите правильные значения **издателя, предложения, SKU** для пользовательских VHD, выберите желаемый режим **кэширования**, а затем заполните все остальные параметры для пула.</span><span class="sxs-lookup"><span data-stu-id="04d9d-304">Select the correct **Publisher/Offer/Sku** for your custom VHDs, select the desired **Caching** mode, then fill in all the other parameters for the pool.</span></span>
6. <span data-ttu-id="04d9d-305">Чтобы проверить, основан ли пул на пользовательском образе, найдите свойство **Операционная система** в разделе сводки по ресурсу колонки **Пул**.</span><span class="sxs-lookup"><span data-stu-id="04d9d-305">To check if a pool is based on a custom image, see the **Operating System** property in the resource summary section of the **Pool** blade.</span></span> <span data-ttu-id="04d9d-306">Это свойство должно иметь значение **Пользовательский образ виртуальной машины**.</span><span class="sxs-lookup"><span data-stu-id="04d9d-306">The value of this property should be **Custom VM image**.</span></span>
7. <span data-ttu-id="04d9d-307">Все пользовательские VHD, связанные с пулом, отображаются в колонке **Свойства** пула.</span><span class="sxs-lookup"><span data-stu-id="04d9d-307">All custom VHDs associated with a pool are displayed on the pool's **Properties** blade.</span></span>

### <a name="compute-node-type-and-target-number-of-nodes"></a><span data-ttu-id="04d9d-308">Тип вычислительного узла и целевое количество узлов</span><span class="sxs-lookup"><span data-stu-id="04d9d-308">Compute node type and target number of nodes</span></span>

<span data-ttu-id="04d9d-309">При создании пула можно указать нужные типы вычислительных узлов, а также целевое количество узлов.</span><span class="sxs-lookup"><span data-stu-id="04d9d-309">When you create a pool, you can specify which types of compute nodes you want and the target number for each.</span></span> <span data-ttu-id="04d9d-310">Ниже приведены два типа вычислительных узлов.</span><span class="sxs-lookup"><span data-stu-id="04d9d-310">The two types of compute nodes are:</span></span>

- <span data-ttu-id="04d9d-311">**Выделенные вычислительные узлы.**</span><span class="sxs-lookup"><span data-stu-id="04d9d-311">**Dedicated compute nodes.**</span></span> <span data-ttu-id="04d9d-312">Выделенные вычислительные узлы зарезервированы для рабочих нагрузок.</span><span class="sxs-lookup"><span data-stu-id="04d9d-312">Dedicated compute nodes are reserved for your workloads.</span></span> <span data-ttu-id="04d9d-313">Они более затратные, чем низкоприоритетные узлы, но они никогда не замещаются.</span><span class="sxs-lookup"><span data-stu-id="04d9d-313">They are more expensive than low-priority nodes, but they are guaranteed to never be preempted.</span></span>

- <span data-ttu-id="04d9d-314">**Низкоприоритетные вычислительные узлы.**</span><span class="sxs-lookup"><span data-stu-id="04d9d-314">**Low-priority compute nodes.**</span></span> <span data-ttu-id="04d9d-315">Низкоприоритетные узлы используют избыточные ресурсы в Azure для выполнения рабочих нагрузок пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-315">Low-priority nodes take advantage of surplus capacity in Azure to run your Batch workloads.</span></span> <span data-ttu-id="04d9d-316">Они экономичнее (дешевле в час) по сравнению с выделенными узлами и выполняют рабочие нагрузки, требующие большого объема вычислительной мощности.</span><span class="sxs-lookup"><span data-stu-id="04d9d-316">Low-priority nodes are less expensive per hour than dedicated nodes, and enable workloads requiring a lot of compute power.</span></span> <span data-ttu-id="04d9d-317">Дополнительные сведения см. в статье [Использование низкоприоритетных виртуальных машин в пакетной службе (предварительная версия)](batch-low-pri-vms.md).</span><span class="sxs-lookup"><span data-stu-id="04d9d-317">For more information, see [Use low-priority VMs with Batch](batch-low-pri-vms.md).</span></span>

    <span data-ttu-id="04d9d-318">При недостаточном количестве избыточных ресурсов в Azure низкоприоритетные вычислительные узлы замещаются.</span><span class="sxs-lookup"><span data-stu-id="04d9d-318">Low-priority compute nodes may be preempted when Azure has insufficient surplus capacity.</span></span> <span data-ttu-id="04d9d-319">Если при выполнении задач узел замещается, задачи помещаются в очередь и перезапускаются, как только он снова станет доступным.</span><span class="sxs-lookup"><span data-stu-id="04d9d-319">If a node is preempted while running tasks, the tasks are requeued and run again once a compute node becomes available again.</span></span> <span data-ttu-id="04d9d-320">Низкоприоритетные узлы — это оптимальный вариант для рабочих нагрузок, где время завершения задания гибкое, а работа распределяется по нескольким узлам.</span><span class="sxs-lookup"><span data-stu-id="04d9d-320">Low-priority nodes are a good option for workloads where the job completion time is flexible and the work is distributed across many nodes.</span></span> <span data-ttu-id="04d9d-321">Прежде чем использовать низкоприоритетные узлы для своего сценария, убедитесь, что любые потери работы из-за замещения будут минимальны и легко воссоздаваемы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-321">Before you decide to use low-priority nodes for your scenario, make sure that any work lost due to preemption will be minimal and easy to recreate.</span></span>

    <span data-ttu-id="04d9d-322">Они доступны только для учетных записей пакетной службы со значением **Пакетная служба** для режима выделения пула.</span><span class="sxs-lookup"><span data-stu-id="04d9d-322">Low-priority compute nodes are available only for Batch accounts created with the pool allocation mode set to **Batch Service**.</span></span>

<span data-ttu-id="04d9d-323">Низкоприоритетные и выделенные вычислительные узлы могут находиться в одном и том же пуле.</span><span class="sxs-lookup"><span data-stu-id="04d9d-323">You can have both low-priority and dedicated compute nodes in the same pool.</span></span> <span data-ttu-id="04d9d-324">Каждый тип узла &mdash; с низким приоритетом и выделенный &mdash; содержит свой собственный целевой объект, для которого можно указать необходимое количество узлов.</span><span class="sxs-lookup"><span data-stu-id="04d9d-324">Each type of node &mdash; low-priority and dedicated &mdash; has its own target setting, for which you can specify the desired number of nodes.</span></span> 
    
<span data-ttu-id="04d9d-325">Оно называется *целевым*, так как в некоторых случаях пул не может достигнуть требуемого числа узлов.</span><span class="sxs-lookup"><span data-stu-id="04d9d-325">The number of compute nodes is referred to as a *target* because, in some situations, your pool might not reach the desired number of nodes.</span></span> <span data-ttu-id="04d9d-326">Например, это может произойти из-за достижения [квоты на ядра](batch-quota-limit.md) для учетной записи пакетной службы</span><span class="sxs-lookup"><span data-stu-id="04d9d-326">For example, a pool might not achieve the target if it reaches the [core quota](batch-quota-limit.md) for your Batch account first.</span></span> <span data-ttu-id="04d9d-327">или если примененная к пулу формула автоматического масштабирования ограничивает максимальное количество узлов.</span><span class="sxs-lookup"><span data-stu-id="04d9d-327">Or, the pool might not achieve the target if you have applied an auto-scaling formula to the pool that limits the maximum number of nodes.</span></span>

<span data-ttu-id="04d9d-328">Дополнительные сведения о ценах на низкоприоритетные и выделенные вычислительные узлы см. на странице [цен на пакетную службу](https://azure.microsoft.com/pricing/details/batch/).</span><span class="sxs-lookup"><span data-stu-id="04d9d-328">For pricing information for both low-priority and dedicated compute nodes, see [Batch Pricing](https://azure.microsoft.com/pricing/details/batch/).</span></span>

### <a name="size-of-the-compute-nodes"></a><span data-ttu-id="04d9d-329">Размер вычислительных узлов</span><span class="sxs-lookup"><span data-stu-id="04d9d-329">Size of the compute nodes</span></span>

<span data-ttu-id="04d9d-330">**конфигурация облачных служб**, приведены в статье [Размеры для облачных служб](../cloud-services/cloud-services-sizes-specs.md).</span><span class="sxs-lookup"><span data-stu-id="04d9d-330">**Cloud Services Configuration** compute node sizes are listed in [Sizes for Cloud Services](../cloud-services/cloud-services-sizes-specs.md).</span></span> <span data-ttu-id="04d9d-331">Пакетная служба поддерживает все размеры облачных служб, кроме `ExtraSmall`, `STANDARD_A1_V2` и `STANDARD_A2_V2`.</span><span class="sxs-lookup"><span data-stu-id="04d9d-331">Batch supports all Cloud Services sizes except `ExtraSmall`, `STANDARD_A1_V2`, and `STANDARD_A2_V2`.</span></span>

<span data-ttu-id="04d9d-332">Размеры вычислительных узлов, доступные в **конфигурации виртуальной машины**, перечислены в статьях [Размеры виртуальных машин в Azure](../virtual-machines/linux/sizes.md) для Linux и [Размеры виртуальных машин в Azure](../virtual-machines/windows/sizes.md) для Windows.</span><span class="sxs-lookup"><span data-stu-id="04d9d-332">**Virtual Machine Configuration** compute node sizes are listed in [Sizes for virtual machines in Azure](../virtual-machines/linux/sizes.md) (Linux) and [Sizes for virtual machines in Azure](../virtual-machines/windows/sizes.md) (Windows).</span></span> <span data-ttu-id="04d9d-333">Пакетная служба поддерживает все размеры виртуальных машин Azure, кроме `STANDARD_A0`. Для хранилища класса Premium также не поддерживаются размеры таких серий: `STANDARD_GS`, `STANDARD_DS` и `STANDARD_DSV2`.</span><span class="sxs-lookup"><span data-stu-id="04d9d-333">Batch supports all Azure VM sizes except `STANDARD_A0` and those with premium storage (`STANDARD_GS`, `STANDARD_DS`, and `STANDARD_DSV2` series).</span></span>

<span data-ttu-id="04d9d-334">При выборе размера вычислительного узла учтите характеристики и требования приложений, которые будут на нем выполняться.</span><span class="sxs-lookup"><span data-stu-id="04d9d-334">When selecting a compute node size, consider the characteristics and requirements of the applications you'll run on the nodes.</span></span> <span data-ttu-id="04d9d-335">Чтобы выбрать правильный размер узла, что позволит снизить затраты, также следует учитывать такие аспекты, как многопоточность приложений и требуемый объем памяти.</span><span class="sxs-lookup"><span data-stu-id="04d9d-335">Aspects like whether the application is multithreaded and how much memory it consumes can help determine the most suitable and cost-effective node size.</span></span> <span data-ttu-id="04d9d-336">Обычно при выборе размера узла предполагается, что единовременно на нем будет выполняться одна задача.</span><span class="sxs-lookup"><span data-stu-id="04d9d-336">It's typical to select a node size assuming one task will run on a node at a time.</span></span> <span data-ttu-id="04d9d-337">Вы можете настроить [параллельное выполнение](batch-parallel-node-tasks.md) нескольких задач (а значит и нескольких экземпляров приложения) на вычислительном узле во время выполнения задания.</span><span class="sxs-lookup"><span data-stu-id="04d9d-337">However, it is possible to have multiple tasks (and therefore multiple application instances) [run in parallel](batch-parallel-node-tasks.md) on compute nodes during job execution.</span></span> <span data-ttu-id="04d9d-338">В таком случае обычно выбирается более крупный узел с учетом роста потребностей, связанных с выполнением параллельных задач.</span><span class="sxs-lookup"><span data-stu-id="04d9d-338">In this case, it is common to choose a larger node size to accommodate the increased demand of parallel task execution.</span></span> <span data-ttu-id="04d9d-339">Дополнительные сведения см. в описании атрибута [Политика планирования задач](#task-scheduling-policy).</span><span class="sxs-lookup"><span data-stu-id="04d9d-339">See [Task scheduling policy](#task-scheduling-policy) for more information.</span></span>

<span data-ttu-id="04d9d-340">Все узлы в пуле имеют одинаковый размер.</span><span class="sxs-lookup"><span data-stu-id="04d9d-340">All of the nodes in a pool are the same size.</span></span> <span data-ttu-id="04d9d-341">Если вы планируете выполнять приложения с разными требованиями к системе и/или с разной нагрузкой, рекомендуется использовать отдельные пулы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-341">If you intend to run applications with differing system requirements and/or load levels, we recommend that you use separate pools.</span></span>

### <a name="scaling-policy"></a><span data-ttu-id="04d9d-342">Политика масштабирования</span><span class="sxs-lookup"><span data-stu-id="04d9d-342">Scaling policy</span></span>

<span data-ttu-id="04d9d-343">Для динамических рабочих нагрузок можно написать и применить к пулу [формулу автоматического масштабирования](#scaling-compute-resources).</span><span class="sxs-lookup"><span data-stu-id="04d9d-343">For dynamic workloads, you can write and apply an [auto-scaling formula](#scaling-compute-resources) to a pool.</span></span> <span data-ttu-id="04d9d-344">По этой формуле пакетная служба периодически вычисляет и изменяет количество узлов в пуле в зависимости от выбранных вами параметров пула, заданий и задач.</span><span class="sxs-lookup"><span data-stu-id="04d9d-344">The Batch service periodically evaluates your formula and adjusts the number of nodes within the pool based on various pool, job, and task parameters that you can specify.</span></span>

### <a name="task-scheduling-policy"></a><span data-ttu-id="04d9d-345">Политика планирования задач</span><span class="sxs-lookup"><span data-stu-id="04d9d-345">Task scheduling policy</span></span>

<span data-ttu-id="04d9d-346">Параметр конфигурации [Максимальное число заданий на узел](batch-parallel-node-tasks.md) определяет максимальное число задач, которые могут параллельно выполняться на каждом вычислительном узле пула.</span><span class="sxs-lookup"><span data-stu-id="04d9d-346">The [max tasks per node](batch-parallel-node-tasks.md) configuration option determines the maximum number of tasks that can be run in parallel on each compute node within the pool.</span></span>

<span data-ttu-id="04d9d-347">В конфигурации по умолчанию указывается выполнение только одной задачи на узле в любое время. Но в некоторых ситуациях выполнение нескольких задач на одном узле будет более правильным выбором.</span><span class="sxs-lookup"><span data-stu-id="04d9d-347">The default configuration specifies that one task at a time runs on a node, but there are scenarios where it is beneficial to have two or more tasks executed on a node simultaneously.</span></span> <span data-ttu-id="04d9d-348">Сведения о преимуществах выполнения нескольких задач на узле см. в разделе [Пример сценария](batch-parallel-node-tasks.md#example-scenario) статьи [Повышение эффективности вычислительных ресурсов в пакетной службе Azure благодаря параллельному выполнению задач на узлах](batch-parallel-node-tasks.md).</span><span class="sxs-lookup"><span data-stu-id="04d9d-348">See the [example scenario](batch-parallel-node-tasks.md#example-scenario) in the [concurrent node tasks](batch-parallel-node-tasks.md) article to see how you can benefit from multiple tasks per node.</span></span>

<span data-ttu-id="04d9d-349">Вы также можете выбрать *тип заполнения*. Пакетная служба может равномерно распределять задачи между всеми узлами в пуле или назначать каждому узлу максимально возможное число задач, прежде чем переходить к загрузке следующего узла пула.</span><span class="sxs-lookup"><span data-stu-id="04d9d-349">You can also specify a *fill type* which determines whether Batch spreads the tasks evenly across all nodes in a pool, or packs each node with the maximum number of tasks before assigning tasks to another node.</span></span>

### <a name="communication-status-for-compute-nodes"></a><span data-ttu-id="04d9d-350">Состояние взаимодействия между вычислительными узлами</span><span class="sxs-lookup"><span data-stu-id="04d9d-350">Communication status for compute nodes</span></span>

<span data-ttu-id="04d9d-351">В большинстве случаев задачи работают независимо друг от друга и взаимодействие между ними не требуется.</span><span class="sxs-lookup"><span data-stu-id="04d9d-351">In most scenarios, tasks operate independently and do not need to communicate with one another.</span></span> <span data-ttu-id="04d9d-352">Но в некоторых приложениях задачи должны взаимодействовать (например, при использовании [задач с несколькими экземплярами](batch-mpi.md)).</span><span class="sxs-lookup"><span data-stu-id="04d9d-352">However, there are some applications in which tasks must communicate, like [MPI scenarios](batch-mpi.md).</span></span>

<span data-ttu-id="04d9d-353">Вы можете разрешить **обмен данными между узлами**, входящими в один пул, для взаимодействия во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="04d9d-353">You can configure a pool to allow **internode communication**, so that nodes within a pool can communicate at runtime.</span></span> <span data-ttu-id="04d9d-354">При включении обмена данными между узлами узлы в пулах с конфигурацией облачных служб могут взаимодействовать друг с другом через порты с номерами выше 1100. При этом пулы с конфигурацией виртуальной машины не ограничивают трафик через какой-либо порт.</span><span class="sxs-lookup"><span data-stu-id="04d9d-354">When internode communication is enabled, nodes in Cloud Services Configuration pools can communicate with each other on ports greater than 1100, and Virtual Machine Configuration pools do not restrict traffic on any port.</span></span>

<span data-ttu-id="04d9d-355">Обратите внимание, что включение обмена данными между узлами также влияет на размещение узлов в кластерах и из-за ограничений развертывания может ограничить максимальное количество узлов в пуле.</span><span class="sxs-lookup"><span data-stu-id="04d9d-355">Note that enabling internode communication also impacts the placement of the nodes within clusters and might limit the maximum number of nodes in a pool because of deployment restrictions.</span></span> <span data-ttu-id="04d9d-356">Если приложению не требуется обмен данными между узлами, пакетная служба может выделить для пула большое количество узлов из разных кластеров и центров обработки данных. Это позволяет увеличить производительность параллельной обработки.</span><span class="sxs-lookup"><span data-stu-id="04d9d-356">If your application does not require communication between nodes, the Batch service can allocate a potentially large number of nodes to the pool from many different clusters and datacenters to enable increased parallel processing power.</span></span>

### <a name="start-tasks-for-compute-nodes"></a><span data-ttu-id="04d9d-357">Задачи запуска для вычислительных узлов</span><span class="sxs-lookup"><span data-stu-id="04d9d-357">Start tasks for compute nodes</span></span>

<span data-ttu-id="04d9d-358">*Задача запуска* (необязательный параметр) будет выполняться на каждом узле при его присоединении к пулу, а также при каждом перезапуске или пересоздании образа узла.</span><span class="sxs-lookup"><span data-stu-id="04d9d-358">The optional *start task* executes on each node as that node joins the pool, and each time a node is restarted or reimaged.</span></span> <span data-ttu-id="04d9d-359">Она особенно полезна для подготовки вычислительных узлов к выполнению таких операций, как установка приложений, которые запускаются задачами на вычислительных узлах.</span><span class="sxs-lookup"><span data-stu-id="04d9d-359">The start task is especially useful for preparing compute nodes for the execution of tasks, like installing the applications that your tasks run on the compute nodes.</span></span>

### <a name="application-packages"></a><span data-ttu-id="04d9d-360">Пакеты приложений</span><span class="sxs-lookup"><span data-stu-id="04d9d-360">Application packages</span></span>

<span data-ttu-id="04d9d-361">Вы можете указать [пакеты приложений](#application-packages) для развертывания на вычислительных узлах в пуле.</span><span class="sxs-lookup"><span data-stu-id="04d9d-361">You can specify [application packages](#application-packages) to deploy to the compute nodes in the pool.</span></span> <span data-ttu-id="04d9d-362">Пакеты приложений обеспечивают упрощенное развертывание и управление версиями для приложений, запускаемых с помощью задач.</span><span class="sxs-lookup"><span data-stu-id="04d9d-362">Application packages provide simplified deployment and versioning of the applications that your tasks run.</span></span> <span data-ttu-id="04d9d-363">Пакеты приложений, которые указываются для пула, устанавливаются на каждый вычислительный узел, который присоединяется к пулу, а также каждый раз, когда узел перезагружается или для него пересоздается образ.</span><span class="sxs-lookup"><span data-stu-id="04d9d-363">Application packages that you specify for a pool are installed on every node that joins that pool, and every time a node is rebooted or reimaged.</span></span>

> [!NOTE]
> <span data-ttu-id="04d9d-364">Пакеты приложений поддерживаются во всех пулах пакетной службы, созданных после 5 июля 2017 г.</span><span class="sxs-lookup"><span data-stu-id="04d9d-364">Application packages are supported on all Batch pools created after 5 July 2017.</span></span> <span data-ttu-id="04d9d-365">Если пул создан с помощью конфигурации облачной службы, пакеты приложений также поддерживаются в пулах пакетной службы, созданных между 10 марта 2016 г. и 5 июля 2017 г.</span><span class="sxs-lookup"><span data-stu-id="04d9d-365">They are supported on Batch pools created between 10 March 2016 and 5 July 2017 only if the pool was created using a Cloud Service configuration.</span></span> <span data-ttu-id="04d9d-366">Пулы пакетной службы, созданные до 10 марта 2016 г., не поддерживают пакеты приложений.</span><span class="sxs-lookup"><span data-stu-id="04d9d-366">Batch pools created prior to 10 March 2016 do not support application packages.</span></span> <span data-ttu-id="04d9d-367">Дополнительные сведения о развертывании приложений на узлах пакетной службы с помощью пакетов приложений см .в [этой статье](batch-application-packages.md).</span><span class="sxs-lookup"><span data-stu-id="04d9d-367">For more information about using application packages to deploy your applications to your Batch nodes, see [Deploy applications to compute nodes with Batch application packages](batch-application-packages.md).</span></span>
>
>

### <a name="network-configuration"></a><span data-ttu-id="04d9d-368">Конфигурация сети</span><span class="sxs-lookup"><span data-stu-id="04d9d-368">Network configuration</span></span>

<span data-ttu-id="04d9d-369">Можно указать подсеть [виртуальной сети Azure](../virtual-network/virtual-networks-overview.md), в которой необходимо создать вычислительные узлы для пула.</span><span class="sxs-lookup"><span data-stu-id="04d9d-369">You can specify the subnet of an Azure [virtual network (VNet)](../virtual-network/virtual-networks-overview.md) in which the pool's compute nodes should be created.</span></span> <span data-ttu-id="04d9d-370">Более подробную информацию см. в разделе [Конфигурация сети пула](#pool-network-configuration).</span><span class="sxs-lookup"><span data-stu-id="04d9d-370">See the [Pool network configuration](#pool-network-configuration) section for more information.</span></span>


## <a name="job"></a><span data-ttu-id="04d9d-371">задание</span><span class="sxs-lookup"><span data-stu-id="04d9d-371">Job</span></span>
<span data-ttu-id="04d9d-372">Задание представляет собой набор задач.</span><span class="sxs-lookup"><span data-stu-id="04d9d-372">A job is a collection of tasks.</span></span> <span data-ttu-id="04d9d-373">Оно управляет порядком выполнения вычислений каждой задачей на вычислительных узлах в пуле.</span><span class="sxs-lookup"><span data-stu-id="04d9d-373">It manages how computation is performed by its tasks on the compute nodes in a pool.</span></span>

* <span data-ttu-id="04d9d-374">Задание указывает **пул**, в котором будет выполняться работа.</span><span class="sxs-lookup"><span data-stu-id="04d9d-374">The job specifies the **pool** in which the work is to be run.</span></span> <span data-ttu-id="04d9d-375">Вы можете создавать отдельный пул для каждого задания или использовать один пул для множества заданий.</span><span class="sxs-lookup"><span data-stu-id="04d9d-375">You can create a new pool for each job, or use one pool for many jobs.</span></span> <span data-ttu-id="04d9d-376">Кроме того, вы можете создавать пул для каждого задания, включенного в расписание, или единый пул для всех заданий в одном расписании.</span><span class="sxs-lookup"><span data-stu-id="04d9d-376">You can create a pool for each job that is associated with a job schedule, or for all jobs that are associated with a job schedule.</span></span>
* <span data-ttu-id="04d9d-377">Вы можете указать **приоритет задания**, но это необязательный параметр.</span><span class="sxs-lookup"><span data-stu-id="04d9d-377">You can specify an optional **job priority**.</span></span> <span data-ttu-id="04d9d-378">Если вы создаете задание с более высоким приоритетом, его задачи добавляются в очередь перед задачами менее приоритетных заданий.</span><span class="sxs-lookup"><span data-stu-id="04d9d-378">When a job is submitted with a higher priority than jobs that are currently in progress, the tasks for the higher-priority job are inserted into the queue ahead of tasks for the lower-priority jobs.</span></span> <span data-ttu-id="04d9d-379">Задачи с более низким приоритетом, которые уже выполняются, прерываться не будут.</span><span class="sxs-lookup"><span data-stu-id="04d9d-379">Tasks in lower-priority jobs that are already running are not preempted.</span></span>
* <span data-ttu-id="04d9d-380">Вы можете задать некоторые **ограничения** для заданий.</span><span class="sxs-lookup"><span data-stu-id="04d9d-380">You can use job **constraints** to specify certain limits for your jobs:</span></span>

    <span data-ttu-id="04d9d-381">Например, **максимальное время выполнения**. Таким образом, если задание выполняется дольше этого времени, оно будет завершено вместе со всеми задачами.</span><span class="sxs-lookup"><span data-stu-id="04d9d-381">You can set a **maximum wallclock time**, so that if a job runs for longer than the maximum wallclock time that is specified, the job and all of its tasks are terminated.</span></span>

    <span data-ttu-id="04d9d-382">Пакетная служба может обнаруживать и повторно выполнять незавершенные задачи.</span><span class="sxs-lookup"><span data-stu-id="04d9d-382">Batch can detect and then retry failed tasks.</span></span> <span data-ttu-id="04d9d-383">В качестве ограничения можно указать **максимальное число повторных попыток задачи**, а также следует ли пытаться повторно выполнить задачу (*всегда* или *никогда*).</span><span class="sxs-lookup"><span data-stu-id="04d9d-383">You can specify the **maximum number of task retries** as a constraint, including whether a task is *always* or *never* retried.</span></span> <span data-ttu-id="04d9d-384">Повторное выполнение задачи означает, что она повторно помещается в очередь и будет снова запущена.</span><span class="sxs-lookup"><span data-stu-id="04d9d-384">Retrying a task means that the task is requeued to be run again.</span></span>
* <span data-ttu-id="04d9d-385">Задачи к заданию может добавлять клиентское приложение. Кроме того, можно настроить [задачу диспетчера заданий](#job-manager-task).</span><span class="sxs-lookup"><span data-stu-id="04d9d-385">Your client application can add tasks to a job, or you can specify a [job manager task](#job-manager-task).</span></span> <span data-ttu-id="04d9d-386">Задача диспетчера заданий содержит всю информацию для создания необходимых задач в рамках задания. Эту задачу выполняет один из вычислительных узлов пула.</span><span class="sxs-lookup"><span data-stu-id="04d9d-386">A job manager task contains the information that is necessary to create the required tasks for a job, with the job manager task being run on one of the compute nodes in the pool.</span></span> <span data-ttu-id="04d9d-387">Задача диспетчера заданий обрабатывается пакетной службой особым образом: она помещается в очередь сразу при создании задания и перезапускается, если происходит сбой.</span><span class="sxs-lookup"><span data-stu-id="04d9d-387">The job manager task is handled specifically by Batch--it is queued as soon as the job is created, and is restarted if it fails.</span></span> <span data-ttu-id="04d9d-388">Задача диспетчера заданий *необходима* для заданий, создаваемых согласно [расписанию заданий](#scheduled-jobs), так как это единственный способ определить задачи перед созданием экземпляра задания.</span><span class="sxs-lookup"><span data-stu-id="04d9d-388">A job manager task is *required* for jobs that are created by a [job schedule](#scheduled-jobs) because it is the only way to define the tasks before the job is instantiated.</span></span>
* <span data-ttu-id="04d9d-389">По умолчанию задания остаются в активном состоянии после выполнения всех задач в задании.</span><span class="sxs-lookup"><span data-stu-id="04d9d-389">By default, jobs remain in the active state when all tasks within the job are complete.</span></span> <span data-ttu-id="04d9d-390">Это поведение можно изменить, чтобы задание автоматически завершалось после выполнения всех входящих в него задач.</span><span class="sxs-lookup"><span data-stu-id="04d9d-390">You can change this behavior so that the job is automatically terminated when all tasks in the job are complete.</span></span> <span data-ttu-id="04d9d-391">Для этого следует присвоить свойству **onAllTasksComplete** ([OnAllTasksComplete][net_onalltaskscomplete] в .NET пакетной службы) значение *terminatejob*.</span><span class="sxs-lookup"><span data-stu-id="04d9d-391">Set the job's **onAllTasksComplete** property ([OnAllTasksComplete][net_onalltaskscomplete] in Batch .NET) to *terminatejob* to automatically terminate the job when all of its tasks are in the completed state.</span></span>

    <span data-ttu-id="04d9d-392">Обратите внимание, что пакетная служба считает задание *без* задач заданием, все задачи которого выполнены.</span><span class="sxs-lookup"><span data-stu-id="04d9d-392">Note that the Batch service considers a job with *no* tasks to have all of its tasks completed.</span></span> <span data-ttu-id="04d9d-393">Поэтому этот параметр чаще всего используется с [задачами диспетчера заданий](#job-manager-task).</span><span class="sxs-lookup"><span data-stu-id="04d9d-393">Therefore, this option is most commonly used with a [job manager task](#job-manager-task).</span></span> <span data-ttu-id="04d9d-394">Если вы хотите использовать автоматическое завершение заданий без диспетчера заданий, необходимо сначала присвоить свойству **onAllTasksComplete** нового задания значение *noaction*. Значение *terminatejob* следует присвоить этому свойству только после добавления задач в задание.</span><span class="sxs-lookup"><span data-stu-id="04d9d-394">If you want to use automatic job termination without a job manager, you should initially set a new job's **onAllTasksComplete** property to *noaction*, then set it to *terminatejob* only after you've finished adding tasks to the job.</span></span>

### <a name="job-priority"></a><span data-ttu-id="04d9d-395">приоритет задания</span><span class="sxs-lookup"><span data-stu-id="04d9d-395">Job priority</span></span>
<span data-ttu-id="04d9d-396">При создании задания в пакетной службе ему можно назначить приоритет.</span><span class="sxs-lookup"><span data-stu-id="04d9d-396">You can assign a priority to jobs that you create in Batch.</span></span> <span data-ttu-id="04d9d-397">Пакетная служба использует значения приоритетов заданий, чтобы определять порядок выполнения разных заданий в одной учетной записи (не путайте с [запланированным заданием](#scheduled-jobs)).</span><span class="sxs-lookup"><span data-stu-id="04d9d-397">The Batch service uses the priority value of the job to determine the order of job scheduling within an account (this is not to be confused with a [scheduled job](#scheduled-jobs)).</span></span> <span data-ttu-id="04d9d-398">Приоритет может иметь значение в диапазоне от -1000 до 1000, где -1000 означает наименьший приоритет, а 1000 — наивысший.</span><span class="sxs-lookup"><span data-stu-id="04d9d-398">The priority values range from -1000 to 1000, with -1000 being the lowest priority and 1000 being the highest.</span></span> <span data-ttu-id="04d9d-399">Вы можете изменить приоритет задания с помощью вызова операции [обновления свойств задания][rest_update_job] в REST для пакетной службы или изменив свойство [CloudJob.Priority][net_cloudjob_priority] в .NET для пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-399">To update the priority of a job, call the [Update the properties of a job][rest_update_job] operation (Batch REST), or modify the [CloudJob.Priority][net_cloudjob_priority] property (Batch .NET).</span></span>

<span data-ttu-id="04d9d-400">В рамках одной учетной записи задания с высоким приоритетом имеют преимущество при планировании относительно заданий с низким приоритетом.</span><span class="sxs-lookup"><span data-stu-id="04d9d-400">Within the same account, higher-priority jobs have scheduling precedence over lower-priority jobs.</span></span> <span data-ttu-id="04d9d-401">Задания с более высоким приоритетом, относящиеся к одной учетной записи, не имеют преимущества при планировании относительно других заданий с более низким приоритетом, относящихся к другой учетной записи.</span><span class="sxs-lookup"><span data-stu-id="04d9d-401">A job with a higher-priority value in one account does not have scheduling precedence over another job with a lower-priority value in a different account.</span></span>

<span data-ttu-id="04d9d-402">Задания распределяются по пулам независимо друг от друга.</span><span class="sxs-lookup"><span data-stu-id="04d9d-402">Job scheduling across pools is independent.</span></span> <span data-ttu-id="04d9d-403">Если используется несколько пулов, задание с более высоким приоритетом не обязательно будет выполняться первым. Задание задерживается, если в связанном с ним пуле недостаточно свободных узлов.</span><span class="sxs-lookup"><span data-stu-id="04d9d-403">Between different pools, it is not guaranteed that a higher-priority job is scheduled first if its associated pool is short of idle nodes.</span></span> <span data-ttu-id="04d9d-404">Если задания выполняются в одном пуле и имеют одинаковый приоритет, они имеют равные шансы на распределение.</span><span class="sxs-lookup"><span data-stu-id="04d9d-404">In the same pool, jobs with the same priority level have an equal chance of being scheduled.</span></span>

### <a name="scheduled-jobs"></a><span data-ttu-id="04d9d-405">Запланированные задания</span><span class="sxs-lookup"><span data-stu-id="04d9d-405">Scheduled jobs</span></span>
<span data-ttu-id="04d9d-406">[Расписания заданий][rest_job_schedules] позволяют создавать в пакетной службе повторяющиеся задания.</span><span class="sxs-lookup"><span data-stu-id="04d9d-406">[Job schedules][rest_job_schedules] enable you to create recurring jobs within the Batch service.</span></span> <span data-ttu-id="04d9d-407">Расписание заданий определяет время запуска заданий и параметры для запуска этих заданий.</span><span class="sxs-lookup"><span data-stu-id="04d9d-407">A job schedule specifies when to run jobs and includes the specifications for the jobs to be run.</span></span> <span data-ttu-id="04d9d-408">Вы можете указать период действия задания, то есть с какого момента и в течение какого времени служба будет применять это расписание, а также частоту выполнения периодических заданий в этот период.</span><span class="sxs-lookup"><span data-stu-id="04d9d-408">You can specify the duration of the schedule--how long and when the schedule is in effect--and how frequently jobs are created during the scheduled period.</span></span>

## <a name="task"></a><span data-ttu-id="04d9d-409">Задача</span><span class="sxs-lookup"><span data-stu-id="04d9d-409">Task</span></span>
<span data-ttu-id="04d9d-410">Задача представляет собой единицу вычисления, которая связана с заданием</span><span class="sxs-lookup"><span data-stu-id="04d9d-410">A task is a unit of computation that is associated with a job.</span></span> <span data-ttu-id="04d9d-411">и выполняется на узле.</span><span class="sxs-lookup"><span data-stu-id="04d9d-411">It runs on a node.</span></span> <span data-ttu-id="04d9d-412">Задачи назначаются узлу для выполнения или ставятся в очередь, пока не освободится какой-либо узел.</span><span class="sxs-lookup"><span data-stu-id="04d9d-412">Tasks are assigned to a node for execution, or are queued until a node becomes free.</span></span> <span data-ttu-id="04d9d-413">Говоря простыми словами, задача запускает одну или несколько программ или сценариев на вычислительном узле, чтобы выполнить необходимую работу.</span><span class="sxs-lookup"><span data-stu-id="04d9d-413">Put simply, a task runs one or more programs or scripts on a compute node to perform the work you need done.</span></span>

<span data-ttu-id="04d9d-414">При создании задачи можно указать следующее:</span><span class="sxs-lookup"><span data-stu-id="04d9d-414">When you create a task, you can specify:</span></span>

* <span data-ttu-id="04d9d-415">**Командная строка** задачи.</span><span class="sxs-lookup"><span data-stu-id="04d9d-415">The **command line** for the task.</span></span> <span data-ttu-id="04d9d-416">Это командная строка, которая запускает приложение или сценарий на вычислительном узле.</span><span class="sxs-lookup"><span data-stu-id="04d9d-416">This is the command line that runs your application or script on the compute node.</span></span>

    <span data-ttu-id="04d9d-417">Следует отметить, что командная строка не выполняется на базе оболочки</span><span class="sxs-lookup"><span data-stu-id="04d9d-417">It is important to note that the command line does not actually run under a shell.</span></span> <span data-ttu-id="04d9d-418">и поэтому не может автоматически использовать функции оболочки, например расширение [переменных среды](#environment-settings-for-tasks) (в том числе `PATH`).</span><span class="sxs-lookup"><span data-stu-id="04d9d-418">Therefore, it cannot natively take advantage of shell features like [environment variable](#environment-settings-for-tasks) expansion (this includes the `PATH`).</span></span> <span data-ttu-id="04d9d-419">Чтобы воспользоваться этими функциями, необходимо вызвать оболочку в командной строке. Это можно сделать путем запуска `cmd.exe` на узлах Windows или `/bin/sh` на узлах Linux:</span><span class="sxs-lookup"><span data-stu-id="04d9d-419">To take advantage of such features, you must invoke the shell in the command line--for example, by launching `cmd.exe` on Windows nodes or `/bin/sh` on Linux:</span></span>

    `cmd /c MyTaskApplication.exe %MY_ENV_VAR%`

    `/bin/sh -c MyTaskApplication $MY_ENV_VAR`

    <span data-ttu-id="04d9d-420">Если требуется, чтобы задачи выполняли приложение или скрипт без использования переменной `PATH` или переменных среды узла, на которые содержится ссылка, необходимо явным образом вызвать оболочку в командной строке задачи.</span><span class="sxs-lookup"><span data-stu-id="04d9d-420">If your tasks need to run an application or script that is not in the node's `PATH` or reference environment variables, invoke the shell explicitly in the task command line.</span></span>
* <span data-ttu-id="04d9d-421">**Файлы ресурсов**, которые содержат данные для обработки.</span><span class="sxs-lookup"><span data-stu-id="04d9d-421">**Resource files** that contain the data to be processed.</span></span> <span data-ttu-id="04d9d-422">Эти файлы автоматически копируются на узел из хранилища BLOB-объектов в учетной записи службы хранилища Azure общего назначения перед выполнением командной строки задачи.</span><span class="sxs-lookup"><span data-stu-id="04d9d-422">These files are automatically copied to the node from Blob storage in a general-purpose Azure Storage account before the task's command line is executed.</span></span> <span data-ttu-id="04d9d-423">Дополнительные сведения см. в разделах [Задача запуска](#start-task) и [Файлы и каталоги](#files-and-directories).</span><span class="sxs-lookup"><span data-stu-id="04d9d-423">For more information, see the sections [Start task](#start-task) and [Files and directories](#files-and-directories).</span></span>
* <span data-ttu-id="04d9d-424">**Переменные среды**, необходимые для приложения.</span><span class="sxs-lookup"><span data-stu-id="04d9d-424">The **environment variables** that are required by your application.</span></span> <span data-ttu-id="04d9d-425">Дополнительные сведения см. в разделе [Параметры среды для задач](#environment-settings-for-tasks).</span><span class="sxs-lookup"><span data-stu-id="04d9d-425">For more information, see the [Environment settings for tasks](#environment-settings-for-tasks) section.</span></span>
* <span data-ttu-id="04d9d-426">**Ограничения**, в рамках которых должна выполняться задача.</span><span class="sxs-lookup"><span data-stu-id="04d9d-426">The **constraints** under which the task should execute.</span></span> <span data-ttu-id="04d9d-427">Например, может быть задано максимальное время на выполнение задачи, максимальное количество повторных попыток выполнить задачу, завершенную сбоем, и максимальное время хранения файлов в рабочем каталоге задачи.</span><span class="sxs-lookup"><span data-stu-id="04d9d-427">For example, constraints include the maximum time that the task is allowed to run, the maximum number of times a failed task should be retried, and the maximum time that files in the task's working directory are retained.</span></span>
* <span data-ttu-id="04d9d-428">**Пакеты приложений** для развертывания на вычислительном узле, на котором запланировано выполнение задачи.</span><span class="sxs-lookup"><span data-stu-id="04d9d-428">**Application packages** to deploy to the compute node on which the task is scheduled to run.</span></span> <span data-ttu-id="04d9d-429">[Пакеты приложений](#application-packages) обеспечивают упрощенное развертывание и управление версиями для приложений, запускаемых с помощью задач.</span><span class="sxs-lookup"><span data-stu-id="04d9d-429">[Application packages](#application-packages) provide simplified deployment and versioning of the applications that your tasks run.</span></span> <span data-ttu-id="04d9d-430">Пакеты приложений уровня задач особенно полезны в средах с общим пулом, где различные задания выполняются в одном пуле, который не удаляется по завершении задания.</span><span class="sxs-lookup"><span data-stu-id="04d9d-430">Task-level application packages are especially useful in shared-pool environments, where different jobs are run on one pool, and the pool is not deleted when a job is completed.</span></span> <span data-ttu-id="04d9d-431">Если задание содержит меньше задач, чем число узлов в пуле, пакеты приложений задач помогут минимизировать объем передаваемых данных, так как приложение развертывается только на узлах, на которых выполняются задачи.</span><span class="sxs-lookup"><span data-stu-id="04d9d-431">If your job has fewer tasks than nodes in the pool, task application packages can minimize data transfer since your application is deployed only to the nodes that run tasks.</span></span>

<span data-ttu-id="04d9d-432">Помимо задач, которые можно определить для вычислений на узле, пакетная служба выполняет следующие специальные задачи.</span><span class="sxs-lookup"><span data-stu-id="04d9d-432">In addition to tasks you define to perform computation on a node, the following special tasks are also provided by the Batch service:</span></span>

* [<span data-ttu-id="04d9d-433">Задача запуска</span><span class="sxs-lookup"><span data-stu-id="04d9d-433">Start task</span></span>](#start-task)
* [<span data-ttu-id="04d9d-434">Задача диспетчера заданий</span><span class="sxs-lookup"><span data-stu-id="04d9d-434">Job manager task</span></span>](#job-manager-task)
* [<span data-ttu-id="04d9d-435">Задачи подготовки и завершения заданий.</span><span class="sxs-lookup"><span data-stu-id="04d9d-435">Job preparation and release tasks</span></span>](#job-preparation-and-release-tasks)
* [<span data-ttu-id="04d9d-436">Задачи с несколькими экземплярами</span><span class="sxs-lookup"><span data-stu-id="04d9d-436">Multi-instance tasks (MPI)</span></span>](#multi-instance-tasks)
* [<span data-ttu-id="04d9d-437">Зависимости задачи</span><span class="sxs-lookup"><span data-stu-id="04d9d-437">Task dependencies</span></span>](#task-dependencies)

### <a name="start-task"></a><span data-ttu-id="04d9d-438">Задача запуска</span><span class="sxs-lookup"><span data-stu-id="04d9d-438">Start task</span></span>
<span data-ttu-id="04d9d-439">Связав **задачу запуска** с пулом, можно подготовить среду выполнения на его узлах.</span><span class="sxs-lookup"><span data-stu-id="04d9d-439">By associating a **start task** with a pool, you can prepare the operating environment of its nodes.</span></span> <span data-ttu-id="04d9d-440">Например, эта задача может выполнять установку приложений, которые будут использовать задачи, или запуск фоновых процессов.</span><span class="sxs-lookup"><span data-stu-id="04d9d-440">For example, you can perform actions like installing the applications that your tasks run or starting background processes.</span></span> <span data-ttu-id="04d9d-441">Задача запуска выполняется при каждом запуске узла, пока узел остается в пуле, в том числе при первом добавлении узла к пулу и при перезапуске или пересоздании образа узла.</span><span class="sxs-lookup"><span data-stu-id="04d9d-441">The start task runs every time a node starts, for as long as it remains in the pool--including when the node is first added to the pool and when it is restarted or reimaged.</span></span>

<span data-ttu-id="04d9d-442">Задача запуска особенно полезна тем, что она может содержать все сведения для настройки вычислительных узлов и установки приложений, которые нужны для выполнения задач.</span><span class="sxs-lookup"><span data-stu-id="04d9d-442">A primary benefit of the start task is that it can contain all of the information that is necessary to configure a compute node and install the applications that are required for task execution.</span></span> <span data-ttu-id="04d9d-443">Таким образом, для увеличения числа узлов в пуле достаточно указать новое количество узлов.</span><span class="sxs-lookup"><span data-stu-id="04d9d-443">Therefore, increasing the number of nodes in a pool is as simple as specifying the new target node count.</span></span> <span data-ttu-id="04d9d-444">Задача запуска предоставляет пакетной службе сведения, необходимые для настройки новых узлов и подготовки их к выполнению задач.</span><span class="sxs-lookup"><span data-stu-id="04d9d-444">The start task provides the Batch service the information that is needed to configure the new nodes and get them ready for accepting tasks.</span></span>

<span data-ttu-id="04d9d-445">Для этой задачи, как для любой задачи пакетной службы Azure, кроме исполняемой **командной строки**, можно указать список **файлов ресурсов**, которые хранятся в [службе хранилища Azure][azure_storage].</span><span class="sxs-lookup"><span data-stu-id="04d9d-445">As with any Azure Batch task, you can specify a list of **resource files** in [Azure Storage][azure_storage], in addition to a **command line** to be executed.</span></span> <span data-ttu-id="04d9d-446">Пакетная служба сначала скопирует эти файлы на узел из службы хранилища Azure, а затем запустит командную строку.</span><span class="sxs-lookup"><span data-stu-id="04d9d-446">The Batch service first copies the resource files to the node from Azure Storage, and then runs the command line.</span></span> <span data-ttu-id="04d9d-447">Список файлов для задачи запуска пула обычно содержит приложение задач или его зависимости.</span><span class="sxs-lookup"><span data-stu-id="04d9d-447">For a pool start task, the file list typically contains the task application and its dependencies.</span></span>

<span data-ttu-id="04d9d-448">В задаче запуска также могут содержаться справочные данные, которые будут использоваться всеми задачами, выполняемыми на вычислительном узле.</span><span class="sxs-lookup"><span data-stu-id="04d9d-448">However, the start task could also include reference data to be used by all tasks that are running on the compute node.</span></span> <span data-ttu-id="04d9d-449">Например, командная строка задачи запуска может выполнять операцию `robocopy`, чтобы скопировать файлы приложения (указанные в качестве файлов ресурсов и скачанные на узел) из [рабочего каталога](#files-and-directories) задачи запуска в [общую папку](#files-and-directories), а затем запустить MSI-файл или `setup.exe`.</span><span class="sxs-lookup"><span data-stu-id="04d9d-449">For example, a start task's command line could perform a `robocopy` operation to copy application files (which were specified as resource files and downloaded to the node) from the start task's [working directory](#files-and-directories) to the [shared folder](#files-and-directories), and then run an MSI or `setup.exe`.</span></span>

<span data-ttu-id="04d9d-450">Обычно желательно, чтобы пакетная служба дождалась завершения задачи запуска, прежде чем считать узел готовым к назначению задач, но это поведение можно изменить.</span><span class="sxs-lookup"><span data-stu-id="04d9d-450">It is typically desirable for the Batch service to wait for the start task to complete before considering the node ready to be assigned tasks, but you can configure this.</span></span>

<span data-ttu-id="04d9d-451">Если задача запуска на узле пула завершится сбоем, этот сбой отобразится в параметре состояния узла. При этом узлу не будут назначаться задачи.</span><span class="sxs-lookup"><span data-stu-id="04d9d-451">If a start task fails on a compute node, then the state of the node is updated to reflect the failure, and the node is not assigned any tasks.</span></span> <span data-ttu-id="04d9d-452">Задача запуска может завершиться сбоем, если не удастся скопировать файлы ресурсов из хранилища или если процесс, запущенный командной строкой задачи запуска, вернет ненулевой код завершения.</span><span class="sxs-lookup"><span data-stu-id="04d9d-452">A start task can fail if there is an issue copying its resource files from storage, or if the process executed by its command line returns a nonzero exit code.</span></span>

<span data-ttu-id="04d9d-453">При добавлении или обновлении задачи запуска для существующего пула необходимо перезапустить его вычислительные узлы, чтобы применить к ним задачу запуска.</span><span class="sxs-lookup"><span data-stu-id="04d9d-453">If you add or update the start task for an existing pool, you must reboot its compute nodes for the start task to be applied to the nodes.</span></span>

>[!NOTE]
> <span data-ttu-id="04d9d-454">Общий размер задачи запуска не должен превышать 32 768 символов, включая файлы ресурсов и переменные среды.</span><span class="sxs-lookup"><span data-stu-id="04d9d-454">The total size of a start task must be less than or equal to 32768 characters, including resource files and environment variables.</span></span> <span data-ttu-id="04d9d-455">Чтобы убедиться, что ваша задача запуска соответствует этим требованиям, используйте один из двух следующих методов.</span><span class="sxs-lookup"><span data-stu-id="04d9d-455">To ensure that your start task meets this requirement, you can use one of two approaches:</span></span>
>
> 1. <span data-ttu-id="04d9d-456">Можно применить пакеты для распределения приложений или данных в каждом узле пула пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-456">You can use application packages to distribute applications or data across each node in your Batch pool.</span></span> <span data-ttu-id="04d9d-457">Дополнительные сведения о пакетах приложений см. в статье [Развертывание приложений на вычислительных узлах с помощью пакетов приложений пакетной службы](batch-application-packages.md).</span><span class="sxs-lookup"><span data-stu-id="04d9d-457">For more information about application packages, see [Deploy applications to compute nodes with Batch application packages](batch-application-packages.md).</span></span>
> 2. <span data-ttu-id="04d9d-458">Можно вручную создать ZIP-архив с файлами приложения.</span><span class="sxs-lookup"><span data-stu-id="04d9d-458">You can manually create a zipped archive containing your applications files.</span></span> <span data-ttu-id="04d9d-459">Отправьте ZIP-архив в службу хранилища Azure как большой двоичный объект.</span><span class="sxs-lookup"><span data-stu-id="04d9d-459">Upload your zipped archive to Azure Storage as a blob.</span></span> <span data-ttu-id="04d9d-460">Укажите ZIP-архив в качестве файла ресурсов для задачи запуска.</span><span class="sxs-lookup"><span data-stu-id="04d9d-460">Specify the zipped archive as a resource file for your start task.</span></span> <span data-ttu-id="04d9d-461">Перед использованием командной строки для задачи запуска распакуйте архив из командной строки.</span><span class="sxs-lookup"><span data-stu-id="04d9d-461">Before you run the command line for your start task, unzip the archive from the command line.</span></span> 
>
>    <span data-ttu-id="04d9d-462">Для распаковки архива можно использовать средство архивации по своему усмотрению.</span><span class="sxs-lookup"><span data-stu-id="04d9d-462">To unzip the archive, you can use the archiving tool of your choice.</span></span> <span data-ttu-id="04d9d-463">Средство, которое использовалось для распаковки архива, необходимо указать как файл ресурсов для задачи запуска.</span><span class="sxs-lookup"><span data-stu-id="04d9d-463">You will need to include the tool that you use to unzip the archive as a resource file for the start task.</span></span>
>
>

### <a name="job-manager-task"></a><span data-ttu-id="04d9d-464">Задача диспетчера заданий</span><span class="sxs-lookup"><span data-stu-id="04d9d-464">Job manager task</span></span>
<span data-ttu-id="04d9d-465">**Задача диспетчера заданий** обычно используется для управления заданием и/или отслеживания его выполнения. Например, она создает и отправляет задачи для задания, определяет дополнительные задачи, которые нужно выполнить, и фиксирует завершение задания.</span><span class="sxs-lookup"><span data-stu-id="04d9d-465">You typically use a **job manager task** to control and/or monitor job execution--for example, to create and submit the tasks for a job, determine additional tasks to run, and determine when work is complete.</span></span> <span data-ttu-id="04d9d-466">Но задача диспетчера заданий не ограничивается такими действиями.</span><span class="sxs-lookup"><span data-stu-id="04d9d-466">However, a job manager task is not restricted to these activities.</span></span> <span data-ttu-id="04d9d-467">Это полнофункциональная задача, которая может выполнять любые действия, требуемые в рамках задания.</span><span class="sxs-lookup"><span data-stu-id="04d9d-467">It is a fully fledged task that can perform any actions that are required for the job.</span></span> <span data-ttu-id="04d9d-468">Например, задача диспетчера заданий может скачать файл, указанный в качестве параметра, проанализировать содержимое этого файла и в зависимости от содержимого отправить на выполнение дополнительные задачи.</span><span class="sxs-lookup"><span data-stu-id="04d9d-468">For example, a job manager task might download a file that is specified as a parameter, analyze the contents of that file, and submit additional tasks based on those contents.</span></span>

<span data-ttu-id="04d9d-469">Задача диспетчера заданий запускается перед выполнением всех других задач.</span><span class="sxs-lookup"><span data-stu-id="04d9d-469">A job manager task is started before all other tasks.</span></span> <span data-ttu-id="04d9d-470">Она предоставляет следующие возможности.</span><span class="sxs-lookup"><span data-stu-id="04d9d-470">It provides the following features:</span></span>

* <span data-ttu-id="04d9d-471">Пакетная служба автоматически создает эту задачу при создании задания.</span><span class="sxs-lookup"><span data-stu-id="04d9d-471">It is automatically submitted as a task by the Batch service when the job is created.</span></span>
* <span data-ttu-id="04d9d-472">Эта задача выполняется раньше любых других задач в задании.</span><span class="sxs-lookup"><span data-stu-id="04d9d-472">It is scheduled to execute before the other tasks in a job.</span></span>
* <span data-ttu-id="04d9d-473">Узел, на котором выполняется задача, удаляется из пула последним при уменьшении размера пула.</span><span class="sxs-lookup"><span data-stu-id="04d9d-473">Its associated node is the last to be removed from a pool when the pool is being downsized.</span></span>
* <span data-ttu-id="04d9d-474">Такое завершение задачи может привести к завершению всех задач данного задания.</span><span class="sxs-lookup"><span data-stu-id="04d9d-474">Its termination can be tied to the termination of all tasks in the job.</span></span>
* <span data-ttu-id="04d9d-475">При перезапуске задача диспетчера заданий получает наивысший приоритет.</span><span class="sxs-lookup"><span data-stu-id="04d9d-475">A job manager task is given the highest priority when it needs to be restarted.</span></span> <span data-ttu-id="04d9d-476">При этом, если нет свободных узлов, пакетная служба может освободить ресурсы для этой задачи, прервав выполнение одной из других задач, запущенных в пуле.</span><span class="sxs-lookup"><span data-stu-id="04d9d-476">If an idle node is not available, the Batch service might terminate one of the other running tasks in the pool to make room for the job manager task to run.</span></span>
* <span data-ttu-id="04d9d-477">Задача диспетчера заданий не имеет приоритета над задачами других заданий.</span><span class="sxs-lookup"><span data-stu-id="04d9d-477">A job manager task in one job does not have priority over the tasks of other jobs.</span></span> <span data-ttu-id="04d9d-478">Приоритеты между заданиями определяются только на уровне заданий.</span><span class="sxs-lookup"><span data-stu-id="04d9d-478">Across jobs, only job-level priorities are observed.</span></span>

### <a name="job-preparation-and-release-tasks"></a><span data-ttu-id="04d9d-479">Задачи подготовки и завершения заданий.</span><span class="sxs-lookup"><span data-stu-id="04d9d-479">Job preparation and release tasks</span></span>
<span data-ttu-id="04d9d-480">Для настройки среды выполнения задания в пакетной службе предусмотрена задача подготовки задания,</span><span class="sxs-lookup"><span data-stu-id="04d9d-480">Batch provides job preparation tasks for pre-job execution setup.</span></span> <span data-ttu-id="04d9d-481">а для очистки или обслуживания по окончании задания — задача завершения задания.</span><span class="sxs-lookup"><span data-stu-id="04d9d-481">Job release tasks are for post-job maintenance or cleanup.</span></span>

* <span data-ttu-id="04d9d-482">**Задача подготовки задания**. Эта задача выполняется на всех вычислительных узлах, на которых запланировано выполнение задач, до выполнения какой-либо другой задачи задания.</span><span class="sxs-lookup"><span data-stu-id="04d9d-482">**Job preparation task**: A job preparation task runs on all compute nodes that are scheduled to run tasks, before any of the other job tasks are executed.</span></span> <span data-ttu-id="04d9d-483">Например, вы можете применить задачу подготовки задания для копирования данных, которые используются всеми задачами, но только в рамках одного задания.</span><span class="sxs-lookup"><span data-stu-id="04d9d-483">You can use a job preparation task to copy data that is shared by all tasks, but is unique to the job, for example.</span></span>
* <span data-ttu-id="04d9d-484">**Задача завершения задания**. Когда задание завершается, эта задача выполняется на каждом узле в пуле, на котором была выполнена хотя бы одна задача.</span><span class="sxs-lookup"><span data-stu-id="04d9d-484">**Job release task**: When a job has completed, a job release task runs on each node in the pool that executed at least one task.</span></span> <span data-ttu-id="04d9d-485">Задачу завершения задания можно использовать для удаления данных, скопированных задачей подготовки задания, или для сжатия и передачи диагностических данных журналов.</span><span class="sxs-lookup"><span data-stu-id="04d9d-485">You can use a job release task to delete data that is copied by the job preparation task, or to compress and upload diagnostic log data, for example.</span></span>

<span data-ttu-id="04d9d-486">Задачи подготовки и завершения задания позволяют указать командную строку, которая будет выполняться при вызове задачи.</span><span class="sxs-lookup"><span data-stu-id="04d9d-486">Both job preparation and release tasks allow you to specify a command line to run when the task is invoked.</span></span> <span data-ttu-id="04d9d-487">Они предоставляют такие возможности, как загрузка файлов, выполнение с повышенными правами, пользовательские переменные среды, максимальная продолжительность выполнения, число повторных попыток и время хранения файла.</span><span class="sxs-lookup"><span data-stu-id="04d9d-487">They offer features like file download, elevated execution, custom environment variables, maximum execution duration, retry count, and file retention time.</span></span>

<span data-ttu-id="04d9d-488">Дополнительные сведения о задачах подготовки и завершения заданий см. в статье [Выполнение задач подготовки и завершения заданий на вычислительных узлах пакетной службы Azure](batch-job-prep-release.md).</span><span class="sxs-lookup"><span data-stu-id="04d9d-488">For more information on job preparation and release tasks, see [Run job preparation and completion tasks on Azure Batch compute nodes](batch-job-prep-release.md).</span></span>

### <a name="multi-instance-task"></a><span data-ttu-id="04d9d-489">Задачи с несколькими экземплярами</span><span class="sxs-lookup"><span data-stu-id="04d9d-489">Multi-instance task</span></span>
<span data-ttu-id="04d9d-490">[Задача с несколькими экземплярами](batch-mpi.md) — это задача, которая может выполняться на нескольких вычислительных узлах одновременно.</span><span class="sxs-lookup"><span data-stu-id="04d9d-490">A [multi-instance task](batch-mpi.md) is a task that is configured to run on more than one compute node simultaneously.</span></span> <span data-ttu-id="04d9d-491">С помощью задач с несколькими экземплярами можно включать высокопроизводительные вычислительные сценарии (такие как интерфейс передачи сообщений (MPI)), которым необходимо несколько совместно выделенных вычислительных узлов для обработки одной рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="04d9d-491">With multi-instance tasks, you can enable high-performance computing scenarios that require a group of compute nodes that are allocated together to process a single workload (like Message Passing Interface (MPI)).</span></span>

<span data-ttu-id="04d9d-492">Дополнительные сведения о выполнении заданий задач с несколькими экземплярами в пакетной службе с использованием библиотеки .NET для пакетной службы см. в статье [Использование задач с несколькими экземплярами для запуска приложений с интерфейсом передачи сообщений в пакетной службе Azure](batch-mpi.md).</span><span class="sxs-lookup"><span data-stu-id="04d9d-492">For a detailed discussion on running MPI jobs in Batch by using the Batch .NET library, check out [Use multi-instance tasks to run Message Passing Interface (MPI) applications in Azure Batch](batch-mpi.md).</span></span>

### <a name="task-dependencies"></a><span data-ttu-id="04d9d-493">Зависимости задачи</span><span class="sxs-lookup"><span data-stu-id="04d9d-493">Task dependencies</span></span>
<span data-ttu-id="04d9d-494">[Зависимости задач](batch-task-dependencies.md), как можно понять из названия, позволяют настроить выполнение задачи в зависимости от предварительного завершения других задач.</span><span class="sxs-lookup"><span data-stu-id="04d9d-494">[Task dependencies](batch-task-dependencies.md), as the name implies, allow you to specify that a task depends on the completion of other tasks before its execution.</span></span> <span data-ttu-id="04d9d-495">Эта функция обеспечивает поддержку в ситуациях, когда "подчиненная" задача использует выходные данные "вышестоящей" задачи или когда вышестоящая задача выполняет инициализацию, необходимую для подчиненных задач.</span><span class="sxs-lookup"><span data-stu-id="04d9d-495">This feature provides support for situations in which a "downstream" task consumes the output of an "upstream" task--or when an upstream task performs some initialization that is required by a downstream task.</span></span> <span data-ttu-id="04d9d-496">Чтобы использовать эту функцию, необходимо сначала включить зависимости задач для задания пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-496">To use this feature, you must first enable task dependencies on your Batch job.</span></span> <span data-ttu-id="04d9d-497">Затем для каждой задачи, зависящей от другой (или нескольких других), укажите задачи, от которых она зависит.</span><span class="sxs-lookup"><span data-stu-id="04d9d-497">Then, for each task that depends on another (or many others), you specify the tasks which that task depends on.</span></span>

<span data-ttu-id="04d9d-498">С помощью зависимостей задач можно настраивать различные сценарии, например:</span><span class="sxs-lookup"><span data-stu-id="04d9d-498">With task dependencies, you can configure scenarios like the following:</span></span>

* <span data-ttu-id="04d9d-499">Задача *taskB* зависит от задачи *taskA* (выполнение задачи *taskB* не начнется, пока не завершится выполнение задачи *taskA*).</span><span class="sxs-lookup"><span data-stu-id="04d9d-499">*taskB* depends on *taskA* (*taskB* will not begin execution until *taskA* has completed).</span></span>
* <span data-ttu-id="04d9d-500">Задача *taskC* зависит от задач *taskA* и *taskB*.</span><span class="sxs-lookup"><span data-stu-id="04d9d-500">*taskC* depends on both *taskA* and *taskB*.</span></span>
* <span data-ttu-id="04d9d-501">Задача *taskD* зависит от ряда задач — от задачи *1* до задачи *10*.</span><span class="sxs-lookup"><span data-stu-id="04d9d-501">*taskD* depends on a range of tasks, such as tasks *1* through *10*, before it executes.</span></span>

<span data-ttu-id="04d9d-502">Дополнительные сведения об этой возможности см. в статье [Зависимости задач в пакетной службе Azure](batch-task-dependencies.md) и в примере кода [TaskDependencies][github_sample_taskdeps] в репозитории [azure-batch-samples][github_samples] на сайте GitHub.</span><span class="sxs-lookup"><span data-stu-id="04d9d-502">Check out [Task dependencies in Azure Batch](batch-task-dependencies.md) and the [TaskDependencies][github_sample_taskdeps] code sample in the [azure-batch-samples][github_samples] GitHub repository for more in-depth details on this feature.</span></span>

## <a name="environment-settings-for-tasks"></a><span data-ttu-id="04d9d-503">Параметры среды для задач</span><span class="sxs-lookup"><span data-stu-id="04d9d-503">Environment settings for tasks</span></span>
<span data-ttu-id="04d9d-504">Каждая задача, выполняемая пакетной службой, имеет доступ к переменным среды, заданным на вычислительных узлах.</span><span class="sxs-lookup"><span data-stu-id="04d9d-504">Each task executed by the Batch service has access to environment variables that it sets on compute nodes.</span></span> <span data-ttu-id="04d9d-505">Сюда входят переменные среды, определенные пакетной службой ([служебные][msdn_env_vars]), и пользовательские переменные среды, которые вы можете определить для задач.</span><span class="sxs-lookup"><span data-stu-id="04d9d-505">This includes environment variables defined by the Batch service ([service-defined][msdn_env_vars]) and custom environment variables that you can define for your tasks.</span></span> <span data-ttu-id="04d9d-506">Приложения и скрипты, выполняемые с помощью задач, получают доступ к переменным среды во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="04d9d-506">The applications and scripts your tasks execute have access to these environment variables during execution.</span></span>

<span data-ttu-id="04d9d-507">Пользовательские переменные среды можно задать на уровне задачи или задания, задав свойство *параметров среды* для этих объектов.</span><span class="sxs-lookup"><span data-stu-id="04d9d-507">You can set custom environment variables at the task or job level by populating the *environment settings* property for these entities.</span></span> <span data-ttu-id="04d9d-508">Для примера см. раздел об операции [добавления задачи к заданию][rest_add_task] (в REST API пакетной службы) или о свойствах [CloudTask.EnvironmentSettings][net_cloudtask_env] и [CloudJob.CommonEnvironmentSettings][net_job_env] в .NET для пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-508">For example, see the [Add a task to a job][rest_add_task] operation (Batch REST API), or the [CloudTask.EnvironmentSettings][net_cloudtask_env] and [CloudJob.CommonEnvironmentSettings][net_job_env] properties in Batch .NET.</span></span>

<span data-ttu-id="04d9d-509">Чтобы получить значения служебных и пользовательских переменных среды задачи для клиентского приложения или службы, можно использовать операцию [получения сведений о задаче][rest_get_task_info] в REST для пакетной службы или свойство [CloudTask.EnvironmentSettings][net_cloudtask_env] в .NET для пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-509">Your client application or service can obtain a task's environment variables, both service-defined and custom, by using the [Get information about a task][rest_get_task_info] operation (Batch REST) or by accessing the [CloudTask.EnvironmentSettings][net_cloudtask_env] property (Batch .NET).</span></span> <span data-ttu-id="04d9d-510">Процессы, которые выполняются на вычислительном узле, могут обращаться к этим и другим переменным среды узла, например с помощью привычного синтаксиса `%VARIABLE_NAME%` в Windows или `$VARIABLE_NAME` в Linux.</span><span class="sxs-lookup"><span data-stu-id="04d9d-510">Processes executing on a compute node can access these and other environment variables on the node, for example, by using the familiar `%VARIABLE_NAME%` (Windows) or `$VARIABLE_NAME` (Linux) syntax.</span></span>

<span data-ttu-id="04d9d-511">Полный список всех служебных переменных среды см. в статье [Azure Batch compute node environment variables][msdn_env_vars] (Переменные среды вычислительного узла пакетной службы Azure).</span><span class="sxs-lookup"><span data-stu-id="04d9d-511">You can find a full list of all service-defined environment variables in [Compute node environment variables][msdn_env_vars].</span></span>

## <a name="files-and-directories"></a><span data-ttu-id="04d9d-512">Файлы и каталоги</span><span class="sxs-lookup"><span data-stu-id="04d9d-512">Files and directories</span></span>
<span data-ttu-id="04d9d-513">У каждой задачи есть *рабочий каталог*, в котором она может создавать дополнительные файлы и каталоги.</span><span class="sxs-lookup"><span data-stu-id="04d9d-513">Each task has a *working directory* under which it creates zero or more files and directories.</span></span> <span data-ttu-id="04d9d-514">Он может использоваться для хранения выполняемой программы, обрабатываемых данных и результатов обработки.</span><span class="sxs-lookup"><span data-stu-id="04d9d-514">This working directory can be used for storing the program that is run by the task, the data that it processes, and the output of the processing it performs.</span></span> <span data-ttu-id="04d9d-515">Все файлы и каталоги задачи принадлежат пользователю задачи.</span><span class="sxs-lookup"><span data-stu-id="04d9d-515">All files and directories of a task are owned by the task user.</span></span>

<span data-ttu-id="04d9d-516">Пакетная служба предоставляет часть файловой системы на узле в качестве *корневого каталога*.</span><span class="sxs-lookup"><span data-stu-id="04d9d-516">The Batch service exposes a portion of the file system on a node as the *root directory*.</span></span> <span data-ttu-id="04d9d-517">Задачи могут обратиться к корневому каталогу с помощью ссылки на переменную среды `AZ_BATCH_NODE_ROOT_DIR`.</span><span class="sxs-lookup"><span data-stu-id="04d9d-517">Tasks can access the root directory by referencing the `AZ_BATCH_NODE_ROOT_DIR` environment variable.</span></span> <span data-ttu-id="04d9d-518">Дополнительные сведения об использовании переменных среды см. в разделе [Параметры среды для задач](#environment-settings-for-tasks).</span><span class="sxs-lookup"><span data-stu-id="04d9d-518">For more information about using environment variables, see [Environment settings for tasks](#environment-settings-for-tasks).</span></span>

<span data-ttu-id="04d9d-519">Корневой каталог имеет следующую структуру каталогов.</span><span class="sxs-lookup"><span data-stu-id="04d9d-519">The root directory contains the following directory structure:</span></span>

![Структура каталогов вычислительного узла][1]

* <span data-ttu-id="04d9d-521">**shared**— в этом каталоге *все* задачи, выполняемые на узле, имеют права чтения и записи.</span><span class="sxs-lookup"><span data-stu-id="04d9d-521">**shared**: This directory provides read/write access to *all* tasks that run on a node.</span></span> <span data-ttu-id="04d9d-522">Любая задача, выполняемая на узле, может создавать, читать, обновлять и удалять файлы в этом каталоге.</span><span class="sxs-lookup"><span data-stu-id="04d9d-522">Any task that runs on the node can create, read, update, and delete files in this directory.</span></span> <span data-ttu-id="04d9d-523">Задачи могут получить доступ к этому каталогу с помощью ссылки на переменную среды `AZ_BATCH_NODE_SHARED_DIR` .</span><span class="sxs-lookup"><span data-stu-id="04d9d-523">Tasks can access this directory by referencing the `AZ_BATCH_NODE_SHARED_DIR` environment variable.</span></span>
* <span data-ttu-id="04d9d-524">**startup**— этот каталог используется задачей запуска в качестве рабочего каталога.</span><span class="sxs-lookup"><span data-stu-id="04d9d-524">**startup**: This directory is used by a start task as its working directory.</span></span> <span data-ttu-id="04d9d-525">Здесь хранятся все файлы, скачанные на узел с помощью задачи запуска.</span><span class="sxs-lookup"><span data-stu-id="04d9d-525">All of the files that are downloaded to the node by the start task are stored here.</span></span> <span data-ttu-id="04d9d-526">Задача запуска может создавать, читать, обновлять и удалять файлы в данном каталоге.</span><span class="sxs-lookup"><span data-stu-id="04d9d-526">The start task can create, read, update, and delete files under this directory.</span></span> <span data-ttu-id="04d9d-527">Задачи могут получить доступ к этому каталогу с помощью ссылки на переменную среды `AZ_BATCH_NODE_STARTUP_DIR` .</span><span class="sxs-lookup"><span data-stu-id="04d9d-527">Tasks can access this directory by referencing the `AZ_BATCH_NODE_STARTUP_DIR` environment variable.</span></span>
* <span data-ttu-id="04d9d-528">**Tasks**— такой каталог создается отдельно для каждой задачи, которая выполняется на узле.</span><span class="sxs-lookup"><span data-stu-id="04d9d-528">**Tasks**: A directory is created for each task that runs on the node.</span></span> <span data-ttu-id="04d9d-529">К нему можно получить доступ с помощью ссылки на переменную среды `AZ_BATCH_TASK_DIR` .</span><span class="sxs-lookup"><span data-stu-id="04d9d-529">It is accessed by referencing the `AZ_BATCH_TASK_DIR` environment variable.</span></span>

    <span data-ttu-id="04d9d-530">В каждом каталоге задачи пакетная служба создает рабочий каталог (`wd`), который имеет уникальный путь, указанный в переменной среды `AZ_BATCH_TASK_WORKING_DIR`.</span><span class="sxs-lookup"><span data-stu-id="04d9d-530">Within each task directory, the Batch service creates a working directory (`wd`) whose unique path is specified by the `AZ_BATCH_TASK_WORKING_DIR` environment variable.</span></span> <span data-ttu-id="04d9d-531">Этот каталог предоставляет задаче доступ на чтение и запись.</span><span class="sxs-lookup"><span data-stu-id="04d9d-531">This directory provides read/write access to the task.</span></span> <span data-ttu-id="04d9d-532">Задача может создавать, читать, обновлять и удалять файлы в данном каталоге.</span><span class="sxs-lookup"><span data-stu-id="04d9d-532">The task can create, read, update, and delete files under this directory.</span></span> <span data-ttu-id="04d9d-533">Время существования каталога определяется указанным для задачи ограничением *RetentionTime* .</span><span class="sxs-lookup"><span data-stu-id="04d9d-533">This directory is retained based on the *RetentionTime* constraint that is specified for the task.</span></span>

    <span data-ttu-id="04d9d-534">`stdout.txt` и `stderr.txt` — эти файлы сохраняются в папку задачи во время ее выполнения.</span><span class="sxs-lookup"><span data-stu-id="04d9d-534">`stdout.txt` and `stderr.txt`: These files are written to the task folder during the execution of the task.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="04d9d-535">При удалении узла из пула *все* файлы, хранящиеся на этом узле, удаляются.</span><span class="sxs-lookup"><span data-stu-id="04d9d-535">When a node is removed from the pool, *all* of the files that are stored on the node are removed.</span></span>
>
>

## <a name="application-packages"></a><span data-ttu-id="04d9d-536">Пакеты приложений</span><span class="sxs-lookup"><span data-stu-id="04d9d-536">Application packages</span></span>
<span data-ttu-id="04d9d-537">[Пакеты приложений](batch-application-packages.md) упрощают управление приложениями и их развертывание на вычислительных узлах в пулах.</span><span class="sxs-lookup"><span data-stu-id="04d9d-537">The [application packages](batch-application-packages.md) feature provides easy management and deployment of applications to the compute nodes in your pools.</span></span> <span data-ttu-id="04d9d-538">Вы можете отправлять несколько версий приложений, выполняемых задачами, включая двоичные файлы и файлы поддержки (а также управлять этими версиями),</span><span class="sxs-lookup"><span data-stu-id="04d9d-538">You can upload and manage multiple versions of the applications run by your tasks, including their binaries and support files.</span></span> <span data-ttu-id="04d9d-539">а затем автоматически развертывать одно или несколько таких приложений на вычислительных узлах в пуле.</span><span class="sxs-lookup"><span data-stu-id="04d9d-539">Then you can automatically deploy one or more of these applications to the compute nodes in your pool.</span></span>

<span data-ttu-id="04d9d-540">Пакеты приложений можно указывать на уровне пула и задачи.</span><span class="sxs-lookup"><span data-stu-id="04d9d-540">You can specify application packages at the pool and task level.</span></span> <span data-ttu-id="04d9d-541">Если пакеты приложений определены на уровне пула, приложение развертывается на всех узлах в пуле.</span><span class="sxs-lookup"><span data-stu-id="04d9d-541">When you specify pool application packages, the application is deployed to every node in the pool.</span></span> <span data-ttu-id="04d9d-542">Если пакеты приложений определены на уровне задачи, приложение развертывается только на узлах, на которых запланировано выполнение хотя бы одной задачи задания, перед запуском командной строки задачи.</span><span class="sxs-lookup"><span data-stu-id="04d9d-542">When you specify task application packages, the application is deployed only to nodes that are scheduled to run at least one of the job's tasks, just before the task's command line is run.</span></span>

<span data-ttu-id="04d9d-543">Пакетная служба обрабатывает сведения о работе со службой хранилища Azure, обеспечивая хранение пакетов приложений и их развертывание на вычислительных узлах. При этом упрощается код и сокращаются издержки, связанные с управлением.</span><span class="sxs-lookup"><span data-stu-id="04d9d-543">Batch handles the details of working with Azure Storage to store your application packages and deploy them to compute nodes, so both your code and management overhead can be simplified.</span></span>

<span data-ttu-id="04d9d-544">Дополнительные сведения об использовании пакетов приложений см. в статье [Развертывание приложений на вычислительных узлах с помощью пакетов приложений пакетной службы](batch-application-packages.md).</span><span class="sxs-lookup"><span data-stu-id="04d9d-544">To find out more about the application package feature, check out [Deploy applications to compute nodes with Batch application packages](batch-application-packages.md).</span></span>

> [!NOTE]
> <span data-ttu-id="04d9d-545">При добавлении пакетов приложений пула в *существующий* пул необходимо перезагрузить его вычислительные узлы, чтобы обеспечить развертывание пакетов приложений на узлах.</span><span class="sxs-lookup"><span data-stu-id="04d9d-545">If you add pool application packages to an *existing* pool, you must reboot its compute nodes for the application packages to be deployed to the nodes.</span></span>
>
>

## <a name="pool-and-compute-node-lifetime"></a><span data-ttu-id="04d9d-546">Время существования пула и вычислительного узла</span><span class="sxs-lookup"><span data-stu-id="04d9d-546">Pool and compute node lifetime</span></span>
<span data-ttu-id="04d9d-547">При проектировании решения на базе пакетной службы Azure следует принять решение о том, когда и как будут создаваться пулы и как долго будут доступны вычислительные узлы в этих пулах.</span><span class="sxs-lookup"><span data-stu-id="04d9d-547">When you design your Azure Batch solution, you have to make a design decision about how and when pools are created, and how long compute nodes within those pools are kept available.</span></span>

<span data-ttu-id="04d9d-548">Одной из крайностей является создание отдельного пула для каждого отправляемого задания и его удаление сразу по завершении выполнения задач.</span><span class="sxs-lookup"><span data-stu-id="04d9d-548">On one end of the spectrum, you can create a pool for each job that you submit, and delete the pool as soon as its tasks finish execution.</span></span> <span data-ttu-id="04d9d-549">Такой вариант позволит максимально эффективно использовать ресурсы, так как узлы выделяются в необходимом количестве и завершают работу, как только переходят в состояние простоя.</span><span class="sxs-lookup"><span data-stu-id="04d9d-549">This maximizes utilization because the nodes are only allocated when needed, and shut down as soon as they're idle.</span></span> <span data-ttu-id="04d9d-550">Но при этом задание должно ожидать выделения узлов. Важно отметить, что планирование задач для выполнения происходит по мере доступности и выделения каждого отдельного узла сразу после выполнения на нем задачи запуска.</span><span class="sxs-lookup"><span data-stu-id="04d9d-550">While this means that the job must wait for the nodes to be allocated, it's important to note that tasks are scheduled for execution as soon as nodes are individually available, allocated, and the start task has completed.</span></span> <span data-ttu-id="04d9d-551">Иными словами, пакетная служба *не* дожидается, пока все узлы в пуле станут доступными, чтобы назначить задачи узлам.</span><span class="sxs-lookup"><span data-stu-id="04d9d-551">Batch does *not* wait until all nodes within a pool are available before assigning tasks to the nodes.</span></span> <span data-ttu-id="04d9d-552">Это позволяет обеспечить максимально эффективное использование ресурсов.</span><span class="sxs-lookup"><span data-stu-id="04d9d-552">This ensures maximum utilization of all available nodes.</span></span>

<span data-ttu-id="04d9d-553">Другим крайним вариантом является заблаговременное создание пула и подготовка его узлов до запуска заданий. Этот вариант применим для тех ситуаций, когда немедленный запуск задания имеет наивысший приоритет.</span><span class="sxs-lookup"><span data-stu-id="04d9d-553">At the other end of the spectrum, if having jobs start immediately is the highest priority, you can create a pool ahead of time and make its nodes available before jobs are submitted.</span></span> <span data-ttu-id="04d9d-554">В этом случае задачи будут запускаться немедленно, но при этом узлы могут некоторое время простаивать в ожидании назначения задач.</span><span class="sxs-lookup"><span data-stu-id="04d9d-554">In this scenario, tasks can start immediately, but nodes might sit idle while waiting for them to be assigned.</span></span>

<span data-ttu-id="04d9d-555">Смешанный подход обычно используется для обработки постоянной нагрузки, интенсивность которой изменяется.</span><span class="sxs-lookup"><span data-stu-id="04d9d-555">A combined approach is typically used for handling a variable, but ongoing, load.</span></span> <span data-ttu-id="04d9d-556">В этом случае создается пул для нескольких заданий, количество узлов в котором изменяется в зависимости от текущей нагрузки (см. раздел [Масштабирование вычислительных ресурсов](#scaling-compute-resources) ниже).</span><span class="sxs-lookup"><span data-stu-id="04d9d-556">You can have a pool that multiple jobs are submitted to, but can scale the number of nodes up or down according to the job load (see [Scaling compute resources](#scaling-compute-resources) in the following section).</span></span> <span data-ttu-id="04d9d-557">Масштабирование можно выполнять по мере изменения интенсивности нагрузки или с упреждением, если нагрузка является прогнозируемой.</span><span class="sxs-lookup"><span data-stu-id="04d9d-557">You can do this reactively, based on current load, or proactively, if load can be predicted.</span></span>

## <a name="virtual-network-vnet-and-firewall-configuration"></a><span data-ttu-id="04d9d-558">Конфигурация виртуальной сети и брандмауэра</span><span class="sxs-lookup"><span data-stu-id="04d9d-558">Virtual network (VNet) and firewall configuration</span></span> 

<span data-ttu-id="04d9d-559">При подготовке пула вычислительных узлов в пакетной службе Azure можно связать его с подсетью [виртуальной сети Azure](../virtual-network/virtual-networks-overview.md).</span><span class="sxs-lookup"><span data-stu-id="04d9d-559">When you provision a pool of compute nodes in Azure Batch, you can associate the pool with a subnet of an Azure [virtual network (VNet)](../virtual-network/virtual-networks-overview.md).</span></span> <span data-ttu-id="04d9d-560">Дополнительные сведения о создании виртуальной сети с подсетями см. в статье [Создание виртуальной сети с несколькими подсетями](../virtual-network/virtual-networks-create-vnet-arm-pportal.md).</span><span class="sxs-lookup"><span data-stu-id="04d9d-560">To learn more about creating a VNet with subnets, see [Create an Azure virtual network with subnets](../virtual-network/virtual-networks-create-vnet-arm-pportal.md).</span></span> 

 * <span data-ttu-id="04d9d-561">Виртуальная сеть, связанная с пулом, должна:</span><span class="sxs-lookup"><span data-stu-id="04d9d-561">The VNet associated with a pool must be:</span></span>

   * <span data-ttu-id="04d9d-562">Находиться в том же **регионе Azure**, что и учетная запись пакетной службы Azure.</span><span class="sxs-lookup"><span data-stu-id="04d9d-562">In the same Azure **region** as the Azure Batch account.</span></span>
   * <span data-ttu-id="04d9d-563">Относиться к той же **подписке**, что и учетная запись пакетной службы Azure.</span><span class="sxs-lookup"><span data-stu-id="04d9d-563">In the same **subscription** as the Azure Batch account.</span></span>

* <span data-ttu-id="04d9d-564">Тип поддерживаемой виртуальной сети зависит от способа распределения пулов в учетной записи пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-564">The type of VNet supported depends on how pools are being allocated for the Batch account:</span></span>

    - <span data-ttu-id="04d9d-565">Если для учетной записи пакетной службы выбран режим распределения пула "Пакетная служба", то виртуальную сеть можно назначить только пулам, созданным с **конфигурацией облачной службы**.</span><span class="sxs-lookup"><span data-stu-id="04d9d-565">If the pool allocation mode for your Batch account is set to Batch Service, then you can assign a VNet only to pools created with the **Cloud Services Configuration**.</span></span> <span data-ttu-id="04d9d-566">Кроме того, указанная виртуальная сеть должна быть создана по классической модели развертывания.</span><span class="sxs-lookup"><span data-stu-id="04d9d-566">Additionally, the specified VNet must be created with the classic deployment model.</span></span> <span data-ttu-id="04d9d-567">Виртуальные сети, созданные по модели развертывания с помощью Azure Resource Manager, не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="04d9d-567">VNets created with the Azure Resource Manager deployment model are not supported.</span></span>
 
    - <span data-ttu-id="04d9d-568">Если для учетной записи пакетной службы выбран режим распределения пула "Пользовательская подписка", то виртуальную сеть можно назначить только пулам, созданным с **конфигурацией виртуальной сети**.</span><span class="sxs-lookup"><span data-stu-id="04d9d-568">If the pool allocation mode for your Batch account is set to User Subscription, then you can assign a VNet only to pools created with the **Virtual Machine Configuration**.</span></span> <span data-ttu-id="04d9d-569">Пулы, созданные с **конфигурацией облачной службы**, не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="04d9d-569">Pools created with the **Cloud Service Configuration** are not supported.</span></span> <span data-ttu-id="04d9d-570">Связанная виртуальная сеть может быть создана как по классической модели развертывания, так и по модели развертывания с помощью Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="04d9d-570">The associated VNet may be created with either the Azure Resource Manager deployment model or the classic deployment model.</span></span>

    <span data-ttu-id="04d9d-571">Таблицу со сведениями о поддерживаемых виртуальных сетях в зависимости от режима распределения пула см. в разделе [Режим распределения пула](#pool-allocation-mode).</span><span class="sxs-lookup"><span data-stu-id="04d9d-571">For a table summarizing VNet support according to pool allocation mode, see the [Pool allocation mode](#pool-allocation-mode) section.</span></span>

* <span data-ttu-id="04d9d-572">Если для учетной записи пакетной службы выбран режим распределения пула "Пакетная служба", субъекту-службе пакетной службы необходимо предоставить разрешения для доступа к виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="04d9d-572">If the pool allocation mode for your Batch account is set to Batch Service, then you must provide permissions for the Batch service principal to access the VNet.</span></span> <span data-ttu-id="04d9d-573">Субъекту-службе пакетной службы должна быть назначена роль [участника классической виртуальной машины](https://azure.microsoft.com/documentation/articles/role-based-access-built-in-roles/#classic-virtual-machine-contributor) для виртуальной сети в системе управления доступом на основе ролей (RBAC).</span><span class="sxs-lookup"><span data-stu-id="04d9d-573">The VNet must assign the [Classic Virtual Machine Contributor Role-Based Access Control (RBAC)](https://azure.microsoft.com/documentation/articles/role-based-access-built-in-roles/#classic-virtual-machine-contributor) role to the Batch service principal.</span></span> <span data-ttu-id="04d9d-574">Если такая роль RBAC не назначена, пакетная служба возвращает ошибку 400 (неправильный запрос).</span><span class="sxs-lookup"><span data-stu-id="04d9d-574">If the specified RBAC role is not provided, the Batch service returns 400 (Bad Request).</span></span> <span data-ttu-id="04d9d-575">Чтобы добавить роль на портале Azure, сделайте следующее.</span><span class="sxs-lookup"><span data-stu-id="04d9d-575">To add the role in the Azure portal:</span></span>

    1. <span data-ttu-id="04d9d-576">Выберите **виртуальную сеть** и последовательно щелкните **Управление доступом (IAM)** > **Роли** > **Участник виртуальных машин** > **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="04d9d-576">Select the **VNet**, then **Access control (IAM)** > **Roles** > **Virtual Machine Contributor** > **Add**.</span></span>
    2. <span data-ttu-id="04d9d-577">В колонке **Добавление разрешений** выберите роль **Участник виртуальных машин**.</span><span class="sxs-lookup"><span data-stu-id="04d9d-577">On the **Add permissions** blade, select the **Virtual Machine Contributor** role.</span></span>
    3. <span data-ttu-id="04d9d-578">В колонке **Добавление разрешений** выполните поиск API пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-578">On the **Add permissions** blade, search for the Batch API.</span></span> <span data-ttu-id="04d9d-579">Продолжайте поиск по каждой из этих строк поочередно, пока не найдете API:</span><span class="sxs-lookup"><span data-stu-id="04d9d-579">Search for each of these strings in turn until you find the API:</span></span>
        1. <span data-ttu-id="04d9d-580">**MicrosoftAzureBatch**;</span><span class="sxs-lookup"><span data-stu-id="04d9d-580">**MicrosoftAzureBatch**.</span></span>
        2. <span data-ttu-id="04d9d-581">**Microsoft Azure Batch**.</span><span class="sxs-lookup"><span data-stu-id="04d9d-581">**Microsoft Azure Batch**.</span></span> <span data-ttu-id="04d9d-582">Более новые клиенты Azure AD могут использовать это имя.</span><span class="sxs-lookup"><span data-stu-id="04d9d-582">Newer Azure AD tenants may use this name.</span></span>
        3. <span data-ttu-id="04d9d-583">**ddbf3205-c6bd-46ae-8127-60eb93363864** — это идентификатор API пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-583">**ddbf3205-c6bd-46ae-8127-60eb93363864** is the ID for the Batch API.</span></span> 
    3. <span data-ttu-id="04d9d-584">Выберите субъект-службу для API пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-584">Select the Batch API service principal.</span></span> 
    4. <span data-ttu-id="04d9d-585">Щелкните **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="04d9d-585">Click **Save**.</span></span>

        ![Назначение субъекту-службе пакетной службы роли участника виртуальных машин](./media/batch-api-basics/iam-add-role.png)


* <span data-ttu-id="04d9d-587">В указанной подсети должно быть достаточно свободных **IP-адресов**, чтобы разместить общее число целевых узлов, которое представляет собой сумму свойств `targetDedicatedNodes` и `targetLowPriorityNodes` пула.</span><span class="sxs-lookup"><span data-stu-id="04d9d-587">The specified subnet should have enough free **IP addresses** to accommodate the total number of target nodes; that is, the sum of the `targetDedicatedNodes` and `targetLowPriorityNodes` properties of the pool.</span></span> <span data-ttu-id="04d9d-588">Если в подсети недостаточно свободных IP-адресов, пакетная служба частично выделяет вычислительные узлы пула и возвращает ошибку изменения размера.</span><span class="sxs-lookup"><span data-stu-id="04d9d-588">If the subnet doesn't have enough free IP addresses, the Batch service partially allocates the compute nodes in the pool and returns a resize error.</span></span>

* <span data-ttu-id="04d9d-589">Чтобы на вычислительных узлах можно было назначать задачи, указанная подсеть должна разрешать подключения из пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-589">The specified subnet must allow communication from the Batch service to be able to schedule tasks on the compute nodes.</span></span> <span data-ttu-id="04d9d-590">Если **группа безопасности сети (NSG)**, связанная с этой виртуальной сетью, запрещает взаимодействие с вычислительными узлами, пакетная служба установит для вычислительных узлов состояние **Непригоден**.</span><span class="sxs-lookup"><span data-stu-id="04d9d-590">If communication to the compute nodes is denied by a **Network Security Group (NSG)** associated with the VNet, then the Batch service sets the state of the compute nodes to **unusable**.</span></span>

* <span data-ttu-id="04d9d-591">Если в указанной виртуальной сети есть связанные **группы безопасности сети (NSG)** и (или) **брандмауэр**, необходимо включить несколько зарезервированных системных портов для входящего трафика:</span><span class="sxs-lookup"><span data-stu-id="04d9d-591">If the specified VNet has associated **Network Security Groups (NSGs)** and/or a **firewall**, then a few reserved system ports must be enabled for inbound communication:</span></span>

- <span data-ttu-id="04d9d-592">Для пулов, созданных с помощью конфигурации виртуальной машины, включите порты 29876 и 29877, а также порт 22 для Linux и порт 3389 для Windows.</span><span class="sxs-lookup"><span data-stu-id="04d9d-592">For pools created with a virtual machine configuration, enable ports 29876 and 29877, as well as port 22 for Linux and port 3389 for Windows.</span></span> 
- <span data-ttu-id="04d9d-593">Для пулов, созданных с помощью конфигурации облачной службы, включите порты 10100, 20100 и 30100.</span><span class="sxs-lookup"><span data-stu-id="04d9d-593">For pools created with a cloud service configuration, enable ports 10100, 20100, and 30100.</span></span> 
- <span data-ttu-id="04d9d-594">Включите исходящие подключения к службе хранилища Azure через порт 443.</span><span class="sxs-lookup"><span data-stu-id="04d9d-594">Enable outbound connections to Azure Storage on port 443.</span></span> <span data-ttu-id="04d9d-595">Также убедитесь, что конечная точка службы хранилища Azure может разрешаться на всех пользовательских DNS-серверах, используемых в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="04d9d-595">Also, ensure that your Azure Storage endpoint can be resolved by any custom DNS servers that serve your VNET.</span></span> <span data-ttu-id="04d9d-596">В частности, URL-адрес в формате `<account>.table.core.windows.net` должен быть разрешаемым.</span><span class="sxs-lookup"><span data-stu-id="04d9d-596">Specifically, a URL of the form `<account>.table.core.windows.net` should be resolvable.</span></span>

    <span data-ttu-id="04d9d-597">В таблице ниже описаны входящие порты, которые необходимо включить для пулов, созданных с помощью конфигурации виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="04d9d-597">The following table describes the inbound ports that you need to enable for pools that you created with the virtual machine configuration:</span></span>

    |    <span data-ttu-id="04d9d-598">Конечные порты</span><span class="sxs-lookup"><span data-stu-id="04d9d-598">Destination Port(s)</span></span>    |    <span data-ttu-id="04d9d-599">Исходный IP-адрес</span><span class="sxs-lookup"><span data-stu-id="04d9d-599">Source IP address</span></span>      |    <span data-ttu-id="04d9d-600">Добавляет ли пакетная служба группы NSG?</span><span class="sxs-lookup"><span data-stu-id="04d9d-600">Does Batch add NSGs?</span></span>    |    <span data-ttu-id="04d9d-601">Требуется для использования виртуальной машины?</span><span class="sxs-lookup"><span data-stu-id="04d9d-601">Required for VM to be usable?</span></span>    |    <span data-ttu-id="04d9d-602">Действие пользователя</span><span class="sxs-lookup"><span data-stu-id="04d9d-602">Action from user</span></span>   |
    |---------------------------|---------------------------|----------------------------|-------------------------------------|-----------------------|
    |    <ul><li><span data-ttu-id="04d9d-603">Для пулов, созданных с помощью конфигурации виртуальной машины: 29876, 29877</span><span class="sxs-lookup"><span data-stu-id="04d9d-603">For pools created with the virtual machine configuration: 29876, 29877</span></span></li><li><span data-ttu-id="04d9d-604">Для пулов, созданных с помощью конфигурации облачной службы: 10100, 20100, 30100</span><span class="sxs-lookup"><span data-stu-id="04d9d-604">For pools created with the cloud service configuration: 10100, 20100, 30100</span></span></li></ul>         |    <span data-ttu-id="04d9d-605">Только IP-адреса для ролей пакетной службы</span><span class="sxs-lookup"><span data-stu-id="04d9d-605">Only Batch service role IP addresses</span></span> |    <span data-ttu-id="04d9d-606">Да.</span><span class="sxs-lookup"><span data-stu-id="04d9d-606">Yes.</span></span> <span data-ttu-id="04d9d-607">Пакетная служба добавляет группы NSG на уровне сетевых интерфейсов (NIC), подключенных к виртуальным машинам.</span><span class="sxs-lookup"><span data-stu-id="04d9d-607">Batch adds NSGs at the level of network interfaces (NIC) attached to VMs.</span></span> <span data-ttu-id="04d9d-608">Группы NSG пропускают трафик только с IP-адресов для ролей пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-608">These NSGs allow traffic only from Batch service role IP addresses.</span></span> <span data-ttu-id="04d9d-609">Даже если открыть эти порты для всего Интернета, трафик будет блокироваться в сетевом интерфейсе.</span><span class="sxs-lookup"><span data-stu-id="04d9d-609">Even if you open these ports for the  entire web, the traffic will get blocked at the NIC.</span></span> |    <span data-ttu-id="04d9d-610">Да</span><span class="sxs-lookup"><span data-stu-id="04d9d-610">Yes</span></span>  |  <span data-ttu-id="04d9d-611">Указывать NSG не требуется, так как пакетная служба пропускает только трафик с IP-адресов пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-611">You do not need to specify an NSG, because Batch allows only Batch IP addresses.</span></span> <br /><br /> <span data-ttu-id="04d9d-612">Если вы все же укажете NSG, убедитесь, что эти порты открыты для входящего трафика.</span><span class="sxs-lookup"><span data-stu-id="04d9d-612">However, if you do specify an NSG, please ensure that these ports are open for inbound traffic.</span></span> <br /><br /> <span data-ttu-id="04d9d-613">При указании * в качестве исходного IP-адреса в группе NSG пакетная служба по-прежнему добавляет группы NSG на уровне сетевого интерфейса, подключенного к виртуальным машинам.</span><span class="sxs-lookup"><span data-stu-id="04d9d-613">If you specify * as the source IP in your NSG, Batch still adds NSGs at the level of NIC attached to VMs.</span></span> |
    |    <span data-ttu-id="04d9d-614">3389, 22</span><span class="sxs-lookup"><span data-stu-id="04d9d-614">3389, 22</span></span>               |    <span data-ttu-id="04d9d-615">Компьютеры пользователя, используемые для отладки и удаленного доступа к виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="04d9d-615">User machines, used for debugging purposes, so that you can remotely access the VM.</span></span>    |    <span data-ttu-id="04d9d-616">Нет</span><span class="sxs-lookup"><span data-stu-id="04d9d-616">No</span></span>                                    |    <span data-ttu-id="04d9d-617">Нет</span><span class="sxs-lookup"><span data-stu-id="04d9d-617">No</span></span>                     |    <span data-ttu-id="04d9d-618">Добавьте группы NSG, чтобы разрешить удаленный доступ (по протоколу RDP или SSH) к виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="04d9d-618">Add NSGs if you want to permit remote access (RDP/SSH) to the VM.</span></span>   |                 

    <span data-ttu-id="04d9d-619">В таблице ниже описан исходящий порт, который необходимо включить, чтобы разрешить доступ к службе хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="04d9d-619">The following table describes the outbound port that you need to enable to permit access to Azure Storage:</span></span>

    |    <span data-ttu-id="04d9d-620">Исходящие порты</span><span class="sxs-lookup"><span data-stu-id="04d9d-620">Outbound Port(s)</span></span>    |    <span data-ttu-id="04d9d-621">Место назначения</span><span class="sxs-lookup"><span data-stu-id="04d9d-621">Destination</span></span>    |    <span data-ttu-id="04d9d-622">Добавляет ли пакетная служба группы NSG?</span><span class="sxs-lookup"><span data-stu-id="04d9d-622">Does Batch add NSGs?</span></span>    |    <span data-ttu-id="04d9d-623">Требуется для использования виртуальной машины?</span><span class="sxs-lookup"><span data-stu-id="04d9d-623">Required for VM to be usable?</span></span>    |    <span data-ttu-id="04d9d-624">Действие пользователя</span><span class="sxs-lookup"><span data-stu-id="04d9d-624">Action from user</span></span>    |
    |------------------------|-------------------|----------------------------|-------------------------------------|------------------------|
    |    <span data-ttu-id="04d9d-625">443</span><span class="sxs-lookup"><span data-stu-id="04d9d-625">443</span></span>    |    <span data-ttu-id="04d9d-626">Хранилище Azure</span><span class="sxs-lookup"><span data-stu-id="04d9d-626">Azure Storage</span></span>    |    <span data-ttu-id="04d9d-627">Нет</span><span class="sxs-lookup"><span data-stu-id="04d9d-627">No</span></span>    |    <span data-ttu-id="04d9d-628">Да</span><span class="sxs-lookup"><span data-stu-id="04d9d-628">Yes</span></span>    |    <span data-ttu-id="04d9d-629">При добавлении групп NSG убедитесь, что этот порт открыт для исходящего трафика.</span><span class="sxs-lookup"><span data-stu-id="04d9d-629">If you add any NSGs, then ensure that this port is open to outbound   traffic.</span></span>    |


## <a name="scaling-compute-resources"></a><span data-ttu-id="04d9d-630">Масштабирование вычислительных ресурсов</span><span class="sxs-lookup"><span data-stu-id="04d9d-630">Scaling compute resources</span></span>
<span data-ttu-id="04d9d-631">[Автоматическое масштабирование](batch-automatic-scaling.md)позволяет использовать пакетную службу для динамической настройки количества вычислительных узлов в пуле в соответствии с текущей рабочей нагрузкой и использованием ресурсов в рамках вашего сценария вычислений.</span><span class="sxs-lookup"><span data-stu-id="04d9d-631">With [automatic scaling](batch-automatic-scaling.md), you can have the Batch service dynamically adjust the number of compute nodes in a pool according to the current workload and resource usage of your compute scenario.</span></span> <span data-ttu-id="04d9d-632">Это позволит снизить общую стоимость работы приложения за счет использования только необходимых ресурсов и освобождения остальных.</span><span class="sxs-lookup"><span data-stu-id="04d9d-632">This allows you to lower the overall cost of running your application by using only the resources you need, and releasing those you don't need.</span></span>

<span data-ttu-id="04d9d-633">Чтобы включить автоматическое масштабирование, необходимо написать [соответствующую формулу](batch-automatic-scaling.md#automatic-scaling-formulas) и связать ее с пулом.</span><span class="sxs-lookup"><span data-stu-id="04d9d-633">You enable automatic scaling by writing an [automatic scaling formula](batch-automatic-scaling.md#automatic-scaling-formulas) and associating that formula with a pool.</span></span> <span data-ttu-id="04d9d-634">Пакетная служба использует эту формулу для определения целевого количества узлов в пуле для следующего интервала масштабирования (интервал, который можно настроить).</span><span class="sxs-lookup"><span data-stu-id="04d9d-634">The Batch service uses the formula to determine the target number of nodes in the pool for the next scaling interval (an interval that you can configure).</span></span> <span data-ttu-id="04d9d-635">Вы можете указать параметры автоматического масштабирования для пула при его создании или включить масштабирование позже.</span><span class="sxs-lookup"><span data-stu-id="04d9d-635">You can specify the automatic scaling settings for a pool when you create it, or enable scaling on a pool later.</span></span> <span data-ttu-id="04d9d-636">Вы также можете обновить параметры масштабирования в пуле с включенным масштабированием.</span><span class="sxs-lookup"><span data-stu-id="04d9d-636">You can also update the scaling settings on a scaling-enabled pool.</span></span>

<span data-ttu-id="04d9d-637">Рассмотрим для примера задание, которое требует отправки большого количества задач для выполнения.</span><span class="sxs-lookup"><span data-stu-id="04d9d-637">As an example, perhaps a job requires that you submit a very large number of tasks to be executed.</span></span> <span data-ttu-id="04d9d-638">Вы можете назначить для пула формулу масштабирования, которая изменяет количество узлов пула в зависимости от текущего числа задач в очереди и скорости выполнения этих задач, входящих в задание.</span><span class="sxs-lookup"><span data-stu-id="04d9d-638">You can assign a scaling formula to the pool that adjusts the number of nodes in the pool based on the current number of queued tasks and the completion rate of the tasks in the job.</span></span> <span data-ttu-id="04d9d-639">Пакетная служба периодически вычисляет формулу и изменяет размер пула в зависимости от рабочей нагрузки и других параметров формулы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-639">The Batch service periodically evaluates the formula and resizes the pool, based on workload and your other formula settings.</span></span> <span data-ttu-id="04d9d-640">По мере необходимости служба добавляет узлы, если в очереди стоит большое количество задач, и удаляет узлы при отсутствии задач в очереди или выполняемых задач.</span><span class="sxs-lookup"><span data-stu-id="04d9d-640">The service adds nodes as needed when there are a large number of queued tasks, and removes nodes when there are no queued or running tasks.</span></span>

<span data-ttu-id="04d9d-641">Формула масштабирования может использовать следующие метрики.</span><span class="sxs-lookup"><span data-stu-id="04d9d-641">A scaling formula can be based on the following metrics:</span></span>

* <span data-ttu-id="04d9d-642">**Метрики времени** — основываются на статистических данных, которые собираются каждые 5 минут за указанное число часов.</span><span class="sxs-lookup"><span data-stu-id="04d9d-642">**Time metrics** are based on statistics collected every five minutes in the specified number of hours.</span></span>
* <span data-ttu-id="04d9d-643">**Метрики ресурсов** — зависят от показателей загрузки ЦП, использования пропускной способности и памяти, а также количества узлов.</span><span class="sxs-lookup"><span data-stu-id="04d9d-643">**Resource metrics** are based on CPU usage, bandwidth usage, memory usage, and number of nodes.</span></span>
* <span data-ttu-id="04d9d-644">**Метрики задач** зависят от состояния задачи: *Активная* (в очереди), *Выполняется* или *Завершена*.</span><span class="sxs-lookup"><span data-stu-id="04d9d-644">**Task metrics** are based on task state, such as *Active* (queued), *Running*, or *Completed*.</span></span>

<span data-ttu-id="04d9d-645">Если при автоматическом масштабировании уменьшается количество вычислительных узлов в пуле, необходимо учитывать способ обработки текущих выполняемых задач.</span><span class="sxs-lookup"><span data-stu-id="04d9d-645">When automatic scaling decreases the number of compute nodes in a pool, you must consider how to handle tasks that are running at the time of the decrease operation.</span></span> <span data-ttu-id="04d9d-646">Чтобы решить эту проблему, пакетная служба предоставляет *параметр отмены выделения узла*, который можно добавить в формулу.</span><span class="sxs-lookup"><span data-stu-id="04d9d-646">To accommodate this, Batch provides a *node deallocation option* that you can include in your formulas.</span></span> <span data-ttu-id="04d9d-647">Например, можно указать, чтобы выполняемые задачи сразу останавливались, останавливались, а затем помещались в очередь на выполнение на другом узле или завершались до удаления узла из пула.</span><span class="sxs-lookup"><span data-stu-id="04d9d-647">For example, you can specify that running tasks are stopped immediately, stopped immediately and then requeued for execution on another node, or allowed to finish before the node is removed from the pool.</span></span>

<span data-ttu-id="04d9d-648">Подробные сведения об автоматическом масштабировании приложения см. в статье [Автоматическое масштабирование вычислительных узлов в пуле пакетной службы Azure](batch-automatic-scaling.md).</span><span class="sxs-lookup"><span data-stu-id="04d9d-648">For more information about automatically scaling an application, see [Automatically scale compute nodes in an Azure Batch pool](batch-automatic-scaling.md).</span></span>

> [!TIP]
> <span data-ttu-id="04d9d-649">Для максимально эффективного использования ресурсов укажите значение "ноль" для целевого количества узлов на момент завершения задания, но позвольте текущим задачам завершиться нормально.</span><span class="sxs-lookup"><span data-stu-id="04d9d-649">To maximize compute resource utilization, set the target number of nodes to zero at the end of a job, but allow running tasks to finish.</span></span>
>
>

## <a name="security-with-certificates"></a><span data-ttu-id="04d9d-650">Безопасность с использованием сертификатов</span><span class="sxs-lookup"><span data-stu-id="04d9d-650">Security with certificates</span></span>
<span data-ttu-id="04d9d-651">Обычно сертификаты нужны для шифрования и расшифровки конфиденциальных сведений, используемых задачами, например ключей [учетной записи службы хранилища Azure][azure_storage].</span><span class="sxs-lookup"><span data-stu-id="04d9d-651">You typically need to use certificates when you encrypt or decrypt sensitive information for tasks, like the key for an [Azure Storage account][azure_storage].</span></span> <span data-ttu-id="04d9d-652">Такие сертификаты можно установить на узлах.</span><span class="sxs-lookup"><span data-stu-id="04d9d-652">To support this, you can install certificates on nodes.</span></span> <span data-ttu-id="04d9d-653">Зашифрованные данные передаются задачам через параметры командной строки или через ресурсы задачи, а установленные сертификаты позволяют расшифровать их.</span><span class="sxs-lookup"><span data-stu-id="04d9d-653">Encrypted secrets are passed to tasks via command-line parameters or embedded in one of the task resources, and the installed certificates can be used to decrypt them.</span></span>

<span data-ttu-id="04d9d-654">Для добавления сертификата к учетной записи пакетной службы используйте операцию [добавления сертификата][rest_add_cert] в REST API пакетной службы или метод [CertificateOperations.CreateCertificate][net_create_cert] в .NET для пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-654">You use the [Add certificate][rest_add_cert] operation (Batch REST) or [CertificateOperations.CreateCertificate][net_create_cert] method (Batch .NET) to add a certificate to a Batch account.</span></span> <span data-ttu-id="04d9d-655">Затем можно будет связать сертификат с новым или существующим пулом.</span><span class="sxs-lookup"><span data-stu-id="04d9d-655">You can then associate the certificate with a new or existing pool.</span></span> <span data-ttu-id="04d9d-656">Если к пулу привязан сертификат, пакетная служба устанавливает этот сертификат на каждом узле пула.</span><span class="sxs-lookup"><span data-stu-id="04d9d-656">When a certificate is associated with a pool, the Batch service installs the certificate on each node in the pool.</span></span> <span data-ttu-id="04d9d-657">Пакетная служба устанавливает нужные сертификаты при запуске узла до начала выполнения каких-либо задач (в том числе задач запуска и задач диспетчера заданий).</span><span class="sxs-lookup"><span data-stu-id="04d9d-657">The Batch service installs the appropriate certificates when the node starts up, before launching any tasks (including the start task and job manager task).</span></span>

<span data-ttu-id="04d9d-658">При добавлении сертификатов в *существующий* пул необходимо перезагрузить его вычислительные узлы, чтобы применить к ним сертификаты.</span><span class="sxs-lookup"><span data-stu-id="04d9d-658">If you add certificates to an *existing* pool, you must reboot its compute nodes for the certificates to be applied to the nodes.</span></span>

## <a name="error-handling"></a><span data-ttu-id="04d9d-659">Обработка ошибок</span><span class="sxs-lookup"><span data-stu-id="04d9d-659">Error handling</span></span>
<span data-ttu-id="04d9d-660">Возможно, вы захотите обрабатывать ошибки задач и приложений в своем решении пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-660">You might find it necessary to handle both task and application failures within your Batch solution.</span></span>

### <a name="task-failure-handling"></a><span data-ttu-id="04d9d-661">Обработка сбоев задач</span><span class="sxs-lookup"><span data-stu-id="04d9d-661">Task failure handling</span></span>
<span data-ttu-id="04d9d-662">Сбои задач делятся на следующие категории.</span><span class="sxs-lookup"><span data-stu-id="04d9d-662">Task failures fall into these categories:</span></span>

* <span data-ttu-id="04d9d-663">**Ошибки предварительной обработки**</span><span class="sxs-lookup"><span data-stu-id="04d9d-663">**Pre-processing failures**</span></span>

    <span data-ttu-id="04d9d-664">Если не удается запустить задачу, для нее устанавливается ошибка предварительной обработки.</span><span class="sxs-lookup"><span data-stu-id="04d9d-664">If a task fails to start, a pre-processing error is set for the task.</span></span>  

    <span data-ttu-id="04d9d-665">Ошибки предварительной обработки могут возникать, если файлы ресурсов задачи перемещены, учетная запись хранения недоступна или не удалось выполнить копирование файлов на узел из-за другой проблемы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-665">Pre-processing errors can occur if the task's resource files have moved, the Storage account is no longer available, or another issue was encountered that prevented the successful copying of files to the node.</span></span>

* <span data-ttu-id="04d9d-666">**Ошибки передачи файлов**</span><span class="sxs-lookup"><span data-stu-id="04d9d-666">**File upload failures**</span></span>

    <span data-ttu-id="04d9d-667">Если по какой-либо причине происходит сбой передачи файлов, указанных для задачи, для нее устанавливается ошибка передачи файлов.</span><span class="sxs-lookup"><span data-stu-id="04d9d-667">If uploading files that are specified for a task fails for any reason, a file upload error is set for the task.</span></span>

    <span data-ttu-id="04d9d-668">Ошибки передачи файлов могут возникать, если подписанный URL-адрес, указанный для доступа к службе хранилища Azure, недействителен или не предоставляет разрешения на запись, учетная запись хранения недоступна либо произошла другая ошибка, которая не позволяет скопировать файлы с узла.</span><span class="sxs-lookup"><span data-stu-id="04d9d-668">File upload errors can occur if the SAS supplied for accessing Azure Storage is invalid or does not provide write permissions, if the storage account is no longer available, or if another issue was encountered that prevented the successful copying of files from the node.</span></span>    

* <span data-ttu-id="04d9d-669">**Ошибки приложений**</span><span class="sxs-lookup"><span data-stu-id="04d9d-669">**Application failures**</span></span>

    <span data-ttu-id="04d9d-670">Процесс, указанный в командной строке задачи, также может завершиться ошибкой.</span><span class="sxs-lookup"><span data-stu-id="04d9d-670">The process that is specified by the task's command line can also fail.</span></span> <span data-ttu-id="04d9d-671">Если процесс, который выполняет задача, возвращает ненулевой код завершения, считается, что такой процесс завершился ошибкой (см. подраздел *Код завершения задач* в следующем разделе).</span><span class="sxs-lookup"><span data-stu-id="04d9d-671">The process is deemed to have failed when a nonzero exit code is returned by the process that is executed by the task (see *Task exit codes* in the next section).</span></span>

    <span data-ttu-id="04d9d-672">Вы можете настроить пакетную службу так, чтобы в случае ошибки приложения она автоматически повторяла задачу, а также указать максимальное количество таких попыток.</span><span class="sxs-lookup"><span data-stu-id="04d9d-672">For application failures, you can configure Batch to automatically retry the task up to a specified number of times.</span></span>

* <span data-ttu-id="04d9d-673">**Ошибки ограничения**</span><span class="sxs-lookup"><span data-stu-id="04d9d-673">**Constraint failures**</span></span>

    <span data-ttu-id="04d9d-674">Вы можете установить ограничение на максимальное время выполнения задания или задачи с помощью параметра *maxWallClockTime*.</span><span class="sxs-lookup"><span data-stu-id="04d9d-674">You can set a constraint that specifies the maximum execution duration for a job or task, the *maxWallClockTime*.</span></span> <span data-ttu-id="04d9d-675">Это полезно для завершения задач, переставших отвечать на запросы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-675">This can be useful for terminating tasks that fail to progress.</span></span>

    <span data-ttu-id="04d9d-676">Если превышено максимальное время выполнения, задача отмечается как *завершенная*, но с кодом выхода `0xC000013A`. При этом поле *schedulingError* будет иметь значение `{ category:"ServerError", code="TaskEnded"}`.</span><span class="sxs-lookup"><span data-stu-id="04d9d-676">When the maximum amount of time has been exceeded, the task is marked as *completed*, but the exit code is set to `0xC000013A` and the *schedulingError* field is marked as `{ category:"ServerError", code="TaskEnded"}`.</span></span>

### <a name="debugging-application-failures"></a><span data-ttu-id="04d9d-677">Отладка ошибок приложений</span><span class="sxs-lookup"><span data-stu-id="04d9d-677">Debugging application failures</span></span>
* <span data-ttu-id="04d9d-678">`stderr` и `stdout`</span><span class="sxs-lookup"><span data-stu-id="04d9d-678">`stderr` and `stdout`</span></span>

    <span data-ttu-id="04d9d-679">Во время выполнения приложение может создавать диагностические данные, которые помогут устранить неполадки.</span><span class="sxs-lookup"><span data-stu-id="04d9d-679">During execution, an application might produce diagnostic output that you can use to troubleshoot issues.</span></span> <span data-ttu-id="04d9d-680">Как упоминалось выше в разделе [Файлы и каталоги](#files-and-directories), пакетная служба записывает стандартные потоки вывода и ошибок в файлы `stdout.txt` и `stderr.txt`, расположенные в каталоге задач на вычислительном узле.</span><span class="sxs-lookup"><span data-stu-id="04d9d-680">As mentioned in the earlier section [Files and directories](#files-and-directories), the Batch service writes standard output and standard error output to `stdout.txt` and `stderr.txt` files in the task directory on the compute node.</span></span> <span data-ttu-id="04d9d-681">Чтобы получить эти файлы, можно использовать портал Azure или один из пакетов SDK пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-681">You can use the Azure portal or one of the Batch SDKs to download these files.</span></span> <span data-ttu-id="04d9d-682">Например, вы можете получить эти и другие файлы для устранения неполадок, используя методы [ComputeNode.GetNodeFile][net_getfile_node] и [CloudTask.GetNodeFile][net_getfile_task] библиотеки .NET для пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-682">For example, you can retrieve these and other files for troubleshooting purposes by using [ComputeNode.GetNodeFile][net_getfile_node] and [CloudTask.GetNodeFile][net_getfile_task] in the Batch .NET library.</span></span>

* <span data-ttu-id="04d9d-683">**Код завершения задач**</span><span class="sxs-lookup"><span data-stu-id="04d9d-683">**Task exit codes**</span></span>

    <span data-ttu-id="04d9d-684">Как упоминалось выше, пакетная служба помечает задачу как завершившуюся сбоем, если процесс, выполняемый задачей, возвращает ненулевой код завершения.</span><span class="sxs-lookup"><span data-stu-id="04d9d-684">As mentioned earlier, a task is marked as failed by the Batch service if the process that is executed by the task returns a nonzero exit code.</span></span> <span data-ttu-id="04d9d-685">Когда задача выполняет процесс, пакетная служба заполняет свойство кода завершения задачи *кодом возврата процесса*.</span><span class="sxs-lookup"><span data-stu-id="04d9d-685">When a task executes a process, Batch populates the task's exit code property with the *return code of the process*.</span></span> <span data-ttu-id="04d9d-686">Следует отметить, что код завершения задачи определяется **не** пакетной службой.</span><span class="sxs-lookup"><span data-stu-id="04d9d-686">It is important to note that a task's exit code is **not** determined by the Batch service.</span></span> <span data-ttu-id="04d9d-687">Код завершения задачи определяется самим процессом или операционной системой, в которой он выполняется.</span><span class="sxs-lookup"><span data-stu-id="04d9d-687">A task's exit code is determined by the process itself or the operating system on which the process executed.</span></span>

### <a name="accounting-for-task-failures-or-interruptions"></a><span data-ttu-id="04d9d-688">Работа со сбоями и прерываниями задач</span><span class="sxs-lookup"><span data-stu-id="04d9d-688">Accounting for task failures or interruptions</span></span>
<span data-ttu-id="04d9d-689">Задачи могут иногда завершаться ошибками или прерываться.</span><span class="sxs-lookup"><span data-stu-id="04d9d-689">Tasks might occasionally fail or be interrupted.</span></span> <span data-ttu-id="04d9d-690">Например, может завершиться ошибкой приложение задачи или узел, на котором выполняется задача, может быть перезапущен. Кроме того, узел может быть удален из пула при изменении размера, если установленная политика отмены выделения предусматривает немедленное удаление узла без ожидания завершения задачи.</span><span class="sxs-lookup"><span data-stu-id="04d9d-690">The task application itself might fail, the node on which the task is running might be rebooted, or the node might be removed from the pool during a resize operation if the pool's deallocation policy is set to remove nodes immediately without waiting for tasks to finish.</span></span> <span data-ttu-id="04d9d-691">Во всех случаях пакетная служба может автоматически поставить задачу в очередь на повторное выполнение на другом узле.</span><span class="sxs-lookup"><span data-stu-id="04d9d-691">In all cases, the task can be automatically requeued by Batch for execution on another node.</span></span>

<span data-ttu-id="04d9d-692">Задача может также зависнуть или выполняться слишком долго из-за кратковременного сбоя.</span><span class="sxs-lookup"><span data-stu-id="04d9d-692">It is also possible for an intermittent issue to cause a task to hang or take too long to execute.</span></span> <span data-ttu-id="04d9d-693">Для задачи можно установить максимальный интервал выполнения.</span><span class="sxs-lookup"><span data-stu-id="04d9d-693">You can set the maximum execution interval for a task.</span></span> <span data-ttu-id="04d9d-694">В случае его превышения пакетная служба прерывает выполнение приложения задачи.</span><span class="sxs-lookup"><span data-stu-id="04d9d-694">If the maximum execution interval is exceeded, the Batch service interrupts the task application.</span></span>

### <a name="connecting-to-compute-nodes"></a><span data-ttu-id="04d9d-695">Подключение к вычислительным узлам</span><span class="sxs-lookup"><span data-stu-id="04d9d-695">Connecting to compute nodes</span></span>
<span data-ttu-id="04d9d-696">Дополнительные возможности для отладки и устранения неполадок можно получить, выполнив вход на вычислительный узел удаленно.</span><span class="sxs-lookup"><span data-stu-id="04d9d-696">You can perform additional debugging and troubleshooting by signing in to a compute node remotely.</span></span> <span data-ttu-id="04d9d-697">Вы можете использовать портал Azure, чтобы скачать RDP-файл для узлов Windows и получить сведения о подключении SSH для узлов Linux.</span><span class="sxs-lookup"><span data-stu-id="04d9d-697">You can use the Azure portal to download a Remote Desktop Protocol (RDP) file for Windows nodes and obtain Secure Shell (SSH) connection information for Linux nodes.</span></span> <span data-ttu-id="04d9d-698">Это также можно сделать с помощью API пакетной службы (например, в экземплярах [Batch .NET][net_rdpfile] или [Batch Python](batch-linux-nodes.md#connect-to-linux-nodes-using-ssh)).</span><span class="sxs-lookup"><span data-stu-id="04d9d-698">You can also do this by using the Batch APIs--for example, with [Batch .NET][net_rdpfile] or [Batch Python](batch-linux-nodes.md#connect-to-linux-nodes-using-ssh).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="04d9d-699">Чтобы подключиться к узлу по протоколу RDP или SSH, на узле нужно создать пользователя.</span><span class="sxs-lookup"><span data-stu-id="04d9d-699">To connect to a node via RDP or SSH, you must first create a user on the node.</span></span> <span data-ttu-id="04d9d-700">Для этого можно использовать портал Azure, [добавить учетную запись пользователя на узел][rest_create_user] с помощью REST API пакетной службы, вызвать метод [ComputeNode.CreateComputeNodeUser][net_create_user] в .NET API пакетной службы или метод [add_user][py_add_user] в модуле Python пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-700">To do this, you can use the Azure portal, [add a user account to a node][rest_create_user] by using the Batch REST API, call the [ComputeNode.CreateComputeNodeUser][net_create_user] method in Batch .NET, or call the [add_user][py_add_user] method in the Batch Python module.</span></span>
>
>

### <a name="troubleshooting-problematic-compute-nodes"></a><span data-ttu-id="04d9d-701">Устранение неполадок проблемных вычислительных узлов</span><span class="sxs-lookup"><span data-stu-id="04d9d-701">Troubleshooting problematic compute nodes</span></span>
<span data-ttu-id="04d9d-702">В ситуациях, когда при выполнении некоторых задач происходит сбой, пакетное клиентское приложение или служба может проверить метаданные неудачных задач для определения узла, который плохо работает.</span><span class="sxs-lookup"><span data-stu-id="04d9d-702">In situations where some of your tasks are failing, your Batch client application or service can examine the metadata of the failed tasks to identify a misbehaving node.</span></span> <span data-ttu-id="04d9d-703">Каждому узлу в пуле присваивается уникальный идентификатор, а сведения об узле, на котором выполняется задача, включены в метаданные задачи.</span><span class="sxs-lookup"><span data-stu-id="04d9d-703">Each node in a pool is given a unique ID, and the node on which a task runs is included in the task metadata.</span></span> <span data-ttu-id="04d9d-704">Определив проблемный узел, вы можете предпринять некоторые действия:</span><span class="sxs-lookup"><span data-stu-id="04d9d-704">After you've identified a problem node, you can take several actions with it:</span></span>

* <span data-ttu-id="04d9d-705">**Перезапустить узел** ([REST][rest_reboot] | [.NET][net_reboot])</span><span class="sxs-lookup"><span data-stu-id="04d9d-705">**Reboot the node** ([REST][rest_reboot] | [.NET][net_reboot])</span></span>

    <span data-ttu-id="04d9d-706">В некоторых случаях перезапуск узла может устранить некоторые скрытые проблемы, например задержки и сбои при выполнении процессов.</span><span class="sxs-lookup"><span data-stu-id="04d9d-706">Restarting the node can sometimes clear up latent issues like stuck or crashed processes.</span></span> <span data-ttu-id="04d9d-707">Обратите внимание, что если пул использует начальную задачу или задание использует задачу подготовки задания, они будут выполнены при перезапуске узла.</span><span class="sxs-lookup"><span data-stu-id="04d9d-707">Note that if your pool uses a start task or your job uses a job preparation task, they are executed when the node restarts.</span></span>
* <span data-ttu-id="04d9d-708">**Пересоздать образ узла** ([REST][rest_reimage] | [.NET][net_reimage])</span><span class="sxs-lookup"><span data-stu-id="04d9d-708">**Reimage the node** ([REST][rest_reimage] | [.NET][net_reimage])</span></span>

    <span data-ttu-id="04d9d-709">Это обеспечит переустановку операционной системы на узле.</span><span class="sxs-lookup"><span data-stu-id="04d9d-709">This reinstalls the operating system on the node.</span></span> <span data-ttu-id="04d9d-710">Как и в случае перезагрузки узла, задачи запуска и задачи подготовки заданий будут повторно выполнены после повторного создания образа узла.</span><span class="sxs-lookup"><span data-stu-id="04d9d-710">As with rebooting a node, start tasks and job preparation tasks are rerun after the node has been reimaged.</span></span>
* <span data-ttu-id="04d9d-711">**Удалить узел из пула** ([REST][rest_remove] | [.NET][net_remove])</span><span class="sxs-lookup"><span data-stu-id="04d9d-711">**Remove the node from the pool** ([REST][rest_remove] | [.NET][net_remove])</span></span>

    <span data-ttu-id="04d9d-712">Иногда бывает необходимо полностью удалить узел из пула.</span><span class="sxs-lookup"><span data-stu-id="04d9d-712">Sometimes it is necessary to completely remove the node from the pool.</span></span>
* <span data-ttu-id="04d9d-713">**Отключить планирование задач на узле** ([REST][rest_offline] | [.NET][net_offline])</span><span class="sxs-lookup"><span data-stu-id="04d9d-713">**Disable task scheduling on the node** ([REST][rest_offline] | [.NET][net_offline])</span></span>

    <span data-ttu-id="04d9d-714">Это эффективно переключит узел в "автономный режим", чтобы ему не назначались дальнейшие задачи, но сохранялась возможность продолжать выполнять текущие задачи, оставаясь в пуле.</span><span class="sxs-lookup"><span data-stu-id="04d9d-714">This effectively takes the node offline so that no further tasks are assigned to it, but allows the node to remain running and in the pool.</span></span> <span data-ttu-id="04d9d-715">Благодаря этому вы сможете продолжить поиск причины сбоев без потери данных невыполненной задачи и без сбоев при выполнении дополнительных задач на узле.</span><span class="sxs-lookup"><span data-stu-id="04d9d-715">This enables you to perform further investigation into the cause of the failures without losing the failed task's data, and without the node causing additional task failures.</span></span> <span data-ttu-id="04d9d-716">Например, можно отключить планирование задач на узле, а затем выполнить [удаленный вход](#connecting-to-compute-nodes) на узел для анализа журналов событий или устранения других неполадок.</span><span class="sxs-lookup"><span data-stu-id="04d9d-716">For example, you can disable task scheduling on the node, then [sign in remotely](#connecting-to-compute-nodes) to examine the node's event logs or perform other troubleshooting.</span></span> <span data-ttu-id="04d9d-717">Проанализировав проблемы, вы сможете снова подключить узел к сети, включив планирование задач ([REST][rest_online] | [.NET][net_online]) или выполнив одно из перечисленных выше действий.</span><span class="sxs-lookup"><span data-stu-id="04d9d-717">After you've finished your investigation, you can then bring the node back online by enabling task scheduling ([REST][rest_online] | [.NET][net_online]), or perform one of the other actions discussed earlier.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="04d9d-718">С помощью каждого действия, перечисленного в этом разделе, (перезагрузки, пересоздания образа, удаления, отключения планирования задач) вы можете указать вариант обработки текущих задач на узле при выполнении действия.</span><span class="sxs-lookup"><span data-stu-id="04d9d-718">With each action that is described in this section--reboot, reimage, remove, and disable task scheduling--you are able to specify how tasks currently running on the node are handled when you perform the action.</span></span> <span data-ttu-id="04d9d-719">Например, при отключении планирования задач на узле с помощью клиентской библиотеки .NET для пакетной службы вы можете указать значение перечисления [DisableComputeNodeSchedulingOption][net_offline_option], чтобы определить, что нужно сделать до выполнения действия (**TaskCompletion**): **прекратить** выполнение текущих задач, **повторно поставить их в очередь** для планирования выполнения на других узлах или разрешить завершение текущих задач.</span><span class="sxs-lookup"><span data-stu-id="04d9d-719">For example, when you disable task scheduling on a node by using the Batch .NET client library, you can specify a [DisableComputeNodeSchedulingOption][net_offline_option] enum value to specify whether to **Terminate** running tasks, **Requeue** them for scheduling on other nodes, or allow running tasks to complete before performing the action (**TaskCompletion**).</span></span>
>
>

## <a name="next-steps"></a><span data-ttu-id="04d9d-720">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="04d9d-720">Next steps</span></span>
* <span data-ttu-id="04d9d-721">См. дополнительные сведения об [API-интерфейсах и средствах пакетной службы](batch-apis-tools.md) для сборки решений пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-721">Learn about the [Batch APIs and tools](batch-apis-tools.md) available for building Batch solutions.</span></span>
* <span data-ttu-id="04d9d-722">Ознакомьтесь с пошаговой инструкцией по созданию примера приложения пакетной службы в статье [Начало работы с библиотекой пакетной службы Azure для .NET](batch-dotnet-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="04d9d-722">Walk through a sample Batch application step-by-step in [Get started with the Azure Batch Library for .NET](batch-dotnet-get-started.md).</span></span> <span data-ttu-id="04d9d-723">Существует также [версия Python](batch-python-tutorial.md) этого руководства. В ней рассматривается выполнение рабочих нагрузок на вычислительных узлах Linux.</span><span class="sxs-lookup"><span data-stu-id="04d9d-723">There is also a [Python version](batch-python-tutorial.md) of the tutorial that runs a workload on Linux compute nodes.</span></span>
* <span data-ttu-id="04d9d-724">Скачайте и соберите пример проекта [обозревателя пакетной службы][github_batchexplorer], который вы сможете использовать при разработке собственных решений пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-724">Download and build the [Batch Explorer][github_batchexplorer] sample project for use while you develop your Batch solutions.</span></span> <span data-ttu-id="04d9d-725">С помощью обозревателя пакетной службы вы можете выполнять множество операций, в частности:</span><span class="sxs-lookup"><span data-stu-id="04d9d-725">Using the Batch Explorer, you can perform the following and more:</span></span>

  * <span data-ttu-id="04d9d-726">отслеживать и изменять работу пулов, заданий и задач в своей учетной записи пакетной службы;</span><span class="sxs-lookup"><span data-stu-id="04d9d-726">Monitor and manipulate pools, jobs, and tasks within your Batch account</span></span>
  * <span data-ttu-id="04d9d-727">загружать с узлов файлы `stdout.txt`, `stderr.txt` или любые другие;</span><span class="sxs-lookup"><span data-stu-id="04d9d-727">Download `stdout.txt`, `stderr.txt`, and other files from nodes</span></span>
  * <span data-ttu-id="04d9d-728">создавать на узлах пользователей и загружать RDP-файлы для удаленного входа.</span><span class="sxs-lookup"><span data-stu-id="04d9d-728">Create users on nodes and download RDP files for remote login</span></span>
* <span data-ttu-id="04d9d-729">Узнайте, как [создавать пулы вычислительных узлов Linux](batch-linux-nodes.md).</span><span class="sxs-lookup"><span data-stu-id="04d9d-729">Learn how to [create pools of Linux compute nodes](batch-linux-nodes.md).</span></span>
* <span data-ttu-id="04d9d-730">Посетите [форум по пакетной службе Azure][batch_forum] на сайте MSDN.</span><span class="sxs-lookup"><span data-stu-id="04d9d-730">Visit the [Azure Batch forum][batch_forum] on MSDN.</span></span> <span data-ttu-id="04d9d-731">Здесь могут задавать вопросы как начинающие, так и опытные пользователи пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="04d9d-731">The forum is a good place to ask questions, whether you are just learning or are an expert in using Batch.</span></span>

[1]: ./media/batch-api-basics/node-folder-structure.png

[azure_storage]: https://azure.microsoft.com/services/storage/
[batch_forum]: https://social.msdn.microsoft.com/Forums/en-US/home?forum=azurebatch
[cloud_service_sizes]: ../cloud-services/cloud-services-sizes-specs.md
[msmpi]: https://msdn.microsoft.com/library/bb524831.aspx
[github_samples]: https://github.com/Azure/azure-batch-samples
[github_sample_taskdeps]:  https://github.com/Azure/azure-batch-samples/tree/master/CSharp/ArticleProjects/TaskDependencies
[github_batchexplorer]: https://github.com/Azure/azure-batch-samples/tree/master/CSharp/BatchExplorer
[batch_net_api]: https://msdn.microsoft.com/library/azure/mt348682.aspx
[msdn_env_vars]: https://msdn.microsoft.com/library/azure/mt743623.aspx
[net_cloudjob_jobmanagertask]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudjob.jobmanagertask.aspx
[net_cloudjob_priority]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudjob.priority.aspx
[net_cloudpool_starttask]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudpool.starttask.aspx
[net_cloudtask_env]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudtask.environmentsettings.aspx
[net_create_cert]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.certificateoperations.createcertificate.aspx
[net_create_user]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.computenode.createcomputenodeuser.aspx
[net_getfile_node]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.computenode.getnodefile.aspx
[net_getfile_task]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudtask.getnodefile.aspx
[net_job_env]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudjob.commonenvironmentsettings.aspx
[net_multiinstancesettings]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.multiinstancesettings.aspx
[net_onalltaskscomplete]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudjob.onalltaskscomplete.aspx
[net_rdp]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.computenode.getrdpfile.aspx
[net_reboot]: https://msdn.microsoft.com/library/azure/mt631495.aspx
[net_reimage]: https://msdn.microsoft.com/library/azure/mt631496.aspx
[net_remove]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.pooloperations.removefrompoolasync.aspx
[net_offline]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.computenode.disableschedulingasync.aspx
[net_online]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.computenode.enableschedulingasync.aspx
[net_offline_option]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.common.disablecomputenodeschedulingoption.aspx
[net_rdpfile]: https://msdn.microsoft.com/library/azure/Mt272127.aspx
[vnet]: https://msdn.microsoft.com/library/azure/dn820174.aspx#bk_netconf

[py_add_user]: http://azure-sdk-for-python.readthedocs.io/en/latest/ref/azure.batch.operations.html#azure.batch.operations.ComputeNodeOperations.add_user

[batch_rest_api]: https://msdn.microsoft.com/library/azure/Dn820158.aspx
[rest_add_job]: https://msdn.microsoft.com/library/azure/mt282178.aspx
[rest_add_pool]: https://msdn.microsoft.com/library/azure/dn820174.aspx
[rest_add_cert]: https://msdn.microsoft.com/library/azure/dn820169.aspx
[rest_add_task]: https://msdn.microsoft.com/library/azure/dn820105.aspx
[rest_create_user]: https://msdn.microsoft.com/library/azure/dn820137.aspx
[rest_get_task_info]: https://msdn.microsoft.com/library/azure/dn820133.aspx
[rest_job_schedules]: https://msdn.microsoft.com/library/azure/mt282179.aspx
[rest_multiinstance]: https://msdn.microsoft.com/library/azure/mt637905.aspx
[rest_multiinstancesettings]: https://msdn.microsoft.com/library/azure/dn820105.aspx#multiInstanceSettings
[rest_update_job]: https://msdn.microsoft.com/library/azure/dn820162.aspx
[rest_rdp]: https://msdn.microsoft.com/library/azure/dn820120.aspx
[rest_reboot]: https://msdn.microsoft.com/library/azure/dn820171.aspx
[rest_reimage]: https://msdn.microsoft.com/library/azure/dn820157.aspx
[rest_remove]: https://msdn.microsoft.com/library/azure/dn820194.aspx
[rest_offline]: https://msdn.microsoft.com/library/azure/mt637904.aspx
[rest_online]: https://msdn.microsoft.com/library/azure/mt637907.aspx

[vm_marketplace]: https://azure.microsoft.com/marketplace/virtual-machines/
