---
title: "aaaRun Azure пакетных заданий конца в конец без написания кода (Предварительная версия) | Документы Microsoft"
description: "Создайте файлы шаблонов для hello Azure CLI toocreate пакета пулы, заданий и задач."
services: batch
author: mscurrell
manager: timlt
ms.assetid: 
ms.service: batch
ms.devlang: na
ms.topic: article
ms.workload: big-compute
ms.date: 07/20/2017
ms.author: markscu
ms.openlocfilehash: c0434d09766451f6ba516efbad949834711ee819
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="use-azure-batch-cli-templates-and-file-transfer-preview"></a>Использование шаблонов интерфейса командной строки для пакетной службы Azure и передачи файлов (предварительная версия)

При помощи hello Azure CLI можно возможных toorun пакетных заданий без написания кода.

Файлы шаблонов можно создать и использовать с hello Azure CLI, разрешить пулы, задания и toobe задачи создания пакета. Задание входных файлов можно легко загрузить учетную запись хранилища hello, связанную с hello пакетной учетной записи и задание выходные файлы загружаются.

## <a name="overview"></a>Обзор

Расширение toohello Azure CLI позволяет пакета используется toobe-законченный пользователями, которые не являются разработчиками. Можно создать пул, передачи входных данных задания и связанные с ними задачи создания и CLI hello hello результирующие выходные данные загружаются — код не требуется, используются непосредственно, или нужно интегрировать в сценарии.

Построение пакета шаблоны на hello [существующего пакета поддержки в hello Azure CLI](https://docs.microsoft.com/azure/batch/batch-cli-get-started#json-files-for-resource-creation) JSON-файлов, позволяющий toospecify значения свойств для создания hello пулы, заданий, задач и других элементов. С помощью шаблонов пакета hello следующие возможности добавляются по возможности файлы hello JSON:

-   Возможность определять параметры. При использовании шаблона hello только значения параметра hello, элемента указанного toocreate hello и другие значения свойства элемента, указанными в тексте hello шаблона. Пользователь, который понимает, что пакет и toobe приложения выполнялись пакета можно создать шаблоны, указывая пул, задания и значения свойств задачи. Пользователю меньше знакомые с приложениями и пакете достаточно toospecify hello значения для параметров определенных hello.

-   Для многих toobe определения задач создания и значительно упрощения процесса отправки заданий создания фабрики задач задания или дополнительные задачи, связанные с заданием, как избежать hello.


Файлы входные данные должны toobe, указанное для задания, и часто создаваемых выходных файлов данных. Связанные учетной записи хранения по умолчанию, при этом каждый пакет учетной записи и файлы могут быть легко переносятся tooand с этой учетной записи хранилища, используя интерфейс командной строки, без написания кода и необходимые без учетных данных хранилища.

Например, [ffmpeg](http://ffmpeg.org/) — это популярное приложение, которое обрабатывает аудио- и видеофайлы. Hello Azure CLI пакета может быть используется tooinvoke ffmpeg tootranscode источника видеофайлов toodifferent способы их устранения.

-   Создается шаблон пула. Создание шаблона hello пользователя Hello знает, как toocall hello ffmpeg приложения и его требования; они задают hello соответствующие операционной системы, ВМ размер, как ffmpeg установлен (из пакета приложения или с помощью диспетчера пакетов, например) и другие значения свойств пула. Поэтому при использовании шаблона hello только идентификатор пула hello и число виртуальных машин требуется toobe указан, создаются параметры.

-   Создается шаблон задания. Создание шаблона hello Hello пользователя знает, как вызывается tootranscode источник видео tooa другое разрешение toobe ffmpeg потребностей и указывает hello задачи командной строки; они также показывает, что папка, содержащая hello источника видеофайлов, с задачей, которая требуется для каждого входного файла.

-   Пользователь с набором tootranscode видеофайлов сначала создает пул с помощью шаблона пула hello, указав только идентификатор пула hello и число необходимых виртуальных машин. Их можно будет передать файлы tootranscode hello источника. Затем можно отправить задание с помощью шаблона задания hello, указав только идентификатор пула hello и загруженных файлов источника hello. Hello пакетное задание создается с одну задачу на создаваемый входного файла. Наконец Привет перекодировать выходные файлы можно загрузить.

## <a name="installation"></a>Установка

возможности передачи шаблон и файл Hello требуют toobe модуль установлен.

Инструкции по tooinstall hello Azure CLI. в статье [установить CLI Azure 2.0](https://docs.microsoft.com/cli/azure/install-azure-cli).

Один раз приветствия установил Azure CLI hello пакета могут быть установлены расширения с помощью следующей команды CLI:

```azurecli
az component update --add batch-extensions --allow-third-party
```

Дополнительные сведения о hello пакета расширения в разделе [Microsoft Azure пакета CLI расширения для Windows, Mac и Linux](https://github.com/Azure/azure-batch-cli-extensions#microsoft-azure-batch-cli-extensions-for-windows-mac-and-linux).

## <a name="templates"></a>Шаблоны

Hello Azure CLI пакета позволяет пулы, заданий и toobe задачи, созданные путем указания JSON-файл, содержащий имена и значения свойств. Например:

```azurecli
az batch pool create –-json-file AppPool.json
```

Шаблоны пакета Azure являются похожих шаблонов диспетчера ресурсов tooAzure в функции и синтаксис. Они представляют собой файлы JSON содержат элемент имена и значения свойств, но добавить hello следующих основных понятиях:

-   **Параметры**

    -   Разрешить toobe значения свойства, указанный в разделе "текст", со значениями параметров, создающие toobe, предоставленный при использовании шаблона hello. Например полное определение hello в пуле может быть размещен в тексте hello и только один параметр, определенных для идентификатора пула; только строка идентификатора пула таким образом, необходим toocreate toobe указан пул.
        
    -   текста Hello шаблона могут быть созданы пользователем, имеющим базы знаний пакета и toobe приложения hello выполнялись пакета; При использовании шаблона hello, необходимо указать только значения для параметров, определенных автором hello. Пользователь без hello подробные пакета и/или базы знаний приложения таким образом можно использовать шаблоны.

-   **Переменные**

    -   Разрешить простые или сложные параметр toobe значения, указанные в одном месте и используются в одной или нескольких частях текста hello шаблона. Переменные можно упростить и сократить размер hello hello шаблона, а также сделать его более простого в сопровождении, задав одно расположение toochange свойства, значение которого может измениться.

-   **Конструкции более высокого уровня**

    -   Некоторые конструкции более высокого уровня, доступные в hello шаблон, который еще не доступны в API-интерфейсы пакета hello. Например в шаблоне задания, который создает несколько задач для hello задания с помощью общего определения задач можно определить фабрики задач. Эти конструкции избежать toocode необходимость hello динамически создать несколько файлов JSON, например, один файл для каждой задачи, а также создать скрипт, файлы приложений tooinstall через диспетчер пакетов, например.

    -   Некоторые точки, где применимо, возможно, эти конструкции добавлена toothe пакета службы и доступен в hello API-интерфейсы пакета, пользовательских интерфейсов, и т. д.

### <a name="pool-templates"></a>Шаблоны пула

Кроме возможности стандартных шаблонов toohello параметров и переменных, hello следующие высокоуровневые конструкции поддерживаются hello пула шаблон:

-   **Ссылки на пакет**

    -   При необходимости менеджеры узлы toopool toobe копирования программного обеспечения с помощью пакета. указаны диспетчера пакетов Hello и идентификатор пакета. Может toodeclare, один или несколько пакетов позволяет избежать необходимости hello toocreate сценарий, который возвращает hello необходимые пакеты, hello скрипт установки и запустить скрипт hello на каждом узле пула.

следующие Hello состоит в том пример шаблона, который используется для создания пула виртуальных машин Linux с ffmpeg установлены и только требует пула идентификатор строки и hello ряд toouse toobe предоставленный виртуальных машин:

```json
{
    "parameters": {
        "nodeCount": {
            "type": "int",
            "metadata": {
                "description": "hello number of pool nodes"
            }
        },
        "poolId": {
            "type": "string",
            "metadata": {
                "description": "hello pool id "
            }
        }
    },
    "pool": {
        "type": "Microsoft.Batch/batchAccounts/pools",
        "apiVersion": "2016-12-01",
        "properties": {
            "id": "[parameters('poolId')]",
            "virtualMachineConfiguration": {
                "imageReference": {
                    "publisher": "Canonical",
                    "offer": "UbuntuServer",
                    "sku": "16.04.0-LTS",
                    "version": "latest"
                },
                "nodeAgentSKUId": "batch.node.ubuntu 16.04"
            },
            "vmSize": "STANDARD_D3_V2",
            "targetDedicatedNodes": "[parameters('nodeCount')]",
            "enableAutoScale": false,
            "maxTasksPerNode": 1,
            "packageReferences": [
                {
                    "type": "aptPackage",
                    "id": "ffmpeg"
                }
            ]
        }
    }
}
```

Если файл шаблона hello назывался _ffmpeg.json пула_, то шаблон hello будет вызываться, как показано ниже:

```azurecli
az batch pool create --template pool-ffmpeg.json
```

### <a name="job-templates"></a>Шаблоны задания

Кроме возможности стандартных шаблонов toohello параметров и переменных, hello следующие высокоуровневые конструкции поддерживаются hello шаблона задания:

-   **Фабрика задач**

    -   Создает несколько задач для одного задания, используя одно определение задачи. Поддерживается три типа фабрики задач: параметрический анализ, "по одной задаче на файл" и коллекция задач.

Hello ниже приведен пример шаблона, который создает задание, которое использует ffmpeg для перекодирования tooone видеофайлов MP4 из низких разрешениях с одной задачи, создаваемых в исходный файл:

```json
{
    "parameters": {
        "poolId": {
            "type": "string",
            "metadata": {
                "description": "hello name of Azure Batch pool which runs hello job"
            }
        },
        "jobId": {
            "type": "string",
            "metadata": {
                "description": "hello name of Azure Batch job"
            }
        },
        "resolution": {
            "type": "string",
            "defaultValue": "428x240",
            "allowedValues": [
                "428x240",
                "854x480"
            ],
            "metadata": {
                "description": "Target video resolution"
            }
        }
    },
    "job": {
        "type": "Microsoft.Batch/batchAccounts/jobs",
        "apiVersion": "2016-12-01",
        "properties": {
            "id": "[parameters('jobId')]",
            "constraints": {
                "maxWallClockTime": "PT5H",
                "maxTaskRetryCount": 1
            },
            "poolInfo": {
                "poolId": "[parameters('poolId')]"
            },
            "taskFactory": {
                "type": "taskPerFile",
                "source": { 
                    "fileGroup": "ffmpeg-input"
                },
                "repeatTask": {
                    "commandLine": "ffmpeg -i {fileName} -y -s [parameters('resolution')] -strict -2 {fileNameWithoutExtension}_[parameters('resolution')].mp4",
                    "resourceFiles": [
                        {
                            "blobSource": "{url}",
                            "filePath": "{fileName}"
                        }
                    ],
                    "outputFiles": [
                        {
                            "filePattern": "{fileNameWithoutExtension}_[parameters('resolution')].mp4",
                            "destination": {
                                "autoStorage": {
                                    "path": "{fileNameWithoutExtension}_[parameters('resolution')].mp4",
                                    "fileGroup": "ffmpeg-output"
                                }
                            },
                            "uploadOptions": {
                                "uploadCondition": "TaskSuccess"
                            }
                        }
                    ]
                }
            },
            "onAllTasksComplete": "terminatejob"
        }
    }
}
```

Если файл шаблона hello назывался _ffmpeg.json задания_, то шаблон hello будет вызываться, как показано ниже:

```azurecli
az batch job create --template job-ffmpeg.json
```

## <a name="file-groups-and-file-transfer"></a>Группы файлов и передача файлов

Большинство заданий и задач принимают входные файлы и создают выходные файлы. Как входные файлы и выходные файлы обычно требуется toobe, переданных из узла toohello hello клиента или от клиента toohello узел hello. Hello Azure CLI пакета расширения абстрагирует передача размещения файлов и использует hello учетной записи хранилища, создаваемый по умолчанию для каждой учетной записи пакета.

Файловая группа по алгоритму tooa контейнер, который создается в hello учетной записи хранилища Azure. Hello файловая группа может содержать вложенные папки.

Hello CLI пакета расширения предоставляет команды для отправки файлов из клиента tooa указанной файловой группе и загрузку файлов из группы tooa hello указанного файла клиента.

```azurecli
az batch file upload --local-path c:\source_videos\*.mp4 
    --file-group ffmpeg-input

az batch file download --file-group ffmpeg-output --local-path
    c:\output_lowres_videos
```

Отключение пула узлы возврат tooa файловой группы или пула и задание шаблоны позволяют файлы, хранящиеся в toobe групп файл, заданный для копирования на узлах пула. Например в шаблоне задания, указанный ранее, hello файл группы «ffmpeg-input» указан для hello фабрики задач как hello расположения файлов видео источника hello, записанное на узле hello для перекодирования; Hello файл группы «ffmpeg выход», используются как hello места, где Привет перекодировать выходные файлы скопированы toofrom hello узел под управлением каждой задачи.

## <a name="summary"></a>Сводка

Шаблон и файл поддержки в данный момент были добавлены только toohello Azure CLI. Задача Hello — tooexpand hello аудитории, можно использовать toousers пакета, который не обязательно toodevelop кода, с помощью hello пакетных API, например исследователей, ИТ-пользователи и т. д. Без кодирования, пользователи, знакомые с Azure, пакета и toobe приложения hello выполнялись пакета можно создавать шаблоны для создания пула и задания. С параметрами шаблона пользователи, не зная пакета и hello приложений можно использовать шаблоны hello.

Испытайте hello пакета расширения для hello Azure CLI, а также получить любые отзывы и предложения, либо в hello комментарии для данной статьи или с помощью hello [форум по пакетной службы Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=azurebatch).

## <a name="next-steps"></a>Дальнейшие действия

- См. hello пакета шаблоны блога: [заданий запущен пакетной службы Azure с помощью hello Azure CLI — код не требуется](https://azure.microsoft.com/en-us/blog/running-azure-batch-jobs-using-the-azure-cli-no-code-required/).
- Подробную документацию по установке и использовании, образцы и исходного кода доступны в hello [репозитории Azure GitHub](https://github.com/Azure/azure-batch-cli-extensions).
