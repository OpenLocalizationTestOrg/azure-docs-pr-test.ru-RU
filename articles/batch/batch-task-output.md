---
title: "Сохранение результатов или журналов из завершенных заданий и задач в хранилище данных — пакетная служба Azure | Документы Майкрософт"
description: "Дополнительные сведения о различных параметрах для сохранения выходных данных из пакетных задач и заданий. Вы можете сохранить данные в службе хранилища Azure или в другом хранилище данных."
services: batch
author: tamram
manager: timlt
editor: 
ms.assetid: 16e12d0e-958c-46c2-a6b8-7843835d830e
ms.service: batch
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: big-compute
ms.date: 06/16/2017
ms.author: tamram
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 3ca93e823f02b1483ed290cf89de191937d1e2c3
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="persist-job-and-task-output"></a>Сохранение пакетных заданий и выходных данных задач

[!INCLUDE [batch-task-output-include](../../includes/batch-task-output-include.md)]

К типичным примерам выходных данных задачи относятся:

- файлы, созданные при обработке задачей входных данных;
- файлы журналов, сопоставленные с выполнением задачи. 

Эта статья описывает различные параметры для сохранения выходных данных задач, а также сценарии, для которых лучше всего подходит каждый из параметров.   

## <a name="about-the-batch-file-conventions-standard"></a>Сведения о стандарте соглашений по пакетным файлам

Пакет определяет дополнительный набор соглашений для именования выходных файлов задач в службе хранилища Azure. Эти соглашения описаны в [стандарте соглашений по пакетным файлам](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions). Стандарт соглашений об именовании файлов определяет имя целевого контейнера и путь к BLOB-объекту в службе хранилища Azure для заданного выходного файла на основе имен задания и задачи.

Вы сами решаете, нужно ли использовать стандарт соглашений по файлам для именования файлов выходных данных. Вы также можете назначить целевому контейнеру и BLOB-объекту любое подходящее имя. Если для назначения имен выходным файлам используется стандарт соглашений об именовании файлов, то выходные файлы доступны для просмотра на [портале Azure][portal].

Стандарт соглашений по файлам можно использовать несколькими разными способами:

- Если для сохранения выходных файлов вы используете API пакетной службы, можно настроить именование целевых контейнеров и BLOB-объектов согласно стандарту соглашений по файлам. API пакетной службы позволяет сохранять выходные файлы из клиентского кода, не изменяя приложение задачи.
- При работе на платформе .NET можно использовать [библиотеку соглашений о пакетных файлах Azure для .NET][nuget_package]. Преимущество использования этой библиотеки заключается в том, что она поддерживает запросы к выходным файлам по их идентификатору или назначению. Встроенные функции запросов упрощают доступ к выходным файлам из клиентского приложения или из других задач. Однако для вызова указанной библиотеки требуется изменить приложение задачи. Дополнительные сведения см. в справочнике по [библиотеке соглашений о файлах для .NET](https://msdn.microsoft.com/library/microsoft.azure.batch.conventions.files.aspx).
- При работе на языке, отличном от .NET, можно реализовать в приложении стандарт соглашений об именовании файлов.

## <a name="design-considerations-for-persisting-output"></a>Рекомендации по проектированию сохраняемых выходных данных 

При разработке решения пакетной обработки нужно учесть несколько приведенных ниже факторов, связанных с выходными данными заданий и задач.

* **Время существования вычислительного узла.** Нередко вычислительные узлы являются временными, особенно в пулах с поддержкой автомасштабирования. Выходные данные задачи, которая выполняется на узле, доступны, только пока этот узел существует и только в течение периода хранения файлов, заданного для задачи. Если задача создает выходные данные, которые могут понадобиться после ее завершения, задача должна отправить их в долговременное хранилище, например службу хранилища Azure.

* **Хранилище выходных данных**. В качестве хранилища выходных данных задачи рекомендуется использовать службу хранилища Azure, но подойдет и любое долговременное хранилище. Функция записи выходных данных задачи в службу хранилища Azure интегрирована в API пакетной службы. Если используется другое долговременное хранилище, вам потребуется написать логику приложения для самостоятельного сохранения выходных данных задач.   

* **Извлечение выходных данных**. Выходные данные задачи, если они сохраняются, можно получить непосредственно с вычислительных узлов в пуле либо из службы хранилища Azure или другого хранилища данных. Чтобы получить выходные данные задачи непосредственно от вычислительных узлов, необходимо знать имя файла и расположение его выходных данных на узле. Если выходные данные задачи сохраняются в службе хранилища Azure, потребуется полный путь к файлу в этой службе, чтобы скачивать подобные файлы с помощью пакета SDK службы хранилища Azure.

* **Просмотр выходных данных.** Если перейти к задаче пакетной службы на портале Azure и щелкнуть **Файлы на узле**, отобразятся все файлы, связанные с задачей, а не только интересующие вас выходные файлы. Опять же, файлы на вычислительных узлах доступны, только пока узел существует и только в течение периода хранения файлов, заданного для задачи. Чтобы просмотреть выходные данные задачи, сохраненные в службе хранилища Azure, можно воспользоваться порталом Azure или клиентским приложением этой службы, например [Azure Storage Explorer][storage_explorer]. Чтобы просмотреть выходные данные в службе хранилища Azure с портала или из другого средства, нужно знать расположение файла и перейти напрямую к нему.

## <a name="options-for-persisting-output"></a>Способы сохранения выходных данных

В зависимости от сценария существует несколько способов для сохранения выходных данных задач:

- Использование API пакетной службы.  
- Использование библиотеки соглашений по пакетным файлам для .NET.  
- Реализация стандарта соглашений по пакетным файлам в приложении.
- Реализация пользовательского решения для перемещения файлов.

В следующих каждый из этих сценариев описан более подробно.

### <a name="use-the-batch-service-api"></a>Использование API пакетной службы

Начиная с версии 2017-05-01, пакетная служба поддерживает указание выходных файлов в службе хранилища Azure для данных задачи при [добавлении отдельной задачи](https://docs.microsoft.com/rest/api/batchservice/add-a-task-to-a-job) или [их коллекции](https://docs.microsoft.com/rest/api/batchservice/add-a-collection-of-tasks-to-a-job) в задание.

API пакетной службы поддерживает сохранение данных задачи в учетной записи службы хранилища Azure из пулов, созданных с конфигурацией виртуальной машины. С помощью API пакетной службы можно сохранить данные задачи, не изменяя выполняемое этой задачей приложение. При именовании файлов, сохраняемых в службе хранилища Azure, можно придерживаться [стандарта соглашений по пакетным файлам](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions). 

Используйте API пакетной службы для сохранения выходных данных задач в следующих случаях:

- Требуется сохранить данные задач пакетной службы и задач диспетчера заданий в пулах, созданных с конфигурацией виртуальной машины.
- Требуется сохранить данные в контейнер службы хранилища Azure с произвольным именем.
- Требуется сохранить выходные данные в контейнер службы хранилища Azure в соответствии со [стандартом соглашений по пакетным файлам](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions). 

> [!NOTE]
> API пакетной службы не поддерживает сохранение данных из задач, которые выполняются в пулах, созданных с конфигурацией облачной службы. Дополнительные сведения о сохранении выходных данных задач из пулов, использующих конфигурацию облачных служб, см. в разделе [Сохранение данных заданий и задач в службе хранилища Azure с помощью библиотеки соглашений о пакетных файлах для .NET](batch-task-output-file-conventions.md).
> 
> 

Дополнительные сведения о сохранении выходных данных задач с помощью API пакетной службы см. в разделе [Сохранение данных для задач в службе хранилища Azure с помощью API пакетной службы](batch-task-output-files.md). Кроме того, ознакомьтесь с примером проекта [PersistOutputs][github_persistoutputs] на GitHub, который показывает, как использовать клиентскую библиотеку пакетной службы для .NET, чтобы сохранять выходные данные задач в долговременном хранилище.

### <a name="use-the-batch-file-conventions-library-for-net"></a>Использование библиотеки соглашений по пакетным файлам для .NET

Разработчики, создающие пакетные решения с помощью C# и .NET, могут использовать [библиотеку соглашений по файлам для .NET][nuget_package], чтобы сохранять данные задач в учетной записи службы хранилища Azure согласно [стандарту соглашений по пакетным файлам](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions). Библиотека соглашений по файлам обрабатывает перемещение выходных файлов в службу хранилища Azure, а также именование целевых контейнеров и BLOB-объектов хорошо известным образом.

Библиотека соглашений по файлам поддерживает выполнение запросов для выходных файлов по идентификатору или назначению, что позволяет легко находить их без составления URI файлов. 

Используйте библиотеку соглашений по пакетным файлам для .NET для сохранения выходных данных задач в следующих случаях:

- Требуется обеспечить потоковую передачу данных в службу хранилища Azure, пока выполняется задача.
- Требуется сохранить данные из пулов, созданных с конфигурацией облачной службы или конфигурации виртуальной машины.
- Клиентское приложение или другие задачи в задании должны находить и скачивать выходные файлы задачи по идентификатору или назначению. 
- Требуется выполнить сохранение по контрольным точкам или предварительную отправку начальных результатов.
- Требуется просмотреть выходные данные задачи на портале Azure.

Дополнительные сведения о сохранении выходных данных задачи с помощью библиотеки соглашений по файлам для .NET см. в разделе [Сохранение данных заданий и задач в службе хранилища Azure с помощью библиотеки соглашений о пакетных файлах для .NET](batch-task-output-file-conventions.md). Кроме того, ознакомьтесь с примером проекта [PersistOutputs][github_persistoutputs] на GitHub, который показывает, как использовать библиотеку соглашений по файлам для .NET, чтобы сохранять выходные данные задач в долговременном хранилище.

Ознакомьтесь с примером проекта [PersistOutputs][github_persistoutputs] на GitHub, который показывает, как использовать клиентскую библиотеку пакетной службы для .NET, чтобы сохранять выходные данные задач в долговременном хранилище.

### <a name="implement-the-batch-file-conventions-standard"></a>Реализация стандарта соглашений по пакетным файлам

При работе на языке, отличном от .NET, можно реализовать в приложении [стандарт соглашений по пакетным файлам](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions). 

Это может быть уместным, когда требуется проверенная схема именования или нужно просматривать выходные данные задач на портале Azure.

### <a name="implement-a-custom-file-movement-solution"></a>Реализация пользовательского решения для перемещения файлов

Вы также можете реализовать собственное полноценное решение для перемещения файлов. Такой подход применим в следующих случаях:

- Требуется сохранить данные задачи в хранилище данных, отличном от службы хранилища Azure. Чтобы отправить файлы в хранилище данных, например Azure SQL или Azure DataLake, можно создать настраиваемый скрипт или исполняемый файл. Затем его можно вызвать в командной строке после запуска основного исполняемого файла. Например, на узле Windows можно вызывать две следующие команды:`doMyWork.exe && uploadMyFilesToSql.exe`
- Требуется выполнить сохранение по контрольным точкам или предварительную отправку начальных результатов.
- Требуется детально управлять обработкой ошибок. Например, может возникнуть потребность в собственном решении, когда нужно использовать действия зависимостей задач для выполнения определенных операций отправки на основе кодов выхода конкретной задачи. Дополнительные сведения о действиях зависимостей задач см. в разделе [Создание зависимостей для выполнения задач, которые зависят от других задач](batch-task-dependencies.md). 

## <a name="next-steps"></a>Дальнейшие действия

- Познакомьтесь с новыми функциями в API пакетной службы, предназначенными для сохранения данных задачи, в разделе [Сохранение данных для задач в службе хранилища Azure с помощью API пакетной службы](batch-task-output-files.md).
- Дополнительные сведения об использовании библиотеки соглашений по пакетным файлам для .NET см. в разделе [Сохранение данных заданий и задач в службе хранилища Azure с помощью библиотеки соглашений о пакетных файлах для .NET](batch-task-output-file-conventions.md).
- Ознакомьтесь с примером проекта [PersistOutputs][github_persistoutputs] на GitHub, который показывает, как использовать клиентскую библиотеку пакетной службы и библиотеку соглашений по файлам для .NET, чтобы сохранять выходные данные задач в долговременном хранилище.

[nuget_package]: https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files
[portal]: https://portal.azure.com
[storage_explorer]: http://storageexplorer.com/
