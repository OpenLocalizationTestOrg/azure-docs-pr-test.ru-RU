---
title: "Создание пакета решения с помощью шаблонов проектов Visual Studio - Azure aaaStart | Документы Microsoft"
description: "Узнайте, как шаблоны проектов Visual Studio помогут реализовать и выполнить ресурсоемкие рабочие нагрузки в пакетной службе Azure."
services: batch
documentationcenter: .net
author: fayora
manager: timlt
editor: 
ms.assetid: 5e041ae2-25af-4882-a79e-3aa63c4bfb20
ms.service: batch
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: big-compute
ms.date: 02/27/2017
ms.author: tamram
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: a61c480ddc4dffd66c01220a137a3e852e39c338
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="use-visual-studio-project-templates-toojump-start-batch-solutions"></a><span data-ttu-id="ecbea-103">Использование решений пакета toojump начала шаблоны проекта Visual Studio</span><span class="sxs-lookup"><span data-stu-id="ecbea-103">Use Visual Studio project templates toojump-start Batch solutions</span></span>

<span data-ttu-id="ecbea-104">Hello **диспетчера заданий** и **шаблонов Visual Studio задач процессора** для пакета предоставляют toohelp кода вы tooimplement и выполнения ресурсоемких рабочих нагрузок в пакете с hello бы трудозатрат.</span><span class="sxs-lookup"><span data-stu-id="ecbea-104">hello **Job Manager** and **Task Processor Visual Studio templates** for Batch provide code toohelp you tooimplement and run your compute-intensive workloads on Batch with hello least amount of effort.</span></span> <span data-ttu-id="ecbea-105">В этом документе описываются эти шаблоны и руководство toouse их.</span><span class="sxs-lookup"><span data-stu-id="ecbea-105">This document describes these templates and provides guidance for how toouse them.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ecbea-106">В этой статье рассматриваются только сведения применимо toothese двух шаблонов и предполагает, что вы знакомы с пакетной службы hello и связанные tooit основные понятия: пулы, вычислительные узлы, заданий и задач, задачи диспетчера заданий, переменные среды и другие важные сведения.</span><span class="sxs-lookup"><span data-stu-id="ecbea-106">This article discusses only information applicable toothese two templates, and assumes that you are familiar with hello Batch service and key concepts related tooit: pools, compute nodes, jobs and tasks, job manager tasks, environment variables, and other relevant information.</span></span> <span data-ttu-id="ecbea-107">Можно найти дополнительные сведения в [основы пакета Azure](batch-technical-overview.md), [пакета Обзор возможностей для разработчиков](batch-api-basics.md), и [начало работы с библиотекой hello пакетной службы Azure для .NET](batch-dotnet-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="ecbea-107">You can find more information in [Basics of Azure Batch](batch-technical-overview.md), [Batch feature overview for developers](batch-api-basics.md), and [Get started with hello Azure Batch library for .NET](batch-dotnet-get-started.md).</span></span>
> 
> 

## <a name="high-level-overview"></a><span data-ttu-id="ecbea-108">Общий обзор</span><span class="sxs-lookup"><span data-stu-id="ecbea-108">High-level overview</span></span>
<span data-ttu-id="ecbea-109">Hello диспетчера заданий и задач обработчика шаблоны могут быть toocreate используется два полезных компонентов:</span><span class="sxs-lookup"><span data-stu-id="ecbea-109">hello Job Manager and Task Processor templates can be used toocreate two useful components:</span></span>

* <span data-ttu-id="ecbea-110">Задачу диспетчера заданий, позволяющую внедрить разделитель заданий. Благодаря ему можно разбить задание на несколько задач, которые могут выполняться независимо в параллельном режиме.</span><span class="sxs-lookup"><span data-stu-id="ecbea-110">A job manager task that implements a job splitter that can break a job down into multiple tasks that can run independently, in parallel.</span></span>
* <span data-ttu-id="ecbea-111">Процессор задачи, который может быть используется tooperform предварительной обработки и последующей обработки вокруг приложения командной строки.</span><span class="sxs-lookup"><span data-stu-id="ecbea-111">A task processor that can be used tooperform pre-processing and post-processing around an application command line.</span></span>

<span data-ttu-id="ecbea-112">Например в случае подготовки к просмотру фильма hello задания разделителей будет превратить задания одного фильма в сотен или тысяч отдельные задачи, которые будут обрабатывать отдельные кадры отдельно.</span><span class="sxs-lookup"><span data-stu-id="ecbea-112">For example, in a movie rendering scenario, hello job splitter would turn a single movie job into hundreds or thousands of separate tasks that would process individual frames separately.</span></span> <span data-ttu-id="ecbea-113">Соответственно обработчика задач hello бы вызвать hello отрисовки приложения и все зависимые процессы, необходимые toorender каждого кадра, а также выполнять каких-либо дополнительных действий (например, копирование hello к просмотру кадра tooa место хранения).</span><span class="sxs-lookup"><span data-stu-id="ecbea-113">Correspondingly, hello task processor would invoke hello rendering application and all dependent processes that are needed toorender each frame, as well as perform any additional actions (for example, copying hello rendered frame tooa storage location).</span></span>

> [!NOTE]
> <span data-ttu-id="ecbea-114">шаблоны диспетчера заданий и задач процессора Hello независимо друг от друга, поэтому вы можете выбрать toouse, оба или только один из них, в зависимости от требований hello задания вычислений и настройками.</span><span class="sxs-lookup"><span data-stu-id="ecbea-114">hello Job Manager and Task Processor templates are independent of each other, so you can choose toouse both, or only one of them, depending on hello requirements of your compute job and on your preferences.</span></span>
> 
> 

<span data-ttu-id="ecbea-115">Как показано в приведенной ниже схеме hello вычислительного задания, использующего эти шаблоны проходит через три этапа:</span><span class="sxs-lookup"><span data-stu-id="ecbea-115">As shown in hello diagram below, a compute job that uses these templates will go through three stages:</span></span>

1. <span data-ttu-id="ecbea-116">Hello клиентский код (например, приложения, веб-службы, т. д.) отправляет задание toohello пакетной службы в Azure, указав в качестве его задание диспетчера задач hello manager программе задания.</span><span class="sxs-lookup"><span data-stu-id="ecbea-116">hello client code (e.g., application, web service, etc.) submits a job toohello Batch service on Azure, specifying as its job manager task hello job manager program.</span></span>
2. <span data-ttu-id="ecbea-117">Hello пакетная служба запускает hello задачи диспетчера заданий на вычислительном узле и hello hello запускает задание разделителя указан количество задач обработчика задач, на как многие вычислительных узлов, при необходимости, на основе параметров hello и спецификации в коде разделителей hello задания.</span><span class="sxs-lookup"><span data-stu-id="ecbea-117">hello Batch service runs hello job manager task on a compute node and hello job splitter launches hello specified number of task processor tasks, on as many compute nodes as required, based on hello parameters and specifications in hello job splitter code.</span></span>
3. <span data-ttu-id="ecbea-118">Hello задач процессора задачи выполняются независимо друг от друга, в параллельном режиме, tooprocess hello входные данные и создавать hello выходных данных.</span><span class="sxs-lookup"><span data-stu-id="ecbea-118">hello task processor tasks run independently, in parallel, tooprocess hello input data and generate hello output data.</span></span>

![Схема, показывающая, как клиентский код взаимодействует с hello пакетная служба][diagram01]

## <a name="prerequisites"></a><span data-ttu-id="ecbea-120">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="ecbea-120">Prerequisites</span></span>
<span data-ttu-id="ecbea-121">шаблоны пакета toouse hello, вам потребуется hello следующее:</span><span class="sxs-lookup"><span data-stu-id="ecbea-121">toouse hello Batch templates, you will need hello following:</span></span>

* <span data-ttu-id="ecbea-122">Компьютер, на который установлено программное обеспечение Visual Studio 2015.</span><span class="sxs-lookup"><span data-stu-id="ecbea-122">A computer with Visual Studio 2015 installed.</span></span> <span data-ttu-id="ecbea-123">В настоящее время поддерживаются только шаблоны пакетной службы для Visual Studio 2015.</span><span class="sxs-lookup"><span data-stu-id="ecbea-123">Batch templates are currently only supported for Visual Studio 2015.</span></span>
* <span data-ttu-id="ecbea-124">шаблоны пакета Hello, которые доступны из hello [коллекции Visual Studio] [ vs_gallery] как расширения Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="ecbea-124">hello Batch templates, which are available from hello [Visual Studio Gallery][vs_gallery] as Visual Studio extensions.</span></span> <span data-ttu-id="ecbea-125">Существует два способа tooget hello шаблонов:</span><span class="sxs-lookup"><span data-stu-id="ecbea-125">There are two ways tooget hello templates:</span></span>
  
  * <span data-ttu-id="ecbea-126">Установка с помощью hello шаблонов hello **расширения и обновления** диалоговое окно в Visual Studio (Дополнительные сведения см. в разделе [поиск и использование расширений Visual Studio][vs_find_use_ext]).</span><span class="sxs-lookup"><span data-stu-id="ecbea-126">Install hello templates using hello **Extensions and Updates** dialog box in Visual Studio (for more information, see [Finding and Using Visual Studio Extensions][vs_find_use_ext]).</span></span> <span data-ttu-id="ecbea-127">В hello **расширения и обновления** диалоговое окно, поиска и загрузки hello, следующие два расширения:</span><span class="sxs-lookup"><span data-stu-id="ecbea-127">In hello **Extensions and Updates** dialog box, search and download hello following two extensions:</span></span>
    
    * <span data-ttu-id="ecbea-128">диспетчер заданий пакетной службы Azure с разделителем заданий;</span><span class="sxs-lookup"><span data-stu-id="ecbea-128">Azure Batch Job Manager with Job Splitter</span></span>
    * <span data-ttu-id="ecbea-129">обработчик задач пакетной службы Azure.</span><span class="sxs-lookup"><span data-stu-id="ecbea-129">Azure Batch Task Processor</span></span>
  * <span data-ttu-id="ecbea-130">Загрузить шаблоны hello с hello в Интернете для Visual Studio: [шаблоны проектов пакета Microsoft Azure][vs_gallery_templates]</span><span class="sxs-lookup"><span data-stu-id="ecbea-130">Download hello templates from hello online gallery for Visual Studio: [Microsoft Azure Batch Project Templates][vs_gallery_templates]</span></span>
* <span data-ttu-id="ecbea-131">Если планируется toouse hello [пакетов приложений](batch-application-packages.md) диспетчера заданий hello toodeploy функции и задачи процессора toohello пакета вычислительных узлов, вы должны toolink tooyour учетной записи хранилища учетной записи пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="ecbea-131">If you plan toouse hello [Application Packages](batch-application-packages.md) feature toodeploy hello job manager and task processor toohello Batch compute nodes, you need toolink a storage account tooyour Batch account.</span></span>

## <a name="preparation"></a><span data-ttu-id="ecbea-132">Подготовка</span><span class="sxs-lookup"><span data-stu-id="ecbea-132">Preparation</span></span>
<span data-ttu-id="ecbea-133">Рекомендуется создать решение, которое может содержать ваш Диспетчер заданий, а также задачи процессора, так как это можно сделать проще tooshare кода между диспетчера заданий и задач процессора программы.</span><span class="sxs-lookup"><span data-stu-id="ecbea-133">We recommend creating a solution that can contain your job manager as well as your task processor, because this can make it easier tooshare code between your job manager and task processor programs.</span></span> <span data-ttu-id="ecbea-134">toocreate этого решения, выполните следующие действия:</span><span class="sxs-lookup"><span data-stu-id="ecbea-134">toocreate this solution, follow these steps:</span></span>

1. <span data-ttu-id="ecbea-135">Откройте Visual Studio и выберите **Файл** > **Создать** > **Проект**.</span><span class="sxs-lookup"><span data-stu-id="ecbea-135">Open Visual Studio and select **File** > **New** > **Project**.</span></span>
2. <span data-ttu-id="ecbea-136">В разделе **Шаблоны** разверните список **Другие типы проектов**, щелкните **Решения Visual Studio** и выберите **Новое решение**.</span><span class="sxs-lookup"><span data-stu-id="ecbea-136">Under **Templates**, expand **Other Project Types**, click **Visual Studio Solutions**, and then select **Blank Solution**.</span></span>
3. <span data-ttu-id="ecbea-137">Введите имя, описывающее приложение и hello цели данного решения (например, «LitwareBatchTaskPrograms»).</span><span class="sxs-lookup"><span data-stu-id="ecbea-137">Type a name that describes your application and hello purpose of this solution (e.g., "LitwareBatchTaskPrograms").</span></span>
4. <span data-ttu-id="ecbea-138">Здравствуйте, toocreate новое решение, нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="ecbea-138">toocreate hello new solution, click **OK**.</span></span>

## <a name="job-manager-template"></a><span data-ttu-id="ecbea-139">Шаблон "Диспетчер заданий"</span><span class="sxs-lookup"><span data-stu-id="ecbea-139">Job Manager template</span></span>
<span data-ttu-id="ecbea-140">шаблон диспетчера заданий Hello помогает tooimplement задача диспетчера заданий, которые может выполнить hello, следующие действия:</span><span class="sxs-lookup"><span data-stu-id="ecbea-140">hello Job Manager template helps you tooimplement a job manager task that can perform hello following actions:</span></span>

* <span data-ttu-id="ecbea-141">разделение задания на несколько задач;</span><span class="sxs-lookup"><span data-stu-id="ecbea-141">Split a job into multiple tasks.</span></span>
* <span data-ttu-id="ecbea-142">Отправьте toorun эти задачи в пакете.</span><span class="sxs-lookup"><span data-stu-id="ecbea-142">Submit those tasks toorun on Batch.</span></span>

> [!NOTE]
> <span data-ttu-id="ecbea-143">Дополнительные сведения о задачах диспетчера заданий см. в статье [Обзор функций пакетной службы для разработчиков](batch-api-basics.md#job-manager-task).</span><span class="sxs-lookup"><span data-stu-id="ecbea-143">For more information about job manager tasks, see [Batch feature overview for developers](batch-api-basics.md#job-manager-task).</span></span>
> 
> 

### <a name="create-a-job-manager-using-hello-template"></a><span data-ttu-id="ecbea-144">Создание диспетчера заданий, с помощью шаблона hello</span><span class="sxs-lookup"><span data-stu-id="ecbea-144">Create a Job Manager using hello template</span></span>
<span data-ttu-id="ecbea-145">tooadd решение toohello диспетчера заданий, созданной ранее, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="ecbea-145">tooadd a job manager toohello solution that you created earlier, follow these steps:</span></span>

1. <span data-ttu-id="ecbea-146">Откройте имеющееся решение в Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="ecbea-146">Open your existing solution in Visual Studio.</span></span>
2. <span data-ttu-id="ecbea-147">В обозревателе решений щелкните решение правой кнопкой мыши hello, нажмите кнопку **добавить** > **новый проект**.</span><span class="sxs-lookup"><span data-stu-id="ecbea-147">In Solution Explorer, right-click hello solution, click **Add** > **New Project**.</span></span>
3. <span data-ttu-id="ecbea-148">В разделе **Visual C#** щелкните **Облако**, а затем — **Azure Batch Job Manager with Job Splitter** (Диспетчер заданий пакетной службы Azure с разделителем заданий).</span><span class="sxs-lookup"><span data-stu-id="ecbea-148">Under **Visual C#**, click **Cloud**, and then click **Azure Batch Job Manager with Job Splitter**.</span></span>
4. <span data-ttu-id="ecbea-149">Введите имя, которое описывает приложение и определяет этот проект как hello диспетчера заданий (например) LitwareJobManager).</span><span class="sxs-lookup"><span data-stu-id="ecbea-149">Type a name that describes your application and identifies this project as hello job manager (e.g. "LitwareJobManager").</span></span>
5. <span data-ttu-id="ecbea-150">toocreate hello проекта, нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="ecbea-150">toocreate hello project, click **OK**.</span></span>
6. <span data-ttu-id="ecbea-151">Наконец Visual Studio tooforce tooload для построения hello проекта все ссылки на пакеты NuGet и tooverify, hello проекта является допустимым, прежде чем начать, его изменения.</span><span class="sxs-lookup"><span data-stu-id="ecbea-151">Finally, build hello project tooforce Visual Studio tooload all referenced NuGet packages and tooverify that hello project is valid before you start modifying it.</span></span>

### <a name="job-manager-template-files-and-their-purpose"></a><span data-ttu-id="ecbea-152">Файлы шаблона "Диспетчер заданий" и их назначение</span><span class="sxs-lookup"><span data-stu-id="ecbea-152">Job Manager template files and their purpose</span></span>
<span data-ttu-id="ecbea-153">При создании проекта с помощью шаблона диспетчера заданий hello, он создает три группы файлов кода:</span><span class="sxs-lookup"><span data-stu-id="ecbea-153">When you create a project using hello Job Manager template, it generates three groups of code files:</span></span>

* <span data-ttu-id="ecbea-154">файл основной программы Hello (Program.cs).</span><span class="sxs-lookup"><span data-stu-id="ecbea-154">hello main program file (Program.cs).</span></span> <span data-ttu-id="ecbea-155">Оно содержит точку входа программы hello и обработка исключений верхнего уровня.</span><span class="sxs-lookup"><span data-stu-id="ecbea-155">This contains hello program entry point and top-level exception handling.</span></span> <span data-ttu-id="ecbea-156">Не следует обычно toomodify это необходимо.</span><span class="sxs-lookup"><span data-stu-id="ecbea-156">You shouldn't normally need toomodify this.</span></span>
* <span data-ttu-id="ecbea-157">каталог платформы Hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-157">hello Framework directory.</span></span> <span data-ttu-id="ecbea-158">Это файлы hello ответственность за работы «стандартный» hello, выполненной программой hello задания manager – распаковке файлов параметров, добавление задач toohello пакетного задания и т. д. Вы не должны обычно требуется toomodify эти файлы.</span><span class="sxs-lookup"><span data-stu-id="ecbea-158">This contains hello files responsible for hello 'boilerplate' work done by hello job manager program – unpacking parameters, adding tasks toohello Batch job, etc. You shouldn't normally need toomodify these files.</span></span>
* <span data-ttu-id="ecbea-159">файл разделителя задания Hello (JobSplitter.cs).</span><span class="sxs-lookup"><span data-stu-id="ecbea-159">hello job splitter file (JobSplitter.cs).</span></span> <span data-ttu-id="ecbea-160">Именно в него помещается логика приложения для разделения задания на задачи.</span><span class="sxs-lookup"><span data-stu-id="ecbea-160">This is where you will put your application-specific logic for splitting a job into tasks.</span></span>

<span data-ttu-id="ecbea-161">Конечно можно добавить дополнительные файлы как обязательный toosupport коде разделителей задания в зависимости от сложности hello задания hello разделение логики.</span><span class="sxs-lookup"><span data-stu-id="ecbea-161">Of course you can add additional files as required toosupport your job splitter code, depending on hello complexity of hello job splitting logic.</span></span>

<span data-ttu-id="ecbea-162">шаблон Hello также создает стандартные файлы проекта .NET, например CSPROJ-файл, файл app.config, packages.config и т.д.</span><span class="sxs-lookup"><span data-stu-id="ecbea-162">hello template also generates standard .NET project files such as a .csproj file, app.config, packages.config, etc.</span></span>

<span data-ttu-id="ecbea-163">Hello оставшейся части этого раздела описываются различные файлы hello и их структуру кода и объясняется, что делает каждый класс.</span><span class="sxs-lookup"><span data-stu-id="ecbea-163">hello rest of this section describes hello different files and their code structure, and explains what each class does.</span></span>

![Visual Studio в обозревателе решений hello диспетчера заданий шаблон решения][solution_explorer01]

<span data-ttu-id="ecbea-165">**Файлы платформы**</span><span class="sxs-lookup"><span data-stu-id="ecbea-165">**Framework files**</span></span>

* <span data-ttu-id="ecbea-166">`Configuration.cs`: Инкапсулирует hello загрузка данных конфигурации задания, например сведения об учетной записи, связанное хранение учетных данных учетной записи, заданий и задач и задания параметров пакета.</span><span class="sxs-lookup"><span data-stu-id="ecbea-166">`Configuration.cs`: Encapsulates hello loading of job configuration data such as Batch account details, linked storage account credentials, job and task information, and job parameters.</span></span> <span data-ttu-id="ecbea-167">Он также предоставляет доступ tooBatch определенные переменные (см. параметры среды для задачи, в документации пакета hello) через класс Configuration.EnvironmentVariable hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-167">It also provides access tooBatch-defined environment variables (see Environment settings for tasks, in hello Batch documentation) via hello Configuration.EnvironmentVariable class.</span></span>
* <span data-ttu-id="ecbea-168">`IConfiguration.cs`: Краткие описания hello реализация hello класс конфигурации, чтобы пользователь мог модульный тест вашего задания разделителю при помощи объекта конфигурации имитируемой или макета.</span><span class="sxs-lookup"><span data-stu-id="ecbea-168">`IConfiguration.cs`: Abstracts hello implementation of hello Configuration class, so that you can unit test your job splitter using a fake or mock configuration object.</span></span>
* <span data-ttu-id="ecbea-169">`JobManager.cs`: Координирует hello компоненты программы диспетчера заданий hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-169">`JobManager.cs`: Orchestrates hello components of hello job manager program.</span></span> <span data-ttu-id="ecbea-170">Он отвечает за hello инициализация задания разделителей hello, вызов разделителя задания hello, и диспетчеризации задачи hello, возвращенный отправителю hello задания разделителей toohello задачи.</span><span class="sxs-lookup"><span data-stu-id="ecbea-170">It is responsible for hello initializing hello job splitter, invoking hello job splitter, and dispatching hello tasks returned by hello job splitter toohello task submitter.</span></span>
* <span data-ttu-id="ecbea-171">`JobManagerException.cs`: Представляет ошибку, которая требует tooterminate диспетчера заданий hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-171">`JobManagerException.cs`: Represents an error that requires hello job manager tooterminate.</span></span> <span data-ttu-id="ecbea-172">JobManagerException — ошибки «требуется» используется toowrap где определенные диагностические сведения могут быть предоставлены как часть завершения.</span><span class="sxs-lookup"><span data-stu-id="ecbea-172">JobManagerException is used toowrap 'expected' errors where specific diagnostic information can be provided as part of termination.</span></span>
* <span data-ttu-id="ecbea-173">`TaskSubmitter.cs`: Этот класс является ответственным tooadding задачи, возвращенных hello задания разделителей toohello пакетного задания.</span><span class="sxs-lookup"><span data-stu-id="ecbea-173">`TaskSubmitter.cs`: This class is responsible tooadding tasks returned by hello job splitter toohello Batch job.</span></span> <span data-ttu-id="ecbea-174">Класс JobManager Hello агрегирует hello последовательность задач, в виде пакетов для добавления эффективными, но своевременно toohello задания, а затем вызывает TaskSubmitter.SubmitTasks в фоновый поток для каждого пакета.</span><span class="sxs-lookup"><span data-stu-id="ecbea-174">hello JobManager class aggregates hello sequence of tasks into batches for efficient but timely addition toohello job, then calls TaskSubmitter.SubmitTasks on a background thread for each batch.</span></span>

<span data-ttu-id="ecbea-175">**Разделитель заданий**</span><span class="sxs-lookup"><span data-stu-id="ecbea-175">**Job Splitter**</span></span>

<span data-ttu-id="ecbea-176">`JobSplitter.cs`: Этот класс содержит логику приложения для разделения hello задания на задачи.</span><span class="sxs-lookup"><span data-stu-id="ecbea-176">`JobSplitter.cs`: This class contains application-specific logic for splitting hello job into tasks.</span></span> <span data-ttu-id="ecbea-177">Hello framework вызывает hello JobSplitter.Split метод tooobtain последовательности задач, которые он добавляет задание toohello как метод hello возвращает их.</span><span class="sxs-lookup"><span data-stu-id="ecbea-177">hello framework invokes hello JobSplitter.Split method tooobtain a sequence of tasks, which it adds toohello job as hello method returns them.</span></span> <span data-ttu-id="ecbea-178">Это класс hello, в котором обеспечивает включение логики hello задания.</span><span class="sxs-lookup"><span data-stu-id="ecbea-178">This is hello class where you will inject hello logic of your job.</span></span> <span data-ttu-id="ecbea-179">Реализуйте hello разбить метод tooreturn последовательность экземпляров CloudTask, представляющий hello задачи, в которых требуется задание toopartition hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-179">Implement hello Split method tooreturn a sequence of CloudTask instances representing hello tasks into which you want toopartition hello job.</span></span>

<span data-ttu-id="ecbea-180">**Стандартные файлы проекта .NET командной строки**</span><span class="sxs-lookup"><span data-stu-id="ecbea-180">**Standard .NET command line project files**</span></span>

* <span data-ttu-id="ecbea-181">`App.config`— стандартный файл конфигурации приложения .NET.</span><span class="sxs-lookup"><span data-stu-id="ecbea-181">`App.config`: Standard .NET application configuration file.</span></span>
* <span data-ttu-id="ecbea-182">`Packages.config` — стандартный файл зависимостей пакета NuGet.</span><span class="sxs-lookup"><span data-stu-id="ecbea-182">`Packages.config`: Standard NuGet package dependency file.</span></span>
* <span data-ttu-id="ecbea-183">`Program.cs`: Содержит точку входа программы hello и обработка исключений верхнего уровня.</span><span class="sxs-lookup"><span data-stu-id="ecbea-183">`Program.cs`: Contains hello program entry point and top-level exception handling.</span></span>

### <a name="implementing-hello-job-splitter"></a><span data-ttu-id="ecbea-184">Реализация разделителя задания hello</span><span class="sxs-lookup"><span data-stu-id="ecbea-184">Implementing hello job splitter</span></span>
<span data-ttu-id="ecbea-185">При открытии проекта шаблона диспетчера заданий hello hello проект будет содержать файл JobSplitter.cs hello открытия по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="ecbea-185">When you open hello Job Manager template project, hello project will have hello JobSplitter.cs file open by default.</span></span> <span data-ttu-id="ecbea-186">Можно реализовать hello разделить логику для задачи hello в рабочей нагрузке с помощью в следующем примере показан метод Split() hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-186">You can implement hello split logic for hello tasks in your workload by using hello Split() method show below:</span></span>

```csharp
/// <summary>
/// Gets hello tasks into which toosplit hello job. This is where you inject
/// your application-specific logic for decomposing hello job into tasks.
///
/// hello job manager framework invokes hello Split method for you; you need
/// only tooimplement it, not toocall it yourself. Typically, your
/// implementation should return tasks lazily, for example using a C#
/// iterator and hello "yield return" statement; this allows tasks toobe added
/// and toostart running while splitting is still in progress.
/// </summary>
/// <returns>hello tasks toobe added toohello job. Tasks are added automatically
/// by hello job manager framework as they are returned by this method.</returns>
public IEnumerable<CloudTask> Split()
{
    // Your code for hello split logic goes here.
    int startFrame = Convert.ToInt32(_parameters["StartFrame"]);
    int endFrame = Convert.ToInt32(_parameters["EndFrame"]);

    for (int i = startFrame; i <= endFrame; i++)
    {
        yield return new CloudTask("myTask" + i, "cmd /c dir");
    }
}
```

> [!NOTE]
> <span data-ttu-id="ecbea-187">Hello заметками раздела hello `Split()` метод — hello только часть hello код шаблона диспетчера заданий, предназначенный для вас toomodify путем добавления hello toosplit логику выполнения заданий в различные задачи.</span><span class="sxs-lookup"><span data-stu-id="ecbea-187">hello annotated section in hello `Split()` method is hello only section of hello Job Manager template code that is intended for you toomodify by adding hello logic toosplit your jobs into different tasks.</span></span> <span data-ttu-id="ecbea-188">Следует toomodify в другой раздел hello шаблона убедитесь начала ознакомьтесь с принципами работы пакета и попробуйте выполнить некоторые из hello [пакета образцы кода][github_samples].</span><span class="sxs-lookup"><span data-stu-id="ecbea-188">If you want toomodify a different section of hello template, please ensure you are familiarized with how Batch works, and try out a few of hello [Batch code samples][github_samples].</span></span>
> 
> 

<span data-ttu-id="ecbea-189">Для реализации метода Split() доступны такие компоненты:</span><span class="sxs-lookup"><span data-stu-id="ecbea-189">Your Split() implementation has access to:</span></span>

* <span data-ttu-id="ecbea-190">Здравствуйте, задания параметров, через hello `_parameters` поля.</span><span class="sxs-lookup"><span data-stu-id="ecbea-190">hello job parameters, via hello `_parameters` field.</span></span>
* <span data-ttu-id="ecbea-191">представления задания hello, через hello объекта Hello CloudJob `_job` поля.</span><span class="sxs-lookup"><span data-stu-id="ecbea-191">hello CloudJob object representing hello job, via hello `_job` field.</span></span>
* <span data-ttu-id="ecbea-192">представляющих hello задачи диспетчера заданий, через hello объекта Hello CloudTask `_jobManagerTask` поля.</span><span class="sxs-lookup"><span data-stu-id="ecbea-192">hello CloudTask object representing hello job manager task, via hello `_jobManagerTask` field.</span></span>

<span data-ttu-id="ecbea-193">Ваш `Split()` реализации не требуется задание toohello задачи tooadd напрямую.</span><span class="sxs-lookup"><span data-stu-id="ecbea-193">Your `Split()` implementation does not need tooadd tasks toohello job directly.</span></span> <span data-ttu-id="ecbea-194">Вместо этого код должен возвращать последовательность объектов CloudTask, и эти задания toohello автоматически добавляется классами framework hello, вызывающие hello задания разделителей.</span><span class="sxs-lookup"><span data-stu-id="ecbea-194">Instead, your code should return a sequence of CloudTask objects, and these will be added toohello job automatically by hello framework classes that invoke hello job splitter.</span></span> <span data-ttu-id="ecbea-195">Это общие итератор toouse C# (`yield return`) компонентов tooimplement задания разделителей, как это позволяет toostart hello задачи, как можно быстрее под управлением, а не ожидает, пока все задачи toobe рассчитываются.</span><span class="sxs-lookup"><span data-stu-id="ecbea-195">It's common toouse C#'s iterator (`yield return`) feature tooimplement job splitters as this allows hello tasks toostart running as soon as possible rather than waiting for all tasks toobe calculated.</span></span>

<span data-ttu-id="ecbea-196">**Сбой разделителя заданий**</span><span class="sxs-lookup"><span data-stu-id="ecbea-196">**Job splitter failure**</span></span>

<span data-ttu-id="ecbea-197">При сбое разделитель заданий делает следующее:</span><span class="sxs-lookup"><span data-stu-id="ecbea-197">If your job splitter encounters an error, it should either:</span></span>

* <span data-ttu-id="ecbea-198">Завершение последовательности hello hello C# с помощью `yield break` инструкции, в котором вариантов hello диспетчера заданий будет рассматриваться как успешно; или</span><span class="sxs-lookup"><span data-stu-id="ecbea-198">Terminate hello sequence using hello C# `yield break` statement, in which case hello job manager will be treated as successful; or</span></span>
* <span data-ttu-id="ecbea-199">Исключение, в которой диспетчер заданий вариантов hello будут рассматриваться как сбой и может быть повторена в зависимости от того, как клиент hello настроил его).</span><span class="sxs-lookup"><span data-stu-id="ecbea-199">Throw an exception, in which case hello job manager will be treated as failed and may be retried depending on how hello client has configured it).</span></span>

<span data-ttu-id="ecbea-200">В обоих случаях все задачи, уже возвращенных разделителей задания hello и добавлены toohello пакетное задание будет иметь право toorun.</span><span class="sxs-lookup"><span data-stu-id="ecbea-200">In both cases, any tasks already returned by hello job splitter and added toohello Batch job will be eligible toorun.</span></span> <span data-ttu-id="ecbea-201">Если вы не хотите этого toohappen, затем можно выполнить следующее.</span><span class="sxs-lookup"><span data-stu-id="ecbea-201">If you don't want this toohappen, then you could:</span></span>

* <span data-ttu-id="ecbea-202">Завершить задание hello перед возвратом из задания разделителей hello</span><span class="sxs-lookup"><span data-stu-id="ecbea-202">Terminate hello job before returning from hello job splitter</span></span>
* <span data-ttu-id="ecbea-203">Сформулировать коллекции всей задачи hello перед возвращением (то есть возвращать `ICollection<CloudTask>` или `IList<CloudTask>` вместо реализации вашей задания разделителю при помощи итератора C#)</span><span class="sxs-lookup"><span data-stu-id="ecbea-203">Formulate hello entire task collection before returning it (that is, return an `ICollection<CloudTask>` or `IList<CloudTask>` instead of implementing your job splitter using a C# iterator)</span></span>
* <span data-ttu-id="ecbea-204">Использовать toomake зависимости задач, все задачи зависят от успешного завершения диспетчера заданий hello hello</span><span class="sxs-lookup"><span data-stu-id="ecbea-204">Use task dependencies toomake all tasks depend on hello successful completion of hello job manager</span></span>

<span data-ttu-id="ecbea-205">**Повторная попытка запуска диспетчера заданий**</span><span class="sxs-lookup"><span data-stu-id="ecbea-205">**Job manager retries**</span></span>

<span data-ttu-id="ecbea-206">Если происходит сбой диспетчера заданий hello, может быть повторена пакетной службой hello в зависимости от параметров повторных попыток клиента hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-206">If hello job manager fails, it may be retried by hello Batch service depending on hello client retry settings.</span></span> <span data-ttu-id="ecbea-207">Как правило это безопасным, так как при hello framework добавляет задание toohello задачи, игнорирует все задачи, которые уже существуют.</span><span class="sxs-lookup"><span data-stu-id="ecbea-207">In general, this is safe, because when hello framework adds tasks toohello job, it ignores any tasks that already exist.</span></span> <span data-ttu-id="ecbea-208">Однако если вычисление задачи, не можно tooincur hello затраты перерасчет задачи, которые уже были добавлены toohello задания; и наоборот Если hello повторно запустите не гарантируется toogenerate hello одинаковые идентификаторы задач и поведение «пропустить дубликаты» hello не включится.</span><span class="sxs-lookup"><span data-stu-id="ecbea-208">However, if calculating tasks is expensive, you may not wish tooincur hello cost of recalculating tasks that have already been added toohello job; conversely, if hello re-run is not guaranteed toogenerate hello same task IDs then hello 'ignore duplicates' behavior will not kick in.</span></span> <span data-ttu-id="ecbea-209">В таких случаях следует разрабатывать hello действий toodetect задания разделителей, что уже выполнены и не повторять его, например, выполняя CloudJob.ListTasks перед запуском tooyield задачи.</span><span class="sxs-lookup"><span data-stu-id="ecbea-209">In these cases you should design your job splitter toodetect hello work that has already been done and not repeat it, for example by performing a CloudJob.ListTasks before starting tooyield tasks.</span></span>

### <a name="exit-codes-and-exceptions-in-hello-job-manager-template"></a><span data-ttu-id="ecbea-210">Выйти из кодов и исключения в шаблоне hello диспетчера заданий</span><span class="sxs-lookup"><span data-stu-id="ecbea-210">Exit codes and exceptions in hello Job Manager template</span></span>
<span data-ttu-id="ecbea-211">Коды выхода и исключения предоставляют механизм toodetermine hello результат запуска программы, и они могут помочь tooidentify проблемах, связанных с hello выполнения программы hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-211">Exit codes and exceptions provide a mechanism toodetermine hello outcome of running a program, and they can help tooidentify any problems with hello execution of hello program.</span></span> <span data-ttu-id="ecbea-212">шаблон диспетчера заданий Hello реализует коды завершения hello и исключения, описанные в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="ecbea-212">hello Job Manager template implements hello exit codes and exceptions described in this section.</span></span>

<span data-ttu-id="ecbea-213">Задача диспетчера заданий, реализованный с помощью шаблона диспетчера заданий hello может вернуть три возможных выхода кода:</span><span class="sxs-lookup"><span data-stu-id="ecbea-213">A job manager task that is implemented with hello Job Manager template can return three possible exit codes:</span></span>

| <span data-ttu-id="ecbea-214">Код</span><span class="sxs-lookup"><span data-stu-id="ecbea-214">Code</span></span> | <span data-ttu-id="ecbea-215">Описание</span><span class="sxs-lookup"><span data-stu-id="ecbea-215">Description</span></span> |
| --- | --- |
| <span data-ttu-id="ecbea-216">0</span><span class="sxs-lookup"><span data-stu-id="ecbea-216">0</span></span> |<span data-ttu-id="ecbea-217">Диспетчер заданий Hello успешно завершена.</span><span class="sxs-lookup"><span data-stu-id="ecbea-217">hello job manager completed successfully.</span></span> <span data-ttu-id="ecbea-218">Код разделителя задание выполняется toocompletion и все задачи были добавлены toohello задания.</span><span class="sxs-lookup"><span data-stu-id="ecbea-218">Your job splitter code ran toocompletion, and all tasks were added toohello job.</span></span> |
| <span data-ttu-id="ecbea-219">1</span><span class="sxs-lookup"><span data-stu-id="ecbea-219">1</span></span> |<span data-ttu-id="ecbea-220">задачи диспетчера заданий Hello ошибка с исключением в «ожидаемый» части программы hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-220">hello job manager task failed with an exception in an 'expected' part of hello program.</span></span> <span data-ttu-id="ecbea-221">Возникло исключение Hello переведенные tooa JobManagerException с диагностической информацией и hello там, где это возможно, рекомендации по устранению ошибки.</span><span class="sxs-lookup"><span data-stu-id="ecbea-221">hello exception was translated tooa JobManagerException with diagnostic information and, where possible, suggestions for resolving hello failure.</span></span> |
| <span data-ttu-id="ecbea-222">2</span><span class="sxs-lookup"><span data-stu-id="ecbea-222">2</span></span> |<span data-ttu-id="ecbea-223">задачи диспетчера заданий Hello сбой с исключением «Непредвиденная».</span><span class="sxs-lookup"><span data-stu-id="ecbea-223">hello job manager task failed with an 'unexpected' exception.</span></span> <span data-ttu-id="ecbea-224">Hello исключение был регистрируется toostandard выходные данные, но hello диспетчер заданий не удается tooadd любые дополнительные сведения диагностики и исправления.</span><span class="sxs-lookup"><span data-stu-id="ecbea-224">hello exception was logged toostandard output, but hello job manager was unable tooadd any additional diagnostic or remediation information.</span></span> |

<span data-ttu-id="ecbea-225">В случае сбоя задачи диспетчера заданий hello некоторые задачи могут по-прежнему были добавлены службы toohello до возникновения ошибки hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-225">In hello case of job manager task failure, some tasks may still have been added toohello service before hello error occurred.</span></span> <span data-ttu-id="ecbea-226">Эти задачи будут выполняться в обычном режиме.</span><span class="sxs-lookup"><span data-stu-id="ecbea-226">These tasks will run as normal.</span></span> <span data-ttu-id="ecbea-227">Обсуждение этого пути кода см. в разделе "Сбой разделителя заданий" выше.</span><span class="sxs-lookup"><span data-stu-id="ecbea-227">See "Job Splitter Failure" above for discussion of this code path.</span></span>

<span data-ttu-id="ecbea-228">Все hello информацию, возвращаемую исключения записываются в файлы stdout.txt и stderr.txt.</span><span class="sxs-lookup"><span data-stu-id="ecbea-228">All hello information returned by exceptions is written into stdout.txt and stderr.txt files.</span></span> <span data-ttu-id="ecbea-229">Дополнительные сведения см. в разделе [Обработка ошибок](batch-api-basics.md#error-handling).</span><span class="sxs-lookup"><span data-stu-id="ecbea-229">For more information, see [Error Handling](batch-api-basics.md#error-handling).</span></span>

### <a name="client-considerations"></a><span data-ttu-id="ecbea-230">Рекомендации для клиента</span><span class="sxs-lookup"><span data-stu-id="ecbea-230">Client considerations</span></span>
<span data-ttu-id="ecbea-231">В этом разделе описываются некоторые требования к реализации в клиенте при вызове диспетчера заданий с использованием этого шаблона.</span><span class="sxs-lookup"><span data-stu-id="ecbea-231">This section describes some client implementation requirements when invoking a job manager based on this template.</span></span> <span data-ttu-id="ecbea-232">В разделе [hello как toopass параметры и переменные среды из клиентского кода](#pass-environment-settings) сведения о передаче параметров и параметров среды.</span><span class="sxs-lookup"><span data-stu-id="ecbea-232">See [How toopass parameters and environment variables from hello client code](#pass-environment-settings) for details on passing parameters and environment settings.</span></span>

<span data-ttu-id="ecbea-233">**Обязательные учетные данные**</span><span class="sxs-lookup"><span data-stu-id="ecbea-233">**Mandatory credentials**</span></span>

<span data-ttu-id="ecbea-234">В tooadd задачи toohello Azure пакетное задание задача диспетчера заданий hello требуется URL-адрес учетной записи пакетной службы Azure и ключа.</span><span class="sxs-lookup"><span data-stu-id="ecbea-234">In order tooadd tasks toohello Azure Batch job, hello job manager task requires your Azure Batch account URL and key.</span></span> <span data-ttu-id="ecbea-235">Их необходимо передать в переменные среды YOUR_BATCH_URL и YOUR_BATCH_KEY.</span><span class="sxs-lookup"><span data-stu-id="ecbea-235">You must pass these in environment variables named YOUR_BATCH_URL and YOUR_BATCH_KEY.</span></span> <span data-ttu-id="ecbea-236">Можно задать в виде hello диспетчера заданий параметры среды для задачи.</span><span class="sxs-lookup"><span data-stu-id="ecbea-236">You can set these in hello Job Manager task environment settings.</span></span> <span data-ttu-id="ecbea-237">Например, в клиенте C#:</span><span class="sxs-lookup"><span data-stu-id="ecbea-237">For example, in a C# client:</span></span>

```csharp
job.JobManagerTask.EnvironmentSettings = new [] {
    new EnvironmentSetting("YOUR_BATCH_URL", "https://account.region.batch.azure.com"),
    new EnvironmentSetting("YOUR_BATCH_KEY", "{your_base64_encoded_account_key}"),
};
```
<span data-ttu-id="ecbea-238">**Учетные данные хранилища**</span><span class="sxs-lookup"><span data-stu-id="ecbea-238">**Storage credentials**</span></span>

<span data-ttu-id="ecbea-239">Как правило hello клиенту не требуется tooprovide hello связанное хранение учетной записи учетных данных toohello задачи диспетчера заданий, так как не обязательно учетной записи хранилища hello связаны доступа tooexplicitly (a) большинство руководителей задания и (б) hello связанной учетной записи хранения часто предоставляется tooall задачи, как общие параметра среды для задания hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-239">Typically, hello client does not need tooprovide hello linked storage account credentials toohello job manager task because (a) most job managers do not need tooexplicitly access hello linked storage account and (b) hello linked storage account is often provided tooall tasks as a common environment setting for hello job.</span></span> <span data-ttu-id="ecbea-240">Если вы не указываете hello связанной учетной записи хранилища с помощью hello Общие параметры среды и диспетчер заданий hello требует toolinked доступа к хранилищу, а затем необходимо предоставить учетные данные хранилища hello связаны следующим образом:</span><span class="sxs-lookup"><span data-stu-id="ecbea-240">If you are not providing hello linked storage account via hello common environment settings, and hello job manager requires access toolinked storage, then you should supply hello linked storage credentials as follows:</span></span>

```csharp
job.JobManagerTask.EnvironmentSettings = new [] {
    /* other environment settings */
    new EnvironmentSetting("LINKED_STORAGE_ACCOUNT", "{storageAccountName}"),
    new EnvironmentSetting("LINKED_STORAGE_KEY", "{storageAccountKey}"),
};
```

<span data-ttu-id="ecbea-241">**Параметры задачи диспетчера заданий**</span><span class="sxs-lookup"><span data-stu-id="ecbea-241">**Job manager task settings**</span></span>

<span data-ttu-id="ecbea-242">Hello клиент должен задать диспетчера заданий hello *killJobOnCompletion* флаг слишком**false**.</span><span class="sxs-lookup"><span data-stu-id="ecbea-242">hello client should set hello job manager *killJobOnCompletion* flag too**false**.</span></span>

<span data-ttu-id="ecbea-243">Обычно можно безопасно для hello клиента tooset *runExclusive* слишком**false**.</span><span class="sxs-lookup"><span data-stu-id="ecbea-243">It is usually safe for hello client tooset *runExclusive* too**false**.</span></span>

<span data-ttu-id="ecbea-244">Hello клиент должен использовать hello *resourceFiles* или *applicationPackageReferences* коллекции toohave hello диспетчера заданий исполняемый файл (и его необходимых библиотек DLL) развернуты toohello вычислительных узлов.</span><span class="sxs-lookup"><span data-stu-id="ecbea-244">hello client should use hello *resourceFiles* or *applicationPackageReferences* collection toohave hello job manager executable (and its required DLLs) deployed toohello compute node.</span></span>

<span data-ttu-id="ecbea-245">По умолчанию hello диспетчер заданий не предпринимается при неудаче.</span><span class="sxs-lookup"><span data-stu-id="ecbea-245">By default, hello job manager will not be retried if it fails.</span></span> <span data-ttu-id="ecbea-246">В зависимости от логики диспетчера заданий hello клиента может потребоваться tooenable повторные попытки через *ограничения*/*maxTaskRetryCount*.</span><span class="sxs-lookup"><span data-stu-id="ecbea-246">Depending on your job manager logic, hello client may want tooenable retries via *constraints*/*maxTaskRetryCount*.</span></span>

<span data-ttu-id="ecbea-247">**Параметры задания**</span><span class="sxs-lookup"><span data-stu-id="ecbea-247">**Job settings**</span></span>

<span data-ttu-id="ecbea-248">Если разделитель задания hello выдает задачи с зависимостями, hello клиент должен указать tootrue usesTaskDependencies hello задания.</span><span class="sxs-lookup"><span data-stu-id="ecbea-248">If hello job splitter emits tasks with dependencies, hello client must set hello job's usesTaskDependencies tootrue.</span></span>

<span data-ttu-id="ecbea-249">В модели разделителей задания hello является обычным для клиентов toowish tooadd задачи toojobs помимо создает задания какие hello разделителей.</span><span class="sxs-lookup"><span data-stu-id="ecbea-249">In hello job splitter model, it is unusual for clients toowish tooadd tasks toojobs over and above what hello job splitter creates.</span></span> <span data-ttu-id="ecbea-250">Hello клиента таким образом устанавливайте обычно hello задания *onAllTasksComplete* слишком**terminatejob**.</span><span class="sxs-lookup"><span data-stu-id="ecbea-250">hello client should therefore normally set hello job's *onAllTasksComplete* too**terminatejob**.</span></span>

## <a name="task-processor-template"></a><span data-ttu-id="ecbea-251">Шаблон "Обработчик задач"</span><span class="sxs-lookup"><span data-stu-id="ecbea-251">Task Processor template</span></span>
<span data-ttu-id="ecbea-252">Шаблон обработчика задач помогает tooimplement обработчика задач, который может выполнять следующие действия hello:</span><span class="sxs-lookup"><span data-stu-id="ecbea-252">A Task Processor template helps you tooimplement a task processor that can perform hello following actions:</span></span>

* <span data-ttu-id="ecbea-253">Настройка сведения hello, необходимой для каждого toorun задач пакета.</span><span class="sxs-lookup"><span data-stu-id="ecbea-253">Set up hello information required by each Batch task toorun.</span></span>
* <span data-ttu-id="ecbea-254">выполнение всех действий, необходимых для каждой задачи пакетной службы;</span><span class="sxs-lookup"><span data-stu-id="ecbea-254">Run all actions required by each Batch task.</span></span>
* <span data-ttu-id="ecbea-255">Сохранение выходных данных задачи toopersistent хранилища.</span><span class="sxs-lookup"><span data-stu-id="ecbea-255">Save task outputs toopersistent storage.</span></span>

<span data-ttu-id="ecbea-256">Хотя обработчика задач не требуется toorun задач в пакете, hello Главное преимущество использования обработчика задач — что она обеспечивает tooimplement оболочки все действия выполнения задач в одном месте.</span><span class="sxs-lookup"><span data-stu-id="ecbea-256">Although a task processor is not required toorun tasks on Batch, hello key advantage of using a task processor is that it provides a wrapper tooimplement all task execution actions in one location.</span></span> <span data-ttu-id="ecbea-257">Например при необходимости toorun нескольких приложений в контексте hello каждой задачи или при необходимости хранения toopersistent toocopy данных после завершения каждая задача.</span><span class="sxs-lookup"><span data-stu-id="ecbea-257">For example, if you need toorun several applications in hello context of each task, or if you need toocopy data toopersistent storage after completing each task.</span></span>

<span data-ttu-id="ecbea-258">Hello действий, выполняемых обработчиком hello задача может быть как простой или сложной и многие или несколько, как того требует рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="ecbea-258">hello actions performed by hello task processor can be as simple or complex, and as many or as few, as required by your workload.</span></span> <span data-ttu-id="ecbea-259">Кроме того реализовав все действия задач в один процессор задач, можно легко обновить или добавить действия в соответствии с требованиями изменения tooapplications или рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="ecbea-259">Additionally, by implementing all task actions into one task processor, you can readily update or add actions based on changes tooapplications or workload requirements.</span></span> <span data-ttu-id="ecbea-260">Тем не менее в некоторых случаях обработчика задач может оказаться hello оптимальным решением для реализации при его можно добавить ненужные сложности, например при выполнении заданий, которые можно быстро запустить из простых командной строки.</span><span class="sxs-lookup"><span data-stu-id="ecbea-260">However, in some cases a task processor might not be hello optimal solution for your implementation as it can add unnecessary complexity, for example when running jobs that can be quickly started from a simple command line.</span></span>

### <a name="create-a-task-processor-using-hello-template"></a><span data-ttu-id="ecbea-261">Создание обработчика задач, с помощью шаблона hello</span><span class="sxs-lookup"><span data-stu-id="ecbea-261">Create a Task Processor using hello template</span></span>
<span data-ttu-id="ecbea-262">tooadd решения toohello процессора задачи, созданной ранее, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="ecbea-262">tooadd a task processor toohello solution that you created earlier, follow these steps:</span></span>

1. <span data-ttu-id="ecbea-263">Откройте имеющееся решение в Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="ecbea-263">Open your existing solution in Visual Studio.</span></span>
2. <span data-ttu-id="ecbea-264">В обозревателе решений щелкните решение правой кнопкой мыши hello, нажмите кнопку **добавить**, а затем нажмите кнопку **новый проект**.</span><span class="sxs-lookup"><span data-stu-id="ecbea-264">In Solution Explorer, right-click hello solution, click **Add**, and then click **New Project**.</span></span>
3. <span data-ttu-id="ecbea-265">В разделе **Visual C#** щелкните **Облако**, а затем — **Azure Batch Task Processor** (Обработчик задач пакетной службы Azure).</span><span class="sxs-lookup"><span data-stu-id="ecbea-265">Under **Visual C#**, click **Cloud**, and then click **Azure Batch Task Processor**.</span></span>
4. <span data-ttu-id="ecbea-266">Введите имя, которое описывает приложение и определяет этот проект как hello обработчика задач (например) LitwareTaskProcessor).</span><span class="sxs-lookup"><span data-stu-id="ecbea-266">Type a name that describes your application and identifies this project as hello task processor (e.g. "LitwareTaskProcessor").</span></span>
5. <span data-ttu-id="ecbea-267">toocreate hello проекта, нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="ecbea-267">toocreate hello project, click **OK**.</span></span>
6. <span data-ttu-id="ecbea-268">Наконец Visual Studio tooforce tooload для построения hello проекта все ссылки на пакеты NuGet и tooverify, hello проекта является допустимым, прежде чем начать, его изменения.</span><span class="sxs-lookup"><span data-stu-id="ecbea-268">Finally, build hello project tooforce Visual Studio tooload all referenced NuGet packages and tooverify that hello project is valid before you start modifying it.</span></span>

### <a name="task-processor-template-files-and-their-purpose"></a><span data-ttu-id="ecbea-269">Файлы шаблона "Обработчик задач" и их назначение</span><span class="sxs-lookup"><span data-stu-id="ecbea-269">Task Processor template files and their purpose</span></span>
<span data-ttu-id="ecbea-270">При создании проекта с помощью шаблона процессора задачи hello, он создает три группы файлов кода:</span><span class="sxs-lookup"><span data-stu-id="ecbea-270">When you create a project using hello task processor template, it generates three groups of code files:</span></span>

* <span data-ttu-id="ecbea-271">файл основной программы Hello (Program.cs).</span><span class="sxs-lookup"><span data-stu-id="ecbea-271">hello main program file (Program.cs).</span></span> <span data-ttu-id="ecbea-272">Оно содержит точку входа программы hello и обработка исключений верхнего уровня.</span><span class="sxs-lookup"><span data-stu-id="ecbea-272">This contains hello program entry point and top-level exception handling.</span></span> <span data-ttu-id="ecbea-273">Не следует обычно toomodify это необходимо.</span><span class="sxs-lookup"><span data-stu-id="ecbea-273">You shouldn't normally need toomodify this.</span></span>
* <span data-ttu-id="ecbea-274">каталог платформы Hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-274">hello Framework directory.</span></span> <span data-ttu-id="ecbea-275">Это файлы hello ответственность за работы «стандартный» hello, выполненной программой hello задания manager – распаковке файлов параметров, добавление задач toohello пакетного задания и т. д. Вы не должны обычно требуется toomodify эти файлы.</span><span class="sxs-lookup"><span data-stu-id="ecbea-275">This contains hello files responsible for hello 'boilerplate' work done by hello job manager program – unpacking parameters, adding tasks toohello Batch job, etc. You shouldn't normally need toomodify these files.</span></span>
* <span data-ttu-id="ecbea-276">файл обработчика задачи Hello (TaskProcessor.cs).</span><span class="sxs-lookup"><span data-stu-id="ecbea-276">hello task processor file (TaskProcessor.cs).</span></span> <span data-ttu-id="ecbea-277">Это происходит, где будет размещаться логику приложения для выполнения задачи (обычно посредством вызова tooan существующего исполняемого файла).</span><span class="sxs-lookup"><span data-stu-id="ecbea-277">This is where you will put your application-specific logic for executing a task (typically by calling out tooan existing executable).</span></span> <span data-ttu-id="ecbea-278">Сюда также помещается код предварительной обработки и постобработки, например для скачивания дополнительных данных или отправки файлов результатов.</span><span class="sxs-lookup"><span data-stu-id="ecbea-278">Pre- and post-processing code, such as downloading additional data or uploading result files, also goes here.</span></span>

<span data-ttu-id="ecbea-279">Конечно можно добавить дополнительные файлы как обязательный toosupport код процессора задачи в зависимости от сложности hello задания hello разделение логики.</span><span class="sxs-lookup"><span data-stu-id="ecbea-279">Of course you can add additional files as required toosupport your task processor code, depending on hello complexity of hello job splitting logic.</span></span>

<span data-ttu-id="ecbea-280">шаблон Hello также создает стандартные файлы проекта .NET, например CSPROJ-файл, файл app.config, packages.config и т.д.</span><span class="sxs-lookup"><span data-stu-id="ecbea-280">hello template also generates standard .NET project files such as a .csproj file, app.config, packages.config, etc.</span></span>

<span data-ttu-id="ecbea-281">Hello оставшейся части этого раздела описываются различные файлы hello и их структуру кода и объясняется, что делает каждый класс.</span><span class="sxs-lookup"><span data-stu-id="ecbea-281">hello rest of this section describes hello different files and their code structure, and explains what each class does.</span></span>

![Visual Studio в обозревателе решений hello обработчика задач шаблон решения][solution_explorer02]

<span data-ttu-id="ecbea-283">**Файлы платформы**</span><span class="sxs-lookup"><span data-stu-id="ecbea-283">**Framework files**</span></span>

* <span data-ttu-id="ecbea-284">`Configuration.cs`: Инкапсулирует hello загрузка данных конфигурации задания, например сведения об учетной записи, связанное хранение учетных данных учетной записи, заданий и задач и задания параметров пакета.</span><span class="sxs-lookup"><span data-stu-id="ecbea-284">`Configuration.cs`: Encapsulates hello loading of job configuration data such as Batch account details, linked storage account credentials, job and task information, and job parameters.</span></span> <span data-ttu-id="ecbea-285">Он также предоставляет доступ tooBatch определенные переменные (см. параметры среды для задачи, в документации пакета hello) через класс Configuration.EnvironmentVariable hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-285">It also provides access tooBatch-defined environment variables (see Environment settings for tasks, in hello Batch documentation) via hello Configuration.EnvironmentVariable class.</span></span>
* <span data-ttu-id="ecbea-286">`IConfiguration.cs`: Краткие описания hello реализация hello класс конфигурации, чтобы пользователь мог модульный тест вашего задания разделителю при помощи объекта конфигурации имитируемой или макета.</span><span class="sxs-lookup"><span data-stu-id="ecbea-286">`IConfiguration.cs`: Abstracts hello implementation of hello Configuration class, so that you can unit test your job splitter using a fake or mock configuration object.</span></span>
* <span data-ttu-id="ecbea-287">`TaskProcessorException.cs`: Представляет ошибку, которая требует tooterminate диспетчера заданий hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-287">`TaskProcessorException.cs`: Represents an error that requires hello job manager tooterminate.</span></span> <span data-ttu-id="ecbea-288">TaskProcessorException — ошибки «требуется» используется toowrap где определенные диагностические сведения могут быть предоставлены как часть завершения.</span><span class="sxs-lookup"><span data-stu-id="ecbea-288">TaskProcessorException is used toowrap 'expected' errors where specific diagnostic information can be provided as part of termination.</span></span>

<span data-ttu-id="ecbea-289">**Обработчик задач**</span><span class="sxs-lookup"><span data-stu-id="ecbea-289">**Task Processor**</span></span>

* <span data-ttu-id="ecbea-290">`TaskProcessor.cs`: Запускает задачу hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-290">`TaskProcessor.cs`: Runs hello task.</span></span> <span data-ttu-id="ecbea-291">Hello framework вызывает метод TaskProcessor.Run hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-291">hello framework invokes hello TaskProcessor.Run method.</span></span> <span data-ttu-id="ecbea-292">Это класс hello, где обеспечивает включение логики приложения hello задач.</span><span class="sxs-lookup"><span data-stu-id="ecbea-292">This is hello class where you will inject hello application-specific logic of your task.</span></span> <span data-ttu-id="ecbea-293">Реализуйте метод выполнения hello, чтобы:</span><span class="sxs-lookup"><span data-stu-id="ecbea-293">Implement hello Run method to:</span></span>
  * <span data-ttu-id="ecbea-294">проанализировать и проверить все параметры задачи;</span><span class="sxs-lookup"><span data-stu-id="ecbea-294">Parse and validate any task parameters</span></span>
  * <span data-ttu-id="ecbea-295">Составить hello командной строки для любой внешней программе требуется tooinvoke</span><span class="sxs-lookup"><span data-stu-id="ecbea-295">Compose hello command line for any external program you want tooinvoke</span></span>
  * <span data-ttu-id="ecbea-296">зарегистрировать любые диагностические сведения, которые могут потребоваться для отладки;</span><span class="sxs-lookup"><span data-stu-id="ecbea-296">Log any diagnostic information you may require for debugging purposes</span></span>
  * <span data-ttu-id="ecbea-297">запустить процесс с помощью созданной командной строки;</span><span class="sxs-lookup"><span data-stu-id="ecbea-297">Start a process using that command line</span></span>
  * <span data-ttu-id="ecbea-298">Время ожидания процесса tooexit hello</span><span class="sxs-lookup"><span data-stu-id="ecbea-298">Wait for hello process tooexit</span></span>
  * <span data-ttu-id="ecbea-299">Записывать код выхода процесса toodetermine hello hello, если он успешно или неудачно</span><span class="sxs-lookup"><span data-stu-id="ecbea-299">Capture hello exit code of hello process toodetermine if it succeeded or failed</span></span>
  * <span data-ttu-id="ecbea-300">Сохранить все выходные файлы, необходимые tookeep toopersistent хранилища</span><span class="sxs-lookup"><span data-stu-id="ecbea-300">Save any output files you want tookeep toopersistent storage</span></span>

<span data-ttu-id="ecbea-301">**Стандартные файлы проекта .NET командной строки**</span><span class="sxs-lookup"><span data-stu-id="ecbea-301">**Standard .NET command line project files**</span></span>

* <span data-ttu-id="ecbea-302">`App.config`— стандартный файл конфигурации приложения .NET.</span><span class="sxs-lookup"><span data-stu-id="ecbea-302">`App.config`: Standard .NET application configuration file.</span></span>
* <span data-ttu-id="ecbea-303">`Packages.config` — стандартный файл зависимостей пакета NuGet.</span><span class="sxs-lookup"><span data-stu-id="ecbea-303">`Packages.config`: Standard NuGet package dependency file.</span></span>
* <span data-ttu-id="ecbea-304">`Program.cs`: Содержит точку входа программы hello и обработка исключений верхнего уровня.</span><span class="sxs-lookup"><span data-stu-id="ecbea-304">`Program.cs`: Contains hello program entry point and top-level exception handling.</span></span>

## <a name="implementing-hello-task-processor"></a><span data-ttu-id="ecbea-305">Реализация обработчика задач hello</span><span class="sxs-lookup"><span data-stu-id="ecbea-305">Implementing hello task processor</span></span>
<span data-ttu-id="ecbea-306">При открытии проекта шаблона обработчика задач hello hello проект будет содержать файл TaskProcessor.cs hello открытия по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="ecbea-306">When you open hello Task Processor template project, hello project will have hello TaskProcessor.cs file open by default.</span></span> <span data-ttu-id="ecbea-307">Можно реализовать логику hello выполнения для задач hello в рабочей нагрузке с помощью метода Run() hello, показано ниже:</span><span class="sxs-lookup"><span data-stu-id="ecbea-307">You can implement hello run logic for hello tasks in your workload by using hello Run() method shown below:</span></span>

```csharp
/// <summary>
/// Runs hello task processing logic. This is where you inject
/// your application-specific logic for decomposing hello job into tasks.
///
/// hello task processor framework invokes hello Run method for you; you need
/// only tooimplement it, not toocall it yourself. Typically, your
/// implementation will execute an external program (from resource files or
/// an application package), check hello exit code of that program and
/// save output files toopersistent storage.
/// </summary>
public async Task<int> Run()

{
    try
    {
        //Your code for hello task processor goes here.
        var command = $"compare {_parameters["Frame1"]} {_parameters["Frame2"]} compare.gif";
        using (var process = Process.Start($"cmd /c {command}"))
        {
            process.WaitForExit();
            var taskOutputStorage = new TaskOutputStorage(
            _configuration.StorageAccount,
            _configuration.JobId,
            _configuration.TaskId
            );
            await taskOutputStorage.SaveAsync(
            TaskOutputKind.TaskOutput,
            @"..\stdout.txt",
            @"stdout.txt"
            );
            return process.ExitCode;
        }
    }
    catch (Exception ex)
    {
        throw new TaskProcessorException(
        $"{ex.GetType().Name} exception in run task processor: {ex.Message}",
        ex
        );
    }
}
```
> [!NOTE]
> <span data-ttu-id="ecbea-308">Hello заметками раздела hello метода Run() — только часть hello hello обработчика задач шаблона код, который предназначен для вас toomodify добавления логики hello запуска задачи hello в рабочей нагрузке.</span><span class="sxs-lookup"><span data-stu-id="ecbea-308">hello annotated section in hello Run() method is hello only section of hello Task Processor template code that is intended for you toomodify by adding hello run logic for hello tasks in your workload.</span></span> <span data-ttu-id="ecbea-309">Если вы хотите toomodify в другой раздел шаблона hello, обратитесь сначала ознакомиться с работу пакета, изучите документацию пакета hello и ознакомление в некоторых образцах кода hello пакета.</span><span class="sxs-lookup"><span data-stu-id="ecbea-309">If you want toomodify a different section of hello template, please first familiarize yourself with how Batch works by reviewing hello Batch documentation and trying out a few of hello Batch code samples.</span></span>
> 
> 

<span data-ttu-id="ecbea-310">Hello Run() метод отвечает за запуск hello командной строки, запуск одного или нескольких процессов, Ожидание всех toocomplete процесса сохранения результатов hello и возврат и, наконец, код выхода.</span><span class="sxs-lookup"><span data-stu-id="ecbea-310">hello Run() method is responsible for launching hello command line, starting one or more processes, waiting for all process toocomplete, saving hello results, and finally returning with an exit code.</span></span> <span data-ttu-id="ecbea-311">Метод Run() Hello — где реализовать логику для задач обработки hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-311">hello Run() method is where you implement hello processing logic for your tasks.</span></span> <span data-ttu-id="ecbea-312">Процессор платформы Hello задач вызывает метод Run() hello Нет необходимости toocall его самостоятельно.</span><span class="sxs-lookup"><span data-stu-id="ecbea-312">hello task processor framework invokes hello Run() method for you; you do not need toocall it yourself.</span></span>

<span data-ttu-id="ecbea-313">Для реализации метода Run() доступны такие компоненты:</span><span class="sxs-lookup"><span data-stu-id="ecbea-313">Your Run() implementation has access to:</span></span>

* <span data-ttu-id="ecbea-314">Здравствуйте, параметры задачи, через hello `_parameters` поля.</span><span class="sxs-lookup"><span data-stu-id="ecbea-314">hello task parameters, via hello `_parameters` field.</span></span>
* <span data-ttu-id="ecbea-315">Здравствуйте, идентификаторы заданий и задач, через hello `_jobId` и `_taskId` поля.</span><span class="sxs-lookup"><span data-stu-id="ecbea-315">hello job and task ids, via hello `_jobId` and `_taskId` fields.</span></span>
* <span data-ttu-id="ecbea-316">конфигурации задачи Hello, через hello `_configuration` поля.</span><span class="sxs-lookup"><span data-stu-id="ecbea-316">hello task configuration, via hello `_configuration` field.</span></span>

<span data-ttu-id="ecbea-317">**Сбой выполнения задачи**</span><span class="sxs-lookup"><span data-stu-id="ecbea-317">**Task failure**</span></span>

<span data-ttu-id="ecbea-318">В случае сбоя можно выйти из метода Run() hello, создавая исключение, но это оставляет обработчик исключений верхнего уровня hello контролируете код выхода задачи hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-318">In case of failure, you can exit hello Run() method by throwing an exception, but this leaves hello top level exception handler in control of hello task exit code.</span></span> <span data-ttu-id="ecbea-319">При необходимости код выхода toocontrol hello, чтобы отличать разные типы сбоев, например в целях диагностики, или из-за некоторых режимах сбоя завершать задания hello и другие не должны, а затем метод Run() hello должны завершать работу, возвращая код выхода ненулевое значение.</span><span class="sxs-lookup"><span data-stu-id="ecbea-319">If you need toocontrol hello exit code so that you can distinguish different types of failure, for example for diagnostic purposes or because some failure modes should terminate hello job and others should not, then you should exit hello Run() method by returning a non-zero exit code.</span></span> <span data-ttu-id="ecbea-320">Это становится hello код завершения задачи.</span><span class="sxs-lookup"><span data-stu-id="ecbea-320">This becomes hello task exit code.</span></span>

### <a name="exit-codes-and-exceptions-in-hello-task-processor-template"></a><span data-ttu-id="ecbea-321">Выйти из кодов и исключения в шаблоне hello обработчика задач</span><span class="sxs-lookup"><span data-stu-id="ecbea-321">Exit codes and exceptions in hello Task Processor template</span></span>
<span data-ttu-id="ecbea-322">Коды выхода и исключения предоставляют механизм toodetermine hello результат запуска программы, и они помогают выявлять проблемы с выполнением hello программы hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-322">Exit codes and exceptions provide a mechanism toodetermine hello outcome of running a program, and they can help identify any problems with hello execution of hello program.</span></span> <span data-ttu-id="ecbea-323">шаблон обработчика задач Hello реализует коды завершения hello и исключения, описанные в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="ecbea-323">hello Task Processor template implements hello exit codes and exceptions described in this section.</span></span>

<span data-ttu-id="ecbea-324">Задача процессора задачу, которая реализуется с помощью шаблона hello обработчика задач может вернуть три возможных выхода кода:</span><span class="sxs-lookup"><span data-stu-id="ecbea-324">A task processor task that is implemented with hello Task Processor template can return three possible exit codes:</span></span>

| <span data-ttu-id="ecbea-325">Код</span><span class="sxs-lookup"><span data-stu-id="ecbea-325">Code</span></span> | <span data-ttu-id="ecbea-326">Описание</span><span class="sxs-lookup"><span data-stu-id="ecbea-326">Description</span></span> |
| --- | --- |
| <span data-ttu-id="ecbea-327">[Process.ExitCode][process_exitcode]</span><span class="sxs-lookup"><span data-stu-id="ecbea-327">[Process.ExitCode][process_exitcode]</span></span> |<span data-ttu-id="ecbea-328">Процессор Hello задачи выполнялись toocompletion.</span><span class="sxs-lookup"><span data-stu-id="ecbea-328">hello task processor ran toocompletion.</span></span> <span data-ttu-id="ecbea-329">Обратите внимание, что это не означает, что происходит при вызове программы hello успешность — только этому процессору hello задача успешно вызвана и выполнить любую необходимую обработку без исключений.</span><span class="sxs-lookup"><span data-stu-id="ecbea-329">Note that this does not imply that hello program you invoked was successful – only that hello task processor invoked it successfully and performed any post-processing without exceptions.</span></span> <span data-ttu-id="ecbea-330">Hello значение кода выхода hello зависит от программы hello вызывается — обычно код выхода 0 означает успешное применение программы hello и любой другой код выхода указывает на сбой программы hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-330">hello meaning of hello exit code depends on hello invoked program – typically exit code 0 means hello program succeeded and any other exit code means hello program failed.</span></span> |
| <span data-ttu-id="ecbea-331">1</span><span class="sxs-lookup"><span data-stu-id="ecbea-331">1</span></span> |<span data-ttu-id="ecbea-332">Hello задач не удалось инициализировать обработчик исключение в «ожидаемый» части программы hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-332">hello task processor failed with an exception in an 'expected' part of hello program.</span></span> <span data-ttu-id="ecbea-333">Hello исключение переведенные tooa `TaskProcessorException` с диагностической информацией и, где это возможно, предложения по разрешению hello сбоя.</span><span class="sxs-lookup"><span data-stu-id="ecbea-333">hello exception was translated tooa `TaskProcessorException` with diagnostic information and, where possible, suggestions for resolving hello failure.</span></span> |
| <span data-ttu-id="ecbea-334">2</span><span class="sxs-lookup"><span data-stu-id="ecbea-334">2</span></span> |<span data-ttu-id="ecbea-335">Hello задач не удалось инициализировать обработчик с исключением «Непредвиденная».</span><span class="sxs-lookup"><span data-stu-id="ecbea-335">hello task processor failed with an 'unexpected' exception.</span></span> <span data-ttu-id="ecbea-336">Hello исключения был регистрируется toostandard выходных данных, но обработчика задач hello не удается tooadd любые дополнительные сведения диагностики и исправления.</span><span class="sxs-lookup"><span data-stu-id="ecbea-336">hello exception was logged toostandard output, but hello task processor was unable tooadd any additional diagnostic or remediation information.</span></span> |

> [!NOTE]
> <span data-ttu-id="ecbea-337">Если hello, вызываемой программой режимы конкретный сбой tooindicate 1 и 2 коды выхода, затем с помощью кодов выхода 1 и 2 для ошибок процессора задачи является неоднозначным.</span><span class="sxs-lookup"><span data-stu-id="ecbea-337">If hello program you invoke uses exit codes 1 and 2 tooindicate specific failure modes, then using exit codes 1 and 2 for task processor errors is ambiguous.</span></span> <span data-ttu-id="ecbea-338">Эти задачи процессора коды toodistinctive кодов ошибок завершения можно изменить, изменив случаев исключений hello в файл Program.cs hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-338">You can change these task processor error codes toodistinctive exit codes by editing hello exception cases in hello Program.cs file.</span></span>
> 
> 

<span data-ttu-id="ecbea-339">Все hello информацию, возвращаемую исключения записываются в файлы stdout.txt и stderr.txt.</span><span class="sxs-lookup"><span data-stu-id="ecbea-339">All hello information returned by exceptions is written into stdout.txt and stderr.txt files.</span></span> <span data-ttu-id="ecbea-340">Дополнительные сведения см. в документации пакета hello обработку ошибок.</span><span class="sxs-lookup"><span data-stu-id="ecbea-340">For more information, see Error Handling, in hello Batch documentation.</span></span>

### <a name="client-considerations"></a><span data-ttu-id="ecbea-341">Рекомендации для клиента</span><span class="sxs-lookup"><span data-stu-id="ecbea-341">Client considerations</span></span>
<span data-ttu-id="ecbea-342">**Учетные данные хранилища**</span><span class="sxs-lookup"><span data-stu-id="ecbea-342">**Storage credentials**</span></span>

<span data-ttu-id="ecbea-343">Если задача процессором выходов toopersist хранилища BLOB-объектов Azure, например с помощью hello файл соглашения вспомогательную библиотеку, то необходим доступ слишком*либо* hello облачные учетные данные учетной записи хранилища *или* URL контейнер больших двоичных объектов, который содержит подписанный URL-адрес (SAS).</span><span class="sxs-lookup"><span data-stu-id="ecbea-343">If your task processor uses Azure blob storage toopersist outputs, for example using hello file conventions helper library, then it needs access too*either* hello cloud storage account credentials *or* a blob container URL that includes a shared access signature (SAS).</span></span> <span data-ttu-id="ecbea-344">шаблон Hello включает поддержку для предоставления учетных данных через общие переменные среды.</span><span class="sxs-lookup"><span data-stu-id="ecbea-344">hello template includes support for providing credentials via common environment variables.</span></span> <span data-ttu-id="ecbea-345">Ваш клиент может передать учетные данные хранилища hello следующим образом:</span><span class="sxs-lookup"><span data-stu-id="ecbea-345">Your client can pass hello storage credentials as follows:</span></span>

```csharp
job.CommonEnvironmentSettings = new [] {
    new EnvironmentSetting("LINKED_STORAGE_ACCOUNT", "{storageAccountName}"),
    new EnvironmentSetting("LINKED_STORAGE_KEY", "{storageAccountKey}"),
};
```

<span data-ttu-id="ecbea-346">Учетная запись хранения Hello становится доступным в hello TaskProcessor класс с помощью hello `_configuration.StorageAccount` свойство.</span><span class="sxs-lookup"><span data-stu-id="ecbea-346">hello storage account is then available in hello TaskProcessor class via hello `_configuration.StorageAccount` property.</span></span>

<span data-ttu-id="ecbea-347">Если вы предпочитаете toouse URL-адрес контейнера с сопоставлениями безопасности, это также можно передать через общие параметры среды задания, но hello задач процессора шаблон в настоящее время не включает встроенную поддержку.</span><span class="sxs-lookup"><span data-stu-id="ecbea-347">If you prefer toouse a container URL with SAS, you can also pass this via an job common environment setting, but hello task processor template does not currently include built-in support for this.</span></span>

<span data-ttu-id="ecbea-348">**Настройка хранилища**</span><span class="sxs-lookup"><span data-stu-id="ecbea-348">**Storage setup**</span></span>

<span data-ttu-id="ecbea-349">Рекомендуется, hello клиента или задание диспетчера задач Создать все контейнеры, необходимые задачи перед добавлением hello задачи toohello задания.</span><span class="sxs-lookup"><span data-stu-id="ecbea-349">It is recommended that hello client or job manager task create any containers required by tasks before adding hello tasks toohello job.</span></span> <span data-ttu-id="ecbea-350">Это является обязательным, если используется URL-адрес контейнера и SAS, таким образом URL-адрес не включает разрешение toocreate hello контейнер.</span><span class="sxs-lookup"><span data-stu-id="ecbea-350">This is mandatory if you use a container URL with SAS, as such a URL does not include permission toocreate hello container.</span></span> <span data-ttu-id="ecbea-351">Рекомендуется даже при передаче учетных данных учетной записи хранения, как она сохраняет каждой задачи с toocall CloudBlobContainer.CreateIfNotExistsAsync на контейнер hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-351">It is recommended even if you pass storage account credentials, as it saves every task having toocall CloudBlobContainer.CreateIfNotExistsAsync on hello container.</span></span>

## <a name="pass-parameters-and-environment-variables"></a><span data-ttu-id="ecbea-352">Передача параметров и переменных среды</span><span class="sxs-lookup"><span data-stu-id="ecbea-352">Pass parameters and environment variables</span></span>
### <a name="pass-environment-settings"></a><span data-ttu-id="ecbea-353">Передача параметров среды</span><span class="sxs-lookup"><span data-stu-id="ecbea-353">Pass environment settings</span></span>
<span data-ttu-id="ecbea-354">Клиент может передать сведения toohello задачи диспетчера заданий в форме hello параметров среды.</span><span class="sxs-lookup"><span data-stu-id="ecbea-354">A client can pass information toohello job manager task in hello form of environment settings.</span></span> <span data-ttu-id="ecbea-355">Эти сведения могут затем использоваться hello задачи диспетчера заданий при генерации hello задач процессора задачи, которые будут выполняться как часть hello вычислений задания.</span><span class="sxs-lookup"><span data-stu-id="ecbea-355">This information can then be used by hello job manager task when generating hello task processor tasks that will run as part of hello compute job.</span></span> <span data-ttu-id="ecbea-356">Приведены примеры hello сведений, можно передать в качестве параметров среды.</span><span class="sxs-lookup"><span data-stu-id="ecbea-356">Examples of hello information that you can pass as environment settings are:</span></span>

* <span data-ttu-id="ecbea-357">имя учетной записи хранения и ключ учетной записи;</span><span class="sxs-lookup"><span data-stu-id="ecbea-357">Storage account name and account keys</span></span>
* <span data-ttu-id="ecbea-358">URL-адрес учетной записи пакетной службы;</span><span class="sxs-lookup"><span data-stu-id="ecbea-358">Batch account URL</span></span>
* <span data-ttu-id="ecbea-359">ключ учетной записи пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="ecbea-359">Batch account key</span></span>

<span data-ttu-id="ecbea-360">Hello пакетная служба имеет простой механизм toopass среде параметры tooa задачи диспетчера заданий с помощью hello `EnvironmentSettings` свойство в [Microsoft.Azure.Batch.JobManagerTask][net_jobmanagertask].</span><span class="sxs-lookup"><span data-stu-id="ecbea-360">hello Batch service has a simple mechanism toopass environment settings tooa job manager task by using hello `EnvironmentSettings` property in [Microsoft.Azure.Batch.JobManagerTask][net_jobmanagertask].</span></span>

<span data-ttu-id="ecbea-361">Например, tooget hello `BatchClient` экземпляра для пакетной учетной записи, можно передать как переменные среды из клиента hello кода hello URL-адрес и общих ключей учетных данных для учетной записи пакетной hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-361">For example, tooget hello `BatchClient` instance for a Batch account, you can pass as environment variables from hello client code hello URL and shared key credentials for hello Batch account.</span></span> <span data-ttu-id="ecbea-362">Аналогичным образом учетной записи хранилища tooaccess hello, связанных toohello пакетной учетной записи, имя учетной записи хранения hello и ключ учетной записи хранения hello можно передать в качестве переменных среды.</span><span class="sxs-lookup"><span data-stu-id="ecbea-362">Likewise, tooaccess hello storage account that is linked toohello Batch account, you can pass hello storage account name and hello storage account key as environment variables.</span></span>

### <a name="pass-parameters-toohello-job-manager-template"></a><span data-ttu-id="ecbea-363">Передать параметры toohello диспетчера заданий шаблона</span><span class="sxs-lookup"><span data-stu-id="ecbea-363">Pass parameters toohello Job Manager template</span></span>
<span data-ttu-id="ecbea-364">Во многих случаях это полезно toopass-задание параметров toohello задачи диспетчера заданий, разделения процесса hello задания либо toocontrol система или tooconfigure hello задачи для hello задания.</span><span class="sxs-lookup"><span data-stu-id="ecbea-364">In many cases, it's useful toopass per-job parameters toohello job manager task, either toocontrol hello job splitting process or tooconfigure hello tasks for hello job.</span></span> <span data-ttu-id="ecbea-365">Это можно сделать путем передачи JSON-файл с именем parameters.json как файл ресурсов для задачи диспетчера заданий hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-365">You can do this by uploading a JSON file named parameters.json as a resource file for hello job manager task.</span></span> <span data-ttu-id="ecbea-366">Параметры Hello затем могут стать доступны в hello `JobSplitter._parameters` в шаблон hello диспетчера заданий.</span><span class="sxs-lookup"><span data-stu-id="ecbea-366">hello parameters can then become available in hello `JobSplitter._parameters` field in hello Job Manager template.</span></span>

> [!NOTE]
> <span data-ttu-id="ecbea-367">Обработчик встроенных параметров Hello поддерживает только словарях строку в строку.</span><span class="sxs-lookup"><span data-stu-id="ecbea-367">hello built-in parameter handler supports only string-to-string dictionaries.</span></span> <span data-ttu-id="ecbea-368">Следует toopass сложных значений JSON как значения параметров будут необходимые toopass как строки и проанализировать их в разделителей задания hello или изменить hello framework `Configuration.GetJobParameters` метод.</span><span class="sxs-lookup"><span data-stu-id="ecbea-368">If you want toopass complex JSON values as parameter values, you will need toopass these as strings and parse them in hello job splitter, or modify hello framework's `Configuration.GetJobParameters` method.</span></span>
> 
> 

### <a name="pass-parameters-toohello-task-processor-template"></a><span data-ttu-id="ecbea-369">Передать параметры toohello обработчика задач шаблона</span><span class="sxs-lookup"><span data-stu-id="ecbea-369">Pass parameters toohello Task Processor template</span></span>
<span data-ttu-id="ecbea-370">Можно также передавать параметры задачи tooindividual реализовано с помощью шаблона hello обработчика задач.</span><span class="sxs-lookup"><span data-stu-id="ecbea-370">You can also pass parameters tooindividual tasks implemented using hello Task Processor template.</span></span> <span data-ttu-id="ecbea-371">Так же, как с помощью шаблона диспетчера заданий hello, hello задач процессора шаблон ищет файл ресурсов с именем</span><span class="sxs-lookup"><span data-stu-id="ecbea-371">Just as with hello job manager template, hello task processor template looks for a resource file named</span></span>

<span data-ttu-id="ecbea-372">Parameters.JSON и если он найден, он загружает их в виде словаря параметров hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-372">parameters.json, and if found it loads it as hello parameters dictionary.</span></span> <span data-ttu-id="ecbea-373">Существует два способа как задачи процессора в toohello toopass параметры:</span><span class="sxs-lookup"><span data-stu-id="ecbea-373">There are a couple of options for how toopass parameters toohello task processor tasks:</span></span>

* <span data-ttu-id="ecbea-374">Повторное использование параметров задания hello JSON.</span><span class="sxs-lookup"><span data-stu-id="ecbea-374">Reuse hello job parameters JSON.</span></span> <span data-ttu-id="ecbea-375">Эта функция работает также в том случае, если только параметры hello являются расширенными задания (для примера, отрисовки высоту и ширину).</span><span class="sxs-lookup"><span data-stu-id="ecbea-375">This works well if hello only parameters are job-wide ones (for example, a render height and width).</span></span> <span data-ttu-id="ecbea-376">toodo, при создании CloudTask в hello задания разделителей, добавить объект файла ресурса parameters.json toohello ссылку из hello задачи диспетчера заданий элемента ResourceFiles (`JobSplitter._jobManagerTask.ResourceFiles`) toohello CloudTask ResourceFiles коллекции.</span><span class="sxs-lookup"><span data-stu-id="ecbea-376">toodo this, when creating a CloudTask in hello job splitter, add a reference toohello parameters.json resource file object from hello job manager task's ResourceFiles (`JobSplitter._jobManagerTask.ResourceFiles`) toohello CloudTask's ResourceFiles collection.</span></span>
* <span data-ttu-id="ecbea-377">Создание и отправка документа parameters.json определенных задач в ходе выполнения задания разделителей и ссылаются на этот большой двоичный объект в коллекцию файлов ресурсов задачу hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-377">Generate and upload a task-specific parameters.json document as part of job splitter execution, and reference that blob in hello task's resource files collection.</span></span> <span data-ttu-id="ecbea-378">Это необходимо, если в разных задачах используются разные параметры.</span><span class="sxs-lookup"><span data-stu-id="ecbea-378">This is necessary if different tasks have different parameters.</span></span> <span data-ttu-id="ecbea-379">Примером может служить сценарий трехмерной отрисовки, где индекс кадров hello задача будет передана toohello как параметр.</span><span class="sxs-lookup"><span data-stu-id="ecbea-379">An example might be a 3D rendering scenario where hello frame index is passed toohello task as a parameter.</span></span>

> [!NOTE]
> <span data-ttu-id="ecbea-380">Обработчик встроенных параметров Hello поддерживает только словарях строку в строку.</span><span class="sxs-lookup"><span data-stu-id="ecbea-380">hello built-in parameter handler supports only string-to-string dictionaries.</span></span> <span data-ttu-id="ecbea-381">Следует toopass сложных значений JSON как значения параметров будут необходимые toopass как строки и проанализировать их в процессоре задача hello или изменить hello framework `Configuration.GetTaskParameters` метод.</span><span class="sxs-lookup"><span data-stu-id="ecbea-381">If you want toopass complex JSON values as parameter values, you will need toopass these as strings and parse them in hello task processor, or modify hello framework's `Configuration.GetTaskParameters` method.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="ecbea-382">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="ecbea-382">Next steps</span></span>
### <a name="persist-job-and-task-output-tooazure-storage"></a><span data-ttu-id="ecbea-383">Сохранение заданий и задач tooAzure выходные данные хранилища</span><span class="sxs-lookup"><span data-stu-id="ecbea-383">Persist job and task output tooAzure Storage</span></span>
<span data-ttu-id="ecbea-384">Еще одно полезное средство в разработке решений пакетной службы — [Azure Batch File Conventions][nuget_package].</span><span class="sxs-lookup"><span data-stu-id="ecbea-384">Another helpful tool in Batch solution development is [Azure Batch File Conventions][nuget_package].</span></span> <span data-ttu-id="ecbea-385">Используйте Эта библиотека классов .NET (в настоящее время в предварительной версии) в хранилище tooeasily приложений пакета .NET и получить tooand выходные данные задачи из хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="ecbea-385">Use this .NET class library (currently in preview) in your Batch .NET applications tooeasily store and retrieve task outputs tooand from Azure Storage.</span></span> <span data-ttu-id="ecbea-386">[Сохранение выходных данных заданий и задач пакетной службы Azure](batch-task-output.md) содержит полное описание библиотеки hello и их использование.</span><span class="sxs-lookup"><span data-stu-id="ecbea-386">[Persist Azure Batch job and task output](batch-task-output.md) contains a full discussion of hello library and its usage.</span></span>

### <a name="batch-forum"></a><span data-ttu-id="ecbea-387">Форум по Пакетной службе</span><span class="sxs-lookup"><span data-stu-id="ecbea-387">Batch Forum</span></span>
<span data-ttu-id="ecbea-388">Hello [форум по пакетной Azure] [ forum] на сайте MSDN — лучшие поместите toodiscuss пакета и ответы на вопросы о службе hello.</span><span class="sxs-lookup"><span data-stu-id="ecbea-388">hello [Azure Batch Forum][forum] on MSDN is a great place toodiscuss Batch and ask questions about hello service.</span></span> <span data-ttu-id="ecbea-389">Изучайте полезные «прикрепленные» сообщения и задавайте вопросы, возникающие во время сборки пакетных решений.</span><span class="sxs-lookup"><span data-stu-id="ecbea-389">Head on over for helpful "sticky" posts, and post your questions as they arise while you build your Batch solutions.</span></span>

[forum]: https://social.msdn.microsoft.com/forums/azure/en-US/home?forum=azurebatch
[net_jobmanagertask]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.jobmanagertask.aspx
[github_samples]: https://github.com/Azure/azure-batch-samples
[nuget_package]: https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files
[process_exitcode]: https://msdn.microsoft.com/library/system.diagnostics.process.exitcode.aspx
[vs_gallery]: https://visualstudiogallery.msdn.microsoft.com/
[vs_gallery_templates]: https://go.microsoft.com/fwlink/?linkid=820714
[vs_find_use_ext]: https://msdn.microsoft.com/library/dd293638.aspx

[diagram01]: ./media/batch-visual-studio-templates/diagram01.png
[solution_explorer01]: ./media/batch-visual-studio-templates/solution_explorer01.png
[solution_explorer02]: ./media/batch-visual-studio-templates/solution_explorer02.png
