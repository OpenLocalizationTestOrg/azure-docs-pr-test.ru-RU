---
title: "Создание пакета решения с помощью шаблонов проектов Visual Studio - Azure aaaStart | Документы Microsoft"
description: "Узнайте, как шаблоны проектов Visual Studio помогут реализовать и выполнить ресурсоемкие рабочие нагрузки в пакетной службе Azure."
services: batch
documentationcenter: .net
author: fayora
manager: timlt
editor: 
ms.assetid: 5e041ae2-25af-4882-a79e-3aa63c4bfb20
ms.service: batch
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: big-compute
ms.date: 02/27/2017
ms.author: tamram
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: a61c480ddc4dffd66c01220a137a3e852e39c338
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="use-visual-studio-project-templates-toojump-start-batch-solutions"></a>Использование решений пакета toojump начала шаблоны проекта Visual Studio

Hello **диспетчера заданий** и **шаблонов Visual Studio задач процессора** для пакета предоставляют toohelp кода вы tooimplement и выполнения ресурсоемких рабочих нагрузок в пакете с hello бы трудозатрат. В этом документе описываются эти шаблоны и руководство toouse их.

> [!IMPORTANT]
> В этой статье рассматриваются только сведения применимо toothese двух шаблонов и предполагает, что вы знакомы с пакетной службы hello и связанные tooit основные понятия: пулы, вычислительные узлы, заданий и задач, задачи диспетчера заданий, переменные среды и другие важные сведения. Можно найти дополнительные сведения в [основы пакета Azure](batch-technical-overview.md), [пакета Обзор возможностей для разработчиков](batch-api-basics.md), и [начало работы с библиотекой hello пакетной службы Azure для .NET](batch-dotnet-get-started.md).
> 
> 

## <a name="high-level-overview"></a>Общий обзор
Hello диспетчера заданий и задач обработчика шаблоны могут быть toocreate используется два полезных компонентов:

* Задачу диспетчера заданий, позволяющую внедрить разделитель заданий. Благодаря ему можно разбить задание на несколько задач, которые могут выполняться независимо в параллельном режиме.
* Процессор задачи, который может быть используется tooperform предварительной обработки и последующей обработки вокруг приложения командной строки.

Например в случае подготовки к просмотру фильма hello задания разделителей будет превратить задания одного фильма в сотен или тысяч отдельные задачи, которые будут обрабатывать отдельные кадры отдельно. Соответственно обработчика задач hello бы вызвать hello отрисовки приложения и все зависимые процессы, необходимые toorender каждого кадра, а также выполнять каких-либо дополнительных действий (например, копирование hello к просмотру кадра tooa место хранения).

> [!NOTE]
> шаблоны диспетчера заданий и задач процессора Hello независимо друг от друга, поэтому вы можете выбрать toouse, оба или только один из них, в зависимости от требований hello задания вычислений и настройками.
> 
> 

Как показано в приведенной ниже схеме hello вычислительного задания, использующего эти шаблоны проходит через три этапа:

1. Hello клиентский код (например, приложения, веб-службы, т. д.) отправляет задание toohello пакетной службы в Azure, указав в качестве его задание диспетчера задач hello manager программе задания.
2. Hello пакетная служба запускает hello задачи диспетчера заданий на вычислительном узле и hello hello запускает задание разделителя указан количество задач обработчика задач, на как многие вычислительных узлов, при необходимости, на основе параметров hello и спецификации в коде разделителей hello задания.
3. Hello задач процессора задачи выполняются независимо друг от друга, в параллельном режиме, tooprocess hello входные данные и создавать hello выходных данных.

![Схема, показывающая, как клиентский код взаимодействует с hello пакетная служба][diagram01]

## <a name="prerequisites"></a>Предварительные требования
шаблоны пакета toouse hello, вам потребуется hello следующее:

* Компьютер, на который установлено программное обеспечение Visual Studio 2015. В настоящее время поддерживаются только шаблоны пакетной службы для Visual Studio 2015.
* шаблоны пакета Hello, которые доступны из hello [коллекции Visual Studio] [ vs_gallery] как расширения Visual Studio. Существует два способа tooget hello шаблонов:
  
  * Установка с помощью hello шаблонов hello **расширения и обновления** диалоговое окно в Visual Studio (Дополнительные сведения см. в разделе [поиск и использование расширений Visual Studio][vs_find_use_ext]). В hello **расширения и обновления** диалоговое окно, поиска и загрузки hello, следующие два расширения:
    
    * диспетчер заданий пакетной службы Azure с разделителем заданий;
    * обработчик задач пакетной службы Azure.
  * Загрузить шаблоны hello с hello в Интернете для Visual Studio: [шаблоны проектов пакета Microsoft Azure][vs_gallery_templates]
* Если планируется toouse hello [пакетов приложений](batch-application-packages.md) диспетчера заданий hello toodeploy функции и задачи процессора toohello пакета вычислительных узлов, вы должны toolink tooyour учетной записи хранилища учетной записи пакетной службы.

## <a name="preparation"></a>Подготовка
Рекомендуется создать решение, которое может содержать ваш Диспетчер заданий, а также задачи процессора, так как это можно сделать проще tooshare кода между диспетчера заданий и задач процессора программы. toocreate этого решения, выполните следующие действия:

1. Откройте Visual Studio и выберите **Файл** > **Создать** > **Проект**.
2. В разделе **Шаблоны** разверните список **Другие типы проектов**, щелкните **Решения Visual Studio** и выберите **Новое решение**.
3. Введите имя, описывающее приложение и hello цели данного решения (например, «LitwareBatchTaskPrograms»).
4. Здравствуйте, toocreate новое решение, нажмите кнопку **ОК**.

## <a name="job-manager-template"></a>Шаблон "Диспетчер заданий"
шаблон диспетчера заданий Hello помогает tooimplement задача диспетчера заданий, которые может выполнить hello, следующие действия:

* разделение задания на несколько задач;
* Отправьте toorun эти задачи в пакете.

> [!NOTE]
> Дополнительные сведения о задачах диспетчера заданий см. в статье [Обзор функций пакетной службы для разработчиков](batch-api-basics.md#job-manager-task).
> 
> 

### <a name="create-a-job-manager-using-hello-template"></a>Создание диспетчера заданий, с помощью шаблона hello
tooadd решение toohello диспетчера заданий, созданной ранее, выполните следующие действия.

1. Откройте имеющееся решение в Visual Studio.
2. В обозревателе решений щелкните решение правой кнопкой мыши hello, нажмите кнопку **добавить** > **новый проект**.
3. В разделе **Visual C#** щелкните **Облако**, а затем — **Azure Batch Job Manager with Job Splitter** (Диспетчер заданий пакетной службы Azure с разделителем заданий).
4. Введите имя, которое описывает приложение и определяет этот проект как hello диспетчера заданий (например) LitwareJobManager).
5. toocreate hello проекта, нажмите кнопку **ОК**.
6. Наконец Visual Studio tooforce tooload для построения hello проекта все ссылки на пакеты NuGet и tooverify, hello проекта является допустимым, прежде чем начать, его изменения.

### <a name="job-manager-template-files-and-their-purpose"></a>Файлы шаблона "Диспетчер заданий" и их назначение
При создании проекта с помощью шаблона диспетчера заданий hello, он создает три группы файлов кода:

* файл основной программы Hello (Program.cs). Оно содержит точку входа программы hello и обработка исключений верхнего уровня. Не следует обычно toomodify это необходимо.
* каталог платформы Hello. Это файлы hello ответственность за работы «стандартный» hello, выполненной программой hello задания manager – распаковке файлов параметров, добавление задач toohello пакетного задания и т. д. Вы не должны обычно требуется toomodify эти файлы.
* файл разделителя задания Hello (JobSplitter.cs). Именно в него помещается логика приложения для разделения задания на задачи.

Конечно можно добавить дополнительные файлы как обязательный toosupport коде разделителей задания в зависимости от сложности hello задания hello разделение логики.

шаблон Hello также создает стандартные файлы проекта .NET, например CSPROJ-файл, файл app.config, packages.config и т.д.

Hello оставшейся части этого раздела описываются различные файлы hello и их структуру кода и объясняется, что делает каждый класс.

![Visual Studio в обозревателе решений hello диспетчера заданий шаблон решения][solution_explorer01]

**Файлы платформы**

* `Configuration.cs`: Инкапсулирует hello загрузка данных конфигурации задания, например сведения об учетной записи, связанное хранение учетных данных учетной записи, заданий и задач и задания параметров пакета. Он также предоставляет доступ tooBatch определенные переменные (см. параметры среды для задачи, в документации пакета hello) через класс Configuration.EnvironmentVariable hello.
* `IConfiguration.cs`: Краткие описания hello реализация hello класс конфигурации, чтобы пользователь мог модульный тест вашего задания разделителю при помощи объекта конфигурации имитируемой или макета.
* `JobManager.cs`: Координирует hello компоненты программы диспетчера заданий hello. Он отвечает за hello инициализация задания разделителей hello, вызов разделителя задания hello, и диспетчеризации задачи hello, возвращенный отправителю hello задания разделителей toohello задачи.
* `JobManagerException.cs`: Представляет ошибку, которая требует tooterminate диспетчера заданий hello. JobManagerException — ошибки «требуется» используется toowrap где определенные диагностические сведения могут быть предоставлены как часть завершения.
* `TaskSubmitter.cs`: Этот класс является ответственным tooadding задачи, возвращенных hello задания разделителей toohello пакетного задания. Класс JobManager Hello агрегирует hello последовательность задач, в виде пакетов для добавления эффективными, но своевременно toohello задания, а затем вызывает TaskSubmitter.SubmitTasks в фоновый поток для каждого пакета.

**Разделитель заданий**

`JobSplitter.cs`: Этот класс содержит логику приложения для разделения hello задания на задачи. Hello framework вызывает hello JobSplitter.Split метод tooobtain последовательности задач, которые он добавляет задание toohello как метод hello возвращает их. Это класс hello, в котором обеспечивает включение логики hello задания. Реализуйте hello разбить метод tooreturn последовательность экземпляров CloudTask, представляющий hello задачи, в которых требуется задание toopartition hello.

**Стандартные файлы проекта .NET командной строки**

* `App.config`— стандартный файл конфигурации приложения .NET.
* `Packages.config` — стандартный файл зависимостей пакета NuGet.
* `Program.cs`: Содержит точку входа программы hello и обработка исключений верхнего уровня.

### <a name="implementing-hello-job-splitter"></a>Реализация разделителя задания hello
При открытии проекта шаблона диспетчера заданий hello hello проект будет содержать файл JobSplitter.cs hello открытия по умолчанию. Можно реализовать hello разделить логику для задачи hello в рабочей нагрузке с помощью в следующем примере показан метод Split() hello.

```csharp
/// <summary>
/// Gets hello tasks into which toosplit hello job. This is where you inject
/// your application-specific logic for decomposing hello job into tasks.
///
/// hello job manager framework invokes hello Split method for you; you need
/// only tooimplement it, not toocall it yourself. Typically, your
/// implementation should return tasks lazily, for example using a C#
/// iterator and hello "yield return" statement; this allows tasks toobe added
/// and toostart running while splitting is still in progress.
/// </summary>
/// <returns>hello tasks toobe added toohello job. Tasks are added automatically
/// by hello job manager framework as they are returned by this method.</returns>
public IEnumerable<CloudTask> Split()
{
    // Your code for hello split logic goes here.
    int startFrame = Convert.ToInt32(_parameters["StartFrame"]);
    int endFrame = Convert.ToInt32(_parameters["EndFrame"]);

    for (int i = startFrame; i <= endFrame; i++)
    {
        yield return new CloudTask("myTask" + i, "cmd /c dir");
    }
}
```

> [!NOTE]
> Hello заметками раздела hello `Split()` метод — hello только часть hello код шаблона диспетчера заданий, предназначенный для вас toomodify путем добавления hello toosplit логику выполнения заданий в различные задачи. Следует toomodify в другой раздел hello шаблона убедитесь начала ознакомьтесь с принципами работы пакета и попробуйте выполнить некоторые из hello [пакета образцы кода][github_samples].
> 
> 

Для реализации метода Split() доступны такие компоненты:

* Здравствуйте, задания параметров, через hello `_parameters` поля.
* представления задания hello, через hello объекта Hello CloudJob `_job` поля.
* представляющих hello задачи диспетчера заданий, через hello объекта Hello CloudTask `_jobManagerTask` поля.

Ваш `Split()` реализации не требуется задание toohello задачи tooadd напрямую. Вместо этого код должен возвращать последовательность объектов CloudTask, и эти задания toohello автоматически добавляется классами framework hello, вызывающие hello задания разделителей. Это общие итератор toouse C# (`yield return`) компонентов tooimplement задания разделителей, как это позволяет toostart hello задачи, как можно быстрее под управлением, а не ожидает, пока все задачи toobe рассчитываются.

**Сбой разделителя заданий**

При сбое разделитель заданий делает следующее:

* Завершение последовательности hello hello C# с помощью `yield break` инструкции, в котором вариантов hello диспетчера заданий будет рассматриваться как успешно; или
* Исключение, в которой диспетчер заданий вариантов hello будут рассматриваться как сбой и может быть повторена в зависимости от того, как клиент hello настроил его).

В обоих случаях все задачи, уже возвращенных разделителей задания hello и добавлены toohello пакетное задание будет иметь право toorun. Если вы не хотите этого toohappen, затем можно выполнить следующее.

* Завершить задание hello перед возвратом из задания разделителей hello
* Сформулировать коллекции всей задачи hello перед возвращением (то есть возвращать `ICollection<CloudTask>` или `IList<CloudTask>` вместо реализации вашей задания разделителю при помощи итератора C#)
* Использовать toomake зависимости задач, все задачи зависят от успешного завершения диспетчера заданий hello hello

**Повторная попытка запуска диспетчера заданий**

Если происходит сбой диспетчера заданий hello, может быть повторена пакетной службой hello в зависимости от параметров повторных попыток клиента hello. Как правило это безопасным, так как при hello framework добавляет задание toohello задачи, игнорирует все задачи, которые уже существуют. Однако если вычисление задачи, не можно tooincur hello затраты перерасчет задачи, которые уже были добавлены toohello задания; и наоборот Если hello повторно запустите не гарантируется toogenerate hello одинаковые идентификаторы задач и поведение «пропустить дубликаты» hello не включится. В таких случаях следует разрабатывать hello действий toodetect задания разделителей, что уже выполнены и не повторять его, например, выполняя CloudJob.ListTasks перед запуском tooyield задачи.

### <a name="exit-codes-and-exceptions-in-hello-job-manager-template"></a>Выйти из кодов и исключения в шаблоне hello диспетчера заданий
Коды выхода и исключения предоставляют механизм toodetermine hello результат запуска программы, и они могут помочь tooidentify проблемах, связанных с hello выполнения программы hello. шаблон диспетчера заданий Hello реализует коды завершения hello и исключения, описанные в этом разделе.

Задача диспетчера заданий, реализованный с помощью шаблона диспетчера заданий hello может вернуть три возможных выхода кода:

| Код | Описание |
| --- | --- |
| 0 |Диспетчер заданий Hello успешно завершена. Код разделителя задание выполняется toocompletion и все задачи были добавлены toohello задания. |
| 1 |задачи диспетчера заданий Hello ошибка с исключением в «ожидаемый» части программы hello. Возникло исключение Hello переведенные tooa JobManagerException с диагностической информацией и hello там, где это возможно, рекомендации по устранению ошибки. |
| 2 |задачи диспетчера заданий Hello сбой с исключением «Непредвиденная». Hello исключение был регистрируется toostandard выходные данные, но hello диспетчер заданий не удается tooadd любые дополнительные сведения диагностики и исправления. |

В случае сбоя задачи диспетчера заданий hello некоторые задачи могут по-прежнему были добавлены службы toohello до возникновения ошибки hello. Эти задачи будут выполняться в обычном режиме. Обсуждение этого пути кода см. в разделе "Сбой разделителя заданий" выше.

Все hello информацию, возвращаемую исключения записываются в файлы stdout.txt и stderr.txt. Дополнительные сведения см. в разделе [Обработка ошибок](batch-api-basics.md#error-handling).

### <a name="client-considerations"></a>Рекомендации для клиента
В этом разделе описываются некоторые требования к реализации в клиенте при вызове диспетчера заданий с использованием этого шаблона. В разделе [hello как toopass параметры и переменные среды из клиентского кода](#pass-environment-settings) сведения о передаче параметров и параметров среды.

**Обязательные учетные данные**

В tooadd задачи toohello Azure пакетное задание задача диспетчера заданий hello требуется URL-адрес учетной записи пакетной службы Azure и ключа. Их необходимо передать в переменные среды YOUR_BATCH_URL и YOUR_BATCH_KEY. Можно задать в виде hello диспетчера заданий параметры среды для задачи. Например, в клиенте C#:

```csharp
job.JobManagerTask.EnvironmentSettings = new [] {
    new EnvironmentSetting("YOUR_BATCH_URL", "https://account.region.batch.azure.com"),
    new EnvironmentSetting("YOUR_BATCH_KEY", "{your_base64_encoded_account_key}"),
};
```
**Учетные данные хранилища**

Как правило hello клиенту не требуется tooprovide hello связанное хранение учетной записи учетных данных toohello задачи диспетчера заданий, так как не обязательно учетной записи хранилища hello связаны доступа tooexplicitly (a) большинство руководителей задания и (б) hello связанной учетной записи хранения часто предоставляется tooall задачи, как общие параметра среды для задания hello. Если вы не указываете hello связанной учетной записи хранилища с помощью hello Общие параметры среды и диспетчер заданий hello требует toolinked доступа к хранилищу, а затем необходимо предоставить учетные данные хранилища hello связаны следующим образом:

```csharp
job.JobManagerTask.EnvironmentSettings = new [] {
    /* other environment settings */
    new EnvironmentSetting("LINKED_STORAGE_ACCOUNT", "{storageAccountName}"),
    new EnvironmentSetting("LINKED_STORAGE_KEY", "{storageAccountKey}"),
};
```

**Параметры задачи диспетчера заданий**

Hello клиент должен задать диспетчера заданий hello *killJobOnCompletion* флаг слишком**false**.

Обычно можно безопасно для hello клиента tooset *runExclusive* слишком**false**.

Hello клиент должен использовать hello *resourceFiles* или *applicationPackageReferences* коллекции toohave hello диспетчера заданий исполняемый файл (и его необходимых библиотек DLL) развернуты toohello вычислительных узлов.

По умолчанию hello диспетчер заданий не предпринимается при неудаче. В зависимости от логики диспетчера заданий hello клиента может потребоваться tooenable повторные попытки через *ограничения*/*maxTaskRetryCount*.

**Параметры задания**

Если разделитель задания hello выдает задачи с зависимостями, hello клиент должен указать tootrue usesTaskDependencies hello задания.

В модели разделителей задания hello является обычным для клиентов toowish tooadd задачи toojobs помимо создает задания какие hello разделителей. Hello клиента таким образом устанавливайте обычно hello задания *onAllTasksComplete* слишком**terminatejob**.

## <a name="task-processor-template"></a>Шаблон "Обработчик задач"
Шаблон обработчика задач помогает tooimplement обработчика задач, который может выполнять следующие действия hello:

* Настройка сведения hello, необходимой для каждого toorun задач пакета.
* выполнение всех действий, необходимых для каждой задачи пакетной службы;
* Сохранение выходных данных задачи toopersistent хранилища.

Хотя обработчика задач не требуется toorun задач в пакете, hello Главное преимущество использования обработчика задач — что она обеспечивает tooimplement оболочки все действия выполнения задач в одном месте. Например при необходимости toorun нескольких приложений в контексте hello каждой задачи или при необходимости хранения toopersistent toocopy данных после завершения каждая задача.

Hello действий, выполняемых обработчиком hello задача может быть как простой или сложной и многие или несколько, как того требует рабочей нагрузки. Кроме того реализовав все действия задач в один процессор задач, можно легко обновить или добавить действия в соответствии с требованиями изменения tooapplications или рабочей нагрузки. Тем не менее в некоторых случаях обработчика задач может оказаться hello оптимальным решением для реализации при его можно добавить ненужные сложности, например при выполнении заданий, которые можно быстро запустить из простых командной строки.

### <a name="create-a-task-processor-using-hello-template"></a>Создание обработчика задач, с помощью шаблона hello
tooadd решения toohello процессора задачи, созданной ранее, выполните следующие действия.

1. Откройте имеющееся решение в Visual Studio.
2. В обозревателе решений щелкните решение правой кнопкой мыши hello, нажмите кнопку **добавить**, а затем нажмите кнопку **новый проект**.
3. В разделе **Visual C#** щелкните **Облако**, а затем — **Azure Batch Task Processor** (Обработчик задач пакетной службы Azure).
4. Введите имя, которое описывает приложение и определяет этот проект как hello обработчика задач (например) LitwareTaskProcessor).
5. toocreate hello проекта, нажмите кнопку **ОК**.
6. Наконец Visual Studio tooforce tooload для построения hello проекта все ссылки на пакеты NuGet и tooverify, hello проекта является допустимым, прежде чем начать, его изменения.

### <a name="task-processor-template-files-and-their-purpose"></a>Файлы шаблона "Обработчик задач" и их назначение
При создании проекта с помощью шаблона процессора задачи hello, он создает три группы файлов кода:

* файл основной программы Hello (Program.cs). Оно содержит точку входа программы hello и обработка исключений верхнего уровня. Не следует обычно toomodify это необходимо.
* каталог платформы Hello. Это файлы hello ответственность за работы «стандартный» hello, выполненной программой hello задания manager – распаковке файлов параметров, добавление задач toohello пакетного задания и т. д. Вы не должны обычно требуется toomodify эти файлы.
* файл обработчика задачи Hello (TaskProcessor.cs). Это происходит, где будет размещаться логику приложения для выполнения задачи (обычно посредством вызова tooan существующего исполняемого файла). Сюда также помещается код предварительной обработки и постобработки, например для скачивания дополнительных данных или отправки файлов результатов.

Конечно можно добавить дополнительные файлы как обязательный toosupport код процессора задачи в зависимости от сложности hello задания hello разделение логики.

шаблон Hello также создает стандартные файлы проекта .NET, например CSPROJ-файл, файл app.config, packages.config и т.д.

Hello оставшейся части этого раздела описываются различные файлы hello и их структуру кода и объясняется, что делает каждый класс.

![Visual Studio в обозревателе решений hello обработчика задач шаблон решения][solution_explorer02]

**Файлы платформы**

* `Configuration.cs`: Инкапсулирует hello загрузка данных конфигурации задания, например сведения об учетной записи, связанное хранение учетных данных учетной записи, заданий и задач и задания параметров пакета. Он также предоставляет доступ tooBatch определенные переменные (см. параметры среды для задачи, в документации пакета hello) через класс Configuration.EnvironmentVariable hello.
* `IConfiguration.cs`: Краткие описания hello реализация hello класс конфигурации, чтобы пользователь мог модульный тест вашего задания разделителю при помощи объекта конфигурации имитируемой или макета.
* `TaskProcessorException.cs`: Представляет ошибку, которая требует tooterminate диспетчера заданий hello. TaskProcessorException — ошибки «требуется» используется toowrap где определенные диагностические сведения могут быть предоставлены как часть завершения.

**Обработчик задач**

* `TaskProcessor.cs`: Запускает задачу hello. Hello framework вызывает метод TaskProcessor.Run hello. Это класс hello, где обеспечивает включение логики приложения hello задач. Реализуйте метод выполнения hello, чтобы:
  * проанализировать и проверить все параметры задачи;
  * Составить hello командной строки для любой внешней программе требуется tooinvoke
  * зарегистрировать любые диагностические сведения, которые могут потребоваться для отладки;
  * запустить процесс с помощью созданной командной строки;
  * Время ожидания процесса tooexit hello
  * Записывать код выхода процесса toodetermine hello hello, если он успешно или неудачно
  * Сохранить все выходные файлы, необходимые tookeep toopersistent хранилища

**Стандартные файлы проекта .NET командной строки**

* `App.config`— стандартный файл конфигурации приложения .NET.
* `Packages.config` — стандартный файл зависимостей пакета NuGet.
* `Program.cs`: Содержит точку входа программы hello и обработка исключений верхнего уровня.

## <a name="implementing-hello-task-processor"></a>Реализация обработчика задач hello
При открытии проекта шаблона обработчика задач hello hello проект будет содержать файл TaskProcessor.cs hello открытия по умолчанию. Можно реализовать логику hello выполнения для задач hello в рабочей нагрузке с помощью метода Run() hello, показано ниже:

```csharp
/// <summary>
/// Runs hello task processing logic. This is where you inject
/// your application-specific logic for decomposing hello job into tasks.
///
/// hello task processor framework invokes hello Run method for you; you need
/// only tooimplement it, not toocall it yourself. Typically, your
/// implementation will execute an external program (from resource files or
/// an application package), check hello exit code of that program and
/// save output files toopersistent storage.
/// </summary>
public async Task<int> Run()

{
    try
    {
        //Your code for hello task processor goes here.
        var command = $"compare {_parameters["Frame1"]} {_parameters["Frame2"]} compare.gif";
        using (var process = Process.Start($"cmd /c {command}"))
        {
            process.WaitForExit();
            var taskOutputStorage = new TaskOutputStorage(
            _configuration.StorageAccount,
            _configuration.JobId,
            _configuration.TaskId
            );
            await taskOutputStorage.SaveAsync(
            TaskOutputKind.TaskOutput,
            @"..\stdout.txt",
            @"stdout.txt"
            );
            return process.ExitCode;
        }
    }
    catch (Exception ex)
    {
        throw new TaskProcessorException(
        $"{ex.GetType().Name} exception in run task processor: {ex.Message}",
        ex
        );
    }
}
```
> [!NOTE]
> Hello заметками раздела hello метода Run() — только часть hello hello обработчика задач шаблона код, который предназначен для вас toomodify добавления логики hello запуска задачи hello в рабочей нагрузке. Если вы хотите toomodify в другой раздел шаблона hello, обратитесь сначала ознакомиться с работу пакета, изучите документацию пакета hello и ознакомление в некоторых образцах кода hello пакета.
> 
> 

Hello Run() метод отвечает за запуск hello командной строки, запуск одного или нескольких процессов, Ожидание всех toocomplete процесса сохранения результатов hello и возврат и, наконец, код выхода. Метод Run() Hello — где реализовать логику для задач обработки hello. Процессор платформы Hello задач вызывает метод Run() hello Нет необходимости toocall его самостоятельно.

Для реализации метода Run() доступны такие компоненты:

* Здравствуйте, параметры задачи, через hello `_parameters` поля.
* Здравствуйте, идентификаторы заданий и задач, через hello `_jobId` и `_taskId` поля.
* конфигурации задачи Hello, через hello `_configuration` поля.

**Сбой выполнения задачи**

В случае сбоя можно выйти из метода Run() hello, создавая исключение, но это оставляет обработчик исключений верхнего уровня hello контролируете код выхода задачи hello. При необходимости код выхода toocontrol hello, чтобы отличать разные типы сбоев, например в целях диагностики, или из-за некоторых режимах сбоя завершать задания hello и другие не должны, а затем метод Run() hello должны завершать работу, возвращая код выхода ненулевое значение. Это становится hello код завершения задачи.

### <a name="exit-codes-and-exceptions-in-hello-task-processor-template"></a>Выйти из кодов и исключения в шаблоне hello обработчика задач
Коды выхода и исключения предоставляют механизм toodetermine hello результат запуска программы, и они помогают выявлять проблемы с выполнением hello программы hello. шаблон обработчика задач Hello реализует коды завершения hello и исключения, описанные в этом разделе.

Задача процессора задачу, которая реализуется с помощью шаблона hello обработчика задач может вернуть три возможных выхода кода:

| Код | Описание |
| --- | --- |
| [Process.ExitCode][process_exitcode] |Процессор Hello задачи выполнялись toocompletion. Обратите внимание, что это не означает, что происходит при вызове программы hello успешность — только этому процессору hello задача успешно вызвана и выполнить любую необходимую обработку без исключений. Hello значение кода выхода hello зависит от программы hello вызывается — обычно код выхода 0 означает успешное применение программы hello и любой другой код выхода указывает на сбой программы hello. |
| 1 |Hello задач не удалось инициализировать обработчик исключение в «ожидаемый» части программы hello. Hello исключение переведенные tooa `TaskProcessorException` с диагностической информацией и, где это возможно, предложения по разрешению hello сбоя. |
| 2 |Hello задач не удалось инициализировать обработчик с исключением «Непредвиденная». Hello исключения был регистрируется toostandard выходных данных, но обработчика задач hello не удается tooadd любые дополнительные сведения диагностики и исправления. |

> [!NOTE]
> Если hello, вызываемой программой режимы конкретный сбой tooindicate 1 и 2 коды выхода, затем с помощью кодов выхода 1 и 2 для ошибок процессора задачи является неоднозначным. Эти задачи процессора коды toodistinctive кодов ошибок завершения можно изменить, изменив случаев исключений hello в файл Program.cs hello.
> 
> 

Все hello информацию, возвращаемую исключения записываются в файлы stdout.txt и stderr.txt. Дополнительные сведения см. в документации пакета hello обработку ошибок.

### <a name="client-considerations"></a>Рекомендации для клиента
**Учетные данные хранилища**

Если задача процессором выходов toopersist хранилища BLOB-объектов Azure, например с помощью hello файл соглашения вспомогательную библиотеку, то необходим доступ слишком*либо* hello облачные учетные данные учетной записи хранилища *или* URL контейнер больших двоичных объектов, который содержит подписанный URL-адрес (SAS). шаблон Hello включает поддержку для предоставления учетных данных через общие переменные среды. Ваш клиент может передать учетные данные хранилища hello следующим образом:

```csharp
job.CommonEnvironmentSettings = new [] {
    new EnvironmentSetting("LINKED_STORAGE_ACCOUNT", "{storageAccountName}"),
    new EnvironmentSetting("LINKED_STORAGE_KEY", "{storageAccountKey}"),
};
```

Учетная запись хранения Hello становится доступным в hello TaskProcessor класс с помощью hello `_configuration.StorageAccount` свойство.

Если вы предпочитаете toouse URL-адрес контейнера с сопоставлениями безопасности, это также можно передать через общие параметры среды задания, но hello задач процессора шаблон в настоящее время не включает встроенную поддержку.

**Настройка хранилища**

Рекомендуется, hello клиента или задание диспетчера задач Создать все контейнеры, необходимые задачи перед добавлением hello задачи toohello задания. Это является обязательным, если используется URL-адрес контейнера и SAS, таким образом URL-адрес не включает разрешение toocreate hello контейнер. Рекомендуется даже при передаче учетных данных учетной записи хранения, как она сохраняет каждой задачи с toocall CloudBlobContainer.CreateIfNotExistsAsync на контейнер hello.

## <a name="pass-parameters-and-environment-variables"></a>Передача параметров и переменных среды
### <a name="pass-environment-settings"></a>Передача параметров среды
Клиент может передать сведения toohello задачи диспетчера заданий в форме hello параметров среды. Эти сведения могут затем использоваться hello задачи диспетчера заданий при генерации hello задач процессора задачи, которые будут выполняться как часть hello вычислений задания. Приведены примеры hello сведений, можно передать в качестве параметров среды.

* имя учетной записи хранения и ключ учетной записи;
* URL-адрес учетной записи пакетной службы;
* ключ учетной записи пакетной службы.

Hello пакетная служба имеет простой механизм toopass среде параметры tooa задачи диспетчера заданий с помощью hello `EnvironmentSettings` свойство в [Microsoft.Azure.Batch.JobManagerTask][net_jobmanagertask].

Например, tooget hello `BatchClient` экземпляра для пакетной учетной записи, можно передать как переменные среды из клиента hello кода hello URL-адрес и общих ключей учетных данных для учетной записи пакетной hello. Аналогичным образом учетной записи хранилища tooaccess hello, связанных toohello пакетной учетной записи, имя учетной записи хранения hello и ключ учетной записи хранения hello можно передать в качестве переменных среды.

### <a name="pass-parameters-toohello-job-manager-template"></a>Передать параметры toohello диспетчера заданий шаблона
Во многих случаях это полезно toopass-задание параметров toohello задачи диспетчера заданий, разделения процесса hello задания либо toocontrol система или tooconfigure hello задачи для hello задания. Это можно сделать путем передачи JSON-файл с именем parameters.json как файл ресурсов для задачи диспетчера заданий hello. Параметры Hello затем могут стать доступны в hello `JobSplitter._parameters` в шаблон hello диспетчера заданий.

> [!NOTE]
> Обработчик встроенных параметров Hello поддерживает только словарях строку в строку. Следует toopass сложных значений JSON как значения параметров будут необходимые toopass как строки и проанализировать их в разделителей задания hello или изменить hello framework `Configuration.GetJobParameters` метод.
> 
> 

### <a name="pass-parameters-toohello-task-processor-template"></a>Передать параметры toohello обработчика задач шаблона
Можно также передавать параметры задачи tooindividual реализовано с помощью шаблона hello обработчика задач. Так же, как с помощью шаблона диспетчера заданий hello, hello задач процессора шаблон ищет файл ресурсов с именем

Parameters.JSON и если он найден, он загружает их в виде словаря параметров hello. Существует два способа как задачи процессора в toohello toopass параметры:

* Повторное использование параметров задания hello JSON. Эта функция работает также в том случае, если только параметры hello являются расширенными задания (для примера, отрисовки высоту и ширину). toodo, при создании CloudTask в hello задания разделителей, добавить объект файла ресурса parameters.json toohello ссылку из hello задачи диспетчера заданий элемента ResourceFiles (`JobSplitter._jobManagerTask.ResourceFiles`) toohello CloudTask ResourceFiles коллекции.
* Создание и отправка документа parameters.json определенных задач в ходе выполнения задания разделителей и ссылаются на этот большой двоичный объект в коллекцию файлов ресурсов задачу hello. Это необходимо, если в разных задачах используются разные параметры. Примером может служить сценарий трехмерной отрисовки, где индекс кадров hello задача будет передана toohello как параметр.

> [!NOTE]
> Обработчик встроенных параметров Hello поддерживает только словарях строку в строку. Следует toopass сложных значений JSON как значения параметров будут необходимые toopass как строки и проанализировать их в процессоре задача hello или изменить hello framework `Configuration.GetTaskParameters` метод.
> 
> 

## <a name="next-steps"></a>Дальнейшие действия
### <a name="persist-job-and-task-output-tooazure-storage"></a>Сохранение заданий и задач tooAzure выходные данные хранилища
Еще одно полезное средство в разработке решений пакетной службы — [Azure Batch File Conventions][nuget_package]. Используйте Эта библиотека классов .NET (в настоящее время в предварительной версии) в хранилище tooeasily приложений пакета .NET и получить tooand выходные данные задачи из хранилища Azure. [Сохранение выходных данных заданий и задач пакетной службы Azure](batch-task-output.md) содержит полное описание библиотеки hello и их использование.

### <a name="batch-forum"></a>Форум по Пакетной службе
Hello [форум по пакетной Azure] [ forum] на сайте MSDN — лучшие поместите toodiscuss пакета и ответы на вопросы о службе hello. Изучайте полезные «прикрепленные» сообщения и задавайте вопросы, возникающие во время сборки пакетных решений.

[forum]: https://social.msdn.microsoft.com/forums/azure/en-US/home?forum=azurebatch
[net_jobmanagertask]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.jobmanagertask.aspx
[github_samples]: https://github.com/Azure/azure-batch-samples
[nuget_package]: https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files
[process_exitcode]: https://msdn.microsoft.com/library/system.diagnostics.process.exitcode.aspx
[vs_gallery]: https://visualstudiogallery.msdn.microsoft.com/
[vs_gallery_templates]: https://go.microsoft.com/fwlink/?linkid=820714
[vs_find_use_ext]: https://msdn.microsoft.com/library/dd293638.aspx

[diagram01]: ./media/batch-visual-studio-templates/diagram01.png
[solution_explorer01]: ./media/batch-visual-studio-templates/solution_explorer01.png
[solution_explorer02]: ./media/batch-visual-studio-templates/solution_explorer02.png
