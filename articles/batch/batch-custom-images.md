---
title: "пулы aaaProvision пакетной службы Azure из пользовательских образов | Документы Microsoft"
description: "Можно создать пакет пула из tooprovision пользовательского образа вычислительные узлы, которые содержат программное обеспечение hello и данные, необходимые для вашего приложения. Пользовательские изображения позволяют эффективно tooconfigure вычислительные узлы toorun рабочих нагрузок пакета."
services: batch
author: tamram
manager: timlt
ms.service: batch
ms.topic: article
ms.date: 08/07/2017
ms.author: tamram
ms.openlocfilehash: 5cb698ee90f7d3ec9ffe69fa4dc602132c3f7569
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="use-a-custom-image-toocreate-a-pool-of-virtual-machines"></a>Использование пользовательского изображения toocreate пула виртуальных машин

При создании пула виртуальных машин в пакете Azure необходимо указать образ виртуальной машины (VM), который предоставляет hello операционной системы для каждого вычислительных узлов в пул hello. Пул виртуальных машин можно создать с помощью образа Microsoft Azure Marketplace или подготовленного пользовательского образа VHD. При предоставлении настраиваемого образа, вы можете контролировать настройки hello операционной системы во время hello, который предоставляется в каждом вычислительном узле. Образ также могут включать приложения и ссылочные данные, доступные на hello вычислительного узла сразу же после его инициализации.

С помощью пользовательского образа можно сэкономить время пользователя в вашем пуле вычислительных узлов получении готов toorun рабочей нагрузки пакета. Вы всегда можете использовать образ Azure Marketplace и установить программное обеспечение на каждом вычислительном узле после его подготовки. Однако этот подход менее эффективен, чем использование пользовательского образа. 

Некоторые причины toouse пользовательского образа, который настроен для вашего сценария включают необходимости:

- **Настройка hello операционной системы (ОС)** специальной конфигурации hello операционной системы, которые могут выполняться над hello пользовательского образа. 
- **Установки больших приложений.** Установка приложений на пользовательский образ более эффективна, чем их установка на каждом вычислительном узле после его подготовки.
- **Копирования значительного объема данных.** Если данные hello скопированный toohello пользовательского образа, ему только toobe скопировано, вместо того чтобы tooeach вычислительных узлов, экономя время и пропускной способности.
- **Перезагрузите hello виртуальной Машины во время процесса установки hello.** Hello перезагрузка виртуальной Машины может быть много времени, особенно в том случае, если количество вычислительных узлов.

## <a name="prerequisites"></a>Предварительные требования

- **Учетная запись пакета, созданных с помощью режима выделения пула подписки пользователя hello.** toouse пулы виртуальной машины tooprovision пользовательского образа, создание учетной записи пакета с hello подписки пользователя [режим распределения пула](batch-api-basics.md#pool-allocation-mode). В этом режиме пакет пулы выделяются в подписку hello, где находится учетная запись hello. . В разделе hello [учетной записи](batch-api-basics.md#account) статьи [разработка крупномасштабных параллельных вычислений решений с использованием пакета](batch-api-basics.md) сведения об установке режима выделения пула hello при создании учетной записи пакетной.

- **Учетная запись хранения Azure.** toocreate пула виртуальных машин с помощью пользовательского образа, необходима учетная запись хранилища Azure стандартные, общего назначения в hello ту же подписку и регион. При создании настраиваемого образа из виртуальной Машины Azure, необходимо будет скопировать hello toohello учетная запись хранилища образов где располагается диска ОС ВМ hello, и вам не нужна toocreate отдельную учетную запись хранилища. 
    
## <a name="prepare-a-custom-image"></a>Подготовка пользовательского образа

tooprepare пользовательского образа для использования с использованием пакета необходимо обобщить существующей установки Windows или Linux. При подготовке операционной системы удаляются сведения о компьютере. результат Hello — это изображение, можно установить на других компьютерах или виртуальных машин.  

> [!IMPORTANT]
> Пакет не поддерживается с помощью Azure управляемых образов tooprovision пулу. пользовательский образ Hello используйте tooprovision пул должен храниться в хранилище Azure. 
>
> При подготовке настраиваемого образа, имейте в виду hello после точки.
> - Убедитесь, что hello базовый образ ОС используется tooprovision пулов пакета не имеют предварительно установленные расширения, Azure, такие как расширение пользовательского скрипта hello. Если образ hello содержит предварительно установленные расширения, Azure могут возникнуть проблемы, развертывание hello виртуальной Машины.
> - Убедитесь, что hello базовый образ ОС указываемые использует hello временный диск по умолчанию, как hello агента узла пакетной в данный момент ожидает временного диска по умолчанию hello.
>
>

В качестве пользовательского образа можно использовать любой имеющийся образ Windows или Linux. Например, если хотите toouse локального изображения, а затем отправить учетной записи хранилища Azure hello изображения tooan в hello ту же подписку и регион учетной записи пакета с помощью [AzCopy](../storage/storage-use-azcopy.md) или другого средства передачи.

Также пользовательский образ можно подготовить из новой или имеющейся виртуальной машины Azure. При создании новой виртуальной Машины можно использовать образ Azure Marketplace в качестве базового образа hello для настраиваемого образа и затем выполнить его настройку. toocustomize hello базового образа, создание ВМ Azure и добавление приложений или tooit данных. Затем обобщить hello tooserve виртуальной Машины в качестве настраиваемого образа и сохраните его tooAzure хранилища. 

tooprepare пользовательского образа из виртуальной Машины Azure, выполните следующие действия.

1. Создайте **неуправляемую** виртуальную машину Azure из образа Microsoft Azure Marketplace. Microsoft Azure Marketplace содержит образы для [Windows](../virtual-machines/windows/quick-create-portal.md) и [Linux](../virtual-machines/linux/quick-create-portal.md).
    
    На шаге 3 hello процесс создания виртуальной Машины, убедитесь, что **нет** для **хранилища: Используйте управляемые дисков** параметр. Также Обратите внимание hello имя учетной записи хранения для диска ОС ВМ hello, как эта учетная запись хранения является также где Azure будет сохранять настраиваемого образа:

    ![Создание неуправляемой виртуальной Машины и имя учетной записи хранения hello Примечание](media/batch-custom-images/vm-create-storage.png)
 
2. Завершить процесс создания ВМ hello и дождитесь ее toobe, выделенной с помощью Azure. Вот рисунок, демонстрирующий виртуальной Машины в hello портал Azure в рабочем состоянии hello.

    ![Создание виртуальной машины из образа Marketplace](media/batch-custom-images/vm-status-running.png)

3. После запуска hello виртуальной Машины подключитесь tooit посредством протокола удаленного рабочего СТОЛА (для Windows) или SSH (для Linux). Установить все необходимое программное обеспечение или скопируйте требуемые данные и затем обобщить hello виртуальной Машины. Следуйте инструкциям hello в [Generalize hello ВМ](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sa-copy-generalized.md#generalize-the-vm). 
   
4. Выполните действия hello слишком[вход tooAzure PowerShell](../virtual-machines/windows/sa-copy-generalized.md#log-in-to-azure-powershell). tooinstall Azure PowerShell, в разделе [Обзор Azure PowerShell](https://docs.microsoft.com/powershell/azure/overview?view=azurermps-4.2.0). 

5. Затем выполните шаги hello слишком[Deallocate hello виртуальной Машины и набор hello состояние toogeneralized](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sa-copy-generalized#deallocate-the-vm-and-set-the-state-to-generalized). 

    В hello портал Azure Обратите внимание, Виртуальная машина освобождена приветствия:

    ![Убедитесь, что Виртуальная машина освобождена приветствия](media/batch-custom-images/vm-status-deallocated.png)

6.  Создайте и сохраните tooAzure образ виртуальной Машины hello хранилища с помощью hello [AzureRmVMImage Сохранить](https://docs.microsoft.com/powershell/module/azurerm.compute/save-azurermvmimage) командлета PowerShell. Следуйте инструкциям hello, описанным в [создать изображение hello](../virtual-machines/windows/sa-copy-generalized.md#create-the-image).
    
    образ виртуальной Машины Hello сохраняется toohello учетную запись хранилища Azure создан при создании hello виртуальной Машины, как показано на первом шаге этой процедуры. Hello AzureRmVMImage сохранения командлет сохраняет hello изображения toohello **системы** контейнера в этой учетной записи хранения. Hello `-DestinationContainername` имена параметров виртуального каталога в hello **системы** контейнера. Hello `-VHDNamePrefix` параметр указывает префикс для hello имя большого двоичного объекта. Этот префикс — присоединяемый toohello имя BLOB-объекта с дефиса. 

    Например предположим, что вызвать AzureRmVMImage сохранения с hello следующие параметры:  

        Save-AzureRmVMImage -ResourceGroupName sample-resource-group -Name vm-custom-image -DestinationContainerName batchimages -VHDNamePrefix custom -Path C:\Temp\Images\vm-custom-image.json

    полученное изображение Hello сохраняется toohello расположение и имя большого двоичного объекта, показано ниже:

    ![Расположение сохраненного VHD в контейнере системы](media/batch-custom-images/vhd-in-vm-storage-account.png)

    > [!NOTE]
    > Неуправляемая виртуальная машина Azure создает несколько учетных записей хранения для различных целей. Если вы не заметили hello имя контейнера хранилища hello hello ОС диска при hello виртуальной Машины была создана, а затем найти связанные hello хранилища учетной записи, содержащий hello **системы** контейнера. Перемещаться по hello **системы** toofind hello пользовательский образ контейнера с помощью hello значения, заданные для hello **AzureRmVMImage Сохранить** команды.

## <a name="create-a-pool-from-a-custom-image-in-hello-portal"></a>Создание пула из пользовательского образа на портале hello

Если вы сохранили пользовательский образ и знаете его расположение, можно создать пул пакетной службы из этого образа. Выполните эти шаги toocreate пул из hello портал Azure.

1. Перейдите tooyour пакетной учетной записи в hello портал Azure. Эта учетная запись должна быть в hello той же подписке и регионе, что хранилище hello учетной записи содержащего hello пользовательского образа. 
2. В hello **параметры** окна на hello слева, выберите hello **пулы** элемента меню.
3. В hello **пулы** окно, выберите hello **добавить** команды.
4. На hello **"Добавить пул"** выберите **настраиваемое изображение (ОС Linux или Windows)** из hello **тип изображения** раскрывающегося списка. портал Hello отображает hello **настраиваемое изображение** выбора. Перейдите учетной записи хранилища toohello, где находится пользовательский образ, и выберите hello нужный виртуальный жесткий ДИСК из контейнера hello. 
5. Правильный выбор hello **издателя, предложения и Sku** для вашего пользовательского виртуального жесткого диска.
6. Укажите hello оставшихся параметров, включая hello **размер узла**, **целевых узлах, выделенный**, и **низкий уровень приоритета узлов**, а также любой требуемой необязательные параметры.

    Например, для настраиваемого образа Microsoft Windows Server Datacenter 2016 hello **"Добавить пул"** появится окно, как показано ниже:

    ![Добавление пула из пользовательского образа Windows](media/batch-custom-images/add-pool-custom-image.png)
  
toocheck ли существующего пула основан на настраиваемый образ, см. hello **операционной системы** свойства раздела hello ресурсов сводки hello **пула** окна. Если пул hello был создан из образа, он настраивается слишком**пользовательского образа виртуальной Машины**.

Все пользовательские виртуальные жесткие диски, связанные с пулом, отображаются на hello пула **свойства** окна.
 
## <a name="next-steps"></a>Дальнейшие действия

- Исчерпывающий обзор пакетной службы см. в статье [Разработка решений для крупномасштабных параллельных вычислений с использованием пакетной службы](batch-api-basics.md).
- Сведения о создании учетной записи пакетной см. в разделе [создать учетную запись пакета с портала Azure hello](batch-account-create-portal.md).
