---
title: "Начало работы с интерфейсом командной строки пакетной службы Azure | Документация Майкрософт"
description: "Ознакомьтесь с командами интерфейса командной строки пакетной службы Azure для управления ресурсами пакетной службы Azure."
services: batch
documentationcenter: 
author: v-dotren
manager: timlt
editor: 
ms.assetid: fcd76587-1827-4bc8-a84d-bba1cd980d85
ms.service: batch
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: multiple
ms.workload: big-compute
ms.date: 09/28/2017
ms.author: tamram
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 763a8884b65f64b4807cd42c937f43b2f5517ed5
ms.sourcegitcommit: b83781292640e82b5c172210c7190cf97fabb704
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/27/2017
---
# <a name="manage-batch-resources-with-azure-cli"></a>Управление ресурсами пакетной службы с помощью Azure CLI

Azure CLI 2.0 — это новый интерфейс командной строки Azure для управления ресурсами Azure. Его можно использовать в Windows, Linux и macOS. Azure CLI 2.0 оптимизирован для администрирования ресурсов Azure и управления ими из командной строки. При помощи этого интерфейса вы можете управлять учетными записями пакетной службы Azure, а также такими ресурсами, как пулы, задания и задачи. Кроме того, Azure CLI позволяет создавать и выполнять скрипты для многих однотипных задач, выполняемых с помощью API-интерфейсов пакетной службы, портала Azure и командлетов PowerShell пакетной службы.

В этой статье содержатся общие сведения об использовании [Azure CLI версии 2.0](https://docs.microsoft.com/cli/azure/overview) с пакетной службой. Общие сведения об использовании интерфейса командной строки с Azure см. в статье [Начало работы с Azure CLI 2.0](https://docs.microsoft.com/cli/azure/get-started-with-azure-cli).

Корпорация Майкрософт советует использовать последнюю версию Azure CLI — версию 2.0. Дополнительные сведения о ней см. в записи блога о [выпуске общедоступной версии Azure CLI 2.0](https://azure.microsoft.com/blog/announcing-general-availability-of-vm-storage-and-network-azure-cli-2-0/).

## <a name="set-up-the-azure-cli"></a>Настройка Azure CLI

Чтобы установить Azure CLI, используйте указания в [этой статье](https://docs.microsoft.com/cli/azure/install-azure-cli).

> [!TIP]
> Рекомендуем регулярно обновлять интерфейс командной строки Azure, чтобы использовать все преимущества обновлений и улучшений службы.
> 
> 

## <a name="command-help"></a>Справка по командам

Текст справки для каждой команды в Azure CLI можно просмотреть, добавив к ней `-h`. Другие параметры следует опустить. Например:

* Чтобы получить справку по команде `az`, введите: `az -h`
* Чтобы получить список всех команд пакетной службы в интерфейсе командной строки, используйте: `az batch -h`
* Чтобы получить справку по созданию учетной записи пакетной службы, введите: `az batch account create -h`

Если у вас возникнут сомнения, с помощью параметра командной строки `-h` вы сможете получить справку по любой из команд интерфейса командной строки Azure.

> [!NOTE]
> В предыдущих версиях Azure CLI к командам добавлялся префикс `azure`. В версии 2.0 все команды теперь начинаются с приставки `az`. Не забудьте обновить скрипты, чтобы использовать новый синтаксис версии 2.0.
>
>  

Дополнительные сведения о командах Azure CLI для пакетной службы см. в [справочной документации по Azure CLI](https://docs.microsoft.com/cli/azure/batch). 

## <a name="log-in-and-authenticate"></a>Вход в систему и проверки подлинности

Чтобы использовать Azure CLI с пакетной службой, сначала необходимо войти в систему и пройти проверку подлинности. Выполните следующие два простых действия:

1. **Войдите в Azure.** Это позволит получить доступ к командам Azure Resource Manager, в том числе командам [службы управления пакетной службой](batch-management-dotnet.md).  
2. **Войдите в учетную запись пакетной службы.** Это позволит получить доступ к командам пакетной службы.   

### <a name="log-in-to-azure"></a>Вход в Azure

В Azure можно войти разными способами, описанными в статье [Вход с помощью Azure CLI 2.0](https://docs.microsoft.com/cli/azure/authenticate-azure-cli):

1. [Интерактивный вход.](https://docs.microsoft.com/cli/azure/authenticate-azure-cli#az_authenticate_azure_cli_interactive_log_in) Используйте этот способ, если вы самостоятельно выполняете команды Azure CLI из командной строки.
2. [Вход с использованием субъекта-службы.](https://docs.microsoft.com/cli/azure/authenticate-azure-cli#az_authenticate_azure_cli_logging_in_with_a_service_principal) Используйте этот способ, если вы выполняете команды Azure CLI из скрипта или приложения.

В рамках этого руководства мы покажем, как войти в Azure в интерактивном режиме. В окне командной строки введите [az login](https://docs.microsoft.com/cli/azure/#login):

```azurecli
# Log in to Azure and authenticate interactively.
az login
```

Команда `az login` возвращает токен, используемый при аутентификации, как показано ниже. Следуйте предоставленным указаниям, чтобы открыть веб-страницу и отправить токен в Azure:

![Вход в Azure](./media/batch-cli-get-started/az-login.png)

Примеры, приведенные в разделе [Примеры скриптов оболочки](#sample-shell-scripts), позволяют запустить сеанс Azure CLI после входа в Azure в интерактивном режиме. После входа вы сможете вызвать команды для работы с ресурсами управления пакетной службой, в том числе учетные записи пакетной службы, ключи, пакеты приложений и квоты.  

### <a name="log-in-to-your-batch-account"></a>Вход в учетную запись пакетной службы

Чтобы управлять ресурсами пакетной службы, такими как пулы, задания и задачи, с помощью Azure CLI, сначала необходимо войти в учетную запись пакетной службы и пройти проверку подлинности. Для этого используйте команду [az batch account login](https://docs.microsoft.com/cli/azure/batch/account#az_batch_account_login). 

Проверку подлинности в учетной записи пакетной службы можно пройти двумя способами:

- **Проверка подлинности Azure Active Directory (Azure AD).** 

    При использовании Azure CLI с пакетной службой этот метод проверки подлинности реализован по умолчанию. Мы советуем использовать его в большинстве сценариев. 
    
    При входе в Azure в интерактивном режиме, как описано в предыдущем разделе, учетные данные пользователя кэшируются. Поэтому Azure CLI может войти в учетную запись пакетной службы, используя те же учетные данные. Если вы входите Azure с использованием субъекта-службы, эти учетные данные также используются для входа в учетную запись пакетной службы.

    Преимущество Azure AD заключается в том, что эта служба предоставляет управление доступом на основе ролей (RBAC). При использовании RBAC доступ пользователя зависит от назначенной роли, а не наличия ключей учетной записи. В этом случае управлять ключами не нужно. Вы просто назначаете роли RBAC, и Azure AD управляет параметрами доступа и проверки подлинности вместо вас.  

     Чтобы войти в учетную запись пакетной службы с помощью Azure AD, вызовите команду [az batch account login](https://docs.microsoft.com/cli/azure/batch/account#az_batch_account_login): 

    ```azurecli
    az batch account login -g myresource group -n mybatchaccount
    ```

- **Проверка подлинности на основе общего ключа.**

    При использовании метода [проверки подлинности на основе общего ключа](https://docs.microsoft.com/rest/api/batchservice/authenticate-requests-to-the-azure-batch-service#authentication-via-shared-key) проверка подлинности команд Azure CLI для пакетной службы выполняется на основе ключей доступа к учетной записи.

    Если вы используете скрипты Azure CLI для автоматического вызова команд пакетной службы, вы можете реализовать проверку подлинности на основе общего ключа или проверку подлинности Azure AD с использованием субъекта-службы. В некоторых случаях проверку подлинности на основе общего ключа реализовать проще, чем создать субъект-службу.  

    Чтобы войти с использованием проверки подлинности на основе общего ключа, включите параметр `--shared-key-auth` в командной строке:

    ```azurecli
    az batch account login -g myresourcegroup -n mybatchaccount --shared-key-auth
    ```

В примерах, приведенных в разделе [Примеры скриптов оболочки](#sample-shell-scripts), описано, как войти в учетную запись пакетной службы с помощью Azure CLI, использую и Azure AD, и общий ключ.

## <a name="use-azure-batch-cli-templates-and-file-transfer-preview"></a>Использование шаблонов интерфейса командной строки для пакетной службы Azure и передачи файлов (предварительная версия)

Azure CLI можно использовать для запуска заданий пакетной службы без необходимости писать код. Файлы шаблона пакетной службы поддерживают создание пулов, заданий и задач с помощью Azure CLI. Вы также можете использовать Azure CLI для отправки входных файлов заданий в учетную запись хранения Azure, связанную с учетной записью пакетной службы, а также скачивания выходных файлов задания из нее. См. дополнительные сведения об [использовании шаблонов интерфейса командной строки для пакетной службы Azure и передаче файлов (предварительная версия)](batch-cli-templates.md).

## <a name="sample-shell-scripts"></a>Примеры скриптов оболочки

Примеры скриптов в таблице ниже позволяют выполнять стандартные задачи с помощью команд Azure CLI с пакетной службой и службой управления пакетной службой. В этих примерах скриптов используется большинство доступных команд Azure CLI для пакетной службы. 

| Скрипт | Примечания |
|---|---|
| [Создание учетной записи пакетной службы](./scripts/batch-cli-sample-create-account.md) | Создает учетную запись пакетной службы и связывает ее с учетной записью хранения. |
| [Добавление приложения](./scripts/batch-cli-sample-add-application.md) | Добавляет приложение и передает его упакованные двоичные файлы.|
| [Управление пулами пакетной службы](./scripts/batch-cli-sample-manage-pool.md) | Демонстрирует создание пулов, изменение размера пулов и управление ими. |
| [Выполнение задания и задач с помощью пакетной службы](./scripts/batch-cli-sample-run-job.md) | Демонстрирует выполнение задания и добавление задач. |

## <a name="json-files-for-resource-creation"></a>JSON-файлы для создания ресурса

После создания ресурсов пакетной службы, таких как пулы и задания, вы можете указать JSON-файл, содержащий конфигурацию нового ресурса, вместо того чтобы передавать его параметры в виде параметров командной строки. Например:

```azurecli
az batch pool create my_batch_pool.json
```

Хотя большинство ресурсов пакетной службы можно создавать только с помощью параметров командной строки, для некоторых функций необходимо указать файл формата JSON, содержащий сведения о ресурсе. Например, JSON-файл следует использовать, если нужно указать файлы ресурсов для задачи запуска.

Синтаксис JSON, необходимый для создания ресурса, см. в [справочной документации по REST API пакетной службы][rest_api]. В каждой статье о добавлении *определенного типа ресурса* приведены примеры скриптов JSON для создания этого ресурса. Вы можете использовать эти примеры скриптов как шаблоны файлов JSON, которые можно использовать с Azure CLI. Например, синтаксис JSON для создания пула см. в статье [Add a pool to an account][rest_add_pool] (Добавление учетной записи пула).

Пример скрипта указания файла JSON см. в статье [Выполнение заданий в пакетной службе Azure с помощью Azure CLI](./scripts/batch-cli-sample-run-job.md).

> [!NOTE]
> Если при создании ресурса вы указываете JSON-файл, все остальные параметры, которые указываются в командной строке для этого ресурса, можно пропустить.
> 
> 

## <a name="efficient-queries-for-batch-resources"></a>Эффективные запросы для ресурсов пакетной службы

Каждый тип ресурса пакетной службы поддерживает команду `list` , которая запрашивает учетную запись пакетной службы и предоставляет списки ресурсов заданного типа. Например, вы можете получить список пулов в учетной записи и задач, входящих в задание, следующим образом:

```azurecli
az batch pool list
az batch task list --job-id job001
```

При выполнении запроса к пакетной службе, используя операцию `list`, вы можете указать предложение OData, чтобы ограничить объем возвращаемых данных. Так как фильтрация выполняется на стороне сервера, передаются только запрашиваемые данные. Используйте эти предложения для экономии пропускной способности (а значит, и времени) при выполнении операций со списками.

В таблице ниже описаны предложения OData, поддерживаемые пакетной службой.

| Предложение | Описание |
|---|---|
| `--select-clause [select-clause]` | Возвращает подмножество свойств для каждой сущности. |
| `--filter-clause [filter-clause]` | Возвращает только те сущности, которые соответствуют указанному выражению OData. |
| `--expand-clause [expand-clause]` | Получает сведения о сущности за один базовый вызов REST. Сейчас предложение expand поддерживает только свойство `stats`. |

Пример скрипта с предложением OData см. в статье [Выполнение заданий в пакетной службе Azure с помощью Azure CLI](./scripts/batch-cli-sample-run-job.md).

Дополнительные сведения о выполнении эффективных запросов на вывод списка с приложениями OData см. в [этой статье](batch-efficient-list-queries.md).

## <a name="troubleshooting-tips"></a>Советы по устранению неполадок

Ниже приведены советы, которые могут помочь устранить проблемы с Azure CLI.

* Используйте параметр `-h` , чтобы вывести на экран **текст справки** по любой из команд интерфейса командной строки.
* Чтобы отобразить выходные данные команды **verbose**, используйте `-v` и `-vv`. Когда флаг `-vv` включен, Azure CLI отображает текущие REST-запросы и ответы. Эти параметры удобно использовать для просмотра полного вывода ошибок.
* Вы можете просмотреть **выходные данные команды в виде JSON** с помощью параметра `--json`. Например, параметр `az batch pool show pool001 --json` отображает свойства элемента pool001 в формате JSON. Затем вы можете скопировать и изменить эти выходные данные для использования в параметре `--json-file` (см. выше раздел, посвященный [JSON-файлам](#json-files)).
<!---Loc Comment: Please, check link [JSON files] since it's not redirecting to any location.--->
* [Форум пакетной службы][batch_forum] тщательно отслеживают специалисты пакетной службы. Задавайте вопросы на форуме, если у вас возникнут проблемы или вам потребуется справочная информация по какой-либо операции.

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения об Azure CLI см. в [документации по Azure CLI](https://docs.microsoft.com/cli/azure/overview).
* Дополнительные сведения о ресурсах пакетной службы см. в статье [Разработка решений для крупномасштабных параллельных вычислений с использованием пакетной службы](batch-api-basics.md).
* Дополнительные сведения о создании пулов, заданий и задач без написания кода с помощью шаблонов пакетной службы см. в руководстве по [использованию шаблонов интерфейса командной строки для пакетной службы Azure и передаче файлов (предварительная версия)](batch-cli-templates.md).

[batch_forum]: https://social.msdn.microsoft.com/forums/azure/home?forum=azurebatch
[github_readme]: https://github.com/Azure/azure-xplat-cli/blob/dev/README.md
[rest_api]: https://msdn.microsoft.com/library/azure/dn820158.aspx
[rest_add_pool]: https://msdn.microsoft.com/library/azure/dn820174.aspx
