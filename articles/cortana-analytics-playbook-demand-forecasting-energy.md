---
title: "Сборник шаблонов решений Cortana Intelligence для прогнозирования энергопотребления | Документация Майкрософт"
description: "Шаблон решения Microsoft Cortana Intelligence для прогнозирования спроса на энергию в электроэнергетической компании."
services: cortana-analytics
documentationcenter: 
author: ilanr9
manager: ilanr9
editor: yijichen
ms.assetid: 8855dbb9-8543-45b9-b4c6-aa743a04d547
ms.service: cortana-analytics
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/24/2016
ms.author: ilanr9;yijichen;garye
ms.openlocfilehash: 275e387878900154660d044b26ff5ac03a17a65a
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="cortana-intelligence-solution-template-playbook-for-demand-forecasting-of-energy"></a>Сборник шаблонов решений Cortana Intelligence для прогнозирования энергопотребления
## <a name="executive-summary"></a>Аннотация
В последние несколько лет объединенные возможности Интернета вещей (IoT), альтернативных источников энергии и больших данных открывают широкие перспективы в сфере коммунальных услуг и энергетики. Как отдельные коммунальные предприятия, так и энергетический сектор в целом отмечают стабилизацию энергопотребления благодаря стремлению пользователей контролировать расход энергии. Следовательно, коммунальные предприятия и компании, владеющие интеллектуальными сетями, испытывают большую потребность в инновациях и обновлении. Кроме того, энергосистемы со временем часто устаревают и становятся весьма дорогостоящими в обслуживании и управлении. На протяжении прошедшего года наша команда работала над несколькими совместными проектами в энергетическом секторе. Во время этих совместных проектов мы столкнулись с многочисленными ситуациями, в которых коммунальные предприятия или ISV (независимые поставщики программного обеспечения) нуждались в прогнозировании будущего спроса на энергию. Такие прогнозы играют важную роль в текущем и будущем бизнесе компаний и ложатся в основу различных сценариев использования. Сюда входят краткосрочные и долгосрочные прогнозы электрических нагрузок, торговой деятельности, распределения нагрузки, оптимизации сети и т. п. Большие данные и методы углубленной аналитики (AA), например машинное обучение, — это ключевые факторы создания точных и надежных прогнозов.  

В этом сборнике объединены коммерческие и аналитические рекомендации, необходимые для успешной разработки и развертывания решений по прогнозированию спроса на энергию. Представленные рекомендации помогут коммунальным предприятиям, а также специалистам по обработке и анализу данных внедрить полностью готовые к эксплуатации облачные решения по прогнозированию спроса. Для компаний, которые только начинают работу с большими данными и углубленной аналитикой, такое решение может стать отправной точкой в реализации долгосрочной стратегии разработки интеллектуальной сети.

> [!TIP]
> Чтобы скачать схему, на которой представлен обзор архитектуры этого шаблона, см. статью [Архитектура шаблона решения Cortana Intelligence для прогнозирования энергопотребления](cortana-analytics-architecture-demand-forecasting-energy.md).  
> 
> 

## <a name="overview"></a>Обзор
В этом документе рассматриваются коммерческие, информационные и технические аспекты использования Cortana Intelligence и в особенности системы машинного обучения Azure (AML) для внедрения и развертывания решений по прогнозированию энергопотребления. Документ состоит из трех основных частей.  

1. Коммерческий аспект.  
2. Аспект данных.  
3. Техническая реализация.

В части **Коммерческий аспект** описаны бизнес-факторы, которые необходимо изучить и учесть, прежде чем принимать решение об инвестировании. Здесь содержатся рекомендации относительно постановки решаемой бизнес-задачи. Они помогут определить эффективность и применимость прогнозной аналитики и машинного обучения. Кроме того, в документе изложены основы машинного обучения и его использование для решения проблем, связанных с прогнозированием энергопотребления. Здесь указаны предварительные требования и квалификационные критерии для конкретного сценария использования. Также приведены некоторые примеры сценариев использования и экономических моделей.

Данные являются основным компонентом любого решения по машинному обучению. В части **Аспект данных** этого документа описаны некоторые важные факторы, касающиеся данных. Здесь указаны типы данных, необходимые для прогнозирования энергопотребления, требования к качеству данных и типовые источники данных. Кроме того, в этой части объясняется, как необработанные данные используются для подготовки функций, которые выполняют основную часть моделирования.

В третьей части документа рассматривается аспект **технической реализации** решения. Проектирование функций и моделирование лежат в основе процесса обработки и анализа данных, поэтому здесь они рассматриваются довольно подробно. Эта часть охватывает концепцию веб-служб, которые являются важным средством развертывания облачных решений для прогнозной аналитики. Также здесь описана стандартная архитектура комплексного решения, готового к эксплуатации.

Кроме того, документ содержит справочные материалы, которые можно использовать для получения дополнительных сведений о рассматриваемой отрасли и технологии.

Важно отметить, что в этом документе не будут рассматриваться глубокие процессы обработки и анализа данных, а также математические и технические аспекты. Эти сведения можно найти в [документации по машинному обучению](http://azure.microsoft.com/services/machine-learning/) Azure и [блогах](http://blogs.microsoft.com/blog/tag/azure-machine-learning/).

### <a name="target-audience"></a>Целевая аудитория
Этот документ предназначен для предпринимателей и технических специалистов, которые стремятся получить представление о решениях по машинному обучению и их использовании, в частности в сфере прогнозирования энергопотребления.

Кроме того, специалисты по обработке и анализу данных могут использовать этот документ, чтобы лучше понять общий процесс развертывания решения по прогнозированию энергопотребления. В этом контексте он также может использоваться как надежная основа и отправная точка для изучения более подробных материалов.

### <a name="industry-trends"></a>Тенденции отрасли
В последние несколько лет объединенные возможности IoT, альтернативных источников энергии и больших данных открывают широкие перспективы в сфере коммунальных услуг и энергетики. Как отдельные коммунальные предприятия, так и целые энергетические сектора отмечают стабилизацию энергопотребления благодаря стремлению пользователей контролировать расход энергии.

Многие коммунальные предприятия и интеллектуальные энергетические компании осваивают работу с [интеллектуальными сетями](https://en.wikipedia.org/wiki/Smart_grid) , развертывая ряд сценариев использования данных, формируемых сетью. Множество сценариев использования опираются на специфические характеристики производства электроэнергии: ведь ее нельзя ни накапливать, ни хранить, как производственные запасы. Поэтому все, что вырабатывается, должно быть использовано. Для повышения эффективности работы коммунальных предприятий необходим прогноз энергопотребления — просто потому, что это даст больше возможностей **сбалансировать спрос и предложение**, предотвратив нерациональный расход энергии, **снизить выбросы парниковых газов** и контролировать затраты.

Что касается затрат, есть еще один немаловажный аспект — цена. При новых возможностях торговли электроэнергией между коммунальными предприятиями возникает огромная необходимость в **прогнозировании будущих потребностей в электроэнергии и ее цены**. Это поможет компаниям определить объемы производства.

Используя термин "интеллектуальная сеть" мы фактически подразумеваем сеть, которая способна обучаться и создавать прогнозы. Она может предвидеть сезонные колебания в энергопотреблении, а также **прогнозирует возможные ситуации временной перегрузки и автоматически подстраивается под них**. С помощью удаленного регулирования потребления (используя интеллектуальные счетчики) можно управлять локализованными ситуациями перегрузки. **Сначала прогнозируя, а затем действуя**, сеть со временем самообучается.

В оставшейся части этого документа основное внимание уделяется определенному семейству сценариев использования, которые охватывают краткосрочное и долгосрочное прогнозирование будущего спроса на энергию. Мы работаем в этих областях несколько месяцев и получили некоторые знания и навыки, которые позволяют достичь результатов отраслевого уровня. Другие сценарии использования будут также освещены в документе в ближайшем будущем.

## <a name="business-understanding"></a>Коммерческий аспект.
### <a name="business-goals"></a>Бизнес-цели
Цель **демонстрационного прогноза энергопотребления** — показать стандартное решение прогнозной аналитики и машинного обучения, которое можно развернуть за очень короткий промежуток времени. В данном случае основное внимание уделяется активации решений по прогнозированию спроса на энергию, которые помогут оперативно оценить и использовать его коммерческую ценность. Сведения в этом сборнике помогут клиентам достичь указанных ниже целей.

* Оперативная оценка решения на основе машинного обучения.
* Возможность расширения пилотного сценария использования и его преобразования в другие сценарии или в более масштабную область в зависимости от бизнес-потребностей.
* Быстрое обучение работе с продуктом Cortana Intelligence Suite.

Этот сборник предназначен для предоставления коммерческих и технических знаний, которые помогут в достижении указанных выше целей.

### <a name="power-load-and-demand-forecasting"></a>Прогнозирование электрической нагрузки и спроса
В энергетическом секторе прогнозирование спроса может помочь в решении ряда важнейших коммерческих вопросов. Прогноз спроса фактически является основой множества ключевых сценариев использования в отрасли. Мы рассмотрим два общих типа прогнозов спроса на энергию: краткосрочный и долгосрочный. Они могут служить различным целям и задействовать разные подходы. Основное различие между ними заключается в периоде прогнозирования, то есть в диапазоне времени в будущем, для которого составляется прогноз.

#### <a name="short-term-load-forecasting"></a>Краткосрочное прогнозирование нагрузки
В контексте спроса на энергию краткосрочный прогноз нагрузки (STLF) определяется как объединенная нагрузка, прогнозируемая в ближайшем будущем для различных частей сети (или сети в целом). В этом контексте краткосрочным считается период от 1 до 24 часов. В некоторых случаях можно установить период в 48 часов. STLF — распространенный прогноз для рабочего сценария использования сети. Ниже приведены некоторые примеры сценариев использования на основе STLF.

* Балансировка спроса и предложения.
* Поддержка торговли энергией.
* Рыночная деятельность (назначение цены на электроэнергию).
* Рабочая оптимизация сети.
* [Регулирование спроса](https://en.wikipedia.org/wiki/Demand_response)
* Прогнозирование пикового спроса.
* Управление спросом.
* Балансировка нагрузки и предотвращение перегрузки.
* Долгосрочное прогнозирование нагрузки.
* Обнаружение сбоев и аномалий.
* Сокращение (выравнивание) пиков. 

Модели STLF преимущественно основаны на недавних (за последний день или неделю) сведениях об энергопотреблении. В качестве основного прогностического фактора используется прогнозируемая температура. Сегодня получение точного прогноза температуры на час и даже на сутки вперед не составляет особой проблемы. Эти модели менее чувствительны к сезонным изменениям или долгосрочным тенденциям потребления.

Для SLTF-решений зачастую создается большой объем вызовов прогнозов (запросов на обслуживание), так как они вызываются каждый час, а в некоторых случаях и чаще. Кроме того, нередко выполняется внедрение, при котором каждая отдельная подстанция или трансформатор представлены в качестве автономных моделей. Вследствие этого объем запросов на прогнозирование еще больше возрастает.

#### <a name="long-term-load-forecasting"></a>Долгосрочное прогнозирование нагрузки
Цель долгосрочного прогнозирования нагрузки (LTLF) — прогнозирование спроса на энергию с временным диапазоном от 1 недели до нескольких месяцев (а в некоторых случаях и до нескольких лет). Этот период применяется в основном для сценариев использования в сферах планирования и инвестирования.

Для долгосрочных сценариев необходимо наличие высококачественных данных за несколько лет (минимум за 3 года). Эти модели обычно извлекают сведения о сезонных колебаниях из исторических данных. В качестве основных прогностических факторов используются внешние показатели, такие как изменения в зависимости от погоды и климата.

Важно указать, что чем больше период прогнозирования, тем менее точным может быть прогноз. Поэтому важно задавать для фактического прогноза надежные промежутки времени, позволяющие учитывать возможные вариации в процессе планирования.

Так как сценарий энергопотребления для LTLF разрабатывается в основном для планирования, объем данных ожидаемого прогноза будет гораздо меньше (по сравнению с STLF). Эти прогнозы обычно внедрены в средства визуализации, такие как Excel или PowerBI, и вызываются пользователем вручную.

### <a name="short-term-vs-long-term-prediction"></a>Сравнительная характеристика краткосрочного и долгосрочного прогнозирования
В следующей таблице сравниваются самые важные атрибуты STLF и LTLF.

| Атрибут | Краткосрочный прогноз нагрузки | Долгосрочный прогноз нагрузки |
| --- | --- | --- |
| Период прогноза |От 1 дня до 48 часов |От 1 до 6 месяцев или более |
| Степень детализации данных |Ежечасно |Ежечасно или ежедневно |
| Стандартные сценарии использования |<ul><li>Балансировка спроса и предложения</li><li>Прогнозирование времени наибольшей нагрузки</li><li>Регулирование спроса</li></ul> |<ul><li>Долгосрочное планирование</li><li>Планирование ресурсов сети</li><li>Планирование ресурсов</li></ul> |
| Стандартные прогностические факторы |<ul><li>День или неделя</li><li>Час дня</li><li>Почасовая температура</li></ul> |<ul><li>Месяц года</li><li>День месяца</li><li>Долгосрочное прогнозирование температуры и климатических условий</li></ul> |
| Диапазон исторических данных |Данные за период от 2 до 3 лет |Данные за период от 5 до 10 лет |
| Стандартная точность |MAPE* — 5 % и меньше |MAPE* — 25 % и меньше |
| Частота прогнозирования |Создается каждый час или каждые 24 часа |Создается раз в месяц, квартал или год |

\*[ MAPE](https://en.wikipedia.org/wiki/Mean_absolute_percentage_error) — средняя погрешность в процентах.

Как видно из этой таблицы, очень важно различать краткосрочный и долгосрочный сценарии прогнозирования, так как они соответствуют разным бизнес-требованиям. Схемы развертывания и потребления для них могут быть разными.

### <a name="example-use-case-1-esmart-systems--overload-optimization"></a>Пример сценария использования 1. Системы eSmart — оптимизация при перегрузке
Важная роль [интеллектуальной сети](https://en.wikipedia.org/wiki/Smart_grid) — динамично и непрерывно выполнять оптимизацию и настройку при изменении схем энергопотребления. Краткосрочные изменения, вызванные, как правило, колебаниями температуры, могут повлиять на энергопотребление (*например*, дополнительная электроэнергия используется для кондиционирования воздуха или отопления). В то же время энергопотребление также обусловлено долгосрочными тенденциями. Среди них — сезонные колебания, государственные праздники, долгосрочный рост потребления и даже экономические факторы, такие как индекс потребительских цен, цена на нефть и ВВП.

В этом случае [eSmart](http://www.esmartsystems.com/) предполагает развертывание облачного решения, которое дает возможность спрогнозировать тенденцию к перегрузке на любой заданной подстанции сети. В частности, eSmart определяет подстанции, которые с наибольшей вероятностью будут перегружены в течение следующего часа. Это позволяет немедленно принять меры для предотвращения или решения этой проблемы.

Для точного и быстрого прогнозирования необходимо реализовать три прогнозные модели.

* Долгосрочная модель, позволяющая прогнозировать энергопотребление на каждой подстанции в течение нескольких следующих недель или месяцев.
* Краткосрочная модель, позволяющая прогнозировать ситуацию перегрузки на отдельно взятой подстанции в течение следующего часа.
* Модель температуры, которая обеспечивает прогнозирование будущей температуры при нескольких сценариях.

Цель долгосрочной модели — ранжирование подстанций по их склонности к перегрузке (учитывая пропускную способность линии электропередачи) в течение следующей недели или месяца. Это позволяет создать краткий список подстанций, который будет использоваться в качестве входных данных для краткосрочного прогнозирования. Так как температура является важным фактором прогнозирования для долгосрочной модели, существует необходимость постоянно создавать прогноз погоды при нескольких сценариях и использовать его в качестве входных данных для долгосрочной модели. Краткосрочный прогноз вызывается, чтобы определить, какие подстанции могут быть перегружены в течение следующего часа.

Краткосрочная и долгосрочная модели развертываются отдельно для каждой подстанции. Таким образом, практическое применение этих моделей требует масштабной оркестрации. Чтобы повысить точность краткосрочного прогноза, для каждого часа в сутках используется более детализированная модель. Эти модели будут выполняться каждый час и завершать выполнение в течение нескольких минут. Это дает достаточно времени для реагирования и, при необходимости, для профилактики. Актуальность этой коллекции моделей поддерживается путем периодической переподготовки с использованием последних данных.

Дополнительные сведения об этом сценарии использования см. [здесь](https://customers.microsoft.com/Pages/CustomerStory.aspx?recid=18945).

#### <a name="use-case-qualification-criteria--prerequisites"></a>Квалификационные критерии сценария использования — предварительные требования
Основное преимущество Cortana Intelligence заключается в мощной возможности развертывать и масштабировать решения, ориентированные на машинное обучение. Это средство предназначено для поддержки тысяч прогнозов, которые выполняются параллельно. Его можно автоматически масштабировать, адаптировав к изменившейся схеме энергопотребления. Решение прежде всего ориентировано на точность и производительность вычислений. Например, коммунальному предприятию требуется точный прогноз спроса на энергию на следующий час и на каждый час дня. С другой стороны, нас не слишком интересует ответ на вопрос, почему получен именно такой прогноз спроса (об этом позаботится сама модель).

Поэтому важно понимать, что не все сценарии использования и бизнес-задачи можно эффективно решить с помощью машинного обучения.

Cortana Intelligence и машинное обучение могут быть весьма эффективны в решении данной бизнес-задачи при выполнении указанных ниже условий.

* Бизнес-задача должна быть **прогнозируемой** по своей сути. Пример прогнозируемого сценария использования: коммунальному предприятию требуется прогноз энергетической нагрузки на определенной подстанции в течение следующего часа. С другой стороны, анализ и ранжирование факторов исторического спроса будет по своей сути **описательным** , что значительно понижает его применимость.
* Существует четкий **перечень действий** , которые должны выполняться после прогноза. Например, прогноз перегрузки подстанции в течение следующего часа может активировать упреждающее действие — уменьшение нагрузки на этой подстанции — и потенциально предотвратить перегрузку.
* Сценарий использования представляет **стандартный тип проблемы** , решение которой укажет путь к решению проблем других аналогичных сценариев использования.
* Клиент может установить **количественные и качественные цели** для демонстрации успешной реализации решения. Например, подходящей количественной целью для прогноза спроса на энергию будет требуемое пороговое значение точности (*например*, допускается погрешность до 5 %). Либо же при прогнозировании перегрузки подстанции точность (количество истинно положительных результатов) и выборка (степень истинно положительных результатов) должны быть выше заданного порогового значения. Эти цели должны быть производными от бизнес-целей клиента.
* Существует четкий **сценарий интеграции** с рабочим процессом компании. Например, прогноз нагрузки подстанции можно интегрировать в центр управления сети, чтобы разрешить действия по предотвращению перегрузки.
* У клиента есть готовые к использованию **данные достаточного качества** для поддержки сценария использования (подробнее см. в разделе **Качество данных** этого сборника).
* Клиент располагает ориентированной на облачные службы архитектурой данных или **средствами машинного обучения на основе облачных служб**, включая машинное обучение Azure и другие компоненты Cortana Intelligence Suite.
* Клиент должен установить **сквозной поток данных**, который предоставляет средства доставки данных в облако на постоянной основе, и **ввести решение в эксплуатацию**.
* Клиенту необходимо **выделить персонал** , который будет активно участвовать в пилотной реализации, а также обеспечит передачу знаний и право собственности на решение клиенту после успешного завершения.
* Назначенный сотрудник клиента должен быть **квалифицированным специалистом по информационным технологиям**, предпочтительно специалистом по обработке и анализу данных.

Квалификация для этого сценария использования на основе указанных выше условий может значительно повысить шансы на его успешное выполнение и задать надежную позицию для реализации сценариев использования в будущем.

### <a name="cloud-based-solutions"></a>Облачные решения
Cortana Analytics Intelligence в Azure — это интегрированная среда, размещенная в облаке. Развертывание решения углубленной аналитики в облачной среде имеет значительные преимущества для бизнеса и в то же время может требовать существенных изменений для компаний, в которых по-прежнему используются локальные ИТ-решения. В энергетическом секторе существует четкая тенденция постепенного перехода операций в облако. Эта тенденция идет рука об руку с разработкой интеллектуальных сетей, как описано выше в разделе **Тенденции отрасли**. Этот сборник ориентирован на облачные решения в секторе энергетики. Поэтому важно объяснить преимущества и рекомендации относительно развертывания облачного решения.

Возможно, главным преимуществом облачного решения является его стоимость. Так как решение использует компоненты, развернутые в облаке, оно исключает необходимость в начальных капиталовложениях или расходах COGS (себестоимость проданных товаров) на компоненты. Это означает, что не требуется инвестировать средства в оборудование, программное обеспечение и ИТ-обслуживание. Поэтому степень бизнес-рисков существенно снижается.

Другим важным преимуществом является структура оплаты облачных решений по мере использования. Облачные серверы для вычислений и хранения можно развертывать и масштабировать по необходимости. Это обеспечивает экономичность облачных решений.

Наконец, нет необходимости инвестировать средства в разработку будущей инфраструктуры или ИТ-поддержки, так как все это является частью облачных услуг. Пакет Cortana Intelligence Suite включает службы высочайшего в своем классе уровня, и их развитие непрерывно продолжается. Постоянно добавляются и разрабатываются новые функции, компоненты и возможности.

Компаниям, которые только начинают переход в облако, мы настоятельно рекомендуем использовать поэтапный подход, реализуя план миграции в облако. Мы надеемся, что сценарии использования, рассмотренные в этом сборнике, предоставят коммунальным предприятиям и компаниям энергетического сектора прекрасную возможность для пилотного развертывания решения прогнозной аналитики в облаке.

#### <a name="business-case-justification-considerations"></a>Рекомендации по использованию бизнес-модели
Во многих случаях клиенты заинтересованы в коммерческом обосновании определенного сценария использования, важными компонентами которого являются облачное решение и машинное обучение. При использовании облачных решений (в отличие от локальных) начальные капиталовложения минимальны, а большая часть затрат связана с фактическим использованием. При развертывании решения по прогнозированию энергопотребления в Cortana Intelligence Suite несколько служб могут интегрироваться с одной общей структурой затрат. Например, базы данных (*в частности*, SQL Azure) можно использовать для хранения необработанных данных. Затем для фактического прогнозирования применяется служба машинного обучения Azure, где размещаются службы прогнозирования. В этом примере структура затрат может включать компоненты хранения и транзакций.

С другой стороны, необходимо глубокое понимание бизнес-преимуществ прогнозирования спроса на энергию (краткосрочного или долгосрочного). По сути, важно осознавать преимущества каждой операции прогнозирования. Например, точное прогнозирование электрической нагрузки на следующие 24 часа может предотвратить перепроизводство или способствовать предотвращению перегрузок в сети, что можно выразить в показателях ежедневной экономии финансовых средств.

Основная формула для вычисления экономической выгоды от использования решения по прогнозированию спроса выглядит следующим образом: ![Основная формула для вычисления экономической выгоды использования решения по прогнозированию спроса](media/cortana-analytics-playbook-demand-forecasting-energy/financial-benefit-formula.png)

Поскольку Cortana Intelligence Suite предоставляет возможность оплаты по мере использования, нет необходимости вводить в эту формулу компонент фиксированных затрат. Формула может вычисляться ежедневно, ежемесячно или ежегодно.

Текущие тарифные планы Cortana Intelligence Suite и машинного обучения Azure можно найти [здесь](http://azure.microsoft.com/pricing/details/machine-learning/).

### <a name="solution-development-process"></a>Процесс разработки решения
Цикл разработки решения по прогнозированию спроса на электроэнергию обычно включает 4 этапа. На каждом из них будут использоваться облачные технологии и службы Cortana Intelligence Suite.

Это показано на схеме ниже.

![Цикл интеллектуальной сети](media/cortana-analytics-playbook-demand-forecasting-energy/smart-grid-cycle.png)

В следующем абзаце описан этот процесс, разделенный на четыре этапа.

1. **Сбор данных.** В основе любого современного аналитического решения лежат данные (см. раздел **Аспект данных**). В частности, когда речь идет о прогнозной аналитике и прогнозировании, мы полагаемся на непрерывный динамический поток данных. Для прогнозирования спроса на энергию эти данные могут поступать непосредственно из интеллектуальных счетчиков или уже быть объединены в локальной базе данных. Кроме того, используются другие внешние источники данных, такие как погода и температура. Непрерывный поток данных должен упорядочиваться, заноситься в график и сохраняться. [Фабрика данных Azure](http://azure.microsoft.com/services/data-factory/) (ADF) является основным средством для выполнения этих задач.
2. **Моделирование.** Для точных и надежных прогнозов энергопотребления необходимо разработать (обучить) и обслуживать масштабную модель. В ней должны использоваться исторические данные, из которых будут извлекаться значимые и прогнозируемые закономерности. Сфера машинного обучения (ML) стремительно развивается, в ней постоянно разрабатываются все более и более сложные алгоритмы. Студия машинного обучения Microsoft Azure обеспечивает удобство работы для пользователя, позволяя использовать самые современные алгоритмы машинного обучения во всем рабочем процессе. Этот рабочий процесс проиллюстрирован на наглядной схеме потока. Он включает подготовку данных, извлечение компонентов, моделирование и оценку модели. Пользователь может применить сотни различных моделей, содержащихся в этой среде. В конце этого этапа специалист по обработке и анализу данных получает рабочую модель, которая полностью оценена и готова к развертыванию.
   
   На схеме ниже представлен стандартный рабочий процесс.
   
   ![Рабочий процесс моделирования](media/cortana-analytics-playbook-demand-forecasting-energy/modeling-workflow.png)
3. **Развертывание.** Располагая рабочей моделью, можно приступать к развертыванию. На этом этапе модель преобразуется в веб-службу, предоставляющую интерфейс RESTful API, который могут одновременно вызывать через Интернет разные клиенты. Машинное обучение Azure предоставляет простой способ развертывания модели непосредственно из Студии машинного обучения Microsoft Azure одним нажатием кнопки. Весь процесс развертывания происходит "за кулисами". Это решение можно автоматически масштабировать в соответствии с необходимым уровнем использования.
4. **Использование.** На этом этапе модель прогнозирования фактически используется для формирования прогнозов. Модель может использоваться с помощью приложения пользователя (*например*, панели мониторинга) или непосредственно из операционной системы, такой как система балансировки спроса и предложения или решение по оптимизации сети. На основе одной модели можно разработать несколько сценариев использования.

## <a name="data-understanding"></a>Аспект данных.
Рассмотрев коммерческие факторы (см. раздел **Коммерческий аспект**) решения по прогнозированию спроса на энергию, можно приступать к обсуждению аспекта данных. В основе любого решения прогнозной аналитики лежат надежные данные. Для прогнозирования спроса на энергию мы полагаемся на исторические данные по энергопотреблению с различными уровнями детализации. Эти исторические данные используются как исходный материал. Они будут подвергаться тщательному анализу, во время которого специалист по обработке данных определит прогностические факторы (также называющиеся функциями). Функции будут помещены в модель, которая в конечном счете создаст требуемые прогнозы.

В оставшейся части этого раздела мы опишем различные действия и приведем рекомендации для получения общего представления о данных и о том, как привести их в пригодную для использования форму.

### <a name="the-model-development-cycle"></a>Цикл разработки модели
Создание надежных моделей прогнозирования требует тщательной подготовки и планирования. Разбив процесс моделирования на несколько этапов и последовательно изучив каждый этап, можно значительно улучшить результаты для всего процесса.

На схеме ниже показано, как разделить процесс моделирования на несколько этапов.

![Цикл разработки модели](media/cortana-analytics-playbook-demand-forecasting-energy/model-development-cycle.png)

Как видим, цикл состоит из шести этапов:

* Постановка задачи.
* Прием и изучение данных.
* Подготовка данных и проектирование функций.
* Моделирование.
* Оценка модели.
* Разработка

В оставшейся части этого раздела приведено описание отдельных этапов и сведения, которые необходимо учитывать на каждом этапе.

### <a name="problem-formulation"></a>Постановка задачи.
Постановка задачи — важнейший этап, который необходимо завершить перед реализацией любого решения прогнозной аналитики. На этом этапе бизнес-задача преобразуется и разбивается на определенные элементы, которые могут быть разрешены с помощью данных и методов моделирования. Рекомендуем сформулировать проблему как ряд вопросов, на которые необходимо ответить. Ниже приведены некоторые возможные вопросы, которые могут быть применимы в области прогнозирования спроса на энергию.

* Какова ожидаемая нагрузка на отдельные подстанции в течение следующего часа или дня?
* В котором часу спрос на энергию в сети будет пиковым?
* Какова вероятность того, что сеть выдержит пиковую нагрузку?
* Какое количество энергии должна вырабатывать станция каждый час?

Постановка этих вопросов позволяет сосредоточиться на получении необходимых данных и реализации решения, которое будет полностью соответствовать требованиям поставленной бизнес-задачи. Кроме того, затем можно задать некоторые ключевые метрики, которые позволят оценить эффективность модели. Например, можно определить уровень точности прогноза и допустимый для компании диапазон погрешности.

### <a name="data-sources"></a>Источники данных
В современной интеллектуальной сети выполняется сбор данных из ее частей и компонентов. Эти данные представляют различные аспекты работы и использования энергосети. В контексте прогнозирования спроса на энергию мы остановимся на источниках данных, которые отражают фактические спрос и потребление. Важным источником сведений о потреблении энергии являются интеллектуальные счетчики. Коммунальные предприятия по всему миру оперативно переходят к развертыванию интеллектуальных счетчиков для своих пользователей. Интеллектуальные счетчики фиксируют фактические показатели энергопотребления и постоянно передают эти данные в коммунальное предприятие. Данные собираются и отправляются обратно с фиксированными интервалами (от 5 минут до 1 часа). Более сложные интеллектуальные счетчики можно удаленно программировать для контроля и распределения фактического потребления в жилом доме. Данные интеллектуальных счетчиков относительно надежны и содержат метку времени. Это делает их важным элементом прогнозирования спроса. Данные счетчиков можно агрегировать (суммировать) на различных уровнях топологии сети: трансформатора, подстанции, региона *и т. д.* Затем можно выбрать требуемый уровень агрегирования для построения модели прогнозирования. Например, коммунальному предприятию требуется прогнозирование будущей нагрузки на каждой подстанции ее сети. В таком случае все данные счетчиков для каждой отдельной подстанции агрегируются и используются в качестве входных данных для модели прогнозирования. Интеллектуальный счетчик является внутренним источником данных.

Для надежного прогнозирования спроса на энергию необходимо также задействовать внешние источники данных. Важным фактором, влияющим на энергопотребление, является погода, точнее температура. Исторические данные демонстрируют очевидную взаимосвязь между температурой окружающей среды и энергопотреблением. В жаркие летние дни потребители используют кондиционеры, а зимой включают отопительные приборы. Таким образом, надежный источник исторических сведений о температуре в месте расположения сети является ключевым фактором. Кроме того, мы можем полагаться на точный прогноз температуры как на прогностический фактор энергопотребления.

Другие внешние источники данных также применяются при создании прогнозных моделей спроса на энергию. Это могут быть длительные климатические изменения, экономические показатели (*например*, ВВП) и др. Однако в этом документе мы не будем останавливаться на такого рода источниках данных.

### <a name="data-structure"></a>Структура данных
Определив источники данных, следует убедиться, что собранные необработанные данные содержат надлежащие функции. Для создания надежной модели прогнозирования спроса необходимо, чтобы собранные данные включали компоненты, требующиеся для прогнозирования будущего спроса. Ниже приведены некоторые основные требования в отношении структуры (схемы) необработанных данных.

Необработанные данные должны состоять из строк и столбцов. Каждый замер должен быть представлен в виде одной строки данных. Каждая строка данных должна содержать несколько столбцов (также называемых функциями или полями).

1. **Метка времени.** В поле метки времени содержится фактическое время записи измерения. Оно должно быть указано в одном из стандартных форматов даты и времени. Необходимо наличие обоих компонентов — даты и времени. В большинстве случаев нет необходимости указывать время до второго уровня детализации. Важно указать часовой пояс, в котором ведется запись данных.
2. **Идентификатор средства измерения.** В этом поле указывается счетчик или устройство измерения. Это категориальная переменная, которая может быть сочетанием цифр и других символов.
3. **Значение потребления.** Это фактический показатель потребления на заданную дату и время. Потребление может измеряться в кВт·ч (киловатт-час) или любых других выбранных единицах. Важно отметить, что единицы измерения должны быть согласованными для всех измерений данных. Иногда электроэнергия подается при помощи более чем трех фаз. В таком случае необходимо собрать данные по всем независимым фазам энергопотребления.
4. **Температура.** Данные температуры обычно собираются из независимого источника. Тем не менее они должны быть совместимы с данными энергопотребления. Они должны содержать метку времени, как описано выше. Такая метка позволяет синхронизировать температурные показатели с данными фактического энергопотребления. Значение температуры может быть указано в градусах Цельсия или Фаренгейта, но при этом должна сохраняться согласованность между всеми измерениями.
5. **Расположение.** Это поле обычно связано с расположением, в котором собраны данные температуры. Расположение может быть представлено в формате индекса или широты и долготы.

В таблицах ниже представлены примеры правильных форматов данных потребления и температуры.

| **Дата** | **Время** | **Идентификатор средства измерения** | **Фаза 1** | **Фаза 2** | **Фаза 3** |
| --- | --- | --- | --- | --- | --- |
| 01.07.2015 |10:00:00 |АБВ1234 |7.0 |2,1 |5,3 |
| 01.07.2015 |10:00:01 |АБВ1234 |7.1. |2.2 |4.3. |
| 01.07.2015 |10:00:02 |АБВ1234 |6,0 |2,1 |4,0 |

| **Дата** | **Время** | **Расположение** | **Температура** |
| --- | --- | --- | --- |
| 01.07.2015 |10:00:00 |11242 |24,4 |
| 01.07.2015 |10:00:01 |11242 |24,4 |
| 01.07.2015 |10:00:02 |11242 |24,5 |

Как видим, этот пример включает три различных значения для энергопотребления, связанных с тремя фазами электричества. Обратите внимание, что поля даты и времени разделены, однако они также могут быть объединены в один столбец. В этом случае столбец расположения представлен в формате индекса из пяти цифр, а температуры — в формате градусов Цельсия.

### <a name="data-format"></a>Формат данных
Cortana Intelligence Suite поддерживает наиболее распространенные форматы данных, такие как CSV, TSV, JSON *и т. д.* Очень важно, чтобы формат данных был согласованным на протяжении всего жизненного цикла проекта.

### <a name="data-ingestion"></a>Прием данных
Поскольку прогноз спроса на энергию основан на постоянном потоке данных и выполняется довольно часто, необходимо убедиться, что необработанные данные передаются с помощью стабильных и надежных средств приема. Процесс приема должен гарантировать доступность необработанных данных для прогнозирования в нужное время. Это подразумевает, что частота приема данных должна быть выше, чем частота прогнозирования.

Пример. Если решение по прогнозированию спроса создает новый прогноз ежедневно в 08:00, то необходимо гарантировать, что все данные, собранные за последние 24 часа, будут полностью приняты до этого момента и будут включать сведения даже за последний час.

Чтобы добиться этого, Cortana Intelligence Suite предлагает различные способы поддержки процесса приема данных. Этот вопрос будет подробнее рассматриваться в разделе **Развертывание** данного документа.

### <a name="data-quality"></a>Качество данных
Источник необработанных данных, необходимых для надежного и точного прогнозирования спроса, должен соответствовать определенным базовым критериям качества данных. Хотя для решения некоторых проблем с качеством данных можно использовать усовершенствованные статистические методы, все же следует убедиться, что во время приема новых данных превышается определенное пороговое значение для базового качества данных. Ниже приведены некоторые рекомендации, касающиеся качества необработанных данных.

* **Отсутствующее значение.** Это относится к ситуации, при которой данные конкретного измерения не были собраны. Основным требованием для такой ситуации является, чтобы доля отсутствующих значений не превышала 10 % для любого заданного периода. В случае отсутствия одиночного значения оно должно быть указано с помощью предварительно определенного значения (например, 9999), которое не равно 0 и может использоваться в допустимом измерении.
* **Точность измерения.** Фактическое значение энергопотребления или температуры должно быть определено с высокой точностью. На основе неточных измерений создаются неточные прогнозы. Как правило, погрешность измерения должна составлять менее 1 % относительно истинного значения.
* **Время измерения.** Необходимо, чтобы фактическая метка времени собранных данных не отклонялась более чем на 10 секунд от истинного времени фактического измерения.
* **Синхронизация.** Если используется несколько источников данных (*например*, энергопотребления и температуры), следует убедиться, что между ними нет проблем синхронизации времени. Это означает, что разница во времени между собранными метками времени из двух любых независимых источников данных не должна превышать 10 секунд.
* **Задержка.** Как описано выше в разделе **Прием данных**, прогнозирование зависит от надежности потока данных и их приема. Чтобы контролировать их, необходимо убедиться, что мы контролируем задержку данных. Она определяется как разница во времени между моментом фактического измерения и временем, когда оно было загружено в хранилище Cortana Intelligence Suite и стало готовым к использованию. Для краткосрочных прогнозов нагрузки общая задержка не должна превышать 30 минут. Для долгосрочных прогнозов нагрузки общая задержка не должна превышать 1 день.

### <a name="data-preparation-and-feature-engineering"></a>Подготовка данных и проектирование функций.
Как только необработанные данные будут приняты (см. раздел **Прием данных**) и надежно сохранены, можно приступать к их обработке. По сути, подготовительный этап заключается в получении необработанных данных и их преобразовании (трансформации) в форму, необходимую для моделирования. Этот процесс может включать простые операции, такие как использование столбца необработанных данных с фактическим измеренным значением, стандартизированных значений, а также более сложные операции, такие как [временная задержка](https://en.wikipedia.org/wiki/Lag_operator), и т. п. Только что созданные столбцы данных называются функциями данных, а процесс их создания называется проектированием функций. По завершении этого процесса из необработанной информации будет получен набор данных, который может использоваться для моделирования. Кроме того, на этапе подготовки данных необходимо позаботиться об отсутствующих значениях (см. раздел **Качество данных**) и их компенсации. В некоторых случаях также необходимо нормализовать данные, чтобы убедиться, что все значения представлены в одном масштабе.

В этом разделе перечислены некоторые распространенные функции данных, включенные в модели прогнозирования спроса на энергию.

**Временные функции.** Эти функции являются производными от данных даты или метки времени. Они извлекаются и преобразуются в категориальные функции, такие как:

* Время суток — это час дня; принимает значения от 0 до 23.
* День недели — это день недели; принимает значения от 1 (воскресенье) до 7 (суббота).
* День месяца — это фактическая дата; принимает значения от 1 до 31.
* Месяц года — это месяц; принимает значения от 1 (январь) до 12 (декабрь).
* Выходной день — это функция с двоичным значением; принимает значение 0 для будних дней и 1 для выходных дней.
* Праздничный день — это функция с двоичным значением; принимает значение 0 для обычных дней недели и 1 для праздничных дней.
* Условия Фурье — это весовые коэффициенты, которые являются производными от метки времени и используются для записи данных сезонных колебаний (циклов). Поскольку данные могут охватывать несколько сезонов, может понадобиться несколько условий Фурье. Например, для значений спроса могут учитываться ежегодные, еженедельные и ежедневные сезоны или циклы, что требует наличия трех условий Фурье.

**Функции независимого измерения.** Независимые функции включают все элементы данных, которые необходимо использовать в модели в качестве прогностических факторов. Здесь исключается зависимая функция, которая может потребоваться для прогнозирования.

* Функция запаздывания — это значения фактического спроса со сдвигом во времени. Например, функции запаздывания 1 будут содержать значение спроса за предыдущий час (при использовании почасовых данных) по отношению к текущей метке времени. Аналогичным образом можно добавить функции запаздывания 2, 3 и *т. д.* Фактическое сочетание используемых функций запаздывания определяется на этапе моделирования путем оценки результатов модели.
* Анализ долгосрочных тенденций — эта функция представляет линейный рост спроса за определенное количество лет.

**Зависимый компонент.** Это столбец данных, который необходимо использовать в модели для прогнозирования. Прежде всего, при помощи [контролируемого машинного обучения](https://en.wikipedia.org/wiki/Supervised_learning) необходимо обучить модель, используя зависимые компоненты (которые также называются метками). Это позволяет модели изучить закономерности в данных, связанных с зависимыми функциями. В прогнозе спроса на энергию обычно требуется определить будущий фактический спрос. Поэтому он используется в качестве зависимой функции.

**Обработка отсутствующих значений.** На этапе подготовки данных необходимо определить оптимальную стратегию для обработки отсутствующих значений. В большинстве случаев это делается с помощью различных статистических [методов подстановки данных](https://en.wikipedia.org/wiki/Imputation_\(statistics\)). При прогнозировании спроса на энергию отсутствующие значения обычно добавляются с помощью скользящего среднего из предыдущих доступных точек данных.

**Нормализация данных.** Это еще один тип преобразования, который используется для приведения всех числовых данных, например прогноза спроса, к одному масштабу. Как правило, это позволяет повысить точность и достоверность модели. Обычно этот процесс выполняется путем деления фактического значения на диапазон данных.
Исходное значение будет сведено к более узкому диапазону (обычно от –1 до 1).

## <a name="modeling"></a>Моделирование
На этапе моделирования выполняется преобразование данных в модель. В основе этого процесса лежат дополнительные алгоритмы, которые сканируют исторические данные (данные для обучения), извлекают закономерности и выполняют построение модели. Эту модель можно использовать впоследствии для прогнозирования на основе новых данных, не применявшихся для построения модели.

Готовую надежную модель можно использовать для оценки новых данных, структурированных для включения требуемых функций (X). При оценке будет использоваться сохраненная модель (объект из этапа обучения) и выполняться прогнозирование целевой переменной, обозначенной как Ŷ.

### <a name="demand-forecasting-modeling-techniques"></a>Методы моделирования для прогнозирования спроса
При прогнозировании спроса можно использовать исторические данные в хронологическом порядке. Как правило, используются данные с измерением времени, такие как [временной ряд](https://en.wikipedia.org/wiki/Time_series). Цель моделирования временного ряда — определение временных тенденций и сезонных колебаний, автокорреляция (корреляция со временем) и разработка модели на их основе.

В последние годы были разработаны усовершенствованные алгоритмы для прогнозирования временных рядов и повышения точности прогнозов. Вкратце опишем некоторые из них.

> [!NOTE]
> Этот раздел не является руководством по машинному обучению и прогнозированию. Это, скорее, краткий обзор методов моделирования, которые обычно используются для прогнозирования спроса. Для получения дополнительных сведений и обучающих материалов по прогнозированию временных рядов настоятельно рекомендуем ознакомиться с электронной книгой [Forecasting: principles and practice](https://www.otexts.org/book/fpp) (Прогнозирование: принципы и практика).
> 
> 

#### <a name="ma-moving-averagehttpswwwotextsorgfpp62"></a>[**МА (скользящее среднее)**](https://www.otexts.org/fpp/6/2)
Скользящее среднее — один из первых аналитических методов, которые использовались для прогнозирования временных рядов. Он до сих пор является одним из наиболее широко используемых методов. Кроме того, это основа для более сложных методов прогнозирования. С помощью скользящего среднего можно выполнить прогноз для следующей точки данных, усреднив значения для K последних точек, где K указывает порядок скользящего среднего.

Метод скользящего среднего оказывает сглаживающее действие на прогноз. При значительной изменчивости данных он может быть нерезультативным.

#### <a name="ets-exponential-smoothinghttpswwwotextsorgfpp75"></a>[**ETS (экспоненциальное сглаживание)**](https://www.otexts.org/fpp/7/5)
Экспоненциальное сглаживание (ETS) — это семейство различных методов, использующих взвешенное среднее последних точек данных для прогнозирования следующей точки. Идея заключается в том, чтобы назначить более высокие весовые коэффициенты новым значениям и постепенно уменьшить этот весовой коэффициент для более ранних измерений. Есть несколько различных методов этого семейства. Некоторые из них включают обработку сезонных колебаний данных, например [сезонный метод Хольта — Уинтерса](https://www.otexts.org/fpp/7/5).

В некоторых из этих методов также учитываются сезонные колебания данных.

#### <a name="arima-auto-regression-integrated-moving-averagehttpswwwotextsorgfpp8"></a>[**ARIMA (интегрированное скользящее среднее с авторегрессией)**](https://www.otexts.org/fpp/8)
Интегрированное скользящее среднее с авторегрессией (ARIMA) — это еще одно семейство методов, часто используемых для прогнозирования временного ряда. Фактически в нем объединяются методы авторегрессии и скользящего среднего. Методы авторегрессии используют модели регрессии, применяя значения предыдущего временного ряда для вычисления следующей точки данных. Методы ARIMA также работают с применением разностных методов, которые включают вычисление разности между точками данных и используют ее вместо исходного измеренного значения. Наконец, ARIMA также использует методы скользящего среднего, описанные выше. Различные сочетания всех этих методов составляют семейство методов ARIMA.

Сегодня ETS и ARIMA широко используются для прогнозирования спроса на энергию и многих других задач прогнозирования. Часто для максимального повышения точности результатов используется их сочетание.

**Общая множественная регрессия.** Использование регрессионных моделей, возможно, является наиболее важным подходом моделирования в области машинного обучения и статистики. В контексте временного ряда регрессия используется для прогнозирования будущих значений (*например*, спроса). В процессе обучения для регрессии используется линейная комбинация прогностических факторов и определяются их весовые коэффициенты. В результате создается линия регрессии, которая используется для прогнозирования значения. Регрессионные методы применяются, если целевая переменная является числовой и подходит для прогнозирования временного ряда. Есть широкий спектр регрессионных методов, включая очень простые модели регрессии, такие как [линейная регрессия](https://en.wikipedia.org/wiki/Linear_regression), и более сложные, такие как деревья принятия решений, [случайные леса](https://en.wikipedia.org/wiki/Random_forest), [нейронные сети](https://en.wikipedia.org/wiki/Artificial_neural_network) и увеличивающиеся деревья принятия решений.

Разработка прогноза спроса на энергию в качестве проблемы регрессии обеспечивает повышенную гибкость в выборе функций данных, которые можно получить, объединив фактические данные временного ряда спроса и внешние факторы, такие как температура. Дополнительные сведения об определенных функциях можно найти в разделе о проектировании функций (см. раздел **Подготовка данных и проектирование функций**) этого сборника.

После внедрения и развертывания пилотного прогноза спроса на энергию мы обнаружили, что усовершенствованные модели регрессии, доступные в машинном обучении Azure, как правило, дают наиболее высокие результаты и их использование обоснованно.

## <a name="model-evaluation"></a>Оценка модели.
Оценка модели играет важную роль в **цикле разработки модели**. На этом этапе выполняется проверка модели и ее производительности с использованием реальных данных. На этапе моделирования часть доступных данных используется для обучения модели. На этапе оценки оставшаяся часть данных используется для проверки модели. На практике это означает, что мы загружаем в модель реструктуризированные новые данные, которые содержит те же функции, что и набор данных для обучения. Однако при проверке используется модель для прогнозирования целевой переменной. Доступная целевая переменная не применяется. Часто этот процесс называется оценкой модели. Мы будем использовать истинные целевые значения и сравнивать их с прогнозируемыми. Цель — измерить и свести к минимуму погрешность прогноза, то есть разницу между прогнозируемыми и истинными значениями. Вычисление погрешности измерения — ключевой фактор, так как нам необходимо выполнить тонкую настройку модели и проверить, уменьшается ли погрешность на самом деле. Тонкую настройку модели можно выполнить, изменив ее параметры, которые управляют процессом обучения, или добавив либо же удалив функции данных (этот процесс называется [очисткой параметров](https://channel9.msdn.com/Blogs/Azure/Data-Science-Series-Building-an-Optimal-Model-With-Parameter-Sweep)). На практике это означает, что может потребоваться повторить цикл проектирования функций, моделирования и оценки модели несколько раз, пока погрешность не будет уменьшена до требуемого уровня.

Важно отметить, что погрешность прогноза никогда не будет нулевой, так как невозможно создать модель, которая выполнит идеальный прогноз каждого результата. Однако существует определенная величина погрешности, допустимая для компании. При проверке необходимо убедиться, что погрешность прогноза модели находится на допустимом для компании уровне или не превышает его. Поэтому важно установить уровень допустимой погрешности в начале цикла, на этапе **постановки задачи** .

### <a name="typical-evaluation-techniques"></a>Стандартные методы оценки
Существуют различные методы измерения и вычисления погрешности прогноза. В этом разделе основное внимание уделяется методам оценки для прогнозирования спроса на энергию в отношении временного ряда.

#### <a name="mapehttpsenwikipediaorgwikimeanabsolutepercentageerror"></a>[**MAPE**](https://en.wikipedia.org/wiki/Mean_absolute_percentage_error)
MAPE — это средняя абсолютная погрешность в процентах. С помощью MAPE можно определить разницу между прогнозируемым и фактическим значениями каждой точки. Затем для каждой точки определяется погрешность путем вычисления пропорции разницы относительно фактического значения. На последнем этапе эти значения усредняются. Математическая формула, используемая для MAPE, выглядит следующим образом:

![Формула MAPE](media/cortana-analytics-playbook-demand-forecasting-energy/mape-formula.png)
*, где A<sub>t</sub> — фактическое значение; F<sub>t</sub> — прогнозируемое значение, а n — период прогноза.*

## <a name="deployment"></a>Развертывание
По завершении этапа моделирования и проверки эффективности модели можно приступать к этапу развертывания. В этом контексте развертывание означает предоставление клиенту возможности использовать модель, выполняя с ее помощью фактические крупномасштабные прогнозы. Концепция развертывания в машинном обучении Azure является ключевой, поскольку наша основная цель заключается в возможности постоянного выполнения прогнозов, а не только анализа данных. На этапе развертывания модель должна быть подготовлена для использования в крупных масштабах.

В контексте прогнозирования спроса на энергию нашей целью является выполнение непрерывных периодических прогнозов с гарантией того, что для модели доступны новые данные и что данные прогноза отправляются назад клиенту.

### <a name="web-services-deployment"></a>Развертывание веб-служб
Основным стандартным блоком развертывания машинного обучения Azure является веб-служба. Это наиболее эффективный способ обеспечить возможность использования прогнозной модели в облаке. Веб-служба инкапсулирует модель и снабжает ее интерфейсом [RESTful](http://www.restapitutorial.com/) API (интерфейс прикладного программирования). API можно использовать в составе любого клиентского кода, как показано на следующей схеме.

![Развертывание и использование веб-службы](media/cortana-analytics-playbook-demand-forecasting-energy/web-service-deployment-and-consumption.png)

Как можно увидеть, веб-служба развертывается в облаке Cortana Intelligence Suite. Ее можно вызывать через предоставляемую в облаке конечную точку REST API. Клиенты разных типов в различных доменах могут одновременно вызывать службу через веб-API. Кроме того, веб-службы можно масштабировать для поддержки тысяч одновременных вызовов.

### <a name="a-typical-solution-architecture"></a>Стандартная архитектура решения
Для прогнозирования спроса на энергию необходимо развернуть комплексное решение, которое выходит за рамки веб-службы прогнозирования и упрощает передачу потока данных. При вызове нового прогноза необходимо убедиться, что в модель загружены функции с самыми последними данными. Это подразумевает, что недавно собранные необработанные данные непрерывно принимаются, обрабатываются и преобразуются в набор необходимых функций, на котором основана модель. В то же время необходимо сделать данные прогноза доступными для использования конечными клиентами. На схеме ниже показан цикл потока данных (или конвейер данных).

![Сквозной поток данных прогнозирования спроса на энергию](media/cortana-analytics-playbook-demand-forecasting-energy/energy-demand-forecase-end-data-flow.png)

Ниже описаны действия, выполняемые в рамках цикла прогнозирования спроса на энергию.

1. Миллионы развернутых счетчиков данных непрерывно создают данные энергопотребления в режиме реального времени.
2. Эти данные собираются и загружаются в облачное хранилище (*например*, в хранилище BLOB-объектов Azure).
3. Перед обработкой необработанные данные группируются по подстанции или региону в зависимости от требований компании.
4. Затем выполняется обработка функций (см. раздел **Подготовка данных и проектирование функций**) и формируются данные, необходимые для обучения или оценки модели. Набор данных функций хранится в базе данных (*например*, SQL Azure).
5. Для повторного обучения модели прогнозирования вызывается служба повторного обучения. Обновленная версия модели сохраняется для последующего использования веб-службой оценки.
6. Веб-служба оценки вызывается по расписанию, которое соответствует требуемой частоте прогнозирования.
7. Прогнозируемые данные сохраняются в базе данных, к которой предоставляется доступ конечному клиенту.
8. Клиент получает прогнозы, применяет их в сети и использует ее в соответствии с требуемым сценарием.

Важно отметить, что этот цикл полностью автоматизирован и выполняется по расписанию. Полную оркестрацию этого цикла данных можно выполнить с помощью таких средств, как [фабрика данных Azure](http://azure.microsoft.com/services/data-factory/).

### <a name="end-to-end-deployment-architecture"></a>Сквозная архитектура развертывания
Чтобы на практике развернуть решение по прогнозированию спроса на энергию в Cortana Intelligence, необходимо обеспечить внедрение и надлежащую настройку всех требуемых компонентов.

На схеме ниже представлена стандартная архитектура на основе Cortana Intelligence, в которой реализуется цикл потока данных, описанных выше, и выполняется его оркестрация:

![Сквозная архитектура развертывания](media/cortana-analytics-playbook-demand-forecasting-energy/architecture.png)

Дополнительные сведения о каждом компоненте и полной архитектуре см. в разделе "Шаблон решения по прогнозированию спроса на энергию".

