---
title: "Сохранение данных tooconfigure aaaHow для кэша Redis Azure Premium"
description: "Узнайте, как tooconfigure и управления ими данных сохраняемости экземпляры кэша Redis для Azure уровня Premium"
services: redis-cache
documentationcenter: 
author: steved0x
manager: douge
editor: 
ms.assetid: b01cf279-60a0-4711-8c5f-af22d9540d38
ms.service: cache
ms.workload: tbd
ms.tgt_pltfrm: cache-redis
ms.devlang: na
ms.topic: article
ms.date: 08/24/2017
ms.author: sdanie
ms.openlocfilehash: 62feb6f5522e0270487f045eb303bf852434143d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="how-tooconfigure-data-persistence-for-a-premium-azure-redis-cache"></a>Способ сохранения данных tooconfigure для кэша Redis Azure Premium
Кэш Azure Redis имеет разные предложения кэша которые обеспечивают гибкость при hello Выбор размера кэша и функций, включая возможности уровня Premium кластеризации, сохраняемости и поддержки виртуальной сети. В этой статье описывается, как tooconfigure сохраняемости в расширенной Azure Redis кэш экземпляра.

Сведения о других функций кэша premium см. в разделе [уровня Premium кэша Redis Azure введение toohello](cache-premium-tier-intro.md).

## <a name="what-is-data-persistence"></a>Что такое постоянное хранение?
[Redis сохраняемости](https://redis.io/topics/persistence) позволяет toopersist данные, хранящиеся в Redis. Можно также создавать снимки и резервное копирование данных hello, который можно загрузить в случае сбоя оборудования. Это огромное преимущество перед Basic или стандартного уровня, где все hello данных хранится в памяти и может быть возможной потери данных в случае сбоя, где узлы кэша не работают. 

Кэш Azure Redis предоставляет сохраняемости Redis, с помощью следующих моделей hello.

* **Сохраняемость RDB** -настроен сохраняемости при RDB (база данных Redis), моментальный снимок кэша Redis hello в Redis, toodisk двоичный формат в зависимости от можно настроить интервал резервного копирования сохраняется кэша Redis для Azure. В случае критического события, отключает hello первичный и реплика кэша кэш hello перестраивается с помощью hello самый последний моментальный снимок. Дополнительные сведения о hello [преимущества](https://redis.io/topics/persistence#rdb-advantages) и [недостатки](https://redis.io/topics/persistence#rdb-disadvantages) RDB сохраняемости.
* **Сохраняемости AOF** -настроен сохраняемости при AOF (Append только файл), каждый журнал tooa операции записи, сохраняется по крайней мере один раз в секунду в учетную запись хранилища Azure сохраняет кэша Redis для Azure. В случае критического события, отключает hello первичный и реплика кэша кэш hello перестраивается с помощью операций записи хранятся hello. Дополнительные сведения о hello [преимущества](https://redis.io/topics/persistence#aof-advantages) и [недостатки](https://redis.io/topics/persistence#aof-disadvantages) AOF сохраняемости.

Сохраняемость настраивается от hello **новый кэш Redis** колонке во время создания кэша, а также на hello **ресурсов меню** существующие premium кэширует.

[!INCLUDE [redis-cache-create](../../includes/redis-cache-premium-create.md)]

Выбрав ценовую категорию Премиум, щелкните **Сохраняемость Redis**.

![Сохраняемость Redis][redis-cache-persistence]

Hello в следующем разделе hello описывается, как tooconfigure Redis сохраняемости на новый кэш premium. После настройки сохраняемости Redis щелкните **создать** toocreate вашей premium новый кэш с Redis сохраняемости.

## <a name="enable-redis-persistence"></a>Включение сохраняемости Redis

Redis сохраняемость включена на hello **сохраняемости данных Redis** колонки, либо выбрав **RDB** или **AOF** сохраняемости. Для нового кэша эту колонку осуществляется во время процесса создания кэша hello, как описано в предыдущем разделе hello. Для существующего кэша hello **сохраняемости данных Redis** колонке осуществляется из hello **ресурсов меню** своего кэша.

![Параметры Redis][redis-cache-settings]


## <a name="configure-rdb-persistence"></a>Настройка сохраняемости RDB

Сохранение RDB tooenable, нажмите кнопку **RDB**. toodisable RDB сохраняемости на ранее включенный premium кэш, нажмите кнопку **отключено**.

![Сохраняемость RDB Redis][redis-cache-rdb-persistence]

tooconfigure hello интервал создания резервной копии, выберите **интервал резервного копирования** из раскрывающегося списка hello. Вы можете выбрать **15 минут**, **30 минут**, **60 минут**, **6 часов**, **12 часов** или **24 часа**. Этот период начинается отсчет после успешного завершения предыдущей операции резервного копирования hello и запускается по истечении его новой резервной копии.

Нажмите кнопку **учетной записи хранилища** tooselect hello toouse учетной записи хранилища и выберите либо hello **первичного ключа** или **вторичный ключ** toouse из hello **хранилища Ключ** раскрывающегося списка. Необходимо выбрать учетную запись хранилища в hello же регионе, что кэш hello и **хранилище Premium** учетной записи рекомендуется, так как хранилище premium имеет более высокую пропускную способность. 

> [!IMPORTANT]
> При повторном создании hello ключ хранилища для учетной записи сохраняемости, необходимо перенастроить hello нужного ключа из hello **ключ хранилища** раскрывающегося списка.
> 
> 

Нажмите кнопку **ОК** toosave hello сохраняемости конфигурации.

После истечения интервала резервного копирования hello инициируется Hello следующего резервного копирования (или первой резервной копии для нового кэша).

## <a name="configure-aof-persistence"></a>Настройка сохраняемости AOF

Сохранение AOF tooenable, нажмите кнопку **AOF**. toodisable AOF сохраняемости на ранее включенный premium кэш, нажмите кнопку **отключено**.

![Сохраняемость AOF Redis][redis-cache-aof-persistence]

Сохранение AOF tooconfigure, укажите **первой учетной записи хранения**. Эта учетная запись должна находиться в hello же регионе, что кэш hello и **хранилище Premium** учетной записи рекомендуется, так как хранилище premium имеет более высокую пропускную способность. При необходимости можно настроить дополнительную учетную запись хранения с именем **Вторичная учетная запись хранения**. Если настроен вторую учетную запись хранилища, hello кэш-реплика записывает toohello записываются toothis вторую учетную запись хранилища. Для каждого настроенная учетная запись хранилища, выберите либо hello **первичного ключа** или **вторичный ключ** toouse из hello **ключ хранилища** раскрывающегося списка. 

> [!IMPORTANT]
> При повторном создании hello ключ хранилища для учетной записи сохраняемости, необходимо перенастроить hello нужного ключа из hello **ключ хранилища** раскрывающегося списка.
> 
> 

При включении сохраняемости AOF запись кэша toohello операции сохраняются toohello назначить учетной записи хранения (или учетные записи, если вы настроили вторую учетную запись хранилища). В событии hello разрушительного сбоя, принимает вниз оба hello первичный и кэша-реплики, hello хранимых AOF журнала является используется toorebuild hello кэша.

## <a name="persistence-faq"></a>Часто задаваемые вопросы о постоянном хранении
Hello следующий список содержит toocommonly ответы, вопросы и ответы о сохраняемости кэша Redis для Azure.

* [Можно ли включить постоянное хранение для ранее созданного кэша?](#can-i-enable-persistence-on-a-previously-created-cache)
* [Можно включить сохраняемость AOF и RDB на hello одновременно?](#can-i-enable-aof-and-rdb-persistence-at-the-same-time)
* [Какую модель сохраняемости следует выбрать?](#which-persistence-model-should-i-choose)
* [Что произойдет, если я масштабируется tooa другого размера и восстановлении резервной копии, сделанной до hello операция масштабирования?](#what-happens-if-i-have-scaled-to-a-different-size-and-a-backup-is-restored-that-was-made-before-the-scaling-operation)


### <a name="rdb-persistence"></a>Сохраняемость RDB
* [Можно изменить частоту резервного копирования RDB hello после создания кэша hello?](#can-i-change-the-rdb-backup-frequency-after-i-create-the-cache)
* [Почему при установленной частоте резервного копирования RDB в 60 минут между созданием резервных копий проходит больше времени?](#why-if-i-have-an-rdb-backup-frequency-of-60-minutes-there-is-more-than-60-minutes-between-backups)
* [Что происходит toohello старые резервные копии RDB при внесении новую резервную копию?](#what-happens-to-the-old-rdb-backups-when-a-new-backup-is-made)

### <a name="aof-persistence"></a>Сохраняемость AOF
* [Когда следует использовать вторичную учетную запись хранения?](#when-should-i-use-a-second-storage-account)
* [Влияет ли сохраняемость AOF на пропускную способность, задержку или производительность кэша?](#does-aof-persistence-affect-throughout-latency-or-performance-of-my-cache)
* [Как удалить hello вторую учетную запись хранилища?](#how-can-i-remove-the-second-storage-account)
* [Что такое перезапись и как она влияет на кэш?](#what-is-a-rewrite-and-how-does-it-affect-my-cache)
* [Что следует ожидать при масштабировании кэша с включенной сохраняемостью AOF?](#what-should-i-expect-when-scaling-a-cache-with-aof-enabled)
* [Как организованы данные AOF в хранилище?](#how-is-my-aof-data-organized-in-storage)


### <a name="can-i-enable-persistence-on-a-previously-created-cache"></a>Можно ли включить постоянное хранение для ранее созданного кэша?
Да, вы можете настроить сохраняемость Redis как при создании кэша, так и в уже существующем кэше Премиум.

### <a name="can-i-enable-aof-and-rdb-persistence-at-hello-same-time"></a>Можно включить сохраняемость AOF и RDB на hello одновременно?

Нет, можно включить только RDB или AOF, но не оба hello то же время.

### <a name="which-persistence-model-should-i-choose"></a>Какую модель сохраняемости следует выбрать?

AOF сохраняемости сохраняет tooa каждой записи журнала, в который влияет на пропускную способность, по сравнению с RDB сохраняемости, который сохраняет резервные копии на hello основе настроить интервал резервного копирования, с минимальным влиянием на производительность. Выберите AOF сохраняемости, если главной задачей является toominimize потери данных и снижение пропускной способности можно обработать для кэша. Выберите RDB сохраняемости, если вы хотите toomaintain оптимальной пропускной способности на ваш кэш, но по-прежнему требуется механизм для восстановления данных.

* Дополнительные сведения о hello [преимущества](https://redis.io/topics/persistence#rdb-advantages) и [недостатки](https://redis.io/topics/persistence#rdb-disadvantages) RDB сохраняемости.
* Дополнительные сведения о hello [преимущества](https://redis.io/topics/persistence#aof-advantages) и [недостатки](https://redis.io/topics/persistence#aof-disadvantages) AOF сохраняемости.

Дополнительные сведения о производительности при использовании сохраняемости AOF см. в разделе [Влияет ли сохраняемость AOF на пропускную способность, задержку или производительность кэша?](#does-aof-persistence-affect-throughout-latency-or-performance-of-my-cache)

### <a name="what-happens-if-i-have-scaled-tooa-different-size-and-a-backup-is-restored-that-was-made-before-hello-scaling-operation"></a>Что произойдет, если я масштабируется tooa другого размера и восстановлении резервной копии, сделанной до hello операция масштабирования?

Сохраняемость RDB и AOF:

* Если масштабирование больший размер tooa влияния не оказывается.
* Если масштабируется tooa меньшего размера, и имеется пользовательский [баз данных](cache-configure.md#databases) параметре больше, чем hello [предел баз данных](cache-configure.md#databases) для вашего нового размера данных в этих базах данных не восстанавливается. Дополнительные сведения см. в разделе [Что происходит с пользовательским параметром databases при масштабировании?](cache-how-to-scale.md#is-my-custom-databases-setting-affected-during-scaling)
* Если не хватает места в меньший размер toohold hello удаления всех данных hello из последней резервной копии, ключи hello в процессе восстановления hello масштабировать tooa меньшего размера, обычно с помощью hello [allkeys lru](http://redis.io/topics/lru-cache) вытеснения политика.

### <a name="can-i-change-hello-rdb-backup-frequency-after-i-create-hello-cache"></a>Можно изменить частоту резервного копирования RDB hello после создания кэша hello?
Да, можно изменить интервал резервного копирования hello для сохраняемости RDB на hello **сохраняемости данных Redis** колонку. Инструкции см. в разделе [Настройка сохраняемости Redis](#configure-redis-persistence).

### <a name="why-if-i-have-an-rdb-backup-frequency-of-60-minutes-there-is-more-than-60-minutes-between-backups"></a>Почему при установленной частоте резервного копирования RDB в 60 минут между созданием резервных копий проходит больше времени?
Hello RDB сохраняемости интервал резервного копирования не будет начата до предыдущего резервного копирования процесс hello успешно завершен. Если интервал резервного копирования hello составляет 60 минут, и он принимает полный процесс резервного копирования toosuccessfully 15 минут, hello следующая резервная копия не запускается до 75 минут после hello запуск hello предыдущей резервной копии.

### <a name="what-happens-toohello-old-rdb-backups-when-a-new-backup-is-made"></a>Что происходит toohello старые резервные копии RDB при внесении новую резервную копию?
Автоматически удаляются все резервные копии RDB сохраняемости, за исключением hello самую последнюю из них. Это удаление может происходить не сразу, но старые резервные копии не хранятся в течение неограниченного периода времени.


### <a name="when-should-i-use-a-second-storage-account"></a>Когда следует использовать вторичную учетную запись хранения?

Если есть основания полагать, что у вас есть выше, чем ожидаемого набора операций над hello кэша, следует использовать вторую учетную запись хранилища для AOF сохраняемости.  Настройку учетной записи hello вторичного хранилища гарантирует, что ваш кэш не достичь ограничения пропускной способности хранилища.

### <a name="does-aof-persistence-affect-throughout-latency-or-performance-of-my-cache"></a>Влияет ли сохраняемость AOF на пропускную способность, задержку или производительность кэша?

AOF сохраняемости влияет на пропускную способность по 15% – 20% при hello кэша меньше максимальной нагрузки (ЦП и загрузка сервера и в разделе 90%). Не должно быть проблемы задержки при hello кэш находится в пределах этих ограничений. Тем не менее кэш hello достигнет этих ограничений быстрее с AOF включена.

### <a name="how-can-i-remove-hello-second-storage-account"></a>Как удалить hello вторую учетную запись хранилища?

Можно удалить учетную запись для дополнительного хранилища сохраняемости AOF hello, установив hello вторую учетную запись хранилища toobe Здравствуйте таким же, как hello первой учетной записи хранения. Инструкции см. в разделе [Настройка сохраняемости AOF](#configure-aof-persistence).

### <a name="what-is-a-rewrite-and-how-does-it-affect-my-cache"></a>Что такое перезапись и как она влияет на кэш?

Если hello AOF файл станет достаточно большой, перезапись автоматически в очередь на кэш hello. Hello перезаписи изменяет размер файла AOF hello с минимальным набором hello операций требуется toocreate hello текущего набора данных. Во время операции перезаписи ожидается, что ограничения производительности tooreach быстрее, особенно при работе с большими наборами данных. Излишнего копирования возникает меньше часто как hello AOF файла становится больше, но потребуется значительное количество времени, когда он происходит.

### <a name="what-should-i-expect-when-scaling-a-cache-with-aof-enabled"></a>Что следует ожидать при масштабировании кэша с включенной сохраняемостью AOF?

Если файл AOF hello во время hello масштабирования значительно велик, затем ожидать tootake операции масштабирования hello дольше, чем ожидалось, так как он будет повторной загрузки файла hello после масштабирования.

Дополнительные сведения о масштабировании см. в разделе [что произойдет, если я масштабируется tooa другого размера и восстановлении резервной копии, сделанной до hello операция масштабирования?](#what-happens-if-i-have-scaled-to-a-different-size-and-a-backup-is-restored-that-was-made-before-the-scaling-operation)

### <a name="how-is-my-aof-data-organized-in-storage"></a>Как организованы данные AOF в хранилище?

Данные, хранящиеся в файлах AOF делится на несколько больших двоичных объектов страницы на узел tooincrease производительность сохранения данных toostorage hello. Hello следующей таблице представлены сколько страничные большие двоичные объекты используются для каждой ценовой категории.

| Уровень Premium | BLOB-объекты |
|--------------|-------|
| P1           | 4 на сегмент    |
| P2           | 8 на сегмент    |
| P3           | 16 на сегмент   |
| P4           | 20 на сегмент   |

Если включена кластеризация, каждый сегмент в кэше hello имеет собственный набор страничные большие двоичные объекты, как показано в предыдущей таблице hello. Например, кэш P2 с тремя сегментами распределяет файл AOF по 24 страничным BLOB-объектам (8 BLOB-объектов на сегмент, 3 сегменты).

После перезаписи в хранилище создается два набора файлов AOF. Излишнего копирования возникают в фоновом режиме hello и добавить toohello первого набора файлов, во время операции с наборами, отправляемых toohello кэша во время перезаписи hello append toohello второй набор. Во время перезаписи на случай сбоя временно сохраняется резервная копия, которая сразу же удаляется после завершения перезаписи.


## <a name="next-steps"></a>Дальнейшие действия
Узнайте, как toouse более "премиум" кэша функции.

* [Уровень Premium кэша Redis Azure toohello введение](cache-premium-tier-intro.md)

<!-- IMAGES -->

[redis-cache-premium-pricing-tier]: ./media/cache-how-to-premium-persistence/redis-cache-premium-pricing-tier.png

[redis-cache-persistence]: ./media/cache-how-to-premium-persistence/redis-cache-persistence.png

[redis-cache-rdb-persistence]: ./media/cache-how-to-premium-persistence/redis-cache-rdb-persistence.png

[redis-cache-aof-persistence]: ./media/cache-how-to-premium-persistence/redis-cache-aof-persistence.png

[redis-cache-settings]: ./media/cache-how-to-premium-persistence/redis-cache-settings.png
