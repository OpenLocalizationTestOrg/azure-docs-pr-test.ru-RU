---
title: "Сохранение данных tooconfigure aaaHow для кэша Redis Azure Premium"
description: "Узнайте, как tooconfigure и управления ими данных сохраняемости экземпляры кэша Redis для Azure уровня Premium"
services: redis-cache
documentationcenter: 
author: steved0x
manager: douge
editor: 
ms.assetid: b01cf279-60a0-4711-8c5f-af22d9540d38
ms.service: cache
ms.workload: tbd
ms.tgt_pltfrm: cache-redis
ms.devlang: na
ms.topic: article
ms.date: 08/24/2017
ms.author: sdanie
ms.openlocfilehash: 62feb6f5522e0270487f045eb303bf852434143d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="how-tooconfigure-data-persistence-for-a-premium-azure-redis-cache"></a><span data-ttu-id="5a4fb-103">Способ сохранения данных tooconfigure для кэша Redis Azure Premium</span><span class="sxs-lookup"><span data-stu-id="5a4fb-103">How tooconfigure data persistence for a Premium Azure Redis Cache</span></span>
<span data-ttu-id="5a4fb-104">Кэш Azure Redis имеет разные предложения кэша которые обеспечивают гибкость при hello Выбор размера кэша и функций, включая возможности уровня Premium кластеризации, сохраняемости и поддержки виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-104">Azure Redis Cache has different cache offerings which provide flexibility in hello choice of cache size and features, including Premium tier features such as clustering, persistence, and virtual network support.</span></span> <span data-ttu-id="5a4fb-105">В этой статье описывается, как tooconfigure сохраняемости в расширенной Azure Redis кэш экземпляра.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-105">This article describes how tooconfigure persistence in a premium Azure Redis Cache instance.</span></span>

<span data-ttu-id="5a4fb-106">Сведения о других функций кэша premium см. в разделе [уровня Premium кэша Redis Azure введение toohello](cache-premium-tier-intro.md).</span><span class="sxs-lookup"><span data-stu-id="5a4fb-106">For information on other premium cache features, see [Introduction toohello Azure Redis Cache Premium tier](cache-premium-tier-intro.md).</span></span>

## <a name="what-is-data-persistence"></a><span data-ttu-id="5a4fb-107">Что такое постоянное хранение?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-107">What is data persistence?</span></span>
<span data-ttu-id="5a4fb-108">[Redis сохраняемости](https://redis.io/topics/persistence) позволяет toopersist данные, хранящиеся в Redis.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-108">[Redis persistence](https://redis.io/topics/persistence) allows you toopersist data stored in Redis.</span></span> <span data-ttu-id="5a4fb-109">Можно также создавать снимки и резервное копирование данных hello, который можно загрузить в случае сбоя оборудования.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-109">You can also take snapshots and back up hello data, which you can load in case of a hardware failure.</span></span> <span data-ttu-id="5a4fb-110">Это огромное преимущество перед Basic или стандартного уровня, где все hello данных хранится в памяти и может быть возможной потери данных в случае сбоя, где узлы кэша не работают.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-110">This is a huge advantage over Basic or Standard tier where all hello data is stored in memory and there can be potential data loss in case of a failure where Cache nodes are down.</span></span> 

<span data-ttu-id="5a4fb-111">Кэш Azure Redis предоставляет сохраняемости Redis, с помощью следующих моделей hello.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-111">Azure Redis Cache offers Redis persistence using hello following models:</span></span>

* <span data-ttu-id="5a4fb-112">**Сохраняемость RDB** -настроен сохраняемости при RDB (база данных Redis), моментальный снимок кэша Redis hello в Redis, toodisk двоичный формат в зависимости от можно настроить интервал резервного копирования сохраняется кэша Redis для Azure.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-112">**RDB persistence** - When RDB (Redis database) persistence is configured, Azure Redis Cache persists a snapshot of hello Redis cache in a Redis binary format toodisk based on a configurable backup frequency.</span></span> <span data-ttu-id="5a4fb-113">В случае критического события, отключает hello первичный и реплика кэша кэш hello перестраивается с помощью hello самый последний моментальный снимок.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-113">If a catastrophic event occurs that disables both hello primary and replica cache, hello cache is reconstructed using hello most recent snapshot.</span></span> <span data-ttu-id="5a4fb-114">Дополнительные сведения о hello [преимущества](https://redis.io/topics/persistence#rdb-advantages) и [недостатки](https://redis.io/topics/persistence#rdb-disadvantages) RDB сохраняемости.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-114">Learn more about hello [advantages](https://redis.io/topics/persistence#rdb-advantages) and [disadvantages](https://redis.io/topics/persistence#rdb-disadvantages) of RDB persistence.</span></span>
* <span data-ttu-id="5a4fb-115">**Сохраняемости AOF** -настроен сохраняемости при AOF (Append только файл), каждый журнал tooa операции записи, сохраняется по крайней мере один раз в секунду в учетную запись хранилища Azure сохраняет кэша Redis для Azure.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-115">**AOF persistence** - When AOF (Append only file) persistence is configured, Azure Redis Cache saves every write operation tooa log that is saved at least once per second into an Azure Storage account.</span></span> <span data-ttu-id="5a4fb-116">В случае критического события, отключает hello первичный и реплика кэша кэш hello перестраивается с помощью операций записи хранятся hello.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-116">If a catastrophic event occurs that disables both hello primary and replica cache, hello cache is reconstructed using hello stored write operations.</span></span> <span data-ttu-id="5a4fb-117">Дополнительные сведения о hello [преимущества](https://redis.io/topics/persistence#aof-advantages) и [недостатки](https://redis.io/topics/persistence#aof-disadvantages) AOF сохраняемости.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-117">Learn more about hello [advantages](https://redis.io/topics/persistence#aof-advantages) and [disadvantages](https://redis.io/topics/persistence#aof-disadvantages) of AOF persistence.</span></span>

<span data-ttu-id="5a4fb-118">Сохраняемость настраивается от hello **новый кэш Redis** колонке во время создания кэша, а также на hello **ресурсов меню** существующие premium кэширует.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-118">Persistence is configured from hello **New Redis Cache** blade during cache creation and on hello **Resource menu** for existing premium caches.</span></span>

[!INCLUDE [redis-cache-create](../../includes/redis-cache-premium-create.md)]

<span data-ttu-id="5a4fb-119">Выбрав ценовую категорию Премиум, щелкните **Сохраняемость Redis**.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-119">Once a premium pricing tier is selected, click **Redis persistence**.</span></span>

![Сохраняемость Redis][redis-cache-persistence]

<span data-ttu-id="5a4fb-121">Hello в следующем разделе hello описывается, как tooconfigure Redis сохраняемости на новый кэш premium.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-121">hello steps in hello next section describe how tooconfigure Redis persistence on your new premium cache.</span></span> <span data-ttu-id="5a4fb-122">После настройки сохраняемости Redis щелкните **создать** toocreate вашей premium новый кэш с Redis сохраняемости.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-122">Once Redis persistence is configured, click **Create** toocreate your new premium cache with Redis persistence.</span></span>

## <a name="enable-redis-persistence"></a><span data-ttu-id="5a4fb-123">Включение сохраняемости Redis</span><span class="sxs-lookup"><span data-stu-id="5a4fb-123">Enable Redis persistence</span></span>

<span data-ttu-id="5a4fb-124">Redis сохраняемость включена на hello **сохраняемости данных Redis** колонки, либо выбрав **RDB** или **AOF** сохраняемости.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-124">Redis persistence is enabled on hello **Redis data persistence** blade by choosing either **RDB** or **AOF** persistence.</span></span> <span data-ttu-id="5a4fb-125">Для нового кэша эту колонку осуществляется во время процесса создания кэша hello, как описано в предыдущем разделе hello.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-125">For new caches, this blade is accessed during hello cache creation process, as described in hello previous section.</span></span> <span data-ttu-id="5a4fb-126">Для существующего кэша hello **сохраняемости данных Redis** колонке осуществляется из hello **ресурсов меню** своего кэша.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-126">For existing caches, hello **Redis data persistence** blade is accessed from hello **Resource menu** for your cache.</span></span>

![Параметры Redis][redis-cache-settings]


## <a name="configure-rdb-persistence"></a><span data-ttu-id="5a4fb-128">Настройка сохраняемости RDB</span><span class="sxs-lookup"><span data-stu-id="5a4fb-128">Configure RDB persistence</span></span>

<span data-ttu-id="5a4fb-129">Сохранение RDB tooenable, нажмите кнопку **RDB**.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-129">tooenable RDB persistence, click **RDB**.</span></span> <span data-ttu-id="5a4fb-130">toodisable RDB сохраняемости на ранее включенный premium кэш, нажмите кнопку **отключено**.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-130">toodisable RDB persistence on a previously enabled premium cache, click **Disabled**.</span></span>

![Сохраняемость RDB Redis][redis-cache-rdb-persistence]

<span data-ttu-id="5a4fb-132">tooconfigure hello интервал создания резервной копии, выберите **интервал резервного копирования** из раскрывающегося списка hello.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-132">tooconfigure hello backup interval, select a **Backup Frequency** from hello drop-down list.</span></span> <span data-ttu-id="5a4fb-133">Вы можете выбрать **15 минут**, **30 минут**, **60 минут**, **6 часов**, **12 часов** или **24 часа**.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-133">Choices include **15 Minutes**, **30 minutes**, **60 minutes**, **6 hours**, **12 hours**, and **24 hours**.</span></span> <span data-ttu-id="5a4fb-134">Этот период начинается отсчет после успешного завершения предыдущей операции резервного копирования hello и запускается по истечении его новой резервной копии.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-134">This interval starts counting down after hello previous backup operation successfully completes and when it elapses a new backup is initiated.</span></span>

<span data-ttu-id="5a4fb-135">Нажмите кнопку **учетной записи хранилища** tooselect hello toouse учетной записи хранилища и выберите либо hello **первичного ключа** или **вторичный ключ** toouse из hello **хранилища Ключ** раскрывающегося списка.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-135">Click **Storage Account** tooselect hello storage account toouse, and choose either hello **Primary key** or **Secondary key** toouse from hello **Storage Key** drop-down.</span></span> <span data-ttu-id="5a4fb-136">Необходимо выбрать учетную запись хранилища в hello же регионе, что кэш hello и **хранилище Premium** учетной записи рекомендуется, так как хранилище premium имеет более высокую пропускную способность.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-136">You must choose a storage account in hello same region as hello cache, and a **Premium Storage** account is recommended because premium storage has higher throughput.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="5a4fb-137">При повторном создании hello ключ хранилища для учетной записи сохраняемости, необходимо перенастроить hello нужного ключа из hello **ключ хранилища** раскрывающегося списка.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-137">If hello storage key for your persistence account is regenerated, you must reconfigure hello desired key from hello **Storage Key** drop-down.</span></span>
> 
> 

<span data-ttu-id="5a4fb-138">Нажмите кнопку **ОК** toosave hello сохраняемости конфигурации.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-138">Click **OK** toosave hello persistence configuration.</span></span>

<span data-ttu-id="5a4fb-139">После истечения интервала резервного копирования hello инициируется Hello следующего резервного копирования (или первой резервной копии для нового кэша).</span><span class="sxs-lookup"><span data-stu-id="5a4fb-139">hello next backup (or first backup for new caches) is initiated once hello backup frequency interval elapses.</span></span>

## <a name="configure-aof-persistence"></a><span data-ttu-id="5a4fb-140">Настройка сохраняемости AOF</span><span class="sxs-lookup"><span data-stu-id="5a4fb-140">Configure AOF persistence</span></span>

<span data-ttu-id="5a4fb-141">Сохранение AOF tooenable, нажмите кнопку **AOF**.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-141">tooenable AOF persistence, click **AOF**.</span></span> <span data-ttu-id="5a4fb-142">toodisable AOF сохраняемости на ранее включенный premium кэш, нажмите кнопку **отключено**.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-142">toodisable AOF persistence on a previously enabled premium cache, click **Disabled**.</span></span>

![Сохраняемость AOF Redis][redis-cache-aof-persistence]

<span data-ttu-id="5a4fb-144">Сохранение AOF tooconfigure, укажите **первой учетной записи хранения**.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-144">tooconfigure AOF persistence, specify a **First Storage Account**.</span></span> <span data-ttu-id="5a4fb-145">Эта учетная запись должна находиться в hello же регионе, что кэш hello и **хранилище Premium** учетной записи рекомендуется, так как хранилище premium имеет более высокую пропускную способность.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-145">This storage account must be in hello same region as hello cache, and a **Premium Storage** account is recommended because premium storage has higher throughput.</span></span> <span data-ttu-id="5a4fb-146">При необходимости можно настроить дополнительную учетную запись хранения с именем **Вторичная учетная запись хранения**.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-146">You can optionally configure an additional storage account named **Second Storage Account**.</span></span> <span data-ttu-id="5a4fb-147">Если настроен вторую учетную запись хранилища, hello кэш-реплика записывает toohello записываются toothis вторую учетную запись хранилища.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-147">If a second storage account is configured, hello writes toohello replica cache are written toothis second storage account.</span></span> <span data-ttu-id="5a4fb-148">Для каждого настроенная учетная запись хранилища, выберите либо hello **первичного ключа** или **вторичный ключ** toouse из hello **ключ хранилища** раскрывающегося списка.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-148">For each configured storage account, choose either hello **Primary key** or **Secondary key** toouse from hello **Storage Key** drop-down.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="5a4fb-149">При повторном создании hello ключ хранилища для учетной записи сохраняемости, необходимо перенастроить hello нужного ключа из hello **ключ хранилища** раскрывающегося списка.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-149">If hello storage key for your persistence account is regenerated, you must reconfigure hello desired key from hello **Storage Key** drop-down.</span></span>
> 
> 

<span data-ttu-id="5a4fb-150">При включении сохраняемости AOF запись кэша toohello операции сохраняются toohello назначить учетной записи хранения (или учетные записи, если вы настроили вторую учетную запись хранилища).</span><span class="sxs-lookup"><span data-stu-id="5a4fb-150">When AOF persistence is enabled, write operations toohello cache are saved toohello designated storage account (or accounts if you have configured a second storage account).</span></span> <span data-ttu-id="5a4fb-151">В событии hello разрушительного сбоя, принимает вниз оба hello первичный и кэша-реплики, hello хранимых AOF журнала является используется toorebuild hello кэша.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-151">In hello event of a catastrophic failure that takes down both hello primary and replica cache, hello stored AOF log is used toorebuild hello cache.</span></span>

## <a name="persistence-faq"></a><span data-ttu-id="5a4fb-152">Часто задаваемые вопросы о постоянном хранении</span><span class="sxs-lookup"><span data-stu-id="5a4fb-152">Persistence FAQ</span></span>
<span data-ttu-id="5a4fb-153">Hello следующий список содержит toocommonly ответы, вопросы и ответы о сохраняемости кэша Redis для Azure.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-153">hello following list contains answers toocommonly asked questions about Azure Redis Cache persistence.</span></span>

* [<span data-ttu-id="5a4fb-154">Можно ли включить постоянное хранение для ранее созданного кэша?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-154">Can I enable persistence on a previously created cache?</span></span>](#can-i-enable-persistence-on-a-previously-created-cache)
* [<span data-ttu-id="5a4fb-155">Можно включить сохраняемость AOF и RDB на hello одновременно?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-155">Can I enable AOF and RDB persistence at hello same time?</span></span>](#can-i-enable-aof-and-rdb-persistence-at-the-same-time)
* [<span data-ttu-id="5a4fb-156">Какую модель сохраняемости следует выбрать?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-156">Which persistence model should I choose?</span></span>](#which-persistence-model-should-i-choose)
* [<span data-ttu-id="5a4fb-157">Что произойдет, если я масштабируется tooa другого размера и восстановлении резервной копии, сделанной до hello операция масштабирования?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-157">What happens if I have scaled tooa different size and a backup is restored that was made before hello scaling operation?</span></span>](#what-happens-if-i-have-scaled-to-a-different-size-and-a-backup-is-restored-that-was-made-before-the-scaling-operation)


### <a name="rdb-persistence"></a><span data-ttu-id="5a4fb-158">Сохраняемость RDB</span><span class="sxs-lookup"><span data-stu-id="5a4fb-158">RDB persistence</span></span>
* [<span data-ttu-id="5a4fb-159">Можно изменить частоту резервного копирования RDB hello после создания кэша hello?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-159">Can I change hello RDB backup frequency after I create hello cache?</span></span>](#can-i-change-the-rdb-backup-frequency-after-i-create-the-cache)
* [<span data-ttu-id="5a4fb-160">Почему при установленной частоте резервного копирования RDB в 60 минут между созданием резервных копий проходит больше времени?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-160">Why if I have an RDB backup frequency of 60 minutes there is more than 60 minutes between backups?</span></span>](#why-if-i-have-an-rdb-backup-frequency-of-60-minutes-there-is-more-than-60-minutes-between-backups)
* [<span data-ttu-id="5a4fb-161">Что происходит toohello старые резервные копии RDB при внесении новую резервную копию?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-161">What happens toohello old RDB backups when a new backup is made?</span></span>](#what-happens-to-the-old-rdb-backups-when-a-new-backup-is-made)

### <a name="aof-persistence"></a><span data-ttu-id="5a4fb-162">Сохраняемость AOF</span><span class="sxs-lookup"><span data-stu-id="5a4fb-162">AOF persistence</span></span>
* [<span data-ttu-id="5a4fb-163">Когда следует использовать вторичную учетную запись хранения?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-163">When should I use a second storage account?</span></span>](#when-should-i-use-a-second-storage-account)
* [<span data-ttu-id="5a4fb-164">Влияет ли сохраняемость AOF на пропускную способность, задержку или производительность кэша?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-164">Does AOF persistence affect throughout, latency, or performance of my cache?</span></span>](#does-aof-persistence-affect-throughout-latency-or-performance-of-my-cache)
* [<span data-ttu-id="5a4fb-165">Как удалить hello вторую учетную запись хранилища?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-165">How can I remove hello second storage account?</span></span>](#how-can-i-remove-the-second-storage-account)
* [<span data-ttu-id="5a4fb-166">Что такое перезапись и как она влияет на кэш?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-166">What is a rewrite and how does it affect my cache?</span></span>](#what-is-a-rewrite-and-how-does-it-affect-my-cache)
* [<span data-ttu-id="5a4fb-167">Что следует ожидать при масштабировании кэша с включенной сохраняемостью AOF?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-167">What should I expect when scaling a cache with AOF enabled?</span></span>](#what-should-i-expect-when-scaling-a-cache-with-aof-enabled)
* [<span data-ttu-id="5a4fb-168">Как организованы данные AOF в хранилище?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-168">How is my AOF data organized in storage?</span></span>](#how-is-my-aof-data-organized-in-storage)


### <a name="can-i-enable-persistence-on-a-previously-created-cache"></a><span data-ttu-id="5a4fb-169">Можно ли включить постоянное хранение для ранее созданного кэша?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-169">Can I enable persistence on a previously created cache?</span></span>
<span data-ttu-id="5a4fb-170">Да, вы можете настроить сохраняемость Redis как при создании кэша, так и в уже существующем кэше Премиум.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-170">Yes, Redis persistence can be configured both at cache creation and on existing premium caches.</span></span>

### <a name="can-i-enable-aof-and-rdb-persistence-at-hello-same-time"></a><span data-ttu-id="5a4fb-171">Можно включить сохраняемость AOF и RDB на hello одновременно?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-171">Can I enable AOF and RDB persistence at hello same time?</span></span>

<span data-ttu-id="5a4fb-172">Нет, можно включить только RDB или AOF, но не оба hello то же время.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-172">No, you can enable only RDB or AOF, but not both at hello same time.</span></span>

### <a name="which-persistence-model-should-i-choose"></a><span data-ttu-id="5a4fb-173">Какую модель сохраняемости следует выбрать?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-173">Which persistence model should I choose?</span></span>

<span data-ttu-id="5a4fb-174">AOF сохраняемости сохраняет tooa каждой записи журнала, в который влияет на пропускную способность, по сравнению с RDB сохраняемости, который сохраняет резервные копии на hello основе настроить интервал резервного копирования, с минимальным влиянием на производительность.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-174">AOF persistence saves every write tooa log, which has some impact on throughput, compared with RDB persistence which saves backups based on hello configured backup interval, with minimal impact on performance.</span></span> <span data-ttu-id="5a4fb-175">Выберите AOF сохраняемости, если главной задачей является toominimize потери данных и снижение пропускной способности можно обработать для кэша.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-175">Choose AOF persistence if your primary goal is toominimize data loss, and you can handle a decrease in throughput for your cache.</span></span> <span data-ttu-id="5a4fb-176">Выберите RDB сохраняемости, если вы хотите toomaintain оптимальной пропускной способности на ваш кэш, но по-прежнему требуется механизм для восстановления данных.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-176">Choose RDB persistence if you wish toomaintain optimal throughput on your cache, but still want a mechanism for data recovery.</span></span>

* <span data-ttu-id="5a4fb-177">Дополнительные сведения о hello [преимущества](https://redis.io/topics/persistence#rdb-advantages) и [недостатки](https://redis.io/topics/persistence#rdb-disadvantages) RDB сохраняемости.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-177">Learn more about hello [advantages](https://redis.io/topics/persistence#rdb-advantages) and [disadvantages](https://redis.io/topics/persistence#rdb-disadvantages) of RDB persistence.</span></span>
* <span data-ttu-id="5a4fb-178">Дополнительные сведения о hello [преимущества](https://redis.io/topics/persistence#aof-advantages) и [недостатки](https://redis.io/topics/persistence#aof-disadvantages) AOF сохраняемости.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-178">Learn more about hello [advantages](https://redis.io/topics/persistence#aof-advantages) and [disadvantages](https://redis.io/topics/persistence#aof-disadvantages) of AOF persistence.</span></span>

<span data-ttu-id="5a4fb-179">Дополнительные сведения о производительности при использовании сохраняемости AOF см. в разделе [Влияет ли сохраняемость AOF на пропускную способность, задержку или производительность кэша?](#does-aof-persistence-affect-throughout-latency-or-performance-of-my-cache)</span><span class="sxs-lookup"><span data-stu-id="5a4fb-179">For more information on performance when using AOF persistence, see [Does AOF persistence affect throughout, latency, or performance of my cache?](#does-aof-persistence-affect-throughout-latency-or-performance-of-my-cache)</span></span>

### <a name="what-happens-if-i-have-scaled-tooa-different-size-and-a-backup-is-restored-that-was-made-before-hello-scaling-operation"></a><span data-ttu-id="5a4fb-180">Что произойдет, если я масштабируется tooa другого размера и восстановлении резервной копии, сделанной до hello операция масштабирования?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-180">What happens if I have scaled tooa different size and a backup is restored that was made before hello scaling operation?</span></span>

<span data-ttu-id="5a4fb-181">Сохраняемость RDB и AOF:</span><span class="sxs-lookup"><span data-stu-id="5a4fb-181">For both RDB and AOF persistence:</span></span>

* <span data-ttu-id="5a4fb-182">Если масштабирование больший размер tooa влияния не оказывается.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-182">If you have scaled tooa larger size, there is no impact.</span></span>
* <span data-ttu-id="5a4fb-183">Если масштабируется tooa меньшего размера, и имеется пользовательский [баз данных](cache-configure.md#databases) параметре больше, чем hello [предел баз данных](cache-configure.md#databases) для вашего нового размера данных в этих базах данных не восстанавливается.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-183">If you have scaled tooa smaller size, and you have a custom [databases](cache-configure.md#databases) setting that is greater than hello [databases limit](cache-configure.md#databases) for your new size, data in those databases isn't restored.</span></span> <span data-ttu-id="5a4fb-184">Дополнительные сведения см. в разделе [Что происходит с пользовательским параметром databases при масштабировании?](cache-how-to-scale.md#is-my-custom-databases-setting-affected-during-scaling)</span><span class="sxs-lookup"><span data-stu-id="5a4fb-184">For more information, see [Is my custom databases setting affected during scaling?](cache-how-to-scale.md#is-my-custom-databases-setting-affected-during-scaling)</span></span>
* <span data-ttu-id="5a4fb-185">Если не хватает места в меньший размер toohold hello удаления всех данных hello из последней резервной копии, ключи hello в процессе восстановления hello масштабировать tooa меньшего размера, обычно с помощью hello [allkeys lru](http://redis.io/topics/lru-cache) вытеснения политика.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-185">If you have scaled tooa smaller size, and there isn't enough room in hello smaller size toohold all of hello data from hello last backup, keys will be evicted during hello restore process, typically using hello [allkeys-lru](http://redis.io/topics/lru-cache) eviction policy.</span></span>

### <a name="can-i-change-hello-rdb-backup-frequency-after-i-create-hello-cache"></a><span data-ttu-id="5a4fb-186">Можно изменить частоту резервного копирования RDB hello после создания кэша hello?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-186">Can I change hello RDB backup frequency after I create hello cache?</span></span>
<span data-ttu-id="5a4fb-187">Да, можно изменить интервал резервного копирования hello для сохраняемости RDB на hello **сохраняемости данных Redis** колонку.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-187">Yes, you can change hello backup frequency for RDB persistence on hello **Redis data persistence** blade.</span></span> <span data-ttu-id="5a4fb-188">Инструкции см. в разделе [Настройка сохраняемости Redis](#configure-redis-persistence).</span><span class="sxs-lookup"><span data-stu-id="5a4fb-188">For instructions, see [Configure Redis persistence](#configure-redis-persistence).</span></span>

### <a name="why-if-i-have-an-rdb-backup-frequency-of-60-minutes-there-is-more-than-60-minutes-between-backups"></a><span data-ttu-id="5a4fb-189">Почему при установленной частоте резервного копирования RDB в 60 минут между созданием резервных копий проходит больше времени?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-189">Why if I have an RDB backup frequency of 60 minutes there is more than 60 minutes between backups?</span></span>
<span data-ttu-id="5a4fb-190">Hello RDB сохраняемости интервал резервного копирования не будет начата до предыдущего резервного копирования процесс hello успешно завершен.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-190">hello RDB persistence backup frequency interval does not start until hello previous backup process has completed successfully.</span></span> <span data-ttu-id="5a4fb-191">Если интервал резервного копирования hello составляет 60 минут, и он принимает полный процесс резервного копирования toosuccessfully 15 минут, hello следующая резервная копия не запускается до 75 минут после hello запуск hello предыдущей резервной копии.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-191">If hello backup frequency is 60 minutes and it takes a backup process 15 minutes toosuccessfully complete, hello next backup won't start until 75 minutes after hello start time of hello previous backup.</span></span>

### <a name="what-happens-toohello-old-rdb-backups-when-a-new-backup-is-made"></a><span data-ttu-id="5a4fb-192">Что происходит toohello старые резервные копии RDB при внесении новую резервную копию?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-192">What happens toohello old RDB backups when a new backup is made?</span></span>
<span data-ttu-id="5a4fb-193">Автоматически удаляются все резервные копии RDB сохраняемости, за исключением hello самую последнюю из них.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-193">All RDB persistence backups except for hello most recent one are automatically deleted.</span></span> <span data-ttu-id="5a4fb-194">Это удаление может происходить не сразу, но старые резервные копии не хранятся в течение неограниченного периода времени.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-194">This deletion may not happen immediately but older backups are not persisted indefinitely.</span></span>


### <a name="when-should-i-use-a-second-storage-account"></a><span data-ttu-id="5a4fb-195">Когда следует использовать вторичную учетную запись хранения?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-195">When should I use a second storage account?</span></span>

<span data-ttu-id="5a4fb-196">Если есть основания полагать, что у вас есть выше, чем ожидаемого набора операций над hello кэша, следует использовать вторую учетную запись хранилища для AOF сохраняемости.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-196">You should use a second storage account for AOF persistence when you believe you have higher than expected set operations on hello cache.</span></span>  <span data-ttu-id="5a4fb-197">Настройку учетной записи hello вторичного хранилища гарантирует, что ваш кэш не достичь ограничения пропускной способности хранилища.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-197">Setting up hello secondary storage account helps ensure your cache doesn't reach storage bandwidth limits.</span></span>

### <a name="does-aof-persistence-affect-throughout-latency-or-performance-of-my-cache"></a><span data-ttu-id="5a4fb-198">Влияет ли сохраняемость AOF на пропускную способность, задержку или производительность кэша?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-198">Does AOF persistence affect throughout, latency, or performance of my cache?</span></span>

<span data-ttu-id="5a4fb-199">AOF сохраняемости влияет на пропускную способность по 15% – 20% при hello кэша меньше максимальной нагрузки (ЦП и загрузка сервера и в разделе 90%).</span><span class="sxs-lookup"><span data-stu-id="5a4fb-199">AOF persistence affects throughput by about 15% – 20% when hello cache is below maximum load (CPU and Server Load both under 90%).</span></span> <span data-ttu-id="5a4fb-200">Не должно быть проблемы задержки при hello кэш находится в пределах этих ограничений.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-200">There should not be latency issues when hello cache is within these limits.</span></span> <span data-ttu-id="5a4fb-201">Тем не менее кэш hello достигнет этих ограничений быстрее с AOF включена.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-201">However, hello cache will reach these limits sooner with AOF enabled.</span></span>

### <a name="how-can-i-remove-hello-second-storage-account"></a><span data-ttu-id="5a4fb-202">Как удалить hello вторую учетную запись хранилища?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-202">How can I remove hello second storage account?</span></span>

<span data-ttu-id="5a4fb-203">Можно удалить учетную запись для дополнительного хранилища сохраняемости AOF hello, установив hello вторую учетную запись хранилища toobe Здравствуйте таким же, как hello первой учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-203">You can remove hello AOF persistence secondary storage account by setting hello second storage account toobe hello same as hello first storage account.</span></span> <span data-ttu-id="5a4fb-204">Инструкции см. в разделе [Настройка сохраняемости AOF](#configure-aof-persistence).</span><span class="sxs-lookup"><span data-stu-id="5a4fb-204">For instructions, see [Configure AOF persistence](#configure-aof-persistence).</span></span>

### <a name="what-is-a-rewrite-and-how-does-it-affect-my-cache"></a><span data-ttu-id="5a4fb-205">Что такое перезапись и как она влияет на кэш?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-205">What is a rewrite and how does it affect my cache?</span></span>

<span data-ttu-id="5a4fb-206">Если hello AOF файл станет достаточно большой, перезапись автоматически в очередь на кэш hello.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-206">When hello AOF file becomes large enough, a rewrite is automatically queued on hello cache.</span></span> <span data-ttu-id="5a4fb-207">Hello перезаписи изменяет размер файла AOF hello с минимальным набором hello операций требуется toocreate hello текущего набора данных.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-207">hello rewrite resizes hello AOF file with hello minimal set of operations needed toocreate hello current data set.</span></span> <span data-ttu-id="5a4fb-208">Во время операции перезаписи ожидается, что ограничения производительности tooreach быстрее, особенно при работе с большими наборами данных.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-208">During rewrites, expect tooreach performance limits sooner especially when dealing with large datasets.</span></span> <span data-ttu-id="5a4fb-209">Излишнего копирования возникает меньше часто как hello AOF файла становится больше, но потребуется значительное количество времени, когда он происходит.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-209">Rewrites occur less often as hello AOF file becomes larger, but will take a significant amount of time when it happens.</span></span>

### <a name="what-should-i-expect-when-scaling-a-cache-with-aof-enabled"></a><span data-ttu-id="5a4fb-210">Что следует ожидать при масштабировании кэша с включенной сохраняемостью AOF?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-210">What should I expect when scaling a cache with AOF enabled?</span></span>

<span data-ttu-id="5a4fb-211">Если файл AOF hello во время hello масштабирования значительно велик, затем ожидать tootake операции масштабирования hello дольше, чем ожидалось, так как он будет повторной загрузки файла hello после масштабирования.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-211">If hello AOF file at hello time of scaling is significantly large, then expect hello scale operation tootake longer than expected since it will be reloading hello file after scaling has finished.</span></span>

<span data-ttu-id="5a4fb-212">Дополнительные сведения о масштабировании см. в разделе [что произойдет, если я масштабируется tooa другого размера и восстановлении резервной копии, сделанной до hello операция масштабирования?](#what-happens-if-i-have-scaled-to-a-different-size-and-a-backup-is-restored-that-was-made-before-the-scaling-operation)</span><span class="sxs-lookup"><span data-stu-id="5a4fb-212">For more information on scaling, see [What happens if I have scaled tooa different size and a backup is restored that was made before hello scaling operation?](#what-happens-if-i-have-scaled-to-a-different-size-and-a-backup-is-restored-that-was-made-before-the-scaling-operation)</span></span>

### <a name="how-is-my-aof-data-organized-in-storage"></a><span data-ttu-id="5a4fb-213">Как организованы данные AOF в хранилище?</span><span class="sxs-lookup"><span data-stu-id="5a4fb-213">How is my AOF data organized in storage?</span></span>

<span data-ttu-id="5a4fb-214">Данные, хранящиеся в файлах AOF делится на несколько больших двоичных объектов страницы на узел tooincrease производительность сохранения данных toostorage hello.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-214">Data stored in AOF files is divided into multiple page blobs per node tooincrease performance of saving hello data toostorage.</span></span> <span data-ttu-id="5a4fb-215">Hello следующей таблице представлены сколько страничные большие двоичные объекты используются для каждой ценовой категории.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-215">hello following table displays how many page blobs are used for each pricing tier:</span></span>

| <span data-ttu-id="5a4fb-216">Уровень Premium</span><span class="sxs-lookup"><span data-stu-id="5a4fb-216">Premium tier</span></span> | <span data-ttu-id="5a4fb-217">BLOB-объекты</span><span class="sxs-lookup"><span data-stu-id="5a4fb-217">Blobs</span></span> |
|--------------|-------|
| <span data-ttu-id="5a4fb-218">P1</span><span class="sxs-lookup"><span data-stu-id="5a4fb-218">P1</span></span>           | <span data-ttu-id="5a4fb-219">4 на сегмент</span><span class="sxs-lookup"><span data-stu-id="5a4fb-219">4 per shard</span></span>    |
| <span data-ttu-id="5a4fb-220">P2</span><span class="sxs-lookup"><span data-stu-id="5a4fb-220">P2</span></span>           | <span data-ttu-id="5a4fb-221">8 на сегмент</span><span class="sxs-lookup"><span data-stu-id="5a4fb-221">8 per shard</span></span>    |
| <span data-ttu-id="5a4fb-222">P3</span><span class="sxs-lookup"><span data-stu-id="5a4fb-222">P3</span></span>           | <span data-ttu-id="5a4fb-223">16 на сегмент</span><span class="sxs-lookup"><span data-stu-id="5a4fb-223">16 per shard</span></span>   |
| <span data-ttu-id="5a4fb-224">P4</span><span class="sxs-lookup"><span data-stu-id="5a4fb-224">P4</span></span>           | <span data-ttu-id="5a4fb-225">20 на сегмент</span><span class="sxs-lookup"><span data-stu-id="5a4fb-225">20 per shard</span></span>   |

<span data-ttu-id="5a4fb-226">Если включена кластеризация, каждый сегмент в кэше hello имеет собственный набор страничные большие двоичные объекты, как показано в предыдущей таблице hello.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-226">When clustering is enabled, each shard in hello cache has its own set of page blobs, as indicated in hello previous table.</span></span> <span data-ttu-id="5a4fb-227">Например, кэш P2 с тремя сегментами распределяет файл AOF по 24 страничным BLOB-объектам (8 BLOB-объектов на сегмент, 3 сегменты).</span><span class="sxs-lookup"><span data-stu-id="5a4fb-227">For example, a P2 cache with three shards distributes its AOF file across 24 page blobs (8 blobs per shard, with 3 shards).</span></span>

<span data-ttu-id="5a4fb-228">После перезаписи в хранилище создается два набора файлов AOF.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-228">After a rewrite, two sets of AOF files exist in storage.</span></span> <span data-ttu-id="5a4fb-229">Излишнего копирования возникают в фоновом режиме hello и добавить toohello первого набора файлов, во время операции с наборами, отправляемых toohello кэша во время перезаписи hello append toohello второй набор.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-229">Rewrites occur in hello background and append toohello first set of files, while set operations that are sent toohello cache during hello rewrite append toohello second set.</span></span> <span data-ttu-id="5a4fb-230">Во время перезаписи на случай сбоя временно сохраняется резервная копия, которая сразу же удаляется после завершения перезаписи.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-230">A backup is temporarily stored during rewrites in case of failure, but is promptly deleted after a rewrite finishes.</span></span>


## <a name="next-steps"></a><span data-ttu-id="5a4fb-231">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="5a4fb-231">Next steps</span></span>
<span data-ttu-id="5a4fb-232">Узнайте, как toouse более "премиум" кэша функции.</span><span class="sxs-lookup"><span data-stu-id="5a4fb-232">Learn how toouse more premium cache features.</span></span>

* [<span data-ttu-id="5a4fb-233">Уровень Premium кэша Redis Azure toohello введение</span><span class="sxs-lookup"><span data-stu-id="5a4fb-233">Introduction toohello Azure Redis Cache Premium tier</span></span>](cache-premium-tier-intro.md)

<!-- IMAGES -->

[redis-cache-premium-pricing-tier]: ./media/cache-how-to-premium-persistence/redis-cache-premium-pricing-tier.png

[redis-cache-persistence]: ./media/cache-how-to-premium-persistence/redis-cache-persistence.png

[redis-cache-rdb-persistence]: ./media/cache-how-to-premium-persistence/redis-cache-rdb-persistence.png

[redis-cache-aof-persistence]: ./media/cache-how-to-premium-persistence/redis-cache-aof-persistence.png

[redis-cache-settings]: ./media/cache-how-to-premium-persistence/redis-cache-settings.png
