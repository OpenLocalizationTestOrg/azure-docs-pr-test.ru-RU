---
title: "aaaConfigure виртуальной сети для кэша Redis Azure Premium | Документы Microsoft"
description: "Узнайте, как toocreate и управления ими поддержки виртуальной сети для экземпляров кэша Redis для Azure уровня Premium"
services: redis-cache
documentationcenter: 
author: steved0x
manager: douge
editor: 
ms.assetid: 8b1e43a0-a70e-41e6-8994-0ac246d8bf7f
ms.service: cache
ms.workload: tbd
ms.tgt_pltfrm: cache-redis
ms.devlang: na
ms.topic: article
ms.date: 05/15/2017
ms.author: sdanie
ms.openlocfilehash: fab715f4d9365ee4c2f8b89d2e2e58768c25b671
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="how-tooconfigure-virtual-network-support-for-a-premium-azure-redis-cache"></a><span data-ttu-id="e3c9e-103">Как tooconfigure виртуальная сеть поддерживает для кэша Redis Azure Premium</span><span class="sxs-lookup"><span data-stu-id="e3c9e-103">How tooconfigure Virtual Network Support for a Premium Azure Redis Cache</span></span>
<span data-ttu-id="e3c9e-104">Кэш Azure Redis имеет разные предложения кэша, которые обеспечивают гибкость при hello Выбор размера кэша и функций, включая возможности уровня Premium кластеризации, сохраняемости и поддержки виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-104">Azure Redis Cache has different cache offerings, which provide flexibility in hello choice of cache size and features, including Premium tier features such as clustering, persistence, and virtual network support.</span></span> <span data-ttu-id="e3c9e-105">Виртуальная сеть — это частная сеть в облаке hello.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-105">A VNet is a private network in hello cloud.</span></span> <span data-ttu-id="e3c9e-106">При настройке экземпляра кэша Redis для Azure с виртуальной сетью, он не общедоступный и может осуществляться только из виртуальных машин и приложений в пределах hello виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-106">When an Azure Redis Cache instance is configured with a VNet, it is not publicly addressable and can only be accessed from virtual machines and applications within hello VNet.</span></span> <span data-ttu-id="e3c9e-107">В этой статье описано, как tooconfigure виртуальной сети поддерживают для экземпляра кэша Redis для Azure premium.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-107">This article describes how tooconfigure virtual network support for a premium Azure Redis Cache instance.</span></span>

> [!NOTE]
> <span data-ttu-id="e3c9e-108">Кэш Redis для Azure поддерживает классические виртуальные сети и виртуальные сети Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-108">Azure Redis Cache supports both classic and Resource Manager VNets.</span></span>
> 
> 

<span data-ttu-id="e3c9e-109">Сведения о других функций кэша premium см. в разделе [уровня Premium кэша Redis Azure введение toohello](cache-premium-tier-intro.md).</span><span class="sxs-lookup"><span data-stu-id="e3c9e-109">For information on other premium cache features, see [Introduction toohello Azure Redis Cache Premium tier](cache-premium-tier-intro.md).</span></span>

## <a name="why-vnet"></a><span data-ttu-id="e3c9e-110">Зачем использовать виртуальные сети?</span><span class="sxs-lookup"><span data-stu-id="e3c9e-110">Why VNet?</span></span>
<span data-ttu-id="e3c9e-111">[Виртуальной сети (VNet) Azure](https://azure.microsoft.com/services/virtual-network/) развертывание обеспечивает улучшенную защиту и изоляции для кэша Redis для Azure, а также подсетей, политики управления доступом, и другие функции toofurther ограничения доступа.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-111">[Azure Virtual Network (VNet)](https://azure.microsoft.com/services/virtual-network/) deployment provides enhanced security and isolation for your Azure Redis Cache, as well as subnets, access control policies, and other features toofurther restrict access.</span></span>

## <a name="virtual-network-support"></a><span data-ttu-id="e3c9e-112">Поддержка виртуальной сети</span><span class="sxs-lookup"><span data-stu-id="e3c9e-112">Virtual network support</span></span>
<span data-ttu-id="e3c9e-113">Поддержка виртуальной сети (VNet) настраивается на hello **новый кэш Redis** колонке во время создания кэша.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-113">Virtual Network (VNet) support is configured on hello **New Redis Cache** blade during cache creation.</span></span> 

[!INCLUDE [redis-cache-create](../../includes/redis-cache-premium-create.md)]

<span data-ttu-id="e3c9e-114">После выбора ценовой категории premium можно настроить интеграцию Redis виртуальной сети, выбрав виртуальную сеть, которая находится в hello же подписке и расположении с кэшем.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-114">Once you have selected a premium pricing tier, you can configure Redis VNet integration by selecting a VNet that is in hello same subscription and location as your cache.</span></span> <span data-ttu-id="e3c9e-115">toouse новой виртуальной сети, создайте его, следуя указаниям hello [создать виртуальную сеть с помощью портала Azure hello](../virtual-network/virtual-networks-create-vnet-arm-pportal.md) или [Создание виртуальной сети (классические) с помощью портала Azure hello](../virtual-network/virtual-networks-create-vnet-classic-pportal.md) , а затем возвращают toohello **Новый кэш Redis** toocreate колонки и настроить кэш premium.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-115">toouse a new VNet, create it first by following hello steps in [Create a virtual network using hello Azure portal](../virtual-network/virtual-networks-create-vnet-arm-pportal.md) or [Create a virtual network (classic) by using hello Azure portal](../virtual-network/virtual-networks-create-vnet-classic-pportal.md) and then return toohello **New Redis Cache** blade toocreate and configure your premium cache.</span></span>

<span data-ttu-id="e3c9e-116">hello tooconfigure виртуальной сети для вашего нового кэша щелкните **виртуальной сети** на hello **новый кэш Redis** и, при необходимости выберите hello требуемого виртуальной сети из раскрывающегося списка hello.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-116">tooconfigure hello VNet for your new cache, click **Virtual Network** on hello **New Redis Cache** blade, and select hello desired VNet from hello drop-down list.</span></span>

![Виртуальная сеть][redis-cache-vnet]

<span data-ttu-id="e3c9e-118">Здравствуйте, выберите нужный подсети из hello **подсети** раскрывающегося списка и укажите hello требуемого **статический IP-адрес**.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-118">Select hello desired subnet from hello **Subnet** drop-down list, and specify hello desired **Static IP address**.</span></span> <span data-ttu-id="e3c9e-119">При использовании классического hello виртуальной сети **статический IP-адрес** поле является необязательным, и если не указано, одна выбирается из hello выбранные подсети.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-119">If you are using a classic VNet hello **Static IP address** field is optional, and if none is specified, one is chosen from hello selected subnet.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="e3c9e-120">При развертывании tooa кэша Redis для Azure Resource Manager виртуальной сети, hello кэша должен быть в выделенной подсетью, не содержит другие ресурсы, за исключением экземпляров кэша Redis для Azure.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-120">When deploying an Azure Redis Cache tooa Resource Manager VNet, hello cache must be in a dedicated subnet that contains no other resources except for Azure Redis Cache instances.</span></span> <span data-ttu-id="e3c9e-121">Если попытка toodeploy кэш Azure Redis tooa подсети tooa диспетчера ресурсов виртуальной сети, которая содержит другие ресурсы, hello развертывания завершается ошибкой.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-121">If an attempt is made toodeploy an Azure Redis Cache tooa Resource Manager VNet tooa subnet that contains other resources, hello deployment fails.</span></span>
> 
> 

![Виртуальная сеть][redis-cache-vnet-ip]

> [!IMPORTANT]
> <span data-ttu-id="e3c9e-123">Azure резервирует некоторые IP-адреса в каждой подсети, которые нельзя использовать.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-123">Azure reserves some IP addresses within each subnet, and these addresses can't be used.</span></span> <span data-ttu-id="e3c9e-124">Hello первый и последний IP-адреса подсетей hello зарезервированы для соответствия протоколу, а также три дополнительные адреса, используемые для служб Azure.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-124">hello first and last IP addresses of hello subnets are reserved for protocol conformance, along with three more addresses used for Azure services.</span></span> <span data-ttu-id="e3c9e-125">Дополнительные сведения см. в разделе [Существуют ли ограничения на использование IP-адресов в пределах этих подсетей?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-125">For more information, see [Are there any restrictions on using IP addresses within these subnets?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span></span>
> 
> <span data-ttu-id="e3c9e-126">В добавление toohello IP-адреса виртуальной сети Azure инфраструктурой hello Redis для каждого экземпляра в hello подсети использует два IP-адреса на сегмент и один дополнительный IP-адрес для подсистемы балансировки нагрузки hello.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-126">In addition toohello IP addresses used by hello Azure VNET infrastructure, each Redis instance in hello subnet uses two IP addresses per shard and one additional IP address for hello load balancer.</span></span> <span data-ttu-id="e3c9e-127">Кэш некластеризованных считается toohave один сегмент.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-127">A non-clustered cache is considered toohave one shard.</span></span>
> 
> 

<span data-ttu-id="e3c9e-128">После создания кэша hello hello конфигурации для hello виртуальной сети можно просмотреть, щелкнув **виртуальной сети** из hello **ресурсов меню**.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-128">After hello cache is created, you can view hello configuration for hello VNet by clicking **Virtual Network** from hello **Resource menu**.</span></span>

![Виртуальная сеть][redis-cache-vnet-info]

<span data-ttu-id="e3c9e-130">tooconnect tooyour redis для Azure — экземпляр кэша при использовании виртуальной сети, укажите имя узла hello кэша в строке подключения hello, как показано в следующий пример hello:</span><span class="sxs-lookup"><span data-stu-id="e3c9e-130">tooconnect tooyour Azure Redis cache instance when using a VNet, specify hello host name of your cache in hello connection string as shown in hello following example:</span></span>

    private static Lazy<ConnectionMultiplexer> lazyConnection = new Lazy<ConnectionMultiplexer>(() =>
    {
        return ConnectionMultiplexer.Connect("contoso5premium.redis.cache.windows.net,abortConnect=false,ssl=true,password=password");
    });

    public static ConnectionMultiplexer Connection
    {
        get
        {
            return lazyConnection.Value;
        }
    }

## <a name="azure-redis-cache-vnet-faq"></a><span data-ttu-id="e3c9e-131">Часто задаваемые вопросы о виртуальных сетях кэша Redis для Azure</span><span class="sxs-lookup"><span data-stu-id="e3c9e-131">Azure Redis Cache VNet FAQ</span></span>
<span data-ttu-id="e3c9e-132">После списка Hello содержит toocommonly ответы, вопросы и ответы о масштабировании кэша Redis для Azure hello.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-132">hello following list contains answers toocommonly asked questions about hello Azure Redis Cache scaling.</span></span>

* [<span data-ttu-id="e3c9e-133">Каковы распространенные ошибки конфигурации кэша Redis для Azure и виртуальных сетей?</span><span class="sxs-lookup"><span data-stu-id="e3c9e-133">What are some common misconfiguration issues with Azure Redis Cache and VNets?</span></span>](#what-are-some-common-misconfiguration-issues-with-azure-redis-cache-and-vnets)
* [<span data-ttu-id="e3c9e-134">Как проверить, что кэш работает в виртуальной сети?</span><span class="sxs-lookup"><span data-stu-id="e3c9e-134">How can I verify that my cache is working in a VNET?</span></span>](#how-can-i-verify-that-my-cache-is-working-in-a-vnet)
* [<span data-ttu-id="e3c9e-135">Можно ли использовать виртуальные сети в кэше уровня "Стандартный" или "Базовый"?</span><span class="sxs-lookup"><span data-stu-id="e3c9e-135">Can I use VNets with a standard or basic cache?</span></span>](#can-i-use-vnets-with-a-standard-or-basic-cache)
* [<span data-ttu-id="e3c9e-136">Почему в одних подсетях не удается создать кэш Redis, а в других удается?</span><span class="sxs-lookup"><span data-stu-id="e3c9e-136">Why does creating a Redis cache fail in some subnets but not others?</span></span>](#why-does-creating-a-redis-cache-fail-in-some-subnets-but-not-others)
* [<span data-ttu-id="e3c9e-137">Каковы требования к свободному месту адрес подсети hello</span><span class="sxs-lookup"><span data-stu-id="e3c9e-137">What are hello subnet address space requirements?</span></span>](#what-are-the-subnet-address-space-requirements)
* [<span data-ttu-id="e3c9e-138">Do all cache features work when hosting a cache in a VNET? (Все ли функции кэша работают, когда он размещен в виртуальной сети?)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-138">Do all cache features work when hosting a cache in a VNET?</span></span>](#do-all-cache-features-work-when-hosting-a-cache-in-a-vnet)

## <a name="what-are-some-common-misconfiguration-issues-with-azure-redis-cache-and-vnets"></a><span data-ttu-id="e3c9e-139">Каковы распространенные ошибки конфигурации кэша Redis для Azure и виртуальных сетей?</span><span class="sxs-lookup"><span data-stu-id="e3c9e-139">What are some common misconfiguration issues with Azure Redis Cache and VNets?</span></span>
<span data-ttu-id="e3c9e-140">При размещении кэша Redis для Azure в виртуальной сети используются порты hello в следующей таблице hello.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-140">When Azure Redis Cache is hosted in a VNet, hello ports in hello following tables are used.</span></span> 

>[!IMPORTANT]
><span data-ttu-id="e3c9e-141">Если порты hello в следующей таблице hello заблокированы, hello кэша может работать неправильно.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-141">If hello ports in hello following tables are blocked, hello cache may not function correctly.</span></span> <span data-ttu-id="e3c9e-142">При использовании кэш Azure Redis в виртуальной сети с одним или несколькими из этих портов заблокированных является наиболее распространенная проблема неправильной настройкой hello.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-142">Having one or more of these ports blocked is hello most common misconfiguration issue when using Azure Redis Cache in a VNet.</span></span>
> 
> 

- [<span data-ttu-id="e3c9e-143">Обязательные порты для исходящего трафика</span><span class="sxs-lookup"><span data-stu-id="e3c9e-143">Outbound port requirements</span></span>](#outbound-port-requirements)
- [<span data-ttu-id="e3c9e-144">Обязательные порты для входящего трафика</span><span class="sxs-lookup"><span data-stu-id="e3c9e-144">Inbound port requirements</span></span>](#inbound-port-requirements)

### <a name="outbound-port-requirements"></a><span data-ttu-id="e3c9e-145">Обязательные порты для исходящего трафика</span><span class="sxs-lookup"><span data-stu-id="e3c9e-145">Outbound port requirements</span></span>

<span data-ttu-id="e3c9e-146">Существует семь обязательных портов для исходящего трафика.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-146">There are seven outbound port requirements.</span></span>

- <span data-ttu-id="e3c9e-147">При желании все исходящие подключения toohello Интернета можно сделать через клиент локального аудита устройства.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-147">If desired, all outbound connections toohello internet can be made through a client's on-premises auditing device.</span></span>
- <span data-ttu-id="e3c9e-148">Три из портов hello маршрутизацию трафика конечные точки tooAzure обслуживания хранилища Azure и Azure DNS.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-148">Three of hello ports route traffic tooAzure endpoints servicing Azure Storage and Azure DNS.</span></span>
- <span data-ttu-id="e3c9e-149">Hello оставшихся диапазоны портов и для внутренней связи подсети Redis.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-149">hello remaining port ranges and for internal Redis subnet communications.</span></span> <span data-ttu-id="e3c9e-150">Для внутреннего обмена данными в подсети Redis не требуются правила группы безопасности сети в подсети.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-150">No subnet NSG rules are required for internal Redis subnet communications.</span></span>

| <span data-ttu-id="e3c9e-151">Порты</span><span class="sxs-lookup"><span data-stu-id="e3c9e-151">Port(s)</span></span> | <span data-ttu-id="e3c9e-152">Направление</span><span class="sxs-lookup"><span data-stu-id="e3c9e-152">Direction</span></span> | <span data-ttu-id="e3c9e-153">Транспортный протокол</span><span class="sxs-lookup"><span data-stu-id="e3c9e-153">Transport Protocol</span></span> | <span data-ttu-id="e3c9e-154">Назначение</span><span class="sxs-lookup"><span data-stu-id="e3c9e-154">Purpose</span></span> | <span data-ttu-id="e3c9e-155">Локальный IP-адрес</span><span class="sxs-lookup"><span data-stu-id="e3c9e-155">Local IP</span></span> | <span data-ttu-id="e3c9e-156">Удаленный IP-адрес</span><span class="sxs-lookup"><span data-stu-id="e3c9e-156">Remote IP</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="e3c9e-157">80, 443</span><span class="sxs-lookup"><span data-stu-id="e3c9e-157">80, 443</span></span> |<span data-ttu-id="e3c9e-158">Исходящие</span><span class="sxs-lookup"><span data-stu-id="e3c9e-158">Outbound</span></span> |<span data-ttu-id="e3c9e-159">TCP</span><span class="sxs-lookup"><span data-stu-id="e3c9e-159">TCP</span></span> |<span data-ttu-id="e3c9e-160">Зависимости Redis в службе хранилища Azure или PKI (Интернет)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-160">Redis dependencies on Azure Storage/PKI (Internet)</span></span> | <span data-ttu-id="e3c9e-161">(Подсеть Redis)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-161">(Redis subnet)</span></span> |* |
| <span data-ttu-id="e3c9e-162">53</span><span class="sxs-lookup"><span data-stu-id="e3c9e-162">53</span></span> |<span data-ttu-id="e3c9e-163">Исходящие</span><span class="sxs-lookup"><span data-stu-id="e3c9e-163">Outbound</span></span> |<span data-ttu-id="e3c9e-164">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="e3c9e-164">TCP/UDP</span></span> |<span data-ttu-id="e3c9e-165">Зависимости Redis в DNS (Интернет/виртуальная сеть)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-165">Redis dependencies on DNS (Internet/VNet)</span></span> | <span data-ttu-id="e3c9e-166">(Подсеть Redis)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-166">(Redis subnet)</span></span> |* |
| <span data-ttu-id="e3c9e-167">8443</span><span class="sxs-lookup"><span data-stu-id="e3c9e-167">8443</span></span> |<span data-ttu-id="e3c9e-168">Исходящие</span><span class="sxs-lookup"><span data-stu-id="e3c9e-168">Outbound</span></span> |<span data-ttu-id="e3c9e-169">TCP</span><span class="sxs-lookup"><span data-stu-id="e3c9e-169">TCP</span></span> |<span data-ttu-id="e3c9e-170">Внутренний обмен данными для Redis</span><span class="sxs-lookup"><span data-stu-id="e3c9e-170">Internal communications for Redis</span></span> | <span data-ttu-id="e3c9e-171">(Подсеть Redis)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-171">(Redis subnet)</span></span> | <span data-ttu-id="e3c9e-172">(Подсеть Redis)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-172">(Redis subnet)</span></span> |
| <span data-ttu-id="e3c9e-173">10221-10231</span><span class="sxs-lookup"><span data-stu-id="e3c9e-173">10221-10231</span></span> |<span data-ttu-id="e3c9e-174">Исходящие</span><span class="sxs-lookup"><span data-stu-id="e3c9e-174">Outbound</span></span> |<span data-ttu-id="e3c9e-175">TCP</span><span class="sxs-lookup"><span data-stu-id="e3c9e-175">TCP</span></span> |<span data-ttu-id="e3c9e-176">Внутренний обмен данными для Redis</span><span class="sxs-lookup"><span data-stu-id="e3c9e-176">Internal communications for Redis</span></span> | <span data-ttu-id="e3c9e-177">(Подсеть Redis)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-177">(Redis subnet)</span></span> | <span data-ttu-id="e3c9e-178">(Подсеть Redis)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-178">(Redis subnet)</span></span> |
| <span data-ttu-id="e3c9e-179">20226</span><span class="sxs-lookup"><span data-stu-id="e3c9e-179">20226</span></span> |<span data-ttu-id="e3c9e-180">Исходящие</span><span class="sxs-lookup"><span data-stu-id="e3c9e-180">Outbound</span></span> |<span data-ttu-id="e3c9e-181">TCP</span><span class="sxs-lookup"><span data-stu-id="e3c9e-181">TCP</span></span> |<span data-ttu-id="e3c9e-182">Внутренний обмен данными для Redis</span><span class="sxs-lookup"><span data-stu-id="e3c9e-182">Internal communications for Redis</span></span> | <span data-ttu-id="e3c9e-183">(Подсеть Redis)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-183">(Redis subnet)</span></span> |<span data-ttu-id="e3c9e-184">(Подсеть Redis)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-184">(Redis subnet)</span></span> |
| <span data-ttu-id="e3c9e-185">13000-13999</span><span class="sxs-lookup"><span data-stu-id="e3c9e-185">13000-13999</span></span> |<span data-ttu-id="e3c9e-186">Исходящие</span><span class="sxs-lookup"><span data-stu-id="e3c9e-186">Outbound</span></span> |<span data-ttu-id="e3c9e-187">TCP</span><span class="sxs-lookup"><span data-stu-id="e3c9e-187">TCP</span></span> |<span data-ttu-id="e3c9e-188">Внутренний обмен данными для Redis</span><span class="sxs-lookup"><span data-stu-id="e3c9e-188">Internal communications for Redis</span></span> | <span data-ttu-id="e3c9e-189">(Подсеть Redis)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-189">(Redis subnet)</span></span> |<span data-ttu-id="e3c9e-190">(Подсеть Redis)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-190">(Redis subnet)</span></span> |
| <span data-ttu-id="e3c9e-191">15000-15999</span><span class="sxs-lookup"><span data-stu-id="e3c9e-191">15000-15999</span></span> |<span data-ttu-id="e3c9e-192">Исходящие</span><span class="sxs-lookup"><span data-stu-id="e3c9e-192">Outbound</span></span> |<span data-ttu-id="e3c9e-193">TCP</span><span class="sxs-lookup"><span data-stu-id="e3c9e-193">TCP</span></span> |<span data-ttu-id="e3c9e-194">Внутренний обмен данными для Redis</span><span class="sxs-lookup"><span data-stu-id="e3c9e-194">Internal communications for Redis</span></span> | <span data-ttu-id="e3c9e-195">(Подсеть Redis)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-195">(Redis subnet)</span></span> |<span data-ttu-id="e3c9e-196">(Подсеть Redis)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-196">(Redis subnet)</span></span> |


### <a name="inbound-port-requirements"></a><span data-ttu-id="e3c9e-197">Обязательные порты для входящего трафика</span><span class="sxs-lookup"><span data-stu-id="e3c9e-197">Inbound port requirements</span></span>

<span data-ttu-id="e3c9e-198">Существует восемь обязательных диапазонов портов для входящего трафика.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-198">There are eight inbound port range requirements.</span></span> <span data-ttu-id="e3c9e-199">Входящие запросы в этих диапазонов либо являются входящие данные от других служб, размещенных в hello одной виртуальной сети или внутренней toohello связь подсети Redis.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-199">Inbound requests in these ranges are either inbound from other services hosted in hello same VNET or internal toohello Redis subnet communications.</span></span>

| <span data-ttu-id="e3c9e-200">Порты</span><span class="sxs-lookup"><span data-stu-id="e3c9e-200">Port(s)</span></span> | <span data-ttu-id="e3c9e-201">Направление</span><span class="sxs-lookup"><span data-stu-id="e3c9e-201">Direction</span></span> | <span data-ttu-id="e3c9e-202">Транспортный протокол</span><span class="sxs-lookup"><span data-stu-id="e3c9e-202">Transport Protocol</span></span> | <span data-ttu-id="e3c9e-203">Назначение</span><span class="sxs-lookup"><span data-stu-id="e3c9e-203">Purpose</span></span> | <span data-ttu-id="e3c9e-204">Локальный IP-адрес</span><span class="sxs-lookup"><span data-stu-id="e3c9e-204">Local IP</span></span> | <span data-ttu-id="e3c9e-205">Удаленный IP-адрес</span><span class="sxs-lookup"><span data-stu-id="e3c9e-205">Remote IP</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="e3c9e-206">6379, 6380</span><span class="sxs-lookup"><span data-stu-id="e3c9e-206">6379, 6380</span></span> |<span data-ttu-id="e3c9e-207">Входящий трафик</span><span class="sxs-lookup"><span data-stu-id="e3c9e-207">Inbound</span></span> |<span data-ttu-id="e3c9e-208">TCP</span><span class="sxs-lookup"><span data-stu-id="e3c9e-208">TCP</span></span> |<span data-ttu-id="e3c9e-209">Балансировка нагрузки Azure в tooRedis связи клиента,</span><span class="sxs-lookup"><span data-stu-id="e3c9e-209">Client communication tooRedis, Azure load balancing</span></span> | <span data-ttu-id="e3c9e-210">(Подсеть Redis)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-210">(Redis subnet)</span></span> |<span data-ttu-id="e3c9e-211">Виртуальная сеть, Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="e3c9e-211">Virtual Network, Azure Load Balancer</span></span> |
| <span data-ttu-id="e3c9e-212">8443</span><span class="sxs-lookup"><span data-stu-id="e3c9e-212">8443</span></span> |<span data-ttu-id="e3c9e-213">Входящий трафик</span><span class="sxs-lookup"><span data-stu-id="e3c9e-213">Inbound</span></span> |<span data-ttu-id="e3c9e-214">TCP</span><span class="sxs-lookup"><span data-stu-id="e3c9e-214">TCP</span></span> |<span data-ttu-id="e3c9e-215">Внутренний обмен данными для Redis</span><span class="sxs-lookup"><span data-stu-id="e3c9e-215">Internal communications for Redis</span></span> | <span data-ttu-id="e3c9e-216">(Подсеть Redis)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-216">(Redis subnet)</span></span> |<span data-ttu-id="e3c9e-217">(Подсеть Redis)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-217">(Redis subnet)</span></span> |
| <span data-ttu-id="e3c9e-218">8500</span><span class="sxs-lookup"><span data-stu-id="e3c9e-218">8500</span></span> |<span data-ttu-id="e3c9e-219">Входящий трафик</span><span class="sxs-lookup"><span data-stu-id="e3c9e-219">Inbound</span></span> |<span data-ttu-id="e3c9e-220">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="e3c9e-220">TCP/UDP</span></span> |<span data-ttu-id="e3c9e-221">Балансировка нагрузки Azure</span><span class="sxs-lookup"><span data-stu-id="e3c9e-221">Azure load balancing</span></span> | <span data-ttu-id="e3c9e-222">(Подсеть Redis)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-222">(Redis subnet)</span></span> |<span data-ttu-id="e3c9e-223">Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="e3c9e-223">Azure Load Balancer</span></span> |
| <span data-ttu-id="e3c9e-224">10221-10231</span><span class="sxs-lookup"><span data-stu-id="e3c9e-224">10221-10231</span></span> |<span data-ttu-id="e3c9e-225">Входящий трафик</span><span class="sxs-lookup"><span data-stu-id="e3c9e-225">Inbound</span></span> |<span data-ttu-id="e3c9e-226">TCP</span><span class="sxs-lookup"><span data-stu-id="e3c9e-226">TCP</span></span> |<span data-ttu-id="e3c9e-227">Внутренний обмен данными для Redis</span><span class="sxs-lookup"><span data-stu-id="e3c9e-227">Internal communications for Redis</span></span> | <span data-ttu-id="e3c9e-228">(Подсеть Redis)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-228">(Redis subnet)</span></span> |<span data-ttu-id="e3c9e-229">(Подсеть Redis) Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="e3c9e-229">(Redis subnet), Azure Load Balancer</span></span> |
| <span data-ttu-id="e3c9e-230">13000-13999</span><span class="sxs-lookup"><span data-stu-id="e3c9e-230">13000-13999</span></span> |<span data-ttu-id="e3c9e-231">Входящий трафик</span><span class="sxs-lookup"><span data-stu-id="e3c9e-231">Inbound</span></span> |<span data-ttu-id="e3c9e-232">TCP</span><span class="sxs-lookup"><span data-stu-id="e3c9e-232">TCP</span></span> |<span data-ttu-id="e3c9e-233">Обмен данными клиента tooRedis кластеры балансировки нагрузки Azure</span><span class="sxs-lookup"><span data-stu-id="e3c9e-233">Client communication tooRedis Clusters, Azure load balancing</span></span> | <span data-ttu-id="e3c9e-234">(Подсеть Redis)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-234">(Redis subnet)</span></span> |<span data-ttu-id="e3c9e-235">Виртуальная сеть, Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="e3c9e-235">Virtual Network, Azure Load Balancer</span></span> |
| <span data-ttu-id="e3c9e-236">15000-15999</span><span class="sxs-lookup"><span data-stu-id="e3c9e-236">15000-15999</span></span> |<span data-ttu-id="e3c9e-237">Входящий трафик</span><span class="sxs-lookup"><span data-stu-id="e3c9e-237">Inbound</span></span> |<span data-ttu-id="e3c9e-238">TCP</span><span class="sxs-lookup"><span data-stu-id="e3c9e-238">TCP</span></span> |<span data-ttu-id="e3c9e-239">Балансировка нагрузки кластеры Azure в tooRedis связи клиента</span><span class="sxs-lookup"><span data-stu-id="e3c9e-239">Client communication tooRedis Clusters, Azure load Balancing</span></span> | <span data-ttu-id="e3c9e-240">(Подсеть Redis)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-240">(Redis subnet)</span></span> |<span data-ttu-id="e3c9e-241">Виртуальная сеть, Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="e3c9e-241">Virtual Network, Azure Load Balancer</span></span> |
| <span data-ttu-id="e3c9e-242">16001</span><span class="sxs-lookup"><span data-stu-id="e3c9e-242">16001</span></span> |<span data-ttu-id="e3c9e-243">Входящий трафик</span><span class="sxs-lookup"><span data-stu-id="e3c9e-243">Inbound</span></span> |<span data-ttu-id="e3c9e-244">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="e3c9e-244">TCP/UDP</span></span> |<span data-ttu-id="e3c9e-245">Балансировка нагрузки Azure</span><span class="sxs-lookup"><span data-stu-id="e3c9e-245">Azure load balancing</span></span> | <span data-ttu-id="e3c9e-246">(Подсеть Redis)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-246">(Redis subnet)</span></span> |<span data-ttu-id="e3c9e-247">Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="e3c9e-247">Azure Load Balancer</span></span> |
| <span data-ttu-id="e3c9e-248">20226</span><span class="sxs-lookup"><span data-stu-id="e3c9e-248">20226</span></span> |<span data-ttu-id="e3c9e-249">Входящий трафик</span><span class="sxs-lookup"><span data-stu-id="e3c9e-249">Inbound</span></span> |<span data-ttu-id="e3c9e-250">TCP</span><span class="sxs-lookup"><span data-stu-id="e3c9e-250">TCP</span></span> |<span data-ttu-id="e3c9e-251">Внутренний обмен данными для Redis</span><span class="sxs-lookup"><span data-stu-id="e3c9e-251">Internal communications for Redis</span></span> | <span data-ttu-id="e3c9e-252">(Подсеть Redis)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-252">(Redis subnet)</span></span> |<span data-ttu-id="e3c9e-253">(Подсеть Redis)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-253">(Redis subnet)</span></span> |

### <a name="additional-vnet-network-connectivity-requirements"></a><span data-ttu-id="e3c9e-254">Дополнительные требования к подключению к виртуальной сети</span><span class="sxs-lookup"><span data-stu-id="e3c9e-254">Additional VNET network connectivity requirements</span></span>

<span data-ttu-id="e3c9e-255">Существуют требования к сетевому подключению кэша Redis для Azure, которым виртуальная сеть изначально может не соответствовать.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-255">There are network connectivity requirements for Azure Redis Cache that may not be initially met in a virtual network.</span></span> <span data-ttu-id="e3c9e-256">Кэш Azure Redis требует наличия всех hello следующие элементы toofunction должным образом в том случае, при использовании в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-256">Azure Redis Cache requires all hello following items toofunction properly when used within a virtual network.</span></span>

* <span data-ttu-id="e3c9e-257">Исходящее сетевое подключение tooAzure конечные точки хранилища по всему миру.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-257">Outbound network connectivity tooAzure Storage endpoints worldwide.</span></span> <span data-ttu-id="e3c9e-258">Сюда входят конечных точках, найденных в hello hello экземпляр кэша Redis для Azure, а также конечные точки хранилища, расположенных в одном регионе **других** регионах Azure.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-258">This includes endpoints located in hello same region as hello Azure Redis Cache instance, as well as storage endpoints located in **other** Azure regions.</span></span> <span data-ttu-id="e3c9e-259">Разрешить конечные точки хранилища Azure в следующих доменов DNS hello: *table.core.windows.net*, *blob.core.windows.net*, *queue.core.windows.net*и *file.core.windows.net*.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-259">Azure Storage endpoints resolve under hello following DNS domains: *table.core.windows.net*, *blob.core.windows.net*, *queue.core.windows.net*, and *file.core.windows.net*.</span></span> 
* <span data-ttu-id="e3c9e-260">Исходящие сетевое подключение слишком*ocsp.msocsp.com*, *mscrl.microsoft.com*, и *crl.microsoft.com*. Подключение будет функциональность необходимые toosupport SSL.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-260">Outbound network connectivity too*ocsp.msocsp.com*, *mscrl.microsoft.com*, and *crl.microsoft.com*. This connectivity is needed toosupport SSL functionality.</span></span>
* <span data-ttu-id="e3c9e-261">Hello конфигурацию DNS для виртуальной сети hello должны быть способны все конечные точки hello и домены упомянутые в более ранних точек hello.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-261">hello DNS configuration for hello virtual network must be capable of resolving all of hello endpoints and domains mentioned in hello earlier points.</span></span> <span data-ttu-id="e3c9e-262">Эти требования DNS может выполняться за счет того, настроен и поддерживается для виртуальной сети hello допустимым инфраструктуры DNS.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-262">These DNS requirements can be met by ensuring a valid DNS infrastructure is configured and maintained for hello virtual network.</span></span>
* <span data-ttu-id="e3c9e-263">Исходящее сетевое подключение toohello следующие мониторинга Azure конечных точек, то разрешения в группе hello следующие домены DNS: shoebox2 black.shoebox2.metrics.nsatc.net, северо prod2.prod2.metrics.nsatc.net azglobal-black.azglobal.metrics.nsatc.net, azglobal восточно prod2.prod2.metrics.nsatc.net shoebox2-red.shoebox2.metrics.nsatc.net-red.azglobal.metrics.nsatc.net.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-263">Outbound network connectivity toohello following Azure Monitoring endpoints, which resolve under hello following DNS domains: shoebox2-black.shoebox2.metrics.nsatc.net, north-prod2.prod2.metrics.nsatc.net, azglobal-black.azglobal.metrics.nsatc.net, shoebox2-red.shoebox2.metrics.nsatc.net, east-prod2.prod2.metrics.nsatc.net, azglobal-red.azglobal.metrics.nsatc.net.</span></span>

### <a name="how-can-i-verify-that-my-cache-is-working-in-a-vnet"></a><span data-ttu-id="e3c9e-264">Как проверить, что кэш работает в виртуальной сети?</span><span class="sxs-lookup"><span data-stu-id="e3c9e-264">How can I verify that my cache is working in a VNET?</span></span>

>[!IMPORTANT]
><span data-ttu-id="e3c9e-265">При подключении экземпляра tooan кэш Azure Redis, размещенном в виртуальной сети, ваш кэш, который клиенты должны находиться в hello одной виртуальной сети, включая любые проверить работу приложений и средств диагностики обмен пакетами.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-265">When connecting tooan Azure Redis Cache instance that is hosted in a VNET, your cache clients must be in hello same VNET, including any test applications or diagnostic pinging tools.</span></span>
>
>

<span data-ttu-id="e3c9e-266">После настройки требований порта hello как описано в предыдущем разделе hello можно проверить, что кэш работает, выполнив следующие шаги hello.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-266">Once hello port requirements are configured as described in hello previous section, you can verify that your cache is working by performing hello following steps.</span></span>

- <span data-ttu-id="e3c9e-267">[Перезагрузите](cache-administration.md#reboot) все hello кэшировать узлов.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-267">[Reboot](cache-administration.md#reboot) all of hello cache nodes.</span></span> <span data-ttu-id="e3c9e-268">Если все hello необходимые зависимости кэша становится недоступной (задокументированного в [входящего трафика требования к портам](cache-how-to-premium-vnet.md#inbound-port-requirements) и [требования исходящий порт](cache-how-to-premium-vnet.md#outbound-port-requirements)), hello кэша не будет возможности toorestart успешно.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-268">If all of hello required cache dependencies can't be reached (as documented in [Inbound port requirements](cache-how-to-premium-vnet.md#inbound-port-requirements) and [Outbound port requirements](cache-how-to-premium-vnet.md#outbound-port-requirements)), hello cache won't be able toorestart successfully.</span></span>
- <span data-ttu-id="e3c9e-269">После узлов кэша hello были перезагружены (по данным состояние кэша hello в hello портал Azure), можно выполнить следующие тесты hello:</span><span class="sxs-lookup"><span data-stu-id="e3c9e-269">Once hello cache nodes have restarted (as reported by hello cache status in hello Azure portal), you can perform hello following tests:</span></span>
  - <span data-ttu-id="e3c9e-270">проверить связь с hello конечную точку кэша (через порт 6380) с компьютера, который находится в пределах hello одной виртуальной сети как hello кэшировать, с помощью [tcping](https://www.elifulkerson.com/projects/tcping.php).</span><span class="sxs-lookup"><span data-stu-id="e3c9e-270">ping hello cache endpoint (using port 6380) from a machine that is within hello same VNET as hello cache, using [tcping](https://www.elifulkerson.com/projects/tcping.php).</span></span> <span data-ttu-id="e3c9e-271">Например:</span><span class="sxs-lookup"><span data-stu-id="e3c9e-271">For example:</span></span>
    
    `tcping.exe contosocache.redis.cache.windows.net 6380`
    
    <span data-ttu-id="e3c9e-272">Если hello `tcping` средство сообщает, что открыт порт hello, hello кэша для подключения от клиентов в hello виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-272">If hello `tcping` tool reports that hello port is open, hello cache is available for connection from clients in hello VNET.</span></span>

  - <span data-ttu-id="e3c9e-273">Tootest другим способом является toocreate тестового клиента кэша (который может быть простой консольного приложения с использованием StackExchange.Redis), подключается toohello кэша и добавляет и извлекает некоторые элементы из кэша hello.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-273">Another way tootest is toocreate a test cache client (which could be a simple console application using StackExchange.Redis) that connects toohello cache and adds and retrieves some items from hello cache.</span></span> <span data-ttu-id="e3c9e-274">Установка hello образец клиентского приложения на виртуальной Машины, которая находится в одной виртуальной сети в качестве кэша hello hello и запустите его tooverify подключение toohello кэша.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-274">Install hello sample client application onto a VM that is in hello same VNET as hello cache and run it tooverify connectivity toohello cache.</span></span>


### <a name="can-i-use-vnets-with-a-standard-or-basic-cache"></a><span data-ttu-id="e3c9e-275">Можно ли использовать виртуальные сети в кэше уровня "Стандартный" или "Базовый"?</span><span class="sxs-lookup"><span data-stu-id="e3c9e-275">Can I use VNets with a standard or basic cache?</span></span>
<span data-ttu-id="e3c9e-276">Виртуальные сети доступны только для кэшей уровня "Премиум".</span><span class="sxs-lookup"><span data-stu-id="e3c9e-276">VNets can only be used with premium caches.</span></span>

### <a name="why-does-creating-a-redis-cache-fail-in-some-subnets-but-not-others"></a><span data-ttu-id="e3c9e-277">Почему в одних подсетях не удается создать кэш Redis, а в других удается?</span><span class="sxs-lookup"><span data-stu-id="e3c9e-277">Why does creating a Redis cache fail in some subnets but not others?</span></span>
<span data-ttu-id="e3c9e-278">При развертывании tooa кэша Redis для Azure Resource Manager виртуальной сети hello кэша необходимо в выделенной подсетью, содержит никакой другой тип ресурса.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-278">If you are deploying an Azure Redis Cache tooa Resource Manager VNet, hello cache must be in a dedicated subnet that contains no other resource type.</span></span> <span data-ttu-id="e3c9e-279">Если попытаться сделать это toodeploy кэш Azure Redis tooa подсети виртуальной сети диспетчер ресурсов, которая содержит другие ресурсы, hello развертывания завершается ошибкой.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-279">If an attempt is made toodeploy an Azure Redis Cache tooa Resource Manager VNet subnet that contains other resources, hello deployment fails.</span></span> <span data-ttu-id="e3c9e-280">Hello существующих ресурсов внутри hello подсети необходимо удалить, прежде чем создавать новый кэш Redis.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-280">You must delete hello existing resources inside hello subnet before you can create a new Redis cache.</span></span>

<span data-ttu-id="e3c9e-281">Можно развернуть несколько типов из ресурсов tooa классической виртуальной сети, пока у вас недостаточно IP доступных адресов.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-281">You can deploy multiple types of resources tooa classic VNet as long as you have enough IP addresses available.</span></span>

### <a name="what-are-hello-subnet-address-space-requirements"></a><span data-ttu-id="e3c9e-282">Каковы требования к свободному месту адрес подсети hello</span><span class="sxs-lookup"><span data-stu-id="e3c9e-282">What are hello subnet address space requirements?</span></span>
<span data-ttu-id="e3c9e-283">Azure резервирует некоторые IP-адреса в каждой подсети, которые нельзя использовать.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-283">Azure reserves some IP addresses within each subnet, and these addresses can't be used.</span></span> <span data-ttu-id="e3c9e-284">Hello первый и последний IP-адреса подсетей hello зарезервированы для соответствия протоколу, а также три дополнительные адреса, используемые для служб Azure.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-284">hello first and last IP addresses of hello subnets are reserved for protocol conformance, along with three more addresses used for Azure services.</span></span> <span data-ttu-id="e3c9e-285">Дополнительные сведения см. в разделе [Существуют ли ограничения на использование IP-адресов в пределах этих подсетей?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-285">For more information, see [Are there any restrictions on using IP addresses within these subnets?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span></span>

<span data-ttu-id="e3c9e-286">В добавление toohello IP-адреса виртуальной сети Azure инфраструктурой hello Redis для каждого экземпляра в hello подсети использует два IP-адреса на сегмент и один дополнительный IP-адрес для подсистемы балансировки нагрузки hello.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-286">In addition toohello IP addresses used by hello Azure VNET infrastructure, each Redis instance in hello subnet uses two IP addresses per shard and one additional IP address for hello load balancer.</span></span> <span data-ttu-id="e3c9e-287">Кэш некластеризованных считается toohave один сегмент.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-287">A non-clustered cache is considered toohave one shard.</span></span>

### <a name="do-all-cache-features-work-when-hosting-a-cache-in-a-vnet"></a><span data-ttu-id="e3c9e-288">Do all cache features work when hosting a cache in a VNET? (Все ли функции кэша работают, когда он размещен в виртуальной сети?)</span><span class="sxs-lookup"><span data-stu-id="e3c9e-288">Do all cache features work when hosting a cache in a VNET?</span></span>
<span data-ttu-id="e3c9e-289">Когда кэш является частью виртуальной сети, только клиенты в hello виртуальной сети можно обращается к кэшу hello.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-289">When your cache is part of a VNET, only clients in hello VNET can access hello cache.</span></span> <span data-ttu-id="e3c9e-290">В результате hello следующие возможности управления кэша не работают в данный момент.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-290">As a result, hello following cache management features don't work at this time.</span></span>

* <span data-ttu-id="e3c9e-291">Консоль redis — поскольку консоль Redis выполняется в вашей локальной браузера, который находится за пределами hello виртуальной сети, она не может подключиться tooyour кэша.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-291">Redis Console - Because Redis Console runs in your local browser, which is outside hello VNET, it can't connect tooyour cache.</span></span>

## <a name="use-expressroute-with-azure-redis-cache"></a><span data-ttu-id="e3c9e-292">Использование ExpressRoute с кэшем Redis для Azure</span><span class="sxs-lookup"><span data-stu-id="e3c9e-292">Use ExpressRoute with Azure Redis Cache</span></span>
<span data-ttu-id="e3c9e-293">Клиенты могут подключаться [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) цепь tootheir виртуальная сетевая инфраструктура, расширяя их tooAzure в локальной сети.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-293">Customers can connect an [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) circuit tootheir virtual network infrastructure, thus extending their on-premises network tooAzure.</span></span> 

<span data-ttu-id="e3c9e-294">По умолчанию только что созданный канал ExpressRoute не выполняет принудительное туннелирование (объявление маршрута по умолчанию, 0.0.0.0/0) в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-294">By default, a newly created ExpressRoute circuit does not perform forced tunneling (advertisement of a default route, 0.0.0.0/0) on a VNET.</span></span> <span data-ttu-id="e3c9e-295">В результате исходящие подключения к Интернету может быть непосредственно из hello виртуальной сети и клиентских приложений, могут tooconnect tooother Azure конечных точек, включая кэша Redis для Azure.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-295">As a result, outbound Internet connectivity is allowed directly from hello VNET and client applications are able tooconnect tooother Azure endpoints including Azure Redis Cache.</span></span>

<span data-ttu-id="e3c9e-296">Однако общая конфигурация клиента является toouse принудительного туннелирования (объявление маршрута по умолчанию) что вызывает исходящего Интернет трафика tooinstead потока в локальной среде.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-296">However a common customer configuration is toouse forced tunneling (advertise a default route) which forces outbound Internet traffic tooinstead flow on-premises.</span></span> <span data-ttu-id="e3c9e-297">Этот поток трафика разбивает подключение с помощью кэша Azure Redis, если является hello исходящего трафика, а затем заблокировано в локальной, так, чтобы hello экземпляр кэша Redis для Azure не может toocommunicate с зависимостями.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-297">This traffic flow breaks connectivity with Azure Redis Cache if hello outbound traffic is then blocked on-premises such that hello Azure Redis Cache instance is not able toocommunicate with its dependencies.</span></span>

<span data-ttu-id="e3c9e-298">Hello решением является toodefine один (или более) определяемых пользователем маршрутов (UDRs) на hello подсети, содержащей hello кэша Redis для Azure.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-298">hello solution is toodefine one (or more) user-defined routes (UDRs) on hello subnet that contains hello Azure Redis Cache.</span></span> <span data-ttu-id="e3c9e-299">UDR определяет маршруты конкретной подсети, которые будут соблюдаться вместо маршрут по умолчанию hello.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-299">A UDR defines subnet-specific routes that will be honored instead of hello default route.</span></span>

<span data-ttu-id="e3c9e-300">Если это возможно рекомендуется следующая конфигурация hello toouse:</span><span class="sxs-lookup"><span data-stu-id="e3c9e-300">If possible, it is recommended toouse hello following configuration:</span></span>

* <span data-ttu-id="e3c9e-301">Конфигурация ExpressRoute Hello объявляет 0.0.0.0/0 и по умолчанию force туннелей всех исходящего трафика в локальной.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-301">hello ExpressRoute configuration advertises 0.0.0.0/0 and by default force tunnels all outbound traffic on-premises.</span></span>
* <span data-ttu-id="e3c9e-302">Hello UDR применения toohello подсеть содержащий hello кэша Redis для Azure определяет 0.0.0.0/0 на работе маршрут для toohello трафик TCP/IP общедоступный Интернет; Например, установка hello следующего прыжка too'Internet тип ".</span><span class="sxs-lookup"><span data-stu-id="e3c9e-302">hello UDR applied toohello subnet containing hello Azure Redis Cache defines 0.0.0.0/0 with a working route for TCP/IP traffic toohello public internet; for example by setting hello next hop type too'Internet'.</span></span>

<span data-ttu-id="e3c9e-303">Hello воздействии этих шагов — что уровне подсети hello UDR имеет приоритет над hello ExpressRoute принудительного туннелирования, обеспечивая исходящие подключения к Интернету из hello кэша Redis для Azure.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-303">hello combined effect of these steps is that hello subnet level UDR takes precedence over hello ExpressRoute forced tunneling, thus ensuring outbound Internet access from hello Azure Redis Cache.</span></span>

<span data-ttu-id="e3c9e-304">Типичное использование сценарий из-за причин tooperformance не подключении экземпляра tooan кэша Redis для Azure из локального приложения, с помощью ExpressRoute (для достижения оптимальной производительности кэша Redis для Azure клиенты должны находиться в hello же регионе, что кэш Azure Redis hello).</span><span class="sxs-lookup"><span data-stu-id="e3c9e-304">Connecting tooan Azure Redis Cache instance from an on-premises application using ExpressRoute is not a typical usage scenario due tooperformance reasons (for best performance Azure Redis Cache clients should be in hello same region as hello Azure Redis Cache).</span></span>

>[!IMPORTANT] 
><span data-ttu-id="e3c9e-305">Здравствуйте маршрутов, указанных в UDR **должен** быть достаточно точным, tootake приоритет через все маршруты, объявленные hello ExpressRoute конфигурацией.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-305">hello routes defined in a UDR **must** be specific enough tootake precedence over any routes advertised by hello ExpressRoute configuration.</span></span> <span data-ttu-id="e3c9e-306">Hello следующий пример использует диапазон адресов широкий 0.0.0.0/0 hello и таким образом могут быть случайно переписаны объявлений маршрутов с помощью более конкретных диапазонов адресов.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-306">hello following example uses hello broad 0.0.0.0/0 address range, and as such can potentially be accidentally overridden by route advertisements using more specific address ranges.</span></span>

>[!WARNING]  
><span data-ttu-id="e3c9e-307">Кэш Azure Redis не поддерживается с конфигурациями ExpressRoute, **неправильно кросс объявлять маршруты из hello открытого пиринга путь toohello частным путем пиринга**.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-307">Azure Redis Cache is not supported with ExpressRoute configurations that **incorrectly cross-advertise routes from hello public peering path toohello private peering path**.</span></span> <span data-ttu-id="e3c9e-308">Конфигурации ExpressRoute, для которых настроен общедоступный пиринг, будут получать объявления маршрутов от корпорации Майкрософт для большого набора диапазонов IP-адресов Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-308">ExpressRoute configurations that have public peering configured, receive route advertisements from Microsoft for a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="e3c9e-309">Если эти диапазоны адресов — это неправильно кросс объявляемых частным путем пиринга hello, hello происходит, все исходящие сетевые пакеты из экземпляра кэша Redis для Azure hello подсети локальной сети клиента tooa неправильно принудительного туннелирования инфраструктура.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-309">If these address ranges are incorrectly cross-advertised on hello private peering path, hello result is that all outbound network packets from hello Azure Redis Cache instance's subnet are incorrectly force-tunneled tooa customer's on-premises network infrastructure.</span></span> <span data-ttu-id="e3c9e-310">Этот сетевой поток нарушает работу кэша Redis для Azure.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-310">This network flow breaks Azure Redis Cache.</span></span> <span data-ttu-id="e3c9e-311">Hello решения toothis проблема заключается в toostop маршруты между рекламу от hello открытого пиринга путь toohello частным путем пиринга.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-311">hello solution toothis problem is toostop cross-advertising routes from hello public peering path toohello private peering path.</span></span>


<span data-ttu-id="e3c9e-312">Справочные сведения об определяемых пользователем маршрутах см. в этом [обзоре](../virtual-network/virtual-networks-udr-overview.md).</span><span class="sxs-lookup"><span data-stu-id="e3c9e-312">Background information on user-defined routes is available in this [overview](../virtual-network/virtual-networks-udr-overview.md).</span></span>

<span data-ttu-id="e3c9e-313">Дополнительные сведения об ExpressRoute см. в статье [Технический обзор ExpressRoute](../expressroute/expressroute-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="e3c9e-313">For more information about ExpressRoute, see [ExpressRoute technical overview](../expressroute/expressroute-introduction.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="e3c9e-314">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="e3c9e-314">Next steps</span></span>
<span data-ttu-id="e3c9e-315">Узнайте, как toouse более "премиум" кэша функции.</span><span class="sxs-lookup"><span data-stu-id="e3c9e-315">Learn how toouse more premium cache features.</span></span>

* [<span data-ttu-id="e3c9e-316">Уровень Premium кэша Redis Azure toohello введение</span><span class="sxs-lookup"><span data-stu-id="e3c9e-316">Introduction toohello Azure Redis Cache Premium tier</span></span>](cache-premium-tier-intro.md)

<!-- IMAGES -->

[redis-cache-vnet]: ./media/cache-how-to-premium-vnet/redis-cache-vnet.png

[redis-cache-vnet-ip]: ./media/cache-how-to-premium-vnet/redis-cache-vnet-ip.png

[redis-cache-vnet-info]: ./media/cache-how-to-premium-vnet/redis-cache-vnet-info.png

