---
title: "Настройка аналитики веб-приложения для ASP.NET с помощью Azure Application Insights | Документация Майкрософт"
description: "Настройка средств аналитики производительности, доступности и использования для веб-сайта ASP.NET, размещенного локально или в Azure."
services: application-insights
documentationcenter: .net
author: CFreemanwa
manager: carmonm
ms.assetid: d0eee3c0-b328-448f-8123-f478052751db
ms.service: application-insights
ms.workload: tbd
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: get-started-article
ms.date: 05/15/2017
ms.author: bwren
ms.openlocfilehash: cb247ee68da88265f7c51258644064463d44f8b5
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2017
---
# <a name="set-up-application-insights-for-your-aspnet-website"></a>Настройка Application Insights для веб-сайта ASP.NET

Эта процедура настраивает веб-приложение ASP.NET для отправки данных телеметрии в службу [Azure Application Insights](app-insights-overview.md). Она работает для приложений ASP.NET, размещенных на сервере IIS или в облаке. Она предоставляет диаграммы и эффективный язык запросов, который поможет определить производительность приложений и способ использования приложений пользователями, а также автоматические оповещения о сбоях или проблемах с производительностью. Многим разработчикам нравятся эти функции в изначальном виде, но при необходимости их можно расширить и настроить данные телеметрии.

Настройка выполняется несколькими щелчками в Visual Studio. Вы можете избежать расходов, ограничив объем телеметрии. Это позволяет экспериментировать и выполнять отладку или наблюдать за сайтом с небольшим числом пользователей. Если вы хотите отслеживать рабочий сайт, вы можете легко увеличить лимит позже.

## <a name="before-you-start"></a>Перед началом работы
Вам необходимы:

* Visual Studio 2013 с обновлением 3 или более новая версия. Чем новее версия, тем лучше.
* подписка на [Microsoft Azure](http://azure.com). Если у вашей группы или организации есть подписка Azure, владелец может добавить вас в нее с помощью вашей [учетной записи Майкрософт](http://live.com).

Существуют и другие статьи, к которым можно обратиться, если вас интересуют такие темы, как:

* [инструментирование веб-приложения во время выполнения;](app-insights-monitor-performance-live-website-now.md)
* [облачных служб Azure](app-insights-cloudservices.md)

## <a name="ide"></a> Шаг 1. Добавление пакета SDK Application Insights

В обозревателе решений щелкните проект веб-приложения правой кнопкой мыши и выберите пункт **Добавить** > **Телеметрия Application Insights** или **Настроить Application Insights**.

![Снимок экрана с окном обозревателя решений, где выделен параметр "Добавить" и "Телеметрия Application Insights"](./media/app-insights-asp-net/appinsights-03-addExisting.png)

(В Visual Studio 2015 есть параметр, который позволяет добавить Application Insights в диалоговое окно создания проекта.)

Перейдите на страницу настройки Application Insights.

![Снимок экрана с окном страницы "Зарегистрировать приложение в Application Insights"](./media/app-insights-asp-net/visual-studio-register-dialog.png)

**а.** Выберите учетную запись и подписку, которые будут использоваться для доступа к Azure.

**б.** Выберите ресурс в Azure, в котором должны отображаться данные из приложения. Обычно:

* Используйте [один ресурс для разных компонентов](app-insights-monitor-multi-role-apps.md) одного приложения. 
* Создавайте разные ресурсы для несвязанных приложений.
 
Если вы хотите задать группу ресурсов или расположение, где будут храниться данные, щелкните **Настроить параметры**. Группы ресурсов используются для управления доступом к данным. Например, если имеется несколько приложений, которые являются частью одной системы, вы можете поместить их данные Application Insights в одну группу ресурсов.

**в.** Задайте максимальное ограничение объема свободных данных, чтобы избежать ненужных расходов. Служба Application Insights является бесплатной до определенного объема данных телеметрии. После создания ресурса можно изменить выбранные параметры на портале, открыв **Компоненты и расценки** > **Управление данными** > **Ограничение ежедневного объема**.

**г.** Щелкните **Регистрация**, чтобы приступить к настройке Application Insights для веб-приложения. Данные телеметрии будут отправляться на [портал Azure](https://portal.azure.com) как во время отладки, так и после публикации приложения.

**д.** Если вы не хотите отправлять данные телеметрии на портал во время отладки, просто добавьте пакет SDK Application Insights в приложение, но не настраивайте ресурс на портале. Во время отладки можно будет просмотреть данные телеметрии в Visual Studio. Позже вы сможете вернуться на эту страницу настроек или можете дождаться, когда приложение будет развернуто, и [переключиться на данные телеметрии во время выполнения](app-insights-monitor-performance-live-website-now.md).


## <a name="run"></a> Шаг 2. Запуск приложения
Запустите приложение, нажав клавишу F5. Откройте разные страницы, чтобы создать некоторый объем данных телеметрии.

В Visual Studio вы увидите число записанных в журнал событий.

![Снимок экрана, где отображается Visual Studio Кнопка Application Insights доступна во время отладки.](./media/app-insights-asp-net/54.png)

## <a name="step-3-see-your-telemetry"></a>Шаг 3. Просмотр данных телеметрии
Вы можете просмотреть данные телеметрии в Visual Studio или на веб-портале Application Insights. Выполните поиск данных телеметрии в Visual Studio для отладки приложения. Отслеживайте производительность и использование на веб-портале в режиме реального времени. 

### <a name="see-your-telemetry-in-visual-studio"></a>Просмотр данных телеметрии в Visual Studio

В Visual Studio откройте окно Application Insights. Нажмите кнопку **Application Insights** или щелкните проект в обозревателе решений правой кнопкой мыши, выберите **Application Insights**, а затем щелкните **Поиск действующей телеметрии**.

В окне поиска Application Insights в Visual Studio просмотрите представление **данных, полученных в ходе сеанса отладки**, где отображаются данные телеметрии, созданные в серверной части приложения. Поэкспериментируйте с фильтрами и щелкните любое событие, чтобы просмотреть подробные сведения.

![Снимок экрана, где показано представление данных, полученных в ходе сеанса отладки, в окне Application Insights.](./media/app-insights-asp-net/55.png)

> [!NOTE]
> Если данные не отображаются, проверьте диапазон времени и щелкните значок поиска.

[Дополнительные сведения о средствах Application Insights в Visual Studio](app-insights-visual-studio.md).

<a name="monitor"></a>
### <a name="see-telemetry-in-web-portal"></a>Просмотр данных телеметрии на веб-портале

Вы можете также просматривать данные телеметрии на веб-портале Application Insights, если только не решили установить только пакет SDK. На портале представлено больше дополнительных диаграмм, средств анализа и представлений различных компонентов, чем в Visual Studio. На портале также доступны оповещения.

Откройте ресурс Application Insights. Войдите на [портал Azure](https://portal.azure.com/) и найдите его там или щелкните правой кнопкой мыши проект в Visual Studio и перейдите к нему.

![Снимок экрана с окном Visual Studio, где показано, как открыть портал Application Insights](./media/app-insights-asp-net/appinsights-04-openPortal.png)

> [!NOTE]
> Если произошла ошибка доступа, возможно, у вас есть несколько наборов учетных данных Майкрософт и вы использовали для входа неправильный набор. На портале повторите процедуру выхода и входа.

На портале откроется представление данных телеметрии из приложения.

![Снимок экрана, где отображается страница с обзором Application Insights](./media/app-insights-asp-net/66.png)

На портале щелкните любую плитку, чтобы просмотреть подробные сведения.

[Дополнительные сведения об использовании Application Insights на портале Azure](app-insights-dashboards.md).

## <a name="step-4-publish-your-app"></a>Шах 4. Публикация приложения
Опубликуйте приложение на сервере IIS или в Azure. Просмотрите [динамический поток метрик](app-insights-metrics-explorer.md#live-metrics-stream), чтобы убедиться в бесперебойной работе приложения.

Телеметрия создается на портале Application Insights, где можно отслеживать метрики, выполнять поиск данных телеметрии и настраивать [панели мониторинга](app-insights-dashboards.md). Можно также использовать эффективный [язык запросов Log Analytics](https://docs.loganalytics.io/) для анализа использования и производительности или поиска определенных событий.

Кроме того, можно продолжить анализировать телеметрию в [Visual Studio](app-insights-visual-studio.md) с помощью таких средств, как поиск по журналу диагностики и [тренды](app-insights-visual-studio-trends.md).

> [!NOTE]
> Если приложение отправляет достаточно данных телеметрии для достижения [пределов регулирования](app-insights-pricing.md#limits-summary), включается автоматическая [выборка](app-insights-sampling.md). Выборка позволяет уменьшить количество данных телеметрии, отправляемых из приложения, сохраняя связанные данные в целях диагностики.
>
>

## <a name="land"></a>Все готово

Поздравляем! Вы установили в приложение пакет Application Insights и настроили его для отправки данных телеметрии в службу Application Insights в Azure.

![Диаграмма перемещения данных телеметрии](./media/app-insights-asp-net/01-scheme.png)

Ресурс Azure, который получает данные телеметрии приложения, определяется *ключом инструментирования*. Вы найдете этот ключ в файле ApplicationInsights.config.


## <a name="upgrade-to-future-sdk-versions"></a>Обновление до будущих версий пакета SDK
Чтобы установить [новый выпуск пакета SDK](https://github.com/Microsoft/ApplicationInsights-dotnet-server/releases), еще раз откройте **диспетчер пакетов NuGet** и выполните фильтрацию по установленным пакетам. Выберите элемент **Microsoft.ApplicationInsights.Web**, а затем — элемент **Обновить**.

Если были выполнены какие-либо настройки файла ApplicationInsights.config, то прежде чем выполнять обновление, сохраните его копию. Затем объедините изменения в новой версии.

## <a name="video"></a>Видео

> [!VIDEO https://channel9.msdn.com/events/Connect/2016/100/player]

## <a name="next-steps"></a>Дальнейшие действия

### <a name="more-telemetry"></a>Дополнительные данные телеметрии

* **[Данные загрузки браузера и страниц](app-insights-javascript.md)** — вставьте фрагмент кода в веб-страницы.
* **[Более подробные зависимости и данные отслеживание исключений](app-insights-monitor-performance-live-website-now.md)** — установите монитор состояния на сервере.
* **[Добавьте в приложение код для пользовательских событий](app-insights-api-custom-events-metrics.md)**, чтобы считать, фиксировать время и измерять действия пользователя.
* **[Получение данных журнала](app-insights-asp-net-trace-logs.md)** — согласовывайте данные журналов с данными телеметрии.

### <a name="analysis"></a>Анализ

* **[Работа с Application Insights в Visual Studio](app-insights-visual-studio.md)**<br/>Содержит сведения об отладке с помощью телеметрии, о поиске по журналу диагностики и детализации кода.
* **[Работа с порталом Application Insights](app-insights-dashboards.md)**<br/> Содержит сведения о панелях мониторинга, эффективных средствах диагностики и анализа, оповещениях, картах динамических зависимостей приложения, а также сведения об экспорте данных телеметрии.
* **[Аналитика](app-insights-analytics-tour.md)** — эффективный язык запросов.

### <a name="alerts"></a>Оповещения

* [Тесты доступности.](app-insights-monitor-web-app-availability.md) Создавайте тесты, позволяющие проверить, доступен ли ваш сайт в Интернете.
* [Интеллектуальная диагностика.](app-insights-proactive-diagnostics.md) Эти тесты выполняются автоматически, поэтому вам не нужно их настраивать. Благодаря ей вы узнаете о необычном количестве неудачных запросов.
* [Оповещения о метриках.](app-insights-alerts.md) Настройте их, чтобы получать уведомления в случае, если метрика превысила пороговое значение. Их можно настроить для пользовательских метрик, добавляемых в код приложения.

### <a name="automation"></a>Служба автоматизации

* [Создание ресурсов Application Insights с помощью PowerShell](app-insights-powershell.md)
