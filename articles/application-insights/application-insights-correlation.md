---
title: "Корреляция данных телеметрии Azure Application Insights | Документация Майкрософт"
description: "Корреляция данных телеметрии Application Insights"
services: application-insights
documentationcenter: .net
author: SergeyKanzhelev
manager: carmonm
ms.service: application-insights
ms.workload: TBD
ms.tgt_pltfrm: ibiza
ms.devlang: multiple
ms.topic: article
ms.date: 04/25/2017
ms.author: bwren
ms.openlocfilehash: 747c00842f4df9c7fbd816c99771ba8a267106a4
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2017
---
# <a name="telemetry-correlation-in-application-insights"></a><span data-ttu-id="9c65e-103">Корреляция данных телеметрии в Application Insights</span><span class="sxs-lookup"><span data-stu-id="9c65e-103">Telemetry correlation in Application Insights</span></span>

<span data-ttu-id="9c65e-104">В мире микрослужб для каждой логической операции требуется выполнение действий в различных компонентах службы.</span><span class="sxs-lookup"><span data-stu-id="9c65e-104">In the world of micro services, every logical operation requires work done in various components of the service.</span></span> <span data-ttu-id="9c65e-105">Служба [Application Insights](app-insights-overview.md) может отдельно отслеживать каждый из этих компонентов.</span><span class="sxs-lookup"><span data-stu-id="9c65e-105">Each of these components can be separately monitored by [Application Insights](app-insights-overview.md).</span></span> <span data-ttu-id="9c65e-106">Компонент веб-приложения взаимодействует с компонентом поставщика проверки подлинности для проверки учетных данных пользователя и компонентом API для получения данных для визуализации.</span><span class="sxs-lookup"><span data-stu-id="9c65e-106">The web app component communicates with authentication provider component to validate user credentials, and with the API component to get data for visualization.</span></span> <span data-ttu-id="9c65e-107">Компонент API в свою очередь может запрашивать данные из других служб и использовать компоненты поставщика кэша, а также уведомлять компонент выставления счетов об этом вызове.</span><span class="sxs-lookup"><span data-stu-id="9c65e-107">The API component in its turn can query data from other services and use cache-provider components and notify the billing component about this call.</span></span> <span data-ttu-id="9c65e-108">Application Insights поддерживает распределенную корреляцию данных телеметрии.</span><span class="sxs-lookup"><span data-stu-id="9c65e-108">Application Insights supports distributed telemetry correlation.</span></span> <span data-ttu-id="9c65e-109">Это позволяет определить, какой компонент отвечает за сбой или снижение производительности.</span><span class="sxs-lookup"><span data-stu-id="9c65e-109">It allows you to detect which component is responsible for failures or performance degradation.</span></span>

<span data-ttu-id="9c65e-110">В этой статье описывается модель данных, используемая службой Application Insights для корреляции данных телеметрии, отправляемых несколькими компонентами.</span><span class="sxs-lookup"><span data-stu-id="9c65e-110">This article explains the data model used by Application Insights to correlate telemetry sent by multiple components.</span></span> <span data-ttu-id="9c65e-111">Рассматриваются методы и протоколы распространения контекста.</span><span class="sxs-lookup"><span data-stu-id="9c65e-111">It covers the context propagation techniques and protocols.</span></span> <span data-ttu-id="9c65e-112">Здесь также рассматривается реализация принципов корреляции на разных языках и платформах.</span><span class="sxs-lookup"><span data-stu-id="9c65e-112">It also covers the implementation of the correlation concepts on different languages and platforms.</span></span>

## <a name="telemetry-correlation-data-model"></a><span data-ttu-id="9c65e-113">Модель корреляции данных телеметрии</span><span class="sxs-lookup"><span data-stu-id="9c65e-113">Telemetry correlation data model</span></span>

<span data-ttu-id="9c65e-114">Application Insights определяет [модель данных](application-insights-data-model.md) для распределенной корреляции данных телеметрии.</span><span class="sxs-lookup"><span data-stu-id="9c65e-114">Application Insights defines a [data model](application-insights-data-model.md) for distributed telemetry correlation.</span></span> <span data-ttu-id="9c65e-115">Для связывания данных телеметрии с логической операцией у каждого элемента телеметрии есть поле контекста `operation_Id`.</span><span class="sxs-lookup"><span data-stu-id="9c65e-115">To associate telemetry with the logical operation, every telemetry item has a context field called `operation_Id`.</span></span> <span data-ttu-id="9c65e-116">Этот идентификатор совместно используется каждым элементом телеметрии в распределенной трассировке.</span><span class="sxs-lookup"><span data-stu-id="9c65e-116">This identifier is shared by every telemetry item in the distributed trace.</span></span> <span data-ttu-id="9c65e-117">Поэтому даже в случае потери телеметрии из одного уровня вы по-прежнему можете связывать данные телеметрии, сообщаемые другими компонентами.</span><span class="sxs-lookup"><span data-stu-id="9c65e-117">So even with loss of telemetry from a single layer you still can associate telemetry reported by other components.</span></span>

<span data-ttu-id="9c65e-118">Распределенная логическая операция обычно состоит из набора меньших операций — запросов, обрабатываемых одним из компонентов.</span><span class="sxs-lookup"><span data-stu-id="9c65e-118">Distributed logical operation typically consists of a set of smaller operations - requests processed by one of the components.</span></span> <span data-ttu-id="9c65e-119">Эти операции определяются [телеметрией запросов](application-insights-data-model-request-telemetry.md).</span><span class="sxs-lookup"><span data-stu-id="9c65e-119">Those operations are defined by [request telemetry](application-insights-data-model-request-telemetry.md).</span></span> <span data-ttu-id="9c65e-120">Каждый элемент телеметрии запросов имеет собственный уникальный `id`, который его глобально идентифицирует.</span><span class="sxs-lookup"><span data-stu-id="9c65e-120">Every request telemetry has its own `id` that uniquely globally identifies it.</span></span> <span data-ttu-id="9c65e-121">И для всех данных телеметрии (трассировок, исключений и др.), связанных с этим запросом, следует задать значение `operation_parentId` для `id` запроса.</span><span class="sxs-lookup"><span data-stu-id="9c65e-121">And all telemetry - traces, exceptions, etc. associated with this request should set the `operation_parentId` to the value of the request `id`.</span></span>

<span data-ttu-id="9c65e-122">Каждая исходящая операция, такая как вызов HTTP к другому компоненту, представлена [телеметрией зависимостей](application-insights-data-model-dependency-telemetry.md).</span><span class="sxs-lookup"><span data-stu-id="9c65e-122">Every outgoing operation like http call to another component represented by [dependency telemetry](application-insights-data-model-dependency-telemetry.md).</span></span> <span data-ttu-id="9c65e-123">Телеметрия зависимостей также определяет собственный `id`, который является глобально уникальным.</span><span class="sxs-lookup"><span data-stu-id="9c65e-123">Dependency telemetry also defines its own `id` that is globally unique.</span></span> <span data-ttu-id="9c65e-124">Телеметрия запросов, инициированная этим вызовом зависимостей, использует его в качестве `operation_parentId`.</span><span class="sxs-lookup"><span data-stu-id="9c65e-124">Request telemetry, initiated by this dependency call, uses it as `operation_parentId`.</span></span>

<span data-ttu-id="9c65e-125">Можно создать представление распределенной логической операции, используя `operation_Id`, `operation_parentId` и `request.id` с `dependency.id`.</span><span class="sxs-lookup"><span data-stu-id="9c65e-125">You can build the view of distributed logical operation using `operation_Id`, `operation_parentId`, and `request.id` with `dependency.id`.</span></span> <span data-ttu-id="9c65e-126">Эти поля также определяют причинно-следственную связь вызовов телеметрии.</span><span class="sxs-lookup"><span data-stu-id="9c65e-126">Those fields also define the causality order of telemetry calls.</span></span>

<span data-ttu-id="9c65e-127">В среде микрослужб трассировки компонентов могут отправляться в разные хранилища.</span><span class="sxs-lookup"><span data-stu-id="9c65e-127">In micro services environment, traces from components may go to the different storages.</span></span> <span data-ttu-id="9c65e-128">Каждый компонент может иметь свой собственный ключ инструментирования в Application Insights.</span><span class="sxs-lookup"><span data-stu-id="9c65e-128">Every component may have its own instrumentation key in Application Insights.</span></span> <span data-ttu-id="9c65e-129">Чтобы получить данные телеметрии для логической операции, необходимо запросить данные из каждого хранилища.</span><span class="sxs-lookup"><span data-stu-id="9c65e-129">To get telemetry for the logical operation, you need to query data from every storage.</span></span> <span data-ttu-id="9c65e-130">Если число хранилищ очень велико, то необходимо дать указание, где продолжить поиск.</span><span class="sxs-lookup"><span data-stu-id="9c65e-130">When number of storages is huge, you need to have a hint on where to look next.</span></span>

<span data-ttu-id="9c65e-131">Модель данных Application Insights определяет два поля (`request.source` и `dependency.target`) для решения этой проблемы.</span><span class="sxs-lookup"><span data-stu-id="9c65e-131">Application Insights data model defines two fields to solve this problem: `request.source` and `dependency.target`.</span></span> <span data-ttu-id="9c65e-132">Первое поле определяет компонент, который инициировал запрос зависимости, а второе — компонент, который вернул ответ вызова зависимостей.</span><span class="sxs-lookup"><span data-stu-id="9c65e-132">The first field identifies the component that initiated the dependency request, and the second identifies which component returned the response of the dependency call.</span></span>


## <a name="example"></a><span data-ttu-id="9c65e-133">Пример</span><span class="sxs-lookup"><span data-stu-id="9c65e-133">Example</span></span>

<span data-ttu-id="9c65e-134">Давайте рассмотрим пример приложения STOCK PRICES (Стоимость акций), в котором показывается текущая рыночная стоимость акций. При этом используется внешний интерфейс API, называемый STOCKS API (API акций).</span><span class="sxs-lookup"><span data-stu-id="9c65e-134">Let's take an example of an application STOCK PRICES showing the current market price of a stock using the external API called STOCKS API.</span></span> <span data-ttu-id="9c65e-135">В приложении STOCK PRICES есть страница `Stock page`, которая открывается в браузере клиента с помощью `GET /Home/Stock`.</span><span class="sxs-lookup"><span data-stu-id="9c65e-135">The STOCK PRICES application has a page `Stock page` opened by the client web browser using `GET /Home/Stock`.</span></span> <span data-ttu-id="9c65e-136">Приложение запрашивает STOCK API с помощью HTTP-вызова `GET /api/stock/value`.</span><span class="sxs-lookup"><span data-stu-id="9c65e-136">The application queries the STOCK API by using an HTTP call `GET /api/stock/value`.</span></span>

<span data-ttu-id="9c65e-137">Вы можете проанализировать итоговые данные телеметрии, выполнив запрос:</span><span class="sxs-lookup"><span data-stu-id="9c65e-137">You can analyze resulting telemetry running a query:</span></span>

```
(requests | union dependencies | union pageViews) 
| where operation_Id == "STYz"
| project timestamp, itemType, name, id, operation_ParentId, operation_Id
```

<span data-ttu-id="9c65e-138">Обратите внимание, что в представлении результата все элементы телеметрии используют корневой `operation_Id`.</span><span class="sxs-lookup"><span data-stu-id="9c65e-138">In the result view note that all telemetry items share the root `operation_Id`.</span></span> <span data-ttu-id="9c65e-139">При вызове AJAX, осуществляемом со страницы, телеметрии зависимостей назначается новый уникальный идентификатор `qJSXU`, а в качестве `operation_ParentId` используется идентификатор pageView.</span><span class="sxs-lookup"><span data-stu-id="9c65e-139">When ajax call made from the page - new unique id `qJSXU` is assigned to the dependency telemetry and pageView's id is used as `operation_ParentId`.</span></span> <span data-ttu-id="9c65e-140">В свою очередь запрос сервера использует идентификатор AJAX в качестве `operation_ParentId`, и т. д.</span><span class="sxs-lookup"><span data-stu-id="9c65e-140">In turn server request uses ajax's id as `operation_ParentId`, etc.</span></span>

| <span data-ttu-id="9c65e-141">itemType</span><span class="sxs-lookup"><span data-stu-id="9c65e-141">itemType</span></span>   | <span data-ttu-id="9c65e-142">name</span><span class="sxs-lookup"><span data-stu-id="9c65e-142">name</span></span>                      | <span data-ttu-id="9c65e-143">id</span><span class="sxs-lookup"><span data-stu-id="9c65e-143">id</span></span>           | <span data-ttu-id="9c65e-144">operation_ParentId</span><span class="sxs-lookup"><span data-stu-id="9c65e-144">operation_ParentId</span></span> | <span data-ttu-id="9c65e-145">operation_Id</span><span class="sxs-lookup"><span data-stu-id="9c65e-145">operation_Id</span></span> |
|------------|---------------------------|--------------|--------------------|--------------|
| <span data-ttu-id="9c65e-146">pageView</span><span class="sxs-lookup"><span data-stu-id="9c65e-146">pageView</span></span>   | <span data-ttu-id="9c65e-147">Stock page</span><span class="sxs-lookup"><span data-stu-id="9c65e-147">Stock page</span></span>                |              | <span data-ttu-id="9c65e-148">STYz</span><span class="sxs-lookup"><span data-stu-id="9c65e-148">STYz</span></span>               | <span data-ttu-id="9c65e-149">STYz</span><span class="sxs-lookup"><span data-stu-id="9c65e-149">STYz</span></span>         |
| <span data-ttu-id="9c65e-150">dependency</span><span class="sxs-lookup"><span data-stu-id="9c65e-150">dependency</span></span> | <span data-ttu-id="9c65e-151">GET /Home/Stock</span><span class="sxs-lookup"><span data-stu-id="9c65e-151">GET /Home/Stock</span></span>           | <span data-ttu-id="9c65e-152">qJSXU</span><span class="sxs-lookup"><span data-stu-id="9c65e-152">qJSXU</span></span>        | <span data-ttu-id="9c65e-153">STYz</span><span class="sxs-lookup"><span data-stu-id="9c65e-153">STYz</span></span>               | <span data-ttu-id="9c65e-154">STYz</span><span class="sxs-lookup"><span data-stu-id="9c65e-154">STYz</span></span>         |
| <span data-ttu-id="9c65e-155">запрос</span><span class="sxs-lookup"><span data-stu-id="9c65e-155">request</span></span>    | <span data-ttu-id="9c65e-156">GET Home/Stock</span><span class="sxs-lookup"><span data-stu-id="9c65e-156">GET Home/Stock</span></span>            | <span data-ttu-id="9c65e-157">KqKwlrSt9PA=</span><span class="sxs-lookup"><span data-stu-id="9c65e-157">KqKwlrSt9PA=</span></span> | <span data-ttu-id="9c65e-158">qJSXU</span><span class="sxs-lookup"><span data-stu-id="9c65e-158">qJSXU</span></span>              | <span data-ttu-id="9c65e-159">STYz</span><span class="sxs-lookup"><span data-stu-id="9c65e-159">STYz</span></span>         |
| <span data-ttu-id="9c65e-160">dependency</span><span class="sxs-lookup"><span data-stu-id="9c65e-160">dependency</span></span> | <span data-ttu-id="9c65e-161">GET /api/stock/value</span><span class="sxs-lookup"><span data-stu-id="9c65e-161">GET /api/stock/value</span></span>      | <span data-ttu-id="9c65e-162">bBrf2L7mm2g=</span><span class="sxs-lookup"><span data-stu-id="9c65e-162">bBrf2L7mm2g=</span></span> | <span data-ttu-id="9c65e-163">KqKwlrSt9PA=</span><span class="sxs-lookup"><span data-stu-id="9c65e-163">KqKwlrSt9PA=</span></span>       | <span data-ttu-id="9c65e-164">STYz</span><span class="sxs-lookup"><span data-stu-id="9c65e-164">STYz</span></span>         |

<span data-ttu-id="9c65e-165">Теперь, когда к внешней службе осуществлен вызов `GET /api/stock/value`, необходимо узнать идентификатор этого сервера.</span><span class="sxs-lookup"><span data-stu-id="9c65e-165">Now when the call `GET /api/stock/value` made to an external service you want to know the identity of that server.</span></span> <span data-ttu-id="9c65e-166">Поэтому можно соответствующим образом задать поле `dependency.target`.</span><span class="sxs-lookup"><span data-stu-id="9c65e-166">So you can set `dependency.target` field appropriately.</span></span> <span data-ttu-id="9c65e-167">Если внешняя служба не поддерживает мониторинг, то в качестве `target` задается имя узла службы, например `stock-prices-api.com`.</span><span class="sxs-lookup"><span data-stu-id="9c65e-167">When the external service does not support monitoring - `target` is set to the host name of the service like `stock-prices-api.com`.</span></span> <span data-ttu-id="9c65e-168">Однако если для идентификации этой службы возвращается предопределенный заголовок HTTP, то `target` содержит удостоверение службы, которое позволяет Application Insights создать распределенную трассировку, запросив телеметрию из этой службы.</span><span class="sxs-lookup"><span data-stu-id="9c65e-168">However if that service identifies itself by returning a predefined HTTP header - `target` contains the service identity that allows Application Insights to build distributed trace by querying telemetry from that service.</span></span> 

## <a name="correlation-headers"></a><span data-ttu-id="9c65e-169">Заголовки корреляции</span><span class="sxs-lookup"><span data-stu-id="9c65e-169">Correlation headers</span></span>

<span data-ttu-id="9c65e-170">Мы работаем над созданием предложения RFC для [протокола HTTP корреляции](https://github.com/lmolkova/correlation/blob/master/http_protocol_proposal_v1.md).</span><span class="sxs-lookup"><span data-stu-id="9c65e-170">We are working on RFC proposal for the [correlation HTTP protocol](https://github.com/lmolkova/correlation/blob/master/http_protocol_proposal_v1.md).</span></span> <span data-ttu-id="9c65e-171">Это предложение определяет два заголовка:</span><span class="sxs-lookup"><span data-stu-id="9c65e-171">This proposal defines two headers:</span></span>

- <span data-ttu-id="9c65e-172">`Request-Id` содержит глобальный уникальный идентификатор вызова.</span><span class="sxs-lookup"><span data-stu-id="9c65e-172">`Request-Id` carry the globally unique id of the call</span></span>
- <span data-ttu-id="9c65e-173">`Correlation-Context` содержит коллекцию пар "имя-значение" свойств распределенной трассировки.</span><span class="sxs-lookup"><span data-stu-id="9c65e-173">`Correlation-Context` - carry the name value pairs collection of the distributed trace properties</span></span>

<span data-ttu-id="9c65e-174">Стандарт также определяет две схемы создания `Request-Id` — неструктурированная и иерархическая.</span><span class="sxs-lookup"><span data-stu-id="9c65e-174">The standard also defines two schemas of `Request-Id` generation - flat and hierarchical.</span></span> <span data-ttu-id="9c65e-175">В неструктурированной схеме для коллекции `Correlation-Context` определяется хорошо известный ключ `Id`.</span><span class="sxs-lookup"><span data-stu-id="9c65e-175">With the flat schema, there is a well-known `Id` key defined for the `Correlation-Context` collection.</span></span>

<span data-ttu-id="9c65e-176">Служба Application Insights определяет [расширение](https://github.com/lmolkova/correlation/blob/master/http_protocol_proposal_v2.md) для протокола HTTP корреляции.</span><span class="sxs-lookup"><span data-stu-id="9c65e-176">Application Insights defines the [extension](https://github.com/lmolkova/correlation/blob/master/http_protocol_proposal_v2.md) for the correlation HTTP protocol.</span></span> <span data-ttu-id="9c65e-177">Она использует пары "имя-значение" `Request-Context` для распространения коллекции свойств, используемых непосредственным вызывающим или вызываемым.</span><span class="sxs-lookup"><span data-stu-id="9c65e-177">It uses `Request-Context` name value pairs to propagate the collection of properties used by the immediate caller or callee.</span></span> <span data-ttu-id="9c65e-178">Пакет SDK для Application Insights использует этот заголовок, чтобы задать значения полей `dependency.target` и `request.source`.</span><span class="sxs-lookup"><span data-stu-id="9c65e-178">Application Insights SDK uses this header to set `dependency.target` and `request.source` fields.</span></span>

## <a name="open-tracing-and-application-insights"></a><span data-ttu-id="9c65e-179">OpenTracing и Application Insights</span><span class="sxs-lookup"><span data-stu-id="9c65e-179">Open tracing and Application Insights</span></span>

<span data-ttu-id="9c65e-180">Модели данных [OpenTracing](http://opentracing.io/) и Application Insights выглядят следующим образом:</span><span class="sxs-lookup"><span data-stu-id="9c65e-180">[Open Tracing](http://opentracing.io/) and Application Insights data models looks</span></span> 

- <span data-ttu-id="9c65e-181">`request` и `pageView` сопоставляются со **Span** с помощью `span.kind = server`;</span><span class="sxs-lookup"><span data-stu-id="9c65e-181">`request`, `pageView` maps to **Span** with `span.kind = server`</span></span>
- <span data-ttu-id="9c65e-182">`dependency` сопоставляется со **Span** с помощью `span.kind = client`;</span><span class="sxs-lookup"><span data-stu-id="9c65e-182">`dependency` maps to **Span** with `span.kind = client`</span></span>
- <span data-ttu-id="9c65e-183">`id` элементов `request` и `dependency` сопоставляется со **Span.Id**;</span><span class="sxs-lookup"><span data-stu-id="9c65e-183">`id` of a `request` and `dependency` maps to **Span.Id**</span></span>
- <span data-ttu-id="9c65e-184">`operation_Id` сопоставляется с **TraceId**;</span><span class="sxs-lookup"><span data-stu-id="9c65e-184">`operation_Id` maps to **TraceId**</span></span>
- <span data-ttu-id="9c65e-185">`operation_ParentId` сопоставляется с **Reference** типа `ChileOf`.</span><span class="sxs-lookup"><span data-stu-id="9c65e-185">`operation_ParentId` maps to **Reference** of type `ChileOf`</span></span>

<span data-ttu-id="9c65e-186">В [этой статье](application-insights-data-model.md) представлены типы данных и модель данных для Application Insights.</span><span class="sxs-lookup"><span data-stu-id="9c65e-186">See [data model](application-insights-data-model.md) for Application Insights types and data model.</span></span>

<span data-ttu-id="9c65e-187">Определения основных понятий OpenTracing см. в [спецификации](https://github.com/opentracing/specification/blob/master/specification.md) и [соглашениях о семантике](https://github.com/opentracing/specification/blob/master/semantic_conventions.md).</span><span class="sxs-lookup"><span data-stu-id="9c65e-187">See [specification](https://github.com/opentracing/specification/blob/master/specification.md) and [semantic_conventions](https://github.com/opentracing/specification/blob/master/semantic_conventions.md) for definitions of Open Tracing concepts.</span></span>


## <a name="telemetry-correlation-in-net"></a><span data-ttu-id="9c65e-188">Корреляция данных телеметрии в .NET</span><span class="sxs-lookup"><span data-stu-id="9c65e-188">Telemetry correlation in .NET</span></span>

<span data-ttu-id="9c65e-189">Со временем в .NET было определено несколько способов корреляции данных телеметрии и журналов диагностики.</span><span class="sxs-lookup"><span data-stu-id="9c65e-189">Over time .NET defined number of ways to correlate telemetry and diagnostics logs.</span></span> <span data-ttu-id="9c65e-190">`System.Diagnostics.CorrelationManager` позволяет отслеживать свойства [LogicalOperationStack и ActivityId](https://msdn.microsoft.com/library/system.diagnostics.correlationmanager.aspx).</span><span class="sxs-lookup"><span data-stu-id="9c65e-190">There is `System.Diagnostics.CorrelationManager` allowing to track [LogicalOperationStack and ActivityId](https://msdn.microsoft.com/library/system.diagnostics.correlationmanager.aspx).</span></span> <span data-ttu-id="9c65e-191">`System.Diagnostics.Tracing.EventSource` и трассировка событий Windows определяют метод [SetCurrentThreadActivityId](https://msdn.microsoft.com/library/system.diagnostics.tracing.eventsource.setcurrentthreadactivityid.aspx).</span><span class="sxs-lookup"><span data-stu-id="9c65e-191">`System.Diagnostics.Tracing.EventSource` and Windows ETW define the method [SetCurrentThreadActivityId](https://msdn.microsoft.com/library/system.diagnostics.tracing.eventsource.setcurrentthreadactivityid.aspx).</span></span> <span data-ttu-id="9c65e-192">`ILogger` использует [области журналов](https://docs.microsoft.com/aspnet/core/fundamentals/logging#log-scopes).</span><span class="sxs-lookup"><span data-stu-id="9c65e-192">`ILogger` uses [Log Scopes](https://docs.microsoft.com/aspnet/core/fundamentals/logging#log-scopes).</span></span> <span data-ttu-id="9c65e-193">WCF и HTTP подключают распространение "текущего" контекста.</span><span class="sxs-lookup"><span data-stu-id="9c65e-193">WCF and Http wire up "current" context propagation.</span></span>

<span data-ttu-id="9c65e-194">Однако эти методы не обеспечивали поддержку автоматической распределенной трассировки.</span><span class="sxs-lookup"><span data-stu-id="9c65e-194">However those methods didn't enable automatic distributed tracing support.</span></span> <span data-ttu-id="9c65e-195">`DiagnosticsSource` — это способ обеспечить поддержку автоматической корреляции между компьютерами.</span><span class="sxs-lookup"><span data-stu-id="9c65e-195">`DiagnosticsSource` is a way to support automatic cross machine correlation.</span></span> <span data-ttu-id="9c65e-196">Библиотеки .NET поддерживают DiagnosticsSource и разрешают автоматическое распространение контекста корреляции между компьютерами, используя транспортный протокол, например HTTP.</span><span class="sxs-lookup"><span data-stu-id="9c65e-196">.NET libraries support Diagnostics Source and allow automatic cross machine propagation of the correlation context via the transport like http.</span></span>

<span data-ttu-id="9c65e-197">В [руководстве пользователя по классу Activity](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md) представлены общие сведения об отслеживании действий в DiagnosticsSource.</span><span class="sxs-lookup"><span data-stu-id="9c65e-197">The [guide to Activities](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md) in Diagnostics Source explains the basics of tracking Activities.</span></span> 

<span data-ttu-id="9c65e-198">ASP.NET Core 2.0 поддерживает извлечение заголовков HTTP и запуск нового действия (Activity).</span><span class="sxs-lookup"><span data-stu-id="9c65e-198">ASP.NET Core 2.0 supports extraction of Http Headers and starting the new Activity.</span></span> 

<span data-ttu-id="9c65e-199">`System.Net.HttpClient`, начиная с версии `<fill in>`, поддерживает автоматическое внедрение заголовков HTTP корреляции и отслеживание вызова HTTP как действия.</span><span class="sxs-lookup"><span data-stu-id="9c65e-199">`System.Net.HttpClient` starting version `<fill in>` supports automatic injection of the correlation Http Headers and tracking the http call as an Activity.</span></span>

<span data-ttu-id="9c65e-200">Для ASP.NET Classic доступен новый HTTP-модуль [Microsoft.AspNet.TelemetryCorrelation](https://www.nuget.org/packages/Microsoft.AspNet.TelemetryCorrelation/).</span><span class="sxs-lookup"><span data-stu-id="9c65e-200">There is a new Http Module [Microsoft.AspNet.TelemetryCorrelation](https://www.nuget.org/packages/Microsoft.AspNet.TelemetryCorrelation/) for the ASP.NET Classic.</span></span> <span data-ttu-id="9c65e-201">Этот модуль реализует корреляцию данных телеметрии с помощью DiagnosticsSource.</span><span class="sxs-lookup"><span data-stu-id="9c65e-201">This module implements telemetry correlation using DiagnosticsSource.</span></span> <span data-ttu-id="9c65e-202">Он запускает действие, исходя их заголовков входящего запроса.</span><span class="sxs-lookup"><span data-stu-id="9c65e-202">It starts activity based on incoming request headers.</span></span> <span data-ttu-id="9c65e-203">Он также сопоставляет данные телеметрии из разных этапов обработки запроса.</span><span class="sxs-lookup"><span data-stu-id="9c65e-203">It also correlates telemetry from the different stages of request processing.</span></span> <span data-ttu-id="9c65e-204">Даже если каждый этап обработки IIS выполняется в разных потоках управления.</span><span class="sxs-lookup"><span data-stu-id="9c65e-204">Even for the cases when every stage of IIS processing runs on a different manage threads.</span></span>

<span data-ttu-id="9c65e-205">Пакет SDK для Application Insights, начиная с версии `2.4.0-beta1`, использует DiagnosticsSource и Activity для сбора данных телеметрии и их связывания с текущим действием.</span><span class="sxs-lookup"><span data-stu-id="9c65e-205">Application Insights SDK starting version `2.4.0-beta1` uses DiagnosticsSource and Activity to collect telemetry and associate it with the current activity.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="9c65e-206">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="9c65e-206">Next steps</span></span>

- [<span data-ttu-id="9c65e-207">API Application Insights для пользовательских событий и метрик</span><span class="sxs-lookup"><span data-stu-id="9c65e-207">Write custom telemetry</span></span>](app-insights-api-custom-events-metrics.md)
- <span data-ttu-id="9c65e-208">Подключите все компоненты своей микрослужбы с помощью Application Insights.</span><span class="sxs-lookup"><span data-stu-id="9c65e-208">Onboard all components of your micro service on Application Insights.</span></span> <span data-ttu-id="9c65e-209">Ознакомьтесь со сведениями о [поддерживаемых платформах](app-insights-platforms.md).</span><span class="sxs-lookup"><span data-stu-id="9c65e-209">Check out [supported platforms](app-insights-platforms.md).</span></span>
- <span data-ttu-id="9c65e-210">В [этой статье](application-insights-data-model.md) представлены типы данных и модель данных для Application Insights.</span><span class="sxs-lookup"><span data-stu-id="9c65e-210">See [data model](application-insights-data-model.md) for Application Insights types and data model.</span></span>
- <span data-ttu-id="9c65e-211">Узнайте, как [расширять и фильтровать данные телеметрии](app-insights-api-filtering-sampling.md).</span><span class="sxs-lookup"><span data-stu-id="9c65e-211">Learn how to [extend and filter telemetry](app-insights-api-filtering-sampling.md).</span></span>
