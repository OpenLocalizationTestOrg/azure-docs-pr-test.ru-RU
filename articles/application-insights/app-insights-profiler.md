---
title: "aaaProfiling динамических веб-приложений в Azure с помощью Application Insights | Документы Microsoft"
description: "Определите hello Горячий путь в код веб-сервера с помощью профилировщика небольшого размера."
services: application-insights
documentationcenter: 
author: CFreemanwa
manager: carmonm
ms.service: application-insights
ms.workload: tbd
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: article
ms.date: 05/04/2017
ms.author: bwren
ms.openlocfilehash: 3c7f21076f19335e0f006327932e13623ec9526b
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="profiling-live-azure-web-apps-with-application-insights"></a><span data-ttu-id="b1d8d-103">Профилирование динамических веб-приложений Azure с помощью Application Insights</span><span class="sxs-lookup"><span data-stu-id="b1d8d-103">Profiling live Azure web apps with Application Insights</span></span>

<span data-ttu-id="b1d8d-104">*Общедоступная версия этой функции Application Insights доступна для служб приложений, а предварительная — для вычислений.*</span><span class="sxs-lookup"><span data-stu-id="b1d8d-104">*This feature of Application Insights is GA for App Services and in preview for Compute.*</span></span>

<span data-ttu-id="b1d8d-105">Узнайте, сколько время, затраченное на каждый метод в реальном времени веб-приложения с помощью средства для профилирования hello [Azure Application Insights](app-insights-overview.md).</span><span class="sxs-lookup"><span data-stu-id="b1d8d-105">Find out how much time is spent in each method in your live web application by using hello profiling tool of [Azure Application Insights](app-insights-overview.md).</span></span> <span data-ttu-id="b1d8d-106">Он показывает подробные профили динамических запросов, которые были получены в приложении и выделяет hello «Горячий путь», используемого hello большая часть времени.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-106">It shows you detailed profiles of live requests that were served by your app, and highlights hello 'hot path' that is using hello most time.</span></span> <span data-ttu-id="b1d8d-107">Это средство автоматически выбирает примеры с разным временем ответа.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-107">It automatically selects examples that have different response times.</span></span> <span data-ttu-id="b1d8d-108">Hello профилировщик использует различные методы toominimize издержки.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-108">hello profiler uses various techniques toominimize overhead.</span></span>

<span data-ttu-id="b1d8d-109">Hello профилировщика в настоящее время работает для ASP.NET веб-приложения, работающие на службы приложений Azure, в ценовой категории Basic по крайней мере hello.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-109">hello profiler currently works for ASP.NET web apps running on Azure App Services, in at least hello Basic pricing tier.</span></span> 

<a id="installation"></a>
## <a name="enable-hello-profiler"></a><span data-ttu-id="b1d8d-110">Включить профилировщик hello</span><span class="sxs-lookup"><span data-stu-id="b1d8d-110">Enable hello profiler</span></span>

<span data-ttu-id="b1d8d-111">[Установите Application Insights](app-insights-asp-net.md) в коде.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-111">[Install Application Insights](app-insights-asp-net.md) in your code.</span></span> <span data-ttu-id="b1d8d-112">Если он уже установлен, убедитесь, что у вас есть последняя версия hello.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-112">If it's already installed, make sure you have hello latest version.</span></span> <span data-ttu-id="b1d8d-113">(toodo это, щелкните правой кнопкой мыши проект в обозревателе решений и выберите Управление пакетами NuGet.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-113">(toodo this, right-click your project in Solution Explorer, and choose Manage NuGet packages.</span></span> <span data-ttu-id="b1d8d-114">Выберите "Обновления" и обновите все пакеты.) Повторно разверните приложение.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-114">Select Updates and update all packages.) Re-deploy your app.</span></span>

<span data-ttu-id="b1d8d-115">*Используете ASP.NET Core? [Ознакомьтесь с этим разделом](#aspnetcore).*</span><span class="sxs-lookup"><span data-stu-id="b1d8d-115">*Using ASP.NET Core? [Check here](#aspnetcore).*</span></span>

<span data-ttu-id="b1d8d-116">В [https://portal.azure.com](https://portal.azure.com), открытие hello ресурса Application Insights для веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-116">In [https://portal.azure.com](https://portal.azure.com), open hello Application Insights resource for your web app.</span></span> <span data-ttu-id="b1d8d-117">Откройте **Производительность** и щелкните **Включить профилировщик Application Insights**.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-117">Open **Performance** and click **Enable Application Insights Profiler...**.</span></span>

![Нажмите кнопку в заголовке профилировщик enable hello][enable-profiler-banner]

<span data-ttu-id="b1d8d-119">Кроме того, всегда можно щелкнуть **Настройка** tooview состояние, включение и отключение hello профилировщика.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-119">Alternatively, you can always click **Configure** tooview status, enable, or disable hello Profiler.</span></span>

![В колонке производительности hello нажмите кнопку настроить][performance-blade]

<span data-ttu-id="b1d8d-121">Веб-приложения, для которых настроено использование Application Insights, перечислены в колонке "Настройка".</span><span class="sxs-lookup"><span data-stu-id="b1d8d-121">Web apps that are configured with Application Insights are listed on Configure blade.</span></span> <span data-ttu-id="b1d8d-122">Выполните профилировщик инструкции tooinstall hello агент при необходимости.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-122">Follow instructions tooinstall hello Profiler agent if needed.</span></span> <span data-ttu-id="b1d8d-123">Если у вас пока нет веб-приложений, для которых настроено использование Application Insights, щелкните *Add Linked Apps* (Добавить связанные приложения).</span><span class="sxs-lookup"><span data-stu-id="b1d8d-123">If no web app is configured with Application Insights yet, click *Add Linked Apps*.</span></span>

<span data-ttu-id="b1d8d-124">Используйте hello *включить профилировщик* или *отключение профилировщика* кнопки в колонке toocontrol hello Настройка hello Profiler на всех связанных веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-124">Use hello *Enable Profiler* or *Disable Profiler* buttons in hello Configure blade toocontrol hello Profiler on all your linked web apps.</span></span>



![Колонка «Настройка»][linked app services]

<span data-ttu-id="b1d8d-126">перезапуск или toostop профилировщик hello для отдельного экземпляра службы приложений, вы найдете его **в ресурс службы приложения hello**в **веб-задания**.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-126">toostop or restart hello profiler for an individual App Service instance, you'll find it **in hello App Service resource**, in **Web Jobs**.</span></span> <span data-ttu-id="b1d8d-127">toodelete его раскройте категорию **расширения**.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-127">toodelete it, look under **Extensions**.</span></span>

![Отключение профилировщика для веб-заданий][disable-profiler-webjob]

<span data-ttu-id="b1d8d-129">Корпорация Майкрософт рекомендует наличие hello профилировщик включен на всех вашей веб приложения toodiscover любой производительностью, как можно быстрее.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-129">We recommend that you have hello Profiler enabled on all your web apps toodiscover any performance issues as soon as possible.</span></span>

<span data-ttu-id="b1d8d-130">Если вы используете WebDeploy toodeploy изменения tooyour веб-приложения, убедитесь, исключить hello **App_Data** папки от удаления во время развертывания.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-130">If you use WebDeploy toodeploy changes tooyour web application, ensure that you exclude hello **App_Data** folder from being deleted during deployment.</span></span> <span data-ttu-id="b1d8d-131">В противном случае hello профилировщик расширения файлы будут удалены при следующем развертывании tooAzure приложения hello web.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-131">Otherwise, hello profiler extension's files will be deleted when you next deploy hello web application tooAzure.</span></span>

### <a name="using-profiler-with-azure-vms-and-compute-resources-preview"></a><span data-ttu-id="b1d8d-132">Использование профилировщика с виртуальными машинами и вычислительных ресурсами Azure (предварительная версия)</span><span class="sxs-lookup"><span data-stu-id="b1d8d-132">Using profiler with Azure VMs and Compute resources (preview)</span></span>

<span data-ttu-id="b1d8d-133">После [включения Application Insights для служб приложений Azure во время выполнения](app-insights-azure-web-apps.md#run-time-instrumentation-with-application-insights) профилировщик автоматически становится доступным.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-133">When you [enable Application Insights for Azure app services at run time](app-insights-azure-web-apps.md#run-time-instrumentation-with-application-insights), Profiler is automatically available.</span></span> <span data-ttu-id="b1d8d-134">(Если вы включили Application Insights для ресурса hello, необходима версия lates toohello tooupdate через hello **Настройка** мастера.)</span><span class="sxs-lookup"><span data-stu-id="b1d8d-134">(If you already enabled Application Insights for hello resource, you might need tooupdate toohello lates version through hello **Configure** wizard.)</span></span>

<span data-ttu-id="b1d8d-135">Отсутствует [предварительную версию hello профилировщика для вычисления Azure ресурсов](https://go.microsoft.com/fwlink/?linkid=848155).</span><span class="sxs-lookup"><span data-stu-id="b1d8d-135">There is a [preview version of hello Profiler for Azure Compute resources](https://go.microsoft.com/fwlink/?linkid=848155).</span></span>


## <a name="limits"></a><span data-ttu-id="b1d8d-136">Ограничения</span><span class="sxs-lookup"><span data-stu-id="b1d8d-136">Limits</span></span>

<span data-ttu-id="b1d8d-137">хранение данных по умолчанию Hello — 5 дней.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-137">hello default data retention is 5 days.</span></span> <span data-ttu-id="b1d8d-138">В день может быть принято до 10 ГБ.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-138">Maximum 10 GB ingested per day.</span></span>

<span data-ttu-id="b1d8d-139">Является бесплатной службы профилировщик hello.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-139">There is no charge for hello profiler service.</span></span> <span data-ttu-id="b1d8d-140">Веб-приложения должна быть размещена в по крайней мере hello базового уровня службы приложений.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-140">Your web app must be hosted in at least hello Basic tier of App Services.</span></span>

## <a name="viewing-profiler-data"></a><span data-ttu-id="b1d8d-141">Просмотр данных профилировщика</span><span class="sxs-lookup"><span data-stu-id="b1d8d-141">Viewing profiler data</span></span>

<span data-ttu-id="b1d8d-142">Откройте колонку производительности hello и прокрутите вниз список toohello операции.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-142">Open hello Performance blade and scroll down toohello operation list.</span></span>




![Столбец примеров в колонке "Производительность" Application Insights][performance-blade-examples]

<span data-ttu-id="b1d8d-144">содержит столбцы таблицы hello Hello.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-144">hello columns in hello table are:</span></span>

* <span data-ttu-id="b1d8d-145">**Счетчик** -Здравствуйте, количество этих запросов в диапазоне времени hello колонка hello.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-145">**Count** - hello number of these requests in hello time range of hello blade.</span></span>
* <span data-ttu-id="b1d8d-146">**Медиана** -hello типичные время приложения toorespond tooa запроса.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-146">**Median** - hello typical time your app takes toorespond tooa request.</span></span> <span data-ttu-id="b1d8d-147">Половина всех ответов была получена быстрее, чем сейчас.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-147">Half of all responses were faster than this.</span></span>
* <span data-ttu-id="b1d8d-148">**95th percentile** (95-й процентиль). 95 % ответов были получены быстрее, чем сейчас.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-148">**95th percentile** 95% of responses were faster than this.</span></span> <span data-ttu-id="b1d8d-149">Если этот рисунок сильно отличается от hello Медиана, может возникнуть временная проблема с вашим приложением.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-149">If this figure is very different from hello median, there might be an intermittent problem with your app.</span></span> <span data-ttu-id="b1d8d-150">(Или это можно объяснить с помощью такой конструктивной функции, как кэширование.)</span><span class="sxs-lookup"><span data-stu-id="b1d8d-150">(Or it might be explained by a design feature such as caching.)</span></span>
* <span data-ttu-id="b1d8d-151">**Примеры** — значок указывает этот профилировщик hello захватил трассировок стека для этой операции.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-151">**Examples** - an icon indicates that hello profiler has captured stack traces for this operation.</span></span>

<span data-ttu-id="b1d8d-152">Пункт hello примеры значок tooopen hello трассировки.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-152">Click hello Examples icon tooopen hello trace explorer.</span></span> <span data-ttu-id="b1d8d-153">Hello проводника отображается было найдено несколько примеров, которые hello профилировщика, классифицируются по времени ответа.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-153">hello explorer shows several samples that hello profiler has captured, classified by response time.</span></span>

<span data-ttu-id="b1d8d-154">Выберите образец tooshow уровне кода декомпозиция время, затраченное на запрос, выполняющийся hello.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-154">Select a sample tooshow a code-level breakdown of time spent executing hello request.</span></span>

![Обозреватель трассировки Application Insights][trace-explorer]

<span data-ttu-id="b1d8d-156">**Показать критический путь** открывает hello крупнейших конечный узел, или что-нибудь по крайней мере закрыть.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-156">**Show hot path** opens hello biggest leaf node, or at least something close.</span></span> <span data-ttu-id="b1d8d-157">В большинстве случаев этот узел будет узким местом смежные tooa производительности.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-157">In most cases this node will be adjacent tooa performance bottleneck.</span></span>



* <span data-ttu-id="b1d8d-158">**Метка**: hello имя функции hello или события.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-158">**Label**: hello name of hello function or event.</span></span> <span data-ttu-id="b1d8d-159">Hello дерева показано сочетание кода и события, имевшие место (таких как события SQL и http).</span><span class="sxs-lookup"><span data-stu-id="b1d8d-159">hello tree shows a mix of code and events that occurred (such as SQL and http events).</span></span> <span data-ttu-id="b1d8d-160">Hello top событие представляет hello общую длительность запроса.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-160">hello top event represents hello overall request duration.</span></span>
* <span data-ttu-id="b1d8d-161">**Затраченное**: hello временной интервал между hello операции hello взаимном hello.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-161">**Elapsed**: hello time interval between hello start of hello operation and hello end.</span></span>
* <span data-ttu-id="b1d8d-162">**Когда**: показано, когда событие функции hello был запущен в рамках функции tooother отношения.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-162">**When**: Shows when hello function/event was running in relation tooother functions.</span></span>

## <a name="how-tooread-performance-data"></a><span data-ttu-id="b1d8d-163">Как tooread данные о производительности</span><span class="sxs-lookup"><span data-stu-id="b1d8d-163">How tooread performance data</span></span>

<span data-ttu-id="b1d8d-164">Профилировщик службы Microsoft использует сочетание выборки метод инструментирования tooanalyze hello производительности и приложения.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-164">Microsoft service profiler uses a combination of sampling method and instrumentation tooanalyze hello performance of your application.</span></span>
<span data-ttu-id="b1d8d-165">Когда идет подробные коллекции, служба профилировщик hello указатель инструкции для каждого ЦП компьютера hello в каждую миллисекунду.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-165">When detailed collection is in progress, service profiler samples hello instruction pointer of each of hello machine's CPU in every millisecond.</span></span>
<span data-ttu-id="b1d8d-166">В каждом примере захватывает hello полный стек вызовов потока hello в настоящее время выполнения, предоставляя подробные и полезные сведения о том, что что потоком в это оба высокой и низкой уровнях абстракции.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-166">Each sample captures hello complete call stack of hello thread currently executing, giving detailed and useful information about what that thread was doing at both high and low levels of abstraction.</span></span> <span data-ttu-id="b1d8d-167">Профилировщик службы также собирает другие события, например события переключения контекста, TPL события и корреляция действия tootrack событий пула потоков и причинно-следственных связей.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-167">Service profiler also collects other events such as context switching events, TPL events, and thread-pool events tootrack activity correlation and causality.</span></span>

<span data-ttu-id="b1d8d-168">Hello стек вызовов, отображаемый в представлении временной шкалы hello является результатом hello hello выше выборки и инструментирования.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-168">hello call stack shown in hello timeline view is hello result of hello above sampling and instrumentation.</span></span> <span data-ttu-id="b1d8d-169">Поскольку в каждом примере захватывает hello полный стек вызовов потока hello, он включает код из hello .NET framework, а также другие платформы, на которую ссылается.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-169">Because each sample captures hello complete call stack of hello thread, it includes code from hello .NET framework, as well as other frameworks you reference.</span></span>

### <span data-ttu-id="b1d8d-170"><a id="jitnewobj"></a>Выделение объектов (`clr!JIT\_New or clr!JIT\_Newarr1`)</span><span class="sxs-lookup"><span data-stu-id="b1d8d-170"><a id="jitnewobj"></a>Object Allocation (`clr!JIT\_New or clr!JIT\_Newarr1`)</span></span>
<span data-ttu-id="b1d8d-171">`clr!JIT\_New and clr!JIT\_Newarr1` — это вспомогательные функции в .NET Framework, выделяющие память из управляемой кучи.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-171">`clr!JIT\_New and clr!JIT\_Newarr1` are helper functions inside .NET framework that allocates memory from managed heap.</span></span> <span data-ttu-id="b1d8d-172">`clr!JIT\_New` вызывается при выделении объекта.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-172">`clr!JIT\_New` is invoked when an object is allocated.</span></span> <span data-ttu-id="b1d8d-173">`clr!JIT\_Newarr1` вызывается при выделении массива объектов.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-173">`clr!JIT\_Newarr1` is invoked when an object array is allocated.</span></span> <span data-ttu-id="b1d8d-174">Обычно эти две функции выполняются очень быстро за относительно небольшое время.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-174">These two functions are typically very fast and should take relatively small amount of time.</span></span> <span data-ttu-id="b1d8d-175">Если вы видите `clr!JIT\_New` или `clr!JIT\_Newarr1` занять много времени на временной шкале, это означает, что кода hello может распределения много объектов и потребляет значительный объем памяти.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-175">If you see `clr!JIT\_New` or `clr!JIT\_Newarr1` take a substantial amount of time in your timeline, it's an indication that hello code may be allocating many objects and consuming significant amount of memory.</span></span>

### <span data-ttu-id="b1d8d-176"><a id="theprestub"></a>Код загрузки (`clr!ThePreStub`)</span><span class="sxs-lookup"><span data-stu-id="b1d8d-176"><a id="theprestub"></a>Loading Code (`clr!ThePreStub`)</span></span>
<span data-ttu-id="b1d8d-177">`clr!ThePreStub`— это вспомогательная функция внутри платформы .NET framework, подготавливающее tooexecute кода hello hello первый раз.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-177">`clr!ThePreStub` is a helper function inside .NET framework that prepares hello code tooexecute for hello first time.</span></span> <span data-ttu-id="b1d8d-178">Как правило, она включает в себя JIT-компиляцию (но не ограничивается ей).</span><span class="sxs-lookup"><span data-stu-id="b1d8d-178">This typically includes, but not limited to, JIT (Just In Time) compilation.</span></span> <span data-ttu-id="b1d8d-179">Для каждого метода C# `clr!ThePreStub` должны вызываться только один раз во время существования процесса hello.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-179">For each C# method, `clr!ThePreStub` should be invoked at most once during hello lifetime of a process.</span></span>

<span data-ttu-id="b1d8d-180">Если вы видите `clr!ThePreStub` занимает много времени для запроса, значит этот запрос используется Здравствуйте, первая из них выполняет этот метод, а также время hello для tooload среды выполнения .NET framework, что метод является существенным.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-180">If you see `clr!ThePreStub` takes significant amount of time for a request, it indicates that request is hello first one that executes that method, and hello time for .NET framework runtime tooload that method is significant.</span></span> <span data-ttu-id="b1d8d-181">Можно рассмотреть прогрева процесс, выполняемый фрагмент кода hello, прежде чем пользователи к нему доступ, или попробуйте запустить на ваши сборки NGen.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-181">You can consider a warm-up process that executes that portion of hello code before your users access it, or consider running NGen on your assemblies.</span></span>

### <span data-ttu-id="b1d8d-182"><a id="lockcontention"></a>Конфликт блокировки (`clr!JITutil\_MonContention` или `clr!JITutil\_MonEnterWorker`)</span><span class="sxs-lookup"><span data-stu-id="b1d8d-182"><a id="lockcontention"></a>Lock Contention (`clr!JITutil\_MonContention` or `clr!JITutil\_MonEnterWorker`)</span></span>
<span data-ttu-id="b1d8d-183">`clr!JITutil\_MonContention`или `clr!JITutil\_MonEnterWorker` указывают hello текущий поток ожидает блокировки toobe выпуска.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-183">`clr!JITutil\_MonContention` or `clr!JITutil\_MonEnterWorker` indicate hello current thread is waiting for a lock toobe released.</span></span> <span data-ttu-id="b1d8d-184">Обычно это отображается при выполнении команды lock языка C# путем вызова метода Monitor.Enter или метода с атрибутом MethodImplOptions.Synchronized.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-184">This typically shows up when executing a C# lock statement, invoking Monitor.Enter method, or invoking a method with MethodImplOptions.Synchronized attribute.</span></span> <span data-ttu-id="b1d8d-185">Конфликт блокировки обычно происходит, когда блокировку потока A и B поток пытается hello tooacquire же блокировки перед ее отпусканием потока A.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-185">Lock contention typically happens when thread A acquires a lock, and thread B tries tooacquire hello same lock before thread A releases it.</span></span>

### <span data-ttu-id="b1d8d-186"><a id="ngencold"></a>Код загрузки (`[COLD]`)</span><span class="sxs-lookup"><span data-stu-id="b1d8d-186"><a id="ngencold"></a>Loading code (`[COLD]`)</span></span>
<span data-ttu-id="b1d8d-187">Если имя метода hello содержит `[COLD]`, такие как `mscorlib.ni![COLD]System.Reflection.CustomAttribute.IsDefined`, значит среды выполнения .NET framework hello выполняет код, который не оптимизирован по <a href="https://msdn.microsoft.com/library/e7k32f4k.aspx">профильной оптимизации</a> для hello первый раз.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-187">If hello method name contains `[COLD]`, such as `mscorlib.ni![COLD]System.Reflection.CustomAttribute.IsDefined`, it means that hello .NET framework runtime is executing code that is not optimized by <a href="https://msdn.microsoft.com/library/e7k32f4k.aspx">profile-guided optimization</a> for hello first time.</span></span> <span data-ttu-id="b1d8d-188">Для каждого метода он должен отображаться более одного раза в течение времени существования hello hello процесса.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-188">For each method, it should show up at most once during hello lifetime of hello process.</span></span>

<span data-ttu-id="b1d8d-189">При загрузке кода занимает значительное количество времени для запроса, значит этот запрос используется hello первую один tooexecute hello неоптимизированном часть метода hello.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-189">If loading code takes significant amount of time for a request, it indicates that request is hello first one tooexecute hello unoptimized portion of hello method.</span></span> <span data-ttu-id="b1d8d-190">Можно рассмотреть нагревается процесс, который выполняет этот фрагмент кода hello, прежде чем пользователи к нему доступ.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-190">You can consider a warm up process that executes that portion of hello code before your users access it.</span></span>

### <span data-ttu-id="b1d8d-191"><a id="httpclientsend"></a>Отправка HTTP-запроса</span><span class="sxs-lookup"><span data-stu-id="b1d8d-191"><a id="httpclientsend"></a>Send HTTP Request</span></span>
<span data-ttu-id="b1d8d-192">Такие методы, как `HttpClient.Send` указания кода hello ожидает toocomplete запроса HTTP.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-192">Methods such as `HttpClient.Send` indicate hello code is waiting for a HTTP request toocomplete.</span></span>

### <span data-ttu-id="b1d8d-193"><a id="sqlcommand"></a>Операция с базой данных</span><span class="sxs-lookup"><span data-stu-id="b1d8d-193"><a id="sqlcommand"></a>Database Operation</span></span>
<span data-ttu-id="b1d8d-194">Метод, например SqlCommand.Execute указывает, что код hello ожидает toocomplete операции базы данных.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-194">Method such as SqlCommand.Execute indicates hello code is waiting for a database operation toocomplete.</span></span>

### <span data-ttu-id="b1d8d-195"><a id="await"></a>Ожидание (`AWAIT\_TIME`)</span><span class="sxs-lookup"><span data-stu-id="b1d8d-195"><a id="await"></a>Waiting (`AWAIT\_TIME`)</span></span>
<span data-ttu-id="b1d8d-196">`AWAIT\_TIME`Указывает, что код hello ожидает toocomplete другой задачи.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-196">`AWAIT\_TIME` indicates hello code is waiting for another task toocomplete.</span></span> <span data-ttu-id="b1d8d-197">Обычно это осуществляется с помощью команды await языка C#.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-197">This typically happens with C# 'await' statement.</span></span> <span data-ttu-id="b1d8d-198">При делает hello код на языке C# «await», hello поток освобождает управления toohello потоков и возвращает нет потока, который ожидает toofinish «await» hello.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-198">When hello code does a C# 'await', hello thread unwinds and returns control toohello thread-pool, and there is no thread that is blocked waiting for hello 'await' toofinish.</span></span> <span data-ttu-id="b1d8d-199">Однако логически hello потока, что было hello await «заблокировано» ожидание toocomplete операции hello.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-199">However, logically hello thread that did hello await is 'blocked' waiting for hello operation toocomplete.</span></span> <span data-ttu-id="b1d8d-200">`AWAIT\_TIME` Указывает, заблокирован hello времени ожидания toocomplete задача hello.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-200">The `AWAIT\_TIME` indicates hello blocked time waiting for hello task toocomplete.</span></span>

### <span data-ttu-id="b1d8d-201"><a id="block"></a>Время блокировки</span><span class="sxs-lookup"><span data-stu-id="b1d8d-201"><a id="block"></a>Blocked Time</span></span>
<span data-ttu-id="b1d8d-202">`BLOCKED_TIME`Указывает, что другой toobe ресурсов, доступных, например, ожидает объекта синхронизации, Ожидание toobe потока, доступного и ожидает toofinish запрос ожидает кода hello.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-202">`BLOCKED_TIME` indicates hello code is waiting for another resource toobe available, such as waiting for a synchronization object, waiting for a thread toobe available, or waiting for a request toofinish.</span></span>

### <span data-ttu-id="b1d8d-203"><a id="cpu"></a>Время ЦП</span><span class="sxs-lookup"><span data-stu-id="b1d8d-203"><a id="cpu"></a>CPU Time</span></span>
<span data-ttu-id="b1d8d-204">Hello ЦП занят выполнением инструкций hello.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-204">hello CPU is busy executing hello instructions.</span></span>

### <span data-ttu-id="b1d8d-205"><a id="disk"></a>Время работы диска</span><span class="sxs-lookup"><span data-stu-id="b1d8d-205"><a id="disk"></a>Disk Time</span></span>
<span data-ttu-id="b1d8d-206">приложение Hello выполняет дисковые операции.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-206">hello application is performing disk operations.</span></span>

### <span data-ttu-id="b1d8d-207"><a id="network"></a>Сетевое время</span><span class="sxs-lookup"><span data-stu-id="b1d8d-207"><a id="network"></a>Network Time</span></span>
<span data-ttu-id="b1d8d-208">приложение Hello выполнение сетевых операций.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-208">hello application is performing network operations.</span></span>

### <span data-ttu-id="b1d8d-209"><a id="when"></a>Столбец "Время"</span><span class="sxs-lookup"><span data-stu-id="b1d8d-209"><a id="when"></a>When column</span></span>
<span data-ttu-id="b1d8d-210">Это визуализацию как со временем меняться hello ИНКЛЮЗИВНЫЕ выборки, собранные для узла.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-210">This is a visualization of how hello INCLUSIVE samples collected for a node vary over time.</span></span> <span data-ttu-id="b1d8d-211">полный диапазон Hello hello запрос состоит из 32 сегментами времени и hello инклюзивными выборками для этого узла будут накапливаться в этих 32 сегментами.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-211">hello total range of hello request is divided into 32 time buckets and hello inclusive samples for that node are accumulated into those 32 buckets.</span></span> <span data-ttu-id="b1d8d-212">Затем каждый период представляется в виде полосы, высота которой обозначает масштабированное значение.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-212">Each bucket is then represented as a bar whose height represents a scaled value.</span></span> <span data-ttu-id="b1d8d-213">Для узлу, помеченному `CPU_TIME` или `BLOCKED_TIME`, или там, где есть очевидным отношения о потреблении ресурсов (ЦП, диска, поток), hello строке представляет использует один из этих ресурсов в течение периода hello времени этого сегмента.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-213">For nodes marked `CPU_TIME` or `BLOCKED_TIME`, or where there is an obvious relationship of consuming a resource (cpu, disk, thread), hello bar represents consuming one of those resources for hello period of time of that bucket.</span></span> <span data-ttu-id="b1d8d-214">Для этих метрик можно получить показатель, превышающий 100 %, за счет потребления нескольких ресурсов.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-214">For these metrics you can get greater than 100% by consuming multiple resources.</span></span> <span data-ttu-id="b1d8d-215">Например, если в среднем за определенный интервал времени используется два процессора, показатель достигнет 200 %.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-215">For example, if on average you use two CPUs over an interval then you get 200%.</span></span>


## <span data-ttu-id="b1d8d-216"><a id="troubleshooting"></a>Устранение неполадок</span><span class="sxs-lookup"><span data-stu-id="b1d8d-216"><a id="troubleshooting"></a>Troubleshooting</span></span>

### <a name="how-can-i-know-whether-application-insights-profiler-is-running"></a><span data-ttu-id="b1d8d-217">Как узнать, работает ли профилировщик Application Insights?</span><span class="sxs-lookup"><span data-stu-id="b1d8d-217">How can I know whether Application Insights profiler is running?</span></span>

<span data-ttu-id="b1d8d-218">Профилировщик Hello выполняется как непрерывные веб-задание в веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-218">hello profiler runs as a continuous web job in Web App.</span></span> <span data-ttu-id="b1d8d-219">Можно открыть ресурс веб-приложения hello в https://portal.azure.com и проверьте состояние «ApplicationInsightsProfiler» в колонке hello веб-заданий.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-219">You can open hello Web App resource in https://portal.azure.com and check "ApplicationInsightsProfiler" status in hello WebJobs blade.</span></span> <span data-ttu-id="b1d8d-220">Если она не запущена, откройте **журналы** toofind дополнительных сведений.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-220">If it isn't running, open **Logs** toofind out more.</span></span>

### <a name="why-cant-i-find-any-stack-examples-even-though-hello-profiler-is-running"></a><span data-ttu-id="b1d8d-221">Почему не удается найти все примеры стека даже при выполнении профилировщик hello?</span><span class="sxs-lookup"><span data-stu-id="b1d8d-221">Why can't I find any stack examples even though hello profiler is running?</span></span>

<span data-ttu-id="b1d8d-222">Вот несколько моментов, которые можно проверить.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-222">Here are a few things you can check.</span></span>

1. <span data-ttu-id="b1d8d-223">Убедитесь, что вы используете план службы веб-приложений уровня "Базовый" и выше.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-223">Make sure your Web App Service Plan is Basic tier and above.</span></span>
2. <span data-ttu-id="b1d8d-224">Проверьте, содержит ли веб-приложение пакет SDK Application Insights бета-версии 2.2 и более поздней.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-224">Make sure your Web App has Application Insights SDK 2.2 Beta and above enabled.</span></span>
3. <span data-ttu-id="b1d8d-225">Убедитесь, что веб-приложение имеет APPINSIGHTS_INSTRUMENTATIONKEY приветствия с hello использовать же ключ инструментирования, пакет SDK Application Insights.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-225">Make sure your Web App has hello APPINSIGHTS_INSTRUMENTATIONKEY setting with hello same instrumentation key used by Application Insights SDK.</span></span>
4. <span data-ttu-id="b1d8d-226">Проверьте, работает ли веб-приложение на платформе .Net Framework 4.6.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-226">Make sure your Web App is running on .Net Framework 4.6.</span></span>
5. <span data-ttu-id="b1d8d-227">Если приложения ASP.NET Core, также проверьте [hello необходимым требованиям](#aspnetcore).</span><span class="sxs-lookup"><span data-stu-id="b1d8d-227">If it's an ASP.NET Core application, please also check [hello required dependencies](#aspnetcore).</span></span>

<span data-ttu-id="b1d8d-228">После запуска профилировщика hello нет периода прогрева короткий при профилировщик hello активно собирает несколько трассировки производительности.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-228">After hello profiler is started, there is a short warm-up period when hello profiler actively collects several performance traces.</span></span> <span data-ttu-id="b1d8d-229">После этого hello Профилировщик собирает трассировки производительности для двух минут в каждый час.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-229">After that, hello profiler collects performance traces for two minutes in every hour.</span></span>  

### <a name="i-was-using-azure-service-profiler-what-happened-tooit"></a><span data-ttu-id="b1d8d-230">Я включил профилировщик службы Azure.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-230">I was using Azure Service Profiler.</span></span> <span data-ttu-id="b1d8d-231">Какая ошибка tooit?</span><span class="sxs-lookup"><span data-stu-id="b1d8d-231">What happened tooit?</span></span>  

<span data-ttu-id="b1d8d-232">При включении профилировщика Application Insights агент профилировщика службы Azure отключается.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-232">When you enable Application Insights Profiler, Azure Service Profiler agent is disabled.</span></span>

### <span data-ttu-id="b1d8d-233"><a id="double-counting"></a>Двойной подсчет в параллельных потоках</span><span class="sxs-lookup"><span data-stu-id="b1d8d-233"><a id="double-counting"></a>Double counting in parallel threads</span></span>

<span data-ttu-id="b1d8d-234">В некоторых случаях hello метрика общее время в средстве просмотра стека hello больше hello Фактическая длительность запроса hello.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-234">In some cases hello total time metric in hello stack viewer is more than hello actual duration of hello request.</span></span>

<span data-ttu-id="b1d8d-235">Это может произойти при наличии нескольких потоков, связанных с запросом и работающих в параллельном режиме.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-235">This can happen when there are two or more threads associated with a request, operating in parallel.</span></span> <span data-ttu-id="b1d8d-236">Hello поток общее время превышает затем hello затраченного времени.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-236">hello total thread time is then more than hello elapsed time.</span></span> <span data-ttu-id="b1d8d-237">Во многих случаях один поток может ожидает hello других toocomplete.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-237">In many cases one thread may be waiting on hello other toocomplete.</span></span> <span data-ttu-id="b1d8d-238">Это Hello toodetect попытки просмотра и исключить ненужные ожидания hello, но errs со стороны hello отображение слишком большого объема вместо пропуск, что может быть критически важной информации.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-238">hello viewer tries toodetect this and omit hello uninteresting wait, but errs on hello side of showing too much rather than omitting what may be critical information.</span></span>  

<span data-ttu-id="b1d8d-239">При появлении параллельных потоков в ваши трассировки необходимо toodetermine которой потоки ожидают, поэтому можно определить hello критический путь для запроса hello.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-239">When you see parallel threads in your traces, you need toodetermine which threads are waiting so you can determine hello critical path for hello request.</span></span> <span data-ttu-id="b1d8d-240">В большинстве случаев поток hello, быстро переход в состояние ожидания просто ожидающий hello других потоков.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-240">In most cases, hello thread that quickly goes into a wait state is simply waiting on hello other threads.</span></span> <span data-ttu-id="b1d8d-241">Сосредоточиться на других hello и игнорировать время hello в hello ожидающих потоков.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-241">Concentrate on hello others and ignore hello time in hello waiting threads.</span></span>

### <span data-ttu-id="b1d8d-242"><a id="issue-loading-trace-in-viewer"></a>Нет данных профилирования</span><span class="sxs-lookup"><span data-stu-id="b1d8d-242"><a id="issue-loading-trace-in-viewer"></a>No profiling data</span></span>

1. <span data-ttu-id="b1d8d-243">При данных hello tooview старее, чем на пару недель, попробуйте ограничить время фильтра и повторите попытку.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-243">If hello data you are trying tooview is older than a couple of weeks, try limiting your time filter and try again.</span></span>

2. <span data-ttu-id="b1d8d-244">Проверьте, что прокси-серверы или межсетевой экран не заблокирован toohttps://gateway.azureserviceprofiler.net доступа.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-244">Check that proxies or a firewall have not blocked access toohttps://gateway.azureserviceprofiler.net.</span></span>

3. <span data-ttu-id="b1d8d-245">Убедитесь, что hello Application Insights, ключ инструментирования, используемого в приложении является hello же, как hello ресурс Application Insights, которое было включено профилирование с.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-245">Check that hello Application Insights instrumentation key you are using in your app is hello same as hello Application Insights resource you've enabled profiling with.</span></span> <span data-ttu-id="b1d8d-246">ключ Hello обычно находится в ApplicationInsights.config, но также можно найти в файле web.config или app.config.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-246">hello key is usually in ApplicationInsights.config but can also be found in web.config or app.config.</span></span>

### <a name="error-report-in-hello-profiling-viewer"></a><span data-ttu-id="b1d8d-247">Отчет об ошибках в средство просмотра профилирования hello</span><span class="sxs-lookup"><span data-stu-id="b1d8d-247">Error report in hello profiling viewer</span></span>

<span data-ttu-id="b1d8d-248">Файл запрос в службу поддержки с портала hello.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-248">File a support ticket from hello portal.</span></span> <span data-ttu-id="b1d8d-249">Пожалуйста, включите hello идентификатора корреляции из сообщение hello.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-249">Please include hello correlation ID from hello error message.</span></span>

## <a name="manual-installation"></a><span data-ttu-id="b1d8d-250">Ручная установка</span><span class="sxs-lookup"><span data-stu-id="b1d8d-250">Manual installation</span></span>

<span data-ttu-id="b1d8d-251">При настройке профилировщик hello hello следующие обновления выполняются параметры toohello веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-251">When you configure hello profiler, hello following updates are made toohello Web App's settings.</span></span> <span data-ttu-id="b1d8d-252">Если требуется, их можно внести вручную, например, если приложение выполняется в среде службы приложений Azure (ASE):</span><span class="sxs-lookup"><span data-stu-id="b1d8d-252">You can do them yourself manually if your environment requires, for example, if your application runs in Azure App Service Environment (ASE):</span></span>

1. <span data-ttu-id="b1d8d-253">В колонке управления приложения hello web откройте параметры.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-253">In hello web app control blade, open Settings.</span></span>
2. <span data-ttu-id="b1d8d-254">Значение «.net Framework версии» toov4.6.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-254">Set ".Net Framework version" toov4.6.</span></span>
3. <span data-ttu-id="b1d8d-255">Задать tooOn «Always On».</span><span class="sxs-lookup"><span data-stu-id="b1d8d-255">Set "Always On" tooOn.</span></span>
4. <span data-ttu-id="b1d8d-256">Добавить параметр приложения «__APPINSIGHTS_INSTRUMENTATIONKEY__» и набор hello значение toohello же ключ инструментирования используемые hello SDK.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-256">Add app setting "__APPINSIGHTS_INSTRUMENTATIONKEY__" and set hello value toohello same instrumentation key used by hello SDK.</span></span>
5. <span data-ttu-id="b1d8d-257">Откройте дополнительные инструменты.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-257">Open Advanced Tools.</span></span>
6. <span data-ttu-id="b1d8d-258">Нажмите кнопку «Go» tooopen hello Kudu веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-258">Click "Go" tooopen hello Kudu website.</span></span>
7. <span data-ttu-id="b1d8d-259">Веб-сайте Kudu hello выберите «Расширения сайта».</span><span class="sxs-lookup"><span data-stu-id="b1d8d-259">In hello Kudu website, select "Site extensions".</span></span>
8. <span data-ttu-id="b1d8d-260">__Установите Application Insights__ из коллекции.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-260">Install "__Application Insights__" from Gallery.</span></span>
9. <span data-ttu-id="b1d8d-261">Перезапустите веб-приложение hello.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-261">Restart hello web app.</span></span>

## <span data-ttu-id="b1d8d-262"><a id="aspnetcore"></a>Поддержка ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="b1d8d-262"><a id="aspnetcore"></a>ASP.NET Core Support</span></span>

<span data-ttu-id="b1d8d-263">Приложению tooinstall 2.1.0-beta6 пакета Microsoft.ApplicationInsights.AspNetCore Nuget или выше toowork с hello профилировщика ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-263">ASP.NET Core application needs tooinstall Microsoft.ApplicationInsights.AspNetCore Nuget package 2.1.0-beta6 or higher toowork with hello Profiler.</span></span> <span data-ttu-id="b1d8d-264">Мы больше не поддерживают более ранние версии hello после 6/27/2017 г.</span><span class="sxs-lookup"><span data-stu-id="b1d8d-264">We no longer support hello lower versions after 6/27/2017.</span></span>

## <a name="next-steps"></a><span data-ttu-id="b1d8d-265">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="b1d8d-265">Next steps</span></span>

* [<span data-ttu-id="b1d8d-266">Работа с Azure Application Insights в Visual Studio</span><span class="sxs-lookup"><span data-stu-id="b1d8d-266">Working with Application Insights in Visual Studio</span></span>](https://docs.microsoft.com/azure/application-insights/app-insights-visual-studio)

[performance-blade]: ./media/app-insights-profiler/performance-blade.png
[performance-blade-examples]: ./media/app-insights-profiler/performance-blade-examples.png
[trace-explorer]: ./media/app-insights-profiler/trace-explorer.png
[trace-explorer-toolbar]: ./media/app-insights-profiler/trace-explorer-toolbar.png
[trace-explorer-hint-tip]: ./media/app-insights-profiler/trace-explorer-hint-tip.png
[trace-explorer-hot-path]: ./media/app-insights-profiler/trace-explorer-hot-path.png
[enable-profiler-banner]: ./media/app-insights-profiler/enable-profiler-banner.png
[disable-profiler-webjob]: ./media/app-insights-profiler/disable-profiler-webjob.png
[linked app services]: ./media/app-insights-profiler/linked-app-services.png
