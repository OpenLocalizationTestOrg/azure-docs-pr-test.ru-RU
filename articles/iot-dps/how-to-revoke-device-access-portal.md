---
title: "Управление доступом устройств к службе подготовки устройств Центра Интернета вещей Azure | Документация Майкрософт"
description: "Процедура отмены доступа устройств к службе подготовки устройств на портале Azure"
services: iot-dps
keywords: 
author: JimacoMS
ms.author: v-jamebr
ms.date: 12/22/2017
ms.topic: article
ms.service: iot-dps
documentationcenter: 
manager: timlt
ms.devlang: na
ms.custom: mvc
ms.openlocfilehash: 6f1dad648b228163219c8f722eed3897f4ba4d22
ms.sourcegitcommit: 48fce90a4ec357d2fb89183141610789003993d2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/12/2018
---
# <a name="how-to-revoke-device-access-to-your-provisioning-service-in-the-azure-portal"></a>Процедура отмены доступа устройств к службе подготовки на портале Azure

Правильное управление учетными данными устройства крайне важно для таких крупных систем, как решения Интернета вещей. Для таких систем мы рекомендуем иметь четкий план отмены доступа к устройствам в ситуациях, связанных с компрометацией их учетных данных, например маркера SAS или сертификата X.509. В этой статье описывается процедура отмены доступа к устройству на этапе подготовки.

Сведения о том, как отменить доступ устройства к Центру Интернета вещей после подготовки устройства, см. в разделе [Отключение устройств](https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-identity-registry#disable-devices).

> [!NOTE] 
> Не забывайте учесть политики повтора, применяемые к устройствам, для которых вы отменяете доступ. Например, если для устройства применяется политика бесконечных повторов, оно будет постоянно выполнять попытки зарегистрироваться в службе подготовки. Из-за этого оно бесполезно потребляет ресурсы службы и даже может снизить производительность.

## <a name="blacklist-devices-with-an-individual-enrollment-entry"></a>Черный список устройств при использовании записей индивидуальной регистрации

Индивидуальные регистрации относятся к конкретным устройствам и могут использовать в качестве механизмов аттестации сертификаты X.509 или токены SAS (в реальном или виртуальном доверенном платформенном модуле). Устройства, использующие токены SAS в качестве механизма аттестации, можно подготовить только через индивидуальные регистрации. Чтобы внести в черный список устройство, для которого существует индивидуальная регистрация, следует отключить или удалить эту запись регистрации. 

- Чтобы временно отключить устройство, достаточно отключить его запись регистрации. 

    1. Войдите на портал Azure и выберите **Все ресурсы** в меню слева.
    2. Выберите из списка ресурсов службу подготовки, от которой нужно отключить устройство.
    3. В службе подготовки выберите **Manage enrollments** (Управление регистрациями), а затем — вкладку **Individual Enrollments** (Отдельные регистрации).
    4. Щелкните запись регистрации устройства, которое вы хотите внести в черный список, чтобы открыть его. 
    5. Щелкните **Отключить** в нижней части данных о записи регистрации, затем нажмите кнопку **Сохранить**.  

        ![Отключение записи индивидуальной регистрации на портале](./media/how-to-revoke-device-access-portal/disable-individual-enrollment.png)
    
- Чтобы навсегда отключить устройство, вы можете удалить его запись регистрации.

    1. Войдите на портал Azure и выберите **Все ресурсы** в меню слева.
    2. Выберите из списка ресурсов службу подготовки, от которой нужно отключить устройство.
    3. В службе подготовки выберите **Manage enrollments** (Управление регистрациями), а затем — вкладку **Individual Enrollments** (Отдельные регистрации).
    4. Установите флажок рядом с записью регистрации устройства, которое вы хотите заблокировать. 
    5. Нажмите кнопку **Удалить** в верхней части окна, затем подтвердите удаление регистрации, выбрав ответ **Да**. 

        ![Удаление записи индивидуальной регистрации на портале](./media/how-to-revoke-device-access-portal/delete-individual-enrollment.png)
    
    6. Когда это действие завершится, запись исчезнет из списка индивидуальных регистраций.  

## <a name="blacklist-an-x509-intermediate-or-root-ca-certificate-using-an-enrollment-group"></a>Внесение в черный список сертификата X.509 промежуточного или корневого ЦС с использованием группы регистраций

Сертификаты X.509 обычно организованы в цепочки доверия. При компрометации любого из сертификатов, входящих в такую цепочку, отношения доверия разрываются. Скомпрометированный сертификат необходимо поместить в черный список, чтобы предотвратить подготовку в службе подготовки любых устройств, использующих цепочки доверия с этим сертификатом. Дополнительные сведения о сертификатах X.509 и их применении в службе подготовки вы найдете в статье [о сертификатах X.509](./concepts-security.md#x509-certificates). 

Группа регистраций представляет собой групповую запись для устройств с общим механизмом аттестации сертификатов X.509, подписанных одним и тем же промежуточным или корневым ЦС. Запись группы регистрации настраивается с помощью сертификата X.509, связанного с промежуточным или корневым ЦС. Она может иметь любые параметры конфигурации, например состояния двойника и подключения к Центру Интернета вещей, которые применяются для всех устройств, в цепочке сертификатов которых есть указанный в записи сертификат. Чтобы внести такой сертификат в черный список, вы можете отключить или удалить соответствующую группу регистраций.

- Чтобы временно отключить сертификат, достаточно отключить его группу регистраций. 

    1. Войдите на портал Azure и выберите **Все ресурсы** в меню слева.
    2. Выберите из списка ресурсов службу подготовки, от которой нужно отключить сертификат для подписи.
    3. В службе подготовки выберите **Manage enrollments** (Управление регистрациями), а затем — вкладку **Enrollment Groups** (Группы регистраций).
    4. Щелкните группу регистраций, которую вы хотите внести в черный список, чтобы открыть ее.
    5. Нажмите кнопку **Изменить группу** в левом верхнем углу на странице группы регистраций.
    6. Чтобы отключить запись регистрации, выберите положение **Отключить** на переключателе **Включить запись**, а затем нажмите кнопку **Сохранить**.  

        ![Отключение записи группы регистраций на портале](./media/how-to-revoke-device-access-portal/disable-enrollment-group.png)

    
- Чтобы навсегда отключить сертификат, вы можете удалить его группу регистраций.

    1. Войдите на портал Azure и выберите **Все ресурсы** в меню слева.
    2. Выберите из списка ресурсов службу подготовки, от которой нужно отключить устройство.
    3. В службе подготовки выберите **Manage enrollments** (Управление регистрациями), а затем — вкладку **Enrollment Groups** (Группы регистраций).
    4. Установите флажок рядом с группой регистраций, которую вы хотите внести в черный список. 
    5. Нажмите кнопку **Удалить** в верхней части окна, затем подтвердите удаление группы регистраций, выбрав ответ **Да**. 

        ![Удаление записи группы регистраций на портале](./media/how-to-revoke-device-access-portal/delete-enrollment-group.png)

    6. После завершения действия запись будет удалена из списка групп регистраций.  

> [!NOTE]
> Удаление группы регистраций для сертификата не помешает устройствам с этим сертификатом подключаться к службе, если существует другая, активная группа регистраций для корневого или промежуточного сертификата, расположенного выше в цепочке сертификатов устройств.

## <a name="blacklist-specific-devices-in-an-enrollment-group"></a>Отключение конкретных устройств, входящих в группу регистраций

Устройства, которые используют механизм аттестации X.509, выполняют аутентификацию на основе цепочки сертификатов устройства и закрытого ключа. Когда устройство выполняет подключение и аутентификацию в службе подготовки устройств, эта служба проверяет возможность подключения устройства: сначала проверяются индивидуальные регистрации для учетных данных устройства, и только затем группы регистраций. Если служба обнаружит отключенную индивидуальную регистрацию устройства, такое устройство не сможет подключиться, даже если существует группа регистраций для промежуточного или корневого ЦС, входящего в цепочку сертификатов этого устройства. Чтобы включить в черный список индивидуальное устройство из группы регистраций, выполните следующие действия.

1. Войдите на портал Azure и выберите **Все ресурсы** в меню слева.
2. В списке ресурсов щелкните службу подготовки, которая содержит группу регистраций для отключаемого устройства.
3. В службе подготовки выберите **Manage enrollments** (Управление регистрациями), а затем — вкладку **Individual Enrollments** (Отдельные регистрации).
4. Нажмите кнопку **Добавить** вверху. 
5. Выберите **X.509** в качестве механизма безопасности для устройства, а затем отправьте сертификат устройства. Это подписанный сертификат конечных субъектов, который устанавливается на устройстве и применяется для создания сертификатов аутентификации.
6. Щелкните **идентификатор устройства Центра Интернета вещей** для нужного устройства. 
7. Чтобы отключить запись регистрации, выберите положение **Отключить** на переключателе **Включить запись**. 
8. Выберите команду **Сохранить**. После успешного создания регистрации новое устройство появится на вкладке **Индивидуальные регистрации**. 

    ![Отключение записи индивидуальной регистрации на портале](./media/how-to-revoke-device-access-portal/disable-individual-enrollment.png)




