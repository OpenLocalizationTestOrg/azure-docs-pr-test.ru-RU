---
title: "Подготовка устройства с помощью службы подготовки устройств для Центра Интернета вещей Azure | Документация Майкрософт"
description: "Подготовка устройства в одном Центре Интернета вещей с помощью службы подготовки устройств для Центра Интернета вещей Azure"
services: iot-dps
keywords: 
author: dsk-2015
ms.author: dkshir
ms.date: 09/05/2017
ms.topic: tutorial
ms.service: iot-dps
documentationcenter: 
manager: timlt
ms.devlang: na
ms.custom: mvc
ms.openlocfilehash: bf50699d2dc67294d554ba15713254a8b88d8ade
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="provision-the-device-to-an-iot-hub-using-the-azure-iot-hub-device-provisioning-service"></a>Подготовка устройства в Центре Интернета вещей с помощью службы подготовки устройств для Центра Интернета вещей Azure

В предыдущем руководстве вы узнали, как настраивать устройство для подключения к службе подготовки устройств. В этом руководстве описывается, как использовать эту службу для подготовки устройства в одном Центре Интернета вещей с помощью **_списков регистрации_**. В этом учебнике описаны следующие процедуры.

> [!div class="checklist"]
> * Регистрация устройства
> * запуск устройства;
> * проверка регистрации устройства.

## <a name="prerequisites"></a>Предварительные требования

Прежде чем продолжить, настройте устройство и его *аппаратный модуль безопасности*, как описано в руководстве [Set up a device to provision using the Azure IoT Hub Device Provisioning Service](./tutorial-set-up-device.md) (Настройка устройства для подготовки с помощью службы подготовки устройств для Центра Интернета вещей Azure).


<a id="enrolldevice"></a>
## <a name="enroll-the-device"></a>Регистрация устройства

Этот шаг подразумевает добавление уникальных артефактов безопасности устройства в службу подготовки устройств. Эти артефакты безопасности выглядят так:

- Для устройств на основе доверенного платформенного модуля (TPM):
    - *Ключ подтверждения*, который уникален для каждой микросхемы или имитации доверенного платформенного модуля. Дополнительные сведения см. в статье [Общие сведения о ключе подтверждения доверенного платформенного модуля](https://technet.microsoft.com/library/cc770443.aspx).
    - *Registration ID* (ИД регистрации), который позволяет уникально идентифицировать устройство в пространстве имен и (или) области. Он может как совпадать, так и не совпадать с идентификатором устройства. Идентификатор — обязателен для каждого устройства. Для устройств на основе доверенного платформенного модуля идентификатор регистрации может быть производным от самого TPM, например хэш SHA-256 ключа подтверждения доверенного платформенного модуля.

    ![Сведения о регистрации для доверенного платформенного модуля на портале](./media/tutorial-provision-device-to-hub/tpm-device-enrollment.png)

- Для устройств на основе X.509:
    - [Сертификат выдается микросхеме или имитации X.509](https://msdn.microsoft.com/library/windows/desktop/bb540819.aspx) в файле формата *PERM* или *CER*. Для отдельной регистрации необходимо использовать *сертификат подписчика* для системы X.509, а для групп регистраций — *корневой сертификат*.

    ![Сведения о регистрации для X.509 на портале](./media/tutorial-provision-device-to-hub/x509-device-enrollment.png)


Имеется два способа регистрации устройства в службе подготовки устройств:

- **Enrollment Groups** (Группы регистраций). Представляет группу устройств, использующих определенный механизм аттестации. Мы советуем использовать группу регистраций для большого количества устройств, имеющих необходимую начальную конфигурацию, или для устройств, предназначенных для одного и того же клиента.

    ![Группы регистраций для X.509 на портале](./media/tutorial-provision-device-to-hub/x509-enrollment-groups.png)

- **Individual Enrollments** (Отдельные регистрации). Представляет собой запись для одного устройства, которое можно зарегистрировать с помощью службы подготовки устройств. Отдельные регистрации могут использовать сертификаты X.509 или маркеры SAS (в реальном или виртуальном доверенном платформенном модуле) в качестве механизма аттестации. Мы советуем использовать отдельные регистрации для устройств, которым требуются уникальные начальные конфигурации, или для устройств, которые могут использовать только маркеры SAS через TPM или виртуальный TPM в качестве механизма аттестации. Для отдельных регистраций можно указать нужный идентификатор устройства Центра Интернета вещей.

Ниже приведены действия по регистрации устройства на портале:

1. Обратите внимание на артефакты безопасности для HSM на устройстве. В среде разработки может потребоваться использовать API, упомянутые в разделе [Extract the security artifacts](./tutorial-set-up-device.md#extractsecurity) (Извлечение артефактов безопасности) предыдущего руководства.

1. Войдите на портал Azure, нажмите кнопку **Все ресурсы** в левом меню и откройте службу подготовки устройств.

1. В колонке сводки службы подготовки устройств выберите **Manage enrollments** (Управление регистрациями). Выберите вкладку **Individual Enrollments** (Отдельные регистрации) или **Enrollment Groups** (Группы регистраций) согласно настройке устройства. Нажмите кнопку **Добавить** вверху. Выберите **TPM** или **X.509** в качестве *механизма* аттестации удостоверения и введите соответствующий артефакт безопасности, как описано выше. Теперь можно ввести новый идентификатор устройства **IoT Hub device ID** (ИД устройства Центра Интернета вещей). После завершения нажмите кнопку **Сохранить**. 

1. При успешной регистрации устройства вы увидите на портале следующее:

    ![Успешная регистрация доверенного платформенного модуля (TPM) на портале](./media/tutorial-provision-device-to-hub/tpm-enrollment-success.png)


## <a name="start-the-device"></a>Запуск устройства

На этом этапе для регистрации устройства готова следующая настройка:

1. Устройство или группа устройств регистрируется в службе подготовки устройств. 
2. Устройство готово: микросхема HSM настроена и доступна через приложение, которое использует клиентский пакет SDK службы подготовки устройств.

Запустите устройство, чтобы разрешить клиентскому приложению начать регистрацию в службе подготовки устройств.  


## <a name="verify-the-device-is-registered"></a>Проверка регистрации устройства

После загрузки устройства необходимо выполнить следующие действия. Дополнительные сведения о примере приложения имитации доверенного платформенного модуля (TPM) см. на странице [dps_client_sample](https://github.com/Azure/azure-iot-device-auth/blob/master/dps_client/samples/dps_client_sample/dps_client_sample.c). 

1. Устройство отправляет запрос на регистрацию в службу подготовки устройств.
2. Устройствам с доверенным платформенным модулем служба подготовки устройств отправляет обратный запрос регистрации, на который отвечает устройство. 
3. При успешной регистрации служба подготовки устройств отправляет обратно к устройству универсальный код ресурса (URI) Центра Интернета вещей, идентификатор устройства и зашифрованный ключ. 
4. Затем клиентское приложение Центра Интернета вещей на устройстве подключается к центру. 
5. При успешном подключении к центру устройство отобразится в средстве **Device Explorer** Центра Интернета вещей. 

    ![Успешное подключение к центру на портале](./media/tutorial-provision-device-to-hub/hub-connect-success.png)

## <a name="next-steps"></a>Дальнейшие действия
Из этого руководства вы узнали, как выполнять такие задачи:

> [!div class="checklist"]
> * Регистрация устройства
> * запуск устройства;
> * проверка регистрации устройства.

Перейдите к следующему руководству, чтобы узнать, как подготовить несколько устройств через концентраторы с балансировкой нагрузки. 

> [!div class="nextstepaction"]
> [Подготовка устройств в Центрах Интернета вещей с балансировкой нагрузки](./tutorial-provision-multiple-hubs.md)
