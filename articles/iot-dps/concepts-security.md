---
title: "Понятия безопасности в службе подготовки устройств для Центра Интернета вещей Azure | Документация Майкрософт"
description: "В этой статье описываются понятия безопасности подготовки устройств при использовании службы подготовки устройств и Центра Интернета вещей."
services: iot-dps
keywords: 
author: nberdy
ms.author: nberdy
ms.date: 09/05/2017
ms.topic: article
ms.service: iot-dps
documentationcenter: 
manager: timlt
ms.devlang: na
ms.custom: mvc
ms.openlocfilehash: ab2bfff571af659552eef8117de041ca6367ce56
ms.sourcegitcommit: 48fce90a4ec357d2fb89183141610789003993d2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/12/2018
---
# <a name="iot-hub-device-provisioning-service-security-concepts"></a>Понятия безопасности службы подготовки устройств для Центра Интернета вещей 

Служба подготовки устройств для Центра Интернета вещей — это вспомогательная служба, позволяющая настроить полностью автоматическую подготовку устройства в указанном Центре Интернета вещей. Она дает возможность подготавливать миллионы устройств с высоким уровнем безопасности и масштабируемости. В этой статье приводятся общие сведения о понятиях *безопасности*, связанных с подготовкой устройства. Сведения в этой статье касаются пользователей, участвующих в подготовке устройства для развертывания.

## <a name="attestation-mechanism"></a>Механизм аттестации

Механизм аттестации — это способ подтверждения удостоверения устройства. Он также имеет отношение к списку регистрации, указывающему службе подготовки, какой метод аттестации следует использовать с данным устройством.

> [!NOTE]
> Для применения аналогичной концепции Центр Интернета вещей использует схему проверки подлинности.

Служба подготовки устройств поддерживает две формы аттестации:
* **Сертификаты X.509** на основе стандартного потока проверки подлинности сертификата X.509.
* **Токены SAS** на основе запроса nonce с использованием стандарта доверенного платформенного модуля ключей. На устройстве не должен присутствовать физический доверенный платформенный модуль (TPM), но для каждой [спецификации TPM](https://trustedcomputinggroup.org/work-groups/trusted-platform-module/) требуется подтверждение с помощью ключа подтверждения.

## <a name="hardware-security-module"></a>Аппаратный модуль безопасности

Аппаратный модуль безопасности (HSM) используется для безопасного аппаратного хранения секретов устройств. Это самая безопасная форма хранилища секретов. В HSM могут храниться как сертификаты X.509, так и токены SAS. HSM можно использовать с обоими механизмами аттестации, которые поддерживает процесс подготовки.

> [!TIP]
> Мы настоятельно рекомендуем использовать HSM для безопасного хранения секретов на устройствах.

Секреты устройств также можно хранить в программном обеспечении (памяти). Но, по сравнению с HSM, это менее безопасный способ хранения.

## <a name="trusted-platform-module-tpm"></a>Доверенный платформенный модуль (TPM)

TPM может ссылаться на стандарт безопасного хранения ключей, используемых для проверки подлинности платформы, или относиться к интерфейсу ввода-вывода, используемого для взаимодействия с модулями реализации стандарта. Модули TPM могут существовать как дискретные аппаратные средства, интегрированные аппаратные средства, микропрограммные или программные средства. Узнайте больше об [аттестации доверенного платформенного модуля](/windows-server/identity/ad-ds/manage/component-updates/tpm-key-attestation). Служба подготовки устройств поддерживает только TPM 2.0.

### <a name="endorsement-key"></a>Ключ подтверждения

Ключ подтверждения представляет собой асимметричный ключ, содержащийся в TPM, который создан внутри модуля или внедрен во время производства. Он уникален для каждого TPM. Ключ подтверждения невозможно изменить или удалить. Закрытая часть ключа подтверждения недоступна вне TPM, в то время как по открытой части ключа подтверждения можно определить подлинность TPM. Узнайте больше о [ключе подтверждения](https://technet.microsoft.com/library/cc770443(v=ws.11).aspx).

### <a name="storage-root-key"></a>Корневой ключ хранилища

Корневой ключ хранилища хранится в TPM и используется для защиты созданных приложениями ключей TPM, чтобы их нельзя было использовать без TPM. Корневой ключ хранилища создается при назначении владельца TPM. При очистке TPM для нового владельца также создается корневой ключ хранилища. Узнайте больше о [корневом ключе хранилища](https://technet.microsoft.com/library/cc753560(v=ws.11).aspx).

## <a name="x509-certificates"></a>Сертификаты X.509

Применение сертификатов X.509 в качестве механизма аттестации позволяет легко масштабировать производство и упростить подготовку устройств к работе. Сертификаты X.509 обычно организуются в цепочки доверия, в которых каждый сертификат подписан закрытым ключом от сертификата следующего уровня. На самом верху цепочки расположен самозаверяющий корневой сертификат. Такая цепочка создает систему делегированного доверия от корневого сертификата, созданного корневым центром сертификации (ЦС), через все промежуточные ЦС вплоть до сертификата конечного субъекта, установленного на устройстве. Дополнительные сведения см. в статье [Device Authentication using X.509 CA Certificates](https://docs.microsoft.com/azure/iot-hub/iot-hub-x509ca-overview) (Аутентификация устройств с помощью сертификатов ЦС X.509). 

Цепочка сертификатов часто соответствует реальной логической или физической иерархии, характерной для конкретных устройств. Например, производитель может выдать самозаверяющий сертификат корневого ЦС и применить его для создания уникальных сертификатов промежуточного ЦС для каждой фабрики. Сертификаты фабрик применяются для создания уникальных сертификатов промежуточного ЦС для каждого производственного конвейера. На их основе создаются уникальные сертификаты конечного субъекта для каждого устройства, произведенного в соответствующих конвейерах. Дополнительные сведения см. в статье [Концептуальное представление о сертификатах ЦС X.509 в отрасли Интернета вещей](https://docs.microsoft.com/azure/iot-hub/iot-hub-x509ca-concept). 

### <a name="root-certificate"></a>Корневой сертификат

Корневой сертификат — это самозаверяющий сертификат X.509, представляющий определенный центр сертификации (ЦС). Он выполняет роль конечной точки (якоря доверия) в цепочке сертификатов. Организация может самостоятельно выдавать корневые сертификаты или приобретать их в корневом центре сертификации. Дополнительные сведения см. в разделе [Получение сертификатов ЦС X.509](https://docs.microsoft.com/azure/iot-hub/iot-hub-security-x509-get-started#get-x509-ca-certificates). Корневой сертификат также может называться сертификатом корневого ЦС.

### <a name="intermediate-certificate"></a>Промежуточный сертификат

Промежуточным сертификатом считается сертификат X.509, подписанный корневым сертификатом (или другим промежуточным сертификатом, в цепочке которого есть корневой сертификат). Последний промежуточный сертификат в цепочке используется для подписи конечного сертификата. Промежуточный сертификат также может называться сертификатом промежуточного ЦС.

### <a name="leaf-certificate"></a>Конечный сертификат

Конечный сертификат (сертификат конечного субъекта) определяет владельца сертификата. В его цепочке сертификатов содержится один корневой сертификат и может быть несколько промежуточных сертификатов. Конечный сертификат не используется для подписи каких-либо других сертификатов. Он уникально идентифицирует устройство для службы подготовки, поэтому иногда его называют сертификатом устройства. В процессе аутентификации устройство применяет закрытый ключ, связанный с этим сертификатом, чтобы вернуть ответ с подтверждением владения на соответствующий запрос от службы. Дополнительные сведения см. в разделе [Authenticating devices signed with X.509 CA certificates](https://docs.microsoft.com/azure/iot-hub/iot-hub-x509ca-overview#authenticating-devices-signed-with-x509-ca-certificates) (Аутентификация устройств, подписанных с помощью сертификатов ЦС X.509).

## <a name="controlling-device-access-to-the-provisioning-service-with-x509-certificates"></a>Управление доступом устройств к службе подготовки с использованием сертификатов X.509

Служба подготовки поддерживает записи регистрации двух типов, которые позволяют управлять доступом для устройств, использующих механизм аттестации X.509.  

- [Отдельные регистрации](./concepts-service.md#individual-enrollment) создаются на основе сертификата устройства, связанного с определенным устройством. Эти записи устанавливают правила регистрации для конкретных устройств.
- [Группа регистраций](./concepts-service.md#enrollment-group) создается на основе определенного сертификата промежуточного или корневого ЦС. Эти записи устанавливают правила регистрации для всех устройств, содержащих этот промежуточный или корневой сертификат в своей цепочке сертификатов. 

Когда устройство подключается к службе подготовки, эта служба сначала проверяет для него записи регистрации в порядке от более конкретных к более обобщенным. Например, если есть отдельная регистрация для устройства, служба подготовки применяет именно эту запись. Если для устройства нет отдельных регистраций, но существует группа регистраций для первого промежуточного сертификата в его цепочке сертификатов, служба применяет эту запись. И так далее вплоть до корневого сертификата. Служба применяет первую подходящую запись следующим образом:

- если первая из найденных записей включена, служба выполняет подготовку устройства;
- если первая из найденных записей отключена, служба отклоняет подготовку устройства;  
- если не будет найдено ни одной записи для сертификатов в цепочке сертификатов устройства, служба отклоняет подготовку устройства. 

Такой механизм и иерархическая структура сертификатов предоставляют мощный и гибкий инструмент управления доступом для отдельных устройств и групп устройств. Предположим, что мы создали пять устройств со следующими цепочками сертификатов: 

- *устройство 1*: корневой сертификат -> сертификат A -> сертификат устройства 1;
- *устройство 2*: корневой сертификат -> сертификат A -> сертификат устройства 2;
- *устройство 3*: корневой сертификат -> сертификат A -> сертификат устройства 3;
- *устройство 4*: корневой сертификат -> сертификат B -> сертификат устройства 4;
- *устройство 5*: корневой сертификат -> сертификат B -> сертификат устройства 5.

Изначально вы создаете запись групповой регистрации для корневого сертификата, чтобы включить доступ для всех пяти устройств. Если в определенный момент сертификат B окажется скомпрометирован, вы можете создать дополнительную групповую запись для сертификата B и отключить ее, чтобы запретить регистрацию *устройства 4* и *устройства 5*. Если позднее будет скомпрометировано еще и *устройство 3*, вы можете создать запись отдельной регистрации для сертификата этого устройства и отключить ее. Таким образом, доступ будет закрыт для *устройства 3*, но *устройство 1* и *устройство 2* смогут пройти регистрацию.