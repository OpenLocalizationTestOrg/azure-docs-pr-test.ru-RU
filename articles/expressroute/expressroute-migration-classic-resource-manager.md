---
title: "Перенос связанных виртуальных сетей ExpressRoute из классической модели на модель Resource Manager (Azure PowerShell) | Документация Майкрософт"
description: "В этой статье описывается перенос связанных виртуальных сетей на модель Resource Manager после перемещения канала."
documentationcenter: na
services: expressroute
author: ganesr
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 
ms.service: expressroute
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 07/06/2017
ms.author: ganesr;cherylmc
ms.openlocfilehash: 964ea38569062a7127f60dd6309b328db263bf6f
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="migrate-expressroute-associated-virtual-networks-from-classic-to-resource-manager"></a><span data-ttu-id="90c4a-103">Перенос связанных виртуальных сетей ExpressRoute из классической модели на модель Resource Manager</span><span class="sxs-lookup"><span data-stu-id="90c4a-103">Migrate ExpressRoute associated virtual networks from classic to Resource Manager</span></span>

<span data-ttu-id="90c4a-104">В этой статье описывается, как после перемещения канала ExpressRoute перенести связанные виртуальные сети Azure ExpressRoute из классической модели развертывания на модель развертывания с помощью Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="90c4a-104">This article explains how to migrate Azure ExpressRoute associated virtual networks from the classic deployment model to the Azure Resource Manager deployment model after moving your ExpressRoute circuit.</span></span> 


## <a name="before-you-begin"></a><span data-ttu-id="90c4a-105">Перед началом работы</span><span class="sxs-lookup"><span data-stu-id="90c4a-105">Before you begin</span></span>
* <span data-ttu-id="90c4a-106">Убедитесь в наличии последней версии модулей Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="90c4a-106">Verify that you have the latest version of the Azure PowerShell modules.</span></span> <span data-ttu-id="90c4a-107">Дополнительные сведения см. в статье [Установка и настройка Azure PowerShell](/powershell/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="90c4a-107">For more information, see [How to install and configure Azure PowerShell](/powershell/azure/overview).</span></span>
* <span data-ttu-id="90c4a-108">Не забудьте изучить [предварительные требования](expressroute-prerequisites.md), [требования к маршрутизации](expressroute-routing.md) и [рабочие процессы](expressroute-workflows.md), прежде чем приступать к настройке.</span><span class="sxs-lookup"><span data-stu-id="90c4a-108">Make sure that you have reviewed the [prerequisites](expressroute-prerequisites.md), [routing requirements](expressroute-routing.md), and [workflows](expressroute-workflows.md) before you begin configuration.</span></span>
* <span data-ttu-id="90c4a-109">Просмотрите сведения в статье [Перемещение каналов ExpressRoute из классической модели развертывания в модель развертывания с помощью Resource Manager](expressroute-move.md).</span><span class="sxs-lookup"><span data-stu-id="90c4a-109">Review the information that is provided under [Moving an ExpressRoute circuit from classic to Resource Manager](expressroute-move.md).</span></span> <span data-ttu-id="90c4a-110">Убедитесь, что вам полностью понятны пределы и ограничения.</span><span class="sxs-lookup"><span data-stu-id="90c4a-110">Make sure that you fully understand the limits and limitations.</span></span>
* <span data-ttu-id="90c4a-111">Убедитесь, что канал полноценно работает в классической модели развертывания.</span><span class="sxs-lookup"><span data-stu-id="90c4a-111">Verify that the circuit is fully operational in the classic deployment model.</span></span>
* <span data-ttu-id="90c4a-112">Убедитесь в наличии группы ресурсов, созданной в модели развертывания Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="90c4a-112">Ensure that you have a resource group that was created in the Resource Manager deployment model.</span></span>
* <span data-ttu-id="90c4a-113">Ознакомьтесь со следующими статьями о переносе ресурсов:</span><span class="sxs-lookup"><span data-stu-id="90c4a-113">Review the following resource-migration documentation:</span></span>

    * [<span data-ttu-id="90c4a-114">Поддерживаемый платформой перенос ресурсов IaaS из классической модели в модель Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="90c4a-114">Platform-supported migration of IaaS resources from classic to Azure Resource Manager</span></span>](../virtual-machines/virtual-machines-windows-migration-classic-resource-manager.md)
    * [<span data-ttu-id="90c4a-115">Техническое руководство по поддерживаемому платформой переносу из классической модели в модель Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="90c4a-115">Technical deep dive on platform-supported migration from classic to Azure Resource Manager</span></span>](../virtual-machines/virtual-machines-windows-migration-classic-resource-manager-deep-dive.md)
    * <span data-ttu-id="90c4a-116">[Platform-supported migration of IaaS resources from classic to Azure Resource Manager](../virtual-machines/virtual-machines-windows-migration-classic-resource-manager.md) (Поддерживаемый платформой перенос ресурсов IaaS из классической модели в модель Azure Resource Manager)</span><span class="sxs-lookup"><span data-stu-id="90c4a-116">[FAQs: Platform-supported migration of IaaS resources from classic to Azure Resource Manager](../virtual-machines/virtual-machines-windows-migration-classic-resource-manager.md)</span></span>
    * <span data-ttu-id="90c4a-117">[Common errors during Classic to Azure Resource Manager migration](../virtual-machines/windows/migration-classic-resource-manager-errors.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) (Распространенные ошибки при переносе из классической модели на модель Azure Resource Manager)</span><span class="sxs-lookup"><span data-stu-id="90c4a-117">[Review most common migration errors and mitigations](../virtual-machines/windows/migration-classic-resource-manager-errors.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>

## <a name="supported-and-unsupported-scenarios"></a><span data-ttu-id="90c4a-118">Поддерживаемые и неподдерживаемые сценарии</span><span class="sxs-lookup"><span data-stu-id="90c4a-118">Supported and unsupported scenarios</span></span>

* <span data-ttu-id="90c4a-119">Канал ExpressRoute можно перенести из классической среды в среду Resource Manager без простоев.</span><span class="sxs-lookup"><span data-stu-id="90c4a-119">An ExpressRoute circuit can be moved from the classic to the Resource Manager environment without any downtime.</span></span> <span data-ttu-id="90c4a-120">Вы можете переместить любой канал ExpressRoute из классической среды в среду Resource Manager без простоев.</span><span class="sxs-lookup"><span data-stu-id="90c4a-120">You can move any ExpressRoute circuit from the classic to the Resource Manager environment with no downtime.</span></span> <span data-ttu-id="90c4a-121">Следуйте инструкциям в статье [Перемещение каналов ExpressRoute из классической модели развертывания в модель Resource Manager с помощью PowerShell](expressroute-howto-move-arm.md).</span><span class="sxs-lookup"><span data-stu-id="90c4a-121">Follow the instructions in [moving ExpressRoute circuits from the classic to the Resource Manager deployment model using PowerShell](expressroute-howto-move-arm.md).</span></span> <span data-ttu-id="90c4a-122">Перемещение ресурсов, подключенных к виртуальной сети, является обязательным условием.</span><span class="sxs-lookup"><span data-stu-id="90c4a-122">This is a prerequisite to move resources connected to the virtual network.</span></span>
* <span data-ttu-id="90c4a-123">Виртуальные сети, шлюзы и связанные развертывания в виртуальной сети, подключенные к каналу ExpressRoute в одной подписке, можно перенести в среду Resource Manager без простоев.</span><span class="sxs-lookup"><span data-stu-id="90c4a-123">Virtual networks, gateways, and associated deployments within the virtual network that are attached to an ExpressRoute circuit in the same subscription can be migrated to the Resource Manager environment without any downtime.</span></span> <span data-ttu-id="90c4a-124">Выполните приведенные ниже действия, чтобы перенести ресурсы, такие как виртуальные сети, шлюзы и виртуальные машины, развернутые в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="90c4a-124">You can follow the steps described later to migrate resources such as virtual networks, gateways, and virtual machines deployed within the virtual network.</span></span> <span data-ttu-id="90c4a-125">Прежде чем приступать к переносу виртуальных сетей, необходимо убедиться, что они настроены правильно.</span><span class="sxs-lookup"><span data-stu-id="90c4a-125">You must ensure that the virtual networks are configured correctly before they are migrated.</span></span> 
* <span data-ttu-id="90c4a-126">Для переноса виртуальных сетей, шлюзов и связанных развертываний в виртуальной сети, которые принадлежат не к той подписке, где находится канал ExpressRoute, требуется некоторое время простоя.</span><span class="sxs-lookup"><span data-stu-id="90c4a-126">Virtual networks, gateways, and associated deployments within the virtual network that are not in the same subscription as the ExpressRoute circuit require some downtime to complete the migration.</span></span> <span data-ttu-id="90c4a-127">В последнем разделе статьи описываются шаги, которые необходимо выполнить при переносе ресурсов.</span><span class="sxs-lookup"><span data-stu-id="90c4a-127">The last section of the document describes the steps to be followed to migrate resources.</span></span>
* <span data-ttu-id="90c4a-128">Виртуальную сеть с обоими шлюзами (ExpressRoute и VPN-шлюз) нельзя переместить.</span><span class="sxs-lookup"><span data-stu-id="90c4a-128">A virtual network with both ExpressRoute Gateway and VPN Gateway can't be migrated.</span></span>

## <a name="move-an-expressroute-circuit-from-classic-to-resource-manager"></a><span data-ttu-id="90c4a-129">Перемещение канала ExpressRoute из классической модели развертывания в модель развертывания с помощью Resource Manager</span><span class="sxs-lookup"><span data-stu-id="90c4a-129">Move an ExpressRoute circuit from classic to Resource Manager</span></span>
<span data-ttu-id="90c4a-130">Прежде чем приступить к переносу ресурсов, подключенных к каналу ExpressRoute, этот канал необходимо переместить из классической среды в среду Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="90c4a-130">You must move an ExpressRoute circuit from the classic to the Resource Manager environment before you try to migrate resources that are attached to the ExpressRoute circuit.</span></span> <span data-ttu-id="90c4a-131">Для этого используйте приведенные ниже ссылки:</span><span class="sxs-lookup"><span data-stu-id="90c4a-131">To accomplish this task, see the following articles:</span></span>

* <span data-ttu-id="90c4a-132">Просмотрите сведения в статье [Перемещение каналов ExpressRoute из классической модели развертывания в модель развертывания с помощью Resource Manager](expressroute-move.md).</span><span class="sxs-lookup"><span data-stu-id="90c4a-132">Review the information that is provided under [Moving an ExpressRoute circuit from classic to Resource Manager](expressroute-move.md).</span></span>
* <span data-ttu-id="90c4a-133">[Перемещение каналов ExpressRoute из классической модели развертывания в модель Resource Manager с помощью PowerShell](expressroute-howto-move-arm.md).</span><span class="sxs-lookup"><span data-stu-id="90c4a-133">[Move a circuit from classic to Resource Manager using Azure PowerShell](expressroute-howto-move-arm.md).</span></span>
* <span data-ttu-id="90c4a-134">Используя портал управления службами Azure,</span><span class="sxs-lookup"><span data-stu-id="90c4a-134">Use the Azure Service Management portal.</span></span> <span data-ttu-id="90c4a-135">выполните рабочий процесс для [создания канала ExpressRoute](expressroute-howto-circuit-portal-resource-manager.md) и выберите параметр импорта.</span><span class="sxs-lookup"><span data-stu-id="90c4a-135">You can follow the workflow to [create a new ExpressRoute circuit](expressroute-howto-circuit-portal-resource-manager.md) and select the import option.</span></span> 

<span data-ttu-id="90c4a-136">При этой операции прости не возникают.</span><span class="sxs-lookup"><span data-stu-id="90c4a-136">This operation does not involve downtime.</span></span> <span data-ttu-id="90c4a-137">Вы можете продолжить перемещение данных между локальной средой и Майкрософт во время выполнения миграции.</span><span class="sxs-lookup"><span data-stu-id="90c4a-137">You can continue to transfer data between your premises and Microsoft while the migration is in progress.</span></span>

## <a name="migrate-virtual-networks-gateways-and-associated-deployments"></a><span data-ttu-id="90c4a-138">Перенос виртуальных сетей, шлюзов и связанных развертываний</span><span class="sxs-lookup"><span data-stu-id="90c4a-138">Migrate virtual networks, gateways, and associated deployments</span></span>

<span data-ttu-id="90c4a-139">Шаги, выполняемые для переноса, зависят от того, где находятся ресурсы: в одной подписке, в разных подписках, или оба варианта.</span><span class="sxs-lookup"><span data-stu-id="90c4a-139">The steps you follow to migrate depend on whether your resources are in the same subscription, different subscriptions, or both.</span></span>

### <a name="migrate-virtual-networks-gateways-and-associated-deployments-in-the-same-subscription-as-the-expressroute-circuit"></a><span data-ttu-id="90c4a-140">Перенос виртуальных сетей, шлюзов и связанных развертываний, которые находятся в той же подписке, что и канал ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="90c4a-140">Migrate virtual networks, gateways, and associated deployments in the same subscription as the ExpressRoute circuit</span></span>
<span data-ttu-id="90c4a-141">В этом разделе описываются шаги, которые необходимо выполнить для переноса виртуальной сети, шлюза и связанных развертываний, находящихся в той же подписке, что и канал ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="90c4a-141">This section describes the steps to be followed to migrate a virtual network, gateway, and associated deployments in the same subscription as the ExpressRoute circuit.</span></span> <span data-ttu-id="90c4a-142">При таком переносе простои не возникают.</span><span class="sxs-lookup"><span data-stu-id="90c4a-142">No downtime is associated with this migration.</span></span> <span data-ttu-id="90c4a-143">Во время миграции можно продолжать использовать все ресурсы,</span><span class="sxs-lookup"><span data-stu-id="90c4a-143">You can continue to use all resources through the migration process.</span></span> <span data-ttu-id="90c4a-144">однако плоскость управления заблокирована.</span><span class="sxs-lookup"><span data-stu-id="90c4a-144">The management plane is locked while the migration is in progress.</span></span> 

1. <span data-ttu-id="90c4a-145">Убедитесь, что канал ExpressRoute перемещен из классической среды в среду Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="90c4a-145">Ensure that the ExpressRoute circuit has been moved from the classic to the Resource Manager environment.</span></span>
2. <span data-ttu-id="90c4a-146">Убедитесь, что виртуальная сеть подготовлена для переноса.</span><span class="sxs-lookup"><span data-stu-id="90c4a-146">Ensure that the virtual network has been prepared appropriately for the migration.</span></span>
3. <span data-ttu-id="90c4a-147">Зарегистрируйте подписку для переноса ресурсов.</span><span class="sxs-lookup"><span data-stu-id="90c4a-147">Register your subscription for resource migration.</span></span> <span data-ttu-id="90c4a-148">Для этого используйте следующий фрагмент кода PowerShell:</span><span class="sxs-lookup"><span data-stu-id="90c4a-148">To register your subscription for resource migration, use the following PowerShell snippet:</span></span>

  ```powershell 
  Select-AzureRmSubscription -SubscriptionName <Your Subscription Name>
  Register-AzureRmResourceProvider -ProviderNamespace Microsoft.ClassicInfrastructureMigrate
  Get-AzureRmResourceProvider -ProviderNamespace Microsoft.ClassicInfrastructureMigrate
  ```
4. <span data-ttu-id="90c4a-149">Выполните проверку, подготовку и миграцию.</span><span class="sxs-lookup"><span data-stu-id="90c4a-149">Validate, prepare, and migrate.</span></span> <span data-ttu-id="90c4a-150">Чтобы переместить виртуальную сеть, используйте приведенный ниже фрагмент кода PowerShell.</span><span class="sxs-lookup"><span data-stu-id="90c4a-150">To move the virtual network, use the following PowerShell snippet:</span></span>

  ```powershell
  Move-AzureVirtualNetwork -Prepare $vnetName  
  Move-AzureVirtualNetwork -Commit $vnetName
  ```

  <span data-ttu-id="90c4a-151">Вы также можете прервать миграцию, выполнив следующий командлет PowerShell:</span><span class="sxs-lookup"><span data-stu-id="90c4a-151">You can also abort migration by running the following PowerShell cmdlet:</span></span>

  ```powershell
  Move-AzureVirtualNetwork -Abort $vnetName
  ```

## <a name="next-steps"></a><span data-ttu-id="90c4a-152">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="90c4a-152">Next steps</span></span>
* [<span data-ttu-id="90c4a-153">Поддерживаемый платформой перенос ресурсов IaaS из классической модели в модель Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="90c4a-153">Platform-supported migration of IaaS resources from classic to Azure Resource Manager</span></span>](../virtual-machines/virtual-machines-windows-migration-classic-resource-manager.md)
* [<span data-ttu-id="90c4a-154">Техническое руководство по поддерживаемому платформой переносу из классической модели в модель Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="90c4a-154">Technical deep dive on platform-supported migration from classic to Azure Resource Manager</span></span>](../virtual-machines/virtual-machines-windows-migration-classic-resource-manager-deep-dive.md)
* <span data-ttu-id="90c4a-155">[Platform-supported migration of IaaS resources from classic to Azure Resource Manager](../virtual-machines/virtual-machines-windows-migration-classic-resource-manager.md) (Поддерживаемый платформой перенос ресурсов IaaS из классической модели в модель Azure Resource Manager)</span><span class="sxs-lookup"><span data-stu-id="90c4a-155">[FAQs: Platform-supported migration of IaaS resources from classic to Azure Resource Manager](../virtual-machines/virtual-machines-windows-migration-classic-resource-manager.md)</span></span>
* <span data-ttu-id="90c4a-156">[Common errors during Classic to Azure Resource Manager migration](../virtual-machines/windows/migration-classic-resource-manager-errors.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) (Распространенные ошибки при переносе из классической модели на модель Azure Resource Manager)</span><span class="sxs-lookup"><span data-stu-id="90c4a-156">[Review most common migration errors and mitigations](../virtual-machines/windows/migration-classic-resource-manager-errors.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
