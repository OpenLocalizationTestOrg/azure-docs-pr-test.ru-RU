---
title: "Оптимизация маршрутизации ExpressRoute в Azure | Документация Майкрософт"
description: "Эта страница содержит сведения о как toooptimize маршрутизации, при наличии более одного ExpressRoute каналов, связи между корпорацией Майкрософт и сети компании."
documentationcenter: na
services: expressroute
author: charwen
manager: carmonm
editor: 
ms.assetid: fca53249-d9c3-4cff-8916-f8749386a4dd
ms.service: expressroute
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/06/2017
ms.author: charwen
ms.openlocfilehash: ebcfb638f67a9ac78c3e476668bfd0bb0ffb9985
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="optimize-expressroute-routing"></a>Оптимизация маршрутизации ExpressRoute
При наличии нескольких каналов ExpressRoute, у вас есть несколько tooMicrosoft tooconnect путь. В результате неоптимальной маршрутизации может произойти - т. е трафика может занять больше времени, tooreach путь корпорации Майкрософт и tooyour сети (Майкрософт). Hello дольше hello сетевой путь, Высокая задержка hello hello. которая прямо влияет на производительность приложения и работу пользователей. В этой статье будут показаны проблема и объясняется, как toooptimize маршрутизации с помощью hello стандартные технологии маршрутизации.

## <a name="suboptimal-routing-from-customer-toomicrosoft"></a>Неоптимальных маршрутизации из tooMicrosoft клиента
Пример давайте внимание на проблемы маршрутизации hello. Представьте, что у вас есть два офисов в США hello: в Лос-Анджелесе и в Нью-Йорке. Эти офисы подключены к глобальной сети (WAN): либо к вашей собственной магистральной, либо к предоставленной поставщиком услуг VPN на базе IP-сети. У вас есть два каналы ExpressRoute: на Западе США и на Востоке, также подключения на hello глобальной сети. Очевидно, что у вас есть два пути tooconnect toohello Microsoft network. А теперь представьте, что и в западной, и в восточной части США расположены службы Azure (например, службы приложений Azure). Вы собираетесь вызвано tooconnect пользователей в Лос-Анджелес tooAzure Западе США, а также пользователи в Нью-Йорке tooAzure Востоке администратору службы объявляет, что пользователи в каждом office access hello ближайших служб Azure для оптимальной работы. К сожалению план hello происходит для hello восточном побережье пользователей, но не для пользователей западное побережье hello. Причиной Hello hello является hello следующее. На каждый канал ExpressRoute tooyou мы объявляют префикс hello в Azure Востоке (23.100.0.0/16) и префикс hello в Azure Западе США (13.100.0.0/16). Если вы не знаете, какой префикс — из какой области, вы не можете tootreat его по-разному. ГЛОБАЛЬНОЙ сети можно сравнивать оба префиксов hello находятся ближе tooUS Восток чем Западе США и таким образом перенаправлять обоих toohello пользователей office канал ExpressRoute на Востоке. В конце hello имеется несколько пользователей быть недовольны в Лос-Анджелес office hello.

![Проблема ExpressRoute случая 1 - неоптимальных маршрутизации из tooMicrosoft клиента](./media/expressroute-optimize-routing/expressroute-case1-problem.png)

### <a name="solution-use-bgp-communities"></a>Решение. Использование сообщества BGP
toooptimize маршрутизации для обоих пользователей office требуется tooknow, какой префикс — из западе Azure США, а также какие из Azure Востоке. Эти сведения кодируются с использованием [значений сообществ BGP](expressroute-routing.md). Мы был назначен уникальный tooeach значение сообщества BGP регион Azure, например 12076:51004 — восточной части США и 12076:51006 — западной. Теперь, определив префикс для каждого региона Azure, можно настроить канал ExpressRoute, который необходимо использовать. Так как мы используем hello BGP tooexchange маршрутизации сведения, можно использовать маршрутизации tooinfluence локальной настройки BGP на. В нашем примере можно назначить выше too13.100.0.0/16 значение локального предпочтений на Западе США чем на Востоке и аналогично выше too23.100.0.0/16 значение локального предпочтений на востоке чем на Западе США. Эта конфигурация убедиться в том, что, если доступны оба tooMicrosoft пути, пользователей в Лос-Анджелесе займет hello канал ExpressRoute в tooAzure tooconnect Западе США Западе США в то время как пользователи в Нью-Йорке пользоваться hello ExpressRoute в tooAzure Востоке Востоке США. . Это обеспечивает оптимальную маршрутизацию на обоих сторонах. 

![Решение проблемы маршрутизации ExpressRoute 1. Использование сообщества BGP](./media/expressroute-optimize-routing/expressroute-case1-solution.png)

> [!NOTE]
> Здравствуйте же метод, с помощью локального предпочтений, может быть применен toorouting из клиента tooAzure виртуальной сети. Мы не помечать сообщества BGP значение toohello префиксы объявлена с помощью Azure tooyour сети. Тем не менее, поскольку известно, развертывания виртуальной сети, являющийся закрыть toowhich офиса, можно настроить маршрутизаторы соответствующим образом tooprefer один ExpressRoute канала tooanother.
>
>

## <a name="suboptimal-routing-from-microsoft-toocustomer"></a>Неоптимальных маршрутизации из Microsoft toocustomer
Вот другой пример, где подключения от Microsoft занять больше времени, tooreach путь сети. В этом случае используются Exchange Online и локальные серверы Exchange в [гибридной среде](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx). Офисов, подключенных tooa глобальной сети. Префиксы hello локальных серверов, как ваш tooMicrosoft офисов через каналы ExpressRoute hello двух в объявлении. Exchange Online будет инициировать подключения toohello локальных серверов в случаях, такие как миграция почтовых ящиков. К сожалению tooyour подключения hello office Лос-Анджелес предшествует обход hello всей континент задней toohello западное побережье перенаправленное toohello канал ExpressRoute на Востоке. Hello причиной hello является аналогичные toohello первый из них. Любое указание не hello Microsoft network не может определить, какой префикс клиента — закрыть tooUS Восточная и какой из них закрыть tooUS запад. Это происходит office tooyour неправильный путь toopick hello в Лос-Анджелесе.

![ExpressRoute для случая 2 - неоптимальных маршрутизации из Microsoft toocustomer](./media/expressroute-optimize-routing/expressroute-case2-problem.png)

### <a name="solution-use-as-path-prepending"></a>Решение. Использование атрибута AS PATH
Существует два решения toohello проблемы. Hello сначала существует просто объявления префикса локального офиса Лос-Анджелес, 177.2.0.0/31 на канал ExpressRoute hello на Западе США и в локальной префиксов для вашего Нью-Йорке, 177.2.0.2/31 на канал ExpressRoute hello на Востоке. В результате есть только один путь tooeach tooconnect корпорации Майкрософт из офисов. Это позволяет избежать возможной неоднозначности и оптимизировать маршрутизацию. При такой структуре необходимо toothink о стратегии перехода на другой ресурс. В hello разрывается событие, которое hello tooMicrosoft путь через ExpressRoute, необходимо убедиться, что Exchange Online можно подключиться локальные серверы tooyour toomake. 

Hello другим решением является продолжить tooadvertise оба префиксы hello на обоих каналы ExpressRoute, что в дополнение вы предоставите нам указание, какой префикс — закрыть toowhich один из офисов. Так как мы поддерживаем добавляя BGP AS путь, можно настроить hello AS путь для tooinfluence префикс маршрута. В этом примере вы можете увеличить hello AS путь для 172.2.0.0/31 на Востоке, чтобы использовать канал ExpressRoute hello на Западе США для трафика, предназначенного для этого префикса (как свою сеть будет считать, что префикс toothis пути hello короче Индия hello). Точно так же может увеличить hello AS путь для 172.2.0.2/31 на Западе США, чтобы мы будем предпочитают канал ExpressRoute hello на Востоке. Это позволит оптимизировать маршрутизацию для обоих офисов. Если один из каналов ExpressRoute недоступен, подключение Exchange Online к вашей сети будет установлено через другой канал ExpressRoute и вашу глобальную сеть. 

> [!IMPORTANT]
> Мы удаляем закрытый чисел в hello AS путь для hello префиксов, ПОЛУЧЕННЫХ на Пиринга Майкрософт. Требуется tooappend открытые, как числа в путь AS hello tooinfluence маршрутизации для Пиринга Майкрософт.
> 
> 

![Решение проблемы маршрутизации ExpressRoute 2. Использование атрибута AS PATH](./media/expressroute-optimize-routing/expressroute-case2-solution.png)

> [!NOTE]
> Хотя для Майкрософт и открытые пиринги приведенные здесь примеры hello, мы поддерживаем hello одинаковые возможности для частного пиринга hello. Добавляя путь AS hello работает также внутри одного одного канала ExpressRoute, выбор hello tooinfluence hello первичного и вторичного путей.
> 
> 

## <a name="suboptimal-routing-between-virtual-networks"></a>Неоптимальная маршрутизация виртуальных сетей
При помощи ExpressRoute можно включить tooVirtual виртуальной сети (который также называется «Виртуальная сеть») сети связи, связывая их tooan канал ExpressRoute. При связывании их toomultiple каналы ExpressRoute, неоптимальных маршрутизации может произойти между hello виртуальных сетей. Рассмотрим пример. У вас есть два канала ExpressRoute: один — в западной части США, а другой — в восточной. В каждом регионе имеется две виртуальные сети. Ваши веб-серверы развернуты в одной виртуальной сети и hello серверах приложений в других. Для обеспечения избыточности вы ссылку hello двух виртуальных сетей в каждой области tooboth hello локальный канал ExpressRoute и hello удаленный канал ExpressRoute. Как можно увидеть ниже, с каждой виртуальной сети есть два пути toohello другой виртуальной сети. Hello виртуальных сетей не знаете, какие канал ExpressRoute является локальным, а какая удаленной. Таким образом, как равенства-стоимость-Multi-Path (ECMP) трафик tooload баланс между виртуальной сети, некоторые трафик, поступающий будет иметь более длинный путь hello и будут направляться на удаленный канал ExpressRoute hello.

![Проблема маршрутизации ExpressRoute 3. Неоптимальная маршрутизация виртуальных сетей](./media/expressroute-optimize-routing/expressroute-case3-problem.png)

### <a name="solution-assign-a-high-weight-toolocal-connection"></a>Решение: назначить соединение toolocal высокой вес
Hello решением является простой. Поскольку расположение hello виртуальных сетей и hello цепи известно, сообщите нам какой путь, следует выбирать каждой виртуальной сети. Специально для этого примера назначить выше вес toohello локального подключения от удаленного подключения toohello (см. пример конфигурации hello [здесь](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)). Когда виртуальная сеть получает префикс hello hello другой виртуальной сети на несколько подключений, предпочтут hello соединения с трафика вес toosend hello, наибольший предназначенного для этого префикса.

![Решение ExpressRoute случай 3 - assign высокой вес toolocal подключения](./media/expressroute-optimize-routing/expressroute-case3-solution.png)

> [!NOTE]
> Может влиять на маршрутизации из виртуальной сети tooyour в локальной сети, если имеется несколько каналов ExpressRoute, настроив вес hello подключения вместо применения путь AS, добавляя метод, описанный в hello второй сценарий выше. Для каждого префикса всегда рассмотрим hello вес соединения перед hello, длина пути к AS при определении как toosend трафика.
>
>
