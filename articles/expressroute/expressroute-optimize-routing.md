---
title: "Оптимизация маршрутизации ExpressRoute в Azure | Документация Майкрософт"
description: "Эта страница содержит сведения о как toooptimize маршрутизации, при наличии более одного ExpressRoute каналов, связи между корпорацией Майкрософт и сети компании."
documentationcenter: na
services: expressroute
author: charwen
manager: carmonm
editor: 
ms.assetid: fca53249-d9c3-4cff-8916-f8749386a4dd
ms.service: expressroute
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/06/2017
ms.author: charwen
ms.openlocfilehash: ebcfb638f67a9ac78c3e476668bfd0bb0ffb9985
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="optimize-expressroute-routing"></a><span data-ttu-id="0cb31-103">Оптимизация маршрутизации ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="0cb31-103">Optimize ExpressRoute Routing</span></span>
<span data-ttu-id="0cb31-104">При наличии нескольких каналов ExpressRoute, у вас есть несколько tooMicrosoft tooconnect путь.</span><span class="sxs-lookup"><span data-stu-id="0cb31-104">When you have multiple ExpressRoute circuits, you have more than one path tooconnect tooMicrosoft.</span></span> <span data-ttu-id="0cb31-105">В результате неоптимальной маршрутизации может произойти - т. е трафика может занять больше времени, tooreach путь корпорации Майкрософт и tooyour сети (Майкрософт).</span><span class="sxs-lookup"><span data-stu-id="0cb31-105">As a result, suboptimal routing may happen - that is, your traffic may take a longer path tooreach Microsoft, and Microsoft tooyour network.</span></span> <span data-ttu-id="0cb31-106">Hello дольше hello сетевой путь, Высокая задержка hello hello.</span><span class="sxs-lookup"><span data-stu-id="0cb31-106">hello longer hello network path, hello higher hello latency.</span></span> <span data-ttu-id="0cb31-107">которая прямо влияет на производительность приложения и работу пользователей.</span><span class="sxs-lookup"><span data-stu-id="0cb31-107">Latency has direct impact on application performance and user experience.</span></span> <span data-ttu-id="0cb31-108">В этой статье будут показаны проблема и объясняется, как toooptimize маршрутизации с помощью hello стандартные технологии маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="0cb31-108">This article will illustrate this problem and explain how toooptimize routing using hello standard routing technologies.</span></span>

## <a name="suboptimal-routing-from-customer-toomicrosoft"></a><span data-ttu-id="0cb31-109">Неоптимальных маршрутизации из tooMicrosoft клиента</span><span class="sxs-lookup"><span data-stu-id="0cb31-109">Suboptimal routing from customer tooMicrosoft</span></span>
<span data-ttu-id="0cb31-110">Пример давайте внимание на проблемы маршрутизации hello.</span><span class="sxs-lookup"><span data-stu-id="0cb31-110">Let's take a close look at hello routing problem by an example.</span></span> <span data-ttu-id="0cb31-111">Представьте, что у вас есть два офисов в США hello: в Лос-Анджелесе и в Нью-Йорке.</span><span class="sxs-lookup"><span data-stu-id="0cb31-111">Imagine you have two offices in hello US, one in Los Angeles and one in New York.</span></span> <span data-ttu-id="0cb31-112">Эти офисы подключены к глобальной сети (WAN): либо к вашей собственной магистральной, либо к предоставленной поставщиком услуг VPN на базе IP-сети.</span><span class="sxs-lookup"><span data-stu-id="0cb31-112">Your offices are connected on a Wide Area Network (WAN), which can be either your own backbone network or your service provider's IP VPN.</span></span> <span data-ttu-id="0cb31-113">У вас есть два каналы ExpressRoute: на Западе США и на Востоке, также подключения на hello глобальной сети.</span><span class="sxs-lookup"><span data-stu-id="0cb31-113">You have two ExpressRoute circuits, one in US West and one in US East, that are also connected on hello WAN.</span></span> <span data-ttu-id="0cb31-114">Очевидно, что у вас есть два пути tooconnect toohello Microsoft network.</span><span class="sxs-lookup"><span data-stu-id="0cb31-114">Obviously, you have two paths tooconnect toohello Microsoft network.</span></span> <span data-ttu-id="0cb31-115">А теперь представьте, что и в западной, и в восточной части США расположены службы Azure (например, службы приложений Azure).</span><span class="sxs-lookup"><span data-stu-id="0cb31-115">Now imagine you have Azure deployment (for example, Azure App Service) in both US West and US East.</span></span> <span data-ttu-id="0cb31-116">Вы собираетесь вызвано tooconnect пользователей в Лос-Анджелес tooAzure Западе США, а также пользователи в Нью-Йорке tooAzure Востоке администратору службы объявляет, что пользователи в каждом office access hello ближайших служб Azure для оптимальной работы.</span><span class="sxs-lookup"><span data-stu-id="0cb31-116">Your intention is tooconnect your users in Los Angeles tooAzure US West and your users in New York tooAzure US East because your service admin advertises that users in each office access hello nearby Azure services for optimal experiences.</span></span> <span data-ttu-id="0cb31-117">К сожалению план hello происходит для hello восточном побережье пользователей, но не для пользователей западное побережье hello.</span><span class="sxs-lookup"><span data-stu-id="0cb31-117">Unfortunately, hello plan works out well for hello east coast users but not for hello west coast users.</span></span> <span data-ttu-id="0cb31-118">Причиной Hello hello является hello следующее.</span><span class="sxs-lookup"><span data-stu-id="0cb31-118">hello cause of hello problem is hello following.</span></span> <span data-ttu-id="0cb31-119">На каждый канал ExpressRoute tooyou мы объявляют префикс hello в Azure Востоке (23.100.0.0/16) и префикс hello в Azure Западе США (13.100.0.0/16).</span><span class="sxs-lookup"><span data-stu-id="0cb31-119">On each ExpressRoute circuit, we advertise tooyou both hello prefix in Azure US East (23.100.0.0/16) and hello prefix in Azure US West (13.100.0.0/16).</span></span> <span data-ttu-id="0cb31-120">Если вы не знаете, какой префикс — из какой области, вы не можете tootreat его по-разному.</span><span class="sxs-lookup"><span data-stu-id="0cb31-120">If you don't know which prefix is from which region, you are not able tootreat it differently.</span></span> <span data-ttu-id="0cb31-121">ГЛОБАЛЬНОЙ сети можно сравнивать оба префиксов hello находятся ближе tooUS Восток чем Западе США и таким образом перенаправлять обоих toohello пользователей office канал ExpressRoute на Востоке.</span><span class="sxs-lookup"><span data-stu-id="0cb31-121">Your WAN network may think both of hello prefixes are closer tooUS East than US West and therefore route both office users toohello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="0cb31-122">В конце hello имеется несколько пользователей быть недовольны в Лос-Анджелес office hello.</span><span class="sxs-lookup"><span data-stu-id="0cb31-122">In hello end, you will have many unhappy users in hello Los Angeles office.</span></span>

![Проблема ExpressRoute случая 1 - неоптимальных маршрутизации из tooMicrosoft клиента](./media/expressroute-optimize-routing/expressroute-case1-problem.png)

### <a name="solution-use-bgp-communities"></a><span data-ttu-id="0cb31-124">Решение. Использование сообщества BGP</span><span class="sxs-lookup"><span data-stu-id="0cb31-124">Solution: use BGP Communities</span></span>
<span data-ttu-id="0cb31-125">toooptimize маршрутизации для обоих пользователей office требуется tooknow, какой префикс — из западе Azure США, а также какие из Azure Востоке.</span><span class="sxs-lookup"><span data-stu-id="0cb31-125">toooptimize routing for both office users, you need tooknow which prefix is from Azure US West and which from Azure US East.</span></span> <span data-ttu-id="0cb31-126">Эти сведения кодируются с использованием [значений сообществ BGP](expressroute-routing.md).</span><span class="sxs-lookup"><span data-stu-id="0cb31-126">We encode this information by using [BGP Community values](expressroute-routing.md).</span></span> <span data-ttu-id="0cb31-127">Мы был назначен уникальный tooeach значение сообщества BGP регион Azure, например 12076:51004 — восточной части США и 12076:51006 — западной.</span><span class="sxs-lookup"><span data-stu-id="0cb31-127">We've assigned a unique BGP Community value tooeach Azure region, e.g. "12076:51004" for US East, "12076:51006" for US West.</span></span> <span data-ttu-id="0cb31-128">Теперь, определив префикс для каждого региона Azure, можно настроить канал ExpressRoute, который необходимо использовать.</span><span class="sxs-lookup"><span data-stu-id="0cb31-128">Now that you know which prefix is from which Azure region, you can configure which ExpressRoute circuit should be preferred.</span></span> <span data-ttu-id="0cb31-129">Так как мы используем hello BGP tooexchange маршрутизации сведения, можно использовать маршрутизации tooinfluence локальной настройки BGP на.</span><span class="sxs-lookup"><span data-stu-id="0cb31-129">Because we use hello BGP tooexchange routing info, you can use BGP's Local Preference tooinfluence routing.</span></span> <span data-ttu-id="0cb31-130">В нашем примере можно назначить выше too13.100.0.0/16 значение локального предпочтений на Западе США чем на Востоке и аналогично выше too23.100.0.0/16 значение локального предпочтений на востоке чем на Западе США.</span><span class="sxs-lookup"><span data-stu-id="0cb31-130">In our example, you can assign a higher local preference value too13.100.0.0/16 in US West than in US East, and similarly, a higher local preference value too23.100.0.0/16 in US East than in US West.</span></span> <span data-ttu-id="0cb31-131">Эта конфигурация убедиться в том, что, если доступны оба tooMicrosoft пути, пользователей в Лос-Анджелесе займет hello канал ExpressRoute в tooAzure tooconnect Западе США Западе США в то время как пользователи в Нью-Йорке пользоваться hello ExpressRoute в tooAzure Востоке Востоке США. .</span><span class="sxs-lookup"><span data-stu-id="0cb31-131">This configuration will make sure that, when both paths tooMicrosoft are available, your users in Los Angeles will take hello ExpressRoute circuit in US West tooconnect tooAzure US West whereas your users in New York take hello ExpressRoute in US East tooAzure US East.</span></span> <span data-ttu-id="0cb31-132">Это обеспечивает оптимальную маршрутизацию на обоих сторонах.</span><span class="sxs-lookup"><span data-stu-id="0cb31-132">Routing is optimized on both sides.</span></span> 

![Решение проблемы маршрутизации ExpressRoute 1. Использование сообщества BGP](./media/expressroute-optimize-routing/expressroute-case1-solution.png)

> [!NOTE]
> <span data-ttu-id="0cb31-134">Здравствуйте же метод, с помощью локального предпочтений, может быть применен toorouting из клиента tooAzure виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="0cb31-134">hello same technique, using Local Preference, can be applied toorouting from customer tooAzure Virtual Network.</span></span> <span data-ttu-id="0cb31-135">Мы не помечать сообщества BGP значение toohello префиксы объявлена с помощью Azure tooyour сети.</span><span class="sxs-lookup"><span data-stu-id="0cb31-135">We don't tag BGP Community value toohello prefixes advertised from Azure tooyour network.</span></span> <span data-ttu-id="0cb31-136">Тем не менее, поскольку известно, развертывания виртуальной сети, являющийся закрыть toowhich офиса, можно настроить маршрутизаторы соответствующим образом tooprefer один ExpressRoute канала tooanother.</span><span class="sxs-lookup"><span data-stu-id="0cb31-136">However, since you know which of your Virtual Network deployment is close toowhich of your office, you can configure your routers accordingly tooprefer one ExpressRoute circuit tooanother.</span></span>
>
>

## <a name="suboptimal-routing-from-microsoft-toocustomer"></a><span data-ttu-id="0cb31-137">Неоптимальных маршрутизации из Microsoft toocustomer</span><span class="sxs-lookup"><span data-stu-id="0cb31-137">Suboptimal routing from Microsoft toocustomer</span></span>
<span data-ttu-id="0cb31-138">Вот другой пример, где подключения от Microsoft занять больше времени, tooreach путь сети.</span><span class="sxs-lookup"><span data-stu-id="0cb31-138">Here is another example where connections from Microsoft take a longer path tooreach your network.</span></span> <span data-ttu-id="0cb31-139">В этом случае используются Exchange Online и локальные серверы Exchange в [гибридной среде](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span><span class="sxs-lookup"><span data-stu-id="0cb31-139">In this case, you use on-premises Exchange servers and Exchange Online in a [hybrid environment](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span></span> <span data-ttu-id="0cb31-140">Офисов, подключенных tooa глобальной сети.</span><span class="sxs-lookup"><span data-stu-id="0cb31-140">Your offices are connected tooa WAN.</span></span> <span data-ttu-id="0cb31-141">Префиксы hello локальных серверов, как ваш tooMicrosoft офисов через каналы ExpressRoute hello двух в объявлении.</span><span class="sxs-lookup"><span data-stu-id="0cb31-141">You advertise hello prefixes of your on-premises servers in both of your offices tooMicrosoft through hello two ExpressRoute circuits.</span></span> <span data-ttu-id="0cb31-142">Exchange Online будет инициировать подключения toohello локальных серверов в случаях, такие как миграция почтовых ящиков.</span><span class="sxs-lookup"><span data-stu-id="0cb31-142">Exchange Online will initiate connections toohello on-premises servers in cases such as mailbox migration.</span></span> <span data-ttu-id="0cb31-143">К сожалению tooyour подключения hello office Лос-Анджелес предшествует обход hello всей континент задней toohello западное побережье перенаправленное toohello канал ExpressRoute на Востоке.</span><span class="sxs-lookup"><span data-stu-id="0cb31-143">Unfortunately, hello connection tooyour Los Angeles office is routed toohello ExpressRoute circuit in US East before traversing hello entire continent back toohello west coast.</span></span> <span data-ttu-id="0cb31-144">Hello причиной hello является аналогичные toohello первый из них.</span><span class="sxs-lookup"><span data-stu-id="0cb31-144">hello cause of hello problem is similar toohello first one.</span></span> <span data-ttu-id="0cb31-145">Любое указание не hello Microsoft network не может определить, какой префикс клиента — закрыть tooUS Восточная и какой из них закрыть tooUS запад.</span><span class="sxs-lookup"><span data-stu-id="0cb31-145">Without any hint, hello Microsoft network can't tell which customer prefix is close tooUS East and which one is close tooUS West.</span></span> <span data-ttu-id="0cb31-146">Это происходит office tooyour неправильный путь toopick hello в Лос-Анджелесе.</span><span class="sxs-lookup"><span data-stu-id="0cb31-146">It happens toopick hello wrong path tooyour office in Los Angeles.</span></span>

![ExpressRoute для случая 2 - неоптимальных маршрутизации из Microsoft toocustomer](./media/expressroute-optimize-routing/expressroute-case2-problem.png)

### <a name="solution-use-as-path-prepending"></a><span data-ttu-id="0cb31-148">Решение. Использование атрибута AS PATH</span><span class="sxs-lookup"><span data-stu-id="0cb31-148">Solution: use AS PATH prepending</span></span>
<span data-ttu-id="0cb31-149">Существует два решения toohello проблемы.</span><span class="sxs-lookup"><span data-stu-id="0cb31-149">There are two solutions toohello problem.</span></span> <span data-ttu-id="0cb31-150">Hello сначала существует просто объявления префикса локального офиса Лос-Анджелес, 177.2.0.0/31 на канал ExpressRoute hello на Западе США и в локальной префиксов для вашего Нью-Йорке, 177.2.0.2/31 на канал ExpressRoute hello на Востоке.</span><span class="sxs-lookup"><span data-stu-id="0cb31-150">hello first one is that you simply advertise your on-premises prefix for your Los Angeles office, 177.2.0.0/31, on hello ExpressRoute circuit in US West and your on-premises prefix for your New York office, 177.2.0.2/31, on hello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="0cb31-151">В результате есть только один путь tooeach tooconnect корпорации Майкрософт из офисов.</span><span class="sxs-lookup"><span data-stu-id="0cb31-151">As a result, there is only one path for Microsoft tooconnect tooeach of your offices.</span></span> <span data-ttu-id="0cb31-152">Это позволяет избежать возможной неоднозначности и оптимизировать маршрутизацию.</span><span class="sxs-lookup"><span data-stu-id="0cb31-152">There is no ambiguity and routing is optimized.</span></span> <span data-ttu-id="0cb31-153">При такой структуре необходимо toothink о стратегии перехода на другой ресурс.</span><span class="sxs-lookup"><span data-stu-id="0cb31-153">With this design, you need toothink about your failover strategy.</span></span> <span data-ttu-id="0cb31-154">В hello разрывается событие, которое hello tooMicrosoft путь через ExpressRoute, необходимо убедиться, что Exchange Online можно подключиться локальные серверы tooyour toomake.</span><span class="sxs-lookup"><span data-stu-id="0cb31-154">In hello event that hello path tooMicrosoft via ExpressRoute is broken, you need toomake sure that Exchange Online can still connect tooyour on-premises servers.</span></span> 

<span data-ttu-id="0cb31-155">Hello другим решением является продолжить tooadvertise оба префиксы hello на обоих каналы ExpressRoute, что в дополнение вы предоставите нам указание, какой префикс — закрыть toowhich один из офисов.</span><span class="sxs-lookup"><span data-stu-id="0cb31-155">hello second solution is that you continue tooadvertise both of hello prefixes on both ExpressRoute circuits, and in addition you give us a hint of which prefix is close toowhich one of your offices.</span></span> <span data-ttu-id="0cb31-156">Так как мы поддерживаем добавляя BGP AS путь, можно настроить hello AS путь для tooinfluence префикс маршрута.</span><span class="sxs-lookup"><span data-stu-id="0cb31-156">Because we support BGP AS Path prepending, you can configure hello AS Path for your prefix tooinfluence routing.</span></span> <span data-ttu-id="0cb31-157">В этом примере вы можете увеличить hello AS путь для 172.2.0.0/31 на Востоке, чтобы использовать канал ExpressRoute hello на Западе США для трафика, предназначенного для этого префикса (как свою сеть будет считать, что префикс toothis пути hello короче Индия hello).</span><span class="sxs-lookup"><span data-stu-id="0cb31-157">In this example, you can lengthen hello AS PATH for 172.2.0.0/31 in US East so that we will prefer hello ExpressRoute circuit in US West for traffic destined for this prefix (as our network will think hello path toothis prefix is shorter in hello west).</span></span> <span data-ttu-id="0cb31-158">Точно так же может увеличить hello AS путь для 172.2.0.2/31 на Западе США, чтобы мы будем предпочитают канал ExpressRoute hello на Востоке.</span><span class="sxs-lookup"><span data-stu-id="0cb31-158">Similarly you can lengthen hello AS PATH for 172.2.0.2/31 in US West so that we'll prefer hello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="0cb31-159">Это позволит оптимизировать маршрутизацию для обоих офисов.</span><span class="sxs-lookup"><span data-stu-id="0cb31-159">Routing is optimized for both offices.</span></span> <span data-ttu-id="0cb31-160">Если один из каналов ExpressRoute недоступен, подключение Exchange Online к вашей сети будет установлено через другой канал ExpressRoute и вашу глобальную сеть.</span><span class="sxs-lookup"><span data-stu-id="0cb31-160">With this design, if one ExpressRoute circuit is broken, Exchange Online can still reach you via another ExpressRoute circuit and your WAN.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="0cb31-161">Мы удаляем закрытый чисел в hello AS путь для hello префиксов, ПОЛУЧЕННЫХ на Пиринга Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="0cb31-161">We remove private AS numbers in hello AS PATH for hello prefixes received on Microsoft Peering.</span></span> <span data-ttu-id="0cb31-162">Требуется tooappend открытые, как числа в путь AS hello tooinfluence маршрутизации для Пиринга Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="0cb31-162">You need tooappend public AS numbers in hello AS PATH tooinfluence routing for Microsoft Peering.</span></span>
> 
> 

![Решение проблемы маршрутизации ExpressRoute 2. Использование атрибута AS PATH](./media/expressroute-optimize-routing/expressroute-case2-solution.png)

> [!NOTE]
> <span data-ttu-id="0cb31-164">Хотя для Майкрософт и открытые пиринги приведенные здесь примеры hello, мы поддерживаем hello одинаковые возможности для частного пиринга hello.</span><span class="sxs-lookup"><span data-stu-id="0cb31-164">While hello examples given here are for Microsoft and Public peerings, we do support hello same capabilities for hello Private peering.</span></span> <span data-ttu-id="0cb31-165">Добавляя путь AS hello работает также внутри одного одного канала ExpressRoute, выбор hello tooinfluence hello первичного и вторичного путей.</span><span class="sxs-lookup"><span data-stu-id="0cb31-165">Also, hello AS Path prepending works within one single ExpressRoute circuit, tooinfluence hello selection of hello primary and secondary paths.</span></span>
> 
> 

## <a name="suboptimal-routing-between-virtual-networks"></a><span data-ttu-id="0cb31-166">Неоптимальная маршрутизация виртуальных сетей</span><span class="sxs-lookup"><span data-stu-id="0cb31-166">Suboptimal routing between virtual networks</span></span>
<span data-ttu-id="0cb31-167">При помощи ExpressRoute можно включить tooVirtual виртуальной сети (который также называется «Виртуальная сеть») сети связи, связывая их tooan канал ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="0cb31-167">With ExpressRoute, you can enable Virtual Network tooVirtual Network (which is also known as "VNet") communication by linking them tooan ExpressRoute circuit.</span></span> <span data-ttu-id="0cb31-168">При связывании их toomultiple каналы ExpressRoute, неоптимальных маршрутизации может произойти между hello виртуальных сетей.</span><span class="sxs-lookup"><span data-stu-id="0cb31-168">When you link them toomultiple ExpressRoute circuits, suboptimal routing can happen between hello VNets.</span></span> <span data-ttu-id="0cb31-169">Рассмотрим пример.</span><span class="sxs-lookup"><span data-stu-id="0cb31-169">Let's consider an example.</span></span> <span data-ttu-id="0cb31-170">У вас есть два канала ExpressRoute: один — в западной части США, а другой — в восточной.</span><span class="sxs-lookup"><span data-stu-id="0cb31-170">You have two ExpressRoute circuits, one in US West and one in US East.</span></span> <span data-ttu-id="0cb31-171">В каждом регионе имеется две виртуальные сети.</span><span class="sxs-lookup"><span data-stu-id="0cb31-171">In each region, you have two VNets.</span></span> <span data-ttu-id="0cb31-172">Ваши веб-серверы развернуты в одной виртуальной сети и hello серверах приложений в других.</span><span class="sxs-lookup"><span data-stu-id="0cb31-172">Your web servers are deployed in one VNet and application servers in hello other.</span></span> <span data-ttu-id="0cb31-173">Для обеспечения избыточности вы ссылку hello двух виртуальных сетей в каждой области tooboth hello локальный канал ExpressRoute и hello удаленный канал ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="0cb31-173">For redundancy, you link hello two VNets in each region tooboth hello local ExpressRoute circuit and hello remote ExpressRoute circuit.</span></span> <span data-ttu-id="0cb31-174">Как можно увидеть ниже, с каждой виртуальной сети есть два пути toohello другой виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="0cb31-174">As can be seen below, from each VNet there are two paths toohello other VNet.</span></span> <span data-ttu-id="0cb31-175">Hello виртуальных сетей не знаете, какие канал ExpressRoute является локальным, а какая удаленной.</span><span class="sxs-lookup"><span data-stu-id="0cb31-175">hello VNets don't know which ExpressRoute circuit is local and which one is remote.</span></span> <span data-ttu-id="0cb31-176">Таким образом, как равенства-стоимость-Multi-Path (ECMP) трафик tooload баланс между виртуальной сети, некоторые трафик, поступающий будет иметь более длинный путь hello и будут направляться на удаленный канал ExpressRoute hello.</span><span class="sxs-lookup"><span data-stu-id="0cb31-176">Consequently as they do Equal-Cost-Multi-Path (ECMP) routing tooload-balance inter-VNet traffic, some traffic flows will take hello longer path and get routed at hello remote ExpressRoute circuit.</span></span>

![Проблема маршрутизации ExpressRoute 3. Неоптимальная маршрутизация виртуальных сетей](./media/expressroute-optimize-routing/expressroute-case3-problem.png)

### <a name="solution-assign-a-high-weight-toolocal-connection"></a><span data-ttu-id="0cb31-178">Решение: назначить соединение toolocal высокой вес</span><span class="sxs-lookup"><span data-stu-id="0cb31-178">Solution: assign a high weight toolocal connection</span></span>
<span data-ttu-id="0cb31-179">Hello решением является простой.</span><span class="sxs-lookup"><span data-stu-id="0cb31-179">hello solution is simple.</span></span> <span data-ttu-id="0cb31-180">Поскольку расположение hello виртуальных сетей и hello цепи известно, сообщите нам какой путь, следует выбирать каждой виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="0cb31-180">Since you know where hello VNets and hello circuits are, you can tell us which path each VNet should prefer.</span></span> <span data-ttu-id="0cb31-181">Специально для этого примера назначить выше вес toohello локального подключения от удаленного подключения toohello (см. пример конфигурации hello [здесь](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span><span class="sxs-lookup"><span data-stu-id="0cb31-181">Specifically for this example, you assign a higher weight toohello local connection than toohello remote connection (see hello configuration example [here](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span></span> <span data-ttu-id="0cb31-182">Когда виртуальная сеть получает префикс hello hello другой виртуальной сети на несколько подключений, предпочтут hello соединения с трафика вес toosend hello, наибольший предназначенного для этого префикса.</span><span class="sxs-lookup"><span data-stu-id="0cb31-182">When a VNet receives hello prefix of hello other VNet on multiple connections it will prefer hello connection with hello highest weight toosend traffic destined for that prefix.</span></span>

![Решение ExpressRoute случай 3 - assign высокой вес toolocal подключения](./media/expressroute-optimize-routing/expressroute-case3-solution.png)

> [!NOTE]
> <span data-ttu-id="0cb31-184">Может влиять на маршрутизации из виртуальной сети tooyour в локальной сети, если имеется несколько каналов ExpressRoute, настроив вес hello подключения вместо применения путь AS, добавляя метод, описанный в hello второй сценарий выше.</span><span class="sxs-lookup"><span data-stu-id="0cb31-184">You can also influence routing from VNet tooyour on-premises network, if you have multiple ExpressRoute circuits, by configuring hello weight of a connection instead of applying AS PATH prepending, a technique described in hello second scenario above.</span></span> <span data-ttu-id="0cb31-185">Для каждого префикса всегда рассмотрим hello вес соединения перед hello, длина пути к AS при определении как toosend трафика.</span><span class="sxs-lookup"><span data-stu-id="0cb31-185">For each prefix, we will always look at hello connection weight before hello AS Path length when deciding how toosend traffic.</span></span>
>
>
