---
title: "Маршрутизация aaaAsymmetric | Документы Microsoft"
description: "В этой статье рассматриваются hello проблем, которые могут появиться клиента с помощью асимметричного маршрутизации в сети, имеющей несколько назначения tooa ссылки."
documentationcenter: na
services: expressroute
author: osamazia
manager: carmonm
editor: 
ms.assetid: a754bff9-95c9-44b5-9796-377fc21e8322
ms.service: expressroute
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/10/2016
ms.author: osamam
ms.openlocfilehash: 01a16242437a3674dcfe27b074911a829a6c1abd
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="asymmetric-routing-with-multiple-network-paths"></a><span data-ttu-id="3fa4b-103">Асимметричная маршрутизация с использованием нескольких сетевых путей</span><span class="sxs-lookup"><span data-stu-id="3fa4b-103">Asymmetric routing with multiple network paths</span></span>
<span data-ttu-id="3fa4b-104">В этой статье объясняется, как прямой и обратный сетевой трафик может проходить по разным маршрутам, если между исходным и целевым сетевыми расположениями есть несколько путей.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-104">This article explains how forward and return network traffic might take different routes when multiple paths are available between network source and destination.</span></span>

<span data-ttu-id="3fa4b-105">Его важные toounderstand два понятия toounderstand асимметричного маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-105">It's important toounderstand two concepts toounderstand asymmetric routing.</span></span> <span data-ttu-id="3fa4b-106">Один является результатом hello нескольких сетевых путей.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-106">One is hello effect of multiple network paths.</span></span> <span data-ttu-id="3fa4b-107">Hello других — как устройств, например межсетевой экран, сохранять состояние.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-107">hello other is how devices, like a firewall, keep state.</span></span> <span data-ttu-id="3fa4b-108">Устройства такого типа называются устройствами с отслеживанием состояния.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-108">These types of devices are called stateful devices.</span></span> <span data-ttu-id="3fa4b-109">Сочетание этих двух факторов создает сценарии, в какой сетевой трафик удаляется с отслеживанием состояния устройства hello с отслеживанием состояния устройства не обнаруживают, что был начат трафика с само устройство hello.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-109">A combination of these two factors creates scenarios in which network traffic is dropped by a stateful device because hello stateful device didn't detect that traffic originated with hello device itself.</span></span>

## <a name="multiple-network-paths"></a><span data-ttu-id="3fa4b-110">Несколько сетевых путей</span><span class="sxs-lookup"><span data-stu-id="3fa4b-110">Multiple network paths</span></span>
<span data-ttu-id="3fa4b-111">Если в корпоративной сети имеет только один toohello связи, который проходит по Интернету через поставщика услуг Интернета, все tooand трафика из Интернета hello hello же путь.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-111">When an enterprise network has only one link toohello Internet through their Internet service provider, all traffic tooand from hello Internet travels hello same path.</span></span> <span data-ttu-id="3fa4b-112">Часто компаниям покупок несколько каналов как избыточные пути tooimprove работы.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-112">Often, companies purchase multiple circuits, as redundant paths, tooimprove network uptime.</span></span> <span data-ttu-id="3fa4b-113">В этом случае он возможно, что трафик, идущий за пределами сети hello, toohello Интернета, проходит через одну ссылку и hello возврата трафик проходит через различные ссылки.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-113">When this happens, it's possible that traffic that goes outside of hello network, toohello Internet, goes through one link, and hello return traffic goes through a different link.</span></span> <span data-ttu-id="3fa4b-114">Это явление называется асимметричной маршрутизацией.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-114">This is commonly known as asymmetric routing.</span></span> <span data-ttu-id="3fa4b-115">В маршрутизации асимметричного обратного сетевого трафика принимает путь отличается от исходного потока hello.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-115">In asymmetric routing, reverse network traffic takes a different path from hello original flow.</span></span>

![Сеть с несколькими путями](./media/expressroute-asymmetric-routing/AsymmetricRouting3.png)

<span data-ttu-id="3fa4b-117">Несмотря на то, что в первую очередь происходит на hello Интернета, асимметричные маршрутизации также применяется tooother сочетания нескольких путей.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-117">Although it primarily occurs on hello Internet, asymmetric routing also applies tooother combinations of multiple paths.</span></span> <span data-ttu-id="3fa4b-118">Он применяется, например, как tooan Интернета и частного пути, которые выходят toohello одним местом назначения и toomultiple частного пути, которые go toohello того же конечного расположения.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-118">It applies, for example, both tooan Internet path and a private path that go toohello same destination, and toomultiple private paths that go toohello same destination.</span></span>

<span data-ttu-id="3fa4b-119">Каждый маршрутизатор вдоль способом hello из toodestination источника вычисляет лучший hello tooreach путь назначения.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-119">Each router along hello way, from source toodestination, computes hello best path tooreach a destination.</span></span> <span data-ttu-id="3fa4b-120">Hello маршрутизатора определение наиболее возможный путь зависит от двух основных факторов:</span><span class="sxs-lookup"><span data-stu-id="3fa4b-120">hello router's determination of best possible path is based on two main factors:</span></span>

* <span data-ttu-id="3fa4b-121">Маршрутизация между внешними сетями реализуется с помощью протокола маршрутизации BGP.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-121">Routing between external networks is based on a routing protocol, Border Gateway Protocol (BGP).</span></span> <span data-ttu-id="3fa4b-122">BGP принимает объявления из соседей и выполняет их через последовательность шагов toodetermine hello наиболее toohello предназначен конечный путь.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-122">BGP takes advertisements from neighbors and runs them through a series of steps toodetermine hello best path toohello intended destination.</span></span> <span data-ttu-id="3fa4b-123">Она хранит наилучший путь hello в свою таблицу маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-123">It stores hello best path in its routing table.</span></span>
* <span data-ttu-id="3fa4b-124">Длина маски подсети, связанные с маршрутом Hello влияет маршрутам.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-124">hello length of a subnet mask associated with a route influences routing paths.</span></span> <span data-ttu-id="3fa4b-125">Если маршрутизатор получает несколько объявлений для hello же IP-адрес, но с разные маски подсети, маршрутизатор hello является предпочтительным для объявления hello и маску подсети больше времени, так как он считается более конкретный маршрут.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-125">If a router receives multiple advertisements for hello same IP address but with different subnet masks, hello router prefers hello advertisement with a longer subnet mask because it's considered a more specific route.</span></span>

## <a name="stateful-devices"></a><span data-ttu-id="3fa4b-126">Устройства с отслеживанием состояния</span><span class="sxs-lookup"><span data-stu-id="3fa4b-126">Stateful devices</span></span>
<span data-ttu-id="3fa4b-127">Маршрутизаторы просмотрите hello IP-заголовок пакета для целей маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-127">Routers look at hello IP header of a packet for routing purposes.</span></span> <span data-ttu-id="3fa4b-128">Некоторые устройства найдите глубоко внутри пакет приветствия.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-128">Some devices look even deeper inside hello packet.</span></span> <span data-ttu-id="3fa4b-129">Как правило, эти устройства рассматривают заголовки на уровне 4 (протокол TCP либо UDP) или даже на уровне 7 (слой приложения).</span><span class="sxs-lookup"><span data-stu-id="3fa4b-129">Typically, these devices look at Layer4 (Transmission Control Protocol, or TCP; or User Datagram Protocol, or UDP), or even Layer7 (Application Layer) headers.</span></span> <span data-ttu-id="3fa4b-130">Это либо устройства для обеспечения безопасности, либо устройства для оптимизации пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-130">These kinds of devices are either security devices or bandwidth-optimization devices.</span></span> 

<span data-ttu-id="3fa4b-131">Распространенным примером устройства с отслеживанием состояния является брандмауэр.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-131">A firewall is a common example of a stateful device.</span></span> <span data-ttu-id="3fa4b-132">Брандмауэр разрешает или запрещает toopass пакетов через его интерфейсы на основе различных полей, таких как протокол, порт TCP/UDP и заголовки URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-132">A firewall allows or denies a packet toopass through its interfaces based on various fields such as protocol, TCP/UDP port, and URL headers.</span></span> <span data-ttu-id="3fa4b-133">Этот уровень проверки сетевых пакетов помещает интенсивную рабочую нагрузку на устройстве hello.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-133">This level of packet inspection puts a heavy processing load on hello device.</span></span> <span data-ttu-id="3fa4b-134">производительность tooimprove hello брандмауэр проверяет hello первого пакета потока.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-134">tooimprove performance, hello firewall inspects hello first packet of a flow.</span></span> <span data-ttu-id="3fa4b-135">Если он допускает tooproceed пакетов hello, здесь хранятся сведения потока hello в своей таблице состояний.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-135">If it allows hello packet tooproceed, it keeps hello flow information in its state table.</span></span> <span data-ttu-id="3fa4b-136">Все последующие пакеты связанные toothis потока допускаются зависимости от определения начального приветствия.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-136">All subsequent packets related toothis flow are allowed based on hello initial determination.</span></span> <span data-ttu-id="3fa4b-137">Пакет, который является частью существующего потока может начаться в брандмауэре hello.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-137">A packet that is part of an existing flow might arrive at hello firewall.</span></span> <span data-ttu-id="3fa4b-138">Если брандмауэр hello не содержит предыдущего состояния сведений о нем, брандмауэр hello удаляет пакет приветствия.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-138">If hello firewall has no prior state information about it, hello firewall drops hello packet.</span></span>

## <a name="asymmetric-routing-with-expressroute"></a><span data-ttu-id="3fa4b-139">Асимметричная маршрутизация с помощью ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="3fa4b-139">Asymmetric routing with ExpressRoute</span></span>
<span data-ttu-id="3fa4b-140">При подключении tooMicrosoft через Azure ExpressRoute изменения сети следующим образом:</span><span class="sxs-lookup"><span data-stu-id="3fa4b-140">When you connect tooMicrosoft through Azure ExpressRoute, your network changes like this:</span></span>

* <span data-ttu-id="3fa4b-141">У вас есть несколько tooMicrosoft ссылки.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-141">You have multiple links tooMicrosoft.</span></span> <span data-ttu-id="3fa4b-142">Одна связь существующего подключения к Интернету, который hello других через ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-142">One link is your existing Internet connection, and hello other is via ExpressRoute.</span></span> <span data-ttu-id="3fa4b-143">Некоторые tooMicrosoft трафик может проходить через Интернет hello, но вернитесь через ExpressRoute, или наоборот.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-143">Some traffic tooMicrosoft might go through hello Internet but come back via ExpressRoute, or vice versa.</span></span>
* <span data-ttu-id="3fa4b-144">Вам присваиваются более конкретные IP-адреса через ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-144">You receive more specific IP addresses via ExpressRoute.</span></span> <span data-ttu-id="3fa4b-145">Таким образом для входящего трафика с tooMicrosoft вашей сети для служб, предложенных через ExpressRoute маршрутизаторы всегда рекомендуется использовать ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-145">So, for traffic from your network tooMicrosoft for services offered via ExpressRoute, routers always prefer ExpressRoute.</span></span>

<span data-ttu-id="3fa4b-146">эффект hello toounderstand имеет эти два изменения в сети, давайте рассмотрим некоторые сценарии.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-146">toounderstand hello effect these two changes have on a network, let’s consider some scenarios.</span></span> <span data-ttu-id="3fa4b-147">Например имеется только один канал toohello Интернета и использовать все службы Майкрософт через Интернет hello.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-147">As an example, you have only one circuit toohello Internet and you consume all Microsoft services via hello Internet.</span></span> <span data-ttu-id="3fa4b-148">Hello трафик от вашей сети tooMicrosoft и обратно перебирает hello же ссылку Интернет и проходит через брандмауэр hello.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-148">hello traffic from your network tooMicrosoft and back traverses hello same Internet link and passes through hello firewall.</span></span> <span data-ttu-id="3fa4b-149">записи брандмауэра Hello hello потока, как она видит первого пакета hello и возвращать пакетов разрешены, так как существует hello потока из таблицы состояний hello.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-149">hello firewall records hello flow as it sees hello first packet and return packets are allowed because hello flow exists in hello state table.</span></span>

![Асимметричная маршрутизация с помощью ExpressRoute](./media/expressroute-asymmetric-routing/AsymmetricRouting1.png)

<span data-ttu-id="3fa4b-151">Затем включите ExpressRoute для использования служб, предлагаемых корпорацией Майкрософт, через ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-151">Then, you turn on ExpressRoute and consume services offered by Microsoft over ExpressRoute.</span></span> <span data-ttu-id="3fa4b-152">Все другие службы Майкрософт потребляются через Интернет hello.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-152">All other services from Microsoft are consumed over hello Internet.</span></span> <span data-ttu-id="3fa4b-153">Развернуть отдельный брандмауэр границе, подключенных tooExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-153">You deploy a separate firewall at your edge that is connected tooExpressRoute.</span></span> <span data-ttu-id="3fa4b-154">Корпорация Майкрософт объявляет более конкретных сетевых префиксов tooyour через ExpressRoute для определенных служб.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-154">Microsoft advertises more specific prefixes tooyour network over ExpressRoute for specific services.</span></span> <span data-ttu-id="3fa4b-155">Инфраструктуру маршрутизации ExpressRoute выбирает в качестве предпочтительного пути hello для этих префиксов.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-155">Your routing infrastructure chooses ExpressRoute as hello preferred path for those prefixes.</span></span> <span data-ttu-id="3fa4b-156">Если не вы размещаете рекламу ваш открытый tooMicrosoft IP-адресов через ExpressRoute, Microsoft взаимодействует с вашей общих IP-адресов через Интернет hello.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-156">If you are not advertising your public IP addresses tooMicrosoft over ExpressRoute, Microsoft communicates with your public IP addresses via hello Internet.</span></span> <span data-ttu-id="3fa4b-157">Перенаправлял трафик из вашей сети tooMicrosoft используется ExpressRoute, а обратный трафик от Microsoft hello Интернета.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-157">Forward traffic from your network tooMicrosoft uses ExpressRoute, and reverse traffic from Microsoft uses hello Internet.</span></span> <span data-ttu-id="3fa4b-158">При hello брандмауэра на границе hello видит ответный пакет для потока, который не найден в таблице состояния hello, он сбрасывает hello ответного трафика.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-158">When hello firewall at hello edge sees a response packet for a flow that it does not find in hello state table, it drops hello return traffic.</span></span>

<span data-ttu-id="3fa4b-159">При выборе hello toouse пул же преобразование сетевых адресов (NAT) для ExpressRoute и hello Интернета, вы увидите аналогичные проблемы с клиентами hello в сети на частных IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-159">If you choose toouse hello same network address translation (NAT) pool for ExpressRoute and for hello Internet, you'll see similar issues with hello clients in your network on private IP addresses.</span></span> <span data-ttu-id="3fa4b-160">Запросы для служб, таких как Центр обновления Windows перейти через Интернет hello, поскольку IP-адресов для этих служб не распространяются через ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-160">Requests for services like Windows Update go via hello Internet because IP addresses for these services are not advertised via ExpressRoute.</span></span> <span data-ttu-id="3fa4b-161">Однако возвращаемый трафик hello возвращаются через ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-161">However, hello return traffic comes back via ExpressRoute.</span></span> <span data-ttu-id="3fa4b-162">Если корпорация Майкрософт получает IP-адрес с hello же маску подсети из Интернета hello и ExpressRoute, он предпочитает hello Интернет ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-162">If Microsoft receives an IP address with hello same subnet mask from hello Internet and ExpressRoute, it prefers ExpressRoute over hello Internet.</span></span> <span data-ttu-id="3fa4b-163">Если брандмауэр или другое устройство с отслеживанием состояния, в вашей сети и с выходом ExpressRoute нет предыдущих сведений о потоке hello, он удаляет приветственных пакетов, которые принадлежат toothat потока.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-163">If a firewall or another stateful device that is on your network edge and facing ExpressRoute has no prior information about hello flow, it drops hello packets that belong toothat flow.</span></span>

## <a name="asymmetric-routing-solutions"></a><span data-ttu-id="3fa4b-164">Решения при асимметричной маршрутизации</span><span class="sxs-lookup"><span data-stu-id="3fa4b-164">Asymmetric routing solutions</span></span>
<span data-ttu-id="3fa4b-165">У вас есть два основных варианта toosolve hello проблема асимметричного маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-165">You have two main options toosolve hello problem of asymmetric routing.</span></span> <span data-ttu-id="3fa4b-166">Один — по маршрутизация, а hello другие — с помощью источника под управлением NAT (SNAT).</span><span class="sxs-lookup"><span data-stu-id="3fa4b-166">One is through routing, and hello other is by using source-based NAT (SNAT).</span></span>

### <a name="routing"></a><span data-ttu-id="3fa4b-167">Маршрутизация</span><span class="sxs-lookup"><span data-stu-id="3fa4b-167">Routing</span></span>
<span data-ttu-id="3fa4b-168">Убедитесь, что открытый IP-адреса объявленной tooappropriate ссылкам глобальной сети (WAN).</span><span class="sxs-lookup"><span data-stu-id="3fa4b-168">Ensure that your public IP addresses are advertised tooappropriate wide area network (WAN) links.</span></span> <span data-ttu-id="3fa4b-169">Например если требуется для проверки подлинности трафика и ExpressRoute toouse hello Internet mail трафика следует не объявляет общедоступные IP-адреса службы федерации Active Directory (AD FS) по ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-169">For example, if you want toouse hello Internet for authentication traffic and ExpressRoute for your mail traffic, you should not advertise your Active Directory Federation Services (AD FS) public IP addresses over ExpressRoute.</span></span> <span data-ttu-id="3fa4b-170">Аналогичным образом, убедитесь, что не tooexpose значение локального адреса tooIP сервера AD FS, которые hello маршрутизатор получает по ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-170">Similarly, be sure not tooexpose an on-premises AD FS server tooIP addresses that hello router receives over ExpressRoute.</span></span> <span data-ttu-id="3fa4b-171">Маршрутов, полученных через ExpressRoute более различаются, поэтому они делают ExpressRoute hello предпочтительного пути для проверки подлинности трафика tooMicrosoft.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-171">Routes received over ExpressRoute are more specific so they make ExpressRoute hello preferred path for authentication traffic tooMicrosoft.</span></span> <span data-ttu-id="3fa4b-172">Это приведет к асимметричной маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-172">This causes asymmetric routing.</span></span>

<span data-ttu-id="3fa4b-173">Следует toouse ExpressRoute для проверки подлинности, убедитесь, что вы размещаете рекламу общедоступные IP-адреса службы федерации Active Directory через ExpressRoute без NAT.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-173">If you want toouse ExpressRoute for authentication, make sure that you are advertising AD FS public IP addresses over ExpressRoute without NAT.</span></span> <span data-ttu-id="3fa4b-174">Таким образом, трафик, исходит от корпорации Майкрософт и tooan выходит из локального сервера AD FS должен проходить через ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-174">This way, traffic that originates from Microsoft and goes tooan on-premises AD FS server goes over ExpressRoute.</span></span> <span data-ttu-id="3fa4b-175">Возвращаемый трафик от клиента tooMicrosoft использует ExpressRoute, так как это предпочтительный маршрута hello через Интернет hello.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-175">Return traffic from customer tooMicrosoft uses ExpressRoute because it's hello preferred route over hello Internet.</span></span>

### <a name="source-based-nat"></a><span data-ttu-id="3fa4b-176">NAT на основе источника</span><span class="sxs-lookup"><span data-stu-id="3fa4b-176">Source-based NAT</span></span>
<span data-ttu-id="3fa4b-177">Еще один способ решения проблемы асимметричной маршрутизации — SNAT.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-177">Another way of solving asymmetric routing issues is by using SNAT.</span></span> <span data-ttu-id="3fa4b-178">Например вы не разгласили hello общедоступный IP-адрес локального сервера Simple Mail Transfer Protocol (SMTP) по ExpressRoute так, как планировалось hello toouse Интернета для этого типа обмена данными.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-178">For example, you have not advertised hello public IP address of an on-premises Simple Mail Transfer Protocol (SMTP) server over ExpressRoute because you intend toouse hello Internet for this type of communication.</span></span> <span data-ttu-id="3fa4b-179">Запрос, который поступил с корпорацией Майкрософт, а затем — tooyour в локальном hello Интернета, проходит через SMTP-сервер.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-179">A request that originates with Microsoft and then goes tooyour on-premises SMTP server traverses hello Internet.</span></span> <span data-ttu-id="3fa4b-180">Вы SNAT hello входящего запроса tooan внутренний IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-180">You SNAT hello incoming request tooan internal IP address.</span></span> <span data-ttu-id="3fa4b-181">Обратный трафик с SMTP-сервера hello направляется toohello пограничным брандмауэром (который можно использовать преобразования сетевых адресов) вместо через ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-181">Reverse traffic from hello SMTP server goes toohello edge firewall (which you use for NAT) instead of through ExpressRoute.</span></span> <span data-ttu-id="3fa4b-182">Hello возвращаемого трафик направляется обратно через Интернет hello.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-182">hello return traffic goes back via hello Internet.</span></span>

![Конфигурация сети во время SNAT](./media/expressroute-asymmetric-routing/AsymmetricRouting2.png)

## <a name="asymmetric-routing-detection"></a><span data-ttu-id="3fa4b-184">Обнаружение асимметричной маршрутизации</span><span class="sxs-lookup"><span data-stu-id="3fa4b-184">Asymmetric routing detection</span></span>
<span data-ttu-id="3fa4b-185">Трассировка маршрута — hello лучшим способом toomake убедиться, что сетевым трафиком проходящий через hello Ожидался путь.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-185">Traceroute is hello best way toomake sure that your network traffic is traversing hello expected path.</span></span> <span data-ttu-id="3fa4b-186">Если ожидается трафика от вашей локальной SMTP сервера tooMicrosoft tootake hello Интернет-пути, hello ожидается, что трассировка маршрута из tooOffice сервера SMTP hello 365.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-186">If you expect traffic from your on-premises SMTP server tooMicrosoft tootake hello Internet path, hello expected traceroute is from hello SMTP server tooOffice 365.</span></span> <span data-ttu-id="3fa4b-187">результат Hello проверяет, что трафик на самом деле выходит из сети к Интернету hello, а не на ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="3fa4b-187">hello result validates that traffic is indeed leaving your network toward hello Internet and not toward ExpressRoute.</span></span>

