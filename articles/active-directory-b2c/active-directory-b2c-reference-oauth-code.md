---
title: "Azure AD B2C: поток кода авторизации | Документация Майкрософт"
description: "Узнайте, как создавать веб-приложения с использованием протокола аутентификации Azure AD B2C и OpenID Connect."
services: active-directory-b2c
documentationcenter: 
author: saeedakhter-msft
manager: krassk
editor: parakhj
ms.assetid: c371aaab-813a-4317-97df-b62e2f53d865
ms.service: active-directory-b2c
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/16/2017
ms.author: saeedakhter-msft
ms.openlocfilehash: dfc4f2e84704307ccbea6141c0dbc8d089733b22
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="azure-active-directory-b2c-oauth-20-authorization-code-flow"></a><span data-ttu-id="a8471-103">Azure Active Directory B2C: поток кода авторизации OAuth 2.0</span><span class="sxs-lookup"><span data-stu-id="a8471-103">Azure Active Directory B2C: OAuth 2.0 authorization code flow</span></span>
<span data-ttu-id="a8471-104">Код авторизации OAuth 2.0 может использоваться в приложениях, установленных на устройстве, для получения доступа к защищенным ресурсам, таким как веб-API.</span><span class="sxs-lookup"><span data-stu-id="a8471-104">You can use the OAuth 2.0 authorization code grant in apps installed on a device to gain access to protected resources, such as web APIs.</span></span> <span data-ttu-id="a8471-105">С помощью реализации OAuth 2.0 в Azure Active Directory B2C можно добавить регистрацию, вход и другие задачи по управлению пользователями в мобильные и настольные приложения.</span><span class="sxs-lookup"><span data-stu-id="a8471-105">By using the Azure Active Directory B2C (Azure AD B2C) implementation of OAuth 2.0, you can add sign-up, sign-in, and other identity management tasks to your mobile and desktop apps.</span></span> <span data-ttu-id="a8471-106">Эта статья не зависит от языка.</span><span class="sxs-lookup"><span data-stu-id="a8471-106">This article is language-independent.</span></span> <span data-ttu-id="a8471-107">В ней описывается, как отправлять и получать сообщения HTTP, не используя ни одну из библиотек с открытым исходным кодом.</span><span class="sxs-lookup"><span data-stu-id="a8471-107">In the article, we describe how to send and receive HTTP messages without using any open-source libraries.</span></span>

<!-- TODO: Need link to libraries -->

<span data-ttu-id="a8471-108">Описание потока кода авторизации OAuth 2.0 см. в [разделе 4.1 спецификации OAuth 2.0](http://tools.ietf.org/html/rfc6749).</span><span class="sxs-lookup"><span data-stu-id="a8471-108">The OAuth 2.0 authorization code flow is described in [section 4.1 of the OAuth 2.0 specification](http://tools.ietf.org/html/rfc6749).</span></span> <span data-ttu-id="a8471-109">Его можно использовать для проверки подлинности и авторизации в большинстве типов приложений, включая [веб-приложения](active-directory-b2c-apps.md#web-apps) и [изначально установленные приложения](active-directory-b2c-apps.md#mobile-and-native-apps).</span><span class="sxs-lookup"><span data-stu-id="a8471-109">You can use it for authentication and authorization in most app types, including [web apps](active-directory-b2c-apps.md#web-apps) and [natively installed apps](active-directory-b2c-apps.md#mobile-and-native-apps).</span></span> <span data-ttu-id="a8471-110">Вы можете использовать поток кода авторизации OAuth 2.0, чтобы безопасно получать *маркеры доступа* для приложений, с помощью которых можно получить доступ к ресурсам, защищенным [сервером авторизации](active-directory-b2c-reference-protocols.md#the-basics).</span><span class="sxs-lookup"><span data-stu-id="a8471-110">You can use the OAuth 2.0 authorization code flow to securely acquire *access tokens* for your apps, which can be used to access resources that are secured by an [authorization server](active-directory-b2c-reference-protocols.md#the-basics).</span></span>

<span data-ttu-id="a8471-111">В этой статье мы сосредоточимся на потоке кода авторизации OAuth 2.0 для **открытых клиентов**.</span><span class="sxs-lookup"><span data-stu-id="a8471-111">This article focuses on the **public clients** OAuth 2.0 authorization code flow.</span></span> <span data-ttu-id="a8471-112">Открытый клиент — это любое клиентское приложение, которому нельзя доверять в безопасном сохранении целостности секретного пароля.</span><span class="sxs-lookup"><span data-stu-id="a8471-112">A public client is any client application that cannot be trusted to securely maintain the integrity of a secret password.</span></span> <span data-ttu-id="a8471-113">К ним относятся мобильные приложения, приложения для настольных компьютеров и практически любые приложения, которые выполняются на устройстве и должны получать маркеры доступа.</span><span class="sxs-lookup"><span data-stu-id="a8471-113">This includes mobile apps, desktop apps, and essentially any application that runs on a device and needs to get access tokens.</span></span> 

> [!NOTE]
> <span data-ttu-id="a8471-114">Чтобы добавить управление идентификацией в веб-приложение с помощью Azure AD B2C, используйте [OpenID Connect](active-directory-b2c-reference-oidc.md), а не OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="a8471-114">To add identity management to a web app by using Azure AD B2C, use [OpenID Connect](active-directory-b2c-reference-oidc.md) instead of OAuth 2.0.</span></span>

<span data-ttu-id="a8471-115">В Azure AD B2C стандартные потоки OAuth 2.0 выходят за рамки простой проверки подлинности и авторизации.</span><span class="sxs-lookup"><span data-stu-id="a8471-115">Azure AD B2C extends the standard OAuth 2.0 flows to do more than simple authentication and authorization.</span></span> <span data-ttu-id="a8471-116">В этой службе появляется [параметр политики](active-directory-b2c-reference-policies.md).</span><span class="sxs-lookup"><span data-stu-id="a8471-116">It introduces the [policy parameter](active-directory-b2c-reference-policies.md).</span></span> <span data-ttu-id="a8471-117">С помощью внедренных политик можно использовать OAuth 2.0 для добавления в приложение действий по управлению пользователями, таких как регистрация, вход и управление профилями.</span><span class="sxs-lookup"><span data-stu-id="a8471-117">With built-in policies, you can use OAuth 2.0 to add user experiences to your app, such as sign-up, sign-in, and profile management.</span></span> <span data-ttu-id="a8471-118">В этой статье мы покажем, как с помощью OAuth 2.0 и политик реализовать каждую из этих функций в собственных приложениях</span><span class="sxs-lookup"><span data-stu-id="a8471-118">In this article, we show you how to use OAuth 2.0 and policies to implement each of these experiences in your native applications.</span></span> <span data-ttu-id="a8471-119">и получить маркеры доступа к веб-интерфейсам API.</span><span class="sxs-lookup"><span data-stu-id="a8471-119">We also show you how to get access tokens for accessing web APIs.</span></span>

<span data-ttu-id="a8471-120">В приведенных в этой статье запросах HTTP используется наш пример каталога Azure AD B2C **fabrikamb2c.onmicrosoft.com**, а также наши примеры приложения и политик.</span><span class="sxs-lookup"><span data-stu-id="a8471-120">In the example HTTP requests in this article, we use our sample Azure AD B2C directory, **fabrikamb2c.onmicrosoft.com**. We also use our sample application and policies.</span></span> <span data-ttu-id="a8471-121">Вы можете пробовать выполнять запросы с этими значениями или заменить их собственными.</span><span class="sxs-lookup"><span data-stu-id="a8471-121">You can try the requests yourself by using these values, or you can replace them with your own values.</span></span>
<span data-ttu-id="a8471-122">Узнайте, как [получить собственный каталог Azure AD B2C, приложение и политики](#use-your-own-azure-ad-b2c-directory).</span><span class="sxs-lookup"><span data-stu-id="a8471-122">Learn how to [get your own Azure AD B2C directory, application, and policies](#use-your-own-azure-ad-b2c-directory).</span></span>

## <a name="1-get-an-authorization-code"></a><span data-ttu-id="a8471-123">1. Получение кода авторизации</span><span class="sxs-lookup"><span data-stu-id="a8471-123">1. Get an authorization code</span></span>
<span data-ttu-id="a8471-124">Поток кода авторизации начинается с того, что клиент направляет пользователя к конечной точке `/authorize` .</span><span class="sxs-lookup"><span data-stu-id="a8471-124">The authorization code flow begins with the client directing the user to the `/authorize` endpoint.</span></span> <span data-ttu-id="a8471-125">Это интерактивная часть потока, в которой пользователь выполняет действие.</span><span class="sxs-lookup"><span data-stu-id="a8471-125">This is the interactive part of the flow, where the user takes action.</span></span> <span data-ttu-id="a8471-126">В этом запросе клиент указывает в параметре `scope` разрешения, которые ему требуется получить от пользователя.</span><span class="sxs-lookup"><span data-stu-id="a8471-126">In this request, the client indicates in the `scope` parameter the permissions that it needs to acquire from the user.</span></span> <span data-ttu-id="a8471-127">В параметре `p` он указывает политику, которую необходимо выполнить.</span><span class="sxs-lookup"><span data-stu-id="a8471-127">In the `p` parameter, it indicates the policy to execute.</span></span> <span data-ttu-id="a8471-128">Ниже приведены три примера (переносы строк добавлены для удобства чтения), в которых используются разные политики.</span><span class="sxs-lookup"><span data-stu-id="a8471-128">The following three examples (with line breaks for readability) each use a different policy.</span></span>

### <a name="use-a-sign-in-policy"></a><span data-ttu-id="a8471-129">Пример с политикой входа в систему</span><span class="sxs-lookup"><span data-stu-id="a8471-129">Use a sign-in policy</span></span>
```
GET https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6
&response_type=code
&redirect_uri=urn%3Aietf%3Awg%3Aoauth%3A2.0%3Aoob
&response_mode=query
&scope=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6%20offline_access
&state=arbitrary_data_you_can_receive_in_the_response
&p=b2c_1_sign_in
```

### <a name="use-a-sign-up-policy"></a><span data-ttu-id="a8471-130">Пример с политикой регистрации</span><span class="sxs-lookup"><span data-stu-id="a8471-130">Use a sign-up policy</span></span>
```
GET https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6
&response_type=code
&redirect_uri=urn%3Aietf%3Awg%3Aoauth%3A2.0%3Aoob
&response_mode=query
&scope=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6%20offline_access
&state=arbitrary_data_you_can_receive_in_the_response
&p=b2c_1_sign_up
```

### <a name="use-an-edit-profile-policy"></a><span data-ttu-id="a8471-131">Пример с политикой изменения профиля</span><span class="sxs-lookup"><span data-stu-id="a8471-131">Use an edit-profile policy</span></span>
```
GET https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6
&response_type=code
&redirect_uri=urn%3Aietf%3Awg%3Aoauth%3A2.0%3Aoob
&response_mode=query
&scope=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6%20offline_access
&state=arbitrary_data_you_can_receive_in_the_response
&p=b2c_1_edit_profile
```

| <span data-ttu-id="a8471-132">Параметр</span><span class="sxs-lookup"><span data-stu-id="a8471-132">Parameter</span></span> | <span data-ttu-id="a8471-133">Обязательный?</span><span class="sxs-lookup"><span data-stu-id="a8471-133">Required?</span></span> | <span data-ttu-id="a8471-134">Описание</span><span class="sxs-lookup"><span data-stu-id="a8471-134">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="a8471-135">client_id</span><span class="sxs-lookup"><span data-stu-id="a8471-135">client_id</span></span> |<span data-ttu-id="a8471-136">Обязательно</span><span class="sxs-lookup"><span data-stu-id="a8471-136">Required</span></span> |<span data-ttu-id="a8471-137">Идентификатор приложения, назначенный вашему приложению на [портале Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="a8471-137">The application ID assigned to your app in the [Azure portal](https://portal.azure.com).</span></span> |
| <span data-ttu-id="a8471-138">response_type</span><span class="sxs-lookup"><span data-stu-id="a8471-138">response_type</span></span> |<span data-ttu-id="a8471-139">Обязательно</span><span class="sxs-lookup"><span data-stu-id="a8471-139">Required</span></span> |<span data-ttu-id="a8471-140">Тип ответа, который должен содержать `code` для потока кода авторизации.</span><span class="sxs-lookup"><span data-stu-id="a8471-140">The response type, which must include `code` for the authorization code flow.</span></span> |
| <span data-ttu-id="a8471-141">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="a8471-141">redirect_uri</span></span> |<span data-ttu-id="a8471-142">Обязательно</span><span class="sxs-lookup"><span data-stu-id="a8471-142">Required</span></span> |<span data-ttu-id="a8471-143">URI перенаправления приложения, на который можно отправлять ответы проверки подлинности для их получения приложением.</span><span class="sxs-lookup"><span data-stu-id="a8471-143">The redirect URI of your app, where authentication responses are sent and received by your app.</span></span> <span data-ttu-id="a8471-144">Он должен в точности соответствовать одному из URI перенаправления, зарегистрированных на портале, но иметь форму закодированного URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="a8471-144">It must exactly match one of the redirect URIs that you registered in the portal, except that it must be URL-encoded.</span></span> |
| <span data-ttu-id="a8471-145">scope</span><span class="sxs-lookup"><span data-stu-id="a8471-145">scope</span></span> |<span data-ttu-id="a8471-146">Обязательно</span><span class="sxs-lookup"><span data-stu-id="a8471-146">Required</span></span> |<span data-ttu-id="a8471-147">Список областей с разделителями-пробелами.</span><span class="sxs-lookup"><span data-stu-id="a8471-147">A space-separated list of scopes.</span></span> <span data-ttu-id="a8471-148">При указании одной области в Azure Active Directory (Azure AD) также обозначаются запрашиваемые разрешения.</span><span class="sxs-lookup"><span data-stu-id="a8471-148">A single scope value indicates to Azure Active Directory (Azure AD) both of the permissions that are being requested.</span></span> <span data-ttu-id="a8471-149">Использование идентификатора клиента в качестве области указывает на то, что приложению нужен маркер доступа, который может использоваться в вашей службе или веб-API, представленных таким же идентификатором клиента.</span><span class="sxs-lookup"><span data-stu-id="a8471-149">Using the client ID as the scope indicates that your app needs an access token that can be used against your own service or web API, represented by the same client ID.</span></span>  <span data-ttu-id="a8471-150">Область `offline_access` означает, что вашему приложению потребуется маркер обновления для продолжительного доступа к ресурсам.</span><span class="sxs-lookup"><span data-stu-id="a8471-150">The `offline_access` scope indicates that your app needs a refresh token for long-lived access to resources.</span></span> <span data-ttu-id="a8471-151">Вы также можете использовать область `openid` для запроса идентификатора маркера из Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="a8471-151">You also can use the `openid` scope to request an ID token from Azure AD B2C.</span></span> |
| <span data-ttu-id="a8471-152">response_mode</span><span class="sxs-lookup"><span data-stu-id="a8471-152">response_mode</span></span> |<span data-ttu-id="a8471-153">Рекомендуется</span><span class="sxs-lookup"><span data-stu-id="a8471-153">Recommended</span></span> |<span data-ttu-id="a8471-154">Метод, используемый для отправки полученного кода авторизации приложению.</span><span class="sxs-lookup"><span data-stu-id="a8471-154">The method that you use to send the resulting authorization code back to your app.</span></span> <span data-ttu-id="a8471-155">Он может иметь значение `query`, `form_post` или `fragment`.</span><span class="sxs-lookup"><span data-stu-id="a8471-155">It can be `query`, `form_post`, or `fragment`.</span></span> |
| <span data-ttu-id="a8471-156">state</span><span class="sxs-lookup"><span data-stu-id="a8471-156">state</span></span> |<span data-ttu-id="a8471-157">Рекомендуется</span><span class="sxs-lookup"><span data-stu-id="a8471-157">Recommended</span></span> |<span data-ttu-id="a8471-158">Значение, включенное в запрос, которое также возвращается в ответе маркера.</span><span class="sxs-lookup"><span data-stu-id="a8471-158">A value included in the request that is returned in the token response.</span></span> <span data-ttu-id="a8471-159">Это может быть строка любого содержимого.</span><span class="sxs-lookup"><span data-stu-id="a8471-159">It can be a string of any content that you want to use.</span></span> <span data-ttu-id="a8471-160">Как правило, с целью предотвращения подделки межсайтовых запросов используется генерируемое случайным образом уникальное значение.</span><span class="sxs-lookup"><span data-stu-id="a8471-160">Usually, a randomly generated unique value is  used, to prevent cross-site request forgery attacks.</span></span> <span data-ttu-id="a8471-161">Этот параметр также включает информацию о состоянии пользователя в приложении перед созданием запроса на проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="a8471-161">The state also is used to encode information about the user's state in the app before the authentication request occurred.</span></span> <span data-ttu-id="a8471-162">Например, об открытой пользователем в тот момент странице или выполняемой политике.</span><span class="sxs-lookup"><span data-stu-id="a8471-162">For example, the page the user was on, or the policy that was being executed.</span></span> |
| <span data-ttu-id="a8471-163">p</span><span class="sxs-lookup"><span data-stu-id="a8471-163">p</span></span> |<span data-ttu-id="a8471-164">Обязательно</span><span class="sxs-lookup"><span data-stu-id="a8471-164">Required</span></span> |<span data-ttu-id="a8471-165">Выполняемая политика.</span><span class="sxs-lookup"><span data-stu-id="a8471-165">The policy that is executed.</span></span> <span data-ttu-id="a8471-166">Это имя политики, созданной в каталоге Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="a8471-166">It's the name of a policy that is created in your Azure AD B2C directory.</span></span> <span data-ttu-id="a8471-167">Оно должно начинаться с **b2c\_1\_**.</span><span class="sxs-lookup"><span data-stu-id="a8471-167">The policy name value should begin with **b2c\_1\_**.</span></span> <span data-ttu-id="a8471-168">Дополнительные сведения о политиках см. в статье [Azure Active Directory B2C: расширяемая инфраструктура политик](active-directory-b2c-reference-policies.md).</span><span class="sxs-lookup"><span data-stu-id="a8471-168">To learn more about policies, see [Azure AD B2C built-in policies](active-directory-b2c-reference-policies.md).</span></span> |
| <span data-ttu-id="a8471-169">prompt</span><span class="sxs-lookup"><span data-stu-id="a8471-169">prompt</span></span> |<span data-ttu-id="a8471-170">Необязательно</span><span class="sxs-lookup"><span data-stu-id="a8471-170">Optional</span></span> |<span data-ttu-id="a8471-171">Требуемый тип взаимодействия с пользователем.</span><span class="sxs-lookup"><span data-stu-id="a8471-171">The type of user interaction that is required.</span></span> <span data-ttu-id="a8471-172">Сейчас единственное допустимое значение — это `login`, при котором пользователю приходится вводить учетные данные по запросу.</span><span class="sxs-lookup"><span data-stu-id="a8471-172">Currently, the only valid value is `login`, which forces the user to enter their credentials on that request.</span></span> <span data-ttu-id="a8471-173">Единый вход не сработает.</span><span class="sxs-lookup"><span data-stu-id="a8471-173">Single sign-on will not take effect.</span></span> |

<span data-ttu-id="a8471-174">На этом этапе пользователю предлагается выполнить рабочий процесс политики.</span><span class="sxs-lookup"><span data-stu-id="a8471-174">At this point, the user is asked to complete the policy's workflow.</span></span> <span data-ttu-id="a8471-175">Для этого могут потребоваться ввод имени пользователя и пароля, вход с помощью удостоверения социальной сети, регистрация в каталоге или любые другие шаги.</span><span class="sxs-lookup"><span data-stu-id="a8471-175">This might involve the user entering their username and password, signing in with a social identity, signing up for the directory, or any other number of steps.</span></span> <span data-ttu-id="a8471-176">Действия пользователя определяются в политике.</span><span class="sxs-lookup"><span data-stu-id="a8471-176">User actions depend on how the policy is defined.</span></span>

<span data-ttu-id="a8471-177">Когда пользователь выполнит рабочий процесс политики, служба Azure AD вернет ответ приложению, используя значение, указанное для `redirect_uri`.</span><span class="sxs-lookup"><span data-stu-id="a8471-177">After the user completes the policy, Azure AD returns a response to your app at the value you used for `redirect_uri`.</span></span> <span data-ttu-id="a8471-178">Она использует метод, указанный в параметре `response_mode`.</span><span class="sxs-lookup"><span data-stu-id="a8471-178">It uses the method specified in the `response_mode` parameter.</span></span> <span data-ttu-id="a8471-179">Во всех сценариях действий пользователя ответ будет одинаковым независимо от политики, которая была выполнена.</span><span class="sxs-lookup"><span data-stu-id="a8471-179">The response is exactly the same for each of the user action scenarios, independent of the policy that was executed.</span></span>

<span data-ttu-id="a8471-180">Успешный ответ с использованием метода `response_mode=query` выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="a8471-180">A successful response that uses `response_mode=query` looks like this:</span></span>

```
GET urn:ietf:wg:oauth:2.0:oob?
code=AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq...        // the authorization_code, truncated
&state=arbitrary_data_you_can_receive_in_the_response                // the value provided in the request
```

| <span data-ttu-id="a8471-181">Параметр</span><span class="sxs-lookup"><span data-stu-id="a8471-181">Parameter</span></span> | <span data-ttu-id="a8471-182">Описание</span><span class="sxs-lookup"><span data-stu-id="a8471-182">Description</span></span> |
| --- | --- |
| <span data-ttu-id="a8471-183">Код</span><span class="sxs-lookup"><span data-stu-id="a8471-183">code</span></span> |<span data-ttu-id="a8471-184">Запрашиваемый приложением код авторизации.</span><span class="sxs-lookup"><span data-stu-id="a8471-184">The authorization code that the app requested.</span></span> <span data-ttu-id="a8471-185">Приложение может использовать код авторизации для запроса маркера доступа для целевого ресурса.</span><span class="sxs-lookup"><span data-stu-id="a8471-185">The app can use the authorization code to request an access token for a target resource.</span></span> <span data-ttu-id="a8471-186">Срок действия кодов авторизации крайне мал.</span><span class="sxs-lookup"><span data-stu-id="a8471-186">Authorization codes are very short-lived.</span></span> <span data-ttu-id="a8471-187">и обычно истекает по прошествии порядка 10 минут.</span><span class="sxs-lookup"><span data-stu-id="a8471-187">Typically, they expire after about 10 minutes.</span></span> |
| <span data-ttu-id="a8471-188">state</span><span class="sxs-lookup"><span data-stu-id="a8471-188">state</span></span> |<span data-ttu-id="a8471-189">Полное описание см. в таблице выше.</span><span class="sxs-lookup"><span data-stu-id="a8471-189">See the full description in the table in the preceding section.</span></span> <span data-ttu-id="a8471-190">Если запрос содержит параметр `state`, то в ответе должно отображаться то же значение.</span><span class="sxs-lookup"><span data-stu-id="a8471-190">If a `state` parameter is included in the request, the same value should appear in the response.</span></span> <span data-ttu-id="a8471-191">Приложение должно проверить, совпадают ли значения параметра `state` в запросе и ответе.</span><span class="sxs-lookup"><span data-stu-id="a8471-191">The app should verify that the `state` values in the request and response are identical.</span></span> |

<span data-ttu-id="a8471-192">Сообщения об ошибках также можно отправлять на универсальный код ресурса (URI) перенаправления, чтобы приложение могло их правильно обработать:</span><span class="sxs-lookup"><span data-stu-id="a8471-192">Error responses also can be sent to the redirect URI so that the app can handle them appropriately:</span></span>

```
GET urn:ietf:wg:oauth:2.0:oob?
error=access_denied
&error_description=The+user+has+cancelled+entering+self-asserted+information
&state=arbitrary_data_you_can_receive_in_the_response
```

| <span data-ttu-id="a8471-193">Параметр</span><span class="sxs-lookup"><span data-stu-id="a8471-193">Parameter</span></span> | <span data-ttu-id="a8471-194">Описание</span><span class="sxs-lookup"><span data-stu-id="a8471-194">Description</span></span> |
| --- | --- |
| <span data-ttu-id="a8471-195">error</span><span class="sxs-lookup"><span data-stu-id="a8471-195">error</span></span> |<span data-ttu-id="a8471-196">Строка кода ошибки, которую можно использовать для классификации типов возникающих ошибок</span><span class="sxs-lookup"><span data-stu-id="a8471-196">An error code string that you can use to classify the types of errors that occur.</span></span> <span data-ttu-id="a8471-197">и реагирования на них.</span><span class="sxs-lookup"><span data-stu-id="a8471-197">You also can use the string to react to errors.</span></span> |
| <span data-ttu-id="a8471-198">error_description</span><span class="sxs-lookup"><span data-stu-id="a8471-198">error_description</span></span> |<span data-ttu-id="a8471-199">Конкретное сообщение об ошибке, с помощью которого можно определить первопричину возникновения ошибки аутентификации.</span><span class="sxs-lookup"><span data-stu-id="a8471-199">A specific error message that can help you identify the root cause of an authentication error.</span></span> |
| <span data-ttu-id="a8471-200">state</span><span class="sxs-lookup"><span data-stu-id="a8471-200">state</span></span> |<span data-ttu-id="a8471-201">См. полное описание в предыдущей таблице.</span><span class="sxs-lookup"><span data-stu-id="a8471-201">See the full description in the preceding table.</span></span> <span data-ttu-id="a8471-202">Если запрос содержит параметр `state`, то в ответе должно отображаться то же значение.</span><span class="sxs-lookup"><span data-stu-id="a8471-202">If a `state` parameter is included in the request, the same value should appear in the response.</span></span> <span data-ttu-id="a8471-203">Приложение должно проверить, совпадают ли значения параметра `state` в запросе и ответе.</span><span class="sxs-lookup"><span data-stu-id="a8471-203">The app should verify that the `state` values in the request and response are identical.</span></span> |

## <a name="2-get-a-token"></a><span data-ttu-id="a8471-204">2) Получение маркера</span><span class="sxs-lookup"><span data-stu-id="a8471-204">2. Get a token</span></span>
<span data-ttu-id="a8471-205">После получения кода авторизации можно использовать `code`, чтобы получить маркер для целевого ресурса путем отправки запроса POST на конечную точку `/token`.</span><span class="sxs-lookup"><span data-stu-id="a8471-205">Now that you've acquired an authorization code, you can redeem the `code` for a token to the intended resource by sending a POST request to the `/token` endpoint.</span></span> <span data-ttu-id="a8471-206">В Azure AD B2C вы можете запросить маркер только для веб-API серверной части вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="a8471-206">In Azure AD B2C, the only resource that you can request a token for is your app's own back-end web API.</span></span> <span data-ttu-id="a8471-207">В соответствии с соглашением, которое используется при запросе маркера для себя, следует использовать идентификатор клиента в качестве области.</span><span class="sxs-lookup"><span data-stu-id="a8471-207">The convention that's used for requesting a token to yourself is to use your app's client ID as the scope:</span></span>

```
POST fabrikamb2c.onmicrosoft.com/oauth2/v2.0/token?p=b2c_1_sign_in HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code&client_id=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6&scope=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6 offline_access&code=AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq...&redirect_uri=urn:ietf:wg:oauth:2.0:oob

```

| <span data-ttu-id="a8471-208">Параметр</span><span class="sxs-lookup"><span data-stu-id="a8471-208">Parameter</span></span> | <span data-ttu-id="a8471-209">Обязательный?</span><span class="sxs-lookup"><span data-stu-id="a8471-209">Required?</span></span> | <span data-ttu-id="a8471-210">Описание</span><span class="sxs-lookup"><span data-stu-id="a8471-210">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="a8471-211">p</span><span class="sxs-lookup"><span data-stu-id="a8471-211">p</span></span> |<span data-ttu-id="a8471-212">Обязательно</span><span class="sxs-lookup"><span data-stu-id="a8471-212">Required</span></span> |<span data-ttu-id="a8471-213">Политика, которая использовалась для получения кода авторизации.</span><span class="sxs-lookup"><span data-stu-id="a8471-213">The policy that was used to acquire the authorization code.</span></span> <span data-ttu-id="a8471-214">Другую политику в этом запросе использовать нельзя.</span><span class="sxs-lookup"><span data-stu-id="a8471-214">You cannot use a different policy in this request.</span></span> <span data-ttu-id="a8471-215">Обратите внимание, что этот параметр добавляется к *строке запроса*, а не в тело запроса POST.</span><span class="sxs-lookup"><span data-stu-id="a8471-215">Note that you add this parameter to the *query string*, not in the POST body.</span></span> |
| <span data-ttu-id="a8471-216">client_id</span><span class="sxs-lookup"><span data-stu-id="a8471-216">client_id</span></span> |<span data-ttu-id="a8471-217">Обязательно</span><span class="sxs-lookup"><span data-stu-id="a8471-217">Required</span></span> |<span data-ttu-id="a8471-218">Идентификатор приложения, назначенный вашему приложению на [портале Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="a8471-218">The application ID assigned to your app in the [Azure portal](https://portal.azure.com).</span></span> |
| <span data-ttu-id="a8471-219">grant_type</span><span class="sxs-lookup"><span data-stu-id="a8471-219">grant_type</span></span> |<span data-ttu-id="a8471-220">Обязательно</span><span class="sxs-lookup"><span data-stu-id="a8471-220">Required</span></span> |<span data-ttu-id="a8471-221">Тип предоставления.</span><span class="sxs-lookup"><span data-stu-id="a8471-221">The type of grant.</span></span> <span data-ttu-id="a8471-222">Для потока кода авторизации это должен быть тип `authorization_code`.</span><span class="sxs-lookup"><span data-stu-id="a8471-222">For the authorization code flow, the grant type must be `authorization_code`.</span></span> |
| <span data-ttu-id="a8471-223">scope</span><span class="sxs-lookup"><span data-stu-id="a8471-223">scope</span></span> |<span data-ttu-id="a8471-224">Рекомендуется</span><span class="sxs-lookup"><span data-stu-id="a8471-224">Recommended</span></span> |<span data-ttu-id="a8471-225">Список областей с разделителями-пробелами.</span><span class="sxs-lookup"><span data-stu-id="a8471-225">A space-separated list of scopes.</span></span> <span data-ttu-id="a8471-226">При указании одной области также обозначаются запрашиваемые разрешения.</span><span class="sxs-lookup"><span data-stu-id="a8471-226">A single scope value indicates to Azure AD both of the permissions that are being requested.</span></span> <span data-ttu-id="a8471-227">Использование идентификатора клиента в качестве области указывает на то, что приложению нужен маркер доступа, который может использоваться в вашей службе или веб-API, представленных таким же идентификатором клиента.</span><span class="sxs-lookup"><span data-stu-id="a8471-227">Using the client ID as the scope indicates that your app needs an access token that can be used against your own service or web API, represented by the same client ID.</span></span>  <span data-ttu-id="a8471-228">Область `offline_access` означает, что вашему приложению потребуется маркер обновления для продолжительного доступа к ресурсам.</span><span class="sxs-lookup"><span data-stu-id="a8471-228">The `offline_access` scope indicates that your app needs a refresh token for long-lived access to resources.</span></span>  <span data-ttu-id="a8471-229">Вы также можете использовать область `openid` для запроса идентификатора маркера из Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="a8471-229">You also can use the `openid` scope to request an ID token from Azure AD B2C.</span></span> |
| <span data-ttu-id="a8471-230">Код</span><span class="sxs-lookup"><span data-stu-id="a8471-230">code</span></span> |<span data-ttu-id="a8471-231">Обязательно</span><span class="sxs-lookup"><span data-stu-id="a8471-231">Required</span></span> |<span data-ttu-id="a8471-232">Код авторизации, полученный на первом участке потока.</span><span class="sxs-lookup"><span data-stu-id="a8471-232">The authorization code that you acquired in the first leg of the flow.</span></span> |
| <span data-ttu-id="a8471-233">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="a8471-233">redirect_uri</span></span> |<span data-ttu-id="a8471-234">Обязательно</span><span class="sxs-lookup"><span data-stu-id="a8471-234">Required</span></span> |<span data-ttu-id="a8471-235">URI перенаправления приложения, в котором вы получили код авторизации.</span><span class="sxs-lookup"><span data-stu-id="a8471-235">The redirect URI of the application where you received the authorization code.</span></span> |

<span data-ttu-id="a8471-236">Успешный ответ маркера выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="a8471-236">A successful token response looks like this:</span></span>

```
{
    "not_before": "1442340812",
    "token_type": "Bearer",
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...",
    "scope": "90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6 offline_access",
    "expires_in": "3600",
    "refresh_token": "AAQfQmvuDy8WtUv-sd0TBwWVQs1rC-Lfxa_NDkLqpg50Cxp5Dxj0VPF1mx2Z...",
}
```
| <span data-ttu-id="a8471-237">Параметр</span><span class="sxs-lookup"><span data-stu-id="a8471-237">Parameter</span></span> | <span data-ttu-id="a8471-238">Описание</span><span class="sxs-lookup"><span data-stu-id="a8471-238">Description</span></span> |
| --- | --- |
| <span data-ttu-id="a8471-239">not_before</span><span class="sxs-lookup"><span data-stu-id="a8471-239">not_before</span></span> |<span data-ttu-id="a8471-240">Момент времени, в который маркер начинает считаться действительным (с начала эпохи).</span><span class="sxs-lookup"><span data-stu-id="a8471-240">The time at which the token is considered valid, in epoch time.</span></span> |
| <span data-ttu-id="a8471-241">token_type</span><span class="sxs-lookup"><span data-stu-id="a8471-241">token_type</span></span> |<span data-ttu-id="a8471-242">Значение типа маркера.</span><span class="sxs-lookup"><span data-stu-id="a8471-242">The token type value.</span></span> <span data-ttu-id="a8471-243">Единственный тип, поддерживаемый Azure AD — носитель.</span><span class="sxs-lookup"><span data-stu-id="a8471-243">The only type that Azure AD supports is Bearer.</span></span> |
| <span data-ttu-id="a8471-244">access_token</span><span class="sxs-lookup"><span data-stu-id="a8471-244">access_token</span></span> |<span data-ttu-id="a8471-245">Подписанный маркер JSON Web Token (JWT), который вы запрашивали.</span><span class="sxs-lookup"><span data-stu-id="a8471-245">The signed JSON Web Token (JWT) that you requested.</span></span> |
| <span data-ttu-id="a8471-246">scope</span><span class="sxs-lookup"><span data-stu-id="a8471-246">scope</span></span> |<span data-ttu-id="a8471-247">Области, для которых действителен маркер.</span><span class="sxs-lookup"><span data-stu-id="a8471-247">The scopes that the token is valid for.</span></span> <span data-ttu-id="a8471-248">Области также можно использовать, чтобы кэшировать маркеры для последующего использования.</span><span class="sxs-lookup"><span data-stu-id="a8471-248">You also can use scopes to cache tokens for later use.</span></span> |
| <span data-ttu-id="a8471-249">expires_in</span><span class="sxs-lookup"><span data-stu-id="a8471-249">expires_in</span></span> |<span data-ttu-id="a8471-250">Срок действия маркера (в секундах).</span><span class="sxs-lookup"><span data-stu-id="a8471-250">The length of time that the token is valid (in seconds).</span></span> |
| <span data-ttu-id="a8471-251">refresh_token</span><span class="sxs-lookup"><span data-stu-id="a8471-251">refresh_token</span></span> |<span data-ttu-id="a8471-252">Маркер обновления OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="a8471-252">An OAuth 2.0 refresh token.</span></span> <span data-ttu-id="a8471-253">Приложение может использовать этот маркер для получения дополнительных маркеров по истечении срока действия текущего маркера.</span><span class="sxs-lookup"><span data-stu-id="a8471-253">The app can use this token to acquire additional tokens after the current token expires.</span></span> <span data-ttu-id="a8471-254">Маркеры обновления имеют большой срок действия.</span><span class="sxs-lookup"><span data-stu-id="a8471-254">Refresh tokens are long-lived.</span></span> <span data-ttu-id="a8471-255">Их можно использовать для длительного сохранения доступа к ресурсам.</span><span class="sxs-lookup"><span data-stu-id="a8471-255">You can use them to retain access to resources for extended periods of time.</span></span> <span data-ttu-id="a8471-256">Дополнительные сведения см. в статье [Azure AD B2C: справочник по маркерам](active-directory-b2c-reference-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="a8471-256">For more information, see the [Azure AD B2C token reference](active-directory-b2c-reference-tokens.md).</span></span> |

<span data-ttu-id="a8471-257">Сообщения об ошибках выглядят следующим образом:</span><span class="sxs-lookup"><span data-stu-id="a8471-257">Error responses look like this:</span></span>

```
{
    "error": "access_denied",
    "error_description": "The user revoked access to the app.",
}
```

| <span data-ttu-id="a8471-258">Параметр</span><span class="sxs-lookup"><span data-stu-id="a8471-258">Parameter</span></span> | <span data-ttu-id="a8471-259">Описание</span><span class="sxs-lookup"><span data-stu-id="a8471-259">Description</span></span> |
| --- | --- |
| <span data-ttu-id="a8471-260">error</span><span class="sxs-lookup"><span data-stu-id="a8471-260">error</span></span> |<span data-ttu-id="a8471-261">Строка кода ошибки, которую можно использовать для классификации типов возникающих ошибок</span><span class="sxs-lookup"><span data-stu-id="a8471-261">An error code string that you can use to classify the types of errors that occur.</span></span> <span data-ttu-id="a8471-262">и реагирования на них.</span><span class="sxs-lookup"><span data-stu-id="a8471-262">You also can use the string to react to errors.</span></span> |
| <span data-ttu-id="a8471-263">error_description</span><span class="sxs-lookup"><span data-stu-id="a8471-263">error_description</span></span> |<span data-ttu-id="a8471-264">Конкретное сообщение об ошибке, с помощью которого можно определить первопричину возникновения ошибки аутентификации.</span><span class="sxs-lookup"><span data-stu-id="a8471-264">A specific error message that can help you identify the root cause of an authentication error.</span></span> |

## <a name="3-use-the-token"></a><span data-ttu-id="a8471-265">3. Использование маркера</span><span class="sxs-lookup"><span data-stu-id="a8471-265">3. Use the token</span></span>
<span data-ttu-id="a8471-266">После успешного получения маркера доступа маркер можно использовать в запросах к веб-API серверной части приложения, включая маркер в заголовок `Authorization`.</span><span class="sxs-lookup"><span data-stu-id="a8471-266">Now that you've successfully acquired an access token, you can use the token in requests to your back-end web APIs by including it in the `Authorization` header:</span></span>

```
GET /tasks
Host: https://mytaskwebapi.com
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...
```

## <a name="4-refresh-the-token"></a><span data-ttu-id="a8471-267">4. Обновление маркера</span><span class="sxs-lookup"><span data-stu-id="a8471-267">4. Refresh the token</span></span>
<span data-ttu-id="a8471-268">Срок действия маркеров доступа и маркеров идентификации крайне мал.</span><span class="sxs-lookup"><span data-stu-id="a8471-268">Access tokens and ID tokens are short-lived.</span></span> <span data-ttu-id="a8471-269">Для сохранения доступа к ресурсам маркеры с истекшим сроком действия необходимо обновлять.</span><span class="sxs-lookup"><span data-stu-id="a8471-269">After they expire, you must refresh them to continue to access resources.</span></span> <span data-ttu-id="a8471-270">Для этого нужно отправить еще один запрос POST в конечную точку `/token`,</span><span class="sxs-lookup"><span data-stu-id="a8471-270">To do this, submit another POST request to the `/token` endpoint.</span></span> <span data-ttu-id="a8471-271">указав `refresh_token` вместо `code`:</span><span class="sxs-lookup"><span data-stu-id="a8471-271">This time, provide the `refresh_token` instead of the `code`:</span></span>

```
POST fabrikamb2c.onmicrosoft.com/oauth2/v2.0/token?p=b2c_1_sign_in HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded

grant_type=refresh_token&client_id=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6&scope=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6 offline_access&refresh_token=AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq...&redirect_uri=urn:ietf:wg:oauth:2.0:oob
```

| <span data-ttu-id="a8471-272">Параметр</span><span class="sxs-lookup"><span data-stu-id="a8471-272">Parameter</span></span> | <span data-ttu-id="a8471-273">Обязательный?</span><span class="sxs-lookup"><span data-stu-id="a8471-273">Required?</span></span> | <span data-ttu-id="a8471-274">Описание</span><span class="sxs-lookup"><span data-stu-id="a8471-274">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="a8471-275">p</span><span class="sxs-lookup"><span data-stu-id="a8471-275">p</span></span> |<span data-ttu-id="a8471-276">Обязательно</span><span class="sxs-lookup"><span data-stu-id="a8471-276">Required</span></span> |<span data-ttu-id="a8471-277">Политика, которая использовалась для получения исходного маркера обновления.</span><span class="sxs-lookup"><span data-stu-id="a8471-277">The policy that was used to acquire the original refresh token.</span></span> <span data-ttu-id="a8471-278">Другую политику в этом запросе использовать нельзя.</span><span class="sxs-lookup"><span data-stu-id="a8471-278">You cannot use a different policy in this request.</span></span> <span data-ttu-id="a8471-279">Обратите внимание, что этот параметр добавляется к *строке запроса*, а не в тело запроса POST.</span><span class="sxs-lookup"><span data-stu-id="a8471-279">Note that you add this parameter to the *query string*, not in the POST body.</span></span> |
| <span data-ttu-id="a8471-280">client_id</span><span class="sxs-lookup"><span data-stu-id="a8471-280">client_id</span></span> |<span data-ttu-id="a8471-281">Рекомендуется</span><span class="sxs-lookup"><span data-stu-id="a8471-281">Recommended</span></span> |<span data-ttu-id="a8471-282">Идентификатор приложения, назначенный вашему приложению на [портале Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="a8471-282">The application ID assigned to your app in the [Azure portal](https://portal.azure.com).</span></span> |
| <span data-ttu-id="a8471-283">grant_type</span><span class="sxs-lookup"><span data-stu-id="a8471-283">grant_type</span></span> |<span data-ttu-id="a8471-284">Обязательно</span><span class="sxs-lookup"><span data-stu-id="a8471-284">Required</span></span> |<span data-ttu-id="a8471-285">Тип предоставления.</span><span class="sxs-lookup"><span data-stu-id="a8471-285">The type of grant.</span></span> <span data-ttu-id="a8471-286">Для этого участка потока кода авторизации это должен быть тип `refresh_token`.</span><span class="sxs-lookup"><span data-stu-id="a8471-286">For this leg of the authorization code flow, the grant type must be `refresh_token`.</span></span> |
| <span data-ttu-id="a8471-287">scope</span><span class="sxs-lookup"><span data-stu-id="a8471-287">scope</span></span> |<span data-ttu-id="a8471-288">Рекомендуется</span><span class="sxs-lookup"><span data-stu-id="a8471-288">Recommended</span></span> |<span data-ttu-id="a8471-289">Список областей с разделителями-пробелами.</span><span class="sxs-lookup"><span data-stu-id="a8471-289">A space-separated list of scopes.</span></span> <span data-ttu-id="a8471-290">При указании одной области также обозначаются запрашиваемые разрешения.</span><span class="sxs-lookup"><span data-stu-id="a8471-290">A single scope value indicates to Azure AD both of the permissions that are being requested.</span></span> <span data-ttu-id="a8471-291">Использование идентификатора клиента в качестве области указывает на то, что приложению нужен маркер доступа, который может использоваться в вашей службе или веб-API, представленных таким же идентификатором клиента.</span><span class="sxs-lookup"><span data-stu-id="a8471-291">Using the client ID as the scope indicates that your app needs an access token that can be used against your own service or web API, represented by the same client ID.</span></span>  <span data-ttu-id="a8471-292">Область `offline_access` означает, что вашему приложению потребуется маркер обновления для продолжительного доступа к ресурсам.</span><span class="sxs-lookup"><span data-stu-id="a8471-292">The `offline_access` scope indicates that your app will need a refresh token for long-lived access to resources.</span></span>  <span data-ttu-id="a8471-293">Вы также можете использовать область `openid` для запроса идентификатора маркера из Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="a8471-293">You also can use the `openid` scope to request an ID token from Azure AD B2C.</span></span> |
| <span data-ttu-id="a8471-294">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="a8471-294">redirect_uri</span></span> |<span data-ttu-id="a8471-295">Необязательно</span><span class="sxs-lookup"><span data-stu-id="a8471-295">Optional</span></span> |<span data-ttu-id="a8471-296">URI перенаправления приложения, в котором вы получили код авторизации.</span><span class="sxs-lookup"><span data-stu-id="a8471-296">The redirect URI of the application where you received the authorization code.</span></span> |
| <span data-ttu-id="a8471-297">refresh_token</span><span class="sxs-lookup"><span data-stu-id="a8471-297">refresh_token</span></span> |<span data-ttu-id="a8471-298">Обязательно</span><span class="sxs-lookup"><span data-stu-id="a8471-298">Required</span></span> |<span data-ttu-id="a8471-299">Исходный маркер обновления, полученный на втором участке потока.</span><span class="sxs-lookup"><span data-stu-id="a8471-299">The original refresh token that you acquired in the second leg of the flow.</span></span> |

<span data-ttu-id="a8471-300">Успешный ответ маркера выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="a8471-300">A successful token response looks like this:</span></span>

```
{
    "not_before": "1442340812",
    "token_type": "Bearer",
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...",
    "scope": "90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6 offline_access",
    "expires_in": "3600",
    "refresh_token": "AAQfQmvuDy8WtUv-sd0TBwWVQs1rC-Lfxa_NDkLqpg50Cxp5Dxj0VPF1mx2Z...",
}
```
| <span data-ttu-id="a8471-301">Параметр</span><span class="sxs-lookup"><span data-stu-id="a8471-301">Parameter</span></span> | <span data-ttu-id="a8471-302">Описание</span><span class="sxs-lookup"><span data-stu-id="a8471-302">Description</span></span> |
| --- | --- |
| <span data-ttu-id="a8471-303">not_before</span><span class="sxs-lookup"><span data-stu-id="a8471-303">not_before</span></span> |<span data-ttu-id="a8471-304">Момент времени, в который маркер начинает считаться действительным (с начала эпохи).</span><span class="sxs-lookup"><span data-stu-id="a8471-304">The time at which the token is considered valid, in epoch time.</span></span> |
| <span data-ttu-id="a8471-305">token_type</span><span class="sxs-lookup"><span data-stu-id="a8471-305">token_type</span></span> |<span data-ttu-id="a8471-306">Значение типа маркера.</span><span class="sxs-lookup"><span data-stu-id="a8471-306">The token type value.</span></span> <span data-ttu-id="a8471-307">Единственный тип, поддерживаемый Azure AD — носитель.</span><span class="sxs-lookup"><span data-stu-id="a8471-307">The only type that Azure AD supports is Bearer.</span></span> |
| <span data-ttu-id="a8471-308">access_token</span><span class="sxs-lookup"><span data-stu-id="a8471-308">access_token</span></span> |<span data-ttu-id="a8471-309">Подписанный маркер JWT, который вы запрашивали.</span><span class="sxs-lookup"><span data-stu-id="a8471-309">The signed JWT that you requested.</span></span> |
| <span data-ttu-id="a8471-310">scope</span><span class="sxs-lookup"><span data-stu-id="a8471-310">scope</span></span> |<span data-ttu-id="a8471-311">Области, для которых действителен маркер.</span><span class="sxs-lookup"><span data-stu-id="a8471-311">The scopes that the token is valid for.</span></span> <span data-ttu-id="a8471-312">Области также можно использовать, чтобы кэшировать маркеры для последующего использования.</span><span class="sxs-lookup"><span data-stu-id="a8471-312">You also can use the scopes to cache tokens for later use.</span></span> |
| <span data-ttu-id="a8471-313">expires_in</span><span class="sxs-lookup"><span data-stu-id="a8471-313">expires_in</span></span> |<span data-ttu-id="a8471-314">Срок действия маркера (в секундах).</span><span class="sxs-lookup"><span data-stu-id="a8471-314">The length of time that the token is valid (in seconds).</span></span> |
| <span data-ttu-id="a8471-315">refresh_token</span><span class="sxs-lookup"><span data-stu-id="a8471-315">refresh_token</span></span> |<span data-ttu-id="a8471-316">Маркер обновления OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="a8471-316">An OAuth 2.0 refresh token.</span></span> <span data-ttu-id="a8471-317">Приложение может использовать этот маркер для получения дополнительных маркеров по истечении срока действия текущего маркера.</span><span class="sxs-lookup"><span data-stu-id="a8471-317">The app can use this token to acquire additional tokens after the current token expires.</span></span> <span data-ttu-id="a8471-318">У маркеров обновления длительный срок действия. Их можно использовать, чтобы надолго сохранять доступ к ресурсам.</span><span class="sxs-lookup"><span data-stu-id="a8471-318">Refresh tokens are long-lived, and can be used to retain access to resources for extended periods of time.</span></span> <span data-ttu-id="a8471-319">Дополнительные сведения см. в статье [Azure AD B2C: справочник по маркерам](active-directory-b2c-reference-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="a8471-319">For more information, see the [Azure AD B2C token reference](active-directory-b2c-reference-tokens.md).</span></span> |

<span data-ttu-id="a8471-320">Сообщения об ошибках выглядят следующим образом:</span><span class="sxs-lookup"><span data-stu-id="a8471-320">Error responses look like this:</span></span>

```
{
    "error": "access_denied",
    "error_description": "The user revoked access to the app.",
}
```

| <span data-ttu-id="a8471-321">Параметр</span><span class="sxs-lookup"><span data-stu-id="a8471-321">Parameter</span></span> | <span data-ttu-id="a8471-322">Описание</span><span class="sxs-lookup"><span data-stu-id="a8471-322">Description</span></span> |
| --- | --- |
| <span data-ttu-id="a8471-323">error</span><span class="sxs-lookup"><span data-stu-id="a8471-323">error</span></span> |<span data-ttu-id="a8471-324">Строка кода ошибки, которую можно использовать для классификации типов возникающих ошибок</span><span class="sxs-lookup"><span data-stu-id="a8471-324">An error code string that you can use to classify types of errors that occur.</span></span> <span data-ttu-id="a8471-325">и реагирования на них.</span><span class="sxs-lookup"><span data-stu-id="a8471-325">You also can use the string to react to errors.</span></span> |
| <span data-ttu-id="a8471-326">error_description</span><span class="sxs-lookup"><span data-stu-id="a8471-326">error_description</span></span> |<span data-ttu-id="a8471-327">Конкретное сообщение об ошибке, с помощью которого можно определить первопричину возникновения ошибки аутентификации.</span><span class="sxs-lookup"><span data-stu-id="a8471-327">A specific error message that can help you identify the root cause of an authentication error.</span></span> |

## <a name="use-your-own-azure-ad-b2c-directory"></a><span data-ttu-id="a8471-328">Использование собственного каталога Azure AD B2C</span><span class="sxs-lookup"><span data-stu-id="a8471-328">Use your own Azure AD B2C directory</span></span>
<span data-ttu-id="a8471-329">Чтобы отправить эти запросы самостоятельно, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="a8471-329">To try these requests yourself, complete the following steps.</span></span> <span data-ttu-id="a8471-330">Замените значения, приведенные в этой статье в качестве примера, собственными.</span><span class="sxs-lookup"><span data-stu-id="a8471-330">Replace the example values we used in this article with your own values.</span></span>

1. <span data-ttu-id="a8471-331">[Создайте каталог Azure AD B2C](active-directory-b2c-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="a8471-331">[Create an Azure AD B2C directory](active-directory-b2c-get-started.md).</span></span> <span data-ttu-id="a8471-332">Используйте имя своего каталога в запросах.</span><span class="sxs-lookup"><span data-stu-id="a8471-332">Use the name of your directory in the requests.</span></span>
2. <span data-ttu-id="a8471-333">[Создайте приложение](active-directory-b2c-app-registration.md) для получения идентификатора приложения и URI перенаправления.</span><span class="sxs-lookup"><span data-stu-id="a8471-333">[Create an application](active-directory-b2c-app-registration.md) to obtain an application ID and a redirect URI.</span></span> <span data-ttu-id="a8471-334">Включите собственный клиент в приложение.</span><span class="sxs-lookup"><span data-stu-id="a8471-334">Include a native client in your app.</span></span>
3. <span data-ttu-id="a8471-335">[Создайте собственные политики](active-directory-b2c-reference-policies.md) для получения имен политик.</span><span class="sxs-lookup"><span data-stu-id="a8471-335">[Create your policies](active-directory-b2c-reference-policies.md) to obtain your policy names.</span></span>

