---
title: "Azure AD B2C: вход в веб-приложения с помощью OpenID Connect | Документация Майкрософт"
description: "Создание веб-приложений с помощью реализации протокола проверки подлинности OpenID Connect в Azure Active Directory"
services: active-directory-b2c
documentationcenter: 
author: saeedakhter-msft
manager: mtillman
editor: parakhj
ms.assetid: 21d420c8-3c10-4319-b681-adf2e89e7ede
ms.service: active-directory-b2c
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/16/2017
ms.author: saeedakhter-msft
ms.openlocfilehash: 0eb4194307d1d3953fa1cd88ac014ac7c2ba7311
ms.sourcegitcommit: e266df9f97d04acfc4a843770fadfd8edf4fa2b7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2017
---
# <a name="azure-active-directory-b2c-web-sign-in-with-openid-connect"></a>Azure Active Directory B2C: вход в веб-приложения с помощью OpenID Connect
OpenID Connect — это протокол проверки подлинности на основе OAuth 2.0, который может использоваться для безопасного входа пользователей в веб-приложения. Используя реализацию OpenID Connect в Azure Active Directory B2C (Azure AD B2C), можно передать Azure Active Directory (Azure AD) регистрацию, вход в систему и другие действия по управлению пользователями в веб-приложениях. В этом руководстве показано, как это сделать (независимо от языка программирования). и описывает, как отправлять и получать сообщения HTTP, не используя ни одну из наших библиотек с открытым исходным кодом.

[OpenID Connect](http://openid.net/specs/openid-connect-core-1_0.html) расширяет возможности протокола *авторизации* OAuth 2.0 и позволяет использовать его в качестве протокола *проверки подлинности*, что позволяет вам выполнять единый вход с помощью OAuth. В этом протоколе вводится понятие *маркера идентификации*. Это токен безопасности, который позволяет клиенту выполнять идентификацию пользователя и получать основные сведения о профиле пользователя.

Так как OpenID Connect — это расширение OAuth 2.0, приложения могут безопасно получать *маркеры доступа*. обеспечивая возможность доступа к ресурсам, защищенным [сервером авторизации](active-directory-b2c-reference-protocols.md#the-basics). Мы рекомендуем использовать OpenID Connect для веб-приложений, которые размещаются на сервере и доступны через веб-браузер. Если вы хотите добавить идентификацию пользователей с помощью Azure AD B2C в мобильные или настольные приложения, необходимо использовать [OAuth 2.0](active-directory-b2c-reference-oauth-code.md), а не OpenID Connect.

В Azure AD B2C стандартный протокол OpenID Connect выходит за рамки простой проверки подлинности и авторизации. В нем появляется [параметр политики](active-directory-b2c-reference-policies.md), который позволяет использовать OpenID Connect для добавления в приложение таких действий по управлению пользователями, как регистрация, вход и управление профилями. Здесь мы покажем, как с помощью OpenID Connect и политик реализовать каждую из этих функций в собственных веб-приложениях. Мы также покажем, как получить маркеры доступа к веб-API.

В HTTP-запросах в следующем разделе будут использованы наш пример каталога B2C (fabrikamb2c.onmicrosoft.com), а также наш пример приложения (https://aadb2cplayground.azurewebsites.net) и политики. Вы можете пробовать выполнять запросы с этими значениями или заменить их на собственные.
Узнайте, как [получить собственный клиент, приложение и политики B2C](#use-your-own-b2c-directory).

## <a name="send-authentication-requests"></a>Отправка запросов проверки подлинности
Если веб-приложению требуется проверить подлинность пользователя и выполнить политику, оно может направить его к конечной точке `/authorize` . Это интерактивная часть потока, в которой пользователь выполняет действие в зависимости от политики.

В этом запросе клиент указывает разрешения, которые необходимо получить от пользователя в параметре `scope`, и политики, которые нужно выполнить в параметре `p`. В следующих разделах приведены три примера для разных политик (переносы строк добавлены для удобства чтения). Чтобы понять, как работает каждый запрос, попробуйте вставить его в браузер и запустить.

#### <a name="use-a-sign-in-policy"></a>Пример с политикой входа в систему
```
GET https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6
&response_type=code+id_token
&redirect_uri=https%3A%2F%2Faadb2cplayground.azurewebsites.net%2F
&response_mode=form_post
&scope=openid%20offline_access
&state=arbitrary_data_you_can_receive_in_the_response
&nonce=12345
&p=b2c_1_sign_in
```

#### <a name="use-a-sign-up-policy"></a>Пример с политикой регистрации
```
GET https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6
&response_type=code+id_token
&redirect_uri=https%3A%2F%2Faadb2cplayground.azurewebsites.net%2F
&response_mode=form_post
&scope=openid%20offline_access
&state=arbitrary_data_you_can_receive_in_the_response
&nonce=12345
&p=b2c_1_sign_up
```

#### <a name="use-an-edit-profile-policy"></a>Пример с политикой изменения профиля
```
GET https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6
&response_type=code+id_token
&redirect_uri=https%3A%2F%2Faadb2cplayground.azurewebsites.net%2F
&response_mode=form_post
&scope=openid%20offline_access
&state=arbitrary_data_you_can_receive_in_the_response
&nonce=12345
&p=b2c_1_edit_profile
```

| Параметр | Обязательный? | ОПИСАНИЕ |
| --- | --- | --- |
| client_id |Требуется |Идентификатор приложения, который [портал Azure](https://portal.azure.com/) назначил вашему приложению. |
| response_type |Требуется |Тип ответа, который должен включать маркер идентификации для OpenID Connect. Если веб-приложению также потребуются токены для вызова веб-API, можете использовать `code+id_token`, как и в наших примерах. |
| redirect_uri |Рекомендуется |Параметр `redirect_uri` приложения, на который приложение может отправлять запросы проверки подлинности и с которого оно может получать ответы на эти запросы. Он должен в точности соответствовать одному из параметров `redirect_uri`, зарегистрированных на портале, но иметь форму закодированного URL-адреса. |
| scope |Требуется |Список областей с разделителями-пробелами. При указании одной области также указываются оба запрашиваемых разрешения для Azure AD. Область `openid` определяет разрешение на вход пользователя и получение данных о пользователе в форме маркеров идентификации (подробнее об этом далее в этой статье). Область `offline_access` для веб-приложений является необязательной. Она означает, что вашему приложению потребуется *маркер обновления* для продолжительного доступа к ресурсам. |
| response_mode |Рекомендуется |Метод, который следует использовать для отправки полученного кода авторизации приложению. Это может быть `query`, `form_post` или `fragment`.  Для максимальной безопасности рекомендуется использовать режим ответа `form_post`. |
| state |Рекомендуется |Значение, включенное в запрос, которое также возвращается в ответе маркера. Это может быть строка любого контента. Как правило, с целью предотвращения подделки межсайтовых запросов используется генерируемое случайным образом уникальное значение. Этот параметр также включает информацию о состоянии пользователя в приложении перед созданием запроса на проверку подлинности (например, об открытой в тот момент странице). |
| nonce |Требуется |Значение, включенное в запрос и созданное приложением, которое войдет в состав полученного маркера идентификации в качестве утверждения. Приложение может проверить это значение во избежание атак с использованием воспроизведения токена. Это значение обычно представляет собой случайную уникальную строку, которую можно использовать для определения источника запроса. |
| p |Требуется |Политика, которая будет выполняться. Это имя политики, созданной в клиенте B2C. Имя политики должно начинаться с `b2c\_1\_`. Дополнительные сведения о политиках см. в статье [Расширяемая платформа политик](active-directory-b2c-reference-policies.md). |
| prompt |Необязательно |Требуемый тип взаимодействия с пользователем. Сейчас единственное допустимое значение — `login`, при котором пользователю приходится вводить учетные данные по запросу. Единый вход не сработает. |

На этом этапе пользователю предлагается выполнить рабочий процесс политики. Для этого могут потребоваться ввод имени пользователя и пароля, вход с помощью удостоверения социальной сети, регистрация в каталоге или любые другие действия, определенные в политике.

Как только пользователь завершит политику, Azure AD вернет приложению ответ в указанный параметр `redirect_uri` с помощью метода, определенного в параметре `response_mode`. Во всех вышеперечисленных случаях ответ будет одинаковым независимо от политики, которая была выполнена.

Успешный ответ с использованием метода `response_mode=fragment` выглядит следующим образом:

```
GET https://aadb2cplayground.azurewebsites.net/#
id_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...
&code=AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq...
&state=arbitrary_data_you_can_receive_in_the_response
```

| Параметр | ОПИСАНИЕ |
| --- | --- |
| id_token |Маркер идентификации, запрошенный приложением. Вы можете использовать маркер идентификации для проверки личности пользователя и запуска сеанса пользователя. Дополнительные сведения о маркерах идентификации и их содержимом можно найти в [справочнике по маркерам Azure AD B2C](active-directory-b2c-reference-tokens.md). |
| Код |Код авторизации, который запросило приложение, если вы использовали `response_type=code+id_token`. Приложение может использовать код авторизации для запроса маркера доступа для целевого ресурса. Срок действия кодов авторизации крайне мал. и обычно истекает по прошествии порядка 10 минут. |
| state |Если запрос содержит параметр `state`, то в ответе должно отображаться то же значение. Приложение должно проверить, совпадают ли значения параметра `state` в запросе и ответе. |

Сообщения об ошибках также можно отправлять в параметр `redirect_uri`, чтобы приложение обрабатывало их должным образом:

```
GET https://aadb2cplayground.azurewebsites.net/#
error=access_denied
&error_description=the+user+canceled+the+authentication
&state=arbitrary_data_you_can_receive_in_the_response
```

| Параметр | ОПИСАНИЕ |
| --- | --- |
| error |Строка кода ошибки, которую можно использовать для классификации типов возникающих ошибок и реагирования на них. |
| error_description |Конкретное сообщение об ошибке, с помощью которого разработчик может определить причину возникновения ошибки проверки подлинности. |
| state |См. полное описание в первой таблице этого раздела. Если запрос содержит параметр `state`, то в ответе должно отображаться то же значение. Приложение должно проверить, совпадают ли значения параметра `state` в запросе и ответе. |

## <a name="validate-the-id-token"></a>Проверка маркера идентификации
Получение маркера идентификации не является достаточным для прохождения пользователем проверки подлинности. Необходимо проверить подпись маркера идентификации и сопоставить утверждения в маркере с требованиями вашего приложения. В Azure AD B2C для подписи маркеров и проверки их правильности используются [веб-маркеры JSON Web Token (JWT)](http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html) и шифрование с открытым ключом.

Для проверки JWT доступны многие библиотеки с открытым исходным кодом в зависимости от выбранного языка программирования. Мы рекомендуем изучить различные библиотеки, а не реализовывать логику проверки самостоятельно. Приведенные здесь сведения помогут понять, как правильно использовать эти библиотеки.

Azure AD B2C содержит конечную точку метаданных OpenID Connect, позволяющую приложению получать сведения о Azure AD B2C в среде выполнения. Эти сведения включают конечные точки, содержимое маркеров и ключи подписи маркеров. Для каждой политики в клиенте B2C есть собственный документ метаданных JSON. Например, документ метаданных для политики `b2c_1_sign_in` в `fabrikamb2c.onmicrosoft.com` находится в каталоге:

`https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/v2.0/.well-known/openid-configuration?p=b2c_1_sign_in`

Одно из свойств этого документа конфигурации — `jwks_uri`, значение которого для точно такой же политики будет следующим:

`https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/discovery/v2.0/keys?p=b2c_1_sign_in`.

Чтобы определить, какая политика была использована для подписывания маркера идентификации (а также определить, откуда необходимо получать метаданные), можно воспользоваться одним из двух вариантов. Во-первых, имя политики включено в утверждение `acr` маркера идентификации. Сведения об анализе утверждений маркера идентификации см. в [Справочнике по маркерам Azure AD B2C](active-directory-b2c-reference-tokens.md). Другой вариант — закодировать политику в значении параметра `state` при отправке запроса и затем декодировать ее, чтобы определить, какая политика была использована. Каждый из этих методов является допустимым.

После получения документа метаданных из конечной точки метаданных OpenID Connect можно использовать открытые ключи RSA256, расположенные в этой конечной точке, для проверки подписи маркера идентификации. В каждый момент времени в этой конечной точке может находиться множество ключей, каждый из которых определяется утверждением `kid`. Заголовок маркера идентификации также содержит утверждение `kid`, указывающее на ключ, который был использован для подписывания маркера идентификации. Дополнительные сведения см. в [справочнике по маркерам Azure AD B2C](active-directory-b2c-reference-tokens.md), включая раздел [Проверка маркеров](active-directory-b2c-reference-tokens.md#token-validation).
<!--TODO: Improve the information on this-->

После проверки подписи маркера идентификации вам потребуется проверить несколько утверждений. например

* Проверьте утверждение `nonce` во избежание атак с использованием воспроизведения маркера. Его значение должно совпадать с указанным вами в запросе на вход.
* Проверьте утверждение `aud` и убедитесь, что для вашего приложения был выдан маркер идентификации. Его значением должен быть идентификатор приложения вашего приложения.
* Проверьте утверждения `iat` и `exp`, чтобы убедиться, что срок действия маркера идентификации не истек.

Также существуют некоторые дополнительные проверки, которые необходимо выполнить. Они подробно описаны в разделе [Базовая спецификация OpenID](http://openid.net/specs/openid-connect-core-1_0.html).  Вам также может потребоваться проверить дополнительные утверждения в зависимости от сценария. Ниже приведены некоторые из стандартных проверок:

* Обеспечение регистрации пользователя или организации в приложении.
* Предоставление пользователю необходимого уровня авторизации и привилегий.
* Обеспечение определенного уровня проверки подлинности, например с помощью службы Многофакторной идентификации Azure.

Дополнительные сведения об утверждениях в маркере идентификации можно найти в [Справочнике по маркерам Azure AD B2C](active-directory-b2c-reference-tokens.md).

После проверки маркера идентификации можно запустить сеанс пользователя. В приложении используйте утверждения в маркере идентификации для получения сведений о пользователе. Эти сведения используются для отображения, получения записей и проверки подлинности.

## <a name="get-a-token"></a>Получение маркера
Если вашему веб-приложению требуется только выполнять политики, вы можете пропустить следующие несколько разделов. Эти разделы применяются только к веб-приложениям, которым необходимо выполнять вызовы веб-API, защищенные проверкой подлинности. Эти веб-приложения также защищены Azure AD B2C.

Чтобы воспользоваться кодом авторизации маркера для необходимого ресурса (полученным с помощью `response_type=code+id_token`), отправьте запрос `POST` на конечную точку `/token`. Сейчас единственный ресурс, для которого можно запросить маркер, — это веб-API серверной части вашего приложения. По соглашению при запросе маркера для себя следует использовать идентификатор клиента в качестве области.

```
POST fabrikamb2c.onmicrosoft.com/oauth2/v2.0/token?p=b2c_1_sign_in HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code&client_id=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6&scope=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6 offline_access&code=AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq...&redirect_uri=urn:ietf:wg:oauth:2.0:oob&client_secret=<your-application-secret>

```

| Параметр | Обязательный? | ОПИСАНИЕ |
| --- | --- | --- |
| p |Требуется |Политика, которая использовалась для получения кода авторизации. Другую политику в этом запросе использовать нельзя. Обратите внимание, что этот параметр добавляется к строке запроса, а не в тело запроса `POST`. |
| client_id |Требуется |Идентификатор приложения, который [портал Azure](https://portal.azure.com/) назначил вашему приложению. |
| grant_type |Требуется |Тип предоставления. Для потока кода авторизации это должен быть тип `authorization_code`. |
| scope |Рекомендуется |Список областей с разделителями-пробелами. При указании одной области также указываются оба запрашиваемых разрешения для Azure AD. Область `openid` определяет разрешение на вход пользователя и получение данных о пользователе в форме маркеров идентификации. Ее можно использовать для получения маркеров для веб-API серверной части приложения, идентификатор приложения которого совпадает с идентификатором приложения клиента. Область `offline_access` означает, что вашему приложению потребуется маркер обновления для продолжительного доступа к ресурсам. |
| Код |Требуется |Код авторизации, полученный на первом участке потока. |
| redirect_uri |Требуется |Параметр `redirect_uri` приложения, в котором вы получили код авторизации. |
| client_secret |Требуется |Секрет приложения, созданный на [портале Azure](https://portal.azure.com/). Это важный артефакт безопасности, и он должен безопасно храниться на сервере. Также следует периодически изменять секрет клиента. |

Успешный ответ маркера выглядит следующим образом:

```
{
    "not_before": "1442340812",
    "token_type": "Bearer",
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...",
    "scope": "90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6 offline_access",
    "expires_in": "3600",
    "refresh_token": "AAQfQmvuDy8WtUv-sd0TBwWVQs1rC-Lfxa_NDkLqpg50Cxp5Dxj0VPF1mx2Z...",
}
```
| Параметр | ОПИСАНИЕ |
| --- | --- |
| not_before |Момент времени, в который маркер начинает считаться действительным (с начала эпохи). |
| token_type |Значение типа маркера. Единственный тип, поддерживаемый Azure AD — `Bearer` |
| access_token |Подписанный маркер JWT, который вы запрашивали. |
| scope |Области, для которых действителен маркер. Их можно использовать для кэширования маркеров для последующего использования. |
| expires_in |Срок действия маркера доступа (в секундах). |
| refresh_token |Маркер обновления OAuth 2.0. Приложение может использовать этот маркер для получения дополнительных маркеров по истечении срока действия текущего маркера. Маркеры обновления обладают длительным сроком действия. Их можно использовать для продолжительного доступа к ресурсам. Дополнительные сведения см. в [справочнике по маркерам B2C](active-directory-b2c-reference-tokens.md). Обратите внимание, что для получения маркера обновления необходимо использовать область `offline_access` как в запросе авторизации, так и в запросе маркера. |

Сообщения об ошибках выглядят следующим образом:

```
{
    "error": "access_denied",
    "error_description": "The user revoked access to the app.",
}
```

| Параметр | ОПИСАНИЕ |
| --- | --- |
| error |Строка кода ошибки, которую можно использовать для классификации типов возникающих ошибок и реагирования на них. |
| error_description |Конкретное сообщение об ошибке, с помощью которого разработчик может определить причину возникновения ошибки проверки подлинности. |

## <a name="use-the-token"></a>Использование маркера
После успешного получения маркера доступа маркер можно использовать в запросах к веб-API серверной части приложения путем включения маркера в заголовок `Authorization`:

```
GET /tasks
Host: https://mytaskwebapi.com
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...
```

## <a name="refresh-the-token"></a>Обновление маркера
Срок действия маркеров идентификации крайне мал. Для сохранения доступа к ресурсам маркеры с истекшим сроком действия необходимо обновлять. Для этого нужно отправить еще один запрос `POST` в конечную точку `/token`, На этот раз укажите параметр `refresh_token` вместо параметра `code`:

```
POST fabrikamb2c.onmicrosoft.com/oauth2/v2.0/token?p=b2c_1_sign_in HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded

grant_type=refresh_token&client_id=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6&scope=openid offline_access&refresh_token=AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq...&redirect_uri=urn:ietf:wg:oauth:2.0:oob&client_secret=<your-application-secret>
```

| Параметр | Требуется | ОПИСАНИЕ |
| --- | --- | --- |
| p |Требуется |Политика, которая использовалась для получения исходного маркера обновления. Другую политику в этом запросе использовать нельзя. Обратите внимание, что этот параметр добавляется к строке запроса, а не в тело запроса POST. |
| client_id |Требуется |Идентификатор приложения, который [портал Azure](https://portal.azure.com/) назначил вашему приложению. |
| grant_type |Требуется |Тип предоставления. Для этого участка потока в коде проверки подлинности необходимо использовать маркер обновления. |
| scope |Рекомендуется |Список областей с разделителями-пробелами. При указании одной области также указываются оба запрашиваемых разрешения для Azure AD. Область `openid` определяет разрешение на вход пользователя и получение данных о пользователе в форме маркеров идентификации. Ее можно использовать для получения маркеров для веб-API серверной части приложения, идентификатор приложения которого совпадает с идентификатором приложения клиента. Область `offline_access` означает, что вашему приложению потребуется маркер обновления для продолжительного доступа к ресурсам. |
| redirect_uri |Рекомендуется |Параметр `redirect_uri` приложения, в котором вы получили код авторизации. |
| refresh_token |Требуется |Исходный маркер обновления, полученный на втором участке потока. Обратите внимание, что для получения маркера обновления необходимо использовать область `offline_access` как в запросе авторизации, так и в запросе маркера. |
| client_secret |Требуется |Секрет приложения, созданный на [портале Azure](https://portal.azure.com/). Это важный артефакт безопасности, и он должен безопасно храниться на сервере. Также следует периодически изменять секрет клиента. |

Успешный ответ маркера выглядит следующим образом:

```
{
    "not_before": "1442340812",
    "token_type": "Bearer",
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...",
    "scope": "90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6 offline_access",
    "expires_in": "3600",
    "refresh_token": "AAQfQmvuDy8WtUv-sd0TBwWVQs1rC-Lfxa_NDkLqpg50Cxp5Dxj0VPF1mx2Z...",
}
```
| Параметр | ОПИСАНИЕ |
| --- | --- |
| not_before |Момент времени, в который маркер начинает считаться действительным (с начала эпохи). |
| token_type |Значение типа маркера. Единственный тип, поддерживаемый Azure AD — `Bearer` |
| access_token |Подписанный маркер JWT, который вы запрашивали. |
| scope |Области, для которых маркер является действительным и которые можно использовать для кэширования маркеров для последующего использования. |
| expires_in |Срок действия маркера доступа (в секундах). |
| refresh_token |Маркер обновления OAuth 2.0. Приложение может использовать этот маркер для получения дополнительных маркеров по истечении срока действия текущего маркера.  Маркеры обновления обладают длительным сроком действия. Их можно использовать для продолжительного доступа к ресурсам. Дополнительные сведения можно найти в [справочнике по маркерам B2C](active-directory-b2c-reference-tokens.md). |

Сообщения об ошибках выглядят следующим образом:

```
{
    "error": "access_denied",
    "error_description": "The user revoked access to the app.",
}
```

| Параметр | ОПИСАНИЕ |
| --- | --- |
| error |Строка кода ошибки, которую можно использовать для классификации типов возникающих ошибок и реагирования на них. |
| error_description |Конкретное сообщение об ошибке, с помощью которого разработчик может определить причину возникновения ошибки проверки подлинности. |

## <a name="send-a-sign-out-request"></a>Отправка запроса на выход
Для выхода пользователя из приложения недостаточно очистить файлы cookie или каким-то другим образом завершить сеанс пользователя. Необходимо также перенаправить пользователя в Azure AD для выхода. Если этого не сделать, то пользователь сможет снова пройти проверку подлинности в приложении без ввода учетных данных, так как они будут иметь действительный сеанс единого входа с Azure AD.

Вы можете просто перенаправить пользователя на конечную точку `end_session`, которая указана в описанном выше документе метаданных OpenID (см. раздел "Проверка маркера идентификации"):

```
GET https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/oauth2/v2.0/logout?
p=b2c_1_sign_in
&post_logout_redirect_uri=https%3A%2F%2Faadb2cplayground.azurewebsites.net%2F
```

| Параметр | Обязательный? | ОПИСАНИЕ |
| --- | --- | --- |
| p |Требуется |Политика, которую вы хотите использовать для выхода пользователя из приложения. |
| post_logout_redirect_uri |Рекомендуется |URL-адрес, на который пользователя следует перенаправить после успешного выхода. Если он не указан, то Azure AD B2C покажет пользователю универсальное сообщение. |

> [!NOTE]
> Хотя при перенаправлении пользователя на конечную точку `end_session` часть данных о состоянии единого входа пользователя через Azure AD B2C будет удалена, фактически пользователь не выйдет из сеанса поставщика удостоверений социальных сетей. Если пользователь выберет тот же IDP во время последующего входа, он будет повторно аутентифицирован без ввода учетных данных. Если пользователь хочет выйти из приложения B2C, это совершенно не означает, что он также хочет выйти из учетной записи Facebook. Тем не менее для локальных учетных записей необходимо правильно завершить сеанс пользователя.
> 
> 

## <a name="use-your-own-b2c-tenant"></a>Использование собственного клиента B2C
Если вы хотите попробовать выполнить эти запросы самостоятельно, необходимо сначала выполнить следующие три шага, а затем заменить значения в примере выше на собственные:

1. [Создайте клиент B2C](active-directory-b2c-get-started.md)и используйте имя своего клиента в запросах.
2. [Создайте приложение](active-directory-b2c-app-registration.md) для получения идентификатора приложения. Включите в свое приложение веб-приложение или веб-API. При необходимости создайте секрет приложения.
3. [Создайте собственные политики](active-directory-b2c-reference-policies.md) для получения имен политик.

