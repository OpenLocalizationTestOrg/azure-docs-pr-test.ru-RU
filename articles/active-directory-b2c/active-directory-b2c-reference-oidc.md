---
title: "Azure AD B2C: вход в веб-приложения с помощью OpenID Connect | Документация Майкрософт"
description: "Создание веб-приложений с помощью реализации протокола проверки подлинности OpenID Connect в Azure Active Directory"
services: active-directory-b2c
documentationcenter: 
author: saeedakhter-msft
manager: krassk
editor: parakhj
ms.assetid: 21d420c8-3c10-4319-b681-adf2e89e7ede
ms.service: active-directory-b2c
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/16/2017
ms.author: saeedakhter-msft
ms.openlocfilehash: b0c33a47dd0cae79eab32ac578448fae8bf59be5
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="azure-active-directory-b2c-web-sign-in-with-openid-connect"></a><span data-ttu-id="9c3b0-103">Azure Active Directory B2C: вход в веб-приложения с помощью OpenID Connect</span><span class="sxs-lookup"><span data-stu-id="9c3b0-103">Azure Active Directory B2C: Web sign-in with OpenID Connect</span></span>
<span data-ttu-id="9c3b0-104">OpenID Connect — это протокол проверки подлинности на основе OAuth 2.0, который может использоваться для безопасного входа пользователей в веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-104">OpenID Connect is an authentication protocol, built on top of OAuth 2.0, that can be used to securely sign users in to web applications.</span></span> <span data-ttu-id="9c3b0-105">Используя реализацию OpenID Connect в Azure Active Directory B2C (Azure AD B2C), можно передать Azure Active Directory (Azure AD) регистрацию, вход в систему и другие действия по управлению пользователями в веб-приложениях.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-105">By using the Azure Active Directory B2C (Azure AD B2C) implementation of OpenID Connect, you can outsource sign-up, sign-in, and other identity management experiences in your web applications to Azure Active Directory (Azure AD).</span></span> <span data-ttu-id="9c3b0-106">В этом руководстве показано, как это сделать (независимо от языка программирования).</span><span class="sxs-lookup"><span data-stu-id="9c3b0-106">This guide shows you how to do so in a language-independent manner.</span></span> <span data-ttu-id="9c3b0-107">и описывает, как отправлять и получать сообщения HTTP, не используя ни одну из наших библиотек с открытым исходным кодом.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-107">It describes how to send and receive HTTP messages without using any of our open-source libraries.</span></span>

<span data-ttu-id="9c3b0-108">[OpenID Connect](http://openid.net/specs/openid-connect-core-1_0.html) расширяет возможности протокола *авторизации* OAuth 2.0 и позволяет использовать его в качестве протокола *проверки подлинности*,</span><span class="sxs-lookup"><span data-stu-id="9c3b0-108">[OpenID Connect](http://openid.net/specs/openid-connect-core-1_0.html) extends the OAuth 2.0 *authorization* protocol for use as an *authentication* protocol.</span></span> <span data-ttu-id="9c3b0-109">что позволяет вам выполнять единый вход с помощью OAuth.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-109">This allows you to perform single sign-on by using OAuth.</span></span> <span data-ttu-id="9c3b0-110">В этом протоколе вводится понятие *маркера идентификации*. Это токен безопасности, который позволяет клиенту выполнять идентификацию пользователя и получать основные сведения о профиле пользователя.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-110">It introduces the concept of an *ID token*, which is a security token that allows the client to verify the identity of the user and obtain basic profile information about the user.</span></span>

<span data-ttu-id="9c3b0-111">Так как OpenID Connect — это расширение OAuth 2.0, приложения могут безопасно получать *маркеры доступа*.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-111">Because it extends OAuth 2.0, it also enables apps to securely acquire *access tokens*.</span></span> <span data-ttu-id="9c3b0-112">обеспечивая возможность доступа к ресурсам, защищенным [сервером авторизации](active-directory-b2c-reference-protocols.md#the-basics).</span><span class="sxs-lookup"><span data-stu-id="9c3b0-112">You can use access_tokens to access resources that are secured by an [authorization server](active-directory-b2c-reference-protocols.md#the-basics).</span></span> <span data-ttu-id="9c3b0-113">Мы рекомендуем использовать OpenID Connect для веб-приложений, которые размещаются на сервере и доступны через веб-браузер.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-113">We recommend OpenID Connect if you're building a web application that is hosted on a server and accessed through a browser.</span></span> <span data-ttu-id="9c3b0-114">Если вы хотите добавить идентификацию пользователей с помощью Azure AD B2C в мобильные или настольные приложения, необходимо использовать [OAuth 2.0](active-directory-b2c-reference-oauth-code.md), а не OpenID Connect.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-114">If you want to add identity management to your mobile or desktop applications by using Azure AD B2C, you should use [OAuth 2.0](active-directory-b2c-reference-oauth-code.md) rather than OpenID Connect.</span></span>

<span data-ttu-id="9c3b0-115">В Azure AD B2C стандартный протокол OpenID Connect выходит за рамки простой проверки подлинности и авторизации.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-115">Azure AD B2C extends the standard OpenID Connect protocol to do more than simple authentication and authorization.</span></span> <span data-ttu-id="9c3b0-116">В нем появляется [параметр политики](active-directory-b2c-reference-policies.md), который позволяет использовать OpenID Connect для добавления в приложение таких действий по управлению пользователями, как регистрация, вход и управление профилями.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-116">It introduces the [policy parameter](active-directory-b2c-reference-policies.md), which enables you to use OpenID Connect to add user experiences--such as sign-up, sign-in, and profile management--to your app.</span></span> <span data-ttu-id="9c3b0-117">Здесь мы покажем, как с помощью OpenID Connect и политик реализовать каждую из этих функций в собственных веб-приложениях.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-117">Here, we show you how to use OpenID Connect and policies to implement each of these experiences in your web applications.</span></span> <span data-ttu-id="9c3b0-118">Мы также покажем, как получить маркеры доступа к веб-API.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-118">We'll also show you how to get access tokens for accessing web APIs.</span></span>

<span data-ttu-id="9c3b0-119">В HTTP-запросах в следующем разделе будут использованы наш пример каталога B2C (fabrikamb2c.onmicrosoft.com), а также наш пример приложения (https://aadb2cplayground.azurewebsites.net) и политики.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-119">The example HTTP requests in the next section use our sample B2C directory, fabrikamb2c.onmicrosoft.com, as well as our sample application, https://aadb2cplayground.azurewebsites.net, and policies.</span></span> <span data-ttu-id="9c3b0-120">Вы можете пробовать выполнять запросы с этими значениями или заменить их на собственные.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-120">You're free to try out the requests yourself by using these values, or you can replace them with your own.</span></span>
<span data-ttu-id="9c3b0-121">Узнайте, как [получить собственный клиент, приложение и политики B2C](#use-your-own-b2c-directory).</span><span class="sxs-lookup"><span data-stu-id="9c3b0-121">Learn how to [get your own B2C tenant, application, and policies](#use-your-own-b2c-directory).</span></span>

## <a name="send-authentication-requests"></a><span data-ttu-id="9c3b0-122">Отправка запросов проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="9c3b0-122">Send authentication requests</span></span>
<span data-ttu-id="9c3b0-123">Если веб-приложению требуется проверить подлинность пользователя и выполнить политику, оно может направить его к конечной точке `/authorize` .</span><span class="sxs-lookup"><span data-stu-id="9c3b0-123">When your web app needs to authenticate the user and execute a policy, it can direct the user to the `/authorize` endpoint.</span></span> <span data-ttu-id="9c3b0-124">Это интерактивная часть потока, в которой пользователь выполняет действие в зависимости от политики.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-124">This is the interactive portion of the flow, where the user takes action, depending on the policy.</span></span>

<span data-ttu-id="9c3b0-125">В этом запросе клиент указывает разрешения, которые необходимо получить от пользователя в параметре `scope`, и политики, которые нужно выполнить в параметре `p`.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-125">In this request, the client indicates the permissions that it needs to acquire from the user in the `scope` parameter and the policy to execute in the `p` parameter.</span></span> <span data-ttu-id="9c3b0-126">В следующих разделах приведены три примера для разных политик (переносы строк добавлены для удобства чтения).</span><span class="sxs-lookup"><span data-stu-id="9c3b0-126">Three examples are provided in the following sections (with line breaks for readability), each using a different policy.</span></span> <span data-ttu-id="9c3b0-127">Чтобы понять, как работает каждый запрос, попробуйте вставить его в браузер и запустить.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-127">To get a feel for how each request works, try pasting the request into a browser and running it.</span></span>

#### <a name="use-a-sign-in-policy"></a><span data-ttu-id="9c3b0-128">Пример с политикой входа в систему</span><span class="sxs-lookup"><span data-stu-id="9c3b0-128">Use a sign-in policy</span></span>
```
GET https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6
&response_type=code+id_token
&redirect_uri=https%3A%2F%2Faadb2cplayground.azurewebsites.net%2F
&response_mode=form_post
&scope=openid%20offline_access
&state=arbitrary_data_you_can_receive_in_the_response
&nonce=12345
&p=b2c_1_sign_in
```

#### <a name="use-a-sign-up-policy"></a><span data-ttu-id="9c3b0-129">Пример с политикой регистрации</span><span class="sxs-lookup"><span data-stu-id="9c3b0-129">Use a sign-up policy</span></span>
```
GET https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6
&response_type=code+id_token
&redirect_uri=https%3A%2F%2Faadb2cplayground.azurewebsites.net%2F
&response_mode=form_post
&scope=openid%20offline_access
&state=arbitrary_data_you_can_receive_in_the_response
&nonce=12345
&p=b2c_1_sign_up
```

#### <a name="use-an-edit-profile-policy"></a><span data-ttu-id="9c3b0-130">Пример с политикой изменения профиля</span><span class="sxs-lookup"><span data-stu-id="9c3b0-130">Use an edit-profile policy</span></span>
```
GET https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6
&response_type=code+id_token
&redirect_uri=https%3A%2F%2Faadb2cplayground.azurewebsites.net%2F
&response_mode=form_post
&scope=openid%20offline_access
&state=arbitrary_data_you_can_receive_in_the_response
&nonce=12345
&p=b2c_1_edit_profile
```

| <span data-ttu-id="9c3b0-131">Параметр</span><span class="sxs-lookup"><span data-stu-id="9c3b0-131">Parameter</span></span> | <span data-ttu-id="9c3b0-132">Обязательный?</span><span class="sxs-lookup"><span data-stu-id="9c3b0-132">Required?</span></span> | <span data-ttu-id="9c3b0-133">Описание</span><span class="sxs-lookup"><span data-stu-id="9c3b0-133">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="9c3b0-134">client_id</span><span class="sxs-lookup"><span data-stu-id="9c3b0-134">client_id</span></span> |<span data-ttu-id="9c3b0-135">Обязательно</span><span class="sxs-lookup"><span data-stu-id="9c3b0-135">Required</span></span> |<span data-ttu-id="9c3b0-136">Идентификатор приложения, который [портал Azure](https://portal.azure.com/) назначил вашему приложению.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-136">The application ID that the [Azure portal](https://portal.azure.com/) assigned to your app.</span></span> |
| <span data-ttu-id="9c3b0-137">response_type</span><span class="sxs-lookup"><span data-stu-id="9c3b0-137">response_type</span></span> |<span data-ttu-id="9c3b0-138">Обязательно</span><span class="sxs-lookup"><span data-stu-id="9c3b0-138">Required</span></span> |<span data-ttu-id="9c3b0-139">Тип ответа, который должен включать маркер идентификации для OpenID Connect.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-139">The response type, which must include an ID token for OpenID Connect.</span></span> <span data-ttu-id="9c3b0-140">Если веб-приложению также потребуются токены для вызова веб-API, можете использовать `code+id_token`, как и в наших примерах.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-140">If your web app also needs tokens for calling a web API, you can use `code+id_token`, as we've done here.</span></span> |
| <span data-ttu-id="9c3b0-141">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="9c3b0-141">redirect_uri</span></span> |<span data-ttu-id="9c3b0-142">Рекомендуется</span><span class="sxs-lookup"><span data-stu-id="9c3b0-142">Recommended</span></span> |<span data-ttu-id="9c3b0-143">Параметр `redirect_uri` приложения, на который приложение может отправлять запросы проверки подлинности и с которого оно может получать ответы на эти запросы.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-143">The `redirect_uri` parameter of your app, where authentication responses can be sent and received by your app.</span></span> <span data-ttu-id="9c3b0-144">Он должен в точности соответствовать одному из параметров `redirect_uri`, зарегистрированных на портале, но иметь форму закодированного URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-144">It must exactly match one of the `redirect_uri` parameters that you registered in the portal, except that it must be URL encoded.</span></span> |
| <span data-ttu-id="9c3b0-145">scope</span><span class="sxs-lookup"><span data-stu-id="9c3b0-145">scope</span></span> |<span data-ttu-id="9c3b0-146">Обязательно</span><span class="sxs-lookup"><span data-stu-id="9c3b0-146">Required</span></span> |<span data-ttu-id="9c3b0-147">Список областей с разделителями-пробелами.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-147">A space-separated list of scopes.</span></span> <span data-ttu-id="9c3b0-148">При указании одной области также указываются оба запрашиваемых разрешения для Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-148">A single scope value indicates to Azure AD both permissions that are being requested.</span></span> <span data-ttu-id="9c3b0-149">Область `openid` определяет разрешение на вход пользователя и получение данных о пользователе в форме маркеров идентификации (подробнее об этом далее в этой статье).</span><span class="sxs-lookup"><span data-stu-id="9c3b0-149">The `openid` scope indicates a permission to sign in the user and get data about the user in the form of ID tokens (more to come on this later in the article).</span></span> <span data-ttu-id="9c3b0-150">Область `offline_access` для веб-приложений является необязательной.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-150">The `offline_access` scope is optional for web apps.</span></span> <span data-ttu-id="9c3b0-151">Она означает, что вашему приложению потребуется *маркер обновления* для продолжительного доступа к ресурсам.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-151">It indicates that your app will need a *refresh token* for long-lived access to resources.</span></span> |
| <span data-ttu-id="9c3b0-152">response_mode</span><span class="sxs-lookup"><span data-stu-id="9c3b0-152">response_mode</span></span> |<span data-ttu-id="9c3b0-153">Рекомендуется</span><span class="sxs-lookup"><span data-stu-id="9c3b0-153">Recommended</span></span> |<span data-ttu-id="9c3b0-154">Метод, который следует использовать для отправки полученного кода авторизации приложению.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-154">The method that should be used to send the resulting authorization code back to your app.</span></span> <span data-ttu-id="9c3b0-155">Это может быть `query`, `form_post` или `fragment`.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-155">It can be either `query`, `form_post`, or `fragment`.</span></span>  <span data-ttu-id="9c3b0-156">Для максимальной безопасности рекомендуется использовать режим ответа `form_post`.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-156">The `form_post` response mode is recommended for best security.</span></span> |
| <span data-ttu-id="9c3b0-157">state</span><span class="sxs-lookup"><span data-stu-id="9c3b0-157">state</span></span> |<span data-ttu-id="9c3b0-158">Рекомендуется</span><span class="sxs-lookup"><span data-stu-id="9c3b0-158">Recommended</span></span> |<span data-ttu-id="9c3b0-159">Значение, включенное в запрос, которое также возвращается в ответе маркера.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-159">A value included in the request that is also returned in the token response.</span></span> <span data-ttu-id="9c3b0-160">Это может быть строка любого контента.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-160">It can be a string of any content that you want.</span></span> <span data-ttu-id="9c3b0-161">Как правило, с целью предотвращения подделки межсайтовых запросов используется генерируемое случайным образом уникальное значение.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-161">A randomly generated unique value is typically used for preventing cross-site request forgery attacks.</span></span> <span data-ttu-id="9c3b0-162">Этот параметр также включает информацию о состоянии пользователя в приложении перед созданием запроса на проверку подлинности (например, об открытой в тот момент странице).</span><span class="sxs-lookup"><span data-stu-id="9c3b0-162">The state is also used to encode information about the user's state in the app before the authentication request occurred, such as the page they were on.</span></span> |
| <span data-ttu-id="9c3b0-163">nonce</span><span class="sxs-lookup"><span data-stu-id="9c3b0-163">nonce</span></span> |<span data-ttu-id="9c3b0-164">Обязательно</span><span class="sxs-lookup"><span data-stu-id="9c3b0-164">Required</span></span> |<span data-ttu-id="9c3b0-165">Значение, включенное в запрос и созданное приложением, которое войдет в состав полученного маркера идентификации в качестве утверждения.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-165">A value included in the request (generated by the app) that will be included in the resulting ID token as a claim.</span></span> <span data-ttu-id="9c3b0-166">Приложение может проверить это значение во избежание атак с использованием воспроизведения токена.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-166">The app can then verify this value to mitigate token replay attacks.</span></span> <span data-ttu-id="9c3b0-167">Это значение обычно представляет собой случайную уникальную строку, которую можно использовать для определения источника запроса.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-167">The value is typically a randomized unique string that can be used to identify the origin of the request.</span></span> |
| <span data-ttu-id="9c3b0-168">p</span><span class="sxs-lookup"><span data-stu-id="9c3b0-168">p</span></span> |<span data-ttu-id="9c3b0-169">Обязательно</span><span class="sxs-lookup"><span data-stu-id="9c3b0-169">Required</span></span> |<span data-ttu-id="9c3b0-170">Политика, которая будет выполняться.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-170">The policy that will be executed.</span></span> <span data-ttu-id="9c3b0-171">Это имя политики, созданной в клиенте B2C.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-171">It is the name of a policy that is created in your B2C tenant.</span></span> <span data-ttu-id="9c3b0-172">Имя политики должно начинаться с `b2c\_1\_`.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-172">The policy name value should begin with `b2c\_1\_`.</span></span> <span data-ttu-id="9c3b0-173">Дополнительные сведения о политиках см. в статье [Расширяемая платформа политик](active-directory-b2c-reference-policies.md).</span><span class="sxs-lookup"><span data-stu-id="9c3b0-173">Learn more about policies and the [extensible policy framework](active-directory-b2c-reference-policies.md).</span></span> |
| <span data-ttu-id="9c3b0-174">prompt</span><span class="sxs-lookup"><span data-stu-id="9c3b0-174">prompt</span></span> |<span data-ttu-id="9c3b0-175">Необязательно</span><span class="sxs-lookup"><span data-stu-id="9c3b0-175">Optional</span></span> |<span data-ttu-id="9c3b0-176">Требуемый тип взаимодействия с пользователем.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-176">The type of user interaction that is required.</span></span> <span data-ttu-id="9c3b0-177">Сейчас единственное допустимое значение — `login`, при котором пользователю приходится вводить учетные данные по запросу.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-177">The only valid value at this time is `login`, which forces the user to enter their credentials on that request.</span></span> <span data-ttu-id="9c3b0-178">Единый вход не сработает.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-178">Single sign-on will not take effect.</span></span> |

<span data-ttu-id="9c3b0-179">На этом этапе пользователю предлагается выполнить рабочий процесс политики.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-179">At this point, the user is asked to complete the policy's workflow.</span></span> <span data-ttu-id="9c3b0-180">Для этого могут потребоваться ввод имени пользователя и пароля, вход с помощью удостоверения социальной сети, регистрация в каталоге или любые другие действия, определенные в политике.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-180">This might involve the user entering their username and password, signing in with a social identity, signing up for the directory, or any other number of steps, depending on how the policy is defined.</span></span>

<span data-ttu-id="9c3b0-181">Как только пользователь завершит политику, Azure AD вернет приложению ответ в указанный параметр `redirect_uri` с помощью метода, определенного в параметре `response_mode`.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-181">After the user completes the policy, Azure AD returns a response to your app at the indicated `redirect_uri` parameter, by using the method that is specified in the `response_mode` parameter.</span></span> <span data-ttu-id="9c3b0-182">Во всех вышеперечисленных случаях ответ будет одинаковым независимо от политики, которая была выполнена.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-182">The response is the same for each of the preceding cases, independent of the policy that is executed.</span></span>

<span data-ttu-id="9c3b0-183">Успешный ответ с использованием метода `response_mode=fragment` выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="9c3b0-183">A successful response using `response_mode=fragment` would look like:</span></span>

```
GET https://aadb2cplayground.azurewebsites.net/#
id_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...
&code=AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq...
&state=arbitrary_data_you_can_receive_in_the_response
```

| <span data-ttu-id="9c3b0-184">Параметр</span><span class="sxs-lookup"><span data-stu-id="9c3b0-184">Parameter</span></span> | <span data-ttu-id="9c3b0-185">Описание</span><span class="sxs-lookup"><span data-stu-id="9c3b0-185">Description</span></span> |
| --- | --- |
| <span data-ttu-id="9c3b0-186">id_token</span><span class="sxs-lookup"><span data-stu-id="9c3b0-186">id_token</span></span> |<span data-ttu-id="9c3b0-187">Маркер идентификации, запрошенный приложением.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-187">The ID token that the app requested.</span></span> <span data-ttu-id="9c3b0-188">Вы можете использовать маркер идентификации для проверки личности пользователя и запуска сеанса пользователя.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-188">You can use the ID token to verify the user's identity and begin a session with the user.</span></span> <span data-ttu-id="9c3b0-189">Дополнительные сведения о маркерах идентификации и их содержимом можно найти в [справочнике по маркерам Azure AD B2C](active-directory-b2c-reference-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="9c3b0-189">More details on ID tokens and their contents are included in the [Azure AD B2C token reference](active-directory-b2c-reference-tokens.md).</span></span> |
| <span data-ttu-id="9c3b0-190">Код</span><span class="sxs-lookup"><span data-stu-id="9c3b0-190">code</span></span> |<span data-ttu-id="9c3b0-191">Код авторизации, который запросило приложение, если вы использовали `response_type=code+id_token`.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-191">The authorization code that the app requested, if you used `response_type=code+id_token`.</span></span> <span data-ttu-id="9c3b0-192">Приложение может использовать код авторизации для запроса маркера доступа для целевого ресурса.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-192">The app can use the authorization code to request an access token for a target resource.</span></span> <span data-ttu-id="9c3b0-193">Срок действия кодов авторизации крайне мал.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-193">Authorization codes are very short-lived.</span></span> <span data-ttu-id="9c3b0-194">и обычно истекает по прошествии порядка 10 минут.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-194">Typically, they expire after about 10 minutes.</span></span> |
| <span data-ttu-id="9c3b0-195">state</span><span class="sxs-lookup"><span data-stu-id="9c3b0-195">state</span></span> |<span data-ttu-id="9c3b0-196">Если запрос содержит параметр `state`, то в ответе должно отображаться то же значение.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-196">If a `state` parameter is included in the request, the same value should appear in the response.</span></span> <span data-ttu-id="9c3b0-197">Приложение должно проверить, совпадают ли значения параметра `state` в запросе и ответе.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-197">The app should verify that the `state` values in the request and response are identical.</span></span> |

<span data-ttu-id="9c3b0-198">Сообщения об ошибках также можно отправлять в параметр `redirect_uri`, чтобы приложение обрабатывало их должным образом:</span><span class="sxs-lookup"><span data-stu-id="9c3b0-198">Error responses can also be sent to the `redirect_uri` parameter so that the app can handle them appropriately:</span></span>

```
GET https://aadb2cplayground.azurewebsites.net/#
error=access_denied
&error_description=the+user+canceled+the+authentication
&state=arbitrary_data_you_can_receive_in_the_response
```

| <span data-ttu-id="9c3b0-199">Параметр</span><span class="sxs-lookup"><span data-stu-id="9c3b0-199">Parameter</span></span> | <span data-ttu-id="9c3b0-200">Описание</span><span class="sxs-lookup"><span data-stu-id="9c3b0-200">Description</span></span> |
| --- | --- |
| <span data-ttu-id="9c3b0-201">error</span><span class="sxs-lookup"><span data-stu-id="9c3b0-201">error</span></span> |<span data-ttu-id="9c3b0-202">Строка кода ошибки, которую можно использовать для классификации типов возникающих ошибок и реагирования на них.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-202">An error-code string that can be used to classify types of errors that occur and that can be used to react to errors.</span></span> |
| <span data-ttu-id="9c3b0-203">error_description</span><span class="sxs-lookup"><span data-stu-id="9c3b0-203">error_description</span></span> |<span data-ttu-id="9c3b0-204">Конкретное сообщение об ошибке, с помощью которого разработчик может определить причину возникновения ошибки проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-204">A specific error message that can help a developer identify the root cause of an authentication error.</span></span> |
| <span data-ttu-id="9c3b0-205">state</span><span class="sxs-lookup"><span data-stu-id="9c3b0-205">state</span></span> |<span data-ttu-id="9c3b0-206">См. полное описание в первой таблице этого раздела.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-206">See the full description in the first table in this section.</span></span> <span data-ttu-id="9c3b0-207">Если запрос содержит параметр `state`, то в ответе должно отображаться то же значение.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-207">If a `state` parameter is included in the request, the same value should appear in the response.</span></span> <span data-ttu-id="9c3b0-208">Приложение должно проверить, совпадают ли значения параметра `state` в запросе и ответе.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-208">The app should verify that the `state` values in the request and response are identical.</span></span> |

## <a name="validate-the-id-token"></a><span data-ttu-id="9c3b0-209">Проверка маркера идентификации</span><span class="sxs-lookup"><span data-stu-id="9c3b0-209">Validate the ID token</span></span>
<span data-ttu-id="9c3b0-210">Получение маркера идентификации не является достаточным для прохождения пользователем проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-210">Just receiving an ID token is not enough to authenticate the user.</span></span> <span data-ttu-id="9c3b0-211">Необходимо проверить подпись маркера идентификации и сопоставить утверждения в маркере с требованиями вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-211">You must validate the ID token's signature and verify the claims in the token per your app's requirements.</span></span> <span data-ttu-id="9c3b0-212">В Azure AD B2C для подписи маркеров и проверки их правильности используются [веб-маркеры JSON Web Token (JWT)](http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html) и шифрование с открытым ключом.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-212">Azure AD B2C uses [JSON Web Tokens (JWTs)](http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html) and public key cryptography to sign tokens and verify that they are valid.</span></span>

<span data-ttu-id="9c3b0-213">Для проверки JWT доступны многие библиотеки с открытым исходным кодом в зависимости от выбранного языка программирования.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-213">There are many open-source libraries that are available for validating JWTs, depending on your language of preference.</span></span> <span data-ttu-id="9c3b0-214">Мы рекомендуем изучить различные библиотеки, а не реализовывать логику проверки самостоятельно.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-214">We recommend exploring those options rather than implementing your own validation logic.</span></span> <span data-ttu-id="9c3b0-215">Приведенные здесь сведения помогут понять, как правильно использовать эти библиотеки.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-215">The information here will be useful in figuring out how to properly use those libraries.</span></span>

<span data-ttu-id="9c3b0-216">Azure AD B2C содержит конечную точку метаданных OpenID Connect, позволяющую приложению получать сведения о Azure AD B2C в среде выполнения.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-216">Azure AD B2C has an OpenID Connect metadata endpoint, which allows an app to fetch information about Azure AD B2C at runtime.</span></span> <span data-ttu-id="9c3b0-217">Эти сведения включают конечные точки, содержимое маркеров и ключи подписи маркеров.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-217">This information includes endpoints, token contents, and token signing keys.</span></span> <span data-ttu-id="9c3b0-218">Для каждой политики в клиенте B2C есть собственный документ метаданных JSON.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-218">There is a JSON metadata document for each policy in your B2C tenant.</span></span> <span data-ttu-id="9c3b0-219">Например, документ метаданных для политики `b2c_1_sign_in` в `fabrikamb2c.onmicrosoft.com` находится в каталоге:</span><span class="sxs-lookup"><span data-stu-id="9c3b0-219">For example, the metadata document for the `b2c_1_sign_in` policy in `fabrikamb2c.onmicrosoft.com` is located at:</span></span>

`https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/v2.0/.well-known/openid-configuration?p=b2c_1_sign_in`

<span data-ttu-id="9c3b0-220">Одно из свойств этого документа конфигурации — `jwks_uri`, значение которого для точно такой же политики будет следующим:</span><span class="sxs-lookup"><span data-stu-id="9c3b0-220">One of the properties of this configuration document is `jwks_uri`, whose value for the same policy would be:</span></span>

<span data-ttu-id="9c3b0-221">`https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/discovery/v2.0/keys?p=b2c_1_sign_in`.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-221">`https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/discovery/v2.0/keys?p=b2c_1_sign_in`.</span></span>

<span data-ttu-id="9c3b0-222">Чтобы определить, какая политика была использована для подписывания маркера идентификации (а также определить, откуда необходимо получать метаданные), можно воспользоваться одним из двух вариантов.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-222">To determine which policy was used in signing an ID token (and from where to fetch the metadata), you have two options.</span></span> <span data-ttu-id="9c3b0-223">Во-первых, имя политики включено в утверждение `acr` маркера идентификации.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-223">First, the policy name is included in the `acr` claim in the ID token.</span></span> <span data-ttu-id="9c3b0-224">Сведения об анализе утверждений маркера идентификации см. в [Справочнике по маркерам Azure AD B2C](active-directory-b2c-reference-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="9c3b0-224">For information on how to parse the claims from an ID token, see the [Azure AD B2C token reference](active-directory-b2c-reference-tokens.md).</span></span> <span data-ttu-id="9c3b0-225">Другой вариант — закодировать политику в значении параметра `state` при отправке запроса и затем декодировать ее, чтобы определить, какая политика была использована.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-225">Your other option is to encode the policy in the value of the `state` parameter when you issue the request, and then decode it to determine which policy was used.</span></span> <span data-ttu-id="9c3b0-226">Каждый из этих методов является допустимым.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-226">Either method is valid.</span></span>

<span data-ttu-id="9c3b0-227">После получения документа метаданных из конечной точки метаданных OpenID Connect можно использовать открытые ключи RSA256, расположенные в этой конечной точке, для проверки подписи маркера идентификации.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-227">After you've acquired the metadata document from the OpenID Connect metadata endpoint, you can use the RSA 256 public keys (which are located at this endpoint) to validate the signature of the ID token.</span></span> <span data-ttu-id="9c3b0-228">В каждый момент времени в этой конечной точке может находиться множество ключей, каждый из которых определяется утверждением `kid`.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-228">There might be multiple keys listed at this endpoint at any given point in time, each identified by a `kid` claim.</span></span> <span data-ttu-id="9c3b0-229">Заголовок маркера идентификации также содержит утверждение `kid`, указывающее на ключ, который был использован для подписывания маркера идентификации.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-229">The header of the ID token also contains a `kid` claim, which indicates which of these keys was used to sign the ID token.</span></span> <span data-ttu-id="9c3b0-230">Дополнительные сведения см. в [справочнике по маркерам Azure AD B2C](active-directory-b2c-reference-tokens.md), включая раздел [Проверка маркеров](active-directory-b2c-reference-tokens.md#token-validation).</span><span class="sxs-lookup"><span data-stu-id="9c3b0-230">For more information, see the [Azure AD B2C token reference](active-directory-b2c-reference-tokens.md) (the section on [validating tokens](active-directory-b2c-reference-tokens.md#token-validation), in particular).</span></span>
<!--TODO: Improve the information on this-->

<span data-ttu-id="9c3b0-231">После проверки подписи маркера идентификации вам потребуется проверить несколько утверждений.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-231">After you've validated the signature of the ID token, there are several claims that you need to verify.</span></span> <span data-ttu-id="9c3b0-232">например</span><span class="sxs-lookup"><span data-stu-id="9c3b0-232">For instance:</span></span>

* <span data-ttu-id="9c3b0-233">Проверьте утверждение `nonce` во избежание атак с использованием воспроизведения маркера.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-233">You should validate the `nonce` claim to prevent token replay attacks.</span></span> <span data-ttu-id="9c3b0-234">Его значение должно совпадать с указанным вами в запросе на вход.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-234">Its value should be what you specified in the sign-in request.</span></span>
* <span data-ttu-id="9c3b0-235">Проверьте утверждение `aud` и убедитесь, что для вашего приложения был выдан маркер идентификации.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-235">You should validate the `aud` claim to ensure that the ID token was issued for your app.</span></span> <span data-ttu-id="9c3b0-236">Его значением должен быть идентификатор приложения вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-236">Its value should be the application ID of your app.</span></span>
* <span data-ttu-id="9c3b0-237">Проверьте утверждения `iat` и `exp`, чтобы убедиться, что срок действия маркера идентификации не истек.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-237">You should validate the `iat` and `exp` claims to ensure that the ID token has not expired.</span></span>

<span data-ttu-id="9c3b0-238">Также существуют некоторые дополнительные проверки, которые необходимо выполнить.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-238">There are also several more validations that you should perform.</span></span> <span data-ttu-id="9c3b0-239">Они подробно описаны в разделе [Базовая спецификация OpenID](http://openid.net/specs/openid-connect-core-1_0.html).  Вам также может потребоваться проверить дополнительные утверждения в зависимости от сценария.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-239">These are described in detail in the [OpenID Connect Core Spec](http://openid.net/specs/openid-connect-core-1_0.html).  You might also want to validate additional claims, depending on your scenario.</span></span> <span data-ttu-id="9c3b0-240">Ниже приведены некоторые из стандартных проверок:</span><span class="sxs-lookup"><span data-stu-id="9c3b0-240">Some common validations include:</span></span>

* <span data-ttu-id="9c3b0-241">Обеспечение регистрации пользователя или организации в приложении.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-241">Ensuring that the user/organization has signed up for the app.</span></span>
* <span data-ttu-id="9c3b0-242">Предоставление пользователю необходимого уровня авторизации и привилегий.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-242">Ensuring that the user has proper authorization/privileges.</span></span>
* <span data-ttu-id="9c3b0-243">Обеспечение определенного уровня проверки подлинности, например многофакторной проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-243">Ensuring that a certain strength of authentication has occurred, such as Azure Multi-Factor Authentication.</span></span>

<span data-ttu-id="9c3b0-244">Дополнительные сведения об утверждениях в маркере идентификации можно найти в [Справочнике по маркерам Azure AD B2C](active-directory-b2c-reference-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="9c3b0-244">For more information on the claims in an ID token, see the [Azure AD B2C token reference](active-directory-b2c-reference-tokens.md).</span></span>

<span data-ttu-id="9c3b0-245">После проверки маркера идентификации можно запустить сеанс пользователя.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-245">After you have validated the ID token, you can begin a session with the user.</span></span> <span data-ttu-id="9c3b0-246">В приложении используйте утверждения в маркере идентификации для получения сведений о пользователе.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-246">You can use the claims in the ID token to obtain information about the user in your app.</span></span> <span data-ttu-id="9c3b0-247">Эти сведения используются для отображения, получения записей и проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-247">Uses for this information include display, records, and authorization.</span></span>

## <a name="get-a-token"></a><span data-ttu-id="9c3b0-248">Получение маркера</span><span class="sxs-lookup"><span data-stu-id="9c3b0-248">Get a token</span></span>
<span data-ttu-id="9c3b0-249">Если вашему веб-приложению требуется только выполнять политики, вы можете пропустить следующие несколько разделов.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-249">If you need your web app to only execute policies, you can skip the next few sections.</span></span> <span data-ttu-id="9c3b0-250">Эти разделы применяются только к веб-приложениям, которым необходимо выполнять вызовы веб-API, защищенные проверкой подлинности. Эти веб-приложения также защищены Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-250">These sections are applicable only to web apps that need to make authenticated calls to a web API and are also protected by Azure AD B2C.</span></span>

<span data-ttu-id="9c3b0-251">Чтобы воспользоваться кодом авторизации маркера для необходимого ресурса (полученным с помощью `response_type=code+id_token`), отправьте запрос `POST` на конечную точку `/token`.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-251">You can redeem the authorization code that you acquired (by using `response_type=code+id_token`) for a token to the desired resource by sending a `POST` request to the `/token` endpoint.</span></span> <span data-ttu-id="9c3b0-252">Сейчас единственный ресурс, для которого можно запросить маркер, — это веб-API серверной части вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-252">Currently, the only resource that you can request a token for is your app's own back-end web API.</span></span> <span data-ttu-id="9c3b0-253">По соглашению при запросе маркера для себя следует использовать идентификатор клиента в качестве области.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-253">The convention for requesting a token to yourself is to use your app's client ID as the scope:</span></span>

```
POST fabrikamb2c.onmicrosoft.com/oauth2/v2.0/token?p=b2c_1_sign_in HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code&client_id=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6&scope=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6 offline_access&code=AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq...&redirect_uri=urn:ietf:wg:oauth:2.0:oob&client_secret=<your-application-secret>

```

| <span data-ttu-id="9c3b0-254">Параметр</span><span class="sxs-lookup"><span data-stu-id="9c3b0-254">Parameter</span></span> | <span data-ttu-id="9c3b0-255">Обязательный?</span><span class="sxs-lookup"><span data-stu-id="9c3b0-255">Required?</span></span> | <span data-ttu-id="9c3b0-256">Описание</span><span class="sxs-lookup"><span data-stu-id="9c3b0-256">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="9c3b0-257">p</span><span class="sxs-lookup"><span data-stu-id="9c3b0-257">p</span></span> |<span data-ttu-id="9c3b0-258">Обязательно</span><span class="sxs-lookup"><span data-stu-id="9c3b0-258">Required</span></span> |<span data-ttu-id="9c3b0-259">Политика, которая использовалась для получения кода авторизации.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-259">The policy that was used to acquire the authorization code.</span></span> <span data-ttu-id="9c3b0-260">Другую политику в этом запросе использовать нельзя.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-260">You cannot use a different policy in this request.</span></span> <span data-ttu-id="9c3b0-261">Обратите внимание, что этот параметр добавляется к строке запроса, а не в тело запроса `POST`.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-261">Note that you add this parameter to the query string, not to the `POST` body.</span></span> |
| <span data-ttu-id="9c3b0-262">client_id</span><span class="sxs-lookup"><span data-stu-id="9c3b0-262">client_id</span></span> |<span data-ttu-id="9c3b0-263">Обязательно</span><span class="sxs-lookup"><span data-stu-id="9c3b0-263">Required</span></span> |<span data-ttu-id="9c3b0-264">Идентификатор приложения, который [портал Azure](https://portal.azure.com/) назначил вашему приложению.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-264">The application ID that the [Azure portal](https://portal.azure.com/) assigned to your app.</span></span> |
| <span data-ttu-id="9c3b0-265">grant_type</span><span class="sxs-lookup"><span data-stu-id="9c3b0-265">grant_type</span></span> |<span data-ttu-id="9c3b0-266">Обязательно</span><span class="sxs-lookup"><span data-stu-id="9c3b0-266">Required</span></span> |<span data-ttu-id="9c3b0-267">Тип предоставления. Для потока кода авторизации это должен быть тип `authorization_code`.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-267">The type of grant, which must be `authorization_code` for the authorization code flow.</span></span> |
| <span data-ttu-id="9c3b0-268">scope</span><span class="sxs-lookup"><span data-stu-id="9c3b0-268">scope</span></span> |<span data-ttu-id="9c3b0-269">Рекомендуется</span><span class="sxs-lookup"><span data-stu-id="9c3b0-269">Recommended</span></span> |<span data-ttu-id="9c3b0-270">Список областей с разделителями-пробелами.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-270">A space-separated list of scopes.</span></span> <span data-ttu-id="9c3b0-271">При указании одной области также указываются оба запрашиваемых разрешения для Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-271">A single scope value indicates to Azure AD both permissions that are being requested.</span></span> <span data-ttu-id="9c3b0-272">Область `openid` определяет разрешение на вход пользователя и получение данных о пользователе в форме маркеров идентификации.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-272">The `openid` scope indicates a permission to sign in the user and get data about the user in the form of id_token parameters.</span></span> <span data-ttu-id="9c3b0-273">Ее можно использовать для получения маркеров для веб-API серверной части приложения, идентификатор приложения которого совпадает с идентификатором приложения клиента.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-273">It can be used to get tokens to your app's own back-end web API, which is represented by the same application ID as the client.</span></span> <span data-ttu-id="9c3b0-274">Область `offline_access` означает, что вашему приложению потребуется маркер обновления для продолжительного доступа к ресурсам.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-274">The `offline_access` scope indicates that your app will need a refresh token for long-lived access to resources.</span></span> |
| <span data-ttu-id="9c3b0-275">Код</span><span class="sxs-lookup"><span data-stu-id="9c3b0-275">code</span></span> |<span data-ttu-id="9c3b0-276">Обязательно</span><span class="sxs-lookup"><span data-stu-id="9c3b0-276">Required</span></span> |<span data-ttu-id="9c3b0-277">Код авторизации, полученный на первом участке потока.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-277">The authorization code that you acquired in the first leg of the flow.</span></span> |
| <span data-ttu-id="9c3b0-278">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="9c3b0-278">redirect_uri</span></span> |<span data-ttu-id="9c3b0-279">Обязательно</span><span class="sxs-lookup"><span data-stu-id="9c3b0-279">Required</span></span> |<span data-ttu-id="9c3b0-280">Параметр `redirect_uri` приложения, в котором вы получили код авторизации.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-280">The `redirect_uri` parameter of the application where you received the authorization code.</span></span> |
| <span data-ttu-id="9c3b0-281">client_secret</span><span class="sxs-lookup"><span data-stu-id="9c3b0-281">client_secret</span></span> |<span data-ttu-id="9c3b0-282">Обязательно</span><span class="sxs-lookup"><span data-stu-id="9c3b0-282">Required</span></span> |<span data-ttu-id="9c3b0-283">Секрет приложения, созданный на [портале Azure](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="9c3b0-283">The application secret that you generated in the [Azure portal](https://portal.azure.com/).</span></span> <span data-ttu-id="9c3b0-284">Это важный артефакт безопасности,</span><span class="sxs-lookup"><span data-stu-id="9c3b0-284">This application secret is an important security artifact.</span></span> <span data-ttu-id="9c3b0-285">и он должен безопасно храниться на сервере.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-285">You should store it securely on your server.</span></span> <span data-ttu-id="9c3b0-286">Также следует периодически изменять секрет клиента.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-286">You should also rotate this client secret on a periodic basis.</span></span> |

<span data-ttu-id="9c3b0-287">Успешный ответ маркера выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="9c3b0-287">A successful token response looks like:</span></span>

```
{
    "not_before": "1442340812",
    "token_type": "Bearer",
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...",
    "scope": "90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6 offline_access",
    "expires_in": "3600",
    "refresh_token": "AAQfQmvuDy8WtUv-sd0TBwWVQs1rC-Lfxa_NDkLqpg50Cxp5Dxj0VPF1mx2Z...",
}
```
| <span data-ttu-id="9c3b0-288">Параметр</span><span class="sxs-lookup"><span data-stu-id="9c3b0-288">Parameter</span></span> | <span data-ttu-id="9c3b0-289">Описание</span><span class="sxs-lookup"><span data-stu-id="9c3b0-289">Description</span></span> |
| --- | --- |
| <span data-ttu-id="9c3b0-290">not_before</span><span class="sxs-lookup"><span data-stu-id="9c3b0-290">not_before</span></span> |<span data-ttu-id="9c3b0-291">Момент времени, в который маркер начинает считаться действительным (с начала эпохи).</span><span class="sxs-lookup"><span data-stu-id="9c3b0-291">The time at which the token is considered valid, in epoch time.</span></span> |
| <span data-ttu-id="9c3b0-292">token_type</span><span class="sxs-lookup"><span data-stu-id="9c3b0-292">token_type</span></span> |<span data-ttu-id="9c3b0-293">Значение типа маркера.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-293">The token type value.</span></span> <span data-ttu-id="9c3b0-294">Единственный тип, поддерживаемый Azure AD — `Bearer`</span><span class="sxs-lookup"><span data-stu-id="9c3b0-294">The only type that Azure AD supports is `Bearer`.</span></span> |
| <span data-ttu-id="9c3b0-295">access_token</span><span class="sxs-lookup"><span data-stu-id="9c3b0-295">access_token</span></span> |<span data-ttu-id="9c3b0-296">Подписанный маркер JWT, который вы запрашивали.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-296">The signed JWT token that you requested.</span></span> |
| <span data-ttu-id="9c3b0-297">scope</span><span class="sxs-lookup"><span data-stu-id="9c3b0-297">scope</span></span> |<span data-ttu-id="9c3b0-298">Области, для которых действителен маркер.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-298">The scopes for which the token is valid.</span></span> <span data-ttu-id="9c3b0-299">Их можно использовать для кэширования маркеров для последующего использования.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-299">These can be used for caching tokens for later use.</span></span> |
| <span data-ttu-id="9c3b0-300">expires_in</span><span class="sxs-lookup"><span data-stu-id="9c3b0-300">expires_in</span></span> |<span data-ttu-id="9c3b0-301">Срок действия маркера доступа (в секундах).</span><span class="sxs-lookup"><span data-stu-id="9c3b0-301">The length of time that the access token is valid (in seconds).</span></span> |
| <span data-ttu-id="9c3b0-302">refresh_token</span><span class="sxs-lookup"><span data-stu-id="9c3b0-302">refresh_token</span></span> |<span data-ttu-id="9c3b0-303">Маркер обновления OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-303">An OAuth 2.0 refresh token.</span></span> <span data-ttu-id="9c3b0-304">Приложение может использовать этот маркер для получения дополнительных маркеров по истечении срока действия текущего маркера.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-304">The app can use this token to acquire additional tokens after the current token expires.</span></span> <span data-ttu-id="9c3b0-305">Маркеры обновления обладают длительным сроком действия. Их можно использовать для продолжительного доступа к ресурсам.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-305">Refresh tokens are long-lived and can be used to retain access to resources for extended periods of time.</span></span> <span data-ttu-id="9c3b0-306">Дополнительные сведения см. в [справочнике по маркерам B2C](active-directory-b2c-reference-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="9c3b0-306">For more details, refer to the [B2C token reference](active-directory-b2c-reference-tokens.md).</span></span> <span data-ttu-id="9c3b0-307">Обратите внимание, что для получения маркера обновления необходимо использовать область `offline_access` как в запросе авторизации, так и в запросе маркера.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-307">Note that you must have used the scope `offline_access` in both the authorization and token requests in order to receive a refresh token.</span></span> |

<span data-ttu-id="9c3b0-308">Сообщения об ошибках выглядят следующим образом:</span><span class="sxs-lookup"><span data-stu-id="9c3b0-308">Error responses look like:</span></span>

```
{
    "error": "access_denied",
    "error_description": "The user revoked access to the app.",
}
```

| <span data-ttu-id="9c3b0-309">Параметр</span><span class="sxs-lookup"><span data-stu-id="9c3b0-309">Parameter</span></span> | <span data-ttu-id="9c3b0-310">Описание</span><span class="sxs-lookup"><span data-stu-id="9c3b0-310">Description</span></span> |
| --- | --- |
| <span data-ttu-id="9c3b0-311">error</span><span class="sxs-lookup"><span data-stu-id="9c3b0-311">error</span></span> |<span data-ttu-id="9c3b0-312">Строка кода ошибки, которую можно использовать для классификации типов возникающих ошибок и реагирования на них.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-312">An error-code string that can be used to classify types of errors that occur and that can be used to react to errors.</span></span> |
| <span data-ttu-id="9c3b0-313">error_description</span><span class="sxs-lookup"><span data-stu-id="9c3b0-313">error_description</span></span> |<span data-ttu-id="9c3b0-314">Конкретное сообщение об ошибке, с помощью которого разработчик может определить причину возникновения ошибки проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-314">A specific error message that can help a developer identify the root cause of an authentication error.</span></span> |

## <a name="use-the-token"></a><span data-ttu-id="9c3b0-315">Использование маркера</span><span class="sxs-lookup"><span data-stu-id="9c3b0-315">Use the token</span></span>
<span data-ttu-id="9c3b0-316">После успешного получения маркера доступа маркер можно использовать в запросах к веб-API серверной части приложения путем включения маркера в заголовок `Authorization`:</span><span class="sxs-lookup"><span data-stu-id="9c3b0-316">Now that you've successfully acquired an access token, you can use the token in requests to your back-end web APIs by including it in the `Authorization` header:</span></span>

```
GET /tasks
Host: https://mytaskwebapi.com
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...
```

## <a name="refresh-the-token"></a><span data-ttu-id="9c3b0-317">Обновление маркера</span><span class="sxs-lookup"><span data-stu-id="9c3b0-317">Refresh the token</span></span>
<span data-ttu-id="9c3b0-318">Срок действия маркеров идентификации крайне мал.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-318">ID tokens are short-lived.</span></span> <span data-ttu-id="9c3b0-319">Для сохранения доступа к ресурсам маркеры с истекшим сроком действия необходимо обновлять.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-319">You must refresh them after they expire to continue being able to access resources.</span></span> <span data-ttu-id="9c3b0-320">Для этого нужно отправить еще один запрос `POST` в конечную точку `/token`,</span><span class="sxs-lookup"><span data-stu-id="9c3b0-320">You can do so by submitting another `POST` request to the `/token` endpoint.</span></span> <span data-ttu-id="9c3b0-321">На этот раз укажите параметр `refresh_token` вместо параметра `code`:</span><span class="sxs-lookup"><span data-stu-id="9c3b0-321">This time, provide the `refresh_token` parameter instead of the `code` parameter:</span></span>

```
POST fabrikamb2c.onmicrosoft.com/oauth2/v2.0/token?p=b2c_1_sign_in HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded

grant_type=refresh_token&client_id=90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6&scope=openid offline_access&refresh_token=AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq...&redirect_uri=urn:ietf:wg:oauth:2.0:oob&client_secret=<your-application-secret>
```

| <span data-ttu-id="9c3b0-322">Параметр</span><span class="sxs-lookup"><span data-stu-id="9c3b0-322">Parameter</span></span> | <span data-ttu-id="9c3b0-323">Обязательно</span><span class="sxs-lookup"><span data-stu-id="9c3b0-323">Required</span></span> | <span data-ttu-id="9c3b0-324">Описание</span><span class="sxs-lookup"><span data-stu-id="9c3b0-324">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="9c3b0-325">p</span><span class="sxs-lookup"><span data-stu-id="9c3b0-325">p</span></span> |<span data-ttu-id="9c3b0-326">Обязательно</span><span class="sxs-lookup"><span data-stu-id="9c3b0-326">Required</span></span> |<span data-ttu-id="9c3b0-327">Политика, которая использовалась для получения исходного маркера обновления.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-327">The policy that was used to acquire the original refresh token.</span></span> <span data-ttu-id="9c3b0-328">Другую политику в этом запросе использовать нельзя.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-328">You cannot use a different policy in this request.</span></span> <span data-ttu-id="9c3b0-329">Обратите внимание, что этот параметр добавляется к строке запроса, а не в тело запроса POST.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-329">Note that you add this parameter to the query string, not to the POST body.</span></span> |
| <span data-ttu-id="9c3b0-330">client_id</span><span class="sxs-lookup"><span data-stu-id="9c3b0-330">client_id</span></span> |<span data-ttu-id="9c3b0-331">Обязательно</span><span class="sxs-lookup"><span data-stu-id="9c3b0-331">Required</span></span> |<span data-ttu-id="9c3b0-332">Идентификатор приложения, который [портал Azure](https://portal.azure.com/) назначил вашему приложению.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-332">The application ID that the [Azure portal](https://portal.azure.com/) assigned to your app.</span></span> |
| <span data-ttu-id="9c3b0-333">grant_type</span><span class="sxs-lookup"><span data-stu-id="9c3b0-333">grant_type</span></span> |<span data-ttu-id="9c3b0-334">Обязательно</span><span class="sxs-lookup"><span data-stu-id="9c3b0-334">Required</span></span> |<span data-ttu-id="9c3b0-335">Тип предоставления. Для этого участка потока в коде проверки подлинности необходимо использовать маркер обновления.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-335">The type of grant, which must be a refresh token for this leg of the authorization code flow.</span></span> |
| <span data-ttu-id="9c3b0-336">scope</span><span class="sxs-lookup"><span data-stu-id="9c3b0-336">scope</span></span> |<span data-ttu-id="9c3b0-337">Рекомендуется</span><span class="sxs-lookup"><span data-stu-id="9c3b0-337">Recommended</span></span> |<span data-ttu-id="9c3b0-338">Список областей с разделителями-пробелами.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-338">A space-separated list of scopes.</span></span> <span data-ttu-id="9c3b0-339">При указании одной области также указываются оба запрашиваемых разрешения для Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-339">A single scope value indicates to Azure AD both permissions that are being requested.</span></span> <span data-ttu-id="9c3b0-340">Область `openid` определяет разрешение на вход пользователя и получение данных о пользователе в форме маркеров идентификации.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-340">The `openid` scope indicates a permission to sign in the user and get data about the user in the form of ID tokens.</span></span> <span data-ttu-id="9c3b0-341">Ее можно использовать для получения маркеров для веб-API серверной части приложения, идентификатор приложения которого совпадает с идентификатором приложения клиента.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-341">It can be used to get tokens to your app's own back-end web API, which is represented by the same application ID as the client.</span></span> <span data-ttu-id="9c3b0-342">Область `offline_access` означает, что вашему приложению потребуется маркер обновления для продолжительного доступа к ресурсам.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-342">The `offline_access` scope indicates that your app will need a refresh token for long-lived access to resources.</span></span> |
| <span data-ttu-id="9c3b0-343">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="9c3b0-343">redirect_uri</span></span> |<span data-ttu-id="9c3b0-344">Рекомендуется</span><span class="sxs-lookup"><span data-stu-id="9c3b0-344">Recommended</span></span> |<span data-ttu-id="9c3b0-345">Параметр `redirect_uri` приложения, в котором вы получили код авторизации.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-345">The `redirect_uri` parameter of the application where you received the authorization code.</span></span> |
| <span data-ttu-id="9c3b0-346">refresh_token</span><span class="sxs-lookup"><span data-stu-id="9c3b0-346">refresh_token</span></span> |<span data-ttu-id="9c3b0-347">Обязательно</span><span class="sxs-lookup"><span data-stu-id="9c3b0-347">Required</span></span> |<span data-ttu-id="9c3b0-348">Исходный маркер обновления, полученный на втором участке потока.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-348">The original refresh token that you acquired in the second leg of the flow.</span></span> <span data-ttu-id="9c3b0-349">Обратите внимание, что для получения маркера обновления необходимо использовать область `offline_access` как в запросе авторизации, так и в запросе маркера.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-349">Note that you must have used the scope `offline_access` in both the authorization and token requests in order to receive a refresh token.</span></span> |
| <span data-ttu-id="9c3b0-350">client_secret</span><span class="sxs-lookup"><span data-stu-id="9c3b0-350">client_secret</span></span> |<span data-ttu-id="9c3b0-351">Обязательно</span><span class="sxs-lookup"><span data-stu-id="9c3b0-351">Required</span></span> |<span data-ttu-id="9c3b0-352">Секрет приложения, созданный на [портале Azure](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="9c3b0-352">The application secret that you generated in the [Azure portal](https://portal.azure.com/).</span></span> <span data-ttu-id="9c3b0-353">Это важный артефакт безопасности,</span><span class="sxs-lookup"><span data-stu-id="9c3b0-353">This application secret is an important security artifact.</span></span> <span data-ttu-id="9c3b0-354">и он должен безопасно храниться на сервере.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-354">You should store it securely on your server.</span></span> <span data-ttu-id="9c3b0-355">Также следует периодически изменять секрет клиента.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-355">You should also rotate this client secret on a periodic basis.</span></span> |

<span data-ttu-id="9c3b0-356">Успешный ответ маркера выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="9c3b0-356">A successful token response looks like:</span></span>

```
{
    "not_before": "1442340812",
    "token_type": "Bearer",
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...",
    "scope": "90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6 offline_access",
    "expires_in": "3600",
    "refresh_token": "AAQfQmvuDy8WtUv-sd0TBwWVQs1rC-Lfxa_NDkLqpg50Cxp5Dxj0VPF1mx2Z...",
}
```
| <span data-ttu-id="9c3b0-357">Параметр</span><span class="sxs-lookup"><span data-stu-id="9c3b0-357">Parameter</span></span> | <span data-ttu-id="9c3b0-358">Описание</span><span class="sxs-lookup"><span data-stu-id="9c3b0-358">Description</span></span> |
| --- | --- |
| <span data-ttu-id="9c3b0-359">not_before</span><span class="sxs-lookup"><span data-stu-id="9c3b0-359">not_before</span></span> |<span data-ttu-id="9c3b0-360">Момент времени, в который маркер начинает считаться действительным (с начала эпохи).</span><span class="sxs-lookup"><span data-stu-id="9c3b0-360">The time at which the token is considered valid, in epoch time.</span></span> |
| <span data-ttu-id="9c3b0-361">token_type</span><span class="sxs-lookup"><span data-stu-id="9c3b0-361">token_type</span></span> |<span data-ttu-id="9c3b0-362">Значение типа маркера.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-362">The token type value.</span></span> <span data-ttu-id="9c3b0-363">Единственный тип, поддерживаемый Azure AD — `Bearer`</span><span class="sxs-lookup"><span data-stu-id="9c3b0-363">The only type that Azure AD supports is `Bearer`.</span></span> |
| <span data-ttu-id="9c3b0-364">access_token</span><span class="sxs-lookup"><span data-stu-id="9c3b0-364">access_token</span></span> |<span data-ttu-id="9c3b0-365">Подписанный маркер JWT, который вы запрашивали.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-365">The signed JWT token that you requested.</span></span> |
| <span data-ttu-id="9c3b0-366">scope</span><span class="sxs-lookup"><span data-stu-id="9c3b0-366">scope</span></span> |<span data-ttu-id="9c3b0-367">Области, для которых маркер является действительным и которые можно использовать для кэширования маркеров для последующего использования.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-367">The scope that the token is valid for, which can be used for caching tokens for later use.</span></span> |
| <span data-ttu-id="9c3b0-368">expires_in</span><span class="sxs-lookup"><span data-stu-id="9c3b0-368">expires_in</span></span> |<span data-ttu-id="9c3b0-369">Срок действия маркера доступа (в секундах).</span><span class="sxs-lookup"><span data-stu-id="9c3b0-369">The length of time that the access token is valid (in seconds).</span></span> |
| <span data-ttu-id="9c3b0-370">refresh_token</span><span class="sxs-lookup"><span data-stu-id="9c3b0-370">refresh_token</span></span> |<span data-ttu-id="9c3b0-371">Маркер обновления OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-371">An OAuth 2.0 refresh token.</span></span> <span data-ttu-id="9c3b0-372">Приложение может использовать этот маркер для получения дополнительных маркеров по истечении срока действия текущего маркера.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-372">The app can use this token to acquire additional tokens after the current token expires.</span></span>  <span data-ttu-id="9c3b0-373">Маркеры обновления обладают длительным сроком действия. Их можно использовать для продолжительного доступа к ресурсам.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-373">Refresh tokens are long-lived and can be used to retain access to resources for extended periods of time.</span></span> <span data-ttu-id="9c3b0-374">Дополнительные сведения можно найти в [справочнике по маркерам B2C](active-directory-b2c-reference-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="9c3b0-374">For more detail, refer to the [B2C token reference](active-directory-b2c-reference-tokens.md).</span></span> |

<span data-ttu-id="9c3b0-375">Сообщения об ошибках выглядят следующим образом:</span><span class="sxs-lookup"><span data-stu-id="9c3b0-375">Error responses look like:</span></span>

```
{
    "error": "access_denied",
    "error_description": "The user revoked access to the app.",
}
```

| <span data-ttu-id="9c3b0-376">Параметр</span><span class="sxs-lookup"><span data-stu-id="9c3b0-376">Parameter</span></span> | <span data-ttu-id="9c3b0-377">Описание</span><span class="sxs-lookup"><span data-stu-id="9c3b0-377">Description</span></span> |
| --- | --- |
| <span data-ttu-id="9c3b0-378">error</span><span class="sxs-lookup"><span data-stu-id="9c3b0-378">error</span></span> |<span data-ttu-id="9c3b0-379">Строка кода ошибки, которую можно использовать для классификации типов возникающих ошибок и реагирования на них.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-379">An error-code string that can be used to classify types of errors that occur and that can be used to react to errors.</span></span> |
| <span data-ttu-id="9c3b0-380">error_description</span><span class="sxs-lookup"><span data-stu-id="9c3b0-380">error_description</span></span> |<span data-ttu-id="9c3b0-381">Конкретное сообщение об ошибке, с помощью которого разработчик может определить причину возникновения ошибки проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-381">A specific error message that can help a developer identify the root cause of an authentication error.</span></span> |

## <a name="send-a-sign-out-request"></a><span data-ttu-id="9c3b0-382">Отправка запроса на выход</span><span class="sxs-lookup"><span data-stu-id="9c3b0-382">Send a sign-out request</span></span>
<span data-ttu-id="9c3b0-383">Для выхода пользователя из приложения недостаточно очистить файлы cookie или каким-то другим образом завершить сеанс пользователя.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-383">When you want to sign the user out of the app, it is not enough to clear your app's cookies or otherwise end the session with the user.</span></span> <span data-ttu-id="9c3b0-384">Необходимо также перенаправить пользователя в Azure AD для выхода. Если этого не сделать, то пользователь сможет снова пройти проверку подлинности в приложении без ввода учетных данных,</span><span class="sxs-lookup"><span data-stu-id="9c3b0-384">You must also redirect the user to Azure AD to sign out. If you fail to do so, the user might be able to reauthenticate to your app without entering their credentials again.</span></span> <span data-ttu-id="9c3b0-385">так как они будут иметь действительный сеанс единого входа с Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-385">This is because they will have a valid single sign-on session with Azure AD.</span></span>

<span data-ttu-id="9c3b0-386">Вы можете просто перенаправить пользователя на конечную точку `end_session`, которая указана в описанном выше документе метаданных OpenID (см. раздел "Проверка маркера идентификации"):</span><span class="sxs-lookup"><span data-stu-id="9c3b0-386">You can simply redirect the user to the `end_session` endpoint that is listed in the OpenID Connect metadata document described earlier in the "Validate the ID token" section:</span></span>

```
GET https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/oauth2/v2.0/logout?
p=b2c_1_sign_in
&post_logout_redirect_uri=https%3A%2F%2Faadb2cplayground.azurewebsites.net%2F
```

| <span data-ttu-id="9c3b0-387">Параметр</span><span class="sxs-lookup"><span data-stu-id="9c3b0-387">Parameter</span></span> | <span data-ttu-id="9c3b0-388">Обязательный?</span><span class="sxs-lookup"><span data-stu-id="9c3b0-388">Required?</span></span> | <span data-ttu-id="9c3b0-389">Описание</span><span class="sxs-lookup"><span data-stu-id="9c3b0-389">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="9c3b0-390">p</span><span class="sxs-lookup"><span data-stu-id="9c3b0-390">p</span></span> |<span data-ttu-id="9c3b0-391">Обязательно</span><span class="sxs-lookup"><span data-stu-id="9c3b0-391">Required</span></span> |<span data-ttu-id="9c3b0-392">Политика, которую вы хотите использовать для выхода пользователя из приложения.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-392">The policy that you want to use to sign the user out of your application.</span></span> |
| <span data-ttu-id="9c3b0-393">post_logout_redirect_uri</span><span class="sxs-lookup"><span data-stu-id="9c3b0-393">post_logout_redirect_uri</span></span> |<span data-ttu-id="9c3b0-394">Рекомендуется</span><span class="sxs-lookup"><span data-stu-id="9c3b0-394">Recommended</span></span> |<span data-ttu-id="9c3b0-395">URL-адрес, на который пользователя следует перенаправить после успешного выхода. Если он не указан, то Azure AD B2C покажет пользователю универсальное сообщение.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-395">The URL that the user should be redirected to after successful sign-out. If it is not included, Azure AD B2C shows the user a generic message.</span></span> |

> [!NOTE]
> <span data-ttu-id="9c3b0-396">Хотя при перенаправлении пользователя на конечную точку `end_session` часть данных о состоянии единого входа пользователя через Azure AD B2C будет удалена, фактически пользователь не выйдет из сеанса поставщика удостоверений социальных сетей.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-396">Although directing the user to the `end_session` endpoint will clear some of the user's single sign-on state with Azure AD B2C, it will not sign the user out of their social identity provider (IDP) session.</span></span> <span data-ttu-id="9c3b0-397">Если пользователь выберет тот же IDP во время последующего входа, он будет повторно аутентифицирован без ввода учетных данных.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-397">If the user selects the same IDP during a subsequent sign-in, they will be reauthenticated, without entering their credentials.</span></span> <span data-ttu-id="9c3b0-398">Если пользователь хочет выйти из приложения B2C, это совершенно не означает, что он также хочет выйти из учетной записи Facebook.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-398">If a user wants to sign out of your B2C application, it does not necessarily mean they want to sign out of their Facebook account.</span></span> <span data-ttu-id="9c3b0-399">Тем не менее для локальных учетных записей необходимо правильно завершить сеанс пользователя.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-399">However, in the case of local accounts, the user's session will be ended properly.</span></span>
> 
> 

## <a name="use-your-own-b2c-tenant"></a><span data-ttu-id="9c3b0-400">Использование собственного клиента B2C</span><span class="sxs-lookup"><span data-stu-id="9c3b0-400">Use your own B2C tenant</span></span>
<span data-ttu-id="9c3b0-401">Если вы хотите попробовать выполнить эти запросы самостоятельно, необходимо сначала выполнить следующие три шага, а затем заменить значения в примере выше на собственные:</span><span class="sxs-lookup"><span data-stu-id="9c3b0-401">If you want to try these requests for yourself, you must first perform these three steps, and then replace the example values described earlier with your own:</span></span>

1. <span data-ttu-id="9c3b0-402">[Создайте клиент B2C](active-directory-b2c-get-started.md)и используйте имя своего клиента в запросах.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-402">[Create a B2C tenant](active-directory-b2c-get-started.md), and use the name of your tenant in the requests.</span></span>
2. <span data-ttu-id="9c3b0-403">[Создайте приложение](active-directory-b2c-app-registration.md) для получения идентификатора приложения.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-403">[Create an application](active-directory-b2c-app-registration.md) to obtain an application ID.</span></span> <span data-ttu-id="9c3b0-404">Включите в свое приложение веб-приложение или веб-API.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-404">Include a web app/web API in your app.</span></span> <span data-ttu-id="9c3b0-405">При необходимости создайте секрет приложения.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-405">Optionally, create an application secret.</span></span>
3. <span data-ttu-id="9c3b0-406">[Создайте собственные политики](active-directory-b2c-reference-policies.md) для получения имен политик.</span><span class="sxs-lookup"><span data-stu-id="9c3b0-406">[Create your policies](active-directory-b2c-reference-policies.md) to obtain your policy names.</span></span>

