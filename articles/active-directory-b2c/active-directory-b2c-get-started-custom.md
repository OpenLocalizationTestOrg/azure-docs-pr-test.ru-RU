---
title: "Azure Active Directory B2C: начало работы с настраиваемыми политиками | Документы Майкрософт"
description: "Как tooget работу с Azure Active Directory B2C пользовательских политик"
services: active-directory-b2c
documentationcenter: 
author: rojasja
manager: krassk
editor: rojasja
ms.assetid: 658c597e-3787-465e-b377-26aebc94e46d
ms.service: active-directory-b2c
ms.workload: identity
ms.tgt_pltfrm: na
ms.topic: article
ms.devlang: na
ms.date: 08/04/2017
ms.author: joroja;parahk;gsacavdm
ms.openlocfilehash: 5ee133806395cddf18682769a6cad149889d82d1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="azure-active-directory-b2c-get-started-with-custom-policies"></a><span data-ttu-id="eed3a-103">Azure Active Directory B2C: начало работы с настраиваемыми политиками</span><span class="sxs-lookup"><span data-stu-id="eed3a-103">Azure Active Directory B2C: Get started with custom policies</span></span>

[!INCLUDE [active-directory-b2c-advanced-audience-warning](../../includes/active-directory-b2c-advanced-audience-warning.md)]

<span data-ttu-id="eed3a-104">После выполнения шагов hello в этой статье, настраиваемой политики будет поддерживать «локальная учетная запись» зарегистрироваться или войти через адрес электронной почты и пароль.</span><span class="sxs-lookup"><span data-stu-id="eed3a-104">After you complete hello steps in this article, your custom policy will support "local account" sign-up or sign-in via an email address and password.</span></span> <span data-ttu-id="eed3a-105">Кроме того, будет подготовлена среда для добавления поставщиков удостоверений (например, Facebook или Azure Active Directory).</span><span class="sxs-lookup"><span data-stu-id="eed3a-105">You will also prepare your environment for adding identity providers (like Facebook or Azure Active Directory).</span></span> <span data-ttu-id="eed3a-106">Мы рекомендуем вам toocomplete использует следующие действия перед чтением о других hello платформы качества идентификации B2C Azure Active Directory (Azure AD).</span><span class="sxs-lookup"><span data-stu-id="eed3a-106">We encourage you toocomplete these steps before reading about other uses of hello Azure Active Directory (Azure AD) B2C Identity Experience Framework.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="eed3a-107">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="eed3a-107">Prerequisites</span></span>

<span data-ttu-id="eed3a-108">Прежде чем продолжить, убедитесь, что у вас есть клиент Azure AD B2C, который является контейнером для всех пользователей, приложений, политик и т. д.</span><span class="sxs-lookup"><span data-stu-id="eed3a-108">Before proceeding, ensure that you have an Azure AD B2C tenant, which is a container for all your users, apps, policies, and more.</span></span> <span data-ttu-id="eed3a-109">Если у еще его нет, то необходимо слишком[создание клиента Azure AD B2C](active-directory-b2c-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="eed3a-109">If you don't have one already, you need too[create an Azure AD B2C tenant](active-directory-b2c-get-started.md).</span></span> <span data-ttu-id="eed3a-110">Настоятельно рекомендуем toocomplete hello все разработчики пошаговые руководства по Azure AD B2C встроенные политики и настроить свои приложения с помощью встроенных политик перед продолжением.</span><span class="sxs-lookup"><span data-stu-id="eed3a-110">We strongly encourage all developers toocomplete hello Azure AD B2C built-in policy walkthroughs and configure their applications with built-in policies before proceeding.</span></span> <span data-ttu-id="eed3a-111">Приложения будут работать с обоими типами политик, сделав незначительное изменение toohello политики имя tooinvoke hello пользовательскую политику.</span><span class="sxs-lookup"><span data-stu-id="eed3a-111">Your applications will work with both types of policies once you make a minor change toohello policy name tooinvoke hello custom policy.</span></span>

>[!NOTE]
><span data-ttu-id="eed3a-112">tooaccess редактирования пользовательской политики, необходимо, чтобы клиент связанного tooyour действительной подписки Azure.</span><span class="sxs-lookup"><span data-stu-id="eed3a-112">tooaccess custom policy editing, you need a valid Azure subscription linked tooyour tenant.</span></span> <span data-ttu-id="eed3a-113">Если вы еще не [вашей tooan клиента Azure AD B2C подписки Azure связаны](active-directory-b2c-how-to-enable-billing.md) или подписка Azure отключена, hello Identity Framework качества кнопка будет недоступна.</span><span class="sxs-lookup"><span data-stu-id="eed3a-113">If you haven't [linked your Azure AD B2C tenant tooan Azure subscription](active-directory-b2c-how-to-enable-billing.md) or your Azure subscription is disabled, hello Identity Experience Framework button won't be available.</span></span>

## <a name="add-signing-and-encryption-keys-tooyour-b2c-tenant-for-use-by-custom-policies"></a><span data-ttu-id="eed3a-114">Добавить подписывания и шифрования клиента tooyour B2C ключи для использования с пользовательской политики</span><span class="sxs-lookup"><span data-stu-id="eed3a-114">Add signing and encryption keys tooyour B2C tenant for use by custom policies</span></span>

1. <span data-ttu-id="eed3a-115">Откройте hello **Identity Framework качества** колонки в параметрах клиента Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="eed3a-115">Open hello **Identity Experience Framework** blade in your Azure AD B2C tenant settings.</span></span>
2. <span data-ttu-id="eed3a-116">Выберите **ключей политики** ключей tooview hello, доступных в клиенте.</span><span class="sxs-lookup"><span data-stu-id="eed3a-116">Select **Policy Keys** tooview hello keys available in your tenant.</span></span>
3. <span data-ttu-id="eed3a-117">Создайте B2C_1A_TokenSigningKeyContainer, если он не существует:</span><span class="sxs-lookup"><span data-stu-id="eed3a-117">Create B2C_1A_TokenSigningKeyContainer if it does not exist:</span></span><br>
    <span data-ttu-id="eed3a-118">а.</span><span class="sxs-lookup"><span data-stu-id="eed3a-118">a.</span></span> <span data-ttu-id="eed3a-119">Выберите **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-119">Select **Add**.</span></span> <br>
    <span data-ttu-id="eed3a-120">b.</span><span class="sxs-lookup"><span data-stu-id="eed3a-120">b.</span></span> <span data-ttu-id="eed3a-121">Выберите **Создать**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-121">Select **Generate**.</span></span><br>
    <span data-ttu-id="eed3a-122">c.</span><span class="sxs-lookup"><span data-stu-id="eed3a-122">c.</span></span> <span data-ttu-id="eed3a-123">Для параметра **Имя** используйте значение `TokenSigningKeyContainer`.</span><span class="sxs-lookup"><span data-stu-id="eed3a-123">For **Name**, use `TokenSigningKeyContainer`.</span></span> <br> 
    <span data-ttu-id="eed3a-124">префикс Hello `B2C_1A_` могут быть добавлены автоматически.</span><span class="sxs-lookup"><span data-stu-id="eed3a-124">hello prefix `B2C_1A_` might be added automatically.</span></span><br>
    <span data-ttu-id="eed3a-125">d.</span><span class="sxs-lookup"><span data-stu-id="eed3a-125">d.</span></span> <span data-ttu-id="eed3a-126">Для параметра **Тип ключа** используйте значение **RSA**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-126">For **Key type**, use **RSA**.</span></span><br>
    <span data-ttu-id="eed3a-127">д.</span><span class="sxs-lookup"><span data-stu-id="eed3a-127">e.</span></span> <span data-ttu-id="eed3a-128">Для **даты**, используйте значения по умолчанию hello.</span><span class="sxs-lookup"><span data-stu-id="eed3a-128">For **Dates**, use hello defaults.</span></span> <br>
    <span data-ttu-id="eed3a-129">f.</span><span class="sxs-lookup"><span data-stu-id="eed3a-129">f.</span></span> <span data-ttu-id="eed3a-130">Для параметра **Использование ключа** задайте значение **Подпись**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-130">For **Key usage**, use **Signature**.</span></span><br>
    <span data-ttu-id="eed3a-131">ж.</span><span class="sxs-lookup"><span data-stu-id="eed3a-131">g.</span></span> <span data-ttu-id="eed3a-132">Нажмите кнопку **Создать**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-132">Select **Create**.</span></span><br>
4. <span data-ttu-id="eed3a-133">Создайте B2C_1A_TokenEncryptionKeyContainer, если он не существует:</span><span class="sxs-lookup"><span data-stu-id="eed3a-133">Create B2C_1A_TokenEncryptionKeyContainer if it does not exist:</span></span><br>
 <span data-ttu-id="eed3a-134">а.</span><span class="sxs-lookup"><span data-stu-id="eed3a-134">a.</span></span> <span data-ttu-id="eed3a-135">Выберите **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-135">Select **Add**.</span></span><br>
 <span data-ttu-id="eed3a-136">b.</span><span class="sxs-lookup"><span data-stu-id="eed3a-136">b.</span></span> <span data-ttu-id="eed3a-137">Выберите **Создать**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-137">Select **Generate**.</span></span><br>
 <span data-ttu-id="eed3a-138">c.</span><span class="sxs-lookup"><span data-stu-id="eed3a-138">c.</span></span> <span data-ttu-id="eed3a-139">Для параметра **Имя** используйте значение `TokenEncryptionKeyContainer`.</span><span class="sxs-lookup"><span data-stu-id="eed3a-139">For **Name**, use `TokenEncryptionKeyContainer`.</span></span> <br>
   <span data-ttu-id="eed3a-140">префикс Hello `B2C_1A`_ могут быть добавлены автоматически.</span><span class="sxs-lookup"><span data-stu-id="eed3a-140">hello prefix `B2C_1A`_ might be added automatically.</span></span><br>
 <span data-ttu-id="eed3a-141">d.</span><span class="sxs-lookup"><span data-stu-id="eed3a-141">d.</span></span> <span data-ttu-id="eed3a-142">Для параметра **Тип ключа** используйте значение **RSA**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-142">For **Key type**, use **RSA**.</span></span><br>
 <span data-ttu-id="eed3a-143">д.</span><span class="sxs-lookup"><span data-stu-id="eed3a-143">e.</span></span> <span data-ttu-id="eed3a-144">Для **даты**, используйте значения по умолчанию hello.</span><span class="sxs-lookup"><span data-stu-id="eed3a-144">For **Dates**, use hello defaults.</span></span><br>
 <span data-ttu-id="eed3a-145">f.</span><span class="sxs-lookup"><span data-stu-id="eed3a-145">f.</span></span> <span data-ttu-id="eed3a-146">Для параметра **Использование ключа** задайте значение **Шифрование**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-146">For **Key usage**, use **Encryption**.</span></span><br>
 <span data-ttu-id="eed3a-147">g.</span><span class="sxs-lookup"><span data-stu-id="eed3a-147">g.</span></span> <span data-ttu-id="eed3a-148">Нажмите кнопку **Создать**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-148">Select **Create**.</span></span><br>
5. <span data-ttu-id="eed3a-149">Создайте B2C_1A_FacebookSecret.</span><span class="sxs-lookup"><span data-stu-id="eed3a-149">Create B2C_1A_FacebookSecret.</span></span> <br>
<span data-ttu-id="eed3a-150">Если уже имеется секрет приложения Facebook, добавьте его в качестве ключа tooyour политики клиента.</span><span class="sxs-lookup"><span data-stu-id="eed3a-150">If you already have a Facebook application secret, add it as a policy key tooyour tenant.</span></span> <span data-ttu-id="eed3a-151">В противном случае необходимо создать ключ hello с значение-заполнитель, чтобы политик прошел проверку.</span><span class="sxs-lookup"><span data-stu-id="eed3a-151">Otherwise, you must create hello key with a placeholder value so that your policies pass validation.</span></span><br>
 <span data-ttu-id="eed3a-152">а.</span><span class="sxs-lookup"><span data-stu-id="eed3a-152">a.</span></span> <span data-ttu-id="eed3a-153">Выберите **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-153">Select **Add**.</span></span><br>
 <span data-ttu-id="eed3a-154">b.</span><span class="sxs-lookup"><span data-stu-id="eed3a-154">b.</span></span> <span data-ttu-id="eed3a-155">В пункте **Параметры** используйте вариант **Вручную**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-155">For **Options**, use **Manual**.</span></span><br>
 <span data-ttu-id="eed3a-156">c.</span><span class="sxs-lookup"><span data-stu-id="eed3a-156">c.</span></span> <span data-ttu-id="eed3a-157">Для параметра **Имя** используйте значение `FacebookSecret`.</span><span class="sxs-lookup"><span data-stu-id="eed3a-157">For **Name**, use `FacebookSecret`.</span></span> <br>
 <span data-ttu-id="eed3a-158">префикс Hello `B2C_1A_` могут быть добавлены автоматически.</span><span class="sxs-lookup"><span data-stu-id="eed3a-158">hello prefix `B2C_1A_` might be added automatically.</span></span><br>
 <span data-ttu-id="eed3a-159">d.</span><span class="sxs-lookup"><span data-stu-id="eed3a-159">d.</span></span> <span data-ttu-id="eed3a-160">В hello **секрет** введите ваш FacebookSecret от developers.facebook.com или `0` как заполнитель.</span><span class="sxs-lookup"><span data-stu-id="eed3a-160">In hello **Secret** box, enter your FacebookSecret from developers.facebook.com or `0` as a placeholder.</span></span> <span data-ttu-id="eed3a-161">*Это не идентификатор приложения Facebook.*</span><span class="sxs-lookup"><span data-stu-id="eed3a-161">*This is not your Facebook app ID.*</span></span> <br>
 <span data-ttu-id="eed3a-162">д.</span><span class="sxs-lookup"><span data-stu-id="eed3a-162">e.</span></span> <span data-ttu-id="eed3a-163">Для параметра **Использование ключа** задайте значение **Подпись**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-163">For **Key usage**, use **Signature**.</span></span> <br>
 <span data-ttu-id="eed3a-164">Е.</span><span class="sxs-lookup"><span data-stu-id="eed3a-164">f.</span></span> <span data-ttu-id="eed3a-165">Выберите **Создать** и подтвердите создание.</span><span class="sxs-lookup"><span data-stu-id="eed3a-165">Select **Create** and confirm creation.</span></span>

## <a name="register-identity-experience-framework-applications"></a><span data-ttu-id="eed3a-166">Регистрация приложений инфраструктуры процедур идентификации</span><span class="sxs-lookup"><span data-stu-id="eed3a-166">Register Identity Experience Framework applications</span></span>

<span data-ttu-id="eed3a-167">Azure AD B2C требует tooregister два дополнительных приложений, которые используются toosign engine hello вверх и регистрация пользователей.</span><span class="sxs-lookup"><span data-stu-id="eed3a-167">Azure AD B2C requires you tooregister two extra applications that are used by hello engine toosign up and sign in users.</span></span>

>[!NOTE]
><span data-ttu-id="eed3a-168">Необходимо создать два приложения, разрешить вход с использованием локальных учетных записей: IdentityExperienceFramework (веб-приложение) и ProxyIdentityExperienceFramework (собственное приложение) с делегировать разрешения IdentityExperienceFramework приложение hello.</span><span class="sxs-lookup"><span data-stu-id="eed3a-168">You must create two applications that enable sign-in using local accounts: IdentityExperienceFramework (a web app) and ProxyIdentityExperienceFramework (a native app) with delegated permission from hello IdentityExperienceFramework app.</span></span> <span data-ttu-id="eed3a-169">Локальные учетные записи хранятся только в клиенте.</span><span class="sxs-lookup"><span data-stu-id="eed3a-169">Local accounts exist only in your tenant.</span></span> <span data-ttu-id="eed3a-170">Пользователи подписаться на уникальный почтовый адрес и пароль сочетания tooaccess приложений клиент зарегистрирован.</span><span class="sxs-lookup"><span data-stu-id="eed3a-170">Your users sign up with a unique email address/password combination tooaccess your tenant-registered applications.</span></span>

### <a name="create-hello-identityexperienceframework-application"></a><span data-ttu-id="eed3a-171">Создание приложения hello IdentityExperienceFramework</span><span class="sxs-lookup"><span data-stu-id="eed3a-171">Create hello IdentityExperienceFramework application</span></span>

1. <span data-ttu-id="eed3a-172">В hello [портал Azure](https://portal.azure.com), для переключения в hello [контекст клиента Azure AD B2C](active-directory-b2c-navigate-to-b2c-context.md).</span><span class="sxs-lookup"><span data-stu-id="eed3a-172">In hello [Azure portal](https://portal.azure.com), switch into hello [context of your Azure AD B2C tenant](active-directory-b2c-navigate-to-b2c-context.md).</span></span>
2. <span data-ttu-id="eed3a-173">Откройте hello **Azure Active Directory** колонке (не hello **Azure AD B2C** колонке).</span><span class="sxs-lookup"><span data-stu-id="eed3a-173">Open hello **Azure Active Directory** blade (not hello **Azure AD B2C** blade).</span></span> <span data-ttu-id="eed3a-174">Может потребоваться tooselect **более служб** toofind его.</span><span class="sxs-lookup"><span data-stu-id="eed3a-174">You might need tooselect **More Services** toofind it.</span></span>
3. <span data-ttu-id="eed3a-175">Щелкните **Регистрация приложений**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-175">Select **App registrations**.</span></span>
4. <span data-ttu-id="eed3a-176">Выберите **Регистрация нового приложения**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-176">Select **New application registration**.</span></span>
   * <span data-ttu-id="eed3a-177">Для параметра **Имя** используйте значение `IdentityExperienceFramework`.</span><span class="sxs-lookup"><span data-stu-id="eed3a-177">For **Name**, use `IdentityExperienceFramework`.</span></span>
   * <span data-ttu-id="eed3a-178">Для параметра **Тип приложения** используйте значение **Веб-приложение/API**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-178">For **Application type**, use **Web app/API**.</span></span>
   * <span data-ttu-id="eed3a-179">Для параметра **URL-адрес входа** используйте адрес `https://login.microsoftonline.com/yourtenant.onmicrosoft.com`, где `yourtenant` — это доменное имя клиента Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="eed3a-179">For **Sign-on URL**, use `https://login.microsoftonline.com/yourtenant.onmicrosoft.com`, where `yourtenant` is your Azure AD B2C tenant domain name.</span></span>
5. <span data-ttu-id="eed3a-180">Нажмите кнопку **Создать**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-180">Select **Create**.</span></span>
6. <span data-ttu-id="eed3a-181">После его создания, выберите только что созданный hello приложение **IdentityExperienceFramework**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-181">Once it is created, select hello newly created application **IdentityExperienceFramework**.</span></span><br>
   * <span data-ttu-id="eed3a-182">Выберите **Свойства**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-182">Select **Properties**.</span></span><br>
   * <span data-ttu-id="eed3a-183">Скопируйте идентификатор приложения hello и сохраните его на более поздний срок.</span><span class="sxs-lookup"><span data-stu-id="eed3a-183">Copy hello application ID and save it for later.</span></span>

### <a name="create-hello-proxyidentityexperienceframework-application"></a><span data-ttu-id="eed3a-184">Создание приложения hello ProxyIdentityExperienceFramework</span><span class="sxs-lookup"><span data-stu-id="eed3a-184">Create hello ProxyIdentityExperienceFramework application</span></span>

1. <span data-ttu-id="eed3a-185">Щелкните **Регистрация приложений**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-185">Select **App registrations**.</span></span>
1. <span data-ttu-id="eed3a-186">Выберите **Регистрация нового приложения**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-186">Select **New application registration**.</span></span>
   * <span data-ttu-id="eed3a-187">Для параметра **Имя** используйте значение `ProxyIdentityExperienceFramework`.</span><span class="sxs-lookup"><span data-stu-id="eed3a-187">For **Name**, use `ProxyIdentityExperienceFramework`.</span></span>
   * <span data-ttu-id="eed3a-188">Для параметра **Тип приложения** используйте значение **Встроенное**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-188">For **Application type**, use **Native**.</span></span>
   * <span data-ttu-id="eed3a-189">Для параметра **URI перенаправления**, используйте адрес `https://login.microsoftonline.com/yourtenant.onmicrosoft.com`, где `yourtenant` — это ваш клиент Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="eed3a-189">For **Redirect URI**, use `https://login.microsoftonline.com/yourtenant.onmicrosoft.com`, where `yourtenant` is your Azure AD B2C tenant.</span></span>
1. <span data-ttu-id="eed3a-190">Нажмите кнопку **Создать**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-190">Select **Create**.</span></span>
1. <span data-ttu-id="eed3a-191">Как только будет создана, выберите приложение hello **ProxyIdentityExperienceFramework**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-191">Once it has been created, select hello application **ProxyIdentityExperienceFramework**.</span></span><br>
   * <span data-ttu-id="eed3a-192">Выберите **Свойства**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-192">Select **Properties**.</span></span> <br>
   * <span data-ttu-id="eed3a-193">Скопируйте идентификатор приложения hello и сохраните его на более поздний срок.</span><span class="sxs-lookup"><span data-stu-id="eed3a-193">Copy hello application ID and save it for later.</span></span>
1. <span data-ttu-id="eed3a-194">Выберите **Необходимые разрешения**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-194">Select **Required permissions**.</span></span>
1. <span data-ttu-id="eed3a-195">Выберите **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-195">Select **Add**.</span></span>
1. <span data-ttu-id="eed3a-196">Выберите **Выбор API**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-196">Select **Select an API**.</span></span>
1. <span data-ttu-id="eed3a-197">Поиск имени hello IdentityExperienceFramework.</span><span class="sxs-lookup"><span data-stu-id="eed3a-197">Search for hello name IdentityExperienceFramework.</span></span> <span data-ttu-id="eed3a-198">Выберите **IdentityExperienceFramework** в hello результатов и нажмите кнопку **выберите**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-198">Select **IdentityExperienceFramework** in hello results, and then click **Select**.</span></span>
1. <span data-ttu-id="eed3a-199">Установите флажок "hello" рядом слишком**IdentityExperienceFramework доступа**и нажмите кнопку **выберите**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-199">Select hello check box next too**Access IdentityExperienceFramework**, and then click **Select**.</span></span>
1. <span data-ttu-id="eed3a-200">Нажмите кнопку **Готово**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-200">Select **Done**.</span></span>
1. <span data-ttu-id="eed3a-201">Выберите **Предоставление разрешений**, затем **Да** для подтверждения.</span><span class="sxs-lookup"><span data-stu-id="eed3a-201">Select **Grant Permissions**, and then confirm by selecting **Yes**.</span></span>

## <a name="download-starter-pack-and-modify-policies"></a><span data-ttu-id="eed3a-202">Скачивание начального пакета и изменение политик</span><span class="sxs-lookup"><span data-stu-id="eed3a-202">Download starter pack and modify policies</span></span>

<span data-ttu-id="eed3a-203">Настраиваемые политики — это набор XML-файлы, требующие клиента Azure AD B2C tooyour toobe отправлен.</span><span class="sxs-lookup"><span data-stu-id="eed3a-203">Custom policies are a set of XML files that need toobe uploaded tooyour Azure AD B2C tenant.</span></span> <span data-ttu-id="eed3a-204">Мы предоставляем tooget пакеты начального вам быстро.</span><span class="sxs-lookup"><span data-stu-id="eed3a-204">We provide starter packs tooget you going quickly.</span></span> <span data-ttu-id="eed3a-205">Каждый пакет начального в hello после списка содержит hello наименьшее количество технические профилей и поездок пользователя требуется tooachieve hello сценария, описанных:</span><span class="sxs-lookup"><span data-stu-id="eed3a-205">Each starter pack in hello following list contains hello smallest number of technical profiles and user journeys needed tooachieve hello scenarios described:</span></span>
 * <span data-ttu-id="eed3a-206">LocalAccounts.</span><span class="sxs-lookup"><span data-stu-id="eed3a-206">LocalAccounts.</span></span> <span data-ttu-id="eed3a-207">Позволяет использовать hello локальных учетных записей.</span><span class="sxs-lookup"><span data-stu-id="eed3a-207">Enables hello use of local accounts only.</span></span>
 * <span data-ttu-id="eed3a-208">SocialAccounts.</span><span class="sxs-lookup"><span data-stu-id="eed3a-208">SocialAccounts.</span></span> <span data-ttu-id="eed3a-209">Позволяет использовать hello только учетные записи социальных сетей (или федерации).</span><span class="sxs-lookup"><span data-stu-id="eed3a-209">Enables hello use of social (or federated) accounts only.</span></span>
 * <span data-ttu-id="eed3a-210">**SocialAndLocalAccounts**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-210">**SocialAndLocalAccounts**.</span></span> <span data-ttu-id="eed3a-211">Этот файл используется для пошагового руководства hello.</span><span class="sxs-lookup"><span data-stu-id="eed3a-211">We use this file for hello walkthrough.</span></span>
 * <span data-ttu-id="eed3a-212">SocialAndLocalAccountsWithMFA.</span><span class="sxs-lookup"><span data-stu-id="eed3a-212">SocialAndLocalAccountsWithMFA.</span></span> <span data-ttu-id="eed3a-213">Сюда включены параметры локальной идентификации, многофакторной идентификации и идентификации с помощью социальных сетей.</span><span class="sxs-lookup"><span data-stu-id="eed3a-213">Social, local, and Multi-Factor Authentication options are included here.</span></span>

<span data-ttu-id="eed3a-214">Каждый начальный пакет содержит:</span><span class="sxs-lookup"><span data-stu-id="eed3a-214">Each starter pack contains:</span></span>

* <span data-ttu-id="eed3a-215">Hello [основного файла](active-directory-b2c-overview-custom.md#policy-files) hello политики.</span><span class="sxs-lookup"><span data-stu-id="eed3a-215">hello [base file](active-directory-b2c-overview-custom.md#policy-files) of hello policy.</span></span> <span data-ttu-id="eed3a-216">Несколько изменений, которые требуется toohello базового.</span><span class="sxs-lookup"><span data-stu-id="eed3a-216">Few modifications are required toohello base.</span></span>
* <span data-ttu-id="eed3a-217">Hello [файла расширения](active-directory-b2c-overview-custom.md#policy-files) hello политики.</span><span class="sxs-lookup"><span data-stu-id="eed3a-217">hello [extension file](active-directory-b2c-overview-custom.md#policy-files) of hello policy.</span></span>  <span data-ttu-id="eed3a-218">В этот файл вносится большинство изменений конфигурации.</span><span class="sxs-lookup"><span data-stu-id="eed3a-218">This file is where most configuration changes are made.</span></span>
* <span data-ttu-id="eed3a-219">[Файлы проверяющей стороны](active-directory-b2c-overview-custom.md#policy-files) — это файлы, которые вызывает приложение для выполнения определенных задач.</span><span class="sxs-lookup"><span data-stu-id="eed3a-219">[Relying party files](active-directory-b2c-overview-custom.md#policy-files) are task-specific files called by your application.</span></span>

>[!NOTE]
><span data-ttu-id="eed3a-220">Если редактор XML по своему поддерживает проверки, проверка файлов hello по схеме TrustFrameworkPolicy_0.3.0.0.xsd XML hello, расположенный в корневом каталоге hello пакета начального приветствия.</span><span class="sxs-lookup"><span data-stu-id="eed3a-220">If your XML editor supports validation, validate hello files against hello TrustFrameworkPolicy_0.3.0.0.xsd XML schema that is located in hello root directory of hello starter pack.</span></span> <span data-ttu-id="eed3a-221">При проверке по схеме XML определяются ошибки перед отправкой.</span><span class="sxs-lookup"><span data-stu-id="eed3a-221">XML schema validation identifies errors before uploading.</span></span>

 <span data-ttu-id="eed3a-222">Давайте приступим.</span><span class="sxs-lookup"><span data-stu-id="eed3a-222">Let's get started:</span></span>

1. <span data-ttu-id="eed3a-223">Скачайте пакет active-directory-b2c-custom-policy-starterpack из репозитория GitHub.</span><span class="sxs-lookup"><span data-stu-id="eed3a-223">Download active-directory-b2c-custom-policy-starterpack from GitHub.</span></span> <span data-ttu-id="eed3a-224">[Загрузите ZIP-файл hello](https://github.com/Azure-Samples/active-directory-b2c-custom-policy-starterpack/archive/master.zip) или выполнения</span><span class="sxs-lookup"><span data-stu-id="eed3a-224">[Download hello .zip file](https://github.com/Azure-Samples/active-directory-b2c-custom-policy-starterpack/archive/master.zip) or run</span></span>

    ```console
    git clone https://github.com/Azure-Samples/active-directory-b2c-custom-policy-starterpack
    ```
2. <span data-ttu-id="eed3a-225">Откройте папку SocialAndLocalAccounts hello.</span><span class="sxs-lookup"><span data-stu-id="eed3a-225">Open hello SocialAndLocalAccounts folder.</span></span>  <span data-ttu-id="eed3a-226">базовый файл Hello (TrustFrameworkBase.xml) в этой папке содержит содержимое, необходимых для учетных записей локальных и социального и ресурсы.</span><span class="sxs-lookup"><span data-stu-id="eed3a-226">hello base file (TrustFrameworkBase.xml) in this folder contains content needed for both local and social/corporate accounts.</span></span> <span data-ttu-id="eed3a-227">содержимое социальных Hello не влияет на шаги hello начало локальных учетных записей и выполнения.</span><span class="sxs-lookup"><span data-stu-id="eed3a-227">hello social content does not interfere with hello steps for getting local accounts up and running.</span></span>
3. <span data-ttu-id="eed3a-228">Откройте файл TrustFrameworkBase.xml.</span><span class="sxs-lookup"><span data-stu-id="eed3a-228">Open TrustFrameworkBase.xml.</span></span> <span data-ttu-id="eed3a-229">Если вам нужен редактор XML, [попробуйте Visual Studio Code](https://code.visualstudio.com/download) — упрощенный кроссплатформенный редактор.</span><span class="sxs-lookup"><span data-stu-id="eed3a-229">If you need an XML editor, [try Visual Studio Code](https://code.visualstudio.com/download), a lightweight cross-platform editor.</span></span>
4. <span data-ttu-id="eed3a-230">В корневом каталоге hello `TrustFrameworkPolicy` элемент, обновление hello `TenantId` и `PublicPolicyUri` атрибуты, заменив `yourtenant.onmicrosoft.com` с hello доменное имя вашего клиента Azure AD B2C:</span><span class="sxs-lookup"><span data-stu-id="eed3a-230">In hello root `TrustFrameworkPolicy` element, update hello `TenantId` and `PublicPolicyUri` attributes, replacing `yourtenant.onmicrosoft.com` with hello domain name of your Azure AD B2C tenant:</span></span>
   ```xml
    <TrustFrameworkPolicy
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns="http://schemas.microsoft.com/online/cpim/schemas/2013/06"
    PolicySchemaVersion="0.3.0.0"
    TenantId="yourtenant.onmicrosoft.com"
    PolicyId="B2C_1A_TrustFrameworkBase"
    PublicPolicyUri="http://yourtenant.onmicrosoft.com">
    ```
   >[!NOTE]
   ><span data-ttu-id="eed3a-231">`PolicyId`— Имя политики hello, которое будет отображаться в портале hello и hello имя, по которому этот файл политики ссылаются другие файлы политики.</span><span class="sxs-lookup"><span data-stu-id="eed3a-231">`PolicyId` is hello policy name that you see in hello portal and hello name by which this policy file is referenced by other policy files.</span></span>

5. <span data-ttu-id="eed3a-232">Сохраните файл hello.</span><span class="sxs-lookup"><span data-stu-id="eed3a-232">Save hello file.</span></span>
6. <span data-ttu-id="eed3a-233">Откройте файл TrustFrameworkExtensions.xml.</span><span class="sxs-lookup"><span data-stu-id="eed3a-233">Open TrustFrameworkExtensions.xml.</span></span> <span data-ttu-id="eed3a-234">Сделать hello и те же два изменения, заменив `yourtenant.onmicrosoft.com` с вашим клиентом Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="eed3a-234">Make hello same two changes by replacing `yourtenant.onmicrosoft.com` with your Azure AD B2C tenant.</span></span> <span data-ttu-id="eed3a-235">Сделать hello же замены в hello `<TenantId>` элемент для всех трех изменения.</span><span class="sxs-lookup"><span data-stu-id="eed3a-235">Make hello same replacement in hello `<TenantId>` element for a total of three changes.</span></span> <span data-ttu-id="eed3a-236">Сохраните файл hello.</span><span class="sxs-lookup"><span data-stu-id="eed3a-236">Save hello file.</span></span>
7. <span data-ttu-id="eed3a-237">Откройте файл SignUpOrSignIn.xml.</span><span class="sxs-lookup"><span data-stu-id="eed3a-237">Open SignUpOrSignIn.xml.</span></span> <span data-ttu-id="eed3a-238">Внести аналогичные изменения hello, заменив `yourtenant.onmicrosoft.com` с вашим клиентом Azure AD B2C в трех местах.</span><span class="sxs-lookup"><span data-stu-id="eed3a-238">Make hello same changes by replacing `yourtenant.onmicrosoft.com` with your Azure AD B2C tenant in three places.</span></span> <span data-ttu-id="eed3a-239">Сохраните файл hello.</span><span class="sxs-lookup"><span data-stu-id="eed3a-239">Save hello file.</span></span>
8. <span data-ttu-id="eed3a-240">Сброс пароля открытым hello и профиль редактировать файлы.</span><span class="sxs-lookup"><span data-stu-id="eed3a-240">Open hello password reset and profile edit files.</span></span> <span data-ttu-id="eed3a-241">Внести аналогичные изменения hello, заменив `yourtenant.onmicrosoft.com` с вашим клиентом Azure AD B2C в трех местах в каждом файле.</span><span class="sxs-lookup"><span data-stu-id="eed3a-241">Make hello same changes by replacing `yourtenant.onmicrosoft.com` with your Azure AD B2C tenant in three places in each file.</span></span> <span data-ttu-id="eed3a-242">Сохраните файлы hello.</span><span class="sxs-lookup"><span data-stu-id="eed3a-242">Save hello files.</span></span>

### <a name="add-hello-application-ids-tooyour-custom-policy"></a><span data-ttu-id="eed3a-243">Добавление настраиваемой политики удостоверения приложения tooyour hello</span><span class="sxs-lookup"><span data-stu-id="eed3a-243">Add hello application IDs tooyour custom policy</span></span>
<span data-ttu-id="eed3a-244">Добавление файла расширения toohello идентификаторы приложения hello (`TrustFrameworkExtensions.xml`):</span><span class="sxs-lookup"><span data-stu-id="eed3a-244">Add hello application IDs toohello extensions file (`TrustFrameworkExtensions.xml`):</span></span>

1. <span data-ttu-id="eed3a-245">В файле расширения hello (TrustFrameworkExtensions.xml) найдите элемент hello `<TechnicalProfile Id="login-NonInteractive">`.</span><span class="sxs-lookup"><span data-stu-id="eed3a-245">In hello extensions file (TrustFrameworkExtensions.xml), find hello element `<TechnicalProfile Id="login-NonInteractive">`.</span></span>
2. <span data-ttu-id="eed3a-246">Замените оба экземпляра `IdentityExperienceFrameworkAppId` с Идентификатором hello приложения hello Identity Framework качества приложения, созданного ранее.</span><span class="sxs-lookup"><span data-stu-id="eed3a-246">Replace both instances of `IdentityExperienceFrameworkAppId` with hello application ID of hello Identity Experience Framework application that you created earlier.</span></span> <span data-ttu-id="eed3a-247">Пример:</span><span class="sxs-lookup"><span data-stu-id="eed3a-247">Here is an example:</span></span>

   ```xml
   <Item Key="client_id">8322dedc-cbf4-43bc-8bb6-141d16f0f489</Item>
   ```
3. <span data-ttu-id="eed3a-248">Замените оба экземпляра `ProxyIdentityExperienceFrameworkAppId` с Идентификатором hello приложения Framework качества удостоверение прокси-сервера, ранее созданную приложения hello.</span><span class="sxs-lookup"><span data-stu-id="eed3a-248">Replace both instances of `ProxyIdentityExperienceFrameworkAppId` with hello application ID of hello Proxy Identity Experience Framework application that you created earlier.</span></span>
4. <span data-ttu-id="eed3a-249">Сохраните файл расширений.</span><span class="sxs-lookup"><span data-stu-id="eed3a-249">Save your extensions file.</span></span>

## <a name="upload-hello-policies-tooyour-tenant"></a><span data-ttu-id="eed3a-250">Отправка hello политики tooyour клиента</span><span class="sxs-lookup"><span data-stu-id="eed3a-250">Upload hello policies tooyour tenant</span></span>

1. <span data-ttu-id="eed3a-251">В hello [портал Azure](https://portal.azure.com), для переключения в hello [контекст клиента Azure AD B2C](active-directory-b2c-navigate-to-b2c-context.md)и откройте hello **Azure AD B2C** колонку.</span><span class="sxs-lookup"><span data-stu-id="eed3a-251">In hello [Azure portal](https://portal.azure.com), switch into hello [context of your Azure AD B2C tenant](active-directory-b2c-navigate-to-b2c-context.md), and open hello **Azure AD B2C** blade.</span></span>
2. <span data-ttu-id="eed3a-252">Выберите **Инфраструктура процедур идентификации**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-252">Select **Identity Experience Framework**.</span></span>
3. <span data-ttu-id="eed3a-253">Щелкните **Отправить политику**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-253">Select **Upload Policy**.</span></span>

    >[!WARNING]
    ><span data-ttu-id="eed3a-254">файлы пользовательской политики Hello необходимо отправить в hello следующий порядок:</span><span class="sxs-lookup"><span data-stu-id="eed3a-254">hello custom policy files must be uploaded in hello following order:</span></span>

1. <span data-ttu-id="eed3a-255">Отправьте файл TrustFrameworkBase.xml.</span><span class="sxs-lookup"><span data-stu-id="eed3a-255">Upload TrustFrameworkBase.xml.</span></span>
2. <span data-ttu-id="eed3a-256">Отправьте файл TrustFrameworkExtensions.xml.</span><span class="sxs-lookup"><span data-stu-id="eed3a-256">Upload TrustFrameworkExtensions.xml.</span></span>
3. <span data-ttu-id="eed3a-257">Отправьте файл SignUpOrSignin.xml.</span><span class="sxs-lookup"><span data-stu-id="eed3a-257">Upload SignUpOrSignin.xml.</span></span>
4. <span data-ttu-id="eed3a-258">Отправьте другие файлы политики.</span><span class="sxs-lookup"><span data-stu-id="eed3a-258">Upload your other policy files.</span></span>

<span data-ttu-id="eed3a-259">При загрузке файла hello имя файла политики hello добавляется символ `B2C_1A_`.</span><span class="sxs-lookup"><span data-stu-id="eed3a-259">When a file is uploaded, hello name of hello policy file is prepended with `B2C_1A_`.</span></span>

## <a name="test-hello-custom-policy-by-using-run-now"></a><span data-ttu-id="eed3a-260">Тестирование настраиваемой политики hello с использованием выполнить</span><span class="sxs-lookup"><span data-stu-id="eed3a-260">Test hello custom policy by using Run Now</span></span>

1. <span data-ttu-id="eed3a-261">Откройте **параметры Azure AD B2C** и перейти слишком**возможности платформы идентификации**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-261">Open **Azure AD B2C Settings** and go too**Identity Experience Framework**.</span></span>

   >[!NOTE]
   ><span data-ttu-id="eed3a-262">**Теперь запустите** требует по крайней мере одно приложение toobe предварительно зарегистрирован на приветствия клиента.</span><span class="sxs-lookup"><span data-stu-id="eed3a-262">**Run now** requires at least one application toobe preregistered on hello tenant.</span></span> <span data-ttu-id="eed3a-263">Приложения должны быть зарегистрированы в клиенте hello B2C, либо с помощью hello **приложений** пунктов меню в Azure AD B2C или с помощью платформы идентификации качества tooinvoke hello встроенные и пользовательские политики.</span><span class="sxs-lookup"><span data-stu-id="eed3a-263">Applications must be registered in hello B2C tenant, either by using hello **Applications** menu selection in Azure AD B2C or by using hello Identity Experience Framework tooinvoke both built-in and custom policies.</span></span> <span data-ttu-id="eed3a-264">Каждое приложение необходимо зарегистрировать один раз.</span><span class="sxs-lookup"><span data-stu-id="eed3a-264">Only one registration per application is needed.</span></span><br><br>
   <span data-ttu-id="eed3a-265">toolearn приложений tooregister. в статье hello Azure AD B2C [приступить к работе](active-directory-b2c-get-started.md) статьи или hello [регистрацию приложения](active-directory-b2c-app-registration.md) статьи.</span><span class="sxs-lookup"><span data-stu-id="eed3a-265">toolearn how tooregister applications, see hello Azure AD B2C [Get started](active-directory-b2c-get-started.md) article or hello [Application registration](active-directory-b2c-app-registration.md) article.</span></span>  

2. <span data-ttu-id="eed3a-266">Откройте B2C_1A_signup_signin, hello проверяющей стороны (RP) настраиваемой политики загруженный.</span><span class="sxs-lookup"><span data-stu-id="eed3a-266">Open B2C_1A_signup_signin, hello relying party (RP) custom policy that you uploaded.</span></span> <span data-ttu-id="eed3a-267">Выберите **Запустить сейчас**.</span><span class="sxs-lookup"><span data-stu-id="eed3a-267">Select **Run now**.</span></span>

3. <span data-ttu-id="eed3a-268">Должно быть toosign доступ с помощью адреса электронной почты.</span><span class="sxs-lookup"><span data-stu-id="eed3a-268">You should be able toosign up using an email address.</span></span>

4. <span data-ttu-id="eed3a-269">Выполните вход с hello учетную запись, у вас есть tooconfirm hello правильную конфигурацию.</span><span class="sxs-lookup"><span data-stu-id="eed3a-269">Sign in with hello same account tooconfirm that you have hello correct configuration.</span></span>

>[!NOTE]
><span data-ttu-id="eed3a-270">Часто причина ошибки при входе заключается в неправильной настройке приложения IdentityExperienceFramework.</span><span class="sxs-lookup"><span data-stu-id="eed3a-270">A common cause of sign-in failure is an improperly configured IdentityExperienceFramework app.</span></span>


## <a name="next-steps"></a><span data-ttu-id="eed3a-271">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="eed3a-271">Next steps</span></span>

### <a name="add-facebook-as-an-identity-provider"></a><span data-ttu-id="eed3a-272">Добавление Facebook в качестве поставщика удостоверений</span><span class="sxs-lookup"><span data-stu-id="eed3a-272">Add Facebook as an identity provider</span></span>
<span data-ttu-id="eed3a-273">tooset копирование Facebook:</span><span class="sxs-lookup"><span data-stu-id="eed3a-273">tooset up Facebook:</span></span>
1. <span data-ttu-id="eed3a-274">[Настройте приложение Facebook на сайте developers.facebook.com](active-directory-b2c-setup-fb-app.md).</span><span class="sxs-lookup"><span data-stu-id="eed3a-274">[Configure a Facebook application in developers.facebook.com](active-directory-b2c-setup-fb-app.md).</span></span>
2. <span data-ttu-id="eed3a-275">[Добавление клиента секретный tooyour Azure AD B2C приложения Facebook hello](#add-signing-and-encryption-keys-to-your-b2c-tenant-for-use-by-custom-policies).</span><span class="sxs-lookup"><span data-stu-id="eed3a-275">[Add hello Facebook application secret tooyour Azure AD B2C tenant](#add-signing-and-encryption-keys-to-your-b2c-tenant-for-use-by-custom-policies).</span></span>
3. <span data-ttu-id="eed3a-276">В файле политики TrustFrameworkExtensions hello, замените значение hello `client_id` с Идентификатором приложения Facebook hello:</span><span class="sxs-lookup"><span data-stu-id="eed3a-276">In hello TrustFrameworkExtensions policy file, replace hello value of `client_id` with hello Facebook application ID:</span></span>

   ```xml
   <TechnicalProfile Id="Facebook-OAUTH">
     <Metadata>
     <!--Replace hello value of client_id in this technical profile with hello Facebook app ID"-->
       <Item Key="client_id">00000000000000</Item>
   ```
4. <span data-ttu-id="eed3a-277">Отправьте hello TrustFrameworkExtensions.xml политики файл tooyour клиента.</span><span class="sxs-lookup"><span data-stu-id="eed3a-277">Upload hello TrustFrameworkExtensions.xml policy file tooyour tenant.</span></span>
5. <span data-ttu-id="eed3a-278">Тест с помощью **запустить сейчас** или путем вызова hello политики непосредственно из зарегистрированного приложения.</span><span class="sxs-lookup"><span data-stu-id="eed3a-278">Test by using **Run now** or by invoking hello policy directly from your registered application.</span></span>

### <a name="add-azure-active-directory-as-an-identity-provider"></a><span data-ttu-id="eed3a-279">Добавление Azure Active Directory в качестве поставщика удостоверений</span><span class="sxs-lookup"><span data-stu-id="eed3a-279">Add Azure Active Directory as an identity provider</span></span>
<span data-ttu-id="eed3a-280">Hello основного файла уже используется данного руководства по началу работы содержит часть содержимого hello, который необходим для добавления других поставщиков удостоверений.</span><span class="sxs-lookup"><span data-stu-id="eed3a-280">hello base file used in this getting started guide already contains some of hello content that you need for adding other identity providers.</span></span> <span data-ttu-id="eed3a-281">Сведения о настройке входа в систему см. в разделе hello [Azure Active Directory B2C: Войдите, используя учетные записи Azure AD](active-directory-b2c-setup-aad-custom.md) статьи.</span><span class="sxs-lookup"><span data-stu-id="eed3a-281">For information on setting up sign-ins, see hello [Azure Active Directory B2C: Sign in by using Azure AD accounts](active-directory-b2c-setup-aad-custom.md) article.</span></span>

<span data-ttu-id="eed3a-282">Общие сведения о настраиваемых политик в Azure AD B2C, использующих hello Identity Framework качества разделе hello [Azure Active Directory B2C: настраиваемые политики](active-directory-b2c-overview-custom.md) статьи.</span><span class="sxs-lookup"><span data-stu-id="eed3a-282">For an overview of custom policies in Azure AD B2C that use hello Identity Experience Framework, see hello [Azure Active Directory B2C: Custom policies](active-directory-b2c-overview-custom.md) article.</span></span> 
