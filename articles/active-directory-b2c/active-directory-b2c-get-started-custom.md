---
title: "Azure Active Directory B2C: начало работы с настраиваемыми политиками | Документы Майкрософт"
description: "Как начать работу с настраиваемыми политиками Azure Active Directory B2C"
services: active-directory-b2c
documentationcenter: 
author: rojasja
manager: krassk
editor: rojasja
ms.assetid: 658c597e-3787-465e-b377-26aebc94e46d
ms.service: active-directory-b2c
ms.workload: identity
ms.tgt_pltfrm: na
ms.topic: article
ms.devlang: na
ms.date: 08/04/2017
ms.author: joroja;parahk;gsacavdm
ms.openlocfilehash: 4f14dbf4b66f10290cd4f98d56a005f97cc6a207
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="azure-active-directory-b2c-get-started-with-custom-policies"></a><span data-ttu-id="d571d-103">Azure Active Directory B2C: начало работы с настраиваемыми политиками</span><span class="sxs-lookup"><span data-stu-id="d571d-103">Azure Active Directory B2C: Get started with custom policies</span></span>

[!INCLUDE [active-directory-b2c-advanced-audience-warning](../../includes/active-directory-b2c-advanced-audience-warning.md)]

<span data-ttu-id="d571d-104">После выполнения действий, описанных в этой статье, настраиваемая политика будет поддерживать регистрацию и вход с помощью локальной учетной записи с использованием адреса электронной почты и пароля.</span><span class="sxs-lookup"><span data-stu-id="d571d-104">After you complete the steps in this article, your custom policy will support "local account" sign-up or sign-in via an email address and password.</span></span> <span data-ttu-id="d571d-105">Кроме того, будет подготовлена среда для добавления поставщиков удостоверений (например, Facebook или Azure Active Directory).</span><span class="sxs-lookup"><span data-stu-id="d571d-105">You will also prepare your environment for adding identity providers (like Facebook or Azure Active Directory).</span></span> <span data-ttu-id="d571d-106">Мы рекомендуем выполнить эти действия перед знакомством с другими вариантами использования инфраструктуры процедур идентификации Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="d571d-106">We encourage you to complete these steps before reading about other uses of the Azure Active Directory (Azure AD) B2C Identity Experience Framework.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="d571d-107">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="d571d-107">Prerequisites</span></span>

<span data-ttu-id="d571d-108">Прежде чем продолжить, убедитесь, что у вас есть клиент Azure AD B2C, который является контейнером для всех пользователей, приложений, политик и т. д.</span><span class="sxs-lookup"><span data-stu-id="d571d-108">Before proceeding, ensure that you have an Azure AD B2C tenant, which is a container for all your users, apps, policies, and more.</span></span> <span data-ttu-id="d571d-109">Если у вас еще нет клиента Azure AD B2C, его необходимо [создать](active-directory-b2c-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="d571d-109">If you don't have one already, you need to [create an Azure AD B2C tenant](active-directory-b2c-get-started.md).</span></span> <span data-ttu-id="d571d-110">Прежде чем продолжить, мы настоятельно советуем всем разработчикам ознакомиться с руководствами по работе с внедренными политиками Azure AD B2C и настроить приложения на основе этих политик.</span><span class="sxs-lookup"><span data-stu-id="d571d-110">We strongly encourage all developers to complete the Azure AD B2C built-in policy walkthroughs and configure their applications with built-in policies before proceeding.</span></span> <span data-ttu-id="d571d-111">Ваши приложения будут поддерживать оба типа политик. Вы можете немного изменить имя политики, чтобы вызвать настраиваемую политику.</span><span class="sxs-lookup"><span data-stu-id="d571d-111">Your applications will work with both types of policies once you make a minor change to the policy name to invoke the custom policy.</span></span>

>[!NOTE]
><span data-ttu-id="d571d-112">Чтобы получить доступ к изменению настраиваемых политик, необходимо связать с клиентом действующую подписку Azure.</span><span class="sxs-lookup"><span data-stu-id="d571d-112">To access custom policy editing, you need a valid Azure subscription linked to your tenant.</span></span> <span data-ttu-id="d571d-113">Если вы еще не [привязали свою подписку Azure к клиенту Azure AD B2C](active-directory-b2c-how-to-enable-billing.md) или подписка Azure отключена, кнопка Identity Experience Framework будет недоступна.</span><span class="sxs-lookup"><span data-stu-id="d571d-113">If you haven't [linked your Azure AD B2C tenant to an Azure subscription](active-directory-b2c-how-to-enable-billing.md) or your Azure subscription is disabled, the Identity Experience Framework button won't be available.</span></span>

## <a name="add-signing-and-encryption-keys-to-your-b2c-tenant-for-use-by-custom-policies"></a><span data-ttu-id="d571d-114">Добавление ключей подписывания и шифрования в клиент B2C для использования настраиваемыми политиками</span><span class="sxs-lookup"><span data-stu-id="d571d-114">Add signing and encryption keys to your B2C tenant for use by custom policies</span></span>

1. <span data-ttu-id="d571d-115">Откройте колонку **Инфраструктура процедур идентификации** в параметрах клиента Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="d571d-115">Open the **Identity Experience Framework** blade in your Azure AD B2C tenant settings.</span></span>
2. <span data-ttu-id="d571d-116">Выберите **Policy Keys** (Ключи политики), чтобы просмотреть доступные в клиенте ключи.</span><span class="sxs-lookup"><span data-stu-id="d571d-116">Select **Policy Keys** to view the keys available in your tenant.</span></span>
3. <span data-ttu-id="d571d-117">Создайте B2C_1A_TokenSigningKeyContainer, если он не существует:</span><span class="sxs-lookup"><span data-stu-id="d571d-117">Create B2C_1A_TokenSigningKeyContainer if it does not exist:</span></span><br>
    <span data-ttu-id="d571d-118">а.</span><span class="sxs-lookup"><span data-stu-id="d571d-118">a.</span></span> <span data-ttu-id="d571d-119">Выберите **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="d571d-119">Select **Add**.</span></span> <br>
    <span data-ttu-id="d571d-120">b.</span><span class="sxs-lookup"><span data-stu-id="d571d-120">b.</span></span> <span data-ttu-id="d571d-121">Выберите **Создать**.</span><span class="sxs-lookup"><span data-stu-id="d571d-121">Select **Generate**.</span></span><br>
    <span data-ttu-id="d571d-122">c.</span><span class="sxs-lookup"><span data-stu-id="d571d-122">c.</span></span> <span data-ttu-id="d571d-123">Для параметра **Имя** используйте значение `TokenSigningKeyContainer`.</span><span class="sxs-lookup"><span data-stu-id="d571d-123">For **Name**, use `TokenSigningKeyContainer`.</span></span> <br> 
    <span data-ttu-id="d571d-124">Префикс `B2C_1A_` может быть добавлен автоматически.</span><span class="sxs-lookup"><span data-stu-id="d571d-124">The prefix `B2C_1A_` might be added automatically.</span></span><br>
    <span data-ttu-id="d571d-125">d.</span><span class="sxs-lookup"><span data-stu-id="d571d-125">d.</span></span> <span data-ttu-id="d571d-126">Для параметра **Тип ключа** используйте значение **RSA**.</span><span class="sxs-lookup"><span data-stu-id="d571d-126">For **Key type**, use **RSA**.</span></span><br>
    <span data-ttu-id="d571d-127">д.</span><span class="sxs-lookup"><span data-stu-id="d571d-127">e.</span></span> <span data-ttu-id="d571d-128">Для параметра **Даты** используйте значения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="d571d-128">For **Dates**, use the defaults.</span></span> <br>
    <span data-ttu-id="d571d-129">f.</span><span class="sxs-lookup"><span data-stu-id="d571d-129">f.</span></span> <span data-ttu-id="d571d-130">Для параметра **Использование ключа** задайте значение **Подпись**.</span><span class="sxs-lookup"><span data-stu-id="d571d-130">For **Key usage**, use **Signature**.</span></span><br>
    <span data-ttu-id="d571d-131">ж.</span><span class="sxs-lookup"><span data-stu-id="d571d-131">g.</span></span> <span data-ttu-id="d571d-132">Нажмите кнопку **Создать**.</span><span class="sxs-lookup"><span data-stu-id="d571d-132">Select **Create**.</span></span><br>
4. <span data-ttu-id="d571d-133">Создайте B2C_1A_TokenEncryptionKeyContainer, если он не существует:</span><span class="sxs-lookup"><span data-stu-id="d571d-133">Create B2C_1A_TokenEncryptionKeyContainer if it does not exist:</span></span><br>
 <span data-ttu-id="d571d-134">а.</span><span class="sxs-lookup"><span data-stu-id="d571d-134">a.</span></span> <span data-ttu-id="d571d-135">Выберите **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="d571d-135">Select **Add**.</span></span><br>
 <span data-ttu-id="d571d-136">b.</span><span class="sxs-lookup"><span data-stu-id="d571d-136">b.</span></span> <span data-ttu-id="d571d-137">Выберите **Создать**.</span><span class="sxs-lookup"><span data-stu-id="d571d-137">Select **Generate**.</span></span><br>
 <span data-ttu-id="d571d-138">c.</span><span class="sxs-lookup"><span data-stu-id="d571d-138">c.</span></span> <span data-ttu-id="d571d-139">Для параметра **Имя** используйте значение `TokenEncryptionKeyContainer`.</span><span class="sxs-lookup"><span data-stu-id="d571d-139">For **Name**, use `TokenEncryptionKeyContainer`.</span></span> <br>
   <span data-ttu-id="d571d-140">Префикс `B2C_1A`_ может быть добавлен автоматически.</span><span class="sxs-lookup"><span data-stu-id="d571d-140">The prefix `B2C_1A`_ might be added automatically.</span></span><br>
 <span data-ttu-id="d571d-141">г)</span><span class="sxs-lookup"><span data-stu-id="d571d-141">d.</span></span> <span data-ttu-id="d571d-142">Для параметра **Тип ключа** используйте значение **RSA**.</span><span class="sxs-lookup"><span data-stu-id="d571d-142">For **Key type**, use **RSA**.</span></span><br>
 <span data-ttu-id="d571d-143">д.</span><span class="sxs-lookup"><span data-stu-id="d571d-143">e.</span></span> <span data-ttu-id="d571d-144">Для параметра **Даты** используйте значения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="d571d-144">For **Dates**, use the defaults.</span></span><br>
 <span data-ttu-id="d571d-145">Е.</span><span class="sxs-lookup"><span data-stu-id="d571d-145">f.</span></span> <span data-ttu-id="d571d-146">Для параметра **Использование ключа** задайте значение **Шифрование**.</span><span class="sxs-lookup"><span data-stu-id="d571d-146">For **Key usage**, use **Encryption**.</span></span><br>
 <span data-ttu-id="d571d-147">g.</span><span class="sxs-lookup"><span data-stu-id="d571d-147">g.</span></span> <span data-ttu-id="d571d-148">Нажмите кнопку **Создать**.</span><span class="sxs-lookup"><span data-stu-id="d571d-148">Select **Create**.</span></span><br>
5. <span data-ttu-id="d571d-149">Создайте B2C_1A_FacebookSecret.</span><span class="sxs-lookup"><span data-stu-id="d571d-149">Create B2C_1A_FacebookSecret.</span></span> <br>
<span data-ttu-id="d571d-150">При наличии секретного кода приложения Facebook добавьте его как ключ политики в клиенте.</span><span class="sxs-lookup"><span data-stu-id="d571d-150">If you already have a Facebook application secret, add it as a policy key to your tenant.</span></span> <span data-ttu-id="d571d-151">В противном случае создайте ключ со значением-заполнителем. Это позволит политикам проходить проверку.</span><span class="sxs-lookup"><span data-stu-id="d571d-151">Otherwise, you must create the key with a placeholder value so that your policies pass validation.</span></span><br>
 <span data-ttu-id="d571d-152">а.</span><span class="sxs-lookup"><span data-stu-id="d571d-152">a.</span></span> <span data-ttu-id="d571d-153">Выберите **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="d571d-153">Select **Add**.</span></span><br>
 <span data-ttu-id="d571d-154">b.</span><span class="sxs-lookup"><span data-stu-id="d571d-154">b.</span></span> <span data-ttu-id="d571d-155">В пункте **Параметры** используйте вариант **Вручную**.</span><span class="sxs-lookup"><span data-stu-id="d571d-155">For **Options**, use **Manual**.</span></span><br>
 <span data-ttu-id="d571d-156">c.</span><span class="sxs-lookup"><span data-stu-id="d571d-156">c.</span></span> <span data-ttu-id="d571d-157">Для параметра **Имя** используйте значение `FacebookSecret`.</span><span class="sxs-lookup"><span data-stu-id="d571d-157">For **Name**, use `FacebookSecret`.</span></span> <br>
 <span data-ttu-id="d571d-158">Префикс `B2C_1A_` может быть добавлен автоматически.</span><span class="sxs-lookup"><span data-stu-id="d571d-158">The prefix `B2C_1A_` might be added automatically.</span></span><br>
 <span data-ttu-id="d571d-159">г)</span><span class="sxs-lookup"><span data-stu-id="d571d-159">d.</span></span> <span data-ttu-id="d571d-160">В поле **Секрет** введите значение FacebookSecret, указанное на сайте developers.facebook.com, или задайте значение `0` в качестве заполнителя.</span><span class="sxs-lookup"><span data-stu-id="d571d-160">In the **Secret** box, enter your FacebookSecret from developers.facebook.com or `0` as a placeholder.</span></span> <span data-ttu-id="d571d-161">*Это не идентификатор приложения Facebook.*</span><span class="sxs-lookup"><span data-stu-id="d571d-161">*This is not your Facebook app ID.*</span></span> <br>
 <span data-ttu-id="d571d-162">д.</span><span class="sxs-lookup"><span data-stu-id="d571d-162">e.</span></span> <span data-ttu-id="d571d-163">Для параметра **Использование ключа** задайте значение **Подпись**.</span><span class="sxs-lookup"><span data-stu-id="d571d-163">For **Key usage**, use **Signature**.</span></span> <br>
 <span data-ttu-id="d571d-164">Е.</span><span class="sxs-lookup"><span data-stu-id="d571d-164">f.</span></span> <span data-ttu-id="d571d-165">Выберите **Создать** и подтвердите создание.</span><span class="sxs-lookup"><span data-stu-id="d571d-165">Select **Create** and confirm creation.</span></span>

## <a name="register-identity-experience-framework-applications"></a><span data-ttu-id="d571d-166">Регистрация приложений инфраструктуры процедур идентификации</span><span class="sxs-lookup"><span data-stu-id="d571d-166">Register Identity Experience Framework applications</span></span>

<span data-ttu-id="d571d-167">Для Azure AD B2C необходимо зарегистрировать два дополнительных приложения, которые используются подсистемой для регистрации и входа пользователей.</span><span class="sxs-lookup"><span data-stu-id="d571d-167">Azure AD B2C requires you to register two extra applications that are used by the engine to sign up and sign in users.</span></span>

>[!NOTE]
><span data-ttu-id="d571d-168">Создайте два приложения, обеспечивающие поддержку входа с помощью локальных учетных записей: IdentityExperienceFramework (веб-приложение) и ProxyIdentityExperienceFramework (встроенное приложение) с делегированным разрешением IdentityExperienceFramework.</span><span class="sxs-lookup"><span data-stu-id="d571d-168">You must create two applications that enable sign-in using local accounts: IdentityExperienceFramework (a web app) and ProxyIdentityExperienceFramework (a native app) with delegated permission from the IdentityExperienceFramework app.</span></span> <span data-ttu-id="d571d-169">Локальные учетные записи хранятся только в клиенте.</span><span class="sxs-lookup"><span data-stu-id="d571d-169">Local accounts exist only in your tenant.</span></span> <span data-ttu-id="d571d-170">Пользователи регистрируются в системе, используя уникальное сочетание адреса электронной почты и пароля, чтобы получить доступ к зарегистрированным в клиенте приложениям.</span><span class="sxs-lookup"><span data-stu-id="d571d-170">Your users sign up with a unique email address/password combination to access your tenant-registered applications.</span></span>

### <a name="create-the-identityexperienceframework-application"></a><span data-ttu-id="d571d-171">Создание приложения IdentityExperienceFramework</span><span class="sxs-lookup"><span data-stu-id="d571d-171">Create the IdentityExperienceFramework application</span></span>

1. <span data-ttu-id="d571d-172">На [портале Azure](https://portal.azure.com) переключитесь в [контекст клиента Azure AD B2C](active-directory-b2c-navigate-to-b2c-context.md).</span><span class="sxs-lookup"><span data-stu-id="d571d-172">In the [Azure portal](https://portal.azure.com), switch into the [context of your Azure AD B2C tenant](active-directory-b2c-navigate-to-b2c-context.md).</span></span>
2. <span data-ttu-id="d571d-173">Откройте колонку **Azure Active Directory** (не перепутайте ее с колонкой **Azure AD B2C**).</span><span class="sxs-lookup"><span data-stu-id="d571d-173">Open the **Azure Active Directory** blade (not the **Azure AD B2C** blade).</span></span> <span data-ttu-id="d571d-174">Чтобы найти ее, возможно, потребуется выбрать пункт **Больше служб**.</span><span class="sxs-lookup"><span data-stu-id="d571d-174">You might need to select **More Services** to find it.</span></span>
3. <span data-ttu-id="d571d-175">Щелкните **Регистрация приложений**.</span><span class="sxs-lookup"><span data-stu-id="d571d-175">Select **App registrations**.</span></span>
4. <span data-ttu-id="d571d-176">Выберите **Регистрация нового приложения**.</span><span class="sxs-lookup"><span data-stu-id="d571d-176">Select **New application registration**.</span></span>
   * <span data-ttu-id="d571d-177">Для параметра **Имя** используйте значение `IdentityExperienceFramework`.</span><span class="sxs-lookup"><span data-stu-id="d571d-177">For **Name**, use `IdentityExperienceFramework`.</span></span>
   * <span data-ttu-id="d571d-178">Для параметра **Тип приложения** используйте значение **Веб-приложение/API**.</span><span class="sxs-lookup"><span data-stu-id="d571d-178">For **Application type**, use **Web app/API**.</span></span>
   * <span data-ttu-id="d571d-179">Для параметра **URL-адрес входа** используйте адрес `https://login.microsoftonline.com/yourtenant.onmicrosoft.com`, где `yourtenant` — это доменное имя клиента Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="d571d-179">For **Sign-on URL**, use `https://login.microsoftonline.com/yourtenant.onmicrosoft.com`, where `yourtenant` is your Azure AD B2C tenant domain name.</span></span>
5. <span data-ttu-id="d571d-180">Нажмите кнопку **Создать**.</span><span class="sxs-lookup"><span data-stu-id="d571d-180">Select **Create**.</span></span>
6. <span data-ttu-id="d571d-181">Когда создание будет завершено, выберите только что созданное приложение **IdentityExperienceFramework**.</span><span class="sxs-lookup"><span data-stu-id="d571d-181">Once it is created, select the newly created application **IdentityExperienceFramework**.</span></span><br>
   * <span data-ttu-id="d571d-182">Выберите **Свойства**.</span><span class="sxs-lookup"><span data-stu-id="d571d-182">Select **Properties**.</span></span><br>
   * <span data-ttu-id="d571d-183">Скопируйте идентификатор приложения и сохраните его для использования в будущем.</span><span class="sxs-lookup"><span data-stu-id="d571d-183">Copy the application ID and save it for later.</span></span>

### <a name="create-the-proxyidentityexperienceframework-application"></a><span data-ttu-id="d571d-184">Создание приложения ProxyIdentityExperienceFramework</span><span class="sxs-lookup"><span data-stu-id="d571d-184">Create the ProxyIdentityExperienceFramework application</span></span>

1. <span data-ttu-id="d571d-185">Щелкните **Регистрация приложений**.</span><span class="sxs-lookup"><span data-stu-id="d571d-185">Select **App registrations**.</span></span>
1. <span data-ttu-id="d571d-186">Выберите **Регистрация нового приложения**.</span><span class="sxs-lookup"><span data-stu-id="d571d-186">Select **New application registration**.</span></span>
   * <span data-ttu-id="d571d-187">Для параметра **Имя** используйте значение `ProxyIdentityExperienceFramework`.</span><span class="sxs-lookup"><span data-stu-id="d571d-187">For **Name**, use `ProxyIdentityExperienceFramework`.</span></span>
   * <span data-ttu-id="d571d-188">Для параметра **Тип приложения** используйте значение **Встроенное**.</span><span class="sxs-lookup"><span data-stu-id="d571d-188">For **Application type**, use **Native**.</span></span>
   * <span data-ttu-id="d571d-189">Для параметра **URI перенаправления**, используйте адрес `https://login.microsoftonline.com/yourtenant.onmicrosoft.com`, где `yourtenant` — это ваш клиент Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="d571d-189">For **Redirect URI**, use `https://login.microsoftonline.com/yourtenant.onmicrosoft.com`, where `yourtenant` is your Azure AD B2C tenant.</span></span>
1. <span data-ttu-id="d571d-190">Нажмите кнопку **Создать**.</span><span class="sxs-lookup"><span data-stu-id="d571d-190">Select **Create**.</span></span>
1. <span data-ttu-id="d571d-191">Когда создание будет завершено, выберите приложение **ProxyIdentityExperienceFramework**.</span><span class="sxs-lookup"><span data-stu-id="d571d-191">Once it has been created, select the application **ProxyIdentityExperienceFramework**.</span></span><br>
   * <span data-ttu-id="d571d-192">Выберите **Свойства**.</span><span class="sxs-lookup"><span data-stu-id="d571d-192">Select **Properties**.</span></span> <br>
   * <span data-ttu-id="d571d-193">Скопируйте идентификатор приложения и сохраните его для использования в будущем.</span><span class="sxs-lookup"><span data-stu-id="d571d-193">Copy the application ID and save it for later.</span></span>
1. <span data-ttu-id="d571d-194">Выберите **Необходимые разрешения**.</span><span class="sxs-lookup"><span data-stu-id="d571d-194">Select **Required permissions**.</span></span>
1. <span data-ttu-id="d571d-195">Выберите **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="d571d-195">Select **Add**.</span></span>
1. <span data-ttu-id="d571d-196">Выберите **Выбор API**.</span><span class="sxs-lookup"><span data-stu-id="d571d-196">Select **Select an API**.</span></span>
1. <span data-ttu-id="d571d-197">Выполните поиск по имени IdentityExperienceFramework.</span><span class="sxs-lookup"><span data-stu-id="d571d-197">Search for the name IdentityExperienceFramework.</span></span> <span data-ttu-id="d571d-198">В результатах поиска выберите **IdentityExperienceFramework**, затем щелкните **Выбрать**.</span><span class="sxs-lookup"><span data-stu-id="d571d-198">Select **IdentityExperienceFramework** in the results, and then click **Select**.</span></span>
1. <span data-ttu-id="d571d-199">Установите флажок рядом с элементом **Доступ к IdentityExperienceFramework**, затем нажмите **Выбрать**.</span><span class="sxs-lookup"><span data-stu-id="d571d-199">Select the check box next to **Access IdentityExperienceFramework**, and then click **Select**.</span></span>
1. <span data-ttu-id="d571d-200">Нажмите кнопку **Готово**.</span><span class="sxs-lookup"><span data-stu-id="d571d-200">Select **Done**.</span></span>
1. <span data-ttu-id="d571d-201">Выберите **Предоставление разрешений**, затем **Да** для подтверждения.</span><span class="sxs-lookup"><span data-stu-id="d571d-201">Select **Grant Permissions**, and then confirm by selecting **Yes**.</span></span>

## <a name="download-starter-pack-and-modify-policies"></a><span data-ttu-id="d571d-202">Скачивание начального пакета и изменение политик</span><span class="sxs-lookup"><span data-stu-id="d571d-202">Download starter pack and modify policies</span></span>

<span data-ttu-id="d571d-203">Настраиваемые политики — это набор XML-файлов, которые нужно отправить в клиент Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="d571d-203">Custom policies are a set of XML files that need to be uploaded to your Azure AD B2C tenant.</span></span> <span data-ttu-id="d571d-204">Мы предоставляем начальные пакеты, которые позволяют быстро приступить к работе.</span><span class="sxs-lookup"><span data-stu-id="d571d-204">We provide starter packs to get you going quickly.</span></span> <span data-ttu-id="d571d-205">Каждый начальный пакет из следующего списка содержит минимальное количество технических профилей и путей взаимодействия пользователей, необходимых для достижения описанных сценариев:</span><span class="sxs-lookup"><span data-stu-id="d571d-205">Each starter pack in the following list contains the smallest number of technical profiles and user journeys needed to achieve the scenarios described:</span></span>
 * <span data-ttu-id="d571d-206">LocalAccounts.</span><span class="sxs-lookup"><span data-stu-id="d571d-206">LocalAccounts.</span></span> <span data-ttu-id="d571d-207">Позволяет использовать только локальные учетные записи.</span><span class="sxs-lookup"><span data-stu-id="d571d-207">Enables the use of local accounts only.</span></span>
 * <span data-ttu-id="d571d-208">SocialAccounts.</span><span class="sxs-lookup"><span data-stu-id="d571d-208">SocialAccounts.</span></span> <span data-ttu-id="d571d-209">Позволяет использовать только учетные записи социальных сетей (или федеративные учетные записи).</span><span class="sxs-lookup"><span data-stu-id="d571d-209">Enables the use of social (or federated) accounts only.</span></span>
 * <span data-ttu-id="d571d-210">**SocialAndLocalAccounts**.</span><span class="sxs-lookup"><span data-stu-id="d571d-210">**SocialAndLocalAccounts**.</span></span> <span data-ttu-id="d571d-211">Мы будем использовать этот файл в нашем пошаговом руководстве.</span><span class="sxs-lookup"><span data-stu-id="d571d-211">We use this file for the walkthrough.</span></span>
 * <span data-ttu-id="d571d-212">SocialAndLocalAccountsWithMFA.</span><span class="sxs-lookup"><span data-stu-id="d571d-212">SocialAndLocalAccountsWithMFA.</span></span> <span data-ttu-id="d571d-213">Сюда включены параметры локальной идентификации, многофакторной идентификации и идентификации с помощью социальных сетей.</span><span class="sxs-lookup"><span data-stu-id="d571d-213">Social, local, and Multi-Factor Authentication options are included here.</span></span>

<span data-ttu-id="d571d-214">Каждый начальный пакет содержит:</span><span class="sxs-lookup"><span data-stu-id="d571d-214">Each starter pack contains:</span></span>

* <span data-ttu-id="d571d-215">[Базовый файл](active-directory-b2c-overview-custom.md#policy-files) политики.</span><span class="sxs-lookup"><span data-stu-id="d571d-215">The [base file](active-directory-b2c-overview-custom.md#policy-files) of the policy.</span></span> <span data-ttu-id="d571d-216">Для базового файла требуется несколько изменений.</span><span class="sxs-lookup"><span data-stu-id="d571d-216">Few modifications are required to the base.</span></span>
* <span data-ttu-id="d571d-217">[Файл расширения](active-directory-b2c-overview-custom.md#policy-files) политики.</span><span class="sxs-lookup"><span data-stu-id="d571d-217">The [extension file](active-directory-b2c-overview-custom.md#policy-files) of the policy.</span></span>  <span data-ttu-id="d571d-218">В этот файл вносится большинство изменений конфигурации.</span><span class="sxs-lookup"><span data-stu-id="d571d-218">This file is where most configuration changes are made.</span></span>
* <span data-ttu-id="d571d-219">[Файлы проверяющей стороны](active-directory-b2c-overview-custom.md#policy-files) — это файлы, которые вызывает приложение для выполнения определенных задач.</span><span class="sxs-lookup"><span data-stu-id="d571d-219">[Relying party files](active-directory-b2c-overview-custom.md#policy-files) are task-specific files called by your application.</span></span>

>[!NOTE]
><span data-ttu-id="d571d-220">Если в редакторе XML поддерживается проверка, проверьте файлы с помощью XML-файла схемы TrustFrameworkPolicy_0.3.0.0.xsd, который расположен в корневом каталоге начального пакета.</span><span class="sxs-lookup"><span data-stu-id="d571d-220">If your XML editor supports validation, validate the files against the TrustFrameworkPolicy_0.3.0.0.xsd XML schema that is located in the root directory of the starter pack.</span></span> <span data-ttu-id="d571d-221">При проверке по схеме XML определяются ошибки перед отправкой.</span><span class="sxs-lookup"><span data-stu-id="d571d-221">XML schema validation identifies errors before uploading.</span></span>

 <span data-ttu-id="d571d-222">Давайте приступим.</span><span class="sxs-lookup"><span data-stu-id="d571d-222">Let's get started:</span></span>

1. <span data-ttu-id="d571d-223">Скачайте пакет active-directory-b2c-custom-policy-starterpack из репозитория GitHub.</span><span class="sxs-lookup"><span data-stu-id="d571d-223">Download active-directory-b2c-custom-policy-starterpack from GitHub.</span></span> <span data-ttu-id="d571d-224">[Скачайте ZIP-файл](https://github.com/Azure-Samples/active-directory-b2c-custom-policy-starterpack/archive/master.zip) или выполните команду</span><span class="sxs-lookup"><span data-stu-id="d571d-224">[Download the .zip file](https://github.com/Azure-Samples/active-directory-b2c-custom-policy-starterpack/archive/master.zip) or run</span></span>

    ```console
    git clone https://github.com/Azure-Samples/active-directory-b2c-custom-policy-starterpack
    ```
2. <span data-ttu-id="d571d-225">Откройте папку SocialAndLocalAccounts.</span><span class="sxs-lookup"><span data-stu-id="d571d-225">Open the SocialAndLocalAccounts folder.</span></span>  <span data-ttu-id="d571d-226">В базовом файле (TrustFrameworkBase.xml) в этой папке имеется содержимое, необходимое для локальных учетных записей, корпоративных учетных записей и учетных записей социальных сетей.</span><span class="sxs-lookup"><span data-stu-id="d571d-226">The base file (TrustFrameworkBase.xml) in this folder contains content needed for both local and social/corporate accounts.</span></span> <span data-ttu-id="d571d-227">Содержимое из социальных сетей не влияет на настройку и запуск локальных учетных записей.</span><span class="sxs-lookup"><span data-stu-id="d571d-227">The social content does not interfere with the steps for getting local accounts up and running.</span></span>
3. <span data-ttu-id="d571d-228">Откройте файл TrustFrameworkBase.xml.</span><span class="sxs-lookup"><span data-stu-id="d571d-228">Open TrustFrameworkBase.xml.</span></span> <span data-ttu-id="d571d-229">Если вам нужен редактор XML, [попробуйте Visual Studio Code](https://code.visualstudio.com/download) — упрощенный кроссплатформенный редактор.</span><span class="sxs-lookup"><span data-stu-id="d571d-229">If you need an XML editor, [try Visual Studio Code](https://code.visualstudio.com/download), a lightweight cross-platform editor.</span></span>
4. <span data-ttu-id="d571d-230">В корневом элементе `TrustFrameworkPolicy` обновите атрибуты `TenantId` и `PublicPolicyUri`, заменив `yourtenant.onmicrosoft.com` доменным именем клиента Azure AD B2C:</span><span class="sxs-lookup"><span data-stu-id="d571d-230">In the root `TrustFrameworkPolicy` element, update the `TenantId` and `PublicPolicyUri` attributes, replacing `yourtenant.onmicrosoft.com` with the domain name of your Azure AD B2C tenant:</span></span>
   ```xml
    <TrustFrameworkPolicy
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns="http://schemas.microsoft.com/online/cpim/schemas/2013/06"
    PolicySchemaVersion="0.3.0.0"
    TenantId="yourtenant.onmicrosoft.com"
    PolicyId="B2C_1A_TrustFrameworkBase"
    PublicPolicyUri="http://yourtenant.onmicrosoft.com">
    ```
   >[!NOTE]
   ><span data-ttu-id="d571d-231">`PolicyId` — это имя политики, которое отображается на портале, и имя, по которому другие файлы политики ссылаются на этот файл политики.</span><span class="sxs-lookup"><span data-stu-id="d571d-231">`PolicyId` is the policy name that you see in the portal and the name by which this policy file is referenced by other policy files.</span></span>

5. <span data-ttu-id="d571d-232">Сохраните файл.</span><span class="sxs-lookup"><span data-stu-id="d571d-232">Save the file.</span></span>
6. <span data-ttu-id="d571d-233">Откройте файл TrustFrameworkExtensions.xml.</span><span class="sxs-lookup"><span data-stu-id="d571d-233">Open TrustFrameworkExtensions.xml.</span></span> <span data-ttu-id="d571d-234">Внесите те же два изменения, заменив `yourtenant.onmicrosoft.com` клиентом Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="d571d-234">Make the same two changes by replacing `yourtenant.onmicrosoft.com` with your Azure AD B2C tenant.</span></span> <span data-ttu-id="d571d-235">Внесите такие же изменения в значение элемента `<TenantId>` (в результате будут внесены 3 изменения).</span><span class="sxs-lookup"><span data-stu-id="d571d-235">Make the same replacement in the `<TenantId>` element for a total of three changes.</span></span> <span data-ttu-id="d571d-236">Сохраните файл.</span><span class="sxs-lookup"><span data-stu-id="d571d-236">Save the file.</span></span>
7. <span data-ttu-id="d571d-237">Откройте файл SignUpOrSignIn.xml.</span><span class="sxs-lookup"><span data-stu-id="d571d-237">Open SignUpOrSignIn.xml.</span></span> <span data-ttu-id="d571d-238">Внесите те же изменения, заменив `yourtenant.onmicrosoft.com` клиентом Azure AD B2C в трех местах.</span><span class="sxs-lookup"><span data-stu-id="d571d-238">Make the same changes by replacing `yourtenant.onmicrosoft.com` with your Azure AD B2C tenant in three places.</span></span> <span data-ttu-id="d571d-239">Сохраните файл.</span><span class="sxs-lookup"><span data-stu-id="d571d-239">Save the file.</span></span>
8. <span data-ttu-id="d571d-240">Откройте файлы сброса пароля и редактирования профиля.</span><span class="sxs-lookup"><span data-stu-id="d571d-240">Open the password reset and profile edit files.</span></span> <span data-ttu-id="d571d-241">Внесите те же изменения, заменив `yourtenant.onmicrosoft.com` клиентом Azure AD B2C в трех местах в каждом файле.</span><span class="sxs-lookup"><span data-stu-id="d571d-241">Make the same changes by replacing `yourtenant.onmicrosoft.com` with your Azure AD B2C tenant in three places in each file.</span></span> <span data-ttu-id="d571d-242">Сохраните файлы.</span><span class="sxs-lookup"><span data-stu-id="d571d-242">Save the files.</span></span>

### <a name="add-the-application-ids-to-your-custom-policy"></a><span data-ttu-id="d571d-243">Добавление идентификаторов приложений в настраиваемую политику</span><span class="sxs-lookup"><span data-stu-id="d571d-243">Add the application IDs to your custom policy</span></span>
<span data-ttu-id="d571d-244">Добавьте идентификаторы приложений в файл расширения (`TrustFrameworkExtensions.xml`):</span><span class="sxs-lookup"><span data-stu-id="d571d-244">Add the application IDs to the extensions file (`TrustFrameworkExtensions.xml`):</span></span>

1. <span data-ttu-id="d571d-245">Найдите элемент `<TechnicalProfile Id="login-NonInteractive">` в файле расширения (TrustFrameworkExtensions.xml).</span><span class="sxs-lookup"><span data-stu-id="d571d-245">In the extensions file (TrustFrameworkExtensions.xml), find the element `<TechnicalProfile Id="login-NonInteractive">`.</span></span>
2. <span data-ttu-id="d571d-246">Замените оба экземпляра `IdentityExperienceFrameworkAppId` идентификатором созданного ранее приложения инфраструктуры процедур идентификации.</span><span class="sxs-lookup"><span data-stu-id="d571d-246">Replace both instances of `IdentityExperienceFrameworkAppId` with the application ID of the Identity Experience Framework application that you created earlier.</span></span> <span data-ttu-id="d571d-247">Пример:</span><span class="sxs-lookup"><span data-stu-id="d571d-247">Here is an example:</span></span>

   ```xml
   <Item Key="client_id">8322dedc-cbf4-43bc-8bb6-141d16f0f489</Item>
   ```
3. <span data-ttu-id="d571d-248">Замените оба экземпляра `ProxyIdentityExperienceFrameworkAppId` идентификатором созданного ранее приложения прокси инфраструктуры процедур идентификации.</span><span class="sxs-lookup"><span data-stu-id="d571d-248">Replace both instances of `ProxyIdentityExperienceFrameworkAppId` with the application ID of the Proxy Identity Experience Framework application that you created earlier.</span></span>
4. <span data-ttu-id="d571d-249">Сохраните файл расширений.</span><span class="sxs-lookup"><span data-stu-id="d571d-249">Save your extensions file.</span></span>

## <a name="upload-the-policies-to-your-tenant"></a><span data-ttu-id="d571d-250">Отправка политик в клиент</span><span class="sxs-lookup"><span data-stu-id="d571d-250">Upload the policies to your tenant</span></span>

1. <span data-ttu-id="d571d-251">На [портале Azure](https://portal.azure.com) переключитесь в [контекст клиента Azure AD B2C](active-directory-b2c-navigate-to-b2c-context.md) и откройте колонку **Azure AD B2C**.</span><span class="sxs-lookup"><span data-stu-id="d571d-251">In the [Azure portal](https://portal.azure.com), switch into the [context of your Azure AD B2C tenant](active-directory-b2c-navigate-to-b2c-context.md), and open the **Azure AD B2C** blade.</span></span>
2. <span data-ttu-id="d571d-252">Выберите **Инфраструктура процедур идентификации**.</span><span class="sxs-lookup"><span data-stu-id="d571d-252">Select **Identity Experience Framework**.</span></span>
3. <span data-ttu-id="d571d-253">Щелкните **Отправить политику**.</span><span class="sxs-lookup"><span data-stu-id="d571d-253">Select **Upload Policy**.</span></span>

    >[!WARNING]
    ><span data-ttu-id="d571d-254">Файлы настраиваемой политики необходимо отправить в следующем порядке:</span><span class="sxs-lookup"><span data-stu-id="d571d-254">The custom policy files must be uploaded in the following order:</span></span>

1. <span data-ttu-id="d571d-255">Отправьте файл TrustFrameworkBase.xml.</span><span class="sxs-lookup"><span data-stu-id="d571d-255">Upload TrustFrameworkBase.xml.</span></span>
2. <span data-ttu-id="d571d-256">Отправьте файл TrustFrameworkExtensions.xml.</span><span class="sxs-lookup"><span data-stu-id="d571d-256">Upload TrustFrameworkExtensions.xml.</span></span>
3. <span data-ttu-id="d571d-257">Отправьте файл SignUpOrSignin.xml.</span><span class="sxs-lookup"><span data-stu-id="d571d-257">Upload SignUpOrSignin.xml.</span></span>
4. <span data-ttu-id="d571d-258">Отправьте другие файлы политики.</span><span class="sxs-lookup"><span data-stu-id="d571d-258">Upload your other policy files.</span></span>

<span data-ttu-id="d571d-259">При отправке к имени файла политики добавляется префикс `B2C_1A_`.</span><span class="sxs-lookup"><span data-stu-id="d571d-259">When a file is uploaded, the name of the policy file is prepended with `B2C_1A_`.</span></span>

## <a name="test-the-custom-policy-by-using-run-now"></a><span data-ttu-id="d571d-260">Тестирование настраиваемой политики с помощью команды "Запустить сейчас"</span><span class="sxs-lookup"><span data-stu-id="d571d-260">Test the custom policy by using Run Now</span></span>

1. <span data-ttu-id="d571d-261">Откройте **Параметры Azure AD B2C** и перейдите к элементу **Инфраструктура процедур идентификации**.</span><span class="sxs-lookup"><span data-stu-id="d571d-261">Open **Azure AD B2C Settings** and go to **Identity Experience Framework**.</span></span>

   >[!NOTE]
   ><span data-ttu-id="d571d-262">Для использования команды **Запустить сейчас** необходимо, чтобы в клиенте было предварительно зарегистрировано хотя бы одно приложение.</span><span class="sxs-lookup"><span data-stu-id="d571d-262">**Run now** requires at least one application to be preregistered on the tenant.</span></span> <span data-ttu-id="d571d-263">Для регистрации приложений в клиенте B2C выберите меню **Приложения** в Azure AD B2C или используйте инфраструктуру процедур идентификации, чтобы вызвать встроенные и настраиваемые политики.</span><span class="sxs-lookup"><span data-stu-id="d571d-263">Applications must be registered in the B2C tenant, either by using the **Applications** menu selection in Azure AD B2C or by using the Identity Experience Framework to invoke both built-in and custom policies.</span></span> <span data-ttu-id="d571d-264">Каждое приложение необходимо зарегистрировать один раз.</span><span class="sxs-lookup"><span data-stu-id="d571d-264">Only one registration per application is needed.</span></span><br><br>
   <span data-ttu-id="d571d-265">Дополнительные сведения о регистрации приложений см. в статье [Azure AD B2C: начало работы](active-directory-b2c-get-started.md) или [Регистрация приложения](active-directory-b2c-app-registration.md).</span><span class="sxs-lookup"><span data-stu-id="d571d-265">To learn how to register applications, see the Azure AD B2C [Get started](active-directory-b2c-get-started.md) article or the [Application registration](active-directory-b2c-app-registration.md) article.</span></span>  

2. <span data-ttu-id="d571d-266">Откройте политику B2C_1A_signup_signin, отправленную вами настраиваемую политику проверяющей стороны.</span><span class="sxs-lookup"><span data-stu-id="d571d-266">Open B2C_1A_signup_signin, the relying party (RP) custom policy that you uploaded.</span></span> <span data-ttu-id="d571d-267">Выберите **Запустить сейчас**.</span><span class="sxs-lookup"><span data-stu-id="d571d-267">Select **Run now**.</span></span>

3. <span data-ttu-id="d571d-268">Вы сможете зарегистрироваться, используя адрес электронной почты.</span><span class="sxs-lookup"><span data-stu-id="d571d-268">You should be able to sign up using an email address.</span></span>

4. <span data-ttu-id="d571d-269">Войдите в систему с помощью той же учетной записи, чтобы подтвердить правильность конфигурации.</span><span class="sxs-lookup"><span data-stu-id="d571d-269">Sign in with the same account to confirm that you have the correct configuration.</span></span>

>[!NOTE]
><span data-ttu-id="d571d-270">Часто причина ошибки при входе заключается в неправильной настройке приложения IdentityExperienceFramework.</span><span class="sxs-lookup"><span data-stu-id="d571d-270">A common cause of sign-in failure is an improperly configured IdentityExperienceFramework app.</span></span>


## <a name="next-steps"></a><span data-ttu-id="d571d-271">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="d571d-271">Next steps</span></span>

### <a name="add-facebook-as-an-identity-provider"></a><span data-ttu-id="d571d-272">Добавление Facebook в качестве поставщика удостоверений</span><span class="sxs-lookup"><span data-stu-id="d571d-272">Add Facebook as an identity provider</span></span>
<span data-ttu-id="d571d-273">Чтобы настроить Facebook, сделайте следующее.</span><span class="sxs-lookup"><span data-stu-id="d571d-273">To set up Facebook:</span></span>
1. <span data-ttu-id="d571d-274">[Настройте приложение Facebook на сайте developers.facebook.com](active-directory-b2c-setup-fb-app.md).</span><span class="sxs-lookup"><span data-stu-id="d571d-274">[Configure a Facebook application in developers.facebook.com](active-directory-b2c-setup-fb-app.md).</span></span>
2. <span data-ttu-id="d571d-275">[Добавьте секретный код приложения Facebook в клиент Azure AD B2C](#add-signing-and-encryption-keys-to-your-b2c-tenant-for-use-by-custom-policies).</span><span class="sxs-lookup"><span data-stu-id="d571d-275">[Add the Facebook application secret to your Azure AD B2C tenant](#add-signing-and-encryption-keys-to-your-b2c-tenant-for-use-by-custom-policies).</span></span>
3. <span data-ttu-id="d571d-276">Замените значение параметра `client_id` идентификатором приложения Facebook в файле политики TrustFrameworkExtensions:</span><span class="sxs-lookup"><span data-stu-id="d571d-276">In the TrustFrameworkExtensions policy file, replace the value of `client_id` with the Facebook application ID:</span></span>

   ```xml
   <TechnicalProfile Id="Facebook-OAUTH">
     <Metadata>
     <!--Replace the value of client_id in this technical profile with the Facebook app ID"-->
       <Item Key="client_id">00000000000000</Item>
   ```
4. <span data-ttu-id="d571d-277">Отправьте файл политики TrustFrameworkExtensions.xml в клиент.</span><span class="sxs-lookup"><span data-stu-id="d571d-277">Upload the TrustFrameworkExtensions.xml policy file to your tenant.</span></span>
5. <span data-ttu-id="d571d-278">Выполните проверку с помощью команды **Запустить сейчас** или вызовите политику непосредственно из зарегистрированного приложения.</span><span class="sxs-lookup"><span data-stu-id="d571d-278">Test by using **Run now** or by invoking the policy directly from your registered application.</span></span>

### <a name="add-azure-active-directory-as-an-identity-provider"></a><span data-ttu-id="d571d-279">Добавление Azure Active Directory в качестве поставщика удостоверений</span><span class="sxs-lookup"><span data-stu-id="d571d-279">Add Azure Active Directory as an identity provider</span></span>
<span data-ttu-id="d571d-280">В базовом файле, который использовался в этом руководстве по началу работы, уже имеется некоторое содержимое, необходимое для добавления других поставщиков удостоверений.</span><span class="sxs-lookup"><span data-stu-id="d571d-280">The base file used in this getting started guide already contains some of the content that you need for adding other identity providers.</span></span> <span data-ttu-id="d571d-281">Сведения о настройке входа в систему см. в статье [Azure Active Directory B2C. Выполнение входа с помощью учетных записей Azure AD](active-directory-b2c-setup-aad-custom.md).</span><span class="sxs-lookup"><span data-stu-id="d571d-281">For information on setting up sign-ins, see the [Azure Active Directory B2C: Sign in by using Azure AD accounts](active-directory-b2c-setup-aad-custom.md) article.</span></span>

<span data-ttu-id="d571d-282">Обзор настраиваемых политик в Azure AD B2C, использующих инфраструктуру процедур идентификации, см. в статье [Azure Active Directory B2C: пользовательские политики](active-directory-b2c-overview-custom.md).</span><span class="sxs-lookup"><span data-stu-id="d571d-282">For an overview of custom policies in Azure AD B2C that use the Identity Experience Framework, see the [Azure Active Directory B2C: Custom policies](active-directory-b2c-overview-custom.md) article.</span></span> 
