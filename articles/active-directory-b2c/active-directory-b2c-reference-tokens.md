---
title: "Azure Active Directory B2C. Справка по маркерам | Документация Майкрософт"
description: "Hello типов маркеров, выданных в Azure Active Directory B2C"
services: active-directory-b2c
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: 6df79878-65cb-4dfc-98bb-2b328055bc2e
ms.service: active-directory-b2c
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 3/17/2017
ms.author: dastrock
ms.openlocfilehash: 776bc88cc0308875ac6e576f19ac9edf50319d08
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="azure-ad-b2c-token-reference"></a>Azure AD B2C: справочник по маркерам
При обработке каждого [потока аутентификации](active-directory-b2c-apps.md) Azure Active Directory B2C (Azure AD B2C) создает маркеры безопасности различных типов. В этом документе описывается формат hello, характеристики безопасности и содержимого каждого типа маркера.

## <a name="types-of-tokens"></a>Типы маркеров
Azure AD B2C поддерживает hello [протокола авторизации OAuth 2.0](active-directory-b2c-reference-protocols.md), который использует оба токены доступа и обновления токенов. Оно также поддерживает проверку подлинности и войти через [OpenID Connect](active-directory-b2c-reference-protocols.md), который вводит третий тип маркера: hello маркер идентификатора. Каждый из этих маркеров представляется как "токен носителя".

Токен носителя — это упрощенный токен безопасности, предоставляет hello tooa доступа «bearer» защищенный ресурс. Hello носителя является любая сторона, которая может предъявить токен hello. Перед получением токена носителя сторона должна пройти проверку подлинности в Azure AD. Но hello требуемые действия не предпринимаются токен toosecure hello в передачи и хранения, может быть перехвачено и использовать несанкционированной стороной. У некоторых маркеров безопасности есть встроенный механизм, который предотвращает их использование несанкционированными сторонами, но токены носителя не имеют такого механизма. Они должны передаваться по защищенному каналу, например по протоколу TLS (HTTPS).

Если токен носителя, передается за пределами безопасного канала, злоумышленник может использовать токен в третьего tooacquire hello и используйте его toogain несанкционированный доступ tooa защищенных ресурсов. Здравствуйте, те же принципы безопасности применяются при токены носителя хранятся или кэш для дальнейшего использования. Необходимо всегда проверять, что приложение передает и сохраняет токены носителя безопасным образом.

Дополнительные сведения о безопасности во время применения токенов носителя см. в документе [RFC 6750 Section 5](http://tools.ietf.org/html/rfc6750) (RFC 6750, раздел 5).

Многие hello токенов, издаваемых Azure AD B2C реализованы в виде веб-маркеры JSON (JWT). Маркер JWT — это компактное и безопасное для URL-адреса средство передачи информации между двумя сторонами. Маркеры JWT содержат сведения, называемые утверждениями. Ниже приведены проверочные утверждения информации о носителя hello и hello субъект маркера hello. утверждения Hello в JWT — объекты JSON в кодировке и сериализацию для передачи. Поскольку hello JWT, выданного Azure AD B2C подписан, но не зашифровано, можно легко проверять содержимое hello JWT toodebug его. Это можно сделать с помощью нескольких средств, включая [calebb.net](http://calebb.net). Дополнительные сведения о JWT ссылаться слишком[спецификации JWT](http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html).

### <a name="id-tokens"></a>Маркеры идентификации
Маркер идентификатора представляет собой форму маркера безопасности, приложение получает от hello Azure AD B2C `authorize` и `token` конечных точек. Маркеров безопасности представлены в виде [JWT](#types-of-tokens), и они содержат утверждения, можно использовать tooidentify пользователей в приложении. Когда маркеров безопасности полученных из hello `authorize` конечной точки, они часто представляют собой toosign используется в приложениях tooweb пользователей. Когда маркеров безопасности полученных из hello `token` конечной точки, они передаются в HTTP-запросы во время обмена данными между двумя компонентами hello же приложения или службы. Hello утверждения в маркер идентификатора можно использовать по своему усмотрению. Они часто используемые toodisplay учетной записи информации или toomake решения по управлению доступом в приложении.  

На текущий момент маркеры идентификации подписываются, но не шифруются. Когда приложение или API получает маркер идентификатора, он должен [проверки подписи hello](#token-validation) tooprove, hello маркера подлинным. Приложение или API-Интерфейс также необходимо проверить несколько утверждений в токен tooprove hello их правильность. В зависимости от требований к сценарию hello, hello утверждения проверить с помощью приложения можно изменять, но приложения необходимо выполнить некоторые [общие проверки утверждений](#token-validation) в каждом сценарии.

#### <a name="sample-id-token"></a>Пример маркера идентификации
```
// Line breaks for display purposes only

eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6IklkVG9rZW5TaWduaW5nS2V5Q29udGFpbmVyIn0.
eyJleHAiOjE0NDIzNjAwMzQsIm5iZiI6MTQ0MjM1NjQzNCwidmVyIjoiMS4wIiwiaXNzIjoiaHR0cHM6Ly9s
b2dpbi5taWNyb3NvZnRvbmxpbmUuY29tLzc3NTUyN2ZmLTlhMzctNDMwNy04YjNkLWNjMzExZjU4ZDkyNS92
Mi4wLyIsImFjciI6ImIyY18xX3NpZ25faW5fc3RvY2siLCJzdWIiOiJOb3Qgc3VwcG9ydGVkIGN1cnJlbnRs
eS4gVXNlIG9pZCBjbGFpbS4iLCJhdWQiOiI5MGMwZmU2My1iY2YyLTQ0ZDUtOGZiNy1iOGJiYzBiMjlkYzYi
LCJpYXQiOjE0NDIzNTY0MzQsImF1dGhfdGltZSI6MTQ0MjM1NjQzNCwiaWRwIjoiZmFjZWJvb2suY29tIn0.
h-uiKcrT882pSKUtWCpj-_3b3vPs3bOWsESAhPMrL-iIIacKc6_uZrWxaWvIYkLra5czBcGKWrYwrAC8ZvQe
DJWZ50WXQrZYODEW1OUwzaD_I1f1HE0c2uvaWdGXBpDEVdsD3ExKaFlKGjFR2V7F-fPThkVDdKmkUDQX3bVc
yyj2V2nlCQ9jd7aGnokTPfLfpOjuIrTsAdPcGpe5hfSEuwYDmqOJjGs9Jp1f-eSNEiCDQOaTBSvr479L5ptP
XWeQZyX2SypN05Rjr05bjZh3j70ZUimiocfJzjibeoDCaQTz907yAg91WYuFOrQxb-5BaUoR7K-O7vxr2M-_
CQhoFA

```

### <a name="access-tokens"></a>Маркеры доступа
Маркер доступа также представляет собой форму маркера безопасности, приложение получает от hello Azure AD B2C `authorize` и `token` конечных точек. Маркеры доступа также представлены в виде [JWT](#types-of-tokens), и они содержат утверждения, которые можно использовать tooidentify hello предоставлены разрешения tooyour API-интерфейсы. На текущий момент маркеры доступа подписываются, но не шифруются. Маркеры доступа должен быть доступ используется tooprovide tooAPIs и ресурсов серверов. Дополнительные сведения о том, как слишком[использовать токены доступа](active-directory-b2c-access-tokens.md). 

Когда API получает маркер доступа, он должен [проверки подписи hello](#token-validation) tooprove, hello маркера подлинным. API также необходимо проверить несколько утверждений в токен tooprove hello их правильность. В зависимости от требований к сценарию hello, hello утверждения проверить с помощью приложения можно изменять, но приложения необходимо выполнить некоторые [общие проверки утверждений](#token-validation) в каждом сценарии.

### <a name="claims-in-id-and-access-tokens"></a>Утверждения в маркерах идентификации и доступа
При использовании Azure AD B2C имеется тонкую настройку hello содержимое из ваших токенов. Можно настроить [политики](active-directory-b2c-reference-policies.md) toosend определенных наборов данных пользователя в утверждения, требуемые приложению для своих операций. Эти правила могут включать стандартные свойства, например hello пользователя `displayName` и `emailAddress`. Кроме того, они могут содержать [настраиваемые пользовательские атрибуты](active-directory-b2c-reference-custom-attr.md) , которые вы можете задать в каталоге B2C. Каждый маркер идентификации и доступа, который вы получаете, содержит набор утверждений, связанных с безопасностью. Приложения могут использовать эти утверждения toosecurely проверки подлинности пользователей и запросов.

Обратите внимание, что hello утверждений в токенах идентификатор не возвращаются в любом порядке. Кроме того, новые утверждения могут появиться в маркерах идентификации в любое время. По мере появления новых утверждений ваше приложение не должно прерывать работу. Ниже приведены hello заявляет, что предполагается tooexist в токенах идентификатор и доступа, выданный службой Azure AD B2C. Все дополнительные утверждения определяются политиками. Для занятия, попробуйте проверки hello утверждения в маркер идентификатора образец hello, вставив его в [calebb.net](http://calebb.net). Дополнительные сведения можно найти в hello [спецификация OpenID Connect](http://openid.net/specs/openid-connect-core-1_0.html).

| Имя | Утверждение | Пример значения | Описание |
| --- | --- | --- | --- |
| Аудитория |`aud` |`90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6` |Утверждение audience определяет получателя hello предназначен маркер hello. Для Azure AD B2C hello аудитория — идентификатор приложения приложения, назначенные tooyour приложение на портале регистрации приложения hello как. Ваше приложение должно проверить это значение и отклонить hello маркер, если они не совпадают. |
| Издатель |`iss` |`https://login.microsoftonline.com/775527ff-9a37-4307-8b3d-cc311f58d925/v2.0/` |Идентифицирует hello службы маркеров безопасности (STS), создает и возвращает токен hello. Он также определяет hello каталог Azure AD, в которой hello пользователь прошел проверку подлинности. Приложение должно проверять hello издателя утверждения, что получено tooensure, hello токена из конечной v2.0 hello Azure Active Directory. |
| Время выдачи |`iat` |`1438535543` |Это утверждение — hello время выдачи маркера какие hello, представленный во время эпохи. |
| Время окончания срока действия |`exp` |`1438539443` |Hello утверждения время истечения срока действия — hello время какие hello токен становится недопустимым, представленный во время эпохи. Приложения должны использовать это утверждение tooverify hello допустимость время существования маркера hello. |
| Не ранее |`nbf` |`1438535543` |Это утверждение — hello время какие hello токен становится допустимым, представленный во время эпохи. Это обычно hello же как выдачи токена hello hello времени. Приложения должны использовать это утверждение tooverify hello допустимость время существования маркера hello. |
| Version (версия) |`ver` |`1.0` |Это версия hello маркер идентификатора hello, в соответствии с определением Azure AD. |
| Хэш-код |`c_hash` |`SGCPtt01wxwfgnYZy2VJtQ` |Хэш-код включается в маркер идентификатора только в том случае, когда выдается маркер hello вместе с кодом авторизации OAuth 2.0. Хэш-код может быть подлинность hello используется toovalidate код авторизации. Дополнительные сведения о том, как tooperform проверки. в разделе hello [спецификация OpenID Connect](http://openid.net/specs/openid-connect-core-1_0.html).  |
| Хэш маркера доступа |`at_hash` |`SGCPtt01wxwfgnYZy2VJtQ` |Хеш токена доступа включается в маркер идентификатора только в том случае, когда выдается маркер hello вместе с маркера доступа OAuth 2.0. Хеш токена доступа может быть используется toovalidate hello подлинность маркера доступа. Дополнительные сведения о том, как tooperform проверки. в разделе hello [спецификация OpenID Connect](http://openid.net/specs/openid-connect-core-1_0.html)  |
| Специальное утверждение |`nonce` |`12345` |Nonce — стратегии используемых toomitigate атак с повторением токенов. Приложения можно задать nonce в запрос на аутентификацию с помощью hello `nonce` параметр запроса. значение Hello, указываемые в запросе hello будет выдаваться без изменений в hello `nonce` утверждение с правом только маркер идентификатора. Это позволяет значение hello tooverify приложения с hello значением, указанным на hello запрос, который связывает приложение hello сеанса с помощью заданного идентификатора маркера. Это проверку во время процесса проверки токенов идентификатор hello следует выполнять приложения. |
| Субъект |`sub` |`884408e1-2918-4cz0-b12d-3aa027d7563b` |Это является участником hello, о которых hello подтверждает токен, сведения, такие как hello пользователя приложения. Это значение является неизменяемым и не может быть переназначено или повторно использовано. Используется tooperform проверки авторизации может быть безопасно, например, если маркер hello используется tooaccess ресурса. По умолчанию с Идентификатором hello объекта hello пользователя в каталоге hello заполняется hello субъект утверждений. toolearn более, в разделе [Azure Active Directory B2C: маркер, сеансов и настройки единого входа](active-directory-b2c-token-session-sso.md). |
| Ссылка на класс контекста проверки подлинности |`acr` |Не применяется |В настоящее время не используется, за исключением случая hello старые политик. toolearn более, в разделе [Azure Active Directory B2C: маркер, сеансов и настройки единого входа](active-directory-b2c-token-session-sso.md). |
| Политика инфраструктуры доверия |`tfp` |`b2c_1_sign_in` |Это имя hello hello политики, которая была маркер идентификатора используется tooacquire hello. |
| Время проверки подлинности |`auth_time` |`1438535543` |Это утверждение — hello времени, по которому последнего введенные учетные данные пользователя, представленного во время эпохи. |

### <a name="refresh-tokens"></a>Маркеры обновления
Обновить маркеры являются маркерами безопасности, приложение можно использовать новый идентификатор токены tooacquire в и токенов доступа потока OAuth 2.0. Они предоставляют приложения долгосрочной tooresources доступ от имени пользователей без необходимости взаимодействия с пользователями.

tooreceive токен обновления в ответ на токен, приложение должно запросить hello `offline_acesss` области. Дополнительные сведения о hello toolearn `offline_access` области, toohello см. [ссылку Azure AD B2C протокола](active-directory-b2c-reference-protocols.md).

Токенов обновления и всегда будет, полностью непрозрачный tooyour приложения. Их выдает служба Azure AD, и только эта служба может их проверять и интерпретировать. Они находятся в течение продолжительного времени, но не следует записывать приложение hello предположении, что токен обновления будет продолжаться в течение определенного периода времени. Маркеры обновления могут стать недействительными в любое время по разным причинам. Здравствуйте, только для вашего приложения tooknow, если токен обновления является допустимым в том числе tooattempt tooredeem его, делая запроса маркера tooAzure AD.

Когда вы активируете новый маркер токена обновления (и если приложение было предоставлено hello `offline_access` области), вы получите новый маркер обновления в ответ на токен hello. Сохраняйте hello только что выданный маркер обновления. Его следует заменить hello токен обновления, который ранее использовался в запросе hello. Такой подход обеспечит максимальный срок действия маркеров обновления.

## <a name="token-validation"></a>Проверка маркеров
toovalidate маркер, приложение должно проверять подпись hello и утверждения токена hello.

Для проверки маркеров JWT доступны многие библиотеки с открытым исходным кодом в зависимости от выбранного языка. Мы рекомендуем изучить различные библиотеки, а не реализовывать логику проверки самостоятельно. Узнайте, как использовать эти библиотеки в tooproperly может помочь Hello сведения в этом руководстве.

### <a name="validate-hello-signature"></a>Проверить подпись hello
JWT содержит три сегмента, разделенные hello `.` символов. Первый сегмент Hello — hello *заголовок*, hello, второй — hello *текст*, и hello третий — hello *подпись*. Сегмент Hello подпись может быть используется toovalidate hello подлинность маркера hello, чтобы доверенным приложения.

Маркеры Azure AD B2C подписываются при помощи стандартных отраслевых алгоритмов асимметричного шифрования, таких как RSA 256. Заголовок Hello hello маркера содержит сведения о ключе hello и метод шифрования используется токен hello toosign:

```
{
        "typ": "JWT",
        "alg": "RS256",
        "kid": "GvnPApfWMdLRi8PDmisFn7bprKg"
}
```

Hello `alg` утверждение указывает hello алгоритм, который был toosign используется токен hello. Hello `kid` утверждение указывает hello определенный открытый ключ, который был toosign используется токен hello.

Azure AD может в любой момент времени подписать маркер с использованием любой пары открытого и закрытого ключей из определенного набора пар. Azure AD периодически поворачивает hello возможный набор ключей, приложение должно быть написано toohandle этих ключ автоматически изменяется. Toocheck разумного частоты для обновления toohello открытых ключей, используемых Azure AD выполняется каждые 24 часа.

Служба Azure AD B2C имеет конечную точку метаданных OpenID Connect. Это позволяет приложениям toofetch сведения об Azure AD B2C во время выполнения. Эти сведения включают конечные точки, содержимое маркеров и ключи подписи маркеров. Для каждой политики в каталоге B2C есть собственный документ метаданных JSON. Например, документ hello метаданных для hello `b2c_1_sign_in` политики в `fabrikamb2c.onmicrosoft.com` находится в:

```
https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/v2.0/.well-known/openid-configuration?p=b2c_1_sign_in
```

`fabrikamb2c.onmicrosoft.com`— каталог hello B2C используется tooauthenticate hello пользователя, и `b2c_1_sign_in` является hello политики используется токен tooacquire hello. toodetermine, какая политика была toosign используется маркер (и где toogo toofetch hello метаданных), у вас есть два варианта. Во-первых, имя политики hello включается в hello `acr` утверждения в маркере hello. Вы можете проанализировать утверждения из hello текст hello JWT телом base-64 декодирования hello и десериализации hello JSON строка, которая вызывает. Hello `acr` утверждения будет имя hello hello политики, используемые tooissue hello маркер.  Другой вариант — tooencode политики hello в значение hello hello `state` параметра при выдать запрос hello и расшифровать его toodetermine использовался какую политику. Каждый из этих методов является допустимым.

документ метаданных Hello является объект JSON, который содержит несколько важных сведений. К ним относятся hello расположение необходимые tooperform hello конечные точки проверки подлинности OpenID Connect. Они также включают `jwks_uri`, что дает hello расположение hello набор открытых ключей, используемых toosign маркеры. Это расположение представлена ниже, но это лучшее расположение hello toofetch динамически с помощью документа метаданных hello и анализируя `jwks_uri`:

```
https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/discovery/v2.0/keys?p=b2c_1_sign_in
```

документ JSON Hello, расположенной на этот URL-адрес содержит все hello сведения об открытом ключе используются в определенный момент. Приложение может использовать hello `kid` утверждения в hello JWT заголовок tooselect hello открытый ключ в документе JSON hello, используемые toosign данная лексема. Затем он может выполнять проверку подписи с помощью hello правильный открытый ключ и алгоритм указанного hello.

Описание того, как проверка подписи tooperform вне hello рамки данного документа. Многие библиотеки с открытым исходным кодом, доступных toohelp с его, если вам необходимо.

### <a name="validate-hello-claims"></a>Проверки утверждений hello
Когда приложение или API получает маркер идентификатора, его необходимо выполнить несколько проверок для hello утверждения в маркер идентификатора hello. Помимо прочего, к этим утверждениям относятся:

* Hello **аудитории** утверждения: Это подтверждает этот маркер идентификатор hello предполагаемого toobe заданному tooyour приложения.
* Hello **вступления в силу** и **время истечения срока действия** утверждения: они убедитесь, что этот токен идентификатор hello не истек.
* Hello **издателя** утверждения: это проверяет этот маркер hello был выдан tooyour приложения Azure AD.
* Hello **nonce**: это стратегия предотвращения атак воспроизведения токена.

Полный список проверки должно выполнять приложение, см. в разделе toohello [спецификация OpenID Connect](https://openid.net). Подробные сведения о hello ожидаемые значения для этих утверждений включаются в предыдущем hello [маркера раздела](#types-of-tokens).  

## <a name="token-lifetimes"></a>Время существования маркеров
Hello после времени жизни токенов, предоставленных toofurther вашего ведома. Они могут пригодиться при разработке и отладке приложений. Обратите внимание, что ваши приложения не должно быть записаны tooexpect любой из этих константа tooremain время жизни. Они могут и будут изменяться. Дополнительные сведения о hello [настройки времени жизни токенов](active-directory-b2c-token-session-sso.md) в Azure AD B2C.

| Маркер | Срок действия | Описание |
| --- | --- | --- |
| Маркеры идентификации |Один час |Маркеры идентификации обычно действительны в течение часа. Веб-приложения можно использовать это время существования toomaintain свои собственные сеансы с пользователями (рекомендуется). Кроме того, вы можете выбрать другой срок существования сеанса. Если ваше приложение должно tooget новый маркер идентификатора, достаточно toomake новый tooAzure запрос входа в AD. Если у пользователя есть сеанс браузера, допустимые в Azure AD, этот пользователь может оказаться tooenter необходимые учетные данные снова. |
| Маркеры обновления |Копирование too14 дней |Один маркер обновления действителен до 14 дней. Тем не менее маркер обновления может стать недопустимым в любое время и по различным причинам. Приложения должны продолжать tootry toouse токен обновления до hello запрос завершается ошибкой, или приложение заменяет новый токен обновления hello. Токен обновления также могут стать недопустимыми в том случае, если были пройдены 90 дней с момента пользователя hello последнего ввод учетных данных. |
| Коды авторизации |5 минут |Коды авторизации специально обладают коротким сроком действия. После получения их следует незамедлительно обменять на маркеры доступа, маркеры идентификации или маркеры обновления. |

