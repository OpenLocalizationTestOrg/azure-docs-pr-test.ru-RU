---
title: "Azure Active Directory B2C. Справка по маркерам | Документация Майкрософт"
description: "В статье описываются типы маркеров, выпускаемых в Azure Active Directory B2C."
services: active-directory-b2c
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: 6df79878-65cb-4dfc-98bb-2b328055bc2e
ms.service: active-directory-b2c
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 3/17/2017
ms.author: dastrock
ms.openlocfilehash: 39cfbc1c6dea138fe2f1eb3190770606f3895d40
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="azure-ad-b2c-token-reference"></a><span data-ttu-id="a04a8-103">Azure AD B2C: справочник по маркерам</span><span class="sxs-lookup"><span data-stu-id="a04a8-103">Azure AD B2C: Token reference</span></span>
<span data-ttu-id="a04a8-104">При обработке каждого [потока аутентификации](active-directory-b2c-apps.md) Azure Active Directory B2C (Azure AD B2C) создает маркеры безопасности различных типов.</span><span class="sxs-lookup"><span data-stu-id="a04a8-104">Azure Active Directory B2C (Azure AD B2C) emits several types of security tokens as it processes each [authentication flow](active-directory-b2c-apps.md).</span></span> <span data-ttu-id="a04a8-105">В этом документе описывается формат, характеристики безопасности и содержимое каждого типа маркера.</span><span class="sxs-lookup"><span data-stu-id="a04a8-105">This document describes the format, security characteristics, and contents of each type of token.</span></span>

## <a name="types-of-tokens"></a><span data-ttu-id="a04a8-106">Типы маркеров</span><span class="sxs-lookup"><span data-stu-id="a04a8-106">Types of tokens</span></span>
<span data-ttu-id="a04a8-107">Служба Azure AD B2C поддерживает [протокол авторизации OAuth 2.0](active-directory-b2c-reference-protocols.md), использующий как маркеры доступа, так и маркеры обновления.</span><span class="sxs-lookup"><span data-stu-id="a04a8-107">Azure AD B2C supports the [OAuth 2.0 authorization protocol](active-directory-b2c-reference-protocols.md), which makes use of both access tokens and refresh tokens.</span></span> <span data-ttu-id="a04a8-108">Она также поддерживает проверку подлинности и вход с помощью [OpenID Connect](active-directory-b2c-reference-protocols.md), вводя третий тип маркера — маркер идентификации.</span><span class="sxs-lookup"><span data-stu-id="a04a8-108">It also supports authentication and sign-in via [OpenID Connect](active-directory-b2c-reference-protocols.md), which introduces a third type of token: the ID token.</span></span> <span data-ttu-id="a04a8-109">Каждый из этих маркеров представляется как "токен носителя".</span><span class="sxs-lookup"><span data-stu-id="a04a8-109">Each of these tokens is represented as a bearer token.</span></span>

<span data-ttu-id="a04a8-110">Токен носителя — это упрощенный маркер безопасности, предоставляющий доступ носителю к защищенному ресурсу.</span><span class="sxs-lookup"><span data-stu-id="a04a8-110">A bearer token is a lightweight security token that grants the "bearer" access to a protected resource.</span></span> <span data-ttu-id="a04a8-111">В этом смысле носителем является любая сторона, которая может предъявить маркер.</span><span class="sxs-lookup"><span data-stu-id="a04a8-111">The bearer is any party that can present the token.</span></span> <span data-ttu-id="a04a8-112">Перед получением токена носителя сторона должна пройти проверку подлинности в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="a04a8-112">Azure AD must first authenticate a party before it can receive a bearer token.</span></span> <span data-ttu-id="a04a8-113">Однако если не выполняются действия, необходимые для защиты маркера во время его передачи и хранения, то его может перехватить и использовать несанкционированная сторона.</span><span class="sxs-lookup"><span data-stu-id="a04a8-113">But if the required steps are not taken to secure the token in transmission and storage, it can be intercepted and used by an unintended party.</span></span> <span data-ttu-id="a04a8-114">У некоторых маркеров безопасности есть встроенный механизм, который предотвращает их использование несанкционированными сторонами, но токены носителя не имеют такого механизма.</span><span class="sxs-lookup"><span data-stu-id="a04a8-114">Some security tokens have a built-in mechanism for preventing unauthorized parties from using them, but bearer tokens do not have this mechanism.</span></span> <span data-ttu-id="a04a8-115">Они должны передаваться по защищенному каналу, например по протоколу TLS (HTTPS).</span><span class="sxs-lookup"><span data-stu-id="a04a8-115">They must be transported in a secure channel, such as transport layer security (HTTPS).</span></span>

<span data-ttu-id="a04a8-116">Если токен носителя передается вне зашифрованного канала, злоумышленник может использовать атаку "злоумышленник в середине", чтобы получить токен и использовать его для несанкционированного доступа к защищенному ресурсу.</span><span class="sxs-lookup"><span data-stu-id="a04a8-116">If a bearer token is transmitted outside a secure channel, a malicious party can use a man-in-the-middle attack to acquire the token and use it to gain unauthorized access to a protected resource.</span></span> <span data-ttu-id="a04a8-117">Те же принципы безопасности применяются при сохранении или кэшировании токенов носителя для последующего использования.</span><span class="sxs-lookup"><span data-stu-id="a04a8-117">The same security principles apply when bearer tokens are stored or cached for later use.</span></span> <span data-ttu-id="a04a8-118">Необходимо всегда проверять, что приложение передает и сохраняет токены носителя безопасным образом.</span><span class="sxs-lookup"><span data-stu-id="a04a8-118">Always ensure that your app transmits and stores bearer tokens in a secure manner.</span></span>

<span data-ttu-id="a04a8-119">Дополнительные сведения о безопасности во время применения токенов носителя см. в документе [RFC 6750 Section 5](http://tools.ietf.org/html/rfc6750) (RFC 6750, раздел 5).</span><span class="sxs-lookup"><span data-stu-id="a04a8-119">For additional security considerations on bearer tokens, see [RFC 6750 Section 5](http://tools.ietf.org/html/rfc6750).</span></span>

<span data-ttu-id="a04a8-120">Многие маркеры, которые выпускает служба Azure AD B2C, реализуются как веб-маркеры JSON (JWT).</span><span class="sxs-lookup"><span data-stu-id="a04a8-120">Many of the tokens that Azure AD B2C issues are implemented as JSON web tokens (JWTs).</span></span> <span data-ttu-id="a04a8-121">Маркер JWT — это компактное и безопасное для URL-адреса средство передачи информации между двумя сторонами.</span><span class="sxs-lookup"><span data-stu-id="a04a8-121">A JWT is a compact, URL-safe means of transferring information between two parties.</span></span> <span data-ttu-id="a04a8-122">Маркеры JWT содержат сведения, называемые утверждениями.</span><span class="sxs-lookup"><span data-stu-id="a04a8-122">JWTs contain information known as claims.</span></span> <span data-ttu-id="a04a8-123">Это утверждения со сведениями о носителе и о субъекте маркера.</span><span class="sxs-lookup"><span data-stu-id="a04a8-123">These are assertions of information about the bearer and the subject of the token.</span></span> <span data-ttu-id="a04a8-124">Утверждения в маркерах JWT — это объекты JSON, закодированные и сериализованные для передачи.</span><span class="sxs-lookup"><span data-stu-id="a04a8-124">The claims in JWTs are JSON objects that are encoded and serialized for transmission.</span></span> <span data-ttu-id="a04a8-125">Так как формируемые службой Azure AD B2C маркеры JWT подписываются, но не шифруются, их содержимое можно легко изучить с целью отладки.</span><span class="sxs-lookup"><span data-stu-id="a04a8-125">Because the JWTs issued by Azure AD B2C are signed but not encrypted, you can easily inspect the contents of a JWT to debug it.</span></span> <span data-ttu-id="a04a8-126">Это можно сделать с помощью нескольких средств, включая [calebb.net](http://calebb.net).</span><span class="sxs-lookup"><span data-stu-id="a04a8-126">Several tools are available that can do this, including [calebb.net](http://calebb.net).</span></span> <span data-ttu-id="a04a8-127">Дополнительные сведения о маркерах JWT см. в [спецификациях по маркерам JWT](http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html).</span><span class="sxs-lookup"><span data-stu-id="a04a8-127">For more information about JWTs, refer to [JWT specifications](http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html).</span></span>

### <a name="id-tokens"></a><span data-ttu-id="a04a8-128">Маркеры идентификации</span><span class="sxs-lookup"><span data-stu-id="a04a8-128">ID tokens</span></span>
<span data-ttu-id="a04a8-129">Маркеры идентификации — это разновидность маркеров безопасности, которые приложение получает от конечных точек Azure AD B2C `authorize` и `token`.</span><span class="sxs-lookup"><span data-stu-id="a04a8-129">An ID token is a form of security token that your app receives from the Azure AD B2C `authorize` and `token` endpoints.</span></span> <span data-ttu-id="a04a8-130">Они представлены в виде [маркеров JWT](#types-of-tokens)и содержат утверждения, которые можно использовать для идентификации пользователей приложения.</span><span class="sxs-lookup"><span data-stu-id="a04a8-130">ID tokens are represented as [JWTs](#types-of-tokens), and they contain claims that you can use to identify users in your app.</span></span> <span data-ttu-id="a04a8-131">Если они получены из конечной точки `authorize` , маркеры идентификации часто используются для входа пользователей в веб-приложение.</span><span class="sxs-lookup"><span data-stu-id="a04a8-131">When ID tokens are acquired from the `authorize` endpoint, they are often used to sign in users to web applications.</span></span> <span data-ttu-id="a04a8-132">Если они получены из конечной точки `token` , маркеры идентификации могут отправляться в HTTP-запросах во время обмена данными между двумя компонентами одного и того же приложения или службы.</span><span class="sxs-lookup"><span data-stu-id="a04a8-132">When ID tokens are acquired from the `token` endpoint, they can be sent in HTTP requests during communication between two components of the same application or service.</span></span> <span data-ttu-id="a04a8-133">Утверждения, которые содержит маркер идентификации, вы можете использовать по своему усмотрению.</span><span class="sxs-lookup"><span data-stu-id="a04a8-133">You can use the claims in an ID token as you see fit.</span></span> <span data-ttu-id="a04a8-134">Обычно они отображают сведения учетной записи или на их основе предоставляется доступ к приложению.</span><span class="sxs-lookup"><span data-stu-id="a04a8-134">They are commonly used to display account information or to make access control decisions in an app.</span></span>  

<span data-ttu-id="a04a8-135">На текущий момент маркеры идентификации подписываются, но не шифруются.</span><span class="sxs-lookup"><span data-stu-id="a04a8-135">ID tokens are signed, but they are not currently encrypted.</span></span> <span data-ttu-id="a04a8-136">Когда приложение или API получает маркер идентификации, они [проверяют его подпись](#token-validation) , чтобы подтвердить подлинность маркера.</span><span class="sxs-lookup"><span data-stu-id="a04a8-136">When your app or API receives an ID token, it must [validate the signature](#token-validation) to prove that the token is authentic.</span></span> <span data-ttu-id="a04a8-137">Приложение или интерфейс API должны также проверить несколько утверждений в маркере, чтобы подтвердить его действительность.</span><span class="sxs-lookup"><span data-stu-id="a04a8-137">Your app or API must also validate a few claims in the token to prove that it is valid.</span></span> <span data-ttu-id="a04a8-138">Утверждения, которые проверяет приложение, зависят от требований сценария, но некоторые [стандартные проверки утверждений](#token-validation) приложение должно выполнять в каждом сценарии.</span><span class="sxs-lookup"><span data-stu-id="a04a8-138">Depending on the scenario requirements, the claims validated by an app can vary, but your app must perform some [common claim validations](#token-validation) in every scenario.</span></span>

#### <a name="sample-id-token"></a><span data-ttu-id="a04a8-139">Пример маркера идентификации</span><span class="sxs-lookup"><span data-stu-id="a04a8-139">Sample ID token</span></span>
```
// Line breaks for display purposes only

eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6IklkVG9rZW5TaWduaW5nS2V5Q29udGFpbmVyIn0.
eyJleHAiOjE0NDIzNjAwMzQsIm5iZiI6MTQ0MjM1NjQzNCwidmVyIjoiMS4wIiwiaXNzIjoiaHR0cHM6Ly9s
b2dpbi5taWNyb3NvZnRvbmxpbmUuY29tLzc3NTUyN2ZmLTlhMzctNDMwNy04YjNkLWNjMzExZjU4ZDkyNS92
Mi4wLyIsImFjciI6ImIyY18xX3NpZ25faW5fc3RvY2siLCJzdWIiOiJOb3Qgc3VwcG9ydGVkIGN1cnJlbnRs
eS4gVXNlIG9pZCBjbGFpbS4iLCJhdWQiOiI5MGMwZmU2My1iY2YyLTQ0ZDUtOGZiNy1iOGJiYzBiMjlkYzYi
LCJpYXQiOjE0NDIzNTY0MzQsImF1dGhfdGltZSI6MTQ0MjM1NjQzNCwiaWRwIjoiZmFjZWJvb2suY29tIn0.
h-uiKcrT882pSKUtWCpj-_3b3vPs3bOWsESAhPMrL-iIIacKc6_uZrWxaWvIYkLra5czBcGKWrYwrAC8ZvQe
DJWZ50WXQrZYODEW1OUwzaD_I1f1HE0c2uvaWdGXBpDEVdsD3ExKaFlKGjFR2V7F-fPThkVDdKmkUDQX3bVc
yyj2V2nlCQ9jd7aGnokTPfLfpOjuIrTsAdPcGpe5hfSEuwYDmqOJjGs9Jp1f-eSNEiCDQOaTBSvr479L5ptP
XWeQZyX2SypN05Rjr05bjZh3j70ZUimiocfJzjibeoDCaQTz907yAg91WYuFOrQxb-5BaUoR7K-O7vxr2M-_
CQhoFA

```

### <a name="access-tokens"></a><span data-ttu-id="a04a8-140">Маркеры доступа</span><span class="sxs-lookup"><span data-stu-id="a04a8-140">Access tokens</span></span>
<span data-ttu-id="a04a8-141">Маркер доступа — это также разновидность маркеров безопасности, которые приложение получает от конечных точек Azure AD B2C `authorize` и `token`.</span><span class="sxs-lookup"><span data-stu-id="a04a8-141">An access token is also a form of security token that your app receives from the Azure AD B2C `authorize` and `token` endpoints.</span></span> <span data-ttu-id="a04a8-142">Они представлены в виде [маркеров JWT](#types-of-tokens) и содержат утверждения, которые можно использовать для идентификации предоставленных разрешений в интерфейсах API.</span><span class="sxs-lookup"><span data-stu-id="a04a8-142">Access tokens are also represented as [JWTs](#types-of-tokens), and they contain claims that you can use to identify the granted permissions to your APIs.</span></span> <span data-ttu-id="a04a8-143">На текущий момент маркеры доступа подписываются, но не шифруются.</span><span class="sxs-lookup"><span data-stu-id="a04a8-143">Access tokens are signed, but they are not currently encrypted.</span></span> <span data-ttu-id="a04a8-144">Маркеры доступа следует использовать для предоставления доступа к API и серверам ресурсов.</span><span class="sxs-lookup"><span data-stu-id="a04a8-144">Access tokens should be used to provide access to APIs and resource servers.</span></span> <span data-ttu-id="a04a8-145">Узнайте больше о том, как [использовать маркеры доступа](active-directory-b2c-access-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="a04a8-145">Learn more about how to [use access tokens](active-directory-b2c-access-tokens.md).</span></span> 

<span data-ttu-id="a04a8-146">Когда API получает маркер доступа, он [проверяет его подпись](#token-validation) , чтобы подтвердить подлинность маркера.</span><span class="sxs-lookup"><span data-stu-id="a04a8-146">When your API receives an access token, it must [validate the signature](#token-validation) to prove that the token is authentic.</span></span> <span data-ttu-id="a04a8-147">API должен также проверить несколько утверждений в маркере, чтобы подтвердить его действительность.</span><span class="sxs-lookup"><span data-stu-id="a04a8-147">Your API must also validate a few claims in the token to prove that it is valid.</span></span> <span data-ttu-id="a04a8-148">Утверждения, которые проверяет приложение, зависят от требований сценария, но некоторые [стандартные проверки утверждений](#token-validation) приложение должно выполнять в каждом сценарии.</span><span class="sxs-lookup"><span data-stu-id="a04a8-148">Depending on the scenario requirements, the claims validated by an app can vary, but your app must perform some [common claim validations](#token-validation) in every scenario.</span></span>

### <a name="claims-in-id-and-access-tokens"></a><span data-ttu-id="a04a8-149">Утверждения в маркерах идентификации и доступа</span><span class="sxs-lookup"><span data-stu-id="a04a8-149">Claims in ID and access tokens</span></span>
<span data-ttu-id="a04a8-150">Используя Azure AD B2C, вы можете точно контролировать содержимое маркеров.</span><span class="sxs-lookup"><span data-stu-id="a04a8-150">When you use Azure AD B2C, you have fine-grained control over the content of your tokens.</span></span> <span data-ttu-id="a04a8-151">Вы можете настроить [политики](active-directory-b2c-reference-policies.md) для отправки определенных наборов пользовательских данных в утверждениях, которые необходимы для работы приложения.</span><span class="sxs-lookup"><span data-stu-id="a04a8-151">You can configure [policies](active-directory-b2c-reference-policies.md) to send certain sets of user data in claims that your app requires for its operations.</span></span> <span data-ttu-id="a04a8-152">Эти утверждения могут включать в себя стандартные свойства, например свойства `displayName` и `emailAddress` пользователя.</span><span class="sxs-lookup"><span data-stu-id="a04a8-152">These claims can include standard properties such as the user's `displayName` and `emailAddress`.</span></span> <span data-ttu-id="a04a8-153">Кроме того, они могут содержать [настраиваемые пользовательские атрибуты](active-directory-b2c-reference-custom-attr.md) , которые вы можете задать в каталоге B2C.</span><span class="sxs-lookup"><span data-stu-id="a04a8-153">They can also include [custom user attributes](active-directory-b2c-reference-custom-attr.md) that you can define in your B2C directory.</span></span> <span data-ttu-id="a04a8-154">Каждый маркер идентификации и доступа, который вы получаете, содержит набор утверждений, связанных с безопасностью.</span><span class="sxs-lookup"><span data-stu-id="a04a8-154">Every ID and access token that you receive contains a certain set of security-related claims.</span></span> <span data-ttu-id="a04a8-155">С помощью этих утверждений ваши приложения могут безопасно проверять подлинность пользователей и запросов.</span><span class="sxs-lookup"><span data-stu-id="a04a8-155">Your applications can use these claims to securely authenticate users and requests.</span></span>

<span data-ttu-id="a04a8-156">Обратите внимание, что утверждения в маркерах идентификации не возвращаются в определенном порядке.</span><span class="sxs-lookup"><span data-stu-id="a04a8-156">Note that the claims in ID tokens are not returned in any particular order.</span></span> <span data-ttu-id="a04a8-157">Кроме того, новые утверждения могут появиться в маркерах идентификации в любое время.</span><span class="sxs-lookup"><span data-stu-id="a04a8-157">In addition, new claims can be introduced in ID tokens at any time.</span></span> <span data-ttu-id="a04a8-158">По мере появления новых утверждений ваше приложение не должно прерывать работу.</span><span class="sxs-lookup"><span data-stu-id="a04a8-158">Your app should not break as new claims are introduced.</span></span> <span data-ttu-id="a04a8-159">В таблице приводятся утверждения, содержащиеся в маркерах идентификации и доступа, которые выдает служба Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="a04a8-159">Here are the claims that you expect to exist in ID and access tokens issued by Azure AD B2C.</span></span> <span data-ttu-id="a04a8-160">Все дополнительные утверждения определяются политиками.</span><span class="sxs-lookup"><span data-stu-id="a04a8-160">Any additional claims are determined by policies.</span></span> <span data-ttu-id="a04a8-161">В целях обучения попробуйте изучить утверждения в примере маркера идентификации, вставив его в [calebb.net](http://calebb.net).</span><span class="sxs-lookup"><span data-stu-id="a04a8-161">For practice, try inspecting the claims in the sample ID token by pasting it into [calebb.net](http://calebb.net).</span></span> <span data-ttu-id="a04a8-162">Дополнительные сведения можно найти в [спецификации по OpenID Connect](http://openid.net/specs/openid-connect-core-1_0.html).</span><span class="sxs-lookup"><span data-stu-id="a04a8-162">Further details can be found in the [OpenID Connect specification](http://openid.net/specs/openid-connect-core-1_0.html).</span></span>

| <span data-ttu-id="a04a8-163">Имя</span><span class="sxs-lookup"><span data-stu-id="a04a8-163">Name</span></span> | <span data-ttu-id="a04a8-164">Утверждение</span><span class="sxs-lookup"><span data-stu-id="a04a8-164">Claim</span></span> | <span data-ttu-id="a04a8-165">Пример значения</span><span class="sxs-lookup"><span data-stu-id="a04a8-165">Example value</span></span> | <span data-ttu-id="a04a8-166">Описание</span><span class="sxs-lookup"><span data-stu-id="a04a8-166">Description</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="a04a8-167">Аудитория</span><span class="sxs-lookup"><span data-stu-id="a04a8-167">Audience</span></span> |`aud` |`90c0fe63-bcf2-44d5-8fb7-b8bbc0b29dc6` |<span data-ttu-id="a04a8-168">Утверждение "Аудитория" обозначает целевого получателя маркера.</span><span class="sxs-lookup"><span data-stu-id="a04a8-168">An audience claim identifies the intended recipient of the token.</span></span> <span data-ttu-id="a04a8-169">В Azure AD B2C "Аудитория" — это идентификатор приложения, назначенный на портале регистрации приложений.</span><span class="sxs-lookup"><span data-stu-id="a04a8-169">For Azure AD B2C, the audience is your app's application ID, as assigned to your app in the app registration portal.</span></span> <span data-ttu-id="a04a8-170">Приложение должно проверить это значение и отклонить маркер, если он ему не соответствует.</span><span class="sxs-lookup"><span data-stu-id="a04a8-170">Your app should validate this value and reject the token if it does not match.</span></span> |
| <span data-ttu-id="a04a8-171">Issuer</span><span class="sxs-lookup"><span data-stu-id="a04a8-171">Issuer</span></span> |`iss` |`https://login.microsoftonline.com/775527ff-9a37-4307-8b3d-cc311f58d925/v2.0/` |<span data-ttu-id="a04a8-172">Это утверждение обозначает службу токенов безопасности (STS), которая создает и возвращает маркер.</span><span class="sxs-lookup"><span data-stu-id="a04a8-172">This claim identifies the security token service (STS) that constructs and returns the token.</span></span> <span data-ttu-id="a04a8-173">Кроме того, оно определяет, в каком каталоге Azure AD пользователь прошел проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="a04a8-173">It also identifies the Azure AD directory in which the user was authenticated.</span></span> <span data-ttu-id="a04a8-174">Приложение должно проверить утверждение издателя и убедиться, что маркер пришел от конечной точки Azure Active Directory версии 2.0.</span><span class="sxs-lookup"><span data-stu-id="a04a8-174">Your app should validate the issuer claim to ensure that the token came from the Azure Active Directory v2.0 endpoint.</span></span> |
| <span data-ttu-id="a04a8-175">Время выдачи</span><span class="sxs-lookup"><span data-stu-id="a04a8-175">Issued at</span></span> |`iat` |`1438535543` |<span data-ttu-id="a04a8-176">Это утверждение обозначает время выдачи маркера в виде времени эпохи.</span><span class="sxs-lookup"><span data-stu-id="a04a8-176">This claim is the time at which the token was issued, represented in epoch time.</span></span> |
| <span data-ttu-id="a04a8-177">Время окончания срока действия</span><span class="sxs-lookup"><span data-stu-id="a04a8-177">Expiration time</span></span> |`exp` |`1438539443` |<span data-ttu-id="a04a8-178">Утверждение "Время окончания срока действия" обозначает (в виде времени эпохи) время, когда маркер становится недействительным.</span><span class="sxs-lookup"><span data-stu-id="a04a8-178">The expiration time claim is the time at which the token becomes invalid, represented in epoch time.</span></span> <span data-ttu-id="a04a8-179">Приложение должно использовать это утверждение для проверки действительности срока действия маркера.</span><span class="sxs-lookup"><span data-stu-id="a04a8-179">Your app should use this claim to verify the validity of the token lifetime.</span></span> |
| <span data-ttu-id="a04a8-180">Не ранее</span><span class="sxs-lookup"><span data-stu-id="a04a8-180">Not before</span></span> |`nbf` |`1438535543` |<span data-ttu-id="a04a8-181">Это утверждение обозначает время, когда начинается срок действия маркера (указанное в виде времени эпохи).</span><span class="sxs-lookup"><span data-stu-id="a04a8-181">This claim is the time at which the token becomes valid, represented in epoch time.</span></span> <span data-ttu-id="a04a8-182">Оно обычно совпадает со временем выдачи маркера.</span><span class="sxs-lookup"><span data-stu-id="a04a8-182">This is usually the same as the time the token was issued.</span></span> <span data-ttu-id="a04a8-183">Приложение должно использовать это утверждение для проверки действительности срока действия маркера.</span><span class="sxs-lookup"><span data-stu-id="a04a8-183">Your app should use this claim to verify the validity of the token lifetime.</span></span> |
| <span data-ttu-id="a04a8-184">Версия</span><span class="sxs-lookup"><span data-stu-id="a04a8-184">Version</span></span> |`ver` |`1.0` |<span data-ttu-id="a04a8-185">Версия маркера идентификации, заданная службой Azure AD.</span><span class="sxs-lookup"><span data-stu-id="a04a8-185">This is the version of the ID token, as defined by Azure AD.</span></span> |
| <span data-ttu-id="a04a8-186">Хэш-код</span><span class="sxs-lookup"><span data-stu-id="a04a8-186">Code hash</span></span> |`c_hash` |`SGCPtt01wxwfgnYZy2VJtQ` |<span data-ttu-id="a04a8-187">Хэш-код включается в состав маркеров идентификации, только если маркер выдан вместе с кодом авторизации OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="a04a8-187">A code hash is included in an ID token only when the token is issued together with an OAuth 2.0 authorization code.</span></span> <span data-ttu-id="a04a8-188">Хэш-код можно использовать для проверки подлинности кода авторизации.</span><span class="sxs-lookup"><span data-stu-id="a04a8-188">A code hash can be used to validate the authenticity of an authorization code.</span></span> <span data-ttu-id="a04a8-189">Дополнительные сведения о выполнении этой проверки см. в [спецификации OpenID Connect](http://openid.net/specs/openid-connect-core-1_0.html).</span><span class="sxs-lookup"><span data-stu-id="a04a8-189">For more details on how to perform this validation, see the [OpenID Connect specification](http://openid.net/specs/openid-connect-core-1_0.html).</span></span>  |
| <span data-ttu-id="a04a8-190">Хэш маркера доступа</span><span class="sxs-lookup"><span data-stu-id="a04a8-190">Access token hash</span></span> |`at_hash` |`SGCPtt01wxwfgnYZy2VJtQ` |<span data-ttu-id="a04a8-191">Хэш маркера доступа включается в состав маркеров идентификации, только если этот маркер выдан вместе с маркером доступа OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="a04a8-191">An access token hash is included in an ID token only when the token is issued together with an OAuth 2.0 access token.</span></span> <span data-ttu-id="a04a8-192">Его можно использовать для проверки подлинности маркера доступа.</span><span class="sxs-lookup"><span data-stu-id="a04a8-192">An access token hash can be used to validate the authenticity of an access token.</span></span> <span data-ttu-id="a04a8-193">Дополнительные сведения о выполнении этой проверки см. в [спецификации OpenID Connect](http://openid.net/specs/openid-connect-core-1_0.html).</span><span class="sxs-lookup"><span data-stu-id="a04a8-193">For more details on how to perform this validation, see the [OpenID Connect specification](http://openid.net/specs/openid-connect-core-1_0.html)</span></span>  |
| <span data-ttu-id="a04a8-194">Специальное утверждение</span><span class="sxs-lookup"><span data-stu-id="a04a8-194">Nonce</span></span> |`nonce` |`12345` |<span data-ttu-id="a04a8-195">Nonce — это стратегия, которая используется для предотвращения атак повторного воспроизведения маркера.</span><span class="sxs-lookup"><span data-stu-id="a04a8-195">A nonce is a strategy used to mitigate token replay attacks.</span></span> <span data-ttu-id="a04a8-196">Приложение может указать специальное утверждение в запросе авторизации с помощью параметра запроса `nonce` .</span><span class="sxs-lookup"><span data-stu-id="a04a8-196">Your app can specify a nonce in an authorization request by using the `nonce` query parameter.</span></span> <span data-ttu-id="a04a8-197">Значение, указанное вами в запросе, будет использовано без изменений только в утверждении `nonce` маркера идентификации.</span><span class="sxs-lookup"><span data-stu-id="a04a8-197">The value you provide in the request will be emitted unmodified in the `nonce` claim of an ID token only.</span></span> <span data-ttu-id="a04a8-198">Таким образом приложение проверит это значение на соответствие значению, указанному в запросе, который связывает сеанс приложения с определенным маркером идентификации.</span><span class="sxs-lookup"><span data-stu-id="a04a8-198">This allows your app to verify the value against the value it specified on the request, which associates the app's session with a given ID token.</span></span> <span data-ttu-id="a04a8-199">Приложение должно выполнять эту проверку во время проверки маркера идентификации.</span><span class="sxs-lookup"><span data-stu-id="a04a8-199">Your app should perform this validation during the ID token validation process.</span></span> |
| <span data-ttu-id="a04a8-200">Субъект</span><span class="sxs-lookup"><span data-stu-id="a04a8-200">Subject</span></span> |`sub` |`884408e1-2918-4cz0-b12d-3aa027d7563b` |<span data-ttu-id="a04a8-201">Субъект, в отношении которого маркер подтверждает сведения, например пользователь приложения.</span><span class="sxs-lookup"><span data-stu-id="a04a8-201">This is the principal about which the token asserts information, such as the user of an app.</span></span> <span data-ttu-id="a04a8-202">Это значение является неизменяемым и не может быть переназначено или повторно использовано.</span><span class="sxs-lookup"><span data-stu-id="a04a8-202">This value is immutable and cannot be reassigned or reused.</span></span> <span data-ttu-id="a04a8-203">Это значение можно использовать для безопасных проверок авторизации, например, когда маркер используется для доступа к ресурсу.</span><span class="sxs-lookup"><span data-stu-id="a04a8-203">It can be used to perform authorization checks safely, such as when the token is used to access a resource.</span></span> <span data-ttu-id="a04a8-204">По умолчанию утверждение субъекта заполняется идентификатором объекта пользователя в каталоге.</span><span class="sxs-lookup"><span data-stu-id="a04a8-204">By default, the subject claim is populated with the object ID of the user in the directory.</span></span> <span data-ttu-id="a04a8-205">Дополнительные сведения см. в статье [Azure Active Directory B2C: конфигурация маркера, сеанса и единого входа](active-directory-b2c-token-session-sso.md).</span><span class="sxs-lookup"><span data-stu-id="a04a8-205">To learn more, see [Azure Active Directory B2C: Token, session, and single sign-on configuration](active-directory-b2c-token-session-sso.md).</span></span> |
| <span data-ttu-id="a04a8-206">Ссылка на класс контекста проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="a04a8-206">Authentication context class reference</span></span> |`acr` |<span data-ttu-id="a04a8-207">Не применяется</span><span class="sxs-lookup"><span data-stu-id="a04a8-207">Not applicable</span></span> |<span data-ttu-id="a04a8-208">Сейчас не используется, кроме случаев применения старой политики.</span><span class="sxs-lookup"><span data-stu-id="a04a8-208">Not used currently, except in the case of older policies.</span></span> <span data-ttu-id="a04a8-209">Дополнительные сведения см. в статье [Azure Active Directory B2C: конфигурация маркера, сеанса и единого входа](active-directory-b2c-token-session-sso.md).</span><span class="sxs-lookup"><span data-stu-id="a04a8-209">To learn more, see [Azure Active Directory B2C: Token, session, and single sign-on configuration](active-directory-b2c-token-session-sso.md).</span></span> |
| <span data-ttu-id="a04a8-210">Политика инфраструктуры доверия</span><span class="sxs-lookup"><span data-stu-id="a04a8-210">Trust framework policy</span></span> |`tfp` |`b2c_1_sign_in` |<span data-ttu-id="a04a8-211">Это имя политики, которая использовалась для получения маркера идентификации.</span><span class="sxs-lookup"><span data-stu-id="a04a8-211">This is the name of the policy that was used to acquire the ID token.</span></span> |
| <span data-ttu-id="a04a8-212">Время проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="a04a8-212">Authentication time</span></span> |`auth_time` |`1438535543` |<span data-ttu-id="a04a8-213">Данное утверждение — это время, когда пользователь в последний раз вводил учетные данные. Время отображается виде времени эпохи.</span><span class="sxs-lookup"><span data-stu-id="a04a8-213">This claim is the time at which a user last entered credentials, represented in epoch time.</span></span> |

### <a name="refresh-tokens"></a><span data-ttu-id="a04a8-214">Маркеры обновления</span><span class="sxs-lookup"><span data-stu-id="a04a8-214">Refresh tokens</span></span>
<span data-ttu-id="a04a8-215">Маркеры обновления — это маркеры безопасности, которые приложение может использовать для получения новых маркеров идентификации и маркеров доступа в потоке OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="a04a8-215">Refresh tokens are security tokens that your app can use to acquire new ID tokens and access tokens in an OAuth 2.0 flow.</span></span> <span data-ttu-id="a04a8-216">За счет этого приложение может получить длительный доступ к ресурсам от лица пользователя без участия самого пользователя.</span><span class="sxs-lookup"><span data-stu-id="a04a8-216">They provide your app with long-term access to resources on behalf of users without requiring interaction with those users.</span></span>

<span data-ttu-id="a04a8-217">Чтобы получить маркер обновления в ответе маркера, приложение должно запросить область `offline_acesss` .</span><span class="sxs-lookup"><span data-stu-id="a04a8-217">To receive a refresh token in a token response, your app must request the `offline_acesss` scope.</span></span> <span data-ttu-id="a04a8-218">Для получения дополнительных сведений об области `offline_access` обратитесь к [Справочнику по протоколу Azure AD B2C](active-directory-b2c-reference-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="a04a8-218">To learn more about the `offline_access` scope, refer to the [Azure AD B2C protocol reference](active-directory-b2c-reference-protocols.md).</span></span>

<span data-ttu-id="a04a8-219">Маркеры обновления абсолютно непрозрачны для приложения и всегда будут таковыми.</span><span class="sxs-lookup"><span data-stu-id="a04a8-219">Refresh tokens are, and will always be, completely opaque to your app.</span></span> <span data-ttu-id="a04a8-220">Их выдает служба Azure AD, и только эта служба может их проверять и интерпретировать.</span><span class="sxs-lookup"><span data-stu-id="a04a8-220">They are issued by Azure AD and can be inspected and interpreted only by Azure AD.</span></span> <span data-ttu-id="a04a8-221">Они действительны в течение продолжительного времени, но при создании приложения не следует ожидать, что маркер обновления будет действителен в течение определенного периода времени.</span><span class="sxs-lookup"><span data-stu-id="a04a8-221">They are long-lived, but your app should not be written with the expectation that a refresh token will last for a specific period of time.</span></span> <span data-ttu-id="a04a8-222">Маркеры обновления могут стать недействительными в любое время по разным причинам.</span><span class="sxs-lookup"><span data-stu-id="a04a8-222">Refresh tokens can be invalidated at any moment for a variety of reasons.</span></span> <span data-ttu-id="a04a8-223">Единственный способ, с помощью которого приложение может выяснить, является ли маркер действительным, — попытаться использовать его путем отправки запроса маркера Azure AD.</span><span class="sxs-lookup"><span data-stu-id="a04a8-223">The only way for your app to know if a refresh token is valid is to attempt to redeem it by making a token request to Azure AD.</span></span>

<span data-ttu-id="a04a8-224">При обмене маркера обновления на новый маркер (если приложению предоставлена область `offline_access` ) вы получите новый маркер обновления в ответе маркера.</span><span class="sxs-lookup"><span data-stu-id="a04a8-224">When you redeem a refresh token for a new token (and if your app has been granted the `offline_access` scope), you will receive a new refresh token in the token response.</span></span> <span data-ttu-id="a04a8-225">Только что выданный маркер обновления следует сохранить.</span><span class="sxs-lookup"><span data-stu-id="a04a8-225">You should save the newly issued refresh token.</span></span> <span data-ttu-id="a04a8-226">Он должен заменить собой маркер обновления, который вы использовали в запросе в прошлый раз.</span><span class="sxs-lookup"><span data-stu-id="a04a8-226">It should replace the refresh token you previously used in the request.</span></span> <span data-ttu-id="a04a8-227">Такой подход обеспечит максимальный срок действия маркеров обновления.</span><span class="sxs-lookup"><span data-stu-id="a04a8-227">This helps guarantee that your refresh tokens remain valid for as long as possible.</span></span>

## <a name="token-validation"></a><span data-ttu-id="a04a8-228">Проверка маркеров</span><span class="sxs-lookup"><span data-stu-id="a04a8-228">Token validation</span></span>
<span data-ttu-id="a04a8-229">Для проверки маркера приложение должно проверить подпись маркера и содержащиеся в нем утверждения.</span><span class="sxs-lookup"><span data-stu-id="a04a8-229">To validate a token, your app should check both the signature and claims of the token.</span></span>

<span data-ttu-id="a04a8-230">Для проверки маркеров JWT доступны многие библиотеки с открытым исходным кодом в зависимости от выбранного языка.</span><span class="sxs-lookup"><span data-stu-id="a04a8-230">Many open source libraries are available for validating JWTs, depending on your preferred language.</span></span> <span data-ttu-id="a04a8-231">Мы рекомендуем изучить различные библиотеки, а не реализовывать логику проверки самостоятельно.</span><span class="sxs-lookup"><span data-stu-id="a04a8-231">We recommend that you explore those options rather than implement your own validation logic.</span></span> <span data-ttu-id="a04a8-232">Из этого руководства вы узнаете, как правильно использовать эти библиотеки.</span><span class="sxs-lookup"><span data-stu-id="a04a8-232">The information in this guide can help you learn how to properly use those libraries.</span></span>

### <a name="validate-the-signature"></a><span data-ttu-id="a04a8-233">проверяют его подпись</span><span class="sxs-lookup"><span data-stu-id="a04a8-233">Validate the signature</span></span>
<span data-ttu-id="a04a8-234">Маркер JWT содержит три сегмента, разделенных знаком `.` .</span><span class="sxs-lookup"><span data-stu-id="a04a8-234">A JWT contains three segments, separated by the `.` character.</span></span> <span data-ttu-id="a04a8-235">Первый сегмент — это *заголовок*, второй — *текст*, а третий — *подпись*.</span><span class="sxs-lookup"><span data-stu-id="a04a8-235">The first segment is the *header*, the second is the *body*, and the third is the *signature*.</span></span> <span data-ttu-id="a04a8-236">Сегмент подписи можно использовать для проверки подлинности маркера, чтобы приложение доверяло ему.</span><span class="sxs-lookup"><span data-stu-id="a04a8-236">The signature segment can be used to validate the authenticity of the token so that it can be trusted by your app.</span></span>

<span data-ttu-id="a04a8-237">Маркеры Azure AD B2C подписываются при помощи стандартных отраслевых алгоритмов асимметричного шифрования, таких как RSA 256.</span><span class="sxs-lookup"><span data-stu-id="a04a8-237">Azure AD B2C tokens are signed by using industry-standard asymmetric encryption algorithms, such as RSA 256.</span></span> <span data-ttu-id="a04a8-238">Заголовок маркера содержит сведения о ключе и методе шифрования, используемых для подписания маркера:</span><span class="sxs-lookup"><span data-stu-id="a04a8-238">The header of the token contains information about the key and encryption method used to sign the token:</span></span>

```
{
        "typ": "JWT",
        "alg": "RS256",
        "kid": "GvnPApfWMdLRi8PDmisFn7bprKg"
}
```

<span data-ttu-id="a04a8-239">Утверждение `alg` обозначает алгоритм, с помощью которого был подписан маркер.</span><span class="sxs-lookup"><span data-stu-id="a04a8-239">The `alg` claim indicates the algorithm that was used to sign the token.</span></span> <span data-ttu-id="a04a8-240">Утверждение `kid` обозначает конкретный открытый ключ, с помощью которого был подписан маркер.</span><span class="sxs-lookup"><span data-stu-id="a04a8-240">The `kid` claim indicates the particular public key that was used to sign the token.</span></span>

<span data-ttu-id="a04a8-241">Azure AD может в любой момент времени подписать маркер с использованием любой пары открытого и закрытого ключей из определенного набора пар.</span><span class="sxs-lookup"><span data-stu-id="a04a8-241">At any given time, Azure AD can sign a token by using any one of a certain set of public-private key pairs.</span></span> <span data-ttu-id="a04a8-242">Azure AD периодически изменяет возможный набор ключей, поэтому при создании приложения необходимо обеспечить автоматическую обработку подобных изменений ключей.</span><span class="sxs-lookup"><span data-stu-id="a04a8-242">Azure AD rotates the possible set of keys periodically, so your app should be written to handle those key changes automatically.</span></span> <span data-ttu-id="a04a8-243">Рекомендуем проверять наличие обновлений открытых ключей, которые использует служба Azure AD, каждые 24 часа.</span><span class="sxs-lookup"><span data-stu-id="a04a8-243">A reasonable frequency to check for updates to the public keys used by Azure AD is every 24 hours.</span></span>

<span data-ttu-id="a04a8-244">Служба Azure AD B2C имеет конечную точку метаданных OpenID Connect.</span><span class="sxs-lookup"><span data-stu-id="a04a8-244">Azure AD B2C has an OpenID Connect metadata endpoint.</span></span> <span data-ttu-id="a04a8-245">Это позволяет приложениям получать сведения об Azure AD B2C во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="a04a8-245">This allows apps to fetch information about Azure AD B2C at runtime.</span></span> <span data-ttu-id="a04a8-246">Эти сведения включают конечные точки, содержимое маркеров и ключи подписи маркеров.</span><span class="sxs-lookup"><span data-stu-id="a04a8-246">This information includes endpoints, token contents, and token signing keys.</span></span> <span data-ttu-id="a04a8-247">Для каждой политики в каталоге B2C есть собственный документ метаданных JSON.</span><span class="sxs-lookup"><span data-stu-id="a04a8-247">Your B2C directory contains a JSON metadata document for each policy.</span></span> <span data-ttu-id="a04a8-248">Например, документ метаданных для политики `b2c_1_sign_in` в `fabrikamb2c.onmicrosoft.com` находится в каталоге:</span><span class="sxs-lookup"><span data-stu-id="a04a8-248">For example, the metadata document for the `b2c_1_sign_in` policy in  `fabrikamb2c.onmicrosoft.com` is located at:</span></span>

```
https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/v2.0/.well-known/openid-configuration?p=b2c_1_sign_in
```

<span data-ttu-id="a04a8-249">`fabrikamb2c.onmicrosoft.com` — это каталог B2C, используемый для проверки подлинности пользователя, а `b2c_1_sign_in` — это политика, используемая для получения маркера.</span><span class="sxs-lookup"><span data-stu-id="a04a8-249">`fabrikamb2c.onmicrosoft.com` is the B2C directory used to authenticate the user, and `b2c_1_sign_in` is the policy used to acquire the token.</span></span> <span data-ttu-id="a04a8-250">Чтобы определить, какая политика была использована для подписи маркера (а также определить, откуда необходимо получать метаданные), можно воспользоваться одним из двух вариантов.</span><span class="sxs-lookup"><span data-stu-id="a04a8-250">To determine which policy was used to sign a token (and where to go to fetch the metadata), you have two options.</span></span> <span data-ttu-id="a04a8-251">Сначала имя политики включается в утверждение `acr` маркера.</span><span class="sxs-lookup"><span data-stu-id="a04a8-251">First, the policy name is included in the `acr` claim in the token.</span></span> <span data-ttu-id="a04a8-252">Утверждения из тела маркера JWT можно проанализировать, декодировав тело маркера с помощью кодировки base-64 и десериализации полученной строки JSON.</span><span class="sxs-lookup"><span data-stu-id="a04a8-252">You can parse claims out of the body of the JWT by base-64 decoding the body and deserializing the JSON string that results.</span></span> <span data-ttu-id="a04a8-253">Утверждение `acr` будет представлять собой имя политики, которая использовалась для выдачи маркера.</span><span class="sxs-lookup"><span data-stu-id="a04a8-253">The `acr` claim will be the name of the policy that was used to issue the token.</span></span>  <span data-ttu-id="a04a8-254">Другой вариант — закодировать политику в значении параметра `state` при отправке запроса и затем декодировать ее, чтобы определить, какая политика была использована.</span><span class="sxs-lookup"><span data-stu-id="a04a8-254">Your other option is to encode the policy in the value of the `state` parameter when you issue the request, and then decode it to determine which policy was used.</span></span> <span data-ttu-id="a04a8-255">Каждый из этих методов является допустимым.</span><span class="sxs-lookup"><span data-stu-id="a04a8-255">Either method is valid.</span></span>

<span data-ttu-id="a04a8-256">Документ метаданных является объектом JSON, содержащим важные сведения.</span><span class="sxs-lookup"><span data-stu-id="a04a8-256">The metadata document is a JSON object that contains several useful pieces of information.</span></span> <span data-ttu-id="a04a8-257">К ним относится расположение конечных точек, необходимых для проверки подлинности OpenID Connect.</span><span class="sxs-lookup"><span data-stu-id="a04a8-257">These include the location of the endpoints required to perform OpenID Connect authentication.</span></span> <span data-ttu-id="a04a8-258">Эти сведения включают в себя также код `jwks_uri`, который указывает расположение набора открытых ключей, использованных для подписания маркеров.</span><span class="sxs-lookup"><span data-stu-id="a04a8-258">They also include `jwks_uri`, which gives the location of the set of public keys that are used to sign tokens.</span></span> <span data-ttu-id="a04a8-259">Это расположение представлено ниже, но лучше получить его динамически с помощью документа метаданных и анализа `jwks_uri`:</span><span class="sxs-lookup"><span data-stu-id="a04a8-259">That location is provided here, but it is best to fetch the location dynamically by using the metadata document and parsing out `jwks_uri`:</span></span>

```
https://login.microsoftonline.com/fabrikamb2c.onmicrosoft.com/discovery/v2.0/keys?p=b2c_1_sign_in
```

<span data-ttu-id="a04a8-260">Документ JSON, расположенный по этому URL-адресу, содержит все сведения об открытых ключах, используемые в конкретный момент времени.</span><span class="sxs-lookup"><span data-stu-id="a04a8-260">The JSON document located at this URL contains all the public key information in use at a particular moment.</span></span> <span data-ttu-id="a04a8-261">Приложение может использовать утверждение `kid` в заголовке маркера JWT, чтобы выбрать открытый ключ в этом документе JSON, использованный для подписания определенного маркера.</span><span class="sxs-lookup"><span data-stu-id="a04a8-261">Your app can use the `kid` claim in the JWT header to select the public key in the JSON document that is used to sign a particular token.</span></span> <span data-ttu-id="a04a8-262">Затем оно может проверить подпись с использованием правильного открытого ключа и указанного алгоритма.</span><span class="sxs-lookup"><span data-stu-id="a04a8-262">It can then perform signature validation by using the correct public key and the indicated algorithm.</span></span>

<span data-ttu-id="a04a8-263">Описание выполнения проверки выходит за рамки этого документа.</span><span class="sxs-lookup"><span data-stu-id="a04a8-263">A description of how to perform signature validation is outside the scope of this document.</span></span> <span data-ttu-id="a04a8-264">Вы можете использовать для выполнения проверки многие библиотеки с открытым исходным кодом.</span><span class="sxs-lookup"><span data-stu-id="a04a8-264">Many open source libraries are available to help you with this if you need it.</span></span>

### <a name="validate-the-claims"></a><span data-ttu-id="a04a8-265">Проверка утверждений</span><span class="sxs-lookup"><span data-stu-id="a04a8-265">Validate the claims</span></span>
<span data-ttu-id="a04a8-266">Когда приложение или API получает маркер идентификации, они также должны выполнить несколько проверок утверждений в этом маркере.</span><span class="sxs-lookup"><span data-stu-id="a04a8-266">When your app or API receives an ID token, it should also perform several checks against the claims in the ID token.</span></span> <span data-ttu-id="a04a8-267">Помимо прочего, к этим утверждениям относятся:</span><span class="sxs-lookup"><span data-stu-id="a04a8-267">These include, but are not limited to:</span></span>

* <span data-ttu-id="a04a8-268">Утверждение **Аудитория**. Необходимо для подтверждения того, что маркер идентификации действительно должен был быть выдан вашему приложению.</span><span class="sxs-lookup"><span data-stu-id="a04a8-268">The **audience** claim: This verifies that the ID token was intended to be given to your app.</span></span>
* <span data-ttu-id="a04a8-269">Утверждения **Не ранее** и **Время окончания срока действия**. Необходимы для подтверждения того, что срок действия маркера идентификации не истек.</span><span class="sxs-lookup"><span data-stu-id="a04a8-269">The **not before** and **expiration time** claims: These verify that the ID token has not expired.</span></span>
* <span data-ttu-id="a04a8-270">Утверждение **Издатель**. Помогает убедиться в том, что маркер выдала приложению служба Azure AD.</span><span class="sxs-lookup"><span data-stu-id="a04a8-270">The **issuer** claim: This verifies that the token was issued to your app by Azure AD.</span></span>
* <span data-ttu-id="a04a8-271">**Nonce**— это стратегия, с помощью которой можно предотвратить атаки повторного воспроизведения маркера.</span><span class="sxs-lookup"><span data-stu-id="a04a8-271">The **nonce**: This is a strategy for token replay attack mitigation.</span></span>

<span data-ttu-id="a04a8-272">Полный список проверок, которые должно выполнять ваше приложение, см. в [спецификации OpenID Connect](https://openid.net).</span><span class="sxs-lookup"><span data-stu-id="a04a8-272">For a full list of validations your app should perform, refer to the [OpenID Connect specification](https://openid.net).</span></span> <span data-ttu-id="a04a8-273">Подробные сведения об ожидаемых значениях для этих утверждений можно найти выше в разделе, посвященном [маркерам](#types-of-tokens).</span><span class="sxs-lookup"><span data-stu-id="a04a8-273">Details of the expected values for these claims are included in the preceding [token section](#types-of-tokens).</span></span>  

## <a name="token-lifetimes"></a><span data-ttu-id="a04a8-274">Время существования маркеров</span><span class="sxs-lookup"><span data-stu-id="a04a8-274">Token lifetimes</span></span>
<span data-ttu-id="a04a8-275">Доступны следующие сроки существования маркеров.</span><span class="sxs-lookup"><span data-stu-id="a04a8-275">The following token lifetimes are provided to further your knowledge.</span></span> <span data-ttu-id="a04a8-276">Они могут пригодиться при разработке и отладке приложений.</span><span class="sxs-lookup"><span data-stu-id="a04a8-276">They can help you when you develop and debug apps.</span></span> <span data-ttu-id="a04a8-277">Обратите внимание, что при создании приложения не следует ожидать постоянства какого-либо из указанных сроков.</span><span class="sxs-lookup"><span data-stu-id="a04a8-277">Note that your apps should not be written to expect any of these lifetimes to remain constant.</span></span> <span data-ttu-id="a04a8-278">Они могут и будут изменяться.</span><span class="sxs-lookup"><span data-stu-id="a04a8-278">They can and will change.</span></span> <span data-ttu-id="a04a8-279">Ознакомьтесь с дополнительными сведениями о [настройке времени существования маркеров](active-directory-b2c-token-session-sso.md) в Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="a04a8-279">Read more about the [customization of token lifetimes](active-directory-b2c-token-session-sso.md) in Azure AD B2C.</span></span>

| <span data-ttu-id="a04a8-280">Маркер</span><span class="sxs-lookup"><span data-stu-id="a04a8-280">Token</span></span> | <span data-ttu-id="a04a8-281">Срок действия</span><span class="sxs-lookup"><span data-stu-id="a04a8-281">Lifetime</span></span> | <span data-ttu-id="a04a8-282">Описание</span><span class="sxs-lookup"><span data-stu-id="a04a8-282">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="a04a8-283">Маркеры идентификации</span><span class="sxs-lookup"><span data-stu-id="a04a8-283">ID tokens</span></span> |<span data-ttu-id="a04a8-284">Один час</span><span class="sxs-lookup"><span data-stu-id="a04a8-284">One hour</span></span> |<span data-ttu-id="a04a8-285">Маркеры идентификации обычно действительны в течение часа.</span><span class="sxs-lookup"><span data-stu-id="a04a8-285">ID tokens are typically valid for an hour.</span></span> <span data-ttu-id="a04a8-286">В течение этого срока ваше веб-приложение может создать свои сеансы с пользователями (рекомендуется).</span><span class="sxs-lookup"><span data-stu-id="a04a8-286">Your web app can use this lifetime to maintain its own sessions with users (recommended).</span></span> <span data-ttu-id="a04a8-287">Кроме того, вы можете выбрать другой срок существования сеанса.</span><span class="sxs-lookup"><span data-stu-id="a04a8-287">You can also choose a different session lifetime.</span></span> <span data-ttu-id="a04a8-288">Если приложению необходимо получить новый маркер идентификации, оно должно просто создать новый запрос входа в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="a04a8-288">If your app needs to get a new ID token, it simply needs to make a new sign-in request to Azure AD.</span></span> <span data-ttu-id="a04a8-289">Если в браузере у пользователя есть действительный сеанс Azure AD, то повторный ввод учетных данных может не потребоваться.</span><span class="sxs-lookup"><span data-stu-id="a04a8-289">If a user has a valid browser session with Azure AD, that user might not be required to enter credentials again.</span></span> |
| <span data-ttu-id="a04a8-290">Маркеры обновления</span><span class="sxs-lookup"><span data-stu-id="a04a8-290">Refresh tokens</span></span> |<span data-ttu-id="a04a8-291">До 14 дней</span><span class="sxs-lookup"><span data-stu-id="a04a8-291">Up to 14 days</span></span> |<span data-ttu-id="a04a8-292">Один маркер обновления действителен до 14 дней.</span><span class="sxs-lookup"><span data-stu-id="a04a8-292">A single refresh token is valid for a maximum of 14 days.</span></span> <span data-ttu-id="a04a8-293">Тем не менее маркер обновления может стать недопустимым в любое время и по различным причинам.</span><span class="sxs-lookup"><span data-stu-id="a04a8-293">However, a refresh token can become invalid at any time for a number of reasons.</span></span> <span data-ttu-id="a04a8-294">Приложению следует пытаться использовать маркер обновления до тех пор, пока запрос не завершится ошибкой или приложение не заменит существующий маркер обновления новым.</span><span class="sxs-lookup"><span data-stu-id="a04a8-294">Your app should continue to try to use a refresh token until the request fails, or until your app replaces the refresh token with a new one.</span></span> <span data-ttu-id="a04a8-295">Кроме того, маркер обновления может стать недействительным, если последний раз пользователь вводил учетные данные 90 дней назад.</span><span class="sxs-lookup"><span data-stu-id="a04a8-295">A refresh token can also become invalid if 90 days have passed since the user last entered credentials.</span></span> |
| <span data-ttu-id="a04a8-296">Коды авторизации</span><span class="sxs-lookup"><span data-stu-id="a04a8-296">Authorization codes</span></span> |<span data-ttu-id="a04a8-297">5 минут</span><span class="sxs-lookup"><span data-stu-id="a04a8-297">Five minutes</span></span> |<span data-ttu-id="a04a8-298">Коды авторизации специально обладают коротким сроком действия.</span><span class="sxs-lookup"><span data-stu-id="a04a8-298">Authorization codes are intentionally short-lived.</span></span> <span data-ttu-id="a04a8-299">После получения их следует незамедлительно обменять на маркеры доступа, маркеры идентификации или маркеры обновления.</span><span class="sxs-lookup"><span data-stu-id="a04a8-299">They should be redeemed immediately for access tokens, ID tokens, or refresh tokens when they are received.</span></span> |

