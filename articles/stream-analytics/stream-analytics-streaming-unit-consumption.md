---
title: "Azure Stream Analytics: оптимизация задания для эффективного использования единиц потоковой передачи | Документация Майкрософт"
description: "Рассматривайте рекомендации по масштабированию и производительности в Azure Stream Analytics."
keywords: "единица потоковой передачи, производительность запроса"
services: stream-analytics
documentationcenter: 
author: jeffstokes72
manager: jhubbard
editor: cgronlun
ms.assetid: 
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 04/20/2017
ms.author: jeffstok
ms.openlocfilehash: 1441a5df4fd92abf85763ca9a1512503b1a0da56
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="optimize-your-job-to-use-streaming-units-efficiently"></a>Оптимизация задания для эффективного использования единиц потоковой передачи

Azure Stream Analytics вычисляет показатель производительности при выполнении задания в единицах потоковой передачи, представляющих вычислительные ресурсы, которые используются для выполнения заданий. Единицы потоковой передачи предоставляют способ описания относительной мощности обработки события, основываясь на измерении загрузки ЦП, памяти и скорости чтения и записи. Эта емкость позволяет сосредоточиться на логике запросов. При этом вам не нужно знать рекомендации по производительности уровня хранилища, выделять память для задания вручную и определять приблизительное число ядер ЦП, необходимых для своевременного выполнения задания.

## <a name="how-many-sus-are-required-for-a-job"></a>Сколько единиц потоковой передачи требуется для задания?

Выбор числа единиц потоковой передачи, требуемых для конкретного задания, зависит от конфигурации входных данных и запроса, определенного в задании. В колонке **Масштаб** можно задать требуемое число единиц потоковой передачи. Мы рекомендуем выделять больше единиц потоковой передачи, чем требуется. Модуль обработки Stream Analytics оптимизирует задержки и пропускную способность за счет выделения дополнительной памяти.

В общем лучше всего начать с 6 единиц потоковой передачи для запросов, не использующих *PARTITION BY*. Затем определите "золотую середину", используя метод проб и ошибок, при котором вы изменяете число единиц потоковой передачи после передачи репрезентативного объема данных и просмотра метрики процента использования единицы потоковой передачи.

Перед началом обработки в Azure Stream Analytics события находятся в окне буфера изменения порядка. Внутри окна изменения порядка события сортируются по времени, и последующие операции выполняются с отсортированными событиями. Изменение порядка событий по времени гарантирует, что оператор видит все события за установленный период времени. Благодаря этому он выполняет необходимую обработку и выдает результат. Побочный эффект этого механизма заключается в том, что обработка откладывается, пока события находятся в окне изменения порядка. Объем памяти для задания (что влияет на использование единиц потоковой передачи) зависит от размера этого окна изменения порядка и числа событий в нем.

> [!NOTE]
> При изменении числа модулей чтения во время обновления задания временные предупреждения записываются в журналы аудита. Задания Stream Analytics восстанавливаются от этих временных сбоев автоматически.

## <a name="common-high-memory-causes-for-high-su-usage-for-running-jobs"></a>Наиболее частые причины большого объема памяти при интенсивном использовании единиц потоковой передачи для выполняющихся заданий

### <a name="high-cardinality-for-group-by"></a>Большое число элементов для выражения GROUP BY

Число элементов во входящих событиях влияет на использование памяти для задания.

Например, в `SELECT count(*) from input group by clustered, tumblingwindow (minutes, 5)` связанное с **кластером** число — это число элементов в запросе.

Для устранения проблем, вызванных большим количеством элементов, разверните запрос, увеличив число разделов с помощью **PARTITION BY**.

```
Select count(*) from input
Partition By clusterid
GROUP BY clustered tumblingwindow (minutes, 5)
```

Число *кластеров* — это количество элементов GROUP BY.

Секционированный запрос распределяется между несколькими узлами. В результате уменьшается не только число событий, поступающих на каждый узел, но и размер буфера изменения порядка. Кроме того, нужно секционировать разделы концентратора событий по идентификатору раздела.

### <a name="high-unmatched-event-count-for-join"></a>Большое число несопоставленных событий для JOIN

Число несопоставленных событий в JOIN влияет на использование ресурсов памяти в запросе. Например давайте рассмотрим запрос на поиск просмотров рекламы, которые привели к переходам:

```
SELECT id from clicks INNER JOIN,
impressions on impressions.id = clicks.id AND DATEDIFF(hour, impressions, clicks) between 0 AND 10
```

В этом случае возможно, что отображается множество рекламных объявлений и выполняется несколько переходов. С учетом такого результата заданию нужно сохранить все события в течение временного окна. Объем используемой памяти пропорционален размеру окна и частоте событий. 

Во избежание такой ситуации разверните запрос, увеличив число разделов с помощью PARTITION BY. 

Секционированный запрос распределяется между несколькими узлами обработки. В результате уменьшается не только число событий, поступающих на каждый узел, но и размер буфера изменения порядка.

### <a name="large-number-of-out-of-order-events"></a>Большое число неупорядоченных событий 

Большое число неупорядоченных событий в большом временном окне еще больше увеличит окно буфера переупорядочения. Во избежание этого масштабируйте запрос, увеличивая число разделов с помощью PARTITION BY. Секционированный запрос распределяется между несколькими узлами. В результате уменьшается не только число событий, поступающих на каждый узел, но и размер буфера изменения порядка. 


## <a name="get-help"></a>Получение справки
За дополнительной помощью обращайтесь на наш [форум Azure Stream Analytics](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics).

## <a name="next-steps"></a>Дальнейшие действия
* [Введение в Azure Stream Analytics](stream-analytics-introduction.md)
* [Приступая к работе с Azure Stream Analytics](stream-analytics-real-time-fraud-detection.md)
* [Масштабирование заданий в службе Azure Stream Analytics](stream-analytics-scale-jobs.md)
* [Azure Stream Analytics query language reference](https://msdn.microsoft.com/library/azure/dn834998.aspx) (Справочник по языку запросов Azure Stream Analytics).
* [Справочник по API-интерфейсу REST управления Stream Analytics](https://msdn.microsoft.com/library/azure/dn835031.aspx)
