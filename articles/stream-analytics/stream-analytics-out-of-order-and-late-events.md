---
title: "aaaHandling порядок событий и просрочка с Azure Stream Analytics | Документы Microsoft"
description: "Узнайте об обработке неупорядоченных или поздних событий в потоках данных Stream Analytics."
keywords: "не по порядку, поздний, события"
documentationcenter: 
services: stream-analytics
author: jeffstokes72
manager: jhubbard
editor: cgronlun
ms.assetid: 
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 04/20/2017
ms.author: jeffstok
ms.openlocfilehash: 87c028662fbafbf4f72f57f215d017f65bb649f0
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="azure-stream-analytics-event-order-handling"></a><span data-ttu-id="785c3-104">Обработка порядка событий Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="785c3-104">Azure Stream Analytics event order handling</span></span>

<span data-ttu-id="785c3-105">В потоке темпоральных данных событий регистрируется каждого события с временем hello получении hello события.</span><span class="sxs-lookup"><span data-stu-id="785c3-105">In a temporal data stream of events, each event is recorded with hello time that hello event is received.</span></span> <span data-ttu-id="785c3-106">Для некоторых условий может привести к toooccasionally получать потоки событий некоторые события в другом порядке, чем та, которую они были отправлены.</span><span class="sxs-lookup"><span data-stu-id="785c3-106">Some conditions might cause event streams toooccasionally receive some events in a different order than which they were sent.</span></span> <span data-ttu-id="785c3-107">Простые TCP повторной или даже Отклонение времени между отправкой устройства и получение концентратора событий hello hello может привести к этой toooccur.</span><span class="sxs-lookup"><span data-stu-id="785c3-107">A simple TCP retransmit, or even a clock skew between hello sending device and hello receiving event hub might cause this toooccur.</span></span> <span data-ttu-id="785c3-108">События «Пунктуация» также добавляются tooreceived потоков событий, время tooadvance hello в отсутствие поступлений hello.</span><span class="sxs-lookup"><span data-stu-id="785c3-108">“Punctuation” events also are added tooreceived event streams, tooadvance hello time in hello absence of event arrivals.</span></span> <span data-ttu-id="785c3-109">Это нужно в сценариях типа "Уведомить меня, если операция входа не выполняется в течение 3 минут".</span><span class="sxs-lookup"><span data-stu-id="785c3-109">These are needed in scenarios like “Notify me when no logins occur for 3 minutes."</span></span>

<span data-ttu-id="785c3-110">С неупорядоченными входными потоками происходит одно из следующих событий:</span><span class="sxs-lookup"><span data-stu-id="785c3-110">Input streams that are not in order are either:</span></span>
* <span data-ttu-id="785c3-111">сортировка (и, следовательно, **удаление**);</span><span class="sxs-lookup"><span data-stu-id="785c3-111">Sorted (and therefore **delayed**).</span></span>
* <span data-ttu-id="785c3-112">Выровнен по hello системы, в соответствии с tooa пользовательской политики.</span><span class="sxs-lookup"><span data-stu-id="785c3-112">Adjusted by hello system, according tooa user-specified policy.</span></span>


## <a name="lateness-tolerance"></a><span data-ttu-id="785c3-113">Допуск по просрочке</span><span class="sxs-lookup"><span data-stu-id="785c3-113">Lateness tolerance</span></span>
<span data-ttu-id="785c3-114">Stream Analytics допускает такие типы сценариев.</span><span class="sxs-lookup"><span data-stu-id="785c3-114">Stream Analytics tolerates these types of scenarios.</span></span> <span data-ttu-id="785c3-115">В этой службе предусмотрены механизмы обработки неупорядоченных и поздних событий.</span><span class="sxs-lookup"><span data-stu-id="785c3-115">Stream Analytics has handling for "out-of-order" and "late" events.</span></span> <span data-ttu-id="785c3-116">Он обрабатывает эти события в hello следующих способов:</span><span class="sxs-lookup"><span data-stu-id="785c3-116">It handles these events in hello following ways:</span></span>

* <span data-ttu-id="785c3-117">События, которые не по порядку, но в пределах hello задайте допустимые значения: **переупорядочить по отметкам времени**.</span><span class="sxs-lookup"><span data-stu-id="785c3-117">Events that arrive out of order but within hello set tolerance are **reordered by timestamp**.</span></span>
* <span data-ttu-id="785c3-118">События, поступающие позже допустимого, **удаляются или корректируются**.</span><span class="sxs-lookup"><span data-stu-id="785c3-118">Events that arrive later than tolerance are **dropped or adjusted**.</span></span>
    * <span data-ttu-id="785c3-119">**Скорректировать**: toohave скорректированное tooappear достигают hello последние допустимого времени.</span><span class="sxs-lookup"><span data-stu-id="785c3-119">**Adjusted**: Adjusted tooappear toohave arrived at hello latest acceptable time.</span></span>
    * <span data-ttu-id="785c3-120">**Удаление** предполагает удаление.</span><span class="sxs-lookup"><span data-stu-id="785c3-120">**Dropped**: Discarded.</span></span>

![Обработка событий Stream Analytics](media/stream-analytics-event-handling/stream-analytics-event-handling.png)

## <a name="reduce-hello-number-of-out-of-order-events"></a><span data-ttu-id="785c3-122">Сократите число hello ожидания неупорядоченных событий</span><span class="sxs-lookup"><span data-stu-id="785c3-122">Reduce hello number of out-of-order events</span></span>

<span data-ttu-id="785c3-123">Так как при обработке входящих событий Stream Analytics применяет временное преобразование (например, агрегаты данных на основе периодов времени или временные соединения), они сортируются в порядке метки времени.</span><span class="sxs-lookup"><span data-stu-id="785c3-123">Because Stream Analytics applies a temporal transformation when it processes incoming events (for example, for windowed aggregates or temporal joins), Stream Analytics sorts incoming events by timestamp order.</span></span>

<span data-ttu-id="785c3-124">Ключевое слово hello «метка времени,» при **не** используется, по умолчанию используется время постановки в очередь событий концентраторов событий Azure hello.</span><span class="sxs-lookup"><span data-stu-id="785c3-124">When hello “timestamp by” keyword is **not** used, hello Azure Event Hubs event enqueue time is used by default.</span></span> <span data-ttu-id="785c3-125">Концентраторы событий гарантирует монотонности из hello метка времени для каждой секции концентратора событий hello.</span><span class="sxs-lookup"><span data-stu-id="785c3-125">Event Hubs guarantees monotonicity of hello timestamp on each partition of hello event hub.</span></span> <span data-ttu-id="785c3-126">а также объединение событий из всех разделов в порядке метки времени.</span><span class="sxs-lookup"><span data-stu-id="785c3-126">It also guarantees that events from all partitions will be merged in timestamp order.</span></span> <span data-ttu-id="785c3-127">Благодаря этому обеспечивается отсутствие неупорядоченных событий.</span><span class="sxs-lookup"><span data-stu-id="785c3-127">These two Event Hubs guarantees ensure no out-of-order events.</span></span>

<span data-ttu-id="785c3-128">В некоторых случаях важно для вас toouse hello отправителя меток времени.</span><span class="sxs-lookup"><span data-stu-id="785c3-128">Sometimes, it’s important for you toouse hello sender’s timestamp.</span></span> <span data-ttu-id="785c3-129">В этом случае отметки времени из полезных данных события hello выбирается с помощью «метка времени,».</span><span class="sxs-lookup"><span data-stu-id="785c3-129">In that case, a timestamp from hello event payload is chosen by using “timestamp by.”</span></span> <span data-ttu-id="785c3-130">В этих сценариях может появиться несколько источников неупорядоченных событий:</span><span class="sxs-lookup"><span data-stu-id="785c3-130">In these scenarios, one or more sources of event misorder might be introduced:</span></span>

* <span data-ttu-id="785c3-131">Часы поставщиков событий рассинхронизированы.</span><span class="sxs-lookup"><span data-stu-id="785c3-131">Event producers have clock skews.</span></span> <span data-ttu-id="785c3-132">Обычно это происходит, если используются поставщики с разных компьютеров с разными часами.</span><span class="sxs-lookup"><span data-stu-id="785c3-132">This is common when producers are from different computers, so they have different clocks.</span></span>
* <span data-ttu-id="785c3-133">Возникает задержка сети из источника hello hello события toohello назначения события концентратора.</span><span class="sxs-lookup"><span data-stu-id="785c3-133">There's a network delay from hello source of hello events toohello destination event hub.</span></span>
* <span data-ttu-id="785c3-134">Часы разделов концентратора событий рассинхронизированы.</span><span class="sxs-lookup"><span data-stu-id="785c3-134">Clock skews exist between event hub partitions.</span></span> <span data-ttu-id="785c3-135">Сначала Stream Analytics сортирует события из всех разделов концентратора событий по времени постановки события в очередь.</span><span class="sxs-lookup"><span data-stu-id="785c3-135">Stream Analytics first sorts events from all event hub partitions by event enqueue time.</span></span> <span data-ttu-id="785c3-136">Затем он проверяет hello потока данных для событий с неправильным порядком расположения.</span><span class="sxs-lookup"><span data-stu-id="785c3-136">Then, it examines hello data stream for misordered events.</span></span>

<span data-ttu-id="785c3-137">На вкладке настройки hello вы видите hello следующие значения по умолчанию:</span><span class="sxs-lookup"><span data-stu-id="785c3-137">On hello configuration tab, you see hello following defaults:</span></span>

![Обработка неупорядоченных событий в Stream Analytics](media/stream-analytics-event-handling/stream-analytics-out-of-order-handling.png)

<span data-ttu-id="785c3-139">При использовании окна out заказах hello 0 секунд вы утверждаете, что все события отображаются в порядке все время hello.</span><span class="sxs-lookup"><span data-stu-id="785c3-139">If you use 0 seconds as hello out-of-order tolerance window, you are asserting that all events are in order all hello time.</span></span> <span data-ttu-id="785c3-140">Имея hello три источника событий с неправильным порядком расположения, маловероятно, что это значение равно true.</span><span class="sxs-lookup"><span data-stu-id="785c3-140">Given hello three sources of misordered events, it’s unlikely that this is true.</span></span> 

<span data-ttu-id="785c3-141">toocorrect Stream Analytics tooallow misorder событий, можно указать ненулевой из внеочередной временной интервал.</span><span class="sxs-lookup"><span data-stu-id="785c3-141">tooallow Stream Analytics toocorrect an event misorder, you can specify a non-zero out-of-order tolerance window.</span></span> <span data-ttu-id="785c3-142">Stream Analytics буферизацию событий вверх toothat окон, а затем Дозаказы их с помощью hello отметки времени, выбранный.</span><span class="sxs-lookup"><span data-stu-id="785c3-142">Stream Analytics buffers events up toothat window, and then reorders them by using hello timestamp you chose.</span></span> <span data-ttu-id="785c3-143">Затем он применяет преобразование во времени hello.</span><span class="sxs-lookup"><span data-stu-id="785c3-143">It then applies hello temporal transformation.</span></span> <span data-ttu-id="785c3-144">Можно запустить с помощью окна 3 секунды, а также настроить hello значение tooreduce hello число событий, которые корректируются по времени.</span><span class="sxs-lookup"><span data-stu-id="785c3-144">You can start with a 3-second window, and tune hello value tooreduce hello number of events that are time-adjusted.</span></span> 

<span data-ttu-id="785c3-145">Побочным эффектом буферизации hello является выходной hello **задержан hello же время**.</span><span class="sxs-lookup"><span data-stu-id="785c3-145">A side effect of hello buffering is that hello output is **delayed by hello same amount of time**.</span></span> <span data-ttu-id="785c3-146">Можно настроить hello значение tooreduce hello число из неупорядоченные события и свести задержку задания hello.</span><span class="sxs-lookup"><span data-stu-id="785c3-146">You can tune hello value tooreduce hello number of out-of-order events, and keep hello job latency low.</span></span>

## <a name="get-help"></a><span data-ttu-id="785c3-147">Получение справки</span><span class="sxs-lookup"><span data-stu-id="785c3-147">Get help</span></span>
<span data-ttu-id="785c3-148">Дополнительную помощь вы можете получить на нашем [форуме Azure Stream Analytics](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics).</span><span class="sxs-lookup"><span data-stu-id="785c3-148">For additional assistance, try our [Azure Stream Analytics forum](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics).</span></span>

## <a name="next-steps"></a><span data-ttu-id="785c3-149">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="785c3-149">Next steps</span></span>
* [<span data-ttu-id="785c3-150">Введение tooStream аналитика</span><span class="sxs-lookup"><span data-stu-id="785c3-150">Introduction tooStream Analytics</span></span>](stream-analytics-introduction.md)
* [<span data-ttu-id="785c3-151">Приступая к работе с Azure Stream Analytics: выявление мошенничества в режиме реального времени</span><span class="sxs-lookup"><span data-stu-id="785c3-151">Get started with Stream Analytics</span></span>](stream-analytics-real-time-fraud-detection.md)
* [<span data-ttu-id="785c3-152">Масштабирование заданий Azure Stream Analytics для повышения пропускной способности базы данных</span><span class="sxs-lookup"><span data-stu-id="785c3-152">Scale Stream Analytics jobs</span></span>](stream-analytics-scale-jobs.md)
* <span data-ttu-id="785c3-153">[Stream Analytics Query Language Reference](https://msdn.microsoft.com/library/azure/dn834998.aspx) (Справочник по языку запросов Stream Analytics)</span><span class="sxs-lookup"><span data-stu-id="785c3-153">[Stream Analytics query language reference](https://msdn.microsoft.com/library/azure/dn834998.aspx)</span></span>
* <span data-ttu-id="785c3-154">[Stream Analytics management REST API reference](https://msdn.microsoft.com/library/azure/dn835031.aspx) (Справочник по API-интерфейсу REST для управления Stream Analytics)</span><span class="sxs-lookup"><span data-stu-id="785c3-154">[Stream Analytics management REST API reference](https://msdn.microsoft.com/library/azure/dn835031.aspx)</span></span>