---
title: "Обработка порядка событий и просрочки с помощью Azure Stream Analytics | Документация Майкрософт"
description: "Узнайте об обработке неупорядоченных или поздних событий в потоках данных Stream Analytics."
keywords: "не по порядку, поздний, события"
documentationcenter: 
services: stream-analytics
author: jseb225
manager: jhubbard
editor: cgronlun
ms.assetid: 
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 04/20/2017
ms.author: jeanb
ms.openlocfilehash: 71929b449f2a0fa55327fd3f9741208506859e85
ms.sourcegitcommit: 0e4491b7fdd9ca4408d5f2d41be42a09164db775
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/14/2017
---
# <a name="azure-stream-analytics-event-order-considerations"></a>Вопросы порядок событий Azure Stream Analytics

## <a name="arrival-time-and-application-time"></a>Время прибытия и время приложения

В темпоральных данных поток событий каждое событие присваивается отметка времени. Azure Stream Analytics присваивает отметки времени каждого события с помощью либо прибытия времени или времени приложения. **System.Timestamp** столбец имеет отметку времени, присвоенный событию. 

Время получения присваивается в источнике входных данных, когда событие достигает источника. Время прибытия доступны с помощью **EventEnqueuedTime** свойство для входных данных концентратора событий и с помощью [BlobProperties.LastModified](https://docs.microsoft.com/dotnet/api/microsoft.windowsazure.storage.blob.blobproperties.lastmodified?view=azurestorage-8.1.3) свойство для входных данных большого двоичного объекта. 

Время приложения назначается, когда это событие формируется, и он является частью полезной нагрузки. Чтобы обработать события по времени приложения, используйте **Timestamp,** предложение в запросе select. Если **Timestamp,** предложение отсутствует, обрабатываются времени прибытия. 

Azure Stream Analytics выводятся данные в том порядке, отметку времени и содержит параметры, имеют дело с данными из внеочередной.


## <a name="handling-of-multiple-streams"></a>Обработка нескольких потоков

Задание Azure Stream Analytics объединяет события из нескольких временных шкал в случаях, таких как следующие:

* Создание выходных данных из нескольких разделов. Запросы, которые не имеют явно **секции по идентификатору PartitionId** предложения необходимо объединять события из всех секций.
* Объединение двух или более различных источников входных данных.
* Присоединение источников входных данных.

В сценариях, где объединяются несколько временных шкал, Azure Stream Analytics выводятся данные метку времени *t1* только после того, что все источники, которые были объединены по крайней мере, во время *t1*. Например предположим, что запрос считывает из секции концентратора событий с двумя разделами. Одна из секций, *P1*, имеет только во время событий *t1*. Другой раздел *P2*, имеет только во время событий *t1 + x*. Затем выводятся только во время *t1*. Однако если явно указывается **секции по идентификатору PartitionId** предложение, обе секции хода выполнения независимо друг от друга.

Параметр позднего погрешностью прибытия используется для работы с отсутствия данных в некоторых секций.

## <a name="configuring-late-arrival-tolerance-and-out-of-order-tolerance"></a>Настройка позднего отклонение прибытия и отклонение от внеочередной
С неупорядоченными входными потоками происходит одно из следующих событий:
* Сортировка (и, таким образом отложенной)
* Настраивается системой, согласно пользовательской политики

Stream Analytics допускает позднего и из неупорядоченные события при обработке по времени приложения. Следующие параметры доступны в **воспроизведении порядок возникновения событий** параметр на портале Azure: 

![Обработка событий Stream Analytics](media/stream-analytics-event-handling/stream-analytics-event-handling.png)

### <a name="late-arrival-tolerance"></a>Позднее прибытия отклонения
Позднее отклонения прибытия применяется только в том случае, если вы обработки времени приложения. В противном случае учитывается.

Позднее допустимый прибытия — Максимальная разница между время прибытия и время приложения. Если событие поступает позже, чем позднего прибытия погрешность (например, время приложения *app_t* < время прибытия *arr_t* -позднего допуска политики прибытия *late_t*), событие будет настроена и более поздним погрешность прибытия (*arr_t* - *late_t*). Окно позднего прибытия представляет максимальную задержку между созданием события и получения события с источника входных данных. 

При объединении нескольких секций из одного входного потока или несколько входных потоков позднего допустимый прибытия — максимальное время ожидания каждой секции для новых данных. 

Коррекция на основе допустимых позднего прибытия произойдет раньше. Коррекция на основе допустимых из внеочередной происходит дальше. **System.Timestamp** столбец имеет метку в последний раз, присвоенный событию.

### <a name="out-of-order-tolerance"></a>Out заказах
События, которые не по порядку, но в пределах задать период ожидания заказах переупорядочиваются штампом времени. Либо доступны следующие события, поступающие в более поздней версии, чем временной интервал.
* **Корректировка** предполагает изменение значения времени к крайнему допустимому. 
* **Удаление** предполагает удаление.

Когда Stream Analytics изменяет порядок событий, полученных в пределах периода ожидания заказах, период ожидания заказах откладывается выходных данных запроса.

### <a name="example"></a>Пример

* Допустимый интервал поступления с задержкой = 10 минут.<br/>
* Out заказах = 3 минуты<br/>
* Обработка по времени приложения<br/>
* События:
   1. **Время приложения** = 00:00:00 **время прибытия** = 00:10:01 **System.Timestamp** = 00:00:01, скорректирована, поскольку (**время прибытия — время приложения**) — более поздним погрешность прибытия.
   2. **Время приложения** = 00:00:01 **время прибытия** = 00:10:01 **System.Timestamp** = 00:00:01, не изменяется, так как время приложения в окне прибытия позднее.
   3. **Время приложения** = 00:10:00 **время прибытия** = 00:10:02 **System.Timestamp** = 00:10:00, не изменяется, так как время приложения в окне прибытия позднее.
   4. **Время приложения** = 00:09:00 **время прибытия** = 00:10:03 **System.Timestamp** = 00:09:00, принимается исходное отметку времени, поскольку время приложения находится в пределах вне порядка отклонения.
   5. **Время приложения** = 00:06:00 **время прибытия** = 00:10:04 **System.Timestamp** = 00:07:00, скорректирована, поскольку время приложения старее, чем допустимое значение из внеочередной.

### <a name="practical-considerations"></a>Практические рекомендации
Как упоминалось ранее, позднее допустимый прибытия — Максимальная разница между во время прибытия и приложения. При обработки времени приложения событий, которые являются более поздней, чем настроенный допуск позднего прибытия корректируются до применения параметра out заказах. Таким образом действующим по порядку является минимальным позднего отклонения прибытия и ожидания заказах.

Возможные причины из неупорядоченные события в потоке.
* Синхронизирующих импульсов среди отправителей.
* Переменной задержка между отправителем и источник входных событий.

Для позднего прибытия причины.
* Отправители пакетной обработки и отправки событий для интервала позже, после интервала.
* Задержка между событием отправителем отправку и получение событий с источника входных данных.

При настройке позднего отклонение прибытия и отклонение от внеочередной для конкретного задания, рассмотрите возможность правильность, требованиями к задержке и перечисленных выше факторов.

Ниже приведено несколько примеров.

#### <a name="example-1"></a>Пример 1 
Если запрос обладает **секции по идентификатору PartitionId** предложения. В одной секции события отправляются посредством методов синхронной отправки. Синхронные методы отправки блокируются до тех пор, пока события не будут отправлены.

В этом случае по порядку равно нулю, так как отправка событий в порядке явного подтверждения перед отправкой следующего события. Позднее прибытия имеет максимальную задержку между события создания и отправки события, а также максимальную задержку между отправителем и источника входных данных.

#### <a name="example-2"></a>Пример 2
Если запрос обладает **секции по идентификатору PartitionId** предложения. В одной секции события отправляются через методы асинхронной отправки. Методы асинхронной отправки может инициировать несколько отправляет одновременно, это может привести к ожидания неупорядоченных событий.

В этом случае прибытия по порядку и позднее не менее максимальную задержку между события создания и отправки события, а также максимальную задержку между отправителем и источника входных данных.

#### <a name="example-3"></a>Пример 3
Запрос не имеет **секции по идентификатору PartitionId** предложения, и имеется по крайней мере два раздела.

Настраивается так же, как пример 2. Однако отсутствия данных в один из разделов можно отложить дополнительных наступивших выходные данные.

## <a name="handling-event-producers-with-differing-timelines"></a>Обработка производителей событий с различных временных шкал
В одном потоке входных часто содержит события, поступающие от нескольких производителей событий, таких как отдельных устройств. Эти события могут приходить в неправильном порядке из-за причин, рассмотренных. В этих сценариях несмотря на то, что нарушена через производителей событий может быть большим, нарушена в рамках событий из одного производителя small (или даже несуществующей).

Azure Stream Analytics предоставляет общие механизмы обработки ожидания неупорядоченных событий. Такие механизмы результат в задержки (время ожидания для straggling событий для доступа в системе), удалены или же события, или оба.

Еще во многих сценариях нужный запрос обрабатывает события из разных производителями независимо друг от друга. Например он агрегирование событий для каждого окна на устройство. В этом случае нет необходимости отложить выхода, который соответствует производитель одно событие во время ожидания других производителей событий производительности. Другими словами нет необходимости работать с отклонения во времени между производителями. Его можно пропустить.

Конечно это означает, что сами события вывода порядке по отношению к их отметки времени. Подчиненные потребитель должен уметь работать с таким поведением. Но каждое событие в выходных данных указано правильно.

Azure Stream Analytics реализует эту функцию с помощью [TIMESTAMP BY OVER](https://msdn.microsoft.com/library/azure/mt573293.aspx) предложения.

## <a name="summary"></a>Сводка
* Настройте позднее прибытия отказоустойчивость и неупорядоченные из окна на основе правильность и требованиями к задержке. Также рассмотрите способа отправки события.
* Корпорация Майкрософт рекомендует out заказах меньше позднего прибытия отклонения.
* При объединении нескольких временных шкал, отсутствие данных в одном из источников данных или секции можно задержать дополнительных наступивших выходные данные.

## <a name="get-help"></a>Получение справки
Для получения дополнительной помощи повторите [форум Azure Stream Analytics](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics).

## <a name="next-steps"></a>Дальнейшие действия
* [Что такое Stream Analytics?](stream-analytics-introduction.md)
* [Приступая к работе с Azure Stream Analytics: выявление мошенничества в режиме реального времени](stream-analytics-real-time-fraud-detection.md)
* [Масштабирование заданий Azure Stream Analytics для повышения пропускной способности базы данных](stream-analytics-scale-jobs.md)
* [Stream Analytics Query Language Reference](https://msdn.microsoft.com/library/azure/dn834998.aspx) (Справочник по языку запросов Stream Analytics)
* [Stream Analytics management REST API reference](https://msdn.microsoft.com/library/azure/dn835031.aspx) (Справочник по API-интерфейсу REST для управления Stream Analytics)
