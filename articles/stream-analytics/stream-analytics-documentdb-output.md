---
title: "выходные данные aaaJSON для Stream Analytics | Документы Microsoft"
description: "Сведения о том, каким образом Stream Analytics направляет данные из Azure Cosmos DB в формат JSON и позволяет архивировать данные и уменьшать задержки запросов в отношении неструктурированных данных JSON."
keywords: "Выходные данные JSON"
documentationcenter: 
services: stream-analytics,documentdb
author: samacha
manager: jhubbard
editor: cgronlun
ms.assetid: 5d2a61a6-0dbf-4f1b-80af-60a80eb25dd1
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: samacha
ms.openlocfilehash: fa717818c839ecd7a60fcee33d22011990fd5878
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="target-azure-cosmos-db-for-json-output-from-stream-analytics"></a><span data-ttu-id="414b3-104">Направление Azure Cosmos DB из Stream Analytics в формат JSON</span><span class="sxs-lookup"><span data-stu-id="414b3-104">Target Azure Cosmos DB for JSON output from Stream Analytics</span></span>
<span data-ttu-id="414b3-105">Stream Analytics позволяет направлять данные из [Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/) в формат JSON, позволяя архивировать данные и уменьшать задержки запросов в отношении неструктурированных данных JSON.</span><span class="sxs-lookup"><span data-stu-id="414b3-105">Stream Analytics can target [Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/) for JSON output, enabling data archiving and low-latency queries on unstructured JSON data.</span></span> <span data-ttu-id="414b3-106">В этом документе представлены некоторые рекомендации по реализации данной конфигурации.</span><span class="sxs-lookup"><span data-stu-id="414b3-106">This document covers some best practices for implementing this configuration.</span></span>

<span data-ttu-id="414b3-107">Для тех, кто не знаком с Cosmos DB, взгляните на [план обучения Azure Cosmos DB](https://azure.microsoft.com/documentation/learning-paths/documentdb/) tooget работы.</span><span class="sxs-lookup"><span data-stu-id="414b3-107">For those who are unfamiliar with Cosmos DB, take a look at [Azure Cosmos DB’s learning path](https://azure.microsoft.com/documentation/learning-paths/documentdb/) tooget started.</span></span> 

<span data-ttu-id="414b3-108">Примечание. Коллекции Cosmos DB, использующие API-интерфейсы Mongo DB, пока не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="414b3-108">Note: Mongo DB API based Cosmos DB collections is currently not supported.</span></span> 

## <a name="basics-of-cosmos-db-as-an-output-target"></a><span data-ttu-id="414b3-109">Основные сведения о Cosmos DB как объекте вывода данных</span><span class="sxs-lookup"><span data-stu-id="414b3-109">Basics of Cosmos DB as an output target</span></span>
<span data-ttu-id="414b3-110">Hello Azure Cosmos DB выходные данные в Stream Analytics включает записи потока обработки результатов в качестве выходных данных JSON в вашей Cosmos DB коллекций.</span><span class="sxs-lookup"><span data-stu-id="414b3-110">hello Azure Cosmos DB output in Stream Analytics enables writing your stream processing results as JSON output into your Cosmos DB collection(s).</span></span> <span data-ttu-id="414b3-111">Stream Analytics не создавать коллекции в базе данных, вместо необходимости toocreate их заранее.</span><span class="sxs-lookup"><span data-stu-id="414b3-111">Stream Analytics does not create collections in your database, instead requiring you toocreate them upfront.</span></span> <span data-ttu-id="414b3-112">Это так, чтобы hello выставления счетов затраты коллекций Cosmos DB прозрачный tooyou и hello, можно настроить производительность hello, согласованности и емкость непосредственно с помощью коллекций [API-интерфейсы DB Cosmos](https://msdn.microsoft.com/library/azure/dn781481.aspx).</span><span class="sxs-lookup"><span data-stu-id="414b3-112">This is so that hello billing costs of Cosmos DB collections are transparent tooyou, and so that you can tune hello performance, consistency and capacity of your collections directly using hello [Cosmos DB APIs](https://msdn.microsoft.com/library/azure/dn781481.aspx).</span></span> <span data-ttu-id="414b3-113">Рекомендуется использовать одну базу данных DB Cosmos каждого отдельного toologically задания потоковой передачи коллекций для потокового задания.</span><span class="sxs-lookup"><span data-stu-id="414b3-113">We recommend using one Cosmos DB Database per streaming job toologically separate your collections for a streaming job.</span></span>

<span data-ttu-id="414b3-114">Ниже описаны некоторые из параметров коллекции Cosmos DB hello.</span><span class="sxs-lookup"><span data-stu-id="414b3-114">Some of hello Cosmos DB collection options are detailed below.</span></span>

## <a name="tune-consistency-availability-and-latency"></a><span data-ttu-id="414b3-115">Настройка согласованности, доступности и задержки</span><span class="sxs-lookup"><span data-stu-id="414b3-115">Tune consistency, availability, and latency</span></span>
<span data-ttu-id="414b3-116">toomatch требований приложения Cosmos DB позволяет toofine настраивать hello база данных коллекций и сделать компромисс между согласованности, доступность и задержки.</span><span class="sxs-lookup"><span data-stu-id="414b3-116">toomatch your application requirements, Cosmos DB allows you toofine tune hello database and collections and make trade-offs between consistency, availability and latency.</span></span> <span data-ttu-id="414b3-117">В зависимости от того, какие уровни согласованности чтения потребуются вашему сценарию для чтения и записи задержки, вы можете выбирать уровень согласованности в своей учетной записи базы данных.</span><span class="sxs-lookup"><span data-stu-id="414b3-117">Depending on what levels of read consistency your scenario needs against read and write latency, you can choose a consistency level on your database account.</span></span> <span data-ttu-id="414b3-118">По умолчанию Cosmos DB позволяет синхронной индексирования в каждой коллекции tooyour операции CRUD.</span><span class="sxs-lookup"><span data-stu-id="414b3-118">Also by default, Cosmos DB enables synchronous indexing on each CRUD operation tooyour collection.</span></span> <span data-ttu-id="414b3-119">Это другой параметр полезно toocontrol hello чтения/записи производительности в базу данных, Cosmos.</span><span class="sxs-lookup"><span data-stu-id="414b3-119">This is another useful option toocontrol hello write/read performance in Cosmos DB.</span></span> <span data-ttu-id="414b3-120">Сведения по этой теме можно найти hello [изменить уровни согласованности вашей базы данных и запрос](../documentdb/documentdb-consistency-levels.md) статьи.</span><span class="sxs-lookup"><span data-stu-id="414b3-120">For further information on this topic, review hello [change your database and query consistency levels](../documentdb/documentdb-consistency-levels.md) article.</span></span>

## <a name="upserts-from-stream-analytics"></a><span data-ttu-id="414b3-121">Вставка и обновление Upsert в Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="414b3-121">Upserts from Stream Analytics</span></span>
<span data-ttu-id="414b3-122">Stream Analytics интеграция с Cosmos DB позволяет tooinsert или обновления записей в Cosmos DB коллекции на основе данного столбца Идентификаторов документов.</span><span class="sxs-lookup"><span data-stu-id="414b3-122">Stream Analytics integration with Cosmos DB allows you tooinsert or update records in your Cosmos DB collection based on a given Document ID column.</span></span> <span data-ttu-id="414b3-123">Это также назывались tooas *Upsert*.</span><span class="sxs-lookup"><span data-stu-id="414b3-123">This is also referred tooas an *Upsert*.</span></span>

<span data-ttu-id="414b3-124">Stream Analytics использует оптимистичный подход Upsert, где обновления только выполняется, когда операция вставки завершается неудачно из-за конфликта tooa идентификатор документа.</span><span class="sxs-lookup"><span data-stu-id="414b3-124">Stream Analytics utilizes an optimistic Upsert approach, where updates are only done when insert fails due tooa Document ID conflict.</span></span> <span data-ttu-id="414b3-125">Это обновление выполняется Stream Analytics как обновления, поэтому он позволяет частичных обновлений toohello документа, т. е. Добавление новых свойств или замены существующего свойства выполняется последовательно.</span><span class="sxs-lookup"><span data-stu-id="414b3-125">This update is performed by Stream Analytics as a PATCH, so it enables partial updates toohello document, i.e. addition of new properties or replacing an existing property is performed incrementally.</span></span> <span data-ttu-id="414b3-126">Обратите внимание, что изменения в значения свойств массива в документе JSON hello привести ко всему массиву hello перезаписаны начало массива hello т. е. не объединяются.</span><span class="sxs-lookup"><span data-stu-id="414b3-126">Note that changes in hello values of array properties in your JSON document result in hello entire array getting overwritten, i.e. hello array is not merged.</span></span>

## <a name="data-partitioning-in-cosmos-db"></a><span data-ttu-id="414b3-127">Секционирование данных в Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="414b3-127">Data partitioning in Cosmos DB</span></span>
<span data-ttu-id="414b3-128">Cosmos DB [секционированных коллекций](../cosmos-db/partition-data.md) являются hello рекомендованный подход для секционирования данных.</span><span class="sxs-lookup"><span data-stu-id="414b3-128">Cosmos DB [partitioned collections](../cosmos-db/partition-data.md) are hello recommended approach for partitioning your data.</span></span> 

<span data-ttu-id="414b3-129">Для одной коллекции Cosmos DB Stream Analytics по-прежнему можно toopartition данных основании шаблонов запросов hello и требованиям к производительности приложения.</span><span class="sxs-lookup"><span data-stu-id="414b3-129">For single Cosmos DB collections, Stream Analytics still allows you toopartition your data based on both hello query patterns and performance needs of your application.</span></span> <span data-ttu-id="414b3-130">Каждая коллекция может содержать вверх too10GB данных (максимум) и в настоящее время нет не tooscale способом копирования (или переполнение) коллекции.</span><span class="sxs-lookup"><span data-stu-id="414b3-130">Each collection may contain up too10GB of data (maximum) and currently there is no way tooscale up (or overflow) a collection.</span></span> <span data-ttu-id="414b3-131">Для горизонтального масштабирования, Stream Analytics позволяет toowrite toomultiple коллекции с заданным префиксом (см. сведения об использовании ниже).</span><span class="sxs-lookup"><span data-stu-id="414b3-131">For scaling out, Stream Analytics allows you toowrite toomultiple collections with a given prefix (see usage details below).</span></span> <span data-ttu-id="414b3-132">Stream Analytics использует согласованные hello [распознавателя раздела хэш](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) стратегию на основе пользовательского hello предоставленный toopartition столбца PartitionKey ее записи выходных данных.</span><span class="sxs-lookup"><span data-stu-id="414b3-132">Stream Analytics uses hello consistent [Hash Partition Resolver](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) strategy based on hello user provided PartitionKey column toopartition its output records.</span></span> <span data-ttu-id="414b3-133">Hello количество коллекций с hello, предоставленных во время запуска задания потоковой передачи hello префикс используется в качестве количество разделов выходного hello, задание hello toowhich записывает параллельного tooin (коллекции Cosmos DB = секций выходных данных).</span><span class="sxs-lookup"><span data-stu-id="414b3-133">hello number of collections with hello given prefix at hello streaming job’s start time is used as hello output partition count, toowhich hello job writes tooin parallel (Cosmos DB Collections = Output Partitions).</span></span> <span data-ttu-id="414b3-134">Можно предположить, что для одной коллекции с отложенным индексированием, в которой выполняются только операции вставки, пропускная способность записи составит приблизительно 0,4 МБ/с.</span><span class="sxs-lookup"><span data-stu-id="414b3-134">For a single collection with lazy indexing doing only inserts, about 0.4 MB/s write throughput can be expected.</span></span> <span data-ttu-id="414b3-135">Используется несколько коллекций можно разрешить, вы tooachieve более высокую пропускную способность и расширенные возможности.</span><span class="sxs-lookup"><span data-stu-id="414b3-135">Using multiple collections can allow you tooachieve higher throughput and increased capacity.</span></span>

<span data-ttu-id="414b3-136">Если количество разделов tooincrease hello в будущем hello, может потребоваться toostop должностных обязанностей, repartition hello данные из существующих коллекций в новые коллекции, а затем перезапустите задание Stream Analytics hello.</span><span class="sxs-lookup"><span data-stu-id="414b3-136">If you intend tooincrease hello partition count in hello future, you may need toostop your job, repartition hello data from your existing collections into new collections and then restart hello Stream Analytics job.</span></span> <span data-ttu-id="414b3-137">В следующую публикацию будут включены дополнительные сведения об использовании PartitionResolver и перераспределении, а также образец программного кода.</span><span class="sxs-lookup"><span data-stu-id="414b3-137">More details on using PartitionResolver and re-partitioning along with sample code, will be included in a follow-up post.</span></span> <span data-ttu-id="414b3-138">статья Hello [секционирование и масштабирование в Cosmos DB](../documentdb/documentdb-partition-data.md) также предоставляет подробные сведения об этом.</span><span class="sxs-lookup"><span data-stu-id="414b3-138">hello article [Partitioning and scaling in Cosmos DB](../documentdb/documentdb-partition-data.md) also provides details on this.</span></span>

## <a name="cosmos-db-settings-for-json-output"></a><span data-ttu-id="414b3-139">Параметры Cosmos DB для выходных данных JSON</span><span class="sxs-lookup"><span data-stu-id="414b3-139">Cosmos DB settings for JSON output</span></span>
<span data-ttu-id="414b3-140">При создании Cosmos DB как средства обработки выходных данных в Stream Analytics создается запрос информации, показанный ниже.</span><span class="sxs-lookup"><span data-stu-id="414b3-140">Creating Cosmos DB as an output in Stream Analytics generates a prompt for information as seen below.</span></span> <span data-ttu-id="414b3-141">В этом разделе объясняется hello определения свойства.</span><span class="sxs-lookup"><span data-stu-id="414b3-141">This section provides an explanation of hello properties definition.</span></span>

<span data-ttu-id="414b3-142">Секционированная коллекция</span><span class="sxs-lookup"><span data-stu-id="414b3-142">Partitioned Collection</span></span> | <span data-ttu-id="414b3-143">Несколько односекционных коллекций</span><span class="sxs-lookup"><span data-stu-id="414b3-143">Multiple “Single Partition” collections</span></span>
---|---
![экран выходных данных documentdb stream analytics](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-1.png) |  ![экран выходных данных documentdb stream analytics](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-2.png)


  
> [!NOTE]
> <span data-ttu-id="414b3-146">Hello **несколько коллекций «Одна секция»** сценария требуется ключ секции и поддерживаемой конфигурацией.</span><span class="sxs-lookup"><span data-stu-id="414b3-146">hello **Multiple “Single Partition” collections** scenario requires a partition key and is a supported configuration.</span></span> 

* <span data-ttu-id="414b3-147">**Псевдоним вывода** — псевдоним toorefer эти выходные данные в запросе ASA</span><span class="sxs-lookup"><span data-stu-id="414b3-147">**Output Alias** – An alias toorefer this output in your ASA query</span></span>  
* <span data-ttu-id="414b3-148">**Имя учетной записи** — имя hello или конечной точки URI hello Cosmos DB учетной записи.</span><span class="sxs-lookup"><span data-stu-id="414b3-148">**Account Name** – hello name or endpoint URI of hello Cosmos DB account.</span></span>  
* <span data-ttu-id="414b3-149">**Ключ учетной записи** — hello общий ключ доступа для hello Cosmos DB учетной записи.</span><span class="sxs-lookup"><span data-stu-id="414b3-149">**Account Key** – hello shared access key for hello Cosmos DB account.</span></span>  
* <span data-ttu-id="414b3-150">**База данных** — имя базы данных Cosmos DB hello.</span><span class="sxs-lookup"><span data-stu-id="414b3-150">**Database** – hello Cosmos DB database name.</span></span>  
* <span data-ttu-id="414b3-151">**Шаблон имени коллекции** — имя коллекции hello или их шаблон для hello коллекций toobe используется.</span><span class="sxs-lookup"><span data-stu-id="414b3-151">**Collection Name Pattern** – hello collection name or their pattern for hello collections toobe used.</span></span> <span data-ttu-id="414b3-152">формат имени коллекции Hello могут создаваться с помощью hello необязательного токена {partition}, где отсчет разделов начинается с 0.</span><span class="sxs-lookup"><span data-stu-id="414b3-152">hello collection name format can be constructed using hello optional {partition} token, where partitions start from 0.</span></span> <span data-ttu-id="414b3-153">Далее приведены примеры допустимых входных данных:</span><span class="sxs-lookup"><span data-stu-id="414b3-153">Following are sample valid inputs:</span></span>  
  <span data-ttu-id="414b3-154">1\) MyCollection — должна существовать одна коллекция с именем MyCollection;</span><span class="sxs-lookup"><span data-stu-id="414b3-154">1\) MyCollection – One collection named “MyCollection” must exist.</span></span>  
  <span data-ttu-id="414b3-155">2\) MyCollection{partition} — должны существовать такие коллекции: MyCollection0, MyCollection1, MyCollection2 и т. д.</span><span class="sxs-lookup"><span data-stu-id="414b3-155">2\) MyCollection{partition} – Such collections must exist– "MyCollection0”, “MyCollection1”, “MyCollection2” and so on.</span></span>  
* <span data-ttu-id="414b3-156">**Partition Key** — необязательно.</span><span class="sxs-lookup"><span data-stu-id="414b3-156">**Partition Key** – Optional.</span></span> <span data-ttu-id="414b3-157">Требуется, только если в шаблоне имени коллекции используется маркер {partition}.</span><span class="sxs-lookup"><span data-stu-id="414b3-157">This is only needed if you are using a {parition} token in your collection name pattern.</span></span> <span data-ttu-id="414b3-158">Имя Hello hello поля в выходных данных событий, которые используются toospecify hello ключа выходных данных секционирования в коллекциях.</span><span class="sxs-lookup"><span data-stu-id="414b3-158">hello name of hello field in output events used toospecify hello key for partitioning output across collections.</span></span> <span data-ttu-id="414b3-159">Для выходных данных одной коллекции можно использовать любой столбец произвольных выходных данных, например PartitionId.</span><span class="sxs-lookup"><span data-stu-id="414b3-159">For single collection output, any arbitrary output column can be used e.g. PartitionId.</span></span>  
* <span data-ttu-id="414b3-160">**Document ID** — необязательно.</span><span class="sxs-lookup"><span data-stu-id="414b3-160">**Document ID** – Optional.</span></span> <span data-ttu-id="414b3-161">Имя Hello hello поля в исходящих событиях, используемое toospecify hello первичный ключ на какие insert или update основаны операции.</span><span class="sxs-lookup"><span data-stu-id="414b3-161">hello name of hello field in output events used toospecify hello primary key on which insert or update operations are based.</span></span>  
