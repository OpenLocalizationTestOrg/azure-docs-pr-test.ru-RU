---
title: "Масштабирование задания с помощью функций Azure Stream Analytics и Машинного обучения Azure | Документация Майкрософт"
description: "Узнайте, как правильно масштабировать задания Stream Analytics (секционирование, количество SU и т. д.) при использовании функций машинного обучения Azure."
keywords: 
documentationcenter: 
services: stream-analytics
author: jeffstokes72
manager: jhubbard
editor: cgronlun
ms.assetid: 47ce7c5e-1de1-41ca-9a26-b5ecce814743
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: jeffstok
ms.openlocfilehash: 5e07e4efcd14cd8c12124cb34058ef6c345f7f47
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="scale-your-stream-analytics-job-with-azure-machine-learning-functions"></a><span data-ttu-id="fcd48-103">Масштабирование заданий Stream Analytics с помощью функций машинного обучения Azure</span><span class="sxs-lookup"><span data-stu-id="fcd48-103">Scale your Stream Analytics job with Azure Machine Learning functions</span></span>
<span data-ttu-id="fcd48-104">В большинстве случаев настроить задание Stream Analytics и запустить демонстрационные данные можно без особых усилий.</span><span class="sxs-lookup"><span data-stu-id="fcd48-104">It is often quite easy to set up an Stream Analytics job and run some sample data through it.</span></span> <span data-ttu-id="fcd48-105">А что делать, если необходимо выполнить то же задание с большим объемом данных?</span><span class="sxs-lookup"><span data-stu-id="fcd48-105">What should we do when we need to run the same job with higher data volume?</span></span> <span data-ttu-id="fcd48-106">Мы должны разобраться, как настроить задание Stream Analytics таким образом, чтобы его можно было масштабировать.</span><span class="sxs-lookup"><span data-stu-id="fcd48-106">It requires us to understand how to configure the Stream Analytics job so that it will scale.</span></span> <span data-ttu-id="fcd48-107">В этом документе основное внимание уделено специфическим аспектам масштабирования заданий Stream Analytics с помощью функций машинного обучения.</span><span class="sxs-lookup"><span data-stu-id="fcd48-107">In this document, we will focus on the special aspects of scaling Stream Analytics jobs with Machine Learning functions.</span></span> <span data-ttu-id="fcd48-108">Общие сведения о масштабировании заданий Stream Analytics см. в статье [Масштабирование заданий](stream-analytics-scale-jobs.md).</span><span class="sxs-lookup"><span data-stu-id="fcd48-108">For information on how to scale Stream Analytics jobs in general see the article [Scaling jobs](stream-analytics-scale-jobs.md).</span></span>

## <a name="what-is-an-azure-machine-learning-function-in-stream-analytics"></a><span data-ttu-id="fcd48-109">Что такое функция машинного обучения Azure в Stream Analytics?</span><span class="sxs-lookup"><span data-stu-id="fcd48-109">What is an Azure Machine Learning function in Stream Analytics?</span></span>
<span data-ttu-id="fcd48-110">Функция машинного обучения в Stream Analytics может использоваться как обычный вызов функции в языке запросов Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="fcd48-110">A Machine Learning function in Stream Analytics can be used like a regular function call in the Stream Analytics query language.</span></span> <span data-ttu-id="fcd48-111">На самом же деле вызовы функций являются запросами веб-службы машинного обучения Azure.</span><span class="sxs-lookup"><span data-stu-id="fcd48-111">However, behind the scene, the function calls are actually Azure Machine Learning Web Service requests.</span></span> <span data-ttu-id="fcd48-112">Веб-службы машинного обучения поддерживают пакетную обработку нескольких строк (которые называются мини-пакетом) в одном вызове API веб-службы, что способствует повышению общей пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="fcd48-112">Machine Learning web services support “batching” multiple rows, which is called mini-batch, in the same web service API call, to improve overall throughput.</span></span> <span data-ttu-id="fcd48-113">Дополнительные сведения можно найти в следующих статьях: [Функции машинного обучения Azure в Stream Analytics](https://blogs.technet.microsoft.com/machinelearning/2015/12/10/azure-ml-now-available-as-a-function-in-azure-stream-analytics/) и [Веб-службы машинного обучения Azure](../machine-learning/machine-learning-consume-web-services.md).</span><span class="sxs-lookup"><span data-stu-id="fcd48-113">Please see the following articles for more details; [Azure Machine Learning functions in Stream Analytics](https://blogs.technet.microsoft.com/machinelearning/2015/12/10/azure-ml-now-available-as-a-function-in-azure-stream-analytics/) and [Azure Machine Learning Web Services](../machine-learning/machine-learning-consume-web-services.md).</span></span>

## <a name="configure-a-stream-analytics-job-with-machine-learning-functions"></a><span data-ttu-id="fcd48-114">Настройка задания Stream Analytics с помощью функций машинного обучения</span><span class="sxs-lookup"><span data-stu-id="fcd48-114">Configure a Stream Analytics job with Machine Learning functions</span></span>
<span data-ttu-id="fcd48-115">При настройке функции машинного обучения для задания Stream Analytics необходимо учитывать два параметра: размер пакета, содержащего вызов функции машинного обучения, и количество единиц потоковой передачи (SU), подготовленных для задания Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="fcd48-115">When configuring a Machine Learning function for Stream Analytics job, there are two parameters to consider, the batch size of the Machine Learning function calls, and the streaming units (SUs) provisioned for the Stream Analytics job.</span></span> <span data-ttu-id="fcd48-116">Чтобы определить соответствующие значения для этих параметров, сначала нужно решить, что для вас приоритетнее — задержка или пропускная способность (задержка задания Stream Analytics или пропускная способность каждой единицы потоковой передачи).</span><span class="sxs-lookup"><span data-stu-id="fcd48-116">To determine the appropriate values for these, first a decision must be made between latency and throughput, that is, latency of the Stream Analytics job, and throughput of each SU.</span></span> <span data-ttu-id="fcd48-117">К заданию всегда можно добавить SU для увеличения пропускной способности оптимально секционированного запроса Stream Analytics, хотя дополнительные единицы SU увеличивают стоимость выполнения задания.</span><span class="sxs-lookup"><span data-stu-id="fcd48-117">SUs may always be added to a job to increase throughput of a well partitioned Stream Analytics query, although additional SUs increases the cost of running the job.</span></span>

<span data-ttu-id="fcd48-118">Поэтому важно определить *допустимую* задержку при выполнении задания Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="fcd48-118">Therefore it is important to determine the *tolerance* of latency in running a Stream Analytics job.</span></span> <span data-ttu-id="fcd48-119">Задержка выполнения запросов службы машинного обучения Azure естественным образом увеличивается вместе с размером пакета, что приводит к увеличению задержки задания Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="fcd48-119">Additional latency from running Azure Machine Learning service requests will naturally increase with batch size, which will compound the latency of the Stream Analytics job.</span></span> <span data-ttu-id="fcd48-120">С другой стороны, увеличение размера пакета позволяет заданиям Stream Analytics обрабатывать *больше событий с *тем же количеством* запросов веб-службы машинного обучения.</span><span class="sxs-lookup"><span data-stu-id="fcd48-120">On the other hand, increasing batch size allows the Stream Analytics job to process *more events with the *same number* of Machine Learning web service requests.</span></span> <span data-ttu-id="fcd48-121">Часто увеличение задержки веб-службы машинного обучения следует за увеличением размера пакета, поэтому важно определить наиболее экономичный размер пакета для веб-службы машинного обучения в той или иной ситуации.</span><span class="sxs-lookup"><span data-stu-id="fcd48-121">Often the increase of Machine Learning web service latency is sub-linear to the increase of batch size so it is important to consider the most cost-efficient batch size for a Machine Learning web service in any given situation.</span></span> <span data-ttu-id="fcd48-122">По умолчанию размер пакета для запросов веб-службы равен 1000. Для изменения этого значения можно использовать [REST API Stream Analytics](https://msdn.microsoft.com/library/mt653706.aspx "REST API Stream Analytics") или [Клиент PowerShell для Stream Analytics](stream-analytics-monitor-and-manage-jobs-use-powershell.md "Клиент PowerShell для Stream Analytics").</span><span class="sxs-lookup"><span data-stu-id="fcd48-122">The default batch size for the web service requests is 1000 and may be modified either by using the [Stream Analytics REST API](https://msdn.microsoft.com/library/mt653706.aspx "Stream Analytics REST API") or the [PowerShell client for Stream Analytics](stream-analytics-monitor-and-manage-jobs-use-powershell.md "PowerShell client for Stream Analytics").</span></span>

<span data-ttu-id="fcd48-123">Определив размер пакета, можно определить количество единиц потоковой передачи в зависимости от количества событий, которые функция должна обрабатывать в секунду.</span><span class="sxs-lookup"><span data-stu-id="fcd48-123">Once a batch size has been determined, the amount of streaming units (SUs) can be determined, based on the number of events that the function needs to process per second.</span></span> <span data-ttu-id="fcd48-124">Дополнительные сведения о единицах потоковой передачи см. в статье [Масштабирование заданий Azure Stream Analytics для повышения пропускной способности базы данных](stream-analytics-scale-jobs.md).</span><span class="sxs-lookup"><span data-stu-id="fcd48-124">For more information about streaming units, see [Stream Analytics scale jobs](stream-analytics-scale-jobs.md).</span></span>

<span data-ttu-id="fcd48-125">Как правило, на каждые 6 SU приходится 20 одновременных подключений к веб-службе машинного обучения, за исключением того, что задания с 1 SU и 3 SU также получат 20 одновременных подключений.</span><span class="sxs-lookup"><span data-stu-id="fcd48-125">In general, there are 20 concurrent connections to the Machine Learning web service for every 6 SUs, except that 1 SU jobs and 3 SU jobs will get 20 concurrent connections also.</span></span>  <span data-ttu-id="fcd48-126">Например, если скорость передачи входных данных равна 200 000 событий в секунду и используется размер пакета по умолчанию (1000), в результате задержка веб-службы с мини-пакетом на 1000 событий будет составлять 200 мс.</span><span class="sxs-lookup"><span data-stu-id="fcd48-126">For example, if the input data rate is 200,000 events per second and the batch size is left to the default of 1000 the resulting web service latency with 1000 events mini-batch is 200ms.</span></span> <span data-ttu-id="fcd48-127">Это означает, что каждое подключение может отправлять в веб-службу машинного обучения 5 запросов в секунду.</span><span class="sxs-lookup"><span data-stu-id="fcd48-127">This means every connection can make 5 requests to the Machine Learning web service in a second.</span></span> <span data-ttu-id="fcd48-128">С 20 соединениями задание Stream Analytics может обрабатывать 20 000 событий за 200 мс и, соответственно, 100 000 событий в секунду.</span><span class="sxs-lookup"><span data-stu-id="fcd48-128">With 20 connections, the Stream Analytics job can process 20,000 events in 200ms  and therefore 100,000 events in a second.</span></span> <span data-ttu-id="fcd48-129">Таким образом, чтобы обрабатывать 200 000 событий в секунду, заданию Stream Analytics требуется 40 одновременных подключений, что соответствует 12 SU.</span><span class="sxs-lookup"><span data-stu-id="fcd48-129">So to process 200,000 events per second, the Stream Analytics job needs 40 concurrent connections, which comes out to 12 SUs.</span></span> <span data-ttu-id="fcd48-130">На следующей схеме показан запрос из задания Stream Analytics к конечной точке веб-службы машинного обучения. На каждые 6 SU приходится максимум 20 одновременных подключений к веб-службе машинного обучения.</span><span class="sxs-lookup"><span data-stu-id="fcd48-130">The diagram below illustrates the requests from the Stream Analytics job to the Machine Learning web service endpoint – Every 6 SUs has 20 concurrent connections to Machine Learning web service at max.</span></span>

<span data-ttu-id="fcd48-131">![Пример: масштабирование 2 заданий Stream Analytics с помощью функций машинного обучения](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-00.png "Пример: масштабирование 2 заданий Stream Analytics с помощью функций машинного обучения")</span><span class="sxs-lookup"><span data-stu-id="fcd48-131">![Scale Stream Analytics with Machine Learning Functions 2 job example](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-00.png "Scale Stream Analytics with Machine Learning Functions 2 job example")</span></span>

<span data-ttu-id="fcd48-132">В общем случае если ***B*** — размер пакета, а ***L*** — задержка веб-службы при размере пакета B в миллисекундах, пропускная способность задания Stream Analytics с ***N*** SU будет составлять:</span><span class="sxs-lookup"><span data-stu-id="fcd48-132">In general, ***B*** for batch size, ***L*** for the web service latency at batch size B in milliseconds, the throughput of an Stream Analytics job with ***N*** SUs is:</span></span>

<span data-ttu-id="fcd48-133">![Формула масштабирования Stream Analytics с использованием функций машинного обучения](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-02.png "Формула масштабирования Stream Analytics с использованием функций машинного обучения")</span><span class="sxs-lookup"><span data-stu-id="fcd48-133">![Scale Stream Analytics with Machine Learning Functions Formula](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-02.png "Scale Stream Analytics with Machine Learning Functions Formula")</span></span>

<span data-ttu-id="fcd48-134">Дополнительный параметр, который следует учитывать, — максимальное количество одновременных вызовов на стороне веб-службы машинного обучения. Для него рекомендуется задать максимальное значение (в настоящее время 200).</span><span class="sxs-lookup"><span data-stu-id="fcd48-134">An additional consideration may be the 'max concurrent calls' on the Machine Learning web service side, it’s recommended to set this to the maximum value (200 currently).</span></span>

<span data-ttu-id="fcd48-135">Дополнительные сведения об этом параметре см. в статье [Масштабирование веб-службы машинного обучения](../machine-learning/machine-learning-scaling-webservice.md).</span><span class="sxs-lookup"><span data-stu-id="fcd48-135">For more information on this setting please review the [Scaling article for Machine Learning Web Services](../machine-learning/machine-learning-scaling-webservice.md).</span></span>

## <a name="example--sentiment-analysis"></a><span data-ttu-id="fcd48-136">Пример: анализ мнений</span><span class="sxs-lookup"><span data-stu-id="fcd48-136">Example – Sentiment Analysis</span></span>
<span data-ttu-id="fcd48-137">В следующем примере показано задание Stream Analytics с функцией машинного обучения для анализа мнений, как описано в руководстве [Общие сведения о Stream Analytics и интеграции машинного обучения](stream-analytics-machine-learning-integration-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="fcd48-137">The following example includes a Stream Analytics job with the sentiment analysis Machine Learning function, as described in the [Stream Analytics Machine Learning integration tutorial](stream-analytics-machine-learning-integration-tutorial.md).</span></span>

<span data-ttu-id="fcd48-138">Запрос представляет собой простой полностью секционированный запрос, за которым следует функция **sentiment** , как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="fcd48-138">The query is a simple fully partitioned query followed by the **sentiment** function, as shown below:</span></span>

    WITH subquery AS (
        SELECT text, sentiment(text) as result from input
    )

    Select text, result.[Score]
    Into output
    From subquery

<span data-ttu-id="fcd48-139">Рассмотрим следующий сценарий: необходимо создать задание Stream Analytics для анализа мнений в твитах (событиях) с пропускной способностью 10 000 твитов в секунду.</span><span class="sxs-lookup"><span data-stu-id="fcd48-139">Consider the following scenario; with a throughput of 10,000 tweets per second a Stream Analytics job must be created to perform sentiment analysis of the tweets (events).</span></span> <span data-ttu-id="fcd48-140">Достаточно ли 1 SU, чтобы это задание Stream Analytics могло обрабатывать нужный объем трафика?</span><span class="sxs-lookup"><span data-stu-id="fcd48-140">Using 1 SU, could this Stream Analytics job be able to handle the traffic?</span></span> <span data-ttu-id="fcd48-141">Если использовать размер пакета по умолчанию (1000), задание должно справиться с входными данными.</span><span class="sxs-lookup"><span data-stu-id="fcd48-141">Using the default batch size of 1000 the job should be able to keep up with the input.</span></span> <span data-ttu-id="fcd48-142">Дополнительно добавленная функция машинного обучения будет создавать задержку не более одной секунды — это обычная задержка по умолчанию для веб-службы машинного обучения по анализу мнений (при размере пакета по умолчанию 1000).</span><span class="sxs-lookup"><span data-stu-id="fcd48-142">Further the added Machine Learning function should generate no more than a second of latency, which is the general default latency of the sentiment analysis Machine Learning web service (with a default batch size of 1000).</span></span> <span data-ttu-id="fcd48-143">**Общая** (сквозная) задержка задания Stream Analytics обычно составляет несколько секунд.</span><span class="sxs-lookup"><span data-stu-id="fcd48-143">The Stream Analytics job’s **overall** or end-to-end latency would typically be a few seconds.</span></span> <span data-ttu-id="fcd48-144">Изучите это задание Stream Analytics более подробно, *особенно* вызовы функций машинного обучения.</span><span class="sxs-lookup"><span data-stu-id="fcd48-144">Take a more detailed look into this Stream Analytics job, *especially* the Machine Learning function calls.</span></span> <span data-ttu-id="fcd48-145">При размере пакета 1000 и пропускной способности 10 000 событий количество запросов к веб-службе будет составлять примерно 10.</span><span class="sxs-lookup"><span data-stu-id="fcd48-145">Having the batch size as 1000, a throughput of 10,000 events will take about 10 requests to web service.</span></span> <span data-ttu-id="fcd48-146">Даже при 1 SU количество одновременных подключений будет достаточным для обработки этого входящего трафика.</span><span class="sxs-lookup"><span data-stu-id="fcd48-146">Even with 1 SU, there are enough concurrent connections to accommodate this input traffic.</span></span>

<span data-ttu-id="fcd48-147">Но что делать, если частота входящих событий увеличится в 100 раз и задание Stream Analytics должно будет обрабатывать 1 000 000 твитов в секунду?</span><span class="sxs-lookup"><span data-stu-id="fcd48-147">But what if the input event rate increases by 100x and now the Stream Analytics job needs to process 1,000,000 tweets per second?</span></span> <span data-ttu-id="fcd48-148">Существуют два варианта:</span><span class="sxs-lookup"><span data-stu-id="fcd48-148">There are two options:</span></span>

1. <span data-ttu-id="fcd48-149">Увеличить размер пакета.</span><span class="sxs-lookup"><span data-stu-id="fcd48-149">Increase the batch size, or</span></span>
2. <span data-ttu-id="fcd48-150">Секционировать входной поток для обработки событий в параллельном режиме.</span><span class="sxs-lookup"><span data-stu-id="fcd48-150">Partition the input stream to process the events in parallel</span></span>

<span data-ttu-id="fcd48-151">Если выбрать первый вариант, увеличится **задержка** задания.</span><span class="sxs-lookup"><span data-stu-id="fcd48-151">With the first option, the job **latency** will increase.</span></span>

<span data-ttu-id="fcd48-152">Для второго варианта потребуется подготовить дополнительные единицы SU, которые, в свою очередь, будут создавать дополнительные параллельные запросы к веб-службе машинного обучения.</span><span class="sxs-lookup"><span data-stu-id="fcd48-152">With the second option, more SUs would need to be provisioned and therefore generate more concurrent Machine Learning web service requests.</span></span> <span data-ttu-id="fcd48-153">Это означает, что **стоимость** задания увеличится.</span><span class="sxs-lookup"><span data-stu-id="fcd48-153">This means the job **cost** will increase.</span></span>

<span data-ttu-id="fcd48-154">Предположим, что задержка веб-службы машинного обучения по анализу мнений составляет 200 мс для пакетов размером до 1000 событий, 250 мс для пакетов на 5000 событий, 300 мс для пакетов на 10 000 событий и 500 мс для пакетов на 25 000 событий.</span><span class="sxs-lookup"><span data-stu-id="fcd48-154">Assume the latency of the sentiment analysis Machine Learning web service is 200ms for 1000-event batches or below, 250ms for 5,000-event batches, 300ms for 10,000-event batches or 500ms for 25,000-event batches.</span></span>

1. <span data-ttu-id="fcd48-155">Используя первый вариант (**без** подготовки дополнительных единиц SU), можно увеличить размер пакета до **25 000**.</span><span class="sxs-lookup"><span data-stu-id="fcd48-155">Using the first option, (**not** provisioning more SUs), the batch size could be increased to **25,000**.</span></span> <span data-ttu-id="fcd48-156">Это, в свою очередь, позволит заданию обрабатывать 1 000 000 событий при 20 одновременных подключениях к веб-службе машинного обучения (с задержкой 500 мс на один вызов).</span><span class="sxs-lookup"><span data-stu-id="fcd48-156">This in turn would allow the job to process 1,000,000 events with 20 concurrent connections to the Machine Learning web service (with a latency of 500ms per call).</span></span> <span data-ttu-id="fcd48-157">Поэтому дополнительная задержка задания Stream Analytics (из-за того, что функция анализа мнений выполняет запросы к веб-службе машинного обучения) увеличится с **200** до **500 мс**.</span><span class="sxs-lookup"><span data-stu-id="fcd48-157">So the additional latency of the Stream Analytics job due to the sentiment function requests against the Machine Learning web service requests would be increased from **200ms** to **500ms**.</span></span> <span data-ttu-id="fcd48-158">Однако обратите внимание, что размер пакета **не может** увеличиваться бесконечно: в веб-службах машинного обучения допускается размер полезных данных запроса не более 4 МБ, так как веб-службе запросов требуется время ожидания после 100 секунд работы.</span><span class="sxs-lookup"><span data-stu-id="fcd48-158">However, note that batch size **cannot** be increased infinitely as the Machine Learning web services requires the payload size of a request be 4MB or smaller web service requests timeout after 100 seconds of operation.</span></span>
2. <span data-ttu-id="fcd48-159">Если используется второй вариант, размер пакета остается неизменным (1000), и при задержке веб-службы в 200 мс каждые 20 одновременных подключений к веб-службе смогут обрабатывать 1000 * 20 * 5 событий, то есть 100 000 событий в секунду.</span><span class="sxs-lookup"><span data-stu-id="fcd48-159">Using the second option, the batch size is left at 1000, with 200ms web service latency, every 20 concurrent connections to the web service would be able to process 1000 * 20 * 5 events = 100,000 per second.</span></span> <span data-ttu-id="fcd48-160">Таким образом, для обработки 1 000 000 событий в секунду заданию потребуется 60 SU.</span><span class="sxs-lookup"><span data-stu-id="fcd48-160">So to process 1,000,000 events per second, the job would need 60 SUs.</span></span> <span data-ttu-id="fcd48-161">По сравнению с первым вариантом задание Stream Analytics будет создавать больше пакетных запросов к веб-службе, что приведет к увеличению затрат.</span><span class="sxs-lookup"><span data-stu-id="fcd48-161">Compared to the first option, Stream Analytics job would make more web service batch requests, in turn generating an increased cost.</span></span>

<span data-ttu-id="fcd48-162">Ниже приведена таблица пропускной способности (количества событий в секунду) задания Stream Analytics для разного количества SU и размеров пакета.</span><span class="sxs-lookup"><span data-stu-id="fcd48-162">Below is a table for the throughput of the Stream Analytics job for different SUs and batch sizes (in number of events per second).</span></span>

| <span data-ttu-id="fcd48-163">Размер пакета (задержка службы машинного обучения)</span><span class="sxs-lookup"><span data-stu-id="fcd48-163">batch size (ML latency)</span></span> | <span data-ttu-id="fcd48-164">500 (200 мс)</span><span class="sxs-lookup"><span data-stu-id="fcd48-164">500 (200ms)</span></span> | <span data-ttu-id="fcd48-165">1000 (200 мс)</span><span class="sxs-lookup"><span data-stu-id="fcd48-165">1,000 (200ms)</span></span> | <span data-ttu-id="fcd48-166">5000 (250 мс)</span><span class="sxs-lookup"><span data-stu-id="fcd48-166">5,000 (250ms)</span></span> | <span data-ttu-id="fcd48-167">10 000 (300 мс)</span><span class="sxs-lookup"><span data-stu-id="fcd48-167">10,000 (300ms)</span></span> | <span data-ttu-id="fcd48-168">25 000 (500 мс)</span><span class="sxs-lookup"><span data-stu-id="fcd48-168">25,000 (500ms)</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="fcd48-169">**1 единица хранения**</span><span class="sxs-lookup"><span data-stu-id="fcd48-169">**1 SU**</span></span> |<span data-ttu-id="fcd48-170">2500</span><span class="sxs-lookup"><span data-stu-id="fcd48-170">2,500</span></span> |<span data-ttu-id="fcd48-171">5 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-171">5,000</span></span> |<span data-ttu-id="fcd48-172">20 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-172">20,000</span></span> |<span data-ttu-id="fcd48-173">30 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-173">30,000</span></span> |<span data-ttu-id="fcd48-174">50 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-174">50,000</span></span> |
| <span data-ttu-id="fcd48-175">**3 единицы хранения**</span><span class="sxs-lookup"><span data-stu-id="fcd48-175">**3 SUs**</span></span> |<span data-ttu-id="fcd48-176">2500</span><span class="sxs-lookup"><span data-stu-id="fcd48-176">2,500</span></span> |<span data-ttu-id="fcd48-177">5 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-177">5,000</span></span> |<span data-ttu-id="fcd48-178">20 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-178">20,000</span></span> |<span data-ttu-id="fcd48-179">30 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-179">30,000</span></span> |<span data-ttu-id="fcd48-180">50 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-180">50,000</span></span> |
| <span data-ttu-id="fcd48-181">**6 единиц хранения**</span><span class="sxs-lookup"><span data-stu-id="fcd48-181">**6 SUs**</span></span> |<span data-ttu-id="fcd48-182">2500</span><span class="sxs-lookup"><span data-stu-id="fcd48-182">2,500</span></span> |<span data-ttu-id="fcd48-183">5 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-183">5,000</span></span> |<span data-ttu-id="fcd48-184">20 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-184">20,000</span></span> |<span data-ttu-id="fcd48-185">30 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-185">30,000</span></span> |<span data-ttu-id="fcd48-186">50 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-186">50,000</span></span> |
| <span data-ttu-id="fcd48-187">**12 единиц хранения**</span><span class="sxs-lookup"><span data-stu-id="fcd48-187">**12 SUs**</span></span> |<span data-ttu-id="fcd48-188">5 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-188">5,000</span></span> |<span data-ttu-id="fcd48-189">10 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-189">10,000</span></span> |<span data-ttu-id="fcd48-190">40 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-190">40,000</span></span> |<span data-ttu-id="fcd48-191">60 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-191">60,000</span></span> |<span data-ttu-id="fcd48-192">100 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-192">100,000</span></span> |
| <span data-ttu-id="fcd48-193">**18 единиц хранения**</span><span class="sxs-lookup"><span data-stu-id="fcd48-193">**18 SUs**</span></span> |<span data-ttu-id="fcd48-194">7500</span><span class="sxs-lookup"><span data-stu-id="fcd48-194">7,500</span></span> |<span data-ttu-id="fcd48-195">15 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-195">15,000</span></span> |<span data-ttu-id="fcd48-196">60 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-196">60,000</span></span> |<span data-ttu-id="fcd48-197">90 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-197">90,000</span></span> |<span data-ttu-id="fcd48-198">150 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-198">150,000</span></span> |
| <span data-ttu-id="fcd48-199">**24 единицы хранения**</span><span class="sxs-lookup"><span data-stu-id="fcd48-199">**24 SUs**</span></span> |<span data-ttu-id="fcd48-200">10 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-200">10,000</span></span> |<span data-ttu-id="fcd48-201">20 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-201">20,000</span></span> |<span data-ttu-id="fcd48-202">80 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-202">80,000</span></span> |<span data-ttu-id="fcd48-203">120 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-203">120,000</span></span> |<span data-ttu-id="fcd48-204">200 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-204">200,000</span></span> |
| <span data-ttu-id="fcd48-205">**…**</span><span class="sxs-lookup"><span data-stu-id="fcd48-205">**…**</span></span> |<span data-ttu-id="fcd48-206">…</span><span class="sxs-lookup"><span data-stu-id="fcd48-206">…</span></span> |<span data-ttu-id="fcd48-207">…</span><span class="sxs-lookup"><span data-stu-id="fcd48-207">…</span></span> |<span data-ttu-id="fcd48-208">…</span><span class="sxs-lookup"><span data-stu-id="fcd48-208">…</span></span> |<span data-ttu-id="fcd48-209">…</span><span class="sxs-lookup"><span data-stu-id="fcd48-209">…</span></span> |<span data-ttu-id="fcd48-210">…</span><span class="sxs-lookup"><span data-stu-id="fcd48-210">…</span></span> |
| <span data-ttu-id="fcd48-211">**60 единиц хранения**</span><span class="sxs-lookup"><span data-stu-id="fcd48-211">**60 SUs**</span></span> |<span data-ttu-id="fcd48-212">25 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-212">25,000</span></span> |<span data-ttu-id="fcd48-213">50 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-213">50,000</span></span> |<span data-ttu-id="fcd48-214">200 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-214">200,000</span></span> |<span data-ttu-id="fcd48-215">300 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-215">300,000</span></span> |<span data-ttu-id="fcd48-216">500 000</span><span class="sxs-lookup"><span data-stu-id="fcd48-216">500,000</span></span> |

<span data-ttu-id="fcd48-217">Теперь у вас есть четкое представление о том, как работают функции машинного обучения в Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="fcd48-217">By now, you should already have a good understanding of how Machine Learning functions in Stream Analytics work.</span></span> <span data-ttu-id="fcd48-218">Скорее всего, вы также знаете, что задания Stream Analytics извлекают данные из источников данных и каждая операция извлечения возвращает пакет событий, которые должно обработать задание Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="fcd48-218">You likely also understand that Stream Analytics jobs “pull” data from data sources and each “pull” returns a batch of events for the Stream Analytics job to process.</span></span> <span data-ttu-id="fcd48-219">Каким образом эта модель извлечения данных влияет на запросы к веб-службе машинного обучения?</span><span class="sxs-lookup"><span data-stu-id="fcd48-219">How does this pull model impact the Machine Learning web service requests?</span></span>

<span data-ttu-id="fcd48-220">Как правило, размер пакета, заданный для функций машинного обучения, не делится точно на количество событий, возвращаемых каждой операцией извлечения, которую выполняет задание Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="fcd48-220">Normally, the batch size we set for Machine Learning functions won’t exactly be divisible by the number of events returned by each Stream Analytics job “pull”.</span></span> <span data-ttu-id="fcd48-221">Когда это происходит, веб-служба машинного обучения вызывается с помощью "частичных" пакетов.</span><span class="sxs-lookup"><span data-stu-id="fcd48-221">When this occurs the Machine Learning web service will be called with “partial” batches.</span></span> <span data-ttu-id="fcd48-222">Это делается во избежание дополнительных затрат на задержку задания при объединении событий из разных операций извлечения.</span><span class="sxs-lookup"><span data-stu-id="fcd48-222">This is done to not incur additional job latency overhead in coalescing events from pull to pull.</span></span>

## <a name="new-function-related-monitoring-metrics"></a><span data-ttu-id="fcd48-223">Новые метрики мониторинга, связанные с функциями</span><span class="sxs-lookup"><span data-stu-id="fcd48-223">New function-related monitoring metrics</span></span>
<span data-ttu-id="fcd48-224">В области мониторинга задания Stream Analytics добавлены три дополнительные метрики, связанные с функциями.</span><span class="sxs-lookup"><span data-stu-id="fcd48-224">In the Monitor area of a Stream Analytics job, three additional function-related metrics have been added.</span></span> <span data-ttu-id="fcd48-225">Это "Запросы функций", "События функций" и "Запросы функций со сбоем", как показано на следующем рисунке.</span><span class="sxs-lookup"><span data-stu-id="fcd48-225">They are FUNCTION REQUESTS, FUNCTION EVENTS and FAILED FUNCTION REQUESTS, as shown in the graphic below.</span></span>

<span data-ttu-id="fcd48-226">![Метрики масштабирования Stream Analytics с использованием функций машинного обучения](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-01.png "Метрики масштабирования Stream Analytics с использованием функций машинного обучения")</span><span class="sxs-lookup"><span data-stu-id="fcd48-226">![Scale Stream Analytics with Machine Learning Functions Metrics](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-01.png "Scale Stream Analytics with Machine Learning Functions Metrics")</span></span>

<span data-ttu-id="fcd48-227">Вот их определения:</span><span class="sxs-lookup"><span data-stu-id="fcd48-227">The are defined as follows:</span></span>

<span data-ttu-id="fcd48-228">**Запросы функций**— количество запросов функций.</span><span class="sxs-lookup"><span data-stu-id="fcd48-228">**FUNCTION REQUESTS**: The number of function requests.</span></span>

<span data-ttu-id="fcd48-229">**События функций**— количество событий в запросах функций.</span><span class="sxs-lookup"><span data-stu-id="fcd48-229">**FUNCTION EVENTS**: The number events in the function requests.</span></span>

<span data-ttu-id="fcd48-230">**Запросы функций со сбоем**— количество запросов функций, завершившихся сбоем.</span><span class="sxs-lookup"><span data-stu-id="fcd48-230">**FAILED FUNCTION REQUESTS**: The number of failed function requests.</span></span>

## <a name="key-takeaways"></a><span data-ttu-id="fcd48-231">Общие выводы</span><span class="sxs-lookup"><span data-stu-id="fcd48-231">Key Takeaways</span></span>
<span data-ttu-id="fcd48-232">Подытожим основные тезисы. Итак, чтобы масштабировать задания Stream Analytics с помощью функций машинного обучения, необходимо учитывать следующие аспекты.</span><span class="sxs-lookup"><span data-stu-id="fcd48-232">To summarize the main points, in order to scale an Stream Analytics job with Machine Learning functions, the following items must be considered:</span></span>

1. <span data-ttu-id="fcd48-233">Частота входящих событий.</span><span class="sxs-lookup"><span data-stu-id="fcd48-233">The input event rate</span></span>
2. <span data-ttu-id="fcd48-234">Допустимая задержка для выполняющегося задания Stream Analytics (и, соответственно, размер пакета для запросов веб-службы машинного обучения).</span><span class="sxs-lookup"><span data-stu-id="fcd48-234">The tolerated latency for the running Stream Analytics job (and thus the batch size of the Machine Learning web service requests)</span></span>
3. <span data-ttu-id="fcd48-235">Количество подготовленных единиц SU Stream Analytics и количество запросов веб-службы машинного обучения (дополнительные расходы, связанные с использованием функций).</span><span class="sxs-lookup"><span data-stu-id="fcd48-235">The provisioned Stream Analytics SUs and the number of Machine Learning web service requests (the additional function-related costs)</span></span>

<span data-ttu-id="fcd48-236">В качестве примера был использован полностью секционированный запрос Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="fcd48-236">A fully partitioned Stream Analytics query was used as an example.</span></span> <span data-ttu-id="fcd48-237">Если требуется более сложный запрос, посетите [форум Azure Stream Analytics](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics). Это превосходный ресурс, на котором можно получить дополнительные сведения от разработчиков Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="fcd48-237">If a more complex query is needed the [Azure Stream Analytics forum](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics) is a great resource for getting additional help from the Stream Analytics team.</span></span>

## <a name="next-steps"></a><span data-ttu-id="fcd48-238">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="fcd48-238">Next steps</span></span>
<span data-ttu-id="fcd48-239">Дополнительные сведения о службе Stream Analytics см. в следующих статьях:</span><span class="sxs-lookup"><span data-stu-id="fcd48-239">To learn more about Stream Analytics, see:</span></span>

* [<span data-ttu-id="fcd48-240">Приступая к работе с Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="fcd48-240">Get started using Azure Stream Analytics</span></span>](stream-analytics-real-time-fraud-detection.md)
* [<span data-ttu-id="fcd48-241">Масштабирование заданий в службе Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="fcd48-241">Scale Azure Stream Analytics jobs</span></span>](stream-analytics-scale-jobs.md)
* [<span data-ttu-id="fcd48-242">Справочник по языку запросов Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="fcd48-242">Azure Stream Analytics Query Language Reference</span></span>](https://msdn.microsoft.com/library/azure/dn834998.aspx)
* [<span data-ttu-id="fcd48-243">Справочник по API-интерфейсу REST управления Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="fcd48-243">Azure Stream Analytics Management REST API Reference</span></span>](https://msdn.microsoft.com/library/azure/dn835031.aspx)
