---
title: "с помощью функции Azure Stream Analytics & AzureML aaaJob | Документы Microsoft"
description: "Узнайте, как tooproperly масштабировать заданий Stream Analytics (секционирование, SU количество и многое другое) при использовании функции машинного обучения Azure."
keywords: 
documentationcenter: 
services: stream-analytics
author: jeffstokes72
manager: jhubbard
editor: cgronlun
ms.assetid: 47ce7c5e-1de1-41ca-9a26-b5ecce814743
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: jeffstok
ms.openlocfilehash: 3fbdfaf7e8e86896c56f1d18bbde3a10bd3dca04
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="scale-your-stream-analytics-job-with-azure-machine-learning-functions"></a><span data-ttu-id="9169f-103">Масштабирование заданий Stream Analytics с помощью функций машинного обучения Azure</span><span class="sxs-lookup"><span data-stu-id="9169f-103">Scale your Stream Analytics job with Azure Machine Learning functions</span></span>
<span data-ttu-id="9169f-104">Он часто является довольно просто tooset задание Stream Analytics и выполните его образцами данных.</span><span class="sxs-lookup"><span data-stu-id="9169f-104">It is often quite easy tooset up an Stream Analytics job and run some sample data through it.</span></span> <span data-ttu-id="9169f-105">Что необходимо сделать в случае необходимости toorun hello же задания с высоким объемом данных?</span><span class="sxs-lookup"><span data-stu-id="9169f-105">What should we do when we need toorun hello same job with higher data volume?</span></span> <span data-ttu-id="9169f-106">Он требует toounderstand как задания tooconfigure hello Stream Analytics, чтобы они будут масштабироваться.</span><span class="sxs-lookup"><span data-stu-id="9169f-106">It requires us toounderstand how tooconfigure hello Stream Analytics job so that it will scale.</span></span> <span data-ttu-id="9169f-107">В этом документе рассматривается hello особые аспекты масштабирования Stream Analytics задания с помощью функций машинного обучения.</span><span class="sxs-lookup"><span data-stu-id="9169f-107">In this document, we will focus on hello special aspects of scaling Stream Analytics jobs with Machine Learning functions.</span></span> <span data-ttu-id="9169f-108">Сведения о как tooscale заданий Stream Analytics в целом. в статье hello [масштабированию заданий](stream-analytics-scale-jobs.md).</span><span class="sxs-lookup"><span data-stu-id="9169f-108">For information on how tooscale Stream Analytics jobs in general see hello article [Scaling jobs](stream-analytics-scale-jobs.md).</span></span>

## <a name="what-is-an-azure-machine-learning-function-in-stream-analytics"></a><span data-ttu-id="9169f-109">Что такое функция машинного обучения Azure в Stream Analytics?</span><span class="sxs-lookup"><span data-stu-id="9169f-109">What is an Azure Machine Learning function in Stream Analytics?</span></span>
<span data-ttu-id="9169f-110">Функции машинного обучения в Stream Analytics может использоваться как при обычном вызове функции в язык запросов Stream Analytics hello.</span><span class="sxs-lookup"><span data-stu-id="9169f-110">A Machine Learning function in Stream Analytics can be used like a regular function call in hello Stream Analytics query language.</span></span> <span data-ttu-id="9169f-111">Однако за сценой hello вызовов функций hello, фактически запросы веб-служба Azure Machine Learning.</span><span class="sxs-lookup"><span data-stu-id="9169f-111">However, behind hello scene, hello function calls are actually Azure Machine Learning Web Service requests.</span></span> <span data-ttu-id="9169f-112">Веб-машины обучения службы поддержки «Пакетная обработка» несколько строк, называемый мини-пакета, в hello же вызова веб-службы API, tooimprove общую пропускную способность.</span><span class="sxs-lookup"><span data-stu-id="9169f-112">Machine Learning web services support “batching” multiple rows, which is called mini-batch, in hello same web service API call, tooimprove overall throughput.</span></span> <span data-ttu-id="9169f-113">См. в разделе hello следующие статьи для получения дополнительных сведений; [Функции машинного обучения azure в Stream Analytics](https://blogs.technet.microsoft.com/machinelearning/2015/12/10/azure-ml-now-available-as-a-function-in-azure-stream-analytics/) и [веб-службы Azure Machine Learning](../machine-learning/machine-learning-consume-web-services.md).</span><span class="sxs-lookup"><span data-stu-id="9169f-113">Please see hello following articles for more details; [Azure Machine Learning functions in Stream Analytics](https://blogs.technet.microsoft.com/machinelearning/2015/12/10/azure-ml-now-available-as-a-function-in-azure-stream-analytics/) and [Azure Machine Learning Web Services](../machine-learning/machine-learning-consume-web-services.md).</span></span>

## <a name="configure-a-stream-analytics-job-with-machine-learning-functions"></a><span data-ttu-id="9169f-114">Настройка задания Stream Analytics с помощью функций машинного обучения</span><span class="sxs-lookup"><span data-stu-id="9169f-114">Configure a Stream Analytics job with Machine Learning functions</span></span>
<span data-ttu-id="9169f-115">При настройке функции машинного обучения для задания Stream Analytics, существует два tooconsider параметров, размер пакета hello вызовов функции hello машинного обучения и hello единицы (SUs), подготовленных для задания Stream Analytics hello потоковой передачи.</span><span class="sxs-lookup"><span data-stu-id="9169f-115">When configuring a Machine Learning function for Stream Analytics job, there are two parameters tooconsider, hello batch size of hello Machine Learning function calls, and hello streaming units (SUs) provisioned for hello Stream Analytics job.</span></span> <span data-ttu-id="9169f-116">toodetermine hello соответствующие значения для этих сначала решение должно быть принято между задержка и пропускная способность, то есть задержки задания Stream Analytics hello и пропускная способность каждого SU.</span><span class="sxs-lookup"><span data-stu-id="9169f-116">toodetermine hello appropriate values for these, first a decision must be made between latency and throughput, that is, latency of hello Stream Analytics job, and throughput of each SU.</span></span> <span data-ttu-id="9169f-117">SUs всегда добавляются tooa tooincrease по заданию для оптимально секционирована запросов Stream Analytics, несмотря на то, что дополнительные SUs увеличивает затраты на выполнение задания hello hello.</span><span class="sxs-lookup"><span data-stu-id="9169f-117">SUs may always be added tooa job tooincrease throughput of a well partitioned Stream Analytics query, although additional SUs increases hello cost of running hello job.</span></span>

<span data-ttu-id="9169f-118">Поэтому очень важно toodetermine hello *отклонения* задержки в выполнении задания Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="9169f-118">Therefore it is important toodetermine hello *tolerance* of latency in running a Stream Analytics job.</span></span> <span data-ttu-id="9169f-119">Дополнительная задержка выполнения запросов на обслуживание машинного обучения Azure естественным образом увеличивается с размер пакета, который будет составные задержки hello задания Stream Analytics hello.</span><span class="sxs-lookup"><span data-stu-id="9169f-119">Additional latency from running Azure Machine Learning service requests will naturally increase with batch size, which will compound hello latency of hello Stream Analytics job.</span></span> <span data-ttu-id="9169f-120">На hello другой стороны, увеличение размера пакета позволяет tooprocess задания Stream Analytics hello * несколько событий с hello *одинаковый номер* машинного обучения запросов веб-службы.</span><span class="sxs-lookup"><span data-stu-id="9169f-120">On hello other hand, increasing batch size allows hello Stream Analytics job tooprocess *more events with hello *same number* of Machine Learning web service requests.</span></span> <span data-ttu-id="9169f-121">Часто hello увеличение задержки службы web машинного обучения является вложенным линейной toohello увеличение размера пакета, поэтому важно tooconsider hello наиболее эффективный размер пакета с веб-службы машинного обучения в данной ситуации.</span><span class="sxs-lookup"><span data-stu-id="9169f-121">Often hello increase of Machine Learning web service latency is sub-linear toohello increase of batch size so it is important tooconsider hello most cost-efficient batch size for a Machine Learning web service in any given situation.</span></span> <span data-ttu-id="9169f-122">запрашивает размер пакета по умолчанию Hello hello веб-службы — 1000 и может быть изменен с помощью hello [Stream Analytics REST API](https://msdn.microsoft.com/library/mt653706.aspx "Stream Analytics REST API") или hello [PowerShell клиента для Stream Analytics](stream-analytics-monitor-and-manage-jobs-use-powershell.md "PowerShell клиента для Stream Analytics").</span><span class="sxs-lookup"><span data-stu-id="9169f-122">hello default batch size for hello web service requests is 1000 and may be modified either by using hello [Stream Analytics REST API](https://msdn.microsoft.com/library/mt653706.aspx "Stream Analytics REST API") or hello [PowerShell client for Stream Analytics](stream-analytics-monitor-and-manage-jobs-use-powershell.md "PowerShell client for Stream Analytics").</span></span>

<span data-ttu-id="9169f-123">После определения размера пакета hello объем потоковой передачи единицы (SUs) можно было определить, на основе hello число событий, функции hello должен tooprocess в секунду.</span><span class="sxs-lookup"><span data-stu-id="9169f-123">Once a batch size has been determined, hello amount of streaming units (SUs) can be determined, based on hello number of events that hello function needs tooprocess per second.</span></span> <span data-ttu-id="9169f-124">Дополнительные сведения о единицах потоковой передачи см. в статье [Масштабирование заданий Azure Stream Analytics для повышения пропускной способности базы данных](stream-analytics-scale-jobs.md).</span><span class="sxs-lookup"><span data-stu-id="9169f-124">For more information about streaming units, see [Stream Analytics scale jobs](stream-analytics-scale-jobs.md).</span></span>

<span data-ttu-id="9169f-125">Как правило существует 20 одновременных подключений веб-службы машинного обучения toohello каждые 6 SUs, за исключением того, что 1 SU и 3 SU задания будет получать 20 одновременных подключений также.</span><span class="sxs-lookup"><span data-stu-id="9169f-125">In general, there are 20 concurrent connections toohello Machine Learning web service for every 6 SUs, except that 1 SU jobs and 3 SU jobs will get 20 concurrent connections also.</span></span>  <span data-ttu-id="9169f-126">Например если скорость hello входных данных составляет 200 000 событий в секунду и оставшийся размер пакета hello toohello по умолчанию 1000 hello полученный web службы времени задержки с помощью мини-пакета 1000 событий составляет 200 мс.</span><span class="sxs-lookup"><span data-stu-id="9169f-126">For example, if hello input data rate is 200,000 events per second and hello batch size is left toohello default of 1000 hello resulting web service latency with 1000 events mini-batch is 200ms.</span></span> <span data-ttu-id="9169f-127">Это означает, что каждый раз при подключении могут осуществлять 5 запросы веб-службы машинного обучения toohello в секунду.</span><span class="sxs-lookup"><span data-stu-id="9169f-127">This means every connection can make 5 requests toohello Machine Learning web service in a second.</span></span> <span data-ttu-id="9169f-128">С 20 соединений hello задания Stream Analytics может обрабатывать события 20 000 200 мс и поэтому 100 000 событий в секунду.</span><span class="sxs-lookup"><span data-stu-id="9169f-128">With 20 connections, hello Stream Analytics job can process 20,000 events in 200ms  and therefore 100,000 events in a second.</span></span> <span data-ttu-id="9169f-129">Поэтому tooprocess 200 000 событий в секунду, задание Stream Analytics hello должен 40 одновременных подключений, который выйдет too12 SUs.</span><span class="sxs-lookup"><span data-stu-id="9169f-129">So tooprocess 200,000 events per second, hello Stream Analytics job needs 40 concurrent connections, which comes out too12 SUs.</span></span> <span data-ttu-id="9169f-130">Hello приведенной ниже схеме показано hello запросы от hello Stream Analytics задания toohello машинного обучения конечной веб-службы — каждые 6 SUs содержит 20 одновременных подключений tooMachine обучения веб-службы в max.</span><span class="sxs-lookup"><span data-stu-id="9169f-130">hello diagram below illustrates hello requests from hello Stream Analytics job toohello Machine Learning web service endpoint – Every 6 SUs has 20 concurrent connections tooMachine Learning web service at max.</span></span>

<span data-ttu-id="9169f-131">![Пример: масштабирование 2 заданий Stream Analytics с помощью функций машинного обучения](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-00.png "Пример: масштабирование 2 заданий Stream Analytics с помощью функций машинного обучения")</span><span class="sxs-lookup"><span data-stu-id="9169f-131">![Scale Stream Analytics with Machine Learning Functions 2 job example](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-00.png "Scale Stream Analytics with Machine Learning Functions 2 job example")</span></span>

<span data-ttu-id="9169f-132">Как правило ***B*** размер пакета ***L*** для hello web service задержки при размере пакета B в миллисекундах, hello пропускной способности задания Stream Analytics с ***N*** SUs является:</span><span class="sxs-lookup"><span data-stu-id="9169f-132">In general, ***B*** for batch size, ***L*** for hello web service latency at batch size B in milliseconds, hello throughput of an Stream Analytics job with ***N*** SUs is:</span></span>

<span data-ttu-id="9169f-133">![Формула масштабирования Stream Analytics с использованием функций машинного обучения](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-02.png "Формула масштабирования Stream Analytics с использованием функций машинного обучения")</span><span class="sxs-lookup"><span data-stu-id="9169f-133">![Scale Stream Analytics with Machine Learning Functions Formula](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-02.png "Scale Stream Analytics with Machine Learning Functions Formula")</span></span>

<span data-ttu-id="9169f-134">Иногда может быть hello «max параллельных запросов» hello web машинного обучения на стороне службы, рекомендуется tooset toohello максимальное значение (в настоящее время 200).</span><span class="sxs-lookup"><span data-stu-id="9169f-134">An additional consideration may be hello 'max concurrent calls' on hello Machine Learning web service side, it’s recommended tooset this toohello maximum value (200 currently).</span></span>

<span data-ttu-id="9169f-135">Дополнительные сведения об этом параметре см. в статье hello [масштабирование статьи для веб-службы обучения машины](../machine-learning/machine-learning-scaling-webservice.md).</span><span class="sxs-lookup"><span data-stu-id="9169f-135">For more information on this setting please review hello [Scaling article for Machine Learning Web Services](../machine-learning/machine-learning-scaling-webservice.md).</span></span>

## <a name="example--sentiment-analysis"></a><span data-ttu-id="9169f-136">Пример: анализ мнений</span><span class="sxs-lookup"><span data-stu-id="9169f-136">Example – Sentiment Analysis</span></span>
<span data-ttu-id="9169f-137">Hello следующий пример включает задания Stream Analytics с помощью функций анализа мнений hello функции машинного обучения, как описано в hello [учебник по службам integration Stream Analytics машинного обучения](stream-analytics-machine-learning-integration-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="9169f-137">hello following example includes a Stream Analytics job with hello sentiment analysis Machine Learning function, as described in hello [Stream Analytics Machine Learning integration tutorial](stream-analytics-machine-learning-integration-tutorial.md).</span></span>

<span data-ttu-id="9169f-138">Hello это простой полностью секционированных запрос следуют hello **мнений** функции, как показано ниже:</span><span class="sxs-lookup"><span data-stu-id="9169f-138">hello query is a simple fully partitioned query followed by hello **sentiment** function, as shown below:</span></span>

    WITH subquery AS (
        SELECT text, sentiment(text) as result from input
    )

    Select text, result.[Score]
    Into output
    From subquery

<span data-ttu-id="9169f-139">Рассмотрим следующие сценарии; hello с пропускной способностью 10 000 твиты в секунду задания Stream Analytics необходимо создать анализ мнений tooperform твиты hello (события).</span><span class="sxs-lookup"><span data-stu-id="9169f-139">Consider hello following scenario; with a throughput of 10,000 tweets per second a Stream Analytics job must be created tooperform sentiment analysis of hello tweets (events).</span></span> <span data-ttu-id="9169f-140">С помощью 1 SU, это задание Stream Analytics удалось может toohandle hello трафика?</span><span class="sxs-lookup"><span data-stu-id="9169f-140">Using 1 SU, could this Stream Analytics job be able toohandle hello traffic?</span></span> <span data-ttu-id="9169f-141">Размер пакета по умолчанию hello 1000 hello задания с помощью должен быть доступ tookeep вверх с hello входных данных.</span><span class="sxs-lookup"><span data-stu-id="9169f-141">Using hello default batch size of 1000 hello job should be able tookeep up with hello input.</span></span> <span data-ttu-id="9169f-142">Дальнейшие hello добавить функцию машинного обучения должна создавать не более секунды задержки — задержка по умолчанию общие hello анализа мнений hello веб-службы машинного обучения (с размером пакета по умолчанию 1000).</span><span class="sxs-lookup"><span data-stu-id="9169f-142">Further hello added Machine Learning function should generate no more than a second of latency, which is hello general default latency of hello sentiment analysis Machine Learning web service (with a default batch size of 1000).</span></span> <span data-ttu-id="9169f-143">Задание Stream Analytics Hello **общую** или конца в конец задержка, обычно используется, через несколько секунд.</span><span class="sxs-lookup"><span data-stu-id="9169f-143">hello Stream Analytics job’s **overall** or end-to-end latency would typically be a few seconds.</span></span> <span data-ttu-id="9169f-144">Более подробное описание учитывает это задание Stream Analytics *особенно* hello вызовов функции машинного обучения.</span><span class="sxs-lookup"><span data-stu-id="9169f-144">Take a more detailed look into this Stream Analytics job, *especially* hello Machine Learning function calls.</span></span> <span data-ttu-id="9169f-145">Размер пакета hello, равными 1 000, пропускной способности 10 000 событий займет около 10 запросов tooweb службы.</span><span class="sxs-lookup"><span data-stu-id="9169f-145">Having hello batch size as 1000, a throughput of 10,000 events will take about 10 requests tooweb service.</span></span> <span data-ttu-id="9169f-146">Даже при наличии 1 SU имеется достаточное количество одновременных подключений tooaccommodate данный ввода трафика.</span><span class="sxs-lookup"><span data-stu-id="9169f-146">Even with 1 SU, there are enough concurrent connections tooaccommodate this input traffic.</span></span>

<span data-ttu-id="9169f-147">Но что делать, если частота hello входных событий увеличивается на 100 x и теперь задания Stream Analytics hello должен tooprocess 1 000 000 твиты в секунду?</span><span class="sxs-lookup"><span data-stu-id="9169f-147">But what if hello input event rate increases by 100x and now hello Stream Analytics job needs tooprocess 1,000,000 tweets per second?</span></span> <span data-ttu-id="9169f-148">Существуют два варианта:</span><span class="sxs-lookup"><span data-stu-id="9169f-148">There are two options:</span></span>

1. <span data-ttu-id="9169f-149">Увеличить размер пакета hello, или</span><span class="sxs-lookup"><span data-stu-id="9169f-149">Increase hello batch size, or</span></span>
2. <span data-ttu-id="9169f-150">События секции hello входного потока tooprocess hello параллельно</span><span class="sxs-lookup"><span data-stu-id="9169f-150">Partition hello input stream tooprocess hello events in parallel</span></span>

<span data-ttu-id="9169f-151">Первый параметр hello, hello задания **задержки** увеличится.</span><span class="sxs-lookup"><span data-stu-id="9169f-151">With hello first option, hello job **latency** will increase.</span></span>

<span data-ttu-id="9169f-152">Второй параметр hello дополнительные SUs бы должны подготовить toobe и таким образом создавать несколько параллельных запросов веб-службы машинного обучения.</span><span class="sxs-lookup"><span data-stu-id="9169f-152">With hello second option, more SUs would need toobe provisioned and therefore generate more concurrent Machine Learning web service requests.</span></span> <span data-ttu-id="9169f-153">Это означает задание hello **стоимость** увеличится.</span><span class="sxs-lookup"><span data-stu-id="9169f-153">This means hello job **cost** will increase.</span></span>

<span data-ttu-id="9169f-154">Предположим, что задержка hello анализ мнений hello веб-службы машинного обучения равна 200 мс для пакетов 1 000 событий или ниже, 250 секунд для пакетов 5 000 событий, 300 мс для пакетов 10 000 событий или 500 мс для пакетов 25 000 событий.</span><span class="sxs-lookup"><span data-stu-id="9169f-154">Assume hello latency of hello sentiment analysis Machine Learning web service is 200ms for 1000-event batches or below, 250ms for 5,000-event batches, 300ms for 10,000-event batches or 500ms for 25,000-event batches.</span></span>

1. <span data-ttu-id="9169f-155">С помощью hello первый вариант (**не** подготовки дополнительные SUs), hello размер пакета может увеличить слишком**25 000**.</span><span class="sxs-lookup"><span data-stu-id="9169f-155">Using hello first option, (**not** provisioning more SUs), hello batch size could be increased too**25,000**.</span></span> <span data-ttu-id="9169f-156">Это в свою очередь позволит hello задания tooprocess 1 000 000 событий с toohello 20 одновременных подключений веб-службы машинного обучения (с задержкой, равной 500 мс на один вызов).</span><span class="sxs-lookup"><span data-stu-id="9169f-156">This in turn would allow hello job tooprocess 1,000,000 events with 20 concurrent connections toohello Machine Learning web service (with a latency of 500ms per call).</span></span> <span data-ttu-id="9169f-157">Поэтому hello дополнительную задержку задания Stream Analytics hello из-за запросов функция toohello мнений hello машинного обучения, запросы веб-службы будет увеличиваться от **200 мс** слишком**500 мс**.</span><span class="sxs-lookup"><span data-stu-id="9169f-157">So hello additional latency of hello Stream Analytics job due toohello sentiment function requests against hello Machine Learning web service requests would be increased from **200ms** too**500ms**.</span></span> <span data-ttu-id="9169f-158">Однако обратите внимание, что размер пакета **нельзя** увеличить бесконечно hello веб-службы машинного обучения требуется hello размер полезных данных запроса 4 МБ или меньше веб-время ожидания запросов службы после 100 секунд операции.</span><span class="sxs-lookup"><span data-stu-id="9169f-158">However, note that batch size **cannot** be increased infinitely as hello Machine Learning web services requires hello payload size of a request be 4MB or smaller web service requests timeout after 100 seconds of operation.</span></span>
2. <span data-ttu-id="9169f-159">С помощью второй вариант hello, размер пакета hello остается в 1000, с задержкой службы web 200 мс, каждые 20 одновременных подключений toohello веб-службы будет события может tooprocess 1000 * 20 * 5 = 100 000 в секунду.</span><span class="sxs-lookup"><span data-stu-id="9169f-159">Using hello second option, hello batch size is left at 1000, with 200ms web service latency, every 20 concurrent connections toohello web service would be able tooprocess 1000 * 20 * 5 events = 100,000 per second.</span></span> <span data-ttu-id="9169f-160">Поэтому tooprocess 1 000 000 событий в во-вторых, задание hello, должны 60 SUs.</span><span class="sxs-lookup"><span data-stu-id="9169f-160">So tooprocess 1,000,000 events per second, hello job would need 60 SUs.</span></span> <span data-ttu-id="9169f-161">Сравниваемые toohello первый вариант — более веб-службы пакетные запросы, в свою очередь приведет к тому задания Stream Analytics Создание увеличение затрат.</span><span class="sxs-lookup"><span data-stu-id="9169f-161">Compared toohello first option, Stream Analytics job would make more web service batch requests, in turn generating an increased cost.</span></span>

<span data-ttu-id="9169f-162">Ниже приведена таблица для hello пропускной способности задания Stream Analytics hello для разных SUs и размер пакета (в число событий в секунду).</span><span class="sxs-lookup"><span data-stu-id="9169f-162">Below is a table for hello throughput of hello Stream Analytics job for different SUs and batch sizes (in number of events per second).</span></span>

| <span data-ttu-id="9169f-163">Размер пакета (задержка службы машинного обучения)</span><span class="sxs-lookup"><span data-stu-id="9169f-163">batch size (ML latency)</span></span> | <span data-ttu-id="9169f-164">500 (200 мс)</span><span class="sxs-lookup"><span data-stu-id="9169f-164">500 (200ms)</span></span> | <span data-ttu-id="9169f-165">1000 (200 мс)</span><span class="sxs-lookup"><span data-stu-id="9169f-165">1,000 (200ms)</span></span> | <span data-ttu-id="9169f-166">5000 (250 мс)</span><span class="sxs-lookup"><span data-stu-id="9169f-166">5,000 (250ms)</span></span> | <span data-ttu-id="9169f-167">10 000 (300 мс)</span><span class="sxs-lookup"><span data-stu-id="9169f-167">10,000 (300ms)</span></span> | <span data-ttu-id="9169f-168">25 000 (500 мс)</span><span class="sxs-lookup"><span data-stu-id="9169f-168">25,000 (500ms)</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="9169f-169">**1 единица хранения**</span><span class="sxs-lookup"><span data-stu-id="9169f-169">**1 SU**</span></span> |<span data-ttu-id="9169f-170">2500</span><span class="sxs-lookup"><span data-stu-id="9169f-170">2,500</span></span> |<span data-ttu-id="9169f-171">5 000</span><span class="sxs-lookup"><span data-stu-id="9169f-171">5,000</span></span> |<span data-ttu-id="9169f-172">20 000</span><span class="sxs-lookup"><span data-stu-id="9169f-172">20,000</span></span> |<span data-ttu-id="9169f-173">30 000</span><span class="sxs-lookup"><span data-stu-id="9169f-173">30,000</span></span> |<span data-ttu-id="9169f-174">50 000</span><span class="sxs-lookup"><span data-stu-id="9169f-174">50,000</span></span> |
| <span data-ttu-id="9169f-175">**3 единицы хранения**</span><span class="sxs-lookup"><span data-stu-id="9169f-175">**3 SUs**</span></span> |<span data-ttu-id="9169f-176">2500</span><span class="sxs-lookup"><span data-stu-id="9169f-176">2,500</span></span> |<span data-ttu-id="9169f-177">5 000</span><span class="sxs-lookup"><span data-stu-id="9169f-177">5,000</span></span> |<span data-ttu-id="9169f-178">20 000</span><span class="sxs-lookup"><span data-stu-id="9169f-178">20,000</span></span> |<span data-ttu-id="9169f-179">30 000</span><span class="sxs-lookup"><span data-stu-id="9169f-179">30,000</span></span> |<span data-ttu-id="9169f-180">50 000</span><span class="sxs-lookup"><span data-stu-id="9169f-180">50,000</span></span> |
| <span data-ttu-id="9169f-181">**6 единиц хранения**</span><span class="sxs-lookup"><span data-stu-id="9169f-181">**6 SUs**</span></span> |<span data-ttu-id="9169f-182">2500</span><span class="sxs-lookup"><span data-stu-id="9169f-182">2,500</span></span> |<span data-ttu-id="9169f-183">5 000</span><span class="sxs-lookup"><span data-stu-id="9169f-183">5,000</span></span> |<span data-ttu-id="9169f-184">20 000</span><span class="sxs-lookup"><span data-stu-id="9169f-184">20,000</span></span> |<span data-ttu-id="9169f-185">30 000</span><span class="sxs-lookup"><span data-stu-id="9169f-185">30,000</span></span> |<span data-ttu-id="9169f-186">50 000</span><span class="sxs-lookup"><span data-stu-id="9169f-186">50,000</span></span> |
| <span data-ttu-id="9169f-187">**12 единиц хранения**</span><span class="sxs-lookup"><span data-stu-id="9169f-187">**12 SUs**</span></span> |<span data-ttu-id="9169f-188">5 000</span><span class="sxs-lookup"><span data-stu-id="9169f-188">5,000</span></span> |<span data-ttu-id="9169f-189">10 000</span><span class="sxs-lookup"><span data-stu-id="9169f-189">10,000</span></span> |<span data-ttu-id="9169f-190">40 000</span><span class="sxs-lookup"><span data-stu-id="9169f-190">40,000</span></span> |<span data-ttu-id="9169f-191">60 000</span><span class="sxs-lookup"><span data-stu-id="9169f-191">60,000</span></span> |<span data-ttu-id="9169f-192">100 000</span><span class="sxs-lookup"><span data-stu-id="9169f-192">100,000</span></span> |
| <span data-ttu-id="9169f-193">**18 единиц хранения**</span><span class="sxs-lookup"><span data-stu-id="9169f-193">**18 SUs**</span></span> |<span data-ttu-id="9169f-194">7500</span><span class="sxs-lookup"><span data-stu-id="9169f-194">7,500</span></span> |<span data-ttu-id="9169f-195">15 000</span><span class="sxs-lookup"><span data-stu-id="9169f-195">15,000</span></span> |<span data-ttu-id="9169f-196">60 000</span><span class="sxs-lookup"><span data-stu-id="9169f-196">60,000</span></span> |<span data-ttu-id="9169f-197">90 000</span><span class="sxs-lookup"><span data-stu-id="9169f-197">90,000</span></span> |<span data-ttu-id="9169f-198">150 000</span><span class="sxs-lookup"><span data-stu-id="9169f-198">150,000</span></span> |
| <span data-ttu-id="9169f-199">**24 единицы хранения**</span><span class="sxs-lookup"><span data-stu-id="9169f-199">**24 SUs**</span></span> |<span data-ttu-id="9169f-200">10 000</span><span class="sxs-lookup"><span data-stu-id="9169f-200">10,000</span></span> |<span data-ttu-id="9169f-201">20 000</span><span class="sxs-lookup"><span data-stu-id="9169f-201">20,000</span></span> |<span data-ttu-id="9169f-202">80 000</span><span class="sxs-lookup"><span data-stu-id="9169f-202">80,000</span></span> |<span data-ttu-id="9169f-203">120 000</span><span class="sxs-lookup"><span data-stu-id="9169f-203">120,000</span></span> |<span data-ttu-id="9169f-204">200 000</span><span class="sxs-lookup"><span data-stu-id="9169f-204">200,000</span></span> |
| <span data-ttu-id="9169f-205">**…**</span><span class="sxs-lookup"><span data-stu-id="9169f-205">**…**</span></span> |<span data-ttu-id="9169f-206">…</span><span class="sxs-lookup"><span data-stu-id="9169f-206">…</span></span> |<span data-ttu-id="9169f-207">…</span><span class="sxs-lookup"><span data-stu-id="9169f-207">…</span></span> |<span data-ttu-id="9169f-208">…</span><span class="sxs-lookup"><span data-stu-id="9169f-208">…</span></span> |<span data-ttu-id="9169f-209">…</span><span class="sxs-lookup"><span data-stu-id="9169f-209">…</span></span> |<span data-ttu-id="9169f-210">…</span><span class="sxs-lookup"><span data-stu-id="9169f-210">…</span></span> |
| <span data-ttu-id="9169f-211">**60 единиц хранения**</span><span class="sxs-lookup"><span data-stu-id="9169f-211">**60 SUs**</span></span> |<span data-ttu-id="9169f-212">25 000</span><span class="sxs-lookup"><span data-stu-id="9169f-212">25,000</span></span> |<span data-ttu-id="9169f-213">50 000</span><span class="sxs-lookup"><span data-stu-id="9169f-213">50,000</span></span> |<span data-ttu-id="9169f-214">200 000</span><span class="sxs-lookup"><span data-stu-id="9169f-214">200,000</span></span> |<span data-ttu-id="9169f-215">300 000</span><span class="sxs-lookup"><span data-stu-id="9169f-215">300,000</span></span> |<span data-ttu-id="9169f-216">500 000</span><span class="sxs-lookup"><span data-stu-id="9169f-216">500,000</span></span> |

<span data-ttu-id="9169f-217">Теперь у вас есть четкое представление о том, как работают функции машинного обучения в Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="9169f-217">By now, you should already have a good understanding of how Machine Learning functions in Stream Analytics work.</span></span> <span data-ttu-id="9169f-218">Скорее всего знание Здравствуйте, «pull» данных из источников данных и каждый «pull» возвращает пакет событий для задания Stream Analytics tooprocess задания Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="9169f-218">You likely also understand that Stream Analytics jobs “pull” data from data sources and each “pull” returns a batch of events for hello Stream Analytics job tooprocess.</span></span> <span data-ttu-id="9169f-219">Как модель, обеспечивающая извлечение влиять запросов hello машинного обучения для веб-службы</span><span class="sxs-lookup"><span data-stu-id="9169f-219">How does this pull model impact hello Machine Learning web service requests?</span></span>

<span data-ttu-id="9169f-220">Как правило размер пакета hello, которым мы используем для функций машинного обучения не будут точно кратных hello число возвращаемых событий, каждому заданию Stream Analytics «pull».</span><span class="sxs-lookup"><span data-stu-id="9169f-220">Normally, hello batch size we set for Machine Learning functions won’t exactly be divisible by hello number of events returned by each Stream Analytics job “pull”.</span></span> <span data-ttu-id="9169f-221">Когда это происходит hello веб-службы машинного обучения будет вызываться с «частичная» пакетов.</span><span class="sxs-lookup"><span data-stu-id="9169f-221">When this occurs hello Machine Learning web service will be called with “partial” batches.</span></span> <span data-ttu-id="9169f-222">Это делается toonot привести к задержке дополнительных заданий издержек на объединяющую события из toopull запросу.</span><span class="sxs-lookup"><span data-stu-id="9169f-222">This is done toonot incur additional job latency overhead in coalescing events from pull toopull.</span></span>

## <a name="new-function-related-monitoring-metrics"></a><span data-ttu-id="9169f-223">Новые метрики мониторинга, связанные с функциями</span><span class="sxs-lookup"><span data-stu-id="9169f-223">New function-related monitoring metrics</span></span>
<span data-ttu-id="9169f-224">В hello области монитора задания Stream Analytics были добавлены три дополнительные метрики, связанные с функцией.</span><span class="sxs-lookup"><span data-stu-id="9169f-224">In hello Monitor area of a Stream Analytics job, three additional function-related metrics have been added.</span></span> <span data-ttu-id="9169f-225">Это ФУНКЦИЯ запросы, СОБЫТИЯ функции и НЕУДАЧНЫЕ запросы функции, как показано на следующем рисунке hello.</span><span class="sxs-lookup"><span data-stu-id="9169f-225">They are FUNCTION REQUESTS, FUNCTION EVENTS and FAILED FUNCTION REQUESTS, as shown in hello graphic below.</span></span>

<span data-ttu-id="9169f-226">![Метрики масштабирования Stream Analytics с использованием функций машинного обучения](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-01.png "Метрики масштабирования Stream Analytics с использованием функций машинного обучения")</span><span class="sxs-lookup"><span data-stu-id="9169f-226">![Scale Stream Analytics with Machine Learning Functions Metrics](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-01.png "Scale Stream Analytics with Machine Learning Functions Metrics")</span></span>

<span data-ttu-id="9169f-227">Привет, определяются следующим образом:</span><span class="sxs-lookup"><span data-stu-id="9169f-227">hello are defined as follows:</span></span>

<span data-ttu-id="9169f-228">**ФУНКЦИИ ЗАПРОСОВ**: число запросов функции hello.</span><span class="sxs-lookup"><span data-stu-id="9169f-228">**FUNCTION REQUESTS**: hello number of function requests.</span></span>

<span data-ttu-id="9169f-229">**СОБЫТИЯ функции**: hello число событий в hello функции запросов.</span><span class="sxs-lookup"><span data-stu-id="9169f-229">**FUNCTION EVENTS**: hello number events in hello function requests.</span></span>

<span data-ttu-id="9169f-230">**НЕУДАЧНЫЕ запросы ФУНКЦИЯ**: hello число запросов, функции, завершившейся сбоем.</span><span class="sxs-lookup"><span data-stu-id="9169f-230">**FAILED FUNCTION REQUESTS**: hello number of failed function requests.</span></span>

## <a name="key-takeaways"></a><span data-ttu-id="9169f-231">Общие выводы</span><span class="sxs-lookup"><span data-stu-id="9169f-231">Key Takeaways</span></span>
<span data-ttu-id="9169f-232">toosummarize hello основных целей, tooscale порядок задания Stream Analytics с функциями машинного обучения hello следующие элементы необходимо учитывать.</span><span class="sxs-lookup"><span data-stu-id="9169f-232">toosummarize hello main points, in order tooscale an Stream Analytics job with Machine Learning functions, hello following items must be considered:</span></span>

1. <span data-ttu-id="9169f-233">частота события ввода Hello</span><span class="sxs-lookup"><span data-stu-id="9169f-233">hello input event rate</span></span>
2. <span data-ttu-id="9169f-234">Hello, которое должно пройти задержки для запуска задания Stream Analytics hello (и тем самым размер пакета hello веб-службы машинного обучения hello запрашивает)</span><span class="sxs-lookup"><span data-stu-id="9169f-234">hello tolerated latency for hello running Stream Analytics job (and thus hello batch size of hello Machine Learning web service requests)</span></span>
3. <span data-ttu-id="9169f-235">подготовить Hello Stream Analytics SUs и hello число запросов веб-службы машинного обучения (hello дополнительные функции затраты, связанные с)</span><span class="sxs-lookup"><span data-stu-id="9169f-235">hello provisioned Stream Analytics SUs and hello number of Machine Learning web service requests (hello additional function-related costs)</span></span>

<span data-ttu-id="9169f-236">В качестве примера был использован полностью секционированный запрос Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="9169f-236">A fully partitioned Stream Analytics query was used as an example.</span></span> <span data-ttu-id="9169f-237">Если требуется более сложный запрос hello [форум Azure Stream Analytics](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics) — это отличный ресурс для получения дополнительных сведений от команды hello Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="9169f-237">If a more complex query is needed hello [Azure Stream Analytics forum](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics) is a great resource for getting additional help from hello Stream Analytics team.</span></span>

## <a name="next-steps"></a><span data-ttu-id="9169f-238">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="9169f-238">Next steps</span></span>
<span data-ttu-id="9169f-239">toolearn Дополнительные сведения о Stream Analytics см.:</span><span class="sxs-lookup"><span data-stu-id="9169f-239">toolearn more about Stream Analytics, see:</span></span>

* [<span data-ttu-id="9169f-240">Приступая к работе с Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="9169f-240">Get started using Azure Stream Analytics</span></span>](stream-analytics-real-time-fraud-detection.md)
* [<span data-ttu-id="9169f-241">Масштабирование заданий в службе Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="9169f-241">Scale Azure Stream Analytics jobs</span></span>](stream-analytics-scale-jobs.md)
* [<span data-ttu-id="9169f-242">Справочник по языку запросов Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="9169f-242">Azure Stream Analytics Query Language Reference</span></span>](https://msdn.microsoft.com/library/azure/dn834998.aspx)
* [<span data-ttu-id="9169f-243">Справочник по API-интерфейсу REST управления Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="9169f-243">Azure Stream Analytics Management REST API Reference</span></span>](https://msdn.microsoft.com/library/azure/dn835031.aspx)
