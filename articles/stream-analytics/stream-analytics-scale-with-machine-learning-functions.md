---
title: "с помощью функции Azure Stream Analytics & AzureML aaaJob | Документы Microsoft"
description: "Узнайте, как tooproperly масштабировать заданий Stream Analytics (секционирование, SU количество и многое другое) при использовании функции машинного обучения Azure."
keywords: 
documentationcenter: 
services: stream-analytics
author: jeffstokes72
manager: jhubbard
editor: cgronlun
ms.assetid: 47ce7c5e-1de1-41ca-9a26-b5ecce814743
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: jeffstok
ms.openlocfilehash: 3fbdfaf7e8e86896c56f1d18bbde3a10bd3dca04
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="scale-your-stream-analytics-job-with-azure-machine-learning-functions"></a>Масштабирование заданий Stream Analytics с помощью функций машинного обучения Azure
Он часто является довольно просто tooset задание Stream Analytics и выполните его образцами данных. Что необходимо сделать в случае необходимости toorun hello же задания с высоким объемом данных? Он требует toounderstand как задания tooconfigure hello Stream Analytics, чтобы они будут масштабироваться. В этом документе рассматривается hello особые аспекты масштабирования Stream Analytics задания с помощью функций машинного обучения. Сведения о как tooscale заданий Stream Analytics в целом. в статье hello [масштабированию заданий](stream-analytics-scale-jobs.md).

## <a name="what-is-an-azure-machine-learning-function-in-stream-analytics"></a>Что такое функция машинного обучения Azure в Stream Analytics?
Функции машинного обучения в Stream Analytics может использоваться как при обычном вызове функции в язык запросов Stream Analytics hello. Однако за сценой hello вызовов функций hello, фактически запросы веб-служба Azure Machine Learning. Веб-машины обучения службы поддержки «Пакетная обработка» несколько строк, называемый мини-пакета, в hello же вызова веб-службы API, tooimprove общую пропускную способность. См. в разделе hello следующие статьи для получения дополнительных сведений; [Функции машинного обучения azure в Stream Analytics](https://blogs.technet.microsoft.com/machinelearning/2015/12/10/azure-ml-now-available-as-a-function-in-azure-stream-analytics/) и [веб-службы Azure Machine Learning](../machine-learning/machine-learning-consume-web-services.md).

## <a name="configure-a-stream-analytics-job-with-machine-learning-functions"></a>Настройка задания Stream Analytics с помощью функций машинного обучения
При настройке функции машинного обучения для задания Stream Analytics, существует два tooconsider параметров, размер пакета hello вызовов функции hello машинного обучения и hello единицы (SUs), подготовленных для задания Stream Analytics hello потоковой передачи. toodetermine hello соответствующие значения для этих сначала решение должно быть принято между задержка и пропускная способность, то есть задержки задания Stream Analytics hello и пропускная способность каждого SU. SUs всегда добавляются tooa tooincrease по заданию для оптимально секционирована запросов Stream Analytics, несмотря на то, что дополнительные SUs увеличивает затраты на выполнение задания hello hello.

Поэтому очень важно toodetermine hello *отклонения* задержки в выполнении задания Stream Analytics. Дополнительная задержка выполнения запросов на обслуживание машинного обучения Azure естественным образом увеличивается с размер пакета, который будет составные задержки hello задания Stream Analytics hello. На hello другой стороны, увеличение размера пакета позволяет tooprocess задания Stream Analytics hello * несколько событий с hello *одинаковый номер* машинного обучения запросов веб-службы. Часто hello увеличение задержки службы web машинного обучения является вложенным линейной toohello увеличение размера пакета, поэтому важно tooconsider hello наиболее эффективный размер пакета с веб-службы машинного обучения в данной ситуации. запрашивает размер пакета по умолчанию Hello hello веб-службы — 1000 и может быть изменен с помощью hello [Stream Analytics REST API](https://msdn.microsoft.com/library/mt653706.aspx "Stream Analytics REST API") или hello [PowerShell клиента для Stream Analytics](stream-analytics-monitor-and-manage-jobs-use-powershell.md "PowerShell клиента для Stream Analytics").

После определения размера пакета hello объем потоковой передачи единицы (SUs) можно было определить, на основе hello число событий, функции hello должен tooprocess в секунду. Дополнительные сведения о единицах потоковой передачи см. в статье [Масштабирование заданий Azure Stream Analytics для повышения пропускной способности базы данных](stream-analytics-scale-jobs.md).

Как правило существует 20 одновременных подключений веб-службы машинного обучения toohello каждые 6 SUs, за исключением того, что 1 SU и 3 SU задания будет получать 20 одновременных подключений также.  Например если скорость hello входных данных составляет 200 000 событий в секунду и оставшийся размер пакета hello toohello по умолчанию 1000 hello полученный web службы времени задержки с помощью мини-пакета 1000 событий составляет 200 мс. Это означает, что каждый раз при подключении могут осуществлять 5 запросы веб-службы машинного обучения toohello в секунду. С 20 соединений hello задания Stream Analytics может обрабатывать события 20 000 200 мс и поэтому 100 000 событий в секунду. Поэтому tooprocess 200 000 событий в секунду, задание Stream Analytics hello должен 40 одновременных подключений, который выйдет too12 SUs. Hello приведенной ниже схеме показано hello запросы от hello Stream Analytics задания toohello машинного обучения конечной веб-службы — каждые 6 SUs содержит 20 одновременных подключений tooMachine обучения веб-службы в max.

![Пример: масштабирование 2 заданий Stream Analytics с помощью функций машинного обучения](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-00.png "Пример: масштабирование 2 заданий Stream Analytics с помощью функций машинного обучения")

Как правило ***B*** размер пакета ***L*** для hello web service задержки при размере пакета B в миллисекундах, hello пропускной способности задания Stream Analytics с ***N*** SUs является:

![Формула масштабирования Stream Analytics с использованием функций машинного обучения](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-02.png "Формула масштабирования Stream Analytics с использованием функций машинного обучения")

Иногда может быть hello «max параллельных запросов» hello web машинного обучения на стороне службы, рекомендуется tooset toohello максимальное значение (в настоящее время 200).

Дополнительные сведения об этом параметре см. в статье hello [масштабирование статьи для веб-службы обучения машины](../machine-learning/machine-learning-scaling-webservice.md).

## <a name="example--sentiment-analysis"></a>Пример: анализ мнений
Hello следующий пример включает задания Stream Analytics с помощью функций анализа мнений hello функции машинного обучения, как описано в hello [учебник по службам integration Stream Analytics машинного обучения](stream-analytics-machine-learning-integration-tutorial.md).

Hello это простой полностью секционированных запрос следуют hello **мнений** функции, как показано ниже:

    WITH subquery AS (
        SELECT text, sentiment(text) as result from input
    )

    Select text, result.[Score]
    Into output
    From subquery

Рассмотрим следующие сценарии; hello с пропускной способностью 10 000 твиты в секунду задания Stream Analytics необходимо создать анализ мнений tooperform твиты hello (события). С помощью 1 SU, это задание Stream Analytics удалось может toohandle hello трафика? Размер пакета по умолчанию hello 1000 hello задания с помощью должен быть доступ tookeep вверх с hello входных данных. Дальнейшие hello добавить функцию машинного обучения должна создавать не более секунды задержки — задержка по умолчанию общие hello анализа мнений hello веб-службы машинного обучения (с размером пакета по умолчанию 1000). Задание Stream Analytics Hello **общую** или конца в конец задержка, обычно используется, через несколько секунд. Более подробное описание учитывает это задание Stream Analytics *особенно* hello вызовов функции машинного обучения. Размер пакета hello, равными 1 000, пропускной способности 10 000 событий займет около 10 запросов tooweb службы. Даже при наличии 1 SU имеется достаточное количество одновременных подключений tooaccommodate данный ввода трафика.

Но что делать, если частота hello входных событий увеличивается на 100 x и теперь задания Stream Analytics hello должен tooprocess 1 000 000 твиты в секунду? Существуют два варианта:

1. Увеличить размер пакета hello, или
2. События секции hello входного потока tooprocess hello параллельно

Первый параметр hello, hello задания **задержки** увеличится.

Второй параметр hello дополнительные SUs бы должны подготовить toobe и таким образом создавать несколько параллельных запросов веб-службы машинного обучения. Это означает задание hello **стоимость** увеличится.

Предположим, что задержка hello анализ мнений hello веб-службы машинного обучения равна 200 мс для пакетов 1 000 событий или ниже, 250 секунд для пакетов 5 000 событий, 300 мс для пакетов 10 000 событий или 500 мс для пакетов 25 000 событий.

1. С помощью hello первый вариант (**не** подготовки дополнительные SUs), hello размер пакета может увеличить слишком**25 000**. Это в свою очередь позволит hello задания tooprocess 1 000 000 событий с toohello 20 одновременных подключений веб-службы машинного обучения (с задержкой, равной 500 мс на один вызов). Поэтому hello дополнительную задержку задания Stream Analytics hello из-за запросов функция toohello мнений hello машинного обучения, запросы веб-службы будет увеличиваться от **200 мс** слишком**500 мс**. Однако обратите внимание, что размер пакета **нельзя** увеличить бесконечно hello веб-службы машинного обучения требуется hello размер полезных данных запроса 4 МБ или меньше веб-время ожидания запросов службы после 100 секунд операции.
2. С помощью второй вариант hello, размер пакета hello остается в 1000, с задержкой службы web 200 мс, каждые 20 одновременных подключений toohello веб-службы будет события может tooprocess 1000 * 20 * 5 = 100 000 в секунду. Поэтому tooprocess 1 000 000 событий в во-вторых, задание hello, должны 60 SUs. Сравниваемые toohello первый вариант — более веб-службы пакетные запросы, в свою очередь приведет к тому задания Stream Analytics Создание увеличение затрат.

Ниже приведена таблица для hello пропускной способности задания Stream Analytics hello для разных SUs и размер пакета (в число событий в секунду).

| Размер пакета (задержка службы машинного обучения) | 500 (200 мс) | 1000 (200 мс) | 5000 (250 мс) | 10 000 (300 мс) | 25 000 (500 мс) |
| --- | --- | --- | --- | --- | --- |
| **1 единица хранения** |2500 |5 000 |20 000 |30 000 |50 000 |
| **3 единицы хранения** |2500 |5 000 |20 000 |30 000 |50 000 |
| **6 единиц хранения** |2500 |5 000 |20 000 |30 000 |50 000 |
| **12 единиц хранения** |5 000 |10 000 |40 000 |60 000 |100 000 |
| **18 единиц хранения** |7500 |15 000 |60 000 |90 000 |150 000 |
| **24 единицы хранения** |10 000 |20 000 |80 000 |120 000 |200 000 |
| **…** |… |… |… |… |… |
| **60 единиц хранения** |25 000 |50 000 |200 000 |300 000 |500 000 |

Теперь у вас есть четкое представление о том, как работают функции машинного обучения в Stream Analytics. Скорее всего знание Здравствуйте, «pull» данных из источников данных и каждый «pull» возвращает пакет событий для задания Stream Analytics tooprocess задания Stream Analytics. Как модель, обеспечивающая извлечение влиять запросов hello машинного обучения для веб-службы

Как правило размер пакета hello, которым мы используем для функций машинного обучения не будут точно кратных hello число возвращаемых событий, каждому заданию Stream Analytics «pull». Когда это происходит hello веб-службы машинного обучения будет вызываться с «частичная» пакетов. Это делается toonot привести к задержке дополнительных заданий издержек на объединяющую события из toopull запросу.

## <a name="new-function-related-monitoring-metrics"></a>Новые метрики мониторинга, связанные с функциями
В hello области монитора задания Stream Analytics были добавлены три дополнительные метрики, связанные с функцией. Это ФУНКЦИЯ запросы, СОБЫТИЯ функции и НЕУДАЧНЫЕ запросы функции, как показано на следующем рисунке hello.

![Метрики масштабирования Stream Analytics с использованием функций машинного обучения](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-01.png "Метрики масштабирования Stream Analytics с использованием функций машинного обучения")

Привет, определяются следующим образом:

**ФУНКЦИИ ЗАПРОСОВ**: число запросов функции hello.

**СОБЫТИЯ функции**: hello число событий в hello функции запросов.

**НЕУДАЧНЫЕ запросы ФУНКЦИЯ**: hello число запросов, функции, завершившейся сбоем.

## <a name="key-takeaways"></a>Общие выводы
toosummarize hello основных целей, tooscale порядок задания Stream Analytics с функциями машинного обучения hello следующие элементы необходимо учитывать.

1. частота события ввода Hello
2. Hello, которое должно пройти задержки для запуска задания Stream Analytics hello (и тем самым размер пакета hello веб-службы машинного обучения hello запрашивает)
3. подготовить Hello Stream Analytics SUs и hello число запросов веб-службы машинного обучения (hello дополнительные функции затраты, связанные с)

В качестве примера был использован полностью секционированный запрос Stream Analytics. Если требуется более сложный запрос hello [форум Azure Stream Analytics](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics) — это отличный ресурс для получения дополнительных сведений от команды hello Stream Analytics.

## <a name="next-steps"></a>Дальнейшие действия
toolearn Дополнительные сведения о Stream Analytics см.:

* [Приступая к работе с Azure Stream Analytics](stream-analytics-real-time-fraud-detection.md)
* [Масштабирование заданий в службе Azure Stream Analytics](stream-analytics-scale-jobs.md)
* [Справочник по языку запросов Azure Stream Analytics](https://msdn.microsoft.com/library/azure/dn834998.aspx)
* [Справочник по API-интерфейсу REST управления Stream Analytics](https://msdn.microsoft.com/library/azure/dn835031.aspx)
