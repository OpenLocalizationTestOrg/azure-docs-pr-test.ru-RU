---
title: "aaaBuild решения IoT с помощью Stream Analytics | Документы Microsoft"
description: "Приступая к работе учебника для решения Stream Analytics IoT сценарий пропускного пункта hello"
keywords: "Решение IOT, функции окна"
documentationcenter: 
services: stream-analytics
author: samacha
manager: jhubbard
editor: cgronlun
ms.assetid: a473ea0a-3eaa-4e5b-aaa1-fec7e9069f20
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: samacha
ms.openlocfilehash: e37fc5b56c4ffc4a2d7b820afe0c17631e577ea0
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="build-an-iot-solution-by-using-stream-analytics"></a><span data-ttu-id="2b438-104">Создание решения IoT с помощью Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="2b438-104">Build an IoT solution by using Stream Analytics</span></span>
## <a name="introduction"></a><span data-ttu-id="2b438-105">Введение</span><span class="sxs-lookup"><span data-stu-id="2b438-105">Introduction</span></span>
<span data-ttu-id="2b438-106">В этом учебнике вы узнаете, как toouse Azure Stream Analytics tooget в режиме реального времени аналитики из данных.</span><span class="sxs-lookup"><span data-stu-id="2b438-106">In this tutorial, you will learn how toouse Azure Stream Analytics tooget real-time insights from your data.</span></span> <span data-ttu-id="2b438-107">Разработчикам легко объединять потоки данных, таких как щелчок потоки, журналы и события, вызываемые устройства, с помощью записей журнала или ссылку данных tooderive бизнес-аналитики.</span><span class="sxs-lookup"><span data-stu-id="2b438-107">Developers can easily combine streams of data, such as click-streams, logs, and device-generated events, with historical records or reference data tooderive business insights.</span></span> <span data-ttu-id="2b438-108">Как служба вычисления потока полностью управляемыми, в режиме реального времени, размещенном в Microsoft Azure Azure Stream Analytics предоставляет гибкость встроенными функциями, небольших задержек и масштабируемость tooget подготовки к работе в минутах.</span><span class="sxs-lookup"><span data-stu-id="2b438-108">As a fully managed, real-time stream computation service that's hosted in Microsoft Azure, Azure Stream Analytics provides built-in resiliency, low latency, and scalability tooget you up and running in minutes.</span></span>

<span data-ttu-id="2b438-109">После работы с этим учебником вы сможете выполнить следующие задачи:</span><span class="sxs-lookup"><span data-stu-id="2b438-109">After completing this tutorial, you will be able to:</span></span>

* <span data-ttu-id="2b438-110">Ознакомьтесь с портала Azure Stream Analytics hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-110">Familiarize yourself with hello Azure Stream Analytics portal.</span></span>
* <span data-ttu-id="2b438-111">Настроить и развернуть задание потоковой передачи.</span><span class="sxs-lookup"><span data-stu-id="2b438-111">Configure and deploy a streaming job.</span></span>
* <span data-ttu-id="2b438-112">Сформулировать реальных проблем и их решения с помощью языка запросов Stream Analytics hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-112">Articulate real-world problems and solve them by using hello Stream Analytics query language.</span></span>
* <span data-ttu-id="2b438-113">Уверенно разрабатывать решения потоковой передачи для клиентов с помощью Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="2b438-113">Develop streaming solutions for your customers by using Stream Analytics with confidence.</span></span>
* <span data-ttu-id="2b438-114">Используйте hello мониторинга и ведения журнала tootroubleshoot проблемы качества.</span><span class="sxs-lookup"><span data-stu-id="2b438-114">Use hello monitoring and logging experience tootroubleshoot issues.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="2b438-115">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="2b438-115">Prerequisites</span></span>
<span data-ttu-id="2b438-116">Вам будет необходимо hello следующие необходимые условия toocomplete этого учебника:</span><span class="sxs-lookup"><span data-stu-id="2b438-116">You will need hello following prerequisites toocomplete this tutorial:</span></span>

* <span data-ttu-id="2b438-117">Hello последнюю версию [Azure PowerShell](/powershell/azure/overview)</span><span class="sxs-lookup"><span data-stu-id="2b438-117">hello latest version of [Azure PowerShell](/powershell/azure/overview)</span></span>
* <span data-ttu-id="2b438-118">Visual Studio 2017 г., 2015 г., или hello свободного [Visual Studio Community](https://www.visualstudio.com/products/visual-studio-community-vs.aspx)</span><span class="sxs-lookup"><span data-stu-id="2b438-118">Visual Studio 2017, 2015, or hello free [Visual Studio Community](https://www.visualstudio.com/products/visual-studio-community-vs.aspx)</span></span>
* <span data-ttu-id="2b438-119">[Подписка Azure](https://azure.microsoft.com/pricing/free-trial/)</span><span class="sxs-lookup"><span data-stu-id="2b438-119">An [Azure subscription](https://azure.microsoft.com/pricing/free-trial/)</span></span>
* <span data-ttu-id="2b438-120">Права администратора на компьютере hello</span><span class="sxs-lookup"><span data-stu-id="2b438-120">Administrative privileges on hello computer</span></span>
* <span data-ttu-id="2b438-121">Время ожидания загрузки [TollApp.zip](https://github.com/Azure/azure-stream-analytics/blob/master/Samples/TollApp/TollApp.zip) из центра загрузки Майкрософт hello</span><span class="sxs-lookup"><span data-stu-id="2b438-121">Download of [TollApp.zip](https://github.com/Azure/azure-stream-analytics/blob/master/Samples/TollApp/TollApp.zip) from hello Microsoft Download Center</span></span>
* <span data-ttu-id="2b438-122">Необязательно: Исходный код для генератора событий TollApp hello в [GitHub](https://aka.ms/azure-stream-analytics-toll-source)</span><span class="sxs-lookup"><span data-stu-id="2b438-122">Optional: Source code for hello TollApp event generator in [GitHub](https://aka.ms/azure-stream-analytics-toll-source)</span></span>

## <a name="scenario-introduction-hello-toll"></a><span data-ttu-id="2b438-123">Введение в сценарий "Hello, Toll!"</span><span class="sxs-lookup"><span data-stu-id="2b438-123">Scenario introduction: “Hello, Toll!”</span></span>
<span data-ttu-id="2b438-124">Станции сбора дорожной платы представляют собой распространенное явление.</span><span class="sxs-lookup"><span data-stu-id="2b438-124">A toll station is a common phenomenon.</span></span> <span data-ttu-id="2b438-125">Можно встретить на многих скоростных, мосты и туннели между Здравствуй, мир!.</span><span class="sxs-lookup"><span data-stu-id="2b438-125">You encounter them on many expressways, bridges, and tunnels across hello world.</span></span> <span data-ttu-id="2b438-126">Каждая станция имеет несколько пунктов сбора платы.</span><span class="sxs-lookup"><span data-stu-id="2b438-126">Each toll station has multiple toll booths.</span></span> <span data-ttu-id="2b438-127">В ручной стенды остановить toopay hello платный tooan помощника.</span><span class="sxs-lookup"><span data-stu-id="2b438-127">At manual booths, you stop toopay hello toll tooan attendant.</span></span> <span data-ttu-id="2b438-128">В автоматических стенды датчика на основе каждого оплаты считывает RFID-карту, прикрепленную toohello ветровое стекло автомобиля, при проезде через кабинку hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-128">At automated booths, a sensor on top of each booth scans an RFID card that's affixed toohello windshield of your vehicle as you pass hello toll booth.</span></span> <span data-ttu-id="2b438-129">Это легко toovisualize hello проезд автомобилей через эти станции платный как поток событий, по которому интересные операции.</span><span class="sxs-lookup"><span data-stu-id="2b438-129">It is easy toovisualize hello passage of vehicles through these toll stations as an event stream over which interesting operations can be performed.</span></span>

![Изображение автомобилей в пунктах сбора платы](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image1.jpg)

## <a name="incoming-data"></a><span data-ttu-id="2b438-131">Входящие данные</span><span class="sxs-lookup"><span data-stu-id="2b438-131">Incoming data</span></span>
<span data-ttu-id="2b438-132">В этом руководстве используется два потока данных.</span><span class="sxs-lookup"><span data-stu-id="2b438-132">This tutorial works with two streams of data.</span></span> <span data-ttu-id="2b438-133">Датчики устанавливаются в hello вход и выход станций платный hello создания первого потока hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-133">Sensors installed in hello entrance and exit of hello toll stations produce hello first stream.</span></span> <span data-ttu-id="2b438-134">Второй поток Hello — набора статических Уточняющий запрос, который имеет регистрационные данные машина.</span><span class="sxs-lookup"><span data-stu-id="2b438-134">hello second stream is a static lookup dataset that has vehicle registration data.</span></span>

### <a name="entry-data-stream"></a><span data-ttu-id="2b438-135">Входной поток данных</span><span class="sxs-lookup"><span data-stu-id="2b438-135">Entry data stream</span></span>
<span data-ttu-id="2b438-136">поток данных Hello запись содержит сведения о автомобили вводе платный станции.</span><span class="sxs-lookup"><span data-stu-id="2b438-136">hello entry data stream contains information about cars as they enter toll stations.</span></span>

| <span data-ttu-id="2b438-137">ИД пункта сбора</span><span class="sxs-lookup"><span data-stu-id="2b438-137">TollID</span></span> | <span data-ttu-id="2b438-138">Время въезда</span><span class="sxs-lookup"><span data-stu-id="2b438-138">EntryTime</span></span> | <span data-ttu-id="2b438-139">LicensePlate</span><span class="sxs-lookup"><span data-stu-id="2b438-139">LicensePlate</span></span> | <span data-ttu-id="2b438-140">Состояние</span><span class="sxs-lookup"><span data-stu-id="2b438-140">State</span></span> | <span data-ttu-id="2b438-141">Убедитесь,</span><span class="sxs-lookup"><span data-stu-id="2b438-141">Make</span></span> | <span data-ttu-id="2b438-142">Модель</span><span class="sxs-lookup"><span data-stu-id="2b438-142">Model</span></span> | <span data-ttu-id="2b438-143">Тип транспортного средства</span><span class="sxs-lookup"><span data-stu-id="2b438-143">VehicleType</span></span> | <span data-ttu-id="2b438-144">Вес транспортного средства</span><span class="sxs-lookup"><span data-stu-id="2b438-144">VehicleWeight</span></span> | <span data-ttu-id="2b438-145">Плата</span><span class="sxs-lookup"><span data-stu-id="2b438-145">Toll</span></span> | <span data-ttu-id="2b438-146">Тег</span><span class="sxs-lookup"><span data-stu-id="2b438-146">Tag</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="2b438-147">1</span><span class="sxs-lookup"><span data-stu-id="2b438-147">1</span></span> |<span data-ttu-id="2b438-148">10.09.2014 12:01:00.000</span><span class="sxs-lookup"><span data-stu-id="2b438-148">2014-09-10 12:01:00.000</span></span> |<span data-ttu-id="2b438-149">JNB 7001</span><span class="sxs-lookup"><span data-stu-id="2b438-149">JNB 7001</span></span> |<span data-ttu-id="2b438-150">Нью-Йорк</span><span class="sxs-lookup"><span data-stu-id="2b438-150">NY</span></span> |<span data-ttu-id="2b438-151">Honda</span><span class="sxs-lookup"><span data-stu-id="2b438-151">Honda</span></span> |<span data-ttu-id="2b438-152">CRV</span><span class="sxs-lookup"><span data-stu-id="2b438-152">CRV</span></span> |<span data-ttu-id="2b438-153">1</span><span class="sxs-lookup"><span data-stu-id="2b438-153">1</span></span> |<span data-ttu-id="2b438-154">0</span><span class="sxs-lookup"><span data-stu-id="2b438-154">0</span></span> |<span data-ttu-id="2b438-155">7</span><span class="sxs-lookup"><span data-stu-id="2b438-155">7</span></span> | |
| <span data-ttu-id="2b438-156">1</span><span class="sxs-lookup"><span data-stu-id="2b438-156">1</span></span> |<span data-ttu-id="2b438-157">10.09.2014 12:02:00.000</span><span class="sxs-lookup"><span data-stu-id="2b438-157">2014-09-10 12:02:00.000</span></span> |<span data-ttu-id="2b438-158">YXZ 1001</span><span class="sxs-lookup"><span data-stu-id="2b438-158">YXZ 1001</span></span> |<span data-ttu-id="2b438-159">Нью-Йорк</span><span class="sxs-lookup"><span data-stu-id="2b438-159">NY</span></span> |<span data-ttu-id="2b438-160">Toyota</span><span class="sxs-lookup"><span data-stu-id="2b438-160">Toyota</span></span> |<span data-ttu-id="2b438-161">Camry</span><span class="sxs-lookup"><span data-stu-id="2b438-161">Camry</span></span> |<span data-ttu-id="2b438-162">1</span><span class="sxs-lookup"><span data-stu-id="2b438-162">1</span></span> |<span data-ttu-id="2b438-163">0</span><span class="sxs-lookup"><span data-stu-id="2b438-163">0</span></span> |<span data-ttu-id="2b438-164">4.</span><span class="sxs-lookup"><span data-stu-id="2b438-164">4</span></span> |<span data-ttu-id="2b438-165">123456789</span><span class="sxs-lookup"><span data-stu-id="2b438-165">123456789</span></span> |
| <span data-ttu-id="2b438-166">3</span><span class="sxs-lookup"><span data-stu-id="2b438-166">3</span></span> |<span data-ttu-id="2b438-167">10.09.2014 12:02:00.000</span><span class="sxs-lookup"><span data-stu-id="2b438-167">2014-09-10 12:02:00.000</span></span> |<span data-ttu-id="2b438-168">ABC 1004</span><span class="sxs-lookup"><span data-stu-id="2b438-168">ABC 1004</span></span> |<span data-ttu-id="2b438-169">CT</span><span class="sxs-lookup"><span data-stu-id="2b438-169">CT</span></span> |<span data-ttu-id="2b438-170">Ford</span><span class="sxs-lookup"><span data-stu-id="2b438-170">Ford</span></span> |<span data-ttu-id="2b438-171">Taurus</span><span class="sxs-lookup"><span data-stu-id="2b438-171">Taurus</span></span> |<span data-ttu-id="2b438-172">1</span><span class="sxs-lookup"><span data-stu-id="2b438-172">1</span></span> |<span data-ttu-id="2b438-173">0</span><span class="sxs-lookup"><span data-stu-id="2b438-173">0</span></span> |<span data-ttu-id="2b438-174">5</span><span class="sxs-lookup"><span data-stu-id="2b438-174">5</span></span> |<span data-ttu-id="2b438-175">456789123</span><span class="sxs-lookup"><span data-stu-id="2b438-175">456789123</span></span> |
| <span data-ttu-id="2b438-176">2</span><span class="sxs-lookup"><span data-stu-id="2b438-176">2</span></span> |<span data-ttu-id="2b438-177">10.09.2014 12:03:00.000</span><span class="sxs-lookup"><span data-stu-id="2b438-177">2014-09-10 12:03:00.000</span></span> |<span data-ttu-id="2b438-178">XYZ 1003</span><span class="sxs-lookup"><span data-stu-id="2b438-178">XYZ 1003</span></span> |<span data-ttu-id="2b438-179">CT</span><span class="sxs-lookup"><span data-stu-id="2b438-179">CT</span></span> |<span data-ttu-id="2b438-180">Toyota</span><span class="sxs-lookup"><span data-stu-id="2b438-180">Toyota</span></span> |<span data-ttu-id="2b438-181">Corolla</span><span class="sxs-lookup"><span data-stu-id="2b438-181">Corolla</span></span> |<span data-ttu-id="2b438-182">1</span><span class="sxs-lookup"><span data-stu-id="2b438-182">1</span></span> |<span data-ttu-id="2b438-183">0</span><span class="sxs-lookup"><span data-stu-id="2b438-183">0</span></span> |<span data-ttu-id="2b438-184">4.</span><span class="sxs-lookup"><span data-stu-id="2b438-184">4</span></span> | |
| <span data-ttu-id="2b438-185">1</span><span class="sxs-lookup"><span data-stu-id="2b438-185">1</span></span> |<span data-ttu-id="2b438-186">10.09.2014 12:03:00.000</span><span class="sxs-lookup"><span data-stu-id="2b438-186">2014-09-10 12:03:00.000</span></span> |<span data-ttu-id="2b438-187">BNJ 1007</span><span class="sxs-lookup"><span data-stu-id="2b438-187">BNJ 1007</span></span> |<span data-ttu-id="2b438-188">Нью-Йорк</span><span class="sxs-lookup"><span data-stu-id="2b438-188">NY</span></span> |<span data-ttu-id="2b438-189">Honda</span><span class="sxs-lookup"><span data-stu-id="2b438-189">Honda</span></span> |<span data-ttu-id="2b438-190">CRV</span><span class="sxs-lookup"><span data-stu-id="2b438-190">CRV</span></span> |<span data-ttu-id="2b438-191">1</span><span class="sxs-lookup"><span data-stu-id="2b438-191">1</span></span> |<span data-ttu-id="2b438-192">0</span><span class="sxs-lookup"><span data-stu-id="2b438-192">0</span></span> |<span data-ttu-id="2b438-193">5</span><span class="sxs-lookup"><span data-stu-id="2b438-193">5</span></span> |<span data-ttu-id="2b438-194">789123456</span><span class="sxs-lookup"><span data-stu-id="2b438-194">789123456</span></span> |
| <span data-ttu-id="2b438-195">2</span><span class="sxs-lookup"><span data-stu-id="2b438-195">2</span></span> |<span data-ttu-id="2b438-196">10.09.2014 12:05:00.000</span><span class="sxs-lookup"><span data-stu-id="2b438-196">2014-09-10 12:05:00.000</span></span> |<span data-ttu-id="2b438-197">CDE 1007</span><span class="sxs-lookup"><span data-stu-id="2b438-197">CDE 1007</span></span> |<span data-ttu-id="2b438-198">Нью-Джерси</span><span class="sxs-lookup"><span data-stu-id="2b438-198">NJ</span></span> |<span data-ttu-id="2b438-199">Toyota</span><span class="sxs-lookup"><span data-stu-id="2b438-199">Toyota</span></span> |<span data-ttu-id="2b438-200">4x4</span><span class="sxs-lookup"><span data-stu-id="2b438-200">4x4</span></span> |<span data-ttu-id="2b438-201">1</span><span class="sxs-lookup"><span data-stu-id="2b438-201">1</span></span> |<span data-ttu-id="2b438-202">0</span><span class="sxs-lookup"><span data-stu-id="2b438-202">0</span></span> |<span data-ttu-id="2b438-203">6</span><span class="sxs-lookup"><span data-stu-id="2b438-203">6</span></span> |<span data-ttu-id="2b438-204">321987654</span><span class="sxs-lookup"><span data-stu-id="2b438-204">321987654</span></span> |

<span data-ttu-id="2b438-205">Вот краткое описание столбцов hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-205">Here is a short description of hello columns:</span></span>

| <span data-ttu-id="2b438-206">столбец</span><span class="sxs-lookup"><span data-stu-id="2b438-206">Column</span></span> | <span data-ttu-id="2b438-207">Описание</span><span class="sxs-lookup"><span data-stu-id="2b438-207">Description</span></span> |
| --- | --- |
| <span data-ttu-id="2b438-208">ИД пункта сбора</span><span class="sxs-lookup"><span data-stu-id="2b438-208">TollID</span></span> |<span data-ttu-id="2b438-209">Идентификатор Hello платный оплаты, который однозначно определяет оплаты дорожного сбора</span><span class="sxs-lookup"><span data-stu-id="2b438-209">hello toll booth ID that uniquely identifies a toll booth</span></span> |
| <span data-ttu-id="2b438-210">Время въезда</span><span class="sxs-lookup"><span data-stu-id="2b438-210">EntryTime</span></span> |<span data-ttu-id="2b438-211">Hello Дата и время записи hello vehicle toohello через кабинку в формате UTC</span><span class="sxs-lookup"><span data-stu-id="2b438-211">hello date and time of entry of hello vehicle toohello toll booth in UTC</span></span> |
| <span data-ttu-id="2b438-212">LicensePlate</span><span class="sxs-lookup"><span data-stu-id="2b438-212">LicensePlate</span></span> |<span data-ttu-id="2b438-213">Hello номерной автомобиля hello</span><span class="sxs-lookup"><span data-stu-id="2b438-213">hello license plate number of hello vehicle</span></span> |
| <span data-ttu-id="2b438-214">Состояние</span><span class="sxs-lookup"><span data-stu-id="2b438-214">State</span></span> |<span data-ttu-id="2b438-215">Штат в США</span><span class="sxs-lookup"><span data-stu-id="2b438-215">A state in United States</span></span> |
| <span data-ttu-id="2b438-216">Убедитесь,</span><span class="sxs-lookup"><span data-stu-id="2b438-216">Make</span></span> |<span data-ttu-id="2b438-217">Hello производителя автомобиль hello</span><span class="sxs-lookup"><span data-stu-id="2b438-217">hello manufacturer of hello automobile</span></span> |
| <span data-ttu-id="2b438-218">Модель</span><span class="sxs-lookup"><span data-stu-id="2b438-218">Model</span></span> |<span data-ttu-id="2b438-219">Номер модели Hello автомобиль hello</span><span class="sxs-lookup"><span data-stu-id="2b438-219">hello model number of hello automobile</span></span> |
| <span data-ttu-id="2b438-220">Тип транспортного средства</span><span class="sxs-lookup"><span data-stu-id="2b438-220">VehicleType</span></span> |<span data-ttu-id="2b438-221">1 — для пассажирского транспорта, 2 — для коммерческого транспорта</span><span class="sxs-lookup"><span data-stu-id="2b438-221">Either 1 for passenger vehicles or 2 for commercial vehicles</span></span> |
| <span data-ttu-id="2b438-222">Тип веса</span><span class="sxs-lookup"><span data-stu-id="2b438-222">WeightType</span></span> |<span data-ttu-id="2b438-223">Вес транспортного средства в тоннах. 0 — для пассажирского транспорта.</span><span class="sxs-lookup"><span data-stu-id="2b438-223">Vehicle weight in tons; 0 for passenger vehicles</span></span> |
| <span data-ttu-id="2b438-224">Плата</span><span class="sxs-lookup"><span data-stu-id="2b438-224">Toll</span></span> |<span data-ttu-id="2b438-225">значение платный Hello в долларах США</span><span class="sxs-lookup"><span data-stu-id="2b438-225">hello toll value in USD</span></span> |
| <span data-ttu-id="2b438-226">Тег</span><span class="sxs-lookup"><span data-stu-id="2b438-226">Tag</span></span> |<span data-ttu-id="2b438-227">Здравствуйте, e-Tag на автомобиль hello, который автоматизирует платежа; пустое, где было выполнено hello оплаты вручную</span><span class="sxs-lookup"><span data-stu-id="2b438-227">hello e-Tag on hello automobile that automates payment; blank where hello payment was done manually</span></span> |

### <a name="exit-data-stream"></a><span data-ttu-id="2b438-228">Выходной поток данных</span><span class="sxs-lookup"><span data-stu-id="2b438-228">Exit data stream</span></span>
<span data-ttu-id="2b438-229">поток данных выхода Hello содержит сведения о автомобилей, оставляя станции платный hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-229">hello exit data stream contains information about cars leaving hello toll station.</span></span>

| <span data-ttu-id="2b438-230">**ИД пункта сбора**</span><span class="sxs-lookup"><span data-stu-id="2b438-230">**TollId**</span></span> | <span data-ttu-id="2b438-231">**Время выезда**</span><span class="sxs-lookup"><span data-stu-id="2b438-231">**ExitTime**</span></span> | <span data-ttu-id="2b438-232">**LicensePlate**</span><span class="sxs-lookup"><span data-stu-id="2b438-232">**LicensePlate**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="2b438-233">1</span><span class="sxs-lookup"><span data-stu-id="2b438-233">1</span></span> |<span data-ttu-id="2b438-234">10.09.2014T12:03:00.0000000Z</span><span class="sxs-lookup"><span data-stu-id="2b438-234">2014-09-10T12:03:00.0000000Z</span></span> |<span data-ttu-id="2b438-235">JNB 7001</span><span class="sxs-lookup"><span data-stu-id="2b438-235">JNB 7001</span></span> |
| <span data-ttu-id="2b438-236">1</span><span class="sxs-lookup"><span data-stu-id="2b438-236">1</span></span> |<span data-ttu-id="2b438-237">10.09.2014T12:03:00.0000000Z</span><span class="sxs-lookup"><span data-stu-id="2b438-237">2014-09-10T12:03:00.0000000Z</span></span> |<span data-ttu-id="2b438-238">YXZ 1001</span><span class="sxs-lookup"><span data-stu-id="2b438-238">YXZ 1001</span></span> |
| <span data-ttu-id="2b438-239">3</span><span class="sxs-lookup"><span data-stu-id="2b438-239">3</span></span> |<span data-ttu-id="2b438-240">10.09.2014T12:04:00.0000000Z</span><span class="sxs-lookup"><span data-stu-id="2b438-240">2014-09-10T12:04:00.0000000Z</span></span> |<span data-ttu-id="2b438-241">ABC 1004</span><span class="sxs-lookup"><span data-stu-id="2b438-241">ABC 1004</span></span> |
| <span data-ttu-id="2b438-242">2</span><span class="sxs-lookup"><span data-stu-id="2b438-242">2</span></span> |<span data-ttu-id="2b438-243">10.09.2014T12:07:00.0000000Z</span><span class="sxs-lookup"><span data-stu-id="2b438-243">2014-09-10T12:07:00.0000000Z</span></span> |<span data-ttu-id="2b438-244">XYZ 1003</span><span class="sxs-lookup"><span data-stu-id="2b438-244">XYZ 1003</span></span> |
| <span data-ttu-id="2b438-245">1</span><span class="sxs-lookup"><span data-stu-id="2b438-245">1</span></span> |<span data-ttu-id="2b438-246">10.09.2014T12:08:00.0000000Z</span><span class="sxs-lookup"><span data-stu-id="2b438-246">2014-09-10T12:08:00.0000000Z</span></span> |<span data-ttu-id="2b438-247">BNJ 1007</span><span class="sxs-lookup"><span data-stu-id="2b438-247">BNJ 1007</span></span> |
| <span data-ttu-id="2b438-248">2</span><span class="sxs-lookup"><span data-stu-id="2b438-248">2</span></span> |<span data-ttu-id="2b438-249">10.09.2014T12:07:00.0000000Z</span><span class="sxs-lookup"><span data-stu-id="2b438-249">2014-09-10T12:07:00.0000000Z</span></span> |<span data-ttu-id="2b438-250">CDE 1007</span><span class="sxs-lookup"><span data-stu-id="2b438-250">CDE 1007</span></span> |

<span data-ttu-id="2b438-251">Вот краткое описание столбцов hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-251">Here is a short description of hello columns:</span></span>

| <span data-ttu-id="2b438-252">столбец</span><span class="sxs-lookup"><span data-stu-id="2b438-252">Column</span></span> | <span data-ttu-id="2b438-253">Описание</span><span class="sxs-lookup"><span data-stu-id="2b438-253">Description</span></span> |
| --- | --- |
| <span data-ttu-id="2b438-254">ИД пункта сбора</span><span class="sxs-lookup"><span data-stu-id="2b438-254">TollID</span></span> |<span data-ttu-id="2b438-255">Идентификатор Hello платный оплаты, который однозначно определяет оплаты дорожного сбора</span><span class="sxs-lookup"><span data-stu-id="2b438-255">hello toll booth ID that uniquely identifies a toll booth</span></span> |
| <span data-ttu-id="2b438-256">Время выезда</span><span class="sxs-lookup"><span data-stu-id="2b438-256">ExitTime</span></span> |<span data-ttu-id="2b438-257">Hello даты и времени выхода, hello автомобиля в кабинку сбора оплаты в формате UTC</span><span class="sxs-lookup"><span data-stu-id="2b438-257">hello date and time of exit of hello vehicle from toll booth in UTC</span></span> |
| <span data-ttu-id="2b438-258">LicensePlate</span><span class="sxs-lookup"><span data-stu-id="2b438-258">LicensePlate</span></span> |<span data-ttu-id="2b438-259">Hello номерной автомобиля hello</span><span class="sxs-lookup"><span data-stu-id="2b438-259">hello license plate number of hello vehicle</span></span> |

### <a name="commercial-vehicle-registration-data"></a><span data-ttu-id="2b438-260">Данные регистрации коммерческого транспортного средства</span><span class="sxs-lookup"><span data-stu-id="2b438-260">Commercial vehicle registration data</span></span>
<span data-ttu-id="2b438-261">Hello учебнике используется статический моментальный снимок базы данных регистрации коммерческого транспорта.</span><span class="sxs-lookup"><span data-stu-id="2b438-261">hello tutorial uses a static snapshot of a commercial vehicle registration database.</span></span>

| <span data-ttu-id="2b438-262">LicensePlate</span><span class="sxs-lookup"><span data-stu-id="2b438-262">LicensePlate</span></span> | <span data-ttu-id="2b438-263">ИД регистрации</span><span class="sxs-lookup"><span data-stu-id="2b438-263">RegistrationId</span></span> | <span data-ttu-id="2b438-264">Срок действия истек</span><span class="sxs-lookup"><span data-stu-id="2b438-264">Expired</span></span> |
| --- | --- | --- |
| <span data-ttu-id="2b438-265">SVT 6023</span><span class="sxs-lookup"><span data-stu-id="2b438-265">SVT 6023</span></span> |<span data-ttu-id="2b438-266">285429838</span><span class="sxs-lookup"><span data-stu-id="2b438-266">285429838</span></span> |<span data-ttu-id="2b438-267">1</span><span class="sxs-lookup"><span data-stu-id="2b438-267">1</span></span> |
| <span data-ttu-id="2b438-268">XLZ 3463</span><span class="sxs-lookup"><span data-stu-id="2b438-268">XLZ 3463</span></span> |<span data-ttu-id="2b438-269">362715656</span><span class="sxs-lookup"><span data-stu-id="2b438-269">362715656</span></span> |<span data-ttu-id="2b438-270">0</span><span class="sxs-lookup"><span data-stu-id="2b438-270">0</span></span> |
| <span data-ttu-id="2b438-271">BAC 1005</span><span class="sxs-lookup"><span data-stu-id="2b438-271">BAC 1005</span></span> |<span data-ttu-id="2b438-272">876133137</span><span class="sxs-lookup"><span data-stu-id="2b438-272">876133137</span></span> |<span data-ttu-id="2b438-273">1</span><span class="sxs-lookup"><span data-stu-id="2b438-273">1</span></span> |
| <span data-ttu-id="2b438-274">RIV 8632</span><span class="sxs-lookup"><span data-stu-id="2b438-274">RIV 8632</span></span> |<span data-ttu-id="2b438-275">992711956</span><span class="sxs-lookup"><span data-stu-id="2b438-275">992711956</span></span> |<span data-ttu-id="2b438-276">0</span><span class="sxs-lookup"><span data-stu-id="2b438-276">0</span></span> |
| <span data-ttu-id="2b438-277">SNY 7188</span><span class="sxs-lookup"><span data-stu-id="2b438-277">SNY 7188</span></span> |<span data-ttu-id="2b438-278">592133890</span><span class="sxs-lookup"><span data-stu-id="2b438-278">592133890</span></span> |<span data-ttu-id="2b438-279">0</span><span class="sxs-lookup"><span data-stu-id="2b438-279">0</span></span> |
| <span data-ttu-id="2b438-280">ELH 9896</span><span class="sxs-lookup"><span data-stu-id="2b438-280">ELH 9896</span></span> |<span data-ttu-id="2b438-281">678427724</span><span class="sxs-lookup"><span data-stu-id="2b438-281">678427724</span></span> |<span data-ttu-id="2b438-282">1</span><span class="sxs-lookup"><span data-stu-id="2b438-282">1</span></span> |

<span data-ttu-id="2b438-283">Вот краткое описание столбцов hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-283">Here is a short description of hello columns:</span></span>

| <span data-ttu-id="2b438-284">столбец</span><span class="sxs-lookup"><span data-stu-id="2b438-284">Column</span></span> | <span data-ttu-id="2b438-285">Описание</span><span class="sxs-lookup"><span data-stu-id="2b438-285">Description</span></span> |
| --- | --- |
| <span data-ttu-id="2b438-286">LicensePlate</span><span class="sxs-lookup"><span data-stu-id="2b438-286">LicensePlate</span></span> |<span data-ttu-id="2b438-287">Hello номерной автомобиля hello</span><span class="sxs-lookup"><span data-stu-id="2b438-287">hello license plate number of hello vehicle</span></span> |
| <span data-ttu-id="2b438-288">ИД регистрации</span><span class="sxs-lookup"><span data-stu-id="2b438-288">RegistrationId</span></span> |<span data-ttu-id="2b438-289">Идентификатор регистрации Hello vehicle</span><span class="sxs-lookup"><span data-stu-id="2b438-289">hello vehicle's registration ID</span></span> |
| <span data-ttu-id="2b438-290">Срок действия истек</span><span class="sxs-lookup"><span data-stu-id="2b438-290">Expired</span></span> |<span data-ttu-id="2b438-291">Здравствуйте состояния регистрации hello vehicle: 0, если средство регистрации активна, 1, если истек срок действия регистрации</span><span class="sxs-lookup"><span data-stu-id="2b438-291">hello registration status of hello vehicle: 0 if vehicle registration is active, 1 if registration is expired</span></span> |

## <a name="set-up-hello-environment-for-azure-stream-analytics"></a><span data-ttu-id="2b438-292">Настройка среды hello для Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="2b438-292">Set up hello environment for Azure Stream Analytics</span></span>
<span data-ttu-id="2b438-293">toocomplete этого учебника вам потребуется подписка Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="2b438-293">toocomplete this tutorial, you need a Microsoft Azure subscription.</span></span> <span data-ttu-id="2b438-294">Мы предлагаем бесплатную пробную версию служб Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="2b438-294">Microsoft offers free trial for Microsoft Azure services.</span></span>

<span data-ttu-id="2b438-295">Если у вас нет учетной записи Azure, вы можете [получить бесплатную пробную версию](http://azure.microsoft.com/pricing/free-trial/).</span><span class="sxs-lookup"><span data-stu-id="2b438-295">If you do not have an Azure account, you can [request a free trial version](http://azure.microsoft.com/pricing/free-trial/).</span></span>

> [!NOTE]
> <span data-ttu-id="2b438-296">toosign для использования бесплатной пробной версии, необходимо мобильное устройство, которое может принимать текстовые сообщения и действительной кредитной карты.</span><span class="sxs-lookup"><span data-stu-id="2b438-296">toosign up for a free trial, you need a mobile device that can receive text messages and a valid credit card.</span></span>
> 
> 

<span data-ttu-id="2b438-297">Убедитесь, что toofollow hello действия раздела hello «Очистки учетной записи Azure» в конце hello в этой статье, чтобы можно наиболее эффективно использовать hello Azure кредита.</span><span class="sxs-lookup"><span data-stu-id="2b438-297">Be sure toofollow hello steps in hello “Clean up your Azure account” section at hello end of this article so that you can make hello best use of your Azure credit.</span></span>

## <a name="provision-azure-resources-required-for-hello-tutorial"></a><span data-ttu-id="2b438-298">Подготовить Azure ресурсы, необходимые для работы с руководством hello</span><span class="sxs-lookup"><span data-stu-id="2b438-298">Provision Azure resources required for hello tutorial</span></span>
<span data-ttu-id="2b438-299">Этот учебник требует двух tooreceive концентраторов событий *запись* и *выхода* потоки данных.</span><span class="sxs-lookup"><span data-stu-id="2b438-299">This tutorial requires two event hubs tooreceive *entry* and *exit* data streams.</span></span> <span data-ttu-id="2b438-300">База данных SQL Azure выводит результаты hello заданий Stream Analytics hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-300">Azure SQL Database outputs hello results of hello Stream Analytics jobs.</span></span> <span data-ttu-id="2b438-301">Для хранения справочных данных о регистрации транспортных средств используется служба хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="2b438-301">Azure Storage stores reference data about vehicle registrations.</span></span>

<span data-ttu-id="2b438-302">Можно использовать сценарий Setup.ps1 hello в папке TollApp hello на GitHub toocreate все необходимые ресурсы.</span><span class="sxs-lookup"><span data-stu-id="2b438-302">You can use hello Setup.ps1 script in hello TollApp folder on GitHub toocreate all required resources.</span></span> <span data-ttu-id="2b438-303">Hello процент времени мы рекомендуем, запустите его.</span><span class="sxs-lookup"><span data-stu-id="2b438-303">In hello interest of time, we recommend that you run it.</span></span> <span data-ttu-id="2b438-304">Если вы хотите toolearn Дополнительные сведения о как tooconfigure эти ресурсы в hello портал Azure, см. в приложении «Настройка учебника ресурсы на портале Azure» toohello.</span><span class="sxs-lookup"><span data-stu-id="2b438-304">If you would like toolearn more about how tooconfigure these resources in hello Azure portal, refer toohello “Configuring tutorial resources in Azure portal” appendix.</span></span>

<span data-ttu-id="2b438-305">Загрузить и сохранить их hello [TollApp](https://github.com/Azure/azure-stream-analytics/blob/master/Samples/TollApp/TollApp.zip) файлов и папок.</span><span class="sxs-lookup"><span data-stu-id="2b438-305">Download and save hello supporting [TollApp](https://github.com/Azure/azure-stream-analytics/blob/master/Samples/TollApp/TollApp.zip) folder and files.</span></span>

<span data-ttu-id="2b438-306">Откройте окно **Microsoft Azure PowerShell***от имени администратора*.</span><span class="sxs-lookup"><span data-stu-id="2b438-306">Open a **Microsoft Azure PowerShell** window *as an administrator*.</span></span> <span data-ttu-id="2b438-307">Если вы еще не Azure PowerShell, следуйте инструкциям hello [Установка и настройка Azure PowerShell](/powershell/azure/overview) tooinstall его.</span><span class="sxs-lookup"><span data-stu-id="2b438-307">If you do not yet have Azure PowerShell, follow hello instructions in [Install and configure Azure PowerShell](/powershell/azure/overview) tooinstall it.</span></span>

<span data-ttu-id="2b438-308">Поскольку Windows автоматически блокирует файлы .exe, .dll и .ps1, вам потребуется политика выполнения hello tooset перед запуском сценария hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-308">Because Windows automatically blocks .ps1, .dll, and .exe files, you need tooset hello execution policy before you run hello script.</span></span> <span data-ttu-id="2b438-309">Убедитесь, что окно Azure PowerShell hello работает *с правами администратора*.</span><span class="sxs-lookup"><span data-stu-id="2b438-309">Make sure hello Azure PowerShell window is running *as an administrator*.</span></span> <span data-ttu-id="2b438-310">Выполните команду **Set-ExecutionPolicy unrestricted**.</span><span class="sxs-lookup"><span data-stu-id="2b438-310">Run **Set-ExecutionPolicy unrestricted**.</span></span> <span data-ttu-id="2b438-311">При появлении запроса введите **Y**.</span><span class="sxs-lookup"><span data-stu-id="2b438-311">When prompted, type **Y**.</span></span>

![Снимок экрана с командой Set-ExecutionPolicy unrestricted в окне Azure PowerShell](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image2.png)

<span data-ttu-id="2b438-313">Запустите **Get-ExecutionPolicy** toomake правильности команда hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-313">Run **Get-ExecutionPolicy** toomake sure that hello command worked.</span></span>

![Снимок экрана с командой Get-ExecutionPolicy в окне Azure PowerShell](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image3.png)

<span data-ttu-id="2b438-315">Перейдите в каталог toohello, который имеет hello скрипты и приложения генератора.</span><span class="sxs-lookup"><span data-stu-id="2b438-315">Go toohello directory that has hello scripts and generator application.</span></span>

![Снимок экрана «cd .\TollApp\TollApp» в окне Azure PowerShell hello](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image4.png)

<span data-ttu-id="2b438-317">Тип **.\\ Setup.ps1** tooset копирование учетной записи Azure, создать и настроить все необходимые ресурсы и запустить toogenerate события.</span><span class="sxs-lookup"><span data-stu-id="2b438-317">Type **.\\Setup.ps1** tooset up your Azure account, create and configure all required resources, and start toogenerate events.</span></span> <span data-ttu-id="2b438-318">сценарий Hello случайным образом забирает toocreate области ресурсов.</span><span class="sxs-lookup"><span data-stu-id="2b438-318">hello script randomly picks up a region toocreate your resources.</span></span> <span data-ttu-id="2b438-319">tooexplicitly Укажите регион, можно передать hello **-расположение** параметра как hello в следующем примере:</span><span class="sxs-lookup"><span data-stu-id="2b438-319">tooexplicitly specify a region, you can pass hello **-location** parameter as in hello following example:</span></span>

<span data-ttu-id="2b438-320">**.\\Setup.ps1 -location "Central US"**</span><span class="sxs-lookup"><span data-stu-id="2b438-320">**.\\Setup.ps1 -location “Central US”**</span></span>

![Снимок экрана со страницей hello Azure вход](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image5.png)

<span data-ttu-id="2b438-322">скрипт Hello открывается hello **входа** страницы в Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="2b438-322">hello script opens hello **Sign In** page for Microsoft Azure.</span></span> <span data-ttu-id="2b438-323">Введите свои учетные данные.</span><span class="sxs-lookup"><span data-stu-id="2b438-323">Enter your account credentials.</span></span>

> [!NOTE]
> <span data-ttu-id="2b438-324">Если у вас есть доступ toomultiple подписки, можно hello задаваемые tooenter: требуется toouse в учебнике hello имя подписки.</span><span class="sxs-lookup"><span data-stu-id="2b438-324">If your account has access toomultiple subscriptions, you will be asked tooenter hello subscription name that you want toouse for hello tutorial.</span></span>
> 
> 

<span data-ttu-id="2b438-325">Hello скрипт может занять несколько минут toorun.</span><span class="sxs-lookup"><span data-stu-id="2b438-325">hello script can take several minutes toorun.</span></span> <span data-ttu-id="2b438-326">После его завершения hello вывод должен выглядеть так следующий снимок экрана приветствия.</span><span class="sxs-lookup"><span data-stu-id="2b438-326">After it finishes, hello output should look like hello following screenshot.</span></span>

![Снимок экрана скрипта hello в окне Azure PowerShell hello](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image6.PNG)

<span data-ttu-id="2b438-328">Также появится другое окно, которое аналогично toohello следующий снимок экрана.</span><span class="sxs-lookup"><span data-stu-id="2b438-328">You will also see another window that's similar toohello following screenshot.</span></span> <span data-ttu-id="2b438-329">Это приложение отправляет события tooAzure концентраторов событий, являющийся учебника требуется toorun hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-329">This application is sending events tooAzure Event Hubs, which is required toorun hello tutorial.</span></span> <span data-ttu-id="2b438-330">Таким образом не остановить приложение hello и не закрывайте это окно до завершения работы с учебником hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-330">So, do not stop hello application or close this window until you finish hello tutorial.</span></span>

![Снимок экрана "Отправка данных в концентратор событий"](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image7.png)

<span data-ttu-id="2b438-332">Вам необходимо будет toosee ресурсов на портале Azure теперь.</span><span class="sxs-lookup"><span data-stu-id="2b438-332">You should be able toosee your resources in Azure portal now.</span></span> <span data-ttu-id="2b438-333">Go слишком<https://portal.azure.com>и выполните вход с учетными данными.</span><span class="sxs-lookup"><span data-stu-id="2b438-333">Go too<https://portal.azure.com>, and sign in with your account credentials.</span></span> <span data-ttu-id="2b438-334">Обратите внимание, что в настоящее время некоторые функциональные возможности использует классический портал hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-334">Note that currently some functionality utilizes hello classic portal.</span></span> <span data-ttu-id="2b438-335">Эти действия будут четко указаны.</span><span class="sxs-lookup"><span data-stu-id="2b438-335">These steps will be clearly indicated.</span></span>

### <a name="azure-event-hubs"></a><span data-ttu-id="2b438-336">Концентраторы событий Azure</span><span class="sxs-lookup"><span data-stu-id="2b438-336">Azure Event Hubs</span></span>
<span data-ttu-id="2b438-337">В hello портал Azure, щелкните **больше услуг** hello нижней области левой управления hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-337">In hello Azure portal, click **More services** on hello bottom of hello left management pane.</span></span> <span data-ttu-id="2b438-338">Тип **концентраторов событий** в hello в поле и нажмите кнопку **концентраторов событий**.</span><span class="sxs-lookup"><span data-stu-id="2b438-338">Type **Event hubs** in hello field provided and click **Event hubs**.</span></span> <span data-ttu-id="2b438-339">Будет запущен новый hello toodisplay окна браузера **SERVICE BUS** область hello **классический портал**.</span><span class="sxs-lookup"><span data-stu-id="2b438-339">This launches a new browser window toodisplay hello **SERVICE BUS** area in hello **classic portal**.</span></span> <span data-ttu-id="2b438-340">Вы видите hello концентратора событий, созданных hello Setup.ps1 сценария.</span><span class="sxs-lookup"><span data-stu-id="2b438-340">Here you can see hello Event Hub created by hello Setup.ps1 script.</span></span>

![Служебная шина](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image8.png)

<span data-ttu-id="2b438-342">Нажмите кнопку hello, который начинается с *tolldata*.</span><span class="sxs-lookup"><span data-stu-id="2b438-342">Click hello one that starts with *tolldata*.</span></span> <span data-ttu-id="2b438-343">Нажмите кнопку hello **КОНЦЕНТРАТОРОВ СОБЫТИЙ** вкладки. В этом пространстве имен вы увидите два созданных концентратора событий с именами *entry* и *exit*.</span><span class="sxs-lookup"><span data-stu-id="2b438-343">Click hello **EVENT HUBS** tab. You will see two event hubs named *entry* and *exit* created in this namespace.</span></span>

![Вкладки концентраторов событий в классическом портале hello](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image9.png)

### <a name="azure-storage-container"></a><span data-ttu-id="2b438-345">Контейнер хранилища Azure</span><span class="sxs-lookup"><span data-stu-id="2b438-345">Azure Storage container</span></span>
1. <span data-ttu-id="2b438-346">Вы можете вернуться toohello вкладка на портале tooAzure открыть браузер.</span><span class="sxs-lookup"><span data-stu-id="2b438-346">Go back toohello tab in your browser open tooAzure portal.</span></span> <span data-ttu-id="2b438-347">Нажмите кнопку **ХРАНЕНИЯ** на hello слева от оператора hello Azure портала toosee hello хранилища Azure контейнер, который используется в учебнике hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-347">Click **STORAGE** on hello left side of hello Azure portal toosee hello Azure Storage container that's used in hello tutorial.</span></span>
   
    ![Пункт меню хранилища](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image11.png)
2. <span data-ttu-id="2b438-349">Нажмите кнопку hello, начинаться с *tolldata*.</span><span class="sxs-lookup"><span data-stu-id="2b438-349">Click hello one that start with *tolldata*.</span></span> <span data-ttu-id="2b438-350">Нажмите кнопку hello **КОНТЕЙНЕРЫ** вкладку toosee hello создания контейнера.</span><span class="sxs-lookup"><span data-stu-id="2b438-350">Click hello **CONTAINERS** tab toosee hello created container.</span></span>
   
    ![На вкладке контейнеры hello портал Azure](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image10.png)
3. <span data-ttu-id="2b438-352">Нажмите кнопку hello **tolldata** toosee hello контейнер загружен JSON-файл, содержащий данные машина регистрации.</span><span class="sxs-lookup"><span data-stu-id="2b438-352">Click hello **tolldata** container toosee hello uploaded JSON file that has vehicle registration data.</span></span>
   
    ![Снимок экрана файла registration.json hello в контейнере hello](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image12.png)

### <a name="azure-sql-database"></a><span data-ttu-id="2b438-354">База данных SQL Azure</span><span class="sxs-lookup"><span data-stu-id="2b438-354">Azure SQL Database</span></span>
1. <span data-ttu-id="2b438-355">Вы можете вернуться toohello портал Azure на первой вкладке hello, который был открыт в браузере hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-355">Go back toohello Azure portal on hello first tab that was opened in hello browser.</span></span> <span data-ttu-id="2b438-356">Нажмите кнопку **баз данных SQL** на hello левая сторона hello Azure портала toosee hello SQL базы данных, которая будет использоваться в учебнике hello и нажмите кнопку **tolldatadb**.</span><span class="sxs-lookup"><span data-stu-id="2b438-356">Click **SQL DATABASES** on hello left side of hello Azure portal toosee hello SQL database that will be used in hello tutorial and click **tolldatadb**.</span></span>
   
    ![Снимок экрана: hello создана база данных SQL](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image15.png)
2. <span data-ttu-id="2b438-358">Имя сервера hello копирования без номера порта hello (*servername*. database.windows.net, например).</span><span class="sxs-lookup"><span data-stu-id="2b438-358">Copy hello server name without hello port number (*servername*.database.windows.net, for example).</span></span>
    <span data-ttu-id="2b438-359">![Снимок экрана: hello создания баз данных базы данных SQL Server](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image15a.png)</span><span class="sxs-lookup"><span data-stu-id="2b438-359">![Screenshot of hello created SQL database db](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image15a.png)</span></span>

## <a name="connect-toohello-database-from-visual-studio"></a><span data-ttu-id="2b438-360">Подключение базы данных toohello из Visual Studio</span><span class="sxs-lookup"><span data-stu-id="2b438-360">Connect toohello database from Visual Studio</span></span>
<span data-ttu-id="2b438-361">Использование результатов запроса tooaccess Visual Studio в hello Выходная база данных.</span><span class="sxs-lookup"><span data-stu-id="2b438-361">Use Visual Studio tooaccess query results in hello output database.</span></span>

<span data-ttu-id="2b438-362">Подключение базы данных SQL toohello (hello назначение) из Visual Studio:</span><span class="sxs-lookup"><span data-stu-id="2b438-362">Connect toohello SQL database (hello destination) from Visual Studio:</span></span>

1. <span data-ttu-id="2b438-363">Откройте Visual Studio и нажмите кнопку **средства** > **подключения tooDatabase**.</span><span class="sxs-lookup"><span data-stu-id="2b438-363">Open Visual Studio, and then click **Tools** > **Connect tooDatabase**.</span></span>
2. <span data-ttu-id="2b438-364">При запросе выберите **Microsoft SQL Server** в качестве источника данных.</span><span class="sxs-lookup"><span data-stu-id="2b438-364">If asked, click **Microsoft SQL Server** as a data source.</span></span>
   
    ![Диалоговое окно "Сменить источник данных"](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image16.png)
3. <span data-ttu-id="2b438-366">В hello **имя сервера** вставьте имя hello, скопированный в предыдущем разделе hello с hello портал Azure (то есть *servername*. database.windows.net).</span><span class="sxs-lookup"><span data-stu-id="2b438-366">In hello **Server name** field, paste hello name that you copied in hello previous section from hello Azure portal (that is, *servername*.database.windows.net).</span></span>
4. <span data-ttu-id="2b438-367">Выберите **Использовать проверку подлинности SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="2b438-367">Click **Use SQL Server Authentication**.</span></span>
5. <span data-ttu-id="2b438-368">Введите **tolladmin** в hello **имя пользователя** поля и **123toll!**</span><span class="sxs-lookup"><span data-stu-id="2b438-368">Enter **tolladmin** in hello **User name** field and **123toll!**</span></span> <span data-ttu-id="2b438-369">в hello **пароль** поля.</span><span class="sxs-lookup"><span data-stu-id="2b438-369">in hello **Password** field.</span></span>
6. <span data-ttu-id="2b438-370">Нажмите кнопку **выберите или введите имя базы данных**и выберите **TollDataDB** как hello базы данных.</span><span class="sxs-lookup"><span data-stu-id="2b438-370">Click **Select or enter a database name**, and select **TollDataDB** as hello database.</span></span>
   
    ![Диалоговое окно "Добавить подключение"](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image17.jpg)
7. <span data-ttu-id="2b438-372">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="2b438-372">Click **OK**.</span></span>
8. <span data-ttu-id="2b438-373">Откройте обозреватель сервера.</span><span class="sxs-lookup"><span data-stu-id="2b438-373">Open Server Explorer.</span></span>
   
    ![Обозреватель серверов](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image18.png)
9. <span data-ttu-id="2b438-375">См. в четырех таблиц в базе данных TollDataDB hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-375">See four tables in hello TollDataDB database.</span></span>
   
    ![Таблицы в базе данных TollDataDB hello](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image19.jpg)

## <a name="event-generator-tollapp-sample-project"></a><span data-ttu-id="2b438-377">Генератор событий — пример проекта TollApp</span><span class="sxs-lookup"><span data-stu-id="2b438-377">Event generator: TollApp sample project</span></span>
<span data-ttu-id="2b438-378">Hello сценарий PowerShell автоматически запускает toosend события, используя пример приложения hello TollApp программы.</span><span class="sxs-lookup"><span data-stu-id="2b438-378">hello PowerShell script automatically starts toosend events by using hello TollApp sample application program.</span></span> <span data-ttu-id="2b438-379">Не нужно tooperform какие дополнительные шаги.</span><span class="sxs-lookup"><span data-stu-id="2b438-379">You don’t need tooperform any additional steps.</span></span>

<span data-ttu-id="2b438-380">Тем не менее, если вы заинтересованы в детали реализации, можно найти hello TollApp приложения hello исходный код в GitHub [образцы/TollApp](https://aka.ms/azure-stream-analytics-toll-source).</span><span class="sxs-lookup"><span data-stu-id="2b438-380">However, if you are interested in implementation details, you can find hello source code of hello TollApp application in GitHub [samples/TollApp](https://aka.ms/azure-stream-analytics-toll-source).</span></span>

![Снимок экрана примера кода в Visual Studio](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image20.png)

## <a name="create-a-stream-analytics-job"></a><span data-ttu-id="2b438-382">Создание задания Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="2b438-382">Create a Stream Analytics job</span></span>
1. <span data-ttu-id="2b438-383">В hello портал Azure щелкните hello "плюс" в левом верхнем углу hello объекта toocreate страницы приветствия новое задание Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="2b438-383">In hello Azure portal, click hello green plus sign in hello top-left corner of hello page toocreate a new Stream Analytics job.</span></span> <span data-ttu-id="2b438-384">Выберите **Аналитика** и щелкните **Задание Stream Analytics**.</span><span class="sxs-lookup"><span data-stu-id="2b438-384">Select **Intelligence + Analytics** and then click **Stream Analytics job**.</span></span>
   
    ![Кнопка «Создать»](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image21.png)
2. <span data-ttu-id="2b438-386">Укажите имя задания, проверка подписки hello правильно, и затем создать новую группу ресурсов в hello же регионе, что hello хранилища концентратора событий (по умолчанию — центральных штатах юга США для hello скрипта).</span><span class="sxs-lookup"><span data-stu-id="2b438-386">Provide a job name, validate hello subscription is correct and then create a new Resource group in hello same region as hello Event hub storage (default is South Central US for hello script).</span></span>
3. <span data-ttu-id="2b438-387">Нажмите кнопку **toodashboard ПИН-код** и затем **создать** hello нижней части страницы приветствия.</span><span class="sxs-lookup"><span data-stu-id="2b438-387">Click **Pin toodashboard** and then **CREATE** at hello bottom of hello page.</span></span>
   
    ![Параметр "Создать задание Stream Analytics"](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image22.png)

## <a name="define-input-sources"></a><span data-ttu-id="2b438-389">Определение источников входных данных</span><span class="sxs-lookup"><span data-stu-id="2b438-389">Define input sources</span></span>
1. <span data-ttu-id="2b438-390">Создает и открывает страницу приветствия задания Hello задания.</span><span class="sxs-lookup"><span data-stu-id="2b438-390">hello job will create and open hello job page.</span></span> <span data-ttu-id="2b438-391">Или можно щелкнуть hello analytics задание создано на панели мониторинга портала hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-391">Or you can click hello created analytics job on hello portal dashboard.</span></span>

2. <span data-ttu-id="2b438-392">Нажмите кнопку hello **ВХОДОВ** вкладке toodefine hello исходных данных.</span><span class="sxs-lookup"><span data-stu-id="2b438-392">Click hello **INPUTS** tab toodefine hello source data.</span></span>
   
    ![Вкладка Hello входных данных](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image24.png)
3. <span data-ttu-id="2b438-394">Нажмите кнопку **Добавление входных данных**.</span><span class="sxs-lookup"><span data-stu-id="2b438-394">Click **ADD AN INPUT**.</span></span>
   
    ![Добавить вариант ввода Hello](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image25.png)
4. <span data-ttu-id="2b438-396">В качестве **Псевдонима входных данных** введите **EntryStream**.</span><span class="sxs-lookup"><span data-stu-id="2b438-396">Enter **EntryStream** as **INPUT ALIAS**.</span></span>
5. <span data-ttu-id="2b438-397">В качестве типа источника данных выберите **Поток данных**.</span><span class="sxs-lookup"><span data-stu-id="2b438-397">Source Type is **Data Stream**</span></span>
6. <span data-ttu-id="2b438-398">Источник данных — **концентратор событий**.</span><span class="sxs-lookup"><span data-stu-id="2b438-398">Source is **Event hub**.</span></span>
7. <span data-ttu-id="2b438-399">**Пространство имен служебной шины** должно быть hello TollData один в hello раскрывающийся список.</span><span class="sxs-lookup"><span data-stu-id="2b438-399">**Service bus namespace** should be hello TollData one in hello drop down.</span></span>
8. <span data-ttu-id="2b438-400">**Имя концентратора событий** должно быть задано слишком**входа**.</span><span class="sxs-lookup"><span data-stu-id="2b438-400">**Event hub name** should be set too**entry**.</span></span>
9. <span data-ttu-id="2b438-401">**Имя политики концентратора событий*— **RootManageSharedAccessKey** (значение по умолчанию hello).</span><span class="sxs-lookup"><span data-stu-id="2b438-401">**Event hub policy name*is **RootManageSharedAccessKey**  (hello default value).</span></span>
10. <span data-ttu-id="2b438-402">В поле **Формат сериализации событий** выберите **JSON**, а в поле **Кодировка** — **UTF8**.</span><span class="sxs-lookup"><span data-stu-id="2b438-402">Select **JSON** for **EVENT SERIALIZATION FORMAT** and **UTF8** for **ENCODING**.</span></span>
   
    <span data-ttu-id="2b438-403">Настройки будут выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="2b438-403">Your settings will look like:</span></span>
   
    ![Параметры концентратора событий](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image28.png)

10. <span data-ttu-id="2b438-405">Нажмите кнопку **создать** внизу hello toofinish hello hello страницы мастера.</span><span class="sxs-lookup"><span data-stu-id="2b438-405">Click **Create** at hello bottom of hello page toofinish hello wizard.</span></span>
    
    <span data-ttu-id="2b438-406">После создания потока записи hello будет следовать hello одного действия toocreate hello выхода потока.</span><span class="sxs-lookup"><span data-stu-id="2b438-406">Now that you've created hello entry stream, you will follow hello same steps toocreate hello exit stream.</span></span> <span data-ttu-id="2b438-407">Быть убедиться, что значения tooenter на следующий снимок экрана приветствия.</span><span class="sxs-lookup"><span data-stu-id="2b438-407">Be sure tooenter values as on hello following screenshot.</span></span>
    
    ![Параметры для потока выхода hello](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image31.png)
    
    <span data-ttu-id="2b438-409">Определены два потока входных данных:</span><span class="sxs-lookup"><span data-stu-id="2b438-409">You have defined two input streams:</span></span>
    
    ![Определенные входные потоки в hello портал Azure](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image32.png)
    
    <span data-ttu-id="2b438-411">Далее вы добавите входных справочных данных для файла hello BLOB-объект, содержащий данные регистрации автомобиля.</span><span class="sxs-lookup"><span data-stu-id="2b438-411">Next, you will add reference data input for hello blob file that contains car registration data.</span></span>
11. <span data-ttu-id="2b438-412">Нажмите кнопку **добавить**, а затем следуйте hello же обработки потока входов hello, но выбрать **ССЫЛОЧНЫХ данных** вместо **потока данных** и hello **входных псевдонимов**  — **регистрации**.</span><span class="sxs-lookup"><span data-stu-id="2b438-412">Click **ADD**, and then follow hello same process for hello stream inputs but select **REFERENCE DATA** instead of **Data Stream** and hello **Input Alias** is **Registration**.</span></span>

12. <span data-ttu-id="2b438-413">Учетная запись хранения, имя которой начинается с **tolldata**.</span><span class="sxs-lookup"><span data-stu-id="2b438-413">storage account that starts with **tolldata**.</span></span> <span data-ttu-id="2b438-414">Имя контейнера Hello должно быть **tolldata**и hello **ШАБЛОН пути** должно быть **registration.json**.</span><span class="sxs-lookup"><span data-stu-id="2b438-414">hello container name should be **tolldata**, and hello **PATH PATTERN** should be **registration.json**.</span></span> <span data-ttu-id="2b438-415">Имя файла должно быть введено **строчными буквами** (в нем учитывается регистр).</span><span class="sxs-lookup"><span data-stu-id="2b438-415">This file name is case sensitive and should be **lowercase**.</span></span>
    
    ![Параметры хранилища BLOB-объектов](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image34.png)
13. <span data-ttu-id="2b438-417">Нажмите кнопку **создать** toofinish приветствия мастера.</span><span class="sxs-lookup"><span data-stu-id="2b438-417">Click **Create** toofinish hello wizard.</span></span>

<span data-ttu-id="2b438-418">Все входные данные определены.</span><span class="sxs-lookup"><span data-stu-id="2b438-418">Now all inputs are defined.</span></span>

## <a name="define-output"></a><span data-ttu-id="2b438-419">Определение выходных данных</span><span class="sxs-lookup"><span data-stu-id="2b438-419">Define output</span></span>
1. <span data-ttu-id="2b438-420">На панели обзора задания Stream Analytics hello выберите **ВЫХОДОВ**.</span><span class="sxs-lookup"><span data-stu-id="2b438-420">On hello Stream Analytics job overview pane, select **OUTPUTS**.</span></span>
   
    ![Здравствуйте, вкладка «Вывод» и «Добавление выходных данных» параметр](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image37.png)
2. <span data-ttu-id="2b438-422">Щелкните **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="2b438-422">Click **Add**.</span></span>
3. <span data-ttu-id="2b438-423">Набор hello **Псевдоним выхода** too'output "и затем **приемника** слишком**базы данных SQL**.</span><span class="sxs-lookup"><span data-stu-id="2b438-423">Set hello **Output alias** too'output' and then **Sink** too**SQL database**.</span></span>
3. <span data-ttu-id="2b438-424">Выберите имя сервера hello, который использовался в hello статьи «TooDatabase подключение из Visual Studio» hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-424">Select hello server name that was used in hello “Connect tooDatabase from Visual Studio” section of hello article.</span></span> <span data-ttu-id="2b438-425">Имя базы данных Hello **TollDataDB**.</span><span class="sxs-lookup"><span data-stu-id="2b438-425">hello database name is **TollDataDB**.</span></span>
4. <span data-ttu-id="2b438-426">Введите **tolladmin** в hello **USERNAME** поля, **123toll!**</span><span class="sxs-lookup"><span data-stu-id="2b438-426">Enter **tolladmin** in hello **USERNAME** field, **123toll!**</span></span> <span data-ttu-id="2b438-427">в hello **пароль** поля, и **TollDataRefJoin** в hello **таблицы** поля.</span><span class="sxs-lookup"><span data-stu-id="2b438-427">in hello **PASSWORD** field, and **TollDataRefJoin** in hello **TABLE** field.</span></span>
   
    ![Параметры базы данных SQL](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image38.png)
5. <span data-ttu-id="2b438-429">Щелкните **Создать**.</span><span class="sxs-lookup"><span data-stu-id="2b438-429">Click **Create**.</span></span>

## <a name="azure-stream-analytics-query"></a><span data-ttu-id="2b438-430">Запрос в службе Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="2b438-430">Azure Stream analytics query</span></span>
<span data-ttu-id="2b438-431">Hello **ЗАПРОСА** вкладка содержит SQL-запроса, что преобразования hello входящих данных.</span><span class="sxs-lookup"><span data-stu-id="2b438-431">hello **QUERY** tab contains a SQL query that transforms hello incoming data.</span></span>

![Запрос добавлены toohello вкладка «запрос»](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image39.png)

<span data-ttu-id="2b438-433">Этот учебник попыток tooanswer несколько вопросов для бизнеса, связанных данных tootoll и конструкции Stream Analytics запросов, которые можно использовать в Azure Stream Analytics tooprovide соответствующий ответ.</span><span class="sxs-lookup"><span data-stu-id="2b438-433">This tutorial attempts tooanswer several business questions that are related tootoll data and constructs Stream Analytics queries that can be used in Azure Stream Analytics tooprovide a relevant answer.</span></span>

<span data-ttu-id="2b438-434">Перед началом первого задание Stream Analytics, давайте рассмотрим несколько сценариев и синтаксис запросов hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-434">Before you start your first Stream Analytics job, let’s explore a few scenarios and hello query syntax.</span></span>

## <a name="introduction-tooazure-stream-analytics-query-language"></a><span data-ttu-id="2b438-435">Введение tooAzure языка запросов Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="2b438-435">Introduction tooAzure Stream Analytics query language</span></span>
- - -
<span data-ttu-id="2b438-436">Предположим, что необходимые toocount hello число автомобилей, введите через кабинку.</span><span class="sxs-lookup"><span data-stu-id="2b438-436">Let’s say that you need toocount hello number of vehicles that enter a toll booth.</span></span> <span data-ttu-id="2b438-437">Поскольку это непрерывный поток событий, у вас есть toodefine» периода времени.»</span><span class="sxs-lookup"><span data-stu-id="2b438-437">Because this is a continuous stream of events, you have toodefine a “period of time.”</span></span> <span data-ttu-id="2b438-438">Изменим вопрос toobe hello, «сколько автомобилей введите через кабинку каждые три минуты?».</span><span class="sxs-lookup"><span data-stu-id="2b438-438">Let's modify hello question toobe “How many vehicles enter a toll booth every three minutes?”.</span></span> <span data-ttu-id="2b438-439">Это часто ссылка tooas hello переворачивающееся count.</span><span class="sxs-lookup"><span data-stu-id="2b438-439">This is commonly referred tooas hello tumbling count.</span></span>

<span data-ttu-id="2b438-440">Давайте рассмотрим hello Azure Stream Analytics запрос, который отвечает на этот вопрос:</span><span class="sxs-lookup"><span data-stu-id="2b438-440">Let’s look at hello Azure Stream Analytics query that answers this question:</span></span>

    SELECT TollId, System.Timestamp AS WindowEnd, COUNT(*) AS Count
    FROM EntryStream TIMESTAMP BY EntryTime
    GROUP BY TUMBLINGWINDOW(minute, 3), TollId

<span data-ttu-id="2b438-441">Как видите, Azure Stream Analytics использует язык запросов, подобного SQL и добавляет несколько расширений toospecify связанных со временем аспекты hello запроса.</span><span class="sxs-lookup"><span data-stu-id="2b438-441">As you can see, Azure Stream Analytics uses a query language that's like SQL and adds a few extensions toospecify time-related aspects of hello query.</span></span>

<span data-ttu-id="2b438-442">Дополнительные сведения, узнайте, как [управление временем](https://msdn.microsoft.com/library/azure/mt582045.aspx) и [оконных](https://msdn.microsoft.com/library/azure/dn835019.aspx) конструкции, используемые в запросе hello с MSDN.</span><span class="sxs-lookup"><span data-stu-id="2b438-442">For more details, read about [Time Management](https://msdn.microsoft.com/library/azure/mt582045.aspx) and [Windowing](https://msdn.microsoft.com/library/azure/dn835019.aspx) constructs used in hello query from MSDN.</span></span>

## <a name="testing-azure-stream-analytics-queries"></a><span data-ttu-id="2b438-443">Тестирование запросов в службе Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="2b438-443">Testing Azure Stream Analytics queries</span></span>
<span data-ttu-id="2b438-444">Теперь, когда вы написали первого запроса Azure Stream Analytics, это с помощью файла образцов данных, расположенные в папке TollApp в пути hello tootest времени:</span><span class="sxs-lookup"><span data-stu-id="2b438-444">Now that you have written your first Azure Stream Analytics query, it is time tootest it by using sample data files located in your TollApp folder in hello following path:</span></span>

<span data-ttu-id="2b438-445">**..\\TollApp\\TollApp\\Data**</span><span class="sxs-lookup"><span data-stu-id="2b438-445">**..\\TollApp\\TollApp\\Data**</span></span>

<span data-ttu-id="2b438-446">Эта папка содержит hello следующие файлы:</span><span class="sxs-lookup"><span data-stu-id="2b438-446">This folder contains hello following files:</span></span>

* <span data-ttu-id="2b438-447">Entry.json</span><span class="sxs-lookup"><span data-stu-id="2b438-447">Entry.json</span></span>
* <span data-ttu-id="2b438-448">Exit.json</span><span class="sxs-lookup"><span data-stu-id="2b438-448">Exit.json</span></span>
* <span data-ttu-id="2b438-449">Registration.json</span><span class="sxs-lookup"><span data-stu-id="2b438-449">Registration.json</span></span>

## <a name="question-1-number-of-vehicles-entering-a-toll-booth"></a><span data-ttu-id="2b438-450">Вопрос 1. Количество автомобилей, въезжающих в пункт сбора платы</span><span class="sxs-lookup"><span data-stu-id="2b438-450">Question 1: Number of vehicles entering a toll booth</span></span>
1. <span data-ttu-id="2b438-451">Откройте портал Azure hello и перейдите tooyour создать задание Azure Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="2b438-451">Open hello Azure portal and go tooyour created Azure Stream Analytics job.</span></span> <span data-ttu-id="2b438-452">Нажмите кнопку hello **ЗАПРОСА** и вставить запрос из предыдущего раздела hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-452">Click hello **QUERY** tab and paste query from hello previous section.</span></span>

2. <span data-ttu-id="2b438-453">toovalidate этот запрос на основе образцов данных, передаваемых данных hello в hello EntryStream ввода, нажав кнопку... hello символ и выбрав **отправьте демонстрационные данные из файла**.</span><span class="sxs-lookup"><span data-stu-id="2b438-453">toovalidate this query against sample data, upload hello data into hello EntryStream input by clicking hello ... symbol and selecting **Upload sample data from file**.</span></span>

    ![Снимок экрана файла Entry.json hello](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image41.png)
3. <span data-ttu-id="2b438-455">В области hello, которая отображается файла выберите hello (Entry.json) на локальном компьютере и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="2b438-455">In hello pane that appears select hello file (Entry.json) on your local machine and click **OK**.</span></span> <span data-ttu-id="2b438-456">Hello **тест** значок будет освещения и быть активным.</span><span class="sxs-lookup"><span data-stu-id="2b438-456">hello **Test** icon will now illuminate and be clickable.</span></span>
   
    ![Снимок экрана файла Entry.json hello](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image42.png)
3. <span data-ttu-id="2b438-458">Убедитесь, что hello выходных данных запроса hello — должным образом:</span><span class="sxs-lookup"><span data-stu-id="2b438-458">Validate that hello output of hello query is as expected:</span></span>
   
    ![Результаты теста hello](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image43.png)

## <a name="question-2-report-total-time-for-each-car-toopass-through-hello-toll-booth"></a><span data-ttu-id="2b438-460">Вопрос 2: Общее время для каждой машины toopass через пункт оплаты дорожного сбора hello отчета</span><span class="sxs-lookup"><span data-stu-id="2b438-460">Question 2: Report total time for each car toopass through hello toll booth</span></span>
<span data-ttu-id="2b438-461">Hello среднее время, требуемое для toopass автомобиль через платный hello помогает tooassess hello эффективность процесса hello и качества hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-461">hello average time that's required for a car toopass through hello toll helps tooassess hello efficiency of hello process and hello customer experience.</span></span>

<span data-ttu-id="2b438-462">Общее время toofind hello необходим toojoin hello EntryTime поток с потоком ExitTime hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-462">toofind hello total time, you need toojoin hello EntryTime stream with hello ExitTime stream.</span></span> <span data-ttu-id="2b438-463">Потоки hello в столбцах TollId и LicencePlate будет присоединена.</span><span class="sxs-lookup"><span data-stu-id="2b438-463">You will join hello streams on TollId and LicencePlate columns.</span></span> <span data-ttu-id="2b438-464">Hello **JOIN** оператор требует toospecify temporal свобода, описывающий приемлемое временное hello различие между hello входящих событий.</span><span class="sxs-lookup"><span data-stu-id="2b438-464">hello **JOIN** operator requires you toospecify temporal leeway that describes hello acceptable time difference between hello joined events.</span></span> <span data-ttu-id="2b438-465">Вы воспользуетесь **DATEDIFF** функции toospecify, что события должна быть не более 15 минут друг от друга.</span><span class="sxs-lookup"><span data-stu-id="2b438-465">You will use **DATEDIFF** function toospecify that events should be no more than 15 minutes from each other.</span></span> <span data-ttu-id="2b438-466">Также будут применяться hello **DATEDIFF** tooexit функции и операции раз фактическое время hello toocompute, которое он затрачивает автомобиля в hello номер телефона станции.</span><span class="sxs-lookup"><span data-stu-id="2b438-466">You will also apply hello **DATEDIFF** function tooexit and entry times toocompute hello actual time that a car spends in hello toll station.</span></span> <span data-ttu-id="2b438-467">Обратите внимание hello отличие использования hello **DATEDIFF** при использовании в **ВЫБЕРИТЕ** инструкции, а не **JOIN** условие.</span><span class="sxs-lookup"><span data-stu-id="2b438-467">Note hello difference of hello use of **DATEDIFF** when it's used in a **SELECT** statement rather than a **JOIN** condition.</span></span>

    SELECT EntryStream.TollId, EntryStream.EntryTime, ExitStream.ExitTime, EntryStream.LicensePlate, DATEDIFF (minute , EntryStream.EntryTime, ExitStream.ExitTime) AS DurationInMinutes
    FROM EntryStream TIMESTAMP BY EntryTime
    JOIN ExitStream TIMESTAMP BY ExitTime
    ON (EntryStream.TollId= ExitStream.TollId AND EntryStream.LicensePlate = ExitStream.LicensePlate)
    AND DATEDIFF (minute, EntryStream, ExitStream ) BETWEEN 0 AND 15

1. <span data-ttu-id="2b438-468">tootest этот запрос hello запроса update на hello **ЗАПРОСА** для задания hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-468">tootest this query, update hello query on hello **QUERY** for hello job.</span></span> <span data-ttu-id="2b438-469">Добавить файл теста hello для **ExitStream** так же, как **EntryStream** указано выше.</span><span class="sxs-lookup"><span data-stu-id="2b438-469">Add hello test file for **ExitStream** just like **EntryStream** was entered above.</span></span>
   
2. <span data-ttu-id="2b438-470">Нажмите **Проверить**.</span><span class="sxs-lookup"><span data-stu-id="2b438-470">Click **Test**.</span></span>

3. <span data-ttu-id="2b438-471">Выберите hello флажок tootest hello запросов и представлений hello выходные данные:</span><span class="sxs-lookup"><span data-stu-id="2b438-471">Select hello check box tootest hello query and view hello output:</span></span>
   
    ![Выходные данные теста hello](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image45.png)

## <a name="question-3-report-all-commercial-vehicles-with-expired-registration"></a><span data-ttu-id="2b438-473">Вопрос 3. Сообщать обо всех коммерческих транспортных средствах с истекшим сроком действия регистрации</span><span class="sxs-lookup"><span data-stu-id="2b438-473">Question 3: Report all commercial vehicles with expired registration</span></span>
<span data-ttu-id="2b438-474">Azure Stream Analytics можно использовать статические снимки данных toojoin с потоками временных данных.</span><span class="sxs-lookup"><span data-stu-id="2b438-474">Azure Stream Analytics can use static snapshots of data toojoin with temporal data streams.</span></span> <span data-ttu-id="2b438-475">toodemonstrate эту возможность hello используйте следующий пример вопроса.</span><span class="sxs-lookup"><span data-stu-id="2b438-475">toodemonstrate this capability, use hello following sample question.</span></span>

<span data-ttu-id="2b438-476">При регистрации коммерческого транспорта с компании hello его могут проходить через пункт оплаты дорожного сбора hello без остановки для проверки.</span><span class="sxs-lookup"><span data-stu-id="2b438-476">If a commercial vehicle is registered with hello toll company, it can pass through hello toll booth without being stopped for inspection.</span></span> <span data-ttu-id="2b438-477">Используется tooidentify таблицу подстановки регистрации коммерческого транспорта всех автомобилей, истек срок действия регистрации.</span><span class="sxs-lookup"><span data-stu-id="2b438-477">You will use Commercial Vehicle Registration lookup table tooidentify all commercial vehicles that have expired registrations.</span></span>

```
SELECT EntryStream.EntryTime, EntryStream.LicensePlate, EntryStream.TollId, Registration.RegistrationId
FROM EntryStream TIMESTAMP BY EntryTime
JOIN Registration
ON EntryStream.LicensePlate = Registration.LicensePlate
WHERE Registration.Expired = '1'
```

<span data-ttu-id="2b438-478">tootest запроса с помощью эталонных данных требуется toodefine источник входных данных для hello справочных данных, которые уже были выполнены.</span><span class="sxs-lookup"><span data-stu-id="2b438-478">tootest a query by using reference data, you need toodefine an input source for hello reference data, which you have done already.</span></span>

<span data-ttu-id="2b438-479">tootest этот запрос, вставить hello в hello **ЗАПРОСА** щелкните **тест**и укажите hello двух источников входных данных регистрации hello образец данных и нажмите кнопку **теста**.</span><span class="sxs-lookup"><span data-stu-id="2b438-479">tootest this query, paste hello query into hello **QUERY** tab, click **Test**, and specify hello two input sources and hello registration sample data and click **Test**.</span></span>  
   
![Выходные данные теста hello](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image46.png)

## <a name="start-hello-stream-analytics-job"></a><span data-ttu-id="2b438-481">Запустить задание Stream Analytics hello</span><span class="sxs-lookup"><span data-stu-id="2b438-481">Start hello Stream Analytics job</span></span>
<span data-ttu-id="2b438-482">Пришло время toofinish hello настройки и запуска hello задания.</span><span class="sxs-lookup"><span data-stu-id="2b438-482">Now it's time toofinish hello configuration and start hello job.</span></span> <span data-ttu-id="2b438-483">Сохранить запрос hello из 3 вопроса, которые будут получены выходные данные, что совпадений hello схему hello **TollDataRefJoin** выходной таблицы.</span><span class="sxs-lookup"><span data-stu-id="2b438-483">Save hello query from Question 3, which will produce output that matches hello schema of hello **TollDataRefJoin** output table.</span></span>

<span data-ttu-id="2b438-484">Задание перейдите toohello **МОНИТОРИНГА**и нажмите кнопку **запустить**.</span><span class="sxs-lookup"><span data-stu-id="2b438-484">Go toohello job **DASHBOARD**, and click **START**.</span></span>

![Снимок экрана кнопку "Пуск" hello в панель мониторинга задания hello](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image48.png)

<span data-ttu-id="2b438-486">В hello открывшемся диалоговом окне, измените hello **ЗАПУСК ВЫВОДА** время слишком**время пользовательского**.</span><span class="sxs-lookup"><span data-stu-id="2b438-486">In hello dialog box that opens, change hello **START OUTPUT** time too**CUSTOM TIME**.</span></span> <span data-ttu-id="2b438-487">Изменение hello час tooone часа, после чего hello текущее время.</span><span class="sxs-lookup"><span data-stu-id="2b438-487">Change hello hour tooone hour before hello current time.</span></span> <span data-ttu-id="2b438-488">Это изменение гарантирует, что все события из концентратора событий hello обрабатываются с момента запуска toogenerate hello события в начале hello hello учебника.</span><span class="sxs-lookup"><span data-stu-id="2b438-488">This change ensures that all events from hello event hub are processed since you started toogenerate hello events at hello beginning of hello tutorial.</span></span> <span data-ttu-id="2b438-489">Теперь щелкните hello **запустить** кнопку toostart hello задания.</span><span class="sxs-lookup"><span data-stu-id="2b438-489">Now click hello **Start** button toostart hello job.</span></span>

![Выбор настраиваемого времени](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image49.png)

<span data-ttu-id="2b438-491">Запуск задания hello может занять несколько минут.</span><span class="sxs-lookup"><span data-stu-id="2b438-491">Starting hello job can take a few minutes.</span></span> <span data-ttu-id="2b438-492">Можно просматривать состояние hello на страницу приветствия верхнего уровня для Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="2b438-492">You can see hello status on hello top-level page for Stream Analytics.</span></span>

![Снимок экрана: hello состояние задания hello](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image50.png)

## <a name="check-results-in-visual-studio"></a><span data-ttu-id="2b438-494">Проверка результатов в Visual Studio</span><span class="sxs-lookup"><span data-stu-id="2b438-494">Check results in Visual Studio</span></span>
1. <span data-ttu-id="2b438-495">Откройте обозреватель серверов Visual Studio и щелкните правой кнопкой мыши hello **TollDataRefJoin** таблицы.</span><span class="sxs-lookup"><span data-stu-id="2b438-495">Open Visual Studio Server Explorer, and right-click hello **TollDataRefJoin** table.</span></span>
2. <span data-ttu-id="2b438-496">Нажмите кнопку **Показать таблицу данных** toosee hello выходные данные задания.</span><span class="sxs-lookup"><span data-stu-id="2b438-496">Click **Show Table Data** toosee hello output of your job.</span></span>
   
    ![Выбор "Показать таблицу данных" в обозревателе серверов](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image51.jpg)

## <a name="scale-out-azure-stream-analytics-jobs"></a><span data-ttu-id="2b438-498">Задания по масштабированию в Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="2b438-498">Scale out Azure Stream Analytics jobs</span></span>
<span data-ttu-id="2b438-499">Azure Stream Analytics предназначен tooelastically масштабирования, чтобы можно было обработать большой объем данных.</span><span class="sxs-lookup"><span data-stu-id="2b438-499">Azure Stream Analytics is designed tooelastically scale so that it can handle a lot of data.</span></span> <span data-ttu-id="2b438-500">можно использовать запрос Hello Azure Stream Analytics **PARTITION BY** предложение tootell hello системы, этот шаг будет горизонтального масштабирования. **PartitionId** — специальный столбец hello системы добавляет идентификатор секции hello toomatch входа hello (концентратор событий).</span><span class="sxs-lookup"><span data-stu-id="2b438-500">hello Azure Stream Analytics query can use a **PARTITION BY** clause tootell hello system that this step will scale out. **PartitionId** is a special column that hello system adds toomatch hello partition ID of hello input (event hub).</span></span>

    SELECT TollId, System.Timestamp AS WindowEnd, COUNT(*)AS Count
    FROM EntryStream TIMESTAMP BY EntryTime PARTITION BY PartitionId
    GROUP BY TUMBLINGWINDOW(minute,3), TollId, PartitionId

1. <span data-ttu-id="2b438-501">Остановка hello текущего задания, hello запроса update в hello **ЗАПРОСА** вкладка и откройте hello **параметры** шестеренки в панель мониторинга задания hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-501">Stop hello current job, update hello query in hello **QUERY** tab, and open hello **Settings** gear in hello job dashboard.</span></span> <span data-ttu-id="2b438-502">Щелкните пункт **Масштаб**.</span><span class="sxs-lookup"><span data-stu-id="2b438-502">Click **Scale**.</span></span>
   
    <span data-ttu-id="2b438-503">**ЕДИНИЦЫ потоковой ПЕРЕДАЧИ** определить hello объем вычислительной мощности, hello задания может получать.</span><span class="sxs-lookup"><span data-stu-id="2b438-503">**STREAMING UNITS** define hello amount of compute power that hello job can receive.</span></span>
2. <span data-ttu-id="2b438-504">Изменение hello раскрывающегося списка от 1 из 6.</span><span class="sxs-lookup"><span data-stu-id="2b438-504">Change hello drop down from 1 from 6.</span></span>
   
    ![Снимок экрана: выбор 6 единиц потоковой передачи](media/stream-analytics-build-an-iot-solution-using-stream-analytics/image52.png)
3. <span data-ttu-id="2b438-506">Go toohello **ВЫХОДОВ** вкладку и измените имя hello таблицы SQL hello слишком**TollDataTumblingCountPartitioned**.</span><span class="sxs-lookup"><span data-stu-id="2b438-506">Go toohello **OUTPUTS** tab and change hello name of hello SQL table too**TollDataTumblingCountPartitioned**.</span></span>

<span data-ttu-id="2b438-507">При запуске задания hello теперь Azure Stream Analytics можно распределить работу между дополнительные вычислительные ресурсы и улучшить производительность.</span><span class="sxs-lookup"><span data-stu-id="2b438-507">If you start hello job now, Azure Stream Analytics can distribute work across more compute resources and achieve better throughput.</span></span> <span data-ttu-id="2b438-508">Обратите внимание, что hello TollApp приложение также отправляет события, секционирована по TollId.</span><span class="sxs-lookup"><span data-stu-id="2b438-508">Please note that hello TollApp application is also sending events partitioned by TollId.</span></span>

## <a name="monitor"></a><span data-ttu-id="2b438-509">Монитор</span><span class="sxs-lookup"><span data-stu-id="2b438-509">Monitor</span></span>
<span data-ttu-id="2b438-510">Hello **монитор** область содержит статистические данные о выполнении задания hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-510">hello **MONITOR** area contains statistics about hello running job.</span></span> <span data-ttu-id="2b438-511">Первый раз Настройка требуется учетная запись хранения toouse hello в hello совпадают (имя платный как остальные hello в этом документе).</span><span class="sxs-lookup"><span data-stu-id="2b438-511">First time configuration is needed toouse hello storage account in hello same region (name toll like hello rest of this document).</span></span>   

![Снимок экрана области "Монитор"](media/stream-analytics-build-an-iot-solution-using-stream-analytics/monitoring.png)

<span data-ttu-id="2b438-513">Вы можете получить доступ к **журналы действий** из панели мониторинга задания hello **параметры** также области.</span><span class="sxs-lookup"><span data-stu-id="2b438-513">You can access **Activity Logs** from hello job dashboard **Settings** area as well.</span></span>


## <a name="conclusion"></a><span data-ttu-id="2b438-514">Заключение</span><span class="sxs-lookup"><span data-stu-id="2b438-514">Conclusion</span></span>
<span data-ttu-id="2b438-515">Этот учебник появился toohello службой Azure Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="2b438-515">This tutorial introduced you toohello Azure Stream Analytics service.</span></span> <span data-ttu-id="2b438-516">Он показано, как tooconfigure входов и выходов для hello задания Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="2b438-516">It demonstrated how tooconfigure inputs and outputs for hello Stream Analytics job.</span></span> <span data-ttu-id="2b438-517">С помощью сценария данных платный hello hello учебнике описано распространенных типов проблем, возникающих в пространстве данных в движения и как они могут быть устранены с помощью простых запросов в стиле SQL в Azure Stream Analytics hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-517">Using hello Toll Data scenario, hello tutorial explained common types of problems that arise in hello space of data in motion and how they can be solved with simple SQL-like queries in Azure Stream Analytics.</span></span> <span data-ttu-id="2b438-518">Учебник Hello описано конструкции SQL расширения для работы с темпоральных данных.</span><span class="sxs-lookup"><span data-stu-id="2b438-518">hello tutorial described SQL extension constructs for working with temporal data.</span></span> <span data-ttu-id="2b438-519">Показано, как потоки данных toojoin, как поток данных hello tooenrich с статические справочные данные и как tooscale ожидания запроса tooachieve более высокую пропускную способность.</span><span class="sxs-lookup"><span data-stu-id="2b438-519">It showed how toojoin data streams, how tooenrich hello data stream with static reference data, and how tooscale out a query tooachieve higher throughput.</span></span>

<span data-ttu-id="2b438-520">Несмотря на то что в этом руководстве хорошо представлена вступительная информация, оно является далеко не полным.</span><span class="sxs-lookup"><span data-stu-id="2b438-520">Although this tutorial provides a good introduction, it is not complete by any means.</span></span> <span data-ttu-id="2b438-521">Имеются дополнительные шаблоны запросов, с помощью языка SAQL hello в [примеры для распространенных шаблонов использования Stream Analytics запроса](stream-analytics-stream-analytics-query-patterns.md).</span><span class="sxs-lookup"><span data-stu-id="2b438-521">You can find more query patterns using hello SAQL language at [Query examples for common Stream Analytics usage patterns](stream-analytics-stream-analytics-query-patterns.md).</span></span>
<span data-ttu-id="2b438-522">См. toohello [документации](https://azure.microsoft.com/documentation/services/stream-analytics/) toolearn больше о Azure Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="2b438-522">Refer toohello [online documentation](https://azure.microsoft.com/documentation/services/stream-analytics/) toolearn more about Azure Stream Analytics.</span></span>

## <a name="clean-up-your-azure-account"></a><span data-ttu-id="2b438-523">Очистка учетной записи Azure</span><span class="sxs-lookup"><span data-stu-id="2b438-523">Clean up your Azure account</span></span>
1. <span data-ttu-id="2b438-524">Остановка задания Stream Analytics hello в hello портал Azure.</span><span class="sxs-lookup"><span data-stu-id="2b438-524">Stop hello Stream Analytics job in hello Azure portal.</span></span>
   
    <span data-ttu-id="2b438-525">Hello Setup.ps1 скрипт создает два концентраторов событий и базы данных SQL.</span><span class="sxs-lookup"><span data-stu-id="2b438-525">hello Setup.ps1 script creates two event hubs and a SQL database.</span></span> <span data-ttu-id="2b438-526">следующие инструкции помогут очистки ресурсов в конце hello учебника hello Hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-526">hello following instructions help you clean up resources at hello end of hello tutorial.</span></span>
2. <span data-ttu-id="2b438-527">В окне PowerShell, введите **.\\ Cleanup.ps1** toostart hello скрипт, который удаляет ресурсы, используемые в учебнике hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-527">In a PowerShell window, type **.\\Cleanup.ps1** toostart hello script that deletes resources used in hello tutorial.</span></span>
   
   > [!NOTE]
   > <span data-ttu-id="2b438-528">Ресурсы идентифицируются по имени hello.</span><span class="sxs-lookup"><span data-stu-id="2b438-528">Resources are identified by hello name.</span></span> <span data-ttu-id="2b438-529">Убедитесь, что перед подтверждением удаления вы внимательно просмотрели каждый элемент.</span><span class="sxs-lookup"><span data-stu-id="2b438-529">Make sure you carefully review each item before confirming removal.</span></span>
   > 
   > 


