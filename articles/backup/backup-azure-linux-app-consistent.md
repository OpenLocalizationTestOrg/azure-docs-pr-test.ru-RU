---
title: "Служба архивации Azure: согласованное с приложениями резервное копирование виртуальных машин Linux | Документы Майкрософт"
description: "Используйте tooAzure резервных копий, согласованных приложения tooguarantee сценарии, для виртуальных машин Linux. сценарии Hello применяются только tooLinux виртуальные машины в развертывании диспетчера ресурсов; tooWindows виртуальные машины или службы диспетчера развертывания скриптов Hello не применяются. В этой статье описывается hello действия по настройке hello сценарии, включая устранение неполадок."
services: backup
documentationcenter: dev-center-name
author: anuragmehrotra
manager: shivamg
keywords: "согласованное с приложениями резервное копирование; согласованное с приложениями резервное копирование виртуальных машин Azure; резервное копирование виртуальных машин Linux; служба архивации Azure"
ms.assetid: bbb99cf2-d8c7-4b3d-8b29-eadc0fed3bef
ms.service: backup
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 4/12/2017
ms.author: anuragm;markgal
ms.openlocfilehash: d557dd973364d79bb4d8ce954f648de835dd345f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="application-consistent-backup-of-azure-linux-vms-preview"></a>Согласованное с приложениями резервное копирование виртуальных машин Azure Linux (предварительная версия)

В этой статье рассказывается о hello сценариев предварительной Linux и скрипт, выполняемый после платформы и как можно используется tootake согласованных с приложением резервные копии виртуальных машин Linux в Azure.

> [!Note]
> Примеры сценариев до и после framework Hello поддерживается только для виртуальных машин Linux развертывания диспетчера ресурсов Azure. Скрипты для обеспечения согласованности приложений не поддерживаются для виртуальных машин, развернутых с помощью Service Manager, и виртуальных машин Windows.
>

## <a name="how-hello-framework-works"></a>Как работает hello framework

Hello framework предоставляет параметр toorun пользовательские скрипты до и после сценариев во время ввода моментальные снимки виртуальной Машины. Предварительная скрипты выполняются непосредственно перед сделать снимок виртуальной Машины hello и скрипты, выполняемые после выполнения сразу же после выполнения моментального снимка виртуальной Машины hello. Это дает hello toocontrol гибкость приложения и среды во время ввода моментальные снимки виртуальной Машины.

В этом случае это важно tooensure при согласованных с приложением резервная копия виртуальной Машины. Скрипт предварительного Hello можно вызывать hello tooquiesce API-интерфейсы собственного приложения IOs и очистки диска toohello содержимого в памяти. Это гарантирует наличие hello моментального снимка согласованных на уровне приложения (то есть, это приложение hello приходится сталкиваться при hello, виртуальная машина загружается после восстановления). После сценарий может быть hello используется toothaw операций ввода-вывода. Это делается с помощью API-интерфейсы собственного приложения, чтобы приложение hello может возобновить моментальный снимок виртуальной Машины post обычных операций.

## <a name="steps-tooconfigure-pre-script-and-post-script"></a>Действия tooconfigure сценариев до и после

1. Войдите в корневой пользователя toohello виртуальных Машин Linux, необходимо tooback hello.

2. Загрузить **VMSnapshotScriptPluginConfig.json** из [GitHub](https://github.com/MicrosoftAzureBackup/VMSnapshotPluginConfig)и скопируйте его toohello **/etc/azure** папки на всех виртуальных машинах hello, которые будут tooback вверх. Создать hello **/etc/azure** каталог, если он уже не существует.

3. Скопируйте hello предварительной скрипт и после для приложения hello все виртуальные машины, которые tooback вверх. Можно скопировать расположение tooany hello скрипты на hello виртуальной Машины. Быть файлы-скрипты hello убедиться, что tooupdate hello полный путь к hello **VMSnapshotScriptPluginConfig.json** файла.

4. Убедитесь, hello следующие разрешения для этих файлов.

   - **VMSnapshotScriptPluginConfig.json**: разрешение "600". Например только пользователь «root» должен иметь файл toothis разрешения «чтение» и «запись», и пользователь не должен иметь разрешения «выполнение».

   - **Файл скрипта предварительного выполнения**: разрешение "700".  Например, должен иметь только пользователь «root» «чтение», «запись» и «выполнение» файл toothis разрешений.
  
   - **Файл скрипта последующего выполнения**: разрешение "700". Например, должен иметь только пользователь «root» «чтение», «запись» и «выполнение» файл toothis разрешений.

   > [!Important]
   > Hello framework предоставляет пользователям большое количество электроэнергии. Очень важно, что безопасное и, только пользователь «root» имеет доступ к файлам toocritical JSON и сценарий.
   > Если hello предыдущих требования не выполнены, hello сценарий не запускается. В результате будет создана резервная копия, согласованная с состоянием файловой системы на момент сбоя.
   >

5. Настройте файл **VMSnapshotScriptPluginConfig.json**, как описано далее.
    - **pluginName** — оставьте значение без изменения. Иначе скрипты могут выполняться неправильно.

    - **preScriptLocation**: укажите полный путь hello hello предварительной скрипта на hello с постоянной toobe резервного копирования виртуальной Машины.

    - **postScriptLocation**: укажите полный путь hello hello после скрипта на hello с постоянной toobe резервного копирования виртуальной Машины.

    - **preScriptParams**: предоставляют hello необязательные параметры, требующие toobe передан toohello предварительной скрипта. Все параметры должны быть заключены в кавычки и разделены запятыми, если их несколько.

    - **postScriptParams**: укажите hello необязательные параметры, которые требуется передать скрипт после toohello toobe. Все параметры должны быть заключены в кавычки и разделены запятыми, если их несколько.

    - **preScriptNoOfRetries**: задать hello количество раз, следует повторить hello до сценария, при наличии ошибок перед завершением работы. "0" означает один запуск без повторных попыток в случае сбоя.

    - **postScriptNoOfRetries**: задать hello количество раз, следует повторить после сценария hello, при наличии ошибок перед завершением работы. "0" означает один запуск без повторных попыток в случае сбоя.
    
    - **Период_ожидания_в_секундах**: укажите отдельные значения времени ожидания для hello предварительной hello после скрипт и.

    - **continueBackupOnFailure**: это значение слишком**true** Если нужно резервного копирования Azure toofall задней tooa согласованное согласованное или сбоя резервная копия файловой системы, если скрипт до или после скрипт завершается с ошибкой. Установка этого параметра слишком**false** завершается с ошибкой hello резервного копирования, в случае сбоя сценария (за исключением того, при наличии виртуальной Машины с одним диском, возвращается обратно toocrash резервное копирование независимо от этого параметра).

    - **fsFreezeEnabled**: Укажите, должен быть вызван Linux fsfreeze, пока выполняется переход целостность hello ВМ моментального снимка tooensure файловой системы. Рекомендуется оставить этот параметр, задайте слишком**true** Если приложение имеет зависимость от отключение fsfreeze.

6. Теперь настроен framework скрипт Hello. Если резервная копия виртуальной Машины hello уже настроена, hello следующая резервная копия вызывает скрипты hello и запускает приложение согласованное резервное копирование. Если резервная копия виртуальной Машины hello не настроен, настройте его с помощью [резервное копирование виртуальных машин Azure tooRecovery служб хранилища.](https://docs.microsoft.com/azure/backup/backup-azure-vms-first-look-arm)

## <a name="troubleshooting"></a>Устранение неполадок

Убедитесь, что соответствующие данные в журнал при записи вашего сценариев до и после добавления и увидеть ваш скрипт журналы toofix проблемы скрипта. Если возникают проблемы при выполнении скриптов см. в следующей таблице подробнее toohello.

| Ошибка | Сообщение об ошибке | Рекомендуемое действие |
| ------------------------ | -------------- | ------------------ |
| Pre-ScriptExecutionFailed |Скрипт предварительного Hello вернула ошибку, поэтому резервной копии может быть не согласованы для приложения. | Просмотрите журналы hello сбоя для существующей неполадки hello toofix сценария.|  
|   Post-ScriptExecutionFailed |    скрипт после Hello вернул ошибку, которая может повлиять на состояние приложения. |  В журналах hello сбоя для существующей неполадки hello toofix сценарий и проверьте состояние приложения hello. |
| Pre-ScriptNotFound |  Hello предварительной скрипта не найден по hello расположение, указанное в hello **VMSnapshotScriptPluginConfig.json** файла конфигурации. | Убедитесь, что это предварительная сценария убедитесь присутствует в hello путь, указанный в hello config tooensure согласованных с приложением резервной копии файлов.|
| Post-ScriptNotFound | Hello после скрипта не найден в расположении hello, указанный в hello **VMSnapshotScriptPluginConfig.json** файла конфигурации. | Убедитесь, что то после сценария убедитесь присутствует в hello путь, указанный в hello config tooensure согласованных с приложением резервной копии файлов.|
| IncorrectPluginhostFile | Hello **Pluginhost** файл, который поставляется вместе с hello VmSnapshotLinux расширения, поврежден, поэтому hello резервного копирования не были согласованных на уровне приложения, не удается запустить примеры сценариев до и после.   | Удаление hello **VmSnapshotLinux** расширения и он будет установлен автоматически hello следующего резервного копирования toofix hello проблемы. |
| IncorrectJSONConfigFile | Hello **VMSnapshotScriptPluginConfig.json** файл указан неверно, поэтому перед скрипт и невозможно запустить скрипт, выполняемый после hello резервного копирования не будет согласованных на уровне приложения. | Загрузите копию hello из [GitHub](https://github.com/MicrosoftAzureBackup/VMSnapshotPluginConfig) и заново настроить. |
| InsufficientPermissionforPre-Script | Для выполнения скриптов, пользователь «root» должен быть hello владельца файла hello и hello файл должен иметь разрешения «700» (то есть, должны иметь только «владелец» «чтение», «запись» и «выполнение» разрешения). | Убедитесь, что пользователь «root» является «владелец» файл скрипта hello hello и, только «владелец» «чтение», «написать отзыв» и «выполнение». |
| InsufficientPermissionforPost-Script | Для выполнения скриптов, пользователь root должен hello владельца файла hello и hello файл должен иметь разрешения «700» (то есть, должны иметь только «владелец» «чтение», «запись» и «выполнение» разрешения). | Убедитесь, что пользователь «root» является «владелец» файл скрипта hello hello и, только «владелец» «чтение», «написать отзыв» и «выполнение». |
| Pre-ScriptTimeout | Hello выполнении сценария перед согласованных с приложениями резервного копирования hello тайм аута. | Проверьте сценарий hello и увеличьте время ожидания hello в hello **VMSnapshotScriptPluginConfig.json** файла, который расположен по адресу **azure/etc/**. |
| Post-ScriptTimeout | Истекло время ожидания выполнения сценария согласованных с приложениями резервного копирования после hello Hello. | Проверьте сценарий hello и увеличьте время ожидания hello в hello **VMSnapshotScriptPluginConfig.json** файла, который расположен по адресу **azure/etc/**. |

## <a name="next-steps"></a>Дальнейшие действия
[Настройте хранилище служб восстановления tooa резервного копирования виртуальной Машины](https://docs.microsoft.com/azure/backup/backup-azure-arm-vms)
