---
title: "aaaPlanning инфраструктуру резервного копирования виртуальной Машины в Azure | Документы Microsoft"
description: "Важные вопросы при планировании tooback копирование виртуальных машин в Azure"
services: backup
documentationcenter: 
author: markgalioto
manager: carmonm
editor: 
keywords: "архивация ВМ, архивация виртуальных машин"
ms.assetid: 19d2cf82-1f60-43e1-b089-9238042887a9
ms.service: backup
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 7/18/2017
ms.author: markgal;trinadhk
ms.openlocfilehash: d11982431610000293038ee6aa7df8e7bc2d8b70
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="plan-your-vm-backup-infrastructure-in-azure"></a><span data-ttu-id="65c7e-104">Планирование инфраструктуры резервного копирования виртуальных машин в Azure</span><span class="sxs-lookup"><span data-stu-id="65c7e-104">Plan your VM backup infrastructure in Azure</span></span>
<span data-ttu-id="65c7e-105">Эта статья содержит производительности и ресурсов предложения toohelp планирование инфраструктуры резервного копирования виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="65c7e-105">This article provides performance and resource suggestions toohelp you plan your VM backup infrastructure.</span></span> <span data-ttu-id="65c7e-106">Он также определяет ключевые аспекты hello службы резервного копирования; Эти аспекты может быть вызвана для определения архитектуры, Планирование производительности и планирования.</span><span class="sxs-lookup"><span data-stu-id="65c7e-106">It also defines key aspects of hello Backup service; these aspects can be critical in determining your architecture, capacity planning, and scheduling.</span></span> <span data-ttu-id="65c7e-107">Если вы уже [подготовки среды](backup-azure-vms-prepare.md), планирование, стало hello следующий шаг перед началом [tooback виртуальных машин](backup-azure-vms.md).</span><span class="sxs-lookup"><span data-stu-id="65c7e-107">If you've [prepared your environment](backup-azure-vms-prepare.md), planning is hello next step before you begin [tooback up VMs](backup-azure-vms.md).</span></span> <span data-ttu-id="65c7e-108">Если требуются дополнительные сведения о виртуальных машинах Azure, см. раздел hello [документация по виртуальным машинам](https://azure.microsoft.com/documentation/services/virtual-machines/).</span><span class="sxs-lookup"><span data-stu-id="65c7e-108">If you need more information about Azure virtual machines, see hello [Virtual Machines documentation](https://azure.microsoft.com/documentation/services/virtual-machines/).</span></span>

## <a name="how-does-azure-back-up-virtual-machines"></a><span data-ttu-id="65c7e-109">Как Azure выполняет резервное копирование виртуальных машин</span><span class="sxs-lookup"><span data-stu-id="65c7e-109">How does Azure back up virtual machines?</span></span>
<span data-ttu-id="65c7e-110">Когда служба резервного копирования Azure hello инициирует задание резервного копирования во время запланированного hello, оно активирует tootake hello расширение резервного копирования моментального снимка на момент.</span><span class="sxs-lookup"><span data-stu-id="65c7e-110">When hello Azure Backup service initiates a backup job at hello scheduled time, it triggers hello backup extension tootake a point-in-time snapshot.</span></span> <span data-ttu-id="65c7e-111">Hello службы архивации Azure использует hello _VMSnapshot_ расширения в Windows и hello _VMSnapshotLinux_ расширения в Linux.</span><span class="sxs-lookup"><span data-stu-id="65c7e-111">hello Azure Backup service uses hello _VMSnapshot_ extension in Windows, and hello _VMSnapshotLinux_ extension in Linux.</span></span> <span data-ttu-id="65c7e-112">расширение Hello устанавливается во время hello первая резервная копия виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="65c7e-112">hello extension is installed during hello first VM backup.</span></span> <span data-ttu-id="65c7e-113">расширение tooinstall hello, hello виртуальная машина должна быть запущена.</span><span class="sxs-lookup"><span data-stu-id="65c7e-113">tooinstall hello extension, hello VM must be running.</span></span> <span data-ttu-id="65c7e-114">Если hello Виртуальная машина не запущена, hello службы резервного копирования снимок hello базовое хранилище (так как не записывайте возникать при hello остановки виртуальной Машины).</span><span class="sxs-lookup"><span data-stu-id="65c7e-114">If hello VM is not running, hello Backup service takes a snapshot of hello underlying storage (since no application writes occur while hello VM is stopped).</span></span>

<span data-ttu-id="65c7e-115">При создании моментального снимка ВМ Windows, служба резервного копирования hello координирует с помощью службы теневого копирования томов (VSS) tooget hello согласованный моментальный снимок диски hello виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="65c7e-115">When taking a snapshot of Windows VMs, hello Backup service coordinates with hello Volume Shadow Copy Service (VSS) tooget a consistent snapshot of hello virtual machine's disks.</span></span> <span data-ttu-id="65c7e-116">Если выполняется резервное копирование виртуальных машин Linux, можно написать собственные пользовательские сценарии tooensure согласованности при создании моментального снимка виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="65c7e-116">If you're backing up Linux VMs, you can write your own custom scripts tooensure consistency when taking a VM snapshot.</span></span> <span data-ttu-id="65c7e-117">Подробные сведения о вызове таких скриптов приводятся далее в этой статье.</span><span class="sxs-lookup"><span data-stu-id="65c7e-117">Details on invoking these scripts are provided later in this article.</span></span>

<span data-ttu-id="65c7e-118">Hello службы архивации Azure делает снимок hello, hello данных после переносятся toohello хранилища.</span><span class="sxs-lookup"><span data-stu-id="65c7e-118">Once hello Azure Backup service takes hello snapshot, hello data is transferred toohello vault.</span></span> <span data-ttu-id="65c7e-119">эффективность toomaximize hello служба определяет и передает только hello блоков данных, которые были изменены с момента предыдущего резервного копирования hello.</span><span class="sxs-lookup"><span data-stu-id="65c7e-119">toomaximize efficiency, hello service identifies and transfers only hello blocks of data that have changed since hello previous backup.</span></span>

![Архитектура резервного копирования виртуальных машин Azure](./media/backup-azure-vms-introduction/vmbackup-architecture.png)

<span data-ttu-id="65c7e-121">После завершения передачи данных hello hello снимок удаляется и создается точка восстановления.</span><span class="sxs-lookup"><span data-stu-id="65c7e-121">When hello data transfer is complete, hello snapshot is removed and a recovery point is created.</span></span>

> [!NOTE]
> 1. <span data-ttu-id="65c7e-122">Во время процесса резервного копирования hello Azure Backup не содержит hello временный диск, подключенный toohello виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="65c7e-122">During hello backup process, Azure Backup doesn't include hello temporary disk attached toohello virtual machine.</span></span> <span data-ttu-id="65c7e-123">Дополнительные сведения см. в статье блога hello на [временного хранилища](https://blogs.msdn.microsoft.com/mast/2013/12/06/understanding-the-temporary-drive-on-windows-azure-virtual-machines/).</span><span class="sxs-lookup"><span data-stu-id="65c7e-123">For more information, see hello blog on [temporary storage](https://blogs.msdn.microsoft.com/mast/2013/12/06/understanding-the-temporary-drive-on-windows-azure-virtual-machines/).</span></span>
> 2. <span data-ttu-id="65c7e-124">Поскольку моментальный снимок уровня хранилища и передачи, моментальный снимок toovault берет резервного копирования Azure, не изменяйте hello ключи учетной записи хранения до завершения задания резервного копирования hello.</span><span class="sxs-lookup"><span data-stu-id="65c7e-124">Since Azure Backup takes a storage-level snapshot and transfers that snapshot toovault, do not change hello storage account keys until hello backup job finishes.</span></span>
> 3. <span data-ttu-id="65c7e-125">Для виртуальных машин premium Мы копируем счет toostorage hello моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="65c7e-125">For premium VMs, we copy hello snapshot toostorage account.</span></span> <span data-ttu-id="65c7e-126">Это, чтобы убедиться, что службы архивации Azure получает достаточно операций ввода-ВЫВОДА для передачи данных toovault toomake.</span><span class="sxs-lookup"><span data-stu-id="65c7e-126">This is toomake sure that Azure Backup service gets sufficient IOPS for transferring data toovault.</span></span> <span data-ttu-id="65c7e-127">Этой дополнительной копии хранилища оплачивается согласно hello выделенный размер виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="65c7e-127">This additional copy of storage is charged as per hello VM allocated size.</span></span> 
>

### <a name="data-consistency"></a><span data-ttu-id="65c7e-128">Согласованность данных</span><span class="sxs-lookup"><span data-stu-id="65c7e-128">Data consistency</span></span>
<span data-ttu-id="65c7e-129">Резервное копирование и восстановление важных деловых данных осложняется hello факт, что необходимо архивировать важных деловых данных во время приложения hello, производящих hello данных работают.</span><span class="sxs-lookup"><span data-stu-id="65c7e-129">Backing up and restoring business critical data is complicated by hello fact that business critical data must be backed up while hello applications that produce hello data are running.</span></span> <span data-ttu-id="65c7e-130">tooaddress, резервного копирования Azure поддерживает согласованных с приложением резервного копирования для Windows и виртуальных машин Linux</span><span class="sxs-lookup"><span data-stu-id="65c7e-130">tooaddress this, Azure Backup supports application-consistent backups for both Windows and Linux VMs</span></span>
#### <a name="windows-vm"></a><span data-ttu-id="65c7e-131">Виртуальная машина Windows</span><span class="sxs-lookup"><span data-stu-id="65c7e-131">Windows VM</span></span>
<span data-ttu-id="65c7e-132">Служба архивации Azure принимает полные резервные копии VSS на виртуальных машинах Windows (дополнительные сведения см. в записи блога о [полном резервном копировании VSS](http://blogs.technet.com/b/filecab/archive/2008/05/21/what-is-the-difference-between-vss-full-backup-and-vss-copy-backup-in-windows-server-2008.aspx)).</span><span class="sxs-lookup"><span data-stu-id="65c7e-132">Azure Backup takes VSS full backups on Windows VMs (read more about [VSS full backup](http://blogs.technet.com/b/filecab/archive/2008/05/21/what-is-the-difference-between-vss-full-backup-and-vss-copy-backup-in-windows-server-2008.aspx)).</span></span> <span data-ttu-id="65c7e-133">резервного копирования VSS tooenable, hello после набора toobe потребностей ключей реестра на hello виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="65c7e-133">tooenable VSS copy backups, hello following registry key needs toobe set on hello VM.</span></span>

```
[HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\BCDRAGENT]
"USEVSSCOPYBACKUP"="TRUE"
```

#### <a name="linux-vms"></a><span data-ttu-id="65c7e-134">Виртуальные машины Linux</span><span class="sxs-lookup"><span data-stu-id="65c7e-134">Linux VMs</span></span>
<span data-ttu-id="65c7e-135">Служба архивации Azure предоставляет платформу скриптов.</span><span class="sxs-lookup"><span data-stu-id="65c7e-135">Azure Backup provides a scripting framework.</span></span> <span data-ttu-id="65c7e-136">согласованность приложения tooensure при резервном копировании виртуальных машин Linux, создайте пользовательские сценарии перед и после скриптов, которые управляют рабочего процесса резервного копирования hello и среды.</span><span class="sxs-lookup"><span data-stu-id="65c7e-136">tooensure application consistency when backing up Linux VMs, create custom pre-scripts and post-scripts that control hello backup workflow and environment.</span></span> <span data-ttu-id="65c7e-137">Резервное копирование Azure вызывает hello предварительной скрипт перед созданием моментального снимка виртуальной Машины hello и вызывает скрипт, выполняемый после hello после завершения задания моментального снимка виртуальной Машины hello.</span><span class="sxs-lookup"><span data-stu-id="65c7e-137">Azure Backup invokes hello pre-script before taking hello VM snapshot and invokes hello post-script once hello VM snapshot job completes.</span></span> <span data-ttu-id="65c7e-138">Подробные сведения см. в разделе [Согласованное с приложениями резервное копирование виртуальных машин Azure Linux](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent).</span><span class="sxs-lookup"><span data-stu-id="65c7e-138">For more details, see [application consistent VM backups using pre-script and post-script](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent).</span></span>
> [!NOTE]
> <span data-ttu-id="65c7e-139">Резервного копирования Azure только вызывает hello записи клиента до и после сценариев.</span><span class="sxs-lookup"><span data-stu-id="65c7e-139">Azure Backup only invokes hello customer-written pre- and post-scripts.</span></span> <span data-ttu-id="65c7e-140">Если скрипт предварительной hello и скрипты, выполняемые после успешного выполнения, резервного копирования Azure помечает hello точку восстановления как приложение согласованной.</span><span class="sxs-lookup"><span data-stu-id="65c7e-140">If hello pre-script and post-scripts execute successfully, Azure Backup marks hello recovery point as application consistent.</span></span> <span data-ttu-id="65c7e-141">Однако клиент hello отвечает в итоге для обеспечения согласованности приложения hello при использовании пользовательских сценариев.</span><span class="sxs-lookup"><span data-stu-id="65c7e-141">However, hello customer is ultimately responsible for hello application consistency when using custom scripts.</span></span>
>


<span data-ttu-id="65c7e-142">В этой таблице описываются типы hello согласованности и hello условия, проводить во время резервного копирования виртуальной Машины Azure и восстановления.</span><span class="sxs-lookup"><span data-stu-id="65c7e-142">This table explains hello types of consistency and hello conditions that they occur under during Azure VM backup and restore procedures.</span></span>

| <span data-ttu-id="65c7e-143">Целостность</span><span class="sxs-lookup"><span data-stu-id="65c7e-143">Consistency</span></span> | <span data-ttu-id="65c7e-144">На основе VSS</span><span class="sxs-lookup"><span data-stu-id="65c7e-144">VSS-based</span></span> | <span data-ttu-id="65c7e-145">Подробное объяснение</span><span class="sxs-lookup"><span data-stu-id="65c7e-145">Explanation and details</span></span> |
| --- | --- | --- |
| <span data-ttu-id="65c7e-146">Целостность на уровне приложения</span><span class="sxs-lookup"><span data-stu-id="65c7e-146">Application consistency</span></span> |<span data-ttu-id="65c7e-147">Да для Windows.</span><span class="sxs-lookup"><span data-stu-id="65c7e-147">Yes for Windows</span></span>|<span data-ttu-id="65c7e-148">Согласованность приложений идеально подходит для рабочих нагрузок, так как гарантирует следующее:</span><span class="sxs-lookup"><span data-stu-id="65c7e-148">Application consistency is ideal for workloads as it ensures that:</span></span><ol><li> <span data-ttu-id="65c7e-149">Hello ВМ *загружается*.</span><span class="sxs-lookup"><span data-stu-id="65c7e-149">hello VM *boots up*.</span></span> <li><span data-ttu-id="65c7e-150">*Нет повреждений данных*.</span><span class="sxs-lookup"><span data-stu-id="65c7e-150">There is *no corruption*.</span></span> <li><span data-ttu-id="65c7e-151">*Нет потерь данных*.</span><span class="sxs-lookup"><span data-stu-id="65c7e-151">There is *no data loss*.</span></span><li> <span data-ttu-id="65c7e-152">Hello данных — согласованного toohello приложение, которое использует данные hello, включающих приложения hello во время hello резервного копирования — с помощью скрипта VSS или pre и post.</span><span class="sxs-lookup"><span data-stu-id="65c7e-152">hello data is consistent toohello application that uses hello data, by involving hello application at hello time of backup--using VSS or pre/post script.</span></span></ol> <li><span data-ttu-id="65c7e-153">*Виртуальные машины Windows*-рабочих нагрузок наиболее Майкрософт имеют модули записи VSS, выполните действия конкретных рабочих нагрузок связанные toodata согласованности.</span><span class="sxs-lookup"><span data-stu-id="65c7e-153">*Windows VMs*- Most Microsoft workloads have VSS writers that do workload-specific actions related toodata consistency.</span></span> <span data-ttu-id="65c7e-154">Например Microsoft SQL Server имеется модуль записи VSS, гарантирует правильной реализации файла журнала транзакций toohello записи hello и hello базы данных.</span><span class="sxs-lookup"><span data-stu-id="65c7e-154">For example, Microsoft SQL Server has a VSS writer that ensures that hello writes toohello transaction log file and hello database are done correctly.</span></span> <span data-ttu-id="65c7e-155">Для резервного копирования виртуальной Машины Windows Azure, toocreate точки восстановления, согласованной приложения hello расширение резервного копирования вызова рабочего процесса VSS hello и завершить ее перед созданием моментального снимка виртуальной Машины hello.</span><span class="sxs-lookup"><span data-stu-id="65c7e-155">For Azure Windows VM backups, toocreate an application-consistent recovery point, hello backup extension must invoke hello VSS workflow and complete it before taking hello VM snapshot.</span></span> <span data-ttu-id="65c7e-156">Для toobe моментальный снимок виртуальной Машины Azure hello точные модули записи VSS hello всех приложений на виртуальной Машине Azure, необходимо выполнить также.</span><span class="sxs-lookup"><span data-stu-id="65c7e-156">For hello Azure VM snapshot toobe accurate, hello VSS writers of all Azure VM applications must complete as well.</span></span> <span data-ttu-id="65c7e-157">(Дополнительные сведения hello [основы VSS](http://blogs.technet.com/b/josebda/archive/2007/10/10/the-basics-of-the-volume-shadow-copy-service-vss.aspx) и углубиться в hello подробные сведения о [принцип работы](https://technet.microsoft.com/library/cc785914%28v=ws.10%29.aspx)).</span><span class="sxs-lookup"><span data-stu-id="65c7e-157">(Learn hello [basics of VSS](http://blogs.technet.com/b/josebda/archive/2007/10/10/the-basics-of-the-volume-shadow-copy-service-vss.aspx) and dive deep into hello details of [how it works](https://technet.microsoft.com/library/cc785914%28v=ws.10%29.aspx)).</span></span> </li> <li> <span data-ttu-id="65c7e-158">*Виртуальные машины Linux*-клиенты могут выполнять [согласованность приложения пользовательских сценариев до и после tooensure](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent).</span><span class="sxs-lookup"><span data-stu-id="65c7e-158">*Linux VMs*- Customers can execute [custom pre-script and post-script tooensure application consistency](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent).</span></span> </li> |
| <span data-ttu-id="65c7e-159">Согласованность файловой системы</span><span class="sxs-lookup"><span data-stu-id="65c7e-159">File-system consistency</span></span> |<span data-ttu-id="65c7e-160">Да — для компьютеров под управлением Windows</span><span class="sxs-lookup"><span data-stu-id="65c7e-160">Yes - for Windows-based computers</span></span> |<span data-ttu-id="65c7e-161">Существует два сценария, где может быть точка восстановления hello *файловой системы согласованного*:</span><span class="sxs-lookup"><span data-stu-id="65c7e-161">There are two scenarios where hello recovery point can be *file-system consistent*:</span></span><ul><li><span data-ttu-id="65c7e-162">резервные копии виртуальных машин Linux в Azure, для которых предварительный и последующий сценарии не запускались либо завершились ошибкой;</span><span class="sxs-lookup"><span data-stu-id="65c7e-162">Backups of Linux VMs in Azure, without pre-script/post-script or if pre-script/post-script failed.</span></span> <li><span data-ttu-id="65c7e-163">сбой VSS во время резервного копирования виртуальных машин Windows в Azure.</span><span class="sxs-lookup"><span data-stu-id="65c7e-163">VSS failure during backup for Windows VMs in Azure.</span></span></li></ul> <span data-ttu-id="65c7e-164">В обоих этих случаях hello рекомендации, можно сделать — tooensure:</span><span class="sxs-lookup"><span data-stu-id="65c7e-164">In both these cases, hello best that can be done is tooensure that:</span></span> <ol><li> <span data-ttu-id="65c7e-165">Hello ВМ *загружается*.</span><span class="sxs-lookup"><span data-stu-id="65c7e-165">hello VM *boots up*.</span></span> <li><span data-ttu-id="65c7e-166">*Нет повреждений данных*.</span><span class="sxs-lookup"><span data-stu-id="65c7e-166">There is *no corruption*.</span></span><li><span data-ttu-id="65c7e-167">*Нет потерь данных*.</span><span class="sxs-lookup"><span data-stu-id="65c7e-167">There is *no data loss*.</span></span></ol> <span data-ttu-id="65c7e-168">Приложения должны hello восстановить данные с помощью механизма tooimplement собственные «исправление вверх».</span><span class="sxs-lookup"><span data-stu-id="65c7e-168">Applications need tooimplement their own "fix-up" mechanism on hello restored data.</span></span> |
| <span data-ttu-id="65c7e-169">Отказоустойчивость</span><span class="sxs-lookup"><span data-stu-id="65c7e-169">Crash consistency</span></span> |<span data-ttu-id="65c7e-170">Нет</span><span class="sxs-lookup"><span data-stu-id="65c7e-170">No</span></span> |<span data-ttu-id="65c7e-171">Такая ситуация встречается эквивалентные tooa виртуальной машины, возникают «сбой» (с помощью программным или аппаратным reset).</span><span class="sxs-lookup"><span data-stu-id="65c7e-171">This situation is equivalent tooa virtual machine experiencing a "crash" (through either a soft or hard reset).</span></span> <span data-ttu-id="65c7e-172">На случай сбоя обычно происходит при выключении hello виртуальной машины Azure во время hello резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="65c7e-172">Crash consistency typically happens when hello Azure virtual machine is shut down at hello time of backup.</span></span> <span data-ttu-id="65c7e-173">Точка восстановления на момент аварийного завершения предоставляет никаких гарантий вокруг hello согласованность данных hello на носителе hello — либо с точки зрения hello hello операционной системы или приложения hello.</span><span class="sxs-lookup"><span data-stu-id="65c7e-173">A crash-consistent recovery point provides no guarantees around hello consistency of hello data on hello storage medium--either from hello perspective of hello operating system or hello application.</span></span> <span data-ttu-id="65c7e-174">Только данные hello, уже существует на диске hello во время hello резервного копирования, собираются и резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="65c7e-174">Only hello data that already exists on hello disk at hello time of backup is captured and backed up.</span></span> <br/> <br/> <span data-ttu-id="65c7e-175">Здравствуйте загрузки операционной системы, следуют проверки диска, пока нет гарантий, как правило, процедура, как chkdsk, toofix ошибки повреждения.</span><span class="sxs-lookup"><span data-stu-id="65c7e-175">While there are no guarantees, usually, hello operating system boots, followed by disk-checking procedure, like chkdsk, toofix any corruption errors.</span></span> <span data-ttu-id="65c7e-176">Любые данные в памяти или операций записи, которые не были переносятся toohello диска будут потеряны.</span><span class="sxs-lookup"><span data-stu-id="65c7e-176">Any in-memory data or writes that have not been transferred toohello disk are lost.</span></span> <span data-ttu-id="65c7e-177">в случае, если данные отката должен сделать toobe приложения Hello обычно соответствует с собственный механизм проверки.</span><span class="sxs-lookup"><span data-stu-id="65c7e-177">hello application typically follows with its own verification mechanism in case data rollback needs toobe done.</span></span> <br><br><span data-ttu-id="65c7e-178">Например, если журнал транзакций hello записей, которые отсутствуют в базе данных hello, затем hello базы данных программное обеспечение выполняет откат до hello согласовывается.</span><span class="sxs-lookup"><span data-stu-id="65c7e-178">As an example, if hello transaction log has entries that are not present in hello database, then hello database software does a rollback until hello data is consistent.</span></span> <span data-ttu-id="65c7e-179">Когда данные распределяются на несколько виртуальных дисков (например составные тома), точку восстановления на момент аварийного завершения предоставляет никаких гарантий для hello правильность данных hello.</span><span class="sxs-lookup"><span data-stu-id="65c7e-179">When data is spread across multiple virtual disks (like spanned volumes), a crash-consistent recovery point provides no guarantees for hello correctness of hello data.</span></span> |

## <a name="performance-and-resource-utilization"></a><span data-ttu-id="65c7e-180">Производительность и использование ресурсов</span><span class="sxs-lookup"><span data-stu-id="65c7e-180">Performance and resource utilization</span></span>
<span data-ttu-id="65c7e-181">Как и при локальном резервном копировании, при резервном копировании виртуальных машин в Azure важно учитывать ограничения по производительности и использованию ресурсов.</span><span class="sxs-lookup"><span data-stu-id="65c7e-181">Like backup software that is deployed on-premises, you should plan for capacity and resource utilization needs when backing up VMs in Azure.</span></span> <span data-ttu-id="65c7e-182">Hello [ограничения хранилища Azure](../azure-subscription-service-limits.md#storage-limits) определить влияние toostructure ВМ развертываний tooget максимальную производительность с минимальной toorunning рабочих нагрузок.</span><span class="sxs-lookup"><span data-stu-id="65c7e-182">hello [Azure Storage limits](../azure-subscription-service-limits.md#storage-limits) define how toostructure VM deployments tooget maximum performance with minimum impact toorunning workloads.</span></span>

<span data-ttu-id="65c7e-183">Обратите внимание toohello, который ограничивает следующие хранилища Azure при планировании производительности резервного копирования:</span><span class="sxs-lookup"><span data-stu-id="65c7e-183">Pay attention toohello following Azure Storage limits when planning backup performance:</span></span>

* <span data-ttu-id="65c7e-184">Максимальный объем исходящих данных на учетную запись хранения.</span><span class="sxs-lookup"><span data-stu-id="65c7e-184">Max egress per storage account</span></span>
* <span data-ttu-id="65c7e-185">Общая частота запросов на учетную запись хранения.</span><span class="sxs-lookup"><span data-stu-id="65c7e-185">Total request rate per storage account</span></span>

### <a name="storage-account-limits"></a><span data-ttu-id="65c7e-186">Ограничения учетной записи хранения</span><span class="sxs-lookup"><span data-stu-id="65c7e-186">Storage account limits</span></span>
<span data-ttu-id="65c7e-187">Резервные данные копируются из учетной записи хранилища, добавляет toohello операций ввода вывода в секунду (IOPS) и исходящие данные (или пропускной способности) метрики учетной записи хранения hello.</span><span class="sxs-lookup"><span data-stu-id="65c7e-187">Backup data copied from a storage account, adds toohello input/output operations per second (IOPS) and egress (or throughput) metrics of hello storage account.</span></span> <span data-ttu-id="65c7e-188">AT hello же времени, виртуальные машины также потребляют операций ввода-ВЫВОДА и пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="65c7e-188">At hello same time, virtual machines are also consuming IOPS and throughput.</span></span> <span data-ttu-id="65c7e-189">Цель Hello — tooensure резервного копирования и трафик виртуальной машины не превышает дискового пространства учетной записи.</span><span class="sxs-lookup"><span data-stu-id="65c7e-189">hello goal is tooensure Backup and virtual machine traffic don't exceed your storage account limits.</span></span>

### <a name="number-of-disks"></a><span data-ttu-id="65c7e-190">Количество дисков</span><span class="sxs-lookup"><span data-stu-id="65c7e-190">Number of disks</span></span>
<span data-ttu-id="65c7e-191">процесс резервного копирования Hello предпринимает toocomplete задание резервного копирования как можно быстрее.</span><span class="sxs-lookup"><span data-stu-id="65c7e-191">hello backup process tries toocomplete a backup job as quickly as possible.</span></span> <span data-ttu-id="65c7e-192">Поэтому она потребляет все доступные ресурсы.</span><span class="sxs-lookup"><span data-stu-id="65c7e-192">In doing so, it consumes as many resources as it can.</span></span> <span data-ttu-id="65c7e-193">Тем не менее, все операции ввода-вывода ограничиваются hello *целевая пропускная способность для одного большого двоичного объекта*, который имеет ограничение на 60 МБ в секунду.</span><span class="sxs-lookup"><span data-stu-id="65c7e-193">However, all I/O operations are limited by hello *Target Throughput for Single Blob*, which has a limit of 60 MB per second.</span></span> <span data-ttu-id="65c7e-194">В toomaximize попытки его скорости hello процесс резервного копирования пытается подключиться tooback копии всех дисков виртуальной Машины hello *параллельно*.</span><span class="sxs-lookup"><span data-stu-id="65c7e-194">In an attempt toomaximize its speed, hello backup process tries tooback up each of hello VM's disks *in parallel*.</span></span> <span data-ttu-id="65c7e-195">Если виртуальная машина имеет четыре жестких диска, hello служба пытается tooback все четыре диски в параллельном режиме.</span><span class="sxs-lookup"><span data-stu-id="65c7e-195">If a VM has four disks, hello service attempts tooback up all four disks in parallel.</span></span> <span data-ttu-id="65c7e-196">Hello **номера дисков** создается резервная копия является важным фактором hello в определении трафика резервного копирования учетной записи хранилища.</span><span class="sxs-lookup"><span data-stu-id="65c7e-196">hello **number of disks** being backed up, is hello most important factor in determining storage account backup traffic.</span></span>

### <a name="backup-schedule"></a><span data-ttu-id="65c7e-197">Расписание резервного копирования</span><span class="sxs-lookup"><span data-stu-id="65c7e-197">Backup schedule</span></span>
<span data-ttu-id="65c7e-198">Дополнительный фактор, который влияет на производительность — hello **расписание резервного копирования**.</span><span class="sxs-lookup"><span data-stu-id="65c7e-198">An additional factor that impacts performance is hello **backup schedule**.</span></span> <span data-ttu-id="65c7e-199">При настройке политики hello, чтобы все виртуальные машины резервная копия в hello же время запланировано застряла трафика.</span><span class="sxs-lookup"><span data-stu-id="65c7e-199">If you configure hello policies so all VMs are backed up at hello same time, you have scheduled a traffic jam.</span></span> <span data-ttu-id="65c7e-200">процесс резервного копирования Hello попыток tooback все диски в параллельном режиме.</span><span class="sxs-lookup"><span data-stu-id="65c7e-200">hello backup process attempts tooback up all disks in parallel.</span></span> <span data-ttu-id="65c7e-201">tooreduce hello резервного копирования трафик от учетной записи хранилища, создайте резервную копию разных ВМ в другое время hello, без перекрытия.</span><span class="sxs-lookup"><span data-stu-id="65c7e-201">tooreduce hello backup traffic from a storage account, back up different VMs at different time of hello day, with no overlap.</span></span>

## <a name="capacity-planning"></a><span data-ttu-id="65c7e-202">Планирование загрузки</span><span class="sxs-lookup"><span data-stu-id="65c7e-202">Capacity planning</span></span>
<span data-ttu-id="65c7e-203">Совместное размещение выше факторов hello необходима tooplan hello потребностями в учетной записи хранилища.</span><span class="sxs-lookup"><span data-stu-id="65c7e-203">Putting hello previous factors together, you need tooplan for hello storage account usage needs.</span></span> <span data-ttu-id="65c7e-204">Загрузите hello [электронную таблицу Excel для планирования резервного копирования емкость виртуальной Машины](https://gallery.technet.microsoft.com/Azure-Backup-Storage-a46d7e33) влияние hello toosee диска и параметры расписания резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="65c7e-204">Download hello [VM backup capacity planning Excel spreadsheet](https://gallery.technet.microsoft.com/Azure-Backup-Storage-a46d7e33) toosee hello impact of your disk and backup schedule choices.</span></span>

### <a name="backup-throughput"></a><span data-ttu-id="65c7e-205">Пропускная способность при резервном копировании</span><span class="sxs-lookup"><span data-stu-id="65c7e-205">Backup throughput</span></span>
<span data-ttu-id="65c7e-206">Для каждого диска, резервная копия резервного копирования Azure считывает hello блоков на диске hello и сохраняет только hello измененных данных (добавочное резервное копирование).</span><span class="sxs-lookup"><span data-stu-id="65c7e-206">For each disk being backed up, Azure Backup reads hello blocks on hello disk and stores only hello changed data (incremental backup).</span></span> <span data-ttu-id="65c7e-207">Hello следующей таблице показаны средние значения в пропускной способности резервной копии службы hello.</span><span class="sxs-lookup"><span data-stu-id="65c7e-207">hello following table shows hello average Backup service throughput values.</span></span> <span data-ttu-id="65c7e-208">С помощью hello следующие данные, можно оценить hello количество времени, нужен tooback копии диска заданного размера.</span><span class="sxs-lookup"><span data-stu-id="65c7e-208">Using hello following data, you can estimate hello amount of time needed tooback up a disk of a given size.</span></span>

| <span data-ttu-id="65c7e-209">Операция резервного копирования</span><span class="sxs-lookup"><span data-stu-id="65c7e-209">Backup operation</span></span> | <span data-ttu-id="65c7e-210">Пропускная способность в лучшем случае</span><span class="sxs-lookup"><span data-stu-id="65c7e-210">Best-case throughput</span></span> |
| --- | --- |
| <span data-ttu-id="65c7e-211">Начальное резервное копирование</span><span class="sxs-lookup"><span data-stu-id="65c7e-211">Initial backup</span></span> |<span data-ttu-id="65c7e-212">160 Мбит/с</span><span class="sxs-lookup"><span data-stu-id="65c7e-212">160 Mbps</span></span> |
| <span data-ttu-id="65c7e-213">Добавочное резервное копирование (аварийное восстановление)</span><span class="sxs-lookup"><span data-stu-id="65c7e-213">Incremental backup (DR)</span></span> |<span data-ttu-id="65c7e-214">640 Мбит/с </span><span class="sxs-lookup"><span data-stu-id="65c7e-214">640 Mbps</span></span> <br><br> <span data-ttu-id="65c7e-215">Удаляет пропускной способности значительно изменился hello (который должен toobe резервное копирование) данные распределена по hello диска.</span><span class="sxs-lookup"><span data-stu-id="65c7e-215">Throughput drops significantly if hello changed data (that needs toobe backed up) is dispersed across hello disk.</span></span>|

## <a name="total-vm-backup-time"></a><span data-ttu-id="65c7e-216">Общее время резервного копирования виртуальной машины</span><span class="sxs-lookup"><span data-stu-id="65c7e-216">Total VM backup time</span></span>
<span data-ttu-id="65c7e-217">Хотя большая часть времени создания резервной копии hello затрачивается на чтение и копирование данных, другие операции contribute tooback общее время, необходимое toohello ВМ:</span><span class="sxs-lookup"><span data-stu-id="65c7e-217">While most of hello backup time is spent reading and copying data, other operations contribute toohello total time needed tooback up a VM:</span></span>

* <span data-ttu-id="65c7e-218">Время, необходимое слишком[установить или обновить расширение резервного копирования hello](backup-azure-vms.md).</span><span class="sxs-lookup"><span data-stu-id="65c7e-218">Time needed too[install or update hello backup extension](backup-azure-vms.md).</span></span>
* <span data-ttu-id="65c7e-219">Моментальный снимок время — время, затраченное hello tootrigger моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="65c7e-219">Snapshot time, which is hello time taken tootrigger a snapshot.</span></span> <span data-ttu-id="65c7e-220">Моментальные снимки, инициируемых закрыть toohello запланированное время резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="65c7e-220">Snapshots are triggered close toohello scheduled backup time.</span></span>
* <span data-ttu-id="65c7e-221">Время ожидания в очереди.</span><span class="sxs-lookup"><span data-stu-id="65c7e-221">Queue wait time.</span></span> <span data-ttu-id="65c7e-222">Так как служба резервного копирования hello обрабатывает резервные копии из нескольких клиентов, копирование резервного копирования данных из резервной копии моментального снимка toohello или служб восстановления хранилище может не запускаться немедленно.</span><span class="sxs-lookup"><span data-stu-id="65c7e-222">Since hello Backup service is processing backups from multiple customers, copying backup data from snapshot toohello backup or Recovery Services vault might not start immediately.</span></span> <span data-ttu-id="65c7e-223">В время пиковой нагрузки hello ожидания можно растянуть tooeight часов из-за toohello количество обрабатываемых резервных копий.</span><span class="sxs-lookup"><span data-stu-id="65c7e-223">In times of peak load, hello wait can stretch up tooeight hours due toohello number of backups being processed.</span></span> <span data-ttu-id="65c7e-224">Тем не менее общее время резервного копирования hello ВМ составляет менее 24 часов для ежедневной политики резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="65c7e-224">However, hello total VM backup time is less than 24 hours for daily backup policies.</span></span>
* <span data-ttu-id="65c7e-225">Время передачи данных, время, необходимое для резервного копирования toocompute hello добавочные изменения от предыдущей резервной копии служб и передачи этих изменений toovault хранилища.</span><span class="sxs-lookup"><span data-stu-id="65c7e-225">Data transfer time, time needed for backup service toocompute hello incremental changes from previous backup and transfer those changes toovault storage.</span></span>

### <a name="why-am-i-observing-longer12-hours-backup-time"></a><span data-ttu-id="65c7e-226">Почему архивация выполняется дольше (более 12 ч)?</span><span class="sxs-lookup"><span data-stu-id="65c7e-226">Why am I observing longer(>12 hours) backup time?</span></span>
<span data-ttu-id="65c7e-227">Резервная копия состоит из двух этапов: создание моментальных снимков и передаче hello toohello хранилище моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="65c7e-227">Backup consists of two phases: taking snapshots and transferring hello snapshots toohello vault.</span></span> <span data-ttu-id="65c7e-228">для хранения оптимизирует Hello службы резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="65c7e-228">hello Backup service optimizes for storage.</span></span> <span data-ttu-id="65c7e-229">При передаче данных tooa hello моментального снимка хранилища, служба hello перемещает только добавочные изменения из предыдущего снимка hello.</span><span class="sxs-lookup"><span data-stu-id="65c7e-229">When transferring hello snapshot data tooa vault, hello service only transfers incremental changes from hello previous snapshot.</span></span>  <span data-ttu-id="65c7e-230">toodetermine hello добавочные изменения, службы hello вычисляет контрольную сумму hello hello блоков.</span><span class="sxs-lookup"><span data-stu-id="65c7e-230">toodetermine hello incremental changes, hello service computes hello checksum of hello blocks.</span></span> <span data-ttu-id="65c7e-231">При изменении блок hello блока определяется как блок toobe, отправляемых toohello хранилища.</span><span class="sxs-lookup"><span data-stu-id="65c7e-231">If a block is changed, hello block is identified as a block toobe sent toohello vault.</span></span> <span data-ttu-id="65c7e-232">Затем Детализирует службы hello дальнейшей в каждый hello идентифицировать блоки, поиск tootransfer данных hello toominimize возможности.</span><span class="sxs-lookup"><span data-stu-id="65c7e-232">Then hello service drills further into each of hello identified blocks, looking for opportunities toominimize hello data tootransfer.</span></span> <span data-ttu-id="65c7e-233">После вычисления всех измененных блоков, hello службы объединяет изменения hello и отправляет их toohello хранилища.</span><span class="sxs-lookup"><span data-stu-id="65c7e-233">After evaluating all changed blocks, hello service coalesces hello changes and sends them toohello vault.</span></span> <span data-ttu-id="65c7e-234">В некоторых старых приложениях операции записи не оптимальны с точки зрения хранилища, так как они малого размера и фрагментированы.</span><span class="sxs-lookup"><span data-stu-id="65c7e-234">In some legacy applications, small, fragmented writes are not optimal for storage.</span></span> <span data-ttu-id="65c7e-235">Если моментальный снимок hello содержит большое число операций записи небольших, степень фрагментации, служба hello тратит дополнительное время обработки hello данные, записанные в приложения hello.</span><span class="sxs-lookup"><span data-stu-id="65c7e-235">If hello snapshot contains many small, fragmented writes, hello service spends additional time processing hello data written by hello applications.</span></span> <span data-ttu-id="65c7e-236">Привет, рекомендуется использовать блок приложения для записи из Azure, для приложений, выполняющихся внутри hello виртуальной Машины, является как минимум 8 КБ.</span><span class="sxs-lookup"><span data-stu-id="65c7e-236">hello recommended application write block from Azure, for applications running inside hello VM, is a minimum of 8 KB.</span></span> <span data-ttu-id="65c7e-237">Если приложение использует блок объемом менее 8 КБ, то это негативно влияет на производительность резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="65c7e-237">If your application uses a block of less than 8 KB, backup performance is effected.</span></span> <span data-ttu-id="65c7e-238">Справку по настройке производительность резервного копирования tooimprove приложений см. в разделе [настройки приложений для достижения оптимальной производительности хранилища Azure](../storage/common/storage-premium-storage-performance.md).</span><span class="sxs-lookup"><span data-stu-id="65c7e-238">For help with tuning your application tooimprove backup performance, see [Tuning applications for optimal performance with Azure storage](../storage/common/storage-premium-storage-performance.md).</span></span> <span data-ttu-id="65c7e-239">Хотя hello статьи на производительность резервного копирования используются примеры хранилища Premium, руководство hello применяется для стандартных дисков.</span><span class="sxs-lookup"><span data-stu-id="65c7e-239">Though hello article on backup performance uses Premium storage examples, hello guidance is applicable for Standard storage disks.</span></span>

## <a name="total-restore-time"></a><span data-ttu-id="65c7e-240">Общее время восстановления</span><span class="sxs-lookup"><span data-stu-id="65c7e-240">Total restore time</span></span>
<span data-ttu-id="65c7e-241">Операция восстановления состоит из двух основных sub задач: копирование данных из hello хранилище toohello выбранной пользовательской учетной записи хранения и создание виртуальной машины hello.</span><span class="sxs-lookup"><span data-stu-id="65c7e-241">A restore operation consists of two main sub tasks: Copying data back from hello vault toohello chosen customer storage account, and creating hello virtual machine.</span></span> <span data-ttu-id="65c7e-242">Копирование данных из хранилища hello зависит от где hello резервные копии предназначены для внутреннего хранения в Azure, и место хранения hello пользовательской учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="65c7e-242">Copying data back from hello vault depends on where hello backups are stored internally in Azure, and where hello customer storage account is stored.</span></span> <span data-ttu-id="65c7e-243">Время, затраченное toocopy данных зависит от условий:</span><span class="sxs-lookup"><span data-stu-id="65c7e-243">Time taken toocopy data depends upon:</span></span>
* <span data-ttu-id="65c7e-244">Ожидания в очереди, время - с момента обработки службой hello задания восстановления от нескольких клиентов в hello одновременно, запросов на восстановление, помещена в очередь.</span><span class="sxs-lookup"><span data-stu-id="65c7e-244">Queue wait time - Since hello service processes restore jobs from multiple customers at hello same time, restore requests are put in a queue.</span></span>
* <span data-ttu-id="65c7e-245">Время - копирования данных данные копируются из hello хранилище toohello пользовательской учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="65c7e-245">Data copy time - Data is copied from hello vault toohello customer storage account.</span></span> <span data-ttu-id="65c7e-246">Восстановление время зависит от операций ввода-ВЫВОДА и пропускную способность службы архивации Azure возвращает hello выбранной пользовательской учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="65c7e-246">Restore time depends on IOPS and throughput Azure Backup service gets on hello selected customer storage account.</span></span> <span data-ttu-id="65c7e-247">tooreduce hello копирование времени в процессе восстановления hello, выберите учетную запись хранения не загружен с других приложений записи и чтения.</span><span class="sxs-lookup"><span data-stu-id="65c7e-247">tooreduce hello copying time during hello restore process, select a storage account not loaded with other application writes and reads.</span></span>

## <a name="best-practices"></a><span data-ttu-id="65c7e-248">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="65c7e-248">Best practices</span></span>
<span data-ttu-id="65c7e-249">Ниже приведены рекомендации, которые следует учитывать при настройке резервного копирования виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="65c7e-249">We suggest following these practices while configuring backups for virtual machines:</span></span>

* <span data-ttu-id="65c7e-250">Не планировать более 10 классических виртуальных машин из hello же облако службы tooback в hello то же время.</span><span class="sxs-lookup"><span data-stu-id="65c7e-250">Don't schedule more than 10 classic VMs from hello same cloud service tooback up at hello same time.</span></span> <span data-ttu-id="65c7e-251">Если вы хотите tooback нескольких виртуальных машин из одной облачной службе, управлять временем hello начала резервного копирования на час.</span><span class="sxs-lookup"><span data-stu-id="65c7e-251">If you want tooback up multiple VMs from same cloud service, stagger hello backup start times by an hour.</span></span>
* <span data-ttu-id="65c7e-252">Не назначайте более 40 tooback ВМ вверх в hello то же время.</span><span class="sxs-lookup"><span data-stu-id="65c7e-252">Do not schedule more than 40 VMs tooback up at hello same time.</span></span>
* <span data-ttu-id="65c7e-253">Планируйте резервное копирование виртуальных машин на периоды низкой нагрузки.</span><span class="sxs-lookup"><span data-stu-id="65c7e-253">Schedule VM backups during non-peak hours.</span></span> <span data-ttu-id="65c7e-254">Этот способ hello службы резервного копирования операций ввода-ВЫВОДА использует для передачи данных из hello клиента учетной записи toohello хранилища.</span><span class="sxs-lookup"><span data-stu-id="65c7e-254">This way hello Backup service uses IOPS for transferring data from hello customer storage account toohello vault.</span></span>
* <span data-ttu-id="65c7e-255">Убедитесь, что политика применяется к виртуальным машинам, распределенным по нескольким учетным записям хранения.</span><span class="sxs-lookup"><span data-stu-id="65c7e-255">Make sure that a policy is applied on VMs spread across different storage accounts.</span></span> <span data-ttu-id="65c7e-256">Мы советуем использовать не более 20 общее дисков из одной учетной записи хранения защищена с помощью hello же расписание резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="65c7e-256">We suggest no more than 20 total disks from a single storage account be protected by hello same backup schedule.</span></span> <span data-ttu-id="65c7e-257">При наличии более 20 дисков в учетной записи хранения распространения этих виртуальных машин между несколькими политиками tooget hello необходимое значение IOPS во время фазы передачи hello hello процесс резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="65c7e-257">If you have greater than 20 disks in a storage account, spread those VMs across multiple policies tooget hello required IOPS during hello transfer phase of hello backup process.</span></span>
* <span data-ttu-id="65c7e-258">Не восстанавливайте виртуальная машина, работающая в учетной записи хранилища toosame хранения Premium.</span><span class="sxs-lookup"><span data-stu-id="65c7e-258">Do not restore a VM running on Premium storage toosame storage account.</span></span> <span data-ttu-id="65c7e-259">Если процесс восстановления hello совпадает с hello операции резервного копирования, он уменьшает hello операций ввода-ВЫВОДА, доступные для резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="65c7e-259">If hello restore operation process coincides with hello backup operation, it reduces hello available IOPS for backup.</span></span>
* <span data-ttu-id="65c7e-260">Для успешной архивации виртуальных машин уровня "Премиум" убедитесь, что в учетной записи хранения, в которой размещены диски уровня "Премиум", свободно как минимум 50 % места для промежуточного хранения моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="65c7e-260">For Premium VM backup, ensure that storage account that hosts premium disks has atleast 50% free space for staging snapshot for a successful backup.</span></span> 
* <span data-ttu-id="65c7e-261">Убедитесь, что на виртуальных машинах Linux с поддержкой архивации используется Python 2.7</span><span class="sxs-lookup"><span data-stu-id="65c7e-261">Make sure that python version on Linux VMs enabled for backup is 2.7</span></span>

## <a name="data-encryption"></a><span data-ttu-id="65c7e-262">Шифрование данных</span><span class="sxs-lookup"><span data-stu-id="65c7e-262">Data encryption</span></span>
<span data-ttu-id="65c7e-263">Служба архивации Azure не производит шифрование данных как часть процесса резервного копирования hello.</span><span class="sxs-lookup"><span data-stu-id="65c7e-263">Azure Backup does not encrypt data as a part of hello backup process.</span></span> <span data-ttu-id="65c7e-264">Тем не менее, можно шифровать данные в пределах hello виртуальной Машины и создайте резервную копию hello защищенных данных легко (Дополнительные сведения о [резервного копирования зашифрованных данных](backup-azure-vms-encryption.md)).</span><span class="sxs-lookup"><span data-stu-id="65c7e-264">However, you can encrypt data within hello VM and back up hello protected data seamlessly (read more about [backup of encrypted data](backup-azure-vms-encryption.md)).</span></span>

## <a name="calculating-hello-cost-of-protected-instances"></a><span data-ttu-id="65c7e-265">Расчет себестоимости hello защищенные экземпляры</span><span class="sxs-lookup"><span data-stu-id="65c7e-265">Calculating hello cost of protected instances</span></span>
<span data-ttu-id="65c7e-266">Azure виртуальные машины, резервное копирование копии Azure с помощью подчиняются слишком[цены на Azure Backup](https://azure.microsoft.com/pricing/details/backup/).</span><span class="sxs-lookup"><span data-stu-id="65c7e-266">Azure virtual machines that are backed up through Azure Backup are subject too[Azure Backup pricing](https://azure.microsoft.com/pricing/details/backup/).</span></span> <span data-ttu-id="65c7e-267">Hello защищенных экземпляров вычислений основана на hello *фактическое* размер hello виртуальной машины — hello сумма всех данных hello в hello виртуальной машины — за исключением hello «disk ресурсов».</span><span class="sxs-lookup"><span data-stu-id="65c7e-267">hello Protected Instances calculation is based on hello *actual* size of hello virtual machine, which is hello sum of all hello data in hello virtual machine--excluding hello “resource disk.”</span></span>

<span data-ttu-id="65c7e-268">Цены для резервного копирования виртуальных машин — *не* на основе размера максимальное hello поддерживается для каждого диска данных вложенного toohello виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="65c7e-268">Pricing for backing up VMs is *not* based on hello maximum supported size for each data disk attached toohello virtual machine.</span></span> <span data-ttu-id="65c7e-269">Цены основан на hello фактические данные хранятся на диске данных hello.</span><span class="sxs-lookup"><span data-stu-id="65c7e-269">Pricing is based on hello actual data stored in hello data disk.</span></span> <span data-ttu-id="65c7e-270">Аналогичным образом счета hello хранения резервных копий зависит от hello объем данных, хранящихся в службе архивации Azure, которая представляет сумму hello hello фактических данных в каждой точке восстановления.</span><span class="sxs-lookup"><span data-stu-id="65c7e-270">Similarly, hello backup storage bill is based on hello amount of data that is stored in Azure Backup, which is hello sum of hello actual data in each recovery point.</span></span>

<span data-ttu-id="65c7e-271">Например, возьмем виртуальную машину стандартного размера A2 с двумя дополнительными дисками максимальным объемом 1 ТБ каждый.</span><span class="sxs-lookup"><span data-stu-id="65c7e-271">For example, take an A2 Standard-sized virtual machine that has two additional data disks with a maximum size of 1 TB each.</span></span> <span data-ttu-id="65c7e-272">Hello следующей таблице приведены hello фактические данные хранятся на каждом из этих дисков:</span><span class="sxs-lookup"><span data-stu-id="65c7e-272">hello following table gives hello actual data stored on each of these disks:</span></span>

| <span data-ttu-id="65c7e-273">Тип диска</span><span class="sxs-lookup"><span data-stu-id="65c7e-273">Disk type</span></span> | <span data-ttu-id="65c7e-274">Максимальный размер</span><span class="sxs-lookup"><span data-stu-id="65c7e-274">Max size</span></span> | <span data-ttu-id="65c7e-275">Фактические данные</span><span class="sxs-lookup"><span data-stu-id="65c7e-275">Actual data present</span></span> |
| --- | --- | --- |
| <span data-ttu-id="65c7e-276">Диск операционной системы</span><span class="sxs-lookup"><span data-stu-id="65c7e-276">Operating system disk</span></span> |<span data-ttu-id="65c7e-277">1023 ГБ</span><span class="sxs-lookup"><span data-stu-id="65c7e-277">1023 GB</span></span> |<span data-ttu-id="65c7e-278">17 ГБ</span><span class="sxs-lookup"><span data-stu-id="65c7e-278">17 GB</span></span> |
| <span data-ttu-id="65c7e-279">Локальный диск или диск ресурсов</span><span class="sxs-lookup"><span data-stu-id="65c7e-279">Local disk / Resource disk</span></span> |<span data-ttu-id="65c7e-280">135 ГБ</span><span class="sxs-lookup"><span data-stu-id="65c7e-280">135 GB</span></span> |<span data-ttu-id="65c7e-281">5 ГБ (не учитывается для архивации)</span><span class="sxs-lookup"><span data-stu-id="65c7e-281">5 GB (not included for backup)</span></span> |
| <span data-ttu-id="65c7e-282">Диск данных 1</span><span class="sxs-lookup"><span data-stu-id="65c7e-282">Data disk 1</span></span> |<span data-ttu-id="65c7e-283">1023 ГБ</span><span class="sxs-lookup"><span data-stu-id="65c7e-283">1023 GB</span></span> |<span data-ttu-id="65c7e-284">30 ГБ</span><span class="sxs-lookup"><span data-stu-id="65c7e-284">30 GB</span></span> |
| <span data-ttu-id="65c7e-285">Диск данных 2</span><span class="sxs-lookup"><span data-stu-id="65c7e-285">Data disk 2</span></span> |<span data-ttu-id="65c7e-286">1023 ГБ</span><span class="sxs-lookup"><span data-stu-id="65c7e-286">1023 GB</span></span> |<span data-ttu-id="65c7e-287">0 ГБ</span><span class="sxs-lookup"><span data-stu-id="65c7e-287">0 GB</span></span> |

<span data-ttu-id="65c7e-288">Hello *фактическое* размера hello виртуальной машины в данном случае является 17 ГБ + 30 ГБ + 0 = 47 ГБ.</span><span class="sxs-lookup"><span data-stu-id="65c7e-288">hello *actual* size of hello virtual machine in this case is 17 GB + 30 GB + 0 GB = 47 GB.</span></span> <span data-ttu-id="65c7e-289">Этот размер защищенного экземпляра (47 ГБ) становится основой hello hello ежемесячный счет.</span><span class="sxs-lookup"><span data-stu-id="65c7e-289">This Protected Instance size (47 GB) becomes hello basis for hello monthly bill.</span></span> <span data-ttu-id="65c7e-290">Как hello увеличения объема данных на виртуальной машине hello, размер защищенного экземпляра hello, используемый для изменения в выставление счетов, соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="65c7e-290">As hello amount of data in hello virtual machine grows, hello Protected Instance size used for billing changes accordingly.</span></span>

<span data-ttu-id="65c7e-291">Выставление счетов не запускается до завершения первой успешной архивации hello.</span><span class="sxs-lookup"><span data-stu-id="65c7e-291">Billing does not start until hello first successful backup completes.</span></span> <span data-ttu-id="65c7e-292">На этом этапе начинает hello выставления счетов для хранилища и защищенных экземпляров.</span><span class="sxs-lookup"><span data-stu-id="65c7e-292">At this point, hello billing for both Storage and Protected Instances begins.</span></span> <span data-ttu-id="65c7e-293">Выставление счетов продолжается до тех пор, пока существует *любой резервной копии данных, хранящихся в хранилище* для hello виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="65c7e-293">Billing continues as long as there is *any backup data stored in a vault* for hello virtual machine.</span></span> <span data-ttu-id="65c7e-294">Если остановить защиту на виртуальной машине hello, но данные резервного копирования виртуальных машин в хранилище, выставление счетов продолжается.</span><span class="sxs-lookup"><span data-stu-id="65c7e-294">If you stop protection on hello virtual machine, but virtual machine backup data exists in a vault, billing continues.</span></span>

<span data-ttu-id="65c7e-295">Выставление счетов для указанной виртуальной машины останавливает только в том случае, если остановить защиту hello *и* удалены все данные резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="65c7e-295">Billing for a specified virtual machine stops only if hello protection is stopped *and* all backup data is deleted.</span></span> <span data-ttu-id="65c7e-296">При остановке защиты и нет активных заданий резервного копирования, размер hello hello последней успешной архивации виртуальных Машин становится размер защищенного экземпляра hello, используемый для hello ежемесячный счет.</span><span class="sxs-lookup"><span data-stu-id="65c7e-296">When protection stops and there are no active backup jobs, hello size of hello last successful VM backup becomes hello Protected Instance size used for hello monthly bill.</span></span>

## <a name="questions"></a><span data-ttu-id="65c7e-297">Вопросы?</span><span class="sxs-lookup"><span data-stu-id="65c7e-297">Questions?</span></span>
<span data-ttu-id="65c7e-298">Если у вас есть вопросы или при наличии любой возможности, хотелось бы включены, toosee [отправить отзыв](http://aka.ms/azurebackup_feedback).</span><span class="sxs-lookup"><span data-stu-id="65c7e-298">If you have questions, or if there is any feature that you would like toosee included, [send us feedback](http://aka.ms/azurebackup_feedback).</span></span>

## <a name="next-steps"></a><span data-ttu-id="65c7e-299">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="65c7e-299">Next steps</span></span>
* [<span data-ttu-id="65c7e-300">Настройка виртуальных машин</span><span class="sxs-lookup"><span data-stu-id="65c7e-300">Back up virtual machines</span></span>](backup-azure-vms.md)
* [<span data-ttu-id="65c7e-301">Управление резервными копиями виртуальной машины</span><span class="sxs-lookup"><span data-stu-id="65c7e-301">Manage virtual machine backup</span></span>](backup-azure-manage-vms.md)
* [<span data-ttu-id="65c7e-302">Восстановление виртуальных машин</span><span class="sxs-lookup"><span data-stu-id="65c7e-302">Restore virtual machines</span></span>](backup-azure-restore-vms.md)
* [<span data-ttu-id="65c7e-303">Устранение проблем с резервным копированием виртуальных машин</span><span class="sxs-lookup"><span data-stu-id="65c7e-303">Troubleshoot VM backup issues</span></span>](backup-azure-vms-troubleshoot.md)
