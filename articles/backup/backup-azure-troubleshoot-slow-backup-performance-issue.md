---
title: "aaaTroubleshoot медленно резервного копирования файлов и папок в службе архивации Azure | Документы Microsoft"
description: "Предоставляет разрешение toohelp руководство диагностики hello причиной проблем с производительностью резервного копирования Azure"
services: backup
documentationcenter: 
author: genlin
manager: cshepard
editor: 
ms.assetid: e379180a-db13-4e0c-90e4-28e5dd6f5b14
ms.service: backup
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/13/2017
ms.author: genli
ms.openlocfilehash: 21d79bbd03c2706bc43fcc7c14020cffd6b919c7
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="troubleshoot-slow-backup-of-files-and-folders-in-azure-backup"></a><span data-ttu-id="72fb1-103">Устранение неполадок, связанных с низкой производительностью архивации файлов и папок в службе архивации Azure</span><span class="sxs-lookup"><span data-stu-id="72fb1-103">Troubleshoot slow backup of files and folders in Azure Backup</span></span>
<span data-ttu-id="72fb1-104">Эта статья содержит рекомендации по устранению неполадок toohelp диагностике hello причиной низкой производительностью резервного копирования для файлов и папок при использовании резервного копирования Azure.</span><span class="sxs-lookup"><span data-stu-id="72fb1-104">This article provides troubleshooting guidance toohelp you diagnose hello cause of slow backup performance for files and folders when you're using Azure Backup.</span></span> <span data-ttu-id="72fb1-105">При копировании файлов Azure Backup agent tooback hello, hello процесс резервного копирования может занять больше времени, чем ожидалось.</span><span class="sxs-lookup"><span data-stu-id="72fb1-105">When you use hello Azure Backup agent tooback up files, hello backup process might take longer than expected.</span></span> <span data-ttu-id="72fb1-106">Эта задержка может быть вызвано один или несколько из следующих hello:</span><span class="sxs-lookup"><span data-stu-id="72fb1-106">This delay might be caused by one or more of hello following:</span></span>

* [<span data-ttu-id="72fb1-107">Узких мест производительности на компьютере hello, который выполняется резервное копирование.</span><span class="sxs-lookup"><span data-stu-id="72fb1-107">There are performance bottlenecks on hello computer that’s being backed up.</span></span>](#cause1)
* [<span data-ttu-id="72fb1-108">Другой процесс или антивирусная программа мешает hello процесс резервного копирования Azure.</span><span class="sxs-lookup"><span data-stu-id="72fb1-108">Another process or antivirus software is interfering with hello Azure Backup process.</span></span>](#cause2)
* [<span data-ttu-id="72fb1-109">Hello резервного копирования агент работает на виртуальной машине Azure (ВМ).</span><span class="sxs-lookup"><span data-stu-id="72fb1-109">hello Backup agent is running on an Azure virtual machine (VM).</span></span>](#cause3)  
* [<span data-ttu-id="72fb1-110">Архивация большого количества файлов (нескольких миллионов)</span><span class="sxs-lookup"><span data-stu-id="72fb1-110">You're backing up a large number (millions) of files.</span></span>](#cause4)

<span data-ttu-id="72fb1-111">Прежде чем начать, устранение неполадок, рекомендуется загрузить и установить hello [последнюю версию агента резервного копирования Azure](http://aka.ms/azurebackup_agent).</span><span class="sxs-lookup"><span data-stu-id="72fb1-111">Before you start troubleshooting issues, we recommend that you download and install hello [latest Azure Backup agent](http://aka.ms/azurebackup_agent).</span></span> <span data-ttu-id="72fb1-112">Мы произвести toofix агента резервного копирования toohello частыми обновлениями различные проблемы, добавьте компоненты и повысить производительность.</span><span class="sxs-lookup"><span data-stu-id="72fb1-112">We make frequent updates toohello Backup agent toofix various issues, add features, and improve performance.</span></span>

<span data-ttu-id="72fb1-113">Также настоятельно рекомендуется изучить hello [службы архивации Azure часто задаваемые вопросы о](backup-azure-backup-faq.md) toomake убедиться, что не возникли hello распространенные проблемы конфигурации.</span><span class="sxs-lookup"><span data-stu-id="72fb1-113">We also strongly recommend that you review hello [Azure Backup service FAQ](backup-azure-backup-faq.md) toomake sure you're not experiencing any of hello common configuration issues.</span></span>

[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

<a id="cause1"></a>

## <a name="cause-performance-bottlenecks-on-hello-computer"></a><span data-ttu-id="72fb1-114">Причина: Узкие места производительности на компьютере hello</span><span class="sxs-lookup"><span data-stu-id="72fb1-114">Cause: Performance bottlenecks on hello computer</span></span>
<span data-ttu-id="72fb1-115">Узкие места на компьютере hello, который выполняется резервное копирование может привести к задержкам.</span><span class="sxs-lookup"><span data-stu-id="72fb1-115">Bottlenecks on hello computer that's being backed up can cause delays.</span></span> <span data-ttu-id="72fb1-116">Данные toosend доступную пропускную способность сети hello, могут возникать узкие места или Здравствуйте, например, toodisk tooread или записи возможности компьютера.</span><span class="sxs-lookup"><span data-stu-id="72fb1-116">For example, hello computer's ability tooread or write toodisk, or available bandwidth toosend data over hello network, can cause bottlenecks.</span></span>

<span data-ttu-id="72fb1-117">Windows предоставляет встроенное средство, которое называется [монитора производительности](https://technet.microsoft.com/magazine/2008.08.pulse.aspx) toodetect (Perfmon) эти узкие места.</span><span class="sxs-lookup"><span data-stu-id="72fb1-117">Windows provides a built-in tool that's called [Performance Monitor](https://technet.microsoft.com/magazine/2008.08.pulse.aspx) (Perfmon) toodetect these bottlenecks.</span></span>

<span data-ttu-id="72fb1-118">Ниже приведены некоторые счетчики производительности и диапазоны, которые могут оказаться полезными при обнаружении узких мест производительности для оптимизации архивации.</span><span class="sxs-lookup"><span data-stu-id="72fb1-118">Here are some performance counters and ranges that can be helpful in diagnosing bottlenecks for optimal backups.</span></span>

| <span data-ttu-id="72fb1-119">Счетчик</span><span class="sxs-lookup"><span data-stu-id="72fb1-119">Counter</span></span> | <span data-ttu-id="72fb1-120">Состояние</span><span class="sxs-lookup"><span data-stu-id="72fb1-120">Status</span></span> |
| --- | --- |
| <span data-ttu-id="72fb1-121">Логический диск (физический диск) — % времени простоя</span><span class="sxs-lookup"><span data-stu-id="72fb1-121">Logical Disk(Physical Disk)--%idle</span></span> |<span data-ttu-id="72fb1-122">• 100% простоя too50% простоя = Исправен</span><span class="sxs-lookup"><span data-stu-id="72fb1-122">• 100% idle too50% idle = Healthy</span></span></br><span data-ttu-id="72fb1-123">• 49% простоя too20% простоя = предупреждения или монитора</span><span class="sxs-lookup"><span data-stu-id="72fb1-123">• 49% idle too20% idle = Warning or Monitor</span></span></br><span data-ttu-id="72fb1-124">• простоя too0 19% % простоя = критическое состояние или из спецификации</span><span class="sxs-lookup"><span data-stu-id="72fb1-124">• 19% idle too0% idle = Critical or Out of Spec</span></span> |
| <span data-ttu-id="72fb1-125">Логический диск (физический диск) — среднее время выполнения операции чтения или записи на диске</span><span class="sxs-lookup"><span data-stu-id="72fb1-125">Logical Disk(Physical Disk)--%Avg. Disk Sec Read or Write</span></span> |<span data-ttu-id="72fb1-126">• 0,001 ms too0.015 ms = Исправен</span><span class="sxs-lookup"><span data-stu-id="72fb1-126">• 0.001 ms too0.015 ms  = Healthy</span></span></br><span data-ttu-id="72fb1-127">• 0.015 ms too0.025 ms = предупреждения или монитора</span><span class="sxs-lookup"><span data-stu-id="72fb1-127">• 0.015 ms too0.025 ms = Warning or Monitor</span></span></br><span data-ttu-id="72fb1-128">• 0,026 мс или больше — критическое или недопустимое состояние.</span><span class="sxs-lookup"><span data-stu-id="72fb1-128">• 0.026 ms or longer = Critical or Out of Spec</span></span> |
| <span data-ttu-id="72fb1-129">Логический диск (физический диск) — текущая длина очереди диска (для всех экземпляров)</span><span class="sxs-lookup"><span data-stu-id="72fb1-129">Logical Disk(Physical Disk)--Current Disk Queue Length (for all instances)</span></span> |<span data-ttu-id="72fb1-130">80 запросов в течение более 6 минут</span><span class="sxs-lookup"><span data-stu-id="72fb1-130">80 requests for more than 6 minutes</span></span> |
| <span data-ttu-id="72fb1-131">Память — байт в невыгружаемом пуле</span><span class="sxs-lookup"><span data-stu-id="72fb1-131">Memory--Pool Non Paged Bytes</span></span> |<span data-ttu-id="72fb1-132">• Потребление менее 60 % ресурсов пула — работоспособное состояние.</span><span class="sxs-lookup"><span data-stu-id="72fb1-132">• Less than 60% of pool consumed = Healthy</span></span><br><span data-ttu-id="72fb1-133">• 61% too80% пула потребляет = предупреждения или монитора</span><span class="sxs-lookup"><span data-stu-id="72fb1-133">• 61% too80% of pool consumed = Warning or Monitor</span></span></br><span data-ttu-id="72fb1-134">• Более 80 % — критическое или недопустимое состояние.</span><span class="sxs-lookup"><span data-stu-id="72fb1-134">• Greater than 80% pool consumed = Critical or Out of Spec</span></span> |
| <span data-ttu-id="72fb1-135">Память — байт в выгружаемом пуле</span><span class="sxs-lookup"><span data-stu-id="72fb1-135">Memory--Pool Paged Bytes</span></span> |<span data-ttu-id="72fb1-136">• Потребление менее 60 % ресурсов пула — работоспособное состояние.</span><span class="sxs-lookup"><span data-stu-id="72fb1-136">• Less than 60% of pool consumed = Healthy</span></span></br><span data-ttu-id="72fb1-137">• 61% too80% пула потребляет = предупреждения или монитора</span><span class="sxs-lookup"><span data-stu-id="72fb1-137">• 61% too80% of pool consumed = Warning or Monitor</span></span></br><span data-ttu-id="72fb1-138">• Более 80 % — критическое или недопустимое состояние.</span><span class="sxs-lookup"><span data-stu-id="72fb1-138">• Greater than 80% pool consumed = Critical or Out of Spec</span></span> |
| <span data-ttu-id="72fb1-139">Доступная память (МБ)</span><span class="sxs-lookup"><span data-stu-id="72fb1-139">Memory--Available Megabytes</span></span> |<span data-ttu-id="72fb1-140">• 50 % свободной памяти или больше — работоспособное состояние.</span><span class="sxs-lookup"><span data-stu-id="72fb1-140">• 50% of free memory available or more = Healthy</span></span></br><span data-ttu-id="72fb1-141">• 25 % свободной памяти — состояние отслеживания.</span><span class="sxs-lookup"><span data-stu-id="72fb1-141">• 25% of free memory available = Monitor</span></span></br><span data-ttu-id="72fb1-142">• 10 % свободной памяти — состояние предупреждения.</span><span class="sxs-lookup"><span data-stu-id="72fb1-142">• 10% of free memory available = Warning</span></span></br><span data-ttu-id="72fb1-143">• Менее 100 МБ или 5 % свободной памяти — критическое или недопустимое состояние.</span><span class="sxs-lookup"><span data-stu-id="72fb1-143">• Less than 100 MB or 5% of free memory available = Critical or Out of Spec</span></span> |
| <span data-ttu-id="72fb1-144">Процессор — \% загруженности процессора (все экземпляры)</span><span class="sxs-lookup"><span data-stu-id="72fb1-144">Processor--\%Processor Time (all instances)</span></span> |<span data-ttu-id="72fb1-145">• Менее 60 % — работоспособное состояние.</span><span class="sxs-lookup"><span data-stu-id="72fb1-145">• Less than 60% consumed = Healthy</span></span></br><span data-ttu-id="72fb1-146">• 61% too90% потребляет = монитор или предупреждение</span><span class="sxs-lookup"><span data-stu-id="72fb1-146">• 61% too90% consumed = Monitor or Caution</span></span></br><span data-ttu-id="72fb1-147">• 91% too100% потребляет = критическое</span><span class="sxs-lookup"><span data-stu-id="72fb1-147">• 91% too100% consumed = Critical</span></span> |

> [!NOTE]
> <span data-ttu-id="72fb1-148">Если выяснится, что инфраструктура hello причиной hello, рекомендуется выполнить дефрагментацию дисков hello регулярно для повышения производительности.</span><span class="sxs-lookup"><span data-stu-id="72fb1-148">If you determine that hello infrastructure is hello culprit, we recommend that you defragment hello disks regularly for better performance.</span></span>
>
>

<a id="cause2"></a>

## <a name="cause-another-process-or-antivirus-software-interfering-with-azure-backup"></a><span data-ttu-id="72fb1-149">Причина: на работу службы архивации Azure влияет другой процесс или антивирусная программа</span><span class="sxs-lookup"><span data-stu-id="72fb1-149">Cause: Another process or antivirus software interfering with Azure Backup</span></span>
<span data-ttu-id="72fb1-150">Мы видели несколько экземпляров, где другие процессы в системе Windows hello снизиться производительность hello процесс агента Azure Backup.</span><span class="sxs-lookup"><span data-stu-id="72fb1-150">We've seen several instances where other processes in hello Windows system have negatively affected performance of hello Azure Backup agent process.</span></span> <span data-ttu-id="72fb1-151">Например использовать агент Azure Backup hello и другой программы tooback копии данных, или если антивирусная программа и блокировка файлов toobe которого резервного копирования, hello несколько блокировок файлов может привести к конкуренции.</span><span class="sxs-lookup"><span data-stu-id="72fb1-151">For example, if you use both hello Azure Backup agent and another program tooback up data, or if antivirus software is running and has a lock on files toobe backed up, hello multiple locks on files might cause contention.</span></span> <span data-ttu-id="72fb1-152">В этом случае hello резервного копирования может завершиться ошибкой или hello задания может занять больше времени, чем ожидалось.</span><span class="sxs-lookup"><span data-stu-id="72fb1-152">In this situation, hello backup might fail, or hello job might take longer than expected.</span></span>

<span data-ttu-id="72fb1-153">Здравствуйте, лучшие рекомендации в этом случае является tooturn off hello ли hello время резервного копирования для hello Azure Backup agent изменяет toosee другие программы резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="72fb1-153">hello best recommendation in this scenario is tooturn off hello other backup program toosee whether hello backup time for hello Azure Backup agent changes.</span></span> <span data-ttu-id="72fb1-154">Как правило, убедившись, что нескольких заданий резервного копирования не выполняется то же время является достаточно tooprevent hello их влияния на друг с другом.</span><span class="sxs-lookup"><span data-stu-id="72fb1-154">Usually, making sure that multiple backup jobs are not running at hello same time is sufficient tooprevent them from affecting each other.</span></span>

<span data-ttu-id="72fb1-155">Антивирусные программы, рекомендуется исключить следующие hello файлов и расположений:</span><span class="sxs-lookup"><span data-stu-id="72fb1-155">For antivirus programs, we recommend that you exclude hello following files and locations:</span></span>

* <span data-ttu-id="72fb1-156">процесс C:\Program Files\Microsoft Azure Recovery Services Agent\bin\cbengine.exe;</span><span class="sxs-lookup"><span data-stu-id="72fb1-156">C:\Program Files\Microsoft Azure Recovery Services Agent\bin\cbengine.exe as a process</span></span>
* <span data-ttu-id="72fb1-157">папки C:\Program Files\Microsoft Azure Recovery Services Agent\;</span><span class="sxs-lookup"><span data-stu-id="72fb1-157">C:\Program Files\Microsoft Azure Recovery Services Agent\ folders</span></span>
* <span data-ttu-id="72fb1-158">Область временных файлов расположение (Если вы не используете hello стандартное расположение)</span><span class="sxs-lookup"><span data-stu-id="72fb1-158">Scratch location (if you're not using hello standard location)</span></span>

<a id="cause3"></a>

## <a name="cause-backup-agent-running-on-an-azure-virtual-machine"></a><span data-ttu-id="72fb1-159">Причина: агент службы архивации запущен на виртуальной машине Azure</span><span class="sxs-lookup"><span data-stu-id="72fb1-159">Cause: Backup agent running on an Azure virtual machine</span></span>
<span data-ttu-id="72fb1-160">Если вы используете hello агента резервного копирования на виртуальной Машине, будет работать медленнее, чем при запуске на физическом компьютере.</span><span class="sxs-lookup"><span data-stu-id="72fb1-160">If you're running hello Backup agent on a VM, performance will be slower than when you run it on a physical machine.</span></span> <span data-ttu-id="72fb1-161">Это происходит из-за ограничения tooIOPS.</span><span class="sxs-lookup"><span data-stu-id="72fb1-161">This is expected due tooIOPS limitations.</span></span>  <span data-ttu-id="72fb1-162">Тем не менее производительность hello можно оптимизировать с помощью переключения hello дисков с данными, архивируемых tooAzure хранилище Premium.</span><span class="sxs-lookup"><span data-stu-id="72fb1-162">However, you can optimize hello performance by switching hello data drives that are being backed up tooAzure Premium Storage.</span></span> <span data-ttu-id="72fb1-163">Мы работаем над исправления этой проблемы и исправление hello будут доступны в будущих выпусках.</span><span class="sxs-lookup"><span data-stu-id="72fb1-163">We're working on fixing this issue, and hello fix will be available in a future release.</span></span>

<a id="cause4"></a>

## <a name="cause-backing-up-a-large-number-millions-of-files"></a><span data-ttu-id="72fb1-164">Причина: архивация большого количества файлов (нескольких миллионов)</span><span class="sxs-lookup"><span data-stu-id="72fb1-164">Cause: Backing up a large number (millions) of files</span></span>
<span data-ttu-id="72fb1-165">Перемещение большого объема данных занимает больше времени, чем перемещение меньшего объема данных.</span><span class="sxs-lookup"><span data-stu-id="72fb1-165">Moving a large volume of data will take longer than moving a smaller volume of data.</span></span> <span data-ttu-id="72fb1-166">В некоторых случаях связана время резервного копирования toonot только hello размер данных hello, но hello количество файлов или папок.</span><span class="sxs-lookup"><span data-stu-id="72fb1-166">In some cases, backup time is related toonot only hello size of hello data, but also hello number of files or folders.</span></span> <span data-ttu-id="72fb1-167">Это особенно важно при миллионы небольших файлов (несколько байт tooa несколько килобайт) были созданы резервные копии.</span><span class="sxs-lookup"><span data-stu-id="72fb1-167">This is especially true when millions of small files (a few bytes tooa few kilobytes) are being backed up.</span></span>

<span data-ttu-id="72fb1-168">Это происходит потому, что во время резервного копирования данных hello и переносит его tooAzure, Azure одновременно создания каталога файлов.</span><span class="sxs-lookup"><span data-stu-id="72fb1-168">This behavior occurs because while you're backing up hello data and moving it tooAzure, Azure is simultaneously cataloging your files.</span></span> <span data-ttu-id="72fb1-169">В некоторых редких случаях операция с каталогом hello может занять больше времени, чем ожидалось.</span><span class="sxs-lookup"><span data-stu-id="72fb1-169">In some rare scenarios, hello catalog operation might take longer than expected.</span></span>

<span data-ttu-id="72fb1-170">следующие индикаторы Hello может помочь понять hello узким местом и соответствующим образом работать с hello дальнейшие действия:</span><span class="sxs-lookup"><span data-stu-id="72fb1-170">hello following indicators can help you understand hello bottleneck and accordingly work on hello next steps:</span></span>

* <span data-ttu-id="72fb1-171">**Пользовательский Интерфейс отображается ход выполнения для передачи данных hello**.</span><span class="sxs-lookup"><span data-stu-id="72fb1-171">**UI is showing progress for hello data transfer**.</span></span> <span data-ttu-id="72fb1-172">по-прежнему передаются данные Hello.</span><span class="sxs-lookup"><span data-stu-id="72fb1-172">hello data is still being transferred.</span></span> <span data-ttu-id="72fb1-173">пропускная способность сети Hello или hello размер данных вызывает задержки.</span><span class="sxs-lookup"><span data-stu-id="72fb1-173">hello network bandwidth or hello size of data might be causing delays.</span></span>
* <span data-ttu-id="72fb1-174">**Пользовательский Интерфейс не отображается ход выполнения для передачи данных hello**.</span><span class="sxs-lookup"><span data-stu-id="72fb1-174">**UI is not showing progress for hello data transfer**.</span></span> <span data-ttu-id="72fb1-175">Привет Открыть журналы, расположенный Agent\Temp служб восстановления Azure C:\Microsoft, затем проверьте наличие hello FileProvider::EndData запись в журналы hello.</span><span class="sxs-lookup"><span data-stu-id="72fb1-175">Open hello logs located at C:\Microsoft Azure Recovery Services Agent\Temp, and then check for hello FileProvider::EndData entry in hello logs.</span></span> <span data-ttu-id="72fb1-176">Эта запись означает, что hello передача данных завершена, и происходит операция с каталогом hello.</span><span class="sxs-lookup"><span data-stu-id="72fb1-176">This entry signifies that hello data transfer finished and hello catalog operation is happening.</span></span> <span data-ttu-id="72fb1-177">Не отменять hello задания резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="72fb1-177">Don't cancel hello backup jobs.</span></span> <span data-ttu-id="72fb1-178">Вместо этого дождитесь немного больше toofinish операции каталога hello.</span><span class="sxs-lookup"><span data-stu-id="72fb1-178">Instead, wait a little longer for hello catalog operation toofinish.</span></span> <span data-ttu-id="72fb1-179">Если hello проблема будет повторяться, обратитесь в службу [поддержки Azure](https://portal.azure.com/#create/Microsoft.Support).</span><span class="sxs-lookup"><span data-stu-id="72fb1-179">If hello problem persists, contact [Azure support](https://portal.azure.com/#create/Microsoft.Support).</span></span>
