---
title: "Служба архивации Azure: восстановление файлов и папок из резервной копии виртуальной машины Azure | Документация Майкрософт"
description: "Восстановление файлов из точки восстановления виртуальной машины Azure"
services: backup
documentationcenter: dev-center-name
author: pvrk
manager: shivamg
keywords: "восстановление на уровне элементов; восстановление файлов из резервной копии виртуальной машины Azure; восстановление файлов виртуальной машины Azure"
ms.assetid: f1c067a2-4826-4da4-b97a-c5fd6c189a77
ms.service: backup
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 07/20/2017
ms.author: pullabhk;markgal
ms.openlocfilehash: ae7c345c11a7db25413d60ad822f16f84ca37362
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="recover-files-from-azure-virtual-machine-backup"></a><span data-ttu-id="b695f-104">Восстановление файлов из резервной копии виртуальной машины Azure</span><span class="sxs-lookup"><span data-stu-id="b695f-104">Recover files from Azure virtual machine backup</span></span>

<span data-ttu-id="b695f-105">Служба архивации Azure предоставляет возможность восстанавливать [виртуальные машины Azure и диски](./backup-azure-arm-restore-vms.md) из резервных копий виртуальных машин Azure.</span><span class="sxs-lookup"><span data-stu-id="b695f-105">Azure backup provides the capability to restore [Azure VMs and disks](./backup-azure-arm-restore-vms.md) from Azure VM backups.</span></span> <span data-ttu-id="b695f-106">В этой статье объясняется, как восстановить из резервной копии виртуальной машины Azure отдельные элементы, такие как файлы и папки.</span><span class="sxs-lookup"><span data-stu-id="b695f-106">Now this article explains how you can recover items such as files and folders from an Azure VM backup.</span></span>

> [!Note]
> <span data-ttu-id="b695f-107">Эта функция доступна для всех виртуальных машин Azure, развернутых по модели с помощью Resource Manager и защищенных в хранилище служб восстановления.</span><span class="sxs-lookup"><span data-stu-id="b695f-107">This feature is available for Azure VMs deployed using the Resource Manager model and protected to a Recovery services vault.</span></span>
> <span data-ttu-id="b695f-108">Восстановление файлов из зашифрованной резервной копии виртуальной машины не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="b695f-108">File recovery from an encrypted VM backup is not supported.</span></span>
>

## <a name="mount-the-volume-and-copy-files"></a><span data-ttu-id="b695f-109">Подключение тома и копирование файлов</span><span class="sxs-lookup"><span data-stu-id="b695f-109">Mount the volume and copy files</span></span>

1. <span data-ttu-id="b695f-110">Войдите на [портал Azure](http://portal.Azure.com).</span><span class="sxs-lookup"><span data-stu-id="b695f-110">Sign into the [Azure portal](http://portal.Azure.com).</span></span> <span data-ttu-id="b695f-111">Найдите нужное хранилище служб восстановления, а в нем — нужный архивируемый элемент.</span><span class="sxs-lookup"><span data-stu-id="b695f-111">Find the relevant Recovery services vault and the required backup item.</span></span>

2. <span data-ttu-id="b695f-112">В колонке "Архивируемый элемент" щелкните **Восстановление файлов**</span><span class="sxs-lookup"><span data-stu-id="b695f-112">On the Backup Item blade, click **File Recovery**</span></span>

    ![Открытие архивируемого элемента в хранилище служб восстановления](./media/backup-azure-restore-files-from-vm/open-vault-item.png)

    <span data-ttu-id="b695f-114">Откроется колонка **Восстановление файлов**.</span><span class="sxs-lookup"><span data-stu-id="b695f-114">The **File Recovery** blade opens.</span></span>

    ![Колонка восстановления файлов](./media/backup-azure-restore-files-from-vm/file-recovery-blade.png)

3. <span data-ttu-id="b695f-116">В раскрывающемся меню **Выберите точку восстановления** найдите и выберите точку восстановления, которая содержит требуемые файлы.</span><span class="sxs-lookup"><span data-stu-id="b695f-116">From the **Select recovery point** drop-down menu, select the recovery point that contains the files you want.</span></span> <span data-ttu-id="b695f-117">По умолчанию здесь выбрана последняя из созданных точек восстановления.</span><span class="sxs-lookup"><span data-stu-id="b695f-117">By default, the latest recovery point is already selected.</span></span>

4. <span data-ttu-id="b695f-118">Щелкните **Download Executable** (Скачать исполняемый файл) (для виртуальной машины Windows в Azure) или **Скачать сценарий** (для виртуальной машины Linux в Azure), чтобы скачать программное обеспечение для копирования файлов из точки восстановления.</span><span class="sxs-lookup"><span data-stu-id="b695f-118">Click **Download Executable** (for Windows Azure VM) or **Download Script** (for Linux Azure VM) to download the software that you'll use to copy files from the recovery point.</span></span>

  <span data-ttu-id="b695f-119">Этот исполняемый файл или сценарий создает подключение между локальным компьютером и указанной точкой восстановления.</span><span class="sxs-lookup"><span data-stu-id="b695f-119">The executable/script creates a connection between the local computer and the specified recovery point.</span></span>

5. <span data-ttu-id="b695f-120">Для запуска скачанного сценария или исполняемого файла требуется указать пароль.</span><span class="sxs-lookup"><span data-stu-id="b695f-120">You need a password to run the downloaded script/executable.</span></span> <span data-ttu-id="b695f-121">Можно скопировать пароль с портала с помощью кнопки "Копировать" рядом с созданным паролем</span><span class="sxs-lookup"><span data-stu-id="b695f-121">You can copy the password from the portal using the copy button beside the generated password</span></span>

    ![Созданный пароль](./media/backup-azure-restore-files-from-vm/generated-pswd.png)

6. <span data-ttu-id="b695f-123">Запустите исполняемый файл или сценарий на компьютере, на который вы хотите восстановить файлы.</span><span class="sxs-lookup"><span data-stu-id="b695f-123">On the computer where you want to recover the files, run the executable/script.</span></span> <span data-ttu-id="b695f-124">Это нужно делать от имени администратора.</span><span class="sxs-lookup"><span data-stu-id="b695f-124">You must run it with Administrator credentials.</span></span> <span data-ttu-id="b695f-125">Если скрипт выполняется на компьютере с ограниченным доступом, убедитесь в наличии доступа к следующим ресурсам:</span><span class="sxs-lookup"><span data-stu-id="b695f-125">If you run the script on a computer with restricted access, ensure there is access to:</span></span>

    - <span data-ttu-id="b695f-126">download.microsoft.com</span><span class="sxs-lookup"><span data-stu-id="b695f-126">download.microsoft.com</span></span>
    - <span data-ttu-id="b695f-127">конечные точки Azure, которые использовались для резервного копирования этой виртуальной машины Azure;</span><span class="sxs-lookup"><span data-stu-id="b695f-127">Azure endpoints used for Azure VM backups</span></span>
    - <span data-ttu-id="b695f-128">исходящий порт 3260.</span><span class="sxs-lookup"><span data-stu-id="b695f-128">outbound port 3260</span></span>

   <span data-ttu-id="b695f-129">Для Linux сценарию требуются компоненты open-iscsi и lshw для подключения к точке восстановления.</span><span class="sxs-lookup"><span data-stu-id="b695f-129">For Linux, the script requires 'open-iscsi' and 'lshw' components to connect to the recovery point.</span></span> <span data-ttu-id="b695f-130">Если их не нет на компьютере, на котором выполняется сценарий, он запрашивает разрешение на установку соответствующих компонентов и устанавливает их после получения согласия.</span><span class="sxs-lookup"><span data-stu-id="b695f-130">If those do not exist on the machine where it is run, it asks for permission to install the relevant components and installs them upon consent.</span></span>
   
   <span data-ttu-id="b695f-131">Введите пароль, скопированный с портала, когда будет предложено.</span><span class="sxs-lookup"><span data-stu-id="b695f-131">Enter the password copied from the portal when prompted.</span></span> <span data-ttu-id="b695f-132">После ввода пароля сценарии подключаются к точке восстановления.</span><span class="sxs-lookup"><span data-stu-id="b695f-132">Once the valid password is entered the scripts connects to the recovery point.</span></span>
      
    ![Колонка восстановления файлов](./media/backup-azure-restore-files-from-vm/executable-output.png)
    
   
   <span data-ttu-id="b695f-134">Сценарий можно запустить на любом компьютере, операционная система на котором совпадает или совместима с операционной системой архивной виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="b695f-134">You can run the script on any machine that has the same (or compatible) operating system as the backed-up VM.</span></span> <span data-ttu-id="b695f-135">Условия совместимости можно проверить в [таблице совместимых ОС](backup-azure-restore-files-from-vm.md#compatible-os).</span><span class="sxs-lookup"><span data-stu-id="b695f-135">See the [Compatible OS table](backup-azure-restore-files-from-vm.md#compatible-os) for compatible operating systems.</span></span> <span data-ttu-id="b695f-136">Если на защищенной виртуальной машине Azure используются дисковые пространства Windows (для виртуальных машин Windows в Azure) либо LVM или RAID-массивы (для виртуальных машин Linux), то запустить на ней исполняемый файл или сценарий не удастся.</span><span class="sxs-lookup"><span data-stu-id="b695f-136">If the protected Azure virtual machine uses Windows Storage Spaces (for Windows Azure VMs) or LVM/RAID Arrays(for Linux VMs), then you can't run the executable/script on the same virtual machine.</span></span> <span data-ttu-id="b695f-137">Вместо этого запустите его на другом компьютере с совместимой операционной системой.</span><span class="sxs-lookup"><span data-stu-id="b695f-137">Instead, run it on any other machine with a compatible operating system.</span></span>

### <a name="compatible-os"></a><span data-ttu-id="b695f-138">Совместимые операционные системы</span><span class="sxs-lookup"><span data-stu-id="b695f-138">Compatible OS</span></span>

#### <a name="for-windows"></a><span data-ttu-id="b695f-139">Для Windows</span><span class="sxs-lookup"><span data-stu-id="b695f-139">For Windows</span></span>

<span data-ttu-id="b695f-140">Следующая таблица содержит информацию о совместимости операционных систем сервера и компьютера.</span><span class="sxs-lookup"><span data-stu-id="b695f-140">The following table shows the compatibility between server and computer operating systems.</span></span> <span data-ttu-id="b695f-141">Файлы не удастся восстановить на компьютере с несовместимой операционной системой.</span><span class="sxs-lookup"><span data-stu-id="b695f-141">When recovering files, you can't restore files between incompatible operating systems.</span></span>

|<span data-ttu-id="b695f-142">ОС сервера</span><span class="sxs-lookup"><span data-stu-id="b695f-142">Server OS</span></span> | <span data-ttu-id="b695f-143">Совместимые ОС клиента</span><span class="sxs-lookup"><span data-stu-id="b695f-143">Compatible client OS</span></span>  |
| --------------- | ---- |
| <span data-ttu-id="b695f-144">Windows Server 2012 R2</span><span class="sxs-lookup"><span data-stu-id="b695f-144">Windows Server 2012 R2</span></span> | <span data-ttu-id="b695f-145">Windows 8.1</span><span class="sxs-lookup"><span data-stu-id="b695f-145">Windows 8.1</span></span> |
| <span data-ttu-id="b695f-146">Windows Server 2012</span><span class="sxs-lookup"><span data-stu-id="b695f-146">Windows Server 2012</span></span>    | <span data-ttu-id="b695f-147">Windows 8</span><span class="sxs-lookup"><span data-stu-id="b695f-147">Windows 8</span></span>  |
| <span data-ttu-id="b695f-148">Windows Server 2008 R2</span><span class="sxs-lookup"><span data-stu-id="b695f-148">Windows Server 2008 R2</span></span> | <span data-ttu-id="b695f-149">Windows 7</span><span class="sxs-lookup"><span data-stu-id="b695f-149">Windows 7</span></span>   |

#### <a name="for-linux"></a><span data-ttu-id="b695f-150">Для Linux</span><span class="sxs-lookup"><span data-stu-id="b695f-150">For Linux</span></span>

<span data-ttu-id="b695f-151">В Linux фундаментальным является следующее требование: операционная система компьютера, на котором запускается сценарий, должна поддерживать файловую систему, используемую в виртуальной архивной виртуальной машине Linux.</span><span class="sxs-lookup"><span data-stu-id="b695f-151">In Linux, the fundamental requirement is that the OS of the machine where the script is run should support the filesystem of the files present in the backed-up Linux VM.</span></span> <span data-ttu-id="b695f-152">При выборе компьютера для выполнения сценария убедитесь, что он использует совместимую операционную систему поддерживаемой версии, как указано в следующей таблице.</span><span class="sxs-lookup"><span data-stu-id="b695f-152">While selecting a machine to run the script, please ensure it has the compatible OS and the versions as mentioned in the table below.</span></span>

|<span data-ttu-id="b695f-153">ОС Linux</span><span class="sxs-lookup"><span data-stu-id="b695f-153">Linux OS</span></span> | <span data-ttu-id="b695f-154">Версии</span><span class="sxs-lookup"><span data-stu-id="b695f-154">Versions</span></span>  |
| --------------- | ---- |
| <span data-ttu-id="b695f-155">Ubuntu</span><span class="sxs-lookup"><span data-stu-id="b695f-155">Ubuntu</span></span> | <span data-ttu-id="b695f-156">12.04 и выше</span><span class="sxs-lookup"><span data-stu-id="b695f-156">12.04 and above</span></span> |
| <span data-ttu-id="b695f-157">CentOS</span><span class="sxs-lookup"><span data-stu-id="b695f-157">CentOS</span></span> | <span data-ttu-id="b695f-158">6.5 и выше</span><span class="sxs-lookup"><span data-stu-id="b695f-158">6.5 and above</span></span>  |
| <span data-ttu-id="b695f-159">RHEL</span><span class="sxs-lookup"><span data-stu-id="b695f-159">RHEL</span></span> | <span data-ttu-id="b695f-160">6.7 и выше</span><span class="sxs-lookup"><span data-stu-id="b695f-160">6.7 and above</span></span> |
| <span data-ttu-id="b695f-161">Debian</span><span class="sxs-lookup"><span data-stu-id="b695f-161">Debian</span></span> | <span data-ttu-id="b695f-162">7 и выше</span><span class="sxs-lookup"><span data-stu-id="b695f-162">7 and above</span></span> |
| <span data-ttu-id="b695f-163">Oracle Linux</span><span class="sxs-lookup"><span data-stu-id="b695f-163">Oracle Linux</span></span> | <span data-ttu-id="b695f-164">6.4 и выше</span><span class="sxs-lookup"><span data-stu-id="b695f-164">6.4 and above</span></span> |

<span data-ttu-id="b695f-165">Сценарию также требуется компоненты python и bash для выполнения операций и безопасного подключения к точке восстановления.</span><span class="sxs-lookup"><span data-stu-id="b695f-165">The script also requires python and bash components to execute and connect securely to the recovery point.</span></span>

|<span data-ttu-id="b695f-166">Компонент</span><span class="sxs-lookup"><span data-stu-id="b695f-166">Component</span></span> | <span data-ttu-id="b695f-167">Версия</span><span class="sxs-lookup"><span data-stu-id="b695f-167">Version</span></span>  |
| --------------- | ---- |
| <span data-ttu-id="b695f-168">bash</span><span class="sxs-lookup"><span data-stu-id="b695f-168">bash</span></span> | <span data-ttu-id="b695f-169">4 и выше</span><span class="sxs-lookup"><span data-stu-id="b695f-169">4 and above</span></span> |
| <span data-ttu-id="b695f-170">python</span><span class="sxs-lookup"><span data-stu-id="b695f-170">python</span></span> | <span data-ttu-id="b695f-171">2.6.6 и выше</span><span class="sxs-lookup"><span data-stu-id="b695f-171">2.6.6 and above</span></span>  |


### <a name="identifying-volumes"></a><span data-ttu-id="b695f-172">Определение томов</span><span class="sxs-lookup"><span data-stu-id="b695f-172">Identifying Volumes</span></span>

#### <a name="for-windows"></a><span data-ttu-id="b695f-173">Для Windows</span><span class="sxs-lookup"><span data-stu-id="b695f-173">For Windows</span></span>

<span data-ttu-id="b695f-174">При выполнении исполняемого файла операционная система подключает новые тома и назначает им буквы дисков.</span><span class="sxs-lookup"><span data-stu-id="b695f-174">When you run the exectuable, the operating system mounts the new volumes and assigns drive letters.</span></span> <span data-ttu-id="b695f-175">Для просмотра этих дисков вы можете использовать проводник Windows или проводник.</span><span class="sxs-lookup"><span data-stu-id="b695f-175">You can use Windows Explorer or File Explorer to browse those drives.</span></span> <span data-ttu-id="b695f-176">Этим томам могут быть назначены не те буквы дисков, которые использовались на исходной виртуальной машине. Имена томов сохраняются.</span><span class="sxs-lookup"><span data-stu-id="b695f-176">The drive letters assigned to the volumes may not be the same letters as the original virtual machine, however, the volume name is preserved.</span></span> <span data-ttu-id="b695f-177">Например, если на исходной виртуальной машине том назывался "Диск данных (E:\)", на локальном компьютере он будет подключен как "Диск данных ('любая доступная буква диска':\)".</span><span class="sxs-lookup"><span data-stu-id="b695f-177">For example, if the volume on the original virtual machine was “Data Disk (E:\)”, that volume can be attached as “Data Disk ('Any drive letter available':\) on the local computer.</span></span> <span data-ttu-id="b695f-178">Просмотрите все тома, которые упоминаются в выходных данных скрипта, пока не найдете нужные файлы или папки.</span><span class="sxs-lookup"><span data-stu-id="b695f-178">Browse through all volumes mentioned in the script output until you find your files/folder.</span></span>  
       
   ![Колонка восстановления файлов](./media/backup-azure-restore-files-from-vm/volumes-attached.png)
           
#### <a name="for-linux"></a><span data-ttu-id="b695f-180">Для Linux</span><span class="sxs-lookup"><span data-stu-id="b695f-180">For Linux</span></span>

<span data-ttu-id="b695f-181">В Linux тома точки восстановления подключаются к папке, в которой выполняет сценарий.</span><span class="sxs-lookup"><span data-stu-id="b695f-181">In Linux, the volumes of the recovery point are mounted to the folder where the script is run.</span></span> <span data-ttu-id="b695f-182">Отображаются подключенные диски, тома и соответствующие пути подключения.</span><span class="sxs-lookup"><span data-stu-id="b695f-182">The attached disks, volumes and the corresponding mount paths are shown accordingly.</span></span> <span data-ttu-id="b695f-183">Эти пути подключения видимы для пользователей с доступом на корневом уровне.</span><span class="sxs-lookup"><span data-stu-id="b695f-183">These mount paths are visible to users having root level access.</span></span> <span data-ttu-id="b695f-184">Просмотрите тома, указанные в выходных данных сценария.</span><span class="sxs-lookup"><span data-stu-id="b695f-184">Browse through the volumes mentioned in the script output.</span></span>

  ![Колонка восстановления файлов Linux](./media/backup-azure-restore-files-from-vm/linux-mount-paths.png)
  

## <a name="closing-the-connection"></a><span data-ttu-id="b695f-186">Закрытие подключения</span><span class="sxs-lookup"><span data-stu-id="b695f-186">Closing the connection</span></span>

<span data-ttu-id="b695f-187">Когда вы найдете все нужные файлы и скопируете их в локальное хранилище, удалите или отключите дополнительные диски.</span><span class="sxs-lookup"><span data-stu-id="b695f-187">After identifying the files and copying them to a local storage location, remove (or unmount) the additional drives.</span></span> <span data-ttu-id="b695f-188">Чтобы отключить диски, щелкните **Unmount Disks** (Отключить диски) в колонке **Восстановление файлов** на портале Azure.</span><span class="sxs-lookup"><span data-stu-id="b695f-188">To unmount the drives, on the **File Recovery** blade in the Azure portal, click **Unmount Disks**.</span></span>

![Отключение дисков](./media/backup-azure-restore-files-from-vm/unmount-disks3.png)

<span data-ttu-id="b695f-190">Когда диски будут отключены, появится сообщение об успешном завершении операции.</span><span class="sxs-lookup"><span data-stu-id="b695f-190">Once the disks have been unmounted, you receive a message letting you know it was successful.</span></span> <span data-ttu-id="b695f-191">На обновление состояния подключения может потребоваться несколько минут, после чего диски можно удалить.</span><span class="sxs-lookup"><span data-stu-id="b695f-191">It may take a few minutes for the connection to refresh so that you can remove the disks.</span></span>

<span data-ttu-id="b695f-192">В Linux после разрыва подключения к точке восстановления операционная система не удаляет соответствующие пути подключения автоматически.</span><span class="sxs-lookup"><span data-stu-id="b695f-192">In Linux, after the connection to the recovery point is severed, the OS doesn't remove the corresponding mount paths automatically.</span></span> <span data-ttu-id="b695f-193">Они существуют в виде потерянных томов и видимы, но при обращении к ним или записи в них файлов происходит ошибка.</span><span class="sxs-lookup"><span data-stu-id="b695f-193">These exist as "orphan" volumes and they are visible but throw an error when you access/write the files.</span></span> <span data-ttu-id="b695f-194">Их можно удалить вручную.</span><span class="sxs-lookup"><span data-stu-id="b695f-194">They can be manually removed.</span></span> <span data-ttu-id="b695f-195">При запуске сценарий определяет такие тома, оставшиеся от любой предыдущей точки восстановления, и очищает их после согласия пользователя.</span><span class="sxs-lookup"><span data-stu-id="b695f-195">The script, when run, identifies any such volumes existing from any previous recovery points and cleans them up upon consent.</span></span>

## <a name="special-configurations"></a><span data-ttu-id="b695f-196">Специальные конфигурации</span><span class="sxs-lookup"><span data-stu-id="b695f-196">Special configurations</span></span>

### <a name="dynamic-disks"></a><span data-ttu-id="b695f-197">Динамические диски</span><span class="sxs-lookup"><span data-stu-id="b695f-197">Dynamic Disks</span></span>

<span data-ttu-id="b695f-198">Если на виртуальной машине Azure, для которой была создана резервная копия, есть тома, что занимают несколько дисков (составные и чередующиеся тома), или отказоустойчивые тома (зеркальные тома и тома RAID-5 ) на динамических дисках, тогда на этой виртуальной машине нельзя запустить исполняемый сценарий.</span><span class="sxs-lookup"><span data-stu-id="b695f-198">If the Azure VM that was backed up has volumes that span multiple disks (spanned and striped volumes) and/or fault-tolerant volumes (mirrored and RAID-5 volumes) on dynamic disks, then you can't run the executable script on the same VM.</span></span> <span data-ttu-id="b695f-199">Вместо этого запустите его на другом компьютере с совместимой операционной системой.</span><span class="sxs-lookup"><span data-stu-id="b695f-199">Instead, run the executable script on any other machine with a compatible operating system.</span></span>

### <a name="windows-storage-spaces"></a><span data-ttu-id="b695f-200">Дисковое пространство Windows</span><span class="sxs-lookup"><span data-stu-id="b695f-200">Windows Storage Spaces</span></span>

<span data-ttu-id="b695f-201">Дисковые пространства Windows — это технология службы хранилища Windows, которая позволяет виртуализировать хранилище.</span><span class="sxs-lookup"><span data-stu-id="b695f-201">Windows Storage Spaces is a technology in Windows storage that enables you to virtualize storage.</span></span> <span data-ttu-id="b695f-202">С помощью дисковых пространств Windows можно группировать стандартные диски в пулы носителей и создавать на их основе виртуальные диски (дисковые пространства), использующие доступное пространство в этих пулах носителей.</span><span class="sxs-lookup"><span data-stu-id="b695f-202">With Windows Storage Spaces you can group industry-standard disks into storage pools, and then create virtual disks, called storage spaces, from the available space in those storage pools.</span></span>

<span data-ttu-id="b695f-203">Исполняемый файл или сценарий не удастся запустить на виртуальной машине Azure, для архивации которой использовались дисковые пространства Windows.</span><span class="sxs-lookup"><span data-stu-id="b695f-203">If the Azure VM that was backed up uses Windows Storage Spaces, then you can't run the executable script on the same VM.</span></span> <span data-ttu-id="b695f-204">Вместо этого запустите его на другом компьютере с совместимой операционной системой.</span><span class="sxs-lookup"><span data-stu-id="b695f-204">Instead, run the executable script on any other machine with a compatible operating system.</span></span>

### <a name="lvmraid-arrays"></a><span data-ttu-id="b695f-205">LVM или RAID-массивы</span><span class="sxs-lookup"><span data-stu-id="b695f-205">LVM/RAID Arrays</span></span>

<span data-ttu-id="b695f-206">В Linux для управления логическими томами на нескольких дисках используется диспетчер логических томов (LVM) и (или) программные RAID-массивы.</span><span class="sxs-lookup"><span data-stu-id="b695f-206">In Linux, Logical volume manager (LVM) and/or software RAID Arrays are used to manage logical volumes over multiple disks.</span></span> <span data-ttu-id="b695f-207">Если архивная виртуальная машина Linux использует LVM или RAID-массивы, на ней нельзя запустить сценарий.</span><span class="sxs-lookup"><span data-stu-id="b695f-207">If the backed up Linux VM uses LVM and/or RAID Arrays, you can't run the script on the same VM.</span></span> <span data-ttu-id="b695f-208">Вместо этого запустите сценарий на любом другом компьютере с совместимой операционной системы, поддерживающей файловую систему архивной виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="b695f-208">Instead run the script on any other machine with compatible OS and which supports filesystem of the backed up VM.</span></span>

<span data-ttu-id="b695f-209">В выходных данных сценария отображаются диски и тома LVM или RAID-массивов с типом раздела, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="b695f-209">The script output displays the LVM and/or RAID Arrays disks and the volumes with the partition type as shown below</span></span>

   ![Колонка выходных данных для LVM в Linux](./media/backup-azure-restore-files-from-vm/linux-LVMOutput.png)
   
<span data-ttu-id="b695f-211">Пользователь должен выполнить приведенные ниже команды, чтобы подключить эти разделы.</span><span class="sxs-lookup"><span data-stu-id="b695f-211">The following commands need to be run by the user to bring these partitions online.</span></span> 

<span data-ttu-id="b695f-212">**Для разделов LVM**</span><span class="sxs-lookup"><span data-stu-id="b695f-212">**For LVM Partitions**</span></span>

```
$ pvs <volume name as shown above in the script output> 
```
<span data-ttu-id="b695f-213">Эта команда выводит имена групп томов в физическом томе.</span><span class="sxs-lookup"><span data-stu-id="b695f-213">This lists the volume group names under a physical volume.</span></span>

```
$ lvdisplay <volume-group-name from the pvs command’s results> 
```
<span data-ttu-id="b695f-214">Эта команда выводит все логические тома, имена и их пути в группе томов.</span><span class="sxs-lookup"><span data-stu-id="b695f-214">This lists all logical volumes, names and their paths in a volume group.</span></span>

```
$ mount <LV path> </mountpath>
```
<span data-ttu-id="b695f-215">Эта команда подключает логические тома по указанному пути.</span><span class="sxs-lookup"><span data-stu-id="b695f-215">To mount the logical volumes to the path of your choice.</span></span>


<span data-ttu-id="b695f-216">**Для RAID-массивов**</span><span class="sxs-lookup"><span data-stu-id="b695f-216">**For RAID Arrays**</span></span>

```
$ mdadm –detail –scan
```
<span data-ttu-id="b695f-217">Эта команда отображает сведения о всех дисках RAID.</span><span class="sxs-lookup"><span data-stu-id="b695f-217">This displays details about all raid disks.</span></span> <span data-ttu-id="b695f-218">Соответствующий диск RAID будет отображен как `/dev/mdm/<RAID array name in the backed up VM>`.</span><span class="sxs-lookup"><span data-stu-id="b695f-218">The relevant RAID disk will be displayed as `/dev/mdm/<RAID array name in the backed up VM>`</span></span>

<span data-ttu-id="b695f-219">Если диск RAID содержит физические тома, используйте команду mount.</span><span class="sxs-lookup"><span data-stu-id="b695f-219">Use the mount command if the RAID disk has physical volumes.</span></span>
```
$ mount [RAID Disk Path] [/mounthpath]
```

<span data-ttu-id="b695f-220">Если для этого диска RAID настроен другой LVM, то выполните приведенную выше процедуру для разделов LVM, указав имя тома в качестве имени диска RAID.</span><span class="sxs-lookup"><span data-stu-id="b695f-220">If this RAID disk has another LVM configured in it then follow the same procedure as outlined above for LVM partitions with the volume name being the RAID Disk name</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="b695f-221">Устранение неполадок</span><span class="sxs-lookup"><span data-stu-id="b695f-221">Troubleshooting</span></span>

<span data-ttu-id="b695f-222">Если при восстановлении файлов из виртуальных машин у вас возникнут проблемы, проверьте сведения, приведенные в следующей таблице.</span><span class="sxs-lookup"><span data-stu-id="b695f-222">If you have problems while recovering files from the virtual machines, check the following table for additional information.</span></span>

| <span data-ttu-id="b695f-223">Сообщение об ошибке или ситуация</span><span class="sxs-lookup"><span data-stu-id="b695f-223">Error Message / Scenario</span></span> | <span data-ttu-id="b695f-224">Возможные причины</span><span class="sxs-lookup"><span data-stu-id="b695f-224">Probable Cause</span></span> | <span data-ttu-id="b695f-225">Рекомендуемое действие</span><span class="sxs-lookup"><span data-stu-id="b695f-225">Recommended action</span></span> |
| ------------------------ | -------------- | ------------------ |
| <span data-ttu-id="b695f-226">Исполняемый файл возвращает ошибку *Exception connecting to the target* (исключение при подключении к целевому объекту)</span><span class="sxs-lookup"><span data-stu-id="b695f-226">Exe output: *Exception connecting to the target*</span></span> |<span data-ttu-id="b695f-227">Скрипт не может получить доступ к точке восстановления</span><span class="sxs-lookup"><span data-stu-id="b695f-227">Script is not able to access the recovery point</span></span> | <span data-ttu-id="b695f-228">Проверьте, соответствует ли компьютер всем перечисленным выше требованиям.</span><span class="sxs-lookup"><span data-stu-id="b695f-228">Check whether the machine fulfills the access requirements mentioned above</span></span>|  
|   <span data-ttu-id="b695f-229">Исполняемый файл возвращает ошибку *The target has already been logged in via an ISCSI session* (Вход на целевое устройство уже выполнен через сеанс iSCSI).</span><span class="sxs-lookup"><span data-stu-id="b695f-229">Exe output: *The target has already been logged in via an ISCSI session.*</span></span> | <span data-ttu-id="b695f-230">Этот скрипт уже запущен на этом компьютере и диски уже подключены</span><span class="sxs-lookup"><span data-stu-id="b695f-230">The script was already executed on the same machine and the drives have been attached</span></span> | <span data-ttu-id="b695f-231">Тома точки восстановления уже подключены.</span><span class="sxs-lookup"><span data-stu-id="b695f-231">The volumes of the recovery point have already been attached.</span></span> <span data-ttu-id="b695f-232">Их НЕЛЬЗЯ подключить с теми же буквами дисков, что и на исходной виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="b695f-232">They may NOT be mounted with the same drive letters of the original VM.</span></span> <span data-ttu-id="b695f-233">Просмотрите все доступные тома в проводнике, чтобы найти нужный файл.</span><span class="sxs-lookup"><span data-stu-id="b695f-233">Browse through all the available volumes in the file explorer for your file</span></span> |
| <span data-ttu-id="b695f-234">Исполняемый файл возвращает ошибку *This script is invalid because the disks have been dismounted via portal/exceeded the 12-hr limit. Please download a new script from the portal.* (Этот скрипт недействителен, так как диски отключены через портал или превышено ограничение в 12 часов. Скачайте с портала новый скрипт).</span><span class="sxs-lookup"><span data-stu-id="b695f-234">Exe output: *This script is invalid because the disks have been dismounted via portal/exceeded the 12-hr limit. Please download a new script from the portal.*</span></span> |  <span data-ttu-id="b695f-235">Диски отключены через портал или превышено 12-часовое ограничение.</span><span class="sxs-lookup"><span data-stu-id="b695f-235">The disks have been dismounted from the portal or the 12-hr limit exceeded</span></span> |    <span data-ttu-id="b695f-236">Эта копия исполняемого файла больше недействительна, и использовать ее нельзя.</span><span class="sxs-lookup"><span data-stu-id="b695f-236">This particular exe is now invalid and can’t be run.</span></span> <span data-ttu-id="b695f-237">Если вам еще нужен доступ к файлам этой точки восстановления на определенный момент времени, зайдите на портал и скачайте новый EXE-файл.</span><span class="sxs-lookup"><span data-stu-id="b695f-237">If you want to access the files of that recovery point-in-time, visit the portal for a new exe</span></span>|
| <span data-ttu-id="b695f-238">На компьютере, где выполняется EXE-файл, новые тома не отключаются кнопкой отключения</span><span class="sxs-lookup"><span data-stu-id="b695f-238">On the machine where the exe is run: The new volumes are not dismounted after the dismount button is clicked</span></span> |    <span data-ttu-id="b695f-239">Инициатор iSCSI на компьютере не отвечает на запросы или не обновляет подключение к целевому объекту, сохраняя состояние кэша</span><span class="sxs-lookup"><span data-stu-id="b695f-239">The ISCSI initiator on the machine is not responding/refreshing its connection to the target and maintaining the cache</span></span> |    <span data-ttu-id="b695f-240">Подождите несколько минут после нажатия кнопки отключения.</span><span class="sxs-lookup"><span data-stu-id="b695f-240">Wait for some mins after the dismount button is pressed.</span></span> <span data-ttu-id="b695f-241">Если новые тома по-прежнему не отключаются, откройте в проводнике каждый из них.</span><span class="sxs-lookup"><span data-stu-id="b695f-241">If the new volumes are still not dismounted, please browse through all the volumes.</span></span> <span data-ttu-id="b695f-242">Инициатор принудительно обновит соединение, и диски будут отключены с сообщением об ошибке "Диск недоступен".</span><span class="sxs-lookup"><span data-stu-id="b695f-242">This forces the initiator to refresh the connection and the volume is dismounted with an error message that the disk is not available</span></span>|
| <span data-ttu-id="b695f-243">Скрипт выполняется успешно, но в его выходных данных нет сообщения "New volumes attached" (Новые тома подключены).</span><span class="sxs-lookup"><span data-stu-id="b695f-243">Exe output: Script is run successfully but “New volumes attached” is not displayed on the script output</span></span> | <span data-ttu-id="b695f-244">Это временная проблема</span><span class="sxs-lookup"><span data-stu-id="b695f-244">This is a transient error</span></span>   | <span data-ttu-id="b695f-245">Тома, скорее всего, уже подключены.</span><span class="sxs-lookup"><span data-stu-id="b695f-245">The volumes would have been already attached.</span></span> <span data-ttu-id="b695f-246">Попробуйте открыть их через проводник.</span><span class="sxs-lookup"><span data-stu-id="b695f-246">Open Explorer to browse.</span></span> <span data-ttu-id="b695f-247">Если вы несколько раз запускали скрипт на одном и том же компьютере, попробуйте перезагрузить компьютер. Список будет отображаться при последующих запусках EXE-файла.</span><span class="sxs-lookup"><span data-stu-id="b695f-247">If you are using the same machine for running scripts every time, consider restarting the machine and the list should be displayed in the subsequent exe runs.</span></span> |
| <span data-ttu-id="b695f-248">В Linux: не удается просмотреть нужные тома.</span><span class="sxs-lookup"><span data-stu-id="b695f-248">Linux specific: Not able to view the desired volumes</span></span> | <span data-ttu-id="b695f-249">Операционная система компьютера, на котором выполняется сценарий, не может распознать базовую файловую систему архивной виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="b695f-249">The OS of the machine where the script is run may not recognize the underlying filesystem of the backed up VM</span></span> | <span data-ttu-id="b695f-250">Проверьте, является ли точка восстановления отказоустойчивой или обеспечивающей целостность файлов.</span><span class="sxs-lookup"><span data-stu-id="b695f-250">Check whether the recovery point is crash consistent or file-consistent.</span></span> <span data-ttu-id="b695f-251">Если это конечная точка, обеспечивающая целостность файлов, выполните сценарий на другом компьютере, ОС которого распознает файловую систему архивной виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="b695f-251">If file consistent, run the script on another machine whose OS recognizes the backed up VM's filesystem</span></span> |
| <span data-ttu-id="b695f-252">В Windows: не удается просмотреть нужные тома</span><span class="sxs-lookup"><span data-stu-id="b695f-252">Windows specific: Not able to view the desired volumes</span></span> | <span data-ttu-id="b695f-253">Диски присоединены, но тома не настроены</span><span class="sxs-lookup"><span data-stu-id="b695f-253">The disks may have been attached but the volumes were not configured</span></span> | <span data-ttu-id="b695f-254">На экране управления дисками определите дополнительные диски, относящиеся к точке восстановления.</span><span class="sxs-lookup"><span data-stu-id="b695f-254">From the disk management screen, identify the additional disks related to the recovery point.</span></span> <span data-ttu-id="b695f-255">Если любой из этих дисков не подключен к сети, попробуйте подключить их, щелкнув правой кнопкой мыши диск и выбрав "В сети".</span><span class="sxs-lookup"><span data-stu-id="b695f-255">If any of these disks are in offline state try making them online by right-clicking on the disk and click 'Online'</span></span>|
