---
title: "Служба архивации Azure: восстановление файлов и папок из резервной копии виртуальной машины Azure | Документация Майкрософт"
description: "Восстановление файлов из точки восстановления виртуальной машины Azure"
services: backup
documentationcenter: dev-center-name
author: pvrk
manager: shivamg
keywords: "восстановление на уровне элементов; восстановление файлов из резервной копии виртуальной машины Azure; восстановление файлов виртуальной машины Azure"
ms.assetid: f1c067a2-4826-4da4-b97a-c5fd6c189a77
ms.service: backup
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 07/20/2017
ms.author: pullabhk;markgal
ms.openlocfilehash: 1a62a0ed83d61272c032ac0377a54099ed118db4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="recover-files-from-azure-virtual-machine-backup"></a>Восстановление файлов из резервной копии виртуальной машины Azure

Резервное копирование Azure служит hello возможность toorestore [виртуальные машины Azure и диски](./backup-azure-arm-restore-vms.md) из резервных копий виртуальной Машины Azure. В этой статье объясняется, как восстановить из резервной копии виртуальной машины Azure отдельные элементы, такие как файлы и папки.

> [!Note]
> Эта функция доступна для виртуальных машин Azure, развернутых с помощью диспетчера ресурсов модели hello и защищенных tooa хранилище служб восстановления.
> Восстановление файлов из зашифрованной резервной копии виртуальной машины не поддерживается.
>

## <a name="mount-hello-volume-and-copy-files"></a>Подключить тома и скопируйте файлы hello

1. Вход в hello [портал Azure](http://portal.Azure.com). Найти hello соответствующего хранилища служб восстановления и резервного копирования элементов требуется hello.

2. В колонке hello элемента резервного копирования, нажмите кнопку **восстановление файлов**

    ![Открытие архивируемого элемента в хранилище служб восстановления](./media/backup-azure-restore-files-from-vm/open-vault-item.png)

    Hello **восстановления файла** открывает колонку.

    ![Колонка восстановления файлов](./media/backup-azure-restore-files-from-vm/file-recovery-blade.png)

3. Из hello **выберите точку восстановления** раскрывающееся меню, выберите hello точки восстановления, содержащего файлы hello нужный. По умолчанию hello последняя точка восстановления уже выбрана.

4. Нажмите кнопку **загрузить исполняемый файл** (для ВМ Windows Azure) или **загрузить скрипт** (для ВМ Azure Linux) toodownload программного обеспечения hello, вы сможете использовать toocopy файлы из точки восстановления hello.

  Hello исполняемый файл или сценарий создает соединение между локальным компьютером hello и указан hello точки восстановления.

5. Требуется пароль toorun загружаются hello сценарий или исполняемый объект. Можно скопировать из hello портал, используя кнопку копирования hello рядом с полем hello созданный пароль пароль hello

    ![Созданный пароль](./media/backup-azure-restore-files-from-vm/generated-pswd.png)

6. На компьютере hello файлов toorecover hello выполните hello исполняемый файл или сценарий. Это нужно делать от имени администратора. При запуске сценария hello на компьютере с ограниченным доступом, убедитесь, доступ к:

    - download.microsoft.com
    - конечные точки Azure, которые использовались для резервного копирования этой виртуальной машины Azure;
    - исходящий порт 3260.

   Для Linux, сценарий hello требуются компоненты «open-iscsi» и «lshw» точку восстановления toohello tooconnect. Если их не существует на компьютере hello, где она запущена, он запрашивает разрешение tooinstall hello соответствующие компоненты и устанавливает их после согласия.
   
   Введите пароль hello, скопированные из портала hello в ответ на запрос. После ввода пароля hello сценарии hello подключается toohello точки восстановления.
      
    ![Колонка восстановления файлов](./media/backup-azure-restore-files-from-vm/executable-output.png)
    
   
   На любом компьютере с установленными hello одинаковые (или совместимые) операционной системы, как hello резервную копию виртуальной Машины, можно выполнить скрипт hello. В разделе hello [совместимость ОС таблицы](backup-azure-restore-files-from-vm.md#compatible-os) для совместимых операционных системах. Если hello, защищенные Azure виртуальной машины использует дисковые пространства Windows (для ВМ Windows Azure) или Arrays(for Linux VMs) LVM/RAID, то не удается выполнить hello исполняемый файл или сценарий на hello одной виртуальной машине. Вместо этого запустите его на другом компьютере с совместимой операционной системой.

### <a name="compatible-os"></a>Совместимые операционные системы

#### <a name="for-windows"></a>Для Windows

Здравствуйте, следующая таблица отображает hello совместимости между сервером и компьютер операционной системы. Файлы не удастся восстановить на компьютере с несовместимой операционной системой.

|ОС сервера | Совместимые ОС клиента  |
| --------------- | ---- |
| Windows Server 2012 R2 | Windows 8.1 |
| Windows Server 2012    | Windows 8  |
| Windows Server 2008 R2 | Windows 7   |

#### <a name="for-linux"></a>Для Linux

Linux, hello фундаментальные требованием является машины hello, где выполняется сценарий hello, hello операционной системы должен поддерживать hello filesystem объекта hello файлах, присутствующих в hello резервную копию виртуальной Машины с Linux. При выборе сценария hello toorun компьютера, убедитесь, что имеет hello совместимые ОС и hello версии, как описано в следующей таблице hello.

|ОС Linux | Версии  |
| --------------- | ---- |
| Ubuntu | 12.04 и выше |
| CentOS | 6.5 и выше  |
| RHEL | 6.7 и выше |
| Debian | 7 и выше |
| Oracle Linux | 6.4 и выше |

Hello скрипта также требуется python и bash tooexecute компоненты и безопасное подключение toohello точки восстановления.

|Компонент | Версия  |
| --------------- | ---- |
| bash | 4 и выше |
| python | 2.6.6 и выше  |


### <a name="identifying-volumes"></a>Определение томов

#### <a name="for-windows"></a>Для Windows

При запуске исполняемый hello hello операционная система монтирует новые тома hello и назначает буквы дисков. Можно использовать эти диски toobrowse проводника Windows или проводника. Hello буквы дисков, назначенные toohello тома может быть приветствия и те же буквы как hello исходной виртуальной машины, однако hello имя тома сохраняется. Например, если hello томе hello исходная виртуальная машина была «диск данных (E:\)», что том может подключен как «диск данных («Любую букву диска доступных»:\) на локальном компьютере hello. Просмотрите все тома, упомянутые в выходных данных скрипта hello, пока не найдете файлы или папку.  
       
   ![Колонка восстановления файлов](./media/backup-azure-restore-files-from-vm/volumes-attached.png)
           
#### <a name="for-linux"></a>Для Linux

В Linux hello томов hello точки восстановления, подключенных toohello папку, где выполняется сценарий hello. Hello присоединенные диски, тома и соответствующего подключения hello путей отображаются соответствующим образом. Эти подключения пути являются видимыми toousers с доступом на корневом уровне. Просмотрите hello тома, упомянутые в выходных данных скрипта hello.

  ![Колонка восстановления файлов Linux](./media/backup-azure-restore-files-from-vm/linux-mount-paths.png)
  

## <a name="closing-hello-connection"></a>Закрывает соединение hello

После определения файлов hello и копирования их tooa локальное место хранения, удалить или отключить hello дополнительные диски. диски hello toounmount, hello **восстановления файлов** колонки в hello портала Azure щелкните **отключить диски**.

![Отключение дисков](./media/backup-azure-restore-files-from-vm/unmount-disks3.png)

После hello диски отключены, появляется сообщение о том, что она выполнена успешно. Займет toorefresh hello подключение в течение нескольких минут, чтобы вы можете удалить диски hello.

В Linux после точки восстановления toohello hello соединение разрывается, hello ОС hello соответствующие пути подключения автоматического удаления. Они существуют в виде «строк» и они становятся видимыми, но вызывают ошибку, когда вы доступа и запись файлов hello. Их можно удалить вручную. сценарий Hello, при запуске идентифицирует эти тома, существующие из предыдущих точек восстановления и очищает их после согласия.

## <a name="special-configurations"></a>Специальные конфигурации

### <a name="dynamic-disks"></a>Динамические диски

Здравствуйте, если hello виртуальной Машине Azure, которая была создана резервная копия имеет тома, которые охватывают несколько дисков (составные и чередующиеся тома) и/или отказоустойчивые тома (тома, зеркальные и RAID-5) на динамических дисках, то нельзя запустить исполняемый файл скрипта hello на одной виртуальной Машины. Скрипт hello исполняемый файл на другой компьютер с совместимую операционную систему.

### <a name="windows-storage-spaces"></a>Дисковое пространство Windows

Дисковые пространства Windows — это технология, в хранилище Windows, позволяющая toovirtualize хранилища. С помощью дисковых пространств Windows можно сгруппировать отраслевым стандартам дисков в пулы носителей и затем создавать виртуальные диски, вызывается из hello доступное пространство в этих пулах дисковых пространств.

Здравствуйте, если hello виртуальной Машине Azure, которая была создана резервная копия используется дисковые пространства Windows hello исполняемый скрипт нельзя запускать на одной виртуальной Машины. Скрипт hello исполняемый файл на другой компьютер с совместимую операционную систему.

### <a name="lvmraid-arrays"></a>LVM или RAID-массивы

В Linux, диспетчер логических томов (LVM) и/или программного обеспечения RAID-массивов, используется toomanage логические тома на несколько дисков. Если резервное копирование виртуальных Машин Linux hello использует LVM и/или RAID-массивов, нельзя запустить скрипт hello на hello одной виртуальной Машины. Вместо этого запустить сценарий hello на любом компьютере с ОС, совместимых и который поддерживает файловую систему hello, резервная копия виртуальной Машины.

Отображает выходные данные сценария Hello hello LVM и/или RAID-массивов и hello дисков с типом раздела hello, как показано ниже

   ![Колонка выходных данных для LVM в Linux](./media/backup-azure-restore-files-from-vm/linux-LVMOutput.png)
   
Hello следующие команды требуется toobe выполнялись hello пользователя toobring этих секций в оперативный режим. 

**Для разделов LVM**

```
$ pvs <volume name as shown above in hello script output> 
```
Перечисляет имена групп томов hello в физическом диске.

```
$ lvdisplay <volume-group-name from hello pvs command’s results> 
```
Эта команда выводит все логические тома, имена и их пути в группе томов.

```
$ mount <LV path> </mountpath>
```
toomount hello путь toohello логические тома по своему усмотрению.


**Для RAID-массивов**

```
$ mdadm –detail –scan
```
Эта команда отображает сведения о всех дисках RAID. Hello соответствующие RAID-диск будет отображаться в виде`/dev/mdm/<RAID array name in hello backed up VM>`

Используйте команды mount hello, если диск RAID hello содержит физических томов.
```
$ mount [RAID Disk Path] [/mounthpath]
```

Если этот диск RAID имеет другой LVM, настроенные в нем затем следовать hello же процедуры, как описано выше для секций LVM с именем тома hello, имя диска RAID hello

## <a name="troubleshooting"></a>Устранение неполадок

Если возникают проблемы при восстановлении файлов из виртуальных машин hello, проверьте hello в следующей таблице для получения дополнительных сведений.

| Сообщение об ошибке или ситуация | Возможные причины | Рекомендуемое действие |
| ------------------------ | -------------- | ------------------ |
| Выходной EXE-файла: *подключение целевого toohello исключение* |Скрипт не является точкой восстановления может tooaccess hello | Проверьте ли hello компьютер соответствует требованиям доступа hello, упомянутых выше|  
|   Выходной EXE-файла: *целевой hello уже были записаны в через сеанс ISCSI.* |   Hello скрипт уже был выполнен на приветствия присоединения того же компьютера и hello дисков |   Hello тома точки восстановления hello уже подключен. Они не может выполнить операцию с hello же буквы для диска hello исходной виртуальной Машины. Просмотр всех доступных томов hello в проводнике hello файла |
| Выходной EXE-файла: *этот скрипт является недопустимым, поскольку отсоединить диски hello через hello портала или превышено ограничение 12-hr. Загрузите новый сценарий с портала hello.* |    отсоединить Hello диски с портала hello или превышено предельное число 12 ч hello |  Эта копия исполняемого файла больше недействительна, и использовать ее нельзя. Если вы хотите tooaccess hello файлы, восстановление в момент, посетите портал hello для нового exe-файла|
| На компьютере hello, где запускается hello exe: hello новые тома не отключаются после hello Отключение кнопки |    Hello инициатора ISCSI на компьютере hello не отвечать на запросы и обновление его цель toohello подключения и обслуживание кэша hello |    Подождите несколько минут, после нажатия кнопки dismount hello. Если по-прежнему hello новые тома не отключены, просмотрите через все тома hello. Принудительно, hello инициатора toorefresh hello соединения и hello размонтируется с сообщением об ошибке, hello диск недоступен|
| Выходной EXE-файла: сценарий выполняется успешно, но «Подключенных нового тома» не отображается в выходных данных скрипта hello |   Это временная проблема   | Hello томов будет уже присоединены. Откройте обозреватель toobrowse. При использовании hello же компьютер для выполнения скриптов, каждый раз, рекомендуется перезагрузить компьютер hello и следует отображать список hello hello exe последующих запусках. |
| Linux определенного: не удается tooview hello требуемого тома | Hello ОС машины hello, где выполняется сценарий hello может не распознать hello базовой файловую систему hello, резервная копия виртуальной Машины | Проверьте, является ли точка восстановления hello аварийных согласованием или совместимые в файлами. Если скрипт hello согласованной, запустите файл на другой компьютер, операционная система распознает hello резервная копия файловой системы для Виртуальной машины |
| Windows для конкретной: не удается tooview hello требуемого тома | диски Hello был присоединен, но hello томов не были настроены | В панели управления диска hello идентификации точки восстановления связанных toohello hello дополнительные диски. Если любой из этих дисков находится в автономном режиме состояния попробуйте сделать их через Интернет, щелкнув правой кнопкой мыши на диске hello и нажмите кнопку «Работает»|
