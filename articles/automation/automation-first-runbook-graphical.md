---
title: "Создание графического модуля Runbook в службе автоматизации Azure | Документация Майкрософт"
description: "Учебник, в котором описывается создание, тестирование и публикация простого графического модуля Runbook."
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: 
keywords: "Runbook, шаблон Runbook, служба автоматизации Runbook и Azure Runbook"
ms.assetid: dcb88f19-ed2b-4372-9724-6625cd287c8a
ms.service: automation
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 05/17/2017
ms.author: magoedte;bwren
ms.openlocfilehash: 9d4b28416376482247127698bec7c99b83308885
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="my-first-graphical-runbook"></a><span data-ttu-id="ddcf9-104">Первый графический Runbook</span><span class="sxs-lookup"><span data-stu-id="ddcf9-104">My first graphical runbook</span></span>

> [!div class="op_single_selector"]
> * [<span data-ttu-id="ddcf9-105">Графический</span><span class="sxs-lookup"><span data-stu-id="ddcf9-105">Graphical</span></span>](automation-first-runbook-graphical.md)
> * [<span data-ttu-id="ddcf9-106">PowerShell</span><span class="sxs-lookup"><span data-stu-id="ddcf9-106">PowerShell</span></span>](automation-first-runbook-textual-powershell.md)
> * [<span data-ttu-id="ddcf9-107">Рабочий процесс PowerShell</span><span class="sxs-lookup"><span data-stu-id="ddcf9-107">PowerShell Workflow</span></span>](automation-first-runbook-textual.md)
> 
> 

<span data-ttu-id="ddcf9-108">В данном учебнике описана процедура создания [графического модуля Runbook](automation-runbook-types.md#graphical-runbooks) в службе автоматизации Azure.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-108">This tutorial walks you through the creation of a [graphical runbook](automation-runbook-types.md#graphical-runbooks) in Azure Automation.</span></span>  <span data-ttu-id="ddcf9-109">Для начала мы протестируем и опубликуем простой модуль runbook и расскажем, как отслеживать состояние его заданий.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-109">We start with a simple runbook that tests and publishes while we explain how to track the status of the runbook job.</span></span>  <span data-ttu-id="ddcf9-110">Затем мы изменим модуль runbook, настроив его на фактическое управление ресурсами Azure (в нашем примере это запуск виртуальной машины Azure).</span><span class="sxs-lookup"><span data-stu-id="ddcf9-110">Then we modify the runbook to actually manage Azure resources, in this case starting an Azure virtual machine.</span></span>  <span data-ttu-id="ddcf9-111">Затем мы завершим работу с руководством, повысив надежность браузера, а также добавив параметры Runbook и условные ссылки.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-111">Then we complete the tutorial by making the runbook more robust by adding runbook parameters and conditional links.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="ddcf9-112">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="ddcf9-112">Prerequisites</span></span>
<span data-ttu-id="ddcf9-113">Для работы с этим учебником необходимо следующее.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-113">To complete this tutorial, you will need the following.</span></span>

* <span data-ttu-id="ddcf9-114">Подписка Azure.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-114">Azure subscription.</span></span>  <span data-ttu-id="ddcf9-115">Если у вас ее нет, [активируйте преимущества для подписчиков MSDN](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) или <a href="/pricing/free-account/" target="_blank">[зарегистрируйте бесплатную учетную запись](https://azure.microsoft.com/free/).</span><span class="sxs-lookup"><span data-stu-id="ddcf9-115">If you don't have one yet, you can [activate your MSDN subscriber benefits](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) or <a href="/pricing/free-account/" target="_blank">[sign up for a free account](https://azure.microsoft.com/free/).</span></span>
* <span data-ttu-id="ddcf9-116">[Учетная запись службы автоматизации Azure](automation-sec-configure-azure-runas-account.md) для хранения модуля Runbook и выполнения проверки подлинности ресурсов Azure.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-116">[Azure Automation account](automation-sec-configure-azure-runas-account.md) to hold the runbook and authenticate to Azure resources.</span></span>  <span data-ttu-id="ddcf9-117">Эта учетная запись должна иметь разрешение на запуск и остановку виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-117">This account must have permission to start and stop the virtual machine.</span></span>
* <span data-ttu-id="ddcf9-118">Виртуальная машина Azure.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-118">An Azure virtual machine.</span></span>  <span data-ttu-id="ddcf9-119">Это не должна быть рабочая машина, поскольку в процессе изучения данного материала ее нужно будет остановить и запустить заново.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-119">We will stop and start this machine so it should not be production.</span></span>

## <a name="step-1---create-runbook"></a><span data-ttu-id="ddcf9-120">Шаг 1. Создание нового модуля Runbook</span><span class="sxs-lookup"><span data-stu-id="ddcf9-120">Step 1 - Create runbook</span></span>
<span data-ttu-id="ddcf9-121">Для начала мы создадим простой модуль Runbook, выводящий на экран текст *Hello World*.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-121">We start by creating a simple runbook that outputs the text *Hello World*.</span></span>

1. <span data-ttu-id="ddcf9-122">На портале Azure выберите свою учетную запись службы автоматизации.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-122">In the Azure portal, open your Automation account.</span></span>  
   <span data-ttu-id="ddcf9-123">Страница учетной записи в службе автоматизации позволяет быстро получить представление о ресурсах, доступных в этой учетной записи.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-123">The Automation account page gives you a quick view of the resources in this account.</span></span>  <span data-ttu-id="ddcf9-124">Некоторые ресурсы уже должны быть доступны.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-124">You should already have some Assets.</span></span>  <span data-ttu-id="ddcf9-125">Большинство из них — это модули, которые добавляются в каждую новую учетную запись в службе автоматизации по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-125">Most of those are the modules that are automatically included in a new Automation account.</span></span>  <span data-ttu-id="ddcf9-126">Кроме того, вам потребуется ресурс учетных данных, упомянутый в [предварительных требованиях](#prerequisites).</span><span class="sxs-lookup"><span data-stu-id="ddcf9-126">You should also have the Credential asset that's mentioned in the [prerequisites](#prerequisites).</span></span>
2. <span data-ttu-id="ddcf9-127">Щелкните элемент **Модули Runbook** , чтобы открыть список модулей Runbook.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-127">Click the **Runbooks** tile to open the list of runbooks.</span></span><br> <span data-ttu-id="ddcf9-128">![Элемент управления "Модули Runbook"](media/automation-first-runbook-graphical/runbooks-resources-tile.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-128">![Runbooks control](media/automation-first-runbook-graphical/runbooks-resources-tile.png)</span></span>
3. <span data-ttu-id="ddcf9-129">Создайте новый модуль Runbook. Для этого нажмите кнопку **Add a runbook** (Добавить модуль Runbook), а затем выберите **Создать новый Runbook**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-129">Create a new runbook by clicking on the **Add a runbook** button and then **Create a new runbook**.</span></span>
4. <span data-ttu-id="ddcf9-130">Присвойте модулю Runbook имя *MyFirstRunbook-Graphical*.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-130">Give the runbook the name *MyFirstRunbook-Graphical*.</span></span>
5. <span data-ttu-id="ddcf9-131">В этом примере создается [графический модуль Runbook](automation-graphical-authoring-intro.md), поэтому в поле **Runbook type** (Тип Runbook) выберите значение **Графический**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-131">In this case, we're going to create a [graphical runbook](automation-graphical-authoring-intro.md) so select **Graphical** for **Runbook type**.</span></span><br> <span data-ttu-id="ddcf9-132">![Новый Runbook](media/automation-first-runbook-graphical/create-new-runbook.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-132">![New runbook](media/automation-first-runbook-graphical/create-new-runbook.png)</span></span><br>
6. <span data-ttu-id="ddcf9-133">Щелкните **Создать** , чтобы создать модуль Runbook и открыть графический редактор.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-133">Click **Create** to create the runbook and open the graphical editor.</span></span>

## <a name="step-2---add-activities-to-the-runbook"></a><span data-ttu-id="ddcf9-134">Шаг 2. Добавление действий в модуль Runbook</span><span class="sxs-lookup"><span data-stu-id="ddcf9-134">Step 2 - Add activities to the runbook</span></span>
<span data-ttu-id="ddcf9-135">Элемент управления "Библиотека" в левой части редактора позволяет добавлять действия в модуль Runbook.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-135">The Library control on the left side of the editor allows you to select activities to add to your runbook.</span></span>  <span data-ttu-id="ddcf9-136">Добавим командлет **Write-Output** для вывода текста из модуля Runbook.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-136">We're going to add a **Write-Output** cmdlet to output text from the runbook.</span></span>

1. <span data-ttu-id="ddcf9-137">В элементе управления "Библиотека" щелкните текстовое поле поиска и введите **Write-Output**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-137">In the Library control, click in the search textbox and type **Write-Output**.</span></span>  <span data-ttu-id="ddcf9-138">Результаты поиска будут отображены ниже.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-138">The search results will be displayed below.</span></span> <br> <span data-ttu-id="ddcf9-139">![Microsoft.PowerShell.Utility](media/automation-first-runbook-graphical/search-powershell-cmdlet-writeoutput.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-139">![Microsoft.PowerShell.Utility](media/automation-first-runbook-graphical/search-powershell-cmdlet-writeoutput.png)</span></span>
2. <span data-ttu-id="ddcf9-140">Прокрутите список до конца.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-140">Scroll down to the bottom of the list.</span></span>  <span data-ttu-id="ddcf9-141">Щелкните правой кнопкой мыши **Write-Output** и выберите пункт **Добавить на холст** или же щелкните значок многоточия рядом с командлетом и выберите пункт **Добавить на холст**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-141">You can either right-click **Write-Output** and select **Add to canvas** or click the ellipse next to the cmdlet and then select **Add to canvas**.</span></span>
3. <span data-ttu-id="ddcf9-142">Щелкните **Write-Output** на холсте.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-142">Click the **Write-Output** activity on the canvas.</span></span>  <span data-ttu-id="ddcf9-143">Откроется колонка управления конфигурацией, где можно настроить выбранное действие.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-143">This opens the Configuration control blade, which allows you to configure the activity.</span></span>
4. <span data-ttu-id="ddcf9-144">В поле **Метка** по умолчанию указывается имя командлета, но можно указать и более понятное название.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-144">The **Label** defaults to the name of the cmdlet, but we can change it to something more friendly.</span></span> <span data-ttu-id="ddcf9-145">Введите в это поле значение *Вывод текста "Привет, мир!"*.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-145">Change it to *Write Hello World to output*.</span></span>
5. <span data-ttu-id="ddcf9-146">Щелкните **Параметры**, чтобы указать значения параметров командлета.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-146">Click **Parameters** to provide values for the cmdlet's parameters.</span></span>  
   <span data-ttu-id="ddcf9-147">Некоторые командлеты имеют несколько наборов параметров, и вам нужно выбрать, какой из них будет использоваться.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-147">Some cmdlets have multiple parameter sets, and you need to select which you one to use.</span></span> <span data-ttu-id="ddcf9-148">В этом случае командлет **Write-Output** имеет только один набор параметров, поэтому выбор делать не нужно.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-148">In this case, **Write-Output** has only one parameter set, so you don't need to select one.</span></span> <br> <span data-ttu-id="ddcf9-149">![Свойства командлета Write-Output](media/automation-first-runbook-graphical/write-output-properties-b.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-149">![Write-Output properties](media/automation-first-runbook-graphical/write-output-properties-b.png)</span></span>
6. <span data-ttu-id="ddcf9-150">Выберите параметр **InputObject** .</span><span class="sxs-lookup"><span data-stu-id="ddcf9-150">Select the **InputObject** parameter.</span></span>  <span data-ttu-id="ddcf9-151">В этом параметре мы указываем текст для отправки в поток выходных данных.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-151">This is the parameter where we specify the text to send to the output stream.</span></span>
7. <span data-ttu-id="ddcf9-152">В раскрывающемся списке **Источник данных** выберите **PowerShell expression** (Выражение PowerShell).</span><span class="sxs-lookup"><span data-stu-id="ddcf9-152">In the **Data source** dropdown, select **PowerShell expression**.</span></span>  <span data-ttu-id="ddcf9-153">Раскрывающийся список **Источник данных** содержит разные источники, которые можно использовать для заполнения значения параметра.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-153">The **Data source** dropdown provides different sources that you use to populate a parameter value.</span></span>  
   <span data-ttu-id="ddcf9-154">Можно использовать выходные данные из таких источников, как другое действие, ресурс автоматизации или выражение PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-154">You can use output from such sources such as another activity, an Automation asset, or a PowerShell expression.</span></span>  <span data-ttu-id="ddcf9-155">В этом случае нам нужно вывести только текст *Привет, мир*.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-155">In this case, we just want to output the text *Hello World*.</span></span> <span data-ttu-id="ddcf9-156">Для этого мы воспользуемся выражением PowerShell и укажем строку.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-156">We can use a PowerShell expression and specify a string.</span></span>
8. <span data-ttu-id="ddcf9-157">В поле **Выражение** введите *Привет, мир* и дважды нажмите кнопку **ОК**, чтобы вернуться к холсту.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-157">In the **Expression** box, type *"Hello World"* and then click **OK** twice to return to the canvas.</span></span><br> <span data-ttu-id="ddcf9-158">![PowerShell Expression](media/automation-first-runbook-graphical/expression-hello-world.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-158">![PowerShell Expression](media/automation-first-runbook-graphical/expression-hello-world.png)</span></span>
9. <span data-ttu-id="ddcf9-159">Сохраните модуль Runbook, щелкнув **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-159">Save the runbook by clicking **Save**.</span></span><br> <span data-ttu-id="ddcf9-160">![Сохранить Runbook](media/automation-first-runbook-graphical/runbook-toolbar-save-revised20165.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-160">![Save runbook](media/automation-first-runbook-graphical/runbook-toolbar-save-revised20165.png)</span></span>

## <a name="step-3---test-the-runbook"></a><span data-ttu-id="ddcf9-161">Шаг 3. Тестирование модуля Runbook</span><span class="sxs-lookup"><span data-stu-id="ddcf9-161">Step 3 - Test the runbook</span></span>
<span data-ttu-id="ddcf9-162">Прежде чем опубликовать модуль Runbook и, таким образом, сделать его доступным для рабочей среды, необходимо проверить, нормально ли он работает.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-162">Before we publish the runbook to make it available in production, we want to test it to make sure that it works properly.</span></span>  <span data-ttu-id="ddcf9-163">Чтобы протестировать модуль Runbook, нужно запустить его **черновую** версию и проверить его работу в интерактивном режиме.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-163">When you test a runbook, you run its **Draft** version and view its output interactively.</span></span>

1. <span data-ttu-id="ddcf9-164">Щелкните **Test pane** (Тестовая область), чтобы открыть колонку "Тестирование".</span><span class="sxs-lookup"><span data-stu-id="ddcf9-164">Click **Test pane** to open the Test blade.</span></span><br> <span data-ttu-id="ddcf9-165">![Область тестирования](media/automation-first-runbook-graphical/runbook-toolbar-test-revised20165.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-165">![Test pane](media/automation-first-runbook-graphical/runbook-toolbar-test-revised20165.png)</span></span>
2. <span data-ttu-id="ddcf9-166">Щелкните **Пуск** , чтобы начать тестирование.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-166">Click **Start** to start the test.</span></span>  <span data-ttu-id="ddcf9-167">Активным должен быть только этот параметр.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-167">This should be the only enabled option.</span></span>
3. <span data-ttu-id="ddcf9-168">При этом создается объект [Задание Runbook](automation-runbook-execution.md) , а его состояние отображается на панели.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-168">A [runbook job](automation-runbook-execution.md) is created and its status displayed in the pane.</span></span>  
   <span data-ttu-id="ddcf9-169">Сначала задание получает состояние *В очереди*, которое означает, что задание стало доступно рабочей роли runbook в облаке.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-169">The job status starts as *Queued* indicating that it is waiting for a runbook worker in the cloud to become available.</span></span>  <span data-ttu-id="ddcf9-170">Как только рабочая роль затребует задание, оно получит состояние *Запущено*, а с началом фактического выполнения модуля Runbook — состояние *Выполняется*.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-170">It then moves to *Starting* when a worker claims the job, and then *Running* when the runbook actually starts running.</span></span>  
4. <span data-ttu-id="ddcf9-171">Когда задание модуля Runbook будет выполнено, на экране появится результат.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-171">When the runbook job completes, its output is displayed.</span></span> <span data-ttu-id="ddcf9-172">В нашем случае это должен быть текст *Привет, мир!*.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-172">In our case, we should see *Hello World*.</span></span><br> <span data-ttu-id="ddcf9-173">![Привет, мир!](media/automation-first-runbook-graphical/runbook-test-results.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-173">![Hello World](media/automation-first-runbook-graphical/runbook-test-results.png)</span></span>
5. <span data-ttu-id="ddcf9-174">Закройте колонку "Тест", чтобы вернуться на холст.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-174">Close the Test blade to return to the canvas.</span></span>

## <a name="step-4---publish-and-start-the-runbook"></a><span data-ttu-id="ddcf9-175">Шаг 4. Публикация и запуск модуля Runbook</span><span class="sxs-lookup"><span data-stu-id="ddcf9-175">Step 4 - Publish and start the runbook</span></span>
<span data-ttu-id="ddcf9-176">Модуль runbook, который мы только что создали, все еще находится в режиме черновика.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-176">The runbook that we created is still in Draft mode.</span></span> <span data-ttu-id="ddcf9-177">Прежде чем запустить модуль в рабочей среде, его нужно опубликовать.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-177">We need to publish it before we can run it in production.</span></span>  <span data-ttu-id="ddcf9-178">При публикации модуля Runbook существующая опубликованная версия перезаписывается черновой версией.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-178">When you publish a runbook, you overwrite the existing Published version with the Draft version.</span></span>  <span data-ttu-id="ddcf9-179">В нашем случае опубликованной версии не существует, поскольку Runbook был создан только что.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-179">In our case, we don't have a Published version yet because we just created the runbook.</span></span>

1. <span data-ttu-id="ddcf9-180">Щелкните **Опубликовать**, чтобы опубликовать модуль Runbook, а затем нажмите кнопку **Да** в появившемся запросе.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-180">Click **Publish** to publish the runbook and then **Yes** when prompted.</span></span><br> <span data-ttu-id="ddcf9-181">![Опубликовать](media/automation-first-runbook-graphical/runbook-toolbar-publish-revised20166.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-181">![Publish](media/automation-first-runbook-graphical/runbook-toolbar-publish-revised20166.png)</span></span>
2. <span data-ttu-id="ddcf9-182">Прокрутите экран влево. В колонке **Модули Runbook** для параметра **Состояние создания** модуля должно отображаться значение **Опубликовано**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-182">If you scroll left to view the runbook in the **Runbooks** blade, it shows an **Authoring Status** of **Published**.</span></span>
3. <span data-ttu-id="ddcf9-183">Прокрутите экран вправо до колонки **MyFirstRunbook**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-183">Scroll back to the right to view the blade for **MyFirstRunbook**.</span></span>  
   <span data-ttu-id="ddcf9-184">Параметры в верхней части экрана позволяют запустить модуль Runbook, запланировать его запуск в определенное время или создать [Webhook](automation-webhooks.md) , чтобы модуль можно было запускать с помощью HTTP-вызова.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-184">The options across the top allow us to start the runbook, schedule it to start at some time in the future, or create a [webhook](automation-webhooks.md) so it can be started through an HTTP call.</span></span>
4. <span data-ttu-id="ddcf9-185">Нам нужно только запустить модуль Runbook, поэтому щелкните **Пуск**, а затем нажмите кнопку **Да** в появившемся запросе.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-185">We just want to start the runbook so click **Start** and then **Yes** when prompted.</span></span><br> <span data-ttu-id="ddcf9-186">![Запуск модуля Runbook](media/automation-first-runbook-graphical/runbook-controls-start-revised20165.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-186">![Start runbook](media/automation-first-runbook-graphical/runbook-controls-start-revised20165.png)</span></span>
5. <span data-ttu-id="ddcf9-187">Откроется колонка заданий с созданным заданием Runbook.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-187">A job blade is opened for the runbook job that we created.</span></span>  <span data-ttu-id="ddcf9-188">Эту колонку можно закрыть, но мы пока оставим ее открытой, чтобы проследить за выполнением задания.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-188">We can close this blade, but in this case we leave it open so we can watch the job's progress.</span></span>
6. <span data-ttu-id="ddcf9-189">Состояние задания отображается в поле **Сводка по заданию** и отражает состояния, которые мы наблюдали при тестировании модуля Runbook.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-189">The job status is shown in **Job Summary** and matches the statuses that we saw when we tested the runbook.</span></span><br> <span data-ttu-id="ddcf9-190">![Сводные данные задания](media/automation-first-runbook-graphical/runbook-job-summary.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-190">![Job Summary](media/automation-first-runbook-graphical/runbook-job-summary.png)</span></span>
7. <span data-ttu-id="ddcf9-191">Как только состояние модуля Runbook изменится на *Выполнено*, щелкните **Выходные данные**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-191">Once the runbook status shows *Completed*, click **Output**.</span></span> <span data-ttu-id="ddcf9-192">Откроется колонка **Выходные данные** с текстом *Привет, мир*.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-192">The **Output** blade is opened, and we can see our *Hello World* in the pane.</span></span><br> <span data-ttu-id="ddcf9-193">![Сводные данные задания](media/automation-first-runbook-graphical/runbook-job-output.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-193">![Job Summary](media/automation-first-runbook-graphical/runbook-job-output.png)</span></span>  
8. <span data-ttu-id="ddcf9-194">Закройте колонку выходных данных.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-194">Close the Output blade.</span></span>
9. <span data-ttu-id="ddcf9-195">Щелкните **Все журналы** , чтобы открыть колонку "Потоки" для задания Runbook.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-195">Click **All Logs** to open the Streams blade for the runbook job.</span></span>  <span data-ttu-id="ddcf9-196">В потоке выходных данных должен отображаться только текст *Hello World* , но могут присутствовать и другие потоки заданий Runbook, например "Подробные сведения" и "Ошибка", если Runbook записывает в них какие-то данные.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-196">We should only see *Hello World* in the output stream, but this can show other streams for a runbook job such as Verbose and Error if the runbook writes to them.</span></span><br> <span data-ttu-id="ddcf9-197">![Сводные данные задания](media/automation-first-runbook-graphical/runbook-job-AllLogs.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-197">![Job Summary](media/automation-first-runbook-graphical/runbook-job-AllLogs.png)</span></span>
10. <span data-ttu-id="ddcf9-198">Закройте колонки "Все журналы" и "Задания", чтобы вернуться к колонке MyFirstRunbook.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-198">Close the All Logs blade and the Job blade to return to the MyFirstRunbook blade.</span></span>
11. <span data-ttu-id="ddcf9-199">Щелкните **Задания** , чтобы открыть колонку "Задания" для этого модуля.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-199">Click **Jobs** to open the Jobs blade for this runbook.</span></span>  <span data-ttu-id="ddcf9-200">Откроется список всех заданий, созданных этим модулем Runbook.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-200">This lists all the jobs created by this runbook.</span></span> <span data-ttu-id="ddcf9-201">В нем должно быть только одно задание, так как мы запускали задание только один раз.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-201">We should only see one job listed since we only ran the job once.</span></span><br> <span data-ttu-id="ddcf9-202">![Задания](media/automation-first-runbook-graphical/runbook-control-jobs.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-202">![Jobs](media/automation-first-runbook-graphical/runbook-control-jobs.png)</span></span>
12. <span data-ttu-id="ddcf9-203">Если щелкнуть это задание, откроется та же область заданий, которую мы видели при запуске модуля runbook.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-203">You can click this job to open the same Job pane that we viewed when we started the runbook.</span></span>  <span data-ttu-id="ddcf9-204">С ее помощью можно вернуться назад и просмотреть сведения о любом задании, созданном для конкретного модуля Runbook.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-204">This allows you to go back in time and view the details of any job that was created for a particular runbook.</span></span>

## <a name="step-5---create-variable-assets"></a><span data-ttu-id="ddcf9-205">Шаг 5. Создание ресурсов для переменных</span><span class="sxs-lookup"><span data-stu-id="ddcf9-205">Step 5 - Create variable assets</span></span>
<span data-ttu-id="ddcf9-206">Мы протестировали и опубликовали свой модуль Runbook, но пока он не выполняет никаких полезных действий.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-206">We've tested and published our runbook, but so far it doesn't do anything useful.</span></span> <span data-ttu-id="ddcf9-207">Нам нужно, чтобы он управлял ресурсами Azure.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-207">We want to have it manage Azure resources.</span></span>  <span data-ttu-id="ddcf9-208">Перед тем как настроить проверку подлинности модуля Runbook, мы создадим переменную и сохраним в ней идентификатор подписки. На эту переменную мы будем ссылаться при настройке действия для проверки подлинности (см. шаг 6).</span><span class="sxs-lookup"><span data-stu-id="ddcf9-208">Before we configure the runbook to authenticate, we  create a variable to hold the subscription ID and reference it after we set up the activity to authenticate in step 6 below.</span></span>  <span data-ttu-id="ddcf9-209">Добавив ссылку в контекст подписки, вы сможете легко работать с несколькими подписками.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-209">Including a reference to the subscription context allows you to easily work between multiple subscriptions.</span></span>  <span data-ttu-id="ddcf9-210">Прежде чем продолжить, скопируйте идентификатор подписки из элемента "Подписки" в области навигации.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-210">Before proceeding, copy your subscription ID from the Subscriptions option off the Navigation pane.</span></span>  

1. <span data-ttu-id="ddcf9-211">В колонке "Учетные записи службы автоматизации" щелкните элемент **Ресурсы**, после чего откроется колонка **Ресурсы**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-211">In the Automation Accounts blade, click the **Assets** tile and the **Assets** blade is opened.</span></span>
2. <span data-ttu-id="ddcf9-212">В колонке "Ресурсы" щелкните элемент **Переменные**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-212">In the Assets blade, click the **Variables** tile.</span></span>
3. <span data-ttu-id="ddcf9-213">В колонке "Переменные" щелкните **Добавить переменную**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-213">On the Variables blade, click **Add a variable**.</span></span><br><span data-ttu-id="ddcf9-214">![Переменная службы автоматизации](media/automation-first-runbook-graphical/create-new-subscriptionid-variable.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-214">![Automation Variable](media/automation-first-runbook-graphical/create-new-subscriptionid-variable.png)</span></span>
4. <span data-ttu-id="ddcf9-215">В колонке "Создание переменной" введите в поле **Имя** значение **AzureSubscriptionId**, а в поле **Значение** — свой идентификатор подписки.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-215">In the New variable blade, in the **Name** box, enter **AzureSubscriptionId** and in the **Value** box enter your Subscription ID.</span></span>  <span data-ttu-id="ddcf9-216">Для параметра **Тип** укажите значение *Строка*, а для параметра **Шифрование** используйте значение по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-216">Keep *string* for the **Type** and the default value for **Encryption**.</span></span>  
5. <span data-ttu-id="ddcf9-217">Щелкните **Создать** , чтобы создать переменную.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-217">Click **Create** to create the variable.</span></span>  

## <a name="step-6---add-authentication-to-manage-azure-resources"></a><span data-ttu-id="ddcf9-218">Шаг 6. Добавление проверки подлинности для управления ресурсами Azure</span><span class="sxs-lookup"><span data-stu-id="ddcf9-218">Step 6 - Add authentication to manage Azure resources</span></span>
<span data-ttu-id="ddcf9-219">Теперь, когда есть переменная, содержащая идентификатор подписки, можно настроить модуль Runbook для выполнения проверки подлинности, используя учетные данные запуска от имени, которые указаны в разделе [Предварительные требования](#prerequisites).</span><span class="sxs-lookup"><span data-stu-id="ddcf9-219">Now that we have a variable to hold our subscription ID, we can configure our runbook to authenticate with the Run As credentials that are referred to in the [prerequisites](#prerequisites).</span></span>  <span data-ttu-id="ddcf9-220">Для этого необходимо добавить на холст командлет **Add-AzureRMAccount** и **ресурс** подключения учетной записи запуска от имени Azure.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-220">We do that by adding the Azure Run As connection **Asset** and **Add-AzureRMAccount** cmdlet to the canvas.</span></span>  

1. <span data-ttu-id="ddcf9-221">Откройте графический редактор, щелкнув **Изменить** в колонке MyFirstRunbook.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-221">Open the graphical editor by clicking **Edit** on the MyFirstRunbook blade.</span></span><br> <span data-ttu-id="ddcf9-222">![Изменить Runbook](media/automation-first-runbook-graphical/runbook-controls-edit-revised20165.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-222">![Edit runbook](media/automation-first-runbook-graphical/runbook-controls-edit-revised20165.png)</span></span>
2. <span data-ttu-id="ddcf9-223">Так как название **Вывод текста Hello World** больше не нужно, щелкните его правой кнопкой мыши и выберите **Удалить**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-223">We don't need the **Write Hello World to output** anymore, so right-click it and select **Delete**.</span></span>
3. <span data-ttu-id="ddcf9-224">В элементе управления "Библиотека" разверните узел **Подключения** и добавьте на холст элемент **AzureRunAsConnection**, выбрав **Add to canvas** (Добавить на холст).</span><span class="sxs-lookup"><span data-stu-id="ddcf9-224">In the Library control, expand **Connections** and add **AzureRunAsConnection** to the canvas by selecting **Add to canvas**.</span></span>
4. <span data-ttu-id="ddcf9-225">На холсте выберите **AzureRunAsConnection** и в области управления конфигурацией в текстовое поле **Метка** введите текст **Получить подключение запуска от имени**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-225">On the canvas, select **AzureRunAsConnection** and in the Configuration control pane, type **Get Run As Connection** in the **Label** textbox.</span></span>  <span data-ttu-id="ddcf9-226">Так вы получите нужное подключение.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-226">This is the connection</span></span>
5. <span data-ttu-id="ddcf9-227">В элементе управления "Библиотека" в поле поиска введите текст **Add-AzureRmAccount** .</span><span class="sxs-lookup"><span data-stu-id="ddcf9-227">In the Library control, type **Add-AzureRmAccount** in the search textbox.</span></span>
6. <span data-ttu-id="ddcf9-228">Добавьте на холст командлет **Добавьте на холст командлет-AzureRmAccount** .</span><span class="sxs-lookup"><span data-stu-id="ddcf9-228">Add **Add-AzureRmAccount** to the canvas.</span></span><br> <span data-ttu-id="ddcf9-229">![ресурс](media/automation-first-runbook-graphical/search-powershell-cmdlet-addazurermaccount.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-229">![Add-AzureRMAccount](media/automation-first-runbook-graphical/search-powershell-cmdlet-addazurermaccount.png)</span></span>
7. <span data-ttu-id="ddcf9-230">Наведите указатель мыши на элемент **Get Run As Connection** (Получить подключение запуска от имени), чтобы в нижней части элемента появился кружок.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-230">Hover over **Get Run As Connection** until a circle appears on the bottom of the shape.</span></span> <span data-ttu-id="ddcf9-231">Щелкните этот кружок и перетащите стрелку к элементу **Add-AzureRmAccount**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-231">Click the circle and drag the arrow to **Add-AzureRmAccount**.</span></span>  <span data-ttu-id="ddcf9-232">Созданная стрелка является *связью*.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-232">The arrow that you created is a *link*.</span></span>  <span data-ttu-id="ddcf9-233">При запуске этот модуль Runbook выполнит действие **Get Run As Connection** (Получить подключение запуска от имени), а затем — командлет **Add-AzureRmAccount**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-233">The runbook starts with **Get Run As Connection** and then run **Add-AzureRmAccount**.</span></span><br> <span data-ttu-id="ddcf9-234">![Создание связи между действиями](media/automation-first-runbook-graphical/runbook-link-auth-activities.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-234">![Create link between activities](media/automation-first-runbook-graphical/runbook-link-auth-activities.png)</span></span>
8. <span data-ttu-id="ddcf9-235">На холсте выберите элемент **Add-AzureRmAccount** и в области управления конфигурацией в текстовое поле **Метка** введите текст **Выполнить вход в Azure**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-235">On the canvas, select **Add-AzureRmAccount** and in the Configuration control pane type **Login to Azure** in the **Label** textbox.</span></span>
9. <span data-ttu-id="ddcf9-236">Щелкните **Параметры** , чтобы открыть колонку "Конфигурация параметров действия".</span><span class="sxs-lookup"><span data-stu-id="ddcf9-236">Click **Parameters** and the Activity Parameter Configuration blade appears.</span></span>
10. <span data-ttu-id="ddcf9-237">Командлет **Add-AzureRmAccount** имеет несколько наборов параметров. Нужно выбрать один из них, прежде чем вводить значения параметров.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-237">**Add-AzureRmAccount** has multiple parameter sets, so we need to select one before we can provide parameter values.</span></span>  <span data-ttu-id="ddcf9-238">Щелкните **Набор параметров** и выберите набор параметров **ServicePrincipalCertificatewithSubscriptionId**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-238">Click **Parameter Set** and then select the **ServicePrincipalCertificatewithSubscriptionId** parameter set.</span></span>
11. <span data-ttu-id="ddcf9-239">Параметры из выбранного набора появятся в колонке конфигурации параметров действия.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-239">Once you select the parameter set, the parameters are displayed in the Activity Parameter Configuration blade.</span></span>  <span data-ttu-id="ddcf9-240">Щелкните **APPLICATIONID**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-240">Click **APPLICATIONID**.</span></span><br> <span data-ttu-id="ddcf9-241">![Добавление параметров учетной записи Azure RM](media/automation-first-runbook-graphical/add-azurermaccount-params.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-241">![Add Azure RM account parameters](media/automation-first-runbook-graphical/add-azurermaccount-params.png)</span></span>
12. <span data-ttu-id="ddcf9-242">В колонке "Значение параметра" выберите для параметра **Источник данных** значение **Activity output** (Выходные данные действия), в списке выберите **Get Run As Connection** (Получить подключение запуска от имени), в текстовом поле **Field path** (Путь к полю) введите текст **ApplicationId**, а затем нажмите кнопку **OК**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-242">In the Parameter Value blade, select **Activity output** for the **Data source** and select **Get Run As Connection** from the list, in the **Field path** textbox type **ApplicationId**, and then click **OK**.</span></span>  <span data-ttu-id="ddcf9-243">Для элемента "Путь поля" определяется имя свойства, так как действие выводит объект с несколькими свойствами.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-243">We are specifying the name of the property for the Field path because the activity outputs an object with multiple properties.</span></span>
13. <span data-ttu-id="ddcf9-244">Щелкните **CERTIFICATETHUMBPRINT** и в колонке "Значение параметра" выберите для параметра **Источник данных** значение **Activity output** (Выходные данные действия).</span><span class="sxs-lookup"><span data-stu-id="ddcf9-244">Click **CERTIFICATETHUMBPRINT**, and in the Parameter Value blade, select **Activity output** for the **Data source**.</span></span>  <span data-ttu-id="ddcf9-245">В списке выберите **Get Run As Connection** (Получить подключение запуска от имени), в текстовом поле **Field path** (Путь к полю) введите **CertificateThumbprint**, а затем нажмите кнопку **OК**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-245">Select **Get Run As Connection** from the list, in the **Field path** textbox type **CertificateThumbprint**, and then click **OK**.</span></span>
14. <span data-ttu-id="ddcf9-246">Щелкните **SERVICEPRINCIPAL** и в колонке "Значение параметра" выберите для параметра **Источник данных** значение **ConstantValue**. Затем выберите значение **True** и нажмите кнопку **OК**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-246">Click **SERVICEPRINCIPAL**, and in the Parameter Value blade, select **ConstantValue** for the **Data source**, click the option **True**, and then click **OK**.</span></span>
15. <span data-ttu-id="ddcf9-247">Щелкните **TENANTID** и в колонке "Значение параметра" выберите для параметра **Источник данных** значение **Activity output** (Выходные данные действия).</span><span class="sxs-lookup"><span data-stu-id="ddcf9-247">Click **TENANTID**, and in the Parameter Value blade, select **Activity output** for the **Data source**.</span></span>  <span data-ttu-id="ddcf9-248">В списке выберите **Get Run As Connection** (Получить подключение запуска от имени), в текстовом поле **Field path** (Путь к полю) введите **TenantId**, а затем дважды нажмите кнопку **OК**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-248">Select **Get Run As Connection** from the list, in the **Field path** textbox type **TenantId**, and then click **OK** twice.</span></span>  
16. <span data-ttu-id="ddcf9-249">В элементе управления "Библиотека" введите в поле поиска текст **Set-AzureRmContext** .</span><span class="sxs-lookup"><span data-stu-id="ddcf9-249">In the Library control, type **Set-AzureRmContext** in the search textbox.</span></span>
17. <span data-ttu-id="ddcf9-250">Добавьте на холст командлет **Set-AzureRmContext** .</span><span class="sxs-lookup"><span data-stu-id="ddcf9-250">Add **Set-AzureRmContext** to the canvas.</span></span>
18. <span data-ttu-id="ddcf9-251">На холсте выберите **Set-AzureRmContext** и в области управления конфигурацией в текстовое поле **Метка** введите текст **Указать идентификатор подписки**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-251">On the canvas, select **Set-AzureRmContext** and in the Configuration control pane type **Specify Subscription Id** in the **Label** textbox.</span></span>
19. <span data-ttu-id="ddcf9-252">Щелкните **Параметры** , чтобы открыть колонку "Конфигурация параметров действия".</span><span class="sxs-lookup"><span data-stu-id="ddcf9-252">Click **Parameters** and the Activity Parameter Configuration blade appears.</span></span>
20. <span data-ttu-id="ddcf9-253">Командлет **Set-AzureRmContext** имеет несколько наборов параметров. Нужно выбрать один из них, прежде чем вводить значения параметров.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-253">**Set-AzureRmContext** has multiple parameter sets, so we need to select one before we can provide parameter values.</span></span>  <span data-ttu-id="ddcf9-254">Щелкните **Набор параметров** и выберите набор параметров **SubscriptionId**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-254">Click **Parameter Set** and then select the **SubscriptionId** parameter set.</span></span>  
21. <span data-ttu-id="ddcf9-255">Параметры из выбранного набора появятся в колонке конфигурации параметров действия.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-255">Once you select the parameter set, the parameters are displayed in the Activity Parameter Configuration blade.</span></span>  <span data-ttu-id="ddcf9-256">Щелкните **SubscriptionID**</span><span class="sxs-lookup"><span data-stu-id="ddcf9-256">Click **SubscriptionID**</span></span>
22. <span data-ttu-id="ddcf9-257">В колонке "Значение параметра" для параметра **Источник данных** выберите значение **Variable Asset** (Ресурс-контейнер переменной), а затем в списке выберите **AzureSubscriptionId** и дважды нажмите кнопку **OК**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-257">In the Parameter Value blade, select **Variable Asset** for the **Data source** and select **AzureSubscriptionId** from the list and then click **OK** twice.</span></span>   
23. <span data-ttu-id="ddcf9-258">Наведите указатель мыши на элемент **Login to Azure** (Выполнить вход в Azure), чтобы в нижней части элемента появился кружок.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-258">Hover over **Login to Azure** until a circle appears on the bottom of the shape.</span></span> <span data-ttu-id="ddcf9-259">Щелкните этот кружок и перетащите стрелку к элементу **Specify Subscription Id**(Указать идентификатор подписки).</span><span class="sxs-lookup"><span data-stu-id="ddcf9-259">Click the circle and drag the arrow to **Specify Subscription Id**.</span></span>

<span data-ttu-id="ddcf9-260">Теперь модуль Runbook должен выглядеть примерно так: </span><span class="sxs-lookup"><span data-stu-id="ddcf9-260">Your runbook should look like the following at this point:</span></span> <br>![Настройка проверки подлинности Runbook](media/automation-first-runbook-graphical/runbook-auth-config.png)

## <a name="step-7---add-activity-to-start-a-virtual-machine"></a><span data-ttu-id="ddcf9-262">Шаг 7. Добавление действия для запуска виртуальной машины</span><span class="sxs-lookup"><span data-stu-id="ddcf9-262">Step 7 - Add activity to start a virtual machine</span></span>
<span data-ttu-id="ddcf9-263">Теперь мы добавим действие **Start-AzureRmVM** для запуска виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-263">Here we add a **Start-AzureRmVM** activity to start a virtual machine.</span></span>  <span data-ttu-id="ddcf9-264">Вы можете выбрать любую виртуальную машину в своей подписке Azure. Имя этой машины будет прописано в коде командлета.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-264">You can pick any virtual machine in your Azure subscription, and for now you hardcode that name into the cmdlet.</span></span>

1. <span data-ttu-id="ddcf9-265">В элементе управления "Библиотека" введите в поле поиска текст **Start-AzureRm** .</span><span class="sxs-lookup"><span data-stu-id="ddcf9-265">In the Library control, type **Start-AzureRm** in the search textbox.</span></span>
2. <span data-ttu-id="ddcf9-266">Добавьте на холст командлет **Start-AzureRmVM**, а затем перетащите его под элемент **Specify Subscription Id** (Указать идентификатор подписки).</span><span class="sxs-lookup"><span data-stu-id="ddcf9-266">Add **Start-AzureRmVM** to the canvas and then click and drag it underneath **Specify Subscription Id**.</span></span>
3. <span data-ttu-id="ddcf9-267">Наведите указатель мыши на элемент **Specify Subscription Id** (Указать идентификатор подписки), чтобы в нижней части элемента появился кружок.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-267">Hover over **Specify Subscription Id** until a circle appears on the bottom of the shape.</span></span>  <span data-ttu-id="ddcf9-268">Щелкните этот кружок и перетащите стрелку к элементу **Start-AzureRmVM**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-268">Click the circle and drag the arrow to **Start-AzureRmVM**.</span></span>
4. <span data-ttu-id="ddcf9-269">Выберите **Start-AzureRmVM**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-269">Select **Start-AzureRmVM**.</span></span>  <span data-ttu-id="ddcf9-270">Щелкните **Параметры**, а затем выберите **Набор параметров**, чтобы просмотреть наборы параметров для командлета **Start-AzureRmVM**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-270">Click **Parameters** and then **Parameter Set** to view the sets for **Start-AzureRmVM**.</span></span>  <span data-ttu-id="ddcf9-271">Выберите набор параметров **ResourceGroupNameParameterSetName** .</span><span class="sxs-lookup"><span data-stu-id="ddcf9-271">Select the **ResourceGroupNameParameterSetName** parameter set.</span></span> <span data-ttu-id="ddcf9-272">Обратите внимание, что рядом с параметрами **ResourceGroupName** и **Имя** стоят восклицательные знаки.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-272">Note that **ResourceGroupName** and **Name** have exclamation points next them.</span></span>  <span data-ttu-id="ddcf9-273">Это означает, что данные параметры являются обязательными.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-273">This indicates that they are required parameters.</span></span>  <span data-ttu-id="ddcf9-274">Также оба параметра ожидают ввода строковых значений.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-274">Also note both expect string values.</span></span>
5. <span data-ttu-id="ddcf9-275">Выберите параметр **Имя**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-275">Select **Name**.</span></span>  <span data-ttu-id="ddcf9-276">В поле **Источник данных** выберите **Выражение PowerShell** и введите имя виртуальной машины (в двойных кавычках), которую следует запускать этим модулем Runbook.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-276">Select **PowerShell expression** for the **Data source** and type in the name of the virtual machine surrounded with double quotes that we start with this runbook.</span></span>  <span data-ttu-id="ddcf9-277">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-277">Click **OK**.</span></span><br><span data-ttu-id="ddcf9-278">![Значение параметра имени для Start-AzureRmVM](media/automation-first-runbook-graphical/runbook-startvm-nameparameter.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-278">![Start-AzureRmVM Name Parameter Value](media/automation-first-runbook-graphical/runbook-startvm-nameparameter.png)</span></span>
6. <span data-ttu-id="ddcf9-279">Выберите **ResourceGroupName**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-279">Select **ResourceGroupName**.</span></span> <span data-ttu-id="ddcf9-280">Укажите для параметра **Выражение PowerShell** в поле **Выходные данные действия** и введите имя группы ресурсов, заключенное в двойные кавычки.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-280">Use **PowerShell expression** for the **Data source** and type in the name of the resource group surrounded with double quotes.</span></span>  <span data-ttu-id="ddcf9-281">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-281">Click **OK**.</span></span><br> <span data-ttu-id="ddcf9-282">![Параметры Start-AzureRmVM](media/automation-first-runbook-graphical/startazurermvm-params.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-282">![Start-AzureRmVM Parameters](media/automation-first-runbook-graphical/startazurermvm-params.png)</span></span>
7. <span data-ttu-id="ddcf9-283">Щелкните область тестирования, чтобы проверить модуль Runbook.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-283">Click Test pane so that we can test the runbook.</span></span>
8. <span data-ttu-id="ddcf9-284">Щелкните **Пуск** , чтобы начать тестирование.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-284">Click **Start** to start the test.</span></span>  <span data-ttu-id="ddcf9-285">После завершения теста проверьте, запущена ли виртуальная машина.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-285">Once it completes, check that the virtual machine was started.</span></span>

<span data-ttu-id="ddcf9-286">Теперь модуль Runbook должен выглядеть примерно так: </span><span class="sxs-lookup"><span data-stu-id="ddcf9-286">Your runbook should look like the following at this point:</span></span> <br>![Настройка проверки подлинности Runbook](media/automation-first-runbook-graphical/runbook-startvm.png)

## <a name="step-8---add-additional-input-parameters-to-the-runbook"></a><span data-ttu-id="ddcf9-288">Шаг 8. Добавление дополнительных входных параметров в Runbook</span><span class="sxs-lookup"><span data-stu-id="ddcf9-288">Step 8 - Add additional input parameters to the runbook</span></span>
<span data-ttu-id="ddcf9-289">Сейчас модуль Runbook запускает виртуальную машину в группе ресурсов, указанной в командлете **Start-AzureRmVM**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-289">Our runbook currently starts the virtual machine in the resource group that we specified in the **Start-AzureRmVM** cmdlet.</span></span>  <span data-ttu-id="ddcf9-290">Модуль Runbook был бы полезнее, если бы при его запуске мы могли указать оба значения.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-290">Our runbook would be more useful if we could specify both when the runbook is started.</span></span>  <span data-ttu-id="ddcf9-291">Для этого добавим в модуль Runbook входные параметры.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-291">We now add input parameters to the runbook to provide that functionality.</span></span>

1. <span data-ttu-id="ddcf9-292">Откройте графический редактор, щелкнув **Изменить** в области **MyFirstRunbook**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-292">Open the graphical editor by clicking **Edit** on the **MyFirstRunbook** pane.</span></span>
2. <span data-ttu-id="ddcf9-293">Щелкните **Входные и выходные данные**, а затем выберите **Добавить входные данные**, чтобы открыть область входных параметров для модуля Runbook.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-293">Click **Input and output** and then **Add input** to open the Runbook Input Parameter pane.</span></span><br> <span data-ttu-id="ddcf9-294">![Входные и выходные данные Runbook](media/automation-first-runbook-graphical/runbook-toolbar-InputandOutput-revised20165.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-294">![Runbook Input and Output](media/automation-first-runbook-graphical/runbook-toolbar-InputandOutput-revised20165.png)</span></span>
3. <span data-ttu-id="ddcf9-295">Укажите для параметра *Имя* значение **ИмяВМ**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-295">Specify *VMName* for the **Name**.</span></span>  <span data-ttu-id="ddcf9-296">Для параметра **Тип** оставьте значение *Строка*, но для параметра **Обязательный** выберите значение *Да*.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-296">Keep *string* for the **Type**, but change **Mandatory** to *Yes*.</span></span>  <span data-ttu-id="ddcf9-297">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-297">Click **OK**.</span></span>
4. <span data-ttu-id="ddcf9-298">Создайте второй обязательный входной параметр с именем *ResourceGroupName* и нажмите кнопку **ОК**, чтобы закрыть область **Входные и выходные данные**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-298">Create a second mandatory input parameter called *ResourceGroupName* and then click **OK** to close the **Input and Output** pane.</span></span><br> <span data-ttu-id="ddcf9-299">![Входные параметры Runbook](media/automation-first-runbook-graphical/start-azurermvm-params-outputs.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-299">![Runbook Input Parameters](media/automation-first-runbook-graphical/start-azurermvm-params-outputs.png)</span></span>
5. <span data-ttu-id="ddcf9-300">Выберите действие **Start-AzureRmVM** и щелкните **Параметры**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-300">Select the **Start-AzureRmVM** activity and then click **Parameters**.</span></span>
6. <span data-ttu-id="ddcf9-301">В поле **Источник данных** для параметра **Имя** задайте значение **Runbook input** (Входные данные Runbook), а затем выберите **VMName**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-301">Change the **Data source** for **Name** to **Runbook input** and then select **VMName**.</span></span><br>
7. <span data-ttu-id="ddcf9-302">В поле **Источник данных** для параметра **ResourceGroupName** задайте значение **Runbook input** (Входные данные Runbook), а затем выберите **ResourceGroupName**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-302">Change the **Data source** for **ResourceGroupName** to **Runbook input** and then select **ResourceGroupName**.</span></span><br> <span data-ttu-id="ddcf9-303">![Параметры командлета Start-AzureVM](media/automation-first-runbook-graphical/start-azurermvm-params-runbookinput.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-303">![Start-AzureVM Parameters](media/automation-first-runbook-graphical/start-azurermvm-params-runbookinput.png)</span></span>
8. <span data-ttu-id="ddcf9-304">Сохраните модуль Runbook и откройте область тестирования.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-304">Save the runbook and open the Test pane.</span></span>  <span data-ttu-id="ddcf9-305">Обратите внимание, что теперь значения двух входных переменных, которые будут использоваться в тесте, можно указать.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-305">Note that you can now provide values for the two input variables that you use in the test.</span></span>
9. <span data-ttu-id="ddcf9-306">Закройте область тестирования.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-306">Close the Test pane.</span></span>
10. <span data-ttu-id="ddcf9-307">Щелкните **Опубликовать** , чтобы опубликовать новую версию модуля Runbook.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-307">Click **Publish** to publish the new version of the runbook.</span></span>
11. <span data-ttu-id="ddcf9-308">Остановите виртуальную машину, запущенную на предыдущем этапе.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-308">Stop the virtual machine that you started in the previous step.</span></span>
12. <span data-ttu-id="ddcf9-309">Щелкните **Пуск** , чтобы запустить модуль Runbook.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-309">Click **Start** to start the runbook.</span></span>  <span data-ttu-id="ddcf9-310">Введите значения **VMName** и **ResourceGroupName** для виртуальной машины, которую нужно запустить.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-310">Type in the **VMName** and **ResourceGroupName** for the virtual machine that you're going to start.</span></span><br> <span data-ttu-id="ddcf9-311">![Start Runbook](media/automation-first-runbook-graphical/runbook-start-inputparams.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-311">![Start Runbook](media/automation-first-runbook-graphical/runbook-start-inputparams.png)</span></span>
13. <span data-ttu-id="ddcf9-312">Когда модуль Runbook будет выполнен, проверьте, запустилась ли виртуальная машина.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-312">When the runbook completes, check that the virtual machine was started.</span></span>

## <a name="step-9---create-a-conditional-link"></a><span data-ttu-id="ddcf9-313">Шаг 9. Создание условной связи</span><span class="sxs-lookup"><span data-stu-id="ddcf9-313">Step 9 - Create a conditional link</span></span>
<span data-ttu-id="ddcf9-314">Теперь мы изменим модуль Runbook, чтобы он запускал виртуальную машину только в том случае, если она еще не запущена.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-314">We now modify the runbook so that it only attempts to start the virtual machine if it is not already started.</span></span>  <span data-ttu-id="ddcf9-315">Для этого добавьте в Runbook командлет **Get-AzureRmVM**, который получает текущее состояние виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-315">You do this by adding a **Get-AzureRmVM** cmdlet to the runbook that gets the instance level status of the virtual machine.</span></span> <span data-ttu-id="ddcf9-316">Затем добавьте модуль кода с именем **Get Status** для рабочего процесса PowerShell. Фрагмент кода PowerShell в этом модуле будет определять состояние виртуальной машины (запущена или остановлена).</span><span class="sxs-lookup"><span data-stu-id="ddcf9-316">Then you add a PowerShell Workflow code module called **Get Status** with a snippet of PowerShell code to determine if the virtual machine state is running or stopped.</span></span>  <span data-ttu-id="ddcf9-317">Условная связь между модулем **Get Status** и действием **Start-AzureRmVM** позволит запускать действие, только если виртуальная машина остановлена.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-317">A conditional link from the **Get Status** module only runs **Start-AzureRmVM** if the current running state is stopped.</span></span>  <span data-ttu-id="ddcf9-318">И еще мы выведем сообщение с информацией о том, удалось ли командлету PowerShell Write-Output запустить виртуальную машину.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-318">Finally, we output a message to inform you if the VM was successfully started or not using the PowerShell Write-Output cmdlet.</span></span>

1. <span data-ttu-id="ddcf9-319">Откройте **MyFirstRunbook** в графическом редакторе.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-319">Open **MyFirstRunbook** in the graphical editor.</span></span>
2. <span data-ttu-id="ddcf9-320">Удалите связь между элементами **Specify Subscription Id** (Указать идентификатор подписки) и **Start-AzureRmVM**. Для этого щелкните ее и нажмите клавишу *Delete*.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-320">Remove the link between **Specify Subscription Id** and **Start-AzureRmVM** by clicking on it and then pressing the *Delete* key.</span></span>
3. <span data-ttu-id="ddcf9-321">В элементе управления "Библиотека" введите в поле поиска текст **Get-AzureRm** .</span><span class="sxs-lookup"><span data-stu-id="ddcf9-321">In the Library control, type **Get-AzureRm** in the search textbox.</span></span>
4. <span data-ttu-id="ddcf9-322">Добавьте на холст командлет **Get-AzureRmVM** .</span><span class="sxs-lookup"><span data-stu-id="ddcf9-322">Add **Get-AzureRmVM** to the canvas.</span></span>
5. <span data-ttu-id="ddcf9-323">Выберите **Get-AzureRmVM**, а затем — **Набор параметров**, чтобы просмотреть наборы параметров для командлета **Get-AzureRmVM**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-323">Select **Get-AzureRmVM** and then **Parameter Set** to view the sets for **Get-AzureRmVM**.</span></span>  <span data-ttu-id="ddcf9-324">Выберите набор параметров **GetVirtualMachineInResourceGroupNameParamSet** .</span><span class="sxs-lookup"><span data-stu-id="ddcf9-324">Select the **GetVirtualMachineInResourceGroupNameParamSet** parameter set.</span></span>  <span data-ttu-id="ddcf9-325">Обратите внимание, что рядом с параметрами **ResourceGroupName** и **Имя** стоят восклицательные знаки.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-325">Note that **ResourceGroupName** and **Name** have exclamation points next them.</span></span>  <span data-ttu-id="ddcf9-326">Это означает, что данные параметры являются обязательными.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-326">This indicates that they are required parameters.</span></span>  <span data-ttu-id="ddcf9-327">Также оба параметра ожидают ввода строковых значений.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-327">Also note both expect string values.</span></span>
6. <span data-ttu-id="ddcf9-328">В поле **Источник данных** для параметра **Имя** укажите значение **Runbook input** (Входные данные Runbook), а затем выберите **VMName**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-328">Under **Data source** for **Name**, select **Runbook input** and then select **VMName**.</span></span>  <span data-ttu-id="ddcf9-329">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-329">Click **OK**.</span></span>
7. <span data-ttu-id="ddcf9-330">В поле **Источник данных** для параметра **ResourceGroupName** укажите значение **Runbook input** (Входные данные Runbook), а затем выберите **ResourceGroupName**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-330">Under **Data source** for **ResourceGroupName**, select **Runbook input** and then select **ResourceGroupName**.</span></span>  <span data-ttu-id="ddcf9-331">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-331">Click **OK**.</span></span>
8. <span data-ttu-id="ddcf9-332">В поле **Источник данных** для параметра **Состояние** выберите **Значение-константа**, а затем щелкните **True**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-332">Under **Data source** for **Status**, select **Constant value** and then click  **True**.</span></span>  <span data-ttu-id="ddcf9-333">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-333">Click **OK**.</span></span>  
9. <span data-ttu-id="ddcf9-334">Создайте связь, ведущую от элемента **Specify Subscription Id** (Указать идентификатор подписки) к **Get-AzureRmVM**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-334">Create a link from **Specify Subscription Id** to **Get-AzureRmVM**.</span></span>
10. <span data-ttu-id="ddcf9-335">В элементе управления "Библиотека" разверните элемент **Управление Runbook** и добавьте на холст элемент **Код**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-335">In the library control, expand **Runbook Control** and add **Code** to the canvas.</span></span>  
11. <span data-ttu-id="ddcf9-336">Создайте связь, ведущую от командлета **Get-AzureRmVM** к элементу **Код**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-336">Create a link from **Get-AzureRmVM** to **Code**.</span></span>  
12. <span data-ttu-id="ddcf9-337">Щелкните **Код** и в области конфигурации измените значение метки на **Get Status** (Получить состояние).</span><span class="sxs-lookup"><span data-stu-id="ddcf9-337">Click **Code** and in the Configuration pane, change label to **Get Status**.</span></span>
13. <span data-ttu-id="ddcf9-338">Выберите параметр **Код**. Появится колонка **Редактор кода**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-338">Select **Code** parameter, and the **Code Editor** blade appears.</span></span>  
14. <span data-ttu-id="ddcf9-339">В редакторе кода вставьте этот фрагмент кода:</span><span class="sxs-lookup"><span data-stu-id="ddcf9-339">In the code editor, paste the following snippet of code:</span></span>
    
     ```
     $StatusesJson = $ActivityOutput['Get-AzureRmVM'].StatusesText
     $Statuses = ConvertFrom-Json $StatusesJson
     $StatusOut =""
     foreach ($Status in $Statuses){
     if($Status.Code -eq "Powerstate/running"){$StatusOut = "running"}
     elseif ($Status.Code -eq "Powerstate/deallocated") {$StatusOut = "stopped"}
     }
     $StatusOut
     ```
15. <span data-ttu-id="ddcf9-340">Создайте связь, ведущую от элемента **Get Status** (Получить состояние) к **Start-AzureRmVM**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-340">Create a link from **Get Status** to **Start-AzureRmVM**.</span></span><br> <span data-ttu-id="ddcf9-341">![Runbook с модулем кода](media/automation-first-runbook-graphical/runbook-startvm-get-status.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-341">![Runbook with Code Module](media/automation-first-runbook-graphical/runbook-startvm-get-status.png)</span></span>  
16. <span data-ttu-id="ddcf9-342">Выберите эту связь и в области конфигурации измените значение параметра **Apply condition** (Применить условие) на **Да**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-342">Select the link and in the Configuration pane, change **Apply condition** to **Yes**.</span></span>   <span data-ttu-id="ddcf9-343">Обратите внимание, что связь станет пунктирной. Это означает, что целевое действие будет выполняться только при соблюдении условия.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-343">Note the link turns to a dashed line indicating that the target activity only runs if the condition resolves to true.</span></span>  
17. <span data-ttu-id="ddcf9-344">В поле **Выражение условия**введите *$ActivityOutput['Get Status'] -eq "Stopped"*.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-344">For the **Condition expression**, type *$ActivityOutput['Get Status'] -eq "Stopped"*.</span></span>  <span data-ttu-id="ddcf9-345">**Start-AzureRmVM** выполняется, только если виртуальная машина остановлена.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-345">**Start-AzureRmVM** now only runs if the virtual machine is stopped.</span></span>
18. <span data-ttu-id="ddcf9-346">В элементе управления "Библиотека" разверните узел **Командлеты** и выберите **Microsoft.PowerShell.Utility**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-346">In the Library control, expand **Cmdlets** and then **Microsoft.PowerShell.Utility**.</span></span>
19. <span data-ttu-id="ddcf9-347">Дважды добавьте командлет **Write-Output** на холст.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-347">Add **Write-Output** to the canvas twice.</span></span><br> <span data-ttu-id="ddcf9-348">![Runbook с командлетом Write-Output](media/automation-first-runbook-graphical/runbook-startazurermvm-complete.png)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-348">![Runbook with Write-Output](media/automation-first-runbook-graphical/runbook-startazurermvm-complete.png)</span></span>
20. <span data-ttu-id="ddcf9-349">В первом элементе управления **Write-Output** щелкните **Параметры** и укажите для параметра **Метка** значение *Notify VM Started* (Сообщить о запуске виртуальной машины).</span><span class="sxs-lookup"><span data-stu-id="ddcf9-349">On the first **Write-Output** control, click **Parameters** and change the **Label** value to *Notify VM Started*.</span></span>
21. <span data-ttu-id="ddcf9-350">Для параметра **InputObject** измените значение в поле **Источник данных** на **PowerShell expression** (Выражение PowerShell) и введите выражение *$VMName successfully started*.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-350">For **InputObject**, change **Data source** to **PowerShell expression** and type in the expression *"$VMName successfully started."*.</span></span>
22. <span data-ttu-id="ddcf9-351">Во втором элементе управления **Write-Output** щелкните **Параметры** и укажите для параметра **Метка** значение *Notify VM Start Failed* (Сообщить о сбое при запуске виртуальной машины).</span><span class="sxs-lookup"><span data-stu-id="ddcf9-351">On the second **Write-Output** control, click **Parameters** and change the **Label** value to *Notify VM Start Failed*</span></span>
23. <span data-ttu-id="ddcf9-352">Для параметра **InputObject** измените значение в поле **Источник данных** на **PowerShell expression** (Выражение PowerShell) и введите выражение *$VMName could not start*.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-352">For **InputObject**, change **Data source** to **PowerShell expression** and type in the expression *"$VMName could not start."*.</span></span>
24. <span data-ttu-id="ddcf9-353">Создайте связь, ведущую от **Start-AzureRmVM** к элементу **Notify VM Started** (Сообщить о запуске виртуальной машины), и еще одну, ведущую к элементу **Notify VM Start Failed** (Сообщить о сбое при запуске виртуальной машины).</span><span class="sxs-lookup"><span data-stu-id="ddcf9-353">Create a link from **Start-AzureRmVM** to **Notify VM Started** and **Notify VM Start Failed**.</span></span>
25. <span data-ttu-id="ddcf9-354">Выберите связь, ведущую к элементу **Notify VM Started** (Сообщить о запуске виртуальной машины), и укажите для параметра**Apply condition** (Применить условие) значение **True**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-354">Select the link to **Notify VM Started** and change **Apply condition** to **True**.</span></span>
26. <span data-ttu-id="ddcf9-355">В поле **Выражение условия**введите *$ActivityOutput['Start-AzureRmVM'].IsSuccessStatusCode -eq $true*.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-355">For the **Condition expression**, type *$ActivityOutput['Start-AzureRmVM'].IsSuccessStatusCode -eq $true*.</span></span>  <span data-ttu-id="ddcf9-356">Теперь этот элемент управления Write-Output выполняется только тогда, когда успешно запустится виртуальная машина.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-356">This Write-Output control now only runs if the virtual machine is successfully started.</span></span>
27. <span data-ttu-id="ddcf9-357">Выберите связь, ведущую к элементу **Notify VM Start Failed** (Сообщить о сбое при запуске виртуальной машины), и укажите для параметра **Apply condition** (Применить условие) значение **True**.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-357">Select the link to **Notify VM Start Failed** and change **Apply condition** to **True**.</span></span>
28. <span data-ttu-id="ddcf9-358">В поле **Выражение условия**введите *$ActivityOutput['Start-AzureRmVM'].IsSuccessStatusCode -ne $true*.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-358">For the **Condition expression**, type *$ActivityOutput['Start-AzureRmVM'].IsSuccessStatusCode -ne $true*.</span></span>  <span data-ttu-id="ddcf9-359">Теперь этот элемент управления Write-Output будет выполняться только тогда, когда виртуальная машина не сможет запуститься.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-359">This Write-Output control now only runs if the virtual machine is not successfully started.</span></span>
29. <span data-ttu-id="ddcf9-360">Сохраните модуль Runbook и откройте область тестирования.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-360">Save the runbook and open the Test pane.</span></span>
30. <span data-ttu-id="ddcf9-361">Запустите модуль Runbook при остановленной виртуальной машине; модуль должен запуститься.</span><span class="sxs-lookup"><span data-stu-id="ddcf9-361">Start the runbook with the virtual machine stopped, and it should start.</span></span>

## <a name="next-steps"></a><span data-ttu-id="ddcf9-362">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="ddcf9-362">Next steps</span></span>
* <span data-ttu-id="ddcf9-363">Дополнительные сведения о графической разработке см. в статье [Графическая разработка в службе автоматизации Azure](automation-graphical-authoring-intro.md).</span><span class="sxs-lookup"><span data-stu-id="ddcf9-363">To learn more about Graphical Authoring, see [Graphical authoring in Azure Automation](automation-graphical-authoring-intro.md)</span></span>
* <span data-ttu-id="ddcf9-364">Сведения о том, как начать работу с модулями Runbook, см. в статье [Мой первый модуль Runbook PowerShell](automation-first-runbook-textual-powershell.md).</span><span class="sxs-lookup"><span data-stu-id="ddcf9-364">To get started with PowerShell runbooks, see [My first PowerShell runbook](automation-first-runbook-textual-powershell.md)</span></span>
* <span data-ttu-id="ddcf9-365">Чтобы приступить к работе с модулями Runbook рабочих процессов PowerShell, обратитесь к статье [Мой первый модуль Runbook рабочего процесса PowerShell](automation-first-runbook-textual.md)</span><span class="sxs-lookup"><span data-stu-id="ddcf9-365">To get started with PowerShell workflow runbooks, see [My first PowerShell workflow runbook](automation-first-runbook-textual.md)</span></span>

