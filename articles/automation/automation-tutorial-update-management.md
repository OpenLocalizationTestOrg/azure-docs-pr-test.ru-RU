---
title: "Управление обновлениями и исправлениями для виртуальных машин Azure под управлением Windows | Документация Майкрософт"
description: "Эта статья описывает применение службы автоматизации Azure для управления обновлениями и исправлениями для виртуальных машин Azure под управлением Windows."
services: automation
documentationcenter: 
author: zjalexander
manager: jwhit
editor: 
ms.assetid: 
ms.service: automation
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: tutorial
ms.date: 12/14/2017
ms.author: zachal
ms.custom: mvc
ms.openlocfilehash: 615618e0e78f97e3f41dc2c0e1ca9a6e4b1b47bf
ms.sourcegitcommit: 9cc3d9b9c36e4c973dd9c9028361af1ec5d29910
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2018
---
# <a name="manage-windows-updates-with-azure-automation"></a>Управление обновлениями Windows в службе автоматизации Azure

Управление обновлениями позволяет управлять обновлениями и исправлениями виртуальных машин.
Из этого руководства вы узнаете, как оценить состояние доступных обновлений, назначить время установки необходимых обновлений и проверить результаты развертывания, чтобы убедиться, что обновления успешно применены.

Сведения о ценах см. на странице [цены на службу автоматизации](https://azure.microsoft.com/pricing/details/automation/).

Из этого руководства вы узнаете, как выполнять такие задачи:

> [!div class="checklist"]
> * подключение виртуальной машины к управлению обновлениями;
> * Просмотр оценки обновлений
> * Планирование развертывания обновлений
> * просмотр результатов развертывания.

## <a name="prerequisites"></a>предварительным требованиям

Для работы с этим учебником необходимы указанные ниже компоненты.

* Подписка Azure. Если у вас ее нет, [активируйте преимущества для подписчиков MSDN](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) или [зарегистрируйте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).
* [Учетная запись службы автоматизации](automation-offering-get-started.md) для хранения runbook наблюдателя, runbook действия и задачи наблюдателя.
* [Виртуальная машина](../virtual-machines/windows/quick-create-portal.md) для подключения.

## <a name="log-in-to-azure"></a>Вход в Azure

Войдите на портал Azure по адресу http://portal.azure.com.

## <a name="enable-update-management"></a>Включение управления обновлениями

Для работы с этим руководством прежде всего нужно включить управление обновлениями для виртуальной машины. Если вы ранее настроили для этой виртуальной машины другую систему автоматизации, этот шаг можно пропустить.

1. В меню слева выберите **Виртуальные машины**, затем выберите виртуальную машину из списка.
2. В меню слева в разделе **Операции** выберите пункт **Управление обновлениями**. Откроется страница **Включение управления обновлениями**.

Проверка выполняется, чтобы определить, включено ли управление обновлениями для этой виртуальной машины.
При этом проверяется рабочее пространство Log Analytics и связанная учетная запись службы автоматизации, а также наличие решения в рабочей области.

Рабочая область [Log Analytics](../log-analytics/log-analytics-overview.md?toc=%2fazure%2fautomation%2ftoc.json) используется для сбора данных, созданных компонентами и службами, такими как "Управление обновлениями".
Рабочая область предоставляет единое расположение для проверки и анализа данных из нескольких источников.
Для выполнения дополнительных действий на виртуальных машинах, требующих обновления, служба автоматизации Azure позволяет выполнять runbook на виртуальных машинах, например для скачивания и применения обновлений.

В процессе проверки также определяется, была ли виртуальная машина подготовлена с помощью Microsoft Monitoring Agent (MMA) и гибридной рабочей роли службы автоматизации.
Агент позволяет взаимодействовать с виртуальной машиной и получать сведения о состоянии обновления.

Если предварительные условия не выполнены, появится баннер, с помощью которого можно будет включить решение.

![Баннер конфигурации развертывания службы управления обновлениями](./media/automation-tutorial-update-management/manageupdates-onboard-solution-banner.png)

Щелкните этот баннер, чтобы включить решение.
Если проверка выявит, что отсутствует один из следующих компонентов, он будет автоматически добавлен:

* [Рабочая область Log Analytics](../log-analytics/log-analytics-overview.md?toc=%2fazure%2fautomation%2ftoc.json).
* [Автоматизация](./automation-offering-get-started.md)
* [Гибридная рабочая роль runbook](./automation-hybrid-runbook-worker.md) включена на виртуальной машине.

Откроется экран **Управление обновлениями**. Настройте расположение, рабочую область Log Analytics и учетную запись службы автоматизации, затем нажмите кнопку **Включить**. Если эти поля неактивны и выделены серым цветом, то для этой виртуальной машины настроено другое решение автоматизации, а значит необходимо использовать ту же рабочую область и ту же учетную запись службы автоматизации.

![Окно включения решения по управлению обновлениями](./media/automation-tutorial-update-management/manageupdates-update-enable.png)

Включение решения может занять до 15 минут. В это время не закрывайте окно браузера.
После включения решения сведения об отсутствующих обновлениях на виртуальной машине передаются в Log Analytics.
На получение данных для анализа может уйти от 30 минут до 6 часов.

## <a name="view-update-assessment"></a>Просмотр оценок обновления

После включения решения **Управление обновлениями** отобразится экран **Управление обновлениями**.
Если будут обнаружены отсутствующие обновления, их список можно просмотреть на вкладке **Отсутствующие обновления**.

Выберите элемент **Ссылка на сведения** для любого из этих обновлений, чтобы открыть в новом окне соответствующую статью технической поддержки. На ней вы получите важные сведения об обновлении.

![Просмотр состояния обновления](./media/automation-tutorial-update-management/manageupdates-view-status-win.png)

Щелкнув обновление в любой другой точке, вы откроете окно **поиска по журналам** для выбранного обновления. Запрос поиска по журналам настроен на сведения о конкретном обновлении. Вы можете изменить этот запрос или создать собственный запрос, чтобы просмотреть подробные сведения об обновлениях, развернутых или отсутствующих в вашей среде.

![Просмотр состояния обновления](./media/automation-tutorial-update-management/logsearch.png)

## <a name="schedule-an-update-deployment"></a>Планирование развертывания обновлений

Теперь известно, что на виртуальной машине отсутствуют некоторые обновления. Чтобы установить обновления, составьте план развертывания в рамках графика выпуска и периода обслуживания.
Вы можете выбрать типы обновлений, которые будут включены в развертывание.
Например, можно включить только критические обновления или обновления для системы безопасности и исключить накопительные пакеты обновления.

> [!WARNING]
> Если обновления требуют перезагрузки, виртуальная машина перезагружается автоматически.

Чтобы запланировать новое развертывание обновления для виртуальной машины, перейдите к разделу **Управление обновлениями** и выберите в верхней части экрана элемент **Запланировать развертывание обновлений**.

На экране **New update deployment** (Новое развертывание обновлений) укажите следующие сведения:

* **Имя**. Введите уникальное имя для развертывания обновлений.
* **Update classification** (Классификация обновлений). Выберите типы программного обеспечения, которые были включены в развертывание обновления. Для целей этого руководства сохраните выбор всех типов.

  Ниже приведены типы классификации:

  * критические обновления;
  * обновления для системы безопасности;
  * накопительные пакеты обновления;
  * пакеты дополнительных компонентов;
  * пакеты обновления;
  * обновления определений;
  * Средства
  * Обновления

* **Параметры расписания**. Установите время на 5 минут позднее текущего. По умолчанию здесь предлагается время на 30 минут позднее текущего, и вы можете подтвердить этот вариант.
Кроме того, можно указать, происходит ли развертывание один раз, или настроить расписание повторяющегося развертывания.
Выберите значение **Повторяющееся** для параметра **Периодичность**. Оставьте предложенное по умолчанию значение "1 день" и нажмите кнопку **ОК**. Это действие устанавливает расписание с периодическим повторением.

* **Период обслуживания (в минутах)**. Сохраните здесь значение по умолчанию. Вы можете задать период времени, в течение которого должно завершаться развертывание обновления. Этот параметр позволяет гарантировать соблюдение определенного периода обслуживания.

![Экран параметров обновления расписания](./media/automation-tutorial-update-management/manageupdates-schedule-win.png)

Завершив настройку расписания, нажмите кнопку **Создать**. Вы вернетесь к панели мониторинга состояния. Выберите **Запланированные развертывания обновлений**, чтобы отобразить созданный график развертывания.

## <a name="view-results-of-an-update-deployment"></a>Просмотр результатов развертывания обновлений

После запуска запланированного развертывания вы можете контролировать его состояние на вкладке **Развертывания обновлений** раздела **Управление обновлениями**.
Пока развертывание выполняется, для него отображается состояние **Выполнение**.
При успешном завершении появится состояние **Выполнено**.
В случае сбоя одного или нескольких обновлений в развертывании устанавливается состояние **Частичный сбой**.
Щелкните завершенное развертывание обновлений, чтобы просмотреть панель мониторинга этого развертывания обновлений.

![Панель мониторинга состояния развертывания обновлений конкретного развертывания](./media/automation-tutorial-update-management/manageupdates-view-results.png)

Плитка **Результаты обновления** содержит сводную информацию об общем количестве обновлений и результатах их развертывания на виртуальной машине.
В таблице справа представлена подробная информация о каждом обновлении и результатах установки.
Возможные значения представлены в следующем списке.

* **Not attempted** (Попытка не предпринималась). Обновление не установлено из-за недостатка времени в связи с заданной длительностью окна обслуживания.
* **Выполнено.** Обновление было успешно выполнено.
* **Сбой.** Обновление не удалось выполнить.

Щелкните **Все журналы** для просмотра всех записей журнала, созданных при развертывании.

Щелкните плитку **Вывод** для просмотра потока заданий runbook, отвечающих за управление развертыванием обновления на целевой виртуальной машине.

Щелкните **Ошибки**, чтобы просмотреть подробные сведения о любых ошибках развертывания.

## <a name="next-steps"></a>Дальнейшие действия

Из этого руководства вы узнали, как выполнить следующие задачи:

> [!div class="checklist"]
> * подключение виртуальной машины к управлению обновлениями;
> * Просмотр оценки обновлений
> * Планирование развертывания обновлений
> * просмотр результатов развертывания.

Теперь переходите к обзору решения для управления обновлениями.

> [!div class="nextstepaction"]
> [Update Management solution](../operations-management-suite/oms-solution-update-management.md?toc=%2fazure%2fautomation%2ftoc.json) (Решение для управления обновлениями)
