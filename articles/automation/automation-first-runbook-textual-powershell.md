---
title: "Мой первый модуль Runbook PowerShell в службе автоматизации Azure | Документация Майкрософт"
description: "Учебник, в котором описывается создание, тестирование и публикация простого модуля Runbook PowerShell."
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: 
keywords: "Azure PowerShell, руководство по скриптам PowerShell, инструменты автоматизации PowerShell"
ms.assetid: a43b395a-e740-41a3-ae62-40eac9d0ec00
ms.service: automation
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 03/26/2017
ms.author: magoedte;sngun
ms.openlocfilehash: 4b32011b72acc647d4af44bb5ccbcaab408fb4d6
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="my-first-powershell-runbook"></a><span data-ttu-id="971e6-104">Мой первый модуль Runbook PowerShell</span><span class="sxs-lookup"><span data-stu-id="971e6-104">My first PowerShell runbook</span></span>

> [!div class="op_single_selector"]
> * [<span data-ttu-id="971e6-105">Графический</span><span class="sxs-lookup"><span data-stu-id="971e6-105">Graphical</span></span>](automation-first-runbook-graphical.md)
> * [<span data-ttu-id="971e6-106">PowerShell</span><span class="sxs-lookup"><span data-stu-id="971e6-106">PowerShell</span></span>](automation-first-runbook-textual-powershell.md)
> * [<span data-ttu-id="971e6-107">Рабочий процесс PowerShell</span><span class="sxs-lookup"><span data-stu-id="971e6-107">PowerShell Workflow</span></span>](automation-first-runbook-textual.md)
> 
> 

<span data-ttu-id="971e6-108">В этом руководстве описана процедура создания [модуля Runbook PowerShell](automation-runbook-types.md#powershell-runbooks) в службе автоматизации Azure.</span><span class="sxs-lookup"><span data-stu-id="971e6-108">This tutorial walks you through the creation of a [PowerShell runbook](automation-runbook-types.md#powershell-runbooks) in Azure Automation.</span></span> <span data-ttu-id="971e6-109">Для начала мы протестируем и опубликуем простой модуль runbook и расскажем, как отслеживать состояние его заданий.</span><span class="sxs-lookup"><span data-stu-id="971e6-109">We start with a simple runbook that we test and publish while we explain how to track the status of the runbook job.</span></span> <span data-ttu-id="971e6-110">Затем мы изменим модуль runbook, настроив его на фактическое управление ресурсами Azure (в нашем примере это запуск виртуальной машины Azure).</span><span class="sxs-lookup"><span data-stu-id="971e6-110">Then we modify the runbook to actually manage Azure resources, in this case starting an Azure virtual machine.</span></span> <span data-ttu-id="971e6-111">И наконец, мы сделаем этот модуль runbook еще надежнее, добавив параметры.</span><span class="sxs-lookup"><span data-stu-id="971e6-111">Lastly, we make the runbook more robust by adding runbook parameters.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="971e6-112">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="971e6-112">Prerequisites</span></span>
<span data-ttu-id="971e6-113">Для работы с этим учебником требуется:</span><span class="sxs-lookup"><span data-stu-id="971e6-113">To complete this tutorial, you need the following:</span></span>

* <span data-ttu-id="971e6-114">Подписка Azure.</span><span class="sxs-lookup"><span data-stu-id="971e6-114">Azure subscription.</span></span> <span data-ttu-id="971e6-115">Если у вас ее нет, [активируйте преимущества для подписчиков MSDN](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) или <a href="/pricing/free-account/" target="_blank">[зарегистрируйте бесплатную учетную запись](https://azure.microsoft.com/free/).</span><span class="sxs-lookup"><span data-stu-id="971e6-115">If you don't have one yet, you can [activate your MSDN subscriber benefits](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) or <a href="/pricing/free-account/" target="_blank">[sign up for a free account](https://azure.microsoft.com/free/).</span></span>
* <span data-ttu-id="971e6-116">[Учетная запись службы автоматизации](automation-sec-configure-azure-runas-account.md) , чтобы хранить модуль Runbook и выполнять проверку подлинности ресурсов Azure.</span><span class="sxs-lookup"><span data-stu-id="971e6-116">[Automation account](automation-sec-configure-azure-runas-account.md) to hold the runbook and authenticate to Azure resources.</span></span>  <span data-ttu-id="971e6-117">Эта учетная запись должна иметь разрешение на запуск и остановку виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="971e6-117">This account must have permission to start and stop the virtual machine.</span></span>
* <span data-ttu-id="971e6-118">Виртуальная машина Azure.</span><span class="sxs-lookup"><span data-stu-id="971e6-118">An Azure virtual machine.</span></span> <span data-ttu-id="971e6-119">Это не должна быть рабочая виртуальная машина, так как в процессе изучения этого руководства ее нужно будет остановить и запустить заново.</span><span class="sxs-lookup"><span data-stu-id="971e6-119">We stop and start this machine so it should not be a production VM.</span></span>

## <a name="step-1---create-new-runbook"></a><span data-ttu-id="971e6-120">Шаг 1. Создание нового модуля Runbook</span><span class="sxs-lookup"><span data-stu-id="971e6-120">Step 1 - Create new runbook</span></span>
<span data-ttu-id="971e6-121">Для начала мы создадим простой модуль Runbook, выводящий на экран текст *Привет, мир!*</span><span class="sxs-lookup"><span data-stu-id="971e6-121">We'll start by creating a simple runbook that outputs the text *Hello World*.</span></span>

1. <span data-ttu-id="971e6-122">На портале Azure выберите свою учетную запись службы автоматизации.</span><span class="sxs-lookup"><span data-stu-id="971e6-122">In the Azure portal, open your Automation account.</span></span>  
   <span data-ttu-id="971e6-123">Страница учетной записи в службе автоматизации позволяет быстро получить представление о ресурсах, доступных в этой учетной записи.</span><span class="sxs-lookup"><span data-stu-id="971e6-123">The Automation account page gives you a quick view of the resources in this account.</span></span> <span data-ttu-id="971e6-124">Некоторые ресурсы уже должны быть доступны.</span><span class="sxs-lookup"><span data-stu-id="971e6-124">You should already have some assets.</span></span> <span data-ttu-id="971e6-125">Большинство из них — это модули, которые добавляются в каждую новую учетную запись в службе автоматизации по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="971e6-125">Most of those are the modules that are automatically included in a new Automation account.</span></span> <span data-ttu-id="971e6-126">Кроме того, вам потребуется ресурс учетных данных, упомянутый в [предварительных требованиях](#prerequisites).</span><span class="sxs-lookup"><span data-stu-id="971e6-126">You should also have the Credential asset that's mentioned in the [prerequisites](#prerequisites).</span></span>
2. <span data-ttu-id="971e6-127">Щелкните элемент **Модули Runbook** , чтобы открыть список модулей Runbook.</span><span class="sxs-lookup"><span data-stu-id="971e6-127">Click the **Runbooks** tile to open the list of runbooks.</span></span><br><br> <span data-ttu-id="971e6-128">![Управление модулями Runbook](media/automation-first-runbook-textual-powershell/runbooks-control-tiles.png)</span><span class="sxs-lookup"><span data-stu-id="971e6-128">![RunbooksControl](media/automation-first-runbook-textual-powershell/runbooks-control-tiles.png)</span></span>  
3. <span data-ttu-id="971e6-129">Создайте новый модуль runbook. Для этого нажмите кнопку **Добавить Runbook**, а затем выберите **Создать новый Runbook**.</span><span class="sxs-lookup"><span data-stu-id="971e6-129">Create a new runbook by clicking the **Add a runbook** button and then **Create a new runbook**.</span></span>
4. <span data-ttu-id="971e6-130">Присвойте модулю Runbook имя *MyFirstRunbook-PowerShell*.</span><span class="sxs-lookup"><span data-stu-id="971e6-130">Give the runbook the name *MyFirstRunbook-PowerShell*.</span></span>
5. <span data-ttu-id="971e6-131">В данном случае мы создадим [модуль Runbook PowerShell](automation-runbook-types.md#powershell-runbooks), поэтому для параметра **Тип Runbook** выберите значение **Powershell**.</span><span class="sxs-lookup"><span data-stu-id="971e6-131">In this case, we're going to create a [PowerShell runbook](automation-runbook-types.md#powershell-runbooks) so select **Powershell** for **Runbook type**.</span></span><br><br> <span data-ttu-id="971e6-132">![Runbook Type](media/automation-first-runbook-textual-powershell/automation-runbook-type.png)</span><span class="sxs-lookup"><span data-stu-id="971e6-132">![Runbook Type](media/automation-first-runbook-textual-powershell/automation-runbook-type.png)</span></span>  
6. <span data-ttu-id="971e6-133">Щелкните **Создать** , чтобы создать модуль Runbook и открыть текстовый редактор.</span><span class="sxs-lookup"><span data-stu-id="971e6-133">Click **Create** to create the runbook and open the textual editor.</span></span>

## <a name="step-2---add-code-to-the-runbook"></a><span data-ttu-id="971e6-134">Шаг 2. Добавление кода в Runbook</span><span class="sxs-lookup"><span data-stu-id="971e6-134">Step 2 - Add code to the runbook</span></span>
<span data-ttu-id="971e6-135">Можно либо напрямую ввести код в модуль Runbook, либо выбрать командлеты, модули Runbook и ресурсы из элемента управления "Библиотека" и добавить их к модулю Runbook с любыми связанными параметрами.</span><span class="sxs-lookup"><span data-stu-id="971e6-135">You can either type code directly into the runbook, or you can select cmdlets, runbooks, and assets from the Library control and have them added to the runbook with any related parameters.</span></span> <span data-ttu-id="971e6-136">В этом пошаговом руководстве мы введем код напрямую в модуль runbook.</span><span class="sxs-lookup"><span data-stu-id="971e6-136">For this walkthrough, we type directly in the runbook.</span></span>

1. <span data-ttu-id="971e6-137">Сейчас модуль Runbook пуст, поэтому введите *Write-Output "Hello World."*.</span><span class="sxs-lookup"><span data-stu-id="971e6-137">Our runbook is currently empty, type *Write-Output "Hello World."*.</span></span><br><br> <span data-ttu-id="971e6-138">![Привет, мир!](media/automation-first-runbook-textual-powershell/automation-helloworld.png)</span><span class="sxs-lookup"><span data-stu-id="971e6-138">![Hello World](media/automation-first-runbook-textual-powershell/automation-helloworld.png)</span></span>  
2. <span data-ttu-id="971e6-139">Сохраните модуль Runbook, щелкнув **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="971e6-139">Save the runbook by clicking **Save**.</span></span><br><br> <span data-ttu-id="971e6-140">![Кнопка "Сохранить"](media/automation-first-runbook-textual-powershell/automation-runbook-edit-controls-save.png)</span><span class="sxs-lookup"><span data-stu-id="971e6-140">![Save Button](media/automation-first-runbook-textual-powershell/automation-runbook-edit-controls-save.png)</span></span>  

## <a name="step-3---test-the-runbook"></a><span data-ttu-id="971e6-141">Шаг 3. Тестирование модуля Runbook</span><span class="sxs-lookup"><span data-stu-id="971e6-141">Step 3 - Test the runbook</span></span>
<span data-ttu-id="971e6-142">Прежде чем опубликовать модуль Runbook и, таким образом, сделать его доступным для рабочей среды, необходимо проверить, нормально ли он работает.</span><span class="sxs-lookup"><span data-stu-id="971e6-142">Before we publish the runbook to make it available in production, we want to test it to make sure that it works properly.</span></span> <span data-ttu-id="971e6-143">Чтобы протестировать модуль Runbook, нужно запустить его **черновую** версию и проверить его работу в интерактивном режиме.</span><span class="sxs-lookup"><span data-stu-id="971e6-143">When you test a runbook, you run its **Draft** version and view its output interactively.</span></span>

1. <span data-ttu-id="971e6-144">Щелкните **Область тестирования**.</span><span class="sxs-lookup"><span data-stu-id="971e6-144">Click **Test pane** to open the Test pane.</span></span><br><br> <span data-ttu-id="971e6-145">![Test Pane](media/automation-first-runbook-textual-powershell/automation-runbook-edit-controls-test.png)</span><span class="sxs-lookup"><span data-stu-id="971e6-145">![Test Pane](media/automation-first-runbook-textual-powershell/automation-runbook-edit-controls-test.png)</span></span>  
2. <span data-ttu-id="971e6-146">Щелкните **Пуск** , чтобы начать тестирование.</span><span class="sxs-lookup"><span data-stu-id="971e6-146">Click **Start** to start the test.</span></span> <span data-ttu-id="971e6-147">Активным должен быть только этот параметр.</span><span class="sxs-lookup"><span data-stu-id="971e6-147">This should be the only enabled option.</span></span>
3. <span data-ttu-id="971e6-148">При этом создается [задание Runbook](automation-runbook-execution.md) и отображается его состояние.</span><span class="sxs-lookup"><span data-stu-id="971e6-148">A [runbook job](automation-runbook-execution.md) is created and its status displayed.</span></span>  
   <span data-ttu-id="971e6-149">Сначала задание получает состояние *В очереди*, которое означает, что задание ожидает доступа к рабочей роли runbook в облаке.</span><span class="sxs-lookup"><span data-stu-id="971e6-149">The job status starts as *Queued* indicating that it is waiting for a runbook worker in the cloud to come available.</span></span> <span data-ttu-id="971e6-150">Как только рабочая роль затребует задание, оно получит состояние *Запущено*, а с началом фактического выполнения модуля Runbook — состояние *Выполняется*.</span><span class="sxs-lookup"><span data-stu-id="971e6-150">It will then move to *Starting* when a worker claims the job, and then *Running* when the runbook actually starts running.</span></span>  
4. <span data-ttu-id="971e6-151">Когда задание модуля Runbook будет выполнено, на экране появится результат.</span><span class="sxs-lookup"><span data-stu-id="971e6-151">When the runbook job completes, its output is displayed.</span></span> <span data-ttu-id="971e6-152">В нашем случае это должен быть текст *Привет, мир!*.</span><span class="sxs-lookup"><span data-stu-id="971e6-152">In our case, we should see *Hello World*.</span></span><br><br> <span data-ttu-id="971e6-153">![Вывод области тестирования](media/automation-first-runbook-textual-powershell/automation-testpane-output.png)</span><span class="sxs-lookup"><span data-stu-id="971e6-153">![Test Pane Output](media/automation-first-runbook-textual-powershell/automation-testpane-output.png)</span></span>  
5. <span data-ttu-id="971e6-154">Закройте область тестирования, чтобы вернуться на холст.</span><span class="sxs-lookup"><span data-stu-id="971e6-154">Close the Test pane to return to the canvas.</span></span>

## <a name="step-4---publish-and-start-the-runbook"></a><span data-ttu-id="971e6-155">Шаг 4. Публикация и запуск модуля Runbook</span><span class="sxs-lookup"><span data-stu-id="971e6-155">Step 4 - Publish and start the runbook</span></span>
<span data-ttu-id="971e6-156">Модуль runbook, который мы только что создали, все еще находится в режиме черновика.</span><span class="sxs-lookup"><span data-stu-id="971e6-156">The runbook that we created is still in Draft mode.</span></span> <span data-ttu-id="971e6-157">Прежде чем запустить модуль в рабочей среде, его нужно опубликовать.</span><span class="sxs-lookup"><span data-stu-id="971e6-157">We need to publish it before we can run it in production.</span></span>  <span data-ttu-id="971e6-158">При публикации модуля Runbook существующая опубликованная версия перезаписывается черновой версией.</span><span class="sxs-lookup"><span data-stu-id="971e6-158">When you publish a runbook, you overwrite the existing Published version with the Draft version.</span></span>  <span data-ttu-id="971e6-159">В нашем случае опубликованной версии не существует, поскольку Runbook был создан только что.</span><span class="sxs-lookup"><span data-stu-id="971e6-159">In our case, we don't have a Published version yet because we just created the runbook.</span></span>

1. <span data-ttu-id="971e6-160">Щелкните **Опубликовать**, чтобы опубликовать модуль Runbook, а затем нажмите кнопку **Да** в появившемся запросе.</span><span class="sxs-lookup"><span data-stu-id="971e6-160">Click **Publish** to publish the runbook and then **Yes** when prompted.</span></span><br><br> <span data-ttu-id="971e6-161">![Кнопка "Опубликовать"](media/automation-first-runbook-textual-powershell/automation-runbook-edit-controls-publish.png)</span><span class="sxs-lookup"><span data-stu-id="971e6-161">![Publish button](media/automation-first-runbook-textual-powershell/automation-runbook-edit-controls-publish.png)</span></span>  
2. <span data-ttu-id="971e6-162">Прокрутив экран влево до области **Модули Runbook**, вы увидите, что в поле **Состояние авторизации** для данного модуля Runbook появилось значение **Опубликован**.</span><span class="sxs-lookup"><span data-stu-id="971e6-162">If you scroll left to view the runbook in the **Runbooks** pane now, it will show an **Authoring Status** of **Published**.</span></span>
3. <span data-ttu-id="971e6-163">Прокрутите экран вправо до области **MyFirstRunbook-PowerShell**.</span><span class="sxs-lookup"><span data-stu-id="971e6-163">Scroll back to the right to view the pane for **MyFirstRunbook-PowerShell**.</span></span>  
   <span data-ttu-id="971e6-164">Параметры в верхней части экрана позволяют запускать и просматривать модуль runbook, назначать его запуск в определенное время в будущем, а также создавать вызовы [webhook](automation-webhooks.md), чтобы запускать модуль с помощью HTTP-вызова.</span><span class="sxs-lookup"><span data-stu-id="971e6-164">The options across the top allow us to start the runbook, view the runbook, schedule it to start at some time in the future, or create a [webhook](automation-webhooks.md) so it can be started through an HTTP call.</span></span>
4. <span data-ttu-id="971e6-165">Нам нужно запустить модуль runbook, поэтому щелкните **Запустить**, а затем, когда откроется колонка "Запуск Runbook", нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="971e6-165">We want to start the runbook, so click **Start** and then click **Ok** when the Start Runbook blade opens.</span></span><br><br> <span data-ttu-id="971e6-166">![Кнопка "Запуск"](media/automation-first-runbook-textual-powershell/automation-runbook-controls-start.png)</span><span class="sxs-lookup"><span data-stu-id="971e6-166">![Start button](media/automation-first-runbook-textual-powershell/automation-runbook-controls-start.png)</span></span><br>    
5. <span data-ttu-id="971e6-167">Откроется область заданий с созданным заданием runbook.</span><span class="sxs-lookup"><span data-stu-id="971e6-167">A job pane is opened for the runbook job that we created.</span></span> <span data-ttu-id="971e6-168">Эту область можно закрыть, но сейчас оставим ее открытой, чтобы следить за ходом выполнения задания.</span><span class="sxs-lookup"><span data-stu-id="971e6-168">We can close this pane, but in this case we leave it open so we can watch the job's progress.</span></span>
6. <span data-ttu-id="971e6-169">Состояние задания отображается в поле **Сводка по заданию** и отражает состояния, которые мы наблюдали при тестировании модуля Runbook.</span><span class="sxs-lookup"><span data-stu-id="971e6-169">The job status is shown in **Job Summary** and matches the statuses that we saw when we tested the runbook.</span></span><br><br> <span data-ttu-id="971e6-170">![Сводные данные задания](media/automation-first-runbook-textual-powershell/job-pane-status-blade-jobsummary.png)</span><span class="sxs-lookup"><span data-stu-id="971e6-170">![Job Summary](media/automation-first-runbook-textual-powershell/job-pane-status-blade-jobsummary.png)</span></span><br>  
7. <span data-ttu-id="971e6-171">Как только состояние модуля Runbook изменится на *Выполнено*, щелкните **Выходные данные**.</span><span class="sxs-lookup"><span data-stu-id="971e6-171">Once the runbook status shows *Completed*, click **Output**.</span></span> <span data-ttu-id="971e6-172">Откроется область "Выходные данные" с текстом *Hello World*.</span><span class="sxs-lookup"><span data-stu-id="971e6-172">The Output pane is opened, and we can see our *Hello World*.</span></span><br><br> <span data-ttu-id="971e6-173">![Выходные данные задания](media/automation-first-runbook-textual-powershell/job-pane-status-blade-outputtile.png)</span><span class="sxs-lookup"><span data-stu-id="971e6-173">![Job Output](media/automation-first-runbook-textual-powershell/job-pane-status-blade-outputtile.png)</span></span><br> 
8. <span data-ttu-id="971e6-174">Закройте область выходных данных.</span><span class="sxs-lookup"><span data-stu-id="971e6-174">Close the Output pane.</span></span>
9. <span data-ttu-id="971e6-175">Щелкните **Все журналы** , чтобы открыть область "Потоки" для задания Runbook.</span><span class="sxs-lookup"><span data-stu-id="971e6-175">Click **All Logs** to open the Streams pane for the runbook job.</span></span> <span data-ttu-id="971e6-176">В потоке выходных данных должен отображаться только текст *Hello World* , но могут присутствовать и другие потоки заданий Runbook, например "Подробные сведения" и "Ошибка", если Runbook записывает в них какие-то данные.</span><span class="sxs-lookup"><span data-stu-id="971e6-176">We should only see *Hello World* in the output stream, but this can show other streams for a runbook job such as Verbose and Error if the runbook writes to them.</span></span><br><br> <span data-ttu-id="971e6-177">![Все журналы](media/automation-first-runbook-textual-powershell/job-pane-status-blade-alllogstile.png)</span><span class="sxs-lookup"><span data-stu-id="971e6-177">![All Logs](media/automation-first-runbook-textual-powershell/job-pane-status-blade-alllogstile.png)</span></span><br>   
10. <span data-ttu-id="971e6-178">Закройте области "Потоки" и "Задания", чтобы вернуться в область MyFirstRunbook-PowerShell.</span><span class="sxs-lookup"><span data-stu-id="971e6-178">Close the Streams pane and the Job pane to return to the MyFirstRunbook-PowerShell pane.</span></span>
11. <span data-ttu-id="971e6-179">Щелкните **Задания** , чтобы открыть область "Задания" для этого Runbook.</span><span class="sxs-lookup"><span data-stu-id="971e6-179">Click **Jobs** to open the Jobs pane for this runbook.</span></span> <span data-ttu-id="971e6-180">Откроется список всех заданий, созданных этим модулем Runbook.</span><span class="sxs-lookup"><span data-stu-id="971e6-180">This lists all of the jobs created by this runbook.</span></span> <span data-ttu-id="971e6-181">В нем должно быть только одно задание, так как мы запускали задание только один раз.</span><span class="sxs-lookup"><span data-stu-id="971e6-181">We should only see one job listed since we only ran the job once.</span></span><br><br> <span data-ttu-id="971e6-182">![Список заданий](media/automation-first-runbook-textual-powershell/runbook-control-job-tile.png)</span><span class="sxs-lookup"><span data-stu-id="971e6-182">![Job List](media/automation-first-runbook-textual-powershell/runbook-control-job-tile.png)</span></span>  
12. <span data-ttu-id="971e6-183">Если щелкнуть это задание, откроется та же область заданий, которую мы видели при запуске модуля runbook.</span><span class="sxs-lookup"><span data-stu-id="971e6-183">You can click this job to open the same Job pane that we viewed when we started the runbook.</span></span> <span data-ttu-id="971e6-184">С ее помощью можно вернуться назад и просмотреть сведения о любом задании, созданном для конкретного модуля Runbook.</span><span class="sxs-lookup"><span data-stu-id="971e6-184">This allows you to go back in time and view the details of any job that was created for a particular runbook.</span></span>

## <a name="step-5---add-authentication-to-manage-azure-resources"></a><span data-ttu-id="971e6-185">Шаг 5. Добавление проверки подлинности для управления ресурсами Azure</span><span class="sxs-lookup"><span data-stu-id="971e6-185">Step 5 - Add authentication to manage Azure resources</span></span>
<span data-ttu-id="971e6-186">Мы протестировали и опубликовали свой модуль Runbook, но пока он не выполняет никаких полезных действий.</span><span class="sxs-lookup"><span data-stu-id="971e6-186">We've tested and published our runbook, but so far it doesn't do anything useful.</span></span> <span data-ttu-id="971e6-187">Нам нужно, чтобы он управлял ресурсами Azure.</span><span class="sxs-lookup"><span data-stu-id="971e6-187">We want to have it manage Azure resources.</span></span> <span data-ttu-id="971e6-188">Runbook не сможет делать это, пока не пройдет проверку подлинности с использованием учетных данных, упомянутых в [предварительных требованиях](#prerequisites).</span><span class="sxs-lookup"><span data-stu-id="971e6-188">It won't be able to do that though unless we have it authenticate using the credentials that are referred to in the [prerequisites](#prerequisites).</span></span> <span data-ttu-id="971e6-189">Для этого используется командлет **Add-AzureRmAccount** .</span><span class="sxs-lookup"><span data-stu-id="971e6-189">We do that with the **Add-AzureRmAccount** cmdlet.</span></span>

1. <span data-ttu-id="971e6-190">Откройте текстовый редактор, щелкнув **Изменить** в области MyFirstRunbook-PowerShell.</span><span class="sxs-lookup"><span data-stu-id="971e6-190">Open the textual editor by clicking **Edit** on the MyFirstRunbook-PowerShell pane.</span></span><br><br> <span data-ttu-id="971e6-191">![Изменение модуля Runbook](media/automation-first-runbook-textual-powershell/automation-runbook-controls-edit.png)</span><span class="sxs-lookup"><span data-stu-id="971e6-191">![Edit Runbook](media/automation-first-runbook-textual-powershell/automation-runbook-controls-edit.png)</span></span><br>   
2. <span data-ttu-id="971e6-192">Нам больше не потребуется использовать строку **Write-Output** , поэтому удалите ее.</span><span class="sxs-lookup"><span data-stu-id="971e6-192">We don't need the **Write-Output** line anymore, so go ahead and delete it.</span></span>
3. <span data-ttu-id="971e6-193">Введите или скопируйте и вставьте следующий код, который выполнит проверку подлинности с помощью учетной записи запуска от имени службы автоматизации:</span><span class="sxs-lookup"><span data-stu-id="971e6-193">Type or copy and paste the following code that handles the authentication with your Automation Run As account:</span></span>
   
   ```
   $Conn = Get-AutomationConnection -Name AzureRunAsConnection
   Add-AzureRMAccount -ServicePrincipal -Tenant $Conn.TenantID `
   -ApplicationId $Conn.ApplicationID -CertificateThumbprint $Conn.CertificateThumbprint
   ```
   <br>
4. <span data-ttu-id="971e6-194">Щелкните **область тестирования** , чтобы проверить модуль Runbook.</span><span class="sxs-lookup"><span data-stu-id="971e6-194">Click **Test pane** so that we can test the runbook.</span></span>
5. <span data-ttu-id="971e6-195">Щелкните **Пуск** , чтобы начать тестирование.</span><span class="sxs-lookup"><span data-stu-id="971e6-195">Click **Start** to start the test.</span></span> <span data-ttu-id="971e6-196">После его завершения на экране должны отобразиться приблизительно такие основные сведения из вашей учетной записи.</span><span class="sxs-lookup"><span data-stu-id="971e6-196">Once it completes, you should receive output similar to the following, displaying basic information from your account.</span></span> <span data-ttu-id="971e6-197">Это подтверждает допустимость учетных данных.</span><span class="sxs-lookup"><span data-stu-id="971e6-197">This confirms that the credential is valid.</span></span><br><br> <span data-ttu-id="971e6-198">![Проверка подлинности](media/automation-first-runbook-textual-powershell/runbook-auth-output.png)</span><span class="sxs-lookup"><span data-stu-id="971e6-198">![Authenticate](media/automation-first-runbook-textual-powershell/runbook-auth-output.png)</span></span>

## <a name="step-6---add-code-to-start-a-virtual-machine"></a><span data-ttu-id="971e6-199">Шаг 6. Добавление кода запуска виртуальной машины</span><span class="sxs-lookup"><span data-stu-id="971e6-199">Step 6 - Add code to start a virtual machine</span></span>
<span data-ttu-id="971e6-200">Теперь, когда модуль Runbook прошел проверку подлинности в нашей подписке Azure, можно управлять ресурсами.</span><span class="sxs-lookup"><span data-stu-id="971e6-200">Now that our runbook is authenticating to our Azure subscription, we can manage resources.</span></span> <span data-ttu-id="971e6-201">Мы добавим команду для запуска виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="971e6-201">We add a command to start a virtual machine.</span></span> <span data-ttu-id="971e6-202">Вы можете выбрать любую виртуальную машину в своей подписке Azure. Имя этой машины будет прописано в модуле runbook.</span><span class="sxs-lookup"><span data-stu-id="971e6-202">You can pick any virtual machine in your Azure subscription, and for now we will hardcode that name in the runbook.</span></span>

1. <span data-ttu-id="971e6-203">После команды *Add-AzureRmAccount* введите команду *Start-AzureRmVM -Name 'имя_ВМ' -ResourceGroupName 'имя_группы_ресурсов'*, указав имя виртуальной машины, которую нужно запустить, и имя ее группы ресурсов.</span><span class="sxs-lookup"><span data-stu-id="971e6-203">After *Add-AzureRmAccount*, type *Start-AzureRmVM -Name 'VMName' -ResourceGroupName 'NameofResourceGroup'* providing the name and Resource Group name of the virtual machine to start.</span></span>  
   
   ```
   $Conn = Get-AutomationConnection -Name AzureRunAsConnection
   Add-AzureRMAccount -ServicePrincipal -Tenant $Conn.TenantID `
   -ApplicationID $Conn.ApplicationID -CertificateThumbprint $Conn.CertificateThumbprint
   Start-AzureRmVM -Name 'VMName' -ResourceGroupName 'ResourceGroupName'
   ```
   <br>
2. <span data-ttu-id="971e6-204">Сохраните модуль Runbook, после чего щелкните **область тестирования** для выполнения проверок.</span><span class="sxs-lookup"><span data-stu-id="971e6-204">Save the runbook and then click **Test pane** so that we can test it.</span></span>
3. <span data-ttu-id="971e6-205">Щелкните **Пуск** , чтобы начать тестирование.</span><span class="sxs-lookup"><span data-stu-id="971e6-205">Click **Start** to start the test.</span></span> <span data-ttu-id="971e6-206">После завершения теста проверьте, запущена ли виртуальная машина.</span><span class="sxs-lookup"><span data-stu-id="971e6-206">Once it completes, check that the virtual machine was started.</span></span>

## <a name="step-7---add-an-input-parameter-to-the-runbook"></a><span data-ttu-id="971e6-207">Шаг 7. Добавление входного параметра в модуль Runbook</span><span class="sxs-lookup"><span data-stu-id="971e6-207">Step 7 - Add an input parameter to the runbook</span></span>
<span data-ttu-id="971e6-208">Созданный модуль runbook сейчас запускает виртуальную машину, указанную в коде модуля runbook, но лучше указать виртуальную машину при запуске runbook.</span><span class="sxs-lookup"><span data-stu-id="971e6-208">Our runbook currently starts the virtual machine that we hardcoded in the runbook, but it would be more useful if we specify the virtual machine when the runbook is started.</span></span> <span data-ttu-id="971e6-209">Для этого добавим в модуль Runbook входные параметры.</span><span class="sxs-lookup"><span data-stu-id="971e6-209">We will now add input parameters to the runbook to provide that functionality.</span></span>

1. <span data-ttu-id="971e6-210">Добавьте значения для параметров *VMName* (Имя ВМ) и *ResourceGroupName* (Имя группы ресурсов) в модуль Runbook и используйте эти переменные в командлете **Start-AzureRmVM**, как показано в примере ниже.</span><span class="sxs-lookup"><span data-stu-id="971e6-210">Add parameters for *VMName* and *ResourceGroupName* to the runbook and use these variables with the **Start-AzureRmVM** cmdlet as in the example below.</span></span>  
   
   ```
   Param(
    [string]$VMName,
    [string]$ResourceGroupName
   )
   $Conn = Get-AutomationConnection -Name AzureRunAsConnection
   Add-AzureRMAccount -ServicePrincipal -Tenant $Conn.TenantID `
   -ApplicationID $Conn.ApplicationID -CertificateThumbprint $Conn.CertificateThumbprint
   Start-AzureRmVM -Name $VMName -ResourceGroupName $ResourceGroupName
   ```
   <br>
2. <span data-ttu-id="971e6-211">Сохраните модуль Runbook и откройте область тестирования.</span><span class="sxs-lookup"><span data-stu-id="971e6-211">Save the runbook and open the Test pane.</span></span> <span data-ttu-id="971e6-212">Теперь можно указать значения двух входных переменных, которые будут использоваться в тесте.</span><span class="sxs-lookup"><span data-stu-id="971e6-212">You can now provide values for the two input variables that are used in the test.</span></span>
3. <span data-ttu-id="971e6-213">Закройте область тестирования.</span><span class="sxs-lookup"><span data-stu-id="971e6-213">Close the Test pane.</span></span>
4. <span data-ttu-id="971e6-214">Щелкните **Опубликовать** , чтобы опубликовать новую версию модуля Runbook.</span><span class="sxs-lookup"><span data-stu-id="971e6-214">Click **Publish** to publish the new version of the runbook.</span></span>
5. <span data-ttu-id="971e6-215">Остановите виртуальную машину, запущенную на предыдущем этапе.</span><span class="sxs-lookup"><span data-stu-id="971e6-215">Stop the virtual machine that you started in the previous step.</span></span>
6. <span data-ttu-id="971e6-216">Щелкните **Пуск** , чтобы запустить модуль Runbook.</span><span class="sxs-lookup"><span data-stu-id="971e6-216">Click **Start** to start the runbook.</span></span> <span data-ttu-id="971e6-217">Введите значения **VMName** и **ResourceGroupName** для виртуальной машины, которую нужно запустить.</span><span class="sxs-lookup"><span data-stu-id="971e6-217">Type in the **VMName** and **ResourceGroupName** for the virtual machine that you're going to start.</span></span><br><br> <span data-ttu-id="971e6-218">![Передача параметра](media/automation-first-runbook-textual-powershell/automation-pass-params.png)</span><span class="sxs-lookup"><span data-stu-id="971e6-218">![Pass Parameter](media/automation-first-runbook-textual-powershell/automation-pass-params.png)</span></span><br>  
7. <span data-ttu-id="971e6-219">Когда модуль Runbook будет выполнен, проверьте, запустилась ли виртуальная машина.</span><span class="sxs-lookup"><span data-stu-id="971e6-219">When the runbook completes, check that the virtual machine was started.</span></span>

## <a name="differences-from-powershell-workflow"></a><span data-ttu-id="971e6-220">Отличия от рабочего процесса PowerShell</span><span class="sxs-lookup"><span data-stu-id="971e6-220">Differences from PowerShell Workflow</span></span>
<span data-ttu-id="971e6-221">Модули runbook PowerShell имеют тот же жизненный цикл, возможности и средства управления, что и модули runbook рабочих процессов PowerShell, но существуют некоторые различия и ограничения.</span><span class="sxs-lookup"><span data-stu-id="971e6-221">PowerShell runbooks have the same lifecycle, capabilities, and management as PowerShell Workflow runbooks but there are some differences and limitations:</span></span>

1. <span data-ttu-id="971e6-222">Модули Runbook PowerShell выполняются быстрее (по сравнению с модулями Runbook рабочих процессов PowerShell), так как они не имеют этапа компиляции.</span><span class="sxs-lookup"><span data-stu-id="971e6-222">PowerShell runbooks run fast compared to PowerShell Workflow runbooks as they don’t have compilation step.</span></span>
2. <span data-ttu-id="971e6-223">Модули Runbook PowerShell поддерживают контрольные точки, с помощью которых их выполнение можно возобновить с любого момента, тогда как модули Runbook рабочих процессов PowerShell можно возобновить только с начала.</span><span class="sxs-lookup"><span data-stu-id="971e6-223">PowerShell Workflow runbooks support checkpoints, using checkpoints, PowerShell Workflow runbooks can resume from any point in the runbook whereas PowerShell runbooks can only resume from the beginning.</span></span>
3. <span data-ttu-id="971e6-224">Модули Runbook PowerShell поддерживают параллельное и последовательное выполнение, тогда как модули Runbook рабочих процессов PowerShell могут выполнять команды только последовательно.</span><span class="sxs-lookup"><span data-stu-id="971e6-224">PowerShell Workflow runbooks support parallel and serial execution whereas PowerShell runbooks can only execute commands serially.</span></span>
4. <span data-ttu-id="971e6-225">В модуле runbook рабочего процесса PowerShell действие, команда или блок скрипта могут иметь свои собственные пространства выполнения, тогда как в модуле runbook PowerShell все содержимое скрипта выполняется в одном пространстве выполнения.</span><span class="sxs-lookup"><span data-stu-id="971e6-225">In a PowerShell Workflow runbook, an activity, a command, or a script block can have its own runspace whereas in a PowerShell runbook, everything in a script runs in a single runspace.</span></span> <span data-ttu-id="971e6-226">Кроме того, существуют некоторые [синтаксические различия](https://technet.microsoft.com/magazine/dn151046.aspx) между собственным модулем Runbook PowerShell и модулем Runbook рабочих процессов PowerShell.</span><span class="sxs-lookup"><span data-stu-id="971e6-226">There are also some [syntactic differences](https://technet.microsoft.com/magazine/dn151046.aspx) between a native PowerShell runbook and a PowerShell Workflow runbook.</span></span>

## <a name="next-steps"></a><span data-ttu-id="971e6-227">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="971e6-227">Next steps</span></span>
* <span data-ttu-id="971e6-228">Чтобы начать работу с графическими модулями Runbook, см. инструкции в статье [Первый графический Runbook](automation-first-runbook-graphical.md).</span><span class="sxs-lookup"><span data-stu-id="971e6-228">To get started with Graphical runbooks, see [My first graphical runbook](automation-first-runbook-graphical.md)</span></span>
* <span data-ttu-id="971e6-229">Чтобы приступить к работе с модулями Runbook рабочих процессов PowerShell, обратитесь к статье [Мой первый модуль Runbook рабочего процесса PowerShell](automation-first-runbook-textual.md)</span><span class="sxs-lookup"><span data-stu-id="971e6-229">To get started with PowerShell workflow runbooks, see [My first PowerShell workflow runbook](automation-first-runbook-textual.md)</span></span>
* <span data-ttu-id="971e6-230">Чтобы получить дополнительные сведения о типах модулей Runbook, их преимуществах и ограничениях, обратитесь к статье [Типы модулей Runbook в службе автоматизации Azure](automation-runbook-types.md)</span><span class="sxs-lookup"><span data-stu-id="971e6-230">To know more about runbook types, their advantages and limitations, see [Azure Automation runbook types](automation-runbook-types.md)</span></span>
* <span data-ttu-id="971e6-231">Дополнительные сведения о функции поддержки скриптов PowerShell см. в статье [Announcing Native PowerShell Script Support in Azure Automation](https://azure.microsoft.com/blog/announcing-powershell-script-support-azure-automation-2/) (Встроенная поддержка скриптов PowerShell в службе автоматизации Azure).</span><span class="sxs-lookup"><span data-stu-id="971e6-231">For more information on PowerShell script support feature, see [Native PowerShell script support in Azure Automation](https://azure.microsoft.com/blog/announcing-powershell-script-support-azure-automation-2/)</span></span>

