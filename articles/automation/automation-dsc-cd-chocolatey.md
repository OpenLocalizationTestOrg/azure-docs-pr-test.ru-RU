---
title: "Автоматизация DSC непрерывное развертывание с Chocolatey aaaAzure | Документы Microsoft"
description: "Непрерывное развертывание DevOps с помощью Automation DSC Azure и диспетчера пакетов Chocolatey.  Пример с полным шаблоном ARM в формате JSON и исходным кодом PowerShell."
services: automation
documentationcenter: 
author: eslesar
manager: carmonm
editor: tysonn
ms.assetid: c0baa411-eb76-4f91-8d14-68f68b4805b6
ms.service: automation
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: na
ms.date: 10/29/2016
ms.author: golive
ms.openlocfilehash: 60af52af5f834fd48e3a0dc4677919397b53f0f4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="usage-example-continuous-deployment-toovirtual-machines-using-automation-dsc-and-chocolatey"></a><span data-ttu-id="b49ff-104">Пример использования: TooVirtual непрерывное развертывание компьютеров с помощью DSC службы автоматизации и Chocolatey</span><span class="sxs-lookup"><span data-stu-id="b49ff-104">Usage Example: Continuous deployment tooVirtual Machines using Automation DSC and Chocolatey</span></span>
<span data-ttu-id="b49ff-105">В мире DevOps существует множество средств tooassist с различными точками в конвейере hello непрерывной интеграции.</span><span class="sxs-lookup"><span data-stu-id="b49ff-105">In a DevOps world there are many tools tooassist with various points in hello Continuous Integration pipeline.</span></span>  <span data-ttu-id="b49ff-106">Конфигурация Azure Automation требуемого состояния (DSC) является приветствия параметры toohello новый добавления, можно использовать команды DevOps.</span><span class="sxs-lookup"><span data-stu-id="b49ff-106">Azure Automation Desired State Configuration (DSC) is a welcome new addition toohello options that DevOps teams can employ.</span></span>  <span data-ttu-id="b49ff-107">В этой статье показана настройка непрерывного развертывания для компьютера Windows.</span><span class="sxs-lookup"><span data-stu-id="b49ff-107">This article demonstrates setting up Continuous Deployment (CD) for a Windows computer.</span></span>  <span data-ttu-id="b49ff-108">Можно легко расширить tooinclude метод hello столько компьютеров Windows, необходимости в роли hello (веб-сайта, например), а также из отсутствует tooadditional также ролей.</span><span class="sxs-lookup"><span data-stu-id="b49ff-108">You can easily extend hello technique tooinclude as many Windows computers as necessary in hello role (a web site, for example), and from there tooadditional roles as well.</span></span>

![Непрерывное развертывание для виртуальных машин IaaS](./media/automation-dsc-cd-chocolatey/cdforiaasvm.png)

## <a name="at-a-high-level"></a><span data-ttu-id="b49ff-110">На высоком уровне</span><span class="sxs-lookup"><span data-stu-id="b49ff-110">At a high level</span></span>
<span data-ttu-id="b49ff-111">Эта схема включает немало действий, но, к счастью, их можно разбить на два основных процесса:</span><span class="sxs-lookup"><span data-stu-id="b49ff-111">There is quite a bit going on here, but fortunately it can be broken into two main processes:</span></span> 

* <span data-ttu-id="b49ff-112">Написание кода и его тестирование, создание и публикация установочные пакеты для основной и вспомогательной версии системы hello.</span><span class="sxs-lookup"><span data-stu-id="b49ff-112">Writing code and testing it, then creating and publishing installation packages for major and minor versions of hello system.</span></span> 
* <span data-ttu-id="b49ff-113">Создание и управление ими виртуальных машин, которые будут устанавливаться и выполнения кода hello в пакеты hello.</span><span class="sxs-lookup"><span data-stu-id="b49ff-113">Creating and managing VMs that will install and execute hello code in hello packages.</span></span>  

<span data-ttu-id="b49ff-114">Эти основные процессы выполняются в месте, он после обновления hello короткий шаг tooautomatically пакет, запущенный на любой конкретной виртуальной Машины, как новые версии созданы и развертываются.</span><span class="sxs-lookup"><span data-stu-id="b49ff-114">Once both of these core processes are in place, it’s a short step tooautomatically update hello package running on any particular VM as new versions are created and deployed.</span></span>

## <a name="component-overview"></a><span data-ttu-id="b49ff-115">Обзор компонентов</span><span class="sxs-lookup"><span data-stu-id="b49ff-115">Component overview</span></span>
<span data-ttu-id="b49ff-116">Пакет диспетчеры, такие как [apt get](https://en.wikipedia.org/wiki/Advanced_Packaging_Tool) , довольно хорошо известен в Linux Здравствуй, мир, но не слишком много ресурсов в мире Windows hello.</span><span class="sxs-lookup"><span data-stu-id="b49ff-116">Package managers such as [apt-get](https://en.wikipedia.org/wiki/Advanced_Packaging_Tool) are pretty well known in hello Linux world, but not so much in hello Windows world.</span></span>  <span data-ttu-id="b49ff-117">[Chocolatey](https://chocolatey.org/) такого результата, а также Скотт Хансельман [блог](http://www.hanselman.com/blog/IsTheWindowsUserReadyForAptget.aspx) на hello раздел является отличным введение.</span><span class="sxs-lookup"><span data-stu-id="b49ff-117">[Chocolatey](https://chocolatey.org/) is such a thing, and Scott Hanselman’s [blog](http://www.hanselman.com/blog/IsTheWindowsUserReadyForAptget.aspx) on hello topic is a great intro.</span></span>  <span data-ttu-id="b49ff-118">По сути Chocolatey позволяет tooinstall пакеты из центрального репозитория пакетов в системе Windows, с помощью командной строки hello.</span><span class="sxs-lookup"><span data-stu-id="b49ff-118">In a nutshell, Chocolatey allows you tooinstall packages from a central repository of packages into a Windows system using hello command line.</span></span>  <span data-ttu-id="b49ff-119">Вы можете создать собственный репозиторий и управлять им, а Chocolatey будет устанавливать пакеты из любого указанного вами количества репозиториев.</span><span class="sxs-lookup"><span data-stu-id="b49ff-119">You can create and manage your own repository, and Chocolatey can install packages from any number of repositories that you designate.</span></span>

<span data-ttu-id="b49ff-120">Требуемого состояния (DSC) ([Обзор](https://technet.microsoft.com/library/dn249912.aspx)) — это средство PowerShell, который позволяет вам toodeclare hello необходимую конфигурацию для машины.</span><span class="sxs-lookup"><span data-stu-id="b49ff-120">Desired State Configuration (DSC) ([overview](https://technet.microsoft.com/library/dn249912.aspx)) is a PowerShell tool that allows you toodeclare hello configuration that you want for a machine.</span></span>  <span data-ttu-id="b49ff-121">Например, вы можете указать, что нужно установить Chocolatey и IIS, открыть порт 80 и установить версию 1.0.0 вашего веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="b49ff-121">For example, you can say, “I want Chocolatey installed, I want IIS installed, I want port 80 opened, I want version 1.0.0 of my website installed.”</span></span>  <span data-ttu-id="b49ff-122">Hello DSC локальный диспетчер конфигураций (LCM) развертывает этой конфигурации.</span><span class="sxs-lookup"><span data-stu-id="b49ff-122">hello DSC Local Configuration Manager (LCM) implements that configuration.</span></span> <span data-ttu-id="b49ff-123">Опрашивающий сервер DSC содержит хранилище конфигураций для компьютеров.</span><span class="sxs-lookup"><span data-stu-id="b49ff-123">A DSC Pull Server holds a repository of configurations for your machines.</span></span> <span data-ttu-id="b49ff-124">Hello LCM на каждом компьютере флажок в периодически toosee его конфигурация соответствует hello хранимой.</span><span class="sxs-lookup"><span data-stu-id="b49ff-124">hello LCM on each machine checks in periodically toosee if its configuration matches hello stored configuration.</span></span> <span data-ttu-id="b49ff-125">Он сообщения о состоянии или попытка toobring hello машины обратно в соответствие с сохраненной конфигурации hello.</span><span class="sxs-lookup"><span data-stu-id="b49ff-125">It can either report status or attempt toobring hello machine back into alignment with hello stored configuration.</span></span> <span data-ttu-id="b49ff-126">Вы можете изменить hello сохраненной конфигурации на hello опрашивающего сервера toocause компьютер или набор toocome машины в соответствие с hello изменения конфигурации.</span><span class="sxs-lookup"><span data-stu-id="b49ff-126">You can edit hello stored configuration on hello pull server toocause a machine or set of machines toocome into alignment with hello changed configuration.</span></span>

<span data-ttu-id="b49ff-127">Служба автоматизации Azure является управляемой службой в Microsoft Azure, которая позволяет tooautomate различных задач с помощью Runbook, узлы, учетные данные, ресурсы и ресурсы, например расписания и глобальные переменные.</span><span class="sxs-lookup"><span data-stu-id="b49ff-127">Azure Automation is a managed service in Microsoft Azure that allows you tooautomate various tasks using runbooks, nodes, credentials, resources and assets such as schedules and global variables.</span></span> <span data-ttu-id="b49ff-128">Azure Automation DSC расширяет автоматизация средства PowerShell DSC tooinclude возможностей.</span><span class="sxs-lookup"><span data-stu-id="b49ff-128">Azure Automation DSC extends this automation capability tooinclude PowerShell DSC tools.</span></span>  <span data-ttu-id="b49ff-129">Вот прекрасный [обзор](automation-dsc-overview.md)на эту тему.</span><span class="sxs-lookup"><span data-stu-id="b49ff-129">Here’s a great [overview](automation-dsc-overview.md).</span></span>

<span data-ttu-id="b49ff-130">Ресурс DSC — это модуль кода, который имеет определенные возможности, такие как управление сетевыми подключениями, Active Directory или SQL Server.</span><span class="sxs-lookup"><span data-stu-id="b49ff-130">A DSC Resource is a module of code that has specific capabilities, such as managing networking, Active Directory, or SQL Server.</span></span>  <span data-ttu-id="b49ff-131">Hello Chocolatey ресурса DSC знает, как tooaccess сервера NuGet (среди прочих), загрузить пакеты установки пакетов и т. д.</span><span class="sxs-lookup"><span data-stu-id="b49ff-131">hello Chocolatey DSC Resource knows how tooaccess a NuGet Server (among others), download packages, install packages, and so on.</span></span>  <span data-ttu-id="b49ff-132">Существует множество других ресурсов DSC в hello [коллекции PowerShell](http://www.powershellgallery.com/packages?q=dsc+resources&prerelease=&sortOrder=package-title).</span><span class="sxs-lookup"><span data-stu-id="b49ff-132">There are many other DSC Resources in hello [PowerShell Gallery](http://www.powershellgallery.com/packages?q=dsc+resources&prerelease=&sortOrder=package-title).</span></span>  <span data-ttu-id="b49ff-133">Эти модули установлены на опрашивающем сервере Automation DSC Azure (вручную), поэтому их можно использовать в ваших конфигурациях.</span><span class="sxs-lookup"><span data-stu-id="b49ff-133">These modules are installed into your Azure Automation DSC Pull Server (by you) so they can be used by your configurations.</span></span>

<span data-ttu-id="b49ff-134">Шаблоны Resource Manager предоставляют декларативный способ создания инфраструктуры с помощью сетей, подсетей, сетевой безопасности и маршрутизации, подсистем балансировки нагрузки, сетевых карт, виртуальных машин и т. д.</span><span class="sxs-lookup"><span data-stu-id="b49ff-134">Resource Manager templates provide a declarative way of generating your infrastructure - things like networks, subnets, network security and routing, load balancers, NICs, VMs, and so on.</span></span>  <span data-ttu-id="b49ff-135">Вот [статье](../azure-resource-manager/resource-manager-deployment-model.md) , сравнивает hello (декларативной) модели развертывания диспетчера ресурсов с hello управления службами Azure (ASM или Классическая) развертывания модели (принудительные), а также обсуждаются основные ресурсы hello поставщики, вычислений, хранилища и сети.</span><span class="sxs-lookup"><span data-stu-id="b49ff-135">Here’s an [article](../azure-resource-manager/resource-manager-deployment-model.md) that compares hello Resource Manager deployment model (declarative) with hello Azure Service Management (ASM, or classic) deployment model (imperative), and discusses hello core resource providers, compute, storage and network.</span></span>

<span data-ttu-id="b49ff-136">Одна важная особенность шаблона диспетчера ресурсов является tooinstall его возможности расширения ВМ в hello виртуальной Машины, как он задан.</span><span class="sxs-lookup"><span data-stu-id="b49ff-136">One key feature of an Resource Manager template is its ability tooinstall a VM extension into hello VM as it’s provisioned.</span></span>  <span data-ttu-id="b49ff-137">Расширение VM предоставляет определенные возможности, такие как выполнение пользовательского сценария, установка антивирусного программного обеспечения или выполнение сценария конфигурации DSC.</span><span class="sxs-lookup"><span data-stu-id="b49ff-137">A VM extension has specific capabilities such as running a custom script, installing anti-virus software, or running a DSC configuration script.</span></span>  <span data-ttu-id="b49ff-138">Существует много других типов расширений VM.</span><span class="sxs-lookup"><span data-stu-id="b49ff-138">There are many other types of VM extensions.</span></span>

## <a name="quick-trip-around-hello-diagram"></a><span data-ttu-id="b49ff-139">Быстрый trip вокруг диаграммы hello</span><span class="sxs-lookup"><span data-stu-id="b49ff-139">Quick trip around hello diagram</span></span>
<span data-ttu-id="b49ff-140">Начиная с верхней hello, писать код, построения и тестирования, а затем создайте пакет установки.</span><span class="sxs-lookup"><span data-stu-id="b49ff-140">Starting at hello top, you write your code, build and test, then create an installation package.</span></span>  <span data-ttu-id="b49ff-141">Chocolatey может обрабатывать пакеты установки различных типов, например MSI, MSU и ZIP.</span><span class="sxs-lookup"><span data-stu-id="b49ff-141">Chocolatey can handle various types of installation packages, such as MSI, MSU, ZIP.</span></span>  <span data-ttu-id="b49ff-142">И иметь hello всю мощь PowerShell toodo hello фактической установки, если собственных возможностей Chocolatey не совсем вверх tooit.</span><span class="sxs-lookup"><span data-stu-id="b49ff-142">And you have hello full power of PowerShell toodo hello actual installation if Chocolatey’s native capabilities aren’t quite up tooit.</span></span>  <span data-ttu-id="b49ff-143">Перевести hello пакет в неизвестной точке достижимым — репозитория пакетов.</span><span class="sxs-lookup"><span data-stu-id="b49ff-143">Put hello package into someplace reachable – a package repository.</span></span>  <span data-ttu-id="b49ff-144">Он может располагаться где угодно. Например, в этом примере используется общая папка в учетной записи хранилища больших двоичных объектов Azure.</span><span class="sxs-lookup"><span data-stu-id="b49ff-144">This usage example uses a public folder in an Azure blob storage account, but it can be anywhere.</span></span>  <span data-ttu-id="b49ff-145">Chocolatey работает непосредственно с серверами NuGet и некоторыми другими серверами в рамках управления метаданными пакета.</span><span class="sxs-lookup"><span data-stu-id="b49ff-145">Chocolatey works natively with NuGet servers and a few others for management of package metadata.</span></span>  <span data-ttu-id="b49ff-146">[В этой статье](https://github.com/chocolatey/choco/wiki/How-To-Host-Feed) описаны параметры hello.</span><span class="sxs-lookup"><span data-stu-id="b49ff-146">[This article](https://github.com/chocolatey/choco/wiki/How-To-Host-Feed) describes hello options.</span></span>  <span data-ttu-id="b49ff-147">В этом примере используется NuGet.</span><span class="sxs-lookup"><span data-stu-id="b49ff-147">This usage example uses NuGet.</span></span>  <span data-ttu-id="b49ff-148">Nuspec — это метаданные о пакетах.</span><span class="sxs-lookup"><span data-stu-id="b49ff-148">A Nuspec is metadata about your packages.</span></span>  <span data-ttu-id="b49ff-149">Hello Nuspec «компилируются» в его NuPkg и хранящихся на сервере NuGet.</span><span class="sxs-lookup"><span data-stu-id="b49ff-149">hello Nuspec’s are “compiled” into NuPkg’s and stored in a NuGet server.</span></span>  <span data-ttu-id="b49ff-150">Когда конфигурацию запрашивает пакет по имени, а также ссылается на сервер NuGet, hello Chocolatey ресурса DSC (в настоящее время на hello ВМ) извлекает пакет hello и устанавливает его автоматически.</span><span class="sxs-lookup"><span data-stu-id="b49ff-150">When your configuration requests a package by name, and references a NuGet server, hello Chocolatey DSC Resource (now on hello VM) grabs hello package and installs it for you.</span></span>  <span data-ttu-id="b49ff-151">Можно также запросить определенную версию пакета.</span><span class="sxs-lookup"><span data-stu-id="b49ff-151">You can also request a specific version of a package.</span></span>

<span data-ttu-id="b49ff-152">В hello нижней левой части рисунка hello имеется шаблон диспетчера ресурсов Azure (ARM).</span><span class="sxs-lookup"><span data-stu-id="b49ff-152">In hello bottom left portion of hello picture, there is an Azure Resource Manager (ARM) template.</span></span>  <span data-ttu-id="b49ff-153">В этом примере использования hello расширения виртуальной Машины регистрирует hello виртуальной Машины с hello Azure Automation DSC опрашивающего сервера (то есть опрашивающего сервера) в качестве узла.</span><span class="sxs-lookup"><span data-stu-id="b49ff-153">In this usage example, hello VM extension registers hello VM with hello Azure Automation DSC Pull Server (that is, a pull server) as a Node.</span></span>  <span data-ttu-id="b49ff-154">Hello конфигурация хранится в hello опрашивающего сервера.</span><span class="sxs-lookup"><span data-stu-id="b49ff-154">hello configuration is stored in hello pull server.</span></span>  <span data-ttu-id="b49ff-155">На самом деле это двойное хранение: в виде обычного текста и в виде компиляции в MOF-файле (для тех, кто имеет опыт работы с такими файлами).  В портале hello hello MOF — «конфигурация узла» (как противоположность toosimply «конфигурация»).</span><span class="sxs-lookup"><span data-stu-id="b49ff-155">Actually, it’s stored twice: once as plain text and once compiled as an MOF file (for those that know about such things.)  In hello portal, hello MOF is a “node configuration” (as opposed toosimply “configuration”).</span></span>  <span data-ttu-id="b49ff-156">Он является hello артефакт, связанный с узлом, узел hello будете знать его конфигурации.</span><span class="sxs-lookup"><span data-stu-id="b49ff-156">It’s hello artifact that’s associated with a Node so hello node will know its configuration.</span></span>  <span data-ttu-id="b49ff-157">Ниже приведены сведения показывают, как tooassign hello toohello конфигурации каждого узла.</span><span class="sxs-lookup"><span data-stu-id="b49ff-157">Details below show how tooassign hello node configuration toohello node.</span></span>

<span data-ttu-id="b49ff-158">Скорее всего вы выполняете уже бит hello вверху hello или большую его часть.</span><span class="sxs-lookup"><span data-stu-id="b49ff-158">Presumably you’re already doing hello bit at hello top, or most of it.</span></span>  <span data-ttu-id="b49ff-159">Создание hello nuspec, компиляции и сохранить их на сервере NuGet — это небольшие вещь.</span><span class="sxs-lookup"><span data-stu-id="b49ff-159">Creating hello nuspec, compiling and storing it in a NuGet server is a small thing.</span></span>  <span data-ttu-id="b49ff-160">Кроме того, вы уже управляете виртуальными машинами.</span><span class="sxs-lookup"><span data-stu-id="b49ff-160">And you’re already managing VMs.</span></span>  <span data-ttu-id="b49ff-161">Получение hello следующего шага toocontinuous развертывания требуется настройка опрашивающего сервера hello (один раз), регистрирует узлы (один раз) и создание и хранение hello конфигурации существует (первоначально).</span><span class="sxs-lookup"><span data-stu-id="b49ff-161">Taking hello next step toocontinuous deployment requires setting up hello pull server (once), registering your nodes with it (once), and creating and storing hello configuration there (initially).</span></span>  <span data-ttu-id="b49ff-162">Как пакеты будут обновлены и развернуты репозитория toohello обновите hello конфигурации и конфигурации узлов в hello опрашивающего сервера (повторите при необходимости).</span><span class="sxs-lookup"><span data-stu-id="b49ff-162">Then as packages are upgraded and deployed toohello repository, refresh hello Configuration and Node Configuration in hello pull server (repeat as needed).</span></span>

<span data-ttu-id="b49ff-163">Начинать работу с шаблона ARM не обязательно.</span><span class="sxs-lookup"><span data-stu-id="b49ff-163">If you’re not starting with an ARM template, that’s also OK.</span></span>  <span data-ttu-id="b49ff-164">Нет регистрации виртуальных машин в hello опрашивающего сервера и всех остальных hello toohelp командлетов PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b49ff-164">There are PowerShell cmdlets designed toohelp you register your VMs with hello pull server and all of hello rest.</span></span> <span data-ttu-id="b49ff-165">Дополнительные сведения см. в статье [Подключение компьютеров для управления с помощью Azure Automation DSC](automation-dsc-onboarding.md).</span><span class="sxs-lookup"><span data-stu-id="b49ff-165">For more details, see this article: [Onboarding machines for management by Azure Automation DSC](automation-dsc-onboarding.md)</span></span>

## <a name="step-1-setting-up-hello-pull-server-and-automation-account"></a><span data-ttu-id="b49ff-166">Шаг 1: Настройка hello опрашивающего сервера и автоматизации учетной записи</span><span class="sxs-lookup"><span data-stu-id="b49ff-166">Step 1: Setting up hello pull server and automation account</span></span>
<span data-ttu-id="b49ff-167">Проверкой подлинности командной строки PowerShell (Add-AzureRmAccount): (может занять несколько минут пока Настройка hello опрашивающего сервера)</span><span class="sxs-lookup"><span data-stu-id="b49ff-167">At an authenticated (Add-AzureRmAccount) PowerShell command line:  (can take a few minutes while hello pull server is set up)</span></span>

    New-AzureRmResourceGroup –Name MY-AUTOMATION-RG –Location MY-RG-LOCATION-IN-QUOTES
    New-AzureRmAutomationAccount –ResourceGroupName MY-AUTOMATION-RG –Location MY-RG-LOCATION-IN-QUOTES –Name MY-AUTOMATION-ACCOUNT 

<span data-ttu-id="b49ff-168">Можно поместить ваша учетная запись автоматизации в любые hello следующих областей (также называемого местоположение): восточная часть США 2, центральных штатах юга США, Вирджиния государственных организаций США, Западная Европа, Юго-Восточная Азия, восток Японии, центральной Индии и Юго-Восточная Австралия, Канады центра Северной Европе.</span><span class="sxs-lookup"><span data-stu-id="b49ff-168">You can put your automation account into any of hello following regions (aka location):  East US 2, South Central US, US Gov Virginia, West Europe, Southeast Asia, Japan East, Central India and Australia Southeast, Canada Central, North Europe.</span></span>

## <a name="step-2-vm-extension-tweaks-toohello-arm-template"></a><span data-ttu-id="b49ff-169">Шаг 2: Расширение ВМ модификации toohello шаблон ARM</span><span class="sxs-lookup"><span data-stu-id="b49ff-169">Step 2: VM extension tweaks toohello ARM template</span></span>
<span data-ttu-id="b49ff-170">Сведения о регистрации виртуальной Машины (с помощью расширения PowerShell DSC VM hello), в [шаблона быстрый запуск Azure](https://github.com/Azure/azure-quickstart-templates/tree/master/dsc-extension-azure-automation-pullserver).</span><span class="sxs-lookup"><span data-stu-id="b49ff-170">Details for VM registration (using hello PowerShell DSC VM extension) provided in this [Azure Quickstart Template](https://github.com/Azure/azure-quickstart-templates/tree/master/dsc-extension-azure-automation-pullserver).</span></span>  <span data-ttu-id="b49ff-171">Этот шаг регистрирует новый ВМ hello опрашивающий сервер в список hello узлов DSC.</span><span class="sxs-lookup"><span data-stu-id="b49ff-171">This step registers your new VM with hello pull server in hello list of DSC Nodes.</span></span>  <span data-ttu-id="b49ff-172">Часть этой регистрации: необходимо указать hello конфигурации применены toobe toohello каждого узла.</span><span class="sxs-lookup"><span data-stu-id="b49ff-172">Part of this registration is specifying hello node configuration toobe applied toohello node.</span></span>  <span data-ttu-id="b49ff-173">Эта конфигурация узла нет tooexist еще в hello опрашивающего сервера, поэтому он действителен шаг 4 — где это делается для hello первый раз.</span><span class="sxs-lookup"><span data-stu-id="b49ff-173">This node configuration doesn't have tooexist yet in hello pull server, so it's OK that Step 4 is where this is done for hello first time.</span></span>  <span data-ttu-id="b49ff-174">Однако здесь на этапе 2 необходима toohave решение hello имя узла hello и hello имя конфигурации hello.</span><span class="sxs-lookup"><span data-stu-id="b49ff-174">But here in Step 2 you do need toohave decided hello name of hello node and hello name of hello configuration.</span></span>  <span data-ttu-id="b49ff-175">В этом примере использования hello узел является «isvbox» и «ISVBoxConfig» hello настроен.</span><span class="sxs-lookup"><span data-stu-id="b49ff-175">In this usage example, hello node is 'isvbox' and hello configuration is 'ISVBoxConfig'.</span></span>  <span data-ttu-id="b49ff-176">Поэтому имя конфигурации узла hello (указанный в DeploymentTemplate.json toobe) — «ISVBoxConfig.isvbox».</span><span class="sxs-lookup"><span data-stu-id="b49ff-176">So hello node configuration name (toobe specified in DeploymentTemplate.json) is 'ISVBoxConfig.isvbox'.</span></span>  

## <a name="step-3-adding-required-dsc-resources-toohello-pull-server"></a><span data-ttu-id="b49ff-177">Шаг 3: Добавление необходимых опрашивающего сервера DSC ресурсы toohello</span><span class="sxs-lookup"><span data-stu-id="b49ff-177">Step 3: Adding required DSC resources toohello pull server</span></span>
<span data-ttu-id="b49ff-178">Hello коллекции PowerShell — инструментированного tooinstall ресурсов DSC в учетную запись службы автоматизации Azure.</span><span class="sxs-lookup"><span data-stu-id="b49ff-178">hello PowerShell Gallery is instrumented tooinstall DSC resources into your Azure Automation account.</span></span>  <span data-ttu-id="b49ff-179">Перейдите toohello ресурсов и щелкните кнопку «Развернуть tooAzure автоматизации» hello.</span><span class="sxs-lookup"><span data-stu-id="b49ff-179">Navigate toohello resource you want and click hello “Deploy tooAzure Automation” button.</span></span>

![Пример из коллекции PowerShell](./media/automation-dsc-cd-chocolatey/xNetworking.PNG)

<span data-ttu-id="b49ff-181">Другим способом все добавленные toohello портал Azure позволяет toopull в новый или существующий модулями обновления.</span><span class="sxs-lookup"><span data-stu-id="b49ff-181">Another technique recently added toohello Azure Portal allows you toopull in new modules or update existing modules.</span></span> <span data-ttu-id="b49ff-182">Пролистайте ресурсов учетной записи автоматизации hello, Плитка активы hello и наконец hello модули плитки.</span><span class="sxs-lookup"><span data-stu-id="b49ff-182">Click through hello Automation Account resource, hello Assets tile, and finally hello Modules tile.</span></span>  <span data-ttu-id="b49ff-183">значок обзора коллекции Hello позволяет toosee hello список модулей в галерее hello, перейти к подробным сведениям и в конечном счете импортируйте в вашей учетной записи автоматизации.</span><span class="sxs-lookup"><span data-stu-id="b49ff-183">hello Browse Gallery icon allows you toosee hello list of modules in hello gallery, drill down into details and ultimately import into your Automation Account.</span></span> <span data-ttu-id="b49ff-184">Это является tookeep хорошим способом модули вверх toodate из tootime времени.</span><span class="sxs-lookup"><span data-stu-id="b49ff-184">This is a great way tookeep your modules up toodate from time tootime.</span></span> <span data-ttu-id="b49ff-185">И функцию импорта hello проверяет зависимости с другими tooensure модули, ничего не получает синхронизированы.</span><span class="sxs-lookup"><span data-stu-id="b49ff-185">And, hello import feature checks dependencies with other modules tooensure nothing gets out of sync.</span></span>

<span data-ttu-id="b49ff-186">Или не существует подхода вручную hello.</span><span class="sxs-lookup"><span data-stu-id="b49ff-186">Or, there’s hello manual approach.</span></span>  <span data-ttu-id="b49ff-187">Структура папок Hello модуля интеграции для компьютеров Windows PowerShell немного отличается от структуры папок hello ожидаемый hello автоматизации Azure.</span><span class="sxs-lookup"><span data-stu-id="b49ff-187">hello folder structure of a PowerShell Integration Module for a Windows computer is a little different from hello folder structure expected by hello Azure Automation.</span></span>  <span data-ttu-id="b49ff-188">Некоторые параметры вам придется настроить самостоятельно.</span><span class="sxs-lookup"><span data-stu-id="b49ff-188">This requires a little tweaking on your part.</span></span>  <span data-ttu-id="b49ff-189">Но это несложно, и выполняется только один раз для каждого ресурса (если не требуется, чтобы tooupgrade его в будущем.)  Дополнительные сведения о разработке модулей интеграции PowerShell см. в статье [Authoring Integration Modules for Azure Automation](https://azure.microsoft.com/blog/authoring-integration-modules-for-azure-automation/) (Разработка модулей интеграции для службы автоматизации Azure).</span><span class="sxs-lookup"><span data-stu-id="b49ff-189">But it’s not hard, and it’s done only once per resource (unless you want tooupgrade it in future.)  For more information on authoring PowerShell Integration Modules, see this article: [Authoring Integration Modules for Azure Automation](https://azure.microsoft.com/blog/authoring-integration-modules-for-azure-automation/)</span></span>

* <span data-ttu-id="b49ff-190">Установка модуля hello, необходимое на рабочей станции следующим образом:</span><span class="sxs-lookup"><span data-stu-id="b49ff-190">Install hello module that you need on your workstation, as follows:</span></span>
  * <span data-ttu-id="b49ff-191">Установите [Windows Management Framework 5](http://aka.ms/wmf5latest) (не требуется для Windows 10).</span><span class="sxs-lookup"><span data-stu-id="b49ff-191">Install [Windows Management Framework, v5](http://aka.ms/wmf5latest) (not needed for Windows 10)</span></span>
  * <span data-ttu-id="b49ff-192">`Install-Module –Name MODULE-NAME`< — грабс hello модуля из коллекции PowerShell hello</span><span class="sxs-lookup"><span data-stu-id="b49ff-192">`Install-Module –Name MODULE-NAME`    <—grabs hello module from hello PowerShell Gallery</span></span> 
* <span data-ttu-id="b49ff-193">Скопировать папку модуля hello из `c:\Program Files\WindowsPowerShell\Modules\MODULE-NAME` tooa временной папке</span><span class="sxs-lookup"><span data-stu-id="b49ff-193">Copy hello module folder from `c:\Program Files\WindowsPowerShell\Modules\MODULE-NAME` tooa temp folder</span></span> 
* <span data-ttu-id="b49ff-194">Удалить из главной папки hello примеров и документации</span><span class="sxs-lookup"><span data-stu-id="b49ff-194">Delete samples and documentation from hello main folder</span></span> 
* <span data-ttu-id="b49ff-195">ZIP-папки основной hello, точно именования hello ZIP-файл hello же, как папка hello</span><span class="sxs-lookup"><span data-stu-id="b49ff-195">Zip hello main folder, naming hello ZIP file exactly hello same as hello folder</span></span> 
* <span data-ttu-id="b49ff-196">Поместите hello ZIP-файл в достижимым расположении HTTP, например хранилище больших двоичных объектов в учетной записи хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="b49ff-196">Put hello ZIP file into a reachable HTTP location, such as blob storage in an Azure Storage Account.</span></span>
* <span data-ttu-id="b49ff-197">Выполните эту команду PowerShell:</span><span class="sxs-lookup"><span data-stu-id="b49ff-197">Run this PowerShell:</span></span>
  
      New-AzureRmAutomationModule `
          -ResourceGroupName MY-AUTOMATION-RG -AutomationAccountName MY-AUTOMATION-ACCOUNT `
          -Name MODULE-NAME –ContentLink "https://STORAGE-URI/CONTAINERNAME/MODULE-NAME.zip"

<span data-ttu-id="b49ff-198">пример Hello включены выполняет следующие действия для cChoco и xNetworking.</span><span class="sxs-lookup"><span data-stu-id="b49ff-198">hello included example performs these steps for cChoco and xNetworking.</span></span> <span data-ttu-id="b49ff-199">В разделе hello [заметки](#notes) для специальной обработки для cChoco.</span><span class="sxs-lookup"><span data-stu-id="b49ff-199">See hello [Notes](#notes) for special handling for cChoco.</span></span>

## <a name="step-4-adding-hello-node-configuration-toohello-pull-server"></a><span data-ttu-id="b49ff-200">Шаг 4: Добавление hello узел toohello опрашивающего сервера</span><span class="sxs-lookup"><span data-stu-id="b49ff-200">Step 4: Adding hello node configuration toohello pull server</span></span>
<span data-ttu-id="b49ff-201">Нет ничего особенного hello первый раз импортировать конфигурацию в hello опрашивающего сервера и компиляции.</span><span class="sxs-lookup"><span data-stu-id="b49ff-201">There’s nothing special about hello first time you import your configuration into hello pull server and compile.</span></span>  <span data-ttu-id="b49ff-202">Все последующие импорта/компиляции из hello конфигурации выглядят точно hello таким же.</span><span class="sxs-lookup"><span data-stu-id="b49ff-202">All subsequent import/compiles of hello same configuration look exactly hello same.</span></span>  <span data-ttu-id="b49ff-203">Каждый раз, ваш пакет обновления и требуется его tooproduction выполнением этого действия после того как убедитесь файл конфигурации hello toopush правильность — включая hello новой версии пакета.</span><span class="sxs-lookup"><span data-stu-id="b49ff-203">Each time you update your package and need toopush it out tooproduction you do this step after ensuring hello configuration file is correct – including hello new version of your package.</span></span>  <span data-ttu-id="b49ff-204">Ниже приведен файл конфигурации hello и PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b49ff-204">Here’s hello configuration file and PowerShell:</span></span>

<span data-ttu-id="b49ff-205">ISVBoxConfig.ps1:</span><span class="sxs-lookup"><span data-stu-id="b49ff-205">ISVBoxConfig.ps1:</span></span>

    Configuration ISVBoxConfig 
    { 
        Import-DscResource -ModuleName cChoco 
        Import-DscResource -ModuleName xNetworking

        Node "isvbox" {   

            cChocoInstaller installChoco 
            { 
                InstallDir = "C:\choco" 
            }

            WindowsFeature installIIS 
            { 
                Ensure="Present" 
                Name="Web-Server" 
            }

            xFirewall WebFirewallRule 
            { 
                Direction = "Inbound" 
                Name = "Web-Server-TCP-In" 
                DisplayName = "Web Server (TCP-In)" 
                Description = "IIS allow incoming web site traffic." 
                DisplayGroup = "IIS Incoming Traffic" 
                State = "Enabled" 
                Access = "Allow" 
                Protocol = "TCP" 
                LocalPort = "80" 
                Ensure = "Present" 
            }

            cChocoPackageInstaller trivialWeb 
            {            
                Name = "trivialweb" 
                Version = "1.0.0" 
                Source = “MY-NUGET-V2-SERVER-ADDRESS” 
                DependsOn = "[cChocoInstaller]installChoco", 
                "[WindowsFeature]installIIS" 
            } 
        }    
    }

<span data-ttu-id="b49ff-206">New-ConfigurationScript.ps1:</span><span class="sxs-lookup"><span data-stu-id="b49ff-206">New-ConfigurationScript.ps1:</span></span>

    Import-AzureRmAutomationDscConfiguration ` 
        -ResourceGroupName MY-AUTOMATION-RG –AutomationAccountName MY-AUTOMATION-ACCOUNT ` 
        -SourcePath C:\temp\AzureAutomationDsc\ISVBoxConfig.ps1 ` 
        -Published –Force

    $jobData = Start-AzureRmAutomationDscCompilationJob ` 
        -ResourceGroupName MY-AUTOMATION-RG –AutomationAccountName MY-AUTOMATION-ACCOUNT ` 
        -ConfigurationName ISVBoxConfig 

    $compilationJobId = $jobData.Id

    Get-AzureRmAutomationDscCompilationJob ` 
        -ResourceGroupName MY-AUTOMATION-RG –AutomationAccountName MY-AUTOMATION-ACCOUNT ` 
        -Id $compilationJobId

<span data-ttu-id="b49ff-207">Эти действия приводят к новой конфигурации узла с именем «ISVBoxConfig.isvbox», размещенной на hello опрашивающего сервера.</span><span class="sxs-lookup"><span data-stu-id="b49ff-207">These steps result in a new node configuration named “ISVBoxConfig.isvbox” being placed on hello pull server.</span></span>  <span data-ttu-id="b49ff-208">Имя конфигурации узла Hello построен как «configurationName.nodeName».</span><span class="sxs-lookup"><span data-stu-id="b49ff-208">hello node configuration name is built as “configurationName.nodeName”.</span></span>

## <a name="step-5-creating-and-maintaining-package-metadata"></a><span data-ttu-id="b49ff-209">Шаг 5. Создание и поддержка метаданных пакета</span><span class="sxs-lookup"><span data-stu-id="b49ff-209">Step 5: Creating and maintaining package metadata</span></span>
<span data-ttu-id="b49ff-210">Для каждого пакета, помещенному в hello репозитория пакетов необходимо nuspec, описывающим его.</span><span class="sxs-lookup"><span data-stu-id="b49ff-210">For each package that you put into hello package repository, you need a nuspec that describes it.</span></span>  <span data-ttu-id="b49ff-211">Эти метаданные Nuspec следует компилировать и хранить на сервере NuGet.</span><span class="sxs-lookup"><span data-stu-id="b49ff-211">That nuspec must be compiled and stored in your NuGet server.</span></span> <span data-ttu-id="b49ff-212">Этот процесс описан [здесь](http://docs.nuget.org/create/creating-and-publishing-a-package).</span><span class="sxs-lookup"><span data-stu-id="b49ff-212">This process is described [here](http://docs.nuget.org/create/creating-and-publishing-a-package).</span></span>  <span data-ttu-id="b49ff-213">В качестве сервера NuGet можно использовать сайт MyGet.org.</span><span class="sxs-lookup"><span data-stu-id="b49ff-213">You can use MyGet.org as a NuGet server.</span></span>  <span data-ttu-id="b49ff-214">Это платная служба, но начальные единицы хранения предоставляются бесплатно.</span><span class="sxs-lookup"><span data-stu-id="b49ff-214">They sell this service, but have a starter SKU that’s free.</span></span>  <span data-ttu-id="b49ff-215">На сайте NuGet.org вы найдете инструкции по установке сервера NuGet для закрытых пакетов.</span><span class="sxs-lookup"><span data-stu-id="b49ff-215">At NuGet.org you’ll find instructions on installing your own NuGet server for your private packages.</span></span>

## <a name="step-6-tying-it-all-together"></a><span data-ttu-id="b49ff-216">Шаг 6. Сборка</span><span class="sxs-lookup"><span data-stu-id="b49ff-216">Step 6: Tying it all together</span></span>
<span data-ttu-id="b49ff-217">Каждый раз версии передает QA и утверждена для развертывания, создается пакет hello, nuspec nupkg обновления и развертывания сервера toohello NuGet.</span><span class="sxs-lookup"><span data-stu-id="b49ff-217">Each time a version passes QA and is approved for deployment, hello package is created, nuspec and nupkg updated and deployed toohello NuGet server.</span></span>  <span data-ttu-id="b49ff-218">Кроме того hello конфигурации (шаг 4 выше) должен быть обновленные tooagree с hello новый номер версии.</span><span class="sxs-lookup"><span data-stu-id="b49ff-218">In addition, hello configuration (Step 4 above) must be updated tooagree with hello new version number.</span></span>  <span data-ttu-id="b49ff-219">Должно быть отправлено toohello опрашивающего сервера и компиляции.</span><span class="sxs-lookup"><span data-stu-id="b49ff-219">It must be sent toohello pull server and compiled.</span></span>  <span data-ttu-id="b49ff-220">С этого момента это toohello виртуальных машин, которые зависят от конфигурации toopull hello обновления и установить его.</span><span class="sxs-lookup"><span data-stu-id="b49ff-220">From that point on, it's up toohello VMs that depend on that configuration toopull hello update and install it.</span></span>  <span data-ttu-id="b49ff-221">Каждое такое обновление довольно просто и представляет собой одну-две строки кода PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b49ff-221">Each of these updates are simple - just a line or two of PowerShell.</span></span>  <span data-ttu-id="b49ff-222">В случае Visual Studio Team Services hello некоторые из них содержатся в задачи сборки, которые можно соединять друг с другом в сборке.</span><span class="sxs-lookup"><span data-stu-id="b49ff-222">In hello case of Visual Studio Team Services, some of them are encapsulated in build tasks that can be chained together in a build.</span></span>  <span data-ttu-id="b49ff-223">Дополнительные сведения см. в [этой статье](https://www.visualstudio.com/en-us/docs/alm-devops-feature-index#continuous-delivery).</span><span class="sxs-lookup"><span data-stu-id="b49ff-223">This [article](https://www.visualstudio.com/en-us/docs/alm-devops-feature-index#continuous-delivery) provides more details.</span></span>  <span data-ttu-id="b49ff-224">Это [в репозитории GitHub](https://github.com/Microsoft/vso-agent-tasks) Здравствуйте, сведения о различных доступных задач.</span><span class="sxs-lookup"><span data-stu-id="b49ff-224">This [GitHub repo](https://github.com/Microsoft/vso-agent-tasks) details hello various available build tasks.</span></span>

## <a name="notes"></a><span data-ttu-id="b49ff-225">Примечания</span><span class="sxs-lookup"><span data-stu-id="b49ff-225">Notes</span></span>
<span data-ttu-id="b49ff-226">В этом примере использования начинается с виртуальной Машины с помощью универсального образа Windows Server 2012 R2 из коллекции Azure hello.</span><span class="sxs-lookup"><span data-stu-id="b49ff-226">This usage example starts with a VM from a generic Windows Server 2012 R2 image from hello Azure gallery.</span></span>  <span data-ttu-id="b49ff-227">Можно запустить из любой хранимой образа, а затем настроить оттуда с hello конфигурации DSC.</span><span class="sxs-lookup"><span data-stu-id="b49ff-227">You can start from any stored image and then tweak from there with hello DSC configuration.</span></span>  <span data-ttu-id="b49ff-228">Однако изменения конфигурации, который является помещенного в изображение будет гораздо сложнее, чем динамическое обновление конфигурации hello, с помощью DSC.</span><span class="sxs-lookup"><span data-stu-id="b49ff-228">However, changing configuration that is baked into an image is much harder than dynamically updating hello configuration using DSC.</span></span>

<span data-ttu-id="b49ff-229">У вас нет toouse шаблон ARM и toouse расширения ВМ hello этот способ с виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="b49ff-229">You don’t have toouse an ARM template and hello VM extension toouse this technique with your VMs.</span></span>  <span data-ttu-id="b49ff-230">И виртуальные машины, у вас нет toobe на Azure toobe в группе управления компакт-диска.</span><span class="sxs-lookup"><span data-stu-id="b49ff-230">And your VMs don’t have toobe on Azure toobe under CD management.</span></span>  <span data-ttu-id="b49ff-231">Все, что необходим, Chocolatey будет установлен, а также hello НОК настроен на hello виртуальной Машины, она знает, где hello опрашивающего сервера.</span><span class="sxs-lookup"><span data-stu-id="b49ff-231">All that’s necessary is that Chocolatey be installed and hello LCM configured on hello VM so it knows where hello pull server is.</span></span>  

<span data-ttu-id="b49ff-232">Конечно при обновлении пакета на виртуальной Машине, используемой в производственной среде, необходимо tootake эту виртуальную Машину из ротации во время установки обновления hello.</span><span class="sxs-lookup"><span data-stu-id="b49ff-232">Of course, when you update a package on a VM that’s in production, you need tootake that VM out of rotation while hello update is installed.</span></span>  <span data-ttu-id="b49ff-233">Это можно сделать разными способами.</span><span class="sxs-lookup"><span data-stu-id="b49ff-233">How you do this varies widely.</span></span>  <span data-ttu-id="b49ff-234">Например, на виртуальной машине, которая находится под контролем балансировщика нагрузки Azure, можно добавить настраиваемый зонд.</span><span class="sxs-lookup"><span data-stu-id="b49ff-234">For example, with a VM behind an Azure Load Balancer, you can add a Custom Probe.</span></span>  <span data-ttu-id="b49ff-235">При обновлении hello виртуальной Машины, иметь hello пробы конечную точку вернуть 400.</span><span class="sxs-lookup"><span data-stu-id="b49ff-235">While updating hello VM, have hello probe endpoint return a 400.</span></span>  <span data-ttu-id="b49ff-236">необходимые toocause Hello оптимизировать это изменение может быть внутри вашей конфигурации, как можно оптимизировать tooswitch обратно tooreturning 200 после завершения обновления hello "hello".</span><span class="sxs-lookup"><span data-stu-id="b49ff-236">hello tweak necessary toocause this change can be inside your configuration, as can hello tweak tooswitch it back tooreturning a 200 once hello update is complete.</span></span>

<span data-ttu-id="b49ff-237">Полный исходный код для этого примера хранится в [этом проекте Visual Studio](https://github.com/sebastus/ARM/tree/master/CDIaaSVM) на сайте GitHub.</span><span class="sxs-lookup"><span data-stu-id="b49ff-237">Full source for this usage example is in [this Visual Studio project](https://github.com/sebastus/ARM/tree/master/CDIaaSVM) on GitHub.</span></span>

## <a name="related-articles"></a><span data-ttu-id="b49ff-238">Связанные статьи</span><span class="sxs-lookup"><span data-stu-id="b49ff-238">Related Articles</span></span>
* [<span data-ttu-id="b49ff-239">Обзор DSC службы автоматизации Azure</span><span class="sxs-lookup"><span data-stu-id="b49ff-239">Azure Automation DSC Overview</span></span>](automation-dsc-overview.md)
* [<span data-ttu-id="b49ff-240">Командлеты Automation DSC Azure</span><span class="sxs-lookup"><span data-stu-id="b49ff-240">Azure Automation DSC cmdlets</span></span>](https://msdn.microsoft.com/library/mt244122.aspx)
* [<span data-ttu-id="b49ff-241">Подключение компьютеров для управления с помощью Azure Automation DSC</span><span class="sxs-lookup"><span data-stu-id="b49ff-241">Onboarding machines for management by Azure Automation DSC</span></span>](automation-dsc-onboarding.md)

