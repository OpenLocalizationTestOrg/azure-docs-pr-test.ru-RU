---
title: "Управление обновлениями для нескольких виртуальных машин Azure | Документация Майкрософт"
description: "В этой статье описывается управление обновлениями для виртуальных машин Azure."
services: automation
documentationcenter: 
author: georgewallace
manager: carmonm
editor: 
ms.assetid: 
ms.service: automation
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 11/30/2017
ms.author: magoedte;gwallace
ms.openlocfilehash: 1763077aa733fc93dd59147405db9942c6c98960
ms.sourcegitcommit: 9292e15fc80cc9df3e62731bafdcb0bb98c256e1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/10/2018
---
# <a name="manage-updates-for-multiple-machines"></a>Управление обновлениями для нескольких виртуальных машин

С помощью управления обновлениями вы можете управлять обновлениями и исправлениями виртуальных машин Windows и Linux. В учетной записи [службы автоматизации Azure](automation-offering-get-started.md) вы можете сделать следующее:

- подключить виртуальные машины;
- оценить состояние доступных обновлений;
- запланировать установку необходимых обновлений;
- проверить результаты развертывания, чтобы убедиться, что обновления были успешно применены на всех виртуальных машинах, для которых включено управление обновлениями.

## <a name="prerequisites"></a>Необходимые компоненты

Чтобы использовать управление обновлениями, требуется:

* Учетная запись запуска от имени службы автоматизации Azure. Инструкции по созданию учетной записи см. в статье [Приступая к работе со службой автоматизации Azure](automation-offering-get-started.md).

* Виртуальная машина или компьютер, где установлена одна из поддерживаемых операционных систем.

## <a name="supported-operating-systems"></a>Поддерживаемые операционные системы

Решение управления обновлениями поддерживается в следующих операционных системах.

### <a name="windows"></a>Windows

* Windows Server 2008 и более поздние версии и развертывания обновлений в Windows Server 2008 R2 с пакетом обновления 1 (SP1) и более поздних версий. Nano Server не поддерживается.

  Для поддержки развертывания обновлений в Windows Server 2008 R2 с пакетом обновления 1 (SP1) требуется .NET Framework 4.5 и Windows Management Framework 5.0 или более поздней версии.

* Операционные системы клиента Windows не поддерживаются.

На агентах Windows необходимо настроить связь с сервером служб Windows Server Update Services (WSUS) или доступ к Центру обновления Майкрософт.

> [!NOTE]
> Агентом Windows невозможно управлять параллельно с помощью System Center Configuration Manager.
>

### <a name="linux"></a>Linux

* CentOS 6 (x86 или x64) и 7 (x64).  
* Red Hat Enterprise 6 (x86 или x64) и 7 (x64).  
* SUSE Linux Enterprise Server 11 (x86 или x64) и 12 (x64)  
* Ubuntu 12.04 LTS и более поздних версий (x86 или x64).   

> [!NOTE]  
> Чтобы обновления применялись только в период обслуживания в Ubuntu, повторно настройте пакет unattended-upgrades и отключите автоматическое обновление. Дополнительные сведения см. в разделе об [автоматических обновлениях руководства по Ubuntu Server](https://help.ubuntu.com/lts/serverguide/automatic-updates.html).

У агентов Linux должен быть доступ к репозиторию обновлений.

Это решение не поддерживает агент Operations Management Suite (OMS) для Linux, настроенный для отправки отчетов в несколько рабочих областей OMS.

## <a name="enable-update-management-for-azure-virtual-machines"></a>Включение управления обновлениями для виртуальных машин Azure

1. На портале Azure откройте учетную запись службы автоматизации.
2. На панели слева выберите **Управление обновлениями**.
3. В верхней части окна щелкните **Добавить виртуальную машину Azure**.
   ![Вкладка "Добавить виртуальную машину Azure"](./media/manage-update-multi/update-onboard-vm.png)
4. Выберите виртуальную машину для подключения. Появится диалоговое окно **Включение управления обновлениями**.
5. Нажмите кнопку **Включить**.

   ![Диалоговое окно "Включение управления обновлениями"](./media/manage-update-multi/update-enable.png)

Управление обновлениями включено для виртуальной машины.

## <a name="enable-update-management-for-non-azure-virtual-machines-and-computers"></a>Включение управления обновлениями для виртуальных машин Azure и компьютеров

Инструкции по включению управления обновлениями для компьютеров и виртуальных машин Windows, не относящихся к Azure, см. в статье [Подключение компьютеров Windows к службе Log Analytics в Azure](../log-analytics/log-analytics-windows-agent.md).

Инструкции по включению управления обновлениями для компьютеров и виртуальных машин Linux, не относящихся к Azure, см. в статье [Подключение компьютеров Linux к Log Analytics](../log-analytics/log-analytics-agent-linux.md).

## <a name="view-computers-attached-to-your-automation-account"></a>Просмотр сведений о компьютерах, подключенных к учетной записи службы автоматизации
Включив управление обновлениями для компьютеров, можно просмотреть сведения о них, нажав кнопку **Компьютеры**. Доступны такие сведения, как *имя*, *соответствие*, *среда*, *тип ОС*, *критически важные обновления и обновления для системы безопасности* , а также *другие обновления*. 

  ![Просмотр вкладки "Компьютеры"](./media/manage-update-multi/update-computers-tab.png)

Если управление обновлениями недавно включено для компьютеров, возможно, они еще не оценивались. Для таких компьютеров будет отображаться состояние соответствия *Без оценки*.  Вот список возможных значений состояния соответствия:
* "Соответствует" — компьютеры, на которых установлены все критически важные обновления и обновления для системы безопасности.
* "Не соответствует" — компьютеры, на которых отсутствует как минимум одно критически важное обновление или обновление для системы безопасности.
* "Без оценки" — данные оценки обновления не были получены от компьютера в течение ожидаемого отрезка времени  (для компьютеров Linux — за последние три часа, для компьютеров Windows — за последние 12 часов).  

## <a name="view-an-update-assessment"></a>Просмотр оценки обновлений

Когда вы включите решение управления обновлениями, отобразится экран **Управление обновлениями**. На вкладке **Отсутствующие обновления** можно просмотреть список отсутствующих обновлений.

## <a name="collect-data"></a>Сбор данных

Агенты, установленные на виртуальных машинах и компьютерах, собирают данные об обновлениях и отправляют их в решение управления обновлениями Azure.

### <a name="supported-agents"></a>Поддерживаемые агенты

В приведенной ниже таблице описаны подключенные источники, которые поддерживает это решение.

| Подключенный источник | Поддерживаются | ОПИСАНИЕ |
| --- | --- | --- |
| Агенты Windows |Yes |Решение управления обновлениями собирает сведения об обновлениях системы с агентов Windows и запускает установку требуемых обновлений. |
| Агенты Linux |Yes |Решение управления обновлениями собирает сведения об обновлениях системы с агентов Linux и запускает установку требуемых обновлений для поддерживаемых дистрибутивов. |
| Группа управления Operations Manager |Yes |Решение управления обновлениями собирает сведения о системных обновлениях с агентов, состоящих в подключенной группе обновления. |
| Учетная запись хранения Azure. |Нет  |В хранилище Azure не хранятся сведения о системных обновлениях. |

### <a name="collection-frequency"></a>Частота сбора

Дважды в день выполняется проверка каждого управляемого компьютера Windows. Каждые 15 минут вызывается API Windows, чтобы запросить время последнего обновления и определить, изменилось ли состояние. Если состояние изменилось, запускается проверка на соответствие. Каждые три часа выполняется проверка всех управляемых компьютеров Linux.

Отображение обновленных данных с управляемых компьютеров на панели мониторинга может занять от 30 минут до 6 часов.

## <a name="schedule-an-update-deployment"></a>Планирование развертывания обновлений

Чтобы установить обновления, составьте план развертывания в рамках графика выпуска и периода обслуживания.
Вы можете выбрать типы обновлений, которые будут включены в развертывание. Например, можно включить только критические обновления или обновления для системы безопасности и исключить накопительные пакеты обновления.

Запланируйте новое развертывание обновлений для одной или нескольких виртуальных машин, щелкнув **Запланировать развертывание обновлений** в верхней части диалогового окна **Управление обновлениями**. На панели **Новое развертывание обновления** укажите следующее:

* **Имя**. Введите уникальное имя для идентификации развертывания обновлений.
* **Тип ОС**. Выберите Windows или Linux.
* **Обновляемые компьютеры**. Выберите виртуальные машины, которые необходимо обновить.

  ![Панель "Новое развертывание обновления"](./media/manage-update-multi/update-select-computers.png)

* **Категория обновления**. Выберите типы программного обеспечения, которые будут включены в развертывание обновления. Ниже приведены типы классификации:
  * критические обновления;
  * обновления для системы безопасности;
  * накопительные пакеты обновления;
  * пакеты дополнительных компонентов;
  * пакеты обновления;
  * обновления определений;
  * Средства
  * Обновления
* **Параметры расписания**. Вы можете принять дату и время по умолчанию (на 30 минут позже текущего времени) либо указать другое время.
   Кроме того, можно указать, происходит ли развертывание один раз или повторяется по расписанию. Чтобы настроить регулярное расписание, щелкните параметр **Повторяющееся** в разделе **Повторение**.

   ![Диалоговое окно "Параметры расписания"](./media/manage-update-multi/update-set-schedule.png)

* **Период обслуживания (минуты)**. Укажите период времени, в течение которого должно произойти обновление развертывания. Этот параметр позволяет гарантировать, что изменения выполняются в рамках заданного периода обслуживания.

Когда вы завершите настройку расписания, вернитесь к панели мониторинга состояния, нажав кнопку **Создать**. В таблице **Запланированные** отобразится созданное расписание развертываний.

> [!WARNING]
> Для обновлений, требующих перезагрузки, виртуальная машина перезапустится автоматически.

## <a name="view-results-of-an-update-deployment"></a>Просмотр результатов развертывания обновлений

После запуска запланированного развертывания его состояние можно просмотреть на вкладке **Развертывания обновлений** в диалоговом окне **Управление обновлениями**.
Если развертывание выполняется в этот момент, отображается состояние **Выполняется**. Когда развертывание успешно завершится, состояние изменится на **Успешно**.
В случае сбоя одного или нескольких обновлений при развертывании для состояния отобразится значение **Частичный сбой**.

![Состояние обновления развертывания](./media/manage-update-multi/update-view-results.png)

Щелкните завершенное развертывание обновлений, чтобы просмотреть панель мониторинга этого развертывания.

На панели **Результаты обновления** отображается общее количество обновлений и результаты развертывания на виртуальной машине.
В таблице справа представлен подробный разбор каждого обновления и результатов установки. Результаты установки могут принимать одно из следующих значений:

* Попытка не предпринималась — обновление не установлено из-за недостатка времени в соответствии с заданным периодом обслуживания.
* Выполнено — обновление успешно выполнено.
* Сбой — обновление не удалось выполнить.

Чтобы просмотреть все записи журнала, созданные при развертывании, щелкните **Все журналы**.

Щелкните плитку **Выходные данные**, чтобы просмотреть поток заданий модуля runbook, который управляет развертыванием обновления на целевой виртуальной машине.

Чтобы просмотреть подробные сведения об ошибках развертывания, щелкните **Ошибки**.

## <a name="next-steps"></a>Дополнительная информация

* Дополнительные сведения об управлении обновлениями, включая журналы, выходные данные и ошибки, см. в статье [Решение для управления обновлениями в OMS](../operations-management-suite/oms-solution-update-management.md).

