---
title: "Приступая к работе со службой автоматизации Azure | Документация Майкрософт"
description: "В этой статье содержится обзор службы автоматизации Azure и сведения о разработке и реализации в рамках подготовки к внедрению предложения из Azure Marketplace."
services: automation
documentationcenter: 
author: eslesar
manager: carmonm
editor: 
ms.assetid: 
ms.service: automation
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 08/31/2017
ms.author: magoedte
ms.openlocfilehash: fad13053895c5d6e3c41835fea3cf0bdd3380cd4
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="getting-started-with-azure-automation"></a>Приступая к работе со службой автоматизации Azure

В этом руководстве представлены основные понятия, связанные с развертыванием службы автоматизации Azure. Если вы не знакомы с автоматизацией в Azure или у вас есть опыт работы с программным обеспечением для автоматизации рабочих процессов, например с System Center Orchestrator, из этого руководства вы узнаете об особенностях подготовки и внедрения автоматизации.  Оно подготовит вас к разработке модулей Runbook для поддержки автоматизации процесса. 


## <a name="automation-architecture-overview"></a>Общие сведения об архитектуре автоматизации

![Обзор службы автоматизации Azure](media/automation-offering-get-started/automation-infradiagram-networkcomms.png)

Служба автоматизации Azure — это программное обеспечение как услуга, которое предоставляет масштабируемую и надежную мультитенантную среду для автоматизации процессов с помощью модулей Runbook и управления изменениями конфигурации систем Windows и Linux с помощью настройки требуемого состояния (DSC) в Azure, других облачных службах и в локальной среде. Сущности внутри вашей учетной записи службы автоматизации, например модули Runbook, ресурсы, учетные записи запуска от имени, изолированы от других учетных записей службы автоматизации в вашей и других подписках.  

Модули Runbook, запускаемые в Azure, выполняются в "песочницах" службы автоматизации, размещенных на виртуальных машинах PaaS Azure.  "Песочница" службы автоматизации обеспечивает изоляцию клиентов во всех аспектах выполнения модулей Runbook (модули, хранилище, память, сетевое взаимодействие, потоки заданий и т. д.). Этой ролью управляет служба. Ею невозможно управлять из вашей учетной записи Azure или учетной записи службы автоматизации Azure.         

Чтобы автоматизировать развертывание и администрирование ресурсов в локальном центре обработки данных или других облачных службах, после создания учетной записи службы автоматизации назначьте один или несколько компьютеров для выполнения [гибридной рабочей роли Runbook](automation-hybrid-runbook-worker.md).  Для выполнения каждой гибридной рабочей роли Runbook требуется Microsoft Management Agent с подключением к рабочей области Log Analytics, а также учетная запись службы автоматизации.  Log Analytics используется для начальной загрузки средства установки, обслуживания агента Microsoft Management Agent и мониторинга выполнения гибридной рабочей роли Runbook.  Предоставление элементов Runbook и инструкций по их запуску выполняется службой автоматизации Azure.

Вы можете развернуть несколько гибридных рабочих ролей Runbook для обеспечения высокого уровня доступности модулей Runbook, заданий Runbook балансировки нагрузки, а в некоторых случаях для назначения этих ролей определенным рабочим нагрузкам или средам.  Агент Microsoft Monitoring Agent в гибридной рабочей роли Runbook инициирует обмен данными со службой автоматизации через TCP-порт 443. Требования к брандмауэру для входящих подключений отсутствуют.  Чтобы модуль Runbook, запущенный в гибридной рабочей роли Runbook в пределах среды, выполнял задачи управления на других компьютерах или службах в среде, вам может понадобиться открыть доступ к дополнительным портам.  Если политики ИТ-безопасности запрещают подключение компьютеров в сети к Интернету, ознакомьтесь со статьей [Подключения компьютеров к OMS с помощью шлюза OMS без доступа к Интернету](../log-analytics/log-analytics-oms-gateway.md). Шлюз OMS выступает в качестве прокси-сервера, чтобы гибридная рабочая роль Runbook могла собирать данные о состоянии заданий и получать сведения о конфигурации из вашей учетной записи службы автоматизации.

Модули Runbook, выполняемые в гибридной рабочей роли Runbook, запускаются в контексте локальной системной учетной записи на компьютере, который является рекомендуемым контекстом безопасности при выполнении административных задач на локальном компьютере Windows. Если вам нужно, чтобы модуль Runbook выполнял задачи с ресурсами за пределами локального компьютера, может потребоваться определить безопасные ресурсы учетных данных в учетной записи службы автоматизации, доступ к которым можно получить из модуля Runbook и которые можно использовать для проверки подлинности внешнего ресурса. В модуле Runbook можно использовать ресурсы [учетных данных](automation-credentials.md), [сертификата](automation-certificates.md) и [подключения](automation-connections.md) с командлетами, которые позволяют указывать такие данные для аутентификации.

Конфигурации DSC, хранимые в службе автоматизации Azure, можно применить непосредственно к виртуальным машинам Azure. Другие физические компьютеры и виртуальные машины могут запрашивать конфигурации с опрашивающего сервера DSC службы автоматизации Azure.  Чтобы управлять конфигурациями локальных физических или виртуальных систем Windows и Linux, не нужно развертывать инфраструктуру для поддержки опрашивающего сервера Automation DSC. Требуется только, чтобы компонент Automation DSC, взаимодействующий со службой OMS через TCP-порт 443, управлял исходящим доступом к Интернету в каждой из систем.   

## <a name="prerequisites"></a>Предварительные требования

### <a name="automation-dsc"></a>Automation DSC
Службу Azure Automation DSC можно использовать для управления разными компьютерами. Их типы перечислены ниже.

* Виртуальные машины Azure (классические) под управлением Windows или Linux.
* Виртуальные машины Azure под управлением Windows или Linux.
* Виртуальные машины Amazon Web Services (AWS) под управлением Windows или Linux.
* Физические или виртуальные машины под управлением Windows, расположенные локально или в облачной службе, отличной от Azure или AWS.
* Физические или виртуальные машины под управлением Linux, расположенные локально или в облачной службе, отличной от Azure или AWS.

Должна быть установлена последняя версия WMF 5, чтобы агент PowerShell DSC для Windows имел возможность обмениваться данными со службой автоматизации Azure. Должна быть установлена последняя версия [агента PowerShell DSC для Linux](https://www.microsoft.com/en-us/download/details.aspx?id=49150), чтобы ОС Linux имела возможность обмениваться данными со службой автоматизации Azure.

### <a name="hybrid-runbook-worker"></a>гибридный компонент Runbook Worker  
При назначении компьютера для запуска гибридной рабочей роли Runbook на нем нужно установить следующие компоненты, а также он должен обладать следующими характеристиками:

* Windows Server 2012 или более поздней версии;
* Windows PowerShell, начиная с версии 4.0.  Для повышения надежности работы мы советуем установить на компьютерах Windows PowerShell версии 5.0. Новую версию можно скачать в [Центре загрузки Майкрософт](https://www.microsoft.com/download/details.aspx?id=50395).
* Как минимум два ядра.
* Не менее 4 ГБ ОЗУ.

### <a name="permissions-required-to-create-automation-account"></a>Разрешения, необходимые для создания учетной записи службы автоматизации
Чтобы создать или обновить учетную запись службы автоматизации, вам потребуются указанные ниже определенные привилегии и разрешения, необходимые для изучения этого раздела.   
 
* Для создания учетной записи службы автоматизации необходимо добавить учетную запись пользователя AD к роли с разрешениями, аналогичными разрешениям для роли владельца ресурсов службы автоматизации Майкрософт, как описано в статье [Управление доступом на основе ролей в службе автоматизации Azure](automation-role-based-access-control.md).  
* Пользователи без прав администратора в клиенте Azure AD могут [регистрировать приложения AD](../azure-resource-manager/resource-group-create-service-principal-portal.md#check-azure-subscription-permissions), если для параметра регистрации установлено значение **Да**.  Если для этого параметра задано значение **Нет**, пользователю потребуются права глобального администратора в Azure AD, чтобы выполнить это действие. 

Если пользователь, которому назначают роль глобального администратора или соадминистратора подписки, не является участником экземпляра подписки Active Directory, он будет добавлен в Active Directory в качестве гостя. В этом случае отобразится соответствующее предупреждение "У вас нет разрешений на создание…" в колонке **Добавление учетной записи службы автоматизации**. Пользователей, которым назначена роль соадминистратора или глобального администратора, можно удалить из экземпляра подписки Active Directory, а затем повторно добавить, чтобы предоставить им права полного доступа к Active Directory. Чтобы проверить это, на портале Azure в области **Azure Active Directory** выберите **Пользователи и группы** и **Все пользователи**. Выбрав нужного пользователя, щелкните **Профиль**. Значение атрибута **Тип пользователя** в профиле пользователя не должно соответствовать значению **Гость**.

## <a name="authentication-planning"></a>Планирование проверки подлинности
С помощью службы автоматизации Azure можно автоматизировать задачи, выполняемые с ресурсами Azure (локально), а также с ресурсами других поставщиков облачных служб.  Для выполнения необходимых действий модуль Runbook должен иметь разрешения на безопасный доступ к ресурсам с минимальными правами, требуемыми в рамках подписки.  

### <a name="what-is-an-automation-account"></a>Что такое учетная запись службы автоматизации 
Все задачи автоматизации, выполняемые с ресурсами с использованием командлетов Azure в службе автоматизации Azure, должны пройти проверку подлинности в Azure с помощью корпоративных учетных данных (удостоверения Azure Active Directory).  Учетная запись службы автоматизации отличается от учетной записи, с которой вы входите на портал для настройки и использования ресурсов Azure.  Ниже перечислены ресурсы автоматизации, включенные в учетную запись.

* **Сертификаты** — содержит сертификат для проверки подлинности из модуля Runbook или конфигурации DSC. Сертификаты можно добавлять.
* **Подключения** — содержит данные проверки подлинности и конфигурации, необходимые для подключения к внешней службе или приложению из модуля Runbook или конфигурации DSC.
* **Учетные данные** — объект PSCredential, который содержит учетные данные безопасности, такие как имя пользователя и пароль, необходимые для проверки подлинности из модуля Runbook или конфигурации DSC.
* **Модули интеграции** — модули PowerShell, включенные в учетную запись службы автоматизации Azure для использования командлетов в модулях Runbook и конфигурациях DSC.
* **Расписания** — содержит расписания, при помощи которых модуль Runbook запускается или прекращает работу в указанное время, в том числе частоту повторения этих операций.
* **Переменные** — содержит значения, доступные из модуля Runbook или конфигурации DSC.
* **Конфигурации DSC** — сценарии PowerShell, которые описывают способы настройки операционной системы, а также настройки или установки приложения на компьютере с Windows или Linux.  
* **Модули runbook** — это набор задач, которые выполняют какой-либо автоматизированный процесс в службе автоматизации Azure на основе Windows PowerShell.    

Ресурсы каждой учетной записи службы автоматизации связаны с одним регионом Azure, но учетные записи службы автоматизации могут управлять всеми ресурсами в вашей подписке. Создайте учетные записи службы автоматизации в разных регионах при наличии политик, требующих изолировать данные и ресурсы в определенном регионе.

> [!NOTE]
> Учетные записи службы автоматизации и содержащиеся в них ресурсы, которые создаются с помощью портала Azure, недоступны на классическом портале Azure. Если требуется управлять этими учетными записями или их ресурсами с помощью Windows PowerShell, необходимо использовать модули диспетчера ресурсов Azure.
> 

При создании учетной записи службы автоматизации на портале Azure автоматически создаются две приведенные ниже сущности проверки подлинности.

* Учетная запись запуска от имени. Эта учетная запись создает субъект-службу в Azure Active Directory (Azure AD) и сертификат, а также назначает управление доступом на основе ролей участника, используемое для управления ресурсами Resource Manager с помощью модулей runbook.
* Классическая учетная запись запуска от имени. Эта учетная запись отправляет сертификат управления, используемый для администрирования классических ресурсов с помощью модулей Runbook.

В режиме Azure Resource Manager контроль доступа на основе ролей можно использовать для предоставления разрешений учетной записи пользователя Azure AD и учетной записи запуска от имени, а также для проверки подлинности такого субъекта-службы.  Дополнительные сведения о разработке модели управления разрешениями в службе автоматизации см. в статье [Управление доступом на основе ролей в службе автоматизации Azure](automation-role-based-access-control.md).  

#### <a name="authentication-methods"></a>Методы проверки подлинности
В следующей таблице перечислены разные методы проверки подлинности для каждой среды, поддерживаемой службой автоматизации Azure.

| Метод | Среда 
| --- | --- | 
| Учетная запись запуска от имени Azure или классическая учетная запись запуска от имени |Azure Resource Manager и классическое развертывание Azure |  
| Учетная запись пользователя Azure AD |Azure Resource Manager и классическое развертывание Azure |  
| Проверка подлинности Windows |Локальный центр обработки данных или другой поставщик облачных решений, использующий гибридную рабочую роль Runbook |  
| Учетные данные AWS |Amazon Web Services |  

В подразделе **Проверка подлинности и безопасность** раздела "Практическое руководство" можно найти обзорные статьи, в которых содержатся инструкции по настройке проверки подлинности в средах с существующими или новыми учетными записями.  Дополнительные сведения об учетной записи запуска от имени Azure и классической учетной записи запуска от имени см. в статье [Update Automation Run As account](automation-create-runas-account.md) (Обновление учетной записи запуска от имени службы автоматизации). В ней описывается, как обновить существующую учетную запись службы автоматизации, чтобы добавить учетную запись запуска от имени с портала или при помощи PowerShell, если учетная запись запуска от имени или классическая учетная запись не были настроены изначально. Чтобы создать учетную запись запуска от имени и классическую учетную запись запуска от имени с сертификатом, выданным вашим центром сертификации предприятия (ЦС), прочтите эту статью. Она поможет в создании учетных записей с использованием данной конфигурации.     
 
## <a name="network-planning"></a>Планирование сети
Чтобы гибридная рабочая роль Runbook могла подключаться и регистрироваться в службе Microsoft Operations Management Suite (OMS), ей нужен доступ к описанным ниже портам и URL-адресам.  Этот список является дополнением к [списку ресурсов и портов](../log-analytics/log-analytics-windows-agents.md#network), необходимых для подключения Microsoft Monitoring Agent к OMS. При использовании прокси-сервера для обмена данными между агентом и службой OMS необходимо убедиться, что соответствующие ресурсы доступны. Если доступ к Интернету ограничивается брандмауэром, вам нужно изменить его настройки, чтобы разрешить доступ к OMS.

Приведенные ниже сведения — это список портов и URL-адресов для обмена данными между гибридной рабочей ролью Runbook и службой автоматизации.

* Порт: только исходящий трафик Интернета через TCP-порт 443.
* Глобальный URL-адрес: *.azure-automation.net.

Если ваша учетная запись службы автоматизации настроена для использования в определенном регионе и нужно настроить обмен данными только с центром обработки данных в этом регионе, выберите соответствующие записи DNS из следующей таблицы.

| **Регион** | **Запись DNS** |
| --- | --- |
| Южно-центральный регион США |scus-jobruntimedata-prod-su1.azure-automation.net |
| Восток США 2 |eus2-jobruntimedata-prod-su1.azure-automation.net |
| Западно-центральная часть США | wcus-jobruntimedata-prod-su1.azure-automation.net |
| Западная Европа |we-jobruntimedata-prod-su1.azure-automation.net |
| Северная Европа |ne-jobruntimedata-prod-su1.azure-automation.net |
| Центральная Канада |cc-jobruntimedata-prod-su1.azure-automation.net |
| Юго-Восточная Азия |sea-jobruntimedata-prod-su1.azure-automation.net |
| Центральная Индия |cid-jobruntimedata-prod-su1.azure-automation.net |
| Восточная часть Японии |jpe-jobruntimedata-prod-su1.azure-automation.net |
| Юго-Восточная Австралия |ase-jobruntimedata-prod-su1.azure-automation.net |
| Южная часть Великобритании | uks-jobruntimedata-prod-su1.azure-automation.net |
| Правительство штата Вирджиния | usge-jobruntimedata-prod-su1.azure-automation.us |

Для списка IP-адресов вместо имен скачайте XML-файл [IP-адресов центра обработки данных Azure](https://www.microsoft.com/download/details.aspx?id=41653) из Центра загрузки Майкрософт и ознакомьтесь с ним. 

> [!NOTE]
> Этот файл содержит диапазоны IP-адресов (включая диапазоны вычисления, хранения и SQL), используемые в центрах обработки данных Microsoft Azure. Обновленный файл публикуется еженедельно и отражает развернутые в настоящее время диапазоны и все предстоящие изменения IP-адресов. Новые диапазоны, появившиеся в файле, не будут использоваться в центрах обработки данных по крайней мере одну неделю. Скачивайте новый XML-файл каждую неделю и вносите соответствующие изменения на своем сайте, чтобы правильно определять службы, выполняемые в Azure. Пользователи Express Route могут заметить, что этот файл используется для того, чтобы обновлять объявление BGP пространства Azure в первую неделю каждого месяца. 
> 

## <a name="creating-an-automation-account"></a>Создание учетной записи службы автоматизации

Вы можете создать учетную запись службы автоматизации на портале Azure несколькими способами.  В следующей таблице представлены все варианты развертывания и различия между ними.  

|Метод | Описание |
|-------|-------------|
| Выбор автоматизации и управления из Marketplace | Предложение, которое создает учетную запись службы автоматизации и рабочее пространство OMS, связанные друг с другом в одной группе ресурсов и регионе.  Кроме того, интеграция с OMS предоставляет преимущества Log Analytics. Она обеспечивает динамический мониторинг и анализ состояния и потоков заданий модуля Runbook, а также дополнительные возможности углубленного анализа или обнаружения проблем. Также предложение развертывает решения для управления обновлениями и отслеживания изменений, которые включены по умолчанию. |
| Выбор службы автоматизации из Marketplace | Создает учетную запись службы автоматизации в новой или существующей группе ресурсов, не связанной с рабочей областью OMS и не содержащей доступные решения из предложения управления и автоматизации. Это базовая конфигурация, которая познакомит вас со службой автоматизации и поможет научиться создавать модули Runbook, конфигурации DSC и использовать функциональные возможности службы. |
| Выбор решений для управления | В случае выбора решений **[Управление обновлениями](../operations-management-suite/oms-solution-update-management.md)**, **[Запуск и остановка виртуальных машин в нерабочее время](automation-solution-vm-management.md)** или **[Отслеживание изменений](../log-analytics/log-analytics-change-tracking.md)**  вам будет предложено выбрать существующую учетную запись службы автоматизации или рабочую область OMS или создать их для развертывания решения в вашей подписке. |

В этом разделе описывается создание учетной записи службы автоматизации и рабочей области OMS путем внедрения предложения автоматизации и управления.  Чтобы создать автономную учетную запись службы автоматизации для тестирования или просмотра службы, ознакомьтесь с [этой статьей](automation-create-standalone-account.md).  

### <a name="create-automation-account-integrated-with-oms"></a>Создание учетной записи службы автоматизации, интегрированной с OMS
Рекомендованный метод внедрения службы автоматизации — выбрать предложение "Автоматизация и управление" в Marketplace.  В результате будет создана учетная запись службы автоматизации и выполнена интеграция с рабочей областью OMS с возможностью установки решений для управления, доступных в предложении.  

1. Войдите на портал Azure с помощью учетной записи, которая является участником роли "Администраторы подписки" и соадминистратором подписки.

2. Нажмите кнопку **Создать**.<br><br> ![Выбор пункта "Создать" на портале Azure](media/automation-offering-get-started/automation-portal-martketplacestart.png)<br>  

3. Выполните поиск по запросу **Автоматизация** и в поле результатов поиска выберите **Автоматизация и управление***.<br><br> ![Поиск и выбор элемента "Автоматизация и управление" в Marketplace](media/automation-offering-get-started/automation-portal-martketplace-select-automationandcontrol.png).<br>   

4. Прочитав описание предложения, щелкните **Создать**.  

5. В колонке параметров **Автоматизация и управление** выберите **Рабочая область OMS**.  В колонке **Рабочие области OMS** выберите рабочую область OMS, связанную с подпиской Azure, в которой находится учетная запись службы автоматизации, или создайте новую.  Если у вас нет рабочей области OMS, выберите **Создать рабочую область** и в колонке **Рабочая область OMS** выполните следующие действия: 
   - Укажите имя новой **рабочей области OMS**.
   - Выберите в раскрывающемся списке **подписку**, с которой нужно связать рабочую область, если выбранная по умолчанию не подходит.
   - В качестве **группы ресурсов** можно использовать имеющуюся группу или создать новую.  
   - Выберите **расположение**.  Дополнительные сведения см. в [таблице регионов, в которых доступна служба автоматизации Azure](https://azure.microsoft.com/regions/services/).  Решения предоставляются на двух уровнях: бесплатном и уровне с оплатой за каждый узел (OMS).  Бесплатный уровень имеет ограничение на ежедневный сбор данных, срок хранения и время выполнения задания Runbook.  На уровне оплаты за каждый узел (OMS) ограничение по объему ежедневно собираемых данных отсутствует.  
   - Выберите **Учетная запись службы автоматизации**.  При создании рабочей области OMS требуется также создать новую учетную запись службы автоматизации, в том числе подписку Azure, группу ресурсов и регион. Эта учетная запись будет связана с указанной ранее новой рабочей областью OMS.  Выберите **Создать учетную запись службы автоматизации** и в колонке **Учетная запись службы автоматизации** укажите следующие данные: 
  - В поле **Имя** введите имя учетной записи службы автоматизации.

    Все остальные параметры заполняются автоматически в зависимости от выбранной рабочей области OMS, и их нельзя изменить.  По умолчанию проверка подлинности осуществляется с помощью учетной записи запуска от имени Azure.  Нажмите кнопку **ОК**, чтобы проверить параметры конфигурации и создать учетную запись службы автоматизации.  Ход создания можно просмотреть в разделе **Уведомления** в меню. 

    В противном случае можно выбрать имеющуюся учетную запись запуска от имени службы автоматизации.  Выбранная учетная запись не может быть связана с другой рабочей областью OMS. Если она уже связана, в колонке отобразится уведомление.  В этом случае нужно выбрать другую учетную запись запуска от имени службы автоматизации или создать новую.

    Выполнив необходимые действия, щелкните **Создать**.  После проверки данных будут созданы учетная запись службы автоматизации и учетные записи запуска от имени.  Вы автоматически вернетесь в колонку **Рабочая область OMS**.  

6. После ввода необходимых сведений в колонке **Рабочая область OMS** щелкните **Создать**.  Пока проверяются данные, ход создания рабочей области можно проверить в разделе **Уведомления** в меню.  Затем вы вернитесь в колонку **Добавление решения**.  

7. В колонке параметров **Автоматизация и управление** подтвердите, что следует установить рекомендуемые предварительно выбранные решения. Если вы отмените выбор какого-либо решения, позже их можно будет установить по отдельности.  

8. Щелкните **Создать**, чтобы интегрировать службу автоматизации с рабочей областью OMS. После этого будут проверены все параметры, а также будет произведена попытка развернуть предложение в подписку.  Этот процесс может занять несколько секунд. Ход его выполнения можно просмотреть в разделе **Уведомления** в меню. 

После внедрения предложения можно приступить к созданию модулей Runbook, работе с включенными решениями для управления, развернуть [гибридную рабочую роль Runbook](automation-hybrid-runbook-worker.md) или начать работу с [Log Analytics](https://docs.microsoft.com/azure/log-analytics) для сбора данных, созданных ресурсами в облачной либо локальной среде.   

## <a name="next-steps"></a>Дальнейшие действия
* Чтобы убедиться, что учетная запись службы автоматизации может выполнять проверку подлинности ресурсов Azure, ознакомьтесь со статьей [Тестирование проверки подлинности учетной записи запуска от имени службы автоматизации Azure](automation-verify-runas-authentication.md).
* Перед созданием модулей Runbook изучите список поддерживаемых [типов модулей Runbook в службе автоматизации](automation-runbook-types.md) и связанные с ними рекомендации. Эти сведения помогут вам в разработке.


