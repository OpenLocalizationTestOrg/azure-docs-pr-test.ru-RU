---
title: "Обработка ошибок в графических модулях Runbook в службе автоматизации Azure | Документация Майкрософт"
description: "В этой статье описывается, как реализовать логику обработки ошибок в графических модулях Runbook в службе автоматизации Azure."
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: tysonn
ms.assetid: 
ms.service: automation
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 12/26/2016
ms.author: magoedte
ms.openlocfilehash: 12313f7f245d32c33882f1036f7d4b48bfb3ddc5
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="error-handling-in-azure-automation-graphical-runbooks"></a><span data-ttu-id="14df4-103">Обработка ошибок в графических модулях Runbook в службе автоматизации Azure</span><span class="sxs-lookup"><span data-stu-id="14df4-103">Error handling in Azure Automation graphical runbooks</span></span>

<span data-ttu-id="14df4-104">При проектировании модулей Runbook крайне важно определить различные состояния и условия, характерные для действий в модуле,</span><span class="sxs-lookup"><span data-stu-id="14df4-104">A key runbook design principal to consider is identifying different issues that a runbook might experience.</span></span> <span data-ttu-id="14df4-105">например состояние успеха, состояния ожидаемых ошибок и условия непредвиденных ошибок.</span><span class="sxs-lookup"><span data-stu-id="14df4-105">These issues can include success, expected error states, and unexpected error conditions.</span></span>

<span data-ttu-id="14df4-106">Модули Runbook должны включать обработку ошибок.</span><span class="sxs-lookup"><span data-stu-id="14df4-106">Runbooks should include error handling.</span></span> <span data-ttu-id="14df4-107">Чтобы проверить выходные данные действия или обработать ошибку с помощью графических модулей Runbook, можно использовать действие кода Windows PowerShell, определить условную логику в ссылке выходных данных действия или применить другой метод.</span><span class="sxs-lookup"><span data-stu-id="14df4-107">To validate the output of an activity or handle an error with graphical runbooks, you could use a Windows PowerShell code activity, define conditional logic on the output link of the activity, or apply another method.</span></span>          

<span data-ttu-id="14df4-108">Зачастую, если при выполнении модулей Runbook с каким-либо действием возникает устранимая ошибка, последующее действие будет обрабатываться обычным образом.</span><span class="sxs-lookup"><span data-stu-id="14df4-108">Often, if there is a non-terminating error that occurs with a runbook activity, any activity that follows is processed regardless of the error.</span></span> <span data-ttu-id="14df4-109">Ошибка, вероятнее всего, вызовет исключение, но следующее действие по-прежнему может быть выполнено.</span><span class="sxs-lookup"><span data-stu-id="14df4-109">The error is likely to generate an exception, but the next activity is still allowed to run.</span></span> <span data-ttu-id="14df4-110">Именно таким образом PowerShell обрабатывает ошибки.</span><span class="sxs-lookup"><span data-stu-id="14df4-110">This is the way that PowerShell is designed to handle errors.</span></span>    

<span data-ttu-id="14df4-111">Во время выполнения могут возникнуть неустранимые и устранимые ошибки PowerShell.</span><span class="sxs-lookup"><span data-stu-id="14df4-111">The types of PowerShell errors that can occur during execution are terminating or non-terminating.</span></span> <span data-ttu-id="14df4-112">Ниже приведены различия между неустранимыми и устранимыми ошибками.</span><span class="sxs-lookup"><span data-stu-id="14df4-112">The differences between terminating and non-terminating errors are as follows:</span></span>

* <span data-ttu-id="14df4-113">**Неустранимая ошибка:** серьезная ошибка, возникающая во время выполнения, которая полностью прерывает выполнение команды (или скрипта).</span><span class="sxs-lookup"><span data-stu-id="14df4-113">**Terminating error**: A serious error during execution that halts the command (or script execution) completely.</span></span> <span data-ttu-id="14df4-114">К примерам можно отнести несуществующие командлеты, синтаксические ошибки, предотвращающие выполнение командлета, или другие неустранимые ошибки.</span><span class="sxs-lookup"><span data-stu-id="14df4-114">Examples include non-existent cmdlets, syntax errors that prevent a cmdlet from running, or other fatal errors.</span></span>

* <span data-ttu-id="14df4-115">**Устранимая ошибка:** несерьезная ошибка, которая не останавливает выполнение.</span><span class="sxs-lookup"><span data-stu-id="14df4-115">**Non-terminating error**: A non-serious error that allows execution to continue despite the failure.</span></span> <span data-ttu-id="14df4-116">Примеры включают ошибки из-за отсутствия файла и проблемы с разрешениями.</span><span class="sxs-lookup"><span data-stu-id="14df4-116">Examples include operational errors such as file not found errors and permissions problems.</span></span>

<span data-ttu-id="14df4-117">Графические модули Runbook службы автоматизации Azure теперь включают возможность обработки ошибок.</span><span class="sxs-lookup"><span data-stu-id="14df4-117">Azure Automation graphical runbooks have been improved with the capability to include error handling.</span></span> <span data-ttu-id="14df4-118">Теперь можно преобразовывать исключения в устранимые ошибки и создавать ссылки ошибок между действиями.</span><span class="sxs-lookup"><span data-stu-id="14df4-118">You can now turn exceptions into non-terminating errors and create error links between activities.</span></span> <span data-ttu-id="14df4-119">Этот процесс позволит автору модуля Runbook настроить перехват ошибок и управлять реализованными или непредвиденными условиями.</span><span class="sxs-lookup"><span data-stu-id="14df4-119">This process allows a runbook author to catch errors and manage realized or unexpected conditions.</span></span>  

## <a name="when-to-use-error-handling"></a><span data-ttu-id="14df4-120">Применение обработки ошибок</span><span class="sxs-lookup"><span data-stu-id="14df4-120">When to use error handling</span></span>

<span data-ttu-id="14df4-121">При наличии критичного действия, которое вызывает ошибку или исключение, важно предотвратить выполнение следующего действия в модуле Runbook и соответствующим образом обработать ошибку.</span><span class="sxs-lookup"><span data-stu-id="14df4-121">Whenever there is a critical activity that throws an error or exception, it's important to prevent the next activity in your runbook from processing and to handle the error appropriately.</span></span> <span data-ttu-id="14df4-122">Это особенно важно, если модули Runbook поддерживают бизнес-процессы или операции, связанные со службами.</span><span class="sxs-lookup"><span data-stu-id="14df4-122">This is especially critical when your runbooks are supporting a business or service operations process.</span></span>

<span data-ttu-id="14df4-123">Для каждого действия, которое может вызвать ошибку, автор модуля Runbook может добавить ссылку ошибки, указывающую на любое другое действие.</span><span class="sxs-lookup"><span data-stu-id="14df4-123">For each activity that can produce an error, the runbook author can add an error link pointing to any other activity.</span></span>  <span data-ttu-id="14df4-124">Действие назначения может быть любого типа: действие кода, вызов командлета, вызов другого модуля Runbook и т. д.</span><span class="sxs-lookup"><span data-stu-id="14df4-124">The destination activity can be of any type, including code activities, invoking a cmdlet, invoking another runbook, and so on.</span></span>

<span data-ttu-id="14df4-125">Кроме того, действие назначения может также иметь исходящие ссылки.</span><span class="sxs-lookup"><span data-stu-id="14df4-125">In addition, the destination activity can also have outgoing links.</span></span> <span data-ttu-id="14df4-126">Это могут быть обычные ссылки или ссылки ошибок.</span><span class="sxs-lookup"><span data-stu-id="14df4-126">These links can be regular links or error links.</span></span> <span data-ttu-id="14df4-127">Таким образом автор модуля Runbook может применять сложную логику обработки ошибок, не требующую использования действия кода.</span><span class="sxs-lookup"><span data-stu-id="14df4-127">This means the runbook author can implement complex error-handling logic without resorting to a code activity.</span></span> <span data-ttu-id="14df4-128">Рекомендуется создать выделенный модуль Runbook для обработки ошибок с общими функциональными возможностями. Но это необязательно.</span><span class="sxs-lookup"><span data-stu-id="14df4-128">The recommended practice is to create a dedicated error-handling runbook with common functionality, but it's not mandatory.</span></span> <span data-ttu-id="14df4-129">Определение логики обработки ошибок в действии кода PowerShell не является единственным методом.</span><span class="sxs-lookup"><span data-stu-id="14df4-129">Error-handling logic in a PowerShell code activity it isn't the only option.</span></span>  

<span data-ttu-id="14df4-130">Например, рассмотрим модуль Runbook, который пытается запустить виртуальную машину и установить на нее приложение.</span><span class="sxs-lookup"><span data-stu-id="14df4-130">For example, consider a runbook that tries to start a VM and install an application on it.</span></span> <span data-ttu-id="14df4-131">Если виртуальная машина запускается неправильно, модуль Runbook выполняет два действия:</span><span class="sxs-lookup"><span data-stu-id="14df4-131">If the VM doesn't start correctly, it performs two actions:</span></span>

1. <span data-ttu-id="14df4-132">Отправляет уведомление об этой проблеме.</span><span class="sxs-lookup"><span data-stu-id="14df4-132">It sends a notification about this problem.</span></span>
2. <span data-ttu-id="14df4-133">Запускает другой модуль Runbook, который автоматически подготавливает новую виртуальную машину.</span><span class="sxs-lookup"><span data-stu-id="14df4-133">It starts another runbook that automatically provisions a new VM instead.</span></span>

<span data-ttu-id="14df4-134">В этом случае можно создать ссылку ошибки, указывающую на действие для обработки шага 1,</span><span class="sxs-lookup"><span data-stu-id="14df4-134">One solution is to have an error link pointing to an activity that handles step one.</span></span> <span data-ttu-id="14df4-135">например связать командлет **Write-Warning** с действием шага 2 (к примеру, командлет **Start-AzureRmAutomationRunbook**).</span><span class="sxs-lookup"><span data-stu-id="14df4-135">For example, you could connect the **Write-Warning** cmdlet to an activity for step two, such as the **Start-AzureRmAutomationRunbook** cmdlet.</span></span>

<span data-ttu-id="14df4-136">Можно также обобщить это поведение для нескольких модулей Runbook, помещая эти два действия в отдельные модули для обработки ошибок, следуя рекомендациям, приведенным выше.</span><span class="sxs-lookup"><span data-stu-id="14df4-136">You could also generalize this behavior for use in many runbooks by putting these two activities in a separate error handling runbook and following the guidance suggested earlier.</span></span> <span data-ttu-id="14df4-137">Перед вызовом этого модуля Runbook для обработки ошибок можно создать пользовательское сообщение на основе данных в исходном модуле и передать его как параметр в модуль для обработки ошибок.</span><span class="sxs-lookup"><span data-stu-id="14df4-137">Before calling this error-handling runbook, you could construct a custom message from the data in the original runbook, and then pass it as a parameter to the error-handling runbook.</span></span>

## <a name="how-to-use-error-handling"></a><span data-ttu-id="14df4-138">Способы использования обработки ошибок</span><span class="sxs-lookup"><span data-stu-id="14df4-138">How to use error handling</span></span>

<span data-ttu-id="14df4-139">Каждое действие настроено для преобразования исключений в устранимые ошибки.</span><span class="sxs-lookup"><span data-stu-id="14df4-139">Each activity has a configuration setting that turns exceptions into non-terminating errors.</span></span> <span data-ttu-id="14df4-140">Эта функция отключена по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="14df4-140">By default, this setting is disabled.</span></span> <span data-ttu-id="14df4-141">Рекомендуется включить эту функцию для любого действия, требующего обработки ошибок.</span><span class="sxs-lookup"><span data-stu-id="14df4-141">We recommend that you enable this setting on any activity where you want to handle errors.</span></span>  

<span data-ttu-id="14df4-142">Включая эту конфигурацию, неустранимые и устранимые ошибки в действии будут обрабатываться как устранимые, а затем к ним может быть применена ссылка ошибки.</span><span class="sxs-lookup"><span data-stu-id="14df4-142">By enabling this configuration, you are assuring that both terminating and non-terminating errors in the activity are handled as non-terminating errors, and can be handled with an error link.</span></span>  

<span data-ttu-id="14df4-143">После настройки этого параметра создайте действие, которое будет обрабатывать ошибку.</span><span class="sxs-lookup"><span data-stu-id="14df4-143">After configuring this setting, you create an activity that handles the error.</span></span> <span data-ttu-id="14df4-144">Если действие вызовет ошибку, будет выполнен переход только по исходящим ссылкам ошибок, а по обычным — нет, даже если в результате выполнения действия были сформированы стандартные выходные данные.</span><span class="sxs-lookup"><span data-stu-id="14df4-144">If an activity produces any error, then the outgoing error links are followed, and the regular links are not, even if the activity produces regular output as well.</span></span><br><br> ![Пример ссылки ошибки в модуле Runbook службы автоматизации](media/automation-runbook-graphical-error-handling/error-link-example.png)

<span data-ttu-id="14df4-146">В следующем примере модуль Runbook получает переменную, содержащую имя компьютера виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="14df4-146">In the following example, a runbook retrieves a variable that contains the computer name of a virtual machine.</span></span> <span data-ttu-id="14df4-147">Затем он пытается запустить виртуальную машину в следующем действии.</span><span class="sxs-lookup"><span data-stu-id="14df4-147">It then attempts to start the virtual machine with the next activity.</span></span><br><br> ![Пример обработки ошибок в модуле Runbook службы автоматизации](media/automation-runbook-graphical-error-handling/runbook-example-error-handling.png)<br><br>      

<span data-ttu-id="14df4-149">Действия **Get-AutomationVariable** и **Start-AzureRmVm** настроены для преобразования исключений в ошибки.</span><span class="sxs-lookup"><span data-stu-id="14df4-149">The **Get-AutomationVariable** activity and **Start-AzureRmVm** are configured to convert exceptions to errors.</span></span>  <span data-ttu-id="14df4-150">Если не удается получить переменную или запустить виртуальную машину, возникнут ошибки.</span><span class="sxs-lookup"><span data-stu-id="14df4-150">If there are problems getting the variable or starting the VM, then errors are generated.</span></span><br><br> <span data-ttu-id="14df4-151">![Параметры действия обработки ошибок в модуле Runbook службы автоматизации](media/automation-runbook-graphical-error-handling/activity-blade-convertexception-option.png)</span><span class="sxs-lookup"><span data-stu-id="14df4-151">![Automation runbook error-handling activity settings](media/automation-runbook-graphical-error-handling/activity-blade-convertexception-option.png)</span></span>

<span data-ttu-id="14df4-152">Ссылки ошибок ведут от этих действий к одному действию **управления ошибками** (действие кода).</span><span class="sxs-lookup"><span data-stu-id="14df4-152">Error links flow from these activities to a single **error management** activity (a code activity).</span></span> <span data-ttu-id="14df4-153">Это действие настраивается с помощью простого выражения PowerShell, которое использует ключевое слово *Throw* для остановки обработки, а также для *$Error.Exception.Message*, чтобы получить сообщение, описывающее текущее исключение.</span><span class="sxs-lookup"><span data-stu-id="14df4-153">This activity is configured with a simple PowerShell expression that uses the *Throw* keyword to stop processing, along with *$Error.Exception.Message* to get the message that describes the current exception.</span></span><br><br> <span data-ttu-id="14df4-154">![Пример кода для обработки ошибок в модуле Runbook службы автоматизации](media/automation-runbook-graphical-error-handling/runbook-example-error-handling-code.png)</span><span class="sxs-lookup"><span data-stu-id="14df4-154">![Automation runbook error-handling code example](media/automation-runbook-graphical-error-handling/runbook-example-error-handling-code.png)</span></span>


## <a name="next-steps"></a><span data-ttu-id="14df4-155">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="14df4-155">Next steps</span></span>

* <span data-ttu-id="14df4-156">Дополнительные сведения о ссылках и их типах в графических модулях Runbook см. в статье [Графическая разработка в службе автоматизации Azure](automation-graphical-authoring-intro.md#links-and-workflow).</span><span class="sxs-lookup"><span data-stu-id="14df4-156">To learn more about links and link types in graphical runbooks, see [Graphical authoring in Azure Automation](automation-graphical-authoring-intro.md#links-and-workflow).</span></span>

* <span data-ttu-id="14df4-157">Дополнительные сведения о выполнении модулей Runbook, отслеживании заданий модуля Runbook и других технических деталях см. в статье [Выполнение модуля Runbook в службе автоматизации Azure](automation-runbook-execution.md).</span><span class="sxs-lookup"><span data-stu-id="14df4-157">To learn more about runbook execution, how to monitor runbook jobs, and other technical details, see [Track a runbook job](automation-runbook-execution.md).</span></span>
