---
title: "Выполнение модуля Runbook в службе автоматизации Azure | Документация Майкрософт"
description: "Рассматривается обработка модуля Runbook в службе автоматизации Azure."
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: tysonn
ms.assetid: d10c8ce2-2c0b-4ea7-ba3c-d20e09b2c9ca
ms.service: automation
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/17/2017
ms.author: bwren
ms.openlocfilehash: 14f923e3f08dd3b286218ae56012ce14edcc4058
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="runbook-execution-in-azure-automation"></a><span data-ttu-id="8a264-103">Выполнение модуля Runbook в службе автоматизации Azure</span><span class="sxs-lookup"><span data-stu-id="8a264-103">Runbook execution in Azure Automation</span></span>
<span data-ttu-id="8a264-104">При запуске модуля Runbook в службе автоматизации Azure создается задание.</span><span class="sxs-lookup"><span data-stu-id="8a264-104">When you start a runbook in Azure Automation, a job is created.</span></span> <span data-ttu-id="8a264-105">Задание — это одиночный выполняемый экземпляр модуля Runbook.</span><span class="sxs-lookup"><span data-stu-id="8a264-105">A job is a single execution instance of a runbook.</span></span> <span data-ttu-id="8a264-106">Рабочий процесс службы автоматизации Azure назначается для выполнения каждого задания.</span><span class="sxs-lookup"><span data-stu-id="8a264-106">An Azure Automation worker is assigned to run each job.</span></span> <span data-ttu-id="8a264-107">Пока рабочие процессы используются несколькими учетными записями Azure, задания от различных учетных записей службы автоматизации изолируются друг от друга.</span><span class="sxs-lookup"><span data-stu-id="8a264-107">While workers are shared by multiple Azure accounts, jobs from different Automation accounts are isolated from one another.</span></span> <span data-ttu-id="8a264-108">Вы не контролируете, какая рабочая роль обслуживает запрос для вашего задания.</span><span class="sxs-lookup"><span data-stu-id="8a264-108">You do not have control over which worker services the request for your job.</span></span>  <span data-ttu-id="8a264-109">В одном модуле Runbook могут иметься несколько запущенных заданий одновременно.</span><span class="sxs-lookup"><span data-stu-id="8a264-109">A single runbook can have multiple jobs running at one time.</span></span> <span data-ttu-id="8a264-110">При просмотре списка модулей Runbook на портале Azure в нем отобразится список состояний всех заданий для каждого модуля Runbook.</span><span class="sxs-lookup"><span data-stu-id="8a264-110">When you view the list of runbooks in the Azure portal, it lists the status of all jobs that were started for each runbook.</span></span> <span data-ttu-id="8a264-111">Можно просматривать список заданий для каждого модуля Runbook и отслеживать состояние каждого из них.</span><span class="sxs-lookup"><span data-stu-id="8a264-111">You can view the list of jobs for each runbook in order to track the status of each.</span></span> <span data-ttu-id="8a264-112">Описание различных состояний заданий см. в разделе [Состояния заданий](#job-statuses).</span><span class="sxs-lookup"><span data-stu-id="8a264-112">For a description of the different job statuses, see [Job Statuses](#job-statuses).</span></span>

<span data-ttu-id="8a264-113">На следующей схеме показан жизненный цикл задания Runbook для [графических модулей Runbook](automation-runbook-types.md#graphical-runbooks) и [модулей Runbook рабочих процессов PowerShell](automation-runbook-types.md#powershell-workflow-runbooks).</span><span class="sxs-lookup"><span data-stu-id="8a264-113">The following diagram shows the lifecycle of a runbook job for [Graphical runbooks](automation-runbook-types.md#graphical-runbooks) and [PowerShell Workflow runbooks](automation-runbook-types.md#powershell-workflow-runbooks).</span></span>

![Состояния задания — рабочий процесс PowerShell](./media/automation-runbook-execution/job-statuses.png)

<span data-ttu-id="8a264-115">На следующей схеме показан жизненный цикл задания Runbook для [модулей Runbook PowerShell](automation-runbook-types.md#powershell-runbooks).</span><span class="sxs-lookup"><span data-stu-id="8a264-115">The following diagram shows the lifecycle of a runbook job for [PowerShell runbooks](automation-runbook-types.md#powershell-runbooks).</span></span>

![Состояния задания — сценарий PowerShell](./media/automation-runbook-execution/job-statuses-script.png)

<span data-ttu-id="8a264-117">Задания имеют доступ к ресурсам Azure за счет подключения к ресурсам подписки Azure.</span><span class="sxs-lookup"><span data-stu-id="8a264-117">Your jobs have access to your Azure resources by making a connection to your Azure subscription.</span></span> <span data-ttu-id="8a264-118">Задания имеют доступ только к ресурсам в центре обработки данных, если эти ресурсы доступны из общедоступного облака.</span><span class="sxs-lookup"><span data-stu-id="8a264-118">They only have access to resources in your data center if those resources are accessible from the public cloud.</span></span>

## <a name="job-statuses"></a><span data-ttu-id="8a264-119">Состояния заданий</span><span class="sxs-lookup"><span data-stu-id="8a264-119">Job statuses</span></span>
<span data-ttu-id="8a264-120">Следующая таблица содержит описание различных состояний задания.</span><span class="sxs-lookup"><span data-stu-id="8a264-120">The following table describes the different statuses that are possible for a job.</span></span>

| <span data-ttu-id="8a264-121">Состояние</span><span class="sxs-lookup"><span data-stu-id="8a264-121">Status</span></span> | <span data-ttu-id="8a264-122">Описание</span><span class="sxs-lookup"><span data-stu-id="8a264-122">Description</span></span> |
|:--- |:--- |
| <span data-ttu-id="8a264-123">Завершено</span><span class="sxs-lookup"><span data-stu-id="8a264-123">Completed</span></span> |<span data-ttu-id="8a264-124">Задание успешно выполнено.</span><span class="sxs-lookup"><span data-stu-id="8a264-124">The job completed successfully.</span></span> |
| <span data-ttu-id="8a264-125">Failed</span><span class="sxs-lookup"><span data-stu-id="8a264-125">Failed</span></span> |<span data-ttu-id="8a264-126">Для [графических модулей Runbook и модулей Runbook рабочих процессов PowerShell](automation-runbook-types.md): не удалось скомпилировать модуль Runbook.</span><span class="sxs-lookup"><span data-stu-id="8a264-126">For [Graphical and PowerShell Workflow runbooks](automation-runbook-types.md), the runbook failed to compile.</span></span>  <span data-ttu-id="8a264-127">Для [модулей Runbook сценариев PowerShell](automation-runbook-types.md): не удалось запустить Runbook или задание породило исключение.</span><span class="sxs-lookup"><span data-stu-id="8a264-127">For [PowerShell Script runbooks](automation-runbook-types.md), the runbook failed to start or the job encountered an exception.</span></span> |
| <span data-ttu-id="8a264-128">Задание не выполнено. Ожидание ресурсов.</span><span class="sxs-lookup"><span data-stu-id="8a264-128">Failed, waiting for resources</span></span> |<span data-ttu-id="8a264-129">Задание не выполнено, так как задание превысило ограничение [доли](#fairshare) три раза и было запущено с той же контрольной точки или с момента запуска модуля Runbook.</span><span class="sxs-lookup"><span data-stu-id="8a264-129">The job failed because it reached the [fair share](#fairshare) limit three times and started from the same checkpoint or from the start of the runbook each time.</span></span> |
| <span data-ttu-id="8a264-130">Поставлено в очередь</span><span class="sxs-lookup"><span data-stu-id="8a264-130">Queued</span></span> |<span data-ttu-id="8a264-131">Задание ожидает появления доступных ресурсов в очереди автоматизации, которые позволят запустить задание.</span><span class="sxs-lookup"><span data-stu-id="8a264-131">The job is waiting for resources on an Automation worker to come available so that it can be started.</span></span> |
| <span data-ttu-id="8a264-132">Запуск</span><span class="sxs-lookup"><span data-stu-id="8a264-132">Starting</span></span> |<span data-ttu-id="8a264-133">Задание было назначено рабочему процессу, и система скоро его запустит.</span><span class="sxs-lookup"><span data-stu-id="8a264-133">The job has been assigned to a worker, and the system is in the process of starting it.</span></span> |
| <span data-ttu-id="8a264-134">Возобновление</span><span class="sxs-lookup"><span data-stu-id="8a264-134">Resuming</span></span> |<span data-ttu-id="8a264-135">Система находится в процессе возобновления задания после его приостановки.</span><span class="sxs-lookup"><span data-stu-id="8a264-135">The system is in the process of resuming the job after it was suspended.</span></span> |
| <span data-ttu-id="8a264-136">Выполнение</span><span class="sxs-lookup"><span data-stu-id="8a264-136">Running</span></span> |<span data-ttu-id="8a264-137">Задание выполняется.</span><span class="sxs-lookup"><span data-stu-id="8a264-137">The job is running.</span></span> |
| <span data-ttu-id="8a264-138">Задание выполняется. Ожидание ресурсов.</span><span class="sxs-lookup"><span data-stu-id="8a264-138">Running, waiting for resources</span></span> |<span data-ttu-id="8a264-139">Задание выгружено, поскольку превышено ограничение [доли](#fairshare) .</span><span class="sxs-lookup"><span data-stu-id="8a264-139">The job has been unloaded because it reached the [fair share](#fairshare) limit.</span></span> <span data-ttu-id="8a264-140">Задание будет возобновлено позже с его последней контрольной точки.</span><span class="sxs-lookup"><span data-stu-id="8a264-140">It resumes shortly from its last checkpoint.</span></span> |
| <span data-ttu-id="8a264-141">Остановлено</span><span class="sxs-lookup"><span data-stu-id="8a264-141">Stopped</span></span> |<span data-ttu-id="8a264-142">Задание было остановлено пользователем до его завершения.</span><span class="sxs-lookup"><span data-stu-id="8a264-142">The job was stopped by the user before it was completed.</span></span> |
| <span data-ttu-id="8a264-143">Остановка</span><span class="sxs-lookup"><span data-stu-id="8a264-143">Stopping</span></span> |<span data-ttu-id="8a264-144">Система находится в процессе остановки задания.</span><span class="sxs-lookup"><span data-stu-id="8a264-144">The system is in the process of stopping the job.</span></span> |
| <span data-ttu-id="8a264-145">Приостановлено</span><span class="sxs-lookup"><span data-stu-id="8a264-145">Suspended</span></span> |<span data-ttu-id="8a264-146">Задание было приостановлено пользователем, системой или с помощью команды в модуле Runbook.</span><span class="sxs-lookup"><span data-stu-id="8a264-146">The job was suspended by the user, by the system, or by a command in the runbook.</span></span> <span data-ttu-id="8a264-147">Приостановленное задание можно запустить снова. При этом оно возобновится с последней контрольной точки или с запуска модуля Runbook, если задание не имеет контрольных точек.</span><span class="sxs-lookup"><span data-stu-id="8a264-147">A job that is suspended can be started again and resume from its last checkpoint or from the beginning of the runbook if it doesn't have checkpoints.</span></span> <span data-ttu-id="8a264-148">Модуль Runbook будет приостановлен системой только при возникновении исключения.</span><span class="sxs-lookup"><span data-stu-id="8a264-148">The runbook will only be suspended by the system when an exception occurs.</span></span> <span data-ttu-id="8a264-149">По умолчанию переменная ErrorActionPreference имеет значение **Продолжить**, то есть задание продолжит работу при возникновении ошибки.</span><span class="sxs-lookup"><span data-stu-id="8a264-149">By default, ErrorActionPreference is set to **Continue**, meaning that the job keeps running on an error.</span></span> <span data-ttu-id="8a264-150">Если для этой переменной задать значение **Остановить**, задание будет приостановлено при возникновении ошибки.</span><span class="sxs-lookup"><span data-stu-id="8a264-150">If this preference variable is set to **Stop**, then the job suspends on an error.</span></span>  <span data-ttu-id="8a264-151">Применяется только к [графическим модулям Runbook и модулям Runbook рабочих процессов PowerShell](automation-runbook-types.md) .</span><span class="sxs-lookup"><span data-stu-id="8a264-151">Applies to [Graphical and PowerShell Workflow runbooks](automation-runbook-types.md) only.</span></span> |
| <span data-ttu-id="8a264-152">Приостановка</span><span class="sxs-lookup"><span data-stu-id="8a264-152">Suspending</span></span> |<span data-ttu-id="8a264-153">Система пытается приостановить задание по запросу пользователя.</span><span class="sxs-lookup"><span data-stu-id="8a264-153">The system is attempting to suspend the job at the request of the user.</span></span> <span data-ttu-id="8a264-154">Модуль Runbook должен достичь следующей контрольной точки, прежде чем задание может быть приостановлено.</span><span class="sxs-lookup"><span data-stu-id="8a264-154">The runbook must reach its next checkpoint before it can be suspended.</span></span> <span data-ttu-id="8a264-155">Если последняя контрольная точка уже пройдена, задание будет завершено, прежде чем оно будет приостановлено.</span><span class="sxs-lookup"><span data-stu-id="8a264-155">If it already passed its last checkpoint, then it completes before it can be suspended.</span></span>  <span data-ttu-id="8a264-156">Применяется только к [графическим модулям Runbook и модулям Runbook рабочих процессов PowerShell](automation-runbook-types.md) .</span><span class="sxs-lookup"><span data-stu-id="8a264-156">Applies to [Graphical and PowerShell Workflow runbooks](automation-runbook-types.md) only.</span></span> |

## <a name="viewing-job-status-from-the-azure-portal"></a><span data-ttu-id="8a264-157">Просмотр состояний заданий на портале Azure</span><span class="sxs-lookup"><span data-stu-id="8a264-157">Viewing job status from the Azure portal</span></span>
<span data-ttu-id="8a264-158">Вы можете просматривать сводные данные о состоянии всех заданий Runbook или детализировать сведения об определенном задании на портале Azure. Также можно настроить интеграцию с рабочей областью Log Analytics в Microsoft Operations Management Suite (OMS) для пересылки состояния задания и потоков заданий Runbook.</span><span class="sxs-lookup"><span data-stu-id="8a264-158">You can view a summarized status of all runbook jobs or drill into details of a specific runbook job in the Azure portal or by configuring integration with your Microsoft Operations Management Suite (OMS) Log Analytics workspace to forward runbook job status and job streams.</span></span>  <span data-ttu-id="8a264-159">Дополнительные сведения об интеграции с Log Analytics в OMS см. в статье [Пересылка состояния задания и потоков заданий из службы автоматизации в Log Analytics (OMS)](automation-manage-send-joblogs-log-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="8a264-159">For more information about integrating with OMS Log Analytics, see [Forward job status and job streams from Automation to Log Analytics (OMS)](automation-manage-send-joblogs-log-analytics.md).</span></span>  

### <a name="automation-runbook-jobs-summary"></a><span data-ttu-id="8a264-160">Сводные данные заданий Runbook службы автоматизации</span><span class="sxs-lookup"><span data-stu-id="8a264-160">Automation runbook jobs summary</span></span>
<span data-ttu-id="8a264-161">В правой части выбранной учетной записи службы автоматизации Azure можно посмотреть сводные данные о всех заданиях Runbook для этой учетной записи на плитке **Статистика по заданиям**.</span><span class="sxs-lookup"><span data-stu-id="8a264-161">On the right of your selected Automation account, you can see a summary of all of the runbook jobs for a selected Automation account under **Job Statistics** tile.</span></span><br><br> <span data-ttu-id="8a264-162">![Элемент "Статистика по заданиям"](./media/automation-runbook-execution/automation-account-job-status-summary.png).</span><span class="sxs-lookup"><span data-stu-id="8a264-162">![Job Statistics tile](./media/automation-runbook-execution/automation-account-job-status-summary.png).</span></span><br> <span data-ttu-id="8a264-163">В этом элементе отображается количество и графическое представление состояний всех выполненных заданий.</span><span class="sxs-lookup"><span data-stu-id="8a264-163">This tile displays a count and graphical representation of the job status for all jobs executed.</span></span>  

<span data-ttu-id="8a264-164">Щелкните плитку, чтобы открылась колонка **Задания**, в которой представлен общий список всех выполненных заданий с указанием их состояния, времени начала и завершения выполнения.</span><span class="sxs-lookup"><span data-stu-id="8a264-164">Clicking on the tile presents the **Jobs** blade, which includes a summarized list of all jobs executed, with status, job execution, and start and completion times.</span></span><br><br> <span data-ttu-id="8a264-165">![Колонка "Задания" учетной записи службы автоматизации](./media/automation-runbook-execution/automation-account-jobs-status-blade.png)</span><span class="sxs-lookup"><span data-stu-id="8a264-165">![Automation account Jobs blade](./media/automation-runbook-execution/automation-account-jobs-status-blade.png)</span></span><br><br>  <span data-ttu-id="8a264-166">Чтобы отфильтровать список заданий, выберите **Фильтровать задания** и укажите критерий фильтрации. Для этого введите определенное имя модуля Runbook, выберите состояние задания или диапазон дат и времени из раскрывающегося списка.</span><span class="sxs-lookup"><span data-stu-id="8a264-166">You can filter the list of jobs by selecting **Filter jobs**  and filter on a specific runbook, job status, or from the drop-down list, the date/time range to search within.</span></span><br><br> <span data-ttu-id="8a264-167">![Фильтрация по состоянию задания](./media/automation-runbook-execution/automation-account-jobs-filter.png)</span><span class="sxs-lookup"><span data-stu-id="8a264-167">![Filter Job status](./media/automation-runbook-execution/automation-account-jobs-filter.png)</span></span>

<span data-ttu-id="8a264-168">Кроме того, для просмотра сводных данных о состоянии заданий определенного модуля Runbook можно выбрать этот модуль в колонке **Модули Runbook** учетной записи службы автоматизации, а затем выбрать элемент **Задания**.</span><span class="sxs-lookup"><span data-stu-id="8a264-168">Alternatively, you can view job summary details for a specific runbook by selecting that runbook from the **Runbooks** blade in your Automation account, and then select the **Jobs** tile.</span></span>  <span data-ttu-id="8a264-169">Отобразится колонка **Задания**, в которой можно выбрать конкретную запись и просмотреть подробные сведения о задании и его выходные данные.</span><span class="sxs-lookup"><span data-stu-id="8a264-169">This presents the **Jobs** blade, and from there you can click on the job record to view its detail and output.</span></span><br><br> <span data-ttu-id="8a264-170">![Колонка "Задания" учетной записи службы автоматизации](./media/automation-runbook-execution/automation-runbook-job-summary-blade.png)</span><span class="sxs-lookup"><span data-stu-id="8a264-170">![Automation account Jobs blade](./media/automation-runbook-execution/automation-runbook-job-summary-blade.png)</span></span><br> 

### <a name="job-summary"></a><span data-ttu-id="8a264-171">Сводные данные задания</span><span class="sxs-lookup"><span data-stu-id="8a264-171">Job Summary</span></span>
<span data-ttu-id="8a264-172">Можно просмотреть список всех заданий, которые были созданы для конкретного модуля Runbook, и их последнее состояние.</span><span class="sxs-lookup"><span data-stu-id="8a264-172">You can view a list of all of the jobs that have been created for a particular runbook and their most recent status.</span></span> <span data-ttu-id="8a264-173">Можно фильтровать список по состоянию заданий и изменять диапазон дат для последнего изменения задания.</span><span class="sxs-lookup"><span data-stu-id="8a264-173">You can filter this list by job status and the range of dates for the last change to the job.</span></span> <span data-ttu-id="8a264-174">Чтобы просмотреть подробные сведения и результаты выполнения для задания, щелкните его имя.</span><span class="sxs-lookup"><span data-stu-id="8a264-174">To view its detailed information and output, click on the name of a job.</span></span> <span data-ttu-id="8a264-175">Подробное представление задания содержит значения параметров Runbook, которые были указаны для этого задания.</span><span class="sxs-lookup"><span data-stu-id="8a264-175">The detailed view of the job includes the values for the runbook parameters that were provided to that job.</span></span>

<span data-ttu-id="8a264-176">Чтобы просмотреть задания для модуля Runbook, выполните следующие шаги.</span><span class="sxs-lookup"><span data-stu-id="8a264-176">You can use the following steps to view the jobs for a runbook.</span></span>

1. <span data-ttu-id="8a264-177">На портале Azure щелкните **Автоматизация**, а затем выберите имя учетной записи службы автоматизации.</span><span class="sxs-lookup"><span data-stu-id="8a264-177">In the Azure portal, select **Automation** and then select the name of an Automation account.</span></span>
2. <span data-ttu-id="8a264-178">В концентраторе выберите **Модули Runbook**, а затем в колонке **Модули Runbook** выберите нужный модуль Runbook.</span><span class="sxs-lookup"><span data-stu-id="8a264-178">From the hub, select **Runbooks** and then on the **Runbooks** blade select a runbook from the list.</span></span>
3. <span data-ttu-id="8a264-179">В колонке для выбранного модуля Runbook щелкните плитку **Задания**.</span><span class="sxs-lookup"><span data-stu-id="8a264-179">On the blade for the selected runbook, click the **Jobs** tile.</span></span>
4. <span data-ttu-id="8a264-180">Щелкните одно из заданий в списке, и вы сможете просмотреть сведения о нем и выходные данные в колонке сведений о задании модуля Runbook.</span><span class="sxs-lookup"><span data-stu-id="8a264-180">Click on one of the jobs in the list and on the runbook job details blade you can view its detail and output.</span></span>

## <a name="retrieving-job-status-using-windows-powershell"></a><span data-ttu-id="8a264-181">Получение состояния задания с помощью Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="8a264-181">Retrieving job status using Windows PowerShell</span></span>
<span data-ttu-id="8a264-182">Чтобы получить сведения о созданных для модуля Runbook заданиях и о конкретном задании, воспользуйтесь командлетом [Get-AzureRmAutomationJob](https://msdn.microsoft.com/library/mt619440.aspx).</span><span class="sxs-lookup"><span data-stu-id="8a264-182">You can use the [Get-AzureRmAutomationJob](https://msdn.microsoft.com/library/mt619440.aspx) to retrieve the jobs created for a runbook and the details of a particular job.</span></span> <span data-ttu-id="8a264-183">Если запустить модуль Runbook с помощью Windows PowerShell, то команда [Start-AzureRmAutomationRunbook](https://msdn.microsoft.com/library/mt603661.aspx) вернет результирующее задание.</span><span class="sxs-lookup"><span data-stu-id="8a264-183">If you start a runbook with Windows PowerShell using [Start-AzureRmAutomationRunbook](https://msdn.microsoft.com/library/mt603661.aspx), then it returns the resulting job.</span></span> <span data-ttu-id="8a264-184">Получить выходные данные задания можно с помощью команды [Get-AzureRmAutomationJob](https://msdn.microsoft.com/library/mt619440.aspx).</span><span class="sxs-lookup"><span data-stu-id="8a264-184">Use [Get-AzureRmAutomationJob](https://msdn.microsoft.com/library/mt619440.aspx)Output to get a job’s output.</span></span>

<span data-ttu-id="8a264-185">Приведенные ниже примеры команд получают сведения о последнем задании для примера модуля Runbook и отображают его состояние, значения параметров Runbook, а также выходные данные этого задания.</span><span class="sxs-lookup"><span data-stu-id="8a264-185">The following sample commands retrieve the last job for a sample runbook and displays its status, the values provided for the runbook parameters, and the output from the job.</span></span>

    $job = (Get-AzureRmAutomationJob –AutomationAccountName "MyAutomationAccount" `
    –RunbookName "Test-Runbook" -ResourceGroupName "ResourceGroup01" | sort LastModifiedDate –desc)[0]
    $job.Status
    $job.JobParameters
    Get-AzureRmAutomationJobOutput -ResourceGroupName "ResourceGroup01" `
    –AutomationAccountName "MyAutomationAcct" -Id $job.JobId –Stream Output

## <a name="fair-share"></a><span data-ttu-id="8a264-186">доли</span><span class="sxs-lookup"><span data-stu-id="8a264-186">Fair share</span></span>
<span data-ttu-id="8a264-187">Для совместного использования ресурсов всеми модулями Runbook в облаке служба автоматизации Azure временно выгружает любое задание после того, как его выполнение продолжалось в течение трех часов.</span><span class="sxs-lookup"><span data-stu-id="8a264-187">In order to share resources among all runbooks in the cloud, Azure Automation will temporarily unload any job after it has been running for three hours.</span></span>  <span data-ttu-id="8a264-188">В течение этого времени задания для [модулей Runbook на основе PowerShell](automation-runbook-types.md#powershell-runbooks) останавливаются и не будут перезапускаться.</span><span class="sxs-lookup"><span data-stu-id="8a264-188">During this time, jobs for [PowerShell-based runbooks](automation-runbook-types.md#powershell-runbooks) are stopped and will not be restarted.</span></span>  <span data-ttu-id="8a264-189">Состояние задания отображается как **Остановлено**.</span><span class="sxs-lookup"><span data-stu-id="8a264-189">The job status shows **Stopped**.</span></span>  <span data-ttu-id="8a264-190">Этот тип модулей Runbook всегда перезапускается с самого начала, так как не поддерживает контрольные точки.</span><span class="sxs-lookup"><span data-stu-id="8a264-190">This type of runbook is always restarted from the beginning since they don't support checkpoints.</span></span>  

<span data-ttu-id="8a264-191">[Модули Runbook на основе рабочего процесса PowerShell](automation-runbook-types.md#powershell-workflow-runbooks) будут возобновлены из последней [контрольной точки](https://docs.microsoft.com/system-center/sma/overview-powershell-workflows#bk_Checkpoints).</span><span class="sxs-lookup"><span data-stu-id="8a264-191">[PowerShell-Workflow-based runbooks](automation-runbook-types.md#powershell-workflow-runbooks) will be resumed from their last [checkpoint](https://docs.microsoft.com/system-center/sma/overview-powershell-workflows#bk_Checkpoints).</span></span>  <span data-ttu-id="8a264-192">После трех часового выполнения задание модуля Runbook будет приостановлено службой, а его состояние будет показывать **Running, waiting for resources** (Выполняется, ожидание ресурсов).</span><span class="sxs-lookup"><span data-stu-id="8a264-192">After running three hours, the runbook job will be suspended by the service and its status shows **Running, waiting for resources**.</span></span>  <span data-ttu-id="8a264-193">Если песочница станет доступна, модуль Runbook будет автоматически перезапущен службой автоматизации Azure и возобновится из последней контрольной точки.</span><span class="sxs-lookup"><span data-stu-id="8a264-193">When a sandbox becomes available, the runbook will be automatically restarted by the Automation service and resumes from the last checkpoint.</span></span>  <span data-ttu-id="8a264-194">Это нормальное поведение рабочего процесса PowerShell для приостановки или перезапуска.</span><span class="sxs-lookup"><span data-stu-id="8a264-194">This is normal PowerShell-Workflow behavior for suspend/restart.</span></span>  <span data-ttu-id="8a264-195">Если модуль Runbook еще раз превышает три часа работы среды выполнения, процесс повторяется до трех раз.</span><span class="sxs-lookup"><span data-stu-id="8a264-195">If the runbook again exceeds three hours of runtime, the process repeats, up to three times.</span></span>  <span data-ttu-id="8a264-196">После третьего перезапуска, если модуль Runbook все еще не завершен спустя три часа, задание модуля Runbook завершается сбоем, а состояние задания отображается как **Failed, waiting for resources** (Сбой, ожидание ресурсов).</span><span class="sxs-lookup"><span data-stu-id="8a264-196">After the third restart, if the runbook still has not completed in three hours, then the runbook job is failed, and the job status shows **Failed, waiting for resources**.</span></span>  <span data-ttu-id="8a264-197">В этом случае возникает следующее исключение со сбоем.</span><span class="sxs-lookup"><span data-stu-id="8a264-197">In this case, you receive the following exception with the failure.</span></span>

<span data-ttu-id="8a264-198">*Невозможно продолжить выполнение задания, так как оно было несколько раз прекращено до достижения контрольной точки. Убедитесь, что модуль Runbook не выполняет продолжительные операции без сохранения состояния.*</span><span class="sxs-lookup"><span data-stu-id="8a264-198">*The job cannot continue running because it was repeatedly evicted from the same checkpoint. Please make sure your Runbook does not perform lengthy operations without persisting its state.*</span></span>

<span data-ttu-id="8a264-199">Это необходимо, чтобы защитить службу от постоянного перезапуска модулей Runbook без завершения их работы, так как они не смогут достигнуть следующей контрольной точки без повторной выгрузки.</span><span class="sxs-lookup"><span data-stu-id="8a264-199">This is to protect the service from runbooks running indefinitely without completing, as they are not able to make it to the next checkpoint without being unloaded again.</span></span>

<span data-ttu-id="8a264-200">Если модуль Runbook не имеет контрольных точек или задание не дошло до первой контрольной точки перед выгрузкой, то оно будет перезапущено с самого начала.</span><span class="sxs-lookup"><span data-stu-id="8a264-200">If the runbook has no checkpoints or the job had not reached the first checkpoint before being unloaded, then it restarts from the beginning.</span></span>  

<span data-ttu-id="8a264-201">При создании модуля Runbook следует убедиться, что время для выполнения всех действий между двумя контрольными точками не превышает трех часов.</span><span class="sxs-lookup"><span data-stu-id="8a264-201">When you create a runbook, you should ensure that the time to run any activities between two checkpoints does not exceed three hours.</span></span> <span data-ttu-id="8a264-202">При необходимости добавьте контрольные точки в модуль Runbook, чтобы выполнение задач в нем не превышало трех часов, или разбейте продолжительные операции.</span><span class="sxs-lookup"><span data-stu-id="8a264-202">You may need to add checkpoints to your runbook to ensure that it does not reach this three hour limit or break up long running operations.</span></span> <span data-ttu-id="8a264-203">Например, модуль Runbook может выполнять повторную индексацию в крупной базе данных SQL.</span><span class="sxs-lookup"><span data-stu-id="8a264-203">For example, your runbook might perform a reindex on a large SQL database.</span></span> <span data-ttu-id="8a264-204">Если эта одиночная операция не завершится с учетом справедливого распределения ресурсов, то задание выгружается и перезапускается с самого начала.</span><span class="sxs-lookup"><span data-stu-id="8a264-204">If this single operation does not complete within the fair share limit, then the job are unloaded and restarted from the beginning.</span></span> <span data-ttu-id="8a264-205">В этом случае следует разбить операцию повторного индексирования на несколько шагов, например повторное индексирование одной таблицы, после чего выполняется вставка контрольной точки после каждой операции, чтобы задание могло возобновиться после завершения последней операции.</span><span class="sxs-lookup"><span data-stu-id="8a264-205">In this case, you should break up the reindex operation into multiple steps, such as reindexing one table at a time, and then insert a checkpoint after each operation so that the job could resume after the last operation to complete.</span></span>

## <a name="next-steps"></a><span data-ttu-id="8a264-206">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="8a264-206">Next steps</span></span>
* <span data-ttu-id="8a264-207">Дополнительные сведения о разных методах запуска модуля Runbook см. в статье [Запуск модуля Runbook в службе автоматизации Azure](automation-starting-a-runbook.md).</span><span class="sxs-lookup"><span data-stu-id="8a264-207">To learn more about the different methods that can be used to start a runbook in Azure Automation, see [Starting a runbook in Azure Automation](automation-starting-a-runbook.md)</span></span>

