---
title: "Дочерние модули Runbook в службе автоматизации Azure | Документация Майкрософт"
description: "Описывает различные методы запуска Runbook в службе автоматизации Azure из другого Runbook и обмена информацией между ними."
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: tysonn
ms.assetid: 919887b9-43e2-4c16-883c-f81807fe37db
ms.service: automation
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 02/02/2017
ms.author: magoedte;bwren
ms.openlocfilehash: a605d278dbbda9613b91007ea6a7042403a7a6ff
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="child-runbooks-in-azure-automation"></a><span data-ttu-id="ccbf5-103">Дочерние модули Runbook в службе автоматизации Azure</span><span class="sxs-lookup"><span data-stu-id="ccbf5-103">Child runbooks in Azure Automation</span></span>
<span data-ttu-id="ccbf5-104">Рекомендуется создавать в службе автоматизации Azure повторно используемые модульные Runbook с отдельной функцией, которую могут использовать другие Runbook.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-104">It is a best practice in Azure Automation to write reusable, modular runbooks with a discrete function that can be used by other runbooks.</span></span> <span data-ttu-id="ccbf5-105">Родительский Runbook часто будет вызывать один или несколько дочерних Runbook для выполнения требуемых функций.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-105">A parent runbook will often call one or more child runbooks to perform required functionality.</span></span> <span data-ttu-id="ccbf5-106">Существует два способа вызвать дочерний Runbook, и у каждого из них есть определенные отличия, которые следует понимать, чтобы определить, какой способ наилучшим образом подходит для тех или иных сценариев.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-106">There are two ways to call a child runbook, and each has distinct differences that you should understand so that you can determine which will be best for your different scenarios.</span></span>

## <a name="invoking-a-child-runbook-using-inline-execution"></a><span data-ttu-id="ccbf5-107">Вызов дочернего Runbook с использованием встроенного выполнения</span><span class="sxs-lookup"><span data-stu-id="ccbf5-107">Invoking a child runbook using inline execution</span></span>
<span data-ttu-id="ccbf5-108">Чтобы вызвать Runbook изнутри другого Runbook, используйте имя Runbook и укажите значения его параметров точно так же, как при использовании действия или командлета.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-108">To invoke a runbook inline from another runbook, you use the name of the runbook and provide values for its parameters exactly like you would use an activity or cmdlet.</span></span>  <span data-ttu-id="ccbf5-109">Так все Runbook в одной учетной записи службы автоматизации доступны для использования всем остальным.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-109">All runbooks in the same Automation account are available to all others to be used in this manner.</span></span> <span data-ttu-id="ccbf5-110">Родительский Runbook ожидает завершения работы дочернего Runbook, прежде чем перейти к следующей строке, и любые выходные данные возвращаются непосредственно в родительский Runbook.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-110">The parent runbook will wait for the child runbook to complete before moving to the next line, and any output is returned directly to the parent.</span></span>

<span data-ttu-id="ccbf5-111">При встроенном вызове дочерний Runbook выполняется в той же задаче, что и родительский Runbook.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-111">When you invoke a runbook inline, it runs in the same job as the parent runbook.</span></span> <span data-ttu-id="ccbf5-112">В журнале заданий дочернего Runbook не будет записей о его выполнении.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-112">There will be no indication in the job history of the child runbook that it ran.</span></span> <span data-ttu-id="ccbf5-113">Любые исключения и любой потоковый вывод дочернего Runbook будут связаны с родительским Runbook.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-113">Any exceptions and any stream output from the child runbook will be associated with the parent.</span></span> <span data-ttu-id="ccbf5-114">Это уменьшает число заданий и упрощает отслеживание и устранение неполадок, так как все исключения, порождаемые дочерним Runbook, и любой его потоковый вывод связан с родительским заданием.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-114">This results in fewer jobs and makes them easier to track and to troubleshoot since any exceptions thrown by the child runbook and any of its stream output are associated with the parent job.</span></span>

<span data-ttu-id="ccbf5-115">При публикации Runbook все дочерние Runbook, которые он вызывает, уже должны быть опубликованы.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-115">When a runbook is published, any child runbooks that it calls must already be published.</span></span> <span data-ttu-id="ccbf5-116">Это связано с тем, что служба автоматизации Azure создает связь с любыми дочерними Runbook при компиляции Runbook.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-116">This is because Azure Automation builds an association with any child runbooks when a runbook is compiled.</span></span> <span data-ttu-id="ccbf5-117">В противном случае родительский компонент Runbook будет отображаться как доступный для публикации, но будет выдавать исключение при запуске.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-117">If they aren’t, the parent runbook will appear to publish properly, but will generate an exception when it’s started.</span></span> <span data-ttu-id="ccbf5-118">В этом случае можно повторно опубликовать родительский Runbook, чтобы исправить ссылки на дочерние Runbook.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-118">If this happens, you can republish the parent runbook in order to properly reference the child runbooks.</span></span> <span data-ttu-id="ccbf5-119">Не надо повторно публиковать родительский Runbook, если были изменены все дочерние Runbook, так как связь уже будет создана.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-119">You do not need to republish the parent runbook if any of the child runbooks are changed because the association will have already been created.</span></span>

<span data-ttu-id="ccbf5-120">Параметры дочернего модуля Runbook со встроенным вызовом могут иметь любой тип данных, включая сложные объекты. Кроме того, отсутствует [сериализация JSON](automation-starting-a-runbook.md#runbook-parameters), как при запуске Runbook с помощью портала управления Azure или командлета Start-AzureRmAutomationRunbook.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-120">The parameters of a child runbook called inline can be any data type including complex objects, and there is no [JSON serialization](automation-starting-a-runbook.md#runbook-parameters) as there is when you start the runbook using the Azure Management Portal or with the Start-AzureRmAutomationRunbook cmdlet.</span></span>

### <a name="runbook-types"></a><span data-ttu-id="ccbf5-121">Типы Runbook</span><span class="sxs-lookup"><span data-stu-id="ccbf5-121">Runbook types</span></span>
<span data-ttu-id="ccbf5-122">Какие типы могут вызывать друг друга?</span><span class="sxs-lookup"><span data-stu-id="ccbf5-122">Which types can call each other:</span></span>

* <span data-ttu-id="ccbf5-123">[Runbook PowerShell](automation-runbook-types.md#powershell-runbooks)и [графические модули Runbook](automation-runbook-types.md#graphical-runbooks) могут вызывать друг друга с помощью встроенного вызова (на основе PowerShell).</span><span class="sxs-lookup"><span data-stu-id="ccbf5-123">A [PowerShell runbook](automation-runbook-types.md#powershell-runbooks) and [Graphical runbooks](automation-runbook-types.md#graphical-runbooks) can call each other inline (both are PowerShell based).</span></span>
* <span data-ttu-id="ccbf5-124">[Runbook рабочего процесса PowerShell](automation-runbook-types.md#powershell-workflow-runbooks) и графические модули Runbook рабочего процесса PowerShell могут вызывать друг друга с помощью встроенного вызова (на основе рабочих процессов PowerShell).</span><span class="sxs-lookup"><span data-stu-id="ccbf5-124">A [PowerShell Workflow runbook](automation-runbook-types.md#powershell-workflow-runbooks) and Graphical PowerShell Workflow runbooks can call each other inline (both are PowerShell Workflow based)</span></span>
* <span data-ttu-id="ccbf5-125">Типы PowerShell и типы рабочего процесса PowerShell не могут вызывать друг друга с помощью встроенного вызова и должны использовать командлет Start-AzureRmAutomationRunbook.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-125">The PowerShell types and the PowerShell Workflow types can’t call each other inline, and must use Start-AzureRmAutomationRunbook.</span></span>

<span data-ttu-id="ccbf5-126">Когда имеет значение порядок публикации?</span><span class="sxs-lookup"><span data-stu-id="ccbf5-126">When does publish order matter:</span></span>

* <span data-ttu-id="ccbf5-127">Порядок публикации модулей Runbook имеет значение только для модулей Runbook рабочего процесса PowerShell и графических модулей Runbook рабочего процесса PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-127">The publish order of runbooks only matters for PowerShell Workflow and Graphical PowerShell Workflow runbooks.</span></span>

<span data-ttu-id="ccbf5-128">При вызове графического Runbook и Runbook рабочего процесса PowerShell с помощью встроенного выполнения просто используйте имя необходимого Runbook.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-128">When you call a Graphical or PowerShell Workflow child runbook using inline execution, you just use the name of the runbook.</span></span>  <span data-ttu-id="ccbf5-129">При вызове дочернего модуля runbook PowerShell, необходимо перед его имя с *.\\*  для указания, что сценарий находится в локальном каталоге.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-129">When you call a PowerShell child runbook, you must preceded its name with *.\\* to specify that the script is located in the local directory.</span></span> 

### <a name="example"></a><span data-ttu-id="ccbf5-130">Пример</span><span class="sxs-lookup"><span data-stu-id="ccbf5-130">Example</span></span>
<span data-ttu-id="ccbf5-131">В следующем примере вызывается тестовый дочерний Runbook, который принимает три параметра: сложный объект, целое число и логическое значение.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-131">The following example invokes a test child runbook that accepts three parameters, a complex object, an integer, and a boolean.</span></span> <span data-ttu-id="ccbf5-132">Выходные данные дочернего Runbook присваиваются переменной.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-132">The output of the child runbook is assigned to a variable.</span></span>  <span data-ttu-id="ccbf5-133">В этом случае дочерний Runbook представляет собой Runbook рабочего процесса PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-133">In this case, the child runbook is a PowerShell Workflow runbook</span></span>

    $vm = Get-AzureRmVM –ResourceGroupName "LabRG" –Name "MyVM"
    $output = PSWF-ChildRunbook –VM $vm –RepeatCount 2 –Restart $true

<span data-ttu-id="ccbf5-134">Ниже приведен тот же пример с использованием Runbook PowerShell в качестве дочернего элемента.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-134">Following is the same example using a PowerShell runbook as the child.</span></span>

    $vm = Get-AzureRmVM –ResourceGroupName "LabRG" –Name "MyVM"
    $output = .\PS-ChildRunbook.ps1 –VM $vm –RepeatCount 2 –Restart $true


## <a name="starting-a-child-runbook-using-cmdlet"></a><span data-ttu-id="ccbf5-135">Запуск дочернего Runbook с помощью командлета</span><span class="sxs-lookup"><span data-stu-id="ccbf5-135">Starting a child runbook using cmdlet</span></span>
<span data-ttu-id="ccbf5-136">Чтобы запустить модуль Runbook, можно воспользоваться командлетом [Start-AzureRmAutomationRunbook](https://msdn.microsoft.com/library/mt603661.aspx), как описано в разделе [Запуск модуля Runbook с помощью Windows PowerShell](automation-starting-a-runbook.md#starting-a-runbook-with-windows-powershell).</span><span class="sxs-lookup"><span data-stu-id="ccbf5-136">You can use the [Start-AzureRmAutomationRunbook](https://msdn.microsoft.com/library/mt603661.aspx) cmdlet to start a runbook as described in [To start a runbook with Windows PowerShell](automation-starting-a-runbook.md#starting-a-runbook-with-windows-powershell).</span></span> <span data-ttu-id="ccbf5-137">Этот командлет можно использовать в двух режимах.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-137">There are two modes of use for this cmdlet.</span></span>  <span data-ttu-id="ccbf5-138">В одном режиме командлет возвращает идентификатор задания при создании дочернего задания для дочернего модуля Runbook.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-138">In one mode, the cmdlet returns the job id as soon as the child job is created for the child runbook.</span></span>  <span data-ttu-id="ccbf5-139">В другом режиме, который можно включить, указав параметр **-wait** , командлет ожидает завершения дочернего задания и возвращает выходные данные из дочернего модуля Runbook.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-139">In the other mode, which you enable by specifying the **-wait** parameter, the cmdlet will wait until the child job finishes and will return the output from the child runbook.</span></span>

<span data-ttu-id="ccbf5-140">Задание дочернего Runbook, запущенного с помощью командлета, будет выполняться отдельно от задания родительского Runbook.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-140">The job from a child runbook started with a cmdlet will run in a separate job from the parent runbook.</span></span> <span data-ttu-id="ccbf5-141">Это порождает больше заданий, чем при встроенном вызове компонента runbook, и усложняет их отслеживание.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-141">This results in more jobs than invoking the runbook inline and makes them more difficult to track.</span></span> <span data-ttu-id="ccbf5-142">Родительский модуль Runbook может запустить несколько дочерних модулей Runbook асинхронно, не ожидая завершения каждого из них.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-142">The parent can start multiple child runbooks asynchronously without waiting for each to complete.</span></span> <span data-ttu-id="ccbf5-143">Для такого параллельного выполнения дочерних Runbook с помощью встроенного вызова в родительском Runbook потребуется использовать [ключевое слово parallel](automation-powershell-workflow.md#parallel-processing).</span><span class="sxs-lookup"><span data-stu-id="ccbf5-143">For that same kind of parallel execution calling the child runbooks inline, the parent runbook would need to use the [parallel keyword](automation-powershell-workflow.md#parallel-processing).</span></span>

<span data-ttu-id="ccbf5-144">Параметры дочернего Runbook, запускаемого с помощью командлета, предоставляются в виде хэш-таблицы, как описано в статье [Параметры Runbook](automation-starting-a-runbook.md#runbook-parameters).</span><span class="sxs-lookup"><span data-stu-id="ccbf5-144">Parameters for a child runbook started with a cmdlet are provided as a hashtable as described in [Runbook Parameters](automation-starting-a-runbook.md#runbook-parameters).</span></span> <span data-ttu-id="ccbf5-145">Можно использовать только простые типы данных.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-145">Only simple data types can be used.</span></span> <span data-ttu-id="ccbf5-146">Если у Runbook есть параметр со сложным типом данных, то для него необходимо использовать встроенный вызов.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-146">If the runbook has a parameter with a complex data type, then it must be called inline.</span></span>

### <a name="example"></a><span data-ttu-id="ccbf5-147">Пример</span><span class="sxs-lookup"><span data-stu-id="ccbf5-147">Example</span></span>
<span data-ttu-id="ccbf5-148">В следующем примере с помощью командлета Start-AzureRmAutomationRunbook с параметром -wait запускается дочерний модуль Runbook с параметрами и ожидается его завершение.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-148">The following example starts a child runbook with parameters and then waits for it to complete using the Start-AzureRmAutomationRunbook -wait parameter.</span></span> <span data-ttu-id="ccbf5-149">После завершения его выходные данные собираются из дочернего модуля Runbook.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-149">Once completed, its output is collected from the child runbook.</span></span>

    $params = @{"VMName"="MyVM";"RepeatCount"=2;"Restart"=$true} 
    $joboutput = Start-AzureRmAutomationRunbook –AutomationAccountName "MyAutomationAccount" –Name "Test-ChildRunbook" -ResourceGroupName "LabRG" –Parameters $params –wait


## <a name="comparison-of-methods-for-calling-a-child-runbook"></a><span data-ttu-id="ccbf5-150">Сравнение методов вызова дочернего Runbook</span><span class="sxs-lookup"><span data-stu-id="ccbf5-150">Comparison of methods for calling a child runbook</span></span>
<span data-ttu-id="ccbf5-151">В следующей таблице перечислены различия между двумя методами вызова Runbook из другого Runbook.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-151">The following table summarizes the differences between the two methods for calling a runbook from another runbook.</span></span>

|  | <span data-ttu-id="ccbf5-152">Встроенный</span><span class="sxs-lookup"><span data-stu-id="ccbf5-152">Inline</span></span> | <span data-ttu-id="ccbf5-153">Командлет</span><span class="sxs-lookup"><span data-stu-id="ccbf5-153">Cmdlet</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="ccbf5-154">Задание</span><span class="sxs-lookup"><span data-stu-id="ccbf5-154">Job</span></span> |<span data-ttu-id="ccbf5-155">Дочерние Runbook выполняются в том же задании, что и родительский.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-155">Child runbooks run in the same job as the parent.</span></span> |<span data-ttu-id="ccbf5-156">Для дочернего Runbook создается отдельное задание.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-156">A separate job is created for the child runbook.</span></span> |
| <span data-ttu-id="ccbf5-157">Выполнение</span><span class="sxs-lookup"><span data-stu-id="ccbf5-157">Execution</span></span> |<span data-ttu-id="ccbf5-158">Родительский Runbook ожидает завершения дочернего Runbook, прежде чем продолжить выполнение.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-158">Parent runbook waits for the child runbook to complete before continuing.</span></span> |<span data-ttu-id="ccbf5-159">Родительский модуль Runbook продолжает работу сразу после запуска дочернего модуля Runbook *или* ожидает завершения дочернего задания.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-159">Parent runbook continues immediately after child runbook is started *or* parent runbook waits for the child job to finish.</span></span> |
| <span data-ttu-id="ccbf5-160">Выходные данные</span><span class="sxs-lookup"><span data-stu-id="ccbf5-160">Output</span></span> |<span data-ttu-id="ccbf5-161">Родительский Runbook может получить выходные данные непосредственно из дочернего Runbook.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-161">Parent runbook can directly get output from child runbook.</span></span> |<span data-ttu-id="ccbf5-162">Родительский модуль Runbook должен получить выходные данные из задания дочернего модуля Runbook *или* может получить выходные данные непосредственно из дочернего модуля Runbook.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-162">Parent runbook must retrieve output from child runbook job *or* parent runbook can directly get output from child runbook.</span></span> |
| <span data-ttu-id="ccbf5-163">Параметры</span><span class="sxs-lookup"><span data-stu-id="ccbf5-163">Parameters</span></span> |<span data-ttu-id="ccbf5-164">Значения параметров дочернего Runbook указываются отдельно и могут иметь любой тип данных.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-164">Values for the child runbook parameters are specified separately and can use any data type.</span></span> |<span data-ttu-id="ccbf5-165">Значения параметров дочернего Runbook должны быть объединены в одну хэш-таблицу и могут содержать только простые, регулярные и объектные типы данных, использующие сериализацию JSON.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-165">Values for the child runbook parameters must be combined into a single hashtable and can only include simple, array, and object data types that leverage JSON serialization.</span></span> |
| <span data-ttu-id="ccbf5-166">Учетная запись службы автоматизации</span><span class="sxs-lookup"><span data-stu-id="ccbf5-166">Automation Account</span></span> |<span data-ttu-id="ccbf5-167">Родительский Runbook может использовать только дочерний Runbook, находящийся в той же учетной записи автоматизации.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-167">Parent runbook can only use child runbook in the same automation account.</span></span> |<span data-ttu-id="ccbf5-168">Родительский модуль Runbook может использовать дочерний Runbook из любой учетной записи автоматизации в той же подписке Azure и даже в другой подписке, если к ней есть подключение.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-168">Parent runbook can use child runbook from any automation account from the same Azure subscription and even a different subscription if you have a connection to it.</span></span> |
| <span data-ttu-id="ccbf5-169">Публикация</span><span class="sxs-lookup"><span data-stu-id="ccbf5-169">Publishing</span></span> |<span data-ttu-id="ccbf5-170">Перед публикацией родительского Runbook должен быть опубликован дочерний Runbook.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-170">Child runbook must be published before parent runbook is published.</span></span> |<span data-ttu-id="ccbf5-171">Дочерний Runbook должен быть опубликован в любое время до запуска родительского Runbook.</span><span class="sxs-lookup"><span data-stu-id="ccbf5-171">Child runbook must be published any time before parent runbook is started.</span></span> |

## <a name="next-steps"></a><span data-ttu-id="ccbf5-172">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="ccbf5-172">Next steps</span></span>
* [<span data-ttu-id="ccbf5-173">Запуск модуля Runbook в службе автоматизации Azure</span><span class="sxs-lookup"><span data-stu-id="ccbf5-173">Starting a runbook in Azure Automation</span></span>](automation-starting-a-runbook.md)
* [<span data-ttu-id="ccbf5-174">Выходные данные и сообщения Runbook в службе автоматизации Azure</span><span class="sxs-lookup"><span data-stu-id="ccbf5-174">Runbook output and messages in Azure Automation</span></span>](automation-runbook-output-and-messages.md)

