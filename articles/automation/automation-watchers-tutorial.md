---
title: "Создание задачи наблюдателя в учетной записи службы автоматизации Azure | Документация Майкрософт"
description: "Узнайте, как создать задачу наблюдателя в учетной записи службы автоматизации Azure, чтобы отслеживать создание файлов в папке."
services: automation
documentationcenter: 
author: eamonoreilly
manager: 
editor: 
ms.assetid: 0dd95270-761f-448e-af48-c8b1e82cd821
ms.service: automation
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 12/11/2017
ms.author: eamono
ms.openlocfilehash: 294faa48f9840919b087594835706bad8048d45b
ms.sourcegitcommit: a648f9d7a502bfbab4cd89c9e25aa03d1a0c412b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/22/2017
---
# <a name="create-an-azure-automation-watcher-tasks-to-track-file-changes-on-a-local-machine"></a>Создание задач для отслеживания изменений файла на локальном компьютере наблюдатель службы автоматизации Azure

Служба автоматизации Azure использует задачи наблюдателя для слежения за событиями и вызова действий. Этот учебник поможет выполнить создание задачи наблюдателя для отслеживания при добавлении нового файла в каталог.

Из этого руководства вы узнаете, как выполнять такие задачи:

> [!div class="checklist"]
> * Импорт модуля runbook наблюдателя
> * Создание переменной службы автоматизации
> * Создать действие модуль runbook
> * Создание задачи наблюдателя
> * Наблюдатель триггера
> * Проверьте выходные данные

## <a name="prerequisites"></a>Технические условия

Чтобы завершить этот учебник, необходимы следующие компоненты:

* Подписка Azure. Если у вас ее нет, [активируйте преимущества для подписчиков MSDN](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) или [зарегистрируйте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).
* [Учетная запись службы автоматизации](automation-offering-get-started.md) для хранения runbook наблюдателя, runbook действия и задачи наблюдателя.
* [Гибридная рабочая роль runbook](automation-hybrid-runbook-worker.md), в которой выполняется задача наблюдателя.

## <a name="import-a-watcher-runbook"></a>Импорт модуля runbook наблюдателя

В этом учебнике используется наблюдателя модуля runbook с именем **NewFile Контрольное значение** для поиска новых файлов в каталоге. Runbook наблюдатель получает время последней записи, известные для файлов в папке и рассматривает все файлы более новой версии этого предела. На этом шаге выполняется импорт этого модуля runbook в учетной записи автоматизации.

1. Открыть учетную запись автоматизации, а затем выберите команду **Runbooks** страницы.
1. Щелкните **обзора коллекции** кнопки.
1. Поиск «Наблюдатель runbook» выберите **runbook наблюдателя, который ищет новые файлы в каталоге** и выберите **импорта**.
  ![Импорт runbook службы автоматизации из пользовательского интерфейса](media/automation-watchers-tutorial/importsourcewatcher.png)
1. Предоставить runbook, имя, описание и выберите **ОК** для импорта модуля runbook в учетной записи автоматизации.
1. Выберите **изменить** и нажмите кнопку **публикации**. При появлении соответствующего запроса выберите **Да** для публикации модуля runbook.

## <a name="create-an-automation-variable"></a>Создание переменной службы автоматизации

[Переменной службы автоматизации](automation-variables.md) используется для хранения отметок времени, которая выше runbook считывает и сохраняет из каждого файла. 

1. Выберите **переменных** под **общие ресурсы** и выберите **+ добавить переменную**.
1. Введите имя «Контрольные значения-NewFileTimestamp»
1. Выберите даты и времени для типа.
1. Щелкните **создать** кнопки. При этом создается переменная автоматизации.

## <a name="create-an-action-runbook"></a>Создать действие модуль runbook

Действие runbook используется в задачи наблюдателя для работы с данными, переданных из runbook наблюдателя. На этом шаге обновить Импорт предварительно определенного действия модуля runbook с именем «Процесс NewFile».

1. Перейдите к вашей учетной записи автоматизации и выберите **Runbooks** под **АВТОМАТИЗАЦИИ ПРОЦЕССОВ** категории.
1. Щелкните **обзора коллекции** кнопки.
1. Поиск «Наблюдатель действие» и выберите **действие наблюдателя, обрабатывает события, вызванные runbook наблюдателя** и выберите **импорта**.
  ![Импорт runbook действия из пользовательского интерфейса](media/automation-watchers-tutorial/importsourceaction.png)
1. Предоставить runbook, имя, описание и выберите **ОК** для импорта модуля runbook в учетной записи автоматизации.
1. Выберите **изменить** и нажмите кнопку **публикации**. При появлении соответствующего запроса выберите **Да** для публикации модуля runbook.

## <a name="create-a-watcher-task"></a>Создание задачи наблюдателя

Задача «отслеживание» состоит из двух частей. Наблюдатель и действия. Наблюдатель выполняется с интервалом, определенными в задаче наблюдателя. Данные из runbook наблюдателя передается на действие runbook. На этом этапе настройки задачи «Отслеживание», ссылка на наблюдатель и действия модулей Runbook, определенные на предыдущих шагах.

1. Перейдите к вашей учетной записи автоматизации и выберите **задачи наблюдателя** под **АВТОМАТИЗАЦИИ ПРОЦЕССОВ** категории.
1. Наблюдатель страница выбора задач и выберите команду **+ добавить задачи «Отслеживание»** кнопки.
1. Введите «WatchMyFolder» в качестве имени.

1. Выберите **Настройка наблюдателя** и выберите **Контрольные значения NewFile** runbook.

1. Введите следующие значения параметров.

   * **FOLDERPATH** -папку в гибридной рабочей роли, где создаются новые файлы. d:\examplefiles
   * **РАСШИРЕНИЕ** -оставьте пустым, чтобы обработать все расширения файлов.
   * **RECURSE** -оставить это значение по умолчанию.
   * **Параметры ЗАПУСКА** -Pick гибридной рабочей роли.

1. Нажмите кнопку "ОК" и щелкните "Выбрать", чтобы вернуться на страницу наблюдателя.
1. Выберите **настроить действие** и выберите «Процесс NewFile» runbook.
1. Введите следующие значения параметров:

   *    **Функция EVENTDATA** -оставьте поле пустым. Данные передаются из runbook наблюдателя.  
   *    **Параметры запуска** -оставить как Azure во время выполнения этот runbook в службе автоматизации.

1. Нажмите кнопку **ОК**, а затем выберите, чтобы вернуться на страницу наблюдателя.
1. Нажмите кнопку **ОК** для создания задачи наблюдателя.

![Настройка действия наблюдателя из пользовательского интерфейса](media/automation-watchers-tutorial/watchertaskcreation.png)

## <a name="trigger-a-watcher"></a>Наблюдатель триггера

Для тестирования наблюдатель работает надлежащим образом, необходимо создать файл теста.

Удаленное подключение гибридной рабочей роли. Откройте **PowerShell** и создайте тестовый файл в папке.
  
   ```PowerShell-interactive
   New-Item -Name ExampleFile1.txt
   ```

В следующем примере показано ожидаемый результат.

```
    Directory: D:\examplefiles


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----       12/11/2017   9:05 PM              0 ExampleFile1.txt
```

## <a name="inspect-the-output"></a>Проверьте выходные данные

1. Перейдите к вашей учетной записи автоматизации и выберите **задачи наблюдателя** под **АВТОМАТИЗАЦИИ ПРОЦЕССОВ** категории.
1. Выберите задачу «WatchMyFolder» наблюдатель.
1. Щелкните **просматривать потоки наблюдателя** под **потоки** наблюдатель обнаружен новый файл данных и запуска действия runbook.
1. Для просмотра заданий действие runbook, щелкните на **Просмотр заданий действие наблюдателя**. Каждое задание может быть выбран представление сведений о задании.

   ![Наблюдатель действие задания из пользовательского интерфейса](media/automation-watchers-tutorial/WatcherActionJobs.png)

Ожидаемый результат при обнаружении нового файла можно увидеть в следующем примере:

```
Message is Process new file...



Passed in data is @{FileName=D:\examplefiles\ExampleFile1.txt; Length=0}
```

## <a name="next-steps"></a>Дальнейшие действия

Из этого руководства вы узнали, как выполнить следующие задачи:

> [!div class="checklist"]
> * Импорт модуля runbook наблюдателя
> * Создание переменной службы автоматизации
> * Создать действие модуль runbook
> * Создание задачи наблюдателя
> * Наблюдатель триггера
> * Проверьте выходные данные

Перейдите по ссылке для получения дополнительных сведений о создании собственного модуля runbook.

> [!div class="nextstepaction"]
> [Мой первый runbook PowerShell](automation-first-runbook-textual-powershell.md).
