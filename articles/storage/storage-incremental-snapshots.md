---
title: "aaaUse добавочных моментальных снимков для резервного копирования и восстановления неуправляемые дисков виртуальной Машины Azure | Документы Microsoft"
description: "Создание пользовательского решения для архивации и восстановления дисков виртуальной машины Azure с помощью добавочных моментальных снимков."
services: storage
documentationcenter: na
author: aungoo-msft
manager: tadb
editor: tysonn
ms.assetid: 3524b987-bd65-4e35-83e7-fbc2136643e5
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/23/2017
ms.author: aungoo
ms.openlocfilehash: 6d3e6d78e953f77a1028ac35dcde1ef046dbc3bb
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="back-up-azure-unmanaged-vm-disks-with-incremental-snapshots"></a><span data-ttu-id="c9ef4-103">Архивация неуправляемых дисков виртуальной машины Azure с помощью добавочных моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="c9ef4-103">Back up Azure unmanaged VM disks with incremental snapshots</span></span>
## <a name="overview"></a><span data-ttu-id="c9ef4-104">Обзор</span><span class="sxs-lookup"><span data-stu-id="c9ef4-104">Overview</span></span>
<span data-ttu-id="c9ef4-105">Хранилище Azure предоставляет возможность hello tootake моментальные снимки больших двоичных объектов.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-105">Azure Storage provides hello capability tootake snapshots of blobs.</span></span> <span data-ttu-id="c9ef4-106">Моментальные снимки записать состояние hello большого двоичного объекта на момент времени.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-106">Snapshots capture hello blob state at that point in time.</span></span> <span data-ttu-id="c9ef4-107">В этой статье мы опишем, как можно поддерживать архивы дисков виртуальной машины с помощью моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-107">In this article, we will describe a scenario of how you can maintain backups of virtual machine disks using snapshots.</span></span> <span data-ttu-id="c9ef4-108">Этот метод можно использовать при выборе не toouse резервного копирования Azure и служба восстановления и пожеланий toocreate пользовательской стратегией резервного копирования для дисков виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-108">You can use this methodology when you choose not toouse Azure Backup and Recovery Service, and wish toocreate a custom backup strategy for your virtual machine disks.</span></span>

<span data-ttu-id="c9ef4-109">Диски виртуальной машины Azure хранятся в службе хранилища Azure как страничные BLOB-объекты.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-109">Azure virtual machine disks are stored as page blobs in Azure Storage.</span></span> <span data-ttu-id="c9ef4-110">Поскольку мы говорим о стратегию резервного копирования для дисков виртуальной машины в этой статье, мы будет ссылаться toosnapshots в контексте hello страничные большие двоичные объекты.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-110">Since we are talking about backup strategy for virtual machine disks in this article, we will be referring toosnapshots in hello context of page blobs.</span></span> <span data-ttu-id="c9ef4-111">toolearn Дополнительные сведения о моментальных снимков, см. слишком[создание моментального снимка большого двоичного объекта](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span><span class="sxs-lookup"><span data-stu-id="c9ef4-111">toolearn more about snapshots, refer too[Creating a Snapshot of a Blob](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span></span>

## <a name="what-is-a-snapshot"></a><span data-ttu-id="c9ef4-112">Что такое моментальный снимок?</span><span class="sxs-lookup"><span data-stu-id="c9ef4-112">What is a snapshot?</span></span>
<span data-ttu-id="c9ef4-113">Моментальный снимок большого двоичного объекта — это доступная только для чтения версия большого двоичного объекта, созданная в определенный момент времени.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-113">A blob snapshot is a read-only version of a blob that is captured at a point in time.</span></span> <span data-ttu-id="c9ef4-114">После создания моментального снимка его можно читать, копировать или удалять, но нельзя изменять.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-114">Once a snapshot has been created, it can be read, copied, or deleted, but not modified.</span></span> <span data-ttu-id="c9ef4-115">Моментальные снимки обеспечивают tooback способом копирования большого двоичного объекта, как оно отображается в момент времени.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-115">Snapshots provide a way tooback up a blob as it appears at a moment in time.</span></span> <span data-ttu-id="c9ef4-116">До версии 2015-04-05 REST имели возможность hello toocopy полный моментальные снимки.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-116">Until REST version 2015-04-05 you had hello ability toocopy full snapshots.</span></span> <span data-ttu-id="c9ef4-117">С hello REST версии 2015-07-08 и более поздних версий, можно также можно скопировать добавочных моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-117">With hello REST version 2015-07-08 and above, you can also copy incremental snapshots.</span></span>

## <a name="full-snapshot-copy"></a><span data-ttu-id="c9ef4-118">Копирование полных моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="c9ef4-118">Full snapshot copy</span></span>
<span data-ttu-id="c9ef4-119">Моментальные снимки могут быть скопированы tooanother учетной записи хранения в качестве резервных копий больших двоичных объектов tookeep hello базового большого двоичного объекта.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-119">Snapshots can be copied tooanother storage account as a blob tookeep backups of hello base blob.</span></span> <span data-ttu-id="c9ef4-120">Также можно скопировать моментальный снимок через его базовый большой двоичный объект, как восстановление tooan hello большой двоичный объект более ранней версии.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-120">You can also copy a snapshot over its base blob, which is like restoring hello blob tooan earlier version.</span></span> <span data-ttu-id="c9ef4-121">При копировании из одной tooanother учетной записи хранилища моментального снимка будет занимать hello же пространства как большой двоичный объект базовой страницы приветствия.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-121">When a snapshot is copied from one storage account tooanother, it will occupy hello same space as hello base page blob.</span></span> <span data-ttu-id="c9ef4-122">Таким образом копирование всего моментальных снимков из одного tooanother учетную запись хранилища будет выполняться медленно и также будет занимать много места в hello целевой учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-122">Therefore, copying whole snapshots from one storage account tooanother will be slow and will also consume lot of space in hello target storage account.</span></span>

> [!NOTE]
> <span data-ttu-id="c9ef4-123">При копировании hello базового большого двоичного объекта tooanother назначения hello снимков hello BLOB-объекта не копируются вместе с ним.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-123">If you copy hello base blob tooanother destination, hello snapshots of hello blob are not copied along with it.</span></span> <span data-ttu-id="c9ef4-124">Аналогичным образом при перезаписи базового BLOB-объекта с копией, моментальные снимки, связанные с hello базового большого двоичного объекта не затрагиваются и остаются неизменными, под именем базового большого двоичного объекта.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-124">Similarly, if you overwrite a base blob with a copy, snapshots associated with hello base blob are not affected and stay intact under base blob name.</span></span>
> 
> 

### <a name="back-up-disks-using-snapshots"></a><span data-ttu-id="c9ef4-125">Архивация дисков с помощью моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="c9ef4-125">Back up disks using snapshots</span></span>
<span data-ttu-id="c9ef4-126">В рамках стратегии резервного копирования для дисков виртуальной машины можно периодическое создание большого двоичного объекта диска или страницу приветствия и скопировать их tooanother учетной записи хранилища с помощью таких средств, как [копирования BLOB-объекта](https://msdn.microsoft.com/library/azure/dd894037.aspx) операции или [AzCopy](storage-use-azcopy.md).</span><span class="sxs-lookup"><span data-stu-id="c9ef4-126">As a backup strategy for your virtual machine disks, you can take periodic snapshots of hello disk or page blob, and copy them tooanother storage account using tools like [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) operation or [AzCopy](storage-use-azcopy.md).</span></span> <span data-ttu-id="c9ef4-127">Можно скопировать моментальный снимок tooa страницы BLOB-объект назначения с другим именем.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-127">You can copy a snapshot tooa destination page blob with a different name.</span></span> <span data-ttu-id="c9ef4-128">Hello результирующий целевой страничный большой двоичный объект является большой двоичный объект для записи страницы и моментальный снимок не.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-128">hello resulting destination page blob is a writeable page blob and not a snapshot.</span></span> <span data-ttu-id="c9ef4-129">Далее в этой статье рассматриваются действия tootake резервных копий с использованием моментальных снимков дисков виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-129">Later in this article we will describe steps tootake backups of virtual machine disks using snapshots.</span></span>

### <a name="restore-disks-using-snapshots"></a><span data-ttu-id="c9ef4-130">Восстановление дисков с помощью моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="c9ef4-130">Restore disks using snapshots</span></span>
<span data-ttu-id="c9ef4-131">Когда диск tooa предыдущей стабильной версии, записанные в одной из резервных копий моментальных снимков hello toorestore времени, можно скопировать моментальный снимок на большой двоичный объект базовой страницы приветствия.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-131">When it is time toorestore your disk tooa previous stable version captured in one of hello backup snapshots, you can copy a snapshot over hello base page blob.</span></span> <span data-ttu-id="c9ef4-132">После hello моментального снимка большого двоичного объекта повышенного уровня toohello базовой страницы, hello моментальный снимок остается, но его исходник перезаписывается копией, можно как для чтения и записи.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-132">After hello snapshot is promoted toohello base page blob, hello snapshot remains, but its source is overwritten with a copy that can be both read and written.</span></span> <span data-ttu-id="c9ef4-133">Далее в этой статье рассматриваются действия toorestore предыдущей версии на диске из ее моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-133">Later in this article we will describe steps toorestore a previous version of your disk from its snapshot.</span></span>

### <a name="implementing-full-snapshot-copy"></a><span data-ttu-id="c9ef4-134">Реализация копирования полных моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="c9ef4-134">Implementing full snapshot copy</span></span>
<span data-ttu-id="c9ef4-135">Копирование полного моментального снимка можно реализовать, выполнив следующие hello</span><span class="sxs-lookup"><span data-stu-id="c9ef4-135">You can implement a full snapshot copy by doing hello following,</span></span>

* <span data-ttu-id="c9ef4-136">Во-первых, сделайте снимок hello базового BLOB-объекта с помощью hello [моментального снимка большого двоичного объекта](https://msdn.microsoft.com/library/azure/ee691971.aspx) операции.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-136">First, take a snapshot of hello base blob using hello [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx) operation.</span></span>
* <span data-ttu-id="c9ef4-137">Затем копия hello моментального снимка tooa целевого хранилища учетной записи с помощью [копирования BLOB-объекта](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span><span class="sxs-lookup"><span data-stu-id="c9ef4-137">Then, copy hello snapshot tooa target storage account using [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span></span>
* <span data-ttu-id="c9ef4-138">Повторите этот процесс toomaintain резервные копии базового большого двоичного объекта.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-138">Repeat this process toomaintain backup copies of your base blob.</span></span>

## <a name="incremental-snapshot-copy"></a><span data-ttu-id="c9ef4-139">Копирование добавочных моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="c9ef4-139">Incremental snapshot copy</span></span>
<span data-ttu-id="c9ef4-140">Новая функция Hello в [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) API-Интерфейс обеспечивает гораздо лучшую tooback способом, копирование моментальных снимков hello страничные большие двоичные объекты или дисков.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-140">hello new feature in [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) API provides a much better way tooback up hello snapshots of your page blobs or disks.</span></span> <span data-ttu-id="c9ef4-141">Hello API возвращает hello список изменений между hello базового большого двоичного объекта и моментальные снимки hello.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-141">hello API returns hello list of changes between hello base blob and hello snapshots.</span></span> <span data-ttu-id="c9ef4-142">Это уменьшает hello объем хранилища используется для резервного копирования hello учетной записи.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-142">This reduces hello amount of storage space used on hello backup account.</span></span> <span data-ttu-id="c9ef4-143">Hello API поддерживает страничные большие двоичные объекты в хранилище Premium, а также стандартное хранилище.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-143">hello API supports page blobs on Premium Storage as well as Standard Storage.</span></span> <span data-ttu-id="c9ef4-144">С помощью данного API можно создавать более быстрые и эффективные решения архивации для виртуальных машин Azure.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-144">Using this API, you can now build faster and efficient backup solutions for Azure VMs.</span></span> <span data-ttu-id="c9ef4-145">Это будет hello REST версии 2015-07-08 и более поздних версий.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-145">This will be available with hello REST version 2015-07-08 and higher.</span></span>

<span data-ttu-id="c9ef4-146">Добавочное копирование моментального снимка допускает toocopy из одного хранилища учетной записи tooanother hello разность,</span><span class="sxs-lookup"><span data-stu-id="c9ef4-146">Incremental Snapshot Copy allows you toocopy from one storage account tooanother hello difference between,</span></span>

* <span data-ttu-id="c9ef4-147">между базовым большим двоичным объектом и его моментальным снимком ИЛИ</span><span class="sxs-lookup"><span data-stu-id="c9ef4-147">Base blob and its Snapshot OR</span></span>
* <span data-ttu-id="c9ef4-148">Любые два снимка hello базового большого двоичного объекта</span><span class="sxs-lookup"><span data-stu-id="c9ef4-148">Any two snapshots of hello base blob</span></span>

<span data-ttu-id="c9ef4-149">Если выполняются следующие условия hello,</span><span class="sxs-lookup"><span data-stu-id="c9ef4-149">Provided hello following conditions are met,</span></span>

* <span data-ttu-id="c9ef4-150">Hello BLOB-объект был создан Jan 1 2016 г. или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-150">hello blob was created on Jan-1-2016 or later.</span></span>
* <span data-ttu-id="c9ef4-151">Hello большой двоичный объект не был перезаписан с [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) или [копирования BLOB-объекта](https://msdn.microsoft.com/library/azure/dd894037.aspx) между двумя моментальными снимками.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-151">hello blob was not overwritten with [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) or [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) between two snapshots.</span></span>

<span data-ttu-id="c9ef4-152">**Примечание**. Эта функция доступна для страничных BLOB-объектов Azure класса Premium или "Стандартный".</span><span class="sxs-lookup"><span data-stu-id="c9ef4-152">**Note**: This feature is available for Premium and Standard Azure Page Blobs.</span></span>

<span data-ttu-id="c9ef4-153">При наличии пользовательской стратегией резервного копирования, который использует моментальные снимки, копирование моментальных снимков hello из одного tooanother учетной записи хранилища может вычисляться очень медленно и требует много места.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-153">When you have a custom backup strategy that uses snapshots, copying hello snapshots from one storage account tooanother can be very slow and consumes a lot of storage space.</span></span> <span data-ttu-id="c9ef4-154">Вместо копирования учетной записи для хранения резервных копий tooa всего моментального снимка hello, можно написать hello различие между последовательных моментальные снимки tooa резервного копирования страничного большого двоичного объекта.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-154">Instead of copying hello entire snapshot tooa backup storage account, you can write hello difference between consecutive snapshots tooa backup page blob.</span></span> <span data-ttu-id="c9ef4-155">В этом случае hello время toocopy пространства toostore резервного копирования и значительно снижается.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-155">This way, hello time toocopy and space toostore backups is substantially reduced.</span></span>

### <a name="implementing-incremental-snapshot-copy"></a><span data-ttu-id="c9ef4-156">Реализация копирования добавочных моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="c9ef4-156">Implementing Incremental Snapshot Copy</span></span>
<span data-ttu-id="c9ef4-157">Можно реализовать копирования моментального снимка, выполнив следующие hello</span><span class="sxs-lookup"><span data-stu-id="c9ef4-157">You can implement incremental snapshot copy by doing hello following,</span></span>

* <span data-ttu-id="c9ef4-158">Создание снимка hello базового BLOB-объекта с помощью [моментального снимка большого двоичного объекта](https://msdn.microsoft.com/library/azure/ee691971.aspx).</span><span class="sxs-lookup"><span data-stu-id="c9ef4-158">Take a snapshot of hello base blob using [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx).</span></span>
* <span data-ttu-id="c9ef4-159">Копировать hello моментального снимка toohello целевого хранилища резервных копий учетной записи с помощью [копирования BLOB-объекта](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span><span class="sxs-lookup"><span data-stu-id="c9ef4-159">Copy hello snapshot toohello target backup storage account using [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span></span> <span data-ttu-id="c9ef4-160">Это будет резервного копирования страничным hello.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-160">This will be hello backup page blob.</span></span> <span data-ttu-id="c9ef4-161">Сделайте моментальный снимок этого архивного страничного BLOB-объекта и сохраните его в архивной учетной записи.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-161">Take a snapshot of this backup page blob and store in backup account.</span></span>
* <span data-ttu-id="c9ef4-162">Создайте другой моментальный снимок hello базового BLOB-объекта с помощью моментального снимка большого двоичного объекта.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-162">Take another snapshot of hello base blob using Snapshot Blob.</span></span>
* <span data-ttu-id="c9ef4-163">Получить hello разницу между первой и второй моментальные снимки с помощью базового большого двоичного объекта [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx).</span><span class="sxs-lookup"><span data-stu-id="c9ef4-163">Get hello difference between first and second snapshots of base blob using  [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx).</span></span> <span data-ttu-id="c9ef4-164">Использовать новый параметр hello **prevsnapshot** toospecify hello значение DateTime hello снимок tooget отличие hello.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-164">Use hello new parameter **prevsnapshot** toospecify hello DateTime value of hello snapshot you want tooget hello difference with.</span></span> <span data-ttu-id="c9ef4-165">Если этот параметр присутствует, hello REST ответ будет содержать только hello страницы, которые были изменены между целевой снимком и предыдущим снимком, включая страницы, снимите флажок.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-165">When this parameter is present, hello REST response will include only hello pages that were changed between target snapshot and previous snapshot including clear pages.</span></span>
* <span data-ttu-id="c9ef4-166">Используйте [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) tooapply эти изменения toohello резервного копирования страничного большого двоичного объекта.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-166">Use [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) tooapply these changes toohello backup page blob.</span></span>
* <span data-ttu-id="c9ef4-167">Наконец снимок резервной копии страничным hello и их сохранения в учетной записи хранилища резервных копий hello.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-167">Finally, take a snapshot of hello backup page blob and store it in hello backup storage account.</span></span>

<span data-ttu-id="c9ef4-168">В следующем разделе hello рассматриваются более подробно как можно сохранять резервные копии дисков, с помощью добавочного копирования моментального снимка</span><span class="sxs-lookup"><span data-stu-id="c9ef4-168">In hello next section, we will describe in more detail how you can maintain backups of disks using Incremental Snapshot Copy</span></span>

## <a name="scenario"></a><span data-ttu-id="c9ef4-169">Сценарий</span><span class="sxs-lookup"><span data-stu-id="c9ef4-169">Scenario</span></span>
<span data-ttu-id="c9ef4-170">В этом разделе описывается сценарий, включающий в себя пользовательскую стратегию архивации для дисков виртуальной машины с помощью моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-170">In this section we will describe a scenario that involves a custom backup strategy for virtual machine disks using snapshots.</span></span>

<span data-ttu-id="c9ef4-171">Рассмотрим виртуальную машину Azure серии DS с подключенным диском P30 хранилища уровня "Премиум".</span><span class="sxs-lookup"><span data-stu-id="c9ef4-171">Consider a DS-series Azure VM with a premium storage P30 disk attached.</span></span> <span data-ttu-id="c9ef4-172">диск Hello P30 называют *mypremiumdisk* хранятся в учетной записи хранения premium вызывается *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-172">hello P30 disk called *mypremiumdisk* is stored in a premium storage account called *mypremiumaccount*.</span></span> <span data-ttu-id="c9ef4-173">Стандартная учетная запись хранения называется *mybackupstdaccount* будет использоваться для хранения резервной копии hello *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-173">A standard storage account called *mybackupstdaccount* will be used for storing hello backup of *mypremiumdisk*.</span></span> <span data-ttu-id="c9ef4-174">Мы хотели бы tookeep моментального снимка из *mypremiumdisk* каждые 12 часов.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-174">We would like tookeep a snapshot of *mypremiumdisk* every 12 hours.</span></span>

<span data-ttu-id="c9ef4-175">toolearn о создании учетной записи хранилища и диски, см. слишком[учетных записей хранилища Azure о](storage-create-storage-account.md).</span><span class="sxs-lookup"><span data-stu-id="c9ef4-175">toolearn about creating storage account and disks, refer too[About Azure storage accounts](storage-create-storage-account.md).</span></span>

<span data-ttu-id="c9ef4-176">toolearn о резервном копировании виртуальных машинах Azure, см. слишком[резервных копий виртуальной Машины Azure плана](../backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="c9ef4-176">toolearn about backing up Azure VMs, refer too[Plan Azure VM backups](../backup/backup-azure-vms-introduction.md).</span></span>

## <a name="steps-toomaintain-backups-of-a-disk-using-incremental-snapshots"></a><span data-ttu-id="c9ef4-177">Действия toomaintain резервных копий на диск с помощью добавочных моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="c9ef4-177">Steps toomaintain backups of a disk using incremental snapshots</span></span>
<span data-ttu-id="c9ef4-178">Hello описанные ниже действия будут создавать снимки *mypremiumdisk* и сохранять резервные копии hello в *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-178">hello steps described below will take snapshots of *mypremiumdisk* and maintain hello backups in *mybackupstdaccount*.</span></span> <span data-ttu-id="c9ef4-179">Hello резервная копия будет Стандартная страничного большого двоичного объекта вызывается *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-179">hello backup will be a standard page blob called *mybackupstdpageblob*.</span></span> <span data-ttu-id="c9ef4-180">Hello резервного копирования страничного большого двоичного объекта, всегда представляют Привет же состояний в качестве hello последний моментальный снимок *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-180">hello backup page blob will always reflect hello same state as hello last snapshot of *mypremiumdisk*.</span></span>

1. <span data-ttu-id="c9ef4-181">Во-первых создайте hello резервного копирования страничного большого двоичного объекта для диска хранения premium.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-181">First, create hello backup page blob for your premium storage disk.</span></span> <span data-ttu-id="c9ef4-182">toodo это, создайте снимок *mypremiumdisk* вызывается *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-182">toodo this, take a snapshot of *mypremiumdisk* called *mypremiumdisk_ss1*.</span></span>
2. <span data-ttu-id="c9ef4-183">Скопируйте этот моментальный снимок toomybackupstdaccount как страничного большого двоичного объекта вызывается *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-183">Copy this snapshot toomybackupstdaccount as a page blob called *mybackupstdpageblob*.</span></span>
3. <span data-ttu-id="c9ef4-184">Создайте моментальный снимок *mybackupstdpageblob* с именем *mybackupstdpageblob_ss1* с помощью операции [создания моментального снимка BLOB-объекта](https://msdn.microsoft.com/library/azure/ee691971.aspx) и сохраните его в *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-184">Take a snapshot of *mybackupstdpageblob* called *mybackupstdpageblob_ss1*, using [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx) and store it in *mybackupstdaccount*.</span></span>
4. <span data-ttu-id="c9ef4-185">Во время резервного копирования hello, создайте другой моментальный снимок *mypremiumdisk*, например *mypremiumdisk_ss2*и сохранить ее в *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-185">During hello backup window, create another snapshot of *mypremiumdisk*, say *mypremiumdisk_ss2*, and store it in *mypremiumaccount*.</span></span>
5. <span data-ttu-id="c9ef4-186">Получить hello добавочные изменения между снимками hello двух *mypremiumdisk_ss2* и *mypremiumdisk_ss1*, с использованием [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) на  *mypremiumdisk_ss2* с **prevsnapshot** параметру отметка времени toohello *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-186">Get hello incremental changes between hello two snapshots, *mypremiumdisk_ss2* and *mypremiumdisk_ss1*, using [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) on *mypremiumdisk_ss2* with **prevsnapshot** parameter set toohello timestamp of *mypremiumdisk_ss1*.</span></span> <span data-ttu-id="c9ef4-187">Записать эти добавочные изменения toohello резервного копирования страничного большого двоичного объекта *mybackupstdpageblob* в *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-187">Write these incremental changes toohello backup page blob *mybackupstdpageblob* in *mybackupstdaccount*.</span></span> <span data-ttu-id="c9ef4-188">Если имеются удаленные диапазоны в hello добавочные изменения, должен быть снят из большого двоичного объекта резервного копирования страницы приветствия.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-188">If there are deleted ranges in hello incremental changes, they must be cleared from hello backup page blob.</span></span> <span data-ttu-id="c9ef4-189">Используйте [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) toowrite добавочные изменения toohello резервного копирования страничного большого двоичного объекта.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-189">Use [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) toowrite incremental changes toohello backup page blob.</span></span>
6. <span data-ttu-id="c9ef4-190">Создать моментальный снимок резервной копии страничным hello *mybackupstdpageblob*, который называется *mybackupstdpageblob_ss2*.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-190">Take a snapshot of hello backup page blob *mybackupstdpageblob*, called *mybackupstdpageblob_ss2*.</span></span> <span data-ttu-id="c9ef4-191">Удаление предыдущего снимка hello *mypremiumdisk_ss1* из учетной записи хранения premium.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-191">Delete hello previous snapshot *mypremiumdisk_ss1* from premium storage account.</span></span>
7. <span data-ttu-id="c9ef4-192">Повторите шаги 4–6 в каждом окне архивации.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-192">Repeat steps 4-6 every backup window.</span></span> <span data-ttu-id="c9ef4-193">Так вы сможете хранить архивы *mypremiumdisk* в учетной записи хранения класса "Стандартный".</span><span class="sxs-lookup"><span data-stu-id="c9ef4-193">In this way, you can maintain backups of *mypremiumdisk* in a standard storage account.</span></span>

![Архивация диска с помощью добавочных моментальных снимков](./media/storage-incremental-snapshots/storage-incremental-snapshots-1.png)

## <a name="steps-toorestore-a-disk-from-snapshots"></a><span data-ttu-id="c9ef4-195">Действия toorestore диска из моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="c9ef4-195">Steps toorestore a disk from snapshots</span></span>
<span data-ttu-id="c9ef4-196">Hello описанные ниже действия приведет к восстановлению диска premium *mypremiumdisk* tooan ранее моментального снимка из учетной записи хранилища резервных копий hello *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-196">hello steps described below will restore premium disk, *mypremiumdisk* tooan earlier snapshot from hello backup storage account *mybackupstdaccount*.</span></span>

1. <span data-ttu-id="c9ef4-197">Идентифицирует hello момент времени, в которых надо toorestore hello premium диска.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-197">Identify hello point in time you wish toorestore hello premium disk to.</span></span> <span data-ttu-id="c9ef4-198">Предположим, что, — snapshot *mybackupstdpageblob_ss2*, который хранится в учетной записи хранилища резервных копий hello *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-198">Let's say that is snapshot *mybackupstdpageblob_ss2*, which is stored in hello backup storage account *mybackupstdaccount*.</span></span>
2. <span data-ttu-id="c9ef4-199">В mybackupstdaccount, повышение уровня моментального снимка hello *mybackupstdpageblob_ss2* как hello нового резервного копирования базовой страницы большого двоичного объекта *mybackupstdpageblobrestored*.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-199">In mybackupstdaccount, promote hello snapshot *mybackupstdpageblob_ss2* as hello new backup base page blob *mybackupstdpageblobrestored*.</span></span>
3. <span data-ttu-id="c9ef4-200">Создайте моментальный снимок восстановленного из резервной копии страничного BLOB-объекта с именем *mybackupstdpageblob_ss1*.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-200">Take a snapshot of this restored backup page blob, called *mybackupstdpageblobrestored_ss1*.</span></span>
4. <span data-ttu-id="c9ef4-201">Страница hello восстановить копирования BLOB-объекта *mybackupstdpageblobrestored* из *mybackupstdaccount* слишком*mypremiumaccount* как новый диск premium hello  *mypremiumdiskrestored*.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-201">Copy hello restored page blob *mybackupstdpageblobrestored* from *mybackupstdaccount* too*mypremiumaccount* as hello new premium disk *mypremiumdiskrestored*.</span></span>
5. <span data-ttu-id="c9ef4-202">Создайте моментальный снимок *mypremiumdiskrestored* с именем *mypremiumdiskrestored_ss1* для дальнейшего добавочного резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-202">Take a snapshot of *mypremiumdiskrestored*, called *mypremiumdiskrestored_ss1* for making future incremental backups.</span></span>
6. <span data-ttu-id="c9ef4-203">Точка ряда hello доменных служб Active Directory toohello восстановить диск виртуальной Машины *mypremiumdiskrestored* и отсоединения старой hello *mypremiumdisk* из hello виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-203">Point hello DS series VM toohello restored disk *mypremiumdiskrestored* and detach hello old *mypremiumdisk* from hello VM.</span></span>
7. <span data-ttu-id="c9ef4-204">Начать hello резервного копирования процесс, описанный в предыдущем разделе hello восстановить диск *mypremiumdiskrestored*, с помощью hello *mybackupstdpageblobrestored* как большой двоичный объект резервной копии страницы приветствия.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-204">Begin hello Backup process described in previous section for hello restored disk *mypremiumdiskrestored*, using hello *mybackupstdpageblobrestored* as hello backup page blob.</span></span>

![Восстановление диска из моментальных снимков](./media/storage-incremental-snapshots/storage-incremental-snapshots-2.png)

## <a name="next-steps"></a><span data-ttu-id="c9ef4-206">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="c9ef4-206">Next Steps</span></span>
<span data-ttu-id="c9ef4-207">Дополнительные сведения о планировании инфраструктуры резервного копирования виртуальной Машины, используя приведенные ниже ссылки hello и создание моментальных снимков большого двоичного объекта.</span><span class="sxs-lookup"><span data-stu-id="c9ef4-207">Learn more about creating snapshots of a blob and planning your VM backup infrastructure using hello links below.</span></span>

* [<span data-ttu-id="c9ef4-208">Создание моментального снимка большого двоичного объекта</span><span class="sxs-lookup"><span data-stu-id="c9ef4-208">Creating a Snapshot of a Blob</span></span>](https://msdn.microsoft.com/library/azure/hh488361.aspx)
* [<span data-ttu-id="c9ef4-209">Планирование инфраструктуры резервного копирования виртуальных машин в Azure</span><span class="sxs-lookup"><span data-stu-id="c9ef4-209">Plan your VM Backup Infrastructure</span></span>](../backup/backup-azure-vms-introduction.md)

