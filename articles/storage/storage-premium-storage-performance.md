---
title: "Хранилище Azure уровня \"Премиум\": проектирование для обеспечения высокой производительности | Документация Майкрософт"
description: "Разработка высокопроизводительных приложений с использованием хранилища Azure класса «Премиум». Хранилище Premium обеспечивает поддержку дисков с высокой производительностью и малой задержкой для интенсивных рабочих нагрузок ввода-вывода на виртуальных машинах Azure."
services: storage
documentationcenter: na
author: aungoo-msft
manager: tadb
editor: tysonn
ms.assetid: e6a409c3-d31a-4704-a93c-0a04fdc95960
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/27/2017
ms.author: aungoo
ms.openlocfilehash: 75845eb4707e8e5606153a5e1a7c10b4113ee121
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="azure-premium-storage-design-for-high-performance"></a>Хранилище Azure класса «Премиум»: разработка, обеспечивающая повышенную производительность
## <a name="overview"></a>Обзор
В этой статье приведены рекомендации по разработке высокопроизводительных приложений с использованием хранилища Azure класса «Премиум». Можно использовать hello инструкции, приведенные в этом документе, в сочетании с производительности лучшие методики применимо tootechnologies, используемого приложением. рекомендации по tooillustrate hello, мы использовали SQL Server на хранилище Premium в качестве примера в этом документе.

Хотя мы сценариев производительность для уровня хранилища hello в этой статье, необходимо будет toooptimize уровня приложения hello. Например при размещении фермы SharePoint в хранилище Azure класса Premium, можно использовать hello примеры SQL Server с этого сервера базы данных hello toooptimize статьи. Кроме того Оптимизируйте веб-сервере фермы SharePoint hello и приложения сервера tooget hello максимальной производительности.

В этой статье содержатся ответы на следующие распространенные вопросы об оптимизации производительности приложений в хранилище Azure класса «Премиум».

* Как toomeasure производительность приложений?  
* Почему не наблюдается ожидаемая высокая производительность?  
* Какие факторы влияют на производительность приложения в хранилище класса «Премиум»?  
* Как эти факторы влияют на производительность приложения в хранилище класса «Премиум»?  
* Как можно оптимизировать операции ввода-вывода, пропускную способность и задержку?  

Рекомендации в этой статье предназначены специально для хранилища класса «Премиум», так как рабочие нагрузки в этом хранилище очень чувствительны к уровню производительности. В соответствующих случаях приведены наглядные примеры. Можно также применить некоторые из этих tooapplications рекомендации, выполняющимся как виртуальные машины IaaS с дисками стандартное хранилище.

Прежде чем начать, при наличии нового tooPremium хранилища, сначала прочтите hello [хранилище Premium: высокопроизводительное хранилище для рабочих нагрузок виртуальных машин Azure](storage-premium-storage.md) и [целевыепоказателипопроизводительностиимасштабируемостихранилищаAzure](storage-scalability-targets.md)статей.

## <a name="application-performance-indicators"></a>Показатели производительности приложения
Мы определения соответствия приложения работает хорошо или не используя угодно индикаторы производительности, как быстро приложение обрабатывает запрос пользователя, какой объем данных, приложение обрабатывает каждого запроса, сколько запросов обрабатывается в определенном приложении период времени, сколько времени у пользователя есть toowait tooget ответ после отправки свой запрос. Hello технические термины для этих показателей эффективности, операций ввода-ВЫВОДА, пропускная способность или пропускной способности и задержки.

В этом разделе обсуждаются общие показатели эффективности hello в контексте hello хранилище Premium. В hello в следующем разделе, сбор требований приложения, вы узнаете, как toomeasure эти индикаторы производительности для вашего приложения. Далее в оптимизация производительности приложений, вы узнаете о hello факторов, влияющих на эти индикаторы и рекомендации toooptimize производительности их.

## <a name="iops"></a>ОПЕРАЦИЙ ВВОДА-ВЫВОДА
Операций ввода-ВЫВОДА — количество запросов, что приложение отправляет toohello дисков за одну секунду. Существуют такие типы операций ввода-вывода: операции чтения и записи, последовательные или случайные. OLTP-приложений как на веб-сайт в сети розничной торговли должны tooprocess много одновременных пользователь запрашивает немедленно. вставки и обновления баз данных с интенсивным операций, какое приложение hello необходимо обработать быстро Hello пользователь запросов. Поэтому приложениям OLTP необходима очень высокая скорость выполнения операций ввода-вывода. Такие приложения обрабатывают миллионы небольших случайных запросов ввода-вывода. При наличии такого приложения необходимо разработать toooptimize инфраструктуры приложения hello для операций ввода-ВЫВОДА. В hello позже статьи, *оптимизация производительности приложений*, мы подробно все факторы hello, которые необходимо учитывать tooget высокий уровень операций ввода-ВЫВОДА.

При подключении premium хранения диска tooyour масштабных ВМ, Azure настраивает автоматически гарантированную число операций ввода-ВЫВОДА, согласно спецификации диска hello. Например, диск P50 позволяет подготовить 7500 операций ввода-вывода в секунду. Для каждого размера высокомасштабируемой виртуальной машины также установлено ограничение на количество выполняемых операций ввода-вывода в секунду. Например, для виртуальной машины серии GS5 класса «Стандартный» установлено ограничение в 80 000 операций ввода-вывода в секунду.

## <a name="throughput"></a>Пропускная способность
Производительности или пропускной способности — hello объем данных, что приложение отправляет toohello дисков в течение заданного интервала. Если приложение выполняет операции ввода-вывода большого объема, ему требуется высокая пропускная способность. Приложений с хранилищами данных, как правило, tooissue проверки операций с большим объемом, доступ к большей части данных за раз и обычно выполнения массовых операций. Поэтому таким приложениям требуется более высокая пропускная способность. При наличии такого приложения необходимо разработать его toooptimize инфраструктуры для пропускной способности. В следующем разделе hello, мы обсудим факторов hello сведений необходимо настроить tooachieve это.

При подключении premium хранения диска tooa масштабных ВМ, Azure настраивает пропускной способности согласно спецификации этого диска. Например, диск P50 позволяет подготовить пропускную способность диска в 250 МБ в секунду. Каждая высокомасштабируемая виртуальная машина имеет установленное ограничение по пропускной способности. Например, максимальная пропускная способность виртуальной машины серии GS5 класса «Стандартный» составляет 2000 МБ в секунду. 

Отсутствует отношение между пропускной способности и операций, как показано в следующей формуле hello.

![](media/storage-premium-storage-performance/image1.png)

Таким образом это важно toodetermine hello оптимальной пропускной способности и операций ввода-ВЫВОДА значений нужны вашему приложению. При попытке toooptimize один hello других возвращает воздействует на. В разделе *Оптимизация производительности приложения*более подробно рассмотрена оптимизация операций ввода-вывода и пропускной способности.

## <a name="latency"></a>Задержка
Задержка — hello время, затрачиваемое приложением tooreceive одного запроса, отправить его toohello дисков и отправьте hello ответа toohello клиента. Это критическое показателем производительности приложения в tooIOPS сложения и пропускную способность. Hello задержки диска хранилище premium — время hello им tooretrieve hello информацию для запроса и взаимодействия ее снова tooyour приложения. Хранилище класса «Премиум» обеспечивает постоянно низкую задержку. Если включить кэширование узлов со значением ReadOnly на дисках хранилища класса «Премиум», это позволит сократить время задержки чтения. Более подробно кэширование дисков рассмотрено в разделе *Оптимизация производительности приложения*.

При оптимизации вашего приложения tooget выше операций ввода-ВЫВОДА и пропускной способности, влияет на задержку приложения hello. После настройки производительности приложения hello, всегда возвращают hello задержка tooavoid приложения hello поведение Непредвиденная высокой задержкой.

## <a name="gather-application-performance-requirements"></a>Сбор требований к производительности приложения
Hello первым шагом при разработке высокопроизводительных приложений, выполняющихся на хранилище Azure класса Premium является toounderstand hello требований к производительности приложения. После сбора требований к производительности, можно оптимизировать наиболее оптимальную производительность hello tooachieve приложений.

В предыдущем разделе hello мы описано hello общие показатели эффективности, операций ввода-ВЫВОДА, пропускной способности и задержки. Необходимо определить, какие из этих индикаторов производительности имеют критическое tooyour toodeliver hello требуемого работу пользователей. Например высокий уровень операций ввода-ВЫВОДА, имеет значение большинство приложений tooOLTP обработки миллиона транзакций в секунду. Высокая пропускная способность, в свою очередь, критически важна для приложений хранилища данных, обрабатывающих большие объемы данных в секунду. Очень низкая задержка имеет решающее значение для приложений, выполняющихся в реальном времени, например веб-сайтов потоковой передачи видео.

Далее мер hello требованиям максимальную производительность приложения во время его существования. Используйте контрольный список образец hello ниже запуск по. Записи hello максимальное требований к производительности во время normal, рабочая нагрузка периоды пиковых и нерабочие часы. По определению требований для всех уровней рабочих нагрузок, будет может toodetermine hello общих требований производительности приложения. Например hello нормальной рабочей нагрузкой веб-сайта электронной коммерции будет hello операциями, он выполняет большинство дней в году. Hello пиковой рабочей нагрузки hello веб-сайта будет hello операциями, он выполняет во время праздников или специальные продажи событий. Hello пиковой рабочей нагрузки обычно опытным в течение ограниченного времени, но может потребовать вашего приложения tooscale два или более раз работу в обычном режиме. Узнайте, 99 требования процентиль, процентилей 90 и 50 процентиля hello. Это помогает отфильтровать все выбросы в требования к производительности hello и вы можете сосредоточиться на оптимизации для hello правильные значения.

**Контрольный список требований к производительности приложения**

| **Требования к производительности** | **50-й процентиль** | **90-й процентиль** | **99-й процентиль** |
| --- | --- | --- | --- |
| Макс. Транзакций в секунду | | | |
| Операции чтения, % | | | |
| Операции записи, % | | | |
| Случайные операции, % | | | |
| Последовательные операции, % | | | |
| Размер запроса ввода-вывода | | | |
| Средняя пропускная способность | | | |
| Макс. Пропускная способность | | | |
| Мин. Задержка | | | |
| Среднее время задержки | | | |
| Макс. ЦП | | | |
| Средняя загрузка ЦП | | | |
| Макс. Память | | | |
| Среднее использование памяти | | | |
| Длина очереди | | | |

> [!NOTE]
> Эти показатели следует регулировать в зависимости от ожидаемого в будущем роста приложения. Это tooplan хорошей идеей для увеличения размера заранее, поскольку он может быть сложнее инфраструктуры hello toochange по повышению производительности в более поздней версии.
>
>

Если у существующего приложения и требуется toomove tooPremium хранилища, необходимо вначале построить hello контрольный список выше для существующего приложения hello. Затем построение прототипа приложения на Premium хранилища и проектированием приложения hello, основанного на рекомендации, приведенные в *оптимизация производительности приложений* в следующем разделе этого документа. Следующий раздел Hello описание средств hello, можно использовать измерения производительности toogather hello.

Создание контрольный список аналогичные tooyour существующие приложения для hello прототипа. С помощью средства Benchmarking можно имитации рабочей нагрузки hello и измерять производительность приложения hello прототипа. См. в разделе hello [Benchmarking](#benchmarking) toolearn дополнительные. В результате вы сможете определить, может ли хранилище класса «Премиум» соответствовать требованиям к производительности приложения или превзойти их. Затем можно реализовать hello же правила для производственного приложения.

### <a name="counters-toomeasure-application-performance-requirements"></a>Счетчики toomeasure требований к производительности приложения
Здравствуйте, лучшим способом toomeasure требований к производительности приложения, средства наблюдения за производительностью toouse, предоставляемые hello операционной системы сервера hello. Можно использовать PerfMon для Windows и iostat для Linux. Эти средства отслеживания счетчиков, соответствующую меру tooeach подробно описан hello над разделом. Когда приложение запущено, его normal, пиковые и нерабочие часы рабочих нагрузок необходимо сохранить hello значения этих счетчиков.

счетчики системного монитора Hello доступны для процессора, памяти и каждый логический диск и физического диска сервера. При использовании дисков хранилища premium с виртуальной Машиной hello счетчики физического диска, для каждого диска хранения premium и счетчиками логических дисков, для каждого тома, созданные на дисках хранилища premium hello. Необходимо сохранить значения hello hello дисков, содержащих рабочей нагрузки приложения. Если имеется один tooone сопоставление логических и физических дисков, могут ссылаться счетчики toophysical диска; см. в противном случае toohello счетчиками логических дисков. В Linux hello iostat команда создает отчет об использовании ЦП и диска. отчет об использовании диска Hello предоставляет статистику по физическим устройством или секции. Если данные и журнал сервера базы данных расположены на разных дисках, нужно собрать данные для обоих дисков. В таблице ниже приведены счетчики для дисков, процессора и памяти.

| Счетчик | Описание | PerfMon | iostat |
| --- | --- | --- | --- |
| **Количество операций ввода-вывода или транзакций в секунду** |Количество запросов ввода-вывода выдан toohello диска хранилища в секунду. |Операций чтения с диска в секунду  <br> Операций записи на диск в секунду |tps  <br> r/s  <br> w/s |
| **Количество операций чтения и записи на диске** |% операций чтения и записи операций, выполняемых на диске hello. |Процент активности диска при чтении  <br> Процент активности диска при записи |r/s  <br> w/s |
| **Пропускная способность** |Объем данных считывается или записывается toohello диск за одну секунду. |Скорость чтения с диска (байт/с)  <br> Скорость записи на диск (байт/с) |КБ/с прочитано <br> КБ/с записано |
| **Задержка** |Общее время toocomplete запрос ввода-ВЫВОДА на диск. |Средняя скорость чтения с диска в секунду  <br> Средняя скорость записи на диск в секунду |await  <br> svctm |
| **Объем ввода-вывода** |размер Hello запросов ввода-вывода выдает toohello дисков. |Средняя скорость чтения с диска (байт/с)  <br> Средняя скорость записи на диск (байт/с) |avgrq-sz |
| **Длина очереди** |Число ожидающих операций ввода-вывода запросов toobe ожидания формы чтения или записи toohello места на диске. |Текущая длина очереди диска |avgqu-sz |
| **Макс. Память** |Объем памяти, необходимые приложения toorun плавно |Использование выделенной памяти (в байтах), % |Использование vmstat |
| **Макс. ЦП** |Сумма ЦП плавно необходимые toorun приложения |Загруженность процессора, % |%util |

См. дополнительные сведения об [iostat](http://linuxcommand.org/man_pages/iostat1.html) и [PerfMon](https://msdn.microsoft.com/library/aa645516.aspx).

## <a name="optimizing-application-performance"></a>Оптимизация производительности приложения
Hello основные факторы, влияющие на производительность приложения, работающего в хранилище Premium — характер из запросы ввода-ВЫВОДА, размер виртуальной Машины, размер диска, количество дисков, кэширование, многопоточность и длину очереди. Некоторые из этих причин можно управлять с помощью элементы, предоставляемые системой hello. Большинство приложений может не предоставить вам hello tooalter параметр размер ввода-ВЫВОДА и глубина очереди напрямую. Например при использовании SQL Server, нельзя выбрать размер и очереди глубина hello операции ввода-ВЫВОДА. SQL Server выбирает hello оптимальной операции ввода-ВЫВОДА размером и очереди глубина значения tooget hello максимальной производительности. Это влияние hello важные toounderstand обоих типов факторов на производительность приложений можно предоставить соответствующие ресурсы toomeet требованиям к производительности.

В этом разделе ссылки toohello приложения контрольный список требований, созданному tooidentify сколько требуется toooptimize производительность приложений. На основе, что можно будет toodetermine которого факторы из этого раздела потребуется tootune. toowitness hello влияние на производительность приложений, запустите средства настройки приложения по измерению производительности каждого фактора. См. toohello [Benchmarking](#Benchmarking) раздел в конце этой статьи приведены общие средства в Windows и виртуальных машин Linux по измерению производительности toorun действия в hello.

### <a name="optimizing-iops-throughput-and-latency-at-a-glance"></a>Краткий обзор оптимизации выполнения операций ввода-вывода, пропускной способности и задержки
в следующей таблице Hello содержит сводку всех факторы производительности hello и toooptimize действия hello операций ввода-ВЫВОДА, пропускной способности и задержки. Hello после этой сводке описано каждого фактором является намного более подробно.

| &nbsp; | **ОПЕРАЦИЙ ВВОДА-ВЫВОДА** | **Пропускная способность** | **Задержка** |
| --- | --- | --- | --- |
| **Пример сценария** |Корпоративное приложение OLTP, которому требуется высокая скорость выполнения транзакций в секунду. |Корпоративное приложение хранилища данных, обрабатывающее большие объемы данных. |Почти в реальном времени приложений, требующих запросов, toouser мгновенных ответов, например для интерактивных игр. |
| Факторы производительности | &nbsp; | &nbsp; | &nbsp; |
| **Объем ввода-вывода** |Меньший объем ввода-вывода обеспечивает более высокую скорость выполнения операций ввода-вывода. |Tooyields размер больше операций ввода-ВЫВОДА более высокую пропускную способность. | &nbsp;|
| **Размер виртуальной машины** |Используйте размер виртуальной машины, который обеспечивает более высокую скорость выполнения операций ввода-вывода, чем указано в требованиях приложения. См. размеры виртуальных машин и их ограничения скорости выполнения операций ввода-вывода здесь. |Используйте размер виртуальной машины с большей пропускной способностью, чем требует приложение. См. размеры виртуальных машин и их ограничения пропускной способности здесь. |Используйте размер виртуальной машины с более широкими пределами масштабируемости, чем требует приложение. См. размеры виртуальных машин и их ограничения здесь. |
| **Размер диска** |Используйте размер диска, который обеспечивает более высокую скорость выполнения операций ввода-вывода, чем требует приложение. См. размеры дисков и их ограничения скорости выполнения операций ввода-вывода здесь. |Используйте размер диска с более высокой пропускной способностью, чем требует приложение. См. размеры дисков и их ограничения пропускной способности здесь. |Используйте размер диска с более широкими пределами масштабируемости, чем требует приложение. См. размеры дисков и их ограничения здесь. |
| **Ограничения масштабируемости виртуальной машины и диска** |Ограничение операций ввода-ВЫВОДА в зависимости от выбранного размера виртуальной Машины hello должна быть больше всего операций ввода-ВЫВОДА, обусловленных диски premium присоединенного tooit. |Предел пропускной способности в зависимости от выбранного размера виртуальной Машины hello должна быть больше tooit присоединенного общая пропускная способность, обусловленных диски premium. |Выбранный размер виртуальной Машины hello границы шкалы должно быть больше ограничения масштабирования общее premium присоединенных дисков хранилища. |
| **Кэширование диска** |Включить кэш только для чтения на дисках хранилища premium с tooget масштабных операций чтения выше операций чтения ввода-ВЫВОДА. | &nbsp; |Включите кэш только для чтения на дисках хранилища premium с задержкой чтения очень мало tooget готовности масштабных операций. |
| **Чередование дисков** |Использовать несколько дисков и томов их вместе tooget объединенный выше операций ввода-ВЫВОДА и ограничение пропускной способности. Обратите внимание, что hello объединенный предел каждой виртуальной Машины должно быть больше, чем hello объединенный ограничения premium присоединенные диски. | &nbsp; | &nbsp; |
| **Размер блока чередования** |Меньший размер блока чередования для случайных небольших запросов ввода-вывода в приложениях OLTP. Например, для приложения OLTP SQL Server можно использовать блок чередования на 64 КБ. |Больший размер блока чередования для последовательных объемных запросов ввода-вывода в приложениях хранилища данных. Например, для приложения хранилища данных SQL Server можно использовать блок чередования на 256 КБ. | &nbsp; |
| **Многопоточность** |Используйте многопоточность toopush большое число запросов tooPremium хранилище, могут стать причиной toohigher операций ввода-ВЫВОДА и пропускной способности. Например на сервере SQL Server установить высокой tooallocate значение MAXDOP tooSQL дополнительных процессоров сервера. | &nbsp; | &nbsp; |
| **Длина очереди** |Более длинная очередь обеспечивает более высокую скорость выполнения операций ввода-вывода. |Более длинная очередь обеспечивает более высокую пропускную способность. |Более короткая очередь сокращает время задержки. |

## <a name="nature-of-io-requests"></a>Характер запросов ввода-вывода
Запрос ввода-вывода — это единица операции ввода-вывода, которую будет выполнять приложение. Определение характера hello запросы ввода-ВЫВОДА, произвольных и последовательных, чтения или записи крупных или мелких, помогут вам определить требования к производительности hello приложения. Это очень важно toounderstand характер hello запросы ввода-ВЫВОДА, toomake hello правильных решений при разработке инфраструктуры приложения.

Размер операции ввода-ВЫВОДА является одним из hello более важных факторов. Hello размер ввода-ВЫВОДА, имеет размер hello hello запроса операции ввода вывода, созданные приложением. Hello размер ввода-ВЫВОДА имеет значительное влияние на производительность, особенно на hello операций ввода-ВЫВОДА и пропускной способности, hello приложения является может tooachieve. Hello следующей формуле показан hello связь между операций ввода-ВЫВОДА, размер ввода-ВЫВОДА и пропускной способности и пропускную способность.  
    ![](media/storage-premium-storage-performance/image1.png)

Некоторые приложения позволяют tooalter размер их ввода-ВЫВОДА для некоторых приложений это недопустимо. Например, SQL Server определяет hello операции ввода-ВЫВОДА оптимальным сам и не предоставлять пользователям любые элементы toochange его. На Здравствуйте другой стороны, Oracle предоставляет параметр с именем [DB\_блокировать\_размер](https://docs.oracle.com/cd/B19306_01/server.102/b14211/iodesign.htm#i28815) с помощью которого можно настроить размер запроса ввода-вывода базы данных hello "hello".

При использовании приложения, который не допускает вы toochange hello размер ввода-ВЫВОДА, следуйте рекомендациям hello toooptimize производительности hello Эффективности, который наиболее важные приложения tooyour этой статьи. Например,

* Приложения OLTP генерируют миллионы небольших случайных запросов ввода-вывода. запрашивает toohandle их тип операции ввода-ВЫВОДА, необходимо разработать tooget инфраструктуры вашего приложения выше операций ввода-ВЫВОДА.  
* Приложения хранилища данных генерируют крупные последовательные запросы ввода-вывода. toohandle эти тип запросы ввода-ВЫВОДА, необходимо разработать вашей инфраструктуры tooget приложения более высокой пропускной способностью или пропускной способности.

При использовании приложения, который позволяет размер ввода-ВЫВОДА toochange hello, используйте это правило для hello операции ввода-ВЫВОДА, кроме размер tooother рекомендации по производительности,

* Tooget размер меньше операций ввода-ВЫВОДА выше операций ввода-ВЫВОДА. Например, 8 КБ для приложения OLTP.  
* Tooget размер больше операций ввода-ВЫВОДА более высокую пропускную способность и пропускную способность. Например, 1024 КБ для приложения хранилища данных.

Ниже приведен пример на вычисление hello операций ввода-ВЫВОДА и пропускной способности и пропускной способности для вашего приложения. Рассмотрим приложение, использующее диск P30. Hello Максимума и пропускной способности и пропускной способности диска P30 можно добиться — 5000 операций ввода-ВЫВОДА и 200 МБ в секунду соответственно. Если приложение требует hello Максимума из hello P30 диск и использовать меньший размер операции ввода-ВЫВОДА, например 8 КБ hello возникающие пропускную способность, можно будет tooget является 40 МБ в секунду. Тем не менее, если приложению требуется максимальная пропускная способность и пропускной способности с диска P30 hello и использовать больший размер операции ввода-ВЫВОДА, например 1024 КБ, hello полученный операций ввода-ВЫВОДА может быть меньше 200 операций ввода-ВЫВОДА. Таким образом настройте размер hello ввода-ВЫВОДА, таким образом, что он удовлетворяет требованиям оба приложения операций ввода-ВЫВОДА и пропускной способности и пропускной способности. Для диска P30 в таблице ниже приведены различные размеры операции ввода-ВЫВОДА hello и соответствующие операции ввода-ВЫВОДА и пропускной способности.

| Требование к приложению | Объем ввода-вывода | ОПЕРАЦИЙ ВВОДА-ВЫВОДА | Пропускная способность |
| --- | --- | --- | --- |
| Maкс. количество операций ввода-вывода в секунду |8 КБ |5 000 |40 МБ в секунду |
| Макс. пропускная способность |1024 КБ |200 |200 МБ в секунду |
| Макс. пропускная способность и высокая скорость выполнения операций ввода-вывода |64 КБ |3200 |200 МБ в секунду |
| Макс. скорость выполнения операций ввода-вывода и высокая пропускная способность |32 КБ |5 000 |160 МБ в секунду |

tooget операций ввода-ВЫВОДА и пропускную способность выше, чем максимальное значение hello диска хранения одного premium, использовать несколько дисков "премиум", чередуются друг с другом. Например рекомендуется распределить два tooget дисков P30 объединенный операций ввода-ВЫВОДА из 10 000 операций ввода-ВЫВОДА или объединенных пропускной способности 400 МБ в секунду. Как описано в следующем разделе hello, необходимо использовать размер виртуальной Машины, поддерживающем hello вместе с диска операций ввода-ВЫВОДА и пропускной способности.

> [!NOTE]
> Как увеличить либо операций ввода-ВЫВОДА или также увеличивает пропускную способность hello других, убедитесь, что вы не сталкиваются с пропускной способности или ограничения операций ввода-ВЫВОДА диска hello, или виртуальных Машин при увеличении какой-либо.
>
>

toowitness Здравствуйте эффекты объема операций ввода-ВЫВОДА на производительность приложения, оценки эффективности инструменты можно использовать на виртуальной Машине и дисков. Создайте несколько тестовых запусков и использовать другой размер операции ввода-ВЫВОДА для каждого выполнения toosee hello влияние. См. toohello [Benchmarking](#Benchmarking) раздел в конце hello в этой статье для получения дополнительных сведений.

## <a name="high-scale-vm-sizes"></a>Размеры высокомасштабируемых виртуальных машин
Когда вы приступите к разработке приложения, одним из первого действия toodo hello является, выберите приложение toohost виртуальной Машины. Хранилище класса «Премиум» предусматривает использование высокомасштабируемых виртуальных машин, на которых могут выполняться приложения, требующие высокой вычислительной мощности и повышенной производительности операций ввода-вывода локального диска. Виртуальные машины предоставляют более быстрые процессоры, более высокий коэффициент памяти для ядра и Solid-State накопитель (SSD) на локальном диске hello. Примеры высокий уровень масштабирования виртуальных машин, поддерживающие хранилище Premium: hello DS, серии DSv2 и GS ВМ серии.

Доступны высокомасштабируемые виртуальные машины различных размеров с разным количеством ядер ЦП, объемом памяти, операционными системами и размером временного диска. Размер каждой виртуальной Машины также имеет максимальное число дисков данных, которые можно присоединить toohello виртуальной Машины. Таким образом hello выбранный размер виртуальной Машины повлияет на какой объем обработки, памяти и хранения ресурсов доступна для вашего приложения. Он также влияет на hello вычислений и затраты на хранение. Например ниже приведены спецификации hello hello наибольший размер виртуальной Машины в серии DS, серии DSv2 рядов и ряды GS.

| Размер виртуальной машины | Ядра ЦП | Память | Размеры диска виртуальной машины | Макс. количество дисков данных | Объем кэша | ОПЕРАЦИЙ ВВОДА-ВЫВОДА | Ограничения количества операций ввода-вывода в секунду и пропускной способности кэша |
| --- | --- | --- | --- | --- | --- | --- | --- |
| Standard_DS14 |16 |112 ГБ |ОС = 1023 ГБ  <br> Локальный SSD = 224 ГБ |32 |576 ГБ |50 000 операций ввода-вывода в секунду  <br> 512 МБ в секунду |4000 операций ввода-вывода в секунду и 33 МБ в секунду |
| Standard_GS5 |32 |448 ГБ |ОС = 1023 ГБ  <br> Локальный SSD = 896 ГБ |64 |4224 ГБ |80 000 операций ввода-вывода в секунду  <br> 2000 МБ в секунду |5000 операций ввода-вывода в секунду и 50 МБ в секунду |

см. Полный список всех доступных размеров ВМ Azure tooview слишком[размеры виртуальных Машин Windows](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) или [размеры виртуальных Машин Linux](../virtual-machines/linux/sizes.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json). Выберите размер виртуальной Машины, который может соответствовать и масштабировать требуемого tooyour требований к производительности приложения. Кроме toothis, принимать во внимание следующие важные вопросы при выборе размеров виртуальных Машин.

*Ограничения масштабирования*  
Hello IOPS ограничений на виртуальную Машину и на каждом диске различен и независимо друг от друга. Убедитесь, что приложение hello влияющие операций ввода-ВЫВОДА в пределах hello hello виртуальной Машины, а также tooit присоединенные диски premium hello. В противном случае производительность приложения нужно будет отрегулировать.

В качестве примера предположим, что максимальное количество операций ввода-вывода в секунду для приложения составляет 4000. tooachieve этого, можно подготовить диск P30 на виртуальной Машине DS1. Hello P30 диска можно передавать too5 000 операций ввода-ВЫВОДА. Тем не менее hello DS1 ВМ — ограниченный too3, 200 операций ввода-ВЫВОДА. Следовательно hello производительности приложения будет ограничен hello ограничение виртуальной Машины на 3,200 операций ввода-ВЫВОДА и будет снижение производительности. tooprevent этой ситуации выберите виртуальную Машину и место на диске, будет обоих требования соответствия приложений.

*Стоимость выполнения операций*  
Во многих случаях общая стоимость выполнения операций с использованием хранилища класса «Премиум» может быть меньше, чем при использовании хранилища класса «Стандартный».

В качестве примера рассмотрим приложение, требующее выполнения 16 000 операций ввода-вывода в секунду. tooachieve это производительности требуется стандартный\_ВМ IaaS Azure D14, который может предоставить Максимума 16000 с помощью 32 дисков стандартное хранилище 1 ТБ. Каждый диск хранилища класса «Стандартный» емкостью 1 ТБ может выполнить до 500 операций ввода-вывода в секунду. Hello расчетные затраты на этой виртуальной машины в месяц, могут быть 1,570 $. Ежемесячная стоимость Hello 32 дисков стандартное хранилище будет 1,638 $. Hello предполагаемое Общие ежемесячные затраты будут 3,208 $.

Тем не менее, если вы hello же приложения в хранилище класса Premium, потребуются меньшего размера виртуальной Машины и меньшее количество дисков хранилища premium, что уменьшает общую стоимость hello. Стандартный\_DS13 ВМ можно требованиям hello 16 000 операций ввода-ВЫВОДА с помощью четырех P30 дисков. Hello DS13 ВМ имеет Максимума 25,600 и каждого диска P30 имеет Максимума 5000. В целом, при такой конфигурации можно добиться 20 000 операций ввода-вывода в секунду (5000 x 4). Hello расчетные затраты на этой виртуальной машины в месяц, могут быть 1,003 $. Ежемесячная стоимость Hello четыре жестких диска хранения premium P30 будет 544.34 $. Hello предполагаемое Общие ежемесячные затраты будут 1,544 $.

В следующей таблице представлены детализация затрат hello этого сценария Standard и Premium хранилища.

| &nbsp; | **Стандартный** | **Премиальный** |
| --- | --- | --- |
| **Стоимость виртуальной машины в месяц** |1570,58 долл. США (Standard\_D14) |1003,66 долл. США (Standard\_DS13) |
| **Стоимость дисков в месяц** |1638,40 долл. США (32 диска емкостью 1 ТБ) |544,34 долл. США (4 диска P30) |
| **Общая стоимость в месяц** |3208,98 долл. США |1544,34 долл. США |

*Дистрибутивы Linux*  

Хранилище Azure класса Premium, вы получаете hello того же уровня производительности для виртуальных машин под управлением Windows и Linux. Корпорация Майкрософт поддерживает множество видов дистрибутивы Linux, и можно вывести полный список hello [здесь](../virtual-machines/linux/endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json). Очень важно, что различные дистрибутивы предпочтительнее toonote, подходящих для различных типов рабочих нагрузок. Вы увидите различные уровни производительности в зависимости от дистрибутив hello рабочей нагрузки, на котором запущена. Теста дистрибутивы Linux hello вместе с приложением и выберите тот, который лучше всего работает hello.

При выполнении Linux на хранилище Premium, проверьте последние обновления hello о высокой производительности tooensure требуемые драйверы.

## <a name="premium-storage-disk-sizes"></a>Размеры диска хранилища класса «Премиум»
В настоящее время хранилище уровня "Премиум" Azure предлагается с дисками семи размеров. Для диска каждого размера установлены различные ограничения масштабирования для операций ввода-вывода в секунду, пропускной способности и хранилища. Выберите hello неправильный размер диска хранилища Premium, в зависимости от требований приложения hello и hello масштабных размер виртуальной Машины. в следующей таблице Hello представлены размеры hello семь дисков и их возможности. Размеры P4 и P6 в настоящее время поддерживаются только для службы "Управляемые диски".

| Диски уровня "Премиум"  | P4    | P6    | P10   | P20   | P30   | P40   | P50   | 
|---------------------|-------|-------|-------|-------|-------|-------|-------|
| Размер диска           | 32 ГБ | 64 ГБ | 128 ГБ| 512 ГБ            | 1024 ГБ (1 ТБ)    | 2048 ГБ (2 ТБ)    | 4095 ГБ (4 ТБ)    | 
| Количество операций ввода-вывода в секунду на диск       | 120   | 240   | 500   | 2300              | 5000              | 7500              | 7500              | 
| Пропускная способность на диск | 25 МБ в секунду  | 50 МБ в секунду  | 100 МБ в секунду | 150 МБ в секунду | 200 МБ в секунду | 250 МБ в секунду | 250 МБ в секунду | 


Количество дисков, зависит от дисков hello выбранного размера. Можно использовать один диск P50 один или несколько toomeet дисков P10 ваших требований приложения. Учитывать рекомендации по учетным записям, перечисленные ниже, когда выбор hello.

*Ограничения масштабирования (на количество операций ввода-вывода в секунду и пропускную способность)*  
Hello операций ввода-ВЫВОДА и пропускной способности границы каждого размера диска Premium разных и не зависят от hello пределы масштабирования виртуальных Машин. Убедитесь, что hello всего операций ввода-ВЫВОДА и пропускную способность между дисками hello предельным "масштаб" hello выбираются размер виртуальной Машины.

Например, рассмотрим, как следует поступить, если используется виртуальная машина DS4 с одним диском P30, а максимальная пропускная способность приложения составляет не более 250 МБ/с. Hello DS4 ВМ можно освобождать пропускная способность too256 МБ/с. Тем не менее одного диска P30 установлено ограничение пропускной способности 200 МБ в секунду. Следовательно приложение hello будет ограничен в 200 МБ/сек, из-за toohello предельной. tooovercome этот предел, подготовить несколько toohello дисков данных виртуальной Машины или измените размер вашей tooP40 дисков или P50.

> [!NOTE]
> Операций чтения, выполненных hello кэша не включаются в диск hello операций ввода-ВЫВОДА и пропускной способности, таким образом не регулируется toodisk ограничения. Для кэша существует отдельное ограничение на количество операций ввода-вывода в секунду и пропускную способность для каждой виртуальной машины.
>
> Например, изначально пропускная способность операций чтения и записи составляет 60 МБ/с и 40 МБ/с соответственно. Со временем кэша hello нагревается и обслуживает все больше hello операций чтения из кэша hello. Затем можно получить выше записи пропускная способность с диска hello.
>
>

*Количество дисков*  
Определите hello количество дисков, вам необходимо по оценке требований приложения. Размер каждой виртуальной Машины также имеет ограничение на hello количество дисков, которые можно присоединить toohello виртуальной Машины. Как правило это дважды hello число ядер. Убедитесь, что hello размер виртуальной Машины может поддерживать hello количество дисков, необходимо выбрать.

Помните, что дисках хранилища Premium hello иметь высокий дисков tooStandard возможности по сравнению производительности. Таким образом, при переносе приложения из виртуальной Машины Azure IaaS с помощью стандартного хранилища tooPremium хранилища вы скорее всего, потребуется меньшее количество дисков "премиум" tooachieve hello же или более высокой производительности для вашего приложения.

## <a name="disk-caching"></a>Кэширование диска
В высокомасштабируемых виртуальных машинах, которые используют хранилище Azure класса «Премиум», применяется технология многоуровневого кэширования под названием BlobCache. BlobCache использует сочетание hello ОЗУ виртуальной машины и локальный SSD для кэширования. Этот кэш доступен для постоянного дисках хранилища Premium hello и локальными дисками ВМ hello. По умолчанию кэш задается tooRead и записи для дисков операционной системы и ReadOnly для дисков данных, размещенные в хранилище Premium. При использовании кэширования диска включен на дисках хранилища Premium hello hello высокий уровень масштабирования виртуальных машин можно добиться очень высокий уровень производительности, превышающие hello базового диска.

> [!WARNING]
> Изменение приветствия кэша диска Azure отсоединяется и присоединяется hello целевого диска. Если диск операционной системы hello, hello ВМ перезапускается. Остановка всех приложений и служб, которые могут быть затронуты это прерывание, прежде чем изменять параметр кэша диска hello.
>
>

toolearn Дополнительные сведения о работе BlobCache ссылаться toohello внутри [хранилища Azure Premium](https://azure.microsoft.com/blog/azure-premium-storage-now-generally-available-2/) записи блога.

Это важные tooenable кэша на hello правильный набор дисков. Вы следует включить кэширование на диске premium или не будет зависеть от шаблон рабочей нагрузки hello этот диск будет обработки. В следующей таблице приведены параметры кэша для дисков операционной системы и данных по умолчанию hello.

| **Тип диска** | **Параметр кэширования по умолчанию** |
| --- | --- |
| Диск ОС |ReadWrite |
| Диск данных |None |

Следующие являются hello параметры кэша рекомендуемые диска для дисков с данными

| **Параметр кэширования диска** | **Рекомендации о том, когда toouse этот параметр** |
| --- | --- |
| None |Задайте для кэша узла значение None для дисков с высокой интенсивностью операций записи и дисков только для записи. |
| ReadOnly |Задайте для кэша узла значение ReadOnly для дисков, которые используются для чтения и записи или только для чтения. |
| ReadWrite |Настройка кэша узла как ReadWrite только в том случае, если приложения правильно обрабатывает записи в кэше toopersistent диски с данными, если это требуется. |

*ReadOnly*  
Задав для кэширования значение ReadOnly для дисков данных хранилища класса «Премиум», можно достичь низкой задержки операций чтения и очень высокой скорости выполнения операций ввода-вывода и пропускной способности при чтении для приложения. Это происходит по двум причинам.

1. Операции чтения выполнена из кэша, который находится на hello памяти виртуальной Машины, а локальный SSD, намного быстрее, чем операций чтения с диска данных hello, расположенного на hello хранилище больших двоичных объектов.  
2. Хранилище Premium не учитывает приветствия выполненных операций чтения из кэша на диске hello операций ввода-ВЫВОДА и пропускной способности. Таким образом, оно может tooachieve выше общее число операций ввода-ВЫВОДА и пропускной способности.

*ReadWrite*  
По умолчанию hello диски ОС ReadWrite включено кэширование. Более того, с недавнего времени значение кэширования ReadWrite можно задать и для дисков данных. При использовании кэширования ReadWrite, необходимо иметь надлежащей toowrite hello данных из кэша toopersistent дисков. Например SQL Server обрабатывает записи в кэше дисков постоянное хранилище данных toohello сам по себе. Использование кэша ReadWrite с приложением, не может обрабатывать сохранения hello обязательных данных может привести к потере toodata в случае отказа hello виртуальной Машины.

Например, можно применить эти рекомендации tooSQL сервера под управлением в хранилище класса Premium, выполнив следующие hello

1. Задайте для кэша значение ReadOnly для дисков хранилища уровня "Премиум", на которых размещены файлы данных.  
   а.  Hello быстрого чтения из кэша нижней hello время запроса для SQL Server, с момента страниц данных извлекаются из toodirectly hello кэша по сравнению с дисками данных hello гораздо быстрее.  
   b.  Если операции чтения выполняются из кэша, это означает, что диски с данными класса «Премиум» дают дополнительную пропускную способность. Ее можно использовать на SQL Server для извлечения большего количества страниц данных и выполнения других операций, таких как резервное копирование и восстановление, пакетные загрузки и перестройки индекса.  
2. «None» настройки кэша в хранилище класса premium диски размещения файлов журнала hello.  
   а.  В файлах журнала преимущественно содержатся данные операций с высокой интенсивностью записи. Таким образом они не преимущества hello кэша только для чтения.

## <a name="disk-striping"></a>Чередование дисков
Может ли быть масштабных, виртуальная машина присоединена с несколькими premium хранения постоянных, диски hello чередуются вместе tooaggregate их операций ввода-вывода, пропускной способности и емкость хранилища.

В Windows можно использовать вместе toostripe диски дисковых пространств. Для каждого диска в пуле необходимо настроить один столбец. В противном случае hello общую производительность чередующийся том может быть ниже, чем ожидается, из-за toouneven распределение трафика между дисками hello.

Внимание: С помощью пользовательского интерфейса диспетчера серверов, можно задать hello общее количество столбцов вверх too8 для чередующийся том. При присоединении более 8 дисков, используйте PowerShell toocreate hello тома. С помощью PowerShell, можно задать число столбцов в hello равно toohello число дисков. Например, в случае 16 дисков в одном чередующемся наборе; Укажите 16 столбцов в hello *NumberOfColumns* параметр hello *New-VirtualDisk* командлета PowerShell.

В Linux используйте hello MDADM программа toostripe диски друг с другом. Подробные инструкции по чередование дисков в Linux см. в слишком[Настройка программного RAID на платформе Linux](../virtual-machines/linux/configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).

*Размер блока чередования*  
Важные настройки в чередование дисков — размер чередования hello. размер чередования Hello или размер блока — hello наименьшее блоков данных, приложение можно обращаться в чередующемся томе. размер чередования Hello настроенному зависит от типа hello приложения и его шаблоном запроса. Если размер неправильный чередования hello, он может привести рассогласование tooIO, что приводит toodegraded производительности приложения.

Например если запрос ввода-ВЫВОДА, создаваемые приложения больше, чем размер чередования дисков hello, системы хранения hello записывает его через stripe единицы границы на нескольких дисках. При его время tooaccess эти данные, он получит tooseek через несколько запросов hello toocomplete stripe единицы. Hello воздействие такого поведения можно привести toosubstantial снижение производительности. На hello другой стороны, если размер запроса ввода-ВЫВОДА hello меньше, чем размер чередования и если случайный характер, hello запросы ввода-ВЫВОДА может сложить на hello же диск является узким и в конечном счете ухудшения производительности операций ввода-ВЫВОДА hello.

В зависимости от типа hello рабочую нагрузку, которую использует приложение выберите соответствующий stripe размер. Для случайных небольших запросов ввода-вывода следует использовать меньший размер блока чередования, а для больших последовательных запросов ввода-вывода — более крупный размер блока чередования. Узнайте hello stripe размер рекомендаций для приложения hello, приложение будет выполняться в хранилище Premium. Дополнительную информацию см. В разделе [рекомендации по производительности для SQL Server на виртуальных машинах Azure](../virtual-machines/windows/sql/virtual-machines-windows-sql-performance.md#disks-guidance) toolearn дополнительные.

> [!NOTE]
> На виртуальной машине серии DS можно чередовать до 32 дисков хранилища класса «Премиум», а на виртуальной машине серии GS — до 64 дисков хранилища класса «Премиум».
>
>

## <a name="multi-threading"></a>Многопоточность
Azure разработала расширенной параллельной toobe платформы хранилище Premium. Так, многопоточное приложение обеспечивает более высокую производительность по сравнению с однопоточным приложением. Многопоточное приложение разделяет его задач в нескольких потоках и повышает эффективность своей работы, используя hello виртуальной Машины и максимальное toohello ресурсы диска.

Например если приложение выполняется на одном ядре виртуальную Машину с помощью двух потоков, hello ЦП можно переключаться между эффективность tooachieve hello два потока. Пока один поток ожидает toocomplete операции ввода-ВЫВОДА диска, hello ЦП можно переключить toohello другого потока. Таким образом, используя два потока, можно выполнить намного больше задач, чем с использованием одного. Если hello виртуальная машина имеет более одного ядра, дальнейшей приводит к снижению уровня времени выполнения, так как каждое ядро может выполняться задачи параллельно.

Не может быть готовое приложение реализует один способ hello может toochange потоков или многопоточность. Например, SQL Server может выполнять задачи, используя несколько процессоров и ядер. Однако SQL Server определяет, при каких условиях будет использовать один или несколько потоков tooprocess запроса. С использованием многопоточности на этом сервере можно выполнять запросы и создавать индексы. Для запроса, который включает в себя соединения больших таблиц и сортировка данных перед возвратом toohello пользователя SQL Server, скорее всего будет использовать несколько потоков. Пользователь не может управлять тем, каким образом SQL Server будет обрабатывать запрос — с использованием одного потока или нескольких.

Параметры конфигурации, его можно изменить tooinfluence данный многопоточность или параллельной обработки приложения. Например в случае SQL Server это hello максимальной степени параллелизма конфигурации. Этот параметр MAXDOP, позволяет tooconfigure hello максимальное число процессоров, которые можно использовать SQL Server, при параллельной обработки. Этот параметр можно настроить для отдельных запросов и операций с индексами. Это полезно в тех случаях, когда требуется toobalance ресурсы системы для критических производительности приложения.

Предположим, например, приложение с помощью SQL Server выполняется большого запроса и операции с индексами в hello то же время. Предположим, было toobe операции индекса hello большого запроса toohello более высокой производительностью по сравнению. В этом случае можно задать значение MAXDOP hello toobe операции индекса выше, чем значение MAXDOP для запроса hello hello. В этом случае SQL Server имеет большее количество процессоров, которые может использовать для hello индекс операции по сравнению toohello число процессоров, он может выделить toohello запроса имеет большой размер. Помните, что вы не управляете hello числа потоков, SQL Server будет использовать для каждой операции. Позволяет задать максимальное число процессоров выделенных для hello многопоточность.

Дополнительные сведения см. в статье [Степень параллелизма](https://technet.microsoft.com/library/ms188611.aspx) в документации по SQL Server. Определить такие параметры, влияющие на многопоточность в приложении и их производительности toooptimize конфигурации.

## <a name="queue-depth"></a>Длина очереди
Здравствуйте, глубина очереди или длина очереди или размер очереди — hello, количество ожидающих запросов ввода-ВЫВОДА в системе hello. Hello значение длины очереди определяет, сколько операций ввода-ВЫВОДА приложения можно выравнивать, какие диски хранилища hello будет обрабатывать. Он влияет на все hello три приложения индикаторов производительности, мы уже в этой статье viz. операций ввода-ВЫВОДА, пропускной способности и задержки.

Длина очереди и многопоточность тесно связаны. значение длины очереди Hello указывает, сколько Многопоточность может осуществляться через приложение hello. Если hello глубина очереди имеет большой размер, приложение может выполнить дополнительные операции параллельно, другими словами, более многопоточность. Если глубина очереди hello мал, несмотря на то, что приложения является многопотоковым, не будет иметь достаточное количество запросов, разместить для параллельного выполнения.

Как правило, выключение hello Полка приложений не позволяют глубина очереди toochange hello, поскольку если задано неправильно, он будет выполнять больше вреда, чем пользы. Приложения будут значение hello правой очереди глубина tooget hello оптимальной производительности. Тем не менее он является важным toounderstand эту концепцию, чтобы устранения проблем с производительностью в приложении. Также вы можете увидеть эффекты hello длину очереди путем запуска средства оценки эффективности в системе.

Для некоторых приложений предоставляют параметры tooinfluence hello глубина очереди. Например параметр MAXDOP (максимальная степень параллелизма) hello в SQL Server описано в предыдущем разделе. MAXDOP является способом tooinfluence длину очереди и многопоточность, несмотря на то, что он не изменяет непосредственно hello значение длины очереди SQL Server.

*Высокое значение длины очереди*  
Глубина очереди высокой выравнивался больше операций на диске hello. диск Hello знает hello следующего запроса в его очереди заранее. Следовательно диск hello можно запланировать операции заранее и их обработки в оптимальной последовательности. Поскольку приложения hello отправляет дополнительные запросы toohello диск, диск hello может обрабатывать несколько параллельных операций ввода-вывода. В конечном счете, приложение hello будет может tooachieve выше операций ввода-ВЫВОДА. Так как приложение обрабатывает больше запросов, hello общая пропускная способность приложения hello также увеличивается.

Как правило, приложение может достигать максимальной пропускной способности при наличии 8–16 и более ожидающих выполнения операций ввода-вывода на подключенный диск. Если длина очереди, приложения не внедряет достаточно toohello системы IOs, и он обрабатывал меньше объема, в течение указанного периода. Другими словами, пропускная способность будет меньше.

Например, в SQL Server hello параметр MAXDOP значение для запроса слишком «4» сообщает SQL Server, его можно использовать toofour ядер tooexecute hello запрос. SQL Server определяют, что наилучшее очереди глубина значение и hello количество ядер для выполнения запроса hello.

*Оптимальная длина очереди*  
Использование очень высокого значения длины очереди также имеет свои недостатки. Если значение глубины очереди является слишком большим, приложение hello будет предпринята попытка toodrive очень высокий уровень операций ввода-ВЫВОДА. Если приложение использует непостоянные диски с недостаточным количеством подготовленных операций ввода-вывода в секунду, это может отрицательно повлиять на задержку. Следующая формула показаны hello отношения между операций ввода-ВЫВОДА, задержки и длину очереди.  
    ![](media/storage-premium-storage-performance/image6.png)

Не следует настраивать высокое значение длины очереди tooany, но tooan оптимальное значение, которое может обеспечить достаточное количество операций ввода-ВЫВОДА для приложения hello, не влияя на задержку. Например, если задержка приложения hello должен toobe 1 миллисекунды, hello глубина очереди необходима tooachieve имеет 5 000 операций ввода-ВЫВОДА, длина Очереди = 5000 x 0,001 = 5.

*Длина очереди чередующегося тома*  
Для чередующегося тома следует использовать достаточно высокое значение длины очереди, чтобы у каждого диска было отдельное значение максимальной длины очереди. Например, рассмотрим приложение, которое помещает длине очереди 2 и в hello stripe 4 диска. Hello два запроса ввода-ВЫВОДА переходит tootwo дисков, а оставшиеся два диска будут простаивать. Таким образом можно настройте длину очереди hello, таким образом, что все диски hello может быть занят. Формула ниже показано, как toodetermine hello длине очереди чередующиеся тома.  
    ![](media/storage-premium-storage-performance/image7.png)

## <a name="throttling"></a>Регулирование
Azure подготавливает хранилище Premium заданное число операций ввода-ВЫВОДА и пропускной способности в зависимости от размеров виртуальных Машин hello и размеры дисков, выбранный. Каждый раз, когда приложение пытается toodrive операций ввода-ВЫВОДА или пропускную способность выше эти ограничения могут обрабатывать какие hello виртуальной Машины и диска, хранилище Premium регулирование его. Это проявляется в виде hello снижение производительности в приложении. что выражается в повышенной задержке, низкой пропускной способности или меньшем количестве операций ввода-вывода в секунду. Если хранилище класса «Премиум» не выполнит регулировку, может произойти сбой всего приложения, так как оно превысит максимальные значения, которых могут достичь его ресурсы. Таким образом, из-за проблемы производительности tooavoid toothrottling всегда подготовки достаточные ресурсы для приложения. Имейте в виду, рассматриваются в hello размеры виртуальных Машин и диск размеры разделах выше. По измерению производительности является лучшим способом toofigure hello какие ресурсы необходимо будет toohost приложения.

## <a name="benchmarking"></a>Тестирование производительности
По измерению производительности — процесс hello имитация разную рабочую нагрузку на приложение и измерения производительности приложения hello для каждой рабочей нагрузки. С помощью hello действия, описанные в предыдущем разделе, где собраны hello требований к производительности приложения. Путем запуска средства на виртуальных машинах hello, где размещено приложение hello по измерению производительности, можно определить уровни производительности hello, приложения можно добиться с помощью хранилища Premium. В этом разделе приведены примеры тестирования производительности виртуальной машины серии DS14 класса «Стандартный», для которой подготовлены диски хранилища класса «Премиум».

Мы использовали стандартные инструменты тестирования производительности Iometer для Windows и FIO для Linux. Эти средства породить имитации рабочей нагрузки и производительности системы hello мер, аналогичной рабочей нескольких потоков. С помощью средств hello можно также настроить параметры, как Глубина блока размером и очереди, который обычно нельзя изменить для приложения. Это дает больше гибкости toodrive hello максимальную производительность на высокий уровень масштабирования виртуальных Машин, предоставлен дисков "премиум" для различных типов рабочих нагрузок приложений. Дополнительные сведения о каждой средство сравнения эффективности посетите toolearn [Iometer](http://www.iometer.org/) и [FIO](http://freecode.com/projects/fio).

toofollow hello примерах ниже, создайте Стандартная виртуальная машина DS14 и вложите 11 toohello диски Premium хранилища виртуальной Машины. Hello 11 дисков настройте 10 дисков с узлом, кэширование как «Нет» и чередовать их в том, называется NoCacheWrites. Настройка кэширования «Только для чтения» на диске, оставшиеся hello узла и создайте том вызове CacheReads с этого диска. С помощью этой программы установки, можно будет toosee hello максимальной Read и Write производительности Стандартная виртуальная машина DS14. Дополнительные сведения о создании виртуальной Машины DS14 с дисков "премиум" go слишком[Создание и использование учетной записи хранения Premium для диска данных виртуальной машины](storage-premium-storage.md).

*Прогрев hello кэша*  
Hello диск с кэширование узла ReadOnly будет может toogive выше операций ввода-ВЫВОДА превышает лимит hello диска. tooget максимального производительность чтения из кэша узла hello, сначала необходимо прогрева hello кэша диска. Это гарантирует, что напрямую, hello операций ввода-вывода чтения какие средство сравнения эффективности повлекут на томе CacheReads фактически достигает hello кэша и не hello диска. результат попаданий в кэш Hello в дополнительных операций ввода-ВЫВОДА из одиночного кэша hello включена диска.

> **Важно!**  
> Необходимо прогрева hello кэш до запуска тестирования производительности, каждый раз при перезагрузке ВМ.
>
>

#### <a name="iometer"></a>Iometer
[Загрузите средство Iometer hello](http://sourceforge.net/projects/iometer/files/iometer-stable/2006-07-27/iometer-2006.07.27.win32.i386-setup.exe/download) на hello виртуальной Машины.

*Тестовый файл*  
Iometer использует файл теста, хранящиеся на томе hello, на котором будут выполняться по измерению производительности теста hello. Движущей операций чтения и записи в данном тестов файл toomeasure hello диск операций ввода-ВЫВОДА и пропускной способности. Если этот файл не указан, Iometer создаст его. Создайте файл теста 200 ГБ с именем iobw.tst на томах CacheReads и NoCacheWrites hello.

*Спецификации доступа*  
Hello спецификации, запросить размер ввода-ВЫВОДА, % чтения и записи, % произвольных и последовательных настраиваются с помощью вкладки «Спецификации доступа» hello в Iometer. Создайте спецификацию доступа для каждого из описанных ниже сценариях hello. Создайте спецификации hello доступа с «Сохранить» с соответствующим именем как — RandomWrites\_8 КБ, RandomReads\_8 КБ. Выберите соответствующий спецификации hello при выполнении сценария тестовой hello.

Ниже приведен пример спецификаций доступа для сценария с максимальным количеством операций ввода-вывода в секунду при записи.  
    ![](media/storage-premium-storage-performance/image8.png)

*Спецификации тестирования при максимальном количестве операций ввода-вывода в секунду*  
Максимальная toodemonstrate операций ввода-вывода, использование меньшего размера запроса. Используйте запрос размером 8 КБ и создайте спецификации для случайных операций записи и чтения.

| Спецификация доступа | Размер запроса | Случайные, % | Чтение, % |
| --- | --- | --- | --- |
| RandomWrites\_8K |8 КБ |100 |0 |
| RandomReads\_8K |8 КБ |100 |100 |

*Спецификации тестирования максимальной пропускной способности*  
toodemonstrate максимальная пропускная способность и использование большего размера запроса. Используйте запрос размером 64 КБ и создайте спецификации для случайных операций записи и чтения.

| Спецификация доступа | Размер запроса | Случайные, % | Чтение, % |
| --- | --- | --- | --- |
| RandomWrites\_64K |64 КБ |100 |0 |
| RandomReads\_64K |64 КБ |100 |100 |

*Выполнение теста Iometer hello*  
Выполните действия hello ниже toowarm кэш

1. Создайте две спецификации доступа со значениями, указанными ниже.

   | Имя | Размер запроса | Случайные, % | Чтение, % |
   | --- | --- | --- | --- |
   | RandomWrites\_1MB |1MB |100 |0 |
   | RandomReads\_1MB |1MB |100 |100 |
2. Запустите тест Iometer hello для инициализации кэша на диске со следующими параметрами. Используйте три рабочих потоков для целевой том hello и очереди глубину 128. Задать Здравствуйте, «Время выполнения» длительность hello too2hrs теста на вкладке «Тестирование установки» hello.

   | Сценарий | Целевой том | Имя | Длительность |
   | --- | --- | --- | --- |
   | Инициализация диска с кэшем |CacheReads |RandomWrites\_1MB |2 ч |
3. Запустите тест Iometer hello для прогрев кэша на диске со следующими параметрами. Используйте три рабочих потоков для целевой том hello и очереди глубину 128. Задать Здравствуйте, «Время выполнения» длительность hello too2hrs теста на вкладке «Тестирование установки» hello.

   | Сценарий | Целевой том | Имя | Длительность |
   | --- | --- | --- | --- |
   | Подготовка диска с кэшем |CacheReads |RandomReads\_1MB |2 ч |

После активированию кэша на диске, продолжите hello сценариев тестирования, перечисленные ниже. hello toorun Iometer тестирования, используйте по крайней мере три рабочих потоков для **каждого** целевые тома. Для каждого рабочего потока выберите конечный том hello, задайте длину очереди и выберите один из спецификаций теста сохранены hello, как показано в таблице hello ниже toorun hello соответствующего тестового сценария. Hello таблице также показаны ожидаемые результаты для операций ввода-ВЫВОДА и пропускной способности, во время выполнения этих тестов. Во всех сценариях используется небольшой объем ввода-вывода, 8 КБ, и высокое значение длины очереди, «128».

| Сценарий тестирования | Целевой том | Имя | Результат |
| --- | --- | --- | --- |
| Макс. количество операций вода-вывода в секунду при чтении |CacheReads |RandomWrites\_8K |50 000 операций ввода-вывода в секунду  |
| Макс. количество операций вода-вывода в секунду при записи |NoCacheWrites |RandomReads\_8K |64 000 операций ввода-вывода в секунду |
| Макс. количество объединенных операций ввода-вывода в секунду |CacheReads |RandomWrites\_8K |100 000 операций ввода-вывода в секунду |
| NoCacheWrites |RandomReads\_8K | &nbsp; | &nbsp; |
| Макс. скорость чтения, МБ/с |CacheReads |RandomWrites\_64K |524 МБ/с |
| Макс. скорость записи, МБ/с |NoCacheWrites |RandomReads\_64K |524 МБ/с |
| Скорость объединенных операций, МБ/с |CacheReads |RandomWrites\_64K |1000 МБ/с |
| NoCacheWrites |RandomReads\_64K | &nbsp; | &nbsp; |

Ниже приведены снимки экрана приветствия Iometer результаты теста для объединенных сценариев операций ввода-ВЫВОДА и пропускной способности.

*Максимальное количество операций ввода-вывода в секунду при объединенных операциях чтения и записи*  
![](media/storage-premium-storage-performance/image9.png)

*Максимальная пропускная способность при объединенных операциях чтения и записи*  
![](media/storage-premium-storage-performance/image10.png)

### <a name="fio"></a>FIO
FIO — это хранилище toobenchmark популярным средством на hello виртуальных машин Linux. Он имеет hello гибкость tooselect разного размера, операции ввода-ВЫВОДА, последовательные или случайных операций чтения и записи. Оно создает рабочих потоков или процессов tooperform hello указанных операций ввода-вывода. Можно указать тип hello каждого рабочего потока необходимо выполнить с помощью файлов задания операций ввода-вывода. Мы создали один файл задания для каждого сценария в приведенных ниже примерах hello. Вы можете изменить спецификации hello в эти задания файлы toobenchmark разных рабочих нагрузок на хранилище Premium. В примерах hello, мы используем Стандартная виртуальная машина 14 доменных служб Active Directory промежуточных **Ubuntu**. Используйте hello одинаковую настройку, описанные в начале hello hello [раздел по измерению производительности](#Benchmarking) и нагревается hello кэш, прежде чем запускать тесты по измерению производительности hello.

Прежде чем начать, [скачайте FIO](https://github.com/axboe/fio) и установите его на виртуальной машине.

Запустите следующую команду для Ubuntu, hello

```
apt-get install fio
```

Мы будем использовать четыре рабочих потоков для поездки на машине операций записи и четырех рабочих потоков для каких операций чтения на дисках hello. Hello работников записи будет пешком трафика на nocache «Привет» том, который содержит 10 дисков с кэшем, задайте слишком «None». Hello работников чтения будет пешком трафика на томе readcache «hello», имеющая 1 диска с набором кэша слишком «ReadOnly».

*Максимальное количество операций ввода-вывода в секунду при записи*  
Создайте файл hello задания с помощью следующей спецификации tooget Максимума записи. Назовите файл fiowrite.ini.

```
[global]
size=30g
direct=1
iodepth=256
ioengine=libaio
bs=8k

[writer1]
rw=randwrite
directory=/mnt/nocache
[writer2]
rw=randwrite
directory=/mnt/nocache
[writer3]
rw=randwrite
directory=/mnt/nocache
[writer4]
rw=randwrite
directory=/mnt/nocache
```

Примечание hello выполните важнейших действий, которые соответствуют правилам разработки hello, описанные в предыдущих разделах. Эти спецификации, основные toodrive Максимума,  

* высокое значение длины очереди: 256;  
* небольшой размер блока: 8 КБ;  
* несколько потоков, выполняющих случайные операции записи.

Запустите hello, следующая команда tookick off hello FIO проверки на 30 секунд  

```
sudo fio --runtime 30 fiowrite.ini
```

Пока hello тест, можно будет toosee hello число записи, которые создали дисков виртуальной Машины и Premium hello операций ввода-ВЫВОДА. Как показано в следующем примере hello hello ВМ DS14 разрабатывает его максимальный записи операций ввода-ВЫВОДА ограничение в 50 000 операций ввода-ВЫВОДА.  
    ![](media/storage-premium-storage-performance/image11.png)

*Максимальное количество операций ввода-вывода при чтении*  
Создайте файл hello задания с помощью следующей спецификации tooget чтения Максимума. Назовите файл fioread.ini.

```
[global]
size=30g
direct=1
iodepth=256
ioengine=libaio
bs=8k

[reader1]
rw=randread
directory=/mnt/readcache
[reader2]
rw=randread
directory=/mnt/readcache
[reader3]
rw=randread
directory=/mnt/readcache
[reader4]
rw=randread
directory=/mnt/readcache
```

Примечание hello выполните важнейших действий, которые соответствуют правилам разработки hello, описанные в предыдущих разделах. Эти спецификации, основные toodrive Максимума,

* высокое значение длины очереди: 256;  
* небольшой размер блока: 8 КБ;  
* несколько потоков, выполняющих случайные операции записи.

Запустите hello, следующая команда tookick off hello FIO проверки на 30 секунд

```
sudo fio --runtime 30 fioread.ini
```

Пока hello тест, можно будет toosee hello число чтения hello операций ввода-ВЫВОДА виртуальной Машины и доставке дисков "премиум". Как показано в следующем примере hello hello ВМ DS14 разрабатывает более 64 000 операций чтения ввода-ВЫВОДА. Это сочетание диска hello и производительность кэша hello.  
    ![](media/storage-premium-storage-performance/image12.png)

*Максимальное количество операций ввода-вывода в секунду при чтении и записи*  
Создание файла hello задания с помощью следующей спецификации tooget максимальное сочетании чтения и записи операций ввода-ВЫВОДА. Назовите файл fioreadwrite.ini.

```
[global]
size=30g
direct=1
iodepth=128
ioengine=libaio
bs=4k

[reader1]
rw=randread
directory=/mnt/readcache
[reader2]
rw=randread
directory=/mnt/readcache
[reader3]
rw=randread
directory=/mnt/readcache
[reader4]
rw=randread
directory=/mnt/readcache

[writer1]
rw=randwrite
directory=/mnt/nocache
rate_iops=12500
[writer2]
rw=randwrite
directory=/mnt/nocache
rate_iops=12500
[writer3]
rw=randwrite
directory=/mnt/nocache
rate_iops=12500
[writer4]
rw=randwrite
directory=/mnt/nocache
rate_iops=12500
```

Примечание hello выполните важнейших действий, которые соответствуют правилам разработки hello, описанные в предыдущих разделах. Эти спецификации, основные toodrive Максимума,

* высокое значение длины очереди: 128;  
* небольшой размер блока: 4 КБ;  
* несколько потоков, выполняющих случайные операции чтения и записи.

Запустите hello, следующая команда tookick off hello FIO проверки на 30 секунд

```
sudo fio --runtime 30 fioreadwrite.ini
```

Пока hello тест, необходимо может toosee hello число объединенных чтения и записи операций ввода-ВЫВОДА hello ВМ и дисков "премиум" выполняется за. Как показано в следующем примере hello hello ВМ DS14 разрабатывает более чем 100 000 объединенный чтения и записи операций ввода-ВЫВОДА. Это сочетание диска hello и производительность кэша hello.  
    ![](media/storage-premium-storage-performance/image13.png)

*Максимальное значение объединенной пропускной способности*  
Максимальное hello tooget совместно чтения и записи пропускную способность, использовать больший размер блока и глубина большой размер очереди с несколькими потоками при выполнении операций чтения и записи. Можно использовать блоки размером 64 КБ и длину очереди со значением «128».

## <a name="next-steps"></a>Дальнейшие действия
Дополнительная информация о хранилище Azure класса «Премиум»:

* [Хранилище Premium: высокопроизводительное хранилище для рабочих нагрузок виртуальной машины Azure](storage-premium-storage.md)  

Если вы пользователь SQL Server, см. статьи с рекомендациями по оптимизации производительности SQL Server:

* [Рекомендации по оптимизации производительности SQL Server в виртуальных машинах Azure](../virtual-machines/windows/sql/virtual-machines-windows-sql-performance.md)
* [Хранилище Azure класса «Премиум» обеспечивает максимальную производительность SQL Server в виртуальных машинах Azure](http://blogs.technet.com/b/dataplatforminsider/archive/2015/04/23/azure-premium-storage-provides-highest-performance-for-sql-server-in-azure-vm.aspx)
