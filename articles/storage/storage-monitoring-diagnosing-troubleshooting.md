---
title: "Мониторинг, диагностика и устранение неполадок в работе службы хранилища Azure | Документация Майкрософт"
description: "Воспользуйтесь такими функциями, как аналитика хранилища, вход на стороне клиента, и другими сторонними инструментами для выявления, диагностики и устранения проблем, связанных со службой хранилища Azure."
services: storage
documentationcenter: 
author: fhryo-msft
manager: jahogg
editor: tysonn
ms.assetid: d1e87d98-c763-4caa-ba20-2cf85f853303
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/11/2017
ms.author: fhryo-msft
ms.openlocfilehash: c6bf7cd3bd16d8af30fed09f7878a0e68748a971
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="monitor-diagnose-and-troubleshoot-microsoft-azure-storage"></a><span data-ttu-id="c5631-103">Мониторинг, диагностика и устранение неисправностей службы хранилища Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="c5631-103">Monitor, diagnose, and troubleshoot Microsoft Azure Storage</span></span>
[!INCLUDE [storage-selector-portal-monitoring-diagnosing-troubleshooting](../../includes/storage-selector-portal-monitoring-diagnosing-troubleshooting.md)]

## <a name="overview"></a><span data-ttu-id="c5631-104">Обзор</span><span class="sxs-lookup"><span data-stu-id="c5631-104">Overview</span></span>
<span data-ttu-id="c5631-105">Диагностика и устранение неисправностей в распределенном приложении, размещенном в облачной среде, может представлять большую сложность в сравнении с традиционными средами.</span><span class="sxs-lookup"><span data-stu-id="c5631-105">Diagnosing and troubleshooting issues in a distributed application hosted in a cloud environment can be more complex than in traditional environments.</span></span> <span data-ttu-id="c5631-106">Развертывание приложений можно выполнять в инфраструктуре PaaS или IaaS, на площадке заказчика, на мобильном устройстве или в среде, в которой имеется произвольное сочетание таких устройств.</span><span class="sxs-lookup"><span data-stu-id="c5631-106">Applications can be deployed in a PaaS or IaaS infrastructure, on premises, on a mobile device, or in some combination of these.</span></span> <span data-ttu-id="c5631-107">Обычно сетевой трафик вашего приложения может проходить через общедоступные и частные сети, а ваше приложение может использовать множество технологий хранения данных, например таблицы службы хранилища Microsoft Azure, большие двоичные объекты, очереди или файлы, в дополнение к другим хранилищам данных, таким как реляционные базы данных и базы данных документов.</span><span class="sxs-lookup"><span data-stu-id="c5631-107">Typically, your application's network traffic may traverse public and private networks and your application may use multiple storage technologies such as Microsoft Azure Storage Tables, Blobs, Queues, or Files in addition to other data stores such as relational and document databases.</span></span>

<span data-ttu-id="c5631-108">Чтобы добиться успешного управления такими приложениями необходимо обеспечить наблюдение за ними и понимать принципы диагностики и устранения неисправностей как во всех их аспектах, так и в зависимых от этих приложений технологиях.</span><span class="sxs-lookup"><span data-stu-id="c5631-108">To manage such applications successfully you should monitor them proactively and understand how to diagnose and troubleshoot all aspects of them and their dependent technologies.</span></span> <span data-ttu-id="c5631-109">Как пользователю служб хранения Azure, вам необходимо постоянное наблюдение над службами хранения, которые использует ваше приложение, чтобы обнаружить любое неожиданное поведение (например, более медленный отклик, чем обычно), и использовать ведение журналов для сбора дополнительных подробных данных и их глубокого анализа.</span><span class="sxs-lookup"><span data-stu-id="c5631-109">As a user of Azure Storage services, you should continuously monitor the Storage services your application uses for any unexpected changes in behavior (such as slower than usual response times), and use logging to collect more detailed data and to analyze a problem in depth.</span></span> <span data-ttu-id="c5631-110">Диагностические сведения, которые вы получаете при наблюдении и ведении журналов, помогут установить главную причину неполадки, возникшей при использовании приложения.</span><span class="sxs-lookup"><span data-stu-id="c5631-110">The diagnostics information you obtain from both monitoring and logging will help you to determine the root cause of the issue your application encountered.</span></span> <span data-ttu-id="c5631-111">После этого вы можете выполнить поиск неисправности и определить шаги, необходимые для ее устранения.</span><span class="sxs-lookup"><span data-stu-id="c5631-111">Then you can troubleshoot the issue and determine the appropriate steps you can take to remediate it.</span></span> <span data-ttu-id="c5631-112">Хранилище Azure представляет собой главную службу Azure, и составляет важную часть большинства решений, развертываемых заказчиками в инфраструктуре Azure.</span><span class="sxs-lookup"><span data-stu-id="c5631-112">Azure Storage is a core Azure service, and forms an important part of the majority of solutions that customers deploy to the Azure infrastructure.</span></span> <span data-ttu-id="c5631-113">Хранилище Azure включает функции, предназначенные для упрощения мониторинга, диагностики и поиска неисправностей хранилища для облачных приложений.</span><span class="sxs-lookup"><span data-stu-id="c5631-113">Azure Storage includes capabilities to simplify monitoring, diagnosing, and troubleshooting storage issues in your cloud-based applications.</span></span>

> [!NOTE]
> <span data-ttu-id="c5631-114">В хранилище файлов Azure ведение журналов пока не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="c5631-114">The Azure File storage does not support logging at this time.</span></span>
> 

<span data-ttu-id="c5631-115">Практическое руководство по комплексному устранению неполадок в приложениях службы хранилища Azure см. в статье [Комплексный поиск и устранение неполадок с помощью метрик хранилища Azure и ведения журнала, AzCopy и анализатора сообщений](storage-e2e-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="c5631-115">For a hands-on guide to end-to-end troubleshooting in Azure Storage applications, see [End-to-End Troubleshooting using Azure Storage Metrics and Logging, AzCopy, and Message Analyzer](storage-e2e-troubleshooting.md).</span></span>

* <span data-ttu-id="c5631-116">[Введение]</span><span class="sxs-lookup"><span data-stu-id="c5631-116">[Introduction]</span></span>
  * <span data-ttu-id="c5631-117">[Структура руководства]</span><span class="sxs-lookup"><span data-stu-id="c5631-117">[How this guide is organized]</span></span>
* <span data-ttu-id="c5631-118">[Мониторинг службы хранилища]</span><span class="sxs-lookup"><span data-stu-id="c5631-118">[Monitoring your storage service]</span></span>
  * <span data-ttu-id="c5631-119">[Мониторинг работоспособности службы]</span><span class="sxs-lookup"><span data-stu-id="c5631-119">[Monitoring service health]</span></span>
  * <span data-ttu-id="c5631-120">[Мониторинг мощностей]</span><span class="sxs-lookup"><span data-stu-id="c5631-120">[Monitoring capacity]</span></span>
  * <span data-ttu-id="c5631-121">[Мониторинг доступности]</span><span class="sxs-lookup"><span data-stu-id="c5631-121">[Monitoring availability]</span></span>
  * <span data-ttu-id="c5631-122">[Мониторинг производительности]</span><span class="sxs-lookup"><span data-stu-id="c5631-122">[Monitoring performance]</span></span>
* <span data-ttu-id="c5631-123">[Диагностика неполадок с хранилищем]</span><span class="sxs-lookup"><span data-stu-id="c5631-123">[Diagnosing storage issues]</span></span>
  * <span data-ttu-id="c5631-124">[Проблемы с работоспособностью службы]</span><span class="sxs-lookup"><span data-stu-id="c5631-124">[Service health issues]</span></span>
  * <span data-ttu-id="c5631-125">[Проблемы с производительностью]</span><span class="sxs-lookup"><span data-stu-id="c5631-125">[Performance issues]</span></span>
  * <span data-ttu-id="c5631-126">[Диагностика ошибок]</span><span class="sxs-lookup"><span data-stu-id="c5631-126">[Diagnosing errors]</span></span>
  * <span data-ttu-id="c5631-127">[Проблемы с эмулятором хранения]</span><span class="sxs-lookup"><span data-stu-id="c5631-127">[Storage emulator issues]</span></span>
  * <span data-ttu-id="c5631-128">[Инструменты для ведения журналов хранилища]</span><span class="sxs-lookup"><span data-stu-id="c5631-128">[Storage logging tools]</span></span>
  * <span data-ttu-id="c5631-129">[Использование инструментов для ведения сетевого журнала]</span><span class="sxs-lookup"><span data-stu-id="c5631-129">[Using network logging tools]</span></span>
* <span data-ttu-id="c5631-130">[Комплексная трассировка]</span><span class="sxs-lookup"><span data-stu-id="c5631-130">[End-to-end tracing]</span></span>
  * <span data-ttu-id="c5631-131">[Сопоставление данных журналов]</span><span class="sxs-lookup"><span data-stu-id="c5631-131">[Correlating log data]</span></span>
  * <span data-ttu-id="c5631-132">[Идентификатор запроса клиента]</span><span class="sxs-lookup"><span data-stu-id="c5631-132">[Client request ID]</span></span>
  * <span data-ttu-id="c5631-133">[Идентификатор запроса сервера]</span><span class="sxs-lookup"><span data-stu-id="c5631-133">[Server request ID]</span></span>
  * <span data-ttu-id="c5631-134">[Метки времени]</span><span class="sxs-lookup"><span data-stu-id="c5631-134">[Timestamps]</span></span>
* <span data-ttu-id="c5631-135">[Рекомендации по устранению неполадок]</span><span class="sxs-lookup"><span data-stu-id="c5631-135">[Troubleshooting guidance]</span></span>
  * <span data-ttu-id="c5631-136">[Метрики содержат высокие значения AverageE2ELatency и низкие значения AverageServerLatency]</span><span class="sxs-lookup"><span data-stu-id="c5631-136">[Metrics show high AverageE2ELatency and low AverageServerLatency]</span></span>
  * <span data-ttu-id="c5631-137">[Метрики содержат низкие значения AverageE2ELatency и низкие значения AverageServerLatency, но клиент сталкивается с большой задержкой]</span><span class="sxs-lookup"><span data-stu-id="c5631-137">[Metrics show low AverageE2ELatency and low AverageServerLatency but the client is experiencing high latency]</span></span>
  * <span data-ttu-id="c5631-138">[Метрики содержат высокие значения AverageServerLatency]</span><span class="sxs-lookup"><span data-stu-id="c5631-138">[Metrics show high AverageServerLatency]</span></span>
  * <span data-ttu-id="c5631-139">[При доставке сообщений в очередь возникают неожиданные задержки]</span><span class="sxs-lookup"><span data-stu-id="c5631-139">[You are experiencing unexpected delays in message delivery on a queue]</span></span>
  * <span data-ttu-id="c5631-140">[Метрики указывают на увеличение значения PercentThrottlingError]</span><span class="sxs-lookup"><span data-stu-id="c5631-140">[Metrics show an increase in PercentThrottlingError]</span></span>
  * <span data-ttu-id="c5631-141">[Метрики указывают на увеличение значения PercentTimeoutError]</span><span class="sxs-lookup"><span data-stu-id="c5631-141">[Metrics show an increase in PercentTimeoutError]</span></span>
  * <span data-ttu-id="c5631-142">[Метрики показывают увеличение значения PercentNetworkError]</span><span class="sxs-lookup"><span data-stu-id="c5631-142">[Metrics show an increase in PercentNetworkError]</span></span>
  * <span data-ttu-id="c5631-143">[Клиент получает сообщения «HTTP 403 (запрещено)»]</span><span class="sxs-lookup"><span data-stu-id="c5631-143">[The client is receiving HTTP 403 (Forbidden) messages]</span></span>
  * <span data-ttu-id="c5631-144">[Клиент получает сообщения «HTTP 404 (не найдено)»]</span><span class="sxs-lookup"><span data-stu-id="c5631-144">[The client is receiving HTTP 404 (Not found) messages]</span></span>
  * <span data-ttu-id="c5631-145">[Клиент получает сообщения HTTP 409 (конфликт)]</span><span class="sxs-lookup"><span data-stu-id="c5631-145">[The client is receiving HTTP 409 (Conflict) messages]</span></span>
  * <span data-ttu-id="c5631-146">[Метрики содержат низкие значения PercentSuccess, или в записях журналов аналитики присутствуют операции с состоянием транзакции ClientOtherErrors]</span><span class="sxs-lookup"><span data-stu-id="c5631-146">[Metrics show low PercentSuccess or analytics log entries have operations with transaction status of ClientOtherErrors]</span></span>
  * <span data-ttu-id="c5631-147">[Метрики объема показывают неожиданное увеличение использования объема хранилища]</span><span class="sxs-lookup"><span data-stu-id="c5631-147">[Capacity metrics show an unexpected increase in storage capacity usage]</span></span>
  * <span data-ttu-id="c5631-148">[Происходит неожиданный перезапуск виртуальных машин, имеющих большое количество виртуальных жестких дисков]</span><span class="sxs-lookup"><span data-stu-id="c5631-148">[You are experiencing unexpected reboots of Virtual Machines that have a large number of attached VHDs]</span></span>
  * <span data-ttu-id="c5631-149">[Проблема связана с использованием эмулятора хранения на этапе разработки или тестирования]</span><span class="sxs-lookup"><span data-stu-id="c5631-149">[Your issue arises from using the storage emulator for development or test]</span></span>
  * <span data-ttu-id="c5631-150">[Возникают проблемы при установке пакета SDK для Azure для .NET]</span><span class="sxs-lookup"><span data-stu-id="c5631-150">[You are encountering problems installing the Azure SDK for .NET]</span></span>
  * <span data-ttu-id="c5631-151">[Возникла другая проблема со службой хранилища]</span><span class="sxs-lookup"><span data-stu-id="c5631-151">[You have a different issue with a storage service]</span></span>
  * [<span data-ttu-id="c5631-152">Устранение неполадок с хранилищем файлов Azure в Windows и Linux</span><span class="sxs-lookup"><span data-stu-id="c5631-152">Troubleshooting Azure File storage issues with Windows and Linux</span></span>](storage-troubleshoot-file-connection-problems.md)
* <span data-ttu-id="c5631-153">[приложениях]</span><span class="sxs-lookup"><span data-stu-id="c5631-153">[Appendices]</span></span>
  * <span data-ttu-id="c5631-154">[приложении 1 "Отслеживание HTTP- и HTTPS-трафика с помощью Fiddler"]</span><span class="sxs-lookup"><span data-stu-id="c5631-154">[Appendix 1: Using Fiddler to capture HTTP and HTTPS traffic]</span></span>
  * <span data-ttu-id="c5631-155">[Приложение 2. Отслеживание сетевого трафика с помощью Wireshark]</span><span class="sxs-lookup"><span data-stu-id="c5631-155">[Appendix 2: Using Wireshark to capture network traffic]</span></span>
  * <span data-ttu-id="c5631-156">[Приложение 3. Отслеживание сетевого трафика с помощью Microsoft Message Analyzer]</span><span class="sxs-lookup"><span data-stu-id="c5631-156">[Appendix 3: Using Microsoft Message Analyzer to capture network traffic]</span></span>
  * <span data-ttu-id="c5631-157">[Приложение 4. Просмотр метрик и данных журналов с помощью Excel]</span><span class="sxs-lookup"><span data-stu-id="c5631-157">[Appendix 4: Using Excel to view metrics and log data]</span></span>
  * <span data-ttu-id="c5631-158">[Приложение 5. Мониторинг с использованием Application Insights для Visual Studio Team Services]</span><span class="sxs-lookup"><span data-stu-id="c5631-158">[Appendix 5: Monitoring with Application Insights for Visual Studio Team Services]</span></span>

## <span data-ttu-id="c5631-159"><a name="introduction"></a>Введение</span><span class="sxs-lookup"><span data-stu-id="c5631-159"><a name="introduction"></a>Introduction</span></span>
<span data-ttu-id="c5631-160">В этом руководстве показано, как с помощью таких функций, как Azure Storage Analytics, ведение журналов на стороне клиента в клиентской библиотеке хранилища Azure и прочих сторонних инструментов, выявлять, диагностировать и устранять неполадки, связанные с хранилищем Azure.</span><span class="sxs-lookup"><span data-stu-id="c5631-160">This guide shows you how to use features such as Azure Storage Analytics, client-side logging in the Azure Storage Client Library, and other third-party tools to identify, diagnose, and troubleshoot Azure Storage related issues.</span></span>

![][1]

<span data-ttu-id="c5631-161">Это руководство в первую очередь предназначено для разработчиков веб-служб, использующих службы хранилища Azure, а также для ИТ-специалистов, ответственных за управление ими.</span><span class="sxs-lookup"><span data-stu-id="c5631-161">This guide is intended to be read primarily by developers of online services that use Azure Storage Services and IT Pros responsible for managing such online services.</span></span> <span data-ttu-id="c5631-162">Цели этого руководства:</span><span class="sxs-lookup"><span data-stu-id="c5631-162">The goals of this guide are:</span></span>

* <span data-ttu-id="c5631-163">Помочь вам поддерживать работоспособность и производительность своих учетных записей хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="c5631-163">To help you maintain the health and performance of your Azure Storage accounts.</span></span>
* <span data-ttu-id="c5631-164">Познакомить вас с процессами и инструментами, помогающими определить, связана ли возникшая в приложении проблема с хранилищем Azure.</span><span class="sxs-lookup"><span data-stu-id="c5631-164">To provide you with the necessary processes and tools to help you decide if an issue or problem in an application relates to Azure Storage.</span></span>
* <span data-ttu-id="c5631-165">Предоставить вам практические рекомендации по устранению проблем, связанных с хранилищем Azure.</span><span class="sxs-lookup"><span data-stu-id="c5631-165">To provide you with actionable guidance for resolving problems related to Azure Storage.</span></span>

### <span data-ttu-id="c5631-166"><a name="how-this-guide-is-organized"></a>Структура руководства</span><span class="sxs-lookup"><span data-stu-id="c5631-166"><a name="how-this-guide-is-organized"></a>How this guide is organized</span></span>
<span data-ttu-id="c5631-167">В разделе[Мониторинг службы хранилища]описывается, как с помощью метрик аналитики хранилища Azure (метрик хранилища) отслеживать работоспособность и производительность ваших служб хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="c5631-167">The section "[Monitoring your storage service]" describes how to monitor the health and performance of your Azure Storage services using Azure Storage Analytics Metrics (Storage Metrics).</span></span>

<span data-ttu-id="c5631-168">Раздел[Диагностика неполадок с хранилищем]посвящен диагностике проблем с использованием аналитических журналов хранилища Azure (журналов хранилища).</span><span class="sxs-lookup"><span data-stu-id="c5631-168">The section "[Diagnosing storage issues]" describes how to diagnose issues using Azure Storage Analytics Logging (Storage Logging).</span></span> <span data-ttu-id="c5631-169">Кроме того, в нем описывается, как включить ведение журналов на стороне клиента с использованием средств из одной или нескольких клиентских библиотек, таких как клиентская библиотека хранилища для .NET или Azure SDK для Java.</span><span class="sxs-lookup"><span data-stu-id="c5631-169">It also describes how to enable client-side logging using the facilities in one of the client libraries such as the Storage Client Library for .NET or the Azure SDK for Java.</span></span>

<span data-ttu-id="c5631-170">В разделе[Комплексная трассировка]вы найдете сведения о корреляции данных из различных журналов и метрик.</span><span class="sxs-lookup"><span data-stu-id="c5631-170">The section "[End-to-end tracing]" describes how you can correlate the information contained in various log files and metrics data.</span></span>

<span data-ttu-id="c5631-171">В разделе[Рекомендации по устранению неполадок]представлены инструкции по устранению самых распространенных неполадок хранилища, с которыми вы можете столкнуться.</span><span class="sxs-lookup"><span data-stu-id="c5631-171">The section "[Troubleshooting guidance]" provides troubleshooting guidance for some of the common storage-related issues you might encounter.</span></span>

<span data-ttu-id="c5631-172">Раздел[приложениях]включает сведения об использовании других средств, например Wireshark и Netmon для анализа обмена сетевыми пакетами, Fiddler — для анализа сообщений HTTP и HTTPS, а также Microsoft Message Analyzer — для корреляции данных журналов.</span><span class="sxs-lookup"><span data-stu-id="c5631-172">The "[Appendices]" include information about using other tools such as Wireshark and Netmon for analyzing network packet data, Fiddler for analyzing HTTP/HTTPS messages, and Microsoft Message Analyzer for correlating log data.</span></span>

## <span data-ttu-id="c5631-173"><a name="monitoring-your-storage-service"></a>Мониторинг службы хранилища</span><span class="sxs-lookup"><span data-stu-id="c5631-173"><a name="monitoring-your-storage-service"></a>Monitoring your storage service</span></span>
<span data-ttu-id="c5631-174">Если вы знакомы с системным монитором Windows, то можете считать, что метрики хранилища — эквивалент счетчиков службы хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="c5631-174">If you are familiar with Windows performance monitoring, you can think of Storage Metrics as being an Azure Storage equivalent of Windows Performance Monitor counters.</span></span> <span data-ttu-id="c5631-175">Они предоставляют полный набор метрик (счетчиков в терминологии системного монитора Windows), позволяющих оценить, например, доступность службы, общее количество запросов к службе, а также процент успешно обработанных запросов.</span><span class="sxs-lookup"><span data-stu-id="c5631-175">In Storage Metrics you will find a comprehensive set of metrics (counters in Windows Performance Monitor terminology) such as service availability, total number of requests to service, or percentage of successful requests to service.</span></span> <span data-ttu-id="c5631-176">Полный список доступных метрик см. в статье [Storage Analytics Metrics Table Schema](http://msdn.microsoft.com/library/azure/hh343264.aspx) (Схема таблицы метрик аналитики хранилища).</span><span class="sxs-lookup"><span data-stu-id="c5631-176">For a full list of the available metrics, see [Storage Analytics Metrics Table Schema](http://msdn.microsoft.com/library/azure/hh343264.aspx).</span></span> <span data-ttu-id="c5631-177">Вы можете настроить службу хранилища так, чтобы она собирала и агрегировала метрики каждый час или каждую минуту.</span><span class="sxs-lookup"><span data-stu-id="c5631-177">You can specify whether you want the storage service to collect and aggregate metrics every hour or every minute.</span></span> <span data-ttu-id="c5631-178">Дополнительные сведения о том, как включить метрики и отслеживать учетные записи хранения, см. в статье [Enabling storage metrics and viewing metrics data](http://go.microsoft.com/fwlink/?LinkId=510865) (Включение метрик хранилища и просмотр данных метрик).</span><span class="sxs-lookup"><span data-stu-id="c5631-178">For more information about how to enable metrics and monitor your storage accounts, see [Enabling storage metrics and viewing metrics data](http://go.microsoft.com/fwlink/?LinkId=510865).</span></span>

<span data-ttu-id="c5631-179">Вы можете выбрать, какие ежечасные метрики должны отображаться на [портале Azure](https://portal.azure.com), и настроить правила для уведомления администраторов по электронной почте обо всех случаях, когда эти метрики превышают пороговые уровни.</span><span class="sxs-lookup"><span data-stu-id="c5631-179">You can choose which hourly metrics you want to display in the [Azure portal](https://portal.azure.com) and configure rules that notify administrators by email whenever an hourly metric exceeds a particular threshold.</span></span> <span data-ttu-id="c5631-180">Дополнительные сведения см. в статье [Создание оповещений для служб Azure с помощью портала Azure](../monitoring-and-diagnostics/insights-receive-alert-notifications.md).</span><span class="sxs-lookup"><span data-stu-id="c5631-180">For more information, see [Receive Alert Notifications](../monitoring-and-diagnostics/insights-receive-alert-notifications.md).</span></span> 

<span data-ttu-id="c5631-181">Метрики позволяют получить довольно полную картину о состоянии службы хранилища, но иногда регистрируют не все операции.</span><span class="sxs-lookup"><span data-stu-id="c5631-181">The storage service collects metrics using a best effort, but may not record every storage operation.</span></span>

<span data-ttu-id="c5631-182">На портале Azure можно просматривать такие метрики для учетной записи хранения, как доступность, общее количество запросов и средние показатели задержки.</span><span class="sxs-lookup"><span data-stu-id="c5631-182">In the Azure portal, you can view metrics such as availability, total requests, and average latency numbers for a storage account.</span></span> <span data-ttu-id="c5631-183">Кроме того, на этой странице настроено правило для оповещения администратора о спаде доступности ниже определенного уровня.</span><span class="sxs-lookup"><span data-stu-id="c5631-183">A notification rule has also been set up to alert an administrator if availability drops below a certain level.</span></span> <span data-ttu-id="c5631-184">Помимо этих данных, на возможные проблемы также может указывать то, что уровень успешной обработки службы таблиц составляет менее 100 % (дополнительные сведения см. в разделе [Метрики содержат низкие значения PercentSuccess, или в записях журналов аналитики присутствуют операции с состоянием транзакции ClientOtherErrors]).</span><span class="sxs-lookup"><span data-stu-id="c5631-184">From viewing this data, one possible area for investigation is the table service success percentage being below 100% (for more information, see the section "[Metrics show low PercentSuccess or analytics log entries have operations with transaction status of ClientOtherErrors]").</span></span>

<span data-ttu-id="c5631-185">Чтобы упростить постоянный контроль за работоспособностью и производительностью своих приложений Azure, рекомендуем вам:</span><span class="sxs-lookup"><span data-stu-id="c5631-185">You should continuously monitor your Azure applications to ensure they are healthy and performing as expected by:</span></span>

* <span data-ttu-id="c5631-186">Установить базовые метрики, которые позволят сравнивать текущие данные и выявлять значительные изменения в работе хранилища Azure и вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="c5631-186">Establishing some baseline metrics for application that will enable you to compare current data and identify any significant changes in the behavior of Azure storage and your application.</span></span> <span data-ttu-id="c5631-187">Во многих случаях значения базовых метрик будут зависеть от конкретного приложения — их нужно установить по результатам тестирования программы.</span><span class="sxs-lookup"><span data-stu-id="c5631-187">The values of your baseline metrics will, in many cases, be application specific and you should establish them when you are performance testing your application.</span></span>
* <span data-ttu-id="c5631-188">С помощью ежеминутных метрик активно отслеживать непредвиденные ошибки и необычные изменения, например резкое увеличение числа ошибок или запросов.</span><span class="sxs-lookup"><span data-stu-id="c5631-188">Recording minute metrics and using them to monitor actively for unexpected errors and anomalies such as spikes in error counts or request rates.</span></span>
* <span data-ttu-id="c5631-189">С помощью ежечасных метрик контролировать средние значения, например среднее число ошибок и запросов.</span><span class="sxs-lookup"><span data-stu-id="c5631-189">Recording hourly metrics and using them to monitor average values such as average error counts and request rates.</span></span>
* <span data-ttu-id="c5631-190">Изучать потенциальные проблемы с помощью диагностических инструментов, описанных в разделе[Диагностика неполадок с хранилищем].</span><span class="sxs-lookup"><span data-stu-id="c5631-190">Investigating potential issues using diagnostics tools as discussed later in the section "[Diagnosing storage issues]."</span></span>

<span data-ttu-id="c5631-191">Диаграммы на представленном ниже рисунке демонстрируют, как усреднение, происходящее при сборе метрик каждый час, скрывает всплески активности.</span><span class="sxs-lookup"><span data-stu-id="c5631-191">The charts in the following image illustrate how the averaging that occurs for hourly metrics can hide spikes in activity.</span></span> <span data-ttu-id="c5631-192">Ежечасные метрики отражают равномерный поток запросов, в то время как ежеминутные показывают колебания, которые происходят на самом деле.</span><span class="sxs-lookup"><span data-stu-id="c5631-192">The hourly metrics appear to show a steady rate of requests, while the minute metrics reveal the fluctuations that are really taking place.</span></span>

![][3]

<span data-ttu-id="c5631-193">Последняя часть этого раздела посвящена тому, какие метрики вы должны отслеживать и почему.</span><span class="sxs-lookup"><span data-stu-id="c5631-193">The remainder of this section describes what metrics you should monitor and why.</span></span>

### <span data-ttu-id="c5631-194"><a name="monitoring-service-health"></a>Мониторинг работоспособности службы</span><span class="sxs-lookup"><span data-stu-id="c5631-194"><a name="monitoring-service-health"></a>Monitoring service health</span></span>
<span data-ttu-id="c5631-195">На [портале Azure](https://portal.azure.com) вы можете следить за работоспособностью службы хранилища (и других служб Azure) в любых регионах Azure по всему миру.</span><span class="sxs-lookup"><span data-stu-id="c5631-195">You can use the [Azure portal](https://portal.azure.com) to view the health of the Storage service (and other Azure services) in all the Azure regions around the world.</span></span> <span data-ttu-id="c5631-196">Это позволяет мгновенно определить, не затронуто ли ваше приложение проблемой со службой хранилища, на которую вы никак не можете повлиять.</span><span class="sxs-lookup"><span data-stu-id="c5631-196">This enables you to see immediately if an issue outside of your control is affecting the Storage service in the region you use for your application.</span></span>

<span data-ttu-id="c5631-197">Кроме того, [портал Azure](https://portal.azure.com) может рассылать уведомления об инцидентах, влияющих на различные службы Azure.</span><span class="sxs-lookup"><span data-stu-id="c5631-197">The [Azure portal](https://portal.azure.com) can also provide notifications of incidents that affect the various Azure services.</span></span>
<span data-ttu-id="c5631-198">Ранее эта информация, наряду с данными журналов, была доступна на [панели мониторинга служб Azure](http://status.azure.com).</span><span class="sxs-lookup"><span data-stu-id="c5631-198">Note: This information was previously available, along with historical data, on the [Azure Service Dashboard](http://status.azure.com).</span></span>

<span data-ttu-id="c5631-199">[Портал Azure](https://portal.azure.com) собирает сведения о работоспособности из центров обработки данных Azure (внутренний мониторинг), но вы также можете использовать внешний мониторинг для создания искусственных транзакций, которые периодически поступают в ваше веб-приложение на базе Azure из нескольких расположений.</span><span class="sxs-lookup"><span data-stu-id="c5631-199">While the [Azure portal](https://portal.azure.com) collects health information from inside the Azure datacenters (inside-out monitoring), you could also consider adopting an outside-in approach to generate synthetic transactions that periodically access your Azure-hosted web application from multiple locations.</span></span> <span data-ttu-id="c5631-200">Например, подобный подход может быть реализован с использованием [Dynatrace](http://www.dynatrace.com/en/synthetic-monitoring) и Application Insights для Visual Studio Team Services.</span><span class="sxs-lookup"><span data-stu-id="c5631-200">The services offered by [Dynatrace](http://www.dynatrace.com/en/synthetic-monitoring) and Application Insights for Visual Studio Team Services are examples of this outside-in approach.</span></span> <span data-ttu-id="c5631-201">Дополнительные сведения об Application Insights для Visual Studio Team Services см. в разделе [приложении 5 "Мониторинг с использованием Application Insights для Visual Studio Team Services"](#appendix-5).</span><span class="sxs-lookup"><span data-stu-id="c5631-201">For more information about Application Insights for Visual Studio Team Services, see the appendix "[Appendix 5: Monitoring with Application Insights for Visual Studio Team Services](#appendix-5)."</span></span>

### <span data-ttu-id="c5631-202"><a name="monitoring-capacity"></a>Мониторинг мощностей</span><span class="sxs-lookup"><span data-stu-id="c5631-202"><a name="monitoring-capacity"></a>Monitoring capacity</span></span>
<span data-ttu-id="c5631-203">В метриках емкости учитывается только служба BLOB-объектов, так как именно они обычно занимают больше всего места (на момент подготовки этой статьи метрики хранилища невозможно использовать для мониторинга емкости таблиц и очередей).</span><span class="sxs-lookup"><span data-stu-id="c5631-203">Storage Metrics only stores capacity metrics for the blob service because blobs typically account for the largest proportion of stored data (at the time of writing, it is not possible to use Storage Metrics to monitor the capacity of your tables and queues).</span></span> <span data-ttu-id="c5631-204">Если вы включили мониторинг службы BLOB-объектов, то можете найти эти данные в таблице **$MetricsCapacityBlob**.</span><span class="sxs-lookup"><span data-stu-id="c5631-204">You can find this data in the **$MetricsCapacityBlob** table if you have enabled monitoring for the Blob service.</span></span> <span data-ttu-id="c5631-205">Метрики хранилища регистрируют подобные сведения каждый день. По значению **RowKey** вы можете определить, к чему относится запись в строке: к пользовательским (значение **data**) или к аналитическим данным (значение **analytics**).</span><span class="sxs-lookup"><span data-stu-id="c5631-205">Storage Metrics records this data once per day, and you can use the value of the **RowKey** to determine whether the row contains an entity that relates to user data (value **data**) or analytics data (value **analytics**).</span></span> <span data-ttu-id="c5631-206">Каждая сохраненная запись содержит информацию о занятом месте (показатель **Capacity** в байтах), а также о том, сколько контейнеров (**ContainerCount**) и BLOB-объектов (**ObjectCount**) на данный момент используется в учетной записи хранилища.</span><span class="sxs-lookup"><span data-stu-id="c5631-206">Each stored entity contains information about the amount of storage used (**Capacity** measured in bytes) and the current number of containers (**ContainerCount**) and blobs (**ObjectCount**) in use in the storage account.</span></span> <span data-ttu-id="c5631-207">Дополнительные сведения о метриках емкости, хранящихся в таблице **$MetricsCapacityBlob**, см. в статье [Storage Analytics Metrics Table Schema](http://msdn.microsoft.com/library/azure/hh343264.aspx) (Схема таблицы метрик аналитики хранилища).</span><span class="sxs-lookup"><span data-stu-id="c5631-207">For more information about the capacity metrics stored in the **$MetricsCapacityBlob** table, see [Storage Analytics Metrics Table Schema](http://msdn.microsoft.com/library/azure/hh343264.aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="c5631-208">Рекомендуем вам отслеживать эти значения, так как они позволяют заранее определить, что в вашей учетной записи хранилища скоро будут достигнуты пределы емкости.</span><span class="sxs-lookup"><span data-stu-id="c5631-208">You should monitor these values for an early warning that you are approaching the capacity limits of your storage account.</span></span> <span data-ttu-id="c5631-209">На портале Azure можно добавить правила генерации оповещений о превышении установленных пороговых значений используемой емкости.</span><span class="sxs-lookup"><span data-stu-id="c5631-209">In the Azure portal, you can add alert rules to notify you if aggregate storage use exceeds or falls below thresholds that you specify.</span></span>
> 
> 

<span data-ttu-id="c5631-210">Чтобы узнать, как оценить размер различных объектов для хранения данных, например больших двоичных объектов, прочтите запись блога [Общая информация о плате за использование хранилища Azure: пропускная способность, транзакции и емкость](http://blogs.msdn.com/b/windowsazurestorage/archive/2010/07/09/understanding-windows-azure-storage-billing-bandwidth-transactions-and-capacity.aspx).</span><span class="sxs-lookup"><span data-stu-id="c5631-210">For help estimating the size of various storage objects such as blobs, see the blog post [Understanding Azure Storage Billing – Bandwidth, Transactions, and Capacity](http://blogs.msdn.com/b/windowsazurestorage/archive/2010/07/09/understanding-windows-azure-storage-billing-bandwidth-transactions-and-capacity.aspx).</span></span>

### <span data-ttu-id="c5631-211"><a name="monitoring-availability"></a>Мониторинг доступности</span><span class="sxs-lookup"><span data-stu-id="c5631-211"><a name="monitoring-availability"></a>Monitoring availability</span></span>
<span data-ttu-id="c5631-212">Вы должны отслеживать доступность служб хранилища в своей учетной записи хранения путем мониторинга значения в столбце **Доступность** таблиц, содержащих метрики, которые фиксируются каждую минуту или каждый час: **$MetricsHourPrimaryTransactionsBlob**, **$MetricsHourPrimaryTransactionsTable**, **$MetricsHourPrimaryTransactionsQueue**, **$MetricsMinutePrimaryTransactionsBlob**, **$MetricsMinutePrimaryTransactionsTable**, **$MetricsMinutePrimaryTransactionsQueue** и **$MetricsCapacityBlob**.</span><span class="sxs-lookup"><span data-stu-id="c5631-212">You should monitor the availability of the storage services in your storage account by monitoring the value in the **Availability** column in the hourly or minute metrics tables — **$MetricsHourPrimaryTransactionsBlob**, **$MetricsHourPrimaryTransactionsTable**, **$MetricsHourPrimaryTransactionsQueue**, **$MetricsMinutePrimaryTransactionsBlob**, **$MetricsMinutePrimaryTransactionsTable**, **$MetricsMinutePrimaryTransactionsQueue**, **$MetricsCapacityBlob**.</span></span> <span data-ttu-id="c5631-213">Столбец **Доступность** содержит процентное значение, которое отражает доступность службы или операции API, указанной в соответствующей строке (**Ключ строки** показывает, содержит ли строка метрики для службы в целом или только для конкретной операции API).</span><span class="sxs-lookup"><span data-stu-id="c5631-213">The **Availability** column contains a percentage value that indicates the availability of the service or the API operation represented by the row (the **RowKey** shows if the row contains metrics for the service as a whole or for a specific API operation).</span></span>

<span data-ttu-id="c5631-214">Если значение меньше 100 %, это означает, что некоторые запросы к хранилищу не были выполнены.</span><span class="sxs-lookup"><span data-stu-id="c5631-214">Any value less than 100% indicates that some storage requests are failing.</span></span> <span data-ttu-id="c5631-215">Чтобы узнать, в чем причина сбоя, проверьте другие столбцы с данными метрик, означающих число запросов с ошибками разных типов, например **Ошибка времени ожидания сервера**.</span><span class="sxs-lookup"><span data-stu-id="c5631-215">You can see why they are failing by examining the other columns in the metrics data that show the numbers of requests with different error types such as **ServerTimeoutError**.</span></span> <span data-ttu-id="c5631-216">Вы должны быть готовы к тому, что иногда значение в столбце **Доступность** временно опускается ниже 100 % по определенным причинам (например, из-за превышения времени ожидания на сервере, когда служба перемещает разделы для балансировки нагрузки по запросам). Логический алгоритм повтора в вашем клиентском приложении должен обрабатывать эти периодически возникающие ситуации.</span><span class="sxs-lookup"><span data-stu-id="c5631-216">You should expect to see **Availability** fall temporarily below 100% for reasons such as transient server timeouts while the service moves partitions to better load-balance request; the retry logic in your client application should handle such intermittent conditions.</span></span> <span data-ttu-id="c5631-217">В статье [Storage Analytics Logged Operations and Status Messages](http://msdn.microsoft.com/library/azure/hh343260.aspx) (Регистрируемые операции и сообщения о состоянии аналитики хранилища) перечислены типы транзакций, которые учитываются системой метрик хранилища при расчете значения **Availability**.</span><span class="sxs-lookup"><span data-stu-id="c5631-217">The article [Storage Analytics Logged Operations and Status Messages](http://msdn.microsoft.com/library/azure/hh343260.aspx) lists the transaction types that Storage Metrics includes in its **Availability** calculation.</span></span>

<span data-ttu-id="c5631-218">На [портале Azure](https://portal.azure.com)можно добавить правила генерации оповещений, чтобы получать уведомления, когда значение **Availability** для службы опустится ниже заданного порога.</span><span class="sxs-lookup"><span data-stu-id="c5631-218">In the [Azure portal](https://portal.azure.com), you can add alert rules to notify you if **Availability** for a service falls below a threshold that you specify.</span></span>

<span data-ttu-id="c5631-219">В разделе[Рекомендации по устранению неполадок]этого руководства описаны некоторые распространенные проблемы со службой хранилища, связанные с доступностью.</span><span class="sxs-lookup"><span data-stu-id="c5631-219">The "[Troubleshooting guidance]" section of this guide describes some common storage service issues related to availability.</span></span>

### <span data-ttu-id="c5631-220"><a name="monitoring-performance"></a>Мониторинг производительности</span><span class="sxs-lookup"><span data-stu-id="c5631-220"><a name="monitoring-performance"></a>Monitoring performance</span></span>
<span data-ttu-id="c5631-221">Для отслеживания производительности можно использовать перечисленные ниже метрики из таблиц, содержащих метрики, которые фиксируются каждую минуту или каждый час.</span><span class="sxs-lookup"><span data-stu-id="c5631-221">To monitor the performance of the storage services, you can use the following metrics from the hourly and minute metrics tables.</span></span>

* <span data-ttu-id="c5631-222">Значения в столбцах **AverageE2ELatency** и **AverageServerLatency** соответствуют среднему времени, затрачиваемому службой хранилища или операцией API на обработку запросов.</span><span class="sxs-lookup"><span data-stu-id="c5631-222">The values in the **AverageE2ELatency** and **AverageServerLatency** columns show the average time the storage service or API operation type is taking to process requests.</span></span> <span data-ttu-id="c5631-223">**AverageE2ELatency** — это показатель сквозной задержки, который включает в себя время, затраченное на чтение запроса и отправку ответа, а также время обработки запроса (следовательно, сюда входит задержка в сети после того, как запрос достигнет службы хранилища). В метрике **AverageServerLatency** учитывается только время обработки, т. е. в это значение не включена задержка в сети, которая относится к взаимодействию с клиентом.</span><span class="sxs-lookup"><span data-stu-id="c5631-223">**AverageE2ELatency** is a measure of end-to-end latency that includes the time taken to read the request and send the response in addition to the time taken to process the request (therefore includes network latency once the request reaches the storage service); **AverageServerLatency** is a measure of just the processing time and therefore excludes any network latency related to communicating with the client.</span></span> <span data-ttu-id="c5631-224">В разделе [Метрики содержат высокие значения AverageE2ELatency и низкие значения AverageServerLatency] далее в этом руководстве рассматриваются причины, по которым эти два значения могут сильно отличаться друг от друга.</span><span class="sxs-lookup"><span data-stu-id="c5631-224">See the section "[Metrics show high AverageE2ELatency and low AverageServerLatency]" later in this guide for a discussion of why there might be a significant difference between these two values.</span></span>
* <span data-ttu-id="c5631-225">Значения в столбцах **Всего исходящих** и **Всего входящих** показывают общий объем данных (в байтах), передаваемых в службу хранилища и из нее или получаемых и отправляемых с помощью определенной операции API.</span><span class="sxs-lookup"><span data-stu-id="c5631-225">The values in the **TotalIngress** and **TotalEgress** columns show the total amount of data, in bytes, coming in to and going out of your storage service or through a specific API operation type.</span></span>
* <span data-ttu-id="c5631-226">Значения в столбце **TotalRequests** (Всего запросов) показывают общее число запросов, получаемых службой хранилища или операцией API.</span><span class="sxs-lookup"><span data-stu-id="c5631-226">The values in the **TotalRequests** column show the total number of requests that the storage service of API operation is receiving.</span></span> <span data-ttu-id="c5631-227">**TotalRequests** — это общее число запросов, которые получает служба хранилища.</span><span class="sxs-lookup"><span data-stu-id="c5631-227">**TotalRequests** is the total number of requests that the storage service receives.</span></span>

<span data-ttu-id="c5631-228">Обычно выполняется мониторинг неожиданных изменений каждого из этих значений, так как это говорит о том, что возникла проблема, требующая внимания.</span><span class="sxs-lookup"><span data-stu-id="c5631-228">Typically, you will monitor for unexpected changes in any of these values as an indicator that you have an issue that requires investigation.</span></span>

<span data-ttu-id="c5631-229">На [портале Azure](https://portal.azure.com)можно добавить правила генерации оповещений, чтобы получать уведомления, когда значение любой из метрик производительности для службы опустится ниже заданного порога.</span><span class="sxs-lookup"><span data-stu-id="c5631-229">In the [Azure portal](https://portal.azure.com), you can add alert rules to notify you if any of the performance metrics for this service fall below or exceed a threshold that you specify.</span></span>

<span data-ttu-id="c5631-230">В разделе[Рекомендации по устранению неполадок]этого руководства описаны некоторые распространенные проблемы со службой хранилища, связанные с производительностью.</span><span class="sxs-lookup"><span data-stu-id="c5631-230">The "[Troubleshooting guidance]" section of this guide describes some common storage service issues related to performance.</span></span>

## <span data-ttu-id="c5631-231"><a name="diagnosing-storage-issues"></a>Диагностика неполадок с хранилищем</span><span class="sxs-lookup"><span data-stu-id="c5631-231"><a name="diagnosing-storage-issues"></a>Diagnosing storage issues</span></span>
<span data-ttu-id="c5631-232">Понять, что в приложении возникла проблема или неполадка, можно по нескольким признакам. Вот некоторые из них:</span><span class="sxs-lookup"><span data-stu-id="c5631-232">There are a number of ways that you might become aware of a problem or issue in your application, these include:</span></span>

* <span data-ttu-id="c5631-233">серьезный сбой, который приводит к прекращению или аварийному завершению работы приложения;</span><span class="sxs-lookup"><span data-stu-id="c5631-233">A major failure that causes the application to crash or to stop working.</span></span>
* <span data-ttu-id="c5631-234">существенные отклонения от базовых значений метрик, мониторинг которых выполняется в соответствии с описанием в предыдущем разделе[Мониторинг службы хранилища];</span><span class="sxs-lookup"><span data-stu-id="c5631-234">Significant changes from baseline values in the metrics you are monitoring as described in the previous section "[Monitoring your storage service]."</span></span>
* <span data-ttu-id="c5631-235">сообщения от пользователей приложения, в которых сказано, что определенная операция не выполнена должным образом или что какая-то функция не работает;</span><span class="sxs-lookup"><span data-stu-id="c5631-235">Reports from users of your application that some particular operation didn't complete as expected or that some feature is not working.</span></span>
* <span data-ttu-id="c5631-236">ошибки, сгенерированные приложением, о которых вы узнали из файлов журналов или благодаря полученным уведомлениям.</span><span class="sxs-lookup"><span data-stu-id="c5631-236">Errors generated within your application that appear in log files or through some other notification method.</span></span>

<span data-ttu-id="c5631-237">Обычно неполадки, связанные со службами хранилища Azure, можно отнести к одной из следующих четырех обширных категорий:</span><span class="sxs-lookup"><span data-stu-id="c5631-237">Typically, issues related to Azure storage services fall into one of four broad categories:</span></span>

* <span data-ttu-id="c5631-238">в приложении возникла проблема с производительностью, о которой сообщают пользователи или свидетельствуют изменения метрик производительности;</span><span class="sxs-lookup"><span data-stu-id="c5631-238">Your application has a performance issue, either reported by your users, or revealed by changes in the performance metrics.</span></span>
* <span data-ttu-id="c5631-239">возникла проблема с инфраструктурой службы хранилища Azure в одном или нескольких регионах;</span><span class="sxs-lookup"><span data-stu-id="c5631-239">There is a problem with the Azure Storage infrastructure in one or more regions.</span></span>
* <span data-ttu-id="c5631-240">в приложении произошла ошибка, о которой сообщают пользователи или свидетельствует увеличение значения одной из отслеживаемых вами метрик, являющейся счетчиком ошибок;</span><span class="sxs-lookup"><span data-stu-id="c5631-240">Your application is encountering an error, either reported by your users, or revealed by an increase in one of the error count metrics you monitor.</span></span>
* <span data-ttu-id="c5631-241">если в ходе разработки и тестирования вы используете локальный эмулятор хранения, то могут возникать неполадки, связанные именно с этим.</span><span class="sxs-lookup"><span data-stu-id="c5631-241">During development and test, you may be using the local storage emulator; you may encounter some issues that relate specifically to usage of the storage emulator.</span></span>

<span data-ttu-id="c5631-242">В следующих разделах описаны шаги, которые нужно выполнить для диагностики и устранения неполадок, относящихся к каждой из четырех категорий.</span><span class="sxs-lookup"><span data-stu-id="c5631-242">The following sections outline the steps you should follow to diagnose and troubleshoot issues in each of these four categories.</span></span> <span data-ttu-id="c5631-243">В разделе[Рекомендации по устранению неполадок]ниже в этом руководстве содержатся подробные сведения о некоторых распространенных неполадках.</span><span class="sxs-lookup"><span data-stu-id="c5631-243">The section "[Troubleshooting guidance]" later in this guide provides more detail for some common issues you may encounter.</span></span>

### <span data-ttu-id="c5631-244"><a name="service-health-issues"></a>Проблемы с работоспособностью службы</span><span class="sxs-lookup"><span data-stu-id="c5631-244"><a name="service-health-issues"></a>Service health issues</span></span>
<span data-ttu-id="c5631-245">Чаще всего проблемы с работоспособностью службы находятся вне вашего контроля.</span><span class="sxs-lookup"><span data-stu-id="c5631-245">Service health issues are typically outside of your control.</span></span> <span data-ttu-id="c5631-246">На [портале Azure](https://portal.azure.com) содержится информация обо всех текущих неполадках со службами Azure, включая службы хранилища.</span><span class="sxs-lookup"><span data-stu-id="c5631-246">The [Azure portal](https://portal.azure.com) provides information about any ongoing issues with Azure services including storage services.</span></span> <span data-ttu-id="c5631-247">Если при создании своей учетной записи хранения вы выбрали геоизбыточное хранилище с доступом на чтение, то в ситуации, когда ваши данные будут недоступны в основном расположении, приложение сможет временно переключиться на копию, доступную только для чтения, во вторичном местоположении.</span><span class="sxs-lookup"><span data-stu-id="c5631-247">If you opted for Read-Access Geo-Redundant Storage when you created your storage account, then in the event of your data being unavailable in the primary location, your application could switch temporarily to the read-only copy in the secondary location.</span></span> <span data-ttu-id="c5631-248">Для этого у приложения должна быть возможность переключаться между основным и вторичным расположениями хранилища и работать в режиме сниженной функциональности с данными, доступными только для чтения.</span><span class="sxs-lookup"><span data-stu-id="c5631-248">To do this, your application must be able to switch between using the primary and secondary storage locations, and be able to work in a reduced functionality mode with read-only data.</span></span> <span data-ttu-id="c5631-249">С помощью клиентских библиотек службы хранилища Azure можно определить политику повтора, чтобы выполнять чтение из дополнительного хранилища, если чтение из основного хранилища завершается с ошибкой.</span><span class="sxs-lookup"><span data-stu-id="c5631-249">The Azure Storage Client libraries allow you to define a retry policy that can read from secondary storage in case a read from primary storage fails.</span></span> <span data-ttu-id="c5631-250">Приложение также должно располагать сведениями о том, что данные во вторичном местоположении согласованы в конечном счете.</span><span class="sxs-lookup"><span data-stu-id="c5631-250">Your application also needs to be aware that the data in the secondary location is eventually consistent.</span></span> <span data-ttu-id="c5631-251">Дополнительные сведения см. в записи блога [Параметры избыточности в службе хранилища Azure и геоизбыточное хранилище с доступом на чтение](https://blogs.msdn.microsoft.com/windowsazurestorage/2013/12/11/windows-azure-storage-redundancy-options-and-read-access-geo-redundant-storage/).</span><span class="sxs-lookup"><span data-stu-id="c5631-251">For more information, see the blog post [Azure Storage Redundancy Options and Read Access Geo Redundant Storage](https://blogs.msdn.microsoft.com/windowsazurestorage/2013/12/11/windows-azure-storage-redundancy-options-and-read-access-geo-redundant-storage/).</span></span>

### <span data-ttu-id="c5631-252"><a name="performance-issues"></a>Проблемы с производительностью</span><span class="sxs-lookup"><span data-stu-id="c5631-252"><a name="performance-issues"></a>Performance issues</span></span>
<span data-ttu-id="c5631-253">Производительность приложения — субъективный показатель, особенно с точки зрения пользователя.</span><span class="sxs-lookup"><span data-stu-id="c5631-253">The performance of an application can be subjective, especially from a user perspective.</span></span> <span data-ttu-id="c5631-254">В связи с этим важную роль играет наличие базовых значений метрик, которые позволяют выявлять возможные проблемы с производительностью.</span><span class="sxs-lookup"><span data-stu-id="c5631-254">Therefore, it is important to have baseline metrics available to help you identify where there might be a performance issue.</span></span> <span data-ttu-id="c5631-255">На производительность службы хранилища Azure с точки зрения клиентского приложения могут оказывать влияние многие факторы.</span><span class="sxs-lookup"><span data-stu-id="c5631-255">Many factors might affect the performance of an Azure storage service from the client application perspective.</span></span> <span data-ttu-id="c5631-256">Они могут относиться к службе хранилища, клиенту или сетевой инфраструктуре, поэтому важно сформировать стратегию, позволяющую определять источники проблем с производительностью.</span><span class="sxs-lookup"><span data-stu-id="c5631-256">These factors might operate in the storage service, in the client, or in the network infrastructure; therefore it is important to have a strategy for identifying the origin of the performance issue.</span></span>

<span data-ttu-id="c5631-257">После того как на основе метрик предположительно определено место, где возникла причина неполадки, вы можете воспользоваться подробными данными из файлов журналов для дальнейшей диагностики и устранения проблемы.</span><span class="sxs-lookup"><span data-stu-id="c5631-257">After you have identified the likely location of the cause of the performance issue from the metrics, you can then use the log files to find detailed information to diagnose and troubleshoot the problem further.</span></span>

<span data-ttu-id="c5631-258">В разделе[Рекомендации по устранению неполадок]ниже в этом руководстве содержатся дополнительные сведения о некоторых распространенных неполадках.</span><span class="sxs-lookup"><span data-stu-id="c5631-258">The section "[Troubleshooting guidance]" later in this guide provides more information about some common performance related issues you may encounter.</span></span>

### <span data-ttu-id="c5631-259"><a name="diagnosing-errors"></a>Диагностика ошибок</span><span class="sxs-lookup"><span data-stu-id="c5631-259"><a name="diagnosing-errors"></a>Diagnosing errors</span></span>
<span data-ttu-id="c5631-260">Пользователи могут уведомлять вас об ошибках, о которых сообщает клиентское приложение.</span><span class="sxs-lookup"><span data-stu-id="c5631-260">Users of your application may notify you of errors reported by the client application.</span></span> <span data-ttu-id="c5631-261">Система метрик хранилища также фиксирует количество ошибок разных типов, связанных со службами хранилища, в том числе **NetworkError** (Ошибка сети), **ClientTimeoutError** (Ошибка времени ожидания клиента) и **AuthorizationError** (Ошибка авторизации).</span><span class="sxs-lookup"><span data-stu-id="c5631-261">Storage Metrics also records counts of different error types from your storage services such as **NetworkError**, **ClientTimeoutError**, or **AuthorizationError**.</span></span> <span data-ttu-id="c5631-262">В метриках хранилища фиксируется только количество ошибок каждого типа, но вы можете получить больше данных об отдельных запросах, просмотрев журналы на стороне сервера и клиента, а также сетевой журнал.</span><span class="sxs-lookup"><span data-stu-id="c5631-262">While Storage Metrics only records counts of different error types, you can obtain more detail about individual requests by examining server-side, client-side, and network logs.</span></span> <span data-ttu-id="c5631-263">Обычно по коду состояния HTTP, возвращенному службой хранилища, можно установить причину неудачного выполнения запроса.</span><span class="sxs-lookup"><span data-stu-id="c5631-263">Typically, the HTTP status code returned by the storage service will give an indication of why the request failed.</span></span>

> [!NOTE]
> <span data-ttu-id="c5631-264">Помните, что иногда будут возникать некоторые временные ошибки. Это могут быть, например, ошибки, связанные с кратковременным нарушением работоспособности сети, или ошибки приложения.</span><span class="sxs-lookup"><span data-stu-id="c5631-264">Remember that you should expect to see some intermittent errors: for example, errors due to transient network conditions, or application errors.</span></span>
> 
> 

<span data-ttu-id="c5631-265">Чтобы подробно узнать о кодах состояний и ошибок, связанных с хранилищем, ознакомьтесь со следующими полезными ресурсами:</span><span class="sxs-lookup"><span data-stu-id="c5631-265">The following resources are useful for understanding storage-related status and error codes:</span></span>

* [<span data-ttu-id="c5631-266">Общие коды ошибок API-интерфейса REST</span><span class="sxs-lookup"><span data-stu-id="c5631-266">Common REST API Error Codes</span></span>](http://msdn.microsoft.com/library/azure/dd179357.aspx)
* [<span data-ttu-id="c5631-267">Коды ошибок службы BLOB-объектов</span><span class="sxs-lookup"><span data-stu-id="c5631-267">Blob Service Error Codes</span></span>](http://msdn.microsoft.com/library/azure/dd179439.aspx)
* [<span data-ttu-id="c5631-268">Коды ошибок службы очередей</span><span class="sxs-lookup"><span data-stu-id="c5631-268">Queue Service Error Codes</span></span>](http://msdn.microsoft.com/library/azure/dd179446.aspx)
* [<span data-ttu-id="c5631-269">Коды ошибок для службы таблиц</span><span class="sxs-lookup"><span data-stu-id="c5631-269">Table Service Error Codes</span></span>](http://msdn.microsoft.com/library/azure/dd179438.aspx)
* [<span data-ttu-id="c5631-270">Коды ошибок файловой службы</span><span class="sxs-lookup"><span data-stu-id="c5631-270">File Service Error Codes</span></span>](https://msdn.microsoft.com/library/azure/dn690119.aspx)

### <span data-ttu-id="c5631-271"><a name="storage-emulator-issues"></a>Проблемы с эмулятором хранения</span><span class="sxs-lookup"><span data-stu-id="c5631-271"><a name="storage-emulator-issues"></a>Storage emulator issues</span></span>
<span data-ttu-id="c5631-272">Пакет Azure SDK содержит эмулятор хранения, который вы можете запустить на рабочей станции, где ведется разработка.</span><span class="sxs-lookup"><span data-stu-id="c5631-272">The Azure SDK includes a storage emulator you can run on a development workstation.</span></span> <span data-ttu-id="c5631-273">Этот эмулятор почти полностью моделирует работу служб хранилища Azure и может пригодится на этапах разработки и тестирования: он позволяет запускать приложения, использующие службы хранилища Azure, без подписки Azure и учетной записи хранения Azure.</span><span class="sxs-lookup"><span data-stu-id="c5631-273">This emulator simulates most of the behavior of the Azure storage services and is useful during development and test, enabling you to run applications that use Azure storage services without the need for an Azure subscription and an Azure storage account.</span></span>

<span data-ttu-id="c5631-274">В разделе[Рекомендации по устранению неполадок]этого руководства описаны некоторые распространенные проблемы, связанные с эмулятором хранения.</span><span class="sxs-lookup"><span data-stu-id="c5631-274">The "[Troubleshooting guidance]" section of this guide describes some common issues encountered using the storage emulator.</span></span>

### <span data-ttu-id="c5631-275"><a name="storage-logging-tools"></a>Инструменты для ведения журналов хранилища</span><span class="sxs-lookup"><span data-stu-id="c5631-275"><a name="storage-logging-tools"></a>Storage logging tools</span></span>
<span data-ttu-id="c5631-276">Ведение журналов хранилища подразумевает запись в журнал на стороне сервера запросов к хранилищу в вашей учетной записи хранения Azure.</span><span class="sxs-lookup"><span data-stu-id="c5631-276">Storage Logging provides server-side logging of storage requests in your Azure storage account.</span></span> <span data-ttu-id="c5631-277">Дополнительные сведения о том, как включить ведение журнала на стороне сервера, и о доступе к данным журнала см. в статье [Enabling Storage Logging and Accessing Log Data](http://go.microsoft.com/fwlink/?LinkId=510867) (Включение ведения журнала и доступ к данным журнала хранилища).</span><span class="sxs-lookup"><span data-stu-id="c5631-277">For more information about how to enable server-side logging and access the log data, see [Enabling Storage Logging and Accessing Log Data](http://go.microsoft.com/fwlink/?LinkId=510867).</span></span>

<span data-ttu-id="c5631-278">С помощью клиентской библиотеки хранилища для .NET вы можете собирать на стороне клиента данные журнала, связанные с операциями хранилища, которые выполняются приложением.</span><span class="sxs-lookup"><span data-stu-id="c5631-278">The Storage Client Library for .NET enables you to collect client-side log data that relates to storage operations performed by your application.</span></span> <span data-ttu-id="c5631-279">Дополнительные сведения см. в статье [Client-side Logging with the .NET Storage Client Library](http://go.microsoft.com/fwlink/?LinkId=510868) (Ведение журналов на стороне клиента с помощью клиентской библиотеки хранилища для .NET).</span><span class="sxs-lookup"><span data-stu-id="c5631-279">For more information, see [Client-side Logging with the .NET Storage Client Library](http://go.microsoft.com/fwlink/?LinkId=510868).</span></span>

> [!NOTE]
> <span data-ttu-id="c5631-280">В некоторых ситуациях (например, при ошибке авторизации SAS) пользователь может сообщить об ошибке, для которой вам не удастся найти данные запроса в журналах хранилища на стороне сервера.</span><span class="sxs-lookup"><span data-stu-id="c5631-280">In some circumstances (such as SAS authorization failures), a user may report an error for which you can find no request data in the server-side Storage logs.</span></span> <span data-ttu-id="c5631-281">В таком случае воспользуйтесь возможностями ведения журналов, имеющимися в клиентской библиотеке хранилища, чтобы выяснить, не находится ли причина неполадки на стороне клиента. Кроме того, можно проверить сеть с помощью инструментов мониторинга сети.</span><span class="sxs-lookup"><span data-stu-id="c5631-281">You can use the logging capabilities of the Storage Client Library to investigate if the cause of the issue is on the client or use network monitoring tools to investigate the network.</span></span>
> 
> 

### <span data-ttu-id="c5631-282"><a name="using-network-logging-tools"></a>Использование инструментов для ведения сетевого журнала</span><span class="sxs-lookup"><span data-stu-id="c5631-282"><a name="using-network-logging-tools"></a>Using network logging tools</span></span>
<span data-ttu-id="c5631-283">Вы можете фиксировать трафик между клиентом и сервером, чтобы собирать подробные сведения о том, какими данными они обмениваются, и о текущем состоянии сети.</span><span class="sxs-lookup"><span data-stu-id="c5631-283">You can capture the traffic between the client and server to provide detailed information about the data the client and server are exchanging and the underlying network conditions.</span></span> <span data-ttu-id="c5631-284">Ниже перечислены некоторые полезные инструменты для ведения сетевого журнала.</span><span class="sxs-lookup"><span data-stu-id="c5631-284">Useful network logging tools include:</span></span>

* <span data-ttu-id="c5631-285">[Fiddler](http://www.telerik.com/fiddler) — это бесплатный веб-прокси для отладки, с помощью которого можно проверять заголовки и полезные данные HTTP- и HTTPS-запросов, а также ответных сообщений.</span><span class="sxs-lookup"><span data-stu-id="c5631-285">[Fiddler](http://www.telerik.com/fiddler) is a free web debugging proxy that enables you to examine the headers and payload data of HTTP and HTTPS request and response messages.</span></span> <span data-ttu-id="c5631-286">Дополнительные сведения см. в [приложении 1 "Отслеживание HTTP- и HTTPS-трафика с помощью Fiddler"](#appendix-1).</span><span class="sxs-lookup"><span data-stu-id="c5631-286">For more information, see [Appendix 1: Using Fiddler to capture HTTP and HTTPS traffic](#appendix-1).</span></span>
* <span data-ttu-id="c5631-287">[Microsoft Network Monitor (Netmon)](http://www.microsoft.com/download/details.aspx?id=4865) и [Wireshark](http://www.wireshark.org/) — бесплатные средства для анализа сетевых протоколов, с помощью которых можно просматривать подробную информацию о пакетах для широкого спектра сетевых протоколов.</span><span class="sxs-lookup"><span data-stu-id="c5631-287">[Microsoft Network Monitor (Netmon)](http://www.microsoft.com/download/details.aspx?id=4865) and [Wireshark](http://www.wireshark.org/) are free network protocol analyzers that enable you to view detailed packet information for a wide range of network protocols.</span></span> <span data-ttu-id="c5631-288">Дополнительные сведения о Wireshark см. в [Приложение 2. Отслеживание сетевого трафика с помощью Wireshark](#appendix-2).</span><span class="sxs-lookup"><span data-stu-id="c5631-288">For more information about Wireshark, see "[Appendix 2: Using Wireshark to capture network traffic](#appendix-2)".</span></span>
* <span data-ttu-id="c5631-289">Microsoft Message Analyzer — это средство, предлагаемое корпорацией Майкрософт в качестве замены Netmon. Оно позволяет не только собирать данные о сетевых пакетах, но и просматривать, а также анализировать информацию из журналов, созданных с помощью других инструментов.</span><span class="sxs-lookup"><span data-stu-id="c5631-289">Microsoft Message Analyzer is a tool from Microsoft that supersedes Netmon and that in addition to capturing network packet data, helps you to view and analyze the log data captured from other tools.</span></span> <span data-ttu-id="c5631-290">Дополнительные сведения см. в [приложении 3 "Отслеживание сетевого трафика с помощью Microsoft Message Analyzer"](#appendix-3).</span><span class="sxs-lookup"><span data-stu-id="c5631-290">For more information, see "[Appendix 3: Using Microsoft Message Analyzer to capture network traffic](#appendix-3)".</span></span>
* <span data-ttu-id="c5631-291">Если вы хотите выполнить базовый тест подключения, чтобы проверить, может ли клиентская машина подключиться к службе хранилища Azure по сети, этого не удастся сделать с помощью стандартного инструмента **ping** на клиенте.</span><span class="sxs-lookup"><span data-stu-id="c5631-291">If you want to perform a basic connectivity test to check that your client machine can connect to the Azure storage service over the network, you cannot do this using the standard **ping** tool on the client.</span></span> <span data-ttu-id="c5631-292">Однако вы можете воспользоваться для проверки подключения инструментом [**tcping**](http://www.elifulkerson.com/projects/tcping.php).</span><span class="sxs-lookup"><span data-stu-id="c5631-292">However, you can use the [**tcping** tool](http://www.elifulkerson.com/projects/tcping.php) to check connectivity.</span></span>

<span data-ttu-id="c5631-293">Во многих случаях данных журналов хранилища и клиентской библиотеки хранилища достаточно для диагностики проблемы, но иногда вам могут потребоваться более подробные сведения, чем способны предоставить эти инструменты.</span><span class="sxs-lookup"><span data-stu-id="c5631-293">In many cases, the log data from Storage Logging and the Storage Client Library will be sufficient to diagnose an issue, but in some scenarios, you may need the more detailed information that these network logging tools can provide.</span></span> <span data-ttu-id="c5631-294">Например, используя Fiddler для просмотра сообщений HTTP и HTTPS, вы можете видеть заголовки и полезные данные, отправленные в службы хранилища и из них. Это позволяет проверить, как работает повтор операций хранилища в клиентском приложении.</span><span class="sxs-lookup"><span data-stu-id="c5631-294">For example, using Fiddler to view HTTP and HTTPS messages enables you to view header and payload data sent to and from the storage services, which would enable you to examine how a client application retries storage operations.</span></span> <span data-ttu-id="c5631-295">Средства для анализа протоколов, такие как Wireshark, работают на уровне пакетов, благодаря чему вы можете просматривать данные TCP и выявлять потерянные пакеты и проблемы с подключением.</span><span class="sxs-lookup"><span data-stu-id="c5631-295">Protocol analyzers such as Wireshark operate at the packet level enabling you to view TCP data, which would enable you to troubleshoot lost packets and connectivity issues.</span></span> <span data-ttu-id="c5631-296">Message Analyzer может работать как на уровне HTTP, так и на уровне TCP.</span><span class="sxs-lookup"><span data-stu-id="c5631-296">Message Analyzer can operate at both HTTP and TCP layers.</span></span>

## <span data-ttu-id="c5631-297"><a name="end-to-end-tracing"></a>Комплексная трассировка</span><span class="sxs-lookup"><span data-stu-id="c5631-297"><a name="end-to-end-tracing"></a>End-to-end tracing</span></span>
<span data-ttu-id="c5631-298">Комплексная трассировка с использованием разнообразных файлов журналов — это полезный метод выявления потенциальных проблем.</span><span class="sxs-lookup"><span data-stu-id="c5631-298">End-to-end tracing using a variety of log files is a useful technique for investigating potential issues.</span></span> <span data-ttu-id="c5631-299">Чтобы указать, с какого момента нужно просматривать файлы журналов в поисках подробной информации для диагностики и устранения неполадок, вы можете воспользоваться значениями даты и времени из данных метрик.</span><span class="sxs-lookup"><span data-stu-id="c5631-299">You can use the date/time information from your metrics data as an indication of where to start looking in the log files for the detailed information that will help you troubleshoot the issue.</span></span>

### <span data-ttu-id="c5631-300"><a name="correlating-log-data"></a>Сопоставление данных журналов</span><span class="sxs-lookup"><span data-stu-id="c5631-300"><a name="correlating-log-data"></a>Correlating log data</span></span>
<span data-ttu-id="c5631-301">При просмотре журналов клиентских приложений, сетевой трассировки и журналов хранилища на стороне сервера очень важно иметь возможность сопоставлять между собой запросы из разных файлов журналов.</span><span class="sxs-lookup"><span data-stu-id="c5631-301">When viewing logs from client applications, network traces, and server-side storage logging it is critical to be able to correlate requests across the different log files.</span></span> <span data-ttu-id="c5631-302">Файлы журналов содержат некоторое количество различных полей, которые удобно использовать как идентификаторы при сопоставлении записей.</span><span class="sxs-lookup"><span data-stu-id="c5631-302">The log files include a number of different fields that are useful as correlation identifiers.</span></span> <span data-ttu-id="c5631-303">Удобнее всего сопоставлять записи в разных журналах по идентификатору запроса клиента.</span><span class="sxs-lookup"><span data-stu-id="c5631-303">The client request id is the most useful field to use to correlate entries in the different logs.</span></span> <span data-ttu-id="c5631-304">Однако иногда бывает полезно использовать идентификатор запроса сервера или метки времени.</span><span class="sxs-lookup"><span data-stu-id="c5631-304">However sometimes, it can be useful to use either the server request id or timestamps.</span></span> <span data-ttu-id="c5631-305">Эти возможности рассматриваются подробнее в следующих разделах.</span><span class="sxs-lookup"><span data-stu-id="c5631-305">The following sections provide more details about these options.</span></span>

### <span data-ttu-id="c5631-306"><a name="client-request-id"></a>Идентификатор запроса клиента</span><span class="sxs-lookup"><span data-stu-id="c5631-306"><a name="client-request-id"></a>Client request ID</span></span>
<span data-ttu-id="c5631-307">Клиентская библиотека хранилища автоматически генерирует уникальный идентификатор запроса клиента для каждого запроса.</span><span class="sxs-lookup"><span data-stu-id="c5631-307">The Storage Client Library automatically generates a unique client request id for every request.</span></span>

* <span data-ttu-id="c5631-308">В журнале на стороне клиента, создаваемом клиентской библиотекой хранилища, идентификатор запроса клиента отображается в поле **Client Request ID** (Идентификатор запроса клиента) каждой записи, относящейся к запросу.</span><span class="sxs-lookup"><span data-stu-id="c5631-308">In the client-side log that the Storage Client Library creates, the client request id appears in the **Client Request ID** field of every log entry relating to the request.</span></span>
* <span data-ttu-id="c5631-309">В данных сетевой трассировки, например выполненной с помощью Fiddler, идентификатор запроса клиента можно увидеть в сообщениях запросов. Это значение заголовка HTTP **x-ms-client-request-id**.</span><span class="sxs-lookup"><span data-stu-id="c5631-309">In a network trace such as one captured by Fiddler, the client request id is visible in request messages as the **x-ms-client-request-id** HTTP header value.</span></span>
* <span data-ttu-id="c5631-310">В журнале хранилища на стороне сервера идентификатор запроса клиента отображается в столбце Client request ID.</span><span class="sxs-lookup"><span data-stu-id="c5631-310">In the server-side Storage Logging log, the client request id appears in the Client request ID column.</span></span>

> [!NOTE]
> <span data-ttu-id="c5631-311">Возможна ситуация, когда один идентификатор запроса клиента соответствует нескольким запросам. Это связано с тем, что клиент может назначить такое значение (хотя клиентская библиотека хранилища автоматически назначает новое значение).</span><span class="sxs-lookup"><span data-stu-id="c5631-311">It is possible for multiple requests to share the same client request id because the client can assign this value (although the Storage Client Library assigns a new value automatically).</span></span> <span data-ttu-id="c5631-312">Если клиент выполняет повторные попытки, всем им присваивается один и тот же идентификатор запроса клиента.</span><span class="sxs-lookup"><span data-stu-id="c5631-312">In the case of retries from the client, all attempts share the same client request id.</span></span> <span data-ttu-id="c5631-313">Когда клиент отправляет пакет, ему присваивается один идентификатор запроса клиента.</span><span class="sxs-lookup"><span data-stu-id="c5631-313">In the case of a batch sent from the client, the batch has a single client request id.</span></span>
> 
> 

### <span data-ttu-id="c5631-314"><a name="server-request-id"></a>Идентификатор запроса сервера</span><span class="sxs-lookup"><span data-stu-id="c5631-314"><a name="server-request-id"></a>Server request ID</span></span>
<span data-ttu-id="c5631-315">Служба хранилища автоматически генерирует идентификаторы запросов сервера.</span><span class="sxs-lookup"><span data-stu-id="c5631-315">The storage service automatically generates server request ids.</span></span>

* <span data-ttu-id="c5631-316">В журнале хранилища на стороне сервера идентификатор запроса сервера отображается в столбце **Request ID header** (Заголовок идентификатора запроса).</span><span class="sxs-lookup"><span data-stu-id="c5631-316">In the server-side Storage Logging log, the server request id appears the **Request ID header** column.</span></span>
* <span data-ttu-id="c5631-317">В данных сетевой трассировки, например выполненной с помощью Fiddler, идентификатор запроса сервера можно увидеть в ответных сообщениях. Это значение заголовка HTTP **x-ms-request-id**.</span><span class="sxs-lookup"><span data-stu-id="c5631-317">In a network trace such as one captured by Fiddler, the server request id appears in response messages as the **x-ms-request-id** HTTP header value.</span></span>
* <span data-ttu-id="c5631-318">В журнале на стороне клиента, создаваемом клиентской библиотекой хранилища, идентификатор запроса сервера отображается в столбце **Operation Text** (Текст операции) записи, которая содержит подробные сведения об ответе сервера.</span><span class="sxs-lookup"><span data-stu-id="c5631-318">In the client-side log that the Storage Client Library creates, the server request id appears in the **Operation Text** column for the log entry showing details of the server response.</span></span>

> [!NOTE]
> <span data-ttu-id="c5631-319">Служба хранилища всегда назначает новый идентификатор запроса сервера каждому полученному запросу, так что каждой повторной попытке, предпринятой клиентом, и каждой операции в пакете соответствует уникальный идентификатор запроса сервера.</span><span class="sxs-lookup"><span data-stu-id="c5631-319">The storage service always assigns a unique server request id to every request it receives, so every retry attempt from the client and every operation included in a batch has a unique server request id.</span></span>
> 
> 

<span data-ttu-id="c5631-320">Если клиентская библиотека хранилища генерирует исключение **StorageException** в клиенте, то свойство **RequestInformation** содержит объект **RequestResult**, который включает в себя свойство **ServiceRequestID**.</span><span class="sxs-lookup"><span data-stu-id="c5631-320">If the Storage Client Library throws a **StorageException** in the client, the **RequestInformation** property contains a **RequestResult** object that includes a **ServiceRequestID** property.</span></span> <span data-ttu-id="c5631-321">Объект **RequestResult** также доступен в экземпляре **OperationContext**.</span><span class="sxs-lookup"><span data-stu-id="c5631-321">You can also access a **RequestResult** object from an **OperationContext** instance.</span></span>

<span data-ttu-id="c5631-322">В приведенном ниже примере кода показано, как настроить пользовательское значение **ClientRequestId**, прикрепив объект **OperationContext** к запросу к службе хранилища.</span><span class="sxs-lookup"><span data-stu-id="c5631-322">The code sample below demonstrates how to set a custom **ClientRequestId** value by attaching an **OperationContext** object the request to the storage service.</span></span> <span data-ttu-id="c5631-323">Кроме того, показано, как извлечь значение **ServerRequestId** из ответного сообщения.</span><span class="sxs-lookup"><span data-stu-id="c5631-323">It also shows how to retrieve the **ServerRequestId** value from the response message.</span></span>

```csharp
//Parse the connection string for the storage account.
const string ConnectionString = "DefaultEndpointsProtocol=https;AccountName=account-name;AccountKey=account-key";
CloudStorageAccount storageAccount = CloudStorageAccount.Parse(ConnectionString);
CloudBlobClient blobClient = storageAccount.CreateCloudBlobClient();

// Create an Operation Context that includes custom ClientRequestId string based on constants defined within the application along with a Guid.
OperationContext oc = new OperationContext();
oc.ClientRequestID = String.Format("{0} {1} {2} {3}", HOSTNAME, APPNAME, USERID, Guid.NewGuid().ToString());

try
{
    CloudBlobContainer container = blobClient.GetContainerReference("democontainer");
    ICloudBlob blob = container.GetBlobReferenceFromServer("testImage.jpg", null, null, oc);  
    var downloadToPath = string.Format("./{0}", blob.Name);
    using (var fs = File.OpenWrite(downloadToPath))
    {
        blob.DownloadToStream(fs, null, null, oc);
        Console.WriteLine("\t Blob downloaded to file: {0}", downloadToPath);
    }
}
catch (StorageException storageException)
{
    Console.WriteLine("Storage exception {0} occurred", storageException.Message);
    // Multiple results may exist due to client side retry logic - each retried operation will have a unique ServiceRequestId
    foreach (var result in oc.RequestResults)
    {
            Console.WriteLine("HttpStatus: {0}, ServiceRequestId {1}", result.HttpStatusCode, result.ServiceRequestID);
    }
}
```

### <span data-ttu-id="c5631-324"><a name="timestamps"></a>Метки времени</span><span class="sxs-lookup"><span data-stu-id="c5631-324"><a name="timestamps"></a>Timestamps</span></span>
<span data-ttu-id="c5631-325">Для поиска связанных записей в журналах можно также использовать метки времени, однако при этом нужно учитывать возможное расхождение в значениях времени между клиентом и сервером.</span><span class="sxs-lookup"><span data-stu-id="c5631-325">You can also use timestamps to locate related log entries, but be careful of any clock skew between the client and server that may exist.</span></span> <span data-ttu-id="c5631-326">Поиск соответствующих записей на стороне сервера нужно выполнять в интервале, охватывающем по 15 минут до и после метки времени на клиенте.</span><span class="sxs-lookup"><span data-stu-id="c5631-326">You should search plus or minus 15 minutes for matching server-side entries based on the timestamp on the client.</span></span> <span data-ttu-id="c5631-327">Помните, что метаданные BLOB-объектов, содержащих метрики, определяют для них временной диапазон. Это полезно, если у вас есть много BLOB-объектов с метриками, относящимися к одной минуте или часу.</span><span class="sxs-lookup"><span data-stu-id="c5631-327">Remember that the blob metadata for the blobs containing metrics indicates the time range for the metrics stored in the blob; this is useful if you have many metrics blobs for the same minute or hour.</span></span>

## <span data-ttu-id="c5631-328"><a name="troubleshooting-guidance"></a>Рекомендации по устранению неполадок</span><span class="sxs-lookup"><span data-stu-id="c5631-328"><a name="troubleshooting-guidance"></a>Troubleshooting guidance</span></span>
<span data-ttu-id="c5631-329">Сведения, приведенные в этом разделе, помогут вам диагностировать и устранять некоторые распространенные неполадки, которые могут возникнуть при работе вашего приложения со службами хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="c5631-329">This section will help you with the diagnosis and troubleshooting of some of the common issues your application may encounter when using the Azure storage services.</span></span> <span data-ttu-id="c5631-330">Чтобы найти информацию о конкретной проблеме, просмотрите список ниже.</span><span class="sxs-lookup"><span data-stu-id="c5631-330">Use the list below to locate the information relevant to your specific issue.</span></span>

<span data-ttu-id="c5631-331">**Дерево решений по устранению неполадок**</span><span class="sxs-lookup"><span data-stu-id="c5631-331">**Troubleshooting Decision Tree**</span></span>

---
<span data-ttu-id="c5631-332">Относится ли ваша проблема к производительности одной из служб хранилища?</span><span class="sxs-lookup"><span data-stu-id="c5631-332">Does your issue relate to the performance of one of the storage services?</span></span>

* <span data-ttu-id="c5631-333">[Метрики содержат высокие значения AverageE2ELatency и низкие значения AverageServerLatency]</span><span class="sxs-lookup"><span data-stu-id="c5631-333">[Metrics show high AverageE2ELatency and low AverageServerLatency]</span></span>
* <span data-ttu-id="c5631-334">[Метрики содержат низкие значения AverageE2ELatency и низкие значения AverageServerLatency, но клиент сталкивается с большой задержкой]</span><span class="sxs-lookup"><span data-stu-id="c5631-334">[Metrics show low AverageE2ELatency and low AverageServerLatency but the client is experiencing high latency]</span></span>
* <span data-ttu-id="c5631-335">[Метрики содержат высокие значения AverageServerLatency]</span><span class="sxs-lookup"><span data-stu-id="c5631-335">[Metrics show high AverageServerLatency]</span></span>
* <span data-ttu-id="c5631-336">[При доставке сообщений в очередь возникают неожиданные задержки]</span><span class="sxs-lookup"><span data-stu-id="c5631-336">[You are experiencing unexpected delays in message delivery on a queue]</span></span>

---
<span data-ttu-id="c5631-337">Связана ли неполадка с доступностью одной из служб хранилища?</span><span class="sxs-lookup"><span data-stu-id="c5631-337">Does your issue relate to the availability of one of the storage services?</span></span>

* <span data-ttu-id="c5631-338">[Метрики указывают на увеличение значения PercentThrottlingError]</span><span class="sxs-lookup"><span data-stu-id="c5631-338">[Metrics show an increase in PercentThrottlingError]</span></span>
* <span data-ttu-id="c5631-339">[Метрики указывают на увеличение значения PercentTimeoutError]</span><span class="sxs-lookup"><span data-stu-id="c5631-339">[Metrics show an increase in PercentTimeoutError]</span></span>
* <span data-ttu-id="c5631-340">[Метрики показывают увеличение значения PercentNetworkError]</span><span class="sxs-lookup"><span data-stu-id="c5631-340">[Metrics show an increase in PercentNetworkError]</span></span>

---
 <span data-ttu-id="c5631-341">Получает ли клиентское приложение ответ HTTP 4XX (например, с кодом 404) от службы хранилища?</span><span class="sxs-lookup"><span data-stu-id="c5631-341">Is your client application receiving an HTTP 4XX (such as 404) response from a storage service?</span></span>

* <span data-ttu-id="c5631-342">[Клиент получает сообщения «HTTP 403 (запрещено)»]</span><span class="sxs-lookup"><span data-stu-id="c5631-342">[The client is receiving HTTP 403 (Forbidden) messages]</span></span>
* <span data-ttu-id="c5631-343">[Клиент получает сообщения «HTTP 404 (не найдено)»]</span><span class="sxs-lookup"><span data-stu-id="c5631-343">[The client is receiving HTTP 404 (Not found) messages]</span></span>
* <span data-ttu-id="c5631-344">[Клиент получает сообщения HTTP 409 (конфликт)]</span><span class="sxs-lookup"><span data-stu-id="c5631-344">[The client is receiving HTTP 409 (Conflict) messages]</span></span>

---
<span data-ttu-id="c5631-345">[Метрики содержат низкие значения PercentSuccess, или в записях журналов аналитики присутствуют операции с состоянием транзакции ClientOtherErrors]</span><span class="sxs-lookup"><span data-stu-id="c5631-345">[Metrics show low PercentSuccess or analytics log entries have operations with transaction status of ClientOtherErrors]</span></span>

---
<span data-ttu-id="c5631-346">[Метрики объема показывают неожиданное увеличение использования объема хранилища]</span><span class="sxs-lookup"><span data-stu-id="c5631-346">[Capacity metrics show an unexpected increase in storage capacity usage]</span></span>

---
<span data-ttu-id="c5631-347">[Происходит неожиданный перезапуск виртуальных машин, имеющих большое количество виртуальных жестких дисков]</span><span class="sxs-lookup"><span data-stu-id="c5631-347">[You are experiencing unexpected reboots of Virtual Machines that have a large number of attached VHDs]</span></span>

---
<span data-ttu-id="c5631-348">[Проблема связана с использованием эмулятора хранения на этапе разработки или тестирования]</span><span class="sxs-lookup"><span data-stu-id="c5631-348">[Your issue arises from using the storage emulator for development or test]</span></span>

---
<span data-ttu-id="c5631-349">[Возникают проблемы при установке пакета SDK для Azure для .NET]</span><span class="sxs-lookup"><span data-stu-id="c5631-349">[You are encountering problems installing the Azure SDK for .NET]</span></span>

---
<span data-ttu-id="c5631-350">[Возникла другая проблема со службой хранилища]</span><span class="sxs-lookup"><span data-stu-id="c5631-350">[You have a different issue with a storage service]</span></span>

---
### <span data-ttu-id="c5631-351"><a name="metrics-show-high-AverageE2ELatency-and-low-AverageServerLatency"></a>Метрики содержат высокие значения AverageE2ELatency и низкие значения AverageServerLatency</span><span class="sxs-lookup"><span data-stu-id="c5631-351"><a name="metrics-show-high-AverageE2ELatency-and-low-AverageServerLatency"></a>Metrics show high AverageE2ELatency and low AverageServerLatency</span></span>
<span data-ttu-id="c5631-352">На приведенной ниже иллюстрации из средства мониторинга на [портале Azure](https://portal.azure.com) показана ситуация, когда значение метрики **AverageE2ELatency** значительно выше значения метрики **AverageServerLatency**.</span><span class="sxs-lookup"><span data-stu-id="c5631-352">The illustration below from the [Azure portal](https://portal.azure.com) monitoring tool shows an example where the **AverageE2ELatency** is significantly higher than the **AverageServerLatency**.</span></span>

![][4]

<span data-ttu-id="c5631-353">Обратите внимание на то, что служба хранилища рассчитывает метрику **AverageE2ELatency** только для успешно выполненных запросов. Эта метрика, в отличие от метрики **AverageServerLatency**, включает в себя время, потребовавшееся клиенту для отправки данных и получения подтверждения от службы хранилища.</span><span class="sxs-lookup"><span data-stu-id="c5631-353">Note that the storage service only calculates the metric **AverageE2ELatency** for successful requests and, unlike **AverageServerLatency**, includes the time the client takes to send the data and receive acknowledgement from the storage service.</span></span> <span data-ttu-id="c5631-354">Поэтому разница между значениями метрик **AverageE2ELatency** и **AverageServerLatency** может быть обусловлена либо медленным ответом клиентского приложения, либо состоянием сети.</span><span class="sxs-lookup"><span data-stu-id="c5631-354">Therefore, a difference between **AverageE2ELatency** and **AverageServerLatency** could be either due to the client application being slow to respond, or due to conditions on the network.</span></span>

> [!NOTE]
> <span data-ttu-id="c5631-355">Вы также можете просмотреть метрики **E2ELatency** и **ServerLatency** для отдельных операций хранилища в журнале хранилища.</span><span class="sxs-lookup"><span data-stu-id="c5631-355">You can also view **E2ELatency** and **ServerLatency** for individual storage operations in the Storage Logging log data.</span></span>
> 
> 

#### <a name="investigating-client-performance-issues"></a><span data-ttu-id="c5631-356">Изучение проблем с производительностью клиента</span><span class="sxs-lookup"><span data-stu-id="c5631-356">Investigating client performance issues</span></span>
<span data-ttu-id="c5631-357">К возможным причинам медленного ответа клиента относится ограниченное количество доступных подключений или потоков, а также нехватка ресурсов, таких как ЦП, память и пропускная способность сети.</span><span class="sxs-lookup"><span data-stu-id="c5631-357">Possible reasons for the client responding slowly include having a limited number of available connections or threads, or being low on resources such as CPU, memory or network bandwidth.</span></span> <span data-ttu-id="c5631-358">Чтобы решить эту проблему, можно изменить код клиента, повысив его эффективность (например, с помощью асинхронных вызовов службы хранилища), или использовать виртуальную машину большего размера (с большим числом ядер или объемом памяти).</span><span class="sxs-lookup"><span data-stu-id="c5631-358">You may be able to resolve the issue by modifying the client code to be more efficient (for example by using asynchronous calls to the storage service), or by using a larger Virtual Machine (with more cores and more memory).</span></span>

<span data-ttu-id="c5631-359">Для служб таблиц и очередей алгоритм Нейгла также может приводить к высокому значению метрики **AverageE2ELatency** по сравнению с метрикой **AverageServerLatency**. Дополнительные сведения см. в записи блога [Nagle’s Algorithm is Not Friendly towards Small Requests](http://blogs.msdn.com/b/windowsazurestorage/archive/2010/06/25/nagle-s-algorithm-is-not-friendly-towards-small-requests.aspx) (Алгоритм Нейгла не ориентирован на мелкие запросы).</span><span class="sxs-lookup"><span data-stu-id="c5631-359">For the table and queue services, the Nagle algorithm can also cause high **AverageE2ELatency** as compared to **AverageServerLatency**: for more information see the post [Nagle's Algorithm is Not Friendly towards Small Requests](http://blogs.msdn.com/b/windowsazurestorage/archive/2010/06/25/nagle-s-algorithm-is-not-friendly-towards-small-requests.aspx).</span></span> <span data-ttu-id="c5631-360">Вы можете отключить алгоритм Нейгла в коде с помощью класса **ServicePointManager** в пространстве имен **System.Net**.</span><span class="sxs-lookup"><span data-stu-id="c5631-360">You can disable the Nagle algorithm in code by using the **ServicePointManager** class in the **System.Net** namespace.</span></span> <span data-ttu-id="c5631-361">Это следует сделать до выполнения вызовов к службам таблиц или очередей в приложении, так как на открытые подключения это не распространяется.</span><span class="sxs-lookup"><span data-stu-id="c5631-361">You should do this before you make any calls to the table or queue services in your application since this does not affect connections that are already open.</span></span> <span data-ttu-id="c5631-362">Приведенный ниже пример взят из метода **Application_Start** в рабочей роли.</span><span class="sxs-lookup"><span data-stu-id="c5631-362">The following example comes from the **Application_Start** method in a worker role.</span></span>

```csharp
var storageAccount = CloudStorageAccount.Parse(connStr);
ServicePoint tableServicePoint = ServicePointManager.FindServicePoint(storageAccount.TableEndpoint);
tableServicePoint.UseNagleAlgorithm = false;
ServicePoint queueServicePoint = ServicePointManager.FindServicePoint(storageAccount.QueueEndpoint);
queueServicePoint.UseNagleAlgorithm = false;
```

<span data-ttu-id="c5631-363">Вы должны просмотреть журналы на стороне клиента, чтобы понять, сколько запросов отправляет приложение, а также проверить общие узкие места, связанные с производительностью .NET, в приложении. К ним относятся использование процессора, сети и памяти, а также сборка мусора .NET.</span><span class="sxs-lookup"><span data-stu-id="c5631-363">You should check the client-side logs to see how many requests your client application is submitting, and check for general .NET related performance bottlenecks in your client such as CPU, .NET garbage collection, network utilization, or memory.</span></span> <span data-ttu-id="c5631-364">В качестве отправной точки для устранения неполадок в клиентских приложениях .NET используйте статью [Debugging, Tracing, and Profiling](http://msdn.microsoft.com/library/7fe0dd2y) (Отладка, трассировка и профилирование).</span><span class="sxs-lookup"><span data-stu-id="c5631-364">As a starting point for troubleshooting .NET client applications, see [Debugging, Tracing, and Profiling](http://msdn.microsoft.com/library/7fe0dd2y).</span></span>

#### <a name="investigating-network-latency-issues"></a><span data-ttu-id="c5631-365">Изучение проблем, связанных с задержками в сети</span><span class="sxs-lookup"><span data-stu-id="c5631-365">Investigating network latency issues</span></span>
<span data-ttu-id="c5631-366">Как правило, большие задержки в сети возникают из-за временных условий.</span><span class="sxs-lookup"><span data-stu-id="c5631-366">Typically, high end-to-end latency caused by the network is due to transient conditions.</span></span> <span data-ttu-id="c5631-367">Изучить временные и постоянные неполадки сети, например потерю пакетов, можно с помощью таких средств, как Wireshark или анализатор сообщений Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="c5631-367">You can investigate both transient and persistent network issues such as dropped packets by using tools such as Wireshark or Microsoft Message Analyzer.</span></span>

<span data-ttu-id="c5631-368">Дополнительные сведения об устранении неполадок в сети с помощью Wireshark см. в [Приложение 2. Отслеживание сетевого трафика с помощью Wireshark].</span><span class="sxs-lookup"><span data-stu-id="c5631-368">For more information about using Wireshark to troubleshoot network issues, see "[Appendix 2: Using Wireshark to capture network traffic]."</span></span>

<span data-ttu-id="c5631-369">Дополнительные сведения об устранении неполадок в сети с помощью Microsoft Message Analyzer см. в [Приложение 3. Отслеживание сетевого трафика с помощью Microsoft Message Analyzer].</span><span class="sxs-lookup"><span data-stu-id="c5631-369">For more information about using Microsoft Message Analyzer to troubleshoot network issues, see "[Appendix 3: Using Microsoft Message Analyzer to capture network traffic]."</span></span>

### <span data-ttu-id="c5631-370"><a name="metrics-show-low-AverageE2ELatency-and-low-AverageServerLatency"></a>Метрики содержат низкие значения AverageE2ELatency и низкие значения AverageServerLatency, но клиент сталкивается с большой задержкой</span><span class="sxs-lookup"><span data-stu-id="c5631-370"><a name="metrics-show-low-AverageE2ELatency-and-low-AverageServerLatency"></a>Metrics show low AverageE2ELatency and low AverageServerLatency but the client is experiencing high latency</span></span>
<span data-ttu-id="c5631-371">В такой ситуации наиболее вероятной причиной является поступление запросов в службу хранилища с задержкой.</span><span class="sxs-lookup"><span data-stu-id="c5631-371">In this scenario, the most likely cause is a delay in the storage requests reaching the storage service.</span></span> <span data-ttu-id="c5631-372">Вам необходимо проанализировать, почему запросы от клиента не поступают в службу BLOB-объектов.</span><span class="sxs-lookup"><span data-stu-id="c5631-372">You should investigate why requests from the client are not making it through to the blob service.</span></span>

<span data-ttu-id="c5631-373">Одной из возможных причин задержек при отправке запросов клиентом является ограниченное количество доступных подключений или потоков.</span><span class="sxs-lookup"><span data-stu-id="c5631-373">One possible reason for the client delaying sending requests is that there are a limited number of available connections or threads.</span></span>

<span data-ttu-id="c5631-374">Также следует проверить, не выполняет ли клиент несколько повторных попыток. Если выполняет, необходимо установить причину.</span><span class="sxs-lookup"><span data-stu-id="c5631-374">You should also check whether the client is performing multiple retries, and investigate the reason if this is the case.</span></span> <span data-ttu-id="c5631-375">Проверить, выполняет ли клиент несколько повторных попыток, можно следующими способами:</span><span class="sxs-lookup"><span data-stu-id="c5631-375">To determine whether the client is performing multiple retries, you can:</span></span>

* <span data-ttu-id="c5631-376">Изучите журналы аналитики хранилища.</span><span class="sxs-lookup"><span data-stu-id="c5631-376">Examine the Storage Analytics logs.</span></span> <span data-ttu-id="c5631-377">Если выполняется сразу несколько попыток, вы увидите несколько операций с одинаковым идентификатором запроса клиента, но с разными идентификаторами запроса сервера.</span><span class="sxs-lookup"><span data-stu-id="c5631-377">If multiple retries are happening, you will see multiple operations with the same client request ID but with different server request IDs.</span></span>
* <span data-ttu-id="c5631-378">Изучите журналы клиента.</span><span class="sxs-lookup"><span data-stu-id="c5631-378">Examine the client logs.</span></span> <span data-ttu-id="c5631-379">Подробное ведение журнала позволит определить наличие повторной попытки.</span><span class="sxs-lookup"><span data-stu-id="c5631-379">Verbose logging will indicate that a retry has occurred.</span></span>
* <span data-ttu-id="c5631-380">Выполните отладку кода и проверьте свойства объекта **OperationContext** , связанного с данным запросом.</span><span class="sxs-lookup"><span data-stu-id="c5631-380">Debug your code, and check the properties of the **OperationContext** object associated with the request.</span></span> <span data-ttu-id="c5631-381">Если операция повторялась, свойство **RequestResults** будет содержать несколько уникальных идентификаторов запросов сервера.</span><span class="sxs-lookup"><span data-stu-id="c5631-381">If the operation has retried, the **RequestResults** property will include multiple unique server request IDs.</span></span> <span data-ttu-id="c5631-382">Можно также проверить время начала и окончания для каждого запроса.</span><span class="sxs-lookup"><span data-stu-id="c5631-382">You can also check the start and end times for each request.</span></span> <span data-ttu-id="c5631-383">Для получения дополнительных сведений изучите пример кода в разделе [Идентификатор запроса сервера].</span><span class="sxs-lookup"><span data-stu-id="c5631-383">For more information, see the code sample in the section [Server request ID].</span></span>

<span data-ttu-id="c5631-384">Если в клиенте неполадки не обнаружены, проверьте, нет ли проблем в сети (например, потери пакетов).</span><span class="sxs-lookup"><span data-stu-id="c5631-384">If there are no issues in the client, you should investigate potential network issues such as packet loss.</span></span> <span data-ttu-id="c5631-385">Для этого можно использовать такие средства, как Wireshark или анализатор сообщений Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="c5631-385">You can use tools such as Wireshark or Microsoft Message Analyzer to investigate network issues.</span></span>

<span data-ttu-id="c5631-386">Дополнительные сведения об устранении неполадок в сети с помощью Wireshark см. в [Приложение 2. Отслеживание сетевого трафика с помощью Wireshark].</span><span class="sxs-lookup"><span data-stu-id="c5631-386">For more information about using Wireshark to troubleshoot network issues, see "[Appendix 2: Using Wireshark to capture network traffic]."</span></span>

<span data-ttu-id="c5631-387">Дополнительные сведения об устранении неполадок в сети с помощью Microsoft Message Analyzer см. в [Приложение 3. Отслеживание сетевого трафика с помощью Microsoft Message Analyzer].</span><span class="sxs-lookup"><span data-stu-id="c5631-387">For more information about using Microsoft Message Analyzer to troubleshoot network issues, see "[Appendix 3: Using Microsoft Message Analyzer to capture network traffic]."</span></span>

### <span data-ttu-id="c5631-388"><a name="metrics-show-high-AverageServerLatency"></a>Метрики содержат высокие значения AverageServerLatency</span><span class="sxs-lookup"><span data-stu-id="c5631-388"><a name="metrics-show-high-AverageServerLatency"></a>Metrics show high AverageServerLatency</span></span>
<span data-ttu-id="c5631-389">В случае высокого значения **AverageServerLatency** для запросов на загрузку BLOB-объектов следует просмотреть журналы хранилища, чтобы проверить, нет ли повторных запросов для одного и того же BLOB-объекта (или набора BLOB-объектов).</span><span class="sxs-lookup"><span data-stu-id="c5631-389">In the case of high **AverageServerLatency** for blob download requests, you should use the Storage Logging logs to see if there are repeated requests for the same blob (or set of blobs).</span></span> <span data-ttu-id="c5631-390">Для запросов на отправку BLOB-объектов следует проверить, какой размер блоков используется в клиенте (например, блоки размером менее 64 000 могут приводить к дополнительным издержкам, если только считывание не производится фрагментами размером менее 64 000) и не отправляются ли блоки в один BLOB-объект параллельно несколькими клиентами.</span><span class="sxs-lookup"><span data-stu-id="c5631-390">For blob upload requests, you should investigate what block size the client is using (for example, blocks less than 64K in size can result in overheads unless the reads are also in less than 64K chunks), and if multiple clients are uploading blocks to the same blob in parallel.</span></span> <span data-ttu-id="c5631-391">Следует также проверить поминутные метрики, чтобы определить наличие пиковых увеличений числа запросов, которые приводят к превышению посекундных целевых показателей масштабируемости. См. также раздел [Метрики указывают на увеличение значения PercentTimeoutError].</span><span class="sxs-lookup"><span data-stu-id="c5631-391">You should also check the per-minute metrics for spikes in the number of requests that result in exceeding the per second scalability targets: also see "[Metrics show an increase in PercentTimeoutError]."</span></span>

<span data-ttu-id="c5631-392">Если высокое значение метрики **AverageServerLatency** для запросов загрузки BLOB-объектов наблюдается из-за повторяющихся запросов к одному и тому же BLOB-объекту или набору BLOB-объектов, рекомендуем кэшировать эти объекты с помощью кэша Azure или сети доставки содержимого (CDN) Azure.</span><span class="sxs-lookup"><span data-stu-id="c5631-392">If you are seeing high **AverageServerLatency** for blob download requests when there are repeated requests the same blob or set of blobs, then you should consider caching these blobs using Azure Cache or the Azure Content Delivery Network (CDN).</span></span> <span data-ttu-id="c5631-393">Для запросов отправки пропускную способность можно увеличить с помощью блоков большего размера.</span><span class="sxs-lookup"><span data-stu-id="c5631-393">For upload requests, you can improve the throughput by using a larger block size.</span></span> <span data-ttu-id="c5631-394">Для запросов к таблицам также можно реализовать кэширование на стороне клиента, если клиенты выполняют одни и те же операции запросов и если данные изменяются не часто.</span><span class="sxs-lookup"><span data-stu-id="c5631-394">For queries to tables, it is also possible to implement client-side caching on clients that perform the same query operations and where the data doesn't change frequently.</span></span>

<span data-ttu-id="c5631-395">Высокие значения метрики **AverageServerLatency** также могут быть симптомом неправильной структуры таблиц или запросов, которая приводит к выполнению операций сканирования или построена по ошибочному шаблону добавления в конец и начало.</span><span class="sxs-lookup"><span data-stu-id="c5631-395">High **AverageServerLatency** values can also be a symptom of poorly designed tables or queries that result in scan operations or that follow the append/prepend anti-pattern.</span></span> <span data-ttu-id="c5631-396">Дополнительные сведения см. в разделе [Метрики указывают на увеличение значения PercentThrottlingError].</span><span class="sxs-lookup"><span data-stu-id="c5631-396">See "[Metrics show an increase in PercentThrottlingError]" for more information.</span></span>

> [!NOTE]
> <span data-ttu-id="c5631-397">Подробный контрольный список обеспечения производительности можно найти в статье [Производительность хранилища Microsoft Azure и контрольный список масштабируемости](storage-performance-checklist.md).</span><span class="sxs-lookup"><span data-stu-id="c5631-397">You can find a comprehensive checklist performance checklist here: [Microsoft Azure Storage Performance and Scalability Checklist](storage-performance-checklist.md).</span></span>
> 
> 

### <span data-ttu-id="c5631-398"><a name="you-are-experiencing-unexpected-delays-in-message-delivery"></a>При доставке сообщений в очередь возникают неожиданные задержки</span><span class="sxs-lookup"><span data-stu-id="c5631-398"><a name="you-are-experiencing-unexpected-delays-in-message-delivery"></a>You are experiencing unexpected delays in message delivery on a queue</span></span>
<span data-ttu-id="c5631-399">Если после добавления сообщения в очередь приложением оно становится доступным для чтения из очереди с задержкой, то для диагностики этой неполадки следует выполнить указанные ниже действия.</span><span class="sxs-lookup"><span data-stu-id="c5631-399">If you are experiencing a delay between the time an application adds a message to a queue and the time it becomes available to read from the queue, then you should take the following steps to diagnose the issue:</span></span>

* <span data-ttu-id="c5631-400">Убедитесь в том, что приложение успешно добавляет сообщения в очередь.</span><span class="sxs-lookup"><span data-stu-id="c5631-400">Verify the application is successfully adding the messages to the queue.</span></span> <span data-ttu-id="c5631-401">Проверьте, не приходится ли приложению вызывать метод **AddMessage** несколько раз для добавления сообщения.</span><span class="sxs-lookup"><span data-stu-id="c5631-401">Check that the application is not retrying the **AddMessage** method several times before succeeding.</span></span> <span data-ttu-id="c5631-402">В журналах клиентской библиотеки хранилища содержатся записи о повторных попытках выполнения операций с хранилищем.</span><span class="sxs-lookup"><span data-stu-id="c5631-402">The Storage Client Library logs will show any repeated retries of storage operations.</span></span>
* <span data-ttu-id="c5631-403">Проверьте, нет ли рассинхронизации по времени между рабочей ролью, добавляющей сообщение в очередь, и рабочей ролью, считывающей сообщение из очереди. Такая рассинхронизация может восприниматься как задержка обработки.</span><span class="sxs-lookup"><span data-stu-id="c5631-403">Verify there is no clock skew between the worker role that adds the message to the queue and the worker role that reads the message from the queue that makes it appear as if there is a delay in processing.</span></span>
* <span data-ttu-id="c5631-404">Проверьте, нет ли сбоев рабочей роли, считывающей сообщения из очереди.</span><span class="sxs-lookup"><span data-stu-id="c5631-404">Check if the worker role that reads the messages from the queue is failing.</span></span> <span data-ttu-id="c5631-405">Если клиент очереди вызывает метод **GetMessage**, но ему не удается ответить подтверждением, сообщение останется в очереди и будет невидимым до тех пор, пока не истечет время **invisibilityTimeout**.</span><span class="sxs-lookup"><span data-stu-id="c5631-405">If a queue client calls the **GetMessage** method but fails to respond with an acknowledgement, the message will remain invisible on the queue until the **invisibilityTimeout** period expires.</span></span> <span data-ttu-id="c5631-406">После этого сообщение снова станет доступным для обработки.</span><span class="sxs-lookup"><span data-stu-id="c5631-406">At this point, the message becomes available for processing again.</span></span>
* <span data-ttu-id="c5631-407">Проверьте, не увеличивается ли длина очереди со временем.</span><span class="sxs-lookup"><span data-stu-id="c5631-407">Check if the queue length is growing over time.</span></span> <span data-ttu-id="c5631-408">Это может происходить из-за нехватки рабочих ролей для обработки всех сообщений, помещаемых в очередь другими рабочими ролями.</span><span class="sxs-lookup"><span data-stu-id="c5631-408">This can occur if you do not have sufficient workers available to process all of the messages that other workers are placing on the queue.</span></span> <span data-ttu-id="c5631-409">Кроме того, следует проверить метрики, чтобы установить, не происходят ли сбои при выполнении запросов удаления, а также проверить счетчик удаления сообщений из очереди, который может указывать на повторяющиеся неудачные попытки удаления сообщений.</span><span class="sxs-lookup"><span data-stu-id="c5631-409">You should also check the metrics to see if delete requests are failing and the dequeue count on messages, which might indicate repeated failed attempts to delete the message.</span></span>
* <span data-ttu-id="c5631-410">Проверьте журналы хранилища на наличие операций с очередью, имеющих неожиданно высокие значения метрик **E2ELatency** и **ServerLatency** в течение более длительного периода времени, чем обычно.</span><span class="sxs-lookup"><span data-stu-id="c5631-410">Examine the Storage Logging logs for any queue operations that have higher than expected **E2ELatency** and **ServerLatency** values over a longer period of time than usual.</span></span>

### <span data-ttu-id="c5631-411"><a name="metrics-show-an-increase-in-PercentThrottlingError"></a>Метрики показывают увеличение значения PercentThrottlingError</span><span class="sxs-lookup"><span data-stu-id="c5631-411"><a name="metrics-show-an-increase-in-PercentThrottlingError"></a>Metrics show an increase in PercentThrottlingError</span></span>
<span data-ttu-id="c5631-412">Ошибки регулирования происходят при превышении целевых показателей масштабируемости для службы хранилища.</span><span class="sxs-lookup"><span data-stu-id="c5631-412">Throttling errors occur when you exceed the scalability targets of a storage service.</span></span> <span data-ttu-id="c5631-413">Это необходимо для того, чтобы ни один из клиентов не мог использовать службу хранилища в ущерб другим.</span><span class="sxs-lookup"><span data-stu-id="c5631-413">The storage service does this to ensure that no single client or tenant can use the service at the expense of others.</span></span> <span data-ttu-id="c5631-414">Дополнительные сведения о целевых показателях масштабируемости для учетных записей хранения и целевых показателях производительности для секций внутри учетных записей хранения см. в разделе [Целевые показатели по производительности и масштабируемости для хранилища Azure](storage-scalability-targets.md).</span><span class="sxs-lookup"><span data-stu-id="c5631-414">For more information, see [Azure Storage Scalability and Performance Targets](storage-scalability-targets.md) for details on scalability targets for storage accounts and performance targets for partitions within storage accounts.</span></span>

<span data-ttu-id="c5631-415">Если метрика **PercentThrottlingError** показывает увеличение процента запросов, при выполнении которых происходят ошибки регулирования, необходимо проверить два сценария:</span><span class="sxs-lookup"><span data-stu-id="c5631-415">If the **PercentThrottlingError** metric show an increase in the percentage of requests that are failing with a throttling error, you need to investigate one of two scenarios:</span></span>

* <span data-ttu-id="c5631-416">[Временное увеличение метрики PercentThrottlingError]</span><span class="sxs-lookup"><span data-stu-id="c5631-416">[Transient increase in PercentThrottlingError]</span></span>
* <span data-ttu-id="c5631-417">[Постоянное увеличение метрики PercentThrottlingError]</span><span class="sxs-lookup"><span data-stu-id="c5631-417">[Permanent increase in PercentThrottlingError error]</span></span>

<span data-ttu-id="c5631-418">Метрика **PercentThrottlingError** часто увеличивается одновременно с увеличением числа запросов к хранилищу или при первоначальном нагрузочном тестировании приложения.</span><span class="sxs-lookup"><span data-stu-id="c5631-418">An increase in **PercentThrottlingError** often occurs at the same time as an increase in the number of storage requests, or when you are initially load testing your application.</span></span> <span data-ttu-id="c5631-419">Это также может проявляться в получении сообщений о состоянии HTTP 503 "Сервер занят" или 500 "Время ожидания операции истекло" в клиенте при операциях с хранилищем.</span><span class="sxs-lookup"><span data-stu-id="c5631-419">This may also manifest itself in the client as "503 Server Busy" or "500 Operation Timeout" HTTP status messages from storage operations.</span></span>

#### <span data-ttu-id="c5631-420"><a name="transient-increase-in-PercentThrottlingError"></a>Временное увеличение метрики PercentThrottlingError</span><span class="sxs-lookup"><span data-stu-id="c5631-420"><a name="transient-increase-in-PercentThrottlingError"></a>Transient increase in PercentThrottlingError</span></span>
<span data-ttu-id="c5631-421">Если в значении метрики **PercentThrottlingError** наблюдаются пиковые скачки, совпадающие с периодами высокой активности приложения, следует реализовать стратегию повторения с экспоненциальной, а не линейной задержкой в клиенте. Это позволит снизить мгновенную нагрузку на секцию и сгладить пиковые скачки трафика.</span><span class="sxs-lookup"><span data-stu-id="c5631-421">If you are seeing spikes in the value of **PercentThrottlingError** that coincide with periods of high activity for the application, you should implement an exponential (not linear) back off strategy for retries in your client: this will reduce the immediate load on the partition and help your application to smooth out spikes in traffic.</span></span> <span data-ttu-id="c5631-422">Дополнительные сведения о том, как реализовать политики повтора с помощью клиентской библиотеки хранилища, см. в статье [Microsoft.WindowsAzure.Storage.RetryPolicies Namespace](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.retrypolicies.aspx) (Пространство имен Microsoft.WindowsAzure.Storage.RetryPolicies).</span><span class="sxs-lookup"><span data-stu-id="c5631-422">For more information about how to implement retry policies using the Storage Client Library, see [Microsoft.WindowsAzure.Storage.RetryPolicies Namespace](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.retrypolicies.aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="c5631-423">В значении метрики **PercentThrottlingError** также могут наблюдаться пиковые скачки, не совпадающие с периодами высокой активности приложения. Наиболее вероятная причина в этом случае — перемещение секций службой хранилища для балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="c5631-423">You may also see spikes in the value of **PercentThrottlingError** that do not coincide with periods of high activity for the application: the most likely cause here is the storage service moving partitions to improve load balancing.</span></span>
> 
> 

#### <span data-ttu-id="c5631-424"><a name="permanent-increase-in-PercentThrottlingError"></a>Постоянное увеличение метрики PercentThrottlingError</span><span class="sxs-lookup"><span data-stu-id="c5631-424"><a name="permanent-increase-in-PercentThrottlingError"></a>Permanent increase in PercentThrottlingError error</span></span>
<span data-ttu-id="c5631-425">Если наблюдается стабильно высокое значение метрики **PercentThrottlingError** после постоянного увеличения объемов транзакций или при выполнении первоначального нагрузочного тестирования приложения, то нужно проанализировать, как приложение использует разделы хранилища и не достигнуты ли целевые показатели масштабируемости для учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="c5631-425">If you are seeing a consistently high value for **PercentThrottlingError** following a permanent increase in your transaction volumes, or when you are performing your initial load tests on your application, then you need to evaluate how your application is using storage partitions and whether it is approaching the scalability targets for a storage account.</span></span> <span data-ttu-id="c5631-426">Например, если возникают ошибки регулирования в очереди (которая считается одним разделом), то мы рекомендуем использовать дополнительные очереди для распределения транзакций между несколькими разделами.</span><span class="sxs-lookup"><span data-stu-id="c5631-426">For example, if you are seeing throttling errors on a queue (which counts as a single partition), then you should consider using additional queues to spread the transactions across multiple partitions.</span></span> <span data-ttu-id="c5631-427">Если ошибки регулирования возникают в таблице, следует пересмотреть схему секционирования с целью распределения транзакций между несколькими разделами благодаря большему числу значений ключей разделов.</span><span class="sxs-lookup"><span data-stu-id="c5631-427">If you are seeing throttling errors on a table, you need to consider using a different partitioning scheme to spread your transactions across multiple partitions by using a wider range of partition key values.</span></span> <span data-ttu-id="c5631-428">Распространенной причиной этой проблемы является ошибочный шаблон добавления в конец и начало, при котором в качестве ключа раздела выбирается дата, а затем все данные за определенный день записываются в один раздел. При нагрузке это может спровоцировать появление узкого места.</span><span class="sxs-lookup"><span data-stu-id="c5631-428">One common cause of this issue is the prepend/append anti-pattern where you select the date as the partition key and then all data on a particular day is written to one partition: under load, this can result in a write bottleneck.</span></span> <span data-ttu-id="c5631-429">Рекомендуем изменить схему секционирования или оценить возможность использования хранилища BLOB-объектов как более оптимального решения.</span><span class="sxs-lookup"><span data-stu-id="c5631-429">You should either consider a different partitioning design or evaluate whether using blob storage might be a better solution.</span></span> <span data-ttu-id="c5631-430">Также следует проверить, не является ли регулирование результатом пиковых скачков трафика, и попытаться оптимизировать схему запросов.</span><span class="sxs-lookup"><span data-stu-id="c5631-430">You should also check if the throttling is occurring as a result of spikes in your traffic and investigate ways of smoothing your pattern of requests.</span></span>

<span data-ttu-id="c5631-431">Если транзакции распределяются между несколькими разделами, следует тем не менее учитывать предельные значения масштабируемости, установленные для учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="c5631-431">If you distribute your transactions across multiple partitions, you must still be aware of the scalability limits set for the storage account.</span></span> <span data-ttu-id="c5631-432">Например, если используются десять очередей, каждая из которых обрабатывает максимум 2000 сообщений по 1 КБ в секунду, предельная масштабируемость для учетной записи составляет 20 000 сообщений в секунду.</span><span class="sxs-lookup"><span data-stu-id="c5631-432">For example, if you used ten queues each processing the maximum of 2,000 1KB messages per second, you will be at the overall limit of 20,000 messages per second for the storage account.</span></span> <span data-ttu-id="c5631-433">Если необходимо обрабатывать более 20 000 объектов в секунду, рекомендуем использовать несколько учетных записей хранения.</span><span class="sxs-lookup"><span data-stu-id="c5631-433">If you need to process more than 20,000 entities per second, you should consider using multiple storage accounts.</span></span> <span data-ttu-id="c5631-434">Также следует иметь в виду, что размер запросов и объектов влияет на то, когда служба хранилища начинает регулировать работу клиентов: чем больше этот размер, тем раньше может включиться регулирование.</span><span class="sxs-lookup"><span data-stu-id="c5631-434">You should also bear in mind that the size of your requests and entities has an impact on when the storage service throttles your clients: if you have larger requests and entities, you may be throttled sooner.</span></span>

<span data-ttu-id="c5631-435">Неэффективная структура запросов также может привести к достижению предельных значений масштабируемости для разделов таблицы.</span><span class="sxs-lookup"><span data-stu-id="c5631-435">Inefficient query design can also cause you to hit the scalability limits for table partitions.</span></span> <span data-ttu-id="c5631-436">Например, запросу с фильтром, выбирающим только один процент объектов в разделе, но сканирующим все объекты, потребуется обращаться к каждому объекту.</span><span class="sxs-lookup"><span data-stu-id="c5631-436">For example, a query with a filter that only selects one percent of the entities in a partition but that scans all the entities in a partition will need to access each entity.</span></span> <span data-ttu-id="c5631-437">Каждая операция чтения объекта увеличивает общее число транзакций в разделе, поэтому вы можете легко достичь целевых показателей масштабируемости.</span><span class="sxs-lookup"><span data-stu-id="c5631-437">Every entity read will count towards the total number of transactions in that partition; therefore, you can easily reach the scalability targets.</span></span>

> [!NOTE]
> <span data-ttu-id="c5631-438">Неэффективная структура запросов должна выявляться при тестировании производительности приложения.</span><span class="sxs-lookup"><span data-stu-id="c5631-438">Your performance testing should reveal any inefficient query designs in your application.</span></span>
> 
> 

### <span data-ttu-id="c5631-439"><a name="metrics-show-an-increase-in-PercentTimeoutError"></a>Метрики показывают увеличение значения PercentTimeoutError</span><span class="sxs-lookup"><span data-stu-id="c5631-439"><a name="metrics-show-an-increase-in-PercentTimeoutError"></a>Metrics show an increase in PercentTimeoutError</span></span>
<span data-ttu-id="c5631-440">Вы можете наблюдать увеличение метрики **PercentTimeoutError** для одной из служб хранилища.</span><span class="sxs-lookup"><span data-stu-id="c5631-440">Your metrics show an increase in **PercentTimeoutError** for one of your storage services.</span></span> <span data-ttu-id="c5631-441">В то же время клиент может получать большое число сообщений о состоянии HTTP 500 "Время ожидания операции истекло" при операциях с хранилищем.</span><span class="sxs-lookup"><span data-stu-id="c5631-441">At the same time, the client receives a high volume of "500 Operation Timeout" HTTP status messages from storage operations.</span></span>

> [!NOTE]
> <span data-ttu-id="c5631-442">Ошибки времени ожидания могут возникать временно, когда служба хранилища выполняет балансировку нагрузки запросов, перемещая раздел на новый сервер.</span><span class="sxs-lookup"><span data-stu-id="c5631-442">You may see timeout errors temporarily as the storage service load balances requests by moving a partition to a new server.</span></span>
> 
> 

<span data-ttu-id="c5631-443">Метрика **PercentTimeoutError** является сводной и состоит из следующих метрик: **ClientTimeoutError**, **AnonymousClientTimeoutError**, **SASClientTimeoutError**, **ServerTimeoutError**, **AnonymousServerTimeoutError** и **SASServerTimeoutError**.</span><span class="sxs-lookup"><span data-stu-id="c5631-443">The **PercentTimeoutError** metric is an aggregation of the following metrics: **ClientTimeoutError**, **AnonymousClientTimeoutError**, **SASClientTimeoutError**, **ServerTimeoutError**, **AnonymousServerTimeoutError**, and **SASServerTimeoutError**.</span></span>

<span data-ttu-id="c5631-444">Время ожидания сервера истекает из-за ошибок на сервере.</span><span class="sxs-lookup"><span data-stu-id="c5631-444">The server timeouts are caused by an error on the server.</span></span> <span data-ttu-id="c5631-445">Время ожидания клиента истекает из-за того, что при выполнении операции на сервере истекает время ожидания, установленное клиентом. Например, клиент, использующий клиентскую библиотеку хранилища, может установить время ожидания для операции с помощью свойства **ServerTimeout** класса **QueueRequestOptions**.</span><span class="sxs-lookup"><span data-stu-id="c5631-445">The client timeouts happen because an operation on the server has exceeded the timeout specified by the client; for example, a client using the Storage Client Library can set a timeout for an operation by using the **ServerTimeout** property of the **QueueRequestOptions** class.</span></span>

<span data-ttu-id="c5631-446">Ошибки времени ожидания сервера указывают на проблему со службой хранилища, которая требует дальнейшего изучения.</span><span class="sxs-lookup"><span data-stu-id="c5631-446">Server timeouts indicate a problem with the storage service that requires further investigation.</span></span> <span data-ttu-id="c5631-447">С помощью метрик вы можете определить, не достигнуты ли предельные значения масштабируемости для службы и не связана ли проблема с пиковыми скачками трафика.</span><span class="sxs-lookup"><span data-stu-id="c5631-447">You can use metrics to see if you are hitting the scalability limits for the service and to identify any spikes in traffic that might be causing this problem.</span></span> <span data-ttu-id="c5631-448">Если проблема возникает периодически, она может быть вызвана балансировкой нагрузки в службе.</span><span class="sxs-lookup"><span data-stu-id="c5631-448">If the problem is intermittent, it may be due to load-balancing activity in the service.</span></span> <span data-ttu-id="c5631-449">Если проблема существует постоянно и не вызвана достижением предельных значений масштабируемости службы в приложении, вам следует обратиться в службу поддержки.</span><span class="sxs-lookup"><span data-stu-id="c5631-449">If the problem is persistent and is not caused by your application hitting the scalability limits of the service, you should raise a support issue.</span></span> <span data-ttu-id="c5631-450">В случае ошибок времени ожидания клиента необходимо определить, правильно ли задано время ожидания в клиенте, и либо изменить это значение, либо рассмотреть возможные способы повышения производительности операций в службе хранилища, например путем оптимизации запросов к таблицам или уменьшения размера сообщений.</span><span class="sxs-lookup"><span data-stu-id="c5631-450">For client timeouts, you must decide if the timeout is set to an appropriate value in the client and either change the timeout value set in the client or investigate how you can improve the performance of the operations in the storage service, for example by optimizing your table queries or reducing the size of your messages.</span></span>

### <span data-ttu-id="c5631-451"><a name="metrics-show-an-increase-in-PercentNetworkError"></a>Метрики показывают увеличение значения PercentNetworkError</span><span class="sxs-lookup"><span data-stu-id="c5631-451"><a name="metrics-show-an-increase-in-PercentNetworkError"></a>Metrics show an increase in PercentNetworkError</span></span>
<span data-ttu-id="c5631-452">Вы можете наблюдать увеличение метрики **PercentNetworkError** для одной из служб хранилища.</span><span class="sxs-lookup"><span data-stu-id="c5631-452">Your metrics show an increase in **PercentNetworkError** for one of your storage services.</span></span> <span data-ttu-id="c5631-453">Метрика **PercentNetworkError** является сводной и состоит из следующих метрик: **NetworkError**, **AnonymousNetworkError** и **SASNetworkError**.</span><span class="sxs-lookup"><span data-stu-id="c5631-453">The **PercentNetworkError** metric is an aggregation of the following metrics: **NetworkError**, **AnonymousNetworkError**, and **SASNetworkError**.</span></span> <span data-ttu-id="c5631-454">Это происходит, когда служба хранилища обнаруживает ошибку сети при выполнении клиентом запроса к хранилищу.</span><span class="sxs-lookup"><span data-stu-id="c5631-454">These occur when the storage service detects a network error when the client makes a storage request.</span></span>

<span data-ttu-id="c5631-455">Наиболее распространенной причиной этой ошибки является отключение клиента, прежде чем в службе хранилища истекает время ожидания.</span><span class="sxs-lookup"><span data-stu-id="c5631-455">The most common cause of this error is a client disconnecting before a timeout expires in the storage service.</span></span> <span data-ttu-id="c5631-456">Изучите код клиента, чтобы понять, когда и почему клиент отключается от службы хранилища.</span><span class="sxs-lookup"><span data-stu-id="c5631-456">You should investigate the code in your client to understand why and when the client disconnects from the storage service.</span></span> <span data-ttu-id="c5631-457">Вы также можете использовать такие средства, как Wireshark, анализатор сообщений Майкрософт или Tcping, для анализа проблем с сетевым подключением клиента.</span><span class="sxs-lookup"><span data-stu-id="c5631-457">You can also use Wireshark, Microsoft Message Analyzer, or Tcping to investigate network connectivity issues from the client.</span></span> <span data-ttu-id="c5631-458">Эти средства описываются в [приложениях].</span><span class="sxs-lookup"><span data-stu-id="c5631-458">These tools are described in the [Appendices].</span></span>

### <span data-ttu-id="c5631-459"><a name="the-client-is-receiving-403-messages"></a>Клиент получает сообщения «HTTP 403 (запрещено)»</span><span class="sxs-lookup"><span data-stu-id="c5631-459"><a name="the-client-is-receiving-403-messages"></a>The client is receiving HTTP 403 (Forbidden) messages</span></span>
<span data-ttu-id="c5631-460">Если в клиентском приложении происходят ошибки HTTP 403 (Запрещено), наиболее вероятная причина заключается в использовании клиентом подписанного URL-адреса (SAS) с истекшим сроком действия при отправке запроса к хранилищу (хотя возможны и другие причины: рассинхронизация по времени, недействительные ключи и пустые заголовки).</span><span class="sxs-lookup"><span data-stu-id="c5631-460">If your client application is throwing HTTP 403 (Forbidden) errors, a likely cause is that the client is using an expired Shared Access Signature (SAS) when it sends a storage request (although other possible causes include clock skew, invalid keys, and empty headers).</span></span> <span data-ttu-id="c5631-461">Если причина в просроченном ключе SAS, в журнале хранилища на стороне сервера не будет никаких записей об этом.</span><span class="sxs-lookup"><span data-stu-id="c5631-461">If an expired SAS key is the cause, you will not see any entries in the server-side Storage Logging log data.</span></span> <span data-ttu-id="c5631-462">В приведенной ниже таблице показан пример этой неполадки в журнале на стороне клиента, созданном клиентской библиотекой хранилища.</span><span class="sxs-lookup"><span data-stu-id="c5631-462">The following table shows a sample from the client-side log generated by the Storage Client Library that illustrates this issue occurring:</span></span>

| <span data-ttu-id="c5631-463">Источник</span><span class="sxs-lookup"><span data-stu-id="c5631-463">Source</span></span> | <span data-ttu-id="c5631-464">Уровень детализации</span><span class="sxs-lookup"><span data-stu-id="c5631-464">Verbosity</span></span> | <span data-ttu-id="c5631-465">Уровень детализации</span><span class="sxs-lookup"><span data-stu-id="c5631-465">Verbosity</span></span> | <span data-ttu-id="c5631-466">Идентификатор запроса клиента</span><span class="sxs-lookup"><span data-stu-id="c5631-466">Client request id</span></span> | <span data-ttu-id="c5631-467">Operation Text</span><span class="sxs-lookup"><span data-stu-id="c5631-467">Operation text</span></span> |
| --- | --- | --- | --- | --- |
| <span data-ttu-id="c5631-468">Microsoft.WindowsAzure.Storage</span><span class="sxs-lookup"><span data-stu-id="c5631-468">Microsoft.WindowsAzure.Storage</span></span> |<span data-ttu-id="c5631-469">Информация</span><span class="sxs-lookup"><span data-stu-id="c5631-469">Information</span></span> |<span data-ttu-id="c5631-470">3</span><span class="sxs-lookup"><span data-stu-id="c5631-470">3</span></span> |<span data-ttu-id="c5631-471">85d077ab -…</span><span class="sxs-lookup"><span data-stu-id="c5631-471">85d077ab-…</span></span> |<span data-ttu-id="c5631-472">Начинается выполнение операции с расположением «Основное» в режиме расположения PrimaryOnly.</span><span class="sxs-lookup"><span data-stu-id="c5631-472">Starting operation with location Primary per location mode PrimaryOnly.</span></span> |
| <span data-ttu-id="c5631-473">Microsoft.WindowsAzure.Storage</span><span class="sxs-lookup"><span data-stu-id="c5631-473">Microsoft.WindowsAzure.Storage</span></span> |<span data-ttu-id="c5631-474">Информация</span><span class="sxs-lookup"><span data-stu-id="c5631-474">Information</span></span> |<span data-ttu-id="c5631-475">3</span><span class="sxs-lookup"><span data-stu-id="c5631-475">3</span></span> |<span data-ttu-id="c5631-476">85d077ab -…</span><span class="sxs-lookup"><span data-stu-id="c5631-476">85d077ab -…</span></span> |<span data-ttu-id="c5631-477">Начало синхронного запроса к https://domemaildist.blob.core.windows.netazureimblobcontainer/blobCreatedViaSAS.txt?sv=2014-02-14&amp;sr = c&amp;si = mypolicy&amp;sig = OFnd4Rd7z01fIvh % 2BmcR6zbudIH2F5Ikm % 2FyhNYZEmJNQ % 3D&amp;api-version = 2014-02-14.</span><span class="sxs-lookup"><span data-stu-id="c5631-477">Starting synchronous request to https://domemaildist.blob.core.windows.netazureimblobcontainer/blobCreatedViaSAS.txt?sv=2014-02-14&amp;sr=c&amp;si=mypolicy&amp;sig=OFnd4Rd7z01fIvh%2BmcR6zbudIH2F5Ikm%2FyhNYZEmJNQ%3D&amp;api-version=2014-02-14.</span></span> |
| <span data-ttu-id="c5631-478">Microsoft.WindowsAzure.Storage</span><span class="sxs-lookup"><span data-stu-id="c5631-478">Microsoft.WindowsAzure.Storage</span></span> |<span data-ttu-id="c5631-479">Информация</span><span class="sxs-lookup"><span data-stu-id="c5631-479">Information</span></span> |<span data-ttu-id="c5631-480">3</span><span class="sxs-lookup"><span data-stu-id="c5631-480">3</span></span> |<span data-ttu-id="c5631-481">85d077ab -…</span><span class="sxs-lookup"><span data-stu-id="c5631-481">85d077ab -…</span></span> |<span data-ttu-id="c5631-482">Waiting for response (Ожидание ответа).</span><span class="sxs-lookup"><span data-stu-id="c5631-482">Waiting for response.</span></span> |
| <span data-ttu-id="c5631-483">Microsoft.WindowsAzure.Storage</span><span class="sxs-lookup"><span data-stu-id="c5631-483">Microsoft.WindowsAzure.Storage</span></span> |<span data-ttu-id="c5631-484">Предупреждение</span><span class="sxs-lookup"><span data-stu-id="c5631-484">Warning</span></span> |<span data-ttu-id="c5631-485">2</span><span class="sxs-lookup"><span data-stu-id="c5631-485">2</span></span> |<span data-ttu-id="c5631-486">85d077ab -…</span><span class="sxs-lookup"><span data-stu-id="c5631-486">85d077ab -…</span></span> |<span data-ttu-id="c5631-487">При ожидании ответа возникло исключение: удаленный сервер вернул ошибку 403 (Запрещено).</span><span class="sxs-lookup"><span data-stu-id="c5631-487">Exception thrown while waiting for response: The remote server returned an error: (403) Forbidden..</span></span> |
| <span data-ttu-id="c5631-488">Microsoft.WindowsAzure.Storage</span><span class="sxs-lookup"><span data-stu-id="c5631-488">Microsoft.WindowsAzure.Storage</span></span> |<span data-ttu-id="c5631-489">Информация</span><span class="sxs-lookup"><span data-stu-id="c5631-489">Information</span></span> |<span data-ttu-id="c5631-490">3</span><span class="sxs-lookup"><span data-stu-id="c5631-490">3</span></span> |<span data-ttu-id="c5631-491">85d077ab -…</span><span class="sxs-lookup"><span data-stu-id="c5631-491">85d077ab -…</span></span> |<span data-ttu-id="c5631-492">Response received.</span><span class="sxs-lookup"><span data-stu-id="c5631-492">Response received.</span></span> <span data-ttu-id="c5631-493">Код состояния = 403; идентификатор запроса = 9d67c64a-64ed-4b0d-9515-3b14bbcdc63d; Content-MD5 = ; ETag = .</span><span class="sxs-lookup"><span data-stu-id="c5631-493">Status code = 403, Request ID = 9d67c64a-64ed-4b0d-9515-3b14bbcdc63d, Content-MD5 = , ETag = .</span></span> |
| <span data-ttu-id="c5631-494">Microsoft.WindowsAzure.Storage</span><span class="sxs-lookup"><span data-stu-id="c5631-494">Microsoft.WindowsAzure.Storage</span></span> |<span data-ttu-id="c5631-495">Предупреждение</span><span class="sxs-lookup"><span data-stu-id="c5631-495">Warning</span></span> |<span data-ttu-id="c5631-496">2</span><span class="sxs-lookup"><span data-stu-id="c5631-496">2</span></span> |<span data-ttu-id="c5631-497">85d077ab -…</span><span class="sxs-lookup"><span data-stu-id="c5631-497">85d077ab -…</span></span> |<span data-ttu-id="c5631-498">Во время операции возникло исключение: удаленный сервер вернул ошибку 403 (Запрещено).</span><span class="sxs-lookup"><span data-stu-id="c5631-498">Exception thrown during the operation: The remote server returned an error: (403) Forbidden..</span></span> |
| <span data-ttu-id="c5631-499">Microsoft.WindowsAzure.Storage</span><span class="sxs-lookup"><span data-stu-id="c5631-499">Microsoft.WindowsAzure.Storage</span></span> |<span data-ttu-id="c5631-500">Информация</span><span class="sxs-lookup"><span data-stu-id="c5631-500">Information</span></span> |<span data-ttu-id="c5631-501">3</span><span class="sxs-lookup"><span data-stu-id="c5631-501">3</span></span> |<span data-ttu-id="c5631-502">85d077ab -…</span><span class="sxs-lookup"><span data-stu-id="c5631-502">85d077ab -…</span></span> |<span data-ttu-id="c5631-503">Проверка необходимости в повторной попытке выполнения операции.</span><span class="sxs-lookup"><span data-stu-id="c5631-503">Checking if the operation should be retried.</span></span> <span data-ttu-id="c5631-504">Число повторных попыток = 0; код состояния HTTP = 403; исключение = удаленный сервер вернул ошибку 403 (Запрещено).</span><span class="sxs-lookup"><span data-stu-id="c5631-504">Retry count = 0, HTTP status code = 403, Exception = The remote server returned an error: (403) Forbidden..</span></span> |
| <span data-ttu-id="c5631-505">Microsoft.WindowsAzure.Storage</span><span class="sxs-lookup"><span data-stu-id="c5631-505">Microsoft.WindowsAzure.Storage</span></span> |<span data-ttu-id="c5631-506">Информация</span><span class="sxs-lookup"><span data-stu-id="c5631-506">Information</span></span> |<span data-ttu-id="c5631-507">3</span><span class="sxs-lookup"><span data-stu-id="c5631-507">3</span></span> |<span data-ttu-id="c5631-508">85d077ab -…</span><span class="sxs-lookup"><span data-stu-id="c5631-508">85d077ab -…</span></span> |<span data-ttu-id="c5631-509">Следующим установлено расположение «Основное» в соответствием с режимом расположения.</span><span class="sxs-lookup"><span data-stu-id="c5631-509">The next location has been set to Primary, based on the location mode.</span></span> |
| <span data-ttu-id="c5631-510">Microsoft.WindowsAzure.Storage</span><span class="sxs-lookup"><span data-stu-id="c5631-510">Microsoft.WindowsAzure.Storage</span></span> |<span data-ttu-id="c5631-511">Ошибка</span><span class="sxs-lookup"><span data-stu-id="c5631-511">Error</span></span> |<span data-ttu-id="c5631-512">1</span><span class="sxs-lookup"><span data-stu-id="c5631-512">1</span></span> |<span data-ttu-id="c5631-513">85d077ab -…</span><span class="sxs-lookup"><span data-stu-id="c5631-513">85d077ab -…</span></span> |<span data-ttu-id="c5631-514">Retry policy did not allow for a retry.</span><span class="sxs-lookup"><span data-stu-id="c5631-514">Retry policy did not allow for a retry.</span></span> <span data-ttu-id="c5631-515">Failing with The remote server returned an error: (403) Forbidden. (Политика повтора не позволила выполнить повтор. Сбой, при котором удаленный сервер вернул ошибку: (403) — запрещено.)</span><span class="sxs-lookup"><span data-stu-id="c5631-515">Failing with The remote server returned an error: (403) Forbidden.</span></span> |

<span data-ttu-id="c5631-516">В этой ситуации вам нужно разобраться, почему срок действия маркера SAS истекает, до того как клиент отправит его серверу.</span><span class="sxs-lookup"><span data-stu-id="c5631-516">In this scenario, you should investigate why the SAS token is expiring before the client sends the token to the server:</span></span>

* <span data-ttu-id="c5631-517">Обычно при создании SAS для немедленного использования клиентом вам не нужно задавать время начала.</span><span class="sxs-lookup"><span data-stu-id="c5631-517">Typically, you should not set a start time when you create a SAS for a client to use immediately.</span></span> <span data-ttu-id="c5631-518">Если между узлом, генерирующим SAS по текущему времени, и службой хранилища есть небольшая разница во времени, то может возникнуть ситуация, когда служба хранилища получает еще недействительный SAS.</span><span class="sxs-lookup"><span data-stu-id="c5631-518">If there are small clock differences between the host generating the SAS using the current time and the storage service, then it is possible for the storage service to receive a SAS that is not yet valid.</span></span>
* <span data-ttu-id="c5631-519">Не задавайте для SAS слишком короткий срок действия.</span><span class="sxs-lookup"><span data-stu-id="c5631-519">You should not set a very short expiry time on a SAS.</span></span> <span data-ttu-id="c5631-520">Небольшая разница во времени между узлом, генерирующим SAS, и службой хранилища может привести к тому, что срок действия SAS истечет раньше, чем ожидалось.</span><span class="sxs-lookup"><span data-stu-id="c5631-520">Again, small clock differences between the host generating the SAS and the storage service can lead to a SAS apparently expiring earlier than anticipated.</span></span>
* <span data-ttu-id="c5631-521">Проверьте, соответствует ли параметр версии в ключе SAS (например **sv=2015-04-05**) версии клиентской библиотеки хранилища, которую вы используете.</span><span class="sxs-lookup"><span data-stu-id="c5631-521">Does the version parameter in the SAS key (for example **sv=2015-04-05**) match the version of the Storage Client Library you are using?</span></span> <span data-ttu-id="c5631-522">Всегда используйте последнюю версию [клиентской библиотеки хранилища](https://www.nuget.org/packages/WindowsAzure.Storage/).</span><span class="sxs-lookup"><span data-stu-id="c5631-522">We recommend that you always use the latest version of the [Storage Client Library](https://www.nuget.org/packages/WindowsAzure.Storage/).</span></span>
* <span data-ttu-id="c5631-523">Повторное создание ключей доступа к хранилищу может привести к тому, что существующие токены SAS станут недействительными.</span><span class="sxs-lookup"><span data-stu-id="c5631-523">If you regenerate your storage access keys, this can invalidate any existing SAS tokens.</span></span> <span data-ttu-id="c5631-524">Если вы генерируете маркеры SAS с большим сроком действия для кэширования клиентскими приложениями, может возникнуть проблема.</span><span class="sxs-lookup"><span data-stu-id="c5631-524">This may be an issue if you generate SAS tokens with a long expiry time for client applications to cache.</span></span>

<span data-ttu-id="c5631-525">Если вы генерируете маркеры SAS с помощью клиентской библиотеки хранилища, то можете легко создать действительный маркер.</span><span class="sxs-lookup"><span data-stu-id="c5631-525">If you are using the Storage Client Library to generate SAS tokens, then it is easy to build a valid token.</span></span> <span data-ttu-id="c5631-526">Но если вы используете REST API службы хранилища и создаете токены SAS вручную, рекомендуем внимательно прочитать статью о [делегировании доступа с помощью подписанного URL-адреса](http://msdn.microsoft.com/library/azure/ee395415.aspx).</span><span class="sxs-lookup"><span data-stu-id="c5631-526">However, if you are using the Storage REST API and constructing the SAS tokens by hand you should carefully read the topic [Delegating Access with a Shared Access Signature](http://msdn.microsoft.com/library/azure/ee395415.aspx).</span></span>

### <span data-ttu-id="c5631-527"><a name="the-client-is-receiving-404-messages"></a>Клиент получает сообщения «HTTP 404 (не найдено)»</span><span class="sxs-lookup"><span data-stu-id="c5631-527"><a name="the-client-is-receiving-404-messages"></a>The client is receiving HTTP 404 (Not found) messages</span></span>
<span data-ttu-id="c5631-528">Если клиентское приложение получает от сервера сообщение HTTP 404 (не найдено), подразумевается, что объект, который приложение пытается использовать (например, субъект, таблица, BLOB-объект, контейнер или очередь), не существует в службе хранилища.</span><span class="sxs-lookup"><span data-stu-id="c5631-528">If the client application receives an HTTP 404 (Not found) message from the server, this implies that the object the client was attempting to use (such as an entity, table, blob, container, or queue) does not exist in the storage service.</span></span> <span data-ttu-id="c5631-529">Это может быть вызвано несколькими причинами, включая перечисленные ниже.</span><span class="sxs-lookup"><span data-stu-id="c5631-529">There are a number of possible reasons for this, such as:</span></span>

* <span data-ttu-id="c5631-530">[Объект удален ранее клиентом или другим процессом]</span><span class="sxs-lookup"><span data-stu-id="c5631-530">[The client or another process previously deleted the object]</span></span>
* <span data-ttu-id="c5631-531">[Проблема с авторизацией подписанного URL-адреса (SAS)]</span><span class="sxs-lookup"><span data-stu-id="c5631-531">[A Shared Access Signature (SAS) authorization issue]</span></span>
* <span data-ttu-id="c5631-532">[У кода JavaScript на стороне клиента нет разрешения на доступ к объекту]</span><span class="sxs-lookup"><span data-stu-id="c5631-532">[Client-side JavaScript code does not have permission to access the object]</span></span>
* <span data-ttu-id="c5631-533">[Сбой сети]</span><span class="sxs-lookup"><span data-stu-id="c5631-533">[Network failure]</span></span>

#### <span data-ttu-id="c5631-534"><a name="client-previously-deleted-the-object"></a>Объект удален ранее клиентом или другим процессом</span><span class="sxs-lookup"><span data-stu-id="c5631-534"><a name="client-previously-deleted-the-object"></a>The client or another process previously deleted the object</span></span>
<span data-ttu-id="c5631-535">В ситуациях, когда клиент пытается прочитать, обновить или удалить данные в службе хранилища, обычно легко найти в журналах на стороне сервера предыдущую операцию, которая привела к удалению нужного объекта из этой службы.</span><span class="sxs-lookup"><span data-stu-id="c5631-535">In scenarios where the client is attempting to read, update, or delete data in a storage service it is usually easy to identify in the server-side logs a previous operation that deleted the object in question from the storage service.</span></span> <span data-ttu-id="c5631-536">По данным журнала очень часто можно увидеть, что объект удален другим пользователем или объектом.</span><span class="sxs-lookup"><span data-stu-id="c5631-536">Very often, the log data shows that another user or process deleted the object.</span></span> <span data-ttu-id="c5631-537">В журнале хранилища на стороне сервера есть столбцы Operation-type (Тип операции) и Requested-object-key (Ключ запрошенного объекта), по которым можно понять, когда объект был удален клиентом.</span><span class="sxs-lookup"><span data-stu-id="c5631-537">In the server-side Storage Logging log, the operation-type and requested-object-key columns show when a client deleted an object.</span></span>

<span data-ttu-id="c5631-538">В случае, когда клиент пытается вставить объект, не всегда можно сразу понять, почему появляется сообщение HTTP 404 (не найдено), ведь речь идет о создании нового объекта.</span><span class="sxs-lookup"><span data-stu-id="c5631-538">In the scenario where a client is attempting to insert an object, it may not be immediately obvious why this results in an HTTP 404 (Not found) response given that the client is creating a new object.</span></span> <span data-ttu-id="c5631-539">Однако если клиент создает BLOB-объект, ему требуется найти контейнер BLOB-объектов, при создании сообщения нужно найти очередь, а при добавлении строки — таблицу.</span><span class="sxs-lookup"><span data-stu-id="c5631-539">However, if the client is creating a blob it must be able to find the blob container, if the client is creating a message it must be able to find a queue, and if the client is adding a row it must be able to find the table.</span></span>

<span data-ttu-id="c5631-540">Чтобы лучше понять, когда клиент отправляет конкретные запросы к службе хранилища, обратитесь к журналу из клиентской библиотеки хранилища на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="c5631-540">You can use the client-side log from the Storage Client Library to gain a more detailed understanding of when the client sends specific requests to the storage service.</span></span>

<span data-ttu-id="c5631-541">В приведенном ниже журнале, сгенерированном клиентской библиотекой хранилища, показана проблема, связанная с тем, что клиент не может найти контейнер для создаваемого BLOB-объекта.</span><span class="sxs-lookup"><span data-stu-id="c5631-541">The following client-side log generated by the Storage Client library illustrates the problem when the client cannot find the container for the blob it is creating.</span></span> <span data-ttu-id="c5631-542">Журнал содержит подробные данные о таких операциях хранилища:</span><span class="sxs-lookup"><span data-stu-id="c5631-542">This log includes details of the following storage operations:</span></span>

| <span data-ttu-id="c5631-543">Request ID (ИД запроса)</span><span class="sxs-lookup"><span data-stu-id="c5631-543">Request ID</span></span> | <span data-ttu-id="c5631-544">Операция</span><span class="sxs-lookup"><span data-stu-id="c5631-544">Operation</span></span> |
| --- | --- |
| <span data-ttu-id="c5631-545">07b26a5d-...</span><span class="sxs-lookup"><span data-stu-id="c5631-545">07b26a5d-...</span></span> |<span data-ttu-id="c5631-546">**DeleteIfExists** для удаления контейнера BLOB-объектов.</span><span class="sxs-lookup"><span data-stu-id="c5631-546">**DeleteIfExists** method to delete the blob container.</span></span> <span data-ttu-id="c5631-547">Обратите внимание, что эта операция включает в себя запрос **HEAD** , который проверяет существование контейнера.</span><span class="sxs-lookup"><span data-stu-id="c5631-547">Note that this operation includes a **HEAD** request to check for the existence of the container.</span></span> |
| <span data-ttu-id="c5631-548">e2d06d78-…</span><span class="sxs-lookup"><span data-stu-id="c5631-548">e2d06d78…</span></span> |<span data-ttu-id="c5631-549">**CreateIfNotExists** для создания контейнера BLOB-объектов.</span><span class="sxs-lookup"><span data-stu-id="c5631-549">**CreateIfNotExists** method to create the blob container.</span></span> <span data-ttu-id="c5631-550">Обратите внимание: эта операция включает в себя запрос **HEAD** для проверки существования контейнера.</span><span class="sxs-lookup"><span data-stu-id="c5631-550">Note that this operation includes a **HEAD** request that checks for the existence of the container.</span></span> <span data-ttu-id="c5631-551">**HEAD** возвращает сообщение 404, но работа не прерывается.</span><span class="sxs-lookup"><span data-stu-id="c5631-551">The **HEAD** returns a 404 message but continues.</span></span> |
| <span data-ttu-id="c5631-552">de8b1c3c-...</span><span class="sxs-lookup"><span data-stu-id="c5631-552">de8b1c3c-...</span></span> |<span data-ttu-id="c5631-553">**UploadFromStream** для создания BLOB-объекта.</span><span class="sxs-lookup"><span data-stu-id="c5631-553">**UploadFromStream** method to create the blob.</span></span> <span data-ttu-id="c5631-554">**PUT** завершается сбоем с сообщением 404.</span><span class="sxs-lookup"><span data-stu-id="c5631-554">The **PUT** request fails with a 404 message</span></span> |

<span data-ttu-id="c5631-555">Записи журнала:</span><span class="sxs-lookup"><span data-stu-id="c5631-555">Log entries:</span></span>

| <span data-ttu-id="c5631-556">Request ID (ИД запроса)</span><span class="sxs-lookup"><span data-stu-id="c5631-556">Request ID</span></span> | <span data-ttu-id="c5631-557">Operation Text</span><span class="sxs-lookup"><span data-stu-id="c5631-557">Operation Text</span></span> |
| --- | --- |
| <span data-ttu-id="c5631-558">07b26a5d-...</span><span class="sxs-lookup"><span data-stu-id="c5631-558">07b26a5d-...</span></span> |<span data-ttu-id="c5631-559">Отправка синхронного запроса к https://domemaildist.blob.core.windows.net/azuremmblobcontainer .</span><span class="sxs-lookup"><span data-stu-id="c5631-559">Starting synchronous request to https://domemaildist.blob.core.windows.net/azuremmblobcontainer.</span></span> |
| <span data-ttu-id="c5631-560">07b26a5d-...</span><span class="sxs-lookup"><span data-stu-id="c5631-560">07b26a5d-...</span></span> |<span data-ttu-id="c5631-561">StringToSign = HEAD............x-ms-client-request-id:07b26a5d-....x-ms-date:Tue, 03 Jun 2014 10:33:11 GMT.x-ms-version:2014-02-14./domemaildist/azuremmblobcontainer.restype:container.</span><span class="sxs-lookup"><span data-stu-id="c5631-561">StringToSign = HEAD............x-ms-client-request-id:07b26a5d-....x-ms-date:Tue, 03 Jun 2014 10:33:11 GMT.x-ms-version:2014-02-14./domemaildist/azuremmblobcontainer.restype:container.</span></span> |
| <span data-ttu-id="c5631-562">07b26a5d-...</span><span class="sxs-lookup"><span data-stu-id="c5631-562">07b26a5d-...</span></span> |<span data-ttu-id="c5631-563">Waiting for response (Ожидание ответа).</span><span class="sxs-lookup"><span data-stu-id="c5631-563">Waiting for response.</span></span> |
| <span data-ttu-id="c5631-564">07b26a5d-...</span><span class="sxs-lookup"><span data-stu-id="c5631-564">07b26a5d-...</span></span> |<span data-ttu-id="c5631-565">Response received.</span><span class="sxs-lookup"><span data-stu-id="c5631-565">Response received.</span></span> <span data-ttu-id="c5631-566">Status code = 200, Request ID = eeead849-...Content-MD5 = , ETag =    &quot;0x8D14D2DC63D059B&quot;.</span><span class="sxs-lookup"><span data-stu-id="c5631-566">Status code = 200, Request ID = eeead849-...Content-MD5 = , ETag =    &quot;0x8D14D2DC63D059B&quot;.</span></span> |
| <span data-ttu-id="c5631-567">07b26a5d-...</span><span class="sxs-lookup"><span data-stu-id="c5631-567">07b26a5d-...</span></span> |<span data-ttu-id="c5631-568">Response headers were processed successfully, proceeding with the rest of the operation (Заголовки ответа успешно обработаны, продолжается выполнение операции).</span><span class="sxs-lookup"><span data-stu-id="c5631-568">Response headers were processed successfully, proceeding with the rest of the operation.</span></span> |
| <span data-ttu-id="c5631-569">07b26a5d-...</span><span class="sxs-lookup"><span data-stu-id="c5631-569">07b26a5d-...</span></span> |<span data-ttu-id="c5631-570">Downloading response body (Загружается тело ответа).</span><span class="sxs-lookup"><span data-stu-id="c5631-570">Downloading response body.</span></span> |
| <span data-ttu-id="c5631-571">07b26a5d-...</span><span class="sxs-lookup"><span data-stu-id="c5631-571">07b26a5d-...</span></span> |<span data-ttu-id="c5631-572">Operation completed successfully (Операция выполнена успешно).</span><span class="sxs-lookup"><span data-stu-id="c5631-572">Operation completed successfully.</span></span> |
| <span data-ttu-id="c5631-573">07b26a5d-...</span><span class="sxs-lookup"><span data-stu-id="c5631-573">07b26a5d-...</span></span> |<span data-ttu-id="c5631-574">Отправка синхронного запроса к https://domemaildist.blob.core.windows.net/azuremmblobcontainer .</span><span class="sxs-lookup"><span data-stu-id="c5631-574">Starting synchronous request to https://domemaildist.blob.core.windows.net/azuremmblobcontainer.</span></span> |
| <span data-ttu-id="c5631-575">07b26a5d-...</span><span class="sxs-lookup"><span data-stu-id="c5631-575">07b26a5d-...</span></span> |<span data-ttu-id="c5631-576">StringToSign = DELETE............x-ms-client-request-id:07b26a5d-....x-ms-date:Tue, 03 Jun 2014 10:33:12    GMT.x-ms-version:2014-02-14./domemaildist/azuremmblobcontainer.restype:container.</span><span class="sxs-lookup"><span data-stu-id="c5631-576">StringToSign = DELETE............x-ms-client-request-id:07b26a5d-....x-ms-date:Tue, 03 Jun 2014 10:33:12    GMT.x-ms-version:2014-02-14./domemaildist/azuremmblobcontainer.restype:container.</span></span> |
| <span data-ttu-id="c5631-577">07b26a5d-...</span><span class="sxs-lookup"><span data-stu-id="c5631-577">07b26a5d-...</span></span> |<span data-ttu-id="c5631-578">Waiting for response (Ожидание ответа).</span><span class="sxs-lookup"><span data-stu-id="c5631-578">Waiting for response.</span></span> |
| <span data-ttu-id="c5631-579">07b26a5d-...</span><span class="sxs-lookup"><span data-stu-id="c5631-579">07b26a5d-...</span></span> |<span data-ttu-id="c5631-580">Response received.</span><span class="sxs-lookup"><span data-stu-id="c5631-580">Response received.</span></span> <span data-ttu-id="c5631-581">Status code = 202, Request ID = eeead849-...Content-MD5 = , ETag = . (Ответ получен. Код состояния = 202, ИД запроса = eeead849-...Content-MD5 = , ETag = .)</span><span class="sxs-lookup"><span data-stu-id="c5631-581">Status code = 202, Request ID = 6ab2a4cf-..., Content-MD5 = , ETag = .</span></span> |
| <span data-ttu-id="c5631-582">07b26a5d-...</span><span class="sxs-lookup"><span data-stu-id="c5631-582">07b26a5d-...</span></span> |<span data-ttu-id="c5631-583">Response headers were processed successfully, proceeding with the rest of the operation (Заголовки ответа успешно обработаны, продолжается выполнение операции).</span><span class="sxs-lookup"><span data-stu-id="c5631-583">Response headers were processed successfully, proceeding with the rest of the operation.</span></span> |
| <span data-ttu-id="c5631-584">07b26a5d-...</span><span class="sxs-lookup"><span data-stu-id="c5631-584">07b26a5d-...</span></span> |<span data-ttu-id="c5631-585">Downloading response body (Загружается тело ответа).</span><span class="sxs-lookup"><span data-stu-id="c5631-585">Downloading response body.</span></span> |
| <span data-ttu-id="c5631-586">07b26a5d-...</span><span class="sxs-lookup"><span data-stu-id="c5631-586">07b26a5d-...</span></span> |<span data-ttu-id="c5631-587">Operation completed successfully (Операция выполнена успешно).</span><span class="sxs-lookup"><span data-stu-id="c5631-587">Operation completed successfully.</span></span> |
| <span data-ttu-id="c5631-588">e2d06d78-...</span><span class="sxs-lookup"><span data-stu-id="c5631-588">e2d06d78-...</span></span> |<span data-ttu-id="c5631-589">Отправка синхронного запроса к https://domemaildist.blob.core.windows.net/azuremmblobcontainer .</span><span class="sxs-lookup"><span data-stu-id="c5631-589">Starting asynchronous request to https://domemaildist.blob.core.windows.net/azuremmblobcontainer.</span></span></td> |
| <span data-ttu-id="c5631-590">e2d06d78-...</span><span class="sxs-lookup"><span data-stu-id="c5631-590">e2d06d78-...</span></span> |<span data-ttu-id="c5631-591">StringToSign = HEAD............x-ms-client-request-id:e2d06d78-....x-ms-date:Tue, 03 Jun 2014 10:33:12 GMT.x-ms-version:2014-02-14./domemaildist/azuremmblobcontainer.restype:container.</span><span class="sxs-lookup"><span data-stu-id="c5631-591">StringToSign = HEAD............x-ms-client-request-id:e2d06d78-....x-ms-date:Tue, 03 Jun 2014 10:33:12 GMT.x-ms-version:2014-02-14./domemaildist/azuremmblobcontainer.restype:container.</span></span> |
| <span data-ttu-id="c5631-592">e2d06d78-...</span><span class="sxs-lookup"><span data-stu-id="c5631-592">e2d06d78-...</span></span> |<span data-ttu-id="c5631-593">Waiting for response (Ожидание ответа).</span><span class="sxs-lookup"><span data-stu-id="c5631-593">Waiting for response.</span></span> |
| <span data-ttu-id="c5631-594">de8b1c3c-...</span><span class="sxs-lookup"><span data-stu-id="c5631-594">de8b1c3c-...</span></span> |<span data-ttu-id="c5631-595">Отправка синхронного запроса к https://domemaildist.blob.core.windows.net/azuremmblobcontainer/blobCreated.txt</span><span class="sxs-lookup"><span data-stu-id="c5631-595">Starting synchronous request to https://domemaildist.blob.core.windows.net/azuremmblobcontainer/blobCreated.txt.</span></span> |
| <span data-ttu-id="c5631-596">de8b1c3c-...</span><span class="sxs-lookup"><span data-stu-id="c5631-596">de8b1c3c-...</span></span> |<span data-ttu-id="c5631-597">StringToSign = PUT...64.qCmF+TQLPhq/YYK50mP9ZQ==........x-ms-blob-type:BlockBlob.x-ms-client-request-id:de8b1c3c-....x-ms-date:Tue, 03 Jun 2014 10:33:12 GMT.x-ms-version:2014-02-14./domemaildist/azuremmblobcontainer/blobCreated.txt.</span><span class="sxs-lookup"><span data-stu-id="c5631-597">StringToSign = PUT...64.qCmF+TQLPhq/YYK50mP9ZQ==........x-ms-blob-type:BlockBlob.x-ms-client-request-id:de8b1c3c-....x-ms-date:Tue, 03 Jun 2014 10:33:12 GMT.x-ms-version:2014-02-14./domemaildist/azuremmblobcontainer/blobCreated.txt.</span></span> |
| <span data-ttu-id="c5631-598">de8b1c3c-...</span><span class="sxs-lookup"><span data-stu-id="c5631-598">de8b1c3c-...</span></span> |<span data-ttu-id="c5631-599">Preparing to write request data (Подготовка к записи данных запроса).</span><span class="sxs-lookup"><span data-stu-id="c5631-599">Preparing to write request data.</span></span> |
| <span data-ttu-id="c5631-600">e2d06d78-...</span><span class="sxs-lookup"><span data-stu-id="c5631-600">e2d06d78-...</span></span> |<span data-ttu-id="c5631-601">Exception thrown while waiting for response: The remote server returned an error: (404) Not Found. (Возникло исключение при ожидании ответа. Удаленный сервер вернул ошибку: (404) — не найдено.)</span><span class="sxs-lookup"><span data-stu-id="c5631-601">Exception thrown while waiting for response: The remote server returned an error: (404) Not Found..</span></span> |
| <span data-ttu-id="c5631-602">e2d06d78-...</span><span class="sxs-lookup"><span data-stu-id="c5631-602">e2d06d78-...</span></span> |<span data-ttu-id="c5631-603">Response received.</span><span class="sxs-lookup"><span data-stu-id="c5631-603">Response received.</span></span> <span data-ttu-id="c5631-604">Status code = 404, Request ID = 353ae3bc-..., Content-MD5 = , ETag = . (Ответ получен. Код состояния = 404, ИД запроса = 353ae3bc-..., Content-MD5 = , ETag = .)</span><span class="sxs-lookup"><span data-stu-id="c5631-604">Status code = 404, Request ID = 353ae3bc-..., Content-MD5 = , ETag = .</span></span> |
| <span data-ttu-id="c5631-605">e2d06d78-...</span><span class="sxs-lookup"><span data-stu-id="c5631-605">e2d06d78-...</span></span> |<span data-ttu-id="c5631-606">Response headers were processed successfully, proceeding with the rest of the operation (Заголовки ответа успешно обработаны, продолжается выполнение операции).</span><span class="sxs-lookup"><span data-stu-id="c5631-606">Response headers were processed successfully, proceeding with the rest of the operation.</span></span> |
| <span data-ttu-id="c5631-607">e2d06d78-...</span><span class="sxs-lookup"><span data-stu-id="c5631-607">e2d06d78-...</span></span> |<span data-ttu-id="c5631-608">Downloading response body (Загружается тело ответа).</span><span class="sxs-lookup"><span data-stu-id="c5631-608">Downloading response body.</span></span> |
| <span data-ttu-id="c5631-609">e2d06d78-...</span><span class="sxs-lookup"><span data-stu-id="c5631-609">e2d06d78-...</span></span> |<span data-ttu-id="c5631-610">Operation completed successfully (Операция выполнена успешно).</span><span class="sxs-lookup"><span data-stu-id="c5631-610">Operation completed successfully.</span></span> |
| <span data-ttu-id="c5631-611">e2d06d78-...</span><span class="sxs-lookup"><span data-stu-id="c5631-611">e2d06d78-...</span></span> |<span data-ttu-id="c5631-612">Отправка синхронного запроса к https://domemaildist.blob.core.windows.net/azuremmblobcontainer .</span><span class="sxs-lookup"><span data-stu-id="c5631-612">Starting asynchronous request to https://domemaildist.blob.core.windows.net/azuremmblobcontainer.</span></span> |
| <span data-ttu-id="c5631-613">e2d06d78-...</span><span class="sxs-lookup"><span data-stu-id="c5631-613">e2d06d78-...</span></span> |<span data-ttu-id="c5631-614">StringToSign = PUT...0.........x-ms-client-request-id:e2d06d78-....x-ms-date:Tue, 03 Jun 2014 10:33:12 GMT.x-ms-version:2014-02-14./domemaildist/azuremmblobcontainer.restype:container.</span><span class="sxs-lookup"><span data-stu-id="c5631-614">StringToSign = PUT...0.........x-ms-client-request-id:e2d06d78-....x-ms-date:Tue, 03 Jun 2014 10:33:12 GMT.x-ms-version:2014-02-14./domemaildist/azuremmblobcontainer.restype:container.</span></span> |
| <span data-ttu-id="c5631-615">e2d06d78-...</span><span class="sxs-lookup"><span data-stu-id="c5631-615">e2d06d78-...</span></span> |<span data-ttu-id="c5631-616">Waiting for response (Ожидание ответа).</span><span class="sxs-lookup"><span data-stu-id="c5631-616">Waiting for response.</span></span> |
| <span data-ttu-id="c5631-617">de8b1c3c-...</span><span class="sxs-lookup"><span data-stu-id="c5631-617">de8b1c3c-...</span></span> |<span data-ttu-id="c5631-618">Writing request data (Запись данных запроса).</span><span class="sxs-lookup"><span data-stu-id="c5631-618">Writing request data.</span></span> |
| <span data-ttu-id="c5631-619">de8b1c3c-...</span><span class="sxs-lookup"><span data-stu-id="c5631-619">de8b1c3c-...</span></span> |<span data-ttu-id="c5631-620">Waiting for response (Ожидание ответа).</span><span class="sxs-lookup"><span data-stu-id="c5631-620">Waiting for response.</span></span> |
| <span data-ttu-id="c5631-621">e2d06d78-...</span><span class="sxs-lookup"><span data-stu-id="c5631-621">e2d06d78-...</span></span> |<span data-ttu-id="c5631-622">Exception thrown while waiting for response: The remote server returned an error: (409) Conflict. (Возникло исключение при ожидании ответа. Удаленный сервер вернул ошибку: (409) — конфликт.)</span><span class="sxs-lookup"><span data-stu-id="c5631-622">Exception thrown while waiting for response: The remote server returned an error: (409) Conflict..</span></span> |
| <span data-ttu-id="c5631-623">e2d06d78-...</span><span class="sxs-lookup"><span data-stu-id="c5631-623">e2d06d78-...</span></span> |<span data-ttu-id="c5631-624">Response received.</span><span class="sxs-lookup"><span data-stu-id="c5631-624">Response received.</span></span> <span data-ttu-id="c5631-625">Status code = 409, Request ID = c27da20e-..., Content-MD5 = , ETag = . (Ответ получен. Код состояния = 409, ИД запроса = c27da20e-..., Content-MD5 = , ETag = .)</span><span class="sxs-lookup"><span data-stu-id="c5631-625">Status code = 409, Request ID = c27da20e-..., Content-MD5 = , ETag = .</span></span> |
| <span data-ttu-id="c5631-626">e2d06d78-...</span><span class="sxs-lookup"><span data-stu-id="c5631-626">e2d06d78-...</span></span> |<span data-ttu-id="c5631-627">Downloading error response body (Загружается тело ответа с ошибкой).</span><span class="sxs-lookup"><span data-stu-id="c5631-627">Downloading error response body.</span></span> |
| <span data-ttu-id="c5631-628">de8b1c3c-...</span><span class="sxs-lookup"><span data-stu-id="c5631-628">de8b1c3c-...</span></span> |<span data-ttu-id="c5631-629">Exception thrown while waiting for response: The remote server returned an error: (404) Not Found. (Возникло исключение при ожидании ответа. Удаленный сервер вернул ошибку: (404) — не найдено.)</span><span class="sxs-lookup"><span data-stu-id="c5631-629">Exception thrown while waiting for response: The remote server returned an error: (404) Not Found..</span></span> |
| <span data-ttu-id="c5631-630">de8b1c3c-...</span><span class="sxs-lookup"><span data-stu-id="c5631-630">de8b1c3c-...</span></span> |<span data-ttu-id="c5631-631">Response received.</span><span class="sxs-lookup"><span data-stu-id="c5631-631">Response received.</span></span> <span data-ttu-id="c5631-632">Status code = 404, Request ID = 0eaeab3e-..., Content-MD5 = , ETag = . (Ответ получен. Код состояния = 404, ИД запроса = 0eaeab3e-..., Content-MD5 = , ETag = .)</span><span class="sxs-lookup"><span data-stu-id="c5631-632">Status code = 404, Request ID = 0eaeab3e-..., Content-MD5 = , ETag = .</span></span> |
| <span data-ttu-id="c5631-633">de8b1c3c-...</span><span class="sxs-lookup"><span data-stu-id="c5631-633">de8b1c3c-...</span></span> |<span data-ttu-id="c5631-634">Exception thrown during the operation: The remote server returned an error: (404) Not Found. (Возникло исключение при выполнении операции. Удаленный сервер вернул ошибку: (404) — не найдено.)</span><span class="sxs-lookup"><span data-stu-id="c5631-634">Exception thrown during the operation: The remote server returned an error: (404) Not Found..</span></span> |
| <span data-ttu-id="c5631-635">de8b1c3c-...</span><span class="sxs-lookup"><span data-stu-id="c5631-635">de8b1c3c-...</span></span> |<span data-ttu-id="c5631-636">Retry policy did not allow for a retry.</span><span class="sxs-lookup"><span data-stu-id="c5631-636">Retry policy did not allow for a retry.</span></span> <span data-ttu-id="c5631-637">Failing with The remote server returned an error: (404) Not Found. (Политика повтора не позволила выполнить повтор. Сбой, при котором удаленный сервер вернул ошибку: (404) — не найдено.)</span><span class="sxs-lookup"><span data-stu-id="c5631-637">Failing with The remote server returned an error: (404) Not Found..</span></span> |
| <span data-ttu-id="c5631-638">e2d06d78-...</span><span class="sxs-lookup"><span data-stu-id="c5631-638">e2d06d78-...</span></span> |<span data-ttu-id="c5631-639">Retry policy did not allow for a retry.</span><span class="sxs-lookup"><span data-stu-id="c5631-639">Retry policy did not allow for a retry.</span></span> <span data-ttu-id="c5631-640">Failing with The remote server returned an error: (409) Conflict. (Политика повтора не позволила выполнить повтор. Сбой, при котором удаленный сервер вернул ошибку: (409) — конфликт.)</span><span class="sxs-lookup"><span data-stu-id="c5631-640">Failing with The remote server returned an error: (409) Conflict..</span></span> |

<span data-ttu-id="c5631-641">В этом примере из записей журнала видно, что клиент чередует запросы от метода **CreateIfNotExists** (идентификатор запроса — e2d06d78…) с запросами от метода **UploadFromStream** (de8b1c3c-...). Это происходит потому, что клиентское приложение вызывает эти методы асинхронно.</span><span class="sxs-lookup"><span data-stu-id="c5631-641">In this example, the log shows that the client is interleaving requests from the **CreateIfNotExists** method (request id e2d06d78…) with the requests from the **UploadFromStream** method (de8b1c3c-...); this is happening because the client application is invoking these methods asynchronously.</span></span> <span data-ttu-id="c5631-642">Вы должны изменить код с асинхронными вызовами в клиенте таким образом, чтобы он создавал контейнер до того, как попытается передать какие-либо данные в BLOB-объект в этом контейнере.</span><span class="sxs-lookup"><span data-stu-id="c5631-642">You should modify the asynchronous code in the client to ensure that it creates the container before attempting to upload any data to a blob in that container.</span></span> <span data-ttu-id="c5631-643">В идеале нужно создавать все контейнеры заранее.</span><span class="sxs-lookup"><span data-stu-id="c5631-643">Ideally, you should create all your containers in advance.</span></span>

#### <span data-ttu-id="c5631-644"><a name="SAS-authorization-issue"></a>Проблема с авторизацией подписанного URL-адреса (SAS)</span><span class="sxs-lookup"><span data-stu-id="c5631-644"><a name="SAS-authorization-issue"></a>A Shared Access Signature (SAS) authorization issue</span></span>
<span data-ttu-id="c5631-645">Если клиентское приложение пытается использовать ключ SAS, который не содержит необходимых разрешений для операции, служба хранилища возвращает клиенту сообщение HTTP 404 (не найдено).</span><span class="sxs-lookup"><span data-stu-id="c5631-645">If the client application attempts to use a SAS key that does not include the necessary permissions for the operation, the storage service returns an HTTP 404 (Not found) message to the client.</span></span> <span data-ttu-id="c5631-646">В то же время вы увидите в метриках ненулевое значение **SASAuthorizationError** (Ошибка авторизации SAS).</span><span class="sxs-lookup"><span data-stu-id="c5631-646">At the same time, you will also see a non-zero value for **SASAuthorizationError** in the metrics.</span></span>

<span data-ttu-id="c5631-647">В этой таблице показан пример сообщения журнала на стороне сервера из файла журнала хранилища:</span><span class="sxs-lookup"><span data-stu-id="c5631-647">The following table shows a sample server-side log message from the Storage Logging log file:</span></span>

| <span data-ttu-id="c5631-648">Имя</span><span class="sxs-lookup"><span data-stu-id="c5631-648">Name</span></span> | <span data-ttu-id="c5631-649">Значение</span><span class="sxs-lookup"><span data-stu-id="c5631-649">Value</span></span> |
| --- | --- |
| <span data-ttu-id="c5631-650">Request start time (Время начала запроса)</span><span class="sxs-lookup"><span data-stu-id="c5631-650">Request start time</span></span> | <span data-ttu-id="c5631-651">2014-05-30T06:17:48.4473697Z</span><span class="sxs-lookup"><span data-stu-id="c5631-651">2014-05-30T06:17:48.4473697Z</span></span> |
| <span data-ttu-id="c5631-652">Operation type (Тип операции)</span><span class="sxs-lookup"><span data-stu-id="c5631-652">Operation type</span></span>     | <span data-ttu-id="c5631-653">GetBlobProperties</span><span class="sxs-lookup"><span data-stu-id="c5631-653">GetBlobProperties</span></span>            |
| <span data-ttu-id="c5631-654">Request status (Состояние запроса)</span><span class="sxs-lookup"><span data-stu-id="c5631-654">Request status</span></span>     | <span data-ttu-id="c5631-655">SASAuthorizationError</span><span class="sxs-lookup"><span data-stu-id="c5631-655">SASAuthorizationError</span></span>        |
| <span data-ttu-id="c5631-656">HTTP status code (Код состояния HTTP)</span><span class="sxs-lookup"><span data-stu-id="c5631-656">HTTP status code</span></span>   | <span data-ttu-id="c5631-657">404</span><span class="sxs-lookup"><span data-stu-id="c5631-657">404</span></span>                          |
| <span data-ttu-id="c5631-658">Authentication type (Тип проверки подлинности)</span><span class="sxs-lookup"><span data-stu-id="c5631-658">Authentication type</span></span>| <span data-ttu-id="c5631-659">SAS</span><span class="sxs-lookup"><span data-stu-id="c5631-659">Sas</span></span>                          |
| <span data-ttu-id="c5631-660">Service type (Тип службы)</span><span class="sxs-lookup"><span data-stu-id="c5631-660">Service type</span></span>       | <span data-ttu-id="c5631-661">BLOB-объект</span><span class="sxs-lookup"><span data-stu-id="c5631-661">Blob</span></span>                         |
| <span data-ttu-id="c5631-662">Request URL (URL-адрес запроса)</span><span class="sxs-lookup"><span data-stu-id="c5631-662">Request URL</span></span>        | <span data-ttu-id="c5631-663">https://domemaildist.blob.core.windows.net/azureimblobcontainer/blobCreatedViaSAS.txt</span><span class="sxs-lookup"><span data-stu-id="c5631-663">https://domemaildist.blob.core.windows.net/azureimblobcontainer/blobCreatedViaSAS.txt</span></span> |
| <span data-ttu-id="c5631-664">nbsp;</span><span class="sxs-lookup"><span data-stu-id="c5631-664">nbsp;</span></span>              |   <span data-ttu-id="c5631-665">?sv=2014-02-14&sr=c&si=mypolicy&sig=XXXXX&;api-version=2014-02-14</span><span class="sxs-lookup"><span data-stu-id="c5631-665">?sv=2014-02-14&sr=c&si=mypolicy&sig=XXXXX&;api-version=2014-02-14</span></span> |
| <span data-ttu-id="c5631-666">Request ID header</span><span class="sxs-lookup"><span data-stu-id="c5631-666">Request id header</span></span>  | <span data-ttu-id="c5631-667">a1f348d5-8032-4912-93ef-b393e5252a3b</span><span class="sxs-lookup"><span data-stu-id="c5631-667">a1f348d5-8032-4912-93ef-b393e5252a3b</span></span> |
| <span data-ttu-id="c5631-668">Идентификатор запроса клиента</span><span class="sxs-lookup"><span data-stu-id="c5631-668">Client request ID</span></span>  | <span data-ttu-id="c5631-669">2d064953-8436-4ee0-aa0c-65cb874f7929</span><span class="sxs-lookup"><span data-stu-id="c5631-669">2d064953-8436-4ee0-aa0c-65cb874f7929</span></span> |


<span data-ttu-id="c5631-670">Вам нужно найти причину того, что клиентское приложение пытается выполнить операцию, для которой ему не предоставлены разрешения.</span><span class="sxs-lookup"><span data-stu-id="c5631-670">You should investigate why your client application is attempting to perform an operation it has not been granted permissions for.</span></span>

#### <span data-ttu-id="c5631-671"><a name="JavaScript-code-does-not-have-permission"></a>У кода JavaScript на стороне клиента нет разрешения на доступ к объекту</span><span class="sxs-lookup"><span data-stu-id="c5631-671"><a name="JavaScript-code-does-not-have-permission"></a>Client-side JavaScript code does not have permission to access the object</span></span>
<span data-ttu-id="c5631-672">Если вы используете клиент JavaScript и служба хранилища возвращает сообщения HTTP 404, проверьте в браузере, нет ли следующих ошибок JavaScript:</span><span class="sxs-lookup"><span data-stu-id="c5631-672">If you are using a JavaScript client and the storage service is returning HTTP 404 messages, you check for the following JavaScript errors in the browser:</span></span>

```
SEC7120: Origin http://localhost:56309 not found in Access-Control-Allow-Origin header.
SCRIPT7002: XMLHttpRequest: Network Error 0x80070005, Access is denied.
```

> [!NOTE]
> <span data-ttu-id="c5631-673">При диагностике и устранении неполадок на стороне клиента JavaScript вы можете воспользоваться средствами разработчика F12 в Internet Explorer для трассировки сообщений, которыми обмениваются браузер и служба хранилища.</span><span class="sxs-lookup"><span data-stu-id="c5631-673">You can use the F12 Developer Tools in Internet Explorer to trace the messages exchanged between the browser and the storage service when you are troubleshooting client-side JavaScript issues.</span></span>
> 
> 

<span data-ttu-id="c5631-674">Эти ошибки появляются из-за того, что браузер применяет ограничение безопасности по [принципу одинакового источника](http://www.w3.org/Security/wiki/Same_Origin_Policy) , в связи с чем веб-страница не может вызвать API ни из каких других доменов, кроме собственного.</span><span class="sxs-lookup"><span data-stu-id="c5631-674">These errors occur because the web browser implements the [same origin policy](http://www.w3.org/Security/wiki/Same_Origin_Policy) security restriction that prevents a web page from calling an API in a different domain from the domain the page comes from.</span></span>

<span data-ttu-id="c5631-675">Чтобы решить эту проблему JavaScript обходным путем, вы можете настроить для службы хранилища, к которой обращается клиент, общий доступ к ресурсам независимо от источника (CORS).</span><span class="sxs-lookup"><span data-stu-id="c5631-675">To work around the JavaScript issue, you can configure Cross Origin Resource Sharing (CORS) for the storage service the client is accessing.</span></span> <span data-ttu-id="c5631-676">Дополнительные сведения см. в статье [Cross-Origin Resource Sharing (CORS) Support for Azure Storage Services](http://msdn.microsoft.com/library/azure/dn535601.aspx) (Поддержка общего доступа к ресурсам независимо от источника (CORS) для служб хранилища Azure).</span><span class="sxs-lookup"><span data-stu-id="c5631-676">For more information, see [Cross-Origin Resource Sharing (CORS) Support for Azure Storage Services](http://msdn.microsoft.com/library/azure/dn535601.aspx).</span></span>

<span data-ttu-id="c5631-677">В этом примере кода показано, как настроить службу BLOB-объектов, чтобы разрешить работу приложения JavaScript в домене Contoso для получения доступа к хранящемуся в ней BLOB-объекту:</span><span class="sxs-lookup"><span data-stu-id="c5631-677">The following code sample shows how to configure your blob service to allow JavaScript running in the Contoso domain to access a blob in your blob storage service:</span></span>

```csharp
CloudBlobClient client = new CloudBlobClient(blobEndpoint, new StorageCredentials(accountName, accountKey));
// Set the service properties.
ServiceProperties sp = client.GetServiceProperties();
sp.DefaultServiceVersion = "2013-08-15";
CorsRule cr = new CorsRule();
cr.AllowedHeaders.Add("*");
cr.AllowedMethods = CorsHttpMethods.Get | CorsHttpMethods.Put;
cr.AllowedOrigins.Add("http://www.contoso.com");
cr.ExposedHeaders.Add("x-ms-*");
cr.MaxAgeInSeconds = 5;
sp.Cors.CorsRules.Clear();
sp.Cors.CorsRules.Add(cr);
client.SetServiceProperties(sp);
```

#### <span data-ttu-id="c5631-678"><a name="network-failure"></a>Сбой сети</span><span class="sxs-lookup"><span data-stu-id="c5631-678"><a name="network-failure"></a>Network Failure</span></span>
<span data-ttu-id="c5631-679">В некоторых обстоятельствах потеря сетевых пакетов может привести к тому, что служба хранилища будет возвращать клиенту сообщения HTTP 404.</span><span class="sxs-lookup"><span data-stu-id="c5631-679">In some circumstances, lost network packets can lead to the storage service returning HTTP 404 messages to the client.</span></span> <span data-ttu-id="c5631-680">Например, когда клиентское приложение удаляет субъект из службы таблиц, это вызывает исключение хранилища и вы увидите сообщение о состоянии HTTP 404 (не найдено) от службы таблиц.</span><span class="sxs-lookup"><span data-stu-id="c5631-680">For example, when your client application is deleting an entity from the table service you see the client throw a storage exception reporting an "HTTP 404 (Not Found)" status message from the table service.</span></span> <span data-ttu-id="c5631-681">Если вы посмотрите на таблицу в службе таблиц, то поймете, что субъект удален в соответствии с запросом.</span><span class="sxs-lookup"><span data-stu-id="c5631-681">When you investigate the table in the table storage service, you see that the service did delete the entity as requested.</span></span>

<span data-ttu-id="c5631-682">Данные об исключении в клиенте содержат идентификатор запроса (7e84f12d…), назначенный запросу службой таблиц. С помощью этой информации вы можете найти подробные данные запроса в журналах хранилища на стороне сервера. Для этого нужно выполнить поиск в столбце **request-id-header** в файле журнала.</span><span class="sxs-lookup"><span data-stu-id="c5631-682">The exception details in the client include the request id (7e84f12d…) assigned by the table service for the request: you can use this information to locate the request details in the server-side storage logs by searching in the **request-id-header** column in the log file.</span></span> <span data-ttu-id="c5631-683">Кроме того, можно проверить метрики для того, чтобы выяснить, когда возникают такие ошибки, а затем выполнить поиск в файлах журналов по зафиксированному в метриках времени.</span><span class="sxs-lookup"><span data-stu-id="c5631-683">You could also use the metrics to identify when failures such as this occur and then search the log files based on the time the metrics recorded this error.</span></span> <span data-ttu-id="c5631-684">Эта запись журнала указывает на то, что удаление не выполнено и возвращено сообщение о состоянии HTTP (404) Client Other Error (Другая ошибка клиента).</span><span class="sxs-lookup"><span data-stu-id="c5631-684">This log entry shows that the delete failed with an "HTTP (404) Client Other Error" status message.</span></span> <span data-ttu-id="c5631-685">Она также содержит в столбце **client-request-id** (Идентификатор запроса клиента) идентификатор запроса, сгенерированный клиентом (813ea74f…).</span><span class="sxs-lookup"><span data-stu-id="c5631-685">The same log entry also includes the request id generated by the client in the **client-request-id** column (813ea74f…).</span></span>

<span data-ttu-id="c5631-686">В журнале на стороне сервера есть еще одна запись с тем же значением **client-request-id** (813ea74f…), которая соответствует успешной операции удаления того же субъекта по запросу от того же клиента.</span><span class="sxs-lookup"><span data-stu-id="c5631-686">The server-side log also includes another entry with the same **client-request-id** value (813ea74f…) for a successful delete operation for the same entity, and from the same client.</span></span> <span data-ttu-id="c5631-687">Успешная операция удаления была выполнена непосредственно перед тем, как запрос на удаление завершился с ошибкой.</span><span class="sxs-lookup"><span data-stu-id="c5631-687">This successful delete operation took place very shortly before the failed delete request.</span></span>

<span data-ttu-id="c5631-688">В этом случае наиболее вероятная причина проблемы состоит в том, что клиент отправил в службу таблиц запрос на удаление субъекта, выполненный успешно, но не получил подтверждения от сервера (возможно, из-за временной неполадки в сети).</span><span class="sxs-lookup"><span data-stu-id="c5631-688">The most likely cause of this scenario is that the client sent a delete request for the entity to the table service, which succeeded, but did not receive an acknowledgement from the server (perhaps due to a temporary network issue).</span></span> <span data-ttu-id="c5631-689">Затем клиент автоматически повторил операцию, используя то же значение **client-request-id**, и она завершилась с ошибкой, так как субъект уже был удален.</span><span class="sxs-lookup"><span data-stu-id="c5631-689">The client then automatically retried the operation (using the same **client-request-id**), and this retry failed because the entity had already been deleted.</span></span>

<span data-ttu-id="c5631-690">Если вы часто сталкиваетесь с этой проблемой, попытайтесь выяснить, почему клиент не получает подтверждений от службы таблиц.</span><span class="sxs-lookup"><span data-stu-id="c5631-690">If this problem occurs frequently, you should investigate why the client is failing to receive acknowledgements from the table service.</span></span> <span data-ttu-id="c5631-691">Если проблема не постоянна, вам нужно обработать ошибку «HTTP (404) — не найдено» и внести ее в журнал клиента, но позволить клиенту продолжить работу.</span><span class="sxs-lookup"><span data-stu-id="c5631-691">If the problem is intermittent, you should trap the "HTTP (404) Not Found" error and log it in the client, but allow the client to continue.</span></span>

### <span data-ttu-id="c5631-692"><a name="the-client-is-receiving-409-messages"></a>Клиент получает сообщения HTTP 409 (конфликт)</span><span class="sxs-lookup"><span data-stu-id="c5631-692"><a name="the-client-is-receiving-409-messages"></a>The client is receiving HTTP 409 (Conflict) messages</span></span>
<span data-ttu-id="c5631-693">В таблице ниже показан фрагмент журнала на стороне сервера для двух операций клиента: за операцией **DeleteIfExists** сразу же следует операция **CreateIfNotExists**, в которой используется то же самое имя контейнера BLOB-объектов.</span><span class="sxs-lookup"><span data-stu-id="c5631-693">The following table shows an extract from the server-side log for two client operations: **DeleteIfExists** followed immediately by **CreateIfNotExists** using the same blob container name.</span></span> <span data-ttu-id="c5631-694">Обратите внимание: каждая операция клиента приводит к отправке на сервер двух запросов: сначала отправляется запрос **GetContainerProperties** для проверки существования контейнера, а затем — **DeleteContainer** или **CreateContainer**.</span><span class="sxs-lookup"><span data-stu-id="c5631-694">Note that each client operation results in two requests sent to the server, first a **GetContainerProperties** request to check if the container exists, followed by the **DeleteContainer** or **CreateContainer** request.</span></span>

| <span data-ttu-id="c5631-695">Timestamp</span><span class="sxs-lookup"><span data-stu-id="c5631-695">Timestamp</span></span> | <span data-ttu-id="c5631-696">Операция</span><span class="sxs-lookup"><span data-stu-id="c5631-696">Operation</span></span> | <span data-ttu-id="c5631-697">Результат</span><span class="sxs-lookup"><span data-stu-id="c5631-697">Result</span></span> | <span data-ttu-id="c5631-698">Имя контейнера</span><span class="sxs-lookup"><span data-stu-id="c5631-698">Container name</span></span> | <span data-ttu-id="c5631-699">Идентификатор запроса клиента</span><span class="sxs-lookup"><span data-stu-id="c5631-699">Client request id</span></span> |
| --- | --- | --- | --- | --- |
| <span data-ttu-id="c5631-700">05:10:13.7167225</span><span class="sxs-lookup"><span data-stu-id="c5631-700">05:10:13.7167225</span></span> |<span data-ttu-id="c5631-701">GetContainerProperties</span><span class="sxs-lookup"><span data-stu-id="c5631-701">GetContainerProperties</span></span> |<span data-ttu-id="c5631-702">200</span><span class="sxs-lookup"><span data-stu-id="c5631-702">200</span></span> |<span data-ttu-id="c5631-703">mmcont</span><span class="sxs-lookup"><span data-stu-id="c5631-703">mmcont</span></span> |<span data-ttu-id="c5631-704">c9f52c89-…</span><span class="sxs-lookup"><span data-stu-id="c5631-704">c9f52c89-…</span></span> |
| <span data-ttu-id="c5631-705">05:10:13.8167325</span><span class="sxs-lookup"><span data-stu-id="c5631-705">05:10:13.8167325</span></span> |<span data-ttu-id="c5631-706">DeleteContainer</span><span class="sxs-lookup"><span data-stu-id="c5631-706">DeleteContainer</span></span> |<span data-ttu-id="c5631-707">202</span><span class="sxs-lookup"><span data-stu-id="c5631-707">202</span></span> |<span data-ttu-id="c5631-708">mmcont</span><span class="sxs-lookup"><span data-stu-id="c5631-708">mmcont</span></span> |<span data-ttu-id="c5631-709">c9f52c89-…</span><span class="sxs-lookup"><span data-stu-id="c5631-709">c9f52c89-…</span></span> |
| <span data-ttu-id="c5631-710">05:10:13.8987407</span><span class="sxs-lookup"><span data-stu-id="c5631-710">05:10:13.8987407</span></span> |<span data-ttu-id="c5631-711">GetContainerProperties</span><span class="sxs-lookup"><span data-stu-id="c5631-711">GetContainerProperties</span></span> |<span data-ttu-id="c5631-712">404</span><span class="sxs-lookup"><span data-stu-id="c5631-712">404</span></span> |<span data-ttu-id="c5631-713">mmcont</span><span class="sxs-lookup"><span data-stu-id="c5631-713">mmcont</span></span> |<span data-ttu-id="c5631-714">bc881924-…</span><span class="sxs-lookup"><span data-stu-id="c5631-714">bc881924-…</span></span> |
| <span data-ttu-id="c5631-715">5:10:14.2147723</span><span class="sxs-lookup"><span data-stu-id="c5631-715">05:10:14.2147723</span></span> |<span data-ttu-id="c5631-716">CreateContainer</span><span class="sxs-lookup"><span data-stu-id="c5631-716">CreateContainer</span></span> |<span data-ttu-id="c5631-717">409</span><span class="sxs-lookup"><span data-stu-id="c5631-717">409</span></span> |<span data-ttu-id="c5631-718">mmcont</span><span class="sxs-lookup"><span data-stu-id="c5631-718">mmcont</span></span> |<span data-ttu-id="c5631-719">bc881924-…</span><span class="sxs-lookup"><span data-stu-id="c5631-719">bc881924-…</span></span> |

<span data-ttu-id="c5631-720">Код клиентского приложения удаляет и сразу же снова создает контейнер BLOB-объектов с тем же именем: метод **CreateIfNotExists** (идентификатор запроса клиента bc881924-…) завершается с ошибкой HTTP 409 (конфликт).</span><span class="sxs-lookup"><span data-stu-id="c5631-720">The code in the client application deletes and then immediately recreates a blob container using the same name: the **CreateIfNotExists** method (Client request ID bc881924-…) eventually fails with the HTTP 409 (Conflict) error.</span></span> <span data-ttu-id="c5631-721">Когда клиент удаляет контейнер BLOB-объектов, таблицу или очередь, имя удаленного элемента становится снова доступным через небольшой промежуток времени.</span><span class="sxs-lookup"><span data-stu-id="c5631-721">When a client deletes blob containers, tables, or queues there is a brief period before the name becomes available again.</span></span>

<span data-ttu-id="c5631-722">Если операции удаления и повторного создания выполняются часто, то клиентское приложение должно использовать уникальные имена при создании каждого контейнера.</span><span class="sxs-lookup"><span data-stu-id="c5631-722">The client application should use unique container names whenever it creates new containers if the delete/recreate pattern is common.</span></span>

### <span data-ttu-id="c5631-723"><a name="metrics-show-low-percent-success"></a>Метрики содержат низкие значения PercentSuccess, или в записях журналов аналитики присутствуют операции с состоянием транзакции ClientOtherErrors</span><span class="sxs-lookup"><span data-stu-id="c5631-723"><a name="metrics-show-low-percent-success"></a>Metrics show low PercentSuccess or analytics log entries have operations with transaction status of ClientOtherErrors</span></span>
<span data-ttu-id="c5631-724">В метрике **PercentSuccess** (Процент удачных завершений) фиксируется доля успешно завершенных операций с учетом кода состояния HTTP.</span><span class="sxs-lookup"><span data-stu-id="c5631-724">The **PercentSuccess** metric captures the percent of operations that were successful based on their HTTP Status Code.</span></span> <span data-ttu-id="c5631-725">Операции с кодом состояния 2XX относятся к успешным, а с кодом 3XX, 4XX или 5XX — к неудачным и приводят к уменьшению значения метрики **PercentSucess** .</span><span class="sxs-lookup"><span data-stu-id="c5631-725">Operations with status codes of 2XX count as successful, whereas operations with status codes in 3XX, 4XX and 5XX ranges are counted as unsuccessful and lower the **PercentSucess** metric value.</span></span> <span data-ttu-id="c5631-726">В файлах журналов хранилища на стороне сервера такие операции отображаются с состоянием транзакции **ClientOtherErrors**(Другие ошибки клиента).</span><span class="sxs-lookup"><span data-stu-id="c5631-726">In the server-side storage log files, these operations are recorded with a transaction status of **ClientOtherErrors**.</span></span>

<span data-ttu-id="c5631-727">Важно отметить, что эти операции успешно выполнены и поэтому не влияют на другие метрики, например доступность.</span><span class="sxs-lookup"><span data-stu-id="c5631-727">It is important to note that these operations have completed successfully and therefore do not affect other metrics such as availability.</span></span> <span data-ttu-id="c5631-728">Вот несколько примеров операций, которые при успешном выполнении могут сопровождаться кодами состояния HTTP, свидетельствующими о неудаче:</span><span class="sxs-lookup"><span data-stu-id="c5631-728">Some examples of operations that execute successfully but that can result in unsuccessful HTTP status codes include:</span></span>

* <span data-ttu-id="c5631-729">**ResourceNotFound** (Not Found 404) (Ресурс не найден, не найдено 404), например, после запроса GET к несуществующему BLOB-объекту;</span><span class="sxs-lookup"><span data-stu-id="c5631-729">**ResourceNotFound** (Not Found 404), for example from a GET request to a blob that does not exist.</span></span>
* <span data-ttu-id="c5631-730">**ResouceAlreadyExists** (Conflict 409) (Ресурс уже существует, конфликт 409), например после операции **CreateIfNotExist**, если ресурс уже существует.</span><span class="sxs-lookup"><span data-stu-id="c5631-730">**ResouceAlreadyExists** (Conflict 409), for example from a **CreateIfNotExist** operation where the resource already exists.</span></span>
* <span data-ttu-id="c5631-731">**ConditionNotMet** (Not Modified 304) (Условие не выполнено, не изменено 304), например после условной операции, когда клиент отправляет значение **ETag** и заголовок HTTP **If-None-Match**, чтобы запросить изображение только в том случае, если оно было изменено после последней операции.</span><span class="sxs-lookup"><span data-stu-id="c5631-731">**ConditionNotMet** (Not Modified 304), for example from a conditional operation such as when a client sends an **ETag** value and an HTTP **If-None-Match** header to request an image only if it has been updated since the last operation.</span></span>

<span data-ttu-id="c5631-732">Полный список кодов ошибок REST API, возвращаемых службами хранилища, см. на странице [Общие коды ошибок API-интерфейса REST](http://msdn.microsoft.com/library/azure/dd179357.aspx).</span><span class="sxs-lookup"><span data-stu-id="c5631-732">You can find a list of common REST API error codes that the storage services return on the page [Common REST API Error Codes](http://msdn.microsoft.com/library/azure/dd179357.aspx).</span></span>

### <span data-ttu-id="c5631-733"><a name="capacity-metrics-show-an-unexpected-increase"></a>Метрики объема показывают неожиданное увеличение использования объема хранилища</span><span class="sxs-lookup"><span data-stu-id="c5631-733"><a name="capacity-metrics-show-an-unexpected-increase"></a>Capacity metrics show an unexpected increase in storage capacity usage</span></span>
<span data-ttu-id="c5631-734">Если наблюдаются внезапные, неожиданные изменения используемой емкости в учетной записи хранения, то для установления причины сначала можно проверить метрики доступности. Например, увеличение числа сбоев при выполнении запросов на удаление может приводить к увеличению используемого объема хранилища BLOB-объектов, так как связанные с приложением операции очистки, которые должны освобождать пространство, могут работать неправильно (например, из-за того что срок действия маркеров SAS, используемых для освобождения пространства, истек).</span><span class="sxs-lookup"><span data-stu-id="c5631-734">If you see sudden, unexpected changes in capacity usage in your storage account, you can investigate the reasons by first looking at your availability metrics; for example, an increase in the number of failed delete requests might lead to an increase in the amount of blob storage you are using as application specific cleanup operations you might have expected to be freeing up space may not be working as expected (for example, because the SAS tokens used for freeing up space have expired).</span></span>

### <span data-ttu-id="c5631-735"><a name="you-are-experiencing-unexpected-reboots"></a>Происходит неожиданный перезапуск виртуальных машин Azure, имеющих большое количество виртуальных жестких дисков</span><span class="sxs-lookup"><span data-stu-id="c5631-735"><a name="you-are-experiencing-unexpected-reboots"></a>You are experiencing unexpected reboots of Azure Virtual Machines that have a large number of attached VHDs</span></span>
<span data-ttu-id="c5631-736">Если к виртуальной машине Azure подключено большое число виртуальных жестких дисков, относящихся к одной учетной записи хранения, то целевые показатели масштабируемости для этой учетной записи могут быть превышены, что приводит к сбою виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="c5631-736">If an Azure Virtual Machine (VM) has a large number of attached VHDs that are in the same storage account, you could exceed the scalability targets for an individual storage account causing the VM to fail.</span></span> <span data-ttu-id="c5631-737">Проверьте поминутные метрики для учетной записи хранения (**TotalRequests**/**TotalIngress**/**TotalEgress**) на наличие пиковых скачков с превышением целевых показателей для учетной записи.</span><span class="sxs-lookup"><span data-stu-id="c5631-737">You should check the minute metrics for the storage account (**TotalRequests**/**TotalIngress**/**TotalEgress**) for spikes that exceed the scalability targets for a storage account.</span></span> <span data-ttu-id="c5631-738">Чтобы определить, производилось ли регулирование для учетной записи хранения, см. раздел [Метрики указывают на увеличение значения PercentThrottlingError].</span><span class="sxs-lookup"><span data-stu-id="c5631-738">See the section "[Metrics show an increase in PercentThrottlingError]" for assistance in determining if throttling has occurred on your storage account.</span></span>

<span data-ttu-id="c5631-739">Как правило, каждая отдельная операция ввода или вывода, выполняемая виртуальной машиной с виртуальным жестким диском, преобразуется в операцию **Get Page** или **Put Page** на уровне базового страничного BLOB-объекта.</span><span class="sxs-lookup"><span data-stu-id="c5631-739">In general, each individual input or output operation on a VHD from a Virtual Machine translates to **Get Page** or **Put Page** operations on the underlying page blob.</span></span> <span data-ttu-id="c5631-740">Поэтому вы можете использовать предполагаемое число операций ввода-вывода в секунду, установленное для среды, для корректировки допустимого числа виртуальных жестких дисков в одной учетной записи хранения в соответствии с особенностями функционирования приложения.</span><span class="sxs-lookup"><span data-stu-id="c5631-740">Therefore, you can use the estimated IOPS for your environment to tune how many VHDs you can have in a single storage account based on the specific behavior of your application.</span></span> <span data-ttu-id="c5631-741">Мы не рекомендуем использовать в одной учетной записи более 40 дисков.</span><span class="sxs-lookup"><span data-stu-id="c5631-741">We do not recommend having more than 40 disks in a single storage account.</span></span> <span data-ttu-id="c5631-742">Дополнительную информацию о текущих целевых показателях масштабируемости для учетных записей хранения, в частности об общей скорости выполнения запросов и общей пропускной способности для используемого типа учетной записи хранения, см. в статье [Целевые показатели по производительности и масштабируемости для службы хранилища Azure](storage-scalability-targets.md).</span><span class="sxs-lookup"><span data-stu-id="c5631-742">See [Azure Storage Scalability and Performance Targets](storage-scalability-targets.md) for details of the current scalability targets for storage accounts, in particular the total request rate and total bandwidth for the type of storage account you are using.</span></span>
<span data-ttu-id="c5631-743">Если целевые показатели масштабируемости для учетной записи хранения превышены, виртуальные жесткие диски следует распределить между несколькими учетными записями хранения, чтобы снизить интенсивность использования каждой из них.</span><span class="sxs-lookup"><span data-stu-id="c5631-743">If you are exceeding the scalability targets for your storage account, you should place your VHDs in multiple different storage accounts to reduce the activity in each individual account.</span></span>

### <span data-ttu-id="c5631-744"><a name="your-issue-arises-from-using-the-storage-emulator"></a>Проблема связана с использованием эмулятора хранения на этапе разработки или тестирования</span><span class="sxs-lookup"><span data-stu-id="c5631-744"><a name="your-issue-arises-from-using-the-storage-emulator"></a>Your issue arises from using the storage emulator for development or test</span></span>
<span data-ttu-id="c5631-745">Эмулятор хранения, как правило, используется во время разработки и тестирования, избавляя от необходимости в учетной записи хранения Azure.</span><span class="sxs-lookup"><span data-stu-id="c5631-745">You typically use the storage emulator during development and test to avoid the requirement for an Azure storage account.</span></span> <span data-ttu-id="c5631-746">Вот наиболее распространенные проблемы, которые могут возникать при использовании эмулятора хранения:</span><span class="sxs-lookup"><span data-stu-id="c5631-746">The common issues that can occur when you are using the storage emulator are:</span></span>

* <span data-ttu-id="c5631-747">[Функция X не работает в эмуляторе хранения]</span><span class="sxs-lookup"><span data-stu-id="c5631-747">[Feature "X" is not working in the storage emulator]</span></span>
* <span data-ttu-id="c5631-748">[При использовании эмулятора хранения происходит ошибка «Неправильный формат значения одного из заголовков HTTP»]</span><span class="sxs-lookup"><span data-stu-id="c5631-748">[Error "The value for one of the HTTP headers is not in the correct format" when using the storage emulator]</span></span>
* <span data-ttu-id="c5631-749">[Для запуска эмулятора хранения требуются права администратора]</span><span class="sxs-lookup"><span data-stu-id="c5631-749">[Running the storage emulator requires administrative privileges]</span></span>

#### <span data-ttu-id="c5631-750"><a name="feature-X-is-not-working"></a>Функция X не работает в эмуляторе хранения</span><span class="sxs-lookup"><span data-stu-id="c5631-750"><a name="feature-X-is-not-working"></a>Feature "X" is not working in the storage emulator</span></span>
<span data-ttu-id="c5631-751">Эмулятор хранения поддерживает не все функции служб хранилища Azure, например файловой службы.</span><span class="sxs-lookup"><span data-stu-id="c5631-751">The storage emulator does not support all of the features of the Azure storage services such as the file service.</span></span> <span data-ttu-id="c5631-752">Дополнительные сведения см. в статье [Использование эмулятора хранения Azure для разработки и тестирования](storage-use-emulator.md).</span><span class="sxs-lookup"><span data-stu-id="c5631-752">For more information, see [Use the Azure Storage Emulator for Development and Testing](storage-use-emulator.md).</span></span>

<span data-ttu-id="c5631-753">Если вам нужны функции, не поддерживаемые эмулятором хранения, используйте службу хранилища Azure в облаке.</span><span class="sxs-lookup"><span data-stu-id="c5631-753">For those features that the storage emulator does not support, use the Azure storage service in the cloud.</span></span>

#### <span data-ttu-id="c5631-754"><a name="error-HTTP-header-not-correct-format"></a>При использовании эмулятора хранения происходит ошибка «Неправильный формат значения одного из заголовков HTTP»</span><span class="sxs-lookup"><span data-stu-id="c5631-754"><a name="error-HTTP-header-not-correct-format"></a>Error "The value for one of the HTTP headers is not in the correct format" when using the storage emulator</span></span>
<span data-ttu-id="c5631-755">При тестировании приложения, использующего клиентскую библиотеку хранилища в локальном эмуляторе хранения, вызовы методов, таких как **CreateIfNotExists** , могут завершаться сбоем с сообщением об ошибке "Значение одного из заголовков HTTP имеет неправильный формат".</span><span class="sxs-lookup"><span data-stu-id="c5631-755">You are testing your application that use the Storage Client Library against the local storage emulator and method calls such as **CreateIfNotExists** fail with the error message "The value for one of the HTTP headers is not in the correct format."</span></span> <span data-ttu-id="c5631-756">Это означает, что версия эмулятора хранения не поддерживает используемую версию клиентской библиотеки хранилища.</span><span class="sxs-lookup"><span data-stu-id="c5631-756">This indicates that the version of the storage emulator you are using does not support the version of the storage client library you are using.</span></span> <span data-ttu-id="c5631-757">Клиентская библиотека хранилища добавляет заголовок **x-ms-version** ко всем выполняемым ею запросам.</span><span class="sxs-lookup"><span data-stu-id="c5631-757">The Storage Client Library adds the header **x-ms-version** to all the requests it makes.</span></span> <span data-ttu-id="c5631-758">Если эмулятор хранения не распознаёт значение в заголовке **x-ms-version** , он отклоняет запрос.</span><span class="sxs-lookup"><span data-stu-id="c5631-758">If the storage emulator does not recognize the value in the **x-ms-version** header, it rejects the request.</span></span>

<span data-ttu-id="c5631-759">Для просмотра значения, отправляемого в **заголовке x-ms-version** , можно воспользоваться журналами клиентской библиотеки хранилища.</span><span class="sxs-lookup"><span data-stu-id="c5631-759">You can use the Storage Library Client logs to see the value of the **x-ms-version header** it is sending.</span></span> <span data-ttu-id="c5631-760">Значение **заголовка x-ms-version** также можно просмотреть, если вы используете Fiddler для трассировки запросов от клиентского приложения.</span><span class="sxs-lookup"><span data-stu-id="c5631-760">You can also see the value of the **x-ms-version header** if you use Fiddler to trace the requests from your client application.</span></span>

<span data-ttu-id="c5631-761">Такая ситуация обычно возникает, если вы устанавливаете и используете последнюю версию клиентской библиотеки хранилища, не обновляя эмулятор хранения.</span><span class="sxs-lookup"><span data-stu-id="c5631-761">This scenario typically occurs if you install and use the latest version of the Storage Client Library without updating the storage emulator.</span></span> <span data-ttu-id="c5631-762">Вам следует установить последнюю версию эмулятора хранения или использовать вместо него облачное хранилище для разработки и тестирования.</span><span class="sxs-lookup"><span data-stu-id="c5631-762">You should either install the latest version of the storage emulator, or use cloud storage instead of the emulator for development and test.</span></span>

#### <span data-ttu-id="c5631-763"><a name="storage-emulator-requires-administrative-privileges"></a>Для запуска эмулятора хранения требуются права администратора</span><span class="sxs-lookup"><span data-stu-id="c5631-763"><a name="storage-emulator-requires-administrative-privileges"></a>Running the storage emulator requires administrative privileges</span></span>
<span data-ttu-id="c5631-764">При запуске эмулятора хранения появляется запрос на ввод учетных данных администратора.</span><span class="sxs-lookup"><span data-stu-id="c5631-764">You are prompted for administrator credentials when you run the storage emulator.</span></span> <span data-ttu-id="c5631-765">Это происходит только при первоначальной инициализации эмулятора хранения.</span><span class="sxs-lookup"><span data-stu-id="c5631-765">This only occurs when you are initializing the storage emulator for the first time.</span></span> <span data-ttu-id="c5631-766">После этого для повторного запуска права администратора не требуются.</span><span class="sxs-lookup"><span data-stu-id="c5631-766">After you have initialized the storage emulator, you do not need administrative privileges to run it again.</span></span>

<span data-ttu-id="c5631-767">Дополнительные сведения см. в статье [Использование эмулятора хранения Azure для разработки и тестирования](storage-use-emulator.md).</span><span class="sxs-lookup"><span data-stu-id="c5631-767">For more information, see [Use the Azure Storage Emulator for Development and Testing](storage-use-emulator.md).</span></span> <span data-ttu-id="c5631-768">Обратите внимание, чтобы инициализировать эмулятор хранения в Visual Studio, вам также потребуются права администратора.</span><span class="sxs-lookup"><span data-stu-id="c5631-768">Note that you can also initialize the storage emulator in Visual Studio, which will also require administrative privileges.</span></span>

### <span data-ttu-id="c5631-769"><a name="you-are-encountering-problems-installing-the-Windows-Azure-SDK"></a>Возникают проблемы при установке пакета SDK для Azure для .NET</span><span class="sxs-lookup"><span data-stu-id="c5631-769"><a name="you-are-encountering-problems-installing-the-Windows-Azure-SDK"></a>You are encountering problems installing the Azure SDK for .NET</span></span>
<span data-ttu-id="c5631-770">При попытке установить пакет SDK не удается установить эмулятор хранения на локальном компьютере.</span><span class="sxs-lookup"><span data-stu-id="c5631-770">When you try to install the SDK, it fails trying to install the storage emulator on your local machine.</span></span> <span data-ttu-id="c5631-771">В журнале установки содержится одно из следующих сообщений:</span><span class="sxs-lookup"><span data-stu-id="c5631-771">The installation log contains one of the following messages:</span></span>

* <span data-ttu-id="c5631-772">CAQuietExec. Ошибка: не удалось получить доступ к экземпляру SQL</span><span class="sxs-lookup"><span data-stu-id="c5631-772">CAQuietExec:  Error: Unable to access SQL instance</span></span>
* <span data-ttu-id="c5631-773">CAQuietExec. Ошибка: не удалось создать базу данных</span><span class="sxs-lookup"><span data-stu-id="c5631-773">CAQuietExec:  Error: Unable to create database</span></span>

<span data-ttu-id="c5631-774">Причина заключается в проблемах с существующей установкой LocalDB.</span><span class="sxs-lookup"><span data-stu-id="c5631-774">The cause is an issue with existing LocalDB installation.</span></span> <span data-ttu-id="c5631-775">По умолчанию эмулятор хранения использует базу данных LocalDB для хранения данных при эмуляции служб хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="c5631-775">By default, the storage emulator uses LocalDB to persist data when it simulates the Azure storage services.</span></span> <span data-ttu-id="c5631-776">Вы можете переустановить экземпляр LocalDB, прежде чем пытаться установить пакет SDK, выполнив указанные ниже команды в окне командной строки.</span><span class="sxs-lookup"><span data-stu-id="c5631-776">You can reset your LocalDB instance by running the following commands in a command-prompt window before trying to install the SDK.</span></span>

```
sqllocaldb stop v11.0
sqllocaldb delete v11.0
delete %USERPROFILE%\WAStorageEmulatorDb3*.*
sqllocaldb create v11.0
```

<span data-ttu-id="c5631-777">Команда **delete** удаляет старые файлы базы данных, оставшиеся от предыдущих установок эмулятора хранения.</span><span class="sxs-lookup"><span data-stu-id="c5631-777">The **delete** command removes any old database files from previous installations of the storage emulator.</span></span>

### <span data-ttu-id="c5631-778"><a name="you-have-a-different-issue-with-a-storage-service"></a>Возникла другая проблема со службой хранилища</span><span class="sxs-lookup"><span data-stu-id="c5631-778"><a name="you-have-a-different-issue-with-a-storage-service"></a>You have a different issue with a storage service</span></span>
<span data-ttu-id="c5631-779">Если в предыдущих разделах не описывается возникающая у вас проблема со службой хранилища, используйте следующий подход к диагностике и устранению неполадок.</span><span class="sxs-lookup"><span data-stu-id="c5631-779">If the previous troubleshooting sections do not include the issue you are having with a storage service, you should adopt the following approach to diagnosing and troubleshooting your issue.</span></span>

* <span data-ttu-id="c5631-780">Проверьте метрики на наличие отклонений от ожидаемого поведения.</span><span class="sxs-lookup"><span data-stu-id="c5631-780">Check your metrics to see if there is any change from your expected base-line behavior.</span></span> <span data-ttu-id="c5631-781">На основе метрик можно определить, является ли неполадка временной или постоянной и какие операции с хранилищем она затрагивает.</span><span class="sxs-lookup"><span data-stu-id="c5631-781">From the metrics, you may be able to determine whether the issue is transient or permanent, and which storage operations the issue is affecting.</span></span>
* <span data-ttu-id="c5631-782">Значения метрик могут помочь в поиске более подробной информации о возникающих ошибках в журналах на стороне сервера.</span><span class="sxs-lookup"><span data-stu-id="c5631-782">You can use the metrics information to help you search your server-side log data for more detailed information about any errors that are occurring.</span></span> <span data-ttu-id="c5631-783">Эта информация может помочь в диагностировании и устранении проблемы.</span><span class="sxs-lookup"><span data-stu-id="c5631-783">This information may help you troubleshoot and resolve the issue.</span></span>
* <span data-ttu-id="c5631-784">Если информации в журналах на стороне сервера недостаточно для успешного устранения неполадки, вы можете использовать журналы клиентской библиотеки хранилища для изучения поведения клиентского приложения и такие средства, как Fiddler, Wireshark и анализатор сообщений Майкрософт, для анализа сети.</span><span class="sxs-lookup"><span data-stu-id="c5631-784">If the information in the server-side logs is not sufficient to troubleshoot the issue successfully, you can use the Storage Client Library client-side logs to investigate the behavior of your client application, and tools such as Fiddler, Wireshark, and Microsoft Message Analyzer to investigate your network.</span></span>

<span data-ttu-id="c5631-785">Дополнительные сведения об использовании Fiddler см. в [приложении 1 "Отслеживание HTTP- и HTTPS-трафика с помощью Fiddler"].</span><span class="sxs-lookup"><span data-stu-id="c5631-785">For more information about using Fiddler, see "[Appendix 1: Using Fiddler to capture HTTP and HTTPS traffic]."</span></span>

<span data-ttu-id="c5631-786">Дополнительные сведения об использовании Wireshark см. в [Приложение 2. Отслеживание сетевого трафика с помощью Wireshark].</span><span class="sxs-lookup"><span data-stu-id="c5631-786">For more information about using Wireshark, see "[Appendix 2: Using Wireshark to capture network traffic]."</span></span>

<span data-ttu-id="c5631-787">Дополнительные сведения об использовании Microsoft Message Analyzer см. в [Приложение 3. Отслеживание сетевого трафика с помощью Microsoft Message Analyzer].</span><span class="sxs-lookup"><span data-stu-id="c5631-787">For more information about using Microsoft Message Analyzer, see "[Appendix 3: Using Microsoft Message Analyzer to capture network traffic]."</span></span>

## <span data-ttu-id="c5631-788"><a name="appendices"></a>Приложения</span><span class="sxs-lookup"><span data-stu-id="c5631-788"><a name="appendices"></a>Appendices</span></span>
<span data-ttu-id="c5631-789">В приложениях описывается ряд средств, которые могут оказаться полезными при диагностике и устранении неполадок службы хранилища Azure (и других служб).</span><span class="sxs-lookup"><span data-stu-id="c5631-789">The appendices describe several tools that you may find useful when you are diagnosing and troubleshooting issues with Azure Storage (and other services).</span></span> <span data-ttu-id="c5631-790">Эти средства не входят в состав службы хранилища Azure, а некоторые из них предоставляются сторонними разработчиками.</span><span class="sxs-lookup"><span data-stu-id="c5631-790">These tools are not part of Azure Storage and some are third-party products.</span></span> <span data-ttu-id="c5631-791">В связи с этим на средства, рассматриваемые в этих приложениях, не распространяются соглашения о поддержке Microsoft Azure или службы хранилища Azure. В процессе оценки следует рассмотреть варианты лицензирования и поддержки, предоставляемые поставщиками этих средств.</span><span class="sxs-lookup"><span data-stu-id="c5631-791">As such, the tools discussed in these appendices are not covered by any support agreement you may have with Microsoft Azure or Azure Storage, and therefore as part of your evaluation process you should examine the licensing and support options available from the providers of these tools.</span></span>

### <span data-ttu-id="c5631-792"><a name="appendix-1"></a>Приложение 1. Отслеживание HTTP- и HTTPS-трафика с помощью Fiddler</span><span class="sxs-lookup"><span data-stu-id="c5631-792"><a name="appendix-1"></a>Appendix 1: Using Fiddler to capture HTTP and HTTPS traffic</span></span>
<span data-ttu-id="c5631-793">[Fiddler](http://www.telerik.com/fiddler) — это полезное средство для анализа трафика HTTP и HTTPS между клиентским приложением и используемой службой хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="c5631-793">[Fiddler](http://www.telerik.com/fiddler) is a useful tool for analyzing the HTTP and HTTPS traffic between your client application and the Azure storage service you are using.</span></span>

> [!NOTE]
> <span data-ttu-id="c5631-794">Средство Fiddler может декодировать трафик HTTPS. Внимательно ознакомьтесь с документацией Fiddler, чтобы понять, как это осуществляется и какие последствия может иметь для безопасности.</span><span class="sxs-lookup"><span data-stu-id="c5631-794">Fiddler can decode HTTPS traffic; you should read the Fiddler documentation carefully to understand how it does this, and to understand the security implications.</span></span>
> 
> 

<span data-ttu-id="c5631-795">В этом приложении приводится краткое пошаговое руководство по настройке средства Fiddler для захвата трафика между локальным компьютером, на котором установлено средство, и службами хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="c5631-795">This appendix provides a brief walkthrough of how to configure Fiddler to capture traffic between the local machine where you have installed Fiddler and the Azure storage services.</span></span>

<span data-ttu-id="c5631-796">После запуска средства Fiddler оно начинает захват трафика HTTP и HTTPS на локальном компьютере.</span><span class="sxs-lookup"><span data-stu-id="c5631-796">After you have launched Fiddler, it will begin capturing HTTP and HTTPS traffic on your local machine.</span></span> <span data-ttu-id="c5631-797">Вот некоторые полезные команды для управления Fiddler:</span><span class="sxs-lookup"><span data-stu-id="c5631-797">The following are some useful commands for controlling Fiddler:</span></span>

* <span data-ttu-id="c5631-798">Остановка и запуск захвата трафика.</span><span class="sxs-lookup"><span data-stu-id="c5631-798">Stop and start capturing traffic.</span></span> <span data-ttu-id="c5631-799">В главном меню выберите пункт **Файл**, а затем щелкните **Захват трафика**, чтобы включить или отключить захват.</span><span class="sxs-lookup"><span data-stu-id="c5631-799">On the main menu, go to **File** and then click **Capture Traffic** to toggle capturing on and off.</span></span>
* <span data-ttu-id="c5631-800">Сохранение захваченных данных трафика.</span><span class="sxs-lookup"><span data-stu-id="c5631-800">Save captured traffic data.</span></span> <span data-ttu-id="c5631-801">В главном меню выберите пункт **Файл**, щелкните **Сохранить** и **Все сеансы**. Так вы можете сохранить трафик в файле архива сеанса.</span><span class="sxs-lookup"><span data-stu-id="c5631-801">On the main menu, go to **File**, click **Save**, and then click **All Sessions**: this enables you to save the traffic in a Session Archive file.</span></span> <span data-ttu-id="c5631-802">Позже вы можете загрузить архив сеанса для анализа или отправить его в службу поддержки Майкрософт по запросу.</span><span class="sxs-lookup"><span data-stu-id="c5631-802">You can reload a Session Archive later for analysis, or send it if requested to Microsoft support.</span></span>

<span data-ttu-id="c5631-803">Чтобы ограничить объем трафика, захватываемого средством Fiddler, можно использовать фильтры, которые настраиваются на вкладке **Filters** (Фильтры).</span><span class="sxs-lookup"><span data-stu-id="c5631-803">To limit the amount of traffic that Fiddler captures, you can use filters that you configure in the **Filters** tab.</span></span> <span data-ttu-id="c5631-804">На снимке экрана ниже показан фильтр, с помощью которого захватывается только трафик, передаваемый в конечную точку хранилища **contosoemaildist.table.core.windows.net** .</span><span class="sxs-lookup"><span data-stu-id="c5631-804">The following screenshot shows a filter that captures only traffic sent to the **contosoemaildist.table.core.windows.net** storage endpoint:</span></span>

![][5]

### <span data-ttu-id="c5631-805"><a name="appendix-2"></a>Приложение 2. Отслеживание сетевого трафика с помощью Wireshark</span><span class="sxs-lookup"><span data-stu-id="c5631-805"><a name="appendix-2"></a>Appendix 2: Using Wireshark to capture network traffic</span></span>
<span data-ttu-id="c5631-806">[Wireshark](http://www.wireshark.org/) — это анализатор сетевых протоколов, который позволяет просматривать подробную информацию о пакетах для широкого спектра сетевых протоколов.</span><span class="sxs-lookup"><span data-stu-id="c5631-806">[Wireshark](http://www.wireshark.org/) is a network protocol analyzer that enables you to view detailed packet information for a wide range of network protocols.</span></span>

<span data-ttu-id="c5631-807">Ниже приведена процедура получения подробной информации о пакетах для трафика, отправляемого с локального компьютера, на котором установлено средство Wireshark, в службу таблиц в учетной записи хранения Azure.</span><span class="sxs-lookup"><span data-stu-id="c5631-807">The following procedure shows you how to capture detailed packet information for traffic from the local machine where you installed Wireshark to the table service in your Azure storage account.</span></span>

1. <span data-ttu-id="c5631-808">Запустите Wireshark на локальном компьютере.</span><span class="sxs-lookup"><span data-stu-id="c5631-808">Launch Wireshark on your local machine.</span></span>
2. <span data-ttu-id="c5631-809">В разделе **Start** (Запуск) выберите локальный сетевой интерфейс или интерфейсы, подключенные к Интернету.</span><span class="sxs-lookup"><span data-stu-id="c5631-809">In the **Start** section, select the local network interface or interfaces that are connected to the internet.</span></span>
3. <span data-ttu-id="c5631-810">Щелкните **Capture Options**(Параметры захвата).</span><span class="sxs-lookup"><span data-stu-id="c5631-810">Click **Capture Options**.</span></span>
4. <span data-ttu-id="c5631-811">В текстовом поле **Capture Filter** (Фильтр захвата) добавьте фильтр.</span><span class="sxs-lookup"><span data-stu-id="c5631-811">Add a filter to the **Capture Filter** textbox.</span></span> <span data-ttu-id="c5631-812">Например, при использовании фильтра **host contosoemaildist.table.core.windows.net** Wireshark будет захватывать только пакеты, отправляемые в конечную точку службы таблиц в учетной записи хранения **contosoemaildist** или из нее.</span><span class="sxs-lookup"><span data-stu-id="c5631-812">For example, **host contosoemaildist.table.core.windows.net** will configure Wireshark to capture only packets sent to or from the table service endpoint in the **contosoemaildist** storage account.</span></span> <span data-ttu-id="c5631-813">Ознакомьтесь с [полным списком фильтров захвата](http://wiki.wireshark.org/CaptureFilters).</span><span class="sxs-lookup"><span data-stu-id="c5631-813">Check out the [complete list of Capture Filters](http://wiki.wireshark.org/CaptureFilters).</span></span>
   
   ![][6]
5. <span data-ttu-id="c5631-814">Нажмите **Запуск**.</span><span class="sxs-lookup"><span data-stu-id="c5631-814">Click **Start**.</span></span> <span data-ttu-id="c5631-815">Средство Wireshark будет захватывать все пакеты, отправляемые в конечную точку службы таблиц или из нее в процессе работы клиентского приложения на локальном компьютере.</span><span class="sxs-lookup"><span data-stu-id="c5631-815">Wireshark will now capture all the packets send to or from the table service endpoint as you use your client application on your local machine.</span></span>
6. <span data-ttu-id="c5631-816">По завершении в главном меню выберите пункт **Захват**, а затем пункт **Остановить**.</span><span class="sxs-lookup"><span data-stu-id="c5631-816">When you have finished, on the main menu click **Capture** and then **Stop**.</span></span>
7. <span data-ttu-id="c5631-817">Чтобы сохранить полученные данные в файл захвата Wireshark, в главном меню выберите пункт **Файл**, а затем пункт **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="c5631-817">To save the captured data in a Wireshark Capture File, on the main menu click **File** and then **Save**.</span></span>

<span data-ttu-id="c5631-818">Обнаруженные ошибки будут выделены в окне со **списком пакетов** WireShark.</span><span class="sxs-lookup"><span data-stu-id="c5631-818">WireShark will highlight any errors that exist in the **packetlist** window.</span></span> <span data-ttu-id="c5631-819">Вы также можете просмотреть сводку ошибок и предупреждений в окне **Расширенная информация** (в меню **Анализ** выберите пункт **Expert Info**).</span><span class="sxs-lookup"><span data-stu-id="c5631-819">You can also use the **Expert Info** window (click **Analyze**, then **Expert Info**) to view a summary of errors and warnings.</span></span>

![][7]

<span data-ttu-id="c5631-820">Кроме того, вы можете просмотреть данные TCP так, как они видны прикладному уровню. Для этого щелкните данные TCP правой кнопкой мыши и выберите пункт **Отслеживать поток TCP**.</span><span class="sxs-lookup"><span data-stu-id="c5631-820">You can also chose to view the TCP data as the application layer sees it by right-clicking on the TCP data and selecting **Follow TCP Stream**.</span></span> <span data-ttu-id="c5631-821">Это особенно полезно в том случае, если дамп был получен без использования фильтра захвата.</span><span class="sxs-lookup"><span data-stu-id="c5631-821">This is particularly useful if you captured your dump without a capture filter.</span></span> <span data-ttu-id="c5631-822">Дополнительные сведения см. в разделе [Following TCP Streams](http://www.wireshark.org/docs/wsug_html_chunked/ChAdvFollowTCPSection.html) (Отслеживание потоков TCP).</span><span class="sxs-lookup"><span data-stu-id="c5631-822">For more information, see [Following TCP Streams](http://www.wireshark.org/docs/wsug_html_chunked/ChAdvFollowTCPSection.html).</span></span>

![][8]

> [!NOTE]
> <span data-ttu-id="c5631-823">Дополнительную информацию об использовании Wireshark см. в [руководстве пользователя Wireshark](http://www.wireshark.org/docs/wsug_html_chunked).</span><span class="sxs-lookup"><span data-stu-id="c5631-823">For more information about using Wireshark, see the [Wireshark Users Guide](http://www.wireshark.org/docs/wsug_html_chunked).</span></span>
> 
> 

### <span data-ttu-id="c5631-824"><a name="appendix-3"></a>Приложение 3. Отслеживание сетевого трафика с помощью Microsoft Message Analyzer</span><span class="sxs-lookup"><span data-stu-id="c5631-824"><a name="appendix-3"></a>Appendix 3: Using Microsoft Message Analyzer to capture network traffic</span></span>
<span data-ttu-id="c5631-825">С помощью анализатора сообщений Майкрософт можно захватывать трафик HTTP и HTTPS так же, как помощью Fiddler, и захватывать сетевой трафик так же, как с помощью Wireshark.</span><span class="sxs-lookup"><span data-stu-id="c5631-825">You can use Microsoft Message Analyzer to capture HTTP and HTTPS traffic in a similar way to Fiddler, and capture network traffic in a similar way to Wireshark.</span></span>

#### <a name="configure-a-web-tracing-session-using-microsoft-message-analyzer"></a><span data-ttu-id="c5631-826">Настройка сеанса трассировки веб-трафика с помощью анализатора сообщений Майкрософт</span><span class="sxs-lookup"><span data-stu-id="c5631-826">Configure a web tracing session using Microsoft Message Analyzer</span></span>
<span data-ttu-id="c5631-827">Чтобы настроить сеанс трассировки веб-трафика HTTP и HTTPS с помощью анализатора сообщений Майкрософт, запустите анализатор, а затем в меню **Файл** выберите пункт **Захват и трассировка**.</span><span class="sxs-lookup"><span data-stu-id="c5631-827">To configure a web tracing session for HTTP and HTTPS traffic using Microsoft Message Analyzer, run the Microsoft Message Analyzer application and then on the **File** menu, click **Capture/Trace**.</span></span> <span data-ttu-id="c5631-828">В списке доступных сценариев трассировки выберите пункт **Web Proxy**(Веб-прокси).</span><span class="sxs-lookup"><span data-stu-id="c5631-828">In the list of available trace scenarios, select **Web Proxy**.</span></span> <span data-ttu-id="c5631-829">Затем на панели **Trace Scenario Configuration** (Конфигурация сценария трассировки) в текстовом поле **HostnameFilter** (Фильтр имен узлов) добавьте имена конечных точек хранилища (их можно узнать на [портале Azure](https://portal.azure.com)).</span><span class="sxs-lookup"><span data-stu-id="c5631-829">Then in the **Trace Scenario Configuration** panel, in the **HostnameFilter** textbox, add the names of your storage endpoints (you can look up these names in the [Azure portal](https://portal.azure.com)).</span></span> <span data-ttu-id="c5631-830">Например, если ваша учетная запись хранения Azure имеет имя **contosodata**, добавьте в поле **Фильтр имен узлов** следующий текст.</span><span class="sxs-lookup"><span data-stu-id="c5631-830">For example, if the name of your Azure storage account is **contosodata**, you should add the following to the **HostnameFilter** textbox:</span></span>

```
contosodata.blob.core.windows.net contosodata.table.core.windows.net contosodata.queue.core.windows.net
```

> [!NOTE]
> <span data-ttu-id="c5631-831">Имена узлов разделяются пробелом.</span><span class="sxs-lookup"><span data-stu-id="c5631-831">A space character separates the hostnames.</span></span>
> 
> 

<span data-ttu-id="c5631-832">Когда вы будете готовы начать сбор данных трассировки, нажмите кнопку **Start With** (Начать с).</span><span class="sxs-lookup"><span data-stu-id="c5631-832">When you are ready to start collecting trace data, click the **Start With** button.</span></span>

<span data-ttu-id="c5631-833">Дополнительные сведения о трассировке **веб-прокси** в анализаторе сообщений Майкрософт см. в разделе [Microsoft-PEF-WebProxy Provider](http://technet.microsoft.com/library/jj674814.aspx) (Поставщик Microsoft-PEF-WebProxy).</span><span class="sxs-lookup"><span data-stu-id="c5631-833">For more information about the Microsoft Message Analyzer **Web Proxy** trace, see [Microsoft-PEF-WebProxy Provider](http://technet.microsoft.com/library/jj674814.aspx).</span></span>

<span data-ttu-id="c5631-834">Встроенная трассировка **Веб-прокси** в анализаторе сообщений Майкрософт выполняется с использованием Fiddler. С ее помощью можно захватывать трафик HTTPS на стороне клиента и просматривать незашифрованные сообщения HTTPS.</span><span class="sxs-lookup"><span data-stu-id="c5631-834">The built-in **Web Proxy** trace in Microsoft Message Analyzer is based on Fiddler; it can capture client-side HTTPS traffic and display unencrypted HTTPS messages.</span></span> <span data-ttu-id="c5631-835">Для выполнения трассировки **Веб-прокси** настраивается локальный прокси-сервер для всего трафика HTTP и HTTPS, который обеспечивает доступ к незашифрованным сообщениям.</span><span class="sxs-lookup"><span data-stu-id="c5631-835">The **Web Proxy** trace works by configuring a local proxy for all HTTP and HTTPS traffic that gives it access to unencrypted messages.</span></span>

#### <a name="diagnosing-network-issues-using-microsoft-message-analyzer"></a><span data-ttu-id="c5631-836">Диагностика неполадок сети с помощью анализатора сообщений Майкрософт</span><span class="sxs-lookup"><span data-stu-id="c5631-836">Diagnosing network issues using Microsoft Message Analyzer</span></span>
<span data-ttu-id="c5631-837">Помимо использования трассировки **Веб-прокси** в анализаторе сообщений Майкрософт для захвата данных трафика HTTP и HTTPS между клиентским приложением и службой хранилища, вы также можете использовать встроенную трассировку **Local Link Layer** (Локальный канальный уровень) для захвата информации о сетевых пакетах.</span><span class="sxs-lookup"><span data-stu-id="c5631-837">In addition to using the Microsoft Message Analyzer **Web Proxy** trace to capture details of the HTTP/HTTPs traffic between the client application and the storage service, you can also use the built-in **Local Link Layer** trace to capture network packet information.</span></span> <span data-ttu-id="c5631-838">Это позволяет получать те же данные, что и с помощью Wireshark, и диагностировать неполадки сети, такие как потеря пакетов.</span><span class="sxs-lookup"><span data-stu-id="c5631-838">This enables you to capture data similar to that which you can capture with Wireshark, and diagnose network issues such as dropped packets.</span></span>

<span data-ttu-id="c5631-839">На снимке экрана ниже показан пример трассировки **Local Link Layer** с несколькими **информационными** сообщениями в столбце **DiagnosisTypes**.</span><span class="sxs-lookup"><span data-stu-id="c5631-839">The following screenshot shows an example **Local Link Layer** trace with some **informational** messages in the **DiagnosisTypes** column.</span></span> <span data-ttu-id="c5631-840">Если щелкнуть значок в столбец **DiagnosisTypes** , откроется подробное сообщение.</span><span class="sxs-lookup"><span data-stu-id="c5631-840">Clicking on an icon in the **DiagnosisTypes** column shows the details of the message.</span></span> <span data-ttu-id="c5631-841">В этом примере сервер повторно передал сообщение под номером 305, так как не получил подтверждения от клиента.</span><span class="sxs-lookup"><span data-stu-id="c5631-841">In this example, the server retransmitted message #305 because it did not receive an acknowledgement from the client:</span></span>

![][9]

<span data-ttu-id="c5631-842">При создании сеанса трассировки в анализаторе сообщений Майкрософт можно указать фильтры, чтобы уменьшить объем ненужных данных.</span><span class="sxs-lookup"><span data-stu-id="c5631-842">When you create the trace session in Microsoft Message Analyzer, you can specify filters to reduce the amount of noise in the trace.</span></span> <span data-ttu-id="c5631-843">На странице **Захват и трассировка**, на которой определяется трассировка, щелкните ссылку **Настроить** рядом с пунктом **Microsoft-Windows-NDIS-PacketCapture**.</span><span class="sxs-lookup"><span data-stu-id="c5631-843">On the **Capture / Trace** page where you define the trace, click on the **Configure** link next to **Microsoft-Windows-NDIS-PacketCapture**.</span></span> <span data-ttu-id="c5631-844">На снимке экрана ниже показана конфигурация, которая отфильтровывает трафик TCP для IP-адресов трех служб хранилища.</span><span class="sxs-lookup"><span data-stu-id="c5631-844">The following screenshot shows a configuration that filters TCP traffic for the IP addresses of three storage services:</span></span>

![][10]

<span data-ttu-id="c5631-845">Дополнительные сведения о трассировке Local Link Layer в анализаторе сообщений Майкрософт см. в разделе [Microsoft-PEF-NDIS-PacketCapture Provider](http://technet.microsoft.com/library/jj659264.aspx) (Поставщик Microsoft-PEF-NDIS-PacketCapture).</span><span class="sxs-lookup"><span data-stu-id="c5631-845">For more information about the Microsoft Message Analyzer Local Link Layer trace, see [Microsoft-PEF-NDIS-PacketCapture Provider](http://technet.microsoft.com/library/jj659264.aspx).</span></span>

### <span data-ttu-id="c5631-846"><a name="appendix-4"></a>Приложение 4. Просмотр метрик и данных журналов с помощью Excel</span><span class="sxs-lookup"><span data-stu-id="c5631-846"><a name="appendix-4"></a>Appendix 4: Using Excel to view metrics and log data</span></span>
<span data-ttu-id="c5631-847">Многие средства позволяют загружать данные метрик хранилища из хранилища таблиц Azure в формате с разделителями. Данные в таком формате можно легко загрузить в Excel для просмотра и анализа.</span><span class="sxs-lookup"><span data-stu-id="c5631-847">Many tools enable you to download the Storage Metrics data from Azure table storage in a delimited format that makes it easy to load the data into Excel for viewing and analysis.</span></span> <span data-ttu-id="c5631-848">Данные журналов хранилища, полученные из хранилища BLOB-объектов Azure, уже имеют формат с разделителями, и их можно загрузить в Excel.</span><span class="sxs-lookup"><span data-stu-id="c5631-848">Storage Logging data from Azure blob storage is already in a delimited format that you can load into Excel.</span></span> <span data-ttu-id="c5631-849">Однако вам нужно добавить соответствующие заголовки столбцов согласно информации в статьях [Формат журналов аналитики хранилища](http://msdn.microsoft.com/library/azure/hh343259.aspx) и [Схема таблицы метрик аналитики хранилища](http://msdn.microsoft.com/library/azure/hh343264.aspx).</span><span class="sxs-lookup"><span data-stu-id="c5631-849">However, you will need to add appropriate column headings based in the information at [Storage Analytics Log Format](http://msdn.microsoft.com/library/azure/hh343259.aspx) and [Storage Analytics Metrics Table Schema](http://msdn.microsoft.com/library/azure/hh343264.aspx).</span></span>

<span data-ttu-id="c5631-850">Чтобы импортировать данные журналов хранилища в Excel после их загрузки из хранилища BLOB-объектов, выполните указанные ниже действия.</span><span class="sxs-lookup"><span data-stu-id="c5631-850">To import your Storage Logging data into Excel after you download it from blob storage:</span></span>

* <span data-ttu-id="c5631-851">В меню **Данные** выберите пункт **Из текста**.</span><span class="sxs-lookup"><span data-stu-id="c5631-851">On the **Data** menu, click **From Text**.</span></span>
* <span data-ttu-id="c5631-852">Выберите файл журнала, который нужно просмотреть, и нажмите кнопку **Импорт**.</span><span class="sxs-lookup"><span data-stu-id="c5631-852">Browse to the log file you want to view and click **Import**.</span></span>
* <span data-ttu-id="c5631-853">На первом шаге **мастера импорта текста** выберите параметр **С разделителями**.</span><span class="sxs-lookup"><span data-stu-id="c5631-853">On step 1 of the **Text Import Wizard**, select **Delimited**.</span></span>

<span data-ttu-id="c5631-854">На втором шаге **мастера импорта текста** выберите **точку с запятой** в качестве единственного разделителя и двойные кавычки в качестве **ограничителя строк**.</span><span class="sxs-lookup"><span data-stu-id="c5631-854">On step 1 of the **Text Import Wizard**, select **Semicolon** as the only delimiter and choose double-quote as the **Text qualifier**.</span></span> <span data-ttu-id="c5631-855">Нажмите кнопку **Готово** и выберите место размещения данных в книге.</span><span class="sxs-lookup"><span data-stu-id="c5631-855">Then click **Finish** and choose where to place the data in your workbook.</span></span>

### <span data-ttu-id="c5631-856"><a name="appendix-5"></a>Приложение 5. Мониторинг с использованием Application Insights для Visual Studio Team Services</span><span class="sxs-lookup"><span data-stu-id="c5631-856"><a name="appendix-5"></a>Appendix 5: Monitoring with Application Insights for Visual Studio Team Services</span></span>
<span data-ttu-id="c5631-857">Вы также можете использовать компонент Application Insights для Visual Studio Team Services при мониторинге производительности и доступности.</span><span class="sxs-lookup"><span data-stu-id="c5631-857">You can also use the Application Insights feature for Visual Studio Team Services as part of your performance and availability monitoring.</span></span> <span data-ttu-id="c5631-858">Это средство предоставляет указанные ниже возможности.</span><span class="sxs-lookup"><span data-stu-id="c5631-858">This tool can:</span></span>

* <span data-ttu-id="c5631-859">Проверка того, что веб-служба доступна и отвечает на запросы.</span><span class="sxs-lookup"><span data-stu-id="c5631-859">Make sure your web service is available and responsive.</span></span> <span data-ttu-id="c5631-860">Вне зависимости от того, является ли ваше приложение, использующее веб-службу, приложением для веб-сайта или для устройства, этот инструмент может каждые несколько минут тестировать ваш URL-адрес из разных мест мира и сообщать о возникших проблемах.</span><span class="sxs-lookup"><span data-stu-id="c5631-860">Whether your app is a web site or a device app that uses a web service, it can test your URL every few minutes from locations around the world, and let you know if there's a problem.</span></span>
* <span data-ttu-id="c5631-861">Быстрая диагностика любых проблем с производительностью или исключений в веб-службе.</span><span class="sxs-lookup"><span data-stu-id="c5631-861">Quickly diagnose any performance issues or exceptions in your web service.</span></span> <span data-ttu-id="c5631-862">Определяйте, не исчерпаны ли ресурсы ЦП и другие ресурсы, получайте данные трассировки стека исключений и легко выполняйте поиск по журналам трассировки.</span><span class="sxs-lookup"><span data-stu-id="c5631-862">Find out if CPU or other resources are being stretched, get stack traces from exceptions, and easily search through log traces.</span></span> <span data-ttu-id="c5631-863">Если производительность приложения опустится ниже допустимого предела, мы можем оповестить вас по электронной почте.</span><span class="sxs-lookup"><span data-stu-id="c5631-863">If the app's performance drops below acceptable limits, we can send you an email.</span></span> <span data-ttu-id="c5631-864">Вы можете отслеживать веб-службы .NET и Java.</span><span class="sxs-lookup"><span data-stu-id="c5631-864">You can monitor both .NET and Java web services.</span></span>

<span data-ttu-id="c5631-865">Дополнительные сведения можно найти в статье [Что такое Azure Application Insights?](../application-insights/app-insights-overview.md).</span><span class="sxs-lookup"><span data-stu-id="c5631-865">You can find more information at [What is Application Insights?](../application-insights/app-insights-overview.md).</span></span>

<!--Anchors-->
<span data-ttu-id="c5631-866">[Введение]: #introduction</span><span class="sxs-lookup"><span data-stu-id="c5631-866">[Introduction]: #introduction</span></span>
<span data-ttu-id="c5631-867">[Структура руководства]: #how-this-guide-is-organized</span><span class="sxs-lookup"><span data-stu-id="c5631-867">[How this guide is organized]: #how-this-guide-is-organized</span></span>

<span data-ttu-id="c5631-868">[Мониторинг службы хранилища]: #monitoring-your-storage-service</span><span class="sxs-lookup"><span data-stu-id="c5631-868">[Monitoring your storage service]: #monitoring-your-storage-service</span></span>
<span data-ttu-id="c5631-869">[Мониторинг работоспособности службы]: #monitoring-service-health</span><span class="sxs-lookup"><span data-stu-id="c5631-869">[Monitoring service health]: #monitoring-service-health</span></span>
<span data-ttu-id="c5631-870">[Мониторинг мощностей]: #monitoring-capacity</span><span class="sxs-lookup"><span data-stu-id="c5631-870">[Monitoring capacity]: #monitoring-capacity</span></span>
<span data-ttu-id="c5631-871">[Мониторинг доступности]: #monitoring-availability</span><span class="sxs-lookup"><span data-stu-id="c5631-871">[Monitoring availability]: #monitoring-availability</span></span>
<span data-ttu-id="c5631-872">[Мониторинг производительности]: #monitoring-performance</span><span class="sxs-lookup"><span data-stu-id="c5631-872">[Monitoring performance]: #monitoring-performance</span></span>

<span data-ttu-id="c5631-873">[Диагностика неполадок с хранилищем]: #diagnosing-storage-issues</span><span class="sxs-lookup"><span data-stu-id="c5631-873">[Diagnosing storage issues]: #diagnosing-storage-issues</span></span>
<span data-ttu-id="c5631-874">[Проблемы с работоспособностью службы]: #service-health-issues</span><span class="sxs-lookup"><span data-stu-id="c5631-874">[Service health issues]: #service-health-issues</span></span>
<span data-ttu-id="c5631-875">[Проблемы с производительностью]: #performance-issues</span><span class="sxs-lookup"><span data-stu-id="c5631-875">[Performance issues]: #performance-issues</span></span>
<span data-ttu-id="c5631-876">[Диагностика ошибок]: #diagnosing-errors</span><span class="sxs-lookup"><span data-stu-id="c5631-876">[Diagnosing errors]: #diagnosing-errors</span></span>
<span data-ttu-id="c5631-877">[Проблемы с эмулятором хранения]: #storage-emulator-issues</span><span class="sxs-lookup"><span data-stu-id="c5631-877">[Storage emulator issues]: #storage-emulator-issues</span></span>
<span data-ttu-id="c5631-878">[Инструменты для ведения журналов хранилища]: #storage-logging-tools</span><span class="sxs-lookup"><span data-stu-id="c5631-878">[Storage logging tools]: #storage-logging-tools</span></span>
<span data-ttu-id="c5631-879">[Использование инструментов для ведения сетевого журнала]: #using-network-logging-tools</span><span class="sxs-lookup"><span data-stu-id="c5631-879">[Using network logging tools]: #using-network-logging-tools</span></span>

<span data-ttu-id="c5631-880">[Комплексная трассировка]: #end-to-end-tracing</span><span class="sxs-lookup"><span data-stu-id="c5631-880">[End-to-end tracing]: #end-to-end-tracing</span></span>
<span data-ttu-id="c5631-881">[Сопоставление данных журналов]: #correlating-log-data</span><span class="sxs-lookup"><span data-stu-id="c5631-881">[Correlating log data]: #correlating-log-data</span></span>
<span data-ttu-id="c5631-882">[Идентификатор запроса клиента]: #client-request-id</span><span class="sxs-lookup"><span data-stu-id="c5631-882">[Client request ID]: #client-request-id</span></span>
<span data-ttu-id="c5631-883">[Идентификатор запроса сервера]: #server-request-id</span><span class="sxs-lookup"><span data-stu-id="c5631-883">[Server request ID]: #server-request-id</span></span>
<span data-ttu-id="c5631-884">[Метки времени]: #timestamps</span><span class="sxs-lookup"><span data-stu-id="c5631-884">[Timestamps]: #timestamps</span></span>

<span data-ttu-id="c5631-885">[Рекомендации по устранению неполадок]: #troubleshooting-guidance</span><span class="sxs-lookup"><span data-stu-id="c5631-885">[Troubleshooting guidance]: #troubleshooting-guidance</span></span>
<span data-ttu-id="c5631-886">[Метрики содержат высокие значения AverageE2ELatency и низкие значения AverageServerLatency]: #metrics-show-high-AverageE2ELatency-and-low-AverageServerLatency</span><span class="sxs-lookup"><span data-stu-id="c5631-886">[Metrics show high AverageE2ELatency and low AverageServerLatency]: #metrics-show-high-AverageE2ELatency-and-low-AverageServerLatency</span></span>
<span data-ttu-id="c5631-887">[Метрики содержат низкие значения AverageE2ELatency и низкие значения AverageServerLatency, но клиент сталкивается с большой задержкой]: #metrics-show-low-AverageE2ELatency-and-low-AverageServerLatency</span><span class="sxs-lookup"><span data-stu-id="c5631-887">[Metrics show low AverageE2ELatency and low AverageServerLatency but the client is experiencing high latency]: #metrics-show-low-AverageE2ELatency-and-low-AverageServerLatency</span></span>
<span data-ttu-id="c5631-888">[Метрики содержат высокие значения AverageServerLatency]: #metrics-show-high-AverageServerLatency</span><span class="sxs-lookup"><span data-stu-id="c5631-888">[Metrics show high AverageServerLatency]: #metrics-show-high-AverageServerLatency</span></span>
<span data-ttu-id="c5631-889">[При доставке сообщений в очередь возникают неожиданные задержки]: #you-are-experiencing-unexpected-delays-in-message-delivery</span><span class="sxs-lookup"><span data-stu-id="c5631-889">[You are experiencing unexpected delays in message delivery on a queue]: #you-are-experiencing-unexpected-delays-in-message-delivery</span></span>

<span data-ttu-id="c5631-890">[Метрики указывают на увеличение значения PercentThrottlingError]: #metrics-show-an-increase-in-PercentThrottlingError</span><span class="sxs-lookup"><span data-stu-id="c5631-890">[Metrics show an increase in PercentThrottlingError]: #metrics-show-an-increase-in-PercentThrottlingError</span></span>
<span data-ttu-id="c5631-891">[Временное увеличение метрики PercentThrottlingError]: #transient-increase-in-PercentThrottlingError</span><span class="sxs-lookup"><span data-stu-id="c5631-891">[Transient increase in PercentThrottlingError]: #transient-increase-in-PercentThrottlingError</span></span>
<span data-ttu-id="c5631-892">[Постоянное увеличение метрики PercentThrottlingError]: #permanent-increase-in-PercentThrottlingError</span><span class="sxs-lookup"><span data-stu-id="c5631-892">[Permanent increase in PercentThrottlingError error]: #permanent-increase-in-PercentThrottlingError</span></span>
<span data-ttu-id="c5631-893">[Метрики указывают на увеличение значения PercentTimeoutError]: #metrics-show-an-increase-in-PercentTimeoutError</span><span class="sxs-lookup"><span data-stu-id="c5631-893">[Metrics show an increase in PercentTimeoutError]: #metrics-show-an-increase-in-PercentTimeoutError</span></span>
<span data-ttu-id="c5631-894">[Метрики показывают увеличение значения PercentNetworkError]: #metrics-show-an-increase-in-PercentNetworkError</span><span class="sxs-lookup"><span data-stu-id="c5631-894">[Metrics show an increase in PercentNetworkError]: #metrics-show-an-increase-in-PercentNetworkError</span></span>

<span data-ttu-id="c5631-895">[Клиент получает сообщения «HTTP 403 (запрещено)»]: #the-client-is-receiving-403-messages</span><span class="sxs-lookup"><span data-stu-id="c5631-895">[The client is receiving HTTP 403 (Forbidden) messages]: #the-client-is-receiving-403-messages</span></span>
<span data-ttu-id="c5631-896">[Клиент получает сообщения «HTTP 404 (не найдено)»]: #the-client-is-receiving-404-messages</span><span class="sxs-lookup"><span data-stu-id="c5631-896">[The client is receiving HTTP 404 (Not found) messages]: #the-client-is-receiving-404-messages</span></span>
<span data-ttu-id="c5631-897">[Объект удален ранее клиентом или другим процессом]: #client-previously-deleted-the-object</span><span class="sxs-lookup"><span data-stu-id="c5631-897">[The client or another process previously deleted the object]: #client-previously-deleted-the-object</span></span>
<span data-ttu-id="c5631-898">[Проблема с авторизацией подписанного URL-адреса (SAS)]: #SAS-authorization-issue</span><span class="sxs-lookup"><span data-stu-id="c5631-898">[A Shared Access Signature (SAS) authorization issue]: #SAS-authorization-issue</span></span>
<span data-ttu-id="c5631-899">[У кода JavaScript на стороне клиента нет разрешения на доступ к объекту]: #JavaScript-code-does-not-have-permission</span><span class="sxs-lookup"><span data-stu-id="c5631-899">[Client-side JavaScript code does not have permission to access the object]: #JavaScript-code-does-not-have-permission</span></span>
<span data-ttu-id="c5631-900">[Сбой сети]: #network-failure</span><span class="sxs-lookup"><span data-stu-id="c5631-900">[Network failure]: #network-failure</span></span>
<span data-ttu-id="c5631-901">[Клиент получает сообщения HTTP 409 (конфликт)]: #the-client-is-receiving-409-messages</span><span class="sxs-lookup"><span data-stu-id="c5631-901">[The client is receiving HTTP 409 (Conflict) messages]: #the-client-is-receiving-409-messages</span></span>

<span data-ttu-id="c5631-902">[Метрики содержат низкие значения PercentSuccess, или в записях журналов аналитики присутствуют операции с состоянием транзакции ClientOtherErrors]: #metrics-show-low-percent-success</span><span class="sxs-lookup"><span data-stu-id="c5631-902">[Metrics show low PercentSuccess or analytics log entries have operations with transaction status of ClientOtherErrors]: #metrics-show-low-percent-success</span></span>
<span data-ttu-id="c5631-903">[Метрики объема показывают неожиданное увеличение использования объема хранилища]: #capacity-metrics-show-an-unexpected-increase</span><span class="sxs-lookup"><span data-stu-id="c5631-903">[Capacity metrics show an unexpected increase in storage capacity usage]: #capacity-metrics-show-an-unexpected-increase</span></span>
<span data-ttu-id="c5631-904">[Происходит неожиданный перезапуск виртуальных машин, имеющих большое количество виртуальных жестких дисков]: #you-are-experiencing-unexpected-reboots</span><span class="sxs-lookup"><span data-stu-id="c5631-904">[You are experiencing unexpected reboots of Virtual Machines that have a large number of attached VHDs]: #you-are-experiencing-unexpected-reboots</span></span>
<span data-ttu-id="c5631-905">[Проблема связана с использованием эмулятора хранения на этапе разработки или тестирования]: #your-issue-arises-from-using-the-storage-emulator</span><span class="sxs-lookup"><span data-stu-id="c5631-905">[Your issue arises from using the storage emulator for development or test]: #your-issue-arises-from-using-the-storage-emulator</span></span>
<span data-ttu-id="c5631-906">[Функция X не работает в эмуляторе хранения]: #feature-X-is-not-working</span><span class="sxs-lookup"><span data-stu-id="c5631-906">[Feature "X" is not working in the storage emulator]: #feature-X-is-not-working</span></span>
<span data-ttu-id="c5631-907">[При использовании эмулятора хранения происходит ошибка «Неправильный формат значения одного из заголовков HTTP»]: #error-HTTP-header-not-correct-format</span><span class="sxs-lookup"><span data-stu-id="c5631-907">[Error "The value for one of the HTTP headers is not in the correct format" when using the storage emulator]: #error-HTTP-header-not-correct-format</span></span>
<span data-ttu-id="c5631-908">[Для запуска эмулятора хранения требуются права администратора]: #storage-emulator-requires-administrative-privileges</span><span class="sxs-lookup"><span data-stu-id="c5631-908">[Running the storage emulator requires administrative privileges]: #storage-emulator-requires-administrative-privileges</span></span>
<span data-ttu-id="c5631-909">[Возникают проблемы при установке пакета SDK для Azure для .NET]: #you-are-encountering-problems-installing-the-Windows-Azure-SDK</span><span class="sxs-lookup"><span data-stu-id="c5631-909">[You are encountering problems installing the Azure SDK for .NET]: #you-are-encountering-problems-installing-the-Windows-Azure-SDK</span></span>
<span data-ttu-id="c5631-910">[Возникла другая проблема со службой хранилища]: #you-have-a-different-issue-with-a-storage-service</span><span class="sxs-lookup"><span data-stu-id="c5631-910">[You have a different issue with a storage service]: #you-have-a-different-issue-with-a-storage-service</span></span>

<span data-ttu-id="c5631-911">[приложениях]: #appendices</span><span class="sxs-lookup"><span data-stu-id="c5631-911">[Appendices]: #appendices</span></span>
<span data-ttu-id="c5631-912">[приложении 1 "Отслеживание HTTP- и HTTPS-трафика с помощью Fiddler"]: #appendix-1</span><span class="sxs-lookup"><span data-stu-id="c5631-912">[Appendix 1: Using Fiddler to capture HTTP and HTTPS traffic]: #appendix-1</span></span>
<span data-ttu-id="c5631-913">[Приложение 2. Отслеживание сетевого трафика с помощью Wireshark]: #appendix-2</span><span class="sxs-lookup"><span data-stu-id="c5631-913">[Appendix 2: Using Wireshark to capture network traffic]: #appendix-2</span></span>
<span data-ttu-id="c5631-914">[Приложение 3. Отслеживание сетевого трафика с помощью Microsoft Message Analyzer]: #appendix-3</span><span class="sxs-lookup"><span data-stu-id="c5631-914">[Appendix 3: Using Microsoft Message Analyzer to capture network traffic]: #appendix-3</span></span>
<span data-ttu-id="c5631-915">[Приложение 4. Просмотр метрик и данных журналов с помощью Excel]: #appendix-4</span><span class="sxs-lookup"><span data-stu-id="c5631-915">[Appendix 4: Using Excel to view metrics and log data]: #appendix-4</span></span>
<span data-ttu-id="c5631-916">[Приложение 5. Мониторинг с использованием Application Insights для Visual Studio Team Services]: #appendix-5</span><span class="sxs-lookup"><span data-stu-id="c5631-916">[Appendix 5: Monitoring with Application Insights for Visual Studio Team Services]: #appendix-5</span></span>

<!--Image references-->
[1]: ./media/storage-monitoring-diagnosing-troubleshooting/overview.png
[3]: ./media/storage-monitoring-diagnosing-troubleshooting/hour-minute-metrics.png
[4]: ./media/storage-monitoring-diagnosing-troubleshooting/high-e2e-latency.png
[5]: ./media/storage-monitoring-diagnosing-troubleshooting/fiddler-screenshot.png
[6]: ./media/storage-monitoring-diagnosing-troubleshooting/wireshark-screenshot-1.png
[7]: ./media/storage-monitoring-diagnosing-troubleshooting/wireshark-screenshot-2.png
[8]: ./media/storage-monitoring-diagnosing-troubleshooting/wireshark-screenshot-3.png
[9]: ./media/storage-monitoring-diagnosing-troubleshooting/mma-screenshot-1.png
[10]: ./media/storage-monitoring-diagnosing-troubleshooting/mma-screenshot-2.png
