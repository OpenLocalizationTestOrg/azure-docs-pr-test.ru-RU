---
title: "aaaMonitor, диагностика и устранение неполадок хранилища Azure | Документы Microsoft"
description: "Использование функций, таких как аналитики хранилища, ведение журнала на стороне клиента и другие tooidentify сторонних средств диагностики и устранения проблем, связанных с хранилищем Azure."
services: storage
documentationcenter: 
author: fhryo-msft
manager: jahogg
editor: tysonn
ms.assetid: d1e87d98-c763-4caa-ba20-2cf85f853303
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/11/2017
ms.author: fhryo-msft
ms.openlocfilehash: a33b3af7527223169be7cf3fed76c4765ff80e28
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="monitor-diagnose-and-troubleshoot-microsoft-azure-storage"></a>Мониторинг, диагностика и устранение неисправностей службы хранилища Microsoft Azure
[!INCLUDE [storage-selector-portal-monitoring-diagnosing-troubleshooting](../../includes/storage-selector-portal-monitoring-diagnosing-troubleshooting.md)]

## <a name="overview"></a>Обзор
Диагностика и устранение неисправностей в распределенном приложении, размещенном в облачной среде, может представлять большую сложность в сравнении с традиционными средами. Развертывание приложений можно выполнять в инфраструктуре PaaS или IaaS, на площадке заказчика, на мобильном устройстве или в среде, в которой имеется произвольное сочетание таких устройств. Как правило, приложения сетевой трафик может проходить общедоступных и частных сетях и ваше приложение может использовать несколько технологий хранения данных, таких как таблиц хранилища Microsoft Azure, большие двоичные объекты, очереди или хранит файлы в данных tooother Добавление таких как реляционные и баз данных документов.

toomanage такие приложения успешно необходимо отслеживать их заранее и понять, каким образом toodiagnose и устранения неполадок любого рода их и их зависимые технологии. Имени пользователя служб хранилища Azure, необходимо постоянно отслеживать hello служб хранилища, в приложении используется любой непредвиденных изменений в поведение (например, медленнее, чем обычные отклика) и использовать ведение журнала toocollect более подробные данные и tooanalyze Ошибка в глубину. Hello диагностики, приобретаемых мониторинга и ведения журнала сведения вы toodetermine hello первопричину hello выдачи обнаружил приложения. Вы можете устранить проблему hello и определить hello соответствующие действия может занять tooremediate его. Хранилища Azure — это основное службы Azure и формирует важной частью hello большинство решений, что клиенты развернуть toohello инфраструктуры Azure. Хранилище Azure включает в себя возможности toosimplify мониторинг, диагностика и устранение неполадок хранилища в приложениях на основе облака.

> [!NOTE]
> Hello хранилища Azure File не поддерживает запись в данный момент.
> 

Практическое руководство tooend процесс устранения неполадок в приложениях хранилища Azure, в разделе [End-to-End Устранение неполадок с помощью метрик хранилища Azure и ведение журнала, AzCopy и анализатор сообщений](storage-e2e-troubleshooting.md).

* [Введение]
  * [Структура руководства]
* [мониторинга службы хранения]
  * [Мониторинг работоспособности службы]
  * [Мониторинг мощностей]
  * [Мониторинг доступности]
  * [Мониторинг производительности]
* [Диагностика неполадок хранилища]
  * [Проблемы с работоспособностью службы]
  * [Проблемы с производительностью]
  * [Диагностика ошибок]
  * [Проблемы с эмулятором хранения]
  * [Инструменты для ведения журналов хранилища]
  * [Использование инструментов для ведения сетевого журнала]
* [конца в конец трассировки]
  * [Сопоставление данных журналов]
  * [Идентификатор запроса клиента]
  * [код запроса сервера]
  * [Метки времени]
* [рекомендации по ее устранению]
  * [метрики показывают AverageE2ELatency высокой и низкой AverageServerLatency]
  * [Метрики показывают низкое AverageE2ELatency и низким AverageServerLatency, но клиент hello наблюдается большая задержка]
  * [Метрики содержат высокие значения AverageServerLatency]
  * [При доставке сообщений в очередь возникают неожиданные задержки]
  * [Метрики указывают на увеличение значения PercentThrottlingError]
  * [метрики увеличить PercentTimeoutError]
  * [Метрики показывают увеличение значения PercentNetworkError]
  * [Hello клиент получает сообщения HTTP 403 (запрещено)]
  * [Получает ошибки HTTP 404 (не найдено) сообщения приветствия клиента]
  * [Получает HTTP 409 (конфликт) сообщения приветствия клиента]
  * [метрики низкий PercentSuccess или аналитика записи журнала операций с состояние транзакции ClientOtherErrors]
  * [Метрики объема показывают неожиданное увеличение использования объема хранилища]
  * [Происходит неожиданный перезапуск виртуальных машин, имеющих большое количество виртуальных жестких дисков]
  * [Проблемы возникают из-за использование эмулятора хранилища hello для разработки или тестирования]
  * [Возникающие проблемы с установкой hello Azure SDK для .NET]
  * [Возникла другая проблема со службой хранилища]
  * [Устранение неполадок с хранилищем файлов Azure в Windows и Linux](storage-troubleshoot-file-connection-problems.md)
* [приложения]
  * [приложение 1: с помощью Fiddler toocapture HTTP и HTTPS-трафика]
  * [приложение 2: с помощью Wireshark toocapture сетевой трафик]
  * [приложение 3: с помощью Microsoft Message Analyzer toocapture сетевой трафик]
  * [Приложение 4: С помощью tooview метрики и журнала данных Excel]
  * [Приложение 5. Мониторинг с использованием Application Insights для Visual Studio Team Services]

## <a name="introduction"></a>Введение
Проблемы, связанные с этого руководства показано вы как toouse функции например аналитики хранилища Azure, ведение журнала на стороне клиента в hello клиентская библиотека хранилища Azure и других tooidentify сторонних средств диагностики и устранения хранилища Azure.

![][1]

Это руководство предназначено предполагаемого toobe чтения преимущественно разработчиками Интернет-служб, использующих службы хранилища Azure и ИТ-специалистов, ответственных за управление таких Интернет-служб. Цель данного руководства Hello являются:

* toohelp Ведение hello работоспособности и производительности учетных записей хранилища Azure.
* tooprovide вы с процессами необходимые hello и решить, если проблема или проблема в приложении относится tooAzure хранения toohelp средства.
* с функциональной рекомендации по решению проблем, связанных с tooAzure хранилища tooprovide.

### <a name="how-this-guide-is-organized"></a>Структура руководства
Здравствуйте, раздел «[мониторинга службы хранения]» описывает, каким образом toomonitor hello работоспособность и производительность служб хранения Azure с помощью метрики аналитики хранилища Azure (метрик хранилища).

Здравствуйте, раздел "[Диагностика неполадок хранилища]» описывает, каким образом toodiagnose проблемы с помощью Azure журнала службы аналитики хранилища (ведения журнала хранилища). Он также описывает, как tooenable ведение журнала на стороне клиента с помощью hello средства в одном hello клиентские библиотеки, такие как hello клиентской библиотеки хранилища для .NET или hello Azure SDK для Java.

Здравствуйте, раздел «[конца в конец трассировки]» описывает, каким образом вы можете соотнести hello сведения, содержащиеся в различные файлы журналов и данных метрик.

Здравствуйте, раздел «[рекомендации по ее устранению]» предоставляет рекомендации по устранению неполадок для некоторых hello общих хранилищах проблемы могут возникнуть.

Hello»[приложения]» включают сведения об использовании других средств, таких как Wireshark и сетевой монитор для анализа сетевых пакетов данных, Fiddler для анализа сообщения HTTP или HTTPS и Microsoft Message Analyzer для корреляции данных журнала.

## <a name="monitoring-your-storage-service"></a>Мониторинг службы хранилища
Если вы знакомы с системным монитором Windows, то можете считать, что метрики хранилища — эквивалент счетчиков службы хранилища Azure. Метрики хранилища вы найдете полный набор показателей (счетчики монитора производительности терминологию), например доступность службы, общее число запросов tooservice или процент успешных запросов tooservice. Полный список доступных показателей hello см. в разделе [схема таблицы метрик аналитики хранилища](http://msdn.microsoft.com/library/azure/hh343264.aspx). Можно указать, хотите ли вы toocollect службы хранилища hello и статистические показатели, каждый час или каждую минуту. Дополнительные сведения о tooenable метрики и монитор учетных записей хранилища. в статье [Включение метрик хранилища и просмотр данных метрик](http://go.microsoft.com/fwlink/?LinkId=510865).

Можно выбрать, какие часовых метрик требуется toodisplay в hello [портал Azure](https://portal.azure.com) и настройка правил, которые уведомления администраторов по электронной почте каждый раз, когда почасовые метрики превышает определенный порог. Дополнительные сведения см. в статье [Создание оповещений для служб Azure с помощью портала Azure](../monitoring-and-diagnostics/insights-receive-alert-notifications.md). 

Служба хранилища Hello собирает метрики, используя максимум усилий, но не может быть записано каждой операции хранилища.

В hello портал Azure вы сможете метрик, таких как доступность, общее количество запросов и среднее время задержки чисел для учетной записи хранения. Правила уведомления также настроен tooalert администратора при доступности падает ниже определенного уровня. Просматривать эти данные, одна область, возможных для изучения — hello таблицы службы успешно значение в процентах, менее 100% (Дополнительные сведения см в разделе hello»[метрики низкий PercentSuccess или аналитика записи журнала операций с состояние транзакции ClientOtherErrors]»).

Необходимо постоянно отслеживать tooensure вашего приложения Azure, они являются работоспособными и выполнение, как ожидалось:

* Установление некоторые базовые показатели для приложения, включает вы toocompare текущих данных и идентификации никаких значительных изменений в поведение hello хранилища Azure и приложения. Hello значениями базовые показатели во многих случаях будут в зависимости от приложения и при работе приложения, тестирующего производительность, их необходимо установить.
* Запись минутных метрик и их использованием toomonitor активно для непредвиденных ошибок и аномалии, например всплески подсчеты количества ошибок или частоты запросов.
* Запись часовых метрик и их использование toomonitor средние значения таких как среднее значение количества ошибок и частоты запросов.
* Анализ потенциальных проблем, с помощью средств диагностики, как описано далее в разделе hello»[Диагностика неполадок хранилища].»

диаграммы Hello в следующие изображения hello иллюстрируют, как hello вычисление среднего значения, выполняемое для почасовых метрик можно скрыть пики в действии. часовые показатели Hello отображать tooshow постоянной скоростью запросов, при метрики выявить колебания hello, встречаются действительно минуту hello.

![][3]

Hello в этом разделе описываются метриках, необходимо отслеживать и почему.

### <a name="monitoring-service-health"></a>Мониторинг работоспособности службы
Можно использовать hello [портал Azure](https://portal.azure.com) tooview hello работоспособности службы хранилища hello (и другие службы Azure) во всех hello Azure регионах по всему Здравствуй, мир. Это позволяет toosee немедленно Если проблемы за пределами вашего элемента управления влияет hello службы хранения в регионе hello, используемого для вашего приложения.

Hello [портал Azure](https://portal.azure.com) может также предоставлять уведомления для инцидентов, затрагивающих hello различных служб Azure.
Примечание: Эти сведения были доступны ранее, и данные предыстории, на hello [панель мониторинга службы Azure](http://status.azure.com).

При hello [портал Azure](https://portal.azure.com) собирает сведения о работоспособности из внутри Здравствуйте центрами обработки данных Azure (мониторинг внутри out), можно также рассмотреть, периодически внедрение за пределами подход toogenerate искусственные транзакции доступ к размещенной в Azure веб-приложения в разных местах. Здравствуйте, услугах, предлагаемых [Dynatrace](http://www.dynatrace.com/en/synthetic-monitoring) и Application Insights для Visual Studio Team Services являются примерами такого подхода в снаружи. Дополнительные сведения об Application Insights для Visual Studio Team Services см. в разделе приложение hello»[приложение 5: отслеживание с помощью Application Insights для Visual Studio Team Services](#appendix-5).»

### <a name="monitoring-capacity"></a>Мониторинг мощностей
Метрики хранилища хранит только метрики емкости для службы BLOB-объектов hello потому что BLOB-объекты обычно учитывает hello наибольшее долю сохраненных данных (на момент написания статьи hello, оно не возможные toouse метрик хранилища toomonitor hello емкость таблицы и очереди) . Эти данные можно найти в hello **$MetricsCapacityBlob** таблицы при включении мониторинга для hello службы BLOB-объектов. Метрики хранилища записывает следующие данные один раз в день, а также можно использовать значение hello hello **RowKey** toodetermine ли строка hello содержит сущность, которая связывает toouser данных (значение **данных**) или данные (аналитика значение **analytics**). Каждая сущность хранимых содержит сведения о hello объем используемого хранилища (**емкость** в байтах) и hello текущее число контейнеров (**ContainerCount**) и больших двоичных объектов ( **ObjectCount**) используется в учетной записи хранилища hello. Дополнительные сведения о метриках емкости hello, хранящихся в hello **$MetricsCapacityBlob** таблицы см. в разделе [схема таблицы метрик аналитики хранилища](http://msdn.microsoft.com/library/azure/hh343264.aspx).

> [!NOTE]
> Эти значения для ранним предупреждением приближении hello ограничения емкости вашей учетной записи хранилища, необходимо отслеживать. В hello портал Azure можно добавить toonotify правила оповещения, если использование статистических хранилища превышает или падает ниже пороговых значений, которые указываются.
> 
> 

Дополнительные сведения о предполагаемый размер hello различные хранилища объектов, таких как большие двоичные объекты см hello записи блога [основные сведения о хранилище выставления счетов Azure — пропускная способность, транзакции и емкость](http://blogs.msdn.com/b/windowsazurestorage/archive/2010/07/09/understanding-windows-azure-storage-billing-bandwidth-transactions-and-capacity.aspx).

### <a name="monitoring-availability"></a>Мониторинг доступности
Необходимо отслеживать hello доступности служб хранилища hello в вашей учетной записи хранилища наблюдая за значение hello в hello **доступности** столбца в hello таблицах метрик каждый час или раз в минуту — **$ MetricsHourPrimaryTransactionsBlob**, **$MetricsHourPrimaryTransactionsTable**, **$MetricsHourPrimaryTransactionsQueue**, **$ MetricsMinutePrimaryTransactionsBlob**, **$MetricsMinutePrimaryTransactionsTable**, **$MetricsMinutePrimaryTransactionsQueue**, **$ MetricsCapacityBlob**. Hello **доступности** столбец содержит процентное значение, указывающее доступность hello hello службы или операции hello API, представляемого строкой hello (hello **RowKey** показывает, содержит ли строка hello метрики для службы hello в целом или для определенной операции API).

Если значение меньше 100 %, это означает, что некоторые запросы к хранилищу не были выполнены. Можно увидеть, почему сбой изучив hello других столбцов в данных метрик hello, отображение номеров hello запросов с различные типы ошибок, такие как **ServerTimeoutError**. Следует ожидать toosee **доступности** Осень временно менее 100%, по причинам, например время ожидания временного сервера службы hello перемещает запрос балансировать секции toobetter; hello логику в клиентском приложении повторных попыток должен обрабатывать такие временные условия. статья Hello [операций ведения журнала аналитики хранилища и сообщения о состоянии](http://msdn.microsoft.com/library/azure/hh343260.aspx) списки hello типы транзакций, которые метрик хранилища включает в его **доступности** вычисления.

В hello [портал Azure](https://portal.azure.com), можно добавить правила оповещения toonotify вы Если **доступности** для службы падает ниже порогового значения, можно указать.

Hello»[рекомендации по ее устранению]"данного руководства описываются некоторые общие хранилища службы проблемы связанные tooavailability.

### <a name="monitoring-performance"></a>Мониторинг производительности
производительность hello toomonitor hello служб хранилища, можно использовать hello следующую метрики из hello каждый час и минуты таблицах метрик.

* Здравствуйте, значения в hello **AverageE2ELatency** и **AverageServerLatency** столбцы показывают службы хранилища hello среднее время hello или тип операции API занимает tooprocess запросов. **AverageE2ELatency** — это мера задержка начала до конца, включающий hello время tooread hello запроса и отправка ответа hello в запросе hello tooprocess на время, затраченное toohello сложения (поэтому включает задержки в сети после запроса hello Служба хранилища hello достигает); **AverageServerLatency** — это мера только время обработки hello и поэтому исключает любые связанные задержки в сети toocommunicating с клиентом hello. Hello в разделе «[метрики показывают AverageE2ELatency высокой и низкой AverageServerLatency]» далее в этом руководстве, сведения о том, почему могут существовать значительные различия между этими двумя значениями.
* Здравствуйте, значения в hello **TotalIngress** и **TotalEgress** столбцы показывают hello общий объем данных, в байтах, поступающих в tooand переходом из службы хранилища или с помощью определенного типа операции API.
* Здравствуйте, значения в hello **TotalRequests** получения столбца Показать hello общее число запросов, которые hello службы хранилища из API-операции. **TotalRequests** — общее количество запросов, получаемых службой хранилища hello hello.

Обычно выполняется мониторинг неожиданных изменений каждого из этих значений, так как это говорит о том, что возникла проблема, требующая внимания.

В hello [портал Azure](https://portal.azure.com), можно добавить правила оповещения toonotify вас, если любой из метрик производительности hello для этой службы падают ниже или превышает пороговое значение, указываемое.

Hello»[рекомендации по ее устранению]"данного руководства описываются некоторые общие хранилища службы проблемы связанные tooperformance.

## <a name="diagnosing-storage-issues"></a>Диагностика неполадок с хранилищем
Понять, что в приложении возникла проблема или неполадка, можно по нескольким признакам. Вот некоторые из них:

* Основные сбой, в результате работы toocrash или toostop приложения hello.
* Значительные изменения от базовые показатели hello метрик вы наблюдаете, как описано в предыдущем разделе hello»[мониторинга службы хранения].»
* сообщения от пользователей приложения, в которых сказано, что определенная операция не выполнена должным образом или что какая-то функция не работает;
* ошибки, сгенерированные приложением, о которых вы узнали из файлов журналов или благодаря полученным уведомлениям.

Как правило службы хранения связанных tooAzure проблемы подразделяются на четыре основных категории:

* Ваше приложение имеет проблемы с производительностью, о которых сообщает пользователям, либо выявленных при изменениях в метриках производительности hello.
* Существует проблема с инфраструктурой хранилища Azure hello в одну или несколько областей.
* Приложение возникли ошибки, выданные пользователям или выявленных при увеличенном одним hello ошибки счетчик показатели будут отслеживаться.
* Во время разработки и тестирования может потребоваться использовать hello локального эмулятора хранения; могут возникнуть некоторые проблемы, связанные специально toousage hello эмулятор хранилища.

Hello предполагает следующие шаги hello должен следовать toodiagnose и об устранении неполадок в каждой из этих четырех категорий. Здравствуйте, раздел «[рекомендации по ее устранению]» далее в этом руководстве приводятся подробные сведения для некоторых распространенных проблем, которые могут возникнуть.

### <a name="service-health-issues"></a>Проблемы с работоспособностью службы
Чаще всего проблемы с работоспособностью службы находятся вне вашего контроля. Hello [портал Azure](https://portal.azure.com) предоставляет сведения о любые текущие проблемы со службами Azure, включая службы хранилища. Если вы выбрали для географически избыточное хранилище с доступом для чтения, при создании учетной записи хранилища, затем в событии hello данных станет недоступной в основное расположение hello, приложение может временно переключиться toohello только для чтения копию в дополнительное расположение hello. toodo этого приложения должен быть доступ tooswitch между использованием места хранения первичного и вторичного hello и быть может toowork в режиме ограниченной функциональности с данных только для чтения. библиотеки Azure Storage Client Hello позволяют toodefine политику повтора, который может читать из вторичного хранилища в случае сбоя чтения из основного хранилища. Также приложению toobe знает, что данные hello в дополнительное расположение hello согласованным. Дополнительные сведения см. в статье блога hello [параметры избыточности хранилища Azure и доступ для чтения Geo Redundant Storage](https://blogs.msdn.microsoft.com/windowsazurestorage/2013/12/11/windows-azure-storage-redundancy-options-and-read-access-geo-redundant-storage/).

### <a name="performance-issues"></a>Проблемы с производительностью
Hello производительность приложения может быть Субъективная, особенно с точки зрения пользователя. Поэтому очень важно toohave базовые метрики доступных toohelp необходимо указать там, где возможны проблемы с производительностью. Множество факторов может повлиять на производительность hello службой хранилища Azure с точки зрения приложения клиента hello. Эти факторы могут работать в службе хранилища hello, hello клиента или hello сетевой инфраструктуре; Поэтому очень важно toohave стратегии для определения источника проблемы производительности hello hello.

После идентификации hello скорее всего, расположение hello причина проблем с производительностью hello из hello метрики можно toofind файлы журнала hello используйте подробные сведения о toodiagnose и устранение проблемы hello.

Здравствуйте, раздел "[рекомендации по ее устранению]» далее в этом руководстве предоставляет дополнительные сведения о некоторых общих производительности связанных проблем, которые могут возникнуть.

### <a name="diagnosing-errors"></a>Диагностика ошибок
Пользователи приложения может уведомлять ошибок, клиентское приложение hello. Система метрик хранилища также фиксирует количество ошибок разных типов, связанных со службами хранилища, в том числе **NetworkError** (Ошибка сети), **ClientTimeoutError** (Ошибка времени ожидания клиента) и **AuthorizationError** (Ошибка авторизации). В метриках хранилища фиксируется только количество ошибок каждого типа, но вы можете получить больше данных об отдельных запросах, просмотрев журналы на стороне сервера и клиента, а также сетевой журнал. Как правило код состояния HTTP hello, возвращенный службой хранения hello дадут представление о причинах сбоя запроса hello.

> [!NOTE]
> Помните, что следует ожидать toosee некоторых ошибок: например, ошибки из-за состояния сети tootransient или ошибок приложения.
> 
> 

Hello следующие ресурсы полезны для понимания того, коды состояний и ошибок, связанных с хранилищем:

* [Общие коды ошибок API-интерфейса REST](http://msdn.microsoft.com/library/azure/dd179357.aspx)
* [Коды ошибок службы BLOB-объектов](http://msdn.microsoft.com/library/azure/dd179439.aspx)
* [Коды ошибок службы очередей](http://msdn.microsoft.com/library/azure/dd179446.aspx)
* [Коды ошибок для службы таблиц](http://msdn.microsoft.com/library/azure/dd179438.aspx)
* [Коды ошибок файловой службы](https://msdn.microsoft.com/library/azure/dn690119.aspx)

### <a name="storage-emulator-issues"></a>Проблемы с эмулятором хранения
Hello Azure SDK включает эмулятор хранилища, которые можно запустить на рабочей станции разработки. Этот эмулятор имитирует большинство hello поведение служб хранилища Azure hello и используется во время разработки и тестирования, позволяя toorun приложениям, использующим службы хранилища Azure без hello, требуется подписка Azure и учетной записи хранилища Azure.

Hello»[рекомендации по ее устранению]"данного руководства описаны некоторые типичные проблемы, возникающие с помощью эмулятора хранилища hello.

### <a name="storage-logging-tools"></a>Инструменты для ведения журналов хранилища
Ведение журналов хранилища подразумевает запись в журнал на стороне сервера запросов к хранилищу в вашей учетной записи хранения Azure. Дополнительные сведения о том, как ведение журнала на стороне сервера tooenable и доступа hello журнала данных см. в разделе [Включение ведения журнала хранилища и доступ к данным журнала](http://go.microsoft.com/fwlink/?LinkId=510867).

Hello клиентская библиотека хранилища для .NET включает данные журнала клиента toocollect, связывающий toostorage операций, выполняемых приложением. Дополнительные сведения см. в разделе [входа hello клиентской библиотеки хранилища .NET на стороне клиента](http://go.microsoft.com/fwlink/?LinkId=510868).

> [!NOTE]
> В некоторых случаях (например, ошибки авторизации SAS) пользователь может сообщать об ошибках, для которого можно найти нет данные запроса в hello серверные хранилища журналов. Можно использовать hello ведения журнала клиентской библиотеки хранилища tooinvestigate hello hello причиной проблемы hello в случае на клиенте hello или использования сети hello tooinvestigate средства мониторинга сети.
> 
> 

### <a name="using-network-logging-tools"></a>Использование инструментов для ведения сетевого журнала
Можно фиксировать трафик hello между hello клиентских и серверных tooprovide подробные сведения о hello данных hello клиента и сервера, обмена и hello базового состояния сети. Ниже перечислены некоторые полезные инструменты для ведения сетевого журнала.

* [Fiddler](http://www.telerik.com/fiddler) — это бесплатные веб-отладка прокси-сервера, позволяющая tooexamine hello заголовки и полезные данные сообщения запроса и ответа HTTP и HTTPS. Дополнительные сведения см. в разделе [приложении 1: с помощью Fiddler toocapture HTTP и HTTPS-трафика](#appendix-1).
* [Microsoft сетевого монитора (Netmon)](http://www.microsoft.com/download/details.aspx?id=4865) и [Wireshark](http://www.wireshark.org/) являются свободных сетевых анализаторов протоколов, позволяющих tooview подробную информацию о пакетов для разнообразных сетевых протоколов. Дополнительные сведения о Wireshark см. в разделе «[приложении 2: сетевого трафика с помощью Wireshark toocapture](#appendix-2)».
* Microsoft Message Analyzer — приложение от Майкрософт, заменяет Netmon и, кроме toocapturing сетевую пакетов данных, помогает tooview и анализировать данные журнала hello, полученные из других средств. Дополнительные сведения см. в разделе «[приложении 3: сетевого трафика с помощью Microsoft Message Analyzer toocapture](#appendix-3)».
* Следует tooperform toocheck теста связности, что ваш клиентский компьютер может подключаться toohello службой хранилища Azure hello сети не поддерживается стандартном hello **ping** средства на приветствия клиента. Тем не менее, можно использовать hello [ **tcping** средство](http://www.elifulkerson.com/projects/tcping.php) toocheck подключения.

Во многих случаях данные журнала hello ведения журнала хранилища и hello клиентской библиотеки хранилища будет достаточно toodiagnose проблему, но в некоторых сценариях может потребоваться более подробные сведения, которые может предоставить эти инструменты ведения сетевых hello. Например с помощью Fiddler tooview включает сообщения HTTP и HTTPS, заголовка и полезных данных tooview отправленных tooand hello служб хранилища, к которым позволило бы tooexamine как клиентское приложение пытается выполнить операций сохранения. Анализаторами протоколов, таких как Wireshark работают на уровне пакетов hello, позволяя tooview TCP данные, что позволит tootroubleshoot потерянных пакетов и проблемы с подключением. Message Analyzer может работать как на уровне HTTP, так и на уровне TCP.

## <a name="end-to-end-tracing"></a>Комплексная трассировка
Комплексная трассировка с использованием разнообразных файлов журналов — это полезный метод выявления потенциальных проблем. Сведения даты и времени hello из данных метрик, можно использовать как значение, указывающее, где в файлах журнала hello hello toostart подробные сведения, которые помогут устранить проблему hello.

### <a name="correlating-log-data"></a>Сопоставление данных журналов
При просмотре журналов из клиентских приложений, отслеживает сети и серверные ведения журнала, он является запросов может toocorrelate критические toobe через hello различных файлах журналов. Hello журналы содержат ряд различных полей, которые используются как идентификаторы корреляции. ИД запроса клиента Hello: hello чаще toouse toocorrelate записи полей в различных журналах hello. Однако иногда бывает полезным toouse код запроса сервера hello или отметки времени. Hello следующие разделы содержат дополнительные сведения об этих параметрах.

### <a name="client-request-id"></a>Идентификатор запроса клиента
Клиентская библиотека хранилища Hello автоматически создает идентификатор запроса клиента, уникальный для каждого запроса.

* Hello журнала клиентской части, клиентская библиотека хранилища hello создает, появится идентификатор запроса клиента hello в hello **идентификатор запроса клиента** поле все записи журнала, связанные toohello запроса.
* В сетевой трассировки, например захвачено Fiddler, идентификатор запроса клиента hello отображается в сообщения запроса как hello **x-ms клиент request-id** значение заголовка HTTP.
* В журнале ведения журнала хранилища серверных hello hello идентификатор запроса клиента отображается в столбец идентификатора запроса клиента hello.

> [!NOTE]
> Это возможно, для нескольких запросов tooshare hello же идентификатор запроса клиента, поскольку hello клиента можно присвоить это значение (несмотря на то, что клиентская библиотека хранилища hello автоматически назначается новое значение). В случае hello повторных попыток от клиента hello, все попытки используют hello же идентификатор запроса клиента. В случае hello пакета, отправляемых с клиента hello hello пакете содержится код запроса клиента.
> 
> 

### <a name="server-request-id"></a>Идентификатор запроса сервера
Служба хранилища Hello автоматически создает идентификаторы запроса сервера.

* В журнале ведения журнала хранилища серверных hello, код запроса сервера hello отображается hello **заголовок идентификатора запроса** столбца.
* В сетевой трассировки, например захвачено Fiddler, код запроса сервера hello представляется в ответных сообщений hello **x-ms-request-id** значение заголовка HTTP.
* Hello журнала клиентской части, клиентская библиотека хранилища hello создает, появится код запроса сервера hello в hello **текст операции** столбца для записи журнала hello подробными сведениями о hello ответ сервера.

> [!NOTE]
> службы хранилища Hello всегда назначает уникальный сервер запрос идентификатор tooevery запросу получаемые им, поэтому каждой повторной попытке от клиента hello и каждой операции, включенной в пакет имеет уникальный идентификатор запроса.
> 
> 

Если hello клиентской библиотеки хранилища вызывает **StorageException** в клиенте hello hello **RequestInformation** свойство содержит **RequestResult** объект, который содержит **ServiceRequestID** свойство. Объект **RequestResult** также доступен в экземпляре **OperationContext**.

Hello в следующем примере показано как tooset пользовательского **ClientRequestId** значение путем присоединения **OperationContext** службы хранилища toohello запрос hello объекта. Здесь также показано, как tooretrieve hello **ServerRequestId** значение из ответное сообщение hello.

```csharp
//Parse hello connection string for hello storage account.
const string ConnectionString = "DefaultEndpointsProtocol=https;AccountName=account-name;AccountKey=account-key";
CloudStorageAccount storageAccount = CloudStorageAccount.Parse(ConnectionString);
CloudBlobClient blobClient = storageAccount.CreateCloudBlobClient();

// Create an Operation Context that includes custom ClientRequestId string based on constants defined within hello application along with a Guid.
OperationContext oc = new OperationContext();
oc.ClientRequestID = String.Format("{0} {1} {2} {3}", HOSTNAME, APPNAME, USERID, Guid.NewGuid().ToString());

try
{
    CloudBlobContainer container = blobClient.GetContainerReference("democontainer");
    ICloudBlob blob = container.GetBlobReferenceFromServer("testImage.jpg", null, null, oc);  
    var downloadToPath = string.Format("./{0}", blob.Name);
    using (var fs = File.OpenWrite(downloadToPath))
    {
        blob.DownloadToStream(fs, null, null, oc);
        Console.WriteLine("\t Blob downloaded toofile: {0}", downloadToPath);
    }
}
catch (StorageException storageException)
{
    Console.WriteLine("Storage exception {0} occurred", storageException.Message);
    // Multiple results may exist due tooclient side retry logic - each retried operation will have a unique ServiceRequestId
    foreach (var result in oc.RequestResults)
    {
            Console.WriteLine("HttpStatus: {0}, ServiceRequestId {1}", result.HttpStatusCode, result.ServiceRequestID);
    }
}
```

### <a name="timestamps"></a>Метки времени
Также можно использовать метки времени toolocate записи журнала, связанные с, но при этом следует соблюдать осторожность, любые рассогласования между hello клиентом и сервером, который может существовать часов. Необходимо найти плюс или минус 15 минут в течение совпадающих записей серверное по меткам времени hello на приветствия клиента. Помните, что метаданные большого двоичного объекта hello hello больших двоичных объектов, содержащий показатели указывает диапазон времени hello для метрик hello, хранимых в большом двоичном объекте hello; Это полезно, если имеется много больших двоичных объектов метрики для hello одной минуты или час.

## <a name="troubleshooting-guidance"></a>Рекомендации по устранению неполадок
Этот раздел поможет вам с hello диагностики и устранения неполадок с некоторых распространенных проблем hello приложения могут возникнуть при использовании служб хранилища Azure hello. Используйте список hello ниже toolocate hello соответствующие tooyour сведения о конкретной проблеме.

**Дерево решений по устранению неполадок**

---
Связана ли проблема производительности toohello одну из служб хранения hello?

* [метрики показывают AverageE2ELatency высокой и низкой AverageServerLatency]
* [Метрики показывают низкое AverageE2ELatency и низким AverageServerLatency, но клиент hello наблюдается большая задержка]
* [Метрики содержат высокие значения AverageServerLatency]
* [При доставке сообщений в очередь возникают неожиданные задержки]

---
Связана ли проблема toohello доступность одной из служб хранения hello?

* [Метрики указывают на увеличение значения PercentThrottlingError]
* [метрики увеличить PercentTimeoutError]
* [Метрики показывают увеличение значения PercentNetworkError]

---
 Получает ли клиентское приложение ответ HTTP 4XX (например, с кодом 404) от службы хранилища?

* [Hello клиент получает сообщения HTTP 403 (запрещено)]
* [Получает ошибки HTTP 404 (не найдено) сообщения приветствия клиента]
* [Получает HTTP 409 (конфликт) сообщения приветствия клиента]

---
[метрики низкий PercentSuccess или аналитика записи журнала операций с состояние транзакции ClientOtherErrors]

---
[Метрики объема показывают неожиданное увеличение использования объема хранилища]

---
[Происходит неожиданный перезапуск виртуальных машин, имеющих большое количество виртуальных жестких дисков]

---
[Проблемы возникают из-за использование эмулятора хранилища hello для разработки или тестирования]

---
[Возникающие проблемы с установкой hello Azure SDK для .NET]

---
[Возникла другая проблема со службой хранилища]

---
### <a name="metrics-show-high-AverageE2ELatency-and-low-AverageServerLatency"></a>Метрики содержат высокие значения AverageE2ELatency и низкие значения AverageServerLatency
Здравствуйте, на рисунке ниже из hello [портал Azure](https://portal.azure.com) средство наблюдения за показан пример, где hello **AverageE2ELatency** значительно больше, чем hello **AverageServerLatency**.

![][4]

Примечание, служба хранилища hello вычисляет только метрики hello **AverageE2ELatency** для успешных запросов и, в отличие от **AverageServerLatency**, включает время hello hello-клиент выполняет toosend hello данные и получать подтверждения от службы хранилища hello. Таким образом, разница между **AverageE2ELatency** и **AverageServerLatency** может быть либо из-за toohello клиентских приложений, медленный toorespond или из-за tooconditions сети hello.

> [!NOTE]
> Можно также просмотреть **E2ELatency** и **ServerLatency** для отдельных операций сохранения в hello ведения журнала хранилища данных журналов.
> 
> 

#### <a name="investigating-client-performance-issues"></a>Изучение проблем с производительностью клиента
Возможные причины медленно отвечать на запросы клиента hello включать не ограниченное число доступных подключений или потоки или недостатка ресурсов, таких как пропускной способности ЦП, памяти или сети. Может быть проблема может tooresolve hello, изменив toobe кода hello клиента более эффективно (например с помощью службы хранилища toohello асинхронных вызовов), либо с помощью большего размера виртуальной машины (с нескольких ядер и объем памяти).

Для служб таблиц и очередей hello, алгоритм Nagle hello также может привести к высокой **AverageE2ELatency** при сравнении слишком**AverageServerLatency**: Дополнительные сведения в разделе блога hello [Nagle Алгоритм — не понятное для небольших запросов](http://blogs.msdn.com/b/windowsazurestorage/archive/2010/06/25/nagle-s-algorithm-is-not-friendly-towards-small-requests.aspx). Можно отключить алгоритм Nagle hello в коде с помощью hello **ServicePointManager** класса в hello **System.Net** пространства имен. Это следует сделать до любой таблицы toohello вызовы или откройте службы очередей в приложении, так как это не влияет на подключения, которые уже. Hello в примере берется из hello **Application_Start** метод в рабочей роли.

```csharp
var storageAccount = CloudStorageAccount.Parse(connStr);
ServicePoint tableServicePoint = ServicePointManager.FindServicePoint(storageAccount.TableEndpoint);
tableServicePoint.UseNagleAlgorithm = false;
ServicePoint queueServicePoint = ServicePointManager.FindServicePoint(storageAccount.QueueEndpoint);
queueServicePoint.UseNagleAlgorithm = false;
```

Вы должны проверить toosee журналы на стороне клиента hello сколько клиентского приложения Отправка запросов и поиск Общие .NET, связанные с узкие места производительности в клиентском приложении, такие как ЦП, сборщик мусора .NET, использование сети или памяти. В качестве отправной точки для устранения неполадок в клиентских приложениях .NET используйте статью [Debugging, Tracing, and Profiling](http://msdn.microsoft.com/library/7fe0dd2y) (Отладка, трассировка и профилирование).

#### <a name="investigating-network-latency-issues"></a>Изучение проблем, связанных с задержками в сети
Как правило большая задержка начала до конца, вызванные hello сети — из-за tootransient условия. Изучить временные и постоянные неполадки сети, например потерю пакетов, можно с помощью таких средств, как Wireshark или анализатор сообщений Майкрософт.

Дополнительные сведения об использовании Wireshark tootroubleshoot сетевых проблем см. в разделе «[приложение 2: с помощью Wireshark toocapture сетевой трафик].»

Дополнительные сведения об использовании Microsoft Message Analyzer tootroubleshoot сетевых проблем см. в разделе «[приложение 3: с помощью Microsoft Message Analyzer toocapture сетевой трафик].»

### <a name="metrics-show-low-AverageE2ELatency-and-low-AverageServerLatency"></a>Метрики показывают низкое AverageE2ELatency и низким AverageServerLatency, но клиент hello наблюдается большая задержка
В этом сценарии hello наиболее вероятная причина-задержка запросов к хранилищу hello достижение hello службы хранилища. Следует изучить, почему запросы от клиента hello не выполняют его через toohello BLOB-объектов.

Одна из возможных причин задержки при отправке запросов клиента hello является ограниченное число доступных подключений или потоков.

Необходимо также проверить, является ли клиент hello выполнение нескольких повторных попыток и исследовать причины hello случае hello. toodetermine ли hello клиент выполняет несколько попыток, вы можете:

* Изучите журналы аналитики хранилища hello. Если несколько попыток выполняются операции, вы увидите несколько операций с hello же идентификатор запроса клиента, но с другим сервером запросов идентификаторы.
* Изучите журналы клиента hello. Подробное ведение журнала позволит определить наличие повторной попытки.
* Отладку кода и проверьте свойства hello hello **OperationContext** объект, связанный с запросом hello. Если запустить операцию hello hello **RequestResults** свойство будет включать несколько запроса на сервере уникальные идентификаторы. Можно также проверить hello начала и окончания времени для каждого запроса. Дополнительные сведения см. образец кода hello в разделе "hello" [код запроса сервера].

Если нет никаких проблем в клиенте hello, необходимо проверить потенциальных проблемах сети, например потеря пакетов. Можно использовать средства, такие как проблемы с сетевым tooinvestigate Wireshark или Microsoft Message Analyzer.

Дополнительные сведения об использовании Wireshark tootroubleshoot сетевых проблем см. в разделе «[приложение 2: с помощью Wireshark toocapture сетевой трафик].»

Дополнительные сведения об использовании Microsoft Message Analyzer tootroubleshoot сетевых проблем см. в разделе «[приложение 3: с помощью Microsoft Message Analyzer toocapture сетевой трафик].»

### <a name="metrics-show-high-AverageServerLatency"></a>Метрики содержат высокие значения AverageServerLatency
В случае hello высокий **AverageServerLatency** для запросов на загрузку большого двоичного объекта, следует использовать hello ведения журнала хранилища регистрирует toosee, если имеются повторяющиеся запросы для hello же больших двоичных объектов (или набор больших двоичных объектов). Для большого двоичного объекта передавать запросы, следует проверить, какой блок размер hello клиентом (например, меньше 64 КБ в размере может привести к накладных расходов, если считывает hello также присутствуют в блоках меньше 64 КБ фрагментов данных), и если несколько клиентов отправляете блокирует toohello же BLOB-объектов в параллельном режиме. Необходимо также проверить показатели hello / мин для всплески hello число запросов, которые приводят к превышению hello на второй целевые показатели масштабируемости: см. также "[метрики увеличить PercentTimeoutError].»

Если вы видите большое **AverageServerLatency** запросов на загрузку большого двоичного объекта при будут повторяться запросы hello же большой двоичный объект или набор больших двоичных объектов, затем следует предусмотреть кэширование этих больших двоичных объектов с помощью кэша Azure или hello доставки содержимого Azure Сети (CDN). Для отправки запросов может повысить пропускную способность hello с помощью больший размер блока. Для запросов tootables, это также возможно tooimplement клиентским кэшированием на клиенты, выполняющие hello операций запросов и где hello данные изменяются редко.

Высокий уровень **AverageServerLatency** значения также может быть признаком плохо спроектированные таблиц или в запросы, что приведет к операции сканирования или, выполните hello append и начале антишаблон. Дополнительные сведения см. в разделе [Метрики указывают на увеличение значения PercentThrottlingError].

> [!NOTE]
> Подробный контрольный список обеспечения производительности можно найти в статье [Производительность хранилища Microsoft Azure и контрольный список масштабируемости](storage-performance-checklist.md).
> 
> 

### <a name="you-are-experiencing-unexpected-delays-in-message-delivery"></a>При доставке сообщений в очередь возникают неожиданные задержки
При наличии задержки между моментом hello приложение добавляет сообщение tooa очереди и hello времена, когда она станет доступной tooread из очереди hello, а затем необходимо выполнить следующие шаги toodiagnose hello проблема hello:

* Убедитесь, что приложение hello успешно состоит в добавлении очереди toohello сообщения hello. Проверьте, что приложение hello не восстанавливается hello **AddMessage** метода несколько раз, прежде чем следующему. Клиентская библиотека хранилища журналов Hello покажет повторные попытки повторных операций хранилища.
* Убедитесь, что отсутствуют координации hello рабочая роль, добавляет в очередь toohello сообщений hello и hello рабочей роли, считывающий приветственное сообщение из очереди hello, делающую отображаются, как если бы во время обработки возникает задержка.
* Проверьте, если происходит сбой hello рабочей роли, которая считывает из очереди hello сообщений hello. Если клиент очереди вызывает hello **GetMessage** но сбой метода toorespond с подтверждением, приветственное сообщение останется невидимыми для hello очереди до hello **invisibilityTimeout** этого срока. На этом этапе приветственное сообщение становится доступным для обработки.
* Проверьте, если длина очереди hello растет со временем. Это может произойти, если у вас недостаточно доступных tooprocess работников все hello сообщений, что другим работникам оказывает на очереди hello. Также следует проверять toosee hello метрики, если удалить запросов завершается ошибкой и hello dequeue счетчик на сообщения, которые могут указывать повторно сообщение hello toodelete неудачных попыток входа.
* В журналах hello ведения журнала хранилища для любой операции с очередью, имеющих более поздней версии, чем ожидалось **E2ELatency** и **ServerLatency** значения за более длительный период времени, чем обычно.

### <a name="metrics-show-an-increase-in-PercentThrottlingError"></a>Метрики показывают увеличение значения PercentThrottlingError
Ошибки регулирования возникают в случае превышения hello целевые показатели масштабируемости службы хранилища. Служба хранилища Hello делает это tooensure это ни один клиент не может использовать службу hello за счет hello других пользователей. Дополнительные сведения о целевых показателях масштабируемости для учетных записей хранения и целевых показателях производительности для секций внутри учетных записей хранения см. в разделе [Целевые показатели по производительности и масштабируемости для хранилища Azure](storage-scalability-targets.md).

Если hello **PercentThrottlingError** метрика увеличить процент запросов, которые завершились с ошибкой регулирования hello, вы должны tooinvestigate одного из двух сценариев:

* [Временное увеличение метрики PercentThrottlingError]
* [Постоянное увеличение метрики PercentThrottlingError]

Увеличение **PercentThrottlingError** часто возникает в hello же временем, определяемыми увеличение hello число запросов к хранилищу, или при первоначальном нагрузочное тестирование приложения. Это также может проявляться в клиенте hello как «503 занято сервера» или «500 истекло время ожидания операции» HTTP сообщения о состоянии от операций сохранения.

#### <a name="transient-increase-in-PercentThrottlingError"></a>Временное увеличение метрики PercentThrottlingError
Если вы видите всплески значение hello **PercentThrottlingError** , совпадающие во времени с помощью периодов высокой активности для приложения hello, следует реализовать в клиентском приложении (не линейной) экспоненциальной стратегию повторных попыток: это будет уменьшить hello немедленно нагрузку на раздел hello и помогают вашего приложения toosmooth пиковых уровней трафика. Дополнительные сведения о том, как с помощью политик повторных попыток tooimplement hello клиентской библиотеки хранилища см. в разделе [Microsoft.WindowsAzure.Storage.RetryPolicies имен](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.retrypolicies.aspx).

> [!NOTE]
> Можно также увидеть всплески значение hello **PercentThrottlingError** , не совпадают с периодов высокой активности для приложения hello: hello здесь наиболее вероятной причиной является перемещение секций tooimprove нагрузки службы хранилища hello балансировки.
> 
> 

#### <a name="permanent-increase-in-PercentThrottlingError"></a>Постоянное увеличение метрики PercentThrottlingError
Если вы видите стабильно высокое значение для **PercentThrottlingError** следующие постоянное увеличение, томов, транзакции, или при выполнении вашей начальной загрузки тестов для приложения, то нужно tooevaluate как приложение использует хранилища секций и ли приближается hello целевые показатели масштабируемости для учетной записи хранилища. Например если вы видите регулирования ошибок в очереди (который также считается одной секции), затем можно использовать дополнительные очереди toospread hello транзакции по нескольким секциям. Появление ошибки в таблице регулирования, необходимо tooconsider, с помощью различных toospread схему секционирования в транзакциях по нескольким секциям с помощью широкий диапазон значений ключа секции. Распространенная причина возникновения этой проблемы является hello начале append антишаблон где выберите дату hello в качестве ключа секции hello и все данные на определенный день записывается tooone секции: под нагрузкой, это может привести к образованию записи. Рекомендуем изменить схему секционирования или оценить возможность использования хранилища BLOB-объектов как более оптимального решения. Необходимо также проверить, если hello регулирование происходит в результате пики трафика и изучения способов сглаживания ваш шаблон обработки запросов.

При распространении транзакций по нескольким секциям, по-прежнему необходимо учитывать hello масштабируемость ограничений, заданных для учетной записи хранилища hello. Например, если используется десять очереди каждого hello обработки не более 2 000 сообщений размером 1 КБ в секунду, можно в hello общее ограничение в 20 000 сообщений в секунду для учетной записи хранения hello. Если вам требуется tooprocess более 20 000 сущностей в секунду, можно использовать несколько учетных записей хранения. Следует также иметь в виду такой hello размер запросов и сущностей оказывает влияние на когда служба хранилища hello регулирует клиентов: при наличии больших запросов и сущностей, то может регулироваться быстрее.

Конструктор запросов неэффективным может быть причиной ограничения масштабируемости hello toohit для секционированных таблиц. Например запрос с фильтром, выбирает только один процент hello сущностей в секции, но, просматривает все сущности hello в секции потребуется tooaccess каждой сущности. Каждая сущность чтения будут приниматься hello общее число транзакций в этой секции; Таким образом легко может достичь целей масштабирования hello.

> [!NOTE]
> Неэффективная структура запросов должна выявляться при тестировании производительности приложения.
> 
> 

### <a name="metrics-show-an-increase-in-PercentTimeoutError"></a>Метрики показывают увеличение значения PercentTimeoutError
Вы можете наблюдать увеличение метрики **PercentTimeoutError** для одной из служб хранилища. В hello же время hello клиент получает слишком большое количество сообщений о состоянии HTTP «500 истекло время ожидания операции» от операций сохранения.

> [!NOTE]
> Могут возникнуть ошибки времени ожидания временно как служба хранилища hello нагрузки запросов баланс, перемещая секции tooa нового сервера.
> 
> 

Hello **PercentTimeoutError** метрика агрегат hello следующие метрики: **ClientTimeoutError**, **AnonymousClientTimeoutError**,  **SASClientTimeoutError**, **ServerTimeoutError**, **AnonymousServerTimeoutError**, и **SASServerTimeoutError**.

время ожидания сервера Hello возникают из-за ошибки на сервере hello. время ожидания клиента Hello происходить, когда операция на сервере hello было превышено время ожидания hello, указанный клиентом hello; Например, клиент, использующий hello клиентской библиотеки хранилища можно задать время ожидания для операции с помощью hello **ServerTimeout** свойство hello **QueueRequestOptions** класса.

Время ожидания сервера указывает на проблему с помощью службы хранилища hello, требуется дополнительный анализ. Метрики toosee можно использовать, если предназначаются hello ограничения масштабируемости для службы hello и tooidentify какие-либо пики трафика, который может причиной проблемы. Если hello проблема временная, возможно, из-за балансировки tooload действия в службе hello. Если проблема hello является постоянным и не вызвана попадание ограничения масштабируемости hello hello службы приложения, необходимо вызвать возникшей проблемы. Для времени ожидания клиента необходимо решить, если время ожидания hello задано tooan соответствующее значение в клиенте hello и либо значение времени ожидания изменений hello задаются в клиенте hello или исследовать, как можно улучшить производительность hello операций hello в службе хранилища hello, для Пример, оптимизация запросов таблицы или уменьшив размер сообщений hello.

### <a name="metrics-show-an-increase-in-PercentNetworkError"></a>Метрики показывают увеличение значения PercentNetworkError
Вы можете наблюдать увеличение метрики **PercentNetworkError** для одной из служб хранилища. Hello **PercentNetworkError** метрика агрегат hello следующие метрики: **NetworkError**, **AnonymousNetworkError**, и  **SASNetworkError**. Это происходит при службы хранилища hello обнаруживает ошибку сети, когда hello клиент делает запрос хранилища.

Hello наиболее распространенной причиной этой ошибки является клиентом отключения до истечения времени ожидания в службе хранилища hello. Необходимо проверить код hello в вашей toounderstand клиента, когда и почему hello отключится от службы хранилища hello. Можно также использовать Wireshark, Microsoft Message Analyzer или Tcping tooinvestigate проблемы с сетевым соединением с клиента hello. Эти средства, описанные в hello [приложения].

### <a name="the-client-is-receiving-403-messages"></a>Hello клиент получает сообщения HTTP 403 (запрещено)
Если клиентское приложение создает ошибки HTTP 403 (запрещено), вероятной причиной является, hello клиентом просроченных общих подписи доступа (SAS) при отправке запроса хранилища (хотя ключами часов наклона, недопустимый другие возможные причины и пустым заголовки). Ключ SAS истекшим сроком действия является причиной hello, не увидят все записи в hello серверных данных журнала хранилища. Hello следующей таблице показан пример из журнала клиентские hello, созданные hello клиентской библиотеки хранилища, который иллюстрирует появление этой проблемы:

| Источник | Уровень детализации | Уровень детализации | Идентификатор запроса клиента | Operation Text |
| --- | --- | --- | --- | --- |
| Microsoft.WindowsAzure.Storage |Информация |3 |85d077ab -… |Начинается выполнение операции с расположением «Основное» в режиме расположения PrimaryOnly. |
| Microsoft.WindowsAzure.Storage |Информация |3 |85d077ab -… |Запуск синхронный запрос toohttps://domemaildist.blob.core.windows.netazureimblobcontainer/blobCreatedViaSAS.txt?sv=2014-02-14&amp;sr = c&amp;si = mypolicy&amp;sig = OFnd4Rd7z01fIvh % 2BmcR6zbudIH2F5Ikm % 2FyhNYZEmJNQ % 3D&amp;api-version = 2014-02-14. |
| Microsoft.WindowsAzure.Storage |Информация |3 |85d077ab -… |Waiting for response (Ожидание ответа). |
| Microsoft.WindowsAzure.Storage |Предупреждение |2 |85d077ab -… |Исключение, которое выдается при ожидании ответа: hello удаленный сервер вернул ошибку: (403) запрещено... |
| Microsoft.WindowsAzure.Storage |Информация |3 |85d077ab -… |Response received. Код состояния = 403; идентификатор запроса = 9d67c64a-64ed-4b0d-9515-3b14bbcdc63d; Content-MD5 = ; ETag = . |
| Microsoft.WindowsAzure.Storage |Предупреждение |2 |85d077ab -… |Исключение, возникшее во время операции hello: hello удаленный сервер вернул ошибку: (403) запрещено... |
| Microsoft.WindowsAzure.Storage |Информация |3 |85d077ab -… |Проверка, если следует повторить операцию hello. Число повторных попыток = 0, код состояния HTTP 403, исключение = = hello удаленный сервер вернул ошибку: (403) запрещено... |
| Microsoft.WindowsAzure.Storage |Информация |3 |85d077ab -… |следующее расположение Hello задал tooPrimary, в зависимости от режима расположение hello. |
| Microsoft.WindowsAzure.Storage |Ошибка |1 |85d077ab -… |Retry policy did not allow for a retry. Появления hello удаленный сервер вернул ошибку: (403) запрещено. |

В этом случае следует проверить, почему срок действия маркера SAS hello перед hello клиент отправляет серверу маркера toohello hello:

* Обычно не следует задавать время начала, при создании SAS для toouse клиент немедленно. При наличии небольшого часов различия между узла hello создания с помощью SAS hello hello текущего времени и службы хранилища hello, то tooreceive службы hello хранения SAS, который еще не действителен.
* Не задавайте для SAS слишком короткий срок действия. Опять же, часов различия между узлом hello создания hello SAS и службы хранилища hello может привести tooa SAS внешне истекает раньше, чем ожидалось.
* Здравствуйте, параметр version в ключе SAS hello (например **sv = 2015-04-05**) соответствие версии hello hello использовании клиентской библиотеки хранилища? Рекомендуется всегда использовать последнюю версию hello hello [клиентской библиотеки хранилища](https://www.nuget.org/packages/WindowsAzure.Storage/).
* Повторное создание ключей доступа к хранилищу может привести к тому, что существующие токены SAS станут недействительными. Это может быть проблемой при создании маркера SAS с длинный срок для клиентских приложений toocache.

При использовании токенов SAS toogenerate hello клиентской библиотеки хранилища является просто toobuild допустимый токен. Тем не менее, если вручную создав маркеры SAS hello и использование интерфейса API REST хранилища hello следует внимательно прочитайте раздел hello [Делегирование доступа с подписью общего доступа](http://msdn.microsoft.com/library/azure/ee395415.aspx).

### <a name="the-client-is-receiving-404-messages"></a>Получает ошибки HTTP 404 (не найдено) сообщения приветствия клиента
Если клиентское приложение hello получает сообщение HTTP 404 (не найдено) с сервера hello, это означает, этот клиент hello hello объекта попытка toouse (например, сущность, таблицы, BLOB-объекта, контейнера или очереди) не существует в службе хранилища hello. Это может быть вызвано несколькими причинами, включая перечисленные ниже.

* [Hello клиента или другой процесс удален ранее hello объекта]
* [Проблема с авторизацией подписанного URL-адреса (SAS)]
* [Код JavaScript на стороне клиента не имеет разрешений tooaccess hello объекта]
* [Сбой сети]

#### <a name="client-previously-deleted-the-object"></a>Hello клиента или другой процесс удален ранее hello объекта
В сценариях, где hello клиент пытается tooread, обновления или удаления данных в службе хранилища, обычно легко tooidentify на стороне сервера hello записывает предыдущей операции, которые удалены из службы хранилища hello hello объекта. Очень часто данные журнала hello показывают, другого объекта удаленного hello пользователем или процессом. В журнале ведения журнала хранилища серверных hello hello тип операции и запрошенный объект ключа-столбцы показывают удаления объекта клиента.

В сценарии hello, где клиент пытается tooinsert объекта может оказаться неочевидным почему это приводит в ответе HTTP 404 (не найдено), учитывая, что hello клиента создается новый объект. Однако hello клиента при создании большого двоичного объекта, он должен быть контейнер больших двоичных объектов может toofind hello, hello клиента при создании сообщения, он должен быть доступ toofind очереди и добавляя строку hello клиента должен быть таблицы может toofind hello.

Можно использовать hello журнала клиентской части из toogain клиентской библиотеки хранилища hello, который возвращает более подробное представление о когда hello клиент отправляет определенные запросы toohello службы хранилища.

Hello следующий журнал клиентские библиотеки Storage Client hello иллюстрирует проблему hello hello клиенту не удается найти контейнер hello для hello большого двоичного объекта, который создается. Этот журнал содержит сведения о следующих операций сохранения hello:

| Request ID (ИД запроса) | Операция |
| --- | --- |
| 07b26a5d-... |**DeleteIfExists** контейнер больших двоичных объектов метод toodelete hello. Обратите внимание, что эта операция включает **HEAD** запроса toocheck наличие hello hello контейнера. |
| e2d06d78-… |**CreateIfNotExists** контейнер больших двоичных объектов метод toocreate hello. Обратите внимание, что эта операция включает **HEAD** запрос, который проверяет наличие hello hello контейнера. Hello **HEAD** возвращает сообщение, 404, но будет продолжена. |
| de8b1c3c-... |**UploadFromStream** метод toocreate hello и больших двоичных объектов. Hello **ПОМЕСТИТЬ** запрос завершится ошибкой с сообщением 404 |

Записи журнала:

| Request ID (ИД запроса) | Operation Text |
| --- | --- |
| 07b26a5d-... |Запуск toohttps://domemaildist.blob.core.windows.net/azuremmblobcontainer синхронный запрос. |
| 07b26a5d-... |StringToSign = HEAD............x-ms-client-request-id:07b26a5d-....x-ms-date:Tue, 03 Jun 2014 10:33:11 GMT.x-ms-version:2014-02-14./domemaildist/azuremmblobcontainer.restype:container. |
| 07b26a5d-... |Waiting for response (Ожидание ответа). |
| 07b26a5d-... |Response received. Status code = 200, Request ID = eeead849-...Content-MD5 = , ETag =    &quot;0x8D14D2DC63D059B&quot;. |
| 07b26a5d-... |Заголовки ответа были обработаны успешно, по rest hello hello операции. |
| 07b26a5d-... |Downloading response body (Загружается тело ответа). |
| 07b26a5d-... |Operation completed successfully (Операция выполнена успешно). |
| 07b26a5d-... |Запуск toohttps://domemaildist.blob.core.windows.net/azuremmblobcontainer синхронный запрос. |
| 07b26a5d-... |StringToSign = DELETE............x-ms-client-request-id:07b26a5d-....x-ms-date:Tue, 03 Jun 2014 10:33:12    GMT.x-ms-version:2014-02-14./domemaildist/azuremmblobcontainer.restype:container. |
| 07b26a5d-... |Waiting for response (Ожидание ответа). |
| 07b26a5d-... |Response received. Status code = 202, Request ID = eeead849-...Content-MD5 = , ETag = . (Ответ получен. Код состояния = 202, ИД запроса = eeead849-...Content-MD5 = , ETag = .) |
| 07b26a5d-... |Заголовки ответа были обработаны успешно, по rest hello hello операции. |
| 07b26a5d-... |Downloading response body (Загружается тело ответа). |
| 07b26a5d-... |Operation completed successfully (Операция выполнена успешно). |
| e2d06d78-... |Запуск toohttps://domemaildist.blob.core.windows.net/azuremmblobcontainer асинхронного запроса.</td> |
| e2d06d78-... |StringToSign = HEAD............x-ms-client-request-id:e2d06d78-....x-ms-date:Tue, 03 Jun 2014 10:33:12 GMT.x-ms-version:2014-02-14./domemaildist/azuremmblobcontainer.restype:container. |
| e2d06d78-... |Waiting for response (Ожидание ответа). |
| de8b1c3c-... |Запуск toohttps://domemaildist.blob.core.windows.net/azuremmblobcontainer/blobCreated.txt синхронный запрос. |
| de8b1c3c-... |StringToSign = PUT...64.qCmF+TQLPhq/YYK50mP9ZQ==........x-ms-blob-type:BlockBlob.x-ms-client-request-id:de8b1c3c-....x-ms-date:Tue, 03 Jun 2014 10:33:12 GMT.x-ms-version:2014-02-14./domemaildist/azuremmblobcontainer/blobCreated.txt. |
| de8b1c3c-... |Подготовка данных toowrite запроса. |
| e2d06d78-... |Исключение, которое выдается при ожидании ответа: hello удаленный сервер вернул ошибку: (404) не найдено... |
| e2d06d78-... |Response received. Status code = 404, Request ID = 353ae3bc-..., Content-MD5 = , ETag = . (Ответ получен. Код состояния = 404, ИД запроса = 353ae3bc-..., Content-MD5 = , ETag = .) |
| e2d06d78-... |Заголовки ответа были обработаны успешно, по rest hello hello операции. |
| e2d06d78-... |Downloading response body (Загружается тело ответа). |
| e2d06d78-... |Operation completed successfully (Операция выполнена успешно). |
| e2d06d78-... |Запуск toohttps://domemaildist.blob.core.windows.net/azuremmblobcontainer асинхронного запроса. |
| e2d06d78-... |StringToSign = PUT...0.........x-ms-client-request-id:e2d06d78-....x-ms-date:Tue, 03 Jun 2014 10:33:12 GMT.x-ms-version:2014-02-14./domemaildist/azuremmblobcontainer.restype:container. |
| e2d06d78-... |Waiting for response (Ожидание ответа). |
| de8b1c3c-... |Writing request data (Запись данных запроса). |
| de8b1c3c-... |Waiting for response (Ожидание ответа). |
| e2d06d78-... |Исключение, которое выдается при ожидании ответа: hello удаленный сервер вернул ошибку: (409) конфликт... |
| e2d06d78-... |Response received. Status code = 409, Request ID = c27da20e-..., Content-MD5 = , ETag = . (Ответ получен. Код состояния = 409, ИД запроса = c27da20e-..., Content-MD5 = , ETag = .) |
| e2d06d78-... |Downloading error response body (Загружается тело ответа с ошибкой). |
| de8b1c3c-... |Исключение, которое выдается при ожидании ответа: hello удаленный сервер вернул ошибку: (404) не найдено... |
| de8b1c3c-... |Response received. Status code = 404, Request ID = 0eaeab3e-..., Content-MD5 = , ETag = . (Ответ получен. Код состояния = 404, ИД запроса = 0eaeab3e-..., Content-MD5 = , ETag = .) |
| de8b1c3c-... |Исключение, возникшее во время операции hello: hello удаленный сервер вернул ошибку: (404) не найдено... |
| de8b1c3c-... |Retry policy did not allow for a retry. Появления hello удаленный сервер вернул ошибку: (404) не найдено... |
| e2d06d78-... |Retry policy did not allow for a retry. Появления hello удаленный сервер вернул ошибку: (409) конфликт... |

В этом примере hello журнала видно, что этот клиент hello чередованием запросы от hello **CreateIfNotExists** метод (запрос идентификатор e2d06d78...) с hello запросы от hello **UploadFromStream** метод () de8b1c3c-...); Это происходит потому, что клиентское приложение hello асинхронном вызове этих методов. Следует изменить асинхронного кода hello в tooensure hello клиента, что он создает контейнер hello перед выполнением tooupload любого большого двоичного объекта данных tooa в этом контейнере. В идеале нужно создавать все контейнеры заранее.

#### <a name="SAS-authorization-issue"></a>Проблема с авторизацией подписанного URL-адреса (SAS)
Клиентское приложение hello toouse ключ SAS, который не поддерживает hello необходимые разрешения для операции hello, если служба хранилища hello возвращает клиент toohello сообщения HTTP 404 (не найдено). В hello же время, вы также увидите ненулевое значение для **SASAuthorizationError** hello метрик.

Hello в следующей таблице показан пример журнала серверной части сообщения из файла журнала ведения журнала хранилища hello:

| Имя | Значение |
| --- | --- |
| Request start time (Время начала запроса) | 2014-05-30T06:17:48.4473697Z |
| Operation type (Тип операции)     | GetBlobProperties            |
| Request status (Состояние запроса)     | SASAuthorizationError        |
| HTTP status code (Код состояния HTTP)   | 404                          |
| Authentication type (Тип проверки подлинности)| SAS                          |
| Service type (Тип службы)       | BLOB-объект                         |
| Request URL (URL-адрес запроса)        | https://domemaildist.blob.core.windows.net/azureimblobcontainer/blobCreatedViaSAS.txt |
| nbsp;              |   ?sv=2014-02-14&sr=c&si=mypolicy&sig=XXXXX&;api-version=2014-02-14 |
| Request ID header  | a1f348d5-8032-4912-93ef-b393e5252a3b |
| Идентификатор запроса клиента  | 2d064953-8436-4ee0-aa0c-65cb874f7929 |


Следует изучить, почему клиентское приложение пытается tooperform, он не имеет разрешения для операции.

#### <a name="JavaScript-code-does-not-have-permission"></a>Код JavaScript на стороне клиента не имеет разрешений tooaccess hello объекта
Если вы используете клиент JavaScript и служб хранилища hello возвращает сообщения HTTP 404, необходимо проверить следующие ошибки JavaScript в браузере hello hello:

```
SEC7120: Origin http://localhost:56309 not found in Access-Control-Allow-Origin header.
SCRIPT7002: XMLHttpRequest: Network Error 0x80070005, Access is denied.
```

> [!NOTE]
> Можно использовать инструменты разработчика F12 hello в Internet Explorer tootrace hello сообщений, передаваемых между браузером hello и службы хранилища hello, при диагностике проблем JavaScript на стороне клиента.
> 
> 

Эти ошибки вызваны, так как веб-браузер hello реализует hello [политика одного источника](http://www.w3.org/Security/wiki/Same_Origin_Policy) обусловлены ограничения безопасности, который предотвращает вызова интерфейса API в другом домене со страницы приветствия hello домена на веб-странице.

toowork вокруг hello проблема JavaScript вы можете настроить Cross источника ресурсов для управления доступом (CORS) для службы hello hello хранилища клиент обращается к. Дополнительные сведения см. в статье [Cross-Origin Resource Sharing (CORS) Support for Azure Storage Services](http://msdn.microsoft.com/library/azure/dn535601.aspx) (Поддержка общего доступа к ресурсам независимо от источника (CORS) для служб хранилища Azure).

Hello, следующий пример кода показывает, как tooconfigure вашей службы BLOB-объектов tooallow JavaScript, которые выполняются в hello tooaccess домена Contoso большой двоичный объект в службе хранилища BLOB-объектов:

```csharp
CloudBlobClient client = new CloudBlobClient(blobEndpoint, new StorageCredentials(accountName, accountKey));
// Set hello service properties.
ServiceProperties sp = client.GetServiceProperties();
sp.DefaultServiceVersion = "2013-08-15";
CorsRule cr = new CorsRule();
cr.AllowedHeaders.Add("*");
cr.AllowedMethods = CorsHttpMethods.Get | CorsHttpMethods.Put;
cr.AllowedOrigins.Add("http://www.contoso.com");
cr.ExposedHeaders.Add("x-ms-*");
cr.MaxAgeInSeconds = 5;
sp.Cors.CorsRules.Clear();
sp.Cors.CorsRules.Add(cr);
client.SetServiceProperties(sp);
```

#### <a name="network-failure"></a>Сбой сети
В некоторых случаях потеряны сетевых пакетов может привести службы хранилища toohello возврат клиента toohello сообщения HTTP 404. Например, если клиентское приложение удаляет сущность из службы таблиц hello см hello клиента вызывать исключение отчетов хранилища «HTTP 404 (не найдено)» сообщение о состоянии от службы таблиц hello. При исследовании таблицы hello в службы хранилища таблиц hello вы видите, что hello службы был удален hello сущности по запросу.

сведения об исключении Hello в клиенте hello включают идентификатор запроса hello (7e84f12d), назначенный службой таблиц hello для запроса hello: можно использовать этот запрос сведения о toolocate hello в журналах hello хранилища на стороне сервера, выполняя поиск в hello  **заголовок запроса идентификатор** столбца в файле журнала hello. Можно также использовать tooidentify метрики hello при сбоев, такие как это возникают и выполните поиск по метрикам hello hello времени файлов журнала hello записываются ошибки. Это показывает запись журнала, hello delete завершилась сообщение о состоянии «Клиент HTTP (404) другая ошибка». Hello же записи журнала также включает идентификатор запроса hello, созданных клиентом hello в hello **client-request-id** столбца (813ea74f).

Журнал серверные Hello также включает в себя операции с hello же **client-request-id** значение (813ea74f) для успешной операции для удаления hello одной сущности и из hello же клиента. Эта операция успешно delete были внесены непосредственно перед hello не удалось удалить запрос.

Наиболее вероятной причиной Hello этот сценарий является этот hello клиент отправил запрос delete для hello сущности toohello таблицы службы, которая будет выполнена успешно, но не получил подтверждения с сервера hello (возможно из-за tooa временных проблем с сетью). Hello клиент затем повторная автоматическая попытка добавления hello операции (с помощью hello же **client-request-id**), и эта повторная попытка не удалась, поскольку hello сущность уже была удалена.

При частом возникновении этой проблемы следует изучить, почему клиент hello неудачной tooreceive подтверждения от службы таблиц hello. Если hello проблема временная, следует перехватывать ошибки «HTTP (404) не найден» hello и вход hello клиента, но разрешить hello toocontinue клиента.

### <a name="the-client-is-receiving-409-messages"></a>Получает HTTP 409 (конфликт) сообщения приветствия клиента
Hello следующей таблице показаны извлечения из журнала hello серверной части для двух операций клиента: **DeleteIfExists** немедленно, а затем **CreateIfNotExists** с помощью hello тем же именем контейнера больших двоичных объектов. Обратите внимание, что каждой операции клиента приводит к двух запросов, отправленных toohello сервера, сначала **GetContainerProperties** toocheck запрос если hello контейнер существует, за которыми следует hello **DeleteContainer** или  **CreateContainer** запроса.

| Timestamp | Операция | Результат | Имя контейнера | Идентификатор запроса клиента |
| --- | --- | --- | --- | --- |
| 05:10:13.7167225 |GetContainerProperties |200 |mmcont |c9f52c89-… |
| 05:10:13.8167325 |DeleteContainer |202 |mmcont |c9f52c89-… |
| 05:10:13.8987407 |GetContainerProperties |404 |mmcont |bc881924-… |
| 5:10:14.2147723 |CreateContainer |409 |mmcont |bc881924-… |

Hello код в клиентском приложении hello удаляет и немедленно повторно создает контейнер больших двоичных объектов с помощью hello таким же именем: hello **CreateIfNotExists** метод (запрос клиента идентификатор bc881924-...) в конечном итоге завершается hello HTTP 409 (конфликт) Произошла ошибка. Когда клиент удаляет контейнеров больших двоичных объектов, таблиц или очередей имеется короткий период перед именем hello снова становится доступной.

Hello клиентское приложение должно использовать контейнер уникальные имена, каждый раз при создании новых контейнеров, если hello удалите и снова создайте шаблон является общим.

### <a name="metrics-show-low-percent-success"></a>Метрики содержат низкие значения PercentSuccess, или в записях журналов аналитики присутствуют операции с состоянием транзакции ClientOtherErrors
Hello **PercentSuccess** метрика захватывает hello процентная доля операций, которые были выполнены на основе их кода состояния HTTP. Операции с кодом состояния 2XX подсчета успешно, в то время как операции с кодом состояния в диапазонах 3XX и 4XX или 5XX считаются неудачно и нижней hello **PercentSucess** значение метрики. В файлах журнала хранилища на стороне сервера hello, эти операции записываются с состоянием транзакции **ClientOtherErrors**.

Это важные toonote, что эти операции были завершены успешно и таким образом, не влияют на другие показатели, например доступность. Вот несколько примеров операций, которые при успешном выполнении могут сопровождаться кодами состояния HTTP, свидетельствующими о неудаче:

* **ResourceNotFound** (не найдено 404), например из GET запрос tooa больших двоичных объектов, не существует.
* **ResouceAlreadyExists** (409 конфликт), например из **CreateIfNotExist** операции, где hello ресурс уже существует.
* **ConditionNotMet** (не изменено 304), например из условной операции, например, если клиент отправляет **ETag** значение и HTTP **If-None-Match** toorequest заголовок тот образ, только если она была обновлена со времени последней операции hello.

Можно найти список распространенные коды ошибок API-Интерфейс REST, возвращающие hello служб хранилища на странице приветствия [распространенные коды ошибок REST API](http://msdn.microsoft.com/library/azure/dd179357.aspx).

### <a name="capacity-metrics-show-an-unexpected-increase"></a>Метрики объема показывают неожиданное увеличение использования объема хранилища
Если вы видите резким, непредвиденные изменения в использовании емкости вашей учетной записи хранилища можно исследовать hello причин при первом просмотре показатели доступности; Например увеличение hello количество неудачных запросов на удаление может привести tooan увеличение hello объем хранилища больших двоичных объектов, используемой как приложения определенные завершающие операции, которые можно было бы ожидать, что toobe освобождение пространства может не работать должным образом ( Пример, так как истек срок действия токенов SAS hello, используемых для освобождения места).

### <a name="you-are-experiencing-unexpected-reboots"></a>Происходит неожиданный перезапуск виртуальных машин Azure, имеющих большое количество виртуальных жестких дисков
Если виртуальной машины (ВМ) Azure имеет большое количество подключенных виртуальных жестких дисков, hello учетную запись хранения, может превысить hello целевые показатели масштабируемости для отдельной учетной записи хранения вызывает toofail hello виртуальной Машины. Вы должны проверить hello минутных метрик для учетной записи хранения hello (**TotalRequests**/**TotalIngress**/**TotalEgress**) для пиков длина которых превышает hello целевые показатели масштабируемости для учетной записи хранилища. Hello в разделе «[Метрики указывают на увеличение значения PercentThrottlingError]» для помощи в определении регулирования в вашей учетной записи хранилища произошла.

Как правило, каждой операции вывода виртуальный жесткий ДИСК из виртуальной машины или отдельных входных данных преобразует слишком**получить страницы** или **вставки страницы** операции над hello базовый страничного большого двоичного объекта. Таким образом, можно использовать hello оценка операций ввода-ВЫВОДА для вашей среды tootune сколько виртуальные жесткие диски могут в одной учетной записи хранения на основе определенного поведения приложения hello. Мы не рекомендуем использовать в одной учетной записи более 40 дисков. В разделе [целевые показатели производительности и масштабируемости хранилища Azure](storage-scalability-targets.md) сведения hello текущего целевые показатели масштабируемости для учетных записей хранилища, в частности hello всего запроса скорость и общая пропускная способность для hello тип учетной записи хранения вы используете .
Если превышено hello целевые показатели масштабируемости для вашей учетной записи, необходимо поместить виртуальные жесткие диски несколько hello действия tooreduce другое хранилище учетных записей в каждом отдельную учетную запись.

### <a name="your-issue-arises-from-using-the-storage-emulator"></a>Проблемы возникают из-за использование эмулятора хранилища hello для разработки или тестирования
Обычно использовать эмулятор хранилища hello во время разработки и тестирования tooavoid hello требования для учетной записи хранилища Azure. Hello распространенных проблем, которые могут возникнуть при использовании эмулятора хранилища hello являются:

* [Функция «X» не работает в эмуляторе хранилища hello]
* [Ошибка «hello значение одного из заголовков hello HTTP не правильный формат hello» при hello с помощью эмулятора хранилища]
* [Запущенный эмулятор хранилища hello требуются права администратора]

#### <a name="feature-X-is-not-working"></a>Функция «X» не работает в эмуляторе хранилища hello
Эмулятор хранилища Hello не поддерживает все функции hello hello служб хранилища Azure, такие как службы файлов hello. Дополнительные сведения см. в разделе [hello использование эмулятора хранилища Azure для разработки и тестирования](storage-use-emulator.md).

Для этих компонентов, которые hello хранилища эмулятор не поддерживает, использование службы хранилища Azure hello в облаке hello.

#### <a name="error-HTTP-header-not-correct-format"></a>Ошибка «hello значение одного из заголовков hello HTTP не правильный формат hello» при hello с помощью эмулятора хранилища
Тестировании приложения, такие как использовать hello клиентской библиотеки хранилища для hello локального хранилища эмулятора и вызов метода **CreateIfNotExists** сбой с ошибкой hello сообщение «hello значение одного из заголовков hello HTTP не находится в правильный формат Hello.» Это означает, что hello версию вы используете эмулятор хранилища hello не поддерживает версию hello использовании клиентской библиотеки хранилища hello. Клиентская библиотека хранилища Hello добавляет заголовок hello **x-ms-version** tooall hello запросы с ней. Если эмулятор хранения hello не распознает значение hello в hello **x-ms-version** заголовка, он отклоняет запрос hello.

Можно использовать hello библиотеки клиента хранения журналов toosee hello значение hello **заголовка x-ms-version** отправляет. Также можно увидеть значение hello объекта hello **заголовка x-ms-version** при использовании Fiddler tootrace hello запросы из клиентского приложения.

Этот сценарий обычно возникает в том случае, если установить и использовать последнюю версию клиентской библиотеки хранилища hello hello без обновления hello эмулятор хранилища. Необходимо установить последнюю версию эмулятора хранилища hello hello или использовать облачного хранилища вместо hello эмулятор для разработки и тестирования.

#### <a name="storage-emulator-requires-administrative-privileges"></a>Запущенный эмулятор хранилища hello требуются права администратора
Запрашиваются учетные данные администратора, при запуске эмулятора хранилища hello. Это происходит только при инициализации эмулятора хранения hello для hello первый раз. После инициализации эмулятора хранилища hello toorun правами администратора не требуется его еще раз.

Дополнительные сведения см. в разделе [hello использование эмулятора хранилища Azure для разработки и тестирования](storage-use-emulator.md). Обратите внимание, что можно инициализировать эмулятор хранилища hello в Visual Studio, которая будет также требуют прав администратора.

### <a name="you-are-encountering-problems-installing-the-Windows-Azure-SDK"></a>Возникающие проблемы с установкой hello Azure SDK для .NET
При попытке tooinstall hello SDK, происходит сбой при эмулятор хранилища hello tooinstall на локальном компьютере. журнал установки Hello содержит одно из следующих сообщений hello:

* CAQuietExec: Ошибка: не удается tooaccess экземпляр SQL
* CAQuietExec: Ошибка: не удается toocreate базы данных

Причина Hello проблема с существующим экземпляром LocalDB. По умолчанию hello эмулятор хранилища использует LocalDB toopersist данных при его моделирует службы хранилища Azure hello. Экземпляре LocalDB можно сбросить, выполнив следующие команды в окно командной строки перед попыткой tooinstall hello SDK hello.

```
sqllocaldb stop v11.0
sqllocaldb delete v11.0
delete %USERPROFILE%\WAStorageEmulatorDb3*.*
sqllocaldb create v11.0
```

Hello **удалить** команда удаляет все старые файлы базы данных из предыдущей установки эмулятора хранилища hello.

### <a name="you-have-a-different-issue-with-a-storage-service"></a>Возникла другая проблема со службой хранилища
Если предыдущие разделы по устранению неполадок hello не включают hello проблемы, которые возникают в службе хранилища, необходимо принимать hello, следуя toodiagnosing подход и устранении неполадок.

* Проверьте вашей toosee метрики, если изменения из вашего ожидаемое поведение базовой линией. От метрики hello может быть может toodetermine ли проблема hello временных или постоянных и какие операции хранилища hello проблема влияет на работу.
* Можно использовать toohelp поиска данных журнала серверные более подробные сведения об ошибках, возникающих информации метрик hello. Эти сведения могут помочь определить и устранить проблему hello.
* Если hello сведения в журналах серверные hello не является достаточно проблема hello tootroubleshoot успешно, можно использовать hello клиентской библиотеки хранилища журналов на стороне клиента tooinvestigate hello поведение клиентского приложения и средства, такие как Fiddler, Wireshark, и Microsoft Message Analyzer tooinvestigate вашей сети.

Дополнительные сведения об использовании Fiddler см. в разделе «[приложение 1: с помощью Fiddler toocapture HTTP и HTTPS-трафика].»

Дополнительные сведения об использовании Wireshark см. в разделе «[приложение 2: с помощью Wireshark toocapture сетевой трафик].»

Дополнительные сведения об использовании Microsoft Message Analyzer см. в разделе «[приложение 3: с помощью Microsoft Message Analyzer toocapture сетевой трафик].»

## <a name="appendices"></a>Приложения
приложения Hello описаны несколько средств, которые могут оказаться полезными при Диагностика и устранение неполадок в хранилище Azure (и другие службы). Эти средства не входят в состав службы хранилища Azure, а некоторые из них предоставляются сторонними разработчиками. Таким образом hello средства, описанные в этих приложениях не затрагиваются в каких-либо поддержки соглашений, которые может иметь с Microsoft Azure или хранилище Azure, и таким образом в процессе оценки следует изучить hello лицензирования и варианты поддержки доступны из Поставщики Hello этих средств.

### <a name="appendix-1"></a>Приложение 1: С помощью Fiddler toocapture HTTP и HTTPS-трафика
[Fiddler](http://www.telerik.com/fiddler) — это эффективное средство для анализа hello HTTP и HTTPS-трафика между клиентским приложением и службой хранилища Azure, вы используете hello.

> [!NOTE]
> Fiddler может декодировать трафика HTTPS; следует внимательно прочтите документацию Fiddler hello toounderstand как это делается и последствия для безопасности toounderstand hello.
> 
> 

В этом приложении предоставляет краткий пример как tooconfigure Fiddler toocapture трафик между hello локального компьютера, где вы установили Fiddler и hello служб хранилища Azure.

После запуска средства Fiddler оно начинает захват трафика HTTP и HTTPS на локальном компьютере. Hello ниже приведены некоторые полезные команды для управления Fiddler.

* Остановка и запуск захвата трафика. Hello главного меню, go слишком**файл** и нажмите кнопку **запись трафика** tootoggle захват и отключать.
* Сохранение захваченных данных трафика. Hello главного меню, go слишком**файл**, нажмите кнопку **Сохранить**и нажмите кнопку **все сеансы**: Это позволит вам toosave hello трафика в файл архива сеанса. Можно повторно загрузить в архиве сеанса позже для анализа или отправить его, если необходима поддержка tooMicrosoft.

toolimit hello объем трафика, который фиксирует Fiddler, можно использовать фильтры, настроенные в hello **фильтры** вкладку hello следующий снимок экрана показан фильтр, который перехватывает только трафик, отправленный toohello  **contosoemaildist.Table.Core.Windows.NET** конечную точку:

![][5]

### <a name="appendix-2"></a>Приложение 2: С помощью Wireshark toocapture сетевого трафика
[Wireshark](http://www.wireshark.org/) является анализатор сетевого протокола, который позволяет tooview подробную информацию о пакетов для разнообразных сетевых протоколов.

Hello ниже показано, как toocapture подробные сведения о пакете для входящего трафика с локального компьютера hello которой установлена служба таблицы toohello Wireshark в вашей учетной записи хранилища Azure.

1. Запустите Wireshark на локальном компьютере.
2. В hello **запустить** раздел, выберите hello интерфейса локальной сети или интерфейсы, которые являются подключенных toohello Интернета.
3. Щелкните **Capture Options**(Параметры захвата).
4. Добавление фильтра toohello **фильтр записи** текстового поля. Например **размещения contosoemaildist.table.core.windows.net** настроит Wireshark toocapture только для пакетов, отправляемых с hello конечную точку службы таблиц в hello tooor **contosoemaildist** хранилища Учетная запись. Извлечение hello [полный список фильтров записи](http://wiki.wireshark.org/CaptureFilters).
   
   ![][6]
5. Нажмите **Запуск**. При использовании клиентского приложения на локальном компьютере, Wireshark теперь соберет все hello tooor отправки пакетов из hello конечную точку службы таблиц.
6. После завершения, в главном меню выберите команду hello **захвата** и затем **остановить**.
7. toosave hello собранные данные в файле записи Wireshark, в главном меню выберите команду hello **файл** и затем **Сохранить**.

WireShark будут выделены все ошибки, которые существуют в hello **packetlist** окна. Можно также использовать hello **Expert сведения** окна (щелкните **анализ**, затем **Expert сведения**) tooview сводку ошибок и предупреждений.

![][7]

Также можно выбрать tooview hello TCP данных, как на уровне приложения hello видит его, щелкнув hello данных TCP и при выборе **поток TCP, выполните**. Это особенно полезно в том случае, если дамп был получен без использования фильтра захвата. Дополнительные сведения см. в разделе [Following TCP Streams](http://www.wireshark.org/docs/wsug_html_chunked/ChAdvFollowTCPSection.html) (Отслеживание потоков TCP).

![][8]

> [!NOTE]
> Дополнительные сведения об использовании Wireshark см. в разделе hello [руководстве пользователя Wireshark](http://www.wireshark.org/docs/wsug_html_chunked).
> 
> 

### <a name="appendix-3"></a>Приложение 3: С помощью Microsoft Message Analyzer toocapture сетевого трафика
Можно использовать Microsoft Message Analyzer toocapture HTTP и HTTPS-трафика в аналогичные tooFiddler способом и записи сетевого трафика в аналогичные tooWireshark способом.

#### <a name="configure-a-web-tracing-session-using-microsoft-message-analyzer"></a>Настройка сеанса трассировки веб-трафика с помощью анализатора сообщений Майкрософт
tooconfigure web сеанс трассировки для трафика HTTP и HTTPS, с помощью Microsoft Message Analyzer, запустите приложение Microsoft Message Analyzer hello, а затем на hello **файл** меню, нажмите кнопку **трассировкизаписи/**. В списке доступных трассировки сценариев hello выберите **веб-прокси**. Затем в hello **сценарий конфигурации трассировки** панели в hello **HostnameFilter** текстовое поле, добавьте имена hello конечные точки хранилища (можно найти эти имена в hello [портал Azure](https://portal.azure.com)). Например, если hello имя вашей учетной записи хранилища Azure — **contosodata**, следует добавить следующие toohello hello **HostnameFilter** текстового поля:

```
contosodata.blob.core.windows.net contosodata.table.core.windows.net contosodata.queue.core.windows.net
```

> [!NOTE]
> Пробел отделяет приветствия имен узлов.
> 
> 

Когда вы будете готовы toostart собранные данные, нажмите кнопку hello **Start With** кнопки.

Дополнительные сведения о Microsoft Message Analyzer hello **веб-прокси** трассировки см. в разделе [поставщика Microsoft PEF-WebProxy](http://technet.microsoft.com/library/jj674814.aspx).

встроенные Hello **веб-прокси** трассировки в Microsoft Message Analyzer основан на Fiddler; его можно записать трафика HTTPS на стороне клиента и Показать незашифрованные сообщения по протоколу HTTPS. Hello **веб-прокси** трассировка работает, настроив локальный прокси для всего трафика HTTP и HTTPS, предоставляющий доступ toounencrypted сообщений.

#### <a name="diagnosing-network-issues-using-microsoft-message-analyzer"></a>Диагностика неполадок сети с помощью анализатора сообщений Майкрософт
Кроме того, toousing hello Microsoft Message Analyzer **веб-прокси** toocapture сведений трассировки из Здравствуйте трафик HTTP/HTTPs между hello клиентского приложения и службы хранилища hello, можно также использовать встроенные hello  **Локальный канального** toocapture сетевых пакетов данные трассировки. Это позволяет, например, вы toocapture данных аналогично toothat захвата с Wireshark и диагностировать неполадки сетевого пропущенные пакеты.

Hello следующем снимке экрана показан пример **локального канального** трассировки с некоторыми **Информационное** сообщений hello **DiagnosisTypes** столбца. Щелкнув значок в hello **DiagnosisTypes** столбца отображаются подробные сведения об hello приветственное сообщение. В этом примере hello server повторно сообщение #305, так как не получено подтверждение от клиента hello:

![][9]

При создании сеанса трассировки hello в Microsoft Message Analyzer можно указать фильтры tooreduce hello количество шума в трассировке hello. На hello **записи / Trace** определение трассировки hello, нажмите на hello **Настройка** ссылку рядом слишком**Microsoft-Windows-NDIS-PacketCapture**. Следующий снимок экрана приветствия показана конфигурация, которая фильтрует трафик TCP для IP-адресов hello три служб хранилища:

![][10]

Дополнительные сведения о hello трассировки Microsoft сообщение анализатора локального канального см [поставщика Microsoft PEF-NDIS PacketCapture](http://technet.microsoft.com/library/jj659264.aspx).

### <a name="appendix-4"></a>Приложение 4: С помощью tooview метрики и журнала данных Excel
Многие средства позволяют toodownload hello метрик хранилища данных из хранилища Azure таблицы в формате с разделителями, он просто tooload hello данные в Excel для просмотра и анализа. Данные журналов хранилища, полученные из хранилища BLOB-объектов Azure, уже имеют формат с разделителями, и их можно загрузить в Excel. Тем не менее, потребуется tooadd соответствующие заголовки столбцов на основе сведений о hello в [формат журнала аналитики хранилища](http://msdn.microsoft.com/library/azure/hh343259.aspx) и [схема таблицы метрик аналитики хранилища](http://msdn.microsoft.com/library/azure/hh343264.aspx).

tooimport ведения журнала хранилища данных в Excel после можно загрузить из хранилища больших двоичных объектов:

* На hello **данные** меню, нажмите кнопку **из текста**.
* Файл журнала обзора toohello tooview и нажмите кнопку **импорта**.
* На первом шаге из hello **мастер импорта текста**выберите **Delimited**.

На первом шаге из hello **мастер импорта текста**выберите **запятой** как hello только разделитель и выберите двойных кавычек, как hello **ограничитель текста**. Нажмите кнопку **Готово** и выберите, где tooplace hello данных в книге.

### <a name="appendix-5"></a>Приложение 5. Мониторинг с использованием Application Insights для Visual Studio Team Services
Также можно использовать функции hello Application Insights для Visual Studio Team Services как часть вашего мониторинг производительности и доступности. Это средство предоставляет указанные ниже возможности.

* Проверка того, что веб-служба доступна и отвечает на запросы. Является ли приложение веб-сайт или приложение на устройстве, с использованием веб-службы, его тестирование можно URL-адрес, каждые несколько минут из расположений вокруг Здравствуй, мир!, а позволяют понять, если не удается.
* Быстрая диагностика любых проблем с производительностью или исключений в веб-службе. Определяйте, не исчерпаны ли ресурсы ЦП и другие ресурсы, получайте данные трассировки стека исключений и легко выполняйте поиск по журналам трассировки. Если hello падения производительности приложения под допустимых ограничений, мы отправим вам сообщение электронной почты. Вы можете отслеживать веб-службы .NET и Java.

Дополнительные сведения можно найти в статье [Что такое Azure Application Insights?](../application-insights/app-insights-overview.md).

<!--Anchors-->
[Введение]: #introduction
[Структура руководства]: #how-this-guide-is-organized

[мониторинга службы хранения]: #monitoring-your-storage-service
[Мониторинг работоспособности службы]: #monitoring-service-health
[Мониторинг мощностей]: #monitoring-capacity
[Мониторинг доступности]: #monitoring-availability
[Мониторинг производительности]: #monitoring-performance

[Диагностика неполадок хранилища]: #diagnosing-storage-issues
[Проблемы с работоспособностью службы]: #service-health-issues
[Проблемы с производительностью]: #performance-issues
[Диагностика ошибок]: #diagnosing-errors
[Проблемы с эмулятором хранения]: #storage-emulator-issues
[Инструменты для ведения журналов хранилища]: #storage-logging-tools
[Использование инструментов для ведения сетевого журнала]: #using-network-logging-tools

[конца в конец трассировки]: #end-to-end-tracing
[Сопоставление данных журналов]: #correlating-log-data
[Идентификатор запроса клиента]: #client-request-id
[код запроса сервера]: #server-request-id
[Метки времени]: #timestamps

[рекомендации по ее устранению]: #troubleshooting-guidance
[метрики показывают AverageE2ELatency высокой и низкой AverageServerLatency]: #metrics-show-high-AverageE2ELatency-and-low-AverageServerLatency
[Метрики показывают низкое AverageE2ELatency и низким AverageServerLatency, но клиент hello наблюдается большая задержка]: #metrics-show-low-AverageE2ELatency-and-low-AverageServerLatency
[Метрики содержат высокие значения AverageServerLatency]: #metrics-show-high-AverageServerLatency
[При доставке сообщений в очередь возникают неожиданные задержки]: #you-are-experiencing-unexpected-delays-in-message-delivery

[Метрики указывают на увеличение значения PercentThrottlingError]: #metrics-show-an-increase-in-PercentThrottlingError
[Временное увеличение метрики PercentThrottlingError]: #transient-increase-in-PercentThrottlingError
[Постоянное увеличение метрики PercentThrottlingError]: #permanent-increase-in-PercentThrottlingError
[метрики увеличить PercentTimeoutError]: #metrics-show-an-increase-in-PercentTimeoutError
[Метрики показывают увеличение значения PercentNetworkError]: #metrics-show-an-increase-in-PercentNetworkError

[Hello клиент получает сообщения HTTP 403 (запрещено)]: #the-client-is-receiving-403-messages
[Получает ошибки HTTP 404 (не найдено) сообщения приветствия клиента]: #the-client-is-receiving-404-messages
[Hello клиента или другой процесс удален ранее hello объекта]: #client-previously-deleted-the-object
[Проблема с авторизацией подписанного URL-адреса (SAS)]: #SAS-authorization-issue
[Код JavaScript на стороне клиента не имеет разрешений tooaccess hello объекта]: #JavaScript-code-does-not-have-permission
[Сбой сети]: #network-failure
[Получает HTTP 409 (конфликт) сообщения приветствия клиента]: #the-client-is-receiving-409-messages

[метрики низкий PercentSuccess или аналитика записи журнала операций с состояние транзакции ClientOtherErrors]: #metrics-show-low-percent-success
[Метрики объема показывают неожиданное увеличение использования объема хранилища]: #capacity-metrics-show-an-unexpected-increase
[Происходит неожиданный перезапуск виртуальных машин, имеющих большое количество виртуальных жестких дисков]: #you-are-experiencing-unexpected-reboots
[Проблемы возникают из-за использование эмулятора хранилища hello для разработки или тестирования]: #your-issue-arises-from-using-the-storage-emulator
[Функция «X» не работает в эмуляторе хранилища hello]: #feature-X-is-not-working
[Ошибка «hello значение одного из заголовков hello HTTP не правильный формат hello» при hello с помощью эмулятора хранилища]: #error-HTTP-header-not-correct-format
[Запущенный эмулятор хранилища hello требуются права администратора]: #storage-emulator-requires-administrative-privileges
[Возникающие проблемы с установкой hello Azure SDK для .NET]: #you-are-encountering-problems-installing-the-Windows-Azure-SDK
[Возникла другая проблема со службой хранилища]: #you-have-a-different-issue-with-a-storage-service

[приложения]: #appendices
[приложение 1: с помощью Fiddler toocapture HTTP и HTTPS-трафика]: #appendix-1
[приложение 2: с помощью Wireshark toocapture сетевой трафик]: #appendix-2
[приложение 3: с помощью Microsoft Message Analyzer toocapture сетевой трафик]: #appendix-3
[Приложение 4: С помощью tooview метрики и журнала данных Excel]: #appendix-4
[Приложение 5. Мониторинг с использованием Application Insights для Visual Studio Team Services]: #appendix-5

<!--Image references-->
[1]: ./media/storage-monitoring-diagnosing-troubleshooting/overview.png
[3]: ./media/storage-monitoring-diagnosing-troubleshooting/hour-minute-metrics.png
[4]: ./media/storage-monitoring-diagnosing-troubleshooting/high-e2e-latency.png
[5]: ./media/storage-monitoring-diagnosing-troubleshooting/fiddler-screenshot.png
[6]: ./media/storage-monitoring-diagnosing-troubleshooting/wireshark-screenshot-1.png
[7]: ./media/storage-monitoring-diagnosing-troubleshooting/wireshark-screenshot-2.png
[8]: ./media/storage-monitoring-diagnosing-troubleshooting/wireshark-screenshot-3.png
[9]: ./media/storage-monitoring-diagnosing-troubleshooting/mma-screenshot-1.png
[10]: ./media/storage-monitoring-diagnosing-troubleshooting/mma-screenshot-2.png
