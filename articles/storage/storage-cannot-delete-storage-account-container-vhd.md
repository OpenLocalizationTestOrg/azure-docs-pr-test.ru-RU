---
title: "Устранение неполадок при удалении учетных записей хранения Azure, контейнеров или виртуальных жестких дисков в классической модели развертывания | Документация Майкрософт"
description: "Устранение неполадок при удалении учетных записей хранения Azure, контейнеров или виртуальных жестких дисков в классической модели развертывания"
services: storage
documentationcenter: 
author: genlin
manager: felixwu
editor: tysonn
tags: storage
ms.assetid: 0f7a8243-d8dc-432a-9d37-1272a0cb3a5c
ms.service: storage
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/13/2017
ms.author: genli
ms.openlocfilehash: 9f3e824414ad6c1a0aba98a3d549ee63ddc7272f
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="troubleshoot-deleting-azure-storage-accounts-containers-or-vhds-in-a-classic-deployment"></a>Устранение неполадок при удалении учетных записей хранения Azure, контейнеров или виртуальных жестких дисков в классической модели развертывания
[!INCLUDE [storage-selector-cannot-delete-storage-account-container-vhd](../../includes/storage-selector-cannot-delete-storage-account-container-vhd.md)]

При попытке удалить учетную запись хранения Azure, контейнер или виртуальный жесткий диск на [портале Azure](https://portal.azure.com/) или на [классическом портале Azure](https://manage.windowsazure.com/) могут возникать ошибки. Ошибки могут возникать при следующих обстоятельствах:

* При удалении виртуальной машины диск и виртуальный жесткий диск не удаляются автоматически. Это может быть причиной сбоя удаления учетной записи хранения. Диск не удаляется, чтобы вы могли использовать его для подключения другой виртуальной машины.
* Диск или большой двоичный объект, связанный с диском, по-прежнему находится в аренде.
* Остался образ виртуальной машины, который использует большой двоичный объект, контейнер или учетную запись хранения.

Если в этой статье нет решения вашей проблемы с Azure, посетите форумы по Azure [на сайтах MSDN и Stack Overflow](https://azure.microsoft.com/support/forums/). Проблему можно разместить на этих форумах или отправить по адресу @AzureSupport в Twitter. Кроме того, можно отправить запрос в службу поддержки Azure, выбрав **Получить поддержку** на сайте [службы поддержки Azure](https://azure.microsoft.com/support/options/) .

## <a name="symptoms"></a>Симптомы
В следующем разделе приводится список наиболее распространенных ошибок, которые могут возникать при попытке удаления учетных записей хранения Azure, контейнеров или виртуальных жестких дисков.

### <a name="scenario-1-unable-to-delete-a-storage-account"></a>Сценарий 1. Невозможно удалить учетную запись хранения
Когда вы переходите в классическую учетную запись хранения на [портале Azure](https://portal.azure.com/) и выбираете **Удалить**, может появиться список объектов, которые препятствуют удалению учетной записи хранения.

  ![Изображения ошибки, возникшей при удалении учетной записи хранения](./media/storage-cannot-delete-storage-account-container-vhd/newerror.png)

При переходе в учетную запись хранения на [классическом портале Azure](https://manage.windowsazure.com/) и выборе элемента **Удалить** может появиться одна из следующих ошибок:

- *Учетная запись хранения "имя_учетной_записи_хранения" содержит образы виртуальных машин. Убедитесь, что эти образы будут удалены перед удалением этой учетной записи хранения.*

- *Не удалось удалить учетную запись хранения <учетная_запись_хранения_ВМ>. Не удалось удалить учетную запись хранения <учетная_запись_хранения_ВМ>: "В учетной записи хранения <учетная_запись_хранения_ВМ> есть несколько активных образов или дисков. Убедитесь, что эти образы или диски удалены, перед тем как удалять эту учетную запись хранения".*

- *В учетной записи хранения <учетная_запись_хранения_ВМ> есть несколько активных образов или дисков, например xxxxxxxxx- xxxxxxxxx-O-209490240936090599. Убедитесь, что эти образы или диски удалены, перед тем как удалять эту учетную запись хранения.*

- *Учетная запись хранения <учетная_запись_хранения_ВМ> содержит 1 контейнер с активными артефактами образа или диска. Убедитесь, что эти артефакты удалены из репозитория образов, перед удалением этой учетной записи хранения*.

- *Не удалось выполнить отправку. Учетная запись хранения <учетная_запись_хранения_ВМ> содержит 1 контейнер с активными артефактами образа или диска. Убедитесь, что эти артефакты удалены из репозитория образов, перед удалением этой учетной записи хранения. Когда вы пытаетесь удалить учетную запись хранения, у которой есть связанные активные диски, появится сообщение о том, что существуют активные диски, которые нужно удалить*.

### <a name="scenario-2-unable-to-delete-a-container"></a>Сценарий 2. Невозможно удалить контейнер
При попытке удалить контейнер хранилища может появиться следующая ошибка:

*Не удалось удалить контейнер хранилища <container name>. Ошибка: "В настоящий момент контейнер находится в аренде, и в запросе не указан идентификатор аренды*".

Или

*Следующие диски виртуальной машины сейчас используют большие двоичные объекты в этом контейнере. Поэтому данный контейнер не может быть удален: VirtualMachineDiskName1, VirtualMachineDiskName2…*

### <a name="scenario-3-unable-to-delete-a-vhd"></a>Сценарий 3. Невозможно удалить виртуальный жесткий диск
После удаления виртуальной машины при попытке удаления больших двоичных объектов для связанных виртуальных жестких дисков может появиться следующее сообщение:

*Не удалось удалить BLOB-объект "<путь>/XXXXXX-XXXXXX-os-1447379084699.vhd". Ошибка: "В настоящий момент BLOB-объект находится в аренде, и в запросе не указан идентификатор аренды".*

Или

*Большой двоичный объект "BlobName.vhd" используется в качестве диска виртуальной машины "VirtualMachineDiskName", поэтому его невозможно удалить.*

## <a name="solution"></a>Решение
Для устранения наиболее распространенных проблем попробуйте следующий метод:

### <a name="step-1-delete-any-disks-that-are-preventing-deletion-of-the-storage-account-container-or-vhd"></a>Шаг 1. Удалите любые диски, которые препятствуют удалению учетной записи хранения, контейнера или виртуального жесткого диска.
1. Переключитесь на [классический портал Azure](https://manage.windowsazure.com/).
2. Выберите **ВИРТУАЛЬНАЯ МАШИНА** > **ДИСКИ**.

    ![Изображение дисков на виртуальных машинах на классическом портале Azure.](./media/storage-cannot-delete-storage-account-container-vhd/VMUI.png)
3. Найдите диски, связанные с учетной записью хранения, контейнером или виртуальным жестким диском, которые нужно удалить. Проверив расположение диска, вы найдете связанную учетную запись хранения, контейнер или виртуальный жесткий диск.

    ![Рисунок, демонстрирующий сведения о расположении для дисков на классическом портале Azure](./media/storage-cannot-delete-storage-account-container-vhd/DiskLocation.png)
4. Удалить эти диски можно с помощью одного из указанных ниже способов.

  - Если в поле диска **Подключен к** нет виртуальных машин, то его можно удалить напрямую.

  - Если это диск данных, выполните следующие действия.

    1. Проверьте имя виртуальной машины, к которой подключен диск.
    2. Выберите **Виртуальные машины** > **Экземпляры** и найдите эту виртуальную машину.
    3. Убедитесь, что никакой процесс не использует диск активно.
    4. Щелкните **Отсоединить диск** в нижней части окна портала, чтобы отключить диск.
    5. Выберите **Виртуальные машины** > **Диски** и подождите, пока поле **Подключен к** не станет пустым. Это означает, что диск был успешно отключен от виртуальной машины.
    6. Щелкните **Удалить** в нижней части окна (**Виртуальные машины** > **Диски**), чтобы удалить диск.

  - Если это диск ОС (поле **Содержит ОС** имеет значение Windows или подобное), который подключен к виртуальной машине, выполните приведенные ниже действия, чтобы удалить виртуальную машину. Диск операционной системы невозможно отключить, так что для освобождения аренды нужно удалить виртуальную машину.

    1. Проверьте имя виртуальной машины, к которой подключен диск данных.  
    2. Выберите **Виртуальные машины** > **Экземпляры**, затем выберите виртуальную машину, к которой подключен диск.
    3. Убедитесь, что виртуальная машина больше не используется и в ней нет необходимости.
    4. Выберите виртуальную машину, к которой подключен диск, затем щелкните **Удалить** > **Удалить присоединенные диски**.
    5. Выберите **Виртуальные машины** > **Диски** и подождите, пока диск исчезнет.  На это может потребоваться несколько минут. Может также потребоваться обновить страницу.
    6. Если диск не исчез, подождите, пока поле **Подключен к** не станет пустым. Это означает, что диск был полностью отключен от виртуальной машины.  Выберите этот диск и щелкните **Удалить** в нижней части страницы, чтобы удалить его.


   > [!NOTE]
   > Если диск подключен к виртуальной машине, вы не сможете его удалить. Диски отключаются от удаленной виртуальной машины асинхронно. После удаления виртуальной машины может пройти несколько минут, прежде чем это поле будет очищено.
   >
   >


### <a name="step-2-delete-any-vm-images-that-are-preventing-deletion-of-the-storage-account-or-container"></a>Шаг 2. Удалите любые образы виртуальных машин, которые препятствуют удалению учетной записи хранения или контейнера.
1. Переключитесь на [классический портал Azure](https://manage.windowsazure.com/).
2. Выберите **ВИРТУАЛЬНАЯ МАШИНА** > **ОБРАЗЫ**, а затем удалите образы, которые связаны с учетной записью хранения, контейнером или виртуальным жестким диском.

    После этого попробуйте удалить учетную запись хранения, контейнер или виртуальный жесткий диск снова.

> [!WARNING]
> Создайте резервные копии нужных данных, прежде чем удалять учетную запись. Восстановить удаленный виртуальный жесткий диск, большой двоичный объект, таблицу, очередь и файл невозможно. Убедитесь, что ресурс не используется.
>
>

## <a name="about-the-stopped-deallocated-status"></a>О состоянии "Остановлена (освобождена)"
Виртуальные машины, которые были созданы в классической модели развертывания и сохранены, будут находиться в состоянии **Остановлено (освобождено)** на [портале Azure](https://portal.azure.com/) или [классическом портале Azure](https://manage.windowsazure.com/).

**Классический портал Azure**:

![Состояние "Остановлено (освобождено)" виртуальных машин на портале Azure.](./media/storage-cannot-delete-storage-account-container-vhd/moreinfo2.png)

**Портал Azure**:

![Состояние "Остановлено (освобождено)" виртуальных машин на классическом портале Azure.](./media/storage-cannot-delete-storage-account-container-vhd/moreinfo1.png)

Состояние "Остановлено (освобождено)" освобождает ресурсы компьютера, такие как ЦП, память и сеть. Однако диски по-прежнему сохраняются, чтобы при необходимости вы могли быстро повторно создать виртуальную машину. Эти диски создаются на основе виртуальных жестких дисков, поддерживаемых службой хранилища Azure. Учетная запись хранения имеет эти виртуальные жесткие диски, а диски арендуют их.

## <a name="next-steps"></a>Дальнейшие действия
* [Удаление учетной записи хранения](storage-create-storage-account.md#delete-a-storage-account)
