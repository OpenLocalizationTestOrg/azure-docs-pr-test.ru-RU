---
title: "aaaManaging параллелизма в хранилище Microsoft Azure"
description: "Как toomanage параллелизма для hello служб больших двоичных объектов, очередей, таблицы и файла"
services: storage
documentationcenter: 
author: jasontang501
manager: tadb
editor: tysonn
ms.assetid: cc6429c4-23ee-46e3-b22d-50dd68bd4680
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 05/11/2017
ms.author: jasontang501
ms.openlocfilehash: 277fbbb880906da6be67b2267ed5c8e457455bd1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="managing-concurrency-in-microsoft-azure-storage"></a><span data-ttu-id="af62d-103">Управление параллелизмом в службе хранилища Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="af62d-103">Managing Concurrency in Microsoft Azure Storage</span></span>
## <a name="overview"></a><span data-ttu-id="af62d-104">Обзор</span><span class="sxs-lookup"><span data-stu-id="af62d-104">Overview</span></span>
<span data-ttu-id="af62d-105">В современных интернет-приложениях данные могут одновременно просматриваться и обновляться несколькими пользователями.</span><span class="sxs-lookup"><span data-stu-id="af62d-105">Modern Internet based applications usually have multiple users viewing and updating data simultaneously.</span></span> <span data-ttu-id="af62d-106">Это требуется toothink разработчикам приложений, тщательно о том, как tooprovide a прогнозируемого возникнуть tootheir конечных пользователей, особенно сценарии, когда несколько пользователей могут обновлять hello же данных.</span><span class="sxs-lookup"><span data-stu-id="af62d-106">This requires application developers toothink carefully about how tooprovide a predictable experience tootheir end users, particularly for scenarios where multiple users can update hello same data.</span></span> <span data-ttu-id="af62d-107">Обычно разработчики рассматривают три следующие основные стратегии конфликтов данных:</span><span class="sxs-lookup"><span data-stu-id="af62d-107">There are three main data concurrency strategies developers will typically consider:</span></span>  

1. <span data-ttu-id="af62d-108">Оптимистический параллелизм — приложения выполнении обновления в ходе его обновления проверит Если hello данные изменились с момента приложения hello последнего чтения этих данных.</span><span class="sxs-lookup"><span data-stu-id="af62d-108">Optimistic concurrency – An application performing an update will as part of its update verify if hello data has changed since hello application last read that data.</span></span> <span data-ttu-id="af62d-109">Например если два пользователя, просматривающего страницу вики-сайте обновления toohello же страницы hello вики-сайте платформы необходимо убедиться, что это обновление второй hello не перезаписывает hello первого обновления — и оба пользователям понять, успешно ли их обновления.</span><span class="sxs-lookup"><span data-stu-id="af62d-109">For example, if two users viewing a wiki page make an update toohello same page then hello wiki platform must ensure that hello second update does not overwrite hello first update – and that both users understand whether their update was successful or not.</span></span> <span data-ttu-id="af62d-110">Стратегия наиболее часто применяется в веб-приложениях.</span><span class="sxs-lookup"><span data-stu-id="af62d-110">This strategy is most often used in web applications.</span></span>
2. <span data-ttu-id="af62d-111">Пессимистичный параллелизм — приложения поиска tooperform обновления займет блокировки на объект, не позволяя другим пользователям обновлять данные hello до снятия блокировки hello.</span><span class="sxs-lookup"><span data-stu-id="af62d-111">Pessimistic concurrency – An application looking tooperform an update will take a lock on an object preventing other users from updating hello data until hello lock is released.</span></span> <span data-ttu-id="af62d-112">Например в сценарии репликации данных ведущий и ведомый, где будет обновлять только образец hello образец hello обычно для хранения монопольную блокировку для продолжительного периода времени на tooensure данных hello не никто другой не может обновлять ее.</span><span class="sxs-lookup"><span data-stu-id="af62d-112">For example, in a master/slave data replication scenario where only hello master will perform updates hello master will typically hold an exclusive lock for an extended period of time on hello data tooensure no one else can update it.</span></span>
3. <span data-ttu-id="af62d-113">Последний записавший, побеждает — подход, позволяющий любой tooproceed операций обновления без проверки, если любого другого приложения обновил hello данных, так как приложение hello сначала прочитать данные hello.</span><span class="sxs-lookup"><span data-stu-id="af62d-113">Last writer wins – An approach that allows any update operations tooproceed without verifying if any other application has updated hello data since hello application first read hello data.</span></span> <span data-ttu-id="af62d-114">Этой стратегии (или отсутствие стратегии формальных) обычно используется где данные секционированы таким образом, что имеется не вероятность того, что доступ к нескольким пользователям hello и тех же данных.</span><span class="sxs-lookup"><span data-stu-id="af62d-114">This strategy (or lack of a formal strategy) is usually used where data is partitioned in such a way that there is no likelihood that multiple users will access hello same data.</span></span> <span data-ttu-id="af62d-115">Она также применяется при обработке кратковременных потоков данных.</span><span class="sxs-lookup"><span data-stu-id="af62d-115">It can also be useful where short-lived data streams are being processed.</span></span>  

<span data-ttu-id="af62d-116">Приводятся общие сведения о том, как платформа hello хранилища Azure упрощает разработку, предоставляя поддержку первого класса для всех трех этих стратегий параллелизма.</span><span class="sxs-lookup"><span data-stu-id="af62d-116">This article provides an overview of how hello Azure Storage platform simplifies development by providing first class support for all three of these concurrency strategies.</span></span>  

## <a name="azure-storage--simplifies-cloud-development"></a><span data-ttu-id="af62d-117">Служба хранилища Azure — Упрощает облачные разработки</span><span class="sxs-lookup"><span data-stu-id="af62d-117">Azure Storage – Simplifies Cloud Development</span></span>
<span data-ttu-id="af62d-118">Hello службой хранилища Azure поддерживает все три стратегии, хотя это различение в его возможности tooprovide полная поддержка оптимистичный и пессимистичный параллелизм за спроектированный tooembrace строго согласованная модель, которая гарантирует, что при Здравствуйте фиксации службы хранилища данных, вставить или обновить операции, все последующие обращается к данным toothat увидите hello последнего обновления.</span><span class="sxs-lookup"><span data-stu-id="af62d-118">hello Azure storage service supports all three strategies, although it is distinctive in its ability tooprovide full support for optimistic and pessimistic concurrency because it was designed tooembrace a strong consistency model which guarantees that when hello Storage service commits a data insert or update operation all further accesses toothat data will see hello latest update.</span></span> <span data-ttu-id="af62d-119">Платформы для хранения данных, использующих модель окончательной согласованности имеют промежуток между при записи выполняется одним пользователем, и при обновлении hello может их видеть других пользователей, тем самым усложнения разработки клиентских приложений к несогласованности tooprevent заказа из влияния на конечных пользователей.</span><span class="sxs-lookup"><span data-stu-id="af62d-119">Storage platforms that use an eventual consistency model have a lag between when a write is performed by one user and when hello updated data can be seen by other users thus complicating development of client applications in order tooprevent inconsistencies from affecting end users.</span></span>  

<span data-ttu-id="af62d-120">В дополнение к этому tooselecting разработчики стратегии подходящий параллелизм необходимо принимать во внимание из как платформа хранения изолирует изменения — особенно изменения toohello один объектов между транзакциями.</span><span class="sxs-lookup"><span data-stu-id="af62d-120">In addition tooselecting an appropriate concurrency strategy developers should also be aware of how a storage platform isolates changes – particularly changes toohello same object across transactions.</span></span> <span data-ttu-id="af62d-121">Hello службой хранилища Azure использует tooallow изоляции моментальных снимков, чтения toohappen операций одновременно с операций записи в одной секции.</span><span class="sxs-lookup"><span data-stu-id="af62d-121">hello Azure storage service uses snapshot isolation tooallow read operations toohappen concurrently with write operations within a single partition.</span></span> <span data-ttu-id="af62d-122">В отличие от других уровней изоляции изоляции моментального снимка гарантирует, что все операции чтения разделе согласованный моментальный снимок данных hello даже в том случае, если обновления выполняются — по существу, возвращая hello последних зафиксированных значений во время обработки транзакции обновления.</span><span class="sxs-lookup"><span data-stu-id="af62d-122">Unlike other isolation levels, snapshot isolation guarantees that all reads see a consistent snapshot of hello data even while updates are occurring – essentially by returning hello last committed values while an update transaction is being processed.</span></span>  

## <a name="managing-concurrency-in-blob-storage"></a><span data-ttu-id="af62d-123">Управление параллелизмом в хранилище BLOB-объектов</span><span class="sxs-lookup"><span data-stu-id="af62d-123">Managing Concurrency in Blob storage</span></span>
<span data-ttu-id="af62d-124">Вы можете toouse оптимистичное или пессимистичное управление параллелизмом моделирует tooblobs toomanage доступа и контейнеры в hello службы BLOB-объектов.</span><span class="sxs-lookup"><span data-stu-id="af62d-124">You can opt toouse either optimistic or pessimistic concurrency models toomanage access tooblobs and containers in hello blob service.</span></span> <span data-ttu-id="af62d-125">Если явно не укажете стратегии последней записи wins по умолчанию hello.</span><span class="sxs-lookup"><span data-stu-id="af62d-125">If you do not explicitly specify a strategy last writes wins is hello default.</span></span>  

### <a name="optimistic-concurrency-for-blobs-and-containers"></a><span data-ttu-id="af62d-126">Оптимистичный параллелизм для BLOB-объектов и контейнеров</span><span class="sxs-lookup"><span data-stu-id="af62d-126">Optimistic concurrency for blobs and containers</span></span>
<span data-ttu-id="af62d-127">Hello службы хранилища назначает идентификатор объекта tooevery хранятся.</span><span class="sxs-lookup"><span data-stu-id="af62d-127">hello Storage service assigns an identifier tooevery object stored.</span></span> <span data-ttu-id="af62d-128">Идентификатор обновляется при каждом обновлении объекта.</span><span class="sxs-lookup"><span data-stu-id="af62d-128">This identifier is updated every time an update operation is performed on an object.</span></span> <span data-ttu-id="af62d-129">Идентификатор Hello возвращается toohello клиента как часть ответ HTTP GET, используя заголовок ETag (тег сущности) hello, определенные в hello HTTP-протокола.</span><span class="sxs-lookup"><span data-stu-id="af62d-129">hello identifier is returned toohello client as part of an HTTP GET response using hello ETag (entity tag) header that is defined within hello HTTP protocol.</span></span> <span data-ttu-id="af62d-130">Пользователь, выполняющий обновления на такой объект можно отправить в hello исходного ETag вместе с tooensure условный заголовок, обновление только возникает, если выполнены определенные условия — в этом случае hello условие является заголовком «If-Match», требующая hello хранилища Служба tooensure hello значение ETag, указанный в запросе обновления hello hello совпадение с кодом, хранятся в hello службы хранилища hello.</span><span class="sxs-lookup"><span data-stu-id="af62d-130">A user performing an update on such an object can send in hello original ETag along with a conditional header tooensure that an update will only occur if a certain condition has been met – in this case hello condition is an "If-Match" header which requires hello Storage Service tooensure hello value of hello ETag specified in hello update request is hello same as that stored in hello Storage Service.</span></span>  

<span data-ttu-id="af62d-131">Структура Hello этот процесс выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="af62d-131">hello outline of this process is as follows:</span></span>  

1. <span data-ttu-id="af62d-132">Получить большой двоичный объект из службы хранилища hello, hello ответ включает значение HTTP-заголовка ETag, которое идентифицирует hello текущая версия объекта hello в службе хранилища hello.</span><span class="sxs-lookup"><span data-stu-id="af62d-132">Retrieve a blob from hello storage service, hello response includes an HTTP ETag Header value that identifies hello current version of hello object in hello storage service.</span></span>
2. <span data-ttu-id="af62d-133">При обновлении большого двоичного объекта hello содержать значение ETag hello, полученный на шаге 1 в hello **If-Match** условный заголовок запроса hello отправки toohello службы.</span><span class="sxs-lookup"><span data-stu-id="af62d-133">When you update hello blob, include hello ETag value you received in step 1 in hello **If-Match** conditional header of hello request you send toohello service.</span></span>
3. <span data-ttu-id="af62d-134">Служба Hello сравнивает значение ETag hello в запросе hello с Привет текущее значение ETag большого двоичного объекта hello.</span><span class="sxs-lookup"><span data-stu-id="af62d-134">hello service compares hello ETag value in hello request with hello current ETag value of hello blob.</span></span>
4. <span data-ttu-id="af62d-135">Если hello текущее значение ETag большого двоичного объекта hello другую версию, чем hello ETag в hello **If-Match** условного заголовка в запросе hello, hello службы возвращает ошибки 412 toohello клиента.</span><span class="sxs-lookup"><span data-stu-id="af62d-135">If hello current ETag value of hello blob is a different version than hello ETag in hello **If-Match** conditional header in hello request, hello service returns a 412 error toohello client.</span></span> <span data-ttu-id="af62d-136">Клиент toohello, что другой процесс обновлена hello blob с момента получения hello клиента, он указывает.</span><span class="sxs-lookup"><span data-stu-id="af62d-136">This indicates toohello client that another process has updated hello blob since hello client retrieved it.</span></span>
5. <span data-ttu-id="af62d-137">Если текущий hello hello большого двоичного объекта значение ETag hello совпадает с версией hello ETag в hello **If-Match** условного заголовка в запросе hello, hello служба выполняет hello запросил операцию и обновления hello текущее значение ETag большого двоичного объекта hello tooshow, что она создана новая версия.</span><span class="sxs-lookup"><span data-stu-id="af62d-137">If hello current ETag value of hello blob is hello same version as hello ETag in hello **If-Match** conditional header in hello request, hello service performs hello requested operation and updates hello current ETag value of hello blob tooshow that it has created a new version.</span></span>  

<span data-ttu-id="af62d-138">Hello следующий фрагмент кода C# (с помощью клиентской библиотеки хранилища 4.2.0 hello) показан простой пример того, как tooconstruct **AccessCondition If-Match** основании hello значение ETag, которое осуществляется из hello свойства большого двоичного объекта, который был ранее полученные либо inserted.</span><span class="sxs-lookup"><span data-stu-id="af62d-138">hello following C# snippet (using hello Client Storage Library 4.2.0) shows a simple example of how tooconstruct an **If-Match AccessCondition** based on hello ETag value that is accessed from hello properties of a blob that was previously either retrieved or inserted.</span></span> <span data-ttu-id="af62d-139">Затем он использует hello **AccessCondition** объекта при его обновление hello BLOB-объектов: hello **AccessCondition** объект добавляет hello **If-Match** заголовок toohello запроса.</span><span class="sxs-lookup"><span data-stu-id="af62d-139">It then uses hello **AccessCondition** object when it updating hello blob: hello **AccessCondition** object adds hello **If-Match** header toohello request.</span></span> <span data-ttu-id="af62d-140">Если другой процесс уже обновлен hello больших двоичных объектов, hello BLOB-объектов возвращает сообщение о состоянии HTTP 412 (необходимое условие не выполнено).</span><span class="sxs-lookup"><span data-stu-id="af62d-140">If another process has updated hello blob, hello blob service returns an HTTP 412 (Precondition Failed) status message.</span></span> <span data-ttu-id="af62d-141">Полный образец hello можно загрузить здесь: [управление параллелизмом, использование хранилища Azure](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span><span class="sxs-lookup"><span data-stu-id="af62d-141">You can download hello full sample here: [Managing Concurrency using Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span></span>  

```csharp
// Retrieve hello ETag from hello newly created blob
// Etag is already populated as UploadText should cause a PUT Blob call
// toostorage blob service which returns hello etag in response.
string orignalETag = blockBlob.Properties.ETag;

// This code simulates an update by a third party.
string helloText = "Blob updated by a third party.";

// No etag, provided so orignal blob is overwritten (thus generating a new etag)
blockBlob.UploadText(helloText);
Console.WriteLine("Blob updated. Updated ETag = {0}",
blockBlob.Properties.ETag);

// Now try tooupdate hello blob using hello orignal ETag provided when hello blob was created
try
{
    Console.WriteLine("Trying tooupdate blob using orignal etag toogenerate if-match access condition");
    blockBlob.UploadText(helloText,accessCondition:
    AccessCondition.GenerateIfMatchCondition(orignalETag));
}
catch (StorageException ex)
{
    if (ex.RequestInformation.HttpStatusCode == (int)HttpStatusCode.PreconditionFailed)
    {
        Console.WriteLine("Precondition failure as expected. Blob's orignal etag no longer matches");
        // TODO: client can decide on how it wants toohandle hello 3rd party updated content.
    }
    else
        throw;
}  
```

<span data-ttu-id="af62d-142">Hello службы хранилища также включает поддержку дополнительные заголовки например **If-Modified-Since**, **If-Unmodified-Since** и **If-None-Match** производительны, чем их сочетания.</span><span class="sxs-lookup"><span data-stu-id="af62d-142">hello Storage Service also includes support for additional conditional headers such as **If-Modified-Since**, **If-Unmodified-Since** and **If-None-Match** as well as combinations thereof.</span></span> <span data-ttu-id="af62d-143">Дополнительные сведения см. в статье [Указание условных заголовков для операций службы BLOB-объектов](http://msdn.microsoft.com/library/azure/dd179371.aspx) в MSDN.</span><span class="sxs-lookup"><span data-stu-id="af62d-143">For more information see [Specifying Conditional Headers for Blob Service Operations](http://msdn.microsoft.com/library/azure/dd179371.aspx) on MSDN.</span></span>  

<span data-ttu-id="af62d-144">Hello следующей таблице перечислены hello контейнера операции, такие как условные заголовки accept **If-Match** в hello запроса, которые возвращают значение ETag в ответ hello.</span><span class="sxs-lookup"><span data-stu-id="af62d-144">hello following table summarizes hello container operations that accept conditional headers such as **If-Match** in hello request and that return an ETag value in hello response.</span></span>  

| <span data-ttu-id="af62d-145">Операция</span><span class="sxs-lookup"><span data-stu-id="af62d-145">Operation</span></span> | <span data-ttu-id="af62d-146">Возврат значения ETag для контейнера</span><span class="sxs-lookup"><span data-stu-id="af62d-146">Returns Container ETag value</span></span> | <span data-ttu-id="af62d-147">Принятие дополнительных заголовков</span><span class="sxs-lookup"><span data-stu-id="af62d-147">Accepts conditional headers</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="af62d-148">Create Container (Создание контейнера)</span><span class="sxs-lookup"><span data-stu-id="af62d-148">Create Container</span></span> |<span data-ttu-id="af62d-149">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-149">Yes</span></span> |<span data-ttu-id="af62d-150">Нет</span><span class="sxs-lookup"><span data-stu-id="af62d-150">No</span></span> |
| <span data-ttu-id="af62d-151">Get Container Properties (Получение свойств контейнера)</span><span class="sxs-lookup"><span data-stu-id="af62d-151">Get Container Properties</span></span> |<span data-ttu-id="af62d-152">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-152">Yes</span></span> |<span data-ttu-id="af62d-153">Нет</span><span class="sxs-lookup"><span data-stu-id="af62d-153">No</span></span> |
| <span data-ttu-id="af62d-154">Get Container Metadata (Получение метаданных контейнера)</span><span class="sxs-lookup"><span data-stu-id="af62d-154">Get Container Metadata</span></span> |<span data-ttu-id="af62d-155">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-155">Yes</span></span> |<span data-ttu-id="af62d-156">Нет</span><span class="sxs-lookup"><span data-stu-id="af62d-156">No</span></span> |
| <span data-ttu-id="af62d-157">Определение метаданных контейнера</span><span class="sxs-lookup"><span data-stu-id="af62d-157">Set Container Metadata</span></span> |<span data-ttu-id="af62d-158">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-158">Yes</span></span> |<span data-ttu-id="af62d-159">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-159">Yes</span></span> |
| <span data-ttu-id="af62d-160">Get Container ACL (Получение списка управления доступом для контейнера)</span><span class="sxs-lookup"><span data-stu-id="af62d-160">Get Container ACL</span></span> |<span data-ttu-id="af62d-161">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-161">Yes</span></span> |<span data-ttu-id="af62d-162">Нет</span><span class="sxs-lookup"><span data-stu-id="af62d-162">No</span></span> |
| <span data-ttu-id="af62d-163">Set Container ACL (Задание списка управления доступом для контейнера)</span><span class="sxs-lookup"><span data-stu-id="af62d-163">Set Container ACL</span></span> |<span data-ttu-id="af62d-164">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-164">Yes</span></span> |<span data-ttu-id="af62d-165">Да (*)</span><span class="sxs-lookup"><span data-stu-id="af62d-165">Yes (*)</span></span> |
| <span data-ttu-id="af62d-166">Delete Container (Удаление контейнера)</span><span class="sxs-lookup"><span data-stu-id="af62d-166">Delete Container</span></span> |<span data-ttu-id="af62d-167">Нет</span><span class="sxs-lookup"><span data-stu-id="af62d-167">No</span></span> |<span data-ttu-id="af62d-168">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-168">Yes</span></span> |
| <span data-ttu-id="af62d-169">Lease Container (Аренда контейнера)</span><span class="sxs-lookup"><span data-stu-id="af62d-169">Lease Container</span></span> |<span data-ttu-id="af62d-170">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-170">Yes</span></span> |<span data-ttu-id="af62d-171">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-171">Yes</span></span> |
| <span data-ttu-id="af62d-172">List Blobs (Отображение списка BLOB-объектов)</span><span class="sxs-lookup"><span data-stu-id="af62d-172">List Blobs</span></span> |<span data-ttu-id="af62d-173">Нет</span><span class="sxs-lookup"><span data-stu-id="af62d-173">No</span></span> |<span data-ttu-id="af62d-174">Нет</span><span class="sxs-lookup"><span data-stu-id="af62d-174">No</span></span> |

<span data-ttu-id="af62d-175">разрешения hello (*), определяемые SetContainerACL кэшируются и обновления toothese разрешения имеют toopropagate какой период обновления, не гарантируется согласованность toobe 30 секунд.</span><span class="sxs-lookup"><span data-stu-id="af62d-175">(*) hello permissions defined by SetContainerACL are cached and updates toothese permissions take 30 seconds toopropagate during which period updates are not guaranteed toobe consistent.</span></span>  

<span data-ttu-id="af62d-176">Hello следующей таблице перечислены операции hello BLOB-объекта, которые принимают условные заголовки, такие как **If-Match** в hello запроса, которые возвращают значение ETag в ответ hello.</span><span class="sxs-lookup"><span data-stu-id="af62d-176">hello following table summarizes hello blob operations that accept conditional headers such as **If-Match** in hello request and that return an ETag value in hello response.</span></span>

| <span data-ttu-id="af62d-177">Операция</span><span class="sxs-lookup"><span data-stu-id="af62d-177">Operation</span></span> | <span data-ttu-id="af62d-178">Returns ETag value (Возврат значения ETag)</span><span class="sxs-lookup"><span data-stu-id="af62d-178">Returns ETag value</span></span> | <span data-ttu-id="af62d-179">Принятие дополнительных заголовков</span><span class="sxs-lookup"><span data-stu-id="af62d-179">Accepts conditional headers</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="af62d-180">Put BLOB (Вставка BLOB-объекта)</span><span class="sxs-lookup"><span data-stu-id="af62d-180">Put Blob</span></span> |<span data-ttu-id="af62d-181">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-181">Yes</span></span> |<span data-ttu-id="af62d-182">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-182">Yes</span></span> |
| <span data-ttu-id="af62d-183">Get BLOB (Получение BLOB-объекта)</span><span class="sxs-lookup"><span data-stu-id="af62d-183">Get Blob</span></span> |<span data-ttu-id="af62d-184">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-184">Yes</span></span> |<span data-ttu-id="af62d-185">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-185">Yes</span></span> |
| <span data-ttu-id="af62d-186">Get BLOB Properties (Получение свойств BLOB-объекта)</span><span class="sxs-lookup"><span data-stu-id="af62d-186">Get Blob Properties</span></span> |<span data-ttu-id="af62d-187">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-187">Yes</span></span> |<span data-ttu-id="af62d-188">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-188">Yes</span></span> |
| <span data-ttu-id="af62d-189">Set BLOB Properties (Задание свойств службы BLOB-объекта)</span><span class="sxs-lookup"><span data-stu-id="af62d-189">Set Blob Properties</span></span> |<span data-ttu-id="af62d-190">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-190">Yes</span></span> |<span data-ttu-id="af62d-191">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-191">Yes</span></span> |
| <span data-ttu-id="af62d-192">Get BLOB Metadata (Получение метаданных BLOB-объекта)</span><span class="sxs-lookup"><span data-stu-id="af62d-192">Get Blob Metadata</span></span> |<span data-ttu-id="af62d-193">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-193">Yes</span></span> |<span data-ttu-id="af62d-194">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-194">Yes</span></span> |
| <span data-ttu-id="af62d-195">Set BLOB Metadata (Задание метаданных BLOB-объекта)</span><span class="sxs-lookup"><span data-stu-id="af62d-195">Set Blob Metadata</span></span> |<span data-ttu-id="af62d-196">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-196">Yes</span></span> |<span data-ttu-id="af62d-197">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-197">Yes</span></span> |
| <span data-ttu-id="af62d-198">Lease Blob (Аренда BLOB-объекта) (*)</span><span class="sxs-lookup"><span data-stu-id="af62d-198">Lease Blob (*)</span></span> |<span data-ttu-id="af62d-199">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-199">Yes</span></span> |<span data-ttu-id="af62d-200">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-200">Yes</span></span> |
| <span data-ttu-id="af62d-201">Создание моментального снимка большого двоичного объекта</span><span class="sxs-lookup"><span data-stu-id="af62d-201">Snapshot Blob</span></span> |<span data-ttu-id="af62d-202">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-202">Yes</span></span> |<span data-ttu-id="af62d-203">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-203">Yes</span></span> |
| <span data-ttu-id="af62d-204">Копирование BLOB-объекта</span><span class="sxs-lookup"><span data-stu-id="af62d-204">Copy Blob</span></span> |<span data-ttu-id="af62d-205">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-205">Yes</span></span> |<span data-ttu-id="af62d-206">Да (для исходного и целевого большого двоичного объекта)</span><span class="sxs-lookup"><span data-stu-id="af62d-206">Yes (for source and destination blob)</span></span> |
| <span data-ttu-id="af62d-207">Прерывание копирования большого двоичного объекта</span><span class="sxs-lookup"><span data-stu-id="af62d-207">Abort Copy Blob</span></span> |<span data-ttu-id="af62d-208">Нет</span><span class="sxs-lookup"><span data-stu-id="af62d-208">No</span></span> |<span data-ttu-id="af62d-209">Нет</span><span class="sxs-lookup"><span data-stu-id="af62d-209">No</span></span> |
| <span data-ttu-id="af62d-210">Delete BLOB (Удаление BLOB-объекта)</span><span class="sxs-lookup"><span data-stu-id="af62d-210">Delete Blob</span></span> |<span data-ttu-id="af62d-211">Нет</span><span class="sxs-lookup"><span data-stu-id="af62d-211">No</span></span> |<span data-ttu-id="af62d-212">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-212">Yes</span></span> |
| <span data-ttu-id="af62d-213">Put Block (Вставка блокировки)</span><span class="sxs-lookup"><span data-stu-id="af62d-213">Put Block</span></span> |<span data-ttu-id="af62d-214">Нет</span><span class="sxs-lookup"><span data-stu-id="af62d-214">No</span></span> |<span data-ttu-id="af62d-215">Нет</span><span class="sxs-lookup"><span data-stu-id="af62d-215">No</span></span> |
| <span data-ttu-id="af62d-216">Put Block List (Вставка списка блокировки)</span><span class="sxs-lookup"><span data-stu-id="af62d-216">Put Block List</span></span> |<span data-ttu-id="af62d-217">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-217">Yes</span></span> |<span data-ttu-id="af62d-218">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-218">Yes</span></span> |
| <span data-ttu-id="af62d-219">Get Block List (Получение списка блокировки)</span><span class="sxs-lookup"><span data-stu-id="af62d-219">Get Block List</span></span> |<span data-ttu-id="af62d-220">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-220">Yes</span></span> |<span data-ttu-id="af62d-221">Нет</span><span class="sxs-lookup"><span data-stu-id="af62d-221">No</span></span> |
| <span data-ttu-id="af62d-222">Put Page (Вставка страницы)</span><span class="sxs-lookup"><span data-stu-id="af62d-222">Put Page</span></span> |<span data-ttu-id="af62d-223">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-223">Yes</span></span> |<span data-ttu-id="af62d-224">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-224">Yes</span></span> |
| <span data-ttu-id="af62d-225">Get Page Ranges (Получение диапазона страницы)</span><span class="sxs-lookup"><span data-stu-id="af62d-225">Get Page Ranges</span></span> |<span data-ttu-id="af62d-226">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-226">Yes</span></span> |<span data-ttu-id="af62d-227">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-227">Yes</span></span> |

<span data-ttu-id="af62d-228">(*) Большой двоичный объект не изменяет hello ETag для большого двоичного объекта.</span><span class="sxs-lookup"><span data-stu-id="af62d-228">(*) Lease Blob does not change hello ETag on a blob.</span></span>  

### <a name="pessimistic-concurrency-for-blobs"></a><span data-ttu-id="af62d-229">Пессимистичный параллелизм для BLOB-объектов</span><span class="sxs-lookup"><span data-stu-id="af62d-229">Pessimistic concurrency for blobs</span></span>
<span data-ttu-id="af62d-230">toolock большой двоичный объект для монопольного использования, можно получить [аренды](http://msdn.microsoft.com/library/azure/ee691972.aspx) на нем.</span><span class="sxs-lookup"><span data-stu-id="af62d-230">toolock a blob for exclusive use, you can acquire a [lease](http://msdn.microsoft.com/library/azure/ee691972.aspx) on it.</span></span> <span data-ttu-id="af62d-231">При приобретения аренды необходимо указать, как долго требуется hello аренды: это может быть для между 15 секунд too60 или бесконечной какие суммы tooan монопольная блокировка.</span><span class="sxs-lookup"><span data-stu-id="af62d-231">When you acquire a lease, you specify for how long you need hello lease: this can be for between 15 too60 seconds or infinite which amounts tooan exclusive lock.</span></span> <span data-ttu-id="af62d-232">Можно обновить tooextend конечное аренды и можно освободить все аренду при завершении работы с ним.</span><span class="sxs-lookup"><span data-stu-id="af62d-232">You can renew a finite lease tooextend it, and you can release any lease when you are finished with it.</span></span> <span data-ttu-id="af62d-233">Служба BLOB-объектов Hello автоматически освобождает конечное аренды истечении их срока действия.</span><span class="sxs-lookup"><span data-stu-id="af62d-233">hello blob service automatically releases finite leases when they expire.</span></span>  

<span data-ttu-id="af62d-234">Аренды Включение синхронизации различных стратегий toobe поддерживается, включая Монопольная запись / общих чтения, за исключением записи или только чтения и записи совместно / только чтение.</span><span class="sxs-lookup"><span data-stu-id="af62d-234">Leases enable different synchronization strategies toobe supported, including exclusive write / shared read, exclusive write / exclusive read and shared write / exclusive read.</span></span> <span data-ttu-id="af62d-235">Там, где существует аренда hello службы хранилища применяет монопольную записи (put набор операций и удаления) Однако обеспечение эксклюзивность для операций чтения требует tooensure developer Привет, все клиентские приложения используют идентификатор аренды и, только один клиент по одному не является идентификатором аренды.</span><span class="sxs-lookup"><span data-stu-id="af62d-235">Where a lease exists hello storage service enforces exclusive writes (put, set and delete operations) however ensuring exclusivity for read operations requires hello developer tooensure that all client applications use a lease ID and that only one client at a time has a valid lease ID.</span></span> <span data-ttu-id="af62d-236">Операции чтения, не имеющие идентификатора аренды, окажутся в общем чтении.</span><span class="sxs-lookup"><span data-stu-id="af62d-236">Read operations that do not include a lease ID result in shared reads.</span></span>  

<span data-ttu-id="af62d-237">Hello следующий фрагмент кода C# демонстрируется получение монопольного аренду на 30 секунд для большого двоичного объекта, обновление содержимого hello hello большого двоичного объекта и затем Освобождение аренды hello.</span><span class="sxs-lookup"><span data-stu-id="af62d-237">hello following C# snippet shows an example of acquiring an exclusive lease for 30 seconds on a blob, updating hello content of hello blob, and then releasing hello lease.</span></span> <span data-ttu-id="af62d-238">Если уже существует допустимая Аренда на большой двоичный объект hello при попытке tooacquire новую аренду, hello BLOB-объектов возвращает результат состояния «HTTP (409) конфликт».</span><span class="sxs-lookup"><span data-stu-id="af62d-238">If there is already a valid lease on hello blob when you try tooacquire a new lease, hello blob service returns an "HTTP (409) Conflict" status result.</span></span> <span data-ttu-id="af62d-239">фрагмент кода Hello ниже, используется **AccessCondition** объекта сведений об аренде hello tooencapsulate при большой двоичный объект запроса tooupdate hello в службе хранилища hello.</span><span class="sxs-lookup"><span data-stu-id="af62d-239">hello snippet below uses an **AccessCondition** object tooencapsulate hello lease information when it makes a request tooupdate hello blob in hello storage service.</span></span>  <span data-ttu-id="af62d-240">Полный образец hello можно загрузить здесь: [управление параллелизмом, использование хранилища Azure](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span><span class="sxs-lookup"><span data-stu-id="af62d-240">You can download hello full sample here: [Managing Concurrency using Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span></span>

```csharp
// Acquire lease for 15 seconds
string lease = blockBlob.AcquireLease(TimeSpan.FromSeconds(15), null);
Console.WriteLine("Blob lease acquired. Lease = {0}", lease);

// Update blob using lease. This operation will succeed
const string helloText = "Blob updated";
var accessCondition = AccessCondition.GenerateLeaseCondition(lease);
blockBlob.UploadText(helloText, accessCondition: accessCondition);
Console.WriteLine("Blob updated using an exclusive lease");

//Simulate third party update tooblob without lease
try
{
    // Below operation will fail as no valid lease provided
    Console.WriteLine("Trying tooupdate blob without valid lease");
    blockBlob.UploadText("Update without lease, will fail");
}
catch (StorageException ex)
{
    if (ex.RequestInformation.HttpStatusCode == (int)HttpStatusCode.PreconditionFailed)
        Console.WriteLine("Precondition failure as expected. Blob's lease does not match");
    else
        throw;
}  
```

<span data-ttu-id="af62d-241">При попытке операцию записи на арендованного BLOB-объекта без передачи идентификатора аренды hello hello запрос приведет к ошибке 412.</span><span class="sxs-lookup"><span data-stu-id="af62d-241">If you attempt a write operation on a leased blob without passing hello lease ID, hello request fails with a 412 error.</span></span> <span data-ttu-id="af62d-242">Обратите внимание, что если hello истечения срока аренды перед вызовом hello **UploadText** метода, но по-прежнему передавать идентификатор аренды hello, также hello запрос завершится ошибкой с **412** ошибки.</span><span class="sxs-lookup"><span data-stu-id="af62d-242">Note that if hello lease expires before calling hello **UploadText** method but you still pass hello lease ID, hello request also fails with a **412** error.</span></span> <span data-ttu-id="af62d-243">Дополнительные сведения об управлении время истечения срока действия аренды и идентификаторы аренды см. в разделе hello [большой двоичный объект](http://msdn.microsoft.com/library/azure/ee691972.aspx) ОСТАЛЬНОЙ документации.</span><span class="sxs-lookup"><span data-stu-id="af62d-243">For more information about managing lease expiry times and lease ids, see hello [Lease Blob](http://msdn.microsoft.com/library/azure/ee691972.aspx) REST documentation.</span></span>  

<span data-ttu-id="af62d-244">Hello следующие операции с BLOB-объекта можно использовать аренды toomanage пессимистичного параллелизма.</span><span class="sxs-lookup"><span data-stu-id="af62d-244">hello following blob operations can use leases toomanage pessimistic concurrency:</span></span>  

* <span data-ttu-id="af62d-245">Put BLOB (Вставка BLOB-объекта)</span><span class="sxs-lookup"><span data-stu-id="af62d-245">Put Blob</span></span>
* <span data-ttu-id="af62d-246">Get BLOB (Получение BLOB-объекта)</span><span class="sxs-lookup"><span data-stu-id="af62d-246">Get Blob</span></span>
* <span data-ttu-id="af62d-247">Get BLOB Properties (Получение свойств BLOB-объекта)</span><span class="sxs-lookup"><span data-stu-id="af62d-247">Get Blob Properties</span></span>
* <span data-ttu-id="af62d-248">Set BLOB Properties (Задание свойств службы BLOB-объекта)</span><span class="sxs-lookup"><span data-stu-id="af62d-248">Set Blob Properties</span></span>
* <span data-ttu-id="af62d-249">Get BLOB Metadata (Получение метаданных BLOB-объекта)</span><span class="sxs-lookup"><span data-stu-id="af62d-249">Get Blob Metadata</span></span>
* <span data-ttu-id="af62d-250">Set BLOB Metadata (Задание метаданных BLOB-объекта)</span><span class="sxs-lookup"><span data-stu-id="af62d-250">Set Blob Metadata</span></span>
* <span data-ttu-id="af62d-251">Delete BLOB (Удаление BLOB-объекта)</span><span class="sxs-lookup"><span data-stu-id="af62d-251">Delete Blob</span></span>
* <span data-ttu-id="af62d-252">Put Block (Вставка блокировки)</span><span class="sxs-lookup"><span data-stu-id="af62d-252">Put Block</span></span>
* <span data-ttu-id="af62d-253">Put Block List (Вставка списка блокировки)</span><span class="sxs-lookup"><span data-stu-id="af62d-253">Put Block List</span></span>
* <span data-ttu-id="af62d-254">Get Block List (Получение списка блокировки)</span><span class="sxs-lookup"><span data-stu-id="af62d-254">Get Block List</span></span>
* <span data-ttu-id="af62d-255">Put Page (Вставка страницы)</span><span class="sxs-lookup"><span data-stu-id="af62d-255">Put Page</span></span>
* <span data-ttu-id="af62d-256">Get Page Ranges (Получение диапазона страницы)</span><span class="sxs-lookup"><span data-stu-id="af62d-256">Get Page Ranges</span></span>
* <span data-ttu-id="af62d-257">Snapshot Blob (Моментальные снимки BLOB-объектов) — идентификатор аренды не обязателен, если есть аренда</span><span class="sxs-lookup"><span data-stu-id="af62d-257">Snapshot Blob - lease ID optional if a lease exists</span></span>
* <span data-ttu-id="af62d-258">Требуется идентификатор аренды копирования BLOB-объекта — наличие аренды на BLOB-объект назначения hello</span><span class="sxs-lookup"><span data-stu-id="af62d-258">Copy Blob - lease ID required if a lease exists on hello destination blob</span></span>
* <span data-ttu-id="af62d-259">Прерывание копирования Blob - идентификатор аренды необходимо наличие бесконечная Аренда на BLOB-объект назначения hello</span><span class="sxs-lookup"><span data-stu-id="af62d-259">Abort Copy Blob - lease ID required if an infinite lease exists on hello destination blob</span></span>
* <span data-ttu-id="af62d-260">Lease Blob (Аренда BLOB-объекта)</span><span class="sxs-lookup"><span data-stu-id="af62d-260">Lease Blob</span></span>  

### <a name="pessimistic-concurrency-for-containers"></a><span data-ttu-id="af62d-261">Пессимистичный параллелизм для контейнеров</span><span class="sxs-lookup"><span data-stu-id="af62d-261">Pessimistic concurrency for containers</span></span>
<span data-ttu-id="af62d-262">Аренды адресов для контейнеров включить hello же toobe стратегии синхронизации поддерживается как для больших двоичных объектов (монопольной записи и чтения, за исключением записи совместно / эксклюзивным чтения и записи совместно / только чтение) Однако в отличие от больших двоичных объектов службы хранилища hello только применяет эксклюзивность на операции удаления.</span><span class="sxs-lookup"><span data-stu-id="af62d-262">Leases on containers enable hello same synchronization strategies toobe supported as on blobs (exclusive write / shared read, exclusive write / exclusive read and shared write / exclusive read) however unlike blobs hello storage service only enforces exclusivity on delete operations.</span></span> <span data-ttu-id="af62d-263">toodelete контейнер с активной арендой, клиент должен включить идентификатор активной аренды hello hello запроса delete.</span><span class="sxs-lookup"><span data-stu-id="af62d-263">toodelete a container with an active lease, a client must include hello active lease ID with hello delete request.</span></span> <span data-ttu-id="af62d-264">Все другие операции выполняются успешно для арендуемого контейнера без идентификатора аренды hello в этом случае они являются общими операциями.</span><span class="sxs-lookup"><span data-stu-id="af62d-264">All other container operations succeed on a leased container without including hello lease ID in which case they are shared operations.</span></span> <span data-ttu-id="af62d-265">Если требуется монополия на операции обновления (put или set) или чтения, разработчик должен обеспечить всех клиентов возможностью использования идентификатора аренды, а также наличие действительного идентификатора аренды одновременно только у одного клиента.</span><span class="sxs-lookup"><span data-stu-id="af62d-265">If exclusivity of update (put or set) or read operations is required then developers should ensure all clients use a lease ID and that only one client at a time has a valid lease ID.</span></span>  

<span data-ttu-id="af62d-266">Hello следующие операции контейнера можно использовать аренды toomanage пессимистичного параллелизма.</span><span class="sxs-lookup"><span data-stu-id="af62d-266">hello following container operations can use leases toomanage pessimistic concurrency:</span></span>  

* <span data-ttu-id="af62d-267">Delete Container (Удаление контейнера)</span><span class="sxs-lookup"><span data-stu-id="af62d-267">Delete Container</span></span>
* <span data-ttu-id="af62d-268">Get Container Properties (Получение свойств контейнера)</span><span class="sxs-lookup"><span data-stu-id="af62d-268">Get Container Properties</span></span>
* <span data-ttu-id="af62d-269">Get Container Metadata (Получение метаданных контейнера)</span><span class="sxs-lookup"><span data-stu-id="af62d-269">Get Container Metadata</span></span>
* <span data-ttu-id="af62d-270">Определение метаданных контейнера</span><span class="sxs-lookup"><span data-stu-id="af62d-270">Set Container Metadata</span></span>
* <span data-ttu-id="af62d-271">Get Container ACL (Получение списка управления доступом для контейнера)</span><span class="sxs-lookup"><span data-stu-id="af62d-271">Get Container ACL</span></span>
* <span data-ttu-id="af62d-272">Set Container ACL (Задание списка управления доступом для контейнера)</span><span class="sxs-lookup"><span data-stu-id="af62d-272">Set Container ACL</span></span>
* <span data-ttu-id="af62d-273">Lease Container (Аренда контейнера)</span><span class="sxs-lookup"><span data-stu-id="af62d-273">Lease Container</span></span>  

<span data-ttu-id="af62d-274">Дополнительные сведения см. в разделах:</span><span class="sxs-lookup"><span data-stu-id="af62d-274">For more information see:</span></span>  

* [<span data-ttu-id="af62d-275">Указание условных заголовков для операций службы BLOB-объектов</span><span class="sxs-lookup"><span data-stu-id="af62d-275">Specifying Conditional Headers for Blob Service Operations</span></span>](http://msdn.microsoft.com/library/azure/dd179371.aspx)
* [<span data-ttu-id="af62d-276">Аренда контейнера</span><span class="sxs-lookup"><span data-stu-id="af62d-276">Lease Container</span></span>](http://msdn.microsoft.com/library/azure/jj159103.aspx)
* [<span data-ttu-id="af62d-277">Аренда большого двоичного объекта </span><span class="sxs-lookup"><span data-stu-id="af62d-277">Lease Blob </span></span>](http://msdn.microsoft.com/library/azure/ee691972.aspx)

## <a name="managing-concurrency-in-hello-table-service"></a><span data-ttu-id="af62d-278">Управление параллелизмом в hello службы таблиц</span><span class="sxs-lookup"><span data-stu-id="af62d-278">Managing Concurrency in hello Table Service</span></span>
<span data-ttu-id="af62d-279">Служба таблиц Hello использует проверку оптимистического параллелизма по умолчанию hello при работе с объектами, в отличие от службы BLOB-объектов hello, где необходимо явно указать tooperform проверок оптимистического параллелизма.</span><span class="sxs-lookup"><span data-stu-id="af62d-279">hello table service uses optimistic concurrency checks as hello default behavior when you are working with entities, unlike hello blob service where you must explicitly choose tooperform optimistic concurrency checks.</span></span> <span data-ttu-id="af62d-280">Hello других различий между hello службы таблиц и больших двоичных объектов — что можно управлять только параллелизма по умолчанию hello сущностей, тогда как hello службы больших двоичных объектов позволяет управлять параллелизмом hello контейнеров и больших двоичных объектов.</span><span class="sxs-lookup"><span data-stu-id="af62d-280">hello other difference between hello table and blob services is that you can only manage hello concurrency behavior of entities whereas with hello blob service you can manage hello concurrency of both containers and blobs.</span></span>  

<span data-ttu-id="af62d-281">Оптимистический параллелизм toouse и toocheck, если другой процесс изменения сущности с момента получения его из службы хранилища таблиц hello, можно использовать значение ETag hello, получаемых при hello служба таблиц возвращает сущности.</span><span class="sxs-lookup"><span data-stu-id="af62d-281">toouse optimistic concurrency and toocheck if another process modified an entity since you retrieved it from hello table storage service, you can use hello ETag value you receive when hello table service returns an entity.</span></span> <span data-ttu-id="af62d-282">Структура Hello этот процесс выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="af62d-282">hello outline of this process is as follows:</span></span>  

1. <span data-ttu-id="af62d-283">Получить сущности из службы хранилища таблиц hello, hello ответ включает значение ETag, которое идентифицирует текущий идентификатор hello, связанных с этой сущностью в службе хранилища hello.</span><span class="sxs-lookup"><span data-stu-id="af62d-283">Retrieve an entity from hello table storage service, hello response includes an ETag value that identifies hello current identifier associated with that entity in hello storage service.</span></span>
2. <span data-ttu-id="af62d-284">При обновлении сущности hello, содержать значение ETag hello, полученный на шаге 1 в hello обязательные **If-Match** заголовок запроса hello отправки toohello службы.</span><span class="sxs-lookup"><span data-stu-id="af62d-284">When you update hello entity, include hello ETag value you received in step 1 in hello mandatory **If-Match** header of hello request you send toohello service.</span></span>
3. <span data-ttu-id="af62d-285">Служба Hello сравнивает значение ETag hello в запросе hello с hello значение ETag текущей сущности hello.</span><span class="sxs-lookup"><span data-stu-id="af62d-285">hello service compares hello ETag value in hello request with hello current ETag value of hello entity.</span></span>
4. <span data-ttu-id="af62d-286">Если текущее значение ETag hello hello объекта отличается от hello ETag в hello обязательные **If-Match** заголовка в запросе hello, hello службы возвращает ошибки 412 toohello клиента.</span><span class="sxs-lookup"><span data-stu-id="af62d-286">If hello current ETag value of hello entity is different than hello ETag in hello mandatory **If-Match** header in hello request, hello service returns a 412 error toohello client.</span></span> <span data-ttu-id="af62d-287">Клиент toohello, что другой процесс обновлена hello сущности с момента получения hello клиента, он указывает.</span><span class="sxs-lookup"><span data-stu-id="af62d-287">This indicates toohello client that another process has updated hello entity since hello client retrieved it.</span></span>
5. <span data-ttu-id="af62d-288">Если hello значение ETag текущей сущности hello Здравствуйте, так же, как hello ETag в hello обязательные **If-Match** заголовка в запросе hello или hello **If-Match** заголовок содержит hello подстановочный знак (*), служба hello выполняет hello запросил операцию и обновления hello текущее значение ETag сущности tooshow hello, что она была обновлена.</span><span class="sxs-lookup"><span data-stu-id="af62d-288">If hello current ETag value of hello entity is hello same as hello ETag in hello mandatory **If-Match** header in hello request or hello **If-Match** header contains hello wildcard character (*), hello service performs hello requested operation and updates hello current ETag value of hello entity tooshow that it has been updated.</span></span>  

<span data-ttu-id="af62d-289">Обратите внимание, в отличие от службы BLOB-объектов hello, служба таблиц hello требует hello клиента tooinclude **If-Match** заголовок в запросы на обновление.</span><span class="sxs-lookup"><span data-stu-id="af62d-289">Note that unlike hello blob service, hello table service requires hello client tooinclude an **If-Match** header in update requests.</span></span> <span data-ttu-id="af62d-290">Однако это возможно tooforce Безусловное обновление (стратегии wins последней записи) и обхода проверки параллелизма, если клиент hello задает hello **If-Match** заголовок toohello подстановочный знак (*) в запросе hello.</span><span class="sxs-lookup"><span data-stu-id="af62d-290">However, it is possible tooforce an unconditional update (last writer wins strategy) and bypass concurrency checks if hello client sets hello **If-Match** header toohello wildcard character (*) in hello request.</span></span>  

<span data-ttu-id="af62d-291">Привет, следующий фрагмент кода C# показано сущность «клиент», который ранее создана или получить которых свой адрес электронной почты обновить.</span><span class="sxs-lookup"><span data-stu-id="af62d-291">hello following C# snippet shows a customer entity that was previously either created or retrieved having their email address updated.</span></span> <span data-ttu-id="af62d-292">Hello начальный вставки или получения операция сохраняет значение ETag hello hello объекта клиента, а поскольку образец hello использует hello же экземпляр объекта при его выполнении hello заменить операции, он автоматически отправляет службы таблиц обратной toohello значение ETag hello, Включение toocheck службы hello нарушений параллелизма.</span><span class="sxs-lookup"><span data-stu-id="af62d-292">hello initial insert or retrieve operation stores hello ETag value in hello customer object, and because hello sample uses hello same object instance when it executes hello replace operation, it automatically sends hello ETag value back toohello table service, enabling hello service toocheck for concurrency violations.</span></span> <span data-ttu-id="af62d-293">Если другой процесс уже обновлен hello объекта в хранилище таблиц, hello служба возвращает сообщение о состоянии HTTP 412 (необходимое условие не выполнено).</span><span class="sxs-lookup"><span data-stu-id="af62d-293">If another process has updated hello entity in table storage, hello service returns an HTTP 412 (Precondition Failed) status message.</span></span>  <span data-ttu-id="af62d-294">Полный образец hello можно загрузить здесь: [управление параллелизмом, использование хранилища Azure](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span><span class="sxs-lookup"><span data-stu-id="af62d-294">You can download hello full sample here: [Managing Concurrency using Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span></span>

```csharp
try
{
    customer.Email = "updatedEmail@contoso.org";
    TableOperation replaceCustomer = TableOperation.Replace(customer);
    customerTable.Execute(replaceCustomer);
    Console.WriteLine("Replace operation succeeded.");
}
catch (StorageException ex)
{
    if (ex.RequestInformation.HttpStatusCode == 412)
        Console.WriteLine("Optimistic concurrency violation – entity has changed since it was retrieved.");
    else
        throw;
}  
```

<span data-ttu-id="af62d-295">tooexplicitly отключить проверку параллелизма hello, необходимо задать hello **ETag** свойство hello **сотрудника** объекта слишком «*» до выполнения операции замены hello.</span><span class="sxs-lookup"><span data-stu-id="af62d-295">tooexplicitly disable hello concurrency check, you should set hello **ETag** property of hello **employee** object too"*" before you execute hello replace operation.</span></span>  

```csharp
customer.ETag = "*";  
```

<span data-ttu-id="af62d-296">Hello следующей таблице перечислены как операции с сущностями hello таблицы использовать значения ETag.</span><span class="sxs-lookup"><span data-stu-id="af62d-296">hello following table summarizes how hello table entity operations use ETag values:</span></span>

| <span data-ttu-id="af62d-297">Операция</span><span class="sxs-lookup"><span data-stu-id="af62d-297">Operation</span></span> | <span data-ttu-id="af62d-298">Returns ETag value (Возврат значения ETag)</span><span class="sxs-lookup"><span data-stu-id="af62d-298">Returns ETag value</span></span> | <span data-ttu-id="af62d-299">Requires If-Match request header (Требует заголовок запроса If-Match)</span><span class="sxs-lookup"><span data-stu-id="af62d-299">Requires If-Match request header</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="af62d-300">Query Entities (Сущности запроса)</span><span class="sxs-lookup"><span data-stu-id="af62d-300">Query Entities</span></span> |<span data-ttu-id="af62d-301">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-301">Yes</span></span> |<span data-ttu-id="af62d-302">Нет</span><span class="sxs-lookup"><span data-stu-id="af62d-302">No</span></span> |
| <span data-ttu-id="af62d-303">Insert Entity (Вставка сущности )</span><span class="sxs-lookup"><span data-stu-id="af62d-303">Insert Entity</span></span> |<span data-ttu-id="af62d-304">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-304">Yes</span></span> |<span data-ttu-id="af62d-305">Нет</span><span class="sxs-lookup"><span data-stu-id="af62d-305">No</span></span> |
| <span data-ttu-id="af62d-306">Update Entity (Обновление сущности)</span><span class="sxs-lookup"><span data-stu-id="af62d-306">Update Entity</span></span> |<span data-ttu-id="af62d-307">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-307">Yes</span></span> |<span data-ttu-id="af62d-308">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-308">Yes</span></span> |
| <span data-ttu-id="af62d-309">Merge Entity (Слияние сущностей)</span><span class="sxs-lookup"><span data-stu-id="af62d-309">Merge Entity</span></span> |<span data-ttu-id="af62d-310">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-310">Yes</span></span> |<span data-ttu-id="af62d-311">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-311">Yes</span></span> |
| <span data-ttu-id="af62d-312">Delete Entity (Удаление сущности)</span><span class="sxs-lookup"><span data-stu-id="af62d-312">Delete Entity</span></span> |<span data-ttu-id="af62d-313">Нет</span><span class="sxs-lookup"><span data-stu-id="af62d-313">No</span></span> |<span data-ttu-id="af62d-314">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-314">Yes</span></span> |
| <span data-ttu-id="af62d-315">Insert or Replace Entity (Вставка или замена сущности)</span><span class="sxs-lookup"><span data-stu-id="af62d-315">Insert or Replace Entity</span></span> |<span data-ttu-id="af62d-316">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-316">Yes</span></span> |<span data-ttu-id="af62d-317">Нет</span><span class="sxs-lookup"><span data-stu-id="af62d-317">No</span></span> |
| <span data-ttu-id="af62d-318">Insert or Merge Entity (Вставка или слияние сущностей)</span><span class="sxs-lookup"><span data-stu-id="af62d-318">Insert or Merge Entity</span></span> |<span data-ttu-id="af62d-319">Да</span><span class="sxs-lookup"><span data-stu-id="af62d-319">Yes</span></span> |<span data-ttu-id="af62d-320">Нет</span><span class="sxs-lookup"><span data-stu-id="af62d-320">No</span></span> |

<span data-ttu-id="af62d-321">Обратите внимание, что hello **Вставка или замена сущности** и **Вставка или слияние сущности** выполните операции *не* выполняют проверку параллелизма, так как они не отправляют toohello значение ETag Служба таблиц.</span><span class="sxs-lookup"><span data-stu-id="af62d-321">Note that hello **Insert or Replace Entity** and **Insert or Merge Entity** operations do *not* perform any concurrency checks because they do not send an ETag value toohello table service.</span></span>  

<span data-ttu-id="af62d-322">В основном разработчики, использующие таблицы, при разработке масштабируемых приложений должны полагаться на оптимистичный параллелизм.</span><span class="sxs-lookup"><span data-stu-id="af62d-322">In general developers using tables should rely on optimistic concurrency when developing scalable applications.</span></span> <span data-ttu-id="af62d-323">При необходимости Пессимистическая блокировка разработчики одним из подходов можно воспользоваться при доступе к таблицам tooassign большого двоичного объекта, указанного для каждой таблицы и повторите tootake аренду для большого двоичного объекта hello перед выполнением операции с hello таблицы.</span><span class="sxs-lookup"><span data-stu-id="af62d-323">If pessimistic locking is needed, one approach developers can take when accessing Tables is tooassign a designated blob for each table and try tootake a lease on hello blob before operating on hello table.</span></span> <span data-ttu-id="af62d-324">Этот подход требует tooensure приложения hello доступом пути получения предыдущих toooperating hello аренды в таблице hello.</span><span class="sxs-lookup"><span data-stu-id="af62d-324">This approach does require hello application tooensure all data access paths obtain hello lease prior toooperating on hello table.</span></span> <span data-ttu-id="af62d-325">Следует отметить, что hello аренды минимальное время составляет 15 секунд что требует тщательного анализа последствий для масштабируемости.</span><span class="sxs-lookup"><span data-stu-id="af62d-325">You should also note that hello minimum lease time is 15 seconds which requires careful consideration for scalability.</span></span>  

<span data-ttu-id="af62d-326">Дополнительные сведения см. в разделах:</span><span class="sxs-lookup"><span data-stu-id="af62d-326">For more information see:</span></span>  

* [<span data-ttu-id="af62d-327">Операции с сущностями</span><span class="sxs-lookup"><span data-stu-id="af62d-327">Operations on Entities</span></span>](http://msdn.microsoft.com/library/azure/dd179375.aspx)  

## <a name="managing-concurrency-in-hello-queue-service"></a><span data-ttu-id="af62d-328">Управление параллелизмом в hello службы очередей</span><span class="sxs-lookup"><span data-stu-id="af62d-328">Managing Concurrency in hello Queue Service</span></span>
<span data-ttu-id="af62d-329">Один сценарий, в которой параллелизма проблемой в службе очередей hello — где нескольким клиентам получении сообщений из очереди.</span><span class="sxs-lookup"><span data-stu-id="af62d-329">One scenario in which concurrency is a concern in hello queueing service is where multiple clients are retrieving messages from a queue.</span></span> <span data-ttu-id="af62d-330">При получении сообщения из очереди hello hello ответа включает приветственное сообщение и значение подтверждения, который является обязательным toodelete приветственное сообщение.</span><span class="sxs-lookup"><span data-stu-id="af62d-330">When a message is retrieved from hello queue, hello response includes hello message and a pop receipt value, which is required toodelete hello message.</span></span> <span data-ttu-id="af62d-331">приветственное сообщение не удаляется из очереди hello автоматически, но после его получения, не видны tooother клиентов hello временного интервала, указанного параметром visibilitytimeout hello.</span><span class="sxs-lookup"><span data-stu-id="af62d-331">hello message is not automatically deleted from hello queue, but after it has been retrieved, it is not visible tooother clients for hello time interval specified by hello visibilitytimeout parameter.</span></span> <span data-ttu-id="af62d-332">Hello клиента, который получает сообщение hello является ожидаемым toodelete приветственное сообщение после обработки, а перед hello времени указывает hello TimeNextVisible элемент ответа hello, которое вычисляется на основе значения hello hello visibilitytimeout параметр.</span><span class="sxs-lookup"><span data-stu-id="af62d-332">hello client that retrieves hello message is expected toodelete hello message after it has been processed, and before hello time specified by hello TimeNextVisible element of hello response, which is calculated based on hello value of hello visibilitytimeout parameter.</span></span> <span data-ttu-id="af62d-333">значение Hello visibilitytimeout добавляется значение hello toodetermine TimeNextVisible получить toohello времени, какие hello является сообщение.</span><span class="sxs-lookup"><span data-stu-id="af62d-333">hello value of visibilitytimeout is added toohello time at which hello message is retrieved toodetermine hello value of TimeNextVisible.</span></span>  

<span data-ttu-id="af62d-334">Hello очереди службы отсутствует поддержка пессимистичного или оптимистичного параллелизма и для этого клиентам причина обработки сообщения, отбираемые из очереди следует убедитесь, что сообщения обрабатываются в режиме идемпотентными.</span><span class="sxs-lookup"><span data-stu-id="af62d-334">hello queue service does not have support for either optimistic or pessimistic concurrency and for this reason clients processing messages retrieved from a queue should ensure messages are processed in an idempotent manner.</span></span> <span data-ttu-id="af62d-335">Стратегия "Сохраняются изменения, внесенные последними" используется для обновления операций, таких как SetQueueServiceProperties, SetQueueMetaData, SetQueueACL и UpdateMessage.</span><span class="sxs-lookup"><span data-stu-id="af62d-335">A last writer wins strategy is used for update operations such as SetQueueServiceProperties, SetQueueMetaData, SetQueueACL and UpdateMessage.</span></span>  

<span data-ttu-id="af62d-336">Дополнительные сведения см. в разделах:</span><span class="sxs-lookup"><span data-stu-id="af62d-336">For more information see:</span></span>  

* [<span data-ttu-id="af62d-337">REST API службы очередей</span><span class="sxs-lookup"><span data-stu-id="af62d-337">Queue Service REST API</span></span>](http://msdn.microsoft.com/library/azure/dd179363.aspx)
* [<span data-ttu-id="af62d-338">Получение сообщений</span><span class="sxs-lookup"><span data-stu-id="af62d-338">Get Messages</span></span>](http://msdn.microsoft.com/library/azure/dd179474.aspx)  

## <a name="managing-concurrency-in-hello-file-service"></a><span data-ttu-id="af62d-339">Управление параллелизмом в hello файловой службы</span><span class="sxs-lookup"><span data-stu-id="af62d-339">Managing Concurrency in hello File Service</span></span>
<span data-ttu-id="af62d-340">Служба файлов Hello осуществляется с помощью две конечные точки разных протоколов — SMB и REST.</span><span class="sxs-lookup"><span data-stu-id="af62d-340">hello file service can be accessed using two different protocol endpoints – SMB and REST.</span></span> <span data-ttu-id="af62d-341">Hello службы REST не поддерживает оптимистической блокировки или пессимистичных блокировок и все обновления будут следовать стратегии wins последней записи.</span><span class="sxs-lookup"><span data-stu-id="af62d-341">hello REST service does not have support for either optimistic locking or pessimistic locking and all updates will follow a last writer wins strategy.</span></span> <span data-ttu-id="af62d-342">Клиенты SMB, которые подключают общие файловые ресурсы можно использовать файлы файловой системы блокировки механизмов toomanage доступа tooshared — включая hello возможность tooperform пессимистичных блокировок.</span><span class="sxs-lookup"><span data-stu-id="af62d-342">SMB clients that mount file shares can leverage file system locking mechanisms toomanage access tooshared files – including hello ability tooperform pessimistic locking.</span></span> <span data-ttu-id="af62d-343">Когда клиент SMB открывает файл, он указывает, доступ к файлам hello и общую папку режиме.</span><span class="sxs-lookup"><span data-stu-id="af62d-343">When an SMB client opens a file, it specifies both hello file access and share mode.</span></span> <span data-ttu-id="af62d-344">Задание «Запись» или «Чтение» является параметром доступ к файлам и режим общей папки «None» приведет файл hello блокируемого клиентом SMB до закрытия файла hello.</span><span class="sxs-lookup"><span data-stu-id="af62d-344">Setting a File Access option of "Write" or "Read/Write" along with a File Share mode of "None" will result in hello file being locked by an SMB client until hello file is closed.</span></span> <span data-ttu-id="af62d-345">Если предпринимается попытка операции REST для файла, где клиент SMB открыл файл hello заблокирован hello службы REST возвращает код состояния 409 (конфликт) с кодом ошибки SharingViolation.</span><span class="sxs-lookup"><span data-stu-id="af62d-345">If REST operation is attempted on a file where an SMB client has hello file locked hello REST service will return status code 409 (Conflict) with error code SharingViolation.</span></span>  

<span data-ttu-id="af62d-346">Клиент SMB открывает файл для удаления, отмечает hello файл как ожидающий удаления, пока все SMB-клиент закрываются открытые дескрипторы для этого файла.</span><span class="sxs-lookup"><span data-stu-id="af62d-346">When an SMB client opens a file for delete, it marks hello file as pending delete until all other SMB client open handles on that file are closed.</span></span> <span data-ttu-id="af62d-347">Пока файл отмечен как "ожидающий удаления", любая операция REST на этом файле вернется кодом состояния 409 (конфликт) и с кодом ошибки SMBDeletePending.</span><span class="sxs-lookup"><span data-stu-id="af62d-347">While a file is marked as pending delete, any REST operation on that file will return status code 409 (Conflict) with error code SMBDeletePending.</span></span> <span data-ttu-id="af62d-348">Код состояния 404 (не найдено) не возвращается, поскольку существует возможность приветствия tooremove клиента SMB hello ожидающие удаления флага предыдущих tooclosing hello файла.</span><span class="sxs-lookup"><span data-stu-id="af62d-348">Status code 404 (Not Found) is not returned since it is possible for hello SMB client tooremove hello pending deletion flag prior tooclosing hello file.</span></span> <span data-ttu-id="af62d-349">Другими словами код состояния 404 (не найдено) ожидается только после удаления файла hello.</span><span class="sxs-lookup"><span data-stu-id="af62d-349">In other words, status code 404 (Not Found) is only expected when hello file has been removed.</span></span> <span data-ttu-id="af62d-350">Обратите внимание, что если файл находится в состоянии ожидания удаления SMB, он не включается в приветствия приводит список файлов. Также Обратите внимание, что операции REST удаление файла и удаления каталога REST hello фиксируются автоматически и не приводят к ожидающие удаления состояния.</span><span class="sxs-lookup"><span data-stu-id="af62d-350">Note that while a file is in a SMB pending delete state, it will not be included in hello List Files results.Also note that hello REST Delete File and REST Delete Directory operations are committed atomically and do not result in pending delete state.</span></span>  

<span data-ttu-id="af62d-351">Дополнительные сведения см. в разделах:</span><span class="sxs-lookup"><span data-stu-id="af62d-351">For more information see:</span></span>  

* [<span data-ttu-id="af62d-352">Управление блокировкой файлов</span><span class="sxs-lookup"><span data-stu-id="af62d-352">Managing File Locks</span></span>](http://msdn.microsoft.com/library/azure/dn194265.aspx)  

## <a name="summary-and-next-steps"></a><span data-ttu-id="af62d-353">Сводка и дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="af62d-353">Summary and Next Steps</span></span>
<span data-ttu-id="af62d-354">Hello хранилища Microsoft Azure, служба была разработана потребностей hello toomeet сложные интерактивные приложения hello без перезагрузки разработчики toocompromise или пересмотреть ключевые особенности допущения, например согласованности параллелизма и данных, требуют tootake должное.</span><span class="sxs-lookup"><span data-stu-id="af62d-354">hello Microsoft Azure Storage service has been designed toomeet hello needs of hello most complex online applications without forcing developers toocompromise or rethink key design assumptions such as concurrency and data consistency that they have come tootake for granted.</span></span>  

<span data-ttu-id="af62d-355">Для hello выполните образец приложения, на которые ссылается этот блог.</span><span class="sxs-lookup"><span data-stu-id="af62d-355">For hello complete sample application referenced in this blog:</span></span>  

* [<span data-ttu-id="af62d-356">Управление параллелизмом с помощью службы хранилища Azure: пример приложения</span><span class="sxs-lookup"><span data-stu-id="af62d-356">Managing Concurrency using Azure Storage - Sample Application</span></span>](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114)  

<span data-ttu-id="af62d-357">Подробнее о службе хранения Azure:</span><span class="sxs-lookup"><span data-stu-id="af62d-357">For more information on Azure Storage see:</span></span>  

* [<span data-ttu-id="af62d-358">Домашняя страница службы хранилища Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="af62d-358">Microsoft Azure Storage Home Page</span></span>](https://azure.microsoft.com/services/storage/)
* [<span data-ttu-id="af62d-359">Введение tooAzure хранилища</span><span class="sxs-lookup"><span data-stu-id="af62d-359">Introduction tooAzure Storage</span></span>](storage-introduction.md)
* <span data-ttu-id="af62d-360">Приступая к работе с хранилищем: [большой двоичный объект](storage-dotnet-how-to-use-blobs.md), [таблица](storage-dotnet-how-to-use-tables.md), [очереди](storage-dotnet-how-to-use-queues.md) и [файлы](storage-dotnet-how-to-use-files.md).</span><span class="sxs-lookup"><span data-stu-id="af62d-360">Storage Getting Started for [Blob](storage-dotnet-how-to-use-blobs.md), [Table](storage-dotnet-how-to-use-tables.md),  [Queues](storage-dotnet-how-to-use-queues.md), and [Files](storage-dotnet-how-to-use-files.md)</span></span>
* <span data-ttu-id="af62d-361">Архитектура службы хранилища — [служба хранилища Azure: высокодоступная служба облачного хранения со строгой согласованностью](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/11/20/windows-azure-storage-a-highly-available-cloud-storage-service-with-strong-consistency.aspx)</span><span class="sxs-lookup"><span data-stu-id="af62d-361">Storage Architecture – [Azure Storage : A Highly Available Cloud Storage Service with Strong Consistency](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/11/20/windows-azure-storage-a-highly-available-cloud-storage-service-with-strong-consistency.aspx)</span></span>

