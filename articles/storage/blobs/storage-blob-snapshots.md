---
title: "доступный только для чтения моментальный снимок большого двоичного объекта в хранилище Azure aaaCreate | Документы Microsoft"
description: "Узнайте, как toocreate моментальный снимок большого двоичного объекта tooback копии большого двоичного объекта в данный момент времени. Понять, как выставляются моментальные снимки и как toouse их toominimize емкости расходов."
services: storage
documentationcenter: 
author: mmacy
manager: timlt
editor: tysonn
ms.assetid: 3710705d-e127-4b01-8d0f-29853fb06d0d
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/11/2017
ms.author: marsma
ms.openlocfilehash: 57f2e76b8899b8a513688bf148dd13673141d5bd
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="create-a-blob-snapshot"></a><span data-ttu-id="157c7-104">Создание моментального снимка BLOB-объекта</span><span class="sxs-lookup"><span data-stu-id="157c7-104">Create a blob snapshot</span></span>

<span data-ttu-id="157c7-105">Моментальный снимок — это версия BLOB-объекта только для чтения, сделанная в определенный момент времени.</span><span class="sxs-lookup"><span data-stu-id="157c7-105">A snapshot is a read-only version of a blob that's taken at a point in time.</span></span> <span data-ttu-id="157c7-106">Моментальные снимки полезны для архивации BLOB-объектов.</span><span class="sxs-lookup"><span data-stu-id="157c7-106">Snapshots are useful for backing up blobs.</span></span> <span data-ttu-id="157c7-107">После создания моментального снимка его можно прочитать, скопировать или удалить, но вы не можете изменять его.</span><span class="sxs-lookup"><span data-stu-id="157c7-107">After you create a snapshot, you can read, copy, or delete it, but you cannot modify it.</span></span>

<span data-ttu-id="157c7-108">Моментальный снимок большого двоичного объекта — идентичные tooits базового большого двоичного объекта, за исключением hello большого двоичного объекта имеет URI **DateTime** значение добавлено toohello большой двоичный объект URI tooindicate hello времени в какой hello был сделан снимок.</span><span class="sxs-lookup"><span data-stu-id="157c7-108">A snapshot of a blob is identical tooits base blob, except that hello blob URI has a **DateTime** value appended toohello blob URI tooindicate hello time at which hello snapshot was taken.</span></span> <span data-ttu-id="157c7-109">Например, если страничный большой двоичный объект URI — `http://storagesample.core.blob.windows.net/mydrives/myvhd`, моментальный снимок hello URI аналогичен слишком`http://storagesample.core.blob.windows.net/mydrives/myvhd?snapshot=2011-03-09T01:42:34.9360000Z`.</span><span class="sxs-lookup"><span data-stu-id="157c7-109">For example, if a page blob URI is `http://storagesample.core.blob.windows.net/mydrives/myvhd`, hello snapshot URI is similar too`http://storagesample.core.blob.windows.net/mydrives/myvhd?snapshot=2011-03-09T01:42:34.9360000Z`.</span></span>

> [!NOTE]
> <span data-ttu-id="157c7-110">Все моментальные снимки имеют URI hello базового большого двоичного объекта.</span><span class="sxs-lookup"><span data-stu-id="157c7-110">All snapshots share hello base blob's URI.</span></span> <span data-ttu-id="157c7-111">Здравствуйте только различие между hello базового BLOB-объектов и моментальных снимков hello hello добавляется **DateTime** значение.</span><span class="sxs-lookup"><span data-stu-id="157c7-111">hello only distinction between hello base blob and hello snapshot is hello appended **DateTime** value.</span></span>
>

<span data-ttu-id="157c7-112">Большой двоичный объект может иметь любое количество моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="157c7-112">A blob can have any number of snapshots.</span></span> <span data-ttu-id="157c7-113">Моментальные снимки хранятся до тех пор, пока не будут явно удалены.</span><span class="sxs-lookup"><span data-stu-id="157c7-113">Snapshots persist until they are explicitly deleted.</span></span> <span data-ttu-id="157c7-114">При удалении исходного BLOB-объекта моментальный снимок будет также удален.</span><span class="sxs-lookup"><span data-stu-id="157c7-114">A snapshot cannot outlive its base blob.</span></span> <span data-ttu-id="157c7-115">Hello моментальных снимков, связанных с tootrack hello базового большого двоичного объекта, можно перечислить моментальные.</span><span class="sxs-lookup"><span data-stu-id="157c7-115">You can enumerate hello snapshots associated with hello base blob tootrack your current snapshots.</span></span>

<span data-ttu-id="157c7-116">При создании моментального снимка большого двоичного объекта, hello системные свойства большого двоичного объекта, скопированного toohello моментальный снимок с hello одинаковые значения.</span><span class="sxs-lookup"><span data-stu-id="157c7-116">When you create a snapshot of a blob, hello blob's system properties are copied toohello snapshot with hello same values.</span></span> <span data-ttu-id="157c7-117">Hello базового большого двоичного объекта метаданных также является скопированный toohello моментальных снимков, если не указать отдельные метаданные для hello моментального снимка при ее создании.</span><span class="sxs-lookup"><span data-stu-id="157c7-117">hello base blob's metadata is also copied toohello snapshot, unless you specify separate metadata for hello snapshot when you create it.</span></span>

<span data-ttu-id="157c7-118">Связанные с hello базового BLOB-объекта аренды не влияют на hello моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="157c7-118">Any leases associated with hello base blob do not affect hello snapshot.</span></span> <span data-ttu-id="157c7-119">Вы не можете получить аренду в моментальном снимке.</span><span class="sxs-lookup"><span data-stu-id="157c7-119">You cannot acquire a lease on a snapshot.</span></span>

<span data-ttu-id="157c7-120">Файл виртуального жесткого диска, используется toostore hello текущие данные и состояние диска виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="157c7-120">A VHD file is used toostore hello current information and status for a VM disk.</span></span> <span data-ttu-id="157c7-121">Можно отсоединить диск от внутри hello виртуальной Машины или завершить работу виртуальной Машины hello и затем создать моментальный снимок VHD-файл.</span><span class="sxs-lookup"><span data-stu-id="157c7-121">You can detach a disk from within hello VM or shut down hello VM, and then take a snapshot of its VHD file.</span></span> <span data-ttu-id="157c7-122">Можно использовать этот файл моментального снимка более поздней версии tooretrieve hello VHD файлов на момент времени и повторно создайте hello виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="157c7-122">You can use that snapshot file later tooretrieve hello VHD file at that point in time and recreate hello VM.</span></span>

<span data-ttu-id="157c7-123">Если для учетной записи хранилища hello включено шифрование службы хранилища (SSE) в какие hello находится больших двоичных объектов, а затем неактивные будут зашифрованы все моментальные снимки, что BLOB-объекта.</span><span class="sxs-lookup"><span data-stu-id="157c7-123">If Storage Service Encryption (SSE) is enabled for hello storage account in which hello blob resides, then any snapshots taken of that blob will be encrypted at rest.</span></span>

## <a name="create-a-snapshot"></a><span data-ttu-id="157c7-124">Создание моментального снимка</span><span class="sxs-lookup"><span data-stu-id="157c7-124">Create a snapshot</span></span>
<span data-ttu-id="157c7-125">Hello примере кода показано, как hello toocreate моментальный снимок с помощью [клиентская библиотека хранилища Azure для .NET](https://www.nuget.org/packages/WindowsAzure.Storage/).</span><span class="sxs-lookup"><span data-stu-id="157c7-125">hello following code example shows how toocreate a snapshot by using hello [Azure Storage Client Library for .NET](https://www.nuget.org/packages/WindowsAzure.Storage/).</span></span> <span data-ttu-id="157c7-126">В этом примере задает дополнительные метаданные для hello моментального снимка при его создании.</span><span class="sxs-lookup"><span data-stu-id="157c7-126">This example specifies additional metadata for hello snapshot when it is created.</span></span>

```csharp
private static async Task CreateBlockBlobSnapshot(CloudBlobContainer container)
{
    // Create a new block blob in hello container.
    CloudBlockBlob baseBlob = container.GetBlockBlobReference("sample-base-blob.txt");

    // Add blob metadata.
    baseBlob.Metadata.Add("ApproxBlobCreatedDate", DateTime.UtcNow.ToString());

    try
    {
        // Upload hello blob toocreate it, with its metadata.
        await baseBlob.UploadTextAsync(string.Format("Base blob: {0}", baseBlob.Uri.ToString()));

        // Sleep 5 seconds.
        System.Threading.Thread.Sleep(5000);

        // Create a snapshot of hello base blob.
        // Specify metadata at hello time that hello snapshot is created toospecify unique metadata for hello snapshot.
        // If no metadata is specified when hello snapshot is created, hello base blob's metadata is copied toohello snapshot.
        Dictionary<string, string> metadata = new Dictionary<string, string>();
        metadata.Add("ApproxSnapshotCreatedDate", DateTime.UtcNow.ToString());
        await baseBlob.CreateSnapshotAsync(metadata, null, null, null);
    }
    catch (StorageException e)
    {
        Console.WriteLine(e.Message);
        Console.ReadLine();
        throw;
    }
}
```

## <a name="copy-snapshots"></a><span data-ttu-id="157c7-127">Копирование моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="157c7-127">Copy snapshots</span></span>
<span data-ttu-id="157c7-128">Операции копирования больших двоичных объектов и моментальных снимков подчиняются следующим правилам.</span><span class="sxs-lookup"><span data-stu-id="157c7-128">Copy operations involving blobs and snapshots follow these rules:</span></span>

* <span data-ttu-id="157c7-129">Можно скопировать моментальный снимок и заменить им исходный большой двоичный объект.</span><span class="sxs-lookup"><span data-stu-id="157c7-129">You can copy a snapshot over its base blob.</span></span> <span data-ttu-id="157c7-130">Переместив положения toohello hello базового BLOB-объекта моментального снимка, можно восстановить более раннюю версию большого двоичного объекта.</span><span class="sxs-lookup"><span data-stu-id="157c7-130">By promoting a snapshot toohello position of hello base blob, you can restore an earlier version of a blob.</span></span> <span data-ttu-id="157c7-131">Здравствуйте, моментальный снимок остается, но hello базовый большой двоичный объект перезаписывается копией для записи моментальных снимков hello.</span><span class="sxs-lookup"><span data-stu-id="157c7-131">hello snapshot remains, but hello base blob is overwritten with a writable copy of hello snapshot.</span></span>
* <span data-ttu-id="157c7-132">Можно скопировать моментальный снимок tooa BLOB-объект назначения с другим именем.</span><span class="sxs-lookup"><span data-stu-id="157c7-132">You can copy a snapshot tooa destination blob with a different name.</span></span> <span data-ttu-id="157c7-133">Hello полученный BLOB-объект назначения является доступным для записи большого двоичного объекта и моментальный снимок не.</span><span class="sxs-lookup"><span data-stu-id="157c7-133">hello resulting destination blob is a writable blob and not a snapshot.</span></span>
* <span data-ttu-id="157c7-134">Когда копируется исходный большой двоичный объект, все снимки hello исходного большого двоичного объекта не копируются toohello назначения.</span><span class="sxs-lookup"><span data-stu-id="157c7-134">When a source blob is copied, any snapshots of hello source blob are not copied toohello destination.</span></span> <span data-ttu-id="157c7-135">Когда целевой большой двоичный объект перезаписывается копией, все моментальные снимки, связанные с hello исходный BLOB-объект назначения остаются без изменений.</span><span class="sxs-lookup"><span data-stu-id="157c7-135">When a destination blob is overwritten with a copy, any snapshots associated with hello original destination blob remain intact.</span></span>
* <span data-ttu-id="157c7-136">При создании моментального снимка большого двоичного объекта блока, список зафиксированных блокировок hello blob также является снимком скопированный toohello.</span><span class="sxs-lookup"><span data-stu-id="157c7-136">When you create a snapshot of a block blob, hello blob's committed block list is also copied toohello snapshot.</span></span> <span data-ttu-id="157c7-137">Незафиксированные блоки не копируются.</span><span class="sxs-lookup"><span data-stu-id="157c7-137">Any uncommitted blocks are not copied.</span></span>

## <a name="specify-an-access-condition"></a><span data-ttu-id="157c7-138">Назначение условий доступа</span><span class="sxs-lookup"><span data-stu-id="157c7-138">Specify an access condition</span></span>
<span data-ttu-id="157c7-139">При вызове [CreateSnapshotAsync][dotnet_CreateSnapshotAsync], можно указать условие доступа, чтобы hello моментальный снимок создается только в том случае, если условие выполняется.</span><span class="sxs-lookup"><span data-stu-id="157c7-139">When you call [CreateSnapshotAsync][dotnet_CreateSnapshotAsync], you can specify an access condition so that hello snapshot is created only if a condition is met.</span></span> <span data-ttu-id="157c7-140">toospecify условие доступа, используйте hello [AccessCondition] [ dotnet_AccessCondition] параметра.</span><span class="sxs-lookup"><span data-stu-id="157c7-140">toospecify an access condition, use hello [AccessCondition][dotnet_AccessCondition] parameter.</span></span> <span data-ttu-id="157c7-141">Если условие не выполняется, hello моментальный снимок не создается и hello службы BLOB-объектов возвращает код состояния hello [HTTPStatusCode][dotnet_HTTPStatusCode]. PreconditionFailed.</span><span class="sxs-lookup"><span data-stu-id="157c7-141">If hello specified condition is not met, hello snapshot is not created, and hello Blob service returns status code [HTTPStatusCode][dotnet_HTTPStatusCode].PreconditionFailed.</span></span>

## <a name="delete-snapshots"></a><span data-ttu-id="157c7-142">Удаление моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="157c7-142">Delete snapshots</span></span>
<span data-ttu-id="157c7-143">Для удаления большого двоичного объекта с моментальными снимками hello моментальные снимки также будут удалены.</span><span class="sxs-lookup"><span data-stu-id="157c7-143">You can't delete a blob with snapshots unless hello snapshots are also deleted.</span></span> <span data-ttu-id="157c7-144">Удаление моментального снимка по отдельности или удалить все снимки при удалении hello исходного большого двоичного объекта.</span><span class="sxs-lookup"><span data-stu-id="157c7-144">You can delete a snapshot individually, or specify that all snapshots be deleted when hello source blob is deleted.</span></span> <span data-ttu-id="157c7-145">При попытке toodelete большой двоичный объект, по-прежнему имеются моментальные снимки, результатом будет ошибка.</span><span class="sxs-lookup"><span data-stu-id="157c7-145">If you attempt toodelete a blob that still has snapshots, an error results.</span></span>

<span data-ttu-id="157c7-146">Здравствуйте, следуя примере кода показано, как toodelete большого двоичного объекта и его моментальные снимки в .NET, где `blockBlob` — это объект типа [CloudBlockBlob][dotnet_CloudBlockBlob]:</span><span class="sxs-lookup"><span data-stu-id="157c7-146">hello following code example shows how toodelete a blob and its snapshots in .NET, where `blockBlob` is an object of type [CloudBlockBlob][dotnet_CloudBlockBlob]:</span></span>

```csharp
await blockBlob.DeleteIfExistsAsync(DeleteSnapshotsOption.IncludeSnapshots, null, null, null);
```

## <a name="snapshots-with-azure-premium-storage"></a><span data-ttu-id="157c7-147">Моментальные снимки и хранилище Azure Premium</span><span class="sxs-lookup"><span data-stu-id="157c7-147">Snapshots with Azure Premium Storage</span></span>
<span data-ttu-id="157c7-148">При использовании хранилища Premium моментальных снимков, применяются hello следующие правила:</span><span class="sxs-lookup"><span data-stu-id="157c7-148">When using snapshots with Premium Storage, hello following rules apply:</span></span>

* <span data-ttu-id="157c7-149">Hello моментальных снимков для каждого большого двоичного объекта страницы в учетной записи хранения premium не более 100.</span><span class="sxs-lookup"><span data-stu-id="157c7-149">hello maximum number of snapshots per page blob in a premium storage account is 100.</span></span> <span data-ttu-id="157c7-150">Если этот предел превышен, hello операции моментальный снимок BLOB-объектов возвращает код ошибки 409 (`SnapshotCountExceeded`).</span><span class="sxs-lookup"><span data-stu-id="157c7-150">If that limit is exceeded, hello Snapshot Blob operation returns error code 409 (`SnapshotCountExceeded`).</span></span>
* <span data-ttu-id="157c7-151">При использовании учетной записи хранения класса Premium каждые десять минут можно создавать один моментальный снимок страничного BLOB-объекта.</span><span class="sxs-lookup"><span data-stu-id="157c7-151">You can take a snapshot of a page blob in a premium storage account once every 10 minutes.</span></span> <span data-ttu-id="157c7-152">В случае превышения этого курса hello операции моментальный снимок BLOB-объектов возвращает код ошибки 409 (`SnapshotOperationRateExceeded`).</span><span class="sxs-lookup"><span data-stu-id="157c7-152">If that rate is exceeded, hello Snapshot Blob operation returns error code 409 (`SnapshotOperationRateExceeded`).</span></span>
* <span data-ttu-id="157c7-153">tooread моментального снимка, можно использовать toocopy операции копирования BLOB-объекта hello моментального снимка tooanother страничный большой двоичный объект в учетной записи hello.</span><span class="sxs-lookup"><span data-stu-id="157c7-153">tooread a snapshot, you can use hello Copy Blob operation toocopy a snapshot tooanother page blob in hello account.</span></span> <span data-ttu-id="157c7-154">Hello BLOB-объект назначения для операции копирования hello не должен содержать все существующие моментальные снимки.</span><span class="sxs-lookup"><span data-stu-id="157c7-154">hello destination blob for hello copy operation must not have any existing snapshots.</span></span> <span data-ttu-id="157c7-155">Если BLOB-объект назначения hello имеет моментальные снимки, то hello операции копирования BLOB-объектов возвращает код ошибки 409 (`SnapshotsPresent`).</span><span class="sxs-lookup"><span data-stu-id="157c7-155">If hello destination blob does have snapshots, then hello Copy Blob operation returns error code 409 (`SnapshotsPresent`).</span></span>

## <a name="return-hello-absolute-uri-tooa-snapshot"></a><span data-ttu-id="157c7-156">Возвращает моментальный снимок tooa hello абсолютный URI</span><span class="sxs-lookup"><span data-stu-id="157c7-156">Return hello absolute URI tooa snapshot</span></span>
<span data-ttu-id="157c7-157">Данный пример кода C# создается моментальный снимок и записывает hello абсолютный URI для hello первичного расположения.</span><span class="sxs-lookup"><span data-stu-id="157c7-157">This C# code example creates a snapshot and writes out hello absolute URI for hello primary location.</span></span>

```csharp
//Create hello blob service client object.
const string ConnectionString = "DefaultEndpointsProtocol=https;AccountName=account-name;AccountKey=account-key";

CloudStorageAccount storageAccount = CloudStorageAccount.Parse(ConnectionString);
CloudBlobClient blobClient = storageAccount.CreateCloudBlobClient();

//Get a reference tooa container.
CloudBlobContainer container = blobClient.GetContainerReference("sample-container");
container.CreateIfNotExists();

//Get a reference tooa blob.
CloudBlockBlob blob = container.GetBlockBlobReference("sampleblob.txt");
blob.UploadText("This is a blob.");

//Create a snapshot of hello blob and write out its primary URI.
CloudBlockBlob blobSnapshot = blob.CreateSnapshot();
Console.WriteLine(blobSnapshot.SnapshotQualifiedStorageUri.PrimaryUri);
```

## <a name="understand-how-snapshots-accrue-charges"></a><span data-ttu-id="157c7-158">Общая информация о том, как моментальные снимки увеличивают плату</span><span class="sxs-lookup"><span data-stu-id="157c7-158">Understand how snapshots accrue charges</span></span>
<span data-ttu-id="157c7-159">Создание моментального снимка, который является копией только для чтения большого двоичного объекта, может привести к учетной записи tooyour плата хранения дополнительных данных.</span><span class="sxs-lookup"><span data-stu-id="157c7-159">Creating a snapshot, which is a read-only copy of a blob, can result in additional data storage charges tooyour account.</span></span> <span data-ttu-id="157c7-160">При разработке приложения, это важно toobe учитывать как выставления счетов может провести, чтобы свести к минимуму затраты.</span><span class="sxs-lookup"><span data-stu-id="157c7-160">When designing your application, it is important toobe aware of how these charges might accrue so that you can minimize costs.</span></span>

### <a name="important-billing-considerations"></a><span data-ttu-id="157c7-161">Важные вопросы о выставлении счетов</span><span class="sxs-lookup"><span data-stu-id="157c7-161">Important billing considerations</span></span>
<span data-ttu-id="157c7-162">После списка Hello включает tooconsider ключевые моменты при создании моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="157c7-162">hello following list includes key points tooconsider when creating a snapshot.</span></span>

* <span data-ttu-id="157c7-163">Вашей учетной записи хранилища может привести к сборам за уникальные блокировки и страницы, являются ли они в большом двоичном объекте hello, или в снимке hello.</span><span class="sxs-lookup"><span data-stu-id="157c7-163">Your storage account incurs charges for unique blocks or pages, whether they are in hello blob or in hello snapshot.</span></span> <span data-ttu-id="157c7-164">Ваша учетная запись не создает дополнительных затрат на моментальные снимки, связанные с большой двоичный объект, пока вы не обновите hello больших двоичных объектов, на которых они основаны.</span><span class="sxs-lookup"><span data-stu-id="157c7-164">Your account does not incur additional charges for snapshots associated with a blob until you update hello blob on which they are based.</span></span> <span data-ttu-id="157c7-165">После обновления базового hello большого двоичного объекта он расходится со своими моментальными снимками.</span><span class="sxs-lookup"><span data-stu-id="157c7-165">After you update hello base blob, it diverges from its snapshots.</span></span> <span data-ttu-id="157c7-166">В этом случае вы оплачивать уникальные блокировки hello и страницы в каждом большого двоичного объекта или моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="157c7-166">When this happens, you are charged for hello unique blocks or pages in each blob or snapshot.</span></span>
* <span data-ttu-id="157c7-167">Когда вы заменяете блок в блочном большом двоичном объекте, за этот блок начинает взиматься плата как за уникальный.</span><span class="sxs-lookup"><span data-stu-id="157c7-167">When you replace a block within a block blob, that block is subsequently charged as a unique block.</span></span> <span data-ttu-id="157c7-168">Это верно, даже если блока hello hello hello же и же идентификатор блока данных по мере имеет в снимке hello.</span><span class="sxs-lookup"><span data-stu-id="157c7-168">This is true even if hello block has hello same block ID and hello same data as it has in hello snapshot.</span></span> <span data-ttu-id="157c7-169">После фиксации блока hello снова, он расходится со всеми своими двойниками во всех моментальных снимках, и вы будете оплачивать его данные.</span><span class="sxs-lookup"><span data-stu-id="157c7-169">After hello block is committed again, it diverges from its counterpart in any snapshot, and you will be charged for its data.</span></span> <span data-ttu-id="157c7-170">Здравствуйте, справедливо и для страницы в страничный большой двоичный объект, который обновляется с идентичными данными.</span><span class="sxs-lookup"><span data-stu-id="157c7-170">hello same holds true for a page in a page blob that's updated with identical data.</span></span>
* <span data-ttu-id="157c7-171">Замена блочный BLOB-объект, вызывающий hello [UploadFromFile][dotnet_UploadFromFile], [UploadText][dotnet_UploadText], [UploadFromStream] [ dotnet_UploadFromStream], или [UploadFromByteArray] [ dotnet_UploadFromByteArray] метод заменяет все блоки в большом двоичном объекте hello.</span><span class="sxs-lookup"><span data-stu-id="157c7-171">Replacing a block blob by calling hello [UploadFromFile][dotnet_UploadFromFile], [UploadText][dotnet_UploadText], [UploadFromStream][dotnet_UploadFromStream], or [UploadFromByteArray][dotnet_UploadFromByteArray] method replaces all blocks in hello blob.</span></span> <span data-ttu-id="157c7-172">Если моментальный снимок, связанный с этим большим двоичным объектом, теперь разделить все блоки в hello базового BLOB-объектов и моментальных снимков и вы будете оплачивать все блоки hello в обоих больших двоичных объектов.</span><span class="sxs-lookup"><span data-stu-id="157c7-172">If you have a snapshot associated with that blob, all blocks in hello base blob and snapshot now diverge, and you will be charged for all hello blocks in both blobs.</span></span> <span data-ttu-id="157c7-173">Это верно, даже если данные hello в hello базового BLOB-объектов и моментальных снимков hello остаются идентичными.</span><span class="sxs-lookup"><span data-stu-id="157c7-173">This is true even if hello data in hello base blob and hello snapshot remain identical.</span></span>
* <span data-ttu-id="157c7-174">Hello службы больших двоичных объектов не имеет toodetermine означает ли два блока содержат идентичные данные.</span><span class="sxs-lookup"><span data-stu-id="157c7-174">hello Azure Blob service does not have a means toodetermine whether two blocks contain identical data.</span></span> <span data-ttu-id="157c7-175">Каждая блокировка, которая была загружена и зафиксирована, обрабатывается как уникальная, даже если он имеет hello тем же данным и hello же блокирует идентификатор.</span><span class="sxs-lookup"><span data-stu-id="157c7-175">Each block that is uploaded and committed is treated as unique, even if it has hello same data and hello same block ID.</span></span> <span data-ttu-id="157c7-176">Поскольку плата взимается за уникальные блокировки, это важно tooconsider, обновление большого двоичного объекта, имеющего моментальные снимки приводит к дополнительным уникальным блокировкам и дополнительным расходам.</span><span class="sxs-lookup"><span data-stu-id="157c7-176">Because charges accrue for unique blocks, it's important tooconsider that updating a blob that has a snapshot results in additional unique blocks and additional charges.</span></span>

### <a name="minimize-cost-with-snapshot-management"></a><span data-ttu-id="157c7-177">Минимизация затрат с помощью управления моментальными снимками</span><span class="sxs-lookup"><span data-stu-id="157c7-177">Minimize cost with snapshot management</span></span>

<span data-ttu-id="157c7-178">Рекомендуется тщательно управления вашей моментальными снимками tooavoid дополнительная плата.</span><span class="sxs-lookup"><span data-stu-id="157c7-178">We recommend managing your snapshots carefully tooavoid extra charges.</span></span> <span data-ttu-id="157c7-179">Можно выполнить следующие рекомендации toohelp свести к минимуму затраты hello путем хранения hello вашей моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="157c7-179">You can follow these best practices toohelp minimize hello costs incurred by hello storage of your snapshots:</span></span>

* <span data-ttu-id="157c7-180">Удаление и повторное создание моментальных снимков, связанных с большой двоичный объект всякий раз при обновлении большого двоичного объекта hello, даже если вы обновляете с идентичными данными, если при разработке приложения требует сохранения моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="157c7-180">Delete and re-create snapshots associated with a blob whenever you update hello blob, even if you are updating with identical data, unless your application design requires that you maintain snapshots.</span></span> <span data-ttu-id="157c7-181">Удаление и повторное создание моментальных снимков hello blob, позволяет обеспечить не расходятся hello больших двоичных объектов и моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="157c7-181">By deleting and re-creating hello blob's snapshots, you can ensure that hello blob and snapshots do not diverge.</span></span>
* <span data-ttu-id="157c7-182">Если необходимо хранить моментальные снимки для BLOB-объекта, старайтесь не вызывать [UploadFromFile][dotnet_UploadFromFile], [UploadText][dotnet_UploadText], [ UploadFromStream][dotnet_UploadFromStream], или [UploadFromByteArray] [ dotnet_UploadFromByteArray] tooupdate hello большого двоичного объекта.</span><span class="sxs-lookup"><span data-stu-id="157c7-182">If you are maintaining snapshots for a blob, avoid calling [UploadFromFile][dotnet_UploadFromFile], [UploadText][dotnet_UploadText], [UploadFromStream][dotnet_UploadFromStream], or [UploadFromByteArray][dotnet_UploadFromByteArray] tooupdate hello blob.</span></span> <span data-ttu-id="157c7-183">Эти методы заменяют все блоки hello в большом двоичном объекте hello, значительно приводит к вашей базового большого двоичного объекта и его toodiverge моментальные снимки.</span><span class="sxs-lookup"><span data-stu-id="157c7-183">These methods replace all of hello blocks in hello blob, causing your base blob and its snapshots toodiverge significantly.</span></span> <span data-ttu-id="157c7-184">Вместо этого обновления hello наименьшее возможное количество блоков, с помощью hello [PutBlock] [ dotnet_PutBlock] и [PutBlockList] [ dotnet_PutBlockList] методы.</span><span class="sxs-lookup"><span data-stu-id="157c7-184">Instead, update hello fewest possible number of blocks by using hello [PutBlock][dotnet_PutBlock] and [PutBlockList][dotnet_PutBlockList] methods.</span></span>

### <a name="snapshot-billing-scenarios"></a><span data-ttu-id="157c7-185">Сценарии выставления счетов за моментальные снимки</span><span class="sxs-lookup"><span data-stu-id="157c7-185">Snapshot billing scenarios</span></span>
<span data-ttu-id="157c7-186">Привет, следующие сценарии демонстрируют, как добавляется плата за большой двоичный объект блока и ее моментальные снимки.</span><span class="sxs-lookup"><span data-stu-id="157c7-186">hello following scenarios demonstrate how charges accrue for a block blob and its snapshots.</span></span>

<span data-ttu-id="157c7-187">**Сценарий 1**</span><span class="sxs-lookup"><span data-stu-id="157c7-187">**Scenario 1**</span></span>

<span data-ttu-id="157c7-188">В сценарии 1 базовый большой двоичный объект hello не обновлена после hello моментального снимка, поэтому плата начисляется только за уникальные блокировки 1, 2 и 3.</span><span class="sxs-lookup"><span data-stu-id="157c7-188">In scenario 1, hello base blob has not been updated after hello snapshot was taken, so charges are incurred only for unique blocks 1, 2, and 3.</span></span>

![Ресурсы хранилища Azure](./media/storage-blob-snapshots/storage-blob-snapshots-billing-scenario-1.png)

<span data-ttu-id="157c7-190">**Сценарий 2**</span><span class="sxs-lookup"><span data-stu-id="157c7-190">**Scenario 2**</span></span>

<span data-ttu-id="157c7-191">В сценарии 2 hello базовый BLOB-объект был обновлен, но hello моментальный снимок нет.</span><span class="sxs-lookup"><span data-stu-id="157c7-191">In scenario 2, hello base blob has been updated, but hello snapshot has not.</span></span> <span data-ttu-id="157c7-192">Блокировка 3 была обновлена и несмотря на то, что он содержит hello и тех же данных, и таким же Идентификатором hello, это не так же, как блокировки 3 в моментальном снимке hello hello.</span><span class="sxs-lookup"><span data-stu-id="157c7-192">Block 3 was updated, and even though it contains hello same data and hello same ID, it is not hello same as block 3 in hello snapshot.</span></span> <span data-ttu-id="157c7-193">В результате учетной записи hello взимается плата за четыре блокировки.</span><span class="sxs-lookup"><span data-stu-id="157c7-193">As a result, hello account is charged for four blocks.</span></span>

![Ресурсы хранилища Azure](./media/storage-blob-snapshots/storage-blob-snapshots-billing-scenario-2.png)

<span data-ttu-id="157c7-195">**Сценарий 3**</span><span class="sxs-lookup"><span data-stu-id="157c7-195">**Scenario 3**</span></span>

<span data-ttu-id="157c7-196">В сценарии 3 базовый hello BLOB-объект был обновлен, но hello моментальный снимок нет.</span><span class="sxs-lookup"><span data-stu-id="157c7-196">In scenario 3, hello base blob has been updated, but hello snapshot has not.</span></span> <span data-ttu-id="157c7-197">Блокировка 3 была заменена блокировкой 4 в hello базового большого двоичного объекта, но hello моментальных снимков по-прежнему отражает блокировку 3.</span><span class="sxs-lookup"><span data-stu-id="157c7-197">Block 3 was replaced with block 4 in hello base blob, but hello snapshot still reflects block 3.</span></span> <span data-ttu-id="157c7-198">В результате учетной записи hello взимается плата за четыре блокировки.</span><span class="sxs-lookup"><span data-stu-id="157c7-198">As a result, hello account is charged for four blocks.</span></span>

![Ресурсы хранилища Azure](./media/storage-blob-snapshots/storage-blob-snapshots-billing-scenario-3.png)

<span data-ttu-id="157c7-200">**Сценарий 4**</span><span class="sxs-lookup"><span data-stu-id="157c7-200">**Scenario 4**</span></span>

<span data-ttu-id="157c7-201">В сценарии 4 hello базовый BLOB-объект был обновлен полностью и не содержит ни одного первоначальных блокировок.</span><span class="sxs-lookup"><span data-stu-id="157c7-201">In scenario 4, hello base blob has been completely updated and contains none of its original blocks.</span></span> <span data-ttu-id="157c7-202">В результате учетной записи hello взимается за все 8 уникальных блокировок.</span><span class="sxs-lookup"><span data-stu-id="157c7-202">As a result, hello account is charged for all eight unique blocks.</span></span> <span data-ttu-id="157c7-203">Такая ситуация возникает, если используется метод обновления, такие как [UploadFromFile][dotnet_UploadFromFile], [UploadText][dotnet_UploadText], [ UploadFromStream][dotnet_UploadFromStream], или [UploadFromByteArray][dotnet_UploadFromByteArray], так как эти методы заменяют все содержимое hello большого двоичного объекта.</span><span class="sxs-lookup"><span data-stu-id="157c7-203">This scenario can occur if you are using an update method such as [UploadFromFile][dotnet_UploadFromFile], [UploadText][dotnet_UploadText], [UploadFromStream][dotnet_UploadFromStream], or [UploadFromByteArray][dotnet_UploadFromByteArray], because these methods replace all of hello contents of a blob.</span></span>

![Ресурсы хранилища Azure](./media/storage-blob-snapshots/storage-blob-snapshots-billing-scenario-4.png)

## <a name="next-steps"></a><span data-ttu-id="157c7-205">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="157c7-205">Next steps</span></span>

* <span data-ttu-id="157c7-206">Дополнительные сведения о работе с моментальными снимками диска виртуальной машины см. в статье [Архивация неуправляемых дисков виртуальной машины Azure с помощью добавочных моментальных снимков](../../virtual-machines/windows/incremental-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="157c7-206">You can find more information about working with virtual machine (VM) disk snapshots in [Back up Azure unmanaged VM disks with incremental snapshots](../../virtual-machines/windows/incremental-snapshots.md)</span></span>

* <span data-ttu-id="157c7-207">Дополнительные примеры кода, в которых используется хранилище BLOB-объектов, см. на странице с [примерами кода Azure](https://azure.microsoft.com/documentation/samples/?service=storage&term=blob).</span><span class="sxs-lookup"><span data-stu-id="157c7-207">For additional code examples using Blob storage, see [Azure Code Samples](https://azure.microsoft.com/documentation/samples/?service=storage&term=blob).</span></span> <span data-ttu-id="157c7-208">Можно загрузить пример приложения и запустите его или просмотр кода hello в GitHub.</span><span class="sxs-lookup"><span data-stu-id="157c7-208">You can download a sample application and run it, or browse hello code on GitHub.</span></span>

[dotnet_AccessCondition]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.accesscondition.aspx
[dotnet_CloudBlockBlob]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.blob.cloudblockblob.aspx
[dotnet_CreateSnapshotAsync]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.blob.cloudblockblob.createsnapshotasync.aspx
[dotnet_HTTPStatusCode]: https://msdn.microsoft.com/library/system.net.httpstatuscode(v=vs.110).aspx
[dotnet_PutBlockList]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.blob.cloudblockblob.putblocklist.aspx
[dotnet_PutBlock]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.blob.cloudblockblob.putblock.aspx
[dotnet_UploadFromByteArray]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.blob.cloudblockblob.uploadfrombytearray.aspx
[dotnet_UploadFromFile]: https://msdn.microsoft.com/library/azure/mt705654.aspx
[dotnet_UploadFromStream]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.blob.cloudblockblob.uploadfromstream.aspx
[dotnet_UploadText]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.blob.cloudblockblob.uploadtext.aspx