---
title: "журналы и показатели данных аналитики хранилища Azure toocollect aaaUse | Документы Microsoft"
description: "Аналитика хранилища позволяет tootrack данные метрик для всех служб хранилища, а toocollect журналы для хранения больших двоичных объектов, очередей и таблиц."
services: storage
documentationcenter: 
author: robinsh
manager: timlt
editor: tysonn
ms.assetid: 7894993b-ca42-4125-8f17-8f6dfe3dca76
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 03/03/2017
ms.author: robinsh
ms.openlocfilehash: aba1a236cb69fa2e60bcb8fda5d34841e36e379a
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="storage-analytics"></a>аналитики хранилища

Аналитика хранилища Azure ведет журналы и предоставляет данные метрик для учетной записи хранения. Можно использовать этот tootrace запросы данных, анализа тенденций использования и диагностики проблем с вашей учетной записи хранилища.

toouse аналитики хранилища ее необходимо включить отдельно для каждой службы требуется toomonitor. Его можно включить из hello [портала Azure](https://portal.azure.com). Дополнительные сведения см. в разделе [отслеживание учетной записи хранения в портале Azure hello](storage-monitor-storage-account.md). Можно также включить аналитики хранилища программно через hello API-интерфейса REST или клиентской библиотеки hello. Используйте hello [получение свойств службы BLOB-объектов](https://msdn.microsoft.com/library/hh452239.aspx), [получение свойств службы очередей](https://msdn.microsoft.com/library/hh452243.aspx), [получение свойств службы таблиц](https://msdn.microsoft.com/library/hh452238.aspx), и [свойств службы получения файлов](https://msdn.microsoft.com/library/mt427369.aspx) tooenable операций аналитики хранилища для каждой службы.

Hello статистические данные хранятся в известном большом двоичном объекте (для ведения журнала) и в известных таблицах (для метрик), к которым можно получить с помощью службы BLOB-объектов hello и API службы таблиц.

Аналитике хранилища установлено ограничение в 20 ТБ для hello объема хранимых данных, которая независима от hello общее ограничение для вашей учетной записи хранилища. Дополнительную информацию о выставлении счетов и политиках хранения данных см. в разделе [Аналитика хранилища и выставление счетов](https://msdn.microsoft.com/library/hh360997.aspx). Дополнительные сведения об ограничениях учетных записей хранения см. в разделе [Целевые показатели масштабируемости и производительности хранилища Azure](storage-scalability-targets.md).

Подробное руководство по использованию аналитики хранилища и других tooidentify средства диагностики и устранение неполадок, связанных с хранилищем Azure см. в разделе [монитора, диагностики и устранения неполадок хранилища Microsoft Azure](storage-monitoring-diagnosing-troubleshooting.md).

## <a name="about-storage-analytics-logging"></a>Информация о ведении журнала аналитики хранилища
Аналитика хранилища заносит в журнал подробные сведения о службе хранилища tooa успешных и неудачных запросах. Эти сведения можно использовать toomonitor отдельных запросов и toodiagnose проблем со службой хранилища. Запросы вносятся в журнал наилучшим возможным образом.

Записи журнала создаются только при условии активности службы хранилища. Например если учетной записи хранения имеет действия, в свою службу больших двоичных объектов, но не его таблиц или очередей служб, будут создаваться только журналы, имеющие отношение toohello службы BLOB-объектов.

Ведение журнала аналитики хранилища недоступно для хранилища файлов Azure.

### <a name="logging-authenticated-requests"></a>Ведение журналов запросов, прошедших аутентификацию
регистрируются следующие типы запросов на проверку подлинности Hello:

* успешные запросы;
* неудачные запросы, в том числе из-за ошибок, связанных с временем ожидания, регулированием, сетью, авторизацией и др.;
* запросы, в которых используется подписанный URL-адрес (SAS), в том числе неудачные и успешные запросы;
* Данные tooanalytics запросов.

Запросы, выполненные в самой аналитике хранилища, такие как запросы на создание или удаление журнала, не регистрируются. Полный список hello в журнал данных описаны в hello [операций ведения журнала аналитики хранилища и сообщения о состоянии](https://msdn.microsoft.com/library/hh343260.aspx) и [формат журнала аналитики хранилища](https://msdn.microsoft.com/library/hh343259.aspx) разделы.

### <a name="logging-anonymous-requests"></a>Ведение журналов анонимных запросов
регистрируются следующие типы анонимные запросы Hello:

* успешные запросы;
* ошибки сервера;
* ошибки времени ожидания для клиента и сервера;
* неудачные запросы GET с кодом ошибки 304 (не изменено).

Остальные неудачные анонимные запросы не регистрируются. Полный список hello в журнал данных описаны в hello [операций ведения журнала аналитики хранилища и сообщения о состоянии](https://msdn.microsoft.com/library/hh343260.aspx) и [формат журнала аналитики хранилища](https://msdn.microsoft.com/library/hh343259.aspx) разделы.

### <a name="how-logs-are-stored"></a>Хранение журналов
Все журналы хранятся в блочных больших двоичных объектах в контейнере $logs, который автоматически создается при включении аналитики хранилища для учетной записи хранения. контейнер Hello $logs находится в пространстве имен BLOB-объектов hello hello учетной записи хранилища, например: `http://<accountname>.blob.core.windows.net/$logs`. После включения аналитики хранилища этот контейнер нельзя удалить, но вы можете удалить его содержимое.

> [!NOTE]
> контейнер Hello $logs не отображается при выполнении операции листинга контейнеров, таких как hello [ListContainers](https://msdn.microsoft.com/library/azure/dd179352.aspx) метод. Доступ к нему можно получить только непосредственно. Например, можно использовать hello [ListBlobs](https://msdn.microsoft.com/library/azure/dd135734.aspx) метод tooaccess hello BLOB-объектов в hello `$logs` контейнера.
> По мере регистрации запросов в аналитике хранилища промежуточные результаты передаются в качестве блоков. Периодически эти блоки фиксируются в аналитике хранилища и к ним предоставляется доступ как к большим двоичным объектам.
> 
> 

Могут присутствовать повторяющиеся записи в журналах, созданных в hello того же часа. Можно определить, является ли запись дубликат проверив hello **RequestId** и **операции** номер.

### <a name="log-naming-conventions"></a>Соглашения об именовании журналов
Каждый журнал будут записаны в кодировке hello.

    <service-name>/YYYY/MM/DD/hhmm/<counter>.log

Hello следующей таблице описан каждый атрибут в имени журнала hello.

| Атрибут | Описание |
| --- | --- |
| <service-name> |Имя службы хранилища hello Hello. Например: blob, table или queue. |
| YYYY |четырехзначное число года Hello hello журнала. Например, 2011. |
| ММ |Hello двузначным месяцем для журнала hello. Например, 07. |
| DD |Hello двузначным месяцем для журнала hello. Например, 07. |
| hh |Регистрирует Hello двузначными часами, указывающее hello начиная час для hello в 24-часовом формате времени UTC. Например, 18. |
| ММ |Hello двузначное число, указывающее hello начиная минуты для журналов hello. Это значение не поддерживается в текущей версии hello аналитики хранилища и его значение всегда будет равно 00. |
| <counter> |Отсчитываемый от нуля шестизначный счетчик с, указывающее номер hello больших двоичных объектов журнала, созданный для службы хранилища hello в течение часа. Отсчет этого счетчика начинается с 000000. Например, 000001. |

Hello ниже приведен полный пример имя журнала, объединяющее hello предыдущих примерах.

    blob/2011/07/31/1800/000001.log

Hello ниже приведен пример URI, который может быть используется tooaccess hello предыдущем журнале.

    https://<accountname>.blob.core.windows.net/$logs/blob/2011/07/31/1800/000001.log

При регистрации запроса к хранилищу имя результирующего журнала hello сопоставляет час toohello при hello запросе операция завершена. Например, если запрос GetBlob был завершен в 18:30 7/31/2011 г. hello журнал должен быть записан с префикса hello:`blob/2011/07/31/1800/`

### <a name="log-metadata"></a>Метаданные журнала
Все большие двоичные объекты журнала хранятся с метаданными, которое может быть используется tooidentify содержит какие hello большой двоичный объект ведения журнала. Привет, в следующей таблице описан каждый атрибут метаданных.

| Атрибут | Описание |
| --- | --- |
| LogType |Описывает ли hello журнал содержит сведения о компонентах tooread, записи или операции удаления. Это значение может содержать данные одного типа или сочетание всех трех типов данных, разделенных запятыми. Пример 1: write. Пример 2: read,write. Пример 3: read,write,delete. |
| StartTime |Здравствуйте, самое раннее время записи в журнале hello в форме hello гггг-мм-: Ssz. Например, 2011-07-31T18:21:46Z. |
| EndTime |Здравствуйте, времени последней записи в журнале hello в форме hello гггг-мм-: Ssz. Например, 2011-07-31T18:22:09Z. |
| LogVersion |версия формата журнала hello Hello. В настоящее время поддерживается только hello значение равно 1.0. |

Hello в списке отображаются полный образец метаданных с помощью hello предыдущих примерах.

* LogType=write
* StartTime=2011-07-31T18:21:46Z
* EndTime=2011-07-31T18:22:09Z
* LogVersion=1.0

### <a name="accessing-logging-data"></a>Доступ к данным журнала
Все данные в hello `$logs` контейнер может осуществляться с использованием API службы BLOB-объектов hello, включая API .NET, предоставленные hello hello Azure управляемой библиотеке. Здравствуйте, администратор учетной записи хранилища можно читать и удалять журналы, но невозможно создать или обновить их. Метаданные журнала hello и имя журнала можно использовать при запросе к журналу. Возможно, для заданного часа журналы tooappear по порядку, но hello метаданные всегда указывают timespan hello записей журнала в журнале. Таким образом, при поиске конкретного журнала можно использовать сочетание имен журналов и метаданных.

## <a name="about-storage-analytics-metrics"></a>Информация о метриках аналитики хранилища
Аналитики хранилища могут хранить метрики, которые включают статистические операции статистику и данные о емкости службы хранилища tooa запросов. Транзакции фиксируются на уровне операции обоих hello API, а также на уровне службы хранилища hello и емкости предоставляются на уровне службы хранилища hello. Данные метрик можно использовать tooanalyze использования службы хранилища, диагностики проблем с запросами к службе хранилища hello и tooimprove hello производительность приложений, использующих службу.

toouse аналитики хранилища ее необходимо включить отдельно для каждой службы требуется toomonitor. Его можно включить из hello [портала Azure](https://portal.azure.com). Дополнительные сведения см. в разделе [отслеживание учетной записи хранения в портале Azure hello](storage-monitor-storage-account.md). Можно также включить аналитики хранилища программно через hello API-интерфейса REST или клиентской библиотеки hello. Используйте hello **получение свойств службы** tooenable операций аналитики хранилища для каждой службы.

### <a name="transaction-metrics"></a>Метрики транзакций
Широкий набор данных записывается раз в час или раз в минуту для каждой службы хранилища и запрошенных операций API, включая входящие и выходящие данные, информацию о доступности, ошибки и процент категоризованных запросов. Можно просмотреть полный список деталей транзакции hello в hello [схема таблицы метрик аналитики хранилища](https://msdn.microsoft.com/library/hh343264.aspx) раздела.

Данные транзакций записываются на двух уровнях — уровне службы hello и hello операции API. На уровне службы hello запросил статистика, суммирующая все операции API-интерфейса записываются tooa сущность таблицы каждый час даже если запросы не были внесены toohello службы. На уровне операции hello API статистику, только запись tooan сущности, если была запрошена операция hello в течение этого часа.

Например, если вы выполняете **GetBlob** операции в службе BLOB-объектов метрики аналитики хранилища будут регистрировать запрос hello и включите его в hello статистическую обработку данных, для обоих hello службы BLOB-объектов, а также hello **GetBlob** операции. Тем не менее если не **GetBlob** запросе операции в течение часа hello сущности не будут записаны toohello `$MetricsTransactionsBlob` для этой операции.

Метрики транзакций записываются как для запросов пользователей, так и для запросов, сделанных самой аналитикой хранилища. Например записываются запросы сущностей журналов toowrite аналитики хранилища и таблиц. Дополнительную информацию о выставлении счетов для этих запросов см. в разделе [Аналитика хранилища и выставление счетов](https://msdn.microsoft.com/library/hh360997.aspx).

### <a name="capacity-metrics"></a>Метрики емкости
> [!NOTE]
> В настоящее время метрики емкости доступны только для hello службы BLOB-объектов. Метрики емкости для службы таблиц hello и службы очередей будут доступны в будущих версиях аналитики хранилища.
> 
> 

Данные о емкости записываются ежедневно для службы BLOB-объектов учетной записи хранения, и при этом записываются две сущности таблицы. Одна сущность содержит статистику для данных пользователей и других hello предоставляет статистику hello `$logs` контейнер больших двоичных объектов, используемого аналитикой хранилища. Hello `$MetricsCapacityBlob` таблица включает в себя hello следующая статистика:

* **Емкость**: hello объем хранилища, используемый службой BLOB-объектов учетной записи хранилища hello, в байтах.
* **ContainerCount**: hello число контейнеров больших двоичных объектов в службе BLOB-объектов учетной записи хранения hello.
* **ObjectCount**: hello количество зафиксированных и незафиксированных блочных или страничных больших двоичных объектов в службе BLOB-объектов учетной записи хранения hello.

Дополнительные сведения о метриках емкости hello см. в разделе [схема таблицы метрик аналитики хранилища](https://msdn.microsoft.com/library/hh343264.aspx).

### <a name="how-metrics-are-stored"></a>Как хранятся метрики
Все данные метрик для каждой из служб хранения hello хранятся в трех таблицах, зарезервированных для этой службы: одной таблице содержатся сведения о транзакциях, одна таблица для минутных транзакциях и другую таблицу для данных о производительности. Информация о транзакциях и минутных транзакциях включает в себя данные запросов и ответов, а информация о емкости содержит данные об использовании хранилища. Час метрики, ежеминутных метрик и емкости для учетной записи хранилища BLOB-объектов может осуществляться в таблицах, которые имеют имена, как описано в следующей таблице hello.

| Уровень метрик | Имена таблиц | Поддерживаемые версии |
| --- | --- | --- |
| Часовые метрики, основное расположение |$MetricsTransactionsBlob  <br/>$MetricsTransactionsTable <br/> $MetricsTransactionsQueue |Версии предыдущих too2013-08-15 только. Хотя эти имена по-прежнему поддерживаются, рекомендуется переключиться toousing hello таблиц, перечисленных ниже. |
| Часовые метрики, основное расположение |$MetricsHourPrimaryTransactionsBlob <br/>$MetricsHourPrimaryTransactionsTable <br/>$MetricsHourPrimaryTransactionsQueue |Все версии, включая 15.08.2013 г. |
| Минутные метрики, основное расположение |$MetricsMinutePrimaryTransactionsBlob <br/>$MetricsMinutePrimaryTransactionsTable <br/>$MetricsMinutePrimaryTransactionsQueue |Все версии, включая 15.08.2013 г. |
| Часовые метрики, вторичное расположение |$MetricsHourSecondaryTransactionsBlob  <br/>$MetricsHourSecondaryTransactionsTable <br/>$MetricsHourSecondaryTransactionsQueue |Все версии, включая 15.08.2013 г. Должна быть включена геоизбыточная репликация с доступом для чтения. |
| Минутные метрики, вторичное расположение |$MetricsMinuteSecondaryTransactionsBlob  <br/>$MetricsMinuteSecondaryTransactionsTable <br/>$MetricsMinuteSecondaryTransactionsQueue |Все версии, включая 15.08.2013 г. Должна быть включена геоизбыточная репликация с доступом для чтения. |
| Емкость (только для службы BLOB-объектов) |$MetricsCapacityBlob |Все версии, включая 15.08.2013 г. |

Эти таблицы автоматически создаются при включении аналитики хранилища для учетной записи хранения. К ним осуществляется доступ через пространство имен hello hello учетной записи хранилища, например:`https://<accountname>.table.core.windows.net/Tables("$MetricsTransactionsBlob")`

### <a name="accessing-metrics-data"></a>Доступ к данным метрик
Все данные в таблицах метрик hello может осуществляться с помощью API службы таблиц hello, включая API .NET, предоставленные hello hello Azure управляемой библиотеке. Здравствуйте, администратор учетной записи хранилища можно читать и удалять сущности таблиц, но невозможно создать или обновить их.

## <a name="billing-for-storage-analytics"></a>Оплата аналитики хранилища
Все данные метрик записываются службами hello учетной записи хранения. В результате каждая из операций записи, выполняемая аналитикой хранилища, тарифицируется. Кроме того hello объем хранилища, используемый данными показателей, также тарифицируется.

Привет, выполнив действия, выполняемые аналитикой хранилища являются оплачиваемыми:

* Запросы toocreate большие двоичные объекты для ведения журнала. 
* Запросы toocreate сущностей таблиц для показателей.

Если вы настроили политику хранения данных, за транзакции удаления, выполняемые, когда аналитика хранилища удаляет старые данные журналов и метрики, плата не взимается. В то же время транзакции удаления, инициируемые клиентом, тарифицируются. Дополнительную информацию о политиках хранения см. в разделе [Задание политики хранения данных для аналитик хранилища](https://msdn.microsoft.com/library/azure/hh343263.aspx).

### <a name="understanding-billable-requests"></a>Общая информация о тарифицируемых запросах
Каждый запрос tooan учетной записи службы хранилища является оплаты или нет. Аналитика хранилища регистрирует каждый отдельный запрос tooa службы, включая сообщение о состоянии, указывающее обработку запроса hello. Аналогичным образом аналитика хранилища сохраняет показатели для операций службы, так и hello API службы, включая hello процентные доли и количества определенных сообщений о состоянии. Вместе эти функции помогают проанализировать тарифицируемые запросы, улучшить приложение и диагностики проблем со службами tooyour запросов. Дополнительную информацию о выставлении счетов см. в разделе [Общая информация о выставлении счетов за использование хранилища Azure — пропускная способность, транзакции и емкость](http://blogs.msdn.com/b/windowsazurestorage/archive/2010/07/09/understanding-windows-azure-storage-billing-bandwidth-transactions-and-capacity.aspx).

При просмотре данных аналитики хранилища, можно использовать таблицы hello в hello [операций ведения журнала аналитики хранилища и сообщения о состоянии](https://msdn.microsoft.com/library/azure/hh343260.aspx) toodetermine разделе запросов являются оплачиваемыми. Затем можно сравнить журналы и показатели данных toohello состояние сообщения toosee Если оплаченные для определенного запроса. Также можно использовать таблицы hello hello предыдущего раздела tooinvestigate доступности для службы хранилища или отдельной операции API.

## <a name="next-steps"></a>Дальнейшие действия
### <a name="setting-up-storage-analytics"></a>Настройка аналитики службы хранилища
* [Монитор учетной записи хранения в портале Azure hello](storage-monitor-storage-account.md)
* [Включение и настройка аналитик хранилища](https://msdn.microsoft.com/library/hh360996.aspx)

### <a name="storage-analytics-logging"></a>Ведение журнала аналитики хранилища
* [Информация о ведении журнала аналитики хранилища](https://msdn.microsoft.com/library/hh343262.aspx)
* [Формат журналов аналитик хранилища](https://msdn.microsoft.com/library/hh343259.aspx)
* [Операции с протоколированием и сообщения о состоянии аналитик хранилища](https://msdn.microsoft.com/library/hh343260.aspx)

### <a name="storage-analytics-metrics"></a>Метрики аналитики хранилища
* [Информация о метриках аналитики хранилища](https://msdn.microsoft.com/library/hh343258.aspx)
* [Схема таблицы метрик аналитики хранилища](https://msdn.microsoft.com/library/hh343264.aspx)
* [Операции с протоколированием и сообщения о состоянии аналитик хранилища](https://msdn.microsoft.com/library/hh343260.aspx)  

