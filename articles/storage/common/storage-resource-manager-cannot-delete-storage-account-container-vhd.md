---
title: "Устранение ошибок при удалении учетных записей хранения Azure, контейнеров или виртуальных жестких дисков | Документация Майкрософт"
description: "Устранение ошибок при удалении учетных записей хранения Azure, контейнеров или виртуальных жестких дисков"
services: storage
documentationcenter: 
author: passaree
manager: cshepard
editor: na
tags: storage
ms.assetid: 17403aa1-fe8d-45ec-bc33-2c0b61126286
ms.service: storage
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: troubleshooting
ms.date: 11/03/2017
ms.author: genli
ms.openlocfilehash: 7a3c9422887592c29c2eae8bd75cf960865808fd
ms.sourcegitcommit: 3df3fcec9ac9e56a3f5282f6c65e5a9bc1b5ba22
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2017
---
# <a name="troubleshoot-storage-delete-errors-in-resource-manager-deployment"></a>Устранение ошибок удаления хранилища в развертывании диспетчера ресурсов
В этой статье содержатся рекомендации по устранению неполадок при возникновении одной из следующих ошибок во время удаления учетной записи хранения, контейнера или большого двоичного объекта Azure в развертывании Azure Resource Manager.

>**Не удалось удалить учетную запись хранения "имя_учетной_записи_хранения". Ошибка: "Не удается удалить учетную запись хранения, так как ее артефакты используются".**

>**Не удалось удалить # из # контейнеров.<br> Виртуальные жесткие диски: сейчас контейнер находится в аренде, и в запросе не указан идентификатор аренды.**

>**Не удалось удалить # из # больших двоичных объектов.<br> BlobName.vhd: сейчас большой двоичный объект находится в аренде, и в запросе не указан идентификатор аренды.**

Виртуальные жесткие диски, используемые в виртуальных машинах Azure, представляют собой VHD-файлы, хранящиеся как страничные BLOB-объекты в учетной записи хранения Azure (Standard или Premium).  Дополнительные сведения о дисках Azure см. [здесь](../../virtual-machines/windows/about-disks-and-vhds.md). Среда Azure предотвращает удаление диска, подключенного к виртуальной машине, чтобы избежать повреждения. Она также препятствует удалению контейнеров и учетных записей хранения, имеющих страничный BLOB-объект, который подключен к виртуальной машине. 

## <a name="solution"></a>Решение
Процесс удаления учетной записи хранения, контейнера или большого двоичного объекта при возникновении одной из ошибок, упомянутых выше: 
1. [Определите большие двоичные объекты, присоединенные к виртуальной машине.](#step-1-identify-blobs-attached-to-a-vm)
2. [Удалите виртуальные машины с подключенным **диском ОС.**](#step-2-delete-vm-to-detach-os-disk)
3. [Отключите все **диски с данными** на оставшихся виртуальных машинах.](#step-3-detach-data-disk-from-the-vm)

Повторите удаление учетной записи хранения контейнера или большого двоичного объекта после выполнения указанных выше действий.

### <a name="step-1-identify-blob-attached-to-a-vm"></a>Шаг 1. Определение больших двоичных объектов, присоединенных к виртуальной машине

#### <a name="scenario-1-deleting-a-blob--identify-attached-vm"></a>Сценарий 1. Удаление большого двоичного объекта и определение подключенной виртуальной машины
1. Выполните вход на [портал Azure](https://portal.azure.com).
2. В главном меню выберите **Все ресурсы**. Перейдите к учетной записи хранения в разделе **Blob Service** (Служба больших двоичных объектов), выберите **Контейнеры** и перейдите к большому двоичному объекту, который необходимо удалить.
3. Если **состояние аренды** большого двоичного объекта — **В аренде**, щелкните правой кнопкой мыши и выберите **Изменить метаданные**, чтобы открыть панель метаданных большого двоичного объекта. 

    ![Снимок экрана портала с учетной записью хранения больших двоичных объектов с выделенным действием "Изменить метаданные"](./media/storage-resource-manager-cannot-delete-storage-account-container-vhd/utd-edit-metadata-sm.png)

4. На панели метаданных большого двоичного объекта проверьте и запишите значение для **MicrosoftAzureCompute_VMName**. Это значение является именем виртуальной машины, к которой подключен виртуальный жесткий диск. (Если этого поля нет, см. раздел **Важно**.)
5. На панели метаданных большого двоичного объекта проверьте и запишите значение **MicrosoftAzureCompute_DiskType**. Таким образом определяется подключенный диск (диск операционной системы или диск с данными). (Если этого поля нет, см. раздел **Важно**.) 

     ![Снимок экрана портала с открытой панелью хранилища Blob Metadata (Метаданные больших двоичных объектов)](./media/storage-resource-manager-cannot-delete-storage-account-container-vhd/utd-blob-metadata-sm.png)

6. Если тип диска большого двоичного объекта — **OSDisk**, выполните указания из раздела [Шаг 2. Удаление виртуальной машины для отключения диска ОС](#step-2-delete-vm-to-detach-os-disk). Если тип диска большого двоичного объекта — **DataDisk**, следуйте инструкциям в разделе [Шаг 3. Отключение диска с данными от виртуальной машины](#step-3-detach-data-disk-from-the-vm). 

> [!IMPORTANT]
> Если **MicrosoftAzureCompute_VMName** и **MicrosoftAzureCompute_DiskType** не отображаются в метаданных большого двоичного объекта, большой двоичный объект арендован и не подключен к виртуальной машине. Невозможно удалить арендованный большой двоичных объект, не прервав аренду. Чтобы прервать аренду, щелкните большой двоичный объект правой кнопкой мыши и выберите **Break lease** (Разрыв аренды). Арендованные большие двоичные объекты, не присоединенные к виртуальной машине, предотвращают удаление большого двоичного объекта, но не удаление контейнера или учетной записи хранения.

#### <a name="scenario-2-deleting-a-container---identify-all-blobs-within-container-that-are-attached-to-vms"></a>Сценарий 2. Удаление контейнера и определение всех больших двоичных объектов, подключенных к виртуальным машинам, внутри контейнера
1. Выполните вход на [портал Azure](https://portal.azure.com).
2. В главном меню выберите **Все ресурсы**. Перейдите к учетной записи хранения в разделе **Blob Service** (Служба больших двоичных объектов), выберите **Контейнеры** и найдите контейнер, который нужно удалить.
3. Щелкните, чтобы открыть контейнер, и появится список больших двоичных объектов, находящихся внутри него. Определите из этого списка все большие двоичные объекты с типом больших двоичных объектов **Страничный BLOB-объект** и состоянием аренды **В аренде**. Выполните [сценарий 1](#step-1-identify-blobs-attached-to-a-vm), чтобы идентифицировать виртуальную машину, связанную с каждым из этих больших двоичных объектов.

    ![Снимок экрана портала с большими двоичными объектами учетной записи хранения и выделенным состоянием аренды "В аренде"](./media/storage-resource-manager-cannot-delete-storage-account-container-vhd/utd-disks-sm.png)

4. Выполните [Шаг 2](#step-2-delete-vm-to-detach-os-disk) и [Шаг 3](#step-3-detach-data-disk-from-the-vm), чтобы удалить виртуальные машины с **OSDisk** и отсоединить **DataDisk**. 

#### <a name="scenario-3-deleting-storage-account---identify-all-blobs-within-storage-account-that-are-attached-to-vms"></a>Сценарий 3. Удаление учетной записи хранения и определение всех подключенных к виртуальным машинам больших двоичных объектов в учетной записи хранения
1. Выполните вход на [портал Azure](https://portal.azure.com).
2. В главном меню выберите **Все ресурсы**. Перейдите к учетной записи хранения в разделе **Blob Service** (Служба больших двоичных объектов), выберите **Контейнеры**.

    ![Снимок экрана портала с контейнерами учетной записи хранения и выделенным состоянием аренды "В аренде"](./media/storage-resource-manager-cannot-delete-storage-account-container-vhd/utd-containers-sm.png)

3. В колонке **Контейнеры** идентифицируйте все контейнеры с **состоянием аренды** **В аренде** и выполните действия из [сценария 2](#scenario-2-deleting-a-container---identify-all-blobs-within-container-that-are-attached-to-vms) для каждого **арендованного** контейнера.
4. Выполните [Шаг 2](#step-2-delete-vm-to-detach-os-disk) и [Шаг 3](#step-3-detach-data-disk-from-the-vm), чтобы удалить виртуальные машины с **OSDisk** и отсоединить **DataDisk**. 

### <a name="step-2-delete-vm-to-detach-os-disk"></a>Шаг 2. Удаление виртуальной машины для отключения диска ОС
Если виртуальный жесткий диск (VHD) является диском ОС, необходимо удалить виртуальную машину перед удалением подключенного VHD. Для дисков данных, подключенных к одной виртуальной машине, после выполнения следующих действий не потребуется дополнительных действий:

1. Выполните вход на [портал Azure](https://portal.azure.com).
2. В главном меню выберите **Виртуальные машины**.
3. Выберите виртуальную машину, к которой подключен виртуальный жесткий диск.
4. Убедитесь, что виртуальная машина больше не используется и в ней нет необходимости.
5. В верхней части колонки **сведений о виртуальной машине** выберите **Удалить**, а затем нажмите кнопку **Да**, чтобы подтвердить.
6. После этого виртуальная машина будет удалена, но виртуальный жесткий диск останется. Однако он выйдет из состояния аренды и отключится от виртуальной машины. Освобождение от аренды может занять несколько минут. Чтобы убедиться, что освобождение от аренды выполнено, перейдите в расположение большого двоичного объекта и на панели **свойств больших двоичных объектов** **состояние аренды** должно быть **Доступно**.

### <a name="step-3-detach-data-disk-from-the-vm"></a>Шаг 3. Отключение диска данных от виртуальной машины
Если виртуальный жесткий диск является диском данных, чтобы удалить аренду, отсоедините его от виртуальной машины.

1. Выполните вход на [портал Azure](https://portal.azure.com).
2. В главном меню выберите **Виртуальные машины**.
3. Выберите виртуальную машину, к которой подключен виртуальный жесткий диск.
4. В колонке **сведений о виртуальной машине** выберите **Диски**.
5. Выберите диск данных, к которому подключен виртуальный жесткий диск и который необходимо удалить. Большой двоичный объект, присоединенный к диску данных, можно определить, просмотрев URL-адрес виртуального жесткого диска.
6. Расположение большого двоичного объекта можно проверить, щелкнув диск, чтобы проверить путь в поле **URI VHD**.
7. В верхней части колонки **Диски** выберите **Изменить**.
8. Щелкните **значок отключения** диска данных, который необходимо удалить.

     ![Снимок экрана портала с открытой панелью хранилища Blob Metadata (Метаданные больших двоичных объектов)](./media/storage-resource-manager-cannot-delete-storage-account-container-vhd/utd-vm-disks-edit.png)

9. Щелкните **Сохранить**. После этого диск будет отсоединен от виртуальной машины, а виртуальный жесткий диск освобожден от аренды. Освобождение от аренды может занять несколько минут. Чтобы убедиться, что освобождение от аренды выполнено, перейдите в расположение большого двоичного объекта и на панели **свойств больших двоичных объектов** **состояние аренды** должно быть **Разблокировано** или **Доступно**.

## <a name="next-steps"></a>Дальнейшие действия
Повторите попытку удаления объекта хранилища, которая ранее не удалась.

