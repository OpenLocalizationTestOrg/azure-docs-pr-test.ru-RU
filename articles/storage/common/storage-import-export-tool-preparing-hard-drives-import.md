---
title: "Подготовка жестких дисков к заданию импорта службы импорта и экспорта Azure | Документация Майкрософт"
description: "Сведения о подготовке жестких дисков с помощью средства WAImportExport перед созданием задания импорта в службе импорта и экспорта Azure."
author: muralikk
manager: syadav
editor: tysonn
services: storage
documentationcenter: 
ms.assetid: 
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/29/2017
ms.author: muralikk
ms.openlocfilehash: 23f2640bc71bc4eba0f3fc76014cce4a298bfcfa
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="preparing-hard-drives-for-an-import-job"></a>Подготовка жестких дисков к заданию импорта

WAImportExport — это средство подготовки и исправления дисков, которое можно использовать в [службе импорта и экспорта Microsoft Azure](../storage-import-export-service.md). Оно позволяет копировать данные на жесткие диски перед отправкой их в центр обработки данных Azure. После завершения задания импорта это средство можно использовать для восстановления поврежденных, отсутствующих или конфликтных больших двоичных объектов. Это средство также позволяет восстанавливать на дисках поврежденные или отсутствующие файлы после завершения задания экспорта. В этой статье рассматривается работа с данным инструментом.

## <a name="prerequisites"></a>Предварительные требования

### <a name="requirements-for-waimportexportexe"></a>Требования к WAImportExport.exe

- **Конфигурация компьютера**
  - Windows 7, Windows Server 2008 R2 или операционная система Windows более поздней версии.
  - На компьютере должна быть установлена платформа .NET Framework 4. Дополнительные сведения о том, как проверить, установлена ли на компьютере платформа .NET Framework, см. в [часто задаваемых вопросах](#faq).
- **Ключ учетной записи хранения.** Вам потребуется по крайней мере один ключ учетной записи хранения.

### <a name="preparing-disk-for-import-job"></a>Подготовка диска к заданию импорта

- **BitLocker.** На компьютере, где запущен инструмент WAImportExport, необходимо включить BitLocker. Дополнительные сведения о включении BitLocker см. в разделе [часто задаваемых вопросов](#faq).
- **Диски** должны быть доступными на компьютере, где запущено средство WAImportExport. Спецификацию дисков см. в [часто задаваемых вопросах](#faq).
- **Исходные файлы.** Файлы, которые нужно импортировать, должны быть доступными на целевом компьютере, независимо от того, где они сохранены: в сетевой папке или на локальном жестком диске.

### <a name="repairing-a-partially-failed-import-job"></a>Восстановление задания импорта, частично завершившегося сбоем

- **Файл журнала копирования**, созданный во время копирования службой импорта и экспорта Azure данных между учетной записью хранения и диском. Он находится в целевой учетной записи хранения.

### <a name="repairing-a-partially-failed-export-job"></a>Восстановление задания экспорта, частично завершившегося сбоем

- **Файл журнала копирования**, созданный во время копирования службой импорта и экспорта Azure данных между учетной записью хранения и диском. Он находится в исходной учетной записи хранения.
- **Файл манифеста.** Он находится на экспортированном диске, возвращенном корпорацией Майкрософт (необязательно).

## <a name="download-and-install-waimportexport"></a>Скачивание и установка средства WAImportExport

Скачайте [последнюю версию WAImportExport.exe](https://www.microsoft.com/download/details.aspx?id=55280). Распакуйте содержимое в каталог на своем компьютере.

Затем создайте CSV-файлы.

## <a name="prepare-the-dataset-csv-file"></a>Подготовка CSV-файла набора данных

### <a name="what-is-dataset-csv"></a>Что такое CSV-файл набора данных

CSV-файл набора данных — это значение флага /dataset, т. е. CSV-файл, содержащий список каталогов и (или) файлов, которые нужно копировать на целевые диски. Чтобы создать задание импорта, прежде всего нужно указать, какие каталоги и файлы будут импортированы. Это может быть список каталогов, список уникальных файлов или оба списка. После добавления каталога все файлы и подкаталоги, содержащиеся в нем, также будут добавлены в задание импорта.

Для каждого импортируемого каталога или файла нужно указать целевой виртуальный каталог или большой двоичный объект в службе BLOB-объектов Azure. Эти целевые объекты будут использоваться в качестве входных данных для средства WAImportExport. Каталоги должны быть разделены знаком косой черты "/".

В следующей таблице приведены примеры целевых больших двоичных объектов.

| Исходный файл или каталог | Целевой большой двоичный объект или виртуальный каталог |
| --- | --- |
| H:\Video | https://mystorageaccount.blob.core.windows.net/video |
| H:\Photo | https://mystorageaccount.blob.core.windows.net/photo |
| K:\Temp\FavoriteVideo.ISO | https://mystorageaccount.blob.core.windows.net/favorite/FavoriteVideo.ISO |
| \\myshare\john\music | https://mystorageaccount.blob.core.windows.net/music |

### <a name="sample-datasetcsv"></a>Пример файла dataset.csv

```
BasePath,DstBlobPathOrPrefix,BlobType,Disposition,MetadataFile,PropertiesFile
"F:\50M_original\100M_1.csv.txt","containername/100M_1.csv.txt",BlockBlob,rename,"None",None
"F:\50M_original\","containername/",BlockBlob,rename,"None",None
```

### <a name="dataset-csv-file-fields"></a>Поля CSV-файла набора данных

| Поле | Описание |
| --- | --- |
| BasePath | **[Обязательный параметр]**<br/>Значение этого параметра представляет источник, в котором хранятся импортируемые данные. Инструмент рекурсивно скопирует все данные, расположенные по этому пути.<br><br/>**Допустимые значения:** допустимый путь на локальном компьютере или допустимый путь к общей папке (доступный для пользователя). Путь к каталогу должен быть абсолютным (не относительным). Если путь заканчивается на \\, то он представляет каталог, если же конец пути не содержит \\, то он указывает на файл.<br/>В этом поле запрещается использовать регулярные выражения. Если в пути содержатся пробелы, заключите их в кавычки ("").<br><br/>**Пример:** c:\Directory\c\Directory\File.txt,<br>"\\\\FBaseFilesharePath.domain.net\sharename\directory\"  |
| DstBlobPathOrPrefix | **[Обязательный параметр]**<br/> Путь к целевому виртуальному каталогу в учетной записи хранения Microsoft Azure. Виртуальный каталог может уже существовать. Если он отсутствует, служба импорта и экспорта создаст его.<br/><br/>Указывая целевые виртуальные каталоги и BLOB-объекты, используйте правильные имена контейнеров. Обратите внимание, что имена каталогов пишутся строчными буквами. Правила именования контейнеров см. в статье [Именование контейнеров, больших двоичных объектов и метаданных и ссылка на них](/rest/api/storageservices/naming-and-referencing-containers--blobs--and-metadata). Если указан только корень, то структура каталогов источника реплицируется в целевой контейнер больших двоичных объектов. Если требуется структура каталогов, отличная от источника, то в CSV-файле можно указать несколько строк для сопоставления.<br/><br/>Контейнер или префикс большого двоичного объекта можно указать следующим образом: music/70s/. Путь к целевому каталогу должен начинаться с имени контейнера, после которого ставится знак косой черты. При необходимости вы можете добавить виртуальный каталог больших двоичных объектов, который заканчивается знаком косой черты.<br/><br/>Если в качестве целевого контейнера используется корневой контейнер, его (и знак косой черты) необходимо явно указать как $root/. Имена больших двоичных объектов в корневом контейнере не могут содержать знак косой черты. По этой причине, если в качестве целевого контейнера используется корневой контейнер, подкаталоги в исходном каталоге не будут скопированы.<br/><br/>**Пример**<br/>Если путь к целевому большому двоичному объекту имеет формат https://mystorageaccount.blob.core.windows.net/video, в качестве значения этого поля можно использовать video/.  |
| BlobType | **[Необязательный параметр]** block &#124; page<br/>В настоящее время служба импорта и экспорта поддерживает 2 вида больших двоичных объектов: страничные BLOB-объекты и блочные BLOB-объекты. По умолчанию все файлы импортируются как блочные BLOB-объекты. Файлы \*.vhd и \*.vhdx импортируются как страничные BLOB-объекты. Максимальный размер этих видов больших двоичных объектов ограничен. Дополнительные сведения см. в статье [Целевые показатели масштабируемости и производительности службы хранилища Azure](storage-scalability-targets.md#scalability-targets-for-blobs-queues-tables-and-files).  |
| Disposition | **[Необязательный параметр]** rename &#124; no-overwrite &#124; overwrite <br/> Это поле определяет поведение копирования во время импорта при передаче данных с диска в учетную запись хранения. Доступные параметры: rename, overwite, no-overwrite. Если ничего не указано, то по умолчанию используется параметр overwite. <br/><br/>**rename** — при наличии двух объектов с одинаковым именем создает копию в целевом расположении.<br/>overwrite — заменяет более старый файл новым. Приоритет имеет последний измененный файл.<br/>**no-overwrite** — пропускает запись имеющегося файла.|
| MetadataFile | **[Необязательный параметр]** <br/>Значение этого поля — файл метаданных с сохраненными или пользовательскими метаданными объектов. Путь к файлу метаданных для целевых больших двоичных объектов. Дополнительные сведения см. в статье [Формат файла свойств и метаданных службы импорта и экспорта](../storage-import-export-file-format-metadata-and-properties.md). |
| PropertiesFile | **[Необязательный параметр]** <br/>Путь к файлу свойств для целевых больших двоичных объектов. Дополнительные сведения см. в статье [Формат файла свойств и метаданных службы импорта и экспорта](../storage-import-export-file-format-metadata-and-properties.md). |

## <a name="prepare-initialdriveset-or-additionaldriveset-csv-file"></a>Подготовка CSV-файла InitialDriveSet или AdditionalDriveSet

### <a name="what-is-driveset-csv"></a>Что такое CSV-файл набора дисков

Значение флага /InitialDriveSet или /AdditionalDriveSet — это CSV-файл, содержащий список дисков, с которыми сопоставлены буквы дисков, в результате чего инструмент может правильно выбрать список дисков для подготовки. Если размер данных превышает размер диска, средство WAImportExport оптимальным образом распределяет данные между несколькими дисками, указанными в этом CSV-файле.

В рамках одного сеанса данные можно записывать на неограниченное количество дисков. Средство распределяет данные на основе размера диска и папки. Выбор наиболее подходящего диска зависит от размера объекта. Данные, переданные в учетную запись хранения, принимают структуру каталогов, указанную в файле набора данных. Чтобы создать CSV-файл набора дисков, выполните описанные ниже действия.

### <a name="create-basic-volume-and-assign-drive-letter"></a>Создание базового тома и назначение буквы диска

Чтобы создать базовый том и назначить букву диска, выполните инструкции по созданию раздела, описанные в статье с [общими сведениями об управлении дисками](https://technet.microsoft.com/library/cc754936.aspx).

### <a name="sample-initialdriveset-and-additionaldriveset-csv-file"></a>Пример CSV-файла InitialDriveSet и AdditionalDriveSet

```
DriveLetter,FormatOption,SilentOrPromptOnFormat,Encryption,ExistingBitLockerKey
G,AlreadyFormatted,SilentMode,AlreadyEncrypted,060456-014509-132033-080300-252615-584177-672089-411631
H,Format,SilentMode,Encrypt,
```

### <a name="driveset-csv-file-fields"></a>Поля CSV-файла набора дисков

| Поля | Значение |
| --- | --- |
| DriveLetter | **[Обязательный параметр]**<br/> Каждый диск, указанный в средстве как целевой, должен иметь простой том NTFS и назначенную букву.<br/> <br/>**Пример:** R или r. |
| FormatOption | **[Обязательный параметр]** Format &#124; AlreadyFormatted<br/><br/> **Format.** Включает форматирование всех данных на диске. <br/>**AlreadyFormatted.** Если указано это значение, средство пропускает форматирование. |
| SilentOrPromptOnFormat | **[Обязательный параметр]** SilentMode &#124; PromptOnFormat<br/><br/>**SilentMode.** Укажите это значение, чтобы запустить средство в автоматическом режиме. <br/>**PromptOnFormat.** Указав это значение, средство будет запрашивать подтверждение действия при каждом форматировании.<br/><br/>Если не задать его, выполнение команды прервется и отобразится сообщение "Неправильное значение для свойства SilentOrPromptOnFormat: none". |
| Шифрование | **[Обязательный параметр]**  Encrypt &#124; AlreadyEncrypted<br/> Значение этого поля определяет, какие диски следует шифровать, а какие нет. <br/><br/>**Encrypt.** Инструмент отформатирует диск. Если для поля FormatOption задано значение Format, то в этом поле следует задать значение Encrypt. Если в этом случае задать значение AlreadyEncrypted, отобразится следующее сообщение об ошибке: When Format is specified, Encrypt must also be specified (Если задано значение Format, то также необходимо задать значение Encrypt).<br/>**AlreadyEncrypted.** Если указать это значение, инструмент расшифрует диск, используя ключ BitLocker, указанный в поле ExistingBitLockerKey. Если для поля FormatOption задано значение AlreadyFormatted, то в этом поле можно задать как значение Encrypt, так и AlreadyEncrypted. |
| ExistingBitLockerKey | **[Обязательный параметр]**, если в поле Encryption задано значение AlreadyEncrypted<br/> Значение этого поля — ключ BitLocker, связанный с определенным диском. <br/><br/>Если в поле Encryption указано значение Encrypt, то это поле следует оставить пустым.  Если в этом случае указать ключ BitLocker, отобразится следующее сообщение об ошибке: Bitlocker Key should not be specified (Не следует указывать ключ BitLocker).<br/>  **Пример**: 060456-014509-132033-080300-252615-584177-672089-411631.|

##  <a name="preparing-disk-for-import-job"></a>Подготовка диска к заданию импорта

Чтобы подготовить диски к заданию импорта, вызовите средство WAImportExport с помощью команды **PrepImport**. Используемые параметры зависят от того, какой это сеанс копирования: первый или последующий.

### <a name="first-session"></a>Первый сеанс

Во время первого сеанса выполняется копирование одного или нескольких каталогов на один или несколько дисков (в зависимости от параметров, указанных в CSV-файле). Команда PrepImport в средстве WAImportExport, используемая для первого сеанса копирования каталогов и (или) файлов в рамках нового сеанса, выглядит следующим образом:

```
WAImportExport.exe PrepImport /j:<JournalFile> /id:<SessionId> [/logdir:<LogDirectory>] [/sk:<StorageAccountKey>] [/silentmode] [/InitialDriveSet:<driveset.csv>] DataSet:<dataset.csv>
```

**Пример**

```
WAImportExport.exe PrepImport /j:JournalTest.jrn /id:session#1  /sk:\*\*\*\*\*\*\*\*\*\*\*\*\* /InitialDriveSet:driveset-1.csv /DataSet:dataset-1.csv /logdir:F:\logs
```

### <a name="add-data-in-subsequent-session"></a>Добавление данных в последующем сеансе

Для последующих сеансов копирования начальные параметры задавать не нужно. Вы должны использовать тот же файл журнала, чтобы продолжить последующий сеанс с места остановки предыдущего. Состояние сеанса копирования записывается в файл журнала. Ниже приведен синтаксис для последующего сеанса копирования дополнительных каталогов или файлов.

```
WAImportExport.exe PrepImport /j:<SameJournalFile> /id:<DifferentSessionId>  [DataSet:<differentdataset.csv>]
```

**Пример**

```
WAImportExport.exe PrepImport /j:JournalTest.jrn /id:session#2  /DataSet:dataset-2.csv
```

### <a name="add-drives-to-latest-session"></a>Добавление дисков к последнему сеансу

Если данные не поместились на указанных в файле InitialDriveset дисках, с помощью этого средства вы можете добавить дополнительные диски к тому же сеансу копирования. 

>[!NOTE] 
>Идентификатор этого сеанса должен совпадать с идентификатором предыдущего сеанса. В обоих сеансах следует использовать тот же файл журнала.
>
```
WAImportExport.exe PrepImport /j:<SameJournalFile> /id:<SameSessionId> /AdditionalDriveSet:<newdriveset.csv>
```

**Пример**

```
WAImportExport.exe PrepImport /j:SameJournalTest.jrn /id:session#2  /AdditionalDriveSet:driveset-2.csv
```

### <a name="abort-the-latest-session"></a>Прерывание последнего сеанса

Если сеанс копирования был прерван и его невозможно восстановить (например, если исходный каталог стал недоступным), текущий сеанс необходимо прервать. Это позволит выполнить откат этого сеанса копирования и запустить новый.

```
WAImportExport.exe PrepImport /j:<SameJournalFile> /id:<SameSessionId> /AbortSession
```

**Пример**

```
WAImportExport.exe PrepImport /j:JournalTest.jrn /id:session#2  /AbortSession
```

Вы можете прервать только последний завершившийся сбоем сеанс. Обратите внимание, что первый сеанс копирования для диска прервать невозможно. В этом случае нужно перезапустить сеанс копирования, используя новый файл журнала.

### <a name="resume-a-latest-interrupted-session"></a>Возобновление последнего прерванного сеанса

Если сеанс копирования по какой-либо причине был прерван, вы можете возобновить его. Для этого запустите средство, указав только определенный файл журнала.

```
WAImportExport.exe PrepImport /j:<SameJournalFile> /id:<SameSessionId> /ResumeSession
```

**Пример**

```
WAImportExport.exe PrepImport /j:JournalTest.jrn /id:session#2 /ResumeSession
```

> [!IMPORTANT] 
> При возобновлении сеанса копирования не добавляйте дополнительные или не удаляйте исходные файлы данных и каталоги.

## <a name="waimportexport-parameters"></a>Параметры WAImportExport

| Параметры | Описание |
| --- | --- |
|     /j:&lt;JournalFile&gt;  | **Обязательный**<br/> Путь к файлу журнала. Файл журнала отслеживает набор дисков и записывает ход выполнения их подготовки. Его необходимо всегда указывать.  |
|     /logdir:&lt;LogDirectory&gt;  | **Необязательно**. Каталог журнала.<br/> В этот каталог записываются файлы подробного журнала и некоторые временные файлы. Если каталог не указан, вместо него будет использоваться текущий каталог. Для одного файла журнала можно указать только один каталог журнала.  |
|     /id:&lt;SessionId&gt;  | **Обязательный**<br/> Идентификатор сеанса, используемый для определения сеанса копирования. и используется для обеспечения точного восстановления прерванного сеанса копирования.  |
|     /ResumeSession  | необязательный параметр. Если последний сеанс копирования завершился сбоем, этот параметр позволяет возобновить сеанс.   |
|     /AbortSession  | необязательный параметр. Если последний сеанс копирования завершился сбоем, этот параметр позволяет прервать сеанс.  |
|     /sn:&lt;StorageAccountName&gt;  | **Обязательный**<br/> Применяется только для команд RepairImport и RepairExport. Имя учетной записи хранения.  |
|     /sk:&lt;StorageAccountKey&gt;  | **Обязательный**<br/> Ключ учетной записи хранения. |
|     /InitialDriveSet:&lt;driveset.csv&gt;  | **Обязательный параметр.** При выполнении первого сеанса копирования.<br/> CSV-файл, содержащий список дисков для подготовки.  |
|     /AdditionalDriveSet:&lt;driveset.csv&gt; | **Обязательный**. При добавлении дисков к текущему сеансу копирования. <br/> CSV-файл, содержащий список дополнительных дисков, которые нужно добавить.  |
|      /r:&lt;RepairFile&gt; | **Обязательный параметр.** Применяется только для команд RepairImport и RepairExport.<br/> Путь к файлу для отслеживания хода выполнения восстановления. Каждый диск должен быть связан с одним и только одним файлом восстановления.  |
|     /d:&lt;TargetDirectories&gt; | **Обязательный**. Применяется только для команд RepairImport и RepairExport. В команде RepairImport можно указать один или несколько каталогов для восстановления (в качестве разделителя используется точка с запятой), а в команде RepairExport — один каталог, т. е. корневой каталог диска.  |
|     /CopyLogFile:&lt;DriveCopyLogFile&gt; | **Обязательный параметр.** Применяется только для команд RepairImport и RepairExport. Путь к файлу журнала копирования диска (подробного журнала или журнала ошибок).  |
|     /ManifestFile:&lt;DriveManifestFile&gt; | **Обязательный параметр.** Применяется только для команды RepairExport.<br/> Путь к файлу манифеста диска.  |
|     /PathMapFile:&lt;DrivePathMapFile&gt; | **Необязательно**. Применяется только для команды RepairImport.<br/> Путь к файлу, содержащему сопоставления путей к файлам корневого каталога диска с расположениями фактических файлов (с разделителями-знаками табуляции). При первом указании он заполняется пустыми путями. Это означает, что эти файлы отсутствуют в целевых каталогах, доступ к ним запрещен, они имеют недопустимое имя или находятся в нескольких каталогах. Файл сопоставления пути можно изменить вручную, добавив в него правильные целевые пути. Затем его можно заново задать в средстве. Это позволит устранить проблему с путями к файлам.  |
|     /ExportBlobListFile:&lt;ExportBlobListFile&gt; | **Обязательный**. Применяется только для команды PreviewExport.<br/> Путь к XML-файлу, содержащему список путей к большим двоичным объектам или префиксов путей экспортируемых больших двоичных объектов. Формат файла совпадает с форматом большого двоичного объекта списка больших двоичных объектов в операции Put Job интерфейса REST API службы импорта и экспорта.  |
|     /DriveSize:&lt;DriveSize&gt; | **Обязательный**. Применяется только для команды PreviewExport.<br/>  Размер экспортируемых дисков. Пример: 500 ГБ, 1,5 ТБ. Примечание: 1 ГБ = 1 000 000 000 байтов, 1 ТБ = 1 000 000 000 000 байтов.  |
|     /DataSet:&lt;dataset.csv&gt; | **Обязательный**<br/> CSV-файл, содержащий список каталогов и (или) файлов, которые нужно копировать на целевые диски.  |
|     /silentmode  | **Необязательно**.<br/> Если этот параметр не указан, отобразятся требования дисков и запрос на подтверждение.  |

## <a name="tool-output"></a>Выходные данные инструмента

### <a name="sample-drive-manifest-file"></a>Пример файла манифеста диска

```xml
<?xml version="1.0" encoding="UTF-8"?>
<DriveManifest Version="2011-MM-DD">
   <Drive>
      <DriveId>drive-id</DriveId>
      <StorageAccountKey>storage-account-key</StorageAccountKey>
      <ClientCreator>client-creator</ClientCreator>
      <!-- First Blob List -->
      <BlobList Id="session#1-0">
         <!-- Global properties and metadata that applies to all blobs -->
         <MetadataPath Hash="md5-hash">global-metadata-file-path</MetadataPath>
         <PropertiesPath Hash="md5-hash">global-properties-file-path</PropertiesPath>
         <!-- First Blob -->
         <Blob>
            <BlobPath>blob-path-relative-to-account</BlobPath>
            <FilePath>file-path-relative-to-transfer-disk</FilePath>
            <ClientData>client-data</ClientData>
            <Length>content-length</Length>
            <ImportDisposition>import-disposition</ImportDisposition>
            <!-- page-range-list-or-block-list -->
            <!-- page-range-list -->
            <PageRangeList>
               <PageRange Offset="1073741824" Length="512" Hash="md5-hash" />
               <PageRange Offset="1073741824" Length="512" Hash="md5-hash" />
            </PageRangeList>
            <!-- block-list -->
            <BlockList>
               <Block Offset="1073741824" Length="4194304" Id="block-id" Hash="md5-hash" />
               <Block Offset="1073741824" Length="4194304" Id="block-id" Hash="md5-hash" />
            </BlockList>
            <MetadataPath Hash="md5-hash">metadata-file-path</MetadataPath>
            <PropertiesPath Hash="md5-hash">properties-file-path</PropertiesPath>
         </Blob>
      </BlobList>
   </Drive>
</DriveManifest>
```

### <a name="sample-journal-file-xml-for-each-drive"></a>Пример файла журнала для каждого диска (XML-файл)

```xml
[BeginUpdateRecord][2016/11/01 21:22:25.379][Type:ActivityRecord]
ActivityId: DriveInfo
DriveState: [BeginValue]
<?xml version="1.0" encoding="UTF-8"?>
<Drive>
   <DriveId>drive-id</DriveId>
   <BitLockerKey>*******</BitLockerKey>
   <ManifestFile>\DriveManifest.xml</ManifestFile>
   <ManifestHash>D863FE44F861AE0DA4DCEAEEFFCCCE68</ManifestHash> </Drive>
[EndValue]
SaveCommandOutput: Completed
[EndUpdateRecord]
```

### <a name="sample-journal-file-jrn-for-session-that-records-the-trail-of-sessions"></a>Пример файла журнала для сеанса (JRN-файл) со сведениями о состоянии сеансов

```
[BeginUpdateRecord][2016/11/02 18:24:14.735][Type:NewJournalFile]
VocabularyVersion: 2013-02-01
[EndUpdateRecord]
[BeginUpdateRecord][2016/11/02 18:24:14.749][Type:ActivityRecord]
ActivityId: PrepImportDriveCommandContext
LogDirectory: F:\logs
[EndUpdateRecord]
[BeginUpdateRecord][2016/11/02 18:24:14.754][Type:ActivityRecord]
ActivityId: PrepImportDriveCommandContext
StorageAccountKey: *******
[EndUpdateRecord]
```

## <a name="faq"></a>Часто задаваемые вопросы

### <a name="general"></a>Общие сведения

#### <a name="what-is-waimportexport-tool"></a>Что такое средство WAImportExport?

WAImportExport — это инструмент подготовки и исправления дисков, который можно использовать в службе импорта и экспорта Microsoft Azure. Оно позволяет копировать данные на жесткие диски перед отправкой их в центр обработки данных Azure. После завершения задания импорта это средство можно использовать для восстановления поврежденных, отсутствующих или конфликтных больших двоичных объектов. Это средство также позволяет восстанавливать на дисках поврежденные или отсутствующие файлы после завершения задания экспорта.

#### <a name="how-does-the-waimportexport-tool-work-on-multiple-source-dir-and-disks"></a>Как инструмент WAImportExport работает с несколькими исходными каталогами и дисками?

Если размер данных превышает размер диска, средство WAImportExport оптимальным образом распределяет данные между несколькими дисками. Копирование данных на несколько дисков может выполняться параллельно или последовательно. Одновременно данные можно записывать на неограниченное количество дисков. Средство распределяет данные на основе размера диска и папки. Выбор наиболее подходящего диска зависит от размера объекта. Данные, отправленные в учетную запись хранения, принимают указанную структуру каталогов.

#### <a name="where-can-i-find-previous-version-of-waimportexport-tool"></a>Где можно найти предыдущую версию средства WAImportExport?

Средство WAImportExport поддерживает все те же функции, что и его первая версия. Оно позволяет пользователям указывать несколько источников и записывать данные на несколько дисков. Кроме того, это средство позволяет легко управлять несколькими расположениями источников данных, из которых данные копируются в один CSV-файл. Тем не менее, если нужно добавить поддержку SAS или копировать на диск отдельный источник данных, вы можете [скачать средство WAImportExport версии 1] (http://go.microsoft.com/fwlink/?LinkID=301900&amp;clcid=0x409), а также ознакомиться со [справочными материалами по работе с ним](storage-import-export-tool-how-to-v1.md).

#### <a name="what-is-a-session-id"></a>Что такое идентификатор сеанса?

Если данные необходимо распределить между несколькими дисками, в средстве следует указать одинаковый идентификатор сеанса копирования (параметр /id). Настроив одинаковое имя сеанса копирования, пользователь сможет копировать данные из одного или нескольких расположений источника данных на один или несколько целевых дисков (в один или несколько целевых каталогов). При настройке одинакового идентификатора сеанса средство сможет получить копии файлов из их последнего расположения.

Однако в рамках одного сеанса копирования нельзя импортировать данные в разные учетные записи хранения.

Если при нескольких запусках средства использовалось то же самое имя сеанса копирования, файл журнала (/logdir) и ключ учетной записи хранения (/sk) также будут совпадать.

Идентификатор сеанса может содержать буквы, цифры от 0 до 9, а также символ подчеркивания (\_), тире (-) или хэш (#). Его длина должна быть от 3 до 30 символов.

Например, session-1, session#1 или session\_1.

#### <a name="what-is-a-journal-file"></a>Что такое файл журнала?

При каждом запуске средства WAImportExport для копирования файлов на жесткий диск создается сеанс копирования. Состояние сеанса копирования записывается в файл журнала. Если сеанс копирования прерывается (например, из-за отключения питания системы), его можно возобновить. Для этого повторно запустите средство и укажите файл журнала в командной строке.

Для каждого подготавливаемого жесткого диска инструмент импорта и экспорта Azure создает отдельный файл журнала &lt;ИД_диска&gt;.xml, где идентификатор диска — это связанный с диском серийный номер, полученный инструментом с диска. Чтобы создать задание импорта, вам потребуются файлы журналов со всех ваших дисков. Файл журнала также можно использовать для возобновления подготовки диска, если работа средства прервана.

#### <a name="what-is-a-log-directory"></a>Что такое каталог журнала?

Каталог журнала определяет каталог, используемый для хранения файлов подробного журнала и некоторых временных файлов манифеста. Если каталог не указан, вместо него будет использоваться текущий каталог. В этот каталог записываются подробные журналы.

### <a name="prerequisites"></a>Предварительные требования

#### <a name="what-are-the-specifications-of-my-disk"></a>Какие спецификации моего диска?

Один или несколько пустых 2,5- или 3,5-дюймовых дисков SATA II или SATA III либо твердотельные накопители, подключенные к целевому компьютеру.

#### <a name="how-can-i-enable-bitlocker-on-my-machine"></a>Как включить BitLocker на моем компьютере?

Щелкните системный диск правой кнопкой мыши. Если технология BitLocker включена, вы увидите соответствующие параметры, а если нет, эти параметры отображаться не будут.

![Проверка BitLocker](./media/storage-import-export-tool-preparing-hard-drives-import/BitLocker.png)

Дополнительные сведения о включении BitLocker см. в [этой статье](https://technet.microsoft.com/library/cc766295.aspx).

На вашем компьютере может отсутствовать микросхема доверенного платформенного модуля (TPM). Если после выполнения команды tpm.msc не возвращаются выходные данные, см. следующий часто задаваемый вопрос.

#### <a name="how-to-disable-trusted-platform-module-tpm-in-bitlocker"></a>Как отключить доверенный платформенный модуль (TPM) в BitLocker?
> [!NOTE]
> Только в том случае, если в серверах отсутствует доверенный платформенный модуль (TPM), необходимо отключить политику доверенного платформенного модуля. Если в сервере пользователя есть доверенный платформенный модуль, то делать это не обязательно. 
> 

Чтобы отключить модуль TPM в BitLocker, выполните следующие действия:<br/>
1. Запустите **редактор групповых политик**. Для этого в окне командной строки введите команду gpedit.msc. Если **редактор групповых политик** недоступен, сначала включите BitLocker. См. предыдущий часто задаваемый вопрос.
2. Выберите **Политика локального компьютера &gt; Конфигурация компьютера &gt; Административные шаблоны &gt; Компоненты Windows &gt; Шифрование диска BitLocker &gt; Диски операционной системы**.
3. Измените политику **Обязательная дополнительная проверка подлинности при запуске**.
4. **Включите** эту политику и установите флажок **Разрешить использование BitLocker без совместимого TPM**.

####  <a name="how-to-check-if-net-4-or-higher-version-is-installed-on-my-machine"></a>Как проверить, установлена ли на компьютере платформа .NET 4?

Все версии Microsoft .NET Framework устанавливаются в следующем каталоге: %windir%\Microsoft.NET\Framework\.

Перейдите к упомянутому выше каталогу на своем целевом компьютере, где нужно запустить средство. Найдите папку, имя которой начинается с v4. Если эта папка отсутствует, это означает, что на компьютере не установлена платформа .NET 4. Ее можно скачать с сайта [Microsoft .NET Framework 4 (веб-установщик)](https://www.microsoft.com/download/details.aspx?id=17851).

### <a name="limits"></a>Ограничения

#### <a name="how-many-drives-can-i-preparesend-at-the-same-time"></a>Сколько дисков можно одновременно подготовить или отправить?

Ограничений на количество дисков, которое можно подготовить с помощью средства, нет. Тем не менее перед подготовкой вам потребуется ввести буквы дисков. Это значит, что с помощью средства одновременно можно подготовить не более 25 дисков. В рамках одного задания одновременно можно обрабатывать не более 10 дисков. При подготовке более 10 дисков для одной и той же учетной записи хранения они могут распределяться между несколькими заданиями.

#### <a name="can-i-target-more-than-one-storage-account"></a>Можно ли назначить более одной учетной записи хранения?

В рамках одного задания и одного сеанса копирования можно отправить только одну учетную запись хранения.

### <a name="capabilities"></a>Возможности

#### <a name="does-waimportexportexe-encrypt-my-data"></a>Шифрует ли средство WAImportExport.exe данные?

Да. Для этого процесса требуется шифрование, поэтому это средство выполняет шифрование на основе технологии BitLocker.

#### <a name="what-will-be-the-hierarchy-of-my-data-when-it-appears-in-the-storage-account"></a>Какова иерархия данных после добавления их в учетную запись хранения?

Несмотря на то что данные распределены между несколькими дисками, после отправки в учетную запись хранения они принимают структуру каталогов, указанную в CSV-файле набора данных.

#### <a name="how-many-of-the-input-disks-will-have-active-io-in-parallel-when-copy-is-in-progress"></a>На скольких дисках будут одновременно выполняться операции ввода-вывода в ходе выполнения копирования?

Средство распределяет данные между дисками на основе размера входных файлов. При этом количество одновременно активных дисков полностью зависит от входных данных. В зависимости от размера отдельных файлов во входном наборе данных в активном состоянии могут одновременно находиться один или несколько дисков. Чтобы получить дополнительные сведения, ознакомьтесь со следующим вопросом.

#### <a name="how-does-the-tool-distribute-the-files-across-the-disks"></a>Как средство распределяет файлы между дисками?

Средство WAImportExport выполняет операции чтения и записи файлов пакет за пакетом. Каждый пакет содержит не более 100 000 файлов. Это означает, что одновременно средство может записать не более 100 000 файлов. Если эти файлы распределены между несколькими дисками, то они записываются одновременно. Однако записывает ли инструмент файлы одновременно на несколько дисков или на один, зависит от совокупного размера пакета. Например, если файлы небольшие и все 100 000 файлов помещаются на один диск, при обработке этого пакета средство записывает их только на один диск.

### <a name="waimportexport-output"></a>Выходные данные WAImportExport

#### <a name="there-are-two-journal-files-which-one-should-i-upload-to-azure-portal"></a>Какой из двух файлов журнала следует передать на портал Azure?

**XML-файл.** Для каждого подготавливаемого жесткого диска инструмент WAImportExport создает отдельный файл журнала `<DriveID>.xml`, где DriveID — это связанный с диском серийный номер, полученный инструментом с диска. Чтобы создать задание импорта на портале Azure, вам потребуются файлы журналов со всех ваших дисков. Этот файл журнала также можно использовать для возобновления подготовки диска, если работа средства прервана.

**JRN-файл.** Файл журнала с суффиксом `.jrn` содержит данные о состояниях всех сеансов копирования на жесткий диск. Он также содержит сведения, необходимые для создания задания импорта. При запуске средства WAImportExport необходимо всегда указывать файл журнала и идентификатор сеанса копирования.

## <a name="next-steps"></a>Дальнейшие действия

* [Настройка средства импорта и экспорта Azure](storage-import-export-tool-setup.md)
* [Настройка свойств и метаданных во время импорта](storage-import-export-tool-setting-properties-metadata-import.md)
* [Пример рабочего процесса по подготовке жестких дисков для задания импорта](storage-import-export-tool-sample-preparing-hard-drives-import-job-workflow.md)
* [Краткий справочник по часто используемым командам](storage-import-export-tool-quick-reference.md) 
* [Просмотр состояния задания с помощью файлов журнала копирования](storage-import-export-tool-reviewing-job-status-v1.md)
* [Подготовка задания импорта](storage-import-export-tool-repairing-an-import-job-v1.md)
* [Подготовка задания экспорта](storage-import-export-tool-repairing-an-export-job-v1.md)
* [Устранение неполадок со средством импорта и экспорта Azure](storage-import-export-tool-troubleshooting-v1.md)
