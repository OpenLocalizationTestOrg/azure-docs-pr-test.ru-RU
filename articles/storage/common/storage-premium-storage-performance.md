---
title: "Хранилище Azure уровня \"Премиум\": проектирование для обеспечения высокой производительности | Документация Майкрософт"
description: "Разработка высокопроизводительных приложений с использованием хранилища Azure класса «Премиум». Хранилище Premium обеспечивает поддержку дисков с высокой производительностью и малой задержкой для интенсивных рабочих нагрузок ввода-вывода на виртуальных машинах Azure."
services: storage
documentationcenter: na
author: aungoo-msft
manager: tadb
editor: tysonn
ms.assetid: e6a409c3-d31a-4704-a93c-0a04fdc95960
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/27/2017
ms.author: aungoo
ms.openlocfilehash: 5b5c8b4a0d490aee4b3d33f9222011d7864e4490
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="azure-premium-storage-design-for-high-performance"></a><span data-ttu-id="a3331-104">Хранилище Azure класса «Премиум»: разработка, обеспечивающая повышенную производительность</span><span class="sxs-lookup"><span data-stu-id="a3331-104">Azure Premium Storage: Design for High Performance</span></span>
## <a name="overview"></a><span data-ttu-id="a3331-105">Обзор</span><span class="sxs-lookup"><span data-stu-id="a3331-105">Overview</span></span>
<span data-ttu-id="a3331-106">В этой статье приведены рекомендации по разработке высокопроизводительных приложений с использованием хранилища Azure класса «Премиум».</span><span class="sxs-lookup"><span data-stu-id="a3331-106">This article provides guidelines for building high performance applications using Azure Premium Storage.</span></span> <span data-ttu-id="a3331-107">Указания в этом документе можно использовать вместе с рекомендациями по производительности, применимыми к технологиям, которые используются приложением.</span><span class="sxs-lookup"><span data-stu-id="a3331-107">You can use the instructions provided in this document combined with performance best practices applicable to technologies used by your application.</span></span> <span data-ttu-id="a3331-108">Чтобы продемонстрировать упомянутые рекомендации, в этом документе в качестве примера использован SQL Server, запущенный в хранилище класса «Премиум».</span><span class="sxs-lookup"><span data-stu-id="a3331-108">To illustrate the guidelines, we have used SQL Server running on Premium Storage as an example throughout this document.</span></span>

<span data-ttu-id="a3331-109">Хотя в этой статье приведены сценарии повышения производительности для уровня хранилища, вам нужно будет оптимизировать уровень приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-109">While we address performance scenarios for the Storage layer in this article, you will need to optimize the application layer.</span></span> <span data-ttu-id="a3331-110">Например, при размещении фермы SharePoint в хранилище Azure класса «Премиум» для оптимизации работы сервера базы данных можно использовать примеры для SQL Server из этой статьи.</span><span class="sxs-lookup"><span data-stu-id="a3331-110">For example, if you are hosting a SharePoint Farm on Azure Premium Storage, you can use the SQL Server examples from this article to optimize the database server.</span></span> <span data-ttu-id="a3331-111">Кроме того, для получения лучшей производительности можно также оптимизировать веб-сервер и сервер приложений фермы SharePoint.</span><span class="sxs-lookup"><span data-stu-id="a3331-111">Additionally, optimize the SharePoint Farm's Web server and Application server to get the most performance.</span></span>

<span data-ttu-id="a3331-112">В этой статье содержатся ответы на следующие распространенные вопросы об оптимизации производительности приложений в хранилище Azure класса «Премиум».</span><span class="sxs-lookup"><span data-stu-id="a3331-112">This article will help answer following common questions about optimizing application performance on Azure Premium Storage,</span></span>

* <span data-ttu-id="a3331-113">Как измерить производительность приложения?</span><span class="sxs-lookup"><span data-stu-id="a3331-113">How to measure your application performance?</span></span>  
* <span data-ttu-id="a3331-114">Почему не наблюдается ожидаемая высокая производительность?</span><span class="sxs-lookup"><span data-stu-id="a3331-114">Why are you not seeing expected high performance?</span></span>  
* <span data-ttu-id="a3331-115">Какие факторы влияют на производительность приложения в хранилище класса «Премиум»?</span><span class="sxs-lookup"><span data-stu-id="a3331-115">Which factors influence your application performance on Premium Storage?</span></span>  
* <span data-ttu-id="a3331-116">Как эти факторы влияют на производительность приложения в хранилище класса «Премиум»?</span><span class="sxs-lookup"><span data-stu-id="a3331-116">How do these factors influence performance of your application on Premium Storage?</span></span>  
* <span data-ttu-id="a3331-117">Как можно оптимизировать операции ввода-вывода, пропускную способность и задержку?</span><span class="sxs-lookup"><span data-stu-id="a3331-117">How can you optimize for IOPS, Bandwidth and Latency?</span></span>  

<span data-ttu-id="a3331-118">Рекомендации в этой статье предназначены специально для хранилища класса «Премиум», так как рабочие нагрузки в этом хранилище очень чувствительны к уровню производительности.</span><span class="sxs-lookup"><span data-stu-id="a3331-118">We have provided these guidelines specifically for Premium Storage because workloads running on Premium Storage are highly performance sensitive.</span></span> <span data-ttu-id="a3331-119">В соответствующих случаях приведены наглядные примеры.</span><span class="sxs-lookup"><span data-stu-id="a3331-119">We have provided examples where appropriate.</span></span> <span data-ttu-id="a3331-120">Некоторые из этих рекомендаций можно также применять к приложениям, выполняющимся в виртуальных машинах IaaS с использованием дисков хранилища класса «Стандартный».</span><span class="sxs-lookup"><span data-stu-id="a3331-120">You can also apply some of these guidelines to applications running on IaaS VMs with Standard Storage disks.</span></span>

<span data-ttu-id="a3331-121">Если вы не знакомы с хранилищем уровня "Премиум", перед началом работы ознакомьтесь со статьями [Высокопроизводительное хранилище класса Premium, а также неуправляемые и управляемые диски виртуальной машины Azure](../storage-premium-storage.md) и [Целевые показатели масштабируемости и производительности службы хранилища Azure](storage-scalability-targets.md).</span><span class="sxs-lookup"><span data-stu-id="a3331-121">Before you begin, if you are new to Premium Storage, first read the [Premium Storage: High-Performance Storage for Azure Virtual Machine Workloads](../storage-premium-storage.md) and [Azure Storage Scalability and Performance Targets](storage-scalability-targets.md) articles.</span></span>

## <a name="application-performance-indicators"></a><span data-ttu-id="a3331-122">Показатели производительности приложения</span><span class="sxs-lookup"><span data-stu-id="a3331-122">Application Performance Indicators</span></span>
<span data-ttu-id="a3331-123">Оценка производительности приложения выполняется на основе определенных показателей, например скорость обработки запросов пользователя приложением, объем данных, обрабатываемых приложением для каждого запроса, количество запросов, обрабатываемых приложением в определенный период времени, а также период времени от отправки запроса и до получения ответа.</span><span class="sxs-lookup"><span data-stu-id="a3331-123">We assess whether an application is performing well or not using performance indicators like, how fast an application is processing a user request, how much data an application is processing per request, how many requests is an application processing in a specific period of time, how long a user has to wait to get a response after submitting their request.</span></span> <span data-ttu-id="a3331-124">Технически эти показатели производительности называются так: количество операций ввода-вывода в секунду, пропускная способность и задержка.</span><span class="sxs-lookup"><span data-stu-id="a3331-124">The technical terms for these performance indicators are, IOPS, Throughput or Bandwidth, and Latency.</span></span>

<span data-ttu-id="a3331-125">В этом разделе рассматриваются общие показатели производительности в контексте хранилища класса «Премиум».</span><span class="sxs-lookup"><span data-stu-id="a3331-125">In this section, we will discuss the common performance indicators in the context of Premium Storage.</span></span> <span data-ttu-id="a3331-126">В следующем разделе («Сбор требований к производительности приложения») описывается, как измерить эти показатели производительности для приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-126">In the following section, Gathering Application Requirements, you will learn how to measure these performance indicators for your application.</span></span> <span data-ttu-id="a3331-127">Далее в разделе «Оптимизация производительности приложения» рассказывается о факторах, влияющих на эти показатели производительности, и рекомендациях по их оптимизации.</span><span class="sxs-lookup"><span data-stu-id="a3331-127">Later in Optimizing Application Performance, you will learn about the factors affecting these performance indicators and recommendations to optimize them.</span></span>

## <a name="iops"></a><span data-ttu-id="a3331-128">ОПЕРАЦИЙ ВВОДА-ВЫВОДА</span><span class="sxs-lookup"><span data-stu-id="a3331-128">IOPS</span></span>
<span data-ttu-id="a3331-129">Количество операций ввода-вывода в секунду — это количество запросов, которые приложение отправляет на диски хранилища в секунду.</span><span class="sxs-lookup"><span data-stu-id="a3331-129">IOPS is number of requests that your application is sending to the storage disks in one second.</span></span> <span data-ttu-id="a3331-130">Существуют такие типы операций ввода-вывода: операции чтения и записи, последовательные или случайные.</span><span class="sxs-lookup"><span data-stu-id="a3331-130">An input/output operation could be read or write, sequential or random.</span></span> <span data-ttu-id="a3331-131">Приложениям OLTP, таким как веб-сайт розничной торговли, необходимо обрабатывать множество одновременных запросов пользователей сразу.</span><span class="sxs-lookup"><span data-stu-id="a3331-131">OLTP applications like an online retail website need to process many concurrent user requests immediately.</span></span> <span data-ttu-id="a3331-132">Запросы пользователя представляют собой ресурсоемкие транзакции вставки и обновления в базе данных, требующие быстрой обработки.</span><span class="sxs-lookup"><span data-stu-id="a3331-132">The user requests are insert and update intensive database transactions, which the application must process quickly.</span></span> <span data-ttu-id="a3331-133">Поэтому приложениям OLTP необходима очень высокая скорость выполнения операций ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="a3331-133">Therefore, OLTP applications require very high IOPS.</span></span> <span data-ttu-id="a3331-134">Такие приложения обрабатывают миллионы небольших случайных запросов ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="a3331-134">Such applications handle millions of small and random IO requests.</span></span> <span data-ttu-id="a3331-135">Для такого приложения следует разрабатывать инфраструктуру с учетом оптимизации операций ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="a3331-135">If you have such an application, you must design the application infrastructure to optimize for IOPS.</span></span> <span data-ttu-id="a3331-136">В разделе *Оптимизация производительности приложения*подробно рассматриваются все факторы, которые необходимо учитывать для получения высокой скорости выполнения операций ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="a3331-136">In the later section, *Optimizing Application Performance*, we discuss in detail all the factors that you must consider to get high IOPS.</span></span>

<span data-ttu-id="a3331-137">При подключении диска хранилища класса «Премиум» к высокомасштабируемой виртуальной машине Azure выполняет подготовку гарантированного количества операций ввода-вывода в секунду в соответствии со спецификацией диска.</span><span class="sxs-lookup"><span data-stu-id="a3331-137">When you attach a premium storage disk to your high scale VM, Azure provisions for you a guaranteed number of IOPS as per the disk specification.</span></span> <span data-ttu-id="a3331-138">Например, диск P50 позволяет подготовить 7500 операций ввода-вывода в секунду.</span><span class="sxs-lookup"><span data-stu-id="a3331-138">For example, a P50 disk provisions 7500 IOPS.</span></span> <span data-ttu-id="a3331-139">Для каждого размера высокомасштабируемой виртуальной машины также установлено ограничение на количество выполняемых операций ввода-вывода в секунду.</span><span class="sxs-lookup"><span data-stu-id="a3331-139">Each high scale VM size also has a specific IOPS limit that it can sustain.</span></span> <span data-ttu-id="a3331-140">Например, для виртуальной машины серии GS5 класса «Стандартный» установлено ограничение в 80 000 операций ввода-вывода в секунду.</span><span class="sxs-lookup"><span data-stu-id="a3331-140">For example, a Standard GS5 VM has 80,000 IOPS limit.</span></span>

## <a name="throughput"></a><span data-ttu-id="a3331-141">Пропускная способность</span><span class="sxs-lookup"><span data-stu-id="a3331-141">Throughput</span></span>
<span data-ttu-id="a3331-142">Пропускная способность представляет собой объем данных, которые приложение отправляет на диски хранилища в течение заданного интервала.</span><span class="sxs-lookup"><span data-stu-id="a3331-142">Throughput or Bandwidth is the amount of data that your application is sending to the storage disks in a specified interval.</span></span> <span data-ttu-id="a3331-143">Если приложение выполняет операции ввода-вывода большого объема, ему требуется высокая пропускная способность.</span><span class="sxs-lookup"><span data-stu-id="a3331-143">If your application is performing input/output operations with large IO unit sizes, it requires high Throughput.</span></span> <span data-ttu-id="a3331-144">Приложения хранилища данных зачастую выдают операции с активным сканированием, которые получают доступ к данным большого объема за раз, и часто выполняют массовые операции.</span><span class="sxs-lookup"><span data-stu-id="a3331-144">Data warehouse applications tend to issue scan intensive operations that access large portions of data at a time and commonly perform bulk operations.</span></span> <span data-ttu-id="a3331-145">Поэтому таким приложениям требуется более высокая пропускная способность.</span><span class="sxs-lookup"><span data-stu-id="a3331-145">In other words, such applications require higher Throughput.</span></span> <span data-ttu-id="a3331-146">Для такого приложения необходимо разрабатывать инфраструктуру с учетом оптимизации пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="a3331-146">If you have such an application, you must design its infrastructure to optimize for Throughput.</span></span> <span data-ttu-id="a3331-147">В следующем разделе подробно рассмотрены показатели, которые необходимо настроить, чтобы достичь этой цели.</span><span class="sxs-lookup"><span data-stu-id="a3331-147">In the next section, we discuss in detail the factors you must tune to achieve this.</span></span>

<span data-ttu-id="a3331-148">При подключении диска хранилища класса «Премиум» к высокомасштабируемой виртуальной машине Azure выполняет подготовку пропускной способности согласно спецификации диска.</span><span class="sxs-lookup"><span data-stu-id="a3331-148">When you attach a premium storage disk to a high scale VM, Azure provisions Throughput as per that disk specification.</span></span> <span data-ttu-id="a3331-149">Например, диск P50 позволяет подготовить пропускную способность диска в 250 МБ в секунду.</span><span class="sxs-lookup"><span data-stu-id="a3331-149">For example, a P50 disk provisions 250 MB per second disk Throughput.</span></span> <span data-ttu-id="a3331-150">Каждая высокомасштабируемая виртуальная машина имеет установленное ограничение по пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="a3331-150">Each high scale VM size also has as specific Throughput limit that it can sustain.</span></span> <span data-ttu-id="a3331-151">Например, максимальная пропускная способность виртуальной машины серии GS5 класса «Стандартный» составляет 2000 МБ в секунду.</span><span class="sxs-lookup"><span data-stu-id="a3331-151">For example, Standard GS5 VM has a maximum throughput of 2,000 MB per second.</span></span> 

<span data-ttu-id="a3331-152">Между пропускной способностью и количеством операций ввода-вывода в секунду существует связь, как показано в следующей формуле.</span><span class="sxs-lookup"><span data-stu-id="a3331-152">There is a relation between Throughput and IOPS as shown in the formula below.</span></span>

![](media/storage-premium-storage-performance/image1.png)

<span data-ttu-id="a3331-153">Поэтому очень важно определить для приложения оптимальные значения пропускной способности и количество операций ввода-вывода в секунду.</span><span class="sxs-lookup"><span data-stu-id="a3331-153">Therefore, it is important to determine the optimal Throughput and IOPS values that your application requires.</span></span> <span data-ttu-id="a3331-154">Оптимизация одного из показателей обязательно повлияет на другой.</span><span class="sxs-lookup"><span data-stu-id="a3331-154">As you try to optimize one, the other also gets affected.</span></span> <span data-ttu-id="a3331-155">В разделе *Оптимизация производительности приложения*более подробно рассмотрена оптимизация операций ввода-вывода и пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="a3331-155">In a later section, *Optimizing Application Performance*, we will discuss in more details about optimizing IOPS and Throughput.</span></span>

## <a name="latency"></a><span data-ttu-id="a3331-156">Задержка</span><span class="sxs-lookup"><span data-stu-id="a3331-156">Latency</span></span>
<span data-ttu-id="a3331-157">Задержка — это время, необходимое приложению, чтобы получить один запрос, отправить его дискам хранилища, а затем отправить ответ клиенту.</span><span class="sxs-lookup"><span data-stu-id="a3331-157">Latency is the time it takes an application to receive a single request, send it to the storage disks and send the response to the client.</span></span> <span data-ttu-id="a3331-158">Наряду с количеством операций ввода-вывода в секунду и пропускной способностью этот показатель является критически важным для производительности приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-158">This is a critical measure of an application's performance in addition to IOPS and Throughput.</span></span> <span data-ttu-id="a3331-159">Задержка на диске хранилища класса «Премиум» — это время, необходимое, чтобы извлечь информацию о запросе и передать ее приложению.</span><span class="sxs-lookup"><span data-stu-id="a3331-159">The Latency of a premium storage disk is the time it takes to retrieve the information for a request and communicate it back to your application.</span></span> <span data-ttu-id="a3331-160">Хранилище класса «Премиум» обеспечивает постоянно низкую задержку.</span><span class="sxs-lookup"><span data-stu-id="a3331-160">Premium Storage provides consistent low latencies.</span></span> <span data-ttu-id="a3331-161">Если включить кэширование узлов со значением ReadOnly на дисках хранилища класса «Премиум», это позволит сократить время задержки чтения.</span><span class="sxs-lookup"><span data-stu-id="a3331-161">If you enable ReadOnly host caching on premium storage disks, you can get much lower read latency.</span></span> <span data-ttu-id="a3331-162">Более подробно кэширование дисков рассмотрено в разделе *Оптимизация производительности приложения*.</span><span class="sxs-lookup"><span data-stu-id="a3331-162">We will discuss Disk Caching in more detail in later section on *Optimizing Application Performance*.</span></span>

<span data-ttu-id="a3331-163">При оптимизации приложения для повышения скорости выполнения операций ввода-вывода и увеличения пропускной способности время задержки приложения также меняется.</span><span class="sxs-lookup"><span data-stu-id="a3331-163">When you are optimizing your application to get higher IOPS and Throughput, it will affect the Latency of your application.</span></span> <span data-ttu-id="a3331-164">После настройки производительности приложения во избежание возникновения высокой задержки всегда оценивайте время задержки.</span><span class="sxs-lookup"><span data-stu-id="a3331-164">After tuning the application performance, always evaluate the Latency of the application to avoid unexpected high latency behavior.</span></span>

## <a name="gather-application-performance-requirements"></a><span data-ttu-id="a3331-165">Сбор требований к производительности приложения</span><span class="sxs-lookup"><span data-stu-id="a3331-165">Gather Application Performance Requirements</span></span>
<span data-ttu-id="a3331-166">Первый шаг при разработке высокопроизводительных приложений, выполняющихся в хранилище Azure класса «Премиум», — понять требования к производительности приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-166">The first step in designing high performance applications running on Azure Premium Storage is, to understand the performance requirements of your application.</span></span> <span data-ttu-id="a3331-167">После сбора этих требований на их основе можно оптимизировать приложение для достижения наиболее оптимальной производительности.</span><span class="sxs-lookup"><span data-stu-id="a3331-167">After you gather performance requirements, you can optimize your application to achieve the most optimal performance.</span></span>

<span data-ttu-id="a3331-168">В предыдущем разделе описаны общие показатели производительности: количество операций ввода-вывода в секунду, пропускная способность и задержка.</span><span class="sxs-lookup"><span data-stu-id="a3331-168">In the previous section, we explained the common performance indicators, IOPS, Throughput and Latency.</span></span> <span data-ttu-id="a3331-169">Чтобы предоставить необходимые возможности для пользователя, нужно определить, какие из этих показателей производительности критически важны для приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-169">You must identify which of these performance indicators are critical to your application to deliver the desired user experience.</span></span> <span data-ttu-id="a3331-170">Например, высокая скорость выполнения операций ввода-вывода наиболее важна для приложений OLTP, обрабатывающих миллионы транзакций в секунду.</span><span class="sxs-lookup"><span data-stu-id="a3331-170">For example, high IOPS matters most to OLTP applications processing millions of transactions in a second.</span></span> <span data-ttu-id="a3331-171">Высокая пропускная способность, в свою очередь, критически важна для приложений хранилища данных, обрабатывающих большие объемы данных в секунду.</span><span class="sxs-lookup"><span data-stu-id="a3331-171">Whereas, high Throughput is critical for Data Warehouse applications processing large amounts of data in a second.</span></span> <span data-ttu-id="a3331-172">Очень низкая задержка имеет решающее значение для приложений, выполняющихся в реальном времени, например веб-сайтов потоковой передачи видео.</span><span class="sxs-lookup"><span data-stu-id="a3331-172">Extremely low Latency is crucial for real-time applications like live video streaming websites.</span></span>

<span data-ttu-id="a3331-173">Затем нужно определить максимальные требования к производительности приложения в течение его времени существования.</span><span class="sxs-lookup"><span data-stu-id="a3331-173">Next, measure the maximum performance requirements of your application throughout its lifetime.</span></span> <span data-ttu-id="a3331-174">В качестве начальной точки используйте пример контрольного списка ниже.</span><span class="sxs-lookup"><span data-stu-id="a3331-174">Use the sample checklist below as a start.</span></span> <span data-ttu-id="a3331-175">Запишите максимальные требования к производительности при стандартной, пиковой рабочей нагрузке и рабочей нагрузке в нерабочее время.</span><span class="sxs-lookup"><span data-stu-id="a3331-175">Record the maximum performance requirements during normal, peak and off-hours workload periods.</span></span> <span data-ttu-id="a3331-176">После определения требований для всех уровней рабочих нагрузок можно задать общее требование к производительности приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-176">By identifying requirements for all workloads levels, you will be able to determine the overall performance requirement of your application.</span></span> <span data-ttu-id="a3331-177">Например, стандартная рабочая нагрузка веб-сайта электронной коммерции — это объем транзакций, обрабатываемых на протяжении большинства дней в году.</span><span class="sxs-lookup"><span data-stu-id="a3331-177">For example, the normal workload of an e-commerce website will be the transactions it serves during most days in a year.</span></span> <span data-ttu-id="a3331-178">Пиковая рабочая нагрузка веб-сайта — это объем транзакций, обрабатываемых во время праздников или специальных периодов продаж.</span><span class="sxs-lookup"><span data-stu-id="a3331-178">The peak workload of the website will be the transactions it serves during holiday season or special sale events.</span></span> <span data-ttu-id="a3331-179">Пиковая рабочая нагрузка обычно наблюдается в течение ограниченного периода. Однако приложению при этом может потребоваться выполнять в несколько раз больше операций, чем в обычном режиме.</span><span class="sxs-lookup"><span data-stu-id="a3331-179">The peak workload is typically experienced for a limited period, but can require your application to scale two or more times its normal operation.</span></span> <span data-ttu-id="a3331-180">Узнайте значения показателей для 50-го, 90-го и 99-го процентилей.</span><span class="sxs-lookup"><span data-stu-id="a3331-180">Find out the 50 percentile, 90 percentile and 99 percentile requirements.</span></span> <span data-ttu-id="a3331-181">Таким образом можно отфильтровать все выбросы в требованиях к производительности и сосредоточиться на оптимизации на основе правильных значений.</span><span class="sxs-lookup"><span data-stu-id="a3331-181">This helps filter out any outliers in the performance requirements and you can focus your efforts on optimizing for the right values.</span></span>

<span data-ttu-id="a3331-182">**Контрольный список требований к производительности приложения**</span><span class="sxs-lookup"><span data-stu-id="a3331-182">**Application Performance Requirements Checklist**</span></span>

| <span data-ttu-id="a3331-183">**Требования к производительности**</span><span class="sxs-lookup"><span data-stu-id="a3331-183">**Performance requirements**</span></span> | <span data-ttu-id="a3331-184">**50-й процентиль**</span><span class="sxs-lookup"><span data-stu-id="a3331-184">**50 Percentile**</span></span> | <span data-ttu-id="a3331-185">**90-й процентиль**</span><span class="sxs-lookup"><span data-stu-id="a3331-185">**90 Percentile**</span></span> | <span data-ttu-id="a3331-186">**99-й процентиль**</span><span class="sxs-lookup"><span data-stu-id="a3331-186">**99  Percentile**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="a3331-187">Макс.</span><span class="sxs-lookup"><span data-stu-id="a3331-187">Max.</span></span> <span data-ttu-id="a3331-188">Транзакций в секунду</span><span class="sxs-lookup"><span data-stu-id="a3331-188">Transactions per second</span></span> | | | |
| <span data-ttu-id="a3331-189">Операции чтения, %</span><span class="sxs-lookup"><span data-stu-id="a3331-189">% Read operations</span></span> | | | |
| <span data-ttu-id="a3331-190">Операции записи, %</span><span class="sxs-lookup"><span data-stu-id="a3331-190">% Write operations</span></span> | | | |
| <span data-ttu-id="a3331-191">Случайные операции, %</span><span class="sxs-lookup"><span data-stu-id="a3331-191">% Random operations</span></span> | | | |
| <span data-ttu-id="a3331-192">Последовательные операции, %</span><span class="sxs-lookup"><span data-stu-id="a3331-192">% Sequential operations</span></span> | | | |
| <span data-ttu-id="a3331-193">Размер запроса ввода-вывода</span><span class="sxs-lookup"><span data-stu-id="a3331-193">IO request size</span></span> | | | |
| <span data-ttu-id="a3331-194">Средняя пропускная способность</span><span class="sxs-lookup"><span data-stu-id="a3331-194">Average Throughput</span></span> | | | |
| <span data-ttu-id="a3331-195">Макс.</span><span class="sxs-lookup"><span data-stu-id="a3331-195">Max.</span></span> <span data-ttu-id="a3331-196">Пропускная способность</span><span class="sxs-lookup"><span data-stu-id="a3331-196">Throughput</span></span> | | | |
| <span data-ttu-id="a3331-197">Мин.</span><span class="sxs-lookup"><span data-stu-id="a3331-197">Min.</span></span> <span data-ttu-id="a3331-198">Задержка</span><span class="sxs-lookup"><span data-stu-id="a3331-198">Latency</span></span> | | | |
| <span data-ttu-id="a3331-199">Среднее время задержки</span><span class="sxs-lookup"><span data-stu-id="a3331-199">Average Latency</span></span> | | | |
| <span data-ttu-id="a3331-200">Макс.</span><span class="sxs-lookup"><span data-stu-id="a3331-200">Max.</span></span> <span data-ttu-id="a3331-201">ЦП</span><span class="sxs-lookup"><span data-stu-id="a3331-201">CPU</span></span> | | | |
| <span data-ttu-id="a3331-202">Средняя загрузка ЦП</span><span class="sxs-lookup"><span data-stu-id="a3331-202">Average CPU</span></span> | | | |
| <span data-ttu-id="a3331-203">Макс.</span><span class="sxs-lookup"><span data-stu-id="a3331-203">Max.</span></span> <span data-ttu-id="a3331-204">Память</span><span class="sxs-lookup"><span data-stu-id="a3331-204">Memory</span></span> | | | |
| <span data-ttu-id="a3331-205">Среднее использование памяти</span><span class="sxs-lookup"><span data-stu-id="a3331-205">Average Memory</span></span> | | | |
| <span data-ttu-id="a3331-206">Длина очереди</span><span class="sxs-lookup"><span data-stu-id="a3331-206">Queue Depth</span></span> | | | |

> [!NOTE]
> <span data-ttu-id="a3331-207">Эти показатели следует регулировать в зависимости от ожидаемого в будущем роста приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-207">You should consider scaling these numbers based on expected future growth of your application.</span></span> <span data-ttu-id="a3331-208">Рекомендуем подготовиться к росту приложения заранее, так как изменить инфраструктуру для повышения производительности позже будет сложнее.</span><span class="sxs-lookup"><span data-stu-id="a3331-208">It is a good idea to plan for growth ahead of time, because it could be harder to change the infrastructure for improving performance later.</span></span>
>
>

<span data-ttu-id="a3331-209">Если требуется перейти от существующего приложения к хранилищу класса «Премиум», сначала заполните контрольный список выше для существующего приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-209">If you have an existing application and want to move to Premium Storage, first build the checklist above for the existing application.</span></span> <span data-ttu-id="a3331-210">Затем создайте прототип приложения в хранилище класса «Премиум» и разработайте приложение в соответствии с рекомендациями, приведенными в разделе *Оптимизация производительности приложения* ниже.</span><span class="sxs-lookup"><span data-stu-id="a3331-210">Then, build a prototype of your application on Premium Storage and design the application based on guidelines described in *Optimizing Application Performance* in a later section of this document.</span></span> <span data-ttu-id="a3331-211">В следующем разделе описываются инструменты для сбора информации о показателях производительности.</span><span class="sxs-lookup"><span data-stu-id="a3331-211">The next section describes the tools you can use to gather the performance measurements.</span></span>

<span data-ttu-id="a3331-212">Создайте для прототипа такой же контрольный список, как для существующего приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-212">Create a checklist similar to your existing application for the prototype.</span></span> <span data-ttu-id="a3331-213">С помощью инструментов тестирования производительности можно смоделировать рабочую нагрузку и измерить производительность прототипа приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-213">Using Benchmarking tools you can simulate the workloads and measure performance on the prototype application.</span></span> <span data-ttu-id="a3331-214">Дополнительные сведения см. в разделе [Измерение производительности](#benchmarking).</span><span class="sxs-lookup"><span data-stu-id="a3331-214">See the section on [Benchmarking](#benchmarking) to learn more.</span></span> <span data-ttu-id="a3331-215">В результате вы сможете определить, может ли хранилище класса «Премиум» соответствовать требованиям к производительности приложения или превзойти их.</span><span class="sxs-lookup"><span data-stu-id="a3331-215">By doing so you can determine whether Premium Storage can match or surpass your application performance requirements.</span></span> <span data-ttu-id="a3331-216">Затем те же указания можно применить и для рабочего приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-216">Then you can implement the same guidelines for your production application.</span></span>

### <a name="counters-to-measure-application-performance-requirements"></a><span data-ttu-id="a3331-217">Счетчики для оценки требований к производительности приложения</span><span class="sxs-lookup"><span data-stu-id="a3331-217">Counters to measure application performance requirements</span></span>
<span data-ttu-id="a3331-218">Оптимальным способом оценки требований к производительности приложения являются инструменты мониторинга производительности, содержащиеся в операционной системе сервера.</span><span class="sxs-lookup"><span data-stu-id="a3331-218">The best way to measure performance requirements of your application, is to use performance-monitoring tools provided by the operating system of the server.</span></span> <span data-ttu-id="a3331-219">Можно использовать PerfMon для Windows и iostat для Linux.</span><span class="sxs-lookup"><span data-stu-id="a3331-219">You can use PerfMon for Windows and iostat for Linux.</span></span> <span data-ttu-id="a3331-220">Эти инструменты собирают данные со счетчиков по каждому показателю, описанному в предыдущем разделе.</span><span class="sxs-lookup"><span data-stu-id="a3331-220">These tools capture counters corresponding to each measure explained in the above section.</span></span> <span data-ttu-id="a3331-221">Следует записывать значения этих счетчиков для приложения при стандартной, пиковой рабочей нагрузке и рабочей нагрузке в нерабочее время.</span><span class="sxs-lookup"><span data-stu-id="a3331-221">You must capture the values of these counters when your application is running its normal, peak and off-hours workloads.</span></span>

<span data-ttu-id="a3331-222">Доступны счетчики PerfMon для процессора, памяти и каждого логического и физического диска сервера.</span><span class="sxs-lookup"><span data-stu-id="a3331-222">The PerfMon counters are available for processor, memory and, each logical disk and physical disk of your server.</span></span> <span data-ttu-id="a3331-223">При использовании дисков хранилища класса «Премиум» в виртуальной машине счетчики физических дисков собирают данные с каждого диска хранилища, а счетчики логических дисков — с каждого тома, созданного на диске хранилища.</span><span class="sxs-lookup"><span data-stu-id="a3331-223">When you use premium storage disks with a VM, the physical disk counters are for each premium storage disk, and logical disk counters are for each volume created on the premium storage disks.</span></span> <span data-ttu-id="a3331-224">Необходимо записывать значения для дисков, на которых выполняется рабочая нагрузка приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-224">You must capture the values for the disks that host your application workload.</span></span> <span data-ttu-id="a3331-225">Если логические и физические диски сопоставляются по типу «один к одному», нужно рассматривать значения счетчиков физических дисков. В противном случае следует обращать внимание на значения счетчиков логических дисков.</span><span class="sxs-lookup"><span data-stu-id="a3331-225">If there is a one to one mapping between logical and physical disks, you can refer to physical disk counters; otherwise refer to the logical disk counters.</span></span> <span data-ttu-id="a3331-226">В Linux при выполнении команды iostat создается отчет об использовании ЦП и дискового пространства.</span><span class="sxs-lookup"><span data-stu-id="a3331-226">On Linux, the iostat command generates a CPU and disk utilization report.</span></span> <span data-ttu-id="a3331-227">В отчете об использовании дискового пространства содержатся статистические данные для каждого физического устройства или раздела.</span><span class="sxs-lookup"><span data-stu-id="a3331-227">The disk utilization report provides statistics per physical device or partition.</span></span> <span data-ttu-id="a3331-228">Если данные и журнал сервера базы данных расположены на разных дисках, нужно собрать данные для обоих дисков.</span><span class="sxs-lookup"><span data-stu-id="a3331-228">If you have a database server with its data and log on separate disks, collect this data for both disks.</span></span> <span data-ttu-id="a3331-229">В таблице ниже приведены счетчики для дисков, процессора и памяти.</span><span class="sxs-lookup"><span data-stu-id="a3331-229">Below table describes counters for disks, processor and memory:</span></span>

| <span data-ttu-id="a3331-230">Счетчик</span><span class="sxs-lookup"><span data-stu-id="a3331-230">Counter</span></span> | <span data-ttu-id="a3331-231">Описание</span><span class="sxs-lookup"><span data-stu-id="a3331-231">Description</span></span> | <span data-ttu-id="a3331-232">PerfMon</span><span class="sxs-lookup"><span data-stu-id="a3331-232">PerfMon</span></span> | <span data-ttu-id="a3331-233">iostat</span><span class="sxs-lookup"><span data-stu-id="a3331-233">Iostat</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="a3331-234">**Количество операций ввода-вывода или транзакций в секунду**</span><span class="sxs-lookup"><span data-stu-id="a3331-234">**IOPS or Transactions per second**</span></span> |<span data-ttu-id="a3331-235">Количество запросов ввода-вывода, выдаваемых диску хранилища в секунду.</span><span class="sxs-lookup"><span data-stu-id="a3331-235">Number of I/O requests issued to the storage disk per second.</span></span> |<span data-ttu-id="a3331-236">Операций чтения с диска в секунду </span><span class="sxs-lookup"><span data-stu-id="a3331-236">Disk Reads/sec</span></span> <br> <span data-ttu-id="a3331-237">Операций записи на диск в секунду</span><span class="sxs-lookup"><span data-stu-id="a3331-237">Disk Writes/sec</span></span> |<span data-ttu-id="a3331-238">tps </span><span class="sxs-lookup"><span data-stu-id="a3331-238">tps</span></span> <br> <span data-ttu-id="a3331-239">r/s </span><span class="sxs-lookup"><span data-stu-id="a3331-239">r/s</span></span> <br> <span data-ttu-id="a3331-240">w/s</span><span class="sxs-lookup"><span data-stu-id="a3331-240">w/s</span></span> |
| <span data-ttu-id="a3331-241">**Количество операций чтения и записи на диске**</span><span class="sxs-lookup"><span data-stu-id="a3331-241">**Disk Reads and Writes**</span></span> |<span data-ttu-id="a3331-242">Процент операций чтения и записи, выполняемых на диске.</span><span class="sxs-lookup"><span data-stu-id="a3331-242">% of Reads and Write operations performed on the disk.</span></span> |<span data-ttu-id="a3331-243">Процент активности диска при чтении </span><span class="sxs-lookup"><span data-stu-id="a3331-243">% Disk Read Time</span></span> <br> <span data-ttu-id="a3331-244">Процент активности диска при записи</span><span class="sxs-lookup"><span data-stu-id="a3331-244">% Disk Write Time</span></span> |<span data-ttu-id="a3331-245">r/s </span><span class="sxs-lookup"><span data-stu-id="a3331-245">r/s</span></span> <br> <span data-ttu-id="a3331-246">w/s</span><span class="sxs-lookup"><span data-stu-id="a3331-246">w/s</span></span> |
| <span data-ttu-id="a3331-247">**Пропускная способность**</span><span class="sxs-lookup"><span data-stu-id="a3331-247">**Throughput**</span></span> |<span data-ttu-id="a3331-248">Объем данных, считываемых с диска или записываемых на диск в секунду.</span><span class="sxs-lookup"><span data-stu-id="a3331-248">Amount of data read from or written to the disk per second.</span></span> |<span data-ttu-id="a3331-249">Скорость чтения с диска (байт/с) </span><span class="sxs-lookup"><span data-stu-id="a3331-249">Disk Read Bytes/sec</span></span> <br> <span data-ttu-id="a3331-250">Скорость записи на диск (байт/с)</span><span class="sxs-lookup"><span data-stu-id="a3331-250">Disk Write Bytes/sec</span></span> |<span data-ttu-id="a3331-251">КБ/с прочитано</span><span class="sxs-lookup"><span data-stu-id="a3331-251">kB_read/s</span></span> <br> <span data-ttu-id="a3331-252">КБ/с записано</span><span class="sxs-lookup"><span data-stu-id="a3331-252">kB_wrtn/s</span></span> |
| <span data-ttu-id="a3331-253">**Задержка**</span><span class="sxs-lookup"><span data-stu-id="a3331-253">**Latency**</span></span> |<span data-ttu-id="a3331-254">Общее время завершения запроса ввода-вывода на диске.</span><span class="sxs-lookup"><span data-stu-id="a3331-254">Total time to complete a disk IO request.</span></span> |<span data-ttu-id="a3331-255">Средняя скорость чтения с диска в секунду </span><span class="sxs-lookup"><span data-stu-id="a3331-255">Average Disk sec/Read</span></span> <br> <span data-ttu-id="a3331-256">Средняя скорость записи на диск в секунду</span><span class="sxs-lookup"><span data-stu-id="a3331-256">Average disk sec/Write</span></span> |<span data-ttu-id="a3331-257">await </span><span class="sxs-lookup"><span data-stu-id="a3331-257">await</span></span> <br> <span data-ttu-id="a3331-258">svctm</span><span class="sxs-lookup"><span data-stu-id="a3331-258">svctm</span></span> |
| <span data-ttu-id="a3331-259">**Объем ввода-вывода**</span><span class="sxs-lookup"><span data-stu-id="a3331-259">**IO size**</span></span> |<span data-ttu-id="a3331-260">Объем запросов ввода-вывода, выданных дискам хранилища.</span><span class="sxs-lookup"><span data-stu-id="a3331-260">The size of I/O requests issues to the storage disks.</span></span> |<span data-ttu-id="a3331-261">Средняя скорость чтения с диска (байт/с) </span><span class="sxs-lookup"><span data-stu-id="a3331-261">Average Disk Bytes/Read</span></span> <br> <span data-ttu-id="a3331-262">Средняя скорость записи на диск (байт/с)</span><span class="sxs-lookup"><span data-stu-id="a3331-262">Average Disk Bytes/Write</span></span> |<span data-ttu-id="a3331-263">avgrq-sz</span><span class="sxs-lookup"><span data-stu-id="a3331-263">avgrq-sz</span></span> |
| <span data-ttu-id="a3331-264">**Длина очереди**</span><span class="sxs-lookup"><span data-stu-id="a3331-264">**Queue Depth**</span></span> |<span data-ttu-id="a3331-265">Количество необработанных запросов ввода-вывода, ожидающих чтения с диска хранилища или записи на диск хранилища.</span><span class="sxs-lookup"><span data-stu-id="a3331-265">Number of outstanding I/O requests waiting to be read form or written to the storage disk.</span></span> |<span data-ttu-id="a3331-266">Текущая длина очереди диска</span><span class="sxs-lookup"><span data-stu-id="a3331-266">Current Disk Queue Length</span></span> |<span data-ttu-id="a3331-267">avgqu-sz</span><span class="sxs-lookup"><span data-stu-id="a3331-267">avgqu-sz</span></span> |
| <span data-ttu-id="a3331-268">**Макс. Память**</span><span class="sxs-lookup"><span data-stu-id="a3331-268">**Max. Memory**</span></span> |<span data-ttu-id="a3331-269">Объем памяти, необходимый для стабильной работы приложения</span><span class="sxs-lookup"><span data-stu-id="a3331-269">Amount of memory required to run application smoothly</span></span> |<span data-ttu-id="a3331-270">Использование выделенной памяти (в байтах), %</span><span class="sxs-lookup"><span data-stu-id="a3331-270">% Committed Bytes in Use</span></span> |<span data-ttu-id="a3331-271">Использование vmstat</span><span class="sxs-lookup"><span data-stu-id="a3331-271">Use vmstat</span></span> |
| <span data-ttu-id="a3331-272">**Макс. ЦП**</span><span class="sxs-lookup"><span data-stu-id="a3331-272">**Max. CPU**</span></span> |<span data-ttu-id="a3331-273">Объем ЦП, необходимый для стабильной работы приложения</span><span class="sxs-lookup"><span data-stu-id="a3331-273">Amount CPU required to run application smoothly</span></span> |<span data-ttu-id="a3331-274">Загруженность процессора, %</span><span class="sxs-lookup"><span data-stu-id="a3331-274">% Processor time</span></span> |<span data-ttu-id="a3331-275">%util</span><span class="sxs-lookup"><span data-stu-id="a3331-275">%util</span></span> |

<span data-ttu-id="a3331-276">См. дополнительные сведения об [iostat](http://linuxcommand.org/man_pages/iostat1.html) и [PerfMon](https://msdn.microsoft.com/library/aa645516.aspx).</span><span class="sxs-lookup"><span data-stu-id="a3331-276">Learn more about [iostat](http://linuxcommand.org/man_pages/iostat1.html) and [PerfMon](https://msdn.microsoft.com/library/aa645516.aspx).</span></span>

## <a name="optimizing-application-performance"></a><span data-ttu-id="a3331-277">Оптимизация производительности приложения</span><span class="sxs-lookup"><span data-stu-id="a3331-277">Optimizing Application Performance</span></span>
<span data-ttu-id="a3331-278">Основные факторы, влияющие на производительность приложения, выполняющегося в хранилище класса «Премиум», — характер запросов ввода-вывода, размер виртуальной машины, размер диска, количество дисков, кэширование диска, многопоточность и длина очереди.</span><span class="sxs-lookup"><span data-stu-id="a3331-278">The main factors that influence performance of an application running on Premium Storage are Nature of IO Requests, VM size, Disk size, Number of disks, Disk Caching, Multithreading and Queue Depth.</span></span> <span data-ttu-id="a3331-279">Некоторыми из этих факторов можно управлять с помощью средств, предоставляемых системой.</span><span class="sxs-lookup"><span data-stu-id="a3331-279">You can control some of these factors with knobs provided by the system.</span></span> <span data-ttu-id="a3331-280">В большинстве приложений не предусмотрена возможность изменения объема операций ввода-вывода и длины очереди напрямую.</span><span class="sxs-lookup"><span data-stu-id="a3331-280">Most applications may not give you an option to alter the IO size and Queue Depth directly.</span></span> <span data-ttu-id="a3331-281">Например, при использовании SQL Server нельзя выбрать значения этих показателей.</span><span class="sxs-lookup"><span data-stu-id="a3331-281">For example, if you are using SQL Server, you cannot choose the IO size and queue depth.</span></span> <span data-ttu-id="a3331-282">SQL Server выбирает оптимальные значения объема операций ввода-вывода и длины очереди для получения лучшей производительности.</span><span class="sxs-lookup"><span data-stu-id="a3331-282">SQL Server chooses the optimal IO size and queue depth values to get the most performance.</span></span> <span data-ttu-id="a3331-283">Важно понимать, какое влияние оба показателя оказывают на производительность приложения, чтобы выделить объем ресурсов в соответствии с потребностями в производительности.</span><span class="sxs-lookup"><span data-stu-id="a3331-283">It is important to understand the effects of both types of factors on your application performance, so that you can provision appropriate resources to meet performance needs.</span></span>

<span data-ttu-id="a3331-284">Определить нужный уровень оптимизации производительности приложения можно с помощью созданного ранее контрольного списка требований приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-284">Throughout this section, refer to the application requirements checklist that you created, to identify how much you need to optimize your application performance.</span></span> <span data-ttu-id="a3331-285">Исходя из этого, можно определить, какие показатели из этого раздела необходимо настроить.</span><span class="sxs-lookup"><span data-stu-id="a3331-285">Based on that, you will be able to determine which factors from this section you will need to tune.</span></span> <span data-ttu-id="a3331-286">Чтобы убедиться во влиянии каждого из показателей на производительность приложения, запустите инструменты тестирования производительности на установленном приложении.</span><span class="sxs-lookup"><span data-stu-id="a3331-286">To witness the effects of each factor on your application performance, run benchmarking tools on your application setup.</span></span> <span data-ttu-id="a3331-287">Шаги, необходимые для запуска общих инструментов тестирования производительности в виртуальных машинах Windows и Linux, см. в разделе [Измерение производительности](#Benchmarking) в конце этой статьи.</span><span class="sxs-lookup"><span data-stu-id="a3331-287">Refer to the [Benchmarking](#Benchmarking) section at the end of this article for steps to run common benchmarking tools on Windows and Linux VMs.</span></span>

### <a name="optimizing-iops-throughput-and-latency-at-a-glance"></a><span data-ttu-id="a3331-288">Краткий обзор оптимизации выполнения операций ввода-вывода, пропускной способности и задержки</span><span class="sxs-lookup"><span data-stu-id="a3331-288">Optimizing IOPS, Throughput and Latency at a glance</span></span>
<span data-ttu-id="a3331-289">В таблице ниже приведена сводка всех показателей производительности и шагов, необходимых для оптимизации выполнения операций ввода-вывода, пропускной способности и задержки.</span><span class="sxs-lookup"><span data-stu-id="a3331-289">The table below summarizes all the performance factors and the steps to optimize IOPS, Throughput and Latency.</span></span> <span data-ttu-id="a3331-290">В следующих разделах более подробно описан каждый из показателей.</span><span class="sxs-lookup"><span data-stu-id="a3331-290">The sections following this summary will describe each factor is much more depth.</span></span>

| &nbsp; | <span data-ttu-id="a3331-291">**ОПЕРАЦИЙ ВВОДА-ВЫВОДА**</span><span class="sxs-lookup"><span data-stu-id="a3331-291">**IOPS**</span></span> | <span data-ttu-id="a3331-292">**Пропускная способность**</span><span class="sxs-lookup"><span data-stu-id="a3331-292">**Throughput**</span></span> | <span data-ttu-id="a3331-293">**Задержка**</span><span class="sxs-lookup"><span data-stu-id="a3331-293">**Latency**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="a3331-294">**Пример сценария**</span><span class="sxs-lookup"><span data-stu-id="a3331-294">**Example Scenario**</span></span> |<span data-ttu-id="a3331-295">Корпоративное приложение OLTP, которому требуется высокая скорость выполнения транзакций в секунду.</span><span class="sxs-lookup"><span data-stu-id="a3331-295">Enterprise OLTP application requiring very high transactions per second rate.</span></span> |<span data-ttu-id="a3331-296">Корпоративное приложение хранилища данных, обрабатывающее большие объемы данных.</span><span class="sxs-lookup"><span data-stu-id="a3331-296">Enterprise Data warehousing application processing large amounts of data.</span></span> |<span data-ttu-id="a3331-297">Приложения, которые выполняются практически в реальном времени и требуют мгновенных ответов на запросы пользователей, например игры в сети.</span><span class="sxs-lookup"><span data-stu-id="a3331-297">Near real-time applications requiring instant responses to user requests, like online gaming.</span></span> |
| <span data-ttu-id="a3331-298">Факторы производительности</span><span class="sxs-lookup"><span data-stu-id="a3331-298">Performance factors</span></span> | &nbsp; | &nbsp; | &nbsp; |
| <span data-ttu-id="a3331-299">**Объем ввода-вывода**</span><span class="sxs-lookup"><span data-stu-id="a3331-299">**IO size**</span></span> |<span data-ttu-id="a3331-300">Меньший объем ввода-вывода обеспечивает более высокую скорость выполнения операций ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="a3331-300">Smaller IO size yields higher IOPS.</span></span> |<span data-ttu-id="a3331-301">Больший объем ввода-вывода обеспечивает более высокую пропускную способность.</span><span class="sxs-lookup"><span data-stu-id="a3331-301">Larger IO size to yields higher Throughput.</span></span> | &nbsp;|
| <span data-ttu-id="a3331-302">**Размер виртуальной машины**</span><span class="sxs-lookup"><span data-stu-id="a3331-302">**VM size**</span></span> |<span data-ttu-id="a3331-303">Используйте размер виртуальной машины, который обеспечивает более высокую скорость выполнения операций ввода-вывода, чем указано в требованиях приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-303">Use a VM size that offers IOPS greater than your application requirement.</span></span> <span data-ttu-id="a3331-304">См. размеры виртуальных машин и их ограничения скорости выполнения операций ввода-вывода здесь.</span><span class="sxs-lookup"><span data-stu-id="a3331-304">See VM sizes and their IOPS limits here.</span></span> |<span data-ttu-id="a3331-305">Используйте размер виртуальной машины с большей пропускной способностью, чем требует приложение.</span><span class="sxs-lookup"><span data-stu-id="a3331-305">Use a VM size with Throughput limit greater than your application requirement.</span></span> <span data-ttu-id="a3331-306">См. размеры виртуальных машин и их ограничения пропускной способности здесь.</span><span class="sxs-lookup"><span data-stu-id="a3331-306">See VM sizes and their Throughput limits here.</span></span> |<span data-ttu-id="a3331-307">Используйте размер виртуальной машины с более широкими пределами масштабируемости, чем требует приложение.</span><span class="sxs-lookup"><span data-stu-id="a3331-307">Use a VM size that offers scale limits greater than your application requirement.</span></span> <span data-ttu-id="a3331-308">См. размеры виртуальных машин и их ограничения здесь.</span><span class="sxs-lookup"><span data-stu-id="a3331-308">See VM sizes and their limits here.</span></span> |
| <span data-ttu-id="a3331-309">**Размер диска**</span><span class="sxs-lookup"><span data-stu-id="a3331-309">**Disk size**</span></span> |<span data-ttu-id="a3331-310">Используйте размер диска, который обеспечивает более высокую скорость выполнения операций ввода-вывода, чем требует приложение.</span><span class="sxs-lookup"><span data-stu-id="a3331-310">Use a disk size that offers IOPS greater than your application requirement.</span></span> <span data-ttu-id="a3331-311">См. размеры дисков и их ограничения скорости выполнения операций ввода-вывода здесь.</span><span class="sxs-lookup"><span data-stu-id="a3331-311">See disk sizes and their IOPS limits here.</span></span> |<span data-ttu-id="a3331-312">Используйте размер диска с более высокой пропускной способностью, чем требует приложение.</span><span class="sxs-lookup"><span data-stu-id="a3331-312">Use a disk size with Throughput limit greater than your application requirement.</span></span> <span data-ttu-id="a3331-313">См. размеры дисков и их ограничения пропускной способности здесь.</span><span class="sxs-lookup"><span data-stu-id="a3331-313">See disk sizes and their Throughput limits here.</span></span> |<span data-ttu-id="a3331-314">Используйте размер диска с более широкими пределами масштабируемости, чем требует приложение.</span><span class="sxs-lookup"><span data-stu-id="a3331-314">Use a disk size that offers scale limits greater than your application requirement.</span></span> <span data-ttu-id="a3331-315">См. размеры дисков и их ограничения здесь.</span><span class="sxs-lookup"><span data-stu-id="a3331-315">See disk sizes and their limits here.</span></span> |
| <span data-ttu-id="a3331-316">**Ограничения масштабируемости виртуальной машины и диска**</span><span class="sxs-lookup"><span data-stu-id="a3331-316">**VM and Disk Scale Limits**</span></span> |<span data-ttu-id="a3331-317">Ограничение количества операций ввода-вывода в секунду для выбранного размера виртуальной машины должно быть больше общего количества операций ввода-вывода в секунду, выполняемых на дисках хранилища класса «Премиум», подключенных к виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="a3331-317">IOPS limit of the VM size chosen should be greater than total IOPS driven by premium storage disks attached to it.</span></span> |<span data-ttu-id="a3331-318">Ограничение пропускной способности для выбранного размера виртуальной машины должно быть больше общей пропускной способности дисков хранилища класса «Премиум», подключенных к виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="a3331-318">Throughput limit of the VM size chosen should be greater than total Throughput driven by premium storage disks attached to it.</span></span> |<span data-ttu-id="a3331-319">Ограничение масштабируемости для выбранного размера виртуальной машины должно быть больше общего ограничения масштабируемости подключенных дисков хранилища класса «Премиум».</span><span class="sxs-lookup"><span data-stu-id="a3331-319">Scale limits of the VM size chosen must be greater than total scale limits of attached premium storage disks.</span></span> |
| <span data-ttu-id="a3331-320">**Кэширование диска**</span><span class="sxs-lookup"><span data-stu-id="a3331-320">**Disk Caching**</span></span> |<span data-ttu-id="a3331-321">Включите кэш со значением ReadOnly на дисках хранилища класса «Премиум» с большим объемом операций чтения, чтобы повысить скорость выполнения операций ввода-вывода при чтении.</span><span class="sxs-lookup"><span data-stu-id="a3331-321">Enable ReadOnly Cache on premium storage disks with Read heavy operations to get higher Read IOPS.</span></span> | &nbsp; |<span data-ttu-id="a3331-322">Включите кэш со значением ReadOnly на дисках хранилища класса «Премиум» с большим объемом операций чтения, чтобы сократить время задержки при чтении до минимума.</span><span class="sxs-lookup"><span data-stu-id="a3331-322">Enable ReadOnly Cache on premium storage disks with Ready heavy operations to get very low Read latencies.</span></span> |
| <span data-ttu-id="a3331-323">**Чередование дисков**</span><span class="sxs-lookup"><span data-stu-id="a3331-323">**Disk Striping**</span></span> |<span data-ttu-id="a3331-324">Используйте несколько дисков и чередуйте их, чтобы повысить общее ограничение количества операций ввода-вывода и пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="a3331-324">Use multiple disks and stripe them together to get a combined higher IOPS and Throughput limit.</span></span> <span data-ttu-id="a3331-325">Обратите внимание, что общее ограничение для каждой виртуальной машины должно быть больше, чем общие ограничения подключенных дисков «Премиум».</span><span class="sxs-lookup"><span data-stu-id="a3331-325">Note that the combined limit per VM should be higher than the combined limits of attached premium disks.</span></span> | &nbsp; | &nbsp; |
| <span data-ttu-id="a3331-326">**Размер блока чередования**</span><span class="sxs-lookup"><span data-stu-id="a3331-326">**Stripe Size**</span></span> |<span data-ttu-id="a3331-327">Меньший размер блока чередования для случайных небольших запросов ввода-вывода в приложениях OLTP.</span><span class="sxs-lookup"><span data-stu-id="a3331-327">Smaller stripe size for random small IO pattern seen in OLTP applications.</span></span> <span data-ttu-id="a3331-328">Например, для приложения OLTP SQL Server можно использовать блок чередования на 64 КБ.</span><span class="sxs-lookup"><span data-stu-id="a3331-328">E.g., use stripe size of 64KB for SQL Server OLTP application.</span></span> |<span data-ttu-id="a3331-329">Больший размер блока чередования для последовательных объемных запросов ввода-вывода в приложениях хранилища данных.</span><span class="sxs-lookup"><span data-stu-id="a3331-329">Larger stripe size for sequential large IO pattern seen in Data Warehouse applications.</span></span> <span data-ttu-id="a3331-330">Например, для приложения хранилища данных SQL Server можно использовать блок чередования на 256 КБ.</span><span class="sxs-lookup"><span data-stu-id="a3331-330">E.g., use 256KB stripe size for SQL Server Data warehouse application.</span></span> | &nbsp; |
| <span data-ttu-id="a3331-331">**Многопоточность**</span><span class="sxs-lookup"><span data-stu-id="a3331-331">**Multithreading**</span></span> |<span data-ttu-id="a3331-332">Используйте многопоточность для передачи большего количества запросов хранилищу класса «Премиум». Это позволит увеличить скорость выполнения операций ввода-вывода и повысить пропускную способность.</span><span class="sxs-lookup"><span data-stu-id="a3331-332">Use multithreading to push higher number of requests to Premium Storage that will lead to higher IOPS and Throughput.</span></span> <span data-ttu-id="a3331-333">Например, укажите наибольшее значение для параметра MAXDOP на сервере SQL Server, чтобы выделить дополнительные ЦП для SQL Server.</span><span class="sxs-lookup"><span data-stu-id="a3331-333">For example, on SQL Server set a high MAXDOP value to allocate more CPUs to SQL Server.</span></span> | &nbsp; | &nbsp; |
| <span data-ttu-id="a3331-334">**Длина очереди**</span><span class="sxs-lookup"><span data-stu-id="a3331-334">**Queue Depth**</span></span> |<span data-ttu-id="a3331-335">Более длинная очередь обеспечивает более высокую скорость выполнения операций ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="a3331-335">Larger Queue Depth yields higher IOPS.</span></span> |<span data-ttu-id="a3331-336">Более длинная очередь обеспечивает более высокую пропускную способность.</span><span class="sxs-lookup"><span data-stu-id="a3331-336">Larger Queue Depth yields higher Throughput.</span></span> |<span data-ttu-id="a3331-337">Более короткая очередь сокращает время задержки.</span><span class="sxs-lookup"><span data-stu-id="a3331-337">Smaller Queue Depth yields lower latencies.</span></span> |

## <a name="nature-of-io-requests"></a><span data-ttu-id="a3331-338">Характер запросов ввода-вывода</span><span class="sxs-lookup"><span data-stu-id="a3331-338">Nature of IO Requests</span></span>
<span data-ttu-id="a3331-339">Запрос ввода-вывода — это единица операции ввода-вывода, которую будет выполнять приложение.</span><span class="sxs-lookup"><span data-stu-id="a3331-339">An IO request is a unit of input/output operation that your application will be performing.</span></span> <span data-ttu-id="a3331-340">Определив характер запроса ввода-вывода (случайный или последовательный, чтение или запись, большого или небольшого размера), можно определить требования к производительности приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-340">Identifying the nature of IO requests, random or sequential, read or write, small or large, will help you determine the performance requirements of your application.</span></span> <span data-ttu-id="a3331-341">Очень важно понимать характер запросов ввода-вывода для принятия правильных решений при разработке инфраструктуры приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-341">It is very important to understand the nature of IO requests, to make the right decisions when designing your application infrastructure.</span></span>

<span data-ttu-id="a3331-342">Один из наиболее важных факторов — объем ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="a3331-342">IO size is one of the more important factors.</span></span> <span data-ttu-id="a3331-343">Это объем запроса на операцию ввода-вывода, созданного приложением.</span><span class="sxs-lookup"><span data-stu-id="a3331-343">The IO size is the size of the input/output operation request generated by your application.</span></span> <span data-ttu-id="a3331-344">Объем ввода-вывода оказывает существенное влияние на производительность, особенно на показатели количества операций ввода-вывода и пропускной способности, которых может достигнуть приложение.</span><span class="sxs-lookup"><span data-stu-id="a3331-344">The IO size has a significant impact on performance especially on the IOPS and Bandwidth that the application is able to achieve.</span></span> <span data-ttu-id="a3331-345">Следующая формула демонстрирует взаимосвязь между количеством операций ввода-вывода в секунду, объемом ввода-вывода и пропускной способностью.</span><span class="sxs-lookup"><span data-stu-id="a3331-345">The following formula shows the relationship between IOPS, IO size and Bandwidth/Throughput.</span></span>  
    ![](media/storage-premium-storage-performance/image1.png)

<span data-ttu-id="a3331-346">В одних приложениях можно изменять объем ввода-вывода, а в других — нет.</span><span class="sxs-lookup"><span data-stu-id="a3331-346">Some applications allow you to alter their IO size, while some applications do not.</span></span> <span data-ttu-id="a3331-347">Например, SQL Server определяет оптимальный объем ввода-вывода и не предоставляет пользователям никаких средств для его изменения.</span><span class="sxs-lookup"><span data-stu-id="a3331-347">For example, SQL Server determines the optimal IO size itself, and does not provide users with any knobs to change it.</span></span> <span data-ttu-id="a3331-348">Oracle, в свою очередь, предоставляет параметр [DB\_BLOCK\_SIZE](https://docs.oracle.com/cd/B19306_01/server.102/b14211/iodesign.htm#i28815), с помощью которого можно настроить размер запроса ввода-вывода базы данных.</span><span class="sxs-lookup"><span data-stu-id="a3331-348">On the other hand, Oracle provides a parameter called [DB\_BLOCK\_SIZE](https://docs.oracle.com/cd/B19306_01/server.102/b14211/iodesign.htm#i28815) using which you can configure the I/O request size of the database.</span></span>

<span data-ttu-id="a3331-349">При использовании приложения, в котором нельзя изменять объем ввода-вывода, следуйте приведенным здесь рекомендациям для оптимизации ключевых показателей эффективности для производительности, необходимых приложению.</span><span class="sxs-lookup"><span data-stu-id="a3331-349">If you are using an application, which does not allow you to change the IO size, use the guidelines in this article to optimize the performance KPI that is most relevant to your application.</span></span> <span data-ttu-id="a3331-350">Например,</span><span class="sxs-lookup"><span data-stu-id="a3331-350">For example,</span></span>

* <span data-ttu-id="a3331-351">Приложения OLTP генерируют миллионы небольших случайных запросов ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="a3331-351">An OLTP application generates millions of small and random IO requests.</span></span> <span data-ttu-id="a3331-352">Для обработки таких запросов необходимо разработать инфраструктуру приложения, чтобы повысить скорость выполнения операций ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="a3331-352">To handle these type of IO requests, you must design your application infrastructure to get higher IOPS.</span></span>  
* <span data-ttu-id="a3331-353">Приложения хранилища данных генерируют крупные последовательные запросы ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="a3331-353">A data warehousing application generates large and sequential IO requests.</span></span> <span data-ttu-id="a3331-354">Для обработки таких запросов необходимо разработать инфраструктуру приложения, чтобы увеличить пропускную способность.</span><span class="sxs-lookup"><span data-stu-id="a3331-354">To handle these type of IO requests, you must design your application infrastructure to get higher Bandwidth or Throughput.</span></span>

<span data-ttu-id="a3331-355">При использовании приложения, в котором можно изменять объем ввода-вывода, помимо других указаний для производительности, рекомендуем применять следующие принципы в отношении объема ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="a3331-355">If you are using an application, which allows you to change the IO size, use this rule of thumb for the IO size in addition to other performance guidelines,</span></span>

* <span data-ttu-id="a3331-356">Меньший объем ввода-вывода обеспечивает более высокую скорость выполнения операций ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="a3331-356">Smaller IO size to get higher IOPS.</span></span> <span data-ttu-id="a3331-357">Например, 8 КБ для приложения OLTP.</span><span class="sxs-lookup"><span data-stu-id="a3331-357">For example, 8 KB for an OLTP application.</span></span>  
* <span data-ttu-id="a3331-358">Больший объем ввода-вывода обеспечивает более высокую пропускную способность.</span><span class="sxs-lookup"><span data-stu-id="a3331-358">Larger IO size to get higher Bandwidth/Throughput.</span></span> <span data-ttu-id="a3331-359">Например, 1024 КБ для приложения хранилища данных.</span><span class="sxs-lookup"><span data-stu-id="a3331-359">For example, 1024 KB for a data warehouse application.</span></span>

<span data-ttu-id="a3331-360">Приведенный ниже пример поможет рассчитать количество операций ввода-вывода в секунду и пропускную способность для приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-360">Here is an example on how you can calculate the IOPS and Throughput/Bandwidth for your application.</span></span> <span data-ttu-id="a3331-361">Рассмотрим приложение, использующее диск P30.</span><span class="sxs-lookup"><span data-stu-id="a3331-361">Consider an application using a P30 disk.</span></span> <span data-ttu-id="a3331-362">Максимальное количество операций ввода-вывода в секунду и максимальная пропускная способность диска P30 — 5000 операций ввода-вывода и 200 МБ в секунду соответственно.</span><span class="sxs-lookup"><span data-stu-id="a3331-362">The maximum IOPS and Throughput/Bandwidth a P30 disk can achieve is 5000 IOPS and 200 MB per second respectively.</span></span> <span data-ttu-id="a3331-363">Если с приложением, которому требуется максимальное количество операций ввода-вывода диска P30, использовать меньший объем ввода-вывода, например 8 КБ, пропускная способность, которой можно будет добиться, составит 40 МБ в секунду.</span><span class="sxs-lookup"><span data-stu-id="a3331-363">Now, if your application requires the maximum IOPS from the P30 disk and you use a smaller IO size like 8 KB, the resulting Bandwidth you will be able to get is 40 MB per second.</span></span> <span data-ttu-id="a3331-364">Однако, если с приложением, которому требуется максимальная пропускная способность диска P30, использовать больший объем операций ввода-вывода, например 1024 КБ, количество операций ввода-вывода в секунду, которого можно будет добиться, сократится до 200.</span><span class="sxs-lookup"><span data-stu-id="a3331-364">However, if your application requires the maximum Throughput/Bandwidth from P30 disk, and you use a larger IO size like 1024 KB, the resulting IOPS will be less, 200 IOPS.</span></span> <span data-ttu-id="a3331-365">Таким образом, объем ввода-вывода следует настраивать в соответствии с требованиями приложения к количеству операций ввода-вывода в секунду и пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="a3331-365">Therefore, tune the IO size such that it meets both your application's IOPS and Throughput/Bandwidth requirement.</span></span> <span data-ttu-id="a3331-366">В следующей таблице приведены разные объемы ввода-вывода и соответствующее количество операций ввода-вывода в секунду, а также показатели пропускной способности для диска P30.</span><span class="sxs-lookup"><span data-stu-id="a3331-366">Table below summarizes the different IO sizes and their corresponding IOPS and Throughput for a P30 disk.</span></span>

| <span data-ttu-id="a3331-367">Требование к приложению</span><span class="sxs-lookup"><span data-stu-id="a3331-367">Application Requirement</span></span> | <span data-ttu-id="a3331-368">Объем ввода-вывода</span><span class="sxs-lookup"><span data-stu-id="a3331-368">I/O size</span></span> | <span data-ttu-id="a3331-369">ОПЕРАЦИЙ ВВОДА-ВЫВОДА</span><span class="sxs-lookup"><span data-stu-id="a3331-369">IOPS</span></span> | <span data-ttu-id="a3331-370">Пропускная способность</span><span class="sxs-lookup"><span data-stu-id="a3331-370">Throughput/Bandwidth</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="a3331-371">Maкс. количество операций ввода-вывода в секунду</span><span class="sxs-lookup"><span data-stu-id="a3331-371">Max IOPS</span></span> |<span data-ttu-id="a3331-372">8 КБ</span><span class="sxs-lookup"><span data-stu-id="a3331-372">8 KB</span></span> |<span data-ttu-id="a3331-373">5 000</span><span class="sxs-lookup"><span data-stu-id="a3331-373">5,000</span></span> |<span data-ttu-id="a3331-374">40 МБ в секунду</span><span class="sxs-lookup"><span data-stu-id="a3331-374">40 MB per second</span></span> |
| <span data-ttu-id="a3331-375">Макс. пропускная способность</span><span class="sxs-lookup"><span data-stu-id="a3331-375">Max Throughput</span></span> |<span data-ttu-id="a3331-376">1024 КБ</span><span class="sxs-lookup"><span data-stu-id="a3331-376">1024 KB</span></span> |<span data-ttu-id="a3331-377">200</span><span class="sxs-lookup"><span data-stu-id="a3331-377">200</span></span> |<span data-ttu-id="a3331-378">200 МБ в секунду</span><span class="sxs-lookup"><span data-stu-id="a3331-378">200 MB per second</span></span> |
| <span data-ttu-id="a3331-379">Макс. пропускная способность и высокая скорость выполнения операций ввода-вывода</span><span class="sxs-lookup"><span data-stu-id="a3331-379">Max Throughput + high IOPS</span></span> |<span data-ttu-id="a3331-380">64 КБ</span><span class="sxs-lookup"><span data-stu-id="a3331-380">64 KB</span></span> |<span data-ttu-id="a3331-381">3200</span><span class="sxs-lookup"><span data-stu-id="a3331-381">3,200</span></span> |<span data-ttu-id="a3331-382">200 МБ в секунду</span><span class="sxs-lookup"><span data-stu-id="a3331-382">200 MB per second</span></span> |
| <span data-ttu-id="a3331-383">Макс. скорость выполнения операций ввода-вывода и высокая пропускная способность</span><span class="sxs-lookup"><span data-stu-id="a3331-383">Max IOPS + high Throughput</span></span> |<span data-ttu-id="a3331-384">32 КБ</span><span class="sxs-lookup"><span data-stu-id="a3331-384">32 KB</span></span> |<span data-ttu-id="a3331-385">5 000</span><span class="sxs-lookup"><span data-stu-id="a3331-385">5,000</span></span> |<span data-ttu-id="a3331-386">160 МБ в секунду</span><span class="sxs-lookup"><span data-stu-id="a3331-386">160 MB per second</span></span> |

<span data-ttu-id="a3331-387">Для получения более высокой скорости выполнения операций ввода-вывода и пропускной способности, чем максимальное значение для одного диска хранилища класса «Премиум», чередуйте несколько дисков класса «Премиум».</span><span class="sxs-lookup"><span data-stu-id="a3331-387">To get IOPS and Bandwidth higher than the maximum value of a single premium storage disk, use multiple premium disks striped together.</span></span> <span data-ttu-id="a3331-388">Например, чередуйте два диска P30, чтобы получить объединенную скорость выполнения операций ввода-вывода (10 000 операций ввода-вывода в секунду) или объединенную пропускную способность (400 МБ в секунду).</span><span class="sxs-lookup"><span data-stu-id="a3331-388">For example, stripe two P30 disks to get a combined IOPS of 10,000 IOPS or a combined Throughput of 400 MB per second.</span></span> <span data-ttu-id="a3331-389">Необходимо использовать размер виртуальной машины, который поддерживает объединенную скорость выполнения операций ввода-вывода и пропускную способность дисков, как описано в следующем разделе.</span><span class="sxs-lookup"><span data-stu-id="a3331-389">As explained in the next section, you must use a VM size that supports the combined disk IOPS and Throughput.</span></span>

> [!NOTE]
> <span data-ttu-id="a3331-390">При увеличении скорости выполнения операций ввода-вывода или пропускной способности другой показатель также увеличивается. Поэтому, увеличивая один из показателей, убедитесь, что не достигнуто ограничение пропускной способности или скорости выполнения операций ввода-вывода диска или виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="a3331-390">As you increase either IOPS or Throughput the other also increases, make sure you do not hit throughput or IOPS limits of the disk or VM when increasing either one.</span></span>
>
>

<span data-ttu-id="a3331-391">Чтобы убедиться во влиянии объема ввода-вывода на производительность приложения, можно запустить инструменты тестирования производительности на виртуальной машине и дисках.</span><span class="sxs-lookup"><span data-stu-id="a3331-391">To witness the effects of IO size on application performance, you can run benchmarking tools on your VM and disks.</span></span> <span data-ttu-id="a3331-392">Выполните несколько тестовых запусков и используйте для каждого из них разный объем ввода-вывода, чтобы увидеть влияние.</span><span class="sxs-lookup"><span data-stu-id="a3331-392">Create multiple test runs and use different IO size for each run to see the impact.</span></span> <span data-ttu-id="a3331-393">Дополнительные сведения см. в разделе [Измерение производительности](#Benchmarking) в конце этой статьи.</span><span class="sxs-lookup"><span data-stu-id="a3331-393">Refer to the [Benchmarking](#Benchmarking) section at the end of this article for more details.</span></span>

## <a name="high-scale-vm-sizes"></a><span data-ttu-id="a3331-394">Размеры высокомасштабируемых виртуальных машин</span><span class="sxs-lookup"><span data-stu-id="a3331-394">High Scale VM Sizes</span></span>
<span data-ttu-id="a3331-395">При разработке приложения нужно в первую очередь выбрать виртуальную машину для размещения приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-395">When you start designing an application, one of the first things to do is, choose a VM to host your application.</span></span> <span data-ttu-id="a3331-396">Хранилище класса «Премиум» предусматривает использование высокомасштабируемых виртуальных машин, на которых могут выполняться приложения, требующие высокой вычислительной мощности и повышенной производительности операций ввода-вывода локального диска.</span><span class="sxs-lookup"><span data-stu-id="a3331-396">Premium Storage comes with High Scale VM sizes that can run applications requiring higher compute power and a high local disk I/O performance.</span></span> <span data-ttu-id="a3331-397">Эти виртуальные машины отличаются более быстрыми процессорами, более высоким соотношением «память — ядро» и использованием твердотельного накопителя (SSD) в качестве локального диска.</span><span class="sxs-lookup"><span data-stu-id="a3331-397">These VMs provide faster processors, a higher memory-to-core ratio, and a Solid-State Drive (SSD) for the local disk.</span></span> <span data-ttu-id="a3331-398">Примерами высокомасштабируемых виртуальных машин с поддержкой хранилища класса "Премиум" являются виртуальные машины серий DS, DSv2 и GS.</span><span class="sxs-lookup"><span data-stu-id="a3331-398">Examples of High Scale VMs supporting Premium Storage are the DS, DSv2 and GS series VMs.</span></span>

<span data-ttu-id="a3331-399">Доступны высокомасштабируемые виртуальные машины различных размеров с разным количеством ядер ЦП, объемом памяти, операционными системами и размером временного диска.</span><span class="sxs-lookup"><span data-stu-id="a3331-399">High Scale VMs are available in different sizes with a different number of CPU cores, memory, OS and temporary disk size.</span></span> <span data-ttu-id="a3331-400">Для каждого размера виртуальной машины также установлено максимальное количество дисков данных, которые можно подключить к виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="a3331-400">Each VM size also has maximum number of data disks that you can attach to the VM.</span></span> <span data-ttu-id="a3331-401">Таким образом, выбранный размер виртуальной машины влияет на мощность обработки, объем памяти и хранилища, которые доступны для приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-401">Therefore, the chosen VM size will affect how much processing, memory, and storage capacity is available for your application.</span></span> <span data-ttu-id="a3331-402">Он также влияет на затраты на вычисление и хранение.</span><span class="sxs-lookup"><span data-stu-id="a3331-402">It also affects the Compute and Storage cost.</span></span> <span data-ttu-id="a3331-403">Например, ниже представлены спецификации виртуальной машины максимального размера серий DS, DSv2 и GS:</span><span class="sxs-lookup"><span data-stu-id="a3331-403">For example, below are the specifications of the largest VM size in a DS series, DSv2 series and a GS series:</span></span>

| <span data-ttu-id="a3331-404">Размер виртуальной машины</span><span class="sxs-lookup"><span data-stu-id="a3331-404">VM size</span></span> | <span data-ttu-id="a3331-405">Ядра ЦП</span><span class="sxs-lookup"><span data-stu-id="a3331-405">CPU cores</span></span> | <span data-ttu-id="a3331-406">Память</span><span class="sxs-lookup"><span data-stu-id="a3331-406">Memory</span></span> | <span data-ttu-id="a3331-407">Размеры диска виртуальной машины</span><span class="sxs-lookup"><span data-stu-id="a3331-407">VM disk sizes</span></span> | <span data-ttu-id="a3331-408">Макс.</span><span class="sxs-lookup"><span data-stu-id="a3331-408">Max.</span></span> <span data-ttu-id="a3331-409">количество дисков данных</span><span class="sxs-lookup"><span data-stu-id="a3331-409">data disks</span></span> | <span data-ttu-id="a3331-410">Объем кэша</span><span class="sxs-lookup"><span data-stu-id="a3331-410">Cache size</span></span> | <span data-ttu-id="a3331-411">ОПЕРАЦИЙ ВВОДА-ВЫВОДА</span><span class="sxs-lookup"><span data-stu-id="a3331-411">IOPS</span></span> | <span data-ttu-id="a3331-412">Ограничения количества операций ввода-вывода в секунду и пропускной способности кэша</span><span class="sxs-lookup"><span data-stu-id="a3331-412">Bandwidth Cache IO limits</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="a3331-413">Standard_DS14</span><span class="sxs-lookup"><span data-stu-id="a3331-413">Standard_DS14</span></span> |<span data-ttu-id="a3331-414">16</span><span class="sxs-lookup"><span data-stu-id="a3331-414">16</span></span> |<span data-ttu-id="a3331-415">112 ГБ</span><span class="sxs-lookup"><span data-stu-id="a3331-415">112 GB</span></span> |<span data-ttu-id="a3331-416">ОС = 1023 ГБ </span><span class="sxs-lookup"><span data-stu-id="a3331-416">OS = 1023 GB</span></span> <br> <span data-ttu-id="a3331-417">Локальный SSD = 224 ГБ</span><span class="sxs-lookup"><span data-stu-id="a3331-417">Local SSD = 224 GB</span></span> |<span data-ttu-id="a3331-418">32</span><span class="sxs-lookup"><span data-stu-id="a3331-418">32</span></span> |<span data-ttu-id="a3331-419">576 ГБ</span><span class="sxs-lookup"><span data-stu-id="a3331-419">576 GB</span></span> |<span data-ttu-id="a3331-420">50 000 операций ввода-вывода в секунду </span><span class="sxs-lookup"><span data-stu-id="a3331-420">50,000 IOPS</span></span> <br> <span data-ttu-id="a3331-421">512 МБ в секунду</span><span class="sxs-lookup"><span data-stu-id="a3331-421">512 MB per second</span></span> |<span data-ttu-id="a3331-422">4000 операций ввода-вывода в секунду и 33 МБ в секунду</span><span class="sxs-lookup"><span data-stu-id="a3331-422">4,000 IOPS and 33 MB per second</span></span> |
| <span data-ttu-id="a3331-423">Standard_GS5</span><span class="sxs-lookup"><span data-stu-id="a3331-423">Standard_GS5</span></span> |<span data-ttu-id="a3331-424">32</span><span class="sxs-lookup"><span data-stu-id="a3331-424">32</span></span> |<span data-ttu-id="a3331-425">448 ГБ</span><span class="sxs-lookup"><span data-stu-id="a3331-425">448 GB</span></span> |<span data-ttu-id="a3331-426">ОС = 1023 ГБ </span><span class="sxs-lookup"><span data-stu-id="a3331-426">OS = 1023 GB</span></span> <br> <span data-ttu-id="a3331-427">Локальный SSD = 896 ГБ</span><span class="sxs-lookup"><span data-stu-id="a3331-427">Local SSD = 896 GB</span></span> |<span data-ttu-id="a3331-428">64</span><span class="sxs-lookup"><span data-stu-id="a3331-428">64</span></span> |<span data-ttu-id="a3331-429">4224 ГБ</span><span class="sxs-lookup"><span data-stu-id="a3331-429">4224 GB</span></span> |<span data-ttu-id="a3331-430">80 000 операций ввода-вывода в секунду </span><span class="sxs-lookup"><span data-stu-id="a3331-430">80,000 IOPS</span></span> <br> <span data-ttu-id="a3331-431">2000 МБ в секунду</span><span class="sxs-lookup"><span data-stu-id="a3331-431">2,000 MB per second</span></span> |<span data-ttu-id="a3331-432">5000 операций ввода-вывода в секунду и 50 МБ в секунду</span><span class="sxs-lookup"><span data-stu-id="a3331-432">5,000 IOPS and 50 MB per second</span></span> |

<span data-ttu-id="a3331-433">Полный список всех доступных размеров виртуальных машин Azure см. в статьях [Размеры виртуальных машин Windows](../../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) и [Размеры виртуальных машин Linux](../../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="a3331-433">To view a complete list of all available Azure VM sizes, refer to [Windows VM sizes](../../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) or [Linux VM sizes](../../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span></span> <span data-ttu-id="a3331-434">Выберите размер виртуальной машины, который позволяет выполнять масштабирование в соответствии с требованиями к производительности приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-434">Choose a VM size that can meet and scale to your desired application performance requirements.</span></span> <span data-ttu-id="a3331-435">Помимо этого, при выборе размеров виртуальной машины необходимо учитывать следующие важные аспекты.</span><span class="sxs-lookup"><span data-stu-id="a3331-435">In addition to this, take into account following important considerations when choosing VM sizes.</span></span>

<span data-ttu-id="a3331-436">*Ограничения масштабирования*</span><span class="sxs-lookup"><span data-stu-id="a3331-436">*Scale Limits*</span></span>  
<span data-ttu-id="a3331-437">Максимальные ограничения операций ввода-вывода в секунду на виртуальную машину и на диск различаются и не зависят друг от друга.</span><span class="sxs-lookup"><span data-stu-id="a3331-437">The maximum IOPS limits per VM and per disk are different and independent of each other.</span></span> <span data-ttu-id="a3331-438">Убедитесь, что количество операций ввода-вывода в секунду, выполняемое приложением и подключенными к нему дисками класса «Премиум», находится в пределах ограничений виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="a3331-438">Make sure that the application is driving IOPS within the limits of the VM as well as the premium disks attached to it.</span></span> <span data-ttu-id="a3331-439">В противном случае производительность приложения нужно будет отрегулировать.</span><span class="sxs-lookup"><span data-stu-id="a3331-439">Otherwise, application performance will experience throttling.</span></span>

<span data-ttu-id="a3331-440">В качестве примера предположим, что максимальное количество операций ввода-вывода в секунду для приложения составляет 4000.</span><span class="sxs-lookup"><span data-stu-id="a3331-440">As an example, suppose an application requirement is a maximum of 4,000 IOPS.</span></span> <span data-ttu-id="a3331-441">Для достижения этого показателя на виртуальной машине DS1 необходимо подготовить диск P30.</span><span class="sxs-lookup"><span data-stu-id="a3331-441">To achieve this, you provision a P30 disk on a DS1 VM.</span></span> <span data-ttu-id="a3331-442">Диск P30 может выполнять до 5000 операций ввода-вывода в секунду.</span><span class="sxs-lookup"><span data-stu-id="a3331-442">The P30 disk can deliver up to 5,000 IOPS.</span></span> <span data-ttu-id="a3331-443">Но виртуальная машина DS1 может выполнять не более 3200 операций ввода-вывода в секунду.</span><span class="sxs-lookup"><span data-stu-id="a3331-443">However, the DS1 VM is limited to 3,200 IOPS.</span></span> <span data-ttu-id="a3331-444">Следовательно, приложение также ограничивается 3200 операциями ввода-вывода в секунду и демонстрирует сниженную производительность.</span><span class="sxs-lookup"><span data-stu-id="a3331-444">Consequently, the application performance will be constrained by the VM limit at 3,200 IOPS and there will be degraded performance.</span></span> <span data-ttu-id="a3331-445">Во избежание этого выберите размеры диска и виртуальной машины, соответствующие требованиям приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-445">To prevent this situation, choose a VM and disk size that will both meet application requirements.</span></span>

<span data-ttu-id="a3331-446">*Стоимость выполнения операций*</span><span class="sxs-lookup"><span data-stu-id="a3331-446">*Cost of Operation*</span></span>  
<span data-ttu-id="a3331-447">Во многих случаях общая стоимость выполнения операций с использованием хранилища класса «Премиум» может быть меньше, чем при использовании хранилища класса «Стандартный».</span><span class="sxs-lookup"><span data-stu-id="a3331-447">In many cases, it is possible that your overall cost of operation using Premium Storage is lower than using Standard Storage.</span></span>

<span data-ttu-id="a3331-448">В качестве примера рассмотрим приложение, требующее выполнения 16 000 операций ввода-вывода в секунду.</span><span class="sxs-lookup"><span data-stu-id="a3331-448">For example, consider an application requiring 16,000 IOPS.</span></span> <span data-ttu-id="a3331-449">Для достижения такой производительности потребуется виртуальная машина IaaS Azure Standard\_StandardD14, которая выполняет до 16 000 операций ввода-вывода в секунду, используя 32 диска хранилища класса "Стандартный" емкостью 1 ТБ.</span><span class="sxs-lookup"><span data-stu-id="a3331-449">To achieve this performance, you will need a Standard\_D14 Azure IaaS VM, which can give a maximum IOPS of 16,000 using 32 standard storage 1TB disks.</span></span> <span data-ttu-id="a3331-450">Каждый диск хранилища класса «Стандартный» емкостью 1 ТБ может выполнить до 500 операций ввода-вывода в секунду.</span><span class="sxs-lookup"><span data-stu-id="a3331-450">Each 1TB standard storage disk can achieve a maximum of 500 IOPS.</span></span> <span data-ttu-id="a3331-451">Оценочная стоимость этой виртуальной машины в месяц составляет 1570 долл. США.</span><span class="sxs-lookup"><span data-stu-id="a3331-451">The estimated cost of this VM per month will be $1,570.</span></span> <span data-ttu-id="a3331-452">Ежемесячная стоимость 32 дисков хранилища класса «Стандартный» составляет 1638 долл. США.</span><span class="sxs-lookup"><span data-stu-id="a3331-452">The monthly cost of 32 standard storage disks will be $1,638.</span></span> <span data-ttu-id="a3331-453">Оценочная общая ежемесячная стоимость составляет 3208 долл. США.</span><span class="sxs-lookup"><span data-stu-id="a3331-453">The estimated total monthly cost will be $3,208.</span></span>

<span data-ttu-id="a3331-454">Однако если разместить то же самое приложение в хранилище класса «Премиум», понадобится меньший размер виртуальной машины и меньшее количество дисков хранилища класса «Премиум», что уменьшит общую стоимость.</span><span class="sxs-lookup"><span data-stu-id="a3331-454">However, if you hosted the same application on Premium Storage, you will need a smaller VM size and fewer premium storage disks, thus reducing the overall cost.</span></span> <span data-ttu-id="a3331-455">Виртуальная машина Standard\_StandardDS13 может выполнять 16 000 операций ввода-вывода в секунду, используя четыре диска P30.</span><span class="sxs-lookup"><span data-stu-id="a3331-455">A Standard\_DS13 VM can meet the 16,000 IOPS requirement using four P30 disks.</span></span> <span data-ttu-id="a3331-456">Виртуальная машина DS13 выполняет до 25 600 операций ввода-вывода в секунду, а каждый диск P30 — до 5000.</span><span class="sxs-lookup"><span data-stu-id="a3331-456">The DS13 VM has a maximum IOPS of 25,600 and each P30 disk has a maximum IOPS of 5,000.</span></span> <span data-ttu-id="a3331-457">В целом, при такой конфигурации можно добиться 20 000 операций ввода-вывода в секунду (5000 x 4).</span><span class="sxs-lookup"><span data-stu-id="a3331-457">Overall, this configuration can achieve 5,000 x 4 = 20,000 IOPS.</span></span> <span data-ttu-id="a3331-458">Оценочная стоимость этой виртуальной машины в месяц составляет 1003 долл. США.</span><span class="sxs-lookup"><span data-stu-id="a3331-458">The estimated cost of this VM per month will be $1,003.</span></span> <span data-ttu-id="a3331-459">Ежемесячная стоимость четырех дисков хранилища класса «Премиум» P30 составляет 544,34 долл. США.</span><span class="sxs-lookup"><span data-stu-id="a3331-459">The monthly cost of four P30 premium storage disks will be $544.34.</span></span> <span data-ttu-id="a3331-460">Оценочная общая ежемесячная стоимость составляет 1544 долл. США.</span><span class="sxs-lookup"><span data-stu-id="a3331-460">The estimated total monthly cost will be $1,544.</span></span>

<span data-ttu-id="a3331-461">В следующей таблице представлены затраты по этому сценарию при использовании хранилища класса «Стандартный» и «Премиум».</span><span class="sxs-lookup"><span data-stu-id="a3331-461">Table below summarizes the cost breakdown of this scenario for Standard and Premium Storage.</span></span>

| &nbsp; | <span data-ttu-id="a3331-462">**Стандартный**</span><span class="sxs-lookup"><span data-stu-id="a3331-462">**Standard**</span></span> | <span data-ttu-id="a3331-463">**Премиальный**</span><span class="sxs-lookup"><span data-stu-id="a3331-463">**Premium**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="a3331-464">**Стоимость виртуальной машины в месяц**</span><span class="sxs-lookup"><span data-stu-id="a3331-464">**Cost of VM per month**</span></span> |<span data-ttu-id="a3331-465">1570,58 долл. США (Standard\_D14)</span><span class="sxs-lookup"><span data-stu-id="a3331-465">$1,570.58 (Standard\_D14)</span></span> |<span data-ttu-id="a3331-466">1003,66 долл. США (Standard\_DS13)</span><span class="sxs-lookup"><span data-stu-id="a3331-466">$1,003.66 (Standard\_DS13)</span></span> |
| <span data-ttu-id="a3331-467">**Стоимость дисков в месяц**</span><span class="sxs-lookup"><span data-stu-id="a3331-467">**Cost of Disks per month**</span></span> |<span data-ttu-id="a3331-468">1638,40 долл. США (32 диска емкостью 1 ТБ)</span><span class="sxs-lookup"><span data-stu-id="a3331-468">$1,638.40 (32 x 1 TB disks)</span></span> |<span data-ttu-id="a3331-469">544,34 долл. США (4 диска P30)</span><span class="sxs-lookup"><span data-stu-id="a3331-469">$544.34 (4 x P30 disks)</span></span> |
| <span data-ttu-id="a3331-470">**Общая стоимость в месяц**</span><span class="sxs-lookup"><span data-stu-id="a3331-470">**Overall Cost per month**</span></span> |<span data-ttu-id="a3331-471">3208,98 долл. США</span><span class="sxs-lookup"><span data-stu-id="a3331-471">$3,208.98</span></span> |<span data-ttu-id="a3331-472">1544,34 долл. США</span><span class="sxs-lookup"><span data-stu-id="a3331-472">$1,544.34</span></span> |

<span data-ttu-id="a3331-473">*Дистрибутивы Linux*</span><span class="sxs-lookup"><span data-stu-id="a3331-473">*Linux Distros*</span></span>  

<span data-ttu-id="a3331-474">Используя службу хранилища Azure категории "Премиум", можно добиться одинакового уровня производительности виртуальных машин под управлением Windows и Linux.</span><span class="sxs-lookup"><span data-stu-id="a3331-474">With Azure Premium Storage, you get the same level of Performance for VMs running Windows and Linux.</span></span> <span data-ttu-id="a3331-475">Продукция корпорации Майкрософт поддерживает множество разных дистрибутивов Linux. Полный список можно просмотреть [здесь](../../virtual-machines/linux/endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="a3331-475">We support many flavors of Linux distros, and you can see the complete list [here](../../virtual-machines/linux/endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span></span> <span data-ttu-id="a3331-476">Следует отметить, что для различных типов рабочих нагрузок подходят различные дистрибутивы.</span><span class="sxs-lookup"><span data-stu-id="a3331-476">It is important to note that different distros are better suited for different types of workloads.</span></span> <span data-ttu-id="a3331-477">Каждый дистрибутив, используемый для рабочей нагрузки, обеспечивает разный уровень производительности.</span><span class="sxs-lookup"><span data-stu-id="a3331-477">You will see different levels of performance depending on the distro your workload is running on.</span></span> <span data-ttu-id="a3331-478">Протестируйте дистрибутивы Linux для приложения и выберите наиболее подходящий вариант.</span><span class="sxs-lookup"><span data-stu-id="a3331-478">Test the Linux distros with your application and choose the one that works best.</span></span>

<span data-ttu-id="a3331-479">При использовании хранилища класса «Премиум» под управлением Linux следует проверить последние обновления драйверов, необходимых для обеспечения высокой производительности.</span><span class="sxs-lookup"><span data-stu-id="a3331-479">When running Linux with Premium Storage, check the latest updates about required drivers to ensure high performance.</span></span>

## <a name="premium-storage-disk-sizes"></a><span data-ttu-id="a3331-480">Размеры диска хранилища класса «Премиум»</span><span class="sxs-lookup"><span data-stu-id="a3331-480">Premium Storage Disk Sizes</span></span>
<span data-ttu-id="a3331-481">В настоящее время хранилище уровня "Премиум" Azure предлагается с дисками семи размеров.</span><span class="sxs-lookup"><span data-stu-id="a3331-481">Azure Premium Storage offers seven disk sizes currently.</span></span> <span data-ttu-id="a3331-482">Для диска каждого размера установлены различные ограничения масштабирования для операций ввода-вывода в секунду, пропускной способности и хранилища.</span><span class="sxs-lookup"><span data-stu-id="a3331-482">Each disk size has a different scale limit for IOPS, Bandwidth and Storage.</span></span> <span data-ttu-id="a3331-483">Выберите диск хранилища класса «Премиум» правильного размера в соответствии с требованиями приложения и размером высокомасштабируемой виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="a3331-483">Choose the right Premium Storage Disk size depending on the application requirements and the high scale VM size.</span></span> <span data-ttu-id="a3331-484">В следующей таблице представлены диски семи размеров и их возможности.</span><span class="sxs-lookup"><span data-stu-id="a3331-484">The table below shows the seven disks sizes and their capabilities.</span></span> <span data-ttu-id="a3331-485">Размеры P4 и P6 в настоящее время поддерживаются только для службы "Управляемые диски".</span><span class="sxs-lookup"><span data-stu-id="a3331-485">P4 and P6 sizes are currently only supported for Managed Disks.</span></span>

| <span data-ttu-id="a3331-486">Диски уровня "Премиум"</span><span class="sxs-lookup"><span data-stu-id="a3331-486">Premium Disks Type</span></span>  | <span data-ttu-id="a3331-487">P4</span><span class="sxs-lookup"><span data-stu-id="a3331-487">P4</span></span>    | <span data-ttu-id="a3331-488">P6</span><span class="sxs-lookup"><span data-stu-id="a3331-488">P6</span></span>    | <span data-ttu-id="a3331-489">P10</span><span class="sxs-lookup"><span data-stu-id="a3331-489">P10</span></span>   | <span data-ttu-id="a3331-490">P20</span><span class="sxs-lookup"><span data-stu-id="a3331-490">P20</span></span>   | <span data-ttu-id="a3331-491">P30</span><span class="sxs-lookup"><span data-stu-id="a3331-491">P30</span></span>   | <span data-ttu-id="a3331-492">P40</span><span class="sxs-lookup"><span data-stu-id="a3331-492">P40</span></span>   | <span data-ttu-id="a3331-493">P50</span><span class="sxs-lookup"><span data-stu-id="a3331-493">P50</span></span>   | 
|---------------------|-------|-------|-------|-------|-------|-------|-------|
| <span data-ttu-id="a3331-494">Размер диска</span><span class="sxs-lookup"><span data-stu-id="a3331-494">Disk size</span></span>           | <span data-ttu-id="a3331-495">32 ГБ</span><span class="sxs-lookup"><span data-stu-id="a3331-495">32 GB</span></span> | <span data-ttu-id="a3331-496">64 ГБ</span><span class="sxs-lookup"><span data-stu-id="a3331-496">64 GB</span></span> | <span data-ttu-id="a3331-497">128 ГБ</span><span class="sxs-lookup"><span data-stu-id="a3331-497">128 GB</span></span>| <span data-ttu-id="a3331-498">512 ГБ</span><span class="sxs-lookup"><span data-stu-id="a3331-498">512 GB</span></span>            | <span data-ttu-id="a3331-499">1024 ГБ (1 ТБ)</span><span class="sxs-lookup"><span data-stu-id="a3331-499">1024 GB (1 TB)</span></span>    | <span data-ttu-id="a3331-500">2048 ГБ (2 ТБ)</span><span class="sxs-lookup"><span data-stu-id="a3331-500">2048 GB (2 TB)</span></span>    | <span data-ttu-id="a3331-501">4095 ГБ (4 ТБ)</span><span class="sxs-lookup"><span data-stu-id="a3331-501">4095 GB (4 TB)</span></span>    | 
| <span data-ttu-id="a3331-502">Количество операций ввода-вывода в секунду на диск</span><span class="sxs-lookup"><span data-stu-id="a3331-502">IOPS per disk</span></span>       | <span data-ttu-id="a3331-503">120</span><span class="sxs-lookup"><span data-stu-id="a3331-503">120</span></span>   | <span data-ttu-id="a3331-504">240</span><span class="sxs-lookup"><span data-stu-id="a3331-504">240</span></span>   | <span data-ttu-id="a3331-505">500</span><span class="sxs-lookup"><span data-stu-id="a3331-505">500</span></span>   | <span data-ttu-id="a3331-506">2300</span><span class="sxs-lookup"><span data-stu-id="a3331-506">2300</span></span>              | <span data-ttu-id="a3331-507">5000</span><span class="sxs-lookup"><span data-stu-id="a3331-507">5000</span></span>              | <span data-ttu-id="a3331-508">7500</span><span class="sxs-lookup"><span data-stu-id="a3331-508">7500</span></span>              | <span data-ttu-id="a3331-509">7500</span><span class="sxs-lookup"><span data-stu-id="a3331-509">7500</span></span>              | 
| <span data-ttu-id="a3331-510">Пропускная способность на диск</span><span class="sxs-lookup"><span data-stu-id="a3331-510">Throughput per disk</span></span> | <span data-ttu-id="a3331-511">25 МБ в секунду</span><span class="sxs-lookup"><span data-stu-id="a3331-511">25 MB per second</span></span>  | <span data-ttu-id="a3331-512">50 МБ в секунду</span><span class="sxs-lookup"><span data-stu-id="a3331-512">50 MB per second</span></span>  | <span data-ttu-id="a3331-513">100 МБ в секунду</span><span class="sxs-lookup"><span data-stu-id="a3331-513">100 MB per second</span></span> | <span data-ttu-id="a3331-514">150 МБ в секунду</span><span class="sxs-lookup"><span data-stu-id="a3331-514">150 MB per second</span></span> | <span data-ttu-id="a3331-515">200 МБ в секунду</span><span class="sxs-lookup"><span data-stu-id="a3331-515">200 MB per second</span></span> | <span data-ttu-id="a3331-516">250 МБ в секунду</span><span class="sxs-lookup"><span data-stu-id="a3331-516">250 MB per second</span></span> | <span data-ttu-id="a3331-517">250 МБ в секунду</span><span class="sxs-lookup"><span data-stu-id="a3331-517">250 MB per second</span></span> | 


<span data-ttu-id="a3331-518">Выбор количества дисков зависит от выбранного размера диска.</span><span class="sxs-lookup"><span data-stu-id="a3331-518">How many disks you choose depends on the disk size chosen.</span></span> <span data-ttu-id="a3331-519">Для удовлетворения требований приложения можно использовать один диск P50 или несколько дисков P10.</span><span class="sxs-lookup"><span data-stu-id="a3331-519">You could use a single P50 disk or multiple P10 disks to meet your application requirement.</span></span> <span data-ttu-id="a3331-520">Выбирая размер диска, учитывайте приведенные ниже рекомендации.</span><span class="sxs-lookup"><span data-stu-id="a3331-520">Take into account considerations listed below when making the choice.</span></span>

<span data-ttu-id="a3331-521">*Ограничения масштабирования (на количество операций ввода-вывода в секунду и пропускную способность)*</span><span class="sxs-lookup"><span data-stu-id="a3331-521">*Scale Limits (IOPS and Throughput)*</span></span>  
<span data-ttu-id="a3331-522">Ограничения на количество операций ввода-вывода в секунду и пропускную способность для каждого размера диска класса «Премиум» различаются и не зависят от ограничений масштабирования виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="a3331-522">The IOPS and Throughput limits of each Premium disk size is different and independent from the VM scale limits.</span></span> <span data-ttu-id="a3331-523">Убедитесь, что общее количество операций ввода-вывода в секунду и пропускная способность дисков не превышают установленные ограничения масштабирования выбранного размера виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="a3331-523">Make sure that the total IOPS and Throughput from the disks are within scale limits of the chosen VM size.</span></span>

<span data-ttu-id="a3331-524">Например, рассмотрим, как следует поступить, если используется виртуальная машина DS4 с одним диском P30, а максимальная пропускная способность приложения составляет не более 250 МБ/с.</span><span class="sxs-lookup"><span data-stu-id="a3331-524">For example, if an application requirement is a maximum of 250 MB/sec Throughput and you are using a DS4 VM with a single P30 disk.</span></span> <span data-ttu-id="a3331-525">Максимальная пропускная способность виртуальной машины DS4 — 256 МБ/с.</span><span class="sxs-lookup"><span data-stu-id="a3331-525">The DS4 VM can give up to 256 MB/sec Throughput.</span></span> <span data-ttu-id="a3331-526">У одного диска P30 установлено ограничение пропускной способности на уровне 200 МБ/с. Следовательно, из-за ограничений диска пропускная способность приложения будет равна 200 МБ/с.</span><span class="sxs-lookup"><span data-stu-id="a3331-526">However, a single P30 disk has Throughput limit of 200 MB/sec. Consequently, the application will be constrained at 200 MB/sec due to the disk limit.</span></span> <span data-ttu-id="a3331-527">Чтобы устранить эту проблему, для виртуальной машины необходимо подготовить несколько дисков данных либо изменить размер дисков на P40 или P50.</span><span class="sxs-lookup"><span data-stu-id="a3331-527">To overcome this limit, provision more than one data disks to the VM or resize your disks to P40 or P50.</span></span>

> [!NOTE]
> <span data-ttu-id="a3331-528">Операции чтения, обрабатываемые с помощью кэша, не относятся к операциям ввода-вывода и пропускной способности диска, поэтому ограничения диска на них не распространяются.</span><span class="sxs-lookup"><span data-stu-id="a3331-528">Reads served by the cache are not included in the disk IOPS and Throughput, hence not subject to disk limits.</span></span> <span data-ttu-id="a3331-529">Для кэша существует отдельное ограничение на количество операций ввода-вывода в секунду и пропускную способность для каждой виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="a3331-529">Cache has its separate IOPS and Throughput limit per VM.</span></span>
>
> <span data-ttu-id="a3331-530">Например, изначально пропускная способность операций чтения и записи составляет 60 МБ/с и 40 МБ/с соответственно.</span><span class="sxs-lookup"><span data-stu-id="a3331-530">For example, initially your reads and writes are 60MB/sec and 40MB/sec respectively.</span></span> <span data-ttu-id="a3331-531">Со временем кэш подготавливает и выполняет все больше операций чтения.</span><span class="sxs-lookup"><span data-stu-id="a3331-531">Over time, the cache warms up and serves more and more of the reads from the cache.</span></span> <span data-ttu-id="a3331-532">В дальнейшем можно добиться более высокой пропускной способности операций записи с диска.</span><span class="sxs-lookup"><span data-stu-id="a3331-532">Then, you can get higher write Throughput from the disk.</span></span>
>
>

<span data-ttu-id="a3331-533">*Количество дисков*</span><span class="sxs-lookup"><span data-stu-id="a3331-533">*Number of Disks*</span></span>  
<span data-ttu-id="a3331-534">Определите необходимое количество дисков на основе оценки требований приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-534">Determine the number of disks you will need by assessing application requirements.</span></span> <span data-ttu-id="a3331-535">Для каждого размера виртуальной машины также установлено ограничение на количество дисков, которые можно подключить.</span><span class="sxs-lookup"><span data-stu-id="a3331-535">Each VM size also has a limit on the number of disks that you can attach to the VM.</span></span> <span data-ttu-id="a3331-536">Как правило, это количество в два раза превышает количество ядер.</span><span class="sxs-lookup"><span data-stu-id="a3331-536">Typically, this is twice the number of cores.</span></span> <span data-ttu-id="a3331-537">Убедитесь, что выбранный размер виртуальной машины поддерживает необходимое количество дисков.</span><span class="sxs-lookup"><span data-stu-id="a3331-537">Ensure that the VM size you choose can support the number of disks needed.</span></span>

<span data-ttu-id="a3331-538">Помните, что диски хранилища класса «Премиум» обеспечивают более высокую производительность по сравнению с дисками хранилища класса «Стандартный».</span><span class="sxs-lookup"><span data-stu-id="a3331-538">Remember, the Premium Storage disks have higher performance capabilities compared to Standard Storage disks.</span></span> <span data-ttu-id="a3331-539">Таким образом, при переходе с использования для приложения виртуальной машины IaaS Azure хранилища класса «Стандартный» на хранилище класса «Премиум», скорее всего, для достижения того же или более высокого уровня производительности приложения потребуется меньшее количество дисков класса «Премиум».</span><span class="sxs-lookup"><span data-stu-id="a3331-539">Therefore, if you are migrating your application from Azure IaaS VM using Standard Storage to Premium Storage, you will likely need fewer premium disks to achieve the same or higher performance for your application.</span></span>

## <a name="disk-caching"></a><span data-ttu-id="a3331-540">Кэширование диска</span><span class="sxs-lookup"><span data-stu-id="a3331-540">Disk Caching</span></span>
<span data-ttu-id="a3331-541">В высокомасштабируемых виртуальных машинах, которые используют хранилище Azure класса «Премиум», применяется технология многоуровневого кэширования под названием BlobCache.</span><span class="sxs-lookup"><span data-stu-id="a3331-541">High Scale VMs that leverage Azure Premium Storage have a multi-tier caching technology called BlobCache.</span></span> <span data-ttu-id="a3331-542">При таком кэшировании используется ОЗУ виртуальной машины и локальный SSD.</span><span class="sxs-lookup"><span data-stu-id="a3331-542">BlobCache uses a combination of the Virtual Machine RAM and local SSD for caching.</span></span> <span data-ttu-id="a3331-543">Это кэширование доступно для постоянных дисков хранилища класса «Премиум» и локальных дисков виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="a3331-543">This cache is available for the Premium Storage persistent disks and the VM local disks.</span></span> <span data-ttu-id="a3331-544">По умолчанию для параметра кэширования задано значение Read/Write для дисков операционной системы и ReadOnly для дисков данных, размещенных в хранилище класса «Премиум».</span><span class="sxs-lookup"><span data-stu-id="a3331-544">By default, this cache setting is set to Read/Write for OS disks and ReadOnly for data disks hosted on Premium Storage.</span></span> <span data-ttu-id="a3331-545">Если активировать функцию кэширования диска для дисков хранилища класса «Премиум», можно добиться чрезвычайно высокого уровня производительности высокомасштабируемых виртуальных машин, который превысит базовый уровень производительности диска.</span><span class="sxs-lookup"><span data-stu-id="a3331-545">With disk caching enabled on the Premium Storage disks, the high scale VMs can achieve extremely high levels of performance that exceed the underlying disk performance.</span></span>

> [!WARNING]
> <span data-ttu-id="a3331-546">При изменении параметра кэша диска Azure целевой диск отключается, а затем вновь подключается к виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="a3331-546">Changing the cache setting of an Azure disk detaches and re-attaches the target disk.</span></span> <span data-ttu-id="a3331-547">Если это диск операционной системы, то виртуальная машина перезагрузится.</span><span class="sxs-lookup"><span data-stu-id="a3331-547">If it is the operating system disk, the VM is restarted.</span></span> <span data-ttu-id="a3331-548">Остановите все приложения и службы, работу которых может нарушить это событие, прежде чем изменять параметр кэша диска.</span><span class="sxs-lookup"><span data-stu-id="a3331-548">Stop all applications/services that might be affected by this disruption before changing the disk cache setting.</span></span>
>
>

<span data-ttu-id="a3331-549">Дополнительные сведения о работе BlobCache см. в записи блога [Хранилища Azure класса "Премиум"](https://azure.microsoft.com/blog/azure-premium-storage-now-generally-available-2/).</span><span class="sxs-lookup"><span data-stu-id="a3331-549">To learn more about how BlobCache works, refer to the Inside [Azure Premium Storage](https://azure.microsoft.com/blog/azure-premium-storage-now-generally-available-2/) blog post.</span></span>

<span data-ttu-id="a3331-550">Очень важно включить кэширование для правильного набора дисков.</span><span class="sxs-lookup"><span data-stu-id="a3331-550">It is important to enable cache on the right set of disks.</span></span> <span data-ttu-id="a3331-551">Необходимость включения функции кэширования диска для диска класса «Премиум» зависит от шаблона рабочей нагрузки, которую будет обрабатывать этот диск.</span><span class="sxs-lookup"><span data-stu-id="a3331-551">Whether you should enable disk caching on a premium disk or not will depend on the workload pattern that disk will be handling.</span></span> <span data-ttu-id="a3331-552">В следующей таблице приведены параметры кэширования по умолчанию для дисков операционной системы и дисков данных.</span><span class="sxs-lookup"><span data-stu-id="a3331-552">Table below shows the default cache settings for OS and Data disks.</span></span>

| <span data-ttu-id="a3331-553">**Тип диска**</span><span class="sxs-lookup"><span data-stu-id="a3331-553">**Disk Type**</span></span> | <span data-ttu-id="a3331-554">**Параметр кэширования по умолчанию**</span><span class="sxs-lookup"><span data-stu-id="a3331-554">**Default Cache Setting**</span></span> |
| --- | --- |
| <span data-ttu-id="a3331-555">Диск ОС</span><span class="sxs-lookup"><span data-stu-id="a3331-555">OS disk</span></span> |<span data-ttu-id="a3331-556">ReadWrite</span><span class="sxs-lookup"><span data-stu-id="a3331-556">ReadWrite</span></span> |
| <span data-ttu-id="a3331-557">Диск данных</span><span class="sxs-lookup"><span data-stu-id="a3331-557">Data disk</span></span> |<span data-ttu-id="a3331-558">None</span><span class="sxs-lookup"><span data-stu-id="a3331-558">None</span></span> |

<span data-ttu-id="a3331-559">Ниже приведены рекомендуемые параметры кэширования диска для дисков данных</span><span class="sxs-lookup"><span data-stu-id="a3331-559">Following are the recommended disk cache settings for data disks,</span></span>

| <span data-ttu-id="a3331-560">**Параметр кэширования диска**</span><span class="sxs-lookup"><span data-stu-id="a3331-560">**Disk Caching Setting**</span></span> | <span data-ttu-id="a3331-561">**Рекомендации по использованию этого параметра**</span><span class="sxs-lookup"><span data-stu-id="a3331-561">**Recommendation on when to use this setting**</span></span> |
| --- | --- |
| <span data-ttu-id="a3331-562">None</span><span class="sxs-lookup"><span data-stu-id="a3331-562">None</span></span> |<span data-ttu-id="a3331-563">Задайте для кэша узла значение None для дисков с высокой интенсивностью операций записи и дисков только для записи.</span><span class="sxs-lookup"><span data-stu-id="a3331-563">Configure host-cache as None for write-only and write-heavy disks.</span></span> |
| <span data-ttu-id="a3331-564">ReadOnly</span><span class="sxs-lookup"><span data-stu-id="a3331-564">ReadOnly</span></span> |<span data-ttu-id="a3331-565">Задайте для кэша узла значение ReadOnly для дисков, которые используются для чтения и записи или только для чтения.</span><span class="sxs-lookup"><span data-stu-id="a3331-565">Configure host-cache as ReadOnly for read-only and read-write disks.</span></span> |
| <span data-ttu-id="a3331-566">ReadWrite</span><span class="sxs-lookup"><span data-stu-id="a3331-566">ReadWrite</span></span> |<span data-ttu-id="a3331-567">Задайте для кэша узла значение ReadWrite, только если приложение правильно обрабатывает операции записи кэшированных данных на постоянные диски.</span><span class="sxs-lookup"><span data-stu-id="a3331-567">Configure host-cache as ReadWrite only if your application properly  handles writing cached data to persistent disks when needed.</span></span> |

<span data-ttu-id="a3331-568">*ReadOnly*</span><span class="sxs-lookup"><span data-stu-id="a3331-568">*ReadOnly*</span></span>  
<span data-ttu-id="a3331-569">Задав для кэширования значение ReadOnly для дисков данных хранилища класса «Премиум», можно достичь низкой задержки операций чтения и очень высокой скорости выполнения операций ввода-вывода и пропускной способности при чтении для приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-569">By configuring ReadOnly caching on Premium Storage data disks, you can achieve low Read latency and get very high Read IOPS and Throughput for your application.</span></span> <span data-ttu-id="a3331-570">Это происходит по двум причинам.</span><span class="sxs-lookup"><span data-stu-id="a3331-570">This is due two reasons,</span></span>

1. <span data-ttu-id="a3331-571">Выполнение операций чтения из кэша, который находится в памяти виртуальной машины и локального SSD, происходит намного быстрее, чем выполнение операций чтения с диска данных, который находится в хранилище BLOB-объектов Azure.</span><span class="sxs-lookup"><span data-stu-id="a3331-571">Reads performed from cache, which is on the VM memory and local SSD, are much faster than reads from the data disk, which is on the Azure blob storage.</span></span>  
2. <span data-ttu-id="a3331-572">В хранилище класса «Премиум» операции чтения, выполненные из кэша, не относятся к операциям ввода-вывода и пропускной способности диска.</span><span class="sxs-lookup"><span data-stu-id="a3331-572">Premium Storage does not count the Reads served from cache, towards the disk IOPS and Throughput.</span></span> <span data-ttu-id="a3331-573">Таким образом, приложение может выполнять больше операций ввода-вывода и достичь высокой пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="a3331-573">Therefore, your application is able to achieve higher total IOPS and Throughput.</span></span>

<span data-ttu-id="a3331-574">*ReadWrite*</span><span class="sxs-lookup"><span data-stu-id="a3331-574">*ReadWrite*</span></span>  
<span data-ttu-id="a3331-575">На дисках операционной системы по умолчанию задано значение кэширования ReadWrite.</span><span class="sxs-lookup"><span data-stu-id="a3331-575">By default, the OS disks have ReadWrite caching enabled.</span></span> <span data-ttu-id="a3331-576">Более того, с недавнего времени значение кэширования ReadWrite можно задать и для дисков данных.</span><span class="sxs-lookup"><span data-stu-id="a3331-576">We have recently added support for ReadWrite caching on data disks as well.</span></span> <span data-ttu-id="a3331-577">При использовании значения кэширования ReadWrite необходимо использовать правильный способ записи данных из кэша на постоянные диски.</span><span class="sxs-lookup"><span data-stu-id="a3331-577">If you are using ReadWrite caching, you must have a proper way to write the data from cache to persistent disks.</span></span> <span data-ttu-id="a3331-578">Например, SQL Server обрабатывает операции записи кэшированных данных на постоянные диски хранилища самостоятельно.</span><span class="sxs-lookup"><span data-stu-id="a3331-578">For example, SQL Server handles writing cached data to the persistent storage disks on its own.</span></span> <span data-ttu-id="a3331-579">Использование значения кэширования ReadWrite для приложения, которое не обеспечивает сохранение необходимых данных, может привести к потере данных в случае сбоя виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="a3331-579">Using ReadWrite cache with an application that does not handle persisting the required data can lead to data loss, if the VM crashes.</span></span>

<span data-ttu-id="a3331-580">Эти рекомендации можно применить для запуска SQL Server в хранилище класса «Премиум». Для этого нужно сделать следующее.</span><span class="sxs-lookup"><span data-stu-id="a3331-580">As an example, you can apply these guidelines to SQL Server running on Premium Storage by doing the following,</span></span>

1. <span data-ttu-id="a3331-581">Задайте для кэша значение ReadOnly для дисков хранилища уровня "Премиум", на которых размещены файлы данных.</span><span class="sxs-lookup"><span data-stu-id="a3331-581">Configure "ReadOnly" cache on premium storage disks hosting data files.</span></span>  
   <span data-ttu-id="a3331-582">а.</span><span class="sxs-lookup"><span data-stu-id="a3331-582">a.</span></span>  <span data-ttu-id="a3331-583">Благодаря быстрому выполнению операций чтения из кэша уменьшается время обработки запроса SQL Server, так как страницы данных извлекаются из кэша гораздо быстрее, чем непосредственно с дисков данных.</span><span class="sxs-lookup"><span data-stu-id="a3331-583">The fast reads from cache lower the SQL Server query time since data pages are retrieved much faster from the cache compared to directly from the data disks.</span></span>  
   <span data-ttu-id="a3331-584">b.</span><span class="sxs-lookup"><span data-stu-id="a3331-584">b.</span></span>  <span data-ttu-id="a3331-585">Если операции чтения выполняются из кэша, это означает, что диски с данными класса «Премиум» дают дополнительную пропускную способность.</span><span class="sxs-lookup"><span data-stu-id="a3331-585">Serving reads from cache, means there is additional Throughput available from premium data disks.</span></span> <span data-ttu-id="a3331-586">Ее можно использовать на SQL Server для извлечения большего количества страниц данных и выполнения других операций, таких как резервное копирование и восстановление, пакетные загрузки и перестройки индекса.</span><span class="sxs-lookup"><span data-stu-id="a3331-586">SQL Server can use this additional Throughput towards retrieving more data pages and other operations like backup/restore, batch loads, and index rebuilds.</span></span>  
2. <span data-ttu-id="a3331-587">Задайте для кэша значение None для дисков хранилища уровня "Премиум", на которых размещены файлы журнала.</span><span class="sxs-lookup"><span data-stu-id="a3331-587">Configure "None" cache on premium storage disks hosting the log files.</span></span>  
   <span data-ttu-id="a3331-588">а.</span><span class="sxs-lookup"><span data-stu-id="a3331-588">a.</span></span>  <span data-ttu-id="a3331-589">В файлах журнала преимущественно содержатся данные операций с высокой интенсивностью записи.</span><span class="sxs-lookup"><span data-stu-id="a3331-589">Log files have primarily write-heavy operations.</span></span> <span data-ttu-id="a3331-590">Поэтому на них никак не влияет использование кэша со значением ReadOnly.</span><span class="sxs-lookup"><span data-stu-id="a3331-590">Therefore, they do not benefit from the ReadOnly cache.</span></span>

## <a name="disk-striping"></a><span data-ttu-id="a3331-591">Чередование дисков</span><span class="sxs-lookup"><span data-stu-id="a3331-591">Disk Striping</span></span>
<span data-ttu-id="a3331-592">Если к высокомасштабируемой виртуальной машине подключены несколько постоянных дисков хранилища класса «Премиум», диски можно чередовать для объединения операций ввода-вывода, пропускной способности и объема хранилища.</span><span class="sxs-lookup"><span data-stu-id="a3331-592">When a high scale VM is attached with several premium storage persistent disks, the disks can be striped together to aggregate their IOPs, bandwidth, and storage capacity.</span></span>

<span data-ttu-id="a3331-593">Для чередования дисков в операционной системе Windows можно использовать дисковое пространство.</span><span class="sxs-lookup"><span data-stu-id="a3331-593">On Windows, you can use Storage Spaces to stripe disks together.</span></span> <span data-ttu-id="a3331-594">Для каждого диска в пуле необходимо настроить один столбец.</span><span class="sxs-lookup"><span data-stu-id="a3331-594">You must configure one column for each disk in a pool.</span></span> <span data-ttu-id="a3331-595">В противном случае общая производительность чередующегося тома может быть ниже ожидаемой из-за неравномерного распределения трафика между дисками.</span><span class="sxs-lookup"><span data-stu-id="a3331-595">Otherwise, the overall performance of striped volume can be lower than expected, due to uneven distribution of traffic across the disks.</span></span>

<span data-ttu-id="a3331-596">Важно! С помощью пользовательского интерфейса диспетчера сервера для чередующегося тома можно задать 8 столбцов.</span><span class="sxs-lookup"><span data-stu-id="a3331-596">Important: Using Server Manager UI, you can set the total number of columns up to 8 for a striped volume.</span></span> <span data-ttu-id="a3331-597">При подключении более 8 дисков используйте PowerShell для создания тома.</span><span class="sxs-lookup"><span data-stu-id="a3331-597">When attaching more than 8 disks, use PowerShell to create the volume.</span></span> <span data-ttu-id="a3331-598">С помощью PowerShell можно задать такое же количество столбцов, как и количество дисков.</span><span class="sxs-lookup"><span data-stu-id="a3331-598">Using PowerShell, you can set the number of columns equal to the number of disks.</span></span> <span data-ttu-id="a3331-599">Например, если в одном чередующемся наборе 16 дисков, укажите 16 столбцов для параметра *NumberOfColumns* командлета PowerShell *New-VirtualDisk*.</span><span class="sxs-lookup"><span data-stu-id="a3331-599">For example, if there are 16 disks in a single stripe set; specify 16 columns in the *NumberOfColumns* parameter of the *New-VirtualDisk* PowerShell cmdlet.</span></span>

<span data-ttu-id="a3331-600">В операционной системе Linux для чередования дисков используйте программу MDADM.</span><span class="sxs-lookup"><span data-stu-id="a3331-600">On Linux, use the MDADM utility to stripe disks together.</span></span> <span data-ttu-id="a3331-601">Подробные инструкции по чередованию дисков в Linux см. в статье [Настройка программного RAID-массива в Linux](../../virtual-machines/linux/configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="a3331-601">For detailed steps on striping disks on Linux refer to [Configure Software RAID on Linux](../../virtual-machines/linux/configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span></span>

<span data-ttu-id="a3331-602">*Размер блока чередования*</span><span class="sxs-lookup"><span data-stu-id="a3331-602">*Stripe Size*</span></span>  
<span data-ttu-id="a3331-603">При чередовании дисков размер блока чередования имеет большое значение.</span><span class="sxs-lookup"><span data-stu-id="a3331-603">An important configuration in disk striping is the stripe size.</span></span> <span data-ttu-id="a3331-604">Размер блока чередования или размер блока — это наименьший фрагмент данных, к которым может обратиться приложение в чередующемся томе.</span><span class="sxs-lookup"><span data-stu-id="a3331-604">The stripe size or block size is the smallest chunk of data that application can address on a striped volume.</span></span> <span data-ttu-id="a3331-605">Настраиваемый размер блока чередования зависит от типа приложения и шаблона запроса.</span><span class="sxs-lookup"><span data-stu-id="a3331-605">The stripe size you configure depends on the type of application and its request pattern.</span></span> <span data-ttu-id="a3331-606">Выбор неправильного размера блока чередования может привести к рассогласованию ввода-вывода, что, в свою очередь, влечет снижение производительности приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-606">If you choose the wrong stripe size, it could lead to IO misalignment, which leads to degraded performance of your application.</span></span>

<span data-ttu-id="a3331-607">Например, если размер созданного приложением запроса ввода-вывода больше размера блока чередования диска, система хранения запишет его на несколько дисков, выходя за пределы границ чередующейся единицы.</span><span class="sxs-lookup"><span data-stu-id="a3331-607">For example, if an IO request generated by your application is bigger than the disk stripe size, the storage system writes it across stripe unit boundaries on more than one disk.</span></span> <span data-ttu-id="a3331-608">При доступе к этим данным для выполнения запроса поиск будет осуществляться в нескольких чередующихся единицах.</span><span class="sxs-lookup"><span data-stu-id="a3331-608">When it is time to access that data, it will have to seek across more than one stripe units to complete the request.</span></span> <span data-ttu-id="a3331-609">В результате производительность может существенно снизиться.</span><span class="sxs-lookup"><span data-stu-id="a3331-609">The cumulative effect of such behavior can lead to substantial performance degradation.</span></span> <span data-ttu-id="a3331-610">Если же размер запроса ввода-вывода меньше размера блока чередования и сам запрос является случайным, запросы ввода-вывода будут добавляться на один и тот же диск. Как следствие, диск переполнится, что в конечном счете приведет к снижению производительности ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="a3331-610">On the other hand, if the IO request size is smaller than stripe size, and if it is random in nature, the IO requests may add up on the same disk causing a bottleneck and ultimately degrading the IO performance.</span></span>

<span data-ttu-id="a3331-611">Выберите подходящий размер блока чередования в зависимости от типа рабочей нагрузки приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-611">Depending on the type of workload your application is running, choose an appropriate stripe size.</span></span> <span data-ttu-id="a3331-612">Для случайных небольших запросов ввода-вывода следует использовать меньший размер блока чередования,</span><span class="sxs-lookup"><span data-stu-id="a3331-612">For random small IO requests, use a smaller stripe size.</span></span> <span data-ttu-id="a3331-613">а для больших последовательных запросов ввода-вывода — более крупный размер блока чередования.</span><span class="sxs-lookup"><span data-stu-id="a3331-613">Whereas, for large sequential IO requests use a larger stripe size.</span></span> <span data-ttu-id="a3331-614">Узнайте больше о рекомендациях по размеру блока чередования для приложения, которое будет запущено в хранилище класса «Премиум».</span><span class="sxs-lookup"><span data-stu-id="a3331-614">Find out the stripe size recommendations for the application you will be running on Premium Storage.</span></span> <span data-ttu-id="a3331-615">Дополнительную информацию см.</span><span class="sxs-lookup"><span data-stu-id="a3331-615">For SQL Server, configure stripe size of 64KB for OLTP workloads and 256KB for data warehousing workloads.</span></span> <span data-ttu-id="a3331-616">в статье [Рекомендации по оптимизации производительности SQL Server на виртуальных машинах Azure](../../virtual-machines/windows/sql/virtual-machines-windows-sql-performance.md#disks-guidance) .</span><span class="sxs-lookup"><span data-stu-id="a3331-616">See [Performance best practices for SQL Server on Azure VMs](../../virtual-machines/windows/sql/virtual-machines-windows-sql-performance.md#disks-guidance) to learn more.</span></span>

> [!NOTE]
> <span data-ttu-id="a3331-617">На виртуальной машине серии DS можно чередовать до 32 дисков хранилища класса «Премиум», а на виртуальной машине серии GS — до 64 дисков хранилища класса «Премиум».</span><span class="sxs-lookup"><span data-stu-id="a3331-617">You can stripe together a maximum of 32 premium storage disks on a DS series VM and 64 premium storage disks on a GS series VM.</span></span>
>
>

## <a name="multi-threading"></a><span data-ttu-id="a3331-618">Многопоточность</span><span class="sxs-lookup"><span data-stu-id="a3331-618">Multi-threading</span></span>
<span data-ttu-id="a3331-619">Платформа хранилища класса «Премиум» предназначена для массовой параллельной обработки.</span><span class="sxs-lookup"><span data-stu-id="a3331-619">Azure has designed Premium Storage platform to be massively parallel.</span></span> <span data-ttu-id="a3331-620">Так, многопоточное приложение обеспечивает более высокую производительность по сравнению с однопоточным приложением.</span><span class="sxs-lookup"><span data-stu-id="a3331-620">Therefore, a multi-threaded application achieves much higher performance than a single-threaded application.</span></span> <span data-ttu-id="a3331-621">Многопоточное приложение распределяет задачи между несколькими потоками, увеличивая эффективность их выполнения за счет максимального использования ресурсов виртуальной машины и диска.</span><span class="sxs-lookup"><span data-stu-id="a3331-621">A multi-threaded application splits up its tasks across multiple threads and increases efficiency of its execution by utilizing the VM and disk resources to the maximum.</span></span>

<span data-ttu-id="a3331-622">Например, если приложение запущено на одноядерной виртуальной машине с использованием двух потоков, для увеличения эффективности ЦП может переключаться между двумя потоками.</span><span class="sxs-lookup"><span data-stu-id="a3331-622">For example, if your application is running on a single core VM using two threads, the CPU can switch between the two threads to achieve efficiency.</span></span> <span data-ttu-id="a3331-623">В то время как один поток ожидает завершения дисковой операции ввода-вывода, ЦП может переключиться на другой поток.</span><span class="sxs-lookup"><span data-stu-id="a3331-623">While one thread is waiting on a disk IO to complete, the CPU can switch to the other thread.</span></span> <span data-ttu-id="a3331-624">Таким образом, используя два потока, можно выполнить намного больше задач, чем с использованием одного.</span><span class="sxs-lookup"><span data-stu-id="a3331-624">In this way, two threads can accomplish more than a single thread would.</span></span> <span data-ttu-id="a3331-625">Если у виртуальной машины несколько ядер, для выполнения задач требуется меньше времени, так как каждое ядро может выполнять задачи одновременно.</span><span class="sxs-lookup"><span data-stu-id="a3331-625">If the VM has more than one core, it further decreases running time since each core can execute tasks in parallel.</span></span>

<span data-ttu-id="a3331-626">Способ осуществления однопоточной или многопоточной обработки в готовом приложении изменить невозможно.</span><span class="sxs-lookup"><span data-stu-id="a3331-626">You may not be able to change the way an off-the-shelf application implements single threading or multi-threading.</span></span> <span data-ttu-id="a3331-627">Например, SQL Server может выполнять задачи, используя несколько процессоров и ядер.</span><span class="sxs-lookup"><span data-stu-id="a3331-627">For example, SQL Server is capable of handling multi-CPU and multi-core.</span></span> <span data-ttu-id="a3331-628">Однако способ обработки запроса SQL Server (с использованием одного или нескольких потоков) зависит от определенных условий.</span><span class="sxs-lookup"><span data-stu-id="a3331-628">However, SQL Server decides under what conditions it will leverage one or more threads to process a query.</span></span> <span data-ttu-id="a3331-629">С использованием многопоточности на этом сервере можно выполнять запросы и создавать индексы.</span><span class="sxs-lookup"><span data-stu-id="a3331-629">It can run queries and build indexes using multi-threading.</span></span> <span data-ttu-id="a3331-630">Для обработки запроса, который включает в себя объединение таблиц с большим объемом информации и сортировку данных перед возвращением пользователю, SQL Server, скорее всего, воспользуется несколькими потоками.</span><span class="sxs-lookup"><span data-stu-id="a3331-630">For a query that involves joining large tables and sorting data before returning to the user, SQL Server will likely use multiple threads.</span></span> <span data-ttu-id="a3331-631">Пользователь не может управлять тем, каким образом SQL Server будет обрабатывать запрос — с использованием одного потока или нескольких.</span><span class="sxs-lookup"><span data-stu-id="a3331-631">However, a user cannot control whether SQL Server executes a query using a single thread or multiple threads.</span></span>

<span data-ttu-id="a3331-632">Чтобы повлиять на многопоточность или параллельную обработку приложения, можно изменить некоторые параметры конфигурации.</span><span class="sxs-lookup"><span data-stu-id="a3331-632">There are configuration settings that you can alter to influence this multi-threading or parallel processing of an application.</span></span> <span data-ttu-id="a3331-633">Например, в случае с SQL Server используется конфигурация максимальной степени параллелизма.</span><span class="sxs-lookup"><span data-stu-id="a3331-633">For example, in case of SQL Server it is the maximum Degree of Parallelism configuration.</span></span> <span data-ttu-id="a3331-634">С помощью параметра MAXDOP возможна настройка максимального количества процессоров, которые может использовать SQL Server при параллельной обработке.</span><span class="sxs-lookup"><span data-stu-id="a3331-634">This setting called MAXDOP, allows you to configure the maximum number of processors SQL Server can use when parallel processing.</span></span> <span data-ttu-id="a3331-635">Этот параметр можно настроить для отдельных запросов и операций с индексами.</span><span class="sxs-lookup"><span data-stu-id="a3331-635">You can configure MAXDOP for individual queries or index operations.</span></span> <span data-ttu-id="a3331-636">Такая настройка полезна, если необходимо сбалансировать ресурсы системы для приложений, в работе которых производительность играет критически важную роль.</span><span class="sxs-lookup"><span data-stu-id="a3331-636">This is beneficial when you want to balance resources of your system for a performance critical application.</span></span>

<span data-ttu-id="a3331-637">Например, допустим, приложение, которое использует SQL Server, одновременно выполняет запрос большого размера и индексирование.</span><span class="sxs-lookup"><span data-stu-id="a3331-637">For example, say your application using SQL Server is executing a large query and an index operation at the same time.</span></span> <span data-ttu-id="a3331-638">Предположим также, что необходимо, чтобы индексирование выполнялось с более высоким уровнем производительности, чем запрос большого размера.</span><span class="sxs-lookup"><span data-stu-id="a3331-638">Let us assume that you wanted the index operation to be more performant compared to the large query.</span></span> <span data-ttu-id="a3331-639">В таком случае для индексирования можно задать более высокое значение MAXDOP, чем для запроса.</span><span class="sxs-lookup"><span data-stu-id="a3331-639">In such a case, you can set MAXDOP value of the index operation to be higher than the MAXDOP value for the query.</span></span> <span data-ttu-id="a3331-640">Тогда SQL Server сможет использовать больше процессоров для индексирования, чем он может выделить для запроса большого размера.</span><span class="sxs-lookup"><span data-stu-id="a3331-640">This way, SQL Server has more number of processors that it can leverage for the index operation compared to the number of processors it can dedicate to the large query.</span></span> <span data-ttu-id="a3331-641">Помните, что количество потоков, которые SQL Server будет использовать для каждой операции, не подлежит управлению.</span><span class="sxs-lookup"><span data-stu-id="a3331-641">Remember, you do not control the number of threads SQL Server will use for each operation.</span></span> <span data-ttu-id="a3331-642">Но можно управлять максимальным количеством процессоров, выделяемых для нескольких потоков.</span><span class="sxs-lookup"><span data-stu-id="a3331-642">You can control the maximum number of processors being dedicated for multi-threading.</span></span>

<span data-ttu-id="a3331-643">Дополнительные сведения см. в статье [Степень параллелизма](https://technet.microsoft.com/library/ms188611.aspx) в документации по SQL Server.</span><span class="sxs-lookup"><span data-stu-id="a3331-643">Learn more about [Degrees of Parallelism](https://technet.microsoft.com/library/ms188611.aspx) in SQL Server.</span></span> <span data-ttu-id="a3331-644">Узнайте, какие параметры влияют на многопоточность в приложении и какие значения этих параметров являются оптимальными для обеспечения производительности.</span><span class="sxs-lookup"><span data-stu-id="a3331-644">Find out such settings that influence multi-threading in your application and their configurations to optimize performance.</span></span>

## <a name="queue-depth"></a><span data-ttu-id="a3331-645">Длина очереди</span><span class="sxs-lookup"><span data-stu-id="a3331-645">Queue Depth</span></span>
<span data-ttu-id="a3331-646">Длина, глубина или размер очереди — это количество ожидающих запросов ввода-вывода в системе.</span><span class="sxs-lookup"><span data-stu-id="a3331-646">The Queue Depth or Queue Length or Queue Size is the number of pending IO requests in the system.</span></span> <span data-ttu-id="a3331-647">Значение длины очереди позволяет определить, сколько операций ввода-вывода приложение может поместить в очередь для их обработки дисками хранилища.</span><span class="sxs-lookup"><span data-stu-id="a3331-647">The value of Queue Depth determines how many IO operations your application can line up, which the storage disks will be processing.</span></span> <span data-ttu-id="a3331-648">Это значение влияет на все три показателя производительности приложения, которые рассматриваются в этой статье, а именно на операции ввода-вывода, пропускную способность и задержку.</span><span class="sxs-lookup"><span data-stu-id="a3331-648">It affects all the three application performance indicators that we discussed in this article viz., IOPS, Throughput and Latency.</span></span>

<span data-ttu-id="a3331-649">Длина очереди и многопоточность тесно связаны.</span><span class="sxs-lookup"><span data-stu-id="a3331-649">Queue Depth and multi-threading are closely related.</span></span> <span data-ttu-id="a3331-650">Значение длины очереди указывает, насколько многопоточным может быть приложение.</span><span class="sxs-lookup"><span data-stu-id="a3331-650">The Queue Depth value indicates how much multi-threading can be achieved by the application.</span></span> <span data-ttu-id="a3331-651">Чем длиннее очередь, тем больше одновременных операций может выполнять приложение. Другими словами, оно может выполнять больше потоков.</span><span class="sxs-lookup"><span data-stu-id="a3331-651">If the Queue Depth is large, application can execute more operations concurrently, in other words, more multi-threading.</span></span> <span data-ttu-id="a3331-652">Если длина очереди небольшая, даже многопоточное приложение не поместити в очередь достаточно запросов для параллельного выполнения.</span><span class="sxs-lookup"><span data-stu-id="a3331-652">If the Queue Depth is small, even though application is multi-threaded, it will not have enough requests lined up for concurrent execution.</span></span>

<span data-ttu-id="a3331-653">Обычно в готовых приложениях нельзя менять длину очереди, ведь если задать неправильное значение, это принесет больше вреда, чем пользы.</span><span class="sxs-lookup"><span data-stu-id="a3331-653">Typically, off the shelf applications do not allow you to change the queue depth, because if set incorrectly it will do more harm than good.</span></span> <span data-ttu-id="a3331-654">В приложениях задается правильное значение длины очереди для достижения оптимальной производительности.</span><span class="sxs-lookup"><span data-stu-id="a3331-654">Applications will set the right value of queue depth to get the optimal performance.</span></span> <span data-ttu-id="a3331-655">Тем не менее важно понимать, как это происходит, чтобы иметь возможность устранять проблемы с производительностью.</span><span class="sxs-lookup"><span data-stu-id="a3331-655">However, it is important to understand this concept so that you can troubleshoot performance issues with your application.</span></span> <span data-ttu-id="a3331-656">Кроме того, можно убедиться во влиянии длины очереди, запустив инструменты тестирования производительности в своей системе.</span><span class="sxs-lookup"><span data-stu-id="a3331-656">You can also observe the effects of queue depth by running benchmarking tools on your system.</span></span>

<span data-ttu-id="a3331-657">В некоторых приложениях доступны параметры, с помощью которых можно повлиять на длину очереди.</span><span class="sxs-lookup"><span data-stu-id="a3331-657">Some applications provide settings to influence the Queue Depth.</span></span> <span data-ttu-id="a3331-658">Например, MAXDOP (параметр максимальной степени параллелизма) в SQL Server, описанный в предыдущем разделе.</span><span class="sxs-lookup"><span data-stu-id="a3331-658">For example, the MAXDOP (maximum degree of parallelism) setting in SQL Server explained in previous section.</span></span> <span data-ttu-id="a3331-659">MAXDOP позволяет повлиять на длину очереди и многопоточность, но не меняет значение длины очереди SQL Server напрямую.</span><span class="sxs-lookup"><span data-stu-id="a3331-659">MAXDOP is a way to influence Queue Depth and multi-threading, although it does not directly change the Queue Depth value of SQL Server.</span></span>

<span data-ttu-id="a3331-660">*Высокое значение длины очереди*</span><span class="sxs-lookup"><span data-stu-id="a3331-660">*High Queue Depth*</span></span>  
<span data-ttu-id="a3331-661">Благодаря высокому значению длины в очередь на диске помещается больше операций.</span><span class="sxs-lookup"><span data-stu-id="a3331-661">A high queue depth lines up more operations on the disk.</span></span> <span data-ttu-id="a3331-662">Диску заранее известен следующий запрос очереди.</span><span class="sxs-lookup"><span data-stu-id="a3331-662">The disk knows the next request in its queue ahead of time.</span></span> <span data-ttu-id="a3331-663">Следовательно, операции на диске могут планироваться заранее и он может обрабатывать их в оптимальной последовательности.</span><span class="sxs-lookup"><span data-stu-id="a3331-663">Consequently, the disk can schedule operations ahead of time and process them in an optimal sequence.</span></span> <span data-ttu-id="a3331-664">Так как приложение отправляет на диск больше запросов, диск может обрабатывать больше параллельных операций ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="a3331-664">Since the application is sending more requests to the disk, the disk can process more parallel IOs.</span></span> <span data-ttu-id="a3331-665">В результате приложение сможет выполнять больше операций ввода-вывода в секунду.</span><span class="sxs-lookup"><span data-stu-id="a3331-665">Ultimately, the application will be able to achieve higher IOPS.</span></span> <span data-ttu-id="a3331-666">Обработка большего количества запросов также приводит к увеличению общей пропускной способности приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-666">Since application is processing more requests, the total Throughput of the application also increases.</span></span>

<span data-ttu-id="a3331-667">Как правило, приложение может достигать максимальной пропускной способности при наличии 8–16 и более ожидающих выполнения операций ввода-вывода на подключенный диск.</span><span class="sxs-lookup"><span data-stu-id="a3331-667">Typically, an application can achieve maximum Throughput with 8-16+ outstanding IOs per attached disk.</span></span> <span data-ttu-id="a3331-668">Если задать для длины очереди значение «1», приложение не будет отправлять достаточно операций ввода-вывода в систему и, следовательно, будет обрабатывать меньше операций за указанный период.</span><span class="sxs-lookup"><span data-stu-id="a3331-668">If a Queue Depth is one, application is not pushing enough IOs to the system, and it will process less amount of in a given period.</span></span> <span data-ttu-id="a3331-669">Другими словами, пропускная способность будет меньше.</span><span class="sxs-lookup"><span data-stu-id="a3331-669">In other words, less Throughput.</span></span>

<span data-ttu-id="a3331-670">Например, значение "4" для параметра MAXDOP запроса в SQL Server указывает на то, что для выполнения запроса можно использовать до четырех ядер.</span><span class="sxs-lookup"><span data-stu-id="a3331-670">For example, in SQL Server, setting the MAXDOP value for a query to "4" informs SQL Server that it can use up to four cores to execute the query.</span></span> <span data-ttu-id="a3331-671">SQL Server определит оптимальное значение длины очереди и количество ядер для выполнения запроса.</span><span class="sxs-lookup"><span data-stu-id="a3331-671">SQL Server will determine what is best queue depth value and the number of cores for the query execution.</span></span>

<span data-ttu-id="a3331-672">*Оптимальная длина очереди*</span><span class="sxs-lookup"><span data-stu-id="a3331-672">*Optimal Queue Depth*</span></span>  
<span data-ttu-id="a3331-673">Использование очень высокого значения длины очереди также имеет свои недостатки.</span><span class="sxs-lookup"><span data-stu-id="a3331-673">Very high queue depth value also has its drawbacks.</span></span> <span data-ttu-id="a3331-674">При таком значении приложение будет пытаться выполнить очень много операций ввода-вывода в секунду.</span><span class="sxs-lookup"><span data-stu-id="a3331-674">If queue depth value is too high, the application will try to drive very high IOPS.</span></span> <span data-ttu-id="a3331-675">Если приложение использует непостоянные диски с недостаточным количеством подготовленных операций ввода-вывода в секунду, это может отрицательно повлиять на задержку.</span><span class="sxs-lookup"><span data-stu-id="a3331-675">Unless application has persistent disks with sufficient provisioned IOPS, this can negatively affect application latencies.</span></span> <span data-ttu-id="a3331-676">Следующая формула демонстрирует взаимосвязь между количеством операций ввода-вывода в секунду, значением задержки и длиной очереди.</span><span class="sxs-lookup"><span data-stu-id="a3331-676">Following formula shows the relationship between IOPS, Latency and Queue Depth.</span></span>  
    ![](media/storage-premium-storage-performance/image6.png)

<span data-ttu-id="a3331-677">Для длины очереди не следует задавать высокое значение. Ее значение должно быть оптимальным и обеспечивать выполнение достаточного количества операций ввода-вывода в секунду для приложения, не влияя на задержку.</span><span class="sxs-lookup"><span data-stu-id="a3331-677">You should not configure Queue Depth to any high value, but to an optimal value, which can deliver enough IOPS for the application without affecting latencies.</span></span> <span data-ttu-id="a3331-678">Например, если задержка приложения должна составлять 1 миллисекунду, у длины очереди, необходимой для выполнения 5000 операций ввода-вывода в секунду, должно быть значение «5» (5000 x 0,001 = 5).</span><span class="sxs-lookup"><span data-stu-id="a3331-678">For example, if the application latency needs to be 1 millisecond, the Queue Depth required to achieve 5,000 IOPS is, QD = 5000 x 0.001 = 5.</span></span>

<span data-ttu-id="a3331-679">*Длина очереди чередующегося тома*</span><span class="sxs-lookup"><span data-stu-id="a3331-679">*Queue Depth for Striped Volume*</span></span>  
<span data-ttu-id="a3331-680">Для чередующегося тома следует использовать достаточно высокое значение длины очереди, чтобы у каждого диска было отдельное значение максимальной длины очереди.</span><span class="sxs-lookup"><span data-stu-id="a3331-680">For a striped volume, maintain a high enough queue depth such that, every disk has a peak queue depth individually.</span></span> <span data-ttu-id="a3331-681">Например, рассмотрим приложение, которое отправляет запросы в очередь со значением длины «2», при этом в блоке чередования находится 4 диска.</span><span class="sxs-lookup"><span data-stu-id="a3331-681">For example, consider an application that pushes a queue depth of 2 and there are 4 disks in the stripe.</span></span> <span data-ttu-id="a3331-682">В таком случае два запроса ввода-вывода будут отправляться на два диска, а остальные два диска будут простаивать.</span><span class="sxs-lookup"><span data-stu-id="a3331-682">The two IO requests will go to two disks and remaining two disks will be idle.</span></span> <span data-ttu-id="a3331-683">Поэтому настройте длину очереди так, чтобы диски не простаивали.</span><span class="sxs-lookup"><span data-stu-id="a3331-683">Therefore, configure the queue depth such that all the disks can be busy.</span></span> <span data-ttu-id="a3331-684">С помощью формулы ниже показано, как определить длину очереди для чередующихся томов.</span><span class="sxs-lookup"><span data-stu-id="a3331-684">Formula below shows how to determine the queue depth of striped volumes.</span></span>  
    ![](media/storage-premium-storage-performance/image7.png)

## <a name="throttling"></a><span data-ttu-id="a3331-685">Регулирование</span><span class="sxs-lookup"><span data-stu-id="a3331-685">Throttling</span></span>
<span data-ttu-id="a3331-686">Хранилище Azure класса «Премиум» позволяет подготовить указанное количество операций ввода-вывода в секунду и задать пропускную способность в зависимости от выбранного размера виртуальных машин и дисков.</span><span class="sxs-lookup"><span data-stu-id="a3331-686">Azure Premium Storage provisions specified number of IOPS and Throughput depending on the VM sizes and disk sizes you choose.</span></span> <span data-ttu-id="a3331-687">При каждой попытке приложения выполнить операции ввода-вывода или использовать пропускную способность за пределами ограничения обработки виртуальной машины или диска хранилище класса «Премиум» урегулирует эту проблему.</span><span class="sxs-lookup"><span data-stu-id="a3331-687">Anytime your application tries to drive IOPS or Throughput above these limits of what the VM or disk can handle, Premium Storage will throttle it.</span></span> <span data-ttu-id="a3331-688">Это ухудшает производительность приложения,</span><span class="sxs-lookup"><span data-stu-id="a3331-688">This manifests in the form of degraded performance in your application.</span></span> <span data-ttu-id="a3331-689">что выражается в повышенной задержке, низкой пропускной способности или меньшем количестве операций ввода-вывода в секунду.</span><span class="sxs-lookup"><span data-stu-id="a3331-689">This can mean higher latency, lower Throughput or lower IOPS.</span></span> <span data-ttu-id="a3331-690">Если хранилище класса «Премиум» не выполнит регулировку, может произойти сбой всего приложения, так как оно превысит максимальные значения, которых могут достичь его ресурсы.</span><span class="sxs-lookup"><span data-stu-id="a3331-690">If Premium Storage does not throttle, your application could completely fail by exceeding what its resources are capable of achieving.</span></span> <span data-ttu-id="a3331-691">Таким образом, чтобы избежать проблем с производительностью, связанных с регулированием, всегда следует подготавливать для приложения достаточно ресурсов.</span><span class="sxs-lookup"><span data-stu-id="a3331-691">So, to avoid performance issues due to throttling, always provision sufficient resources for your application.</span></span> <span data-ttu-id="a3331-692">Примите во внимание информацию о размерах виртуальных машин и дисков, приведенную в разделах выше.</span><span class="sxs-lookup"><span data-stu-id="a3331-692">Take into consideration what we discussed in the VM sizes and Disk sizes sections above.</span></span> <span data-ttu-id="a3331-693">Лучший способ выяснить, какие ресурсы необходимы для размещения приложения, — протестировать производительность.</span><span class="sxs-lookup"><span data-stu-id="a3331-693">Benchmarking is the best way to figure out what resources you will need to host your application.</span></span>

## <a name="benchmarking"></a><span data-ttu-id="a3331-694">Тестирование производительности</span><span class="sxs-lookup"><span data-stu-id="a3331-694">Benchmarking</span></span>
<span data-ttu-id="a3331-695">Тестирование производительности — это процесс моделирования различных рабочих нагрузок приложения и измерения его производительности при каждой из них.</span><span class="sxs-lookup"><span data-stu-id="a3331-695">Benchmarking is the process of simulating different workloads on your application and measuring the application performance for each workload.</span></span> <span data-ttu-id="a3331-696">Выполнив действия, описанные в предыдущем разделе, вы узнали требования к производительности приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-696">Using the steps described in an earlier section, you have gathered the application performance requirements.</span></span> <span data-ttu-id="a3331-697">Применив инструменты тестирования производительности в виртуальных машинах с приложением, можно определить уровень производительности, которого оно может достичь при использовании хранилища класса «Премиум».</span><span class="sxs-lookup"><span data-stu-id="a3331-697">By running benchmarking tools on the VMs hosting the application, you can determine the performance levels that your application can achieve with Premium Storage.</span></span> <span data-ttu-id="a3331-698">В этом разделе приведены примеры тестирования производительности виртуальной машины серии DS14 класса «Стандартный», для которой подготовлены диски хранилища класса «Премиум».</span><span class="sxs-lookup"><span data-stu-id="a3331-698">In this section, we provide you examples of benchmarking a Standard DS14 VM provisioned with Azure Premium Storage disks.</span></span>

<span data-ttu-id="a3331-699">Мы использовали стандартные инструменты тестирования производительности Iometer для Windows и FIO для Linux.</span><span class="sxs-lookup"><span data-stu-id="a3331-699">We have used common benchmarking tools Iometer and FIO, for Windows and Linux respectively.</span></span> <span data-ttu-id="a3331-700">Эти инструменты порождают несколько потоков, моделирующих производительность при рабочей нагрузке, и измеряют производительность системы.</span><span class="sxs-lookup"><span data-stu-id="a3331-700">These tools spawn multiple threads simulating a production like workload, and measure the system performance.</span></span> <span data-ttu-id="a3331-701">С помощью этих инструментов можно задать такие параметры, как размер блока и длина очереди, которые обычно нельзя менять в приложениях.</span><span class="sxs-lookup"><span data-stu-id="a3331-701">Using the tools you can also configure parameters like block size and queue depth, which you normally cannot change for an application.</span></span> <span data-ttu-id="a3331-702">Это обеспечивает большую гибкость для достижения максимальной производительности в высокомасштабируемых виртуальных машинах с подготовленными дисками класса «Премиум» для различных рабочих нагрузок приложения.</span><span class="sxs-lookup"><span data-stu-id="a3331-702">This gives you more flexibility to drive the maximum performance on a high scale VM provisioned with premium disks for different types of application workloads.</span></span> <span data-ttu-id="a3331-703">Дополнительные сведения о каждом инструменте измерения производительности см. на веб-сайте [Iometer](http://www.iometer.org/) и на странице [FIO](http://freecode.com/projects/fio).</span><span class="sxs-lookup"><span data-stu-id="a3331-703">To learn more about each benchmarking tool visit [Iometer](http://www.iometer.org/) and [FIO](http://freecode.com/projects/fio).</span></span>

<span data-ttu-id="a3331-704">Создайте виртуальную машину серии DS14 класса «Стандартный» и подключите к ней 11 дисков хранилища класса «Премиум» согласно примеру ниже.</span><span class="sxs-lookup"><span data-stu-id="a3331-704">To follow the examples below, create a Standard DS14 VM and attach 11 Premium Storage disks to the VM.</span></span> <span data-ttu-id="a3331-705">Для параметра кэширования узлов 10 из 11 дисков задайте значение None и чередуйте их в томе NoCacheWrites.</span><span class="sxs-lookup"><span data-stu-id="a3331-705">Of the 11 disks, configure 10 disks with host caching as "None" and stripe them into a volume called NoCacheWrites.</span></span> <span data-ttu-id="a3331-706">Для параметра кэширования оставшегося диска задайте значение ReadOnly и создайте том CacheReads с этим диском.</span><span class="sxs-lookup"><span data-stu-id="a3331-706">Configure host caching as "ReadOnly" on the remaining disk and create a volume called CacheReads with this disk.</span></span> <span data-ttu-id="a3331-707">Благодаря такой настройке можно узнать максимальное значение производительности виртуальной машины серии DS14 класса «Стандартный» при чтении и записи.</span><span class="sxs-lookup"><span data-stu-id="a3331-707">Using this setup, you will be able to see the maximum Read and Write performance from a Standard DS14 VM.</span></span> <span data-ttu-id="a3331-708">Подробные инструкции по созданию виртуальной машины DS14 с дисками уровня "Премиум" см. в разделе [Создание и использование учетной записи хранения класса "Премиум" для работы с дисками данных виртуальных машин](../storage-premium-storage.md).</span><span class="sxs-lookup"><span data-stu-id="a3331-708">For detailed steps about creating a DS14 VM with premium disks, go to [Create and use a Premium Storage account for a virtual machine data disk](../storage-premium-storage.md).</span></span>

<span data-ttu-id="a3331-709">*Подготовка кэша*</span><span class="sxs-lookup"><span data-stu-id="a3331-709">*Warming up the Cache*</span></span>  
<span data-ttu-id="a3331-710">Диск, для кэширования узла которого задано значение ReadOnly, сможет выполнять больше операций ввода-вывода в секунду, чем значение ограничения диска.</span><span class="sxs-lookup"><span data-stu-id="a3331-710">The disk with ReadOnly host caching will be able to give higher IOPS than the disk limit.</span></span> <span data-ttu-id="a3331-711">Чтобы добиться максимальной производительности при чтении для кэша узла, сначала необходимо подготовить кэш диска.</span><span class="sxs-lookup"><span data-stu-id="a3331-711">To get this maximum read performance from the host cache, first you must warm up the cache of this disk.</span></span> <span data-ttu-id="a3331-712">Это гарантирует, что операции ввода-вывода при чтении, которые инструмент тестирования производительности выполнит в томе CacheReads, на самом деле попадут в кэш, а не прямо на диск.</span><span class="sxs-lookup"><span data-stu-id="a3331-712">This ensures that the Read IOs which benchmarking tool will drive on CacheReads volume actually hits the cache and not the disk directly.</span></span> <span data-ttu-id="a3331-713">Попадания в кэш увеличат количество операций ввода-вывода на единственном диске, на котором включен кэш.</span><span class="sxs-lookup"><span data-stu-id="a3331-713">The cache hits result in additional IOPS from the single cache enabled disk.</span></span>

> <span data-ttu-id="a3331-714">**Важно!**</span><span class="sxs-lookup"><span data-stu-id="a3331-714">**Important:**</span></span>  
> <span data-ttu-id="a3331-715">После каждой перезагрузки виртуальной машины кэш необходимо подготавливать до тестирования производительности.</span><span class="sxs-lookup"><span data-stu-id="a3331-715">You must warm up the cache before running benchmarking, every time VM is rebooted.</span></span>
>
>

#### <a name="iometer"></a><span data-ttu-id="a3331-716">Iometer</span><span class="sxs-lookup"><span data-stu-id="a3331-716">Iometer</span></span>
<span data-ttu-id="a3331-717">[Скачайте инструмент Iometer](http://sourceforge.net/projects/iometer/files/iometer-stable/2006-07-27/iometer-2006.07.27.win32.i386-setup.exe/download) на виртуальную машину.</span><span class="sxs-lookup"><span data-stu-id="a3331-717">[Download the Iometer tool](http://sourceforge.net/projects/iometer/files/iometer-stable/2006-07-27/iometer-2006.07.27.win32.i386-setup.exe/download) on the VM.</span></span>

<span data-ttu-id="a3331-718">*Тестовый файл*</span><span class="sxs-lookup"><span data-stu-id="a3331-718">*Test file*</span></span>  
<span data-ttu-id="a3331-719">Инструмент Iometer использует тестовый файл, который хранится в томе, где будет выполняться тестирование производительности.</span><span class="sxs-lookup"><span data-stu-id="a3331-719">Iometer uses a test file that is stored on the volume on which you will run the benchmarking test.</span></span> <span data-ttu-id="a3331-720">Чтение и запись осуществляется в этот тестовый файл, что позволяет измерить количество операций ввода-вывода в секунду и пропускную способность диска.</span><span class="sxs-lookup"><span data-stu-id="a3331-720">It drives Reads and Writes on this test file to measure the disk IOPS and Throughput.</span></span> <span data-ttu-id="a3331-721">Если этот файл не указан, Iometer создаст его.</span><span class="sxs-lookup"><span data-stu-id="a3331-721">Iometer creates this test file if you have not provided one.</span></span> <span data-ttu-id="a3331-722">Создайте тестовый файл iobw.tst размером 200 ГБ в томах CacheReads и NoCacheWrites.</span><span class="sxs-lookup"><span data-stu-id="a3331-722">Create a 200GB test file called iobw.tst on the CacheReads and NoCacheWrites volumes.</span></span>

<span data-ttu-id="a3331-723">*Спецификации доступа*</span><span class="sxs-lookup"><span data-stu-id="a3331-723">*Access Specifications*</span></span>  
<span data-ttu-id="a3331-724">Спецификации, объем ввода-вывода запроса, процент операций чтения и записи, а также процент случайных и последовательных операций можно настроить на вкладке "Access Specifications" (Спецификации доступа) в Iometer.</span><span class="sxs-lookup"><span data-stu-id="a3331-724">The specifications, request IO size, % read/write, % random/sequential are configured using the "Access Specifications" tab in Iometer.</span></span> <span data-ttu-id="a3331-725">Создайте спецификацию доступа для каждого из описанных ниже сценариев.</span><span class="sxs-lookup"><span data-stu-id="a3331-725">Create an access specification for each of the scenarios described below.</span></span> <span data-ttu-id="a3331-726">Создайте спецификации доступа, задайте соответствующее имена, такие как RandomWrites\_8K и RandomReads\_8K, и нажмите кнопку "Сохранить".</span><span class="sxs-lookup"><span data-stu-id="a3331-726">Create the access specifications and "Save" with an appropriate name like – RandomWrites\_8K, RandomReads\_8K.</span></span> <span data-ttu-id="a3331-727">Выберите соответствующую спецификацию при выполнении сценария тестирования.</span><span class="sxs-lookup"><span data-stu-id="a3331-727">Select the corresponding specification when running the test scenario.</span></span>

<span data-ttu-id="a3331-728">Ниже приведен пример спецификаций доступа для сценария с максимальным количеством операций ввода-вывода в секунду при записи.</span><span class="sxs-lookup"><span data-stu-id="a3331-728">An example of access specifications for maximum Write IOPS scenario is shown below,</span></span>  
    ![](media/storage-premium-storage-performance/image8.png)

<span data-ttu-id="a3331-729">*Спецификации тестирования при максимальном количестве операций ввода-вывода в секунду*</span><span class="sxs-lookup"><span data-stu-id="a3331-729">*Maximum IOPS Test Specifications*</span></span>  
<span data-ttu-id="a3331-730">Чтобы продемонстрировать максимальное значение операций ввода-вывода в секунду, используйте запрос меньшего размера.</span><span class="sxs-lookup"><span data-stu-id="a3331-730">To demonstrate maximum IOPs, use smaller request size.</span></span> <span data-ttu-id="a3331-731">Используйте запрос размером 8 КБ и создайте спецификации для случайных операций записи и чтения.</span><span class="sxs-lookup"><span data-stu-id="a3331-731">Use 8K request size and create specifications for Random Writes and Reads.</span></span>

| <span data-ttu-id="a3331-732">Спецификация доступа</span><span class="sxs-lookup"><span data-stu-id="a3331-732">Access Specification</span></span> | <span data-ttu-id="a3331-733">Размер запроса</span><span class="sxs-lookup"><span data-stu-id="a3331-733">Request size</span></span> | <span data-ttu-id="a3331-734">Случайные, %</span><span class="sxs-lookup"><span data-stu-id="a3331-734">Random %</span></span> | <span data-ttu-id="a3331-735">Чтение, %</span><span class="sxs-lookup"><span data-stu-id="a3331-735">Read %</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="a3331-736">RandomWrites\_8K</span><span class="sxs-lookup"><span data-stu-id="a3331-736">RandomWrites\_8K</span></span> |<span data-ttu-id="a3331-737">8 КБ</span><span class="sxs-lookup"><span data-stu-id="a3331-737">8K</span></span> |<span data-ttu-id="a3331-738">100</span><span class="sxs-lookup"><span data-stu-id="a3331-738">100</span></span> |<span data-ttu-id="a3331-739">0</span><span class="sxs-lookup"><span data-stu-id="a3331-739">0</span></span> |
| <span data-ttu-id="a3331-740">RandomReads\_8K</span><span class="sxs-lookup"><span data-stu-id="a3331-740">RandomReads\_8K</span></span> |<span data-ttu-id="a3331-741">8 КБ</span><span class="sxs-lookup"><span data-stu-id="a3331-741">8K</span></span> |<span data-ttu-id="a3331-742">100</span><span class="sxs-lookup"><span data-stu-id="a3331-742">100</span></span> |<span data-ttu-id="a3331-743">100</span><span class="sxs-lookup"><span data-stu-id="a3331-743">100</span></span> |

<span data-ttu-id="a3331-744">*Спецификации тестирования максимальной пропускной способности*</span><span class="sxs-lookup"><span data-stu-id="a3331-744">*Maximum Throughput Test Specifications*</span></span>  
<span data-ttu-id="a3331-745">Чтобы продемонстрировать максимальную пропускную способность, используйте запрос большего размера.</span><span class="sxs-lookup"><span data-stu-id="a3331-745">To demonstrate maximum Throughput, use larger request size.</span></span> <span data-ttu-id="a3331-746">Используйте запрос размером 64 КБ и создайте спецификации для случайных операций записи и чтения.</span><span class="sxs-lookup"><span data-stu-id="a3331-746">Use 64K request size and create specifications for Random Writes and Reads.</span></span>

| <span data-ttu-id="a3331-747">Спецификация доступа</span><span class="sxs-lookup"><span data-stu-id="a3331-747">Access Specification</span></span> | <span data-ttu-id="a3331-748">Размер запроса</span><span class="sxs-lookup"><span data-stu-id="a3331-748">Request size</span></span> | <span data-ttu-id="a3331-749">Случайные, %</span><span class="sxs-lookup"><span data-stu-id="a3331-749">Random %</span></span> | <span data-ttu-id="a3331-750">Чтение, %</span><span class="sxs-lookup"><span data-stu-id="a3331-750">Read %</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="a3331-751">RandomWrites\_64K</span><span class="sxs-lookup"><span data-stu-id="a3331-751">RandomWrites\_64K</span></span> |<span data-ttu-id="a3331-752">64 КБ</span><span class="sxs-lookup"><span data-stu-id="a3331-752">64K</span></span> |<span data-ttu-id="a3331-753">100</span><span class="sxs-lookup"><span data-stu-id="a3331-753">100</span></span> |<span data-ttu-id="a3331-754">0</span><span class="sxs-lookup"><span data-stu-id="a3331-754">0</span></span> |
| <span data-ttu-id="a3331-755">RandomReads\_64K</span><span class="sxs-lookup"><span data-stu-id="a3331-755">RandomReads\_64K</span></span> |<span data-ttu-id="a3331-756">64 КБ</span><span class="sxs-lookup"><span data-stu-id="a3331-756">64K</span></span> |<span data-ttu-id="a3331-757">100</span><span class="sxs-lookup"><span data-stu-id="a3331-757">100</span></span> |<span data-ttu-id="a3331-758">100</span><span class="sxs-lookup"><span data-stu-id="a3331-758">100</span></span> |

<span data-ttu-id="a3331-759">*Выполнение теста Iometer*</span><span class="sxs-lookup"><span data-stu-id="a3331-759">*Running the Iometer Test*</span></span>  
<span data-ttu-id="a3331-760">Выполните следующие шаги, чтобы подготовить кэш.</span><span class="sxs-lookup"><span data-stu-id="a3331-760">Perform the steps below to warm up cache</span></span>

1. <span data-ttu-id="a3331-761">Создайте две спецификации доступа со значениями, указанными ниже.</span><span class="sxs-lookup"><span data-stu-id="a3331-761">Create two access specifications with values shown below,</span></span>

   | <span data-ttu-id="a3331-762">Имя</span><span class="sxs-lookup"><span data-stu-id="a3331-762">Name</span></span> | <span data-ttu-id="a3331-763">Размер запроса</span><span class="sxs-lookup"><span data-stu-id="a3331-763">Request size</span></span> | <span data-ttu-id="a3331-764">Случайные, %</span><span class="sxs-lookup"><span data-stu-id="a3331-764">Random %</span></span> | <span data-ttu-id="a3331-765">Чтение, %</span><span class="sxs-lookup"><span data-stu-id="a3331-765">Read %</span></span> |
   | --- | --- | --- | --- |
   | <span data-ttu-id="a3331-766">RandomWrites\_1MB</span><span class="sxs-lookup"><span data-stu-id="a3331-766">RandomWrites\_1MB</span></span> |<span data-ttu-id="a3331-767">1MB</span><span class="sxs-lookup"><span data-stu-id="a3331-767">1MB</span></span> |<span data-ttu-id="a3331-768">100</span><span class="sxs-lookup"><span data-stu-id="a3331-768">100</span></span> |<span data-ttu-id="a3331-769">0</span><span class="sxs-lookup"><span data-stu-id="a3331-769">0</span></span> |
   | <span data-ttu-id="a3331-770">RandomReads\_1MB</span><span class="sxs-lookup"><span data-stu-id="a3331-770">RandomReads\_1MB</span></span> |<span data-ttu-id="a3331-771">1MB</span><span class="sxs-lookup"><span data-stu-id="a3331-771">1MB</span></span> |<span data-ttu-id="a3331-772">100</span><span class="sxs-lookup"><span data-stu-id="a3331-772">100</span></span> |<span data-ttu-id="a3331-773">100</span><span class="sxs-lookup"><span data-stu-id="a3331-773">100</span></span> |
2. <span data-ttu-id="a3331-774">Запустите тест Iometer, чтобы инициализировать диск с кэшем со следующими параметрами.</span><span class="sxs-lookup"><span data-stu-id="a3331-774">Run the Iometer test for initializing cache disk with following parameters.</span></span> <span data-ttu-id="a3331-775">Используйте три рабочих потока для целевого тома и задайте значение «128» для длины очереди.</span><span class="sxs-lookup"><span data-stu-id="a3331-775">Use three worker threads for the target volume and a queue depth of 128.</span></span> <span data-ttu-id="a3331-776">На вкладке "Test Setup" (Настройка теста) для параметра "Run time" (Время выполнения) установите длительность 2 ч.</span><span class="sxs-lookup"><span data-stu-id="a3331-776">Set the "Run time" duration of the test to 2hrs on the "Test Setup" tab.</span></span>

   | <span data-ttu-id="a3331-777">Сценарий</span><span class="sxs-lookup"><span data-stu-id="a3331-777">Scenario</span></span> | <span data-ttu-id="a3331-778">Целевой том</span><span class="sxs-lookup"><span data-stu-id="a3331-778">Target Volume</span></span> | <span data-ttu-id="a3331-779">Имя</span><span class="sxs-lookup"><span data-stu-id="a3331-779">Name</span></span> | <span data-ttu-id="a3331-780">Длительность</span><span class="sxs-lookup"><span data-stu-id="a3331-780">Duration</span></span> |
   | --- | --- | --- | --- |
   | <span data-ttu-id="a3331-781">Инициализация диска с кэшем</span><span class="sxs-lookup"><span data-stu-id="a3331-781">Initialize Cache Disk</span></span> |<span data-ttu-id="a3331-782">CacheReads</span><span class="sxs-lookup"><span data-stu-id="a3331-782">CacheReads</span></span> |<span data-ttu-id="a3331-783">RandomWrites\_1MB</span><span class="sxs-lookup"><span data-stu-id="a3331-783">RandomWrites\_1MB</span></span> |<span data-ttu-id="a3331-784">2 ч</span><span class="sxs-lookup"><span data-stu-id="a3331-784">2hrs</span></span> |
3. <span data-ttu-id="a3331-785">Запустите тест Iometer, чтобы подготовить кэш на диске со следующими параметрами.</span><span class="sxs-lookup"><span data-stu-id="a3331-785">Run the Iometer test for warming up cache disk with following parameters.</span></span> <span data-ttu-id="a3331-786">Используйте три рабочих потока для целевого тома и задайте значение «128» для длины очереди.</span><span class="sxs-lookup"><span data-stu-id="a3331-786">Use three worker threads for the target volume and a queue depth of 128.</span></span> <span data-ttu-id="a3331-787">На вкладке "Test Setup" (Настройка теста) для параметра "Run time" (Время выполнения) установите длительность 2 ч.</span><span class="sxs-lookup"><span data-stu-id="a3331-787">Set the "Run time" duration of the test to 2hrs on the "Test Setup" tab.</span></span>

   | <span data-ttu-id="a3331-788">Сценарий</span><span class="sxs-lookup"><span data-stu-id="a3331-788">Scenario</span></span> | <span data-ttu-id="a3331-789">Целевой том</span><span class="sxs-lookup"><span data-stu-id="a3331-789">Target Volume</span></span> | <span data-ttu-id="a3331-790">Имя</span><span class="sxs-lookup"><span data-stu-id="a3331-790">Name</span></span> | <span data-ttu-id="a3331-791">Длительность</span><span class="sxs-lookup"><span data-stu-id="a3331-791">Duration</span></span> |
   | --- | --- | --- | --- |
   | <span data-ttu-id="a3331-792">Подготовка диска с кэшем</span><span class="sxs-lookup"><span data-stu-id="a3331-792">Warm up Cache Disk</span></span> |<span data-ttu-id="a3331-793">CacheReads</span><span class="sxs-lookup"><span data-stu-id="a3331-793">CacheReads</span></span> |<span data-ttu-id="a3331-794">RandomReads\_1MB</span><span class="sxs-lookup"><span data-stu-id="a3331-794">RandomReads\_1MB</span></span> |<span data-ttu-id="a3331-795">2 ч</span><span class="sxs-lookup"><span data-stu-id="a3331-795">2hrs</span></span> |

<span data-ttu-id="a3331-796">После подготовки диска с кэшем выполните сценарии тестирования, перечисленные ниже.</span><span class="sxs-lookup"><span data-stu-id="a3331-796">After cache disk is warmed up, proceed with the test scenarios listed below.</span></span> <span data-ttu-id="a3331-797">Чтобы выполнить тест Iometer, используйте по крайней мере три рабочих потока для **каждого** целевого тома.</span><span class="sxs-lookup"><span data-stu-id="a3331-797">To run the Iometer test, use at least three worker threads for **each** target volume.</span></span> <span data-ttu-id="a3331-798">Для каждого рабочего потока выберите целевой том, задайте длину очереди, а затем выберите одну из сохраненных спецификаций тестирования, указанных в следующей таблице, чтобы выполнить соответствующий сценарий тестирования.</span><span class="sxs-lookup"><span data-stu-id="a3331-798">For each worker thread, select the target volume, set queue depth and select one of the saved test specifications, as shown in the table below, to run the corresponding test scenario.</span></span> <span data-ttu-id="a3331-799">В таблице ниже также приведены ожидаемые результаты для значений количества операций ввода-вывода в секунду и пропускной способности при выполнении этих тестов.</span><span class="sxs-lookup"><span data-stu-id="a3331-799">The table also shows expected results for IOPS and Throughput when running these tests.</span></span> <span data-ttu-id="a3331-800">Во всех сценариях используется небольшой объем ввода-вывода, 8 КБ, и высокое значение длины очереди, «128».</span><span class="sxs-lookup"><span data-stu-id="a3331-800">For all scenarios, a small IO size of 8KB and a high queue depth of 128 is used.</span></span>

| <span data-ttu-id="a3331-801">Сценарий тестирования</span><span class="sxs-lookup"><span data-stu-id="a3331-801">Test Scenario</span></span> | <span data-ttu-id="a3331-802">Целевой том</span><span class="sxs-lookup"><span data-stu-id="a3331-802">Target Volume</span></span> | <span data-ttu-id="a3331-803">Имя</span><span class="sxs-lookup"><span data-stu-id="a3331-803">Name</span></span> | <span data-ttu-id="a3331-804">Результат</span><span class="sxs-lookup"><span data-stu-id="a3331-804">Result</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="a3331-805">Макс.</span><span class="sxs-lookup"><span data-stu-id="a3331-805">Max.</span></span> <span data-ttu-id="a3331-806">количество операций вода-вывода в секунду при чтении</span><span class="sxs-lookup"><span data-stu-id="a3331-806">Read IOPS</span></span> |<span data-ttu-id="a3331-807">CacheReads</span><span class="sxs-lookup"><span data-stu-id="a3331-807">CacheReads</span></span> |<span data-ttu-id="a3331-808">RandomWrites\_8K</span><span class="sxs-lookup"><span data-stu-id="a3331-808">RandomWrites\_8K</span></span> |<span data-ttu-id="a3331-809">50 000 операций ввода-вывода в секунду </span><span class="sxs-lookup"><span data-stu-id="a3331-809">50,000 IOPS</span></span> |
| <span data-ttu-id="a3331-810">Макс.</span><span class="sxs-lookup"><span data-stu-id="a3331-810">Max.</span></span> <span data-ttu-id="a3331-811">количество операций вода-вывода в секунду при записи</span><span class="sxs-lookup"><span data-stu-id="a3331-811">Write IOPS</span></span> |<span data-ttu-id="a3331-812">NoCacheWrites</span><span class="sxs-lookup"><span data-stu-id="a3331-812">NoCacheWrites</span></span> |<span data-ttu-id="a3331-813">RandomReads\_8K</span><span class="sxs-lookup"><span data-stu-id="a3331-813">RandomReads\_8K</span></span> |<span data-ttu-id="a3331-814">64 000 операций ввода-вывода в секунду</span><span class="sxs-lookup"><span data-stu-id="a3331-814">64,000 IOPS</span></span> |
| <span data-ttu-id="a3331-815">Макс.</span><span class="sxs-lookup"><span data-stu-id="a3331-815">Max.</span></span> <span data-ttu-id="a3331-816">количество объединенных операций ввода-вывода в секунду</span><span class="sxs-lookup"><span data-stu-id="a3331-816">Combined IOPS</span></span> |<span data-ttu-id="a3331-817">CacheReads</span><span class="sxs-lookup"><span data-stu-id="a3331-817">CacheReads</span></span> |<span data-ttu-id="a3331-818">RandomWrites\_8K</span><span class="sxs-lookup"><span data-stu-id="a3331-818">RandomWrites\_8K</span></span> |<span data-ttu-id="a3331-819">100 000 операций ввода-вывода в секунду</span><span class="sxs-lookup"><span data-stu-id="a3331-819">100,000 IOPS</span></span> |
| <span data-ttu-id="a3331-820">NoCacheWrites</span><span class="sxs-lookup"><span data-stu-id="a3331-820">NoCacheWrites</span></span> |<span data-ttu-id="a3331-821">RandomReads\_8K</span><span class="sxs-lookup"><span data-stu-id="a3331-821">RandomReads\_8K</span></span> | &nbsp; | &nbsp; |
| <span data-ttu-id="a3331-822">Макс.</span><span class="sxs-lookup"><span data-stu-id="a3331-822">Max.</span></span> <span data-ttu-id="a3331-823">скорость чтения, МБ/с</span><span class="sxs-lookup"><span data-stu-id="a3331-823">Read MB/sec</span></span> |<span data-ttu-id="a3331-824">CacheReads</span><span class="sxs-lookup"><span data-stu-id="a3331-824">CacheReads</span></span> |<span data-ttu-id="a3331-825">RandomWrites\_64K</span><span class="sxs-lookup"><span data-stu-id="a3331-825">RandomWrites\_64K</span></span> |<span data-ttu-id="a3331-826">524 МБ/с</span><span class="sxs-lookup"><span data-stu-id="a3331-826">524 MB/sec</span></span> |
| <span data-ttu-id="a3331-827">Макс.</span><span class="sxs-lookup"><span data-stu-id="a3331-827">Max.</span></span> <span data-ttu-id="a3331-828">скорость записи, МБ/с</span><span class="sxs-lookup"><span data-stu-id="a3331-828">Write MB/sec</span></span> |<span data-ttu-id="a3331-829">NoCacheWrites</span><span class="sxs-lookup"><span data-stu-id="a3331-829">NoCacheWrites</span></span> |<span data-ttu-id="a3331-830">RandomReads\_64K</span><span class="sxs-lookup"><span data-stu-id="a3331-830">RandomReads\_64K</span></span> |<span data-ttu-id="a3331-831">524 МБ/с</span><span class="sxs-lookup"><span data-stu-id="a3331-831">524 MB/sec</span></span> |
| <span data-ttu-id="a3331-832">Скорость объединенных операций, МБ/с</span><span class="sxs-lookup"><span data-stu-id="a3331-832">Combined MB/sec</span></span> |<span data-ttu-id="a3331-833">CacheReads</span><span class="sxs-lookup"><span data-stu-id="a3331-833">CacheReads</span></span> |<span data-ttu-id="a3331-834">RandomWrites\_64K</span><span class="sxs-lookup"><span data-stu-id="a3331-834">RandomWrites\_64K</span></span> |<span data-ttu-id="a3331-835">1000 МБ/с</span><span class="sxs-lookup"><span data-stu-id="a3331-835">1000 MB/sec</span></span> |
| <span data-ttu-id="a3331-836">NoCacheWrites</span><span class="sxs-lookup"><span data-stu-id="a3331-836">NoCacheWrites</span></span> |<span data-ttu-id="a3331-837">RandomReads\_64K</span><span class="sxs-lookup"><span data-stu-id="a3331-837">RandomReads\_64K</span></span> | &nbsp; | &nbsp; |

<span data-ttu-id="a3331-838">Ниже приведены снимки экрана Iometer с результатами теста для сценариев, где используются объединенные операций ввода-вывода в секунду и пропускная способность.</span><span class="sxs-lookup"><span data-stu-id="a3331-838">Below are screenshots of the Iometer test results for combined IOPS and Throughput scenarios.</span></span>

<span data-ttu-id="a3331-839">*Максимальное количество операций ввода-вывода в секунду при объединенных операциях чтения и записи*</span><span class="sxs-lookup"><span data-stu-id="a3331-839">*Combined Reads and Writes Maximum IOPS*</span></span>  
![](media/storage-premium-storage-performance/image9.png)

<span data-ttu-id="a3331-840">*Максимальная пропускная способность при объединенных операциях чтения и записи*</span><span class="sxs-lookup"><span data-stu-id="a3331-840">*Combined Reads and Writes Maximum Throughput*</span></span>  
![](media/storage-premium-storage-performance/image10.png)

### <a name="fio"></a><span data-ttu-id="a3331-841">FIO</span><span class="sxs-lookup"><span data-stu-id="a3331-841">FIO</span></span>
<span data-ttu-id="a3331-842">FIO — это популярный инструмент для тестирования производительности хранилища виртуальных машин под управлением Linux.</span><span class="sxs-lookup"><span data-stu-id="a3331-842">FIO is a popular tool to benchmark storage on the Linux VMs.</span></span> <span data-ttu-id="a3331-843">Благодаря своей гибкости он позволяет выбрать различные объемы ввода-вывода, а также порядок выполнения операций чтения и записи — последовательный или случайный.</span><span class="sxs-lookup"><span data-stu-id="a3331-843">It has the flexibility to select different IO sizes, sequential or random reads and writes.</span></span> <span data-ttu-id="a3331-844">Он порождает рабочие потоки или процессы для выполнения указанных операций ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="a3331-844">It spawns worker threads or processes to perform the specified I/O operations.</span></span> <span data-ttu-id="a3331-845">Можно указать тип операций ввода-вывода, которые должен выполнять каждый рабочий поток, используя файлы заданий.</span><span class="sxs-lookup"><span data-stu-id="a3331-845">You can specify the type of I/O operations each worker thread must perform using job files.</span></span> <span data-ttu-id="a3331-846">В примерах ниже продемонстрирован один файл задания для каждого сценария.</span><span class="sxs-lookup"><span data-stu-id="a3331-846">We created one job file per scenario illustrated in the examples below.</span></span> <span data-ttu-id="a3331-847">Можно менять спецификации в этих файлах заданий, чтобы тестировать производительность при различных рабочих нагрузках хранилища класса «Премиум».</span><span class="sxs-lookup"><span data-stu-id="a3331-847">You can change the specifications in these job files to benchmark different workloads running on Premium Storage.</span></span> <span data-ttu-id="a3331-848">В примерах используется виртуальная машина серии DS14 класса «Стандартный» под управлением **Ubuntu**.</span><span class="sxs-lookup"><span data-stu-id="a3331-848">In the examples, we are using a Standard DS 14 VM running **Ubuntu**.</span></span> <span data-ttu-id="a3331-849">Прежде чем выполнить тестирование производительности, настройте параметры в соответствии с указаниями в начале раздела [Измерение производительности](#Benchmarking) и подготовьте кэш.</span><span class="sxs-lookup"><span data-stu-id="a3331-849">Use the same setup described in the beginning of the [Benchmarking section](#Benchmarking) and warm up the cache before running the benchmarking tests.</span></span>

<span data-ttu-id="a3331-850">Прежде чем начать, [скачайте FIO](https://github.com/axboe/fio) и установите его на виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="a3331-850">Before you begin, [download FIO](https://github.com/axboe/fio) and install it on your virtual machine.</span></span>

<span data-ttu-id="a3331-851">В ОС Ubuntu выполните следующую команду:</span><span class="sxs-lookup"><span data-stu-id="a3331-851">Run the following command for Ubuntu,</span></span>

```
apt-get install fio
```

<span data-ttu-id="a3331-852">Мы будем использовать четыре рабочих потока для выполнения операций записи и еще четыре для операций чтения на дисках.</span><span class="sxs-lookup"><span data-stu-id="a3331-852">We will use four worker threads for driving Write operations and four worker threads for driving Read operations on the disks.</span></span> <span data-ttu-id="a3331-853">Для рабочих потоков операций записи будет использоваться трафик в томе nocache, в котором для значения кэша 10 дисков задано значение None.</span><span class="sxs-lookup"><span data-stu-id="a3331-853">The Write workers will be driving traffic on the "nocache" volume, which has 10 disks with cache set to "None".</span></span> <span data-ttu-id="a3331-854">Для рабочих потоков операций чтения будет использоваться трафик в томе readcache, в котором для значения кэша 1 диска задано значение ReadOnly.</span><span class="sxs-lookup"><span data-stu-id="a3331-854">The Read workers will be driving traffic on the "readcache" volume, which has 1 disk with cache set to "ReadOnly".</span></span>

<span data-ttu-id="a3331-855">*Максимальное количество операций ввода-вывода в секунду при записи*</span><span class="sxs-lookup"><span data-stu-id="a3331-855">*Maximum Write IOPS*</span></span>  
<span data-ttu-id="a3331-856">Чтобы добиться максимального количества операций ввода-вывода в секунду при записи, создайте файл задания со следующими спецификациями.</span><span class="sxs-lookup"><span data-stu-id="a3331-856">Create the job file with following specifications to get maximum Write IOPS.</span></span> <span data-ttu-id="a3331-857">Назовите файл fiowrite.ini.</span><span class="sxs-lookup"><span data-stu-id="a3331-857">Name it "fiowrite.ini".</span></span>

```
[global]
size=30g
direct=1
iodepth=256
ioengine=libaio
bs=8k

[writer1]
rw=randwrite
directory=/mnt/nocache
[writer2]
rw=randwrite
directory=/mnt/nocache
[writer3]
rw=randwrite
directory=/mnt/nocache
[writer4]
rw=randwrite
directory=/mnt/nocache
```

<span data-ttu-id="a3331-858">Обратите внимание на следующие ключевые аспекты, которые согласованы с рекомендациями по разработке, описанными в предыдущих разделах.</span><span class="sxs-lookup"><span data-stu-id="a3331-858">Note the follow key things that are in line with the design guidelines discussed in previous sections.</span></span> <span data-ttu-id="a3331-859">Эти спецификации необходимы для выполнения максимального количества операций ввода-вывода в секунду:</span><span class="sxs-lookup"><span data-stu-id="a3331-859">These specifications are essential to drive maximum IOPS,</span></span>  

* <span data-ttu-id="a3331-860">высокое значение длины очереди: 256;</span><span class="sxs-lookup"><span data-stu-id="a3331-860">A high queue depth of 256.</span></span>  
* <span data-ttu-id="a3331-861">небольшой размер блока: 8 КБ;</span><span class="sxs-lookup"><span data-stu-id="a3331-861">A small block size of 8KB.</span></span>  
* <span data-ttu-id="a3331-862">несколько потоков, выполняющих случайные операции записи.</span><span class="sxs-lookup"><span data-stu-id="a3331-862">Multiple threads performing random writes.</span></span>

<span data-ttu-id="a3331-863">Выполните следующую команду, чтобы запустить тест FIO на 30 секунд:</span><span class="sxs-lookup"><span data-stu-id="a3331-863">Run the following command to kick off the FIO test for 30 seconds,</span></span>  

```
sudo fio --runtime 30 fiowrite.ini
```

<span data-ttu-id="a3331-864">Во время тестирования можно узнать количество операций ввода-вывода в секунду при записи, которое обеспечивают виртуальная машина и диски класса «Премиум».</span><span class="sxs-lookup"><span data-stu-id="a3331-864">While the test runs, you will be able to see the number of write IOPS the VM and Premium disks are delivering.</span></span> <span data-ttu-id="a3331-865">Как показано в примере ниже, максимальное количество операций ввода-вывода в секунду при записи, выполняемых виртуальной машиной DS14, — 50 000.</span><span class="sxs-lookup"><span data-stu-id="a3331-865">As shown in the sample below, the DS14 VM is delivering its maximum write IOPS limit of 50,000 IOPS.</span></span>  
    ![](media/storage-premium-storage-performance/image11.png)

<span data-ttu-id="a3331-866">*Максимальное количество операций ввода-вывода при чтении*</span><span class="sxs-lookup"><span data-stu-id="a3331-866">*Maximum Read IOPS*</span></span>  
<span data-ttu-id="a3331-867">Чтобы добиться максимального значения операций ввода-вывода при чтении, создайте файл задания со следующими спецификациями.</span><span class="sxs-lookup"><span data-stu-id="a3331-867">Create the job file with following specifications to get maximum Read IOPS.</span></span> <span data-ttu-id="a3331-868">Назовите файл fioread.ini.</span><span class="sxs-lookup"><span data-stu-id="a3331-868">Name it "fioread.ini".</span></span>

```
[global]
size=30g
direct=1
iodepth=256
ioengine=libaio
bs=8k

[reader1]
rw=randread
directory=/mnt/readcache
[reader2]
rw=randread
directory=/mnt/readcache
[reader3]
rw=randread
directory=/mnt/readcache
[reader4]
rw=randread
directory=/mnt/readcache
```

<span data-ttu-id="a3331-869">Обратите внимание на следующие ключевые аспекты, которые согласованы с рекомендациями по разработке, описанными в предыдущих разделах.</span><span class="sxs-lookup"><span data-stu-id="a3331-869">Note the follow key things that are in line with the design guidelines discussed in previous sections.</span></span> <span data-ttu-id="a3331-870">Эти спецификации необходимы для выполнения максимального количества операций ввода-вывода в секунду:</span><span class="sxs-lookup"><span data-stu-id="a3331-870">These specifications are essential to drive maximum IOPS,</span></span>

* <span data-ttu-id="a3331-871">высокое значение длины очереди: 256;</span><span class="sxs-lookup"><span data-stu-id="a3331-871">A high queue depth of 256.</span></span>  
* <span data-ttu-id="a3331-872">небольшой размер блока: 8 КБ;</span><span class="sxs-lookup"><span data-stu-id="a3331-872">A small block size of 8KB.</span></span>  
* <span data-ttu-id="a3331-873">несколько потоков, выполняющих случайные операции записи.</span><span class="sxs-lookup"><span data-stu-id="a3331-873">Multiple threads performing random writes.</span></span>

<span data-ttu-id="a3331-874">Выполните следующую команду, чтобы запустить тест FIO на 30 секунд:</span><span class="sxs-lookup"><span data-stu-id="a3331-874">Run the following command to kick off the FIO test for 30 seconds,</span></span>

```
sudo fio --runtime 30 fioread.ini
```

<span data-ttu-id="a3331-875">Во время тестирования можно узнать количество операций ввода-вывода в секунду при чтении, которое обеспечивают виртуальная машина и диски класса «Премиум».</span><span class="sxs-lookup"><span data-stu-id="a3331-875">While the test runs, you will be able to see the number of read IOPS the VM and Premium disks are delivering.</span></span> <span data-ttu-id="a3331-876">Как показано в примере ниже, виртуальная машина DS14 выполняет более 64 000 операций ввода-вывода в секунду при чтении.</span><span class="sxs-lookup"><span data-stu-id="a3331-876">As shown in the sample below, the DS14 VM is delivering more than 64,000 Read IOPS.</span></span> <span data-ttu-id="a3331-877">Это количество представляет собой сочетание производительности диска и кэша.</span><span class="sxs-lookup"><span data-stu-id="a3331-877">This is a combination of the disk and the cache performance.</span></span>  
    ![](media/storage-premium-storage-performance/image12.png)

<span data-ttu-id="a3331-878">*Максимальное количество операций ввода-вывода в секунду при чтении и записи*</span><span class="sxs-lookup"><span data-stu-id="a3331-878">*Maximum Read and Write IOPS*</span></span>  
<span data-ttu-id="a3331-879">Чтобы добиться максимального количества операций ввода-вывода в секунду при объединенных операциях чтения и записи, создайте файл задания со следующими спецификациями.</span><span class="sxs-lookup"><span data-stu-id="a3331-879">Create the job file with following specifications to get maximum combined Read and Write IOPS.</span></span> <span data-ttu-id="a3331-880">Назовите файл fioreadwrite.ini.</span><span class="sxs-lookup"><span data-stu-id="a3331-880">Name it "fioreadwrite.ini".</span></span>

```
[global]
size=30g
direct=1
iodepth=128
ioengine=libaio
bs=4k

[reader1]
rw=randread
directory=/mnt/readcache
[reader2]
rw=randread
directory=/mnt/readcache
[reader3]
rw=randread
directory=/mnt/readcache
[reader4]
rw=randread
directory=/mnt/readcache

[writer1]
rw=randwrite
directory=/mnt/nocache
rate_iops=12500
[writer2]
rw=randwrite
directory=/mnt/nocache
rate_iops=12500
[writer3]
rw=randwrite
directory=/mnt/nocache
rate_iops=12500
[writer4]
rw=randwrite
directory=/mnt/nocache
rate_iops=12500
```

<span data-ttu-id="a3331-881">Обратите внимание на следующие ключевые аспекты, которые согласованы с рекомендациями по разработке, описанными в предыдущих разделах.</span><span class="sxs-lookup"><span data-stu-id="a3331-881">Note the follow key things that are in line with the design guidelines discussed in previous sections.</span></span> <span data-ttu-id="a3331-882">Эти спецификации необходимы для выполнения максимального количества операций ввода-вывода в секунду:</span><span class="sxs-lookup"><span data-stu-id="a3331-882">These specifications are essential to drive maximum IOPS,</span></span>

* <span data-ttu-id="a3331-883">высокое значение длины очереди: 128;</span><span class="sxs-lookup"><span data-stu-id="a3331-883">A high queue depth of 128.</span></span>  
* <span data-ttu-id="a3331-884">небольшой размер блока: 4 КБ;</span><span class="sxs-lookup"><span data-stu-id="a3331-884">A small block size of 4KB.</span></span>  
* <span data-ttu-id="a3331-885">несколько потоков, выполняющих случайные операции чтения и записи.</span><span class="sxs-lookup"><span data-stu-id="a3331-885">Multiple threads performing random reads and writes.</span></span>

<span data-ttu-id="a3331-886">Выполните следующую команду, чтобы запустить тест FIO на 30 секунд:</span><span class="sxs-lookup"><span data-stu-id="a3331-886">Run the following command to kick off the FIO test for 30 seconds,</span></span>

```
sudo fio --runtime 30 fioreadwrite.ini
```

<span data-ttu-id="a3331-887">Во время тестирования можно узнать количество операций ввода-вывода в секунду при объединенных операциях чтения и записи, которое обеспечивают виртуальная машина и диски класса «Премиум».</span><span class="sxs-lookup"><span data-stu-id="a3331-887">While the test runs, you will be able to see the number of combined read and write IOPS the VM and Premium disks are delivering.</span></span> <span data-ttu-id="a3331-888">Как показано в примере ниже, виртуальная машина DS14 выполняет более 100 000 операций ввода-вывода в секунду при объединенных операциях чтения и записи.</span><span class="sxs-lookup"><span data-stu-id="a3331-888">As shown in the sample below, the DS14 VM is delivering more than 100,000 combined Read and Write IOPS.</span></span> <span data-ttu-id="a3331-889">Это количество представляет собой сочетание производительности диска и кэша.</span><span class="sxs-lookup"><span data-stu-id="a3331-889">This is a combination of the disk and the cache performance.</span></span>  
    ![](media/storage-premium-storage-performance/image13.png)

<span data-ttu-id="a3331-890">*Максимальное значение объединенной пропускной способности*</span><span class="sxs-lookup"><span data-stu-id="a3331-890">*Maximum Combined Throughput*</span></span>  
<span data-ttu-id="a3331-891">Чтобы добиться максимальной пропускной способности объединенных операций чтения и записи, используйте больший размер блока и длинную очередь с несколькими потоками, выполняющими операции чтения и записи.</span><span class="sxs-lookup"><span data-stu-id="a3331-891">To get the maximum combined Read and Write Throughput, use a larger block size and large queue depth with multiple threads performing reads and writes.</span></span> <span data-ttu-id="a3331-892">Можно использовать блоки размером 64 КБ и длину очереди со значением «128».</span><span class="sxs-lookup"><span data-stu-id="a3331-892">You can use a block size of 64KB and queue depth of 128.</span></span>

## <a name="next-steps"></a><span data-ttu-id="a3331-893">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="a3331-893">Next Steps</span></span>
<span data-ttu-id="a3331-894">Дополнительная информация о хранилище Azure класса «Премиум»:</span><span class="sxs-lookup"><span data-stu-id="a3331-894">Learn more about Azure Premium Storage:</span></span>

* [<span data-ttu-id="a3331-895">Хранилище Premium: высокопроизводительное хранилище для рабочих нагрузок виртуальной машины Azure</span><span class="sxs-lookup"><span data-stu-id="a3331-895">Premium Storage: High-Performance Storage for Azure Virtual Machine Workloads</span></span>](../storage-premium-storage.md)  

<span data-ttu-id="a3331-896">Если вы пользователь SQL Server, см. статьи с рекомендациями по оптимизации производительности SQL Server:</span><span class="sxs-lookup"><span data-stu-id="a3331-896">For SQL Server users, read articles on Performance Best Practices for SQL Server:</span></span>

* [<span data-ttu-id="a3331-897">Рекомендации по оптимизации производительности SQL Server в виртуальных машинах Azure</span><span class="sxs-lookup"><span data-stu-id="a3331-897">Performance Best Practices for SQL Server in Azure Virtual Machines</span></span>](../../virtual-machines/windows/sql/virtual-machines-windows-sql-performance.md)
* [<span data-ttu-id="a3331-898">Хранилище Azure класса «Премиум» обеспечивает максимальную производительность SQL Server в виртуальных машинах Azure</span><span class="sxs-lookup"><span data-stu-id="a3331-898">Azure Premium Storage provides highest performance for SQL Server in Azure VM</span></span>](http://blogs.technet.com/b/dataplatforminsider/archive/2015/04/23/azure-premium-storage-provides-highest-performance-for-sql-server-in-azure-vm.aspx)
