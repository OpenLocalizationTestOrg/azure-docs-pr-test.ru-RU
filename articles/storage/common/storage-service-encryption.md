---
title: "Шифрование неактивных данных в службе хранилища Azure | Документация Майкрософт"
description: "Используйте функцию шифрования службы хранилища Azure для шифрования хранилища BLOB-объектов Azure на стороне службы при сохранении данных и его расшифровки при извлечении данных."
services: storage
documentationcenter: .net
author: tamram
manager: timlt
editor: tysonn
ms.assetid: edabe3ee-688b-41e0-b34f-613ac9c3fdfd
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/09/2017
ms.author: tamram
ms.openlocfilehash: 32f622c39583a25a7bc53ffcb6d9be779459badc
ms.sourcegitcommit: 821b6306aab244d2feacbd722f60d99881e9d2a4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/16/2017
---
# <a name="azure-storage-service-encryption-for-data-at-rest"></a>Шифрование службы хранилища Azure для неактивных данных (предварительная версия)
Шифрование службы хранилища Azure (SSE) для неактивных данных помогает защитить данные в соответствии с предложениями по безопасности и соответствию вашей организации. С помощью этой функции служба хранилища Azure автоматически шифрует данные перед сохранением в хранилище и расшифровывает их перед извлечением. Шифрование, расшифровка и управление ключами полностью прозрачны для пользователей.

В следующих разделах приведены подробные инструкции по использованию функции шифрования для службы хранилища, а также описаны поддерживаемые сценарии и взаимодействие с пользователем.

## <a name="overview"></a>Обзор
Служба хранилища Azure предоставляет полный набор возможностей обеспечения безопасности, которые в совокупности позволяют разработчикам создавать защищенные приложения. Защитить данные в процессе передачи между приложением и Azure можно с помощью [шифрования на стороне клиента](../storage-client-side-encryption.md), HTTPS или SMB 3.0. Шифрование службы хранилища обеспечивает шифрование при хранении, а также полностью прозрачное шифрование, расшифровку и управление ключами. Используется 256-битное [шифрование AES](https://en.wikipedia.org/wiki/Advanced_Encryption_Standard), самая надежная технология блочного шифрования на сегодняшний день.

Функция SSE шифрует данные при их записи в хранилище Azure. Ее можно использовать для хранилища BLOB-объектов Azure и для хранилища файлов. Вот что поддерживает служба:

* стандартное хранилище: учетные записи хранения общего назначения для хранилища BLOB-объектов и хранилища файлов, а также учетные записи хранения больших двоичных объектов;
* Хранилище уровня "Премиум" 
* все уровни избыточности (LRS, ZRS, GRS и RA-GRS);
* учетные записи хранения Azure Resource Manager (но не классические учетные записи хранения); 
* все регионы.

Дополнительные сведения см. в разделе вопросов и ответов.

Чтобы включить или отключить шифрование службы хранилища для учетной записи хранения, войдите на [портал Azure](https://portal.azure.com) и выберите нужную учетную запись. В колонке "Параметры" найдите раздел "Служба BLOB-объектов", как показано на следующем снимке экрана, и щелкните "Шифрование".

![Снимок экрана портала с параметром шифрования](./media/storage-service-encryption/image1.png)
<br/>*Рис. 1. Включение SSE для службы BLOB-объектов (шаг 1)*

![Снимок экрана портала с параметром шифрования](./media/storage-service-encryption/image3.png)
<br/>*Рис. 2. Включение SSE для службы файлов (шаг 1)*

После выбора параметра шифрования можно включить или отключить шифрование службы хранилища.

![Снимок экрана портала со свойствами шифрования](./media/storage-service-encryption/image2.png)
<br/>*Рис. 3. Включение SSE для службы BLOB-объектов и службы файлов (шаг 2)*

## <a name="encryption-scenarios"></a>Сценарии шифрования
Шифрование службы хранилища можно включить на уровне учетной записи хранения. После включения клиенты выберут, какие службы необходимо зашифровать. Оно поддерживает следующие сценарии клиентов:

* шифрование хранилища BLOB-объектов и хранилища файлов в учетных записях Resource Manager;
* шифрование службы BLOB-объектов и файлов в классических учетных записях хранения после миграции в учетные записи хранения Resource Manager.

SSE имеет такие ограничения:

* Шифрование классических учетных записей хранения не поддерживается.
* Существующие данные — SSE шифрует вновь созданные данные только после включения шифрования. Например, если вы создадите учетную запись хранения Resource Manager, не включив шифрование, передадите в нее большие двоичные объекты или архивные виртуальные жесткие диски, а затем включите SSE, то эти большие двоичные объекты будут шифроваться только после их перезаписи или копирования.
* Поддержка Marketplace — включите шифрование виртуальных машин, созданных из Marketplace, с помощью [портала Azure](https://portal.azure.com), PowerShell или интерфейса командной строки Azure (Azure CLI). Базовый образ виртуального жесткого диска остается незашифрованным, однако все операции записи, производимые после развертывания виртуальной машины, шифруются.
* Таблицы и файлы не шифруются.

## <a name="getting-started"></a>Приступая к работе
### <a name="step-1-create-a-new-storage-accountstorage-create-storage-accountmd"></a>Этап 1. [Создание учетной записи хранения](../storage-create-storage-account.md)
### <a name="step-2-enable-encryption"></a>Этап 2. Включение шифрования
Шифрование можно включить с помощью [портала Azure](https://portal.azure.com).

> [!NOTE]
> Если вы хотите включить или отключить шифрование службы хранилища для учетной записи хранения с помощью программных средств, вы можете использовать [REST API поставщика ресурсов службы хранилища Azure](https://msdn.microsoft.com/library/azure/mt163683.aspx), [клиентскую библиотеку поставщика ресурсов хранилища для .NET](https://msdn.microsoft.com/library/azure/mt131037.aspx), [Azure PowerShell](/powershell/azureps-cmdlets-docs) или [Azure CLI](../storage-azure-cli.md).
> 
> 

### <a name="step-3-copy-data-to-storage-account"></a>Этап 3. Копирование данных в учетную запись хранения
Если вы включите SSE для службы BLOB-объектов, будут зашифрованы все большие двоичные объекты, сохраненные в этой учетной записи хранения. Большие двоичные объекты, которые уже находятся в этой учетной записи не будут зашифрованы, если их не перезаписать. Можно скопировать данные из одной учетной записи хранения в другую, для которой включено шифрование SSE, или даже включить SSE и скопировать большие двоичные объекты из одного контейнера в другой, чтобы убедиться, что записанные ранее данные зашифрованы. Для этого можно использовать любой из перечисленных далее инструментов. Для хранилища файлов используется такая же схема работы.

#### <a name="using-azcopy"></a>Использование AzCopy
AzCopy — это служебная программа командной строки для Windows. Она разработана для копирования данных из хранилища больших двоичных объектов, файлов и табличного хранилища Microsoft Azure (и обратно) с помощью простых команд, обеспечивающих максимальную производительность. С помощью этой программы можно копировать большие двоичные объекты или файлы из одной учетной записи хранения в другую, для которой также включено шифрование SSE. 

Дополнительные сведения см. в статье [Передача данных с помощью служебной программы командной строки AzCopy](storage-use-azcopy.md).

#### <a name="using-smb"></a>Использование SMB
Служба файлов Azure предоставляет общие папки в облаке с доступом по стандартному протоколу SMB. Общую папку можно подключить через клиент на локальном компьютере или в Azure. После подключения можно копировать файлы в общие папки Azure с помощью таких инструментов, как Robocopy. Дополнительные сведения см. в статьях [Подключение общей папки Azure и получение доступа к этой папке в Windows](../files/storage-how-to-use-files-windows.md) и [Использование хранилища файлов Azure в Linux](../files/storage-how-to-use-files-linux.md).


#### <a name="using-the-storage-client-libraries"></a>Использование клиентских библиотек хранилища
Чтобы скопировать большие двоичные объекты или файлы из одного хранилища BLOB-объектов в другое или из одной учетной записи хранения в другую, вы можете использовать обширный набор клиентских библиотек хранилища, в том числе для .NET, C++, Java, Android, Node.js, PHP, Python и Ruby.

Дополнительные сведения см. в статье [Приступая к работе с хранилищем BLOB-объектов Azure с помощью .NET](../blobs/storage-dotnet-how-to-use-blobs.md).

#### <a name="using-a-storage-explorer"></a>Использование обозревателя хранилищ
Вы можете использовать обозреватель хранилищ для создания учетных записей хранения, отправки и скачивания данных, просмотра содержимого больших двоичных объектов и перехода по каталогам. Один из них можно использовать для отправки BLOB-объектов в учетную запись хранения с включенным шифрованием. При помощи некоторых обозревателей хранилищ также можно копировать данные из существующего хранилища BLOB-объектов в другой контейнер учетной записи хранения или в новую учетную запись хранения с включенным SSE.

Дополнительные сведения см. в статье [Обучающие ресурсы для хранилища Azure](../storage-explorers.md).

### <a name="step-4-query-the-status-of-the-encrypted-data"></a>Шаг 4. Запрос состояния зашифрованных данных
Развернута обновленная версия клиентской библиотеки хранилища, позволяющая запрашивать состояние объекта, чтобы определить, зашифрован ли он. Сейчас эта функция поддерживается только для хранилища BLOB-объектов. Мы планируем реализовать поддержку и для хранилища файлов. 

В то же время можно вызвать операцию [получения свойств учетной записи](https://msdn.microsoft.com/library/azure/mt163553.aspx) , чтобы убедиться, что для учетной записи включено шифрование, или просмотреть свойства учетной записи хранения на портале Azure.

## <a name="encryption-and-decryption-workflow"></a>Рабочий процесс шифрования и расшифровки
Ниже приведено краткое описание того, как работает шифрование и расшифровка:

* Клиент включает шифрование в учетной записи хранения.
* Когда клиент записывает новые данные (выполняя операции PUT Blob, PUT Block, PUT Page, PUT File и т. п.) в хранилище BLOB-объектов или в хранилище файлов, к каждой операции записи применяется 256-разрядное [шифрование AES](https://en.wikipedia.org/wiki/Advanced_Encryption_Standard). Это одна из самых надежных технологий блочного шифрования на сегодняшний день.
* Когда клиенту требуется получить доступ к данным (например GET Blob и т. п.), они автоматически расшифровываются перед возвратом пользователю.
* Если шифрование отключено, новые операции записи не шифруются, а уже зашифрованные данные остаются в таком состоянии, пока не будут перезаписаны пользователем. После включения шифрования шифруются все последующие операции записи в хранилище BLOB-объектов или в хранилище файлов. Состояние данных не изменяется, когда пользователь переключается между включенным и отключенным шифрованием для учетной записи хранения.
* Все ключи шифрования хранятся в зашифрованном виде и управляются корпорацией Майкрософт.

## <a name="frequently-asked-questions-about-storage-service-encryption-for-data-at-rest"></a>Часто задаваемые вопросы о шифровании службы хранилища для неактивных данных
**Вопрос. У меня есть классическая учетная запись хранения. Можно включить в ней SSE?**

Ответ. Нет, SSE поддерживается только для учетных записей хранения Resource Manager.

**Вопрос. Каким образом можно зашифровать данные в классической учетной записи хранения?**

Ответ. Можно создать новую учетную запись хранения Resource Manager и скопировать в нее данные из классической учетной записи с помощью [AzCopy](storage-use-azcopy.md). 

Перенос классической учетной записи хранения в учетную запись хранения Resource Manager выполняется мгновенно. При этом изменяется тип учетной записи, а имеющиеся данные не затрагиваются. Все новые записанные данные будут шифроваться только после включения шифрования. Дополнительные сведения см. в статье [Поддерживаемый платформой перенос ресурсов IaaS из классической модели в модель Azure Resource Manager](https://azure.microsoft.com/blog/iaas-migration-classic-resource-manager/). Обратите внимание, что эта функция поддерживается только для служб BLOB-объектов и служб файлов.

**Вопрос. У меня есть учетная запись хранения Resource Manager. Можно включить в ней SSE?**

Ответ. Да, но шифрование будет применяться только к тем данным, которые будут записываться после включения SSE. Данные, сохраненные до этого, шифроваться не будут. Эта функция пока не поддерживается в предварительной версии хранилища файлов.

**Вопрос. Мне бы хотелось зашифровать текущие данные в существующей учетной записи хранения Resource Manager.**

Ответ. Вы можете включить SSE в учетной записи Resource Manager в любое время. Однако данные, которые существовали до этого, не будут зашифрованы. Чтобы зашифровать имеющиеся данные, их можно скопировать в другое имя или другой контейнер и удалить их незашифрованные версии.

**Вопрос. Я использую хранилище класса "Премиум"; доступна ли мне функция SSE?**

Ответ. Да, функция SSE поддерживается для хранилища класса как "Стандартный", так и "Премиум".  Служба файлов не поддерживает хранилище класса Premium.

**Вопрос. Если я создаю учетную запись хранения, включив SSE, а затем создаю с ее помощью новую виртуальную машину, означает ли это, что виртуальная машина зашифрована?**

Ответ. Да. Все новые диски, которые используют новую учетную запись хранения, будут зашифрованы при условии, что они созданы после включения SSE. Если виртуальная машина создана с помощью Azure Marketplace, базовый образ виртуального жесткого диска остается незашифрованным, однако все операции записи, производимые после развертывания виртуальной машины, шифруются.

**Вопрос. Можно ли создавать учетные записи хранения с включенной функцией SSE с помощью интерфейса командной строки Azure и Azure PowerShell?**

Ответ. Да.

**Вопрос. Насколько дороже обходится служба хранилища Azure с включенным SSE?**

Ответ. Дополнительные затраты не требуются.

**Вопрос. Кто управляет ключами шифрования?**

Ответ. Ключами управляет корпорация Майкрософт.

**Вопрос. Можно ли использовать собственные ключи шифрования?**

Ответ. Мы работаем над тем, чтобы дать клиентам возможность использовать собственные ключи шифрования.

**Вопрос. Можно ли отменить доступ к ключам шифрования?**

Ответ. Сейчас нет, так как ключи полностью управляются корпорацией Майкрософт.

**Вопрос. Включается ли SSE по умолчанию при создании учетной записи хранения?**

Ответ выполняется Включение шифрования по умолчанию с помощью ключей, управляемых Майкрософт, все данные, записанные в хранилище Azure (хранилище больших двоичных объектов, файлов, таблиц и очередей), а также для всех учетных записей хранилища (диспетчера ресурсов Azure и классическом хранилище команды хранилища Azure учетным записям), новые и существующие.

**Вопрос. Чем это отличается от шифрования дисков Azure?**

Ответ. Эта функция используется для шифрования данных в хранилище BLOB-объектов Azure. Шифрование дисков Azure применяется для шифрования дисков операционной системы и данных в виртуальных машинах IaaS. Дополнительные сведения см. в [руководстве по безопасности службы хранилища](../storage-security-guide.md).

**Вопрос. Что будет, если включить SSE, а затем выполнить вход и включить шифрование дисков Azure для этих дисков?**

Ответ. Это поддерживаемый режим работы. Данные будут шифроваться с помощью обоих методов.

**Вопрос. Для моей учетной записи хранения настроена геоизбыточная репликация. Если включить SSE, будет зашифрована и избыточная копия?**

Ответ. Да, шифрованию подлежат все копии учетной записи хранения, при этом поддерживаются все варианты избыточности — локально избыточное хранилище (LRS), хранилище, избыточное в пределах зоны (ZRS), геоизбыточное хранилище (GRS) и геоизбыточное хранилище с доступом на чтение (RA-GRS).

**Вопрос. Не удается включить шифрование для учетной записи хранения.**

Ответ. Это учетная запись Resource Manager? Классические учетные записи хранения не поддерживаются. 

**Вопрос. Услуга SSE доступна только в некоторых регионах?**

Ответ. Функция SSE доступна для хранилища BLOB-объектов во всех регионах. Сведения о хранилище файлов см. в разделе, посвященном доступности. 

**Вопрос. Куда обратиться, чтобы задать вопрос или оставить отзыв?**

Ответ. По любым вопросам, связанным с шифрованием службы хранилища, обращайтесь по адресу [ssediscussions@microsoft.com](mailto:ssediscussions@microsoft.com).

## <a name="next-steps"></a>Следующие шаги
Служба хранилища Azure предоставляет полный набор возможностей обеспечения безопасности, которые в совокупности позволяют разработчикам создавать защищенные приложения. Дополнительные сведения см. в [руководстве по безопасности службы хранилища](../storage-security-guide.md).

