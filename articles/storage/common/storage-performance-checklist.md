---
title: "Контрольный список производительности и масштабируемости хранилища aaaAzure | Документы Microsoft"
description: "Контрольный список проверенных методов для использования с хранилищем Azure при разработке приложений с высокой производительностью."
services: storage
documentationcenter: 
author: robinsh
manager: timlt
editor: tysonn
ms.assetid: 959d831b-a4fd-4634-a646-0d2c0c462ef8
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/08/2016
ms.author: robinsh
ms.openlocfilehash: c2970c055d460070288d1810e4a77a7f056a4137
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="microsoft-azure-storage-performance-and-scalability-checklist"></a>Производительность хранилища Microsoft Azure и контрольный список масштабируемости
## <a name="overview"></a>Обзор
С момента выпуска hello hello службы хранилища Microsoft Azure Корпорация Майкрософт разработала количество проверенных методах использования этих служб производительным образом и в этой статье служит tooconsolidate hello наиболее важные из них в список стилей контрольный список. toohelp разработчикам приложений убедитесь, что они используют проверенные хранилища Azure и их определения другие методики они полезно придерживаться toohelp — намерение Hello данной статьи. В этой статье не пытаться toocover каждой возможности оптимизации производительности и масштабируемости — те, которые мало в их влияние или не широкой областью применения исключаются. toohello экстент, hello поведение приложения может быть спрогнозирован во время разработки бывает полезно tookeep их в виду на раннем этапе tooavoid схем, которые сталкиваются с проблемами производительности.  

Каждый разработчик приложения с помощью хранилища Azure должен занять tooread время hello в этой статье, а также убедитесь, что свои приложения использует каждого hello проверенные методики, перечисленные ниже.  

## <a name="checklist"></a>Контрольный список
В этой статье hello проверенные методики организованы в следующие группы hello. Методики, применимые в отношении:  

* всех служб хранилища Azure (BLOB-объектов, таблиц, очередей и файлов);
* BLOB-объекты
* Таблицы
* Очереди  

| Готово | Область | Категория | Вопрос |
| --- | --- | --- | --- |
| &nbsp; | Все службы |Целевые показатели масштабируемости |[Приближается к tooavoid приложение, разработанное целевые показатели масштабируемости hello](#subheading1) |
| &nbsp; | Все службы |Целевые показатели масштабируемости |[Лучше вашей именования tooenable соглашение предназначены балансировки нагрузки?](#subheading47) |
| &nbsp; | Все службы |Сеть |[У части клиентских устройств достаточно высокой пропускной способностью и малой задержкой tooachieve hello производительности требуется?](#subheading2) |
| &nbsp; | Все службы |Сеть |[Имеют ли клиентские устройства достаточно высокое качество связи?](#subheading3) |
| &nbsp; | Все службы |Сеть |[Находится ли клиентское приложение hello «рядом с» hello учетной записи хранилища?](#subheading4) |
| &nbsp; | Все службы |Распространение содержимого |[Используете ли вы CDN для распределения содержимого?](#subheading5) |
| &nbsp; | Все службы |Прямой клиентский доступ |[Вы используете SAS и CORS toostorage tooallow прямой доступ вместо прокси?](#subheading6) |
| &nbsp; | Все службы |Caching |[Данные кэширования приложений используются постоянно и изменяются редко?](#subheading7) |
| &nbsp; | Все службы |Caching |[Ваше приложение группирует обновления (кэширует на стороне клиента, а затем загружает в виде большого массива)?](#subheading8) |
| &nbsp; | Все службы |Конфигурация .NET |[Вы настроили ваш клиент toouse достаточное количество одновременных подключений?](#subheading9) |
| &nbsp; | Все службы |Конфигурация .NET |[Вы настроили .NET toouse достаточное количество потоков?](#subheading10) |
| &nbsp; | Все службы |Конфигурация .NET |[Используете ли вы .NET 4.5 или более позднюю версию, в которой улучшена функция сборки мусора?](#subheading11) |
| &nbsp; | Все службы |Parallelism |[Вы убедились в ограниченных, параллелизма соответствующим образом, чтобы не перегружать целевые показатели масштабируемости hello или клиентских возможностей?](#subheading12) |
| &nbsp; | Все службы |Средства |[Вы используете последнюю версию Microsoft hello предоставляются клиентские библиотеки и средства?](#subheading13) |
| &nbsp; | Все службы |Повторы |[Вы используете политику повтора экспоненциального откладывания для регулирования ошибок и времени ожидания?](#subheading14) |
| &nbsp; | Все службы |Повторы |[Ваше приложение избегает повторов неповторяемых ошибок?](#subheading15) |
| &nbsp; | BLOB-объекты |Целевые показатели масштабируемости |[Имеется большое число клиентов, одновременно обращающихся к одному объекту?](#subheading46) |
| &nbsp; | BLOB-объекты |Целевые показатели масштабируемости |[Приложения должны оставаться в пределах hello пропускной способности или операций цель масштабируемости для большого двоичного объекта?](#subheading16) |
| &nbsp; | BLOB-объекты |Копирование BLOB-объектов |[Вы копируете BLOB-объекты эффективным способом?](#subheading17) |
| &nbsp; | BLOB-объекты |Копирование BLOB-объектов |[Используете ли вы AzCopy для массового копирования BLOB-объектов?](#subheading18) |
| &nbsp; | BLOB-объекты |Копирование BLOB-объектов |[Вы используете импорта и экспорта Azure tootransfer очень больших объемов данных?](#subheading19) |
| &nbsp; | BLOB-объекты |Использование метаданных |[Вы храните часто используемые метаданные, касающиеся BLOB-объектов, в их метаданных?](#subheading20) |
| &nbsp; | BLOB-объекты |Быстрая отправка |[При попытке быстро tooupload одного большого двоичного объекта, вы отправляете блоков одновременно?](#subheading21) |
| &nbsp; | BLOB-объекты |Быстрая отправка |[При попытке tooupload много BLOB-объектов быстро, вы отправляете больших двоичных объектов в параллельном режиме?](#subheading22) |
| &nbsp; | BLOB-объекты |Правильный тип BLOB-объекта |[Используете ли вы при необходимости страничные BLOB-объекты или блочные BLOB-объекты?](#subheading23) |
| &nbsp; | Таблицы |Целевые показатели масштабируемости |[Такое вы около hello целевые показатели масштабируемости для сущностей в секунду](#subheading24) |
| &nbsp; | Таблицы |Конфигурация |[Используете ли вы JSON в запросах таблиц?](#subheading25) |
| &nbsp; | Таблицы |Конфигурация |[Вы отключили Nagle производительности hello tooimprove небольших запросов?](#subheading26) |
| &nbsp; | Таблицы |Таблицы и разделы |[Вы правильно разделили свои данные?](#subheading27) |
| &nbsp; | Таблицы |Горячие разделы |[Вы избегаете использования инкрементируемых и декрементируемых шаблонов?](#subheading28) |
| &nbsp; | Таблицы |Горячие разделы |[Вы распределяете свои вставки и обновления по нескольким разделам?](#subheading29) |
| &nbsp; | Таблицы |Область запроса |[Предусмотрели tooallow вашей схемы для toobe запросов точки используются в большинстве случаев и toobe таблицы запросов, используется только в случае необходимости?](#subheading30) |
| &nbsp; | Таблицы |Плотность запроса |[Ваши запросы обычно только сканируют и возвращают строки, которые будет использовать приложение?](#subheading31) |
| &nbsp; | Таблицы |Ограничение возвращаемых данных |[Вы используете фильтрации tooavoid возвращение сущностей, которые не требуются?](#subheading32) |
| &nbsp; | Таблицы |Ограничение возвращаемых данных |[Используется проекция tooavoid возврат свойств, которые больше не нужны?](#subheading33) |
| &nbsp; | Таблицы |Денормализация |[Денормализованное данных таким образом, чтобы избежать неэффективные запросы или несколько запросов чтения при попытке tooget данных?](#subheading34) |
| &nbsp; | Таблицы |Вставить, обновить, удалить |[Вы пакетной обработки запросов, которые требуется toobe транзакций или можно выполнить на hello же время циклов приема-передачи tooreduce?](#subheading35) |
| &nbsp; | Таблицы |Вставить, обновить, удалить |[Вы Предотвращение извлечение сущности просто toodetermine ли toocall вставки или обновления?](#subheading36) |
| &nbsp; | Таблицы |Вставить, обновить, удалить |[Рассматривали ли вы возможность хранения ряда данных, которые будут часто извлекаться в качестве свойств вместе с единственной сущностью, а не в виде множества сущностей?](#subheading37) |
| &nbsp; | Таблицы |Вставить, обновить, удалить |[Для сущностей, которые всегда будут извлекаться вместе и могут быть записаны в пакеты (например, данные временных рядов), рассматривали ли вы возможность использования BLOB-объектов вместо таблиц?](#subheading38) |
| &nbsp; | Очереди |Целевые показатели масштабируемости |[Такое вы около hello целевые показатели масштабируемости для сообщений в секунду](#subheading39) |
| &nbsp; | Очереди |Конфигурация |[Вы отключили Nagle производительности hello tooimprove небольших запросов?](#subheading40) |
| &nbsp; | Очереди |Размер сообщения |[— Сообщения производительности hello compact tooimprove hello очереди?](#subheading41) |
| &nbsp; | Очереди |Массовое получение |[Вы получаете множество сообщений при выполнении одной операции "Получить"?](#subheading42) |
| &nbsp; | Очереди |Частота опроса |[Ли опроса часто достаточно hello tooreduce воспринимаемой задержка приложения?](#subheading43) |
| &nbsp; | Очереди |Сообщение об обновлении |[Вы используете UpdateMessage toostore ход обработки сообщений, как избежать необходимости все сообщение hello tooreprocess при возникновении ошибки?](#subheading44) |
| &nbsp; | Очереди |Архитектура |[Вы используете toomake очереди масштабируемое приложение, оставив установленным долго выполняющихся рабочих нагрузок за пределы критический путь hello и масштаб затем независимо друг от друга?](#subheading45) |

## <a name="allservices"></a>Все службы
В этом разделе перечислены методики, применяемые применимо toohello любого hello службы хранилища Azure (большие двоичные объекты, таблицы, очереди или файлы).  

### <a name="subheading1"></a>Целевые показатели масштабируемости
Каждый из службы хранилища Azure hello содержит целевые показатели масштабируемости для емкость (ГБ), скорость выполнения транзакций и пропускной способности. Если приложение достигает или превышает целевые показатели масштабируемости hello, могут возникнуть задержки транзакции или регулирования. При службы хранилища регулирует приложения, службы hello начинает tooreturn «503. сервер занят» или «500 истекло время ожидания операции» коды ошибок для некоторых транзакций в хранилище. В этом разделе рассматриваются оба toodealing общий подход hello целевые показатели масштабируемости и пропускной способности целевые показатели масштабируемости, в частности. Более поздние версии, связанные со службами хранилища в отдельных разделах целевые показатели масштабируемости в контексте этой конкретной службы hello:  

* [Пропускная способность больших двоичных объектов и количество запросов в секунду](#subheading16)
* [Сущности таблицы в секунду](#subheading24)
* [Сообщения очереди в секунду](#subheading39)  

#### <a name="sub1bandwidth"></a>Целевой показатель масштабируемости пропускной способности для всех служб
На момент написания статьи hello, целевые объекты пропускной способности hello в учетной записи hello США для географически избыточное хранилище (GRS): 10 Гигабит в секунду (Гбит/с) для входящих сообщений (данные отправляются учетной записи хранилища toohello) и 20 Гбит/с для исходящего трафика (данные, отправленные из учетной записи хранилища hello). Для учетной записи локально избыточное хранилище (LRS), превышают ограничения hello — 20 Гбит/с для входящих сообщений и 30 Гбит/с для исходящего трафика.  Международные ограничения пропускной способности могут быть ниже. О них можно узнать на [странице целевых показателей масштабируемости](http://msdn.microsoft.com/library/azure/dn249410.aspx).  Дополнительные сведения о параметры избыточности хранилища hello воспользуйтесь ссылками hello в [полезные ресурсы](#sub1useful) ниже.  

#### <a name="what-toodo-when-approaching-a-scalability-target"></a>Какие toodo при приближении к целевой показатель масштабируемости
Если приложение приближается hello целевые показатели масштабируемости для одной учетной записи хранения, необходимо учитывайте внедрение один hello следующие подходы:  

* Пересмотреть hello рабочую нагрузку, приводящую к tooapproach приложения или превышать целевой показатель масштабируемости hello. Можно его проектировании по-разному toouse меньше пропускной способности или емкости или меньшее число транзакций?
* Если приложение должно превышать одну целевые показатели масштабируемости hello, необходимо создать несколько учетных записей хранения и секции данных приложения этих нескольких учетных записях хранения. Если вы используете этот шаблон, затем быть toodesign убедиться, что приложения, чтобы hello будущих для балансировки нагрузки можно добавить дополнительные учетные записи хранения. На момент написания статьи каждая подписка Azure может содержать до too100 учетные записи хранения.  Кроме случаев использования с целью хранения данных, совершения транзакций или передачи данных плата за учетные записи хранения не взимается.
* Если приложение hello цели пропускной способности, выполнить сжатие данных в hello клиента tooreduce hello пропускной способности, необходимой toosend hello toohello службой хранения данных.  Обратите внимание, этот способ может как сэкономить полосу пропускания и повысить производительность сети, так и иметь некоторые негативные последствия.  Следует оценить hello воздействие на производительность это из-за toohello Дополнительные требования к обработке для сжатия и распаковки данных в клиенте hello. Кроме того хранение сжатых данных может сделать его более сложных проблем tootroubleshoot так, как это может быть более сложной tooview хранимых данных, с помощью стандартных средств.
* Если приложение обратится целевые показатели масштабируемости hello, убедитесь, что вы используете экспоненциальную отсрочку для повторных попыток (см. [попыток](#subheading14)).  Его лучше toomake никогда не подход целевые показатели масштабируемости hello (с помощью одного из hello выше методов), но это гарантирует приложения не будет хранить только быстро повторять, что делает hello регулирования хуже.  

#### <a name="useful-resources"></a>Полезные ресурсы
Hello ссылкам содержатся дополнительные сведения о целевые показатели масштабируемости.

* Дополнительные сведения о целевых показателях масштабируемости см. в статье [Целевые показатели масштабируемости и производительности службы хранилища Azure](storage-scalability-targets.md).
* В разделе [репликацию хранилища Azure](storage-redundancy.md) и hello блога [параметры избыточности хранилища Azure и доступ для чтения Geo Redundant Storage](http://blogs.msdn.com/b/windowsazurestorage/archive/2013/12/11/introducing-read-access-geo-replicated-storage-ra-grs-for-windows-azure-storage.aspx) сведения о параметры избыточности хранилища.
* Для получения актуальной информации о ценах за использование служб Azure см. страницу [Цены Azure](https://azure.microsoft.com/pricing/overview/).  

### <a name="subheading47"></a>Соглашение об именовании секций
Хранилище Azure использует на основе диапазонов секционирования схемы tooscale и загрузка баланс hello систему. ключ раздела Hello данным используется toopartition разбиваются на диапазоны, а эти диапазоны балансировки нагрузки во всей системе hello. Это означает, что соглашения об именовании лексической сортировки (например, msftpayroll, msftperformance, msftemployees, и т. д) или с помощью метки времени (log20160101, log20160102, log20160102 и т. д) выполняется по тому toohello секций потенциально, совместно размещенную на hello одном сервере разделов, пока операции с балансировкой нагрузки разбивает их на более мелкие диапазоны. Например все большие двоичные объекты в контейнере может быть предоставлен на одном сервере, пока hello нагрузка на эти большие двоичные объекты требует дальнейшего перераспределения hello секции диапазонов. Аналогичным образом, группа со слабой загрузкой учетных записей с распределены по именам в лексическом порядке может обслуживаться одного сервера до hello нагрузки на одном или всех этих учетных записей требуют их toobe разбиение по нескольким серверам секций. Каждого операции подсистемы балансировки нагрузки может повлиять на задержку hello вызовов хранилища во время операции hello. toohandle возможности системы Hello, внезапное большого количества трафика tooa секции ограничивается hello масштабируемость одного сервера секционирования до hello балансировки операции запускается в и балансировку hello диапазона ключей секций.  

Вы можете использовать некоторые лучшие рекомендации tooreduce hello частоту таких операций.  

* Изучите hello соглашение об именовании, используемое для учетных записей, контейнеров, больших двоичных объектов, таблиц и очередей, точно. К именам учетных записей можно добавить трехзначный хэш в виде префикса, используя функцию хэширования, наиболее соответствующую вашим задачам.  
* Можно организовывать данные с помощью метки времени или числовые идентификаторы, наличие tooensure, вы не используете трафик только для добавления (или только добавить). Эти шаблоны не подходят для диапазона-на основе секционирование системы, и может интереса tooall hello трафик будет tooa одной секции и ограничивающую система hello из эффективной балансировки нагрузки. Например при наличии ежедневно операции, которые используют большой двоичный объект с меткой времени, такие как ГГГГММДД, затем hello трафик для ежедневной работы, направляются tooa один объект, который обслуживается с одного сервера секционирования. Рассмотрим ли ограничивает hello на BLOB-объект и каждой секции ограничения потребностей и попробуйте разорвать эту операцию в несколько больших двоичных объектов, при необходимости. Аналогично, если временного ряда данных хранятся в таблицах, весь трафик hello может быть направлены toohello последнюю часть ключа hello пространства имен. Если необходимо использовать метки времени или числовые идентификаторы, префикс идентификатора hello с хэшем из 3 цифр, или в случае hello части секунд hello префикс отметки времени hello времени, например ssyyyymmdd. Если операции перечисления и запросов выполняются регулярно, выберите функцию хэширования, ограничивающую число запросов. В других случаях может быть достаточно случайного префикса.  
* Дополнительные сведения о hello, используемое в хранилище Azure схему секционирования, читать документ sosp о hello [здесь](http://sigops.org/sosp/sosp11/current/2011-Cascais/printable/11-calder.pdf).

### <a name="networking"></a>Сеть
Хотя hello API вызывает независимо от того, часто hello физической сети ограничения приложения hello имеют значительное влияние на производительность. Hello ниже описываются некоторые ограничения, которые могут столкнуться.  

#### <a name="client-network-capability"></a>Возможность клиентской сети
##### <a name="subheading2"></a>Пропускная способность
Пропускная способность проблема hello часто является hello возможности клиента hello. Например, во время одной учетной записи хранения может обрабатывать количество входящих сообщений или 10 Гбит/с (см. [целевые показатели масштабируемости пропускной способности](#sub1bandwidth)), скорость сети hello в «Small» рабочей роли Azure только способен приблизительно 100 Мбит/с. Очень крупные экземпляры Azure имеют сетевые карты, обладающие большими возможностями, поэтому если необходимы более высокие сетевые ограничения от одной машины, следует рассмотреть возможность использования более крупного экземпляра или большего количества виртуальных машин. Если вы обращаетесь в службу хранилища в локальном приложении, то hello же правило применяется: понять возможности сетевого hello hello клиентского устройства и toohello подключения к сети hello расположение хранилища Azure и повышают их при необходимости или Проектирование toowork вашего приложения в пределах их возможности.  

##### <a name="subheading3"></a>Качество связи
Как и при любом использовании сети, имейте в виду, что состояние сети, приводящее к ошибкам и потере пакетов, снижает эффективную пропускную способность.  Использование инструмента WireShark или NetMon может помочь в диагностике этой проблемы.  

##### <a name="useful-resources"></a>Полезные ресурсы
Дополнительные сведения о размерах виртуальной машины и выделенной пропускной способности см. в статье [Размеры виртуальных машин в Azure](../../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) (Windows) или [Размеры виртуальных машин в Azure](../../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) (Linux).  

#### <a name="subheading4"></a>Расположение
В любой распределенной среде размещения клиента hello рядом toohello сервера обеспечивает наилучшую производительность hello. Для доступа к службе хранилища Azure с минимальной задержкой hello, hello лучшее расположение клиента находится в пределах hello же регионе Azure. Например, при наличии веб-сайта Azure, который использует хранилище Azure, оба следует разместить внутри одного региона (например, на Западе США или в Юго-Восточной Азии). Это сокращает задержки hello и стоимости hello — на момент написания статьи hello, использование пропускной способности в одном регионе предоставляется бесплатно.  

Если клиент, приложения не размещаются в Azure (например, приложений для мобильных устройств или на локальные службы enterprise), а затем снова размещение учетной записи хранилища hello в области рядом с toohello устройств, которые будут пользоваться ими, обычно уменьшит задержки. Если клиенты разбросаны по всему миру (например, одни находятся в Северной Америке, другие — в Европе), следует рассмотреть возможность использования нескольких учетных записей хранения: одна размещенная в североамериканском регионе и одна — в европейском. Это поможет tooreduce задержки для пользователей в обоих регионах. Этот подход является tooimplement обычно проще, если hello hello приложения и хранилищ данных — tooindividual конкретных пользователей, не требуется репликация данных между учетными записями хранения.  Для широкого распространения содержимого рекомендуется использовать CDN – hello следующего раздела приведены дополнительные сведения см. в разделе.  

### <a name="subheading5"></a>Распространение содержимого
В некоторых случаях hello tooserve потребностей приложения и те же пользователи toomany содержимого (например продукта демонстрационных видео, используемых в hello домашнюю страницу веб-сайта), расположенный в либо hello таким же или из нескольких областей. В этом случае следует использовать доставки содержимого сети (CDN) как Azure CDN и hello CDN используется хранилища Azure в качестве источника данных hello hello. В отличие от учетная запись хранилища Azure, хранящиеся в одном регионе и, не может доставлять содержимое с низкой задержкой tooother областей Azure CDN использует серверы в нескольких центрах обработки данных вокруг Здравствуй, мир. Кроме того, сеть CDN обычно поддерживает гораздо более высокие ограничения на выходе, чем одна учетная запись хранения.  

Для получения дополнительной информации о сети Azure CDN см. статью [Сеть кэширующих серверов](https://azure.microsoft.com/services/cdn/).  

### <a name="subheading6"></a>Использование SAS и CORS
Если вам требуется tooauthorize код JavaScript в веб-браузере пользователя или данных tooaccess приложения мобильного телефона в хранилище Azure, одним из подходов является toouse приложения в веб-роли прокси-сервером: hello пользователя на устройство с проверкой подлинности hello веб-роли, который в свою очередь выполняет проверку подлинности с помощью службы хранилища hello. Таким образом, на небезопасных устройствах можно не сообщать ключи своей учетной записи хранения. Однако в этом случае влечет большие накладные расходы на hello веб-роли, так как все hello данные, передаваемые между устройством пользователя hello и hello службы хранилища должно пройти через hello веб-роли. Можно избежать, используя веб-роли как прокси для службы хранилища hello общего доступа подписи (SAS), иногда в сочетании с заголовками, общий доступ к ресурсам независимо от источника (CORS). Используя SAS, вы можете разрешить запросы toomake устройство пользователя напрямую tooa хранилища службы с помощью маркером ограниченного доступа. Например если пользователю tooupload приложении tooyour фотографий, веб-роли можно создавать и отправлять устройство пользователя toohello маркер SAS, которая предоставляет разрешение toowrite tooa определенного большого двоичного объекта или контейнера для hello Далее 30 минут (после чего hello маркер SAS истечения срока действия).

Как правило браузер не позволит JavaScript на странице, размещенной на веб-сайте на один домен tooperform определенных операциях домена tooanother «PUT». Например, если размещать веб-роли на «contosomarketing.cloudapp.net» и требуется toouse клиента стороне JavaScript tooupload учетной записи хранилища больших двоичных объектов tooyour в «contosoproducts.blob.core.windows.net» hello браузера «политика одного источника» не будет запрещать это операция. CORS является функцией браузера, которая позволяет hello целевого домена (в этой учетной записи хранения вариантов hello) toocommunicate toohello обозревателя, которому доверяет исходящие запросы hello исходного домена (в веб-роли этого варианта hello).  

Обе эти технологии могут помочь избежать излишней нагрузки (и узких мест) веб-приложения.  

#### <a name="useful-resources"></a>Полезные ресурсы
Дополнительные сведения о SAS см. в разделе [Shared Access Signatures, Part 1: hello основные сведения о модели SAS](../storage-dotnet-shared-access-signature-part-1.md).  

Дополнительные сведения о CORS см. в разделе [Поддержка общего доступа к ресурсам независимо от источника (CORS) для hello служб хранилища Azure](http://msdn.microsoft.com/library/azure/dn535601.aspx).  

### <a name="caching"></a>Caching
#### <a name="subheading7"></a>Получение данных
В большинстве случаев получение данных из службы с одной попытки лучше, чем с двух. Рассмотрим пример hello веб-приложение MVC, работающих в веб-роли, который уже загружен из hello tooserve службы хранения имени пользователя tooa содержимого большого двоичного объекта 50 МБ. приложение Hello может затем извлечь, один большой двоичный объект каждый раз пользователь запрашивает он или она может кэшировать локально toodisk и повторное использование hello кэшированная версия для последующих пользовательских запросов. Кроме того каждый раз, когда пользователь запрашивает данные hello, hello приложения проблема ДАВАЛО с условный заголовок для изменения времени, которое бы не начало hello весь большой двоичный объект, если он еще не был изменен. Можно применять этот же шаблон tooworking с сущностями в таблице.  

В некоторых случаях вы можете решить, что приложение можно предположить, что hello большого двоичного объекта остается действительным, на короткий промежуток времени после получения и что во время этого периода hello приложение не требует toocheck Если hello большой двоичный объект был изменен.

Конфигурации, поиска и другие данные, которые используются приложением hello всегда являются идеальные кандидаты для кэширования.  

Например, как tooget hello toodiscover свойства большого двоичного объекта даты последнего изменения с помощью .NET, см. [набор получить свойства и метаданные](../blobs/storage-properties-metadata.md). Дополнительные сведения об условных загрузках см. в статье [Specifying Conditional Headers for Blob Service Operations](http://msdn.microsoft.com/library/azure/dd179371.aspx) (Указание условных заголовков для операций службы BLOB-объектов).  

#### <a name="subheading8"></a>Передача данных в пакетах
В некоторых случаях приложения могут объединять данные локально, а затем периодически отправлять их в пакете вместо немедленной отправки каждого фрагмента данных. Например, веб-приложение может хранить файл журнала действий: hello приложение может либо отправить подробные сведения о каждом действии как он выполняется в сущности таблицы (для которого требуется много операций хранилища), либо его удалось сохранить сведения о tooa локальный файл журнала действий, а затем периодически передать все сведения о действии, как большой двоичный объект tooa файла с разделителями. Если каждая запись журнала имеет размер 1 КБ, можно передать тысяч в одной транзакции «Put BLOB-объект» (вы можете отправить большой двоичный объект из копии too64MB размер в рамках одной транзакции). Конечно, при сбое передачи предыдущих toohello локального компьютера hello потенциально данные будут потеряны некоторые журнала: hello разработчику приложения необходимо разработать hello возможности клиентского устройства или передать сбоев.  Если данные о действиях hello должен toobe загружаться интервалы (не только одно действие), с помощью таблицы рекомендуются больших двоичных объектов.

### <a name="net-configuration"></a>Конфигурация .NET
Если с помощью hello .NET Framework, в этом разделе перечислены некоторые параметры быстрой настройки, которые можно использовать toomake значительное повышение производительности.  При использовании других языков, проверьте toosee, если одинаковые принципы применяются в выбранный язык.  

#### <a name="subheading9"></a>Увеличение ограничения числа подключений по умолчанию
В .NET, после кода hello увеличивает число подключений по умолчанию hello (которая обычно является 2 в среде клиента или 10 в серверной среде) too100. Как правило следует задать hello значение tooapproximately hello количество потоков, используемых приложением.  

```csharp
ServicePointManager.DefaultConnectionLimit = 100; //(Or More)  
```

Необходимо задать предел для числа подключений hello перед открытием все подключения.  

Для других языков программирования см. как ограничить подключения hello tooset toodetermine документации этого языка.  

Дополнительные сведения см. в разделе блога hello [веб-служб: одновременных подключений](http://blogs.msdn.com/b/darrenj/archive/2005/03/07/386655.aspx).  

#### <a name="subheading10"></a>
Этот код приведет к увеличению min hello потоков пула:  

```csharp
ThreadPool.SetMinThreads(100,100); //(Determine hello right number for your application)  
```

Дополнительные сведения см. в статье [ThreadPool.SetMinThreads Method (Int32, Int32)](http://msdn.microsoft.com/library/system.threading.threadpool.setminthreads%28v=vs.110%29.aspx) (Метод ThreadPool.SetMinThreads (Int32, Int32)).  

#### <a name="subheading11"></a>
Используйте .NET 4.5 или более поздней версии для hello клиентского приложения tootake преимуществами увеличение производительности сборка мусора сервера.

Дополнительные сведения см. в статье hello [Общие сведения для улучшения производительности в .NET 4.5](http://msdn.microsoft.com/magazine/hh882452.aspx).  

### <a name="subheading12"></a>Неограниченный параллелизм
Параллелизм может быть удобно для производительности, следует быть осторожным при unbounded параллелизма (без ограничений на число потоков и/или параллельных запросов hello) tooupload или загрузки данных с помощью нескольких работников tooaccess несколько секций (контейнеры, очереди, или Таблица разделов) в hello одной учетной записи хранилища или tooaccess нескольких элементов в hello одной секции. Если unbounded hello параллелизма, приложение может превосходить возможности hello клиентского устройства и hello целевые показатели масштабируемости учетной записи хранилища приведет к более продолжительные задержки и регулирования.  

### <a name="subheading13"></a>Клиентские библиотеки и средства хранилища
Всегда используйте hello последнюю предоставленный Майкрософт клиентских библиотек и средств. На момент написания статьи hello являются клиентские библиотеки для .NET, Windows Phone, среды выполнения Windows, Java и C++, а также предварительного просмотра библиотек для других языков. Кроме того, корпорация Майкрософт выпустила командлеты PowerShell и команды CLI Azure для работы с хранилищем Azure. Корпорация Майкрософт активно разрабатывает эти средства повышения производительности, сохраняет их копию toodate с hello последние версии службы и гарантирует, что они обрабатывают многие hello внутренне доказано производительности и рекомендации.  

### <a name="retries"></a>Повторы
#### <a name="subheading14"></a>Регулирование количества запросов и состояние "Сервер занят"
В некоторых случаях служба хранилища hello может регулировать приложения может просто невозможно tooserve hello запрос из-за временного состояния toosome и быть возвращать сообщение «503. сервер занят» или «500 Timeout».  Это может произойти, если приложение приближается к любой цели масштабирования hello, или если hello системы перераспределения вашей tooallow секционированных данных более высокую пропускную способность.  клиентское приложение Hello обычно следует повторить hello операция, вызывающая такой ошибки: попытка hello же запрос позже может быть успешным. Тем не менее если служба хранилища hello регулирует приложения, так как он является превышение целей масштабирования или даже если служба hello не удается tooserve hello запроса по другой причине, агрессивной попыток обычно усугубляет hello проблему. По этой причине следует использовать экспоненциальное в пассивном режиме (hello клиентских библиотек toothis по умолчанию). Например, приложение может повторить действие через 2 секунды, затем через 4 секунды, затем через 10 секунд, затем через 30 секунд, а затем полностью отказаться от повторения. Это поведение результатов в приложении, значительно уменьшая его нагрузку на службу hello, а не exacerbating проблемы.  

Обратите внимание, что ошибок подключения могут быть повторены немедленно, из-за не hello вследствие регулирования количества запросов их ожидаемый toobe временной.  

#### <a name="subheading15"></a>Ошибки без повторов
клиентские библиотеки Hello известно какие ошибки являются возможностью повторной попытки, а какие — нет. При написании кода с хранилищами, hello REST API, обратите внимание на некоторые ошибки, которые не следует повторить: например, 400 (неправильный запрос), ответ означает, что клиентское приложение hello отправил запрос, который не может быть обработан, так как он не в форме ожидаемым. Повторная отправка запроса приведет к hello же ответе каждый раз, поэтому нет смысла повторять его. При написании кода с хранилищами, hello REST API, следует учитывать какие hello коды ошибок tooretry надлежащей среднее и hello (или не) для каждого из них.  

#### <a name="useful-resources"></a>Полезные ресурсы
Дополнительные сведения о кодах ошибок носителей см. в разделе [коды состояний и ошибок](http://msdn.microsoft.com/library/azure/dd179382.aspx) на веб-сайте Microsoft Azure hello.  

## <a name="blobs"></a>BLOB-объекты
В добавление toohello проверенные методики [все службы](#allservices) было описано выше, применяются следующие hello проверенные методики специально toohello BLOB-объектов.  

### <a name="blob-specific-scalability-targets"></a>Целевые показатели масштабируемости, характерные для BLOB-объекта
#### <a name="subheading46"></a>Несколько клиентов, одновременно обращающихся к одному объекту
При наличии большого числа клиентов, параллельный доступ к один объект потребуется tooconsider каждого объекта и хранения целевые показатели масштабируемости учетной записи. Hello точное число клиентов, которые могут обращаться к один объект будет различаться в зависимости от таких факторов, как hello несколько клиентов одновременно, запрашивающих hello объекта размер hello объекта hello, сети условий и т. д.

Если hello объекта могут быть распространены с помощью обслуживаться CDN, такие как изображения или видео с веб-сайта, то следует использовать CDN. Дополнительные сведения см. [здесь](#subheading5).

В других сценариях, например научных моделирования, где hello данные являются конфиденциальными имеются две возможности. Во-первых, Hello является toostagger обращения за определенный период времени vs, к которому выполняется доступ одновременно к рабочей нагрузке доступ, в частности, hello объекта. Кроме того можно скопировать временно hello учетные записи для хранения объекта toomultiple тем самым повышая hello всего операций ввода-ВЫВОДА на объект и нескольких учетных записей хранения. В ограниченное тестирование мы обнаружили, что около 25 виртуальных машин может одновременно загружать большой двоичный объект 100 ГБ в параллельном режиме (каждая виртуальная машина параллелизации hello загрузки с помощью 32 потока). Если у вас есть 100 клиентов необходимости tooaccess hello объекта, сначала скопируйте его tooa вторую учетную запись хранилища имеют hello первые 50 виртуальных машин доступа hello первый BLOB-объект и hello второй 50 виртуальных машин доступа hello второй большого двоичного объекта. Результаты будут зависеть от поведения приложений, поэтому это следует проверить во время разработки. 

#### <a name="subheading16"></a>Пропускная способность и операции с BLOB-объектом
Вы могли читать или записывать tooa один большой двоичный объект в копии tooa более 60 МБ в секунду (это приблизительно 480 Мбит/с превышает возможности hello несколько сетей стороны клиента (включая hello физический сетевой Адаптер на клиентском устройстве hello). Кроме того один большой двоичный объект поддерживает запросы too500 в секунду. При наличии нескольких клиентов, которым требуется tooread hello же больших двоичных объектов и может превысить эти ограничения, можно использовать в сети доставки Содержимого для распространения hello большого двоичного объекта.  

Дополнительные сведения о целевой пропускной способности для больших двоичных объектов см. в статье [Целевые показатели масштабируемости и производительности службы хранилища Azure](storage-scalability-targets.md).  

### <a name="copying-and-moving-blobs"></a>Копирование и перемещение BLOB-объектов
#### <a name="subheading17"></a>Копирование BLOB-объекта
Hello хранилища версии 2012-02-12 API-интерфейса REST появился hello полезные возможности toocopy BLOB-объектов в учетных записях: клиентское приложение может указать toocopy службы hello хранения большого двоичного объекта из другого источника (возможно, в другую учетную запись хранения) и подождите, пока hello Служба асинхронного выполнения копирования hello. Это может значительно снизить пропускную способность hello, необходимые для приложения hello, при переносе данных из других учетных записей хранилища, так как не требуется toodownload и передача данных hello.  

Во-первых, то, что при копировании между учетными записями хранения, нет гарантии времени по завершении копирования hello. Если приложению toocomplete большой двоичный объект быстро скопировать под вашим управлением, загрузив его tooa виртуальной Машины и затем загрузить toohello назначения может лучше toocopy hello большого двоичного объекта.  Для полного предсказуемость в этом случае убедитесь, что выполняется копирование hello, виртуальная машина, работающая в hello же регионе Azure, в противном случае условий сети между возможно (и, возможно, будет) повлиять на производительность копирования.  Кроме того вы можете отслеживать ход выполнения hello асинхронную копию программными средствами.  

Обратите внимание, что копирование в пределах одной учетной записи хранения, сам обычно выполняются быстро hello.  

Дополнительную информацию см. в статье [Copy Blob](http://msdn.microsoft.com/library/azure/dd894037.aspx) (Копирование большого двоичного объекта).  

#### <a name="subheading18"></a>Использование программы AzCopy
Группа разработчиков хранилища Azure Hello выпустила средство командной строки «AzCopy», предназначены toohelp при массовой передаче много BLOB-объектов для из и в учетных записях хранения.  Этот инструмент оптимизирован специально для такого случая и может достигать высоких скоростей передачи данных.  Его использование рекомендуется для случаев массовой отправки, загрузки и копирования данных. Дополнительные сведения о его toolearn и загрузить его см. в разделе [перенесите данные с помощью служебной программы командной строки AzCopy hello](storage-use-azcopy.md).  

#### <a name="subheading19"></a>Служба импорта и экспорта Azure
Для очень больших объемов данных (более 1 ТБ) hello хранилища Azure предлагает hello службы импорта и экспорта, позволяющую для выгрузки и загрузки из хранилища больших двоичных объектов по доставке жестких дисков.  Можно разбить данные на жестком диске и отправить его tooMicrosoft для передачи или toodownload отправку tooMicrosoft пустой жесткий диск.  Дополнительные сведения см. в разделе [использовать hello службы импорта и экспорта Microsoft Azure tooTransfer данных tooBlob хранения](../storage-import-export-service.md).  Это может быть более эффективным, чем передаче или загрузке этого тома данных по сети hello.  

### <a name="subheading20"></a>Использование метаданных
Служба BLOB-объектов Hello поддерживает головного запросы, которые могут включать метаданные о больших двоичных объектов hello. Например при необходимости приложение hello EXIF данных из фотографию он может получить фото hello и извлеките его. toosave пропускной способности и повышения производительности, приложение может сохранять данные EXIF hello в метаданных hello большого двоичного объекта, отправке приложения hello фото hello: после этого можно получать данные EXIF hello в метаданных с использованием только проверки ПОДЛИННОСТИ, экономя пропускную способность значительные и время обработки hello tooextract hello EXIF данные каждый раз hello BLOB-объект доступен для чтения. Это будет полезно в сценариях, где требуется только метаданные hello и hello не полное содержимое большого двоичного объекта.  Обратите внимание, что только 8 КБ метаданные могут храниться на BLOB-объект (hello служба не будет принимать toostore запроса, больше указанного,), поэтому если hello данные не помещаются в этот размер, вы не имеете права быть этот подход может toouse.  

Пример того, как tooget метаданные большого двоичного объекта, с помощью .NET, в разделе [набор получить свойства и метаданные](../blobs/storage-properties-metadata.md).  

### <a name="uploading-fast"></a>Быстрая отправка
— Первый вопрос tooanswer hello tooupload BLOB-объектов быстрого: вы Отправка одного большого двоичного объекта» или «много?  Используйте hello ниже рекомендации toodetermine hello правильный метод toouse в зависимости от вашего сценария.  

#### <a name="subheading21"></a>Быстрая отправка одного BLOB-объекта
tooupload одной большой больших двоичных объектов быстро, клиентского приложения должен передавать его блокировки или страницы в параллельном режиме (будет учитывать hello целевые показатели масштабируемости для отдельных больших двоичных объектов и hello учетной записи хранения в целом).  Обратите внимание, что hello официальный предоставленный корпорацией Майкрософт RTM хранилища клиентские библиотеки (.NET, Java) hello возможность toodo это.  Для каждой из библиотек hello используйте hello ниже указанного объекта tooset hello уровень параллелизма:  

* .NET: Набор ParallelOperationThreadCount на toobe объекта BlobRequestOptions используется.
* Java/Android: используйте функцию BlobRequestOptions.setConcurrentRequestCount()
* Node.js: Для использования parallelOperationThreadCount параметры запроса либо hello и hello BLOB-объектов.
* C++: Метод blob_request_options::set_parallelism_factor hello.

#### <a name="subheading22"></a>Быстрая отправка множества BLOB-объектов
Многие быстро, большие двоичные объекты tooupload Отправка BLOB-объектов в параллельном режиме. Это быстрее, чем отправка одного больших двоичных объектов одновременно с параллельного блока передачи, так как она распространяется hello передачи по нескольким секциям hello службы хранилища. Один BLOB-объект поддерживает пропускную способность не более 60 МБ/с (около 480 Мбит/с). На момент написания статьи hello учетной записи на основе США LRS поддерживает до too20 входящих Гбит/с, являющийся гораздо более чем пропускная способность hello поддерживается отдельные BLOB-объект.  [AzCopy](#subheading18) выполняет параллельную отправку по умолчанию, как и рекомендуется для данного случая.  

### <a name="subheading23"></a>Выбор правильного типа hello большого двоичного объекта
Служба хранилища Azure поддерживает два типа больших двоичных объектов: *страничные* BLOB-объекты и *блочные* BLOB-объекты. Для использования данного сценария Выбор типа blob повлияет hello производительности и масштабируемости решения. При необходимости tooupload больших объемов данных, эффективно подходят блочных больших двоичных объектов: например, клиентское приложение может потребоваться tooupload фото или видео tooblob хранилища. Страничные большие двоичные объекты подходят, если приложение hello должно tooperform произвольные операции записи данных hello: например, Azure виртуальные жесткие диски хранятся в виде страничных больших двоичных объектов.  

Дополнительные сведения см. в статье [Understanding Block Blobs, Append Blobs, and Page Blobs](http://msdn.microsoft.com/library/azure/ee691964.aspx) (Основные сведения о блочных, добавочных и страничных BLOB-объектах).  

## <a name="tables"></a>Таблицы
В добавление toohello проверенные методики [все службы](#allservices) было описано выше, применяются следующие hello проверенные методики специально toohello службы таблиц.  

### <a name="subheading24"></a>Целевые показатели масштабирования для таблицы
В добавление ограничения пропускной способности toohello всего хранилища учетной записи таблицы имеют следующие предел конкретных масштабируемости hello.  Обратите внимание, что система hello загружает баланс при увеличении вашего трафика, но если резкому увеличению трафика, вы не имеете права сразу стать может tooget этот объем пропускной способности.  Если ваш шаблон имеет пакетами, следует ожидать, что регулирование toosee и/или время ожидания во время hello пакетов как служба хранилища hello, автоматически равномерно распределяется из таблицы.  Увеличивать медленно обычно имеет лучшие результаты, как он обеспечивает баланс tooload hello системы времени соответствующим образом.  

#### <a name="entities-per-second-account"></a>Сущностей в секунду (учетная запись)
предел масштабируемости Hello для доступа к таблицам работает too20 000 сущностей (1 КБ) в секунду для учетной записи.  Обычно каждая сущность, которая вставляется, обновляется, удаляется или сканируется, идет в счет этой цели.  Так, пакетная вставка, которая содержит 100 сущностей, будет считаться за 100 сущностей.  Запрос, который сканирует 1000 сущностей и возвращает 5 из них, будет считаться за 1000 сущностей.  

#### <a name="entities-per-second-partition"></a>Сущностей в секунду (раздел)
Здравствуйте, целевой показатель масштабируемости в одной секции, доступ к таблицам — 2 000 сущностей (1 КБ) в секунду, с помощью hello же инвентаризации как описано в предыдущем разделе hello.  

### <a name="configuration"></a>Конфигурация
В этом разделе перечислены некоторые параметры быстрой настройки, toomake значительное повышение производительности можно использовать в службе таблиц hello.  

#### <a name="subheading25"></a>Использование JSON
Начиная с версии службы хранилища 2013-08-15, hello служба таблиц поддерживает JSON вместо формата hello AtomPub на основе XML для передачи данных в таблице. Это число можно уменьшить размер полезных данных, до 75% и может значительно повысить производительность приложения hello.

Дополнительные сведения см. в статье блога hello [таблиц Microsoft Azure: введение в JSON](http://blogs.msdn.com/b/windowsazurestorage/archive/2013/12/05/windows-azure-tables-introducing-json.aspx) и [формат полезных данных для операций службы таблиц](http://msdn.microsoft.com/library/azure/dn535600.aspx).

#### <a name="subheading26"></a>Отключение алгоритма Nagle
Алгоритм Nagle широко применяется в сетях TCP/IP в производительности означает tooimprove сети. Тем не менее он не является оптимальным во всех случаях (включая высокоинтерактивные среды). Алгоритм Nagle оказывает негативное влияние на производительность hello toohello запросы таблиц и очередей служб для хранилища Azure, и необходимо отключить их, если это возможно.  

Дополнительные сведения см. наш блога [алгоритм Nagle является не понятным для небольших запросов](http://blogs.msdn.com/b/windowsazurestorage/archive/2010/06/25/nagle-s-algorithm-is-not-friendly-towards-small-requests.aspx), которой объясняется, почему алгоритм Nagle плохо взаимодействует с запросами, таблиц и очередей и показано, как toodisable его в клиентском приложении приложение.  

### <a name="schema"></a>Схема
Как представления и запроса данных — главное hello один фактор, который влияет на производительность hello hello службы таблиц. Поскольку приложения отличаются друг от друга, в данном разделе излагаются некоторые общие проверенные подходы, которые относятся к:  

* конструктору таблиц;
* эффективным запросам;
* эффективным обновлениям данных.  

#### <a name="subheading27"></a>Таблицы и секции
Таблицы разделены на разделы. Каждая сущность хранятся в разделе общих ресурсов hello одинаковым ключом секции и имеет уникальную строку ключа tooidentify его в этой секции. Разделы предоставляют преимущества, но также вводят ограничения по масштабируемости.  

* Преимущества: Вы можете обновить сущностей в hello же секции в пакете одинарные, атомарные, транзакции, которая содержит копии too100 хранить операций (ограничение на общий размер 4 МБ). При условии, что hello одинаковый номер из сущности toobe получены, можно также выполнить запрос данных в одной секции более эффективно, чем данных, охватывающих несколько секций (хотя для чтения на дополнительные рекомендации по запросу данных таблицы).
* Предел масштабируемости: tooentities доступа хранятся в одной секции не может быть балансировкой нагрузки секций поддерживает атомарные пакетные транзакции. По этой причине hello цель масштабируемости для отдельной таблицы разделов ниже, чем для службы таблиц hello в целом.  

Из-за эти характеристики таблиц и секций необходимо принимать hello следующие принципы разработки:  

* Данные, которые клиентское приложение обновляется или часто запрашиваемых в hello же логическая единица работы должна находиться в hello одной секции.  Возможно, поскольку приложение выполняет статистическую обработку операций записи или вы хотите tootake преимуществами атомарные пакетные операции.  Кроме того, данные, находящиеся в одном разделе, могут быть с большим успехом запрошены в одном обращении, чем данные, которые находятся в разных разделах.
* Данные, которые клиентское приложение не вставки или обновления или запроса в hello же логическая единица работы (одного запроса или пакета обновления) должен находиться в отдельные разделы.  Одно важное замечание то, что не toohello ограничить количество разделов в одной таблице, поэтому наличие миллионы ключи разделов не вызывает проблем и не влияют на производительность.  Например если приложение является популярных веб-сайт с именем входа пользователя, с помощью hello идентификатор пользователя в качестве ключа секции hello может быть хорошим выбором.  

#### <a name="hot-partitions"></a>Горячие разделы
Горячий секции то, которое получает непропорционального процент от учетной записи tooan трафика hello и не может обеспечить балансировку нагрузки, так как это один раздел.  Обычно горячие разделы создаются одним из двух способов:  

##### <a name="subheading28"></a>Инкрементируемые и декрементируемые шаблоны
шаблон «Добавление только» Hello является одним где все или почти все tooa трафика hello заданному PK увеличивается и уменьшается соответствующим toohello текущее время.  Например, если приложение используется hello текущую дату в качестве ключа секции для данных журнала.  Это приведет к всех вставок hello переходом toohello последнюю секцию в таблице и hello система не может загрузить баланс, поскольку все операции записи hello не конец toohello постоянной таблицы.  Если hello объем трафика toothat раздела превышает целевой показатель масштабируемости уровне секции hello, это приведет регулирования.  Это лучше tooensure, трафик секций toomultiple hello балансировки нагрузки tooenable запрашивает по таблице.  

##### <a name="subheading29"></a>Данные с интенсивным трафиком
Если результаты схему секционирования в одной секции, содержит только данные, которые используются гораздо более чем в других секциях, также возможны регулирования как hello цель масштабируемости для одной секции, приближается к этой секции.  Это лучше toomake в том, что результаты схему секционирования в нет единственного секции около целевые показатели масштабируемости hello.  

#### <a name="querying"></a>Выполнение запроса
В этом разделе описываются проверенные методики для выполнения запросов к службе таблиц hello.  

##### <a name="subheading30"></a>Область запроса
Существует несколько способов toospecify hello спектр tooquery сущностей.  Hello ниже приводится описание использует hello каждого.  

Как правило избежать проверок (запросов больше, чем одной сущности), но если необходимо проверить, попробуйте tooorganize данных, чтобы ваш просмотров извлекать hello данных без сканирования или возвращение значительное количество сущностей, которые не требуются.  

###### <a name="point-queries"></a>Точечные запросы
Точечный запрос извлекает ровно одну сущность. Это делается путем указания hello ключ раздела и ключ строки сущности tooretrieve hello. Эти запросы являются очень эффективными, и их следует использовать везде, где это возможно.  

###### <a name="partition-queries"></a>Запросы разделов
Запрос раздела — это запрос, который извлекает набор данных, совместно использующих общий ключ раздела. Как правило запрос hello указывает диапазон значений ключа строки или диапазон значений для некоторых свойств сущности в ключ раздела tooa сложения. Они менее эффективны, чем точечные запросы, и их следует использовать с осторожностью.  

###### <a name="table-queries"></a>Табличные запросы
Табличный запрос — это запрос, который извлекает набор сущностей, не использующих совместно общий ключ раздела. Эти запросы не являются эффективными, и, если это возможно, следует избегать их использования.  

##### <a name="subheading31"></a>Плотность запроса
Другим ключевым фактором эффективность запросов: hello число сущностей, возвращаемых как сравниваемых toohello возвращаемого количества сущностей hello отсканированные toofind задано. Если приложение выполняет запрос таблицы с фильтром для значения свойства, что только 1% общих ресурсов данных hello, hello запрос будет сканировать 100 сущностей для каждого одной сущности, он возвращает. Hello целевые показатели масштабируемости таблице описано ранее, все связанные toohello количество сущностей, проверенных и не hello возвращаемого количества сущностей: плотность низкий запроса может легко привести к toothrottle службы таблицы hello приложения так, как должно проверять так много hello сущность tooretrieve сущности, которую вы ищете.  В разделе hello ниже на [денормализации](#subheading34) Дополнительные сведения о том, как tooavoid это.  

##### <a name="limiting-hello-amount-of-data-returned"></a>Ограничение сумма данные возвращаются hello
###### <a name="subheading32"></a>Фильтрация
Когда вы знаете, что запрос возвращает сущности, которые не требуется в клиентском приложении hello, рассмотрите возможность использования размером hello tooreduce фильтр вернул набор hello. При передаче hello сущностей не toohello клиент по-прежнему учитываются hello ограничения масштабирования, производительность приложений будет повышения из-за размер полезных данных сетевого ограниченной hello и уменьшению числа сущностей, которые необходимо обработать клиентское приложение hello .  См. выше Обратите внимание на [плотность запроса](#subheading31), однако — целевые показатели масштабируемости hello связаны toohello количество сущностей, которые проверяются, поэтому запрос, который отфильтровывает большого количества объектов может по-прежнему привести регулирования, даже если возвращается несколько сущностей.  

###### <a name="subheading33"></a>Проекция
Если клиентское приложение должно только ограниченный набор свойств из hello сущностей в таблице, можно использовать размер hello toolimit проекции hello возвращаемого набора данных. При фильтрации это помогает tooreduce сетевой нагрузки и обработка на клиенте.  

##### <a name="subheading34"></a>Денормализация
В отличие от работы с реляционными базами данных hello методики для эффективного выполнения запросов данных таблицы привести toodenormalizing данных. То есть, дублирование hello и тех же данных в нескольких сущностях (одно для каждого ключа может использовать данные hello toofind) toominimize hello количество сущностей, что запрос должен сканировать потребности toofind hello данных hello клиента, а не tooscan большое число toofind сущностей Hello данные приложению.  Например, в веб-сайт электронной коммерции, может потребоваться toofind заказ обоих по Идентификатору клиента hello (приведите заказов этого клиента) и по дате hello (приведите заказы в день).  В хранилище таблиц, это лучший сущности toostore hello (или tooit ссылку) дважды: один раз с именем таблицы, PK и RK toofacilitate поиск по Идентификатору клиента, один раз toofacilitate его поиск по дате hello.  

#### <a name="insertupdatedelete"></a>Вставить, обновить, удалить
В этом разделе описываются проверенные методы изменения сущностей, хранящихся в службе таблиц hello.  

##### <a name="subheading35"></a>Пакетная обработка
Пакетные транзакции известны как транзакции группы сущностей (ETG) в хранилище Azure; все операции hello в ETG должны быть в одной секции в одной таблице. По возможности используйте ETGs tooperform вставок, обновлений и удалений в пакетах. Это уменьшает hello количество циклов приема-передачи от сервера toohello клиентских приложений, уменьшает hello количество оплачиваемых транзакции (ETG считается как одна транзакция выставления и может содержать копирование операций сохранения too100), позволяет atomic обновления (успешного выполнения всех операций или все завершиться сбоем в ETG). Среды с большими задержками, такие как мобильные устройства, в результате использования транзакций групп сущностей получают большие преимущества.  

##### <a name="subheading36"></a>Операция Upsert
Используйте табличные операции **Upsert** как можно чаще. Существует два типа операций **Upsert**. Оба они могут быть более эффективными, чем обычные операции **Insert** и **Update**:  

* **InsertOrMerge**: следует использовать, если вы хотите tooupload подмножество свойств сущности hello, но не уверены ли hello сущность уже существует. Если существует hello объекта, этот вызов обновляет свойства hello, включенных в hello **Upsert** операции и оставляет все существующие свойства, как они являются, если hello сущность не существует, он вставляет новую сущность hello. Это аналогично toousing проекции в запросе, в том, что требуется только tooupload hello свойства, которые изменяются.
* **InsertOrReplace**: следует использовать, если требуется tooupload совершенно новые сущности, но вы не уверены, является ли он уже существует. Вам следует использовать только если известно, что hello вновь отправлен сущности является полностью ошибкой, поскольку он полностью переписывает hello старая сущность. Например можно tooupdate hello сущность, которая хранит текущее расположение пользователя независимо от того, является ли приложение hello ранее сохраненные данные расположение для пользователя hello. Новая сущность расположение Hello завершена, и все сведения из любой предыдущей сущности не требуется.

##### <a name="subheading37"></a>Хранение ряда данных в одной сущности
В некоторых случаях приложение сохраняет ряд данных, что часто требуется tooretrieve за один раз: например, приложение может отслеживать использование ЦП по времени в порядке tooplot последовательного плана данных hello из hello последние 24 часа. Один из подходов заключается сущность toohave одной таблицы в час, с каждой сущности, представляющий конкретный час и хранения hello ЦП в течение этого часа. tooplot эти данные приложения hello должен tooretrieve hello сущностей хранения данных hello из hello 24 часа, последние.  

Кроме того, приложение может хранить использования hello ЦП за каждый час как отдельные свойства одной сущности: tooupdate каждый час, приложение может использовать отдельный **InsertOrMerge Upsert** вызова tooupdate hello значение для hello самые последние час. данные tooplot hello, hello приложению требуются только одной сущности вместо 24, выполняющего запрос очень эффективен tooretrieve (см. выше обсуждения на [область запроса](#subheading30)).

##### <a name="subheading38"></a>Хранение структурированных данных в BLOB-объектах
Иногда кажется, что структурированные данные должны попадать в таблицы, но диапазоны сущностей всегда извлекаются вместе и могут быть вставлены пакетным образом.  Хорошим примером такой ситуации является файл журнала.  В этом случае несколько минут из журнала можно укомплектовать в пакет, затем произвести их вставку и потом, с тем же успехом, извлекать несколько минут журнала за раз.  В этом случае для повышения производительности, это лучше toouse больших двоичных объектов, а не таблиц, так как вы может значительно снизить количество hello записи/возвращаемые объекты, а также обычно hello число запросов, требующих.  

## <a name="queues"></a>Очереди
В добавление toohello проверенные методики [все службы](#allservices) было описано выше, применяются следующие hello проверенные методики специально toohello службы очередей.  

### <a name="subheading39"></a>Ограничения масштабируемости
Одна очередь может обрабатывать около 2000 сообщений (размером 1 КБ каждое) в секунду (здесь каждая операция AddMessage, GetMessage и DeleteMessage считается сообщением). Если этого недостаточно для вашего приложения, необходимо использовать несколько очередей и распределяться сообщений hello.  

Текущие целевые показатели масштабируемости можно посмотреть на странице [Цели масштабируемости хранилища и производительности Azure](storage-scalability-targets.md).  

### <a name="subheading40"></a>Отключение алгоритма Nagle
Разделе hello таблицы конфигурацию, которая описывает алгоритм Nagle hello — алгоритм Nagle hello обычно плохо сказывается на производительности hello очереди запросов, и оно должно быть отключено.  

### <a name="subheading41"></a>Размер сообщения
Производительность и масштабируемость очередей уменьшается по мере увеличения размера сообщения. Необходимо поместить только hello hello приемника потребности в сообщении.  

### <a name="subheading42"></a>Пакетное извлечение
Вы можете получать too32 сообщений из очереди в рамках одной операции. Это позволяет сократить hello количество обращений из клиентского приложения hello, что особенно полезно в средах, таких как мобильные устройства с большой задержкой.  

### <a name="subheading43"></a>Интервал опроса очереди
Большинство приложений извлекать сообщения из очереди, который может быть одним из источников наибольшее hello транзакций для этого приложения. Выберите интервал опроса рационально: опроса слишком часто может привести к tooapproach вашего приложения hello целевые показатели масштабируемости для очереди hello. Тем не менее на 200 000 транзакций для 0,01 $ (во время hello написания) опроса после каждую секунду в течение месяца будет стоить меньше 15 центам стоимости т один процессор не обычно коэффициент, на который влияет на Выбор интервала опроса.  

Актуальные сведения о стоимости см. на странице [Цены на хранилища Azure](https://azure.microsoft.com/pricing/details/storage/).  

### <a name="subheading44"></a>UpdateMessage
Можно использовать **UpdateMessage** tooincrease hello невидимости истечения времени ожидания или tooupdate сведения о состоянии сообщения. Это мощный, помните, что каждый **UpdateMessage** операции учитывается при подсчете целевой показатель масштабируемости hello. Тем не менее это может быть намного более эффективным подходом чем рабочий процесс, который передает задания из очереди toohello Далее при завершении каждого шага задания hello. С помощью hello **UpdateMessage** операция позволяет вашего приложения toosave hello задания toohello сообщение о состоянии и затем продолжить работу, вместо повторного очереди приветственное сообщение для следующего шага задания hello каждый раз при завершении шага hello.  

Дополнительные сведения см. в статье hello [как: изменить содержимое hello сообщение из очереди](../queues/storage-dotnet-how-to-use-queues.md#change-the-contents-of-a-queued-message).  

### <a name="subheading45"></a>Архитектура приложения
Масштабируемая архитектура приложения следует использовать toomake очереди. Hello ниже приведены некоторые способы использования очередей toomake масштабируемое приложения:  

* Можно использовать для обработки очередей toocreate невыполненной работы и сглаживают рабочих нагрузок в приложении. Например можно поставить в очередь запросы от пользователей tooperform процессора вычислительных операций, например изменение размера переданные изображения.
* Можно использовать очереди toodecouple части приложения, чтобы масштабировать их независимо друг от друга. Например, клиент веб-интерфейса может разместить результаты опроса пользователей в очередь для последующего анализа и хранения. Вы может добавить дополнительные рабочей роли экземпляров tooprocess hello данных очередь при необходимости.  

## <a name="conclusion"></a>Заключение
В этой статье рассматриваются некоторые из наиболее распространенных hello проверенных и рекомендации по оптимизации производительности при использовании хранилища Azure. Мы стимулировать каждый tooassess разработчика приложения свои приложения для каждой hello выше рекомендациям и примите к сведению действуя hello рекомендации tooget высокую производительность для приложений, использующих хранилище Azure.
