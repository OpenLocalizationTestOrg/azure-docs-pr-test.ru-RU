---
title: "Использование подписанных URL-адресов (SAS) в службе хранилища Azure | Документация Майкрософт"
description: "Сведения о делегировании доступа к ресурсам службы хранилища Azure, включая большие двоичные объекты, очереди, таблицы и файлы, с помощью подписанного URL-адреса (SAS)."
services: storage
documentationcenter: 
author: mmacy
manager: timlt
editor: tysonn
ms.assetid: 46fd99d7-36b3-4283-81e3-f214b29f1152
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 04/18/2017
ms.author: marsma
ms.openlocfilehash: ae944eae4e62132e47bf9069d83817a1a6779ff7
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="using-shared-access-signatures-sas"></a><span data-ttu-id="3572d-103">Использование подписанных URL-адресов (SAS)</span><span class="sxs-lookup"><span data-stu-id="3572d-103">Using shared access signatures (SAS)</span></span>

<span data-ttu-id="3572d-104">Подписанный URL-адрес (SAS) позволяет вам предоставлять другим клиентам ограниченный доступ к объектам в вашей учетной записи хранения без предоставления ключа вашей учетной записи.</span><span class="sxs-lookup"><span data-stu-id="3572d-104">A shared access signature (SAS) provides you with a way to grant limited access to objects in your storage account to other clients, without exposing your account key.</span></span> <span data-ttu-id="3572d-105">В этой статье содержится обзор модели SAS, рекомендации по использованию SAS, а также рассмотрены некоторые примеры.</span><span class="sxs-lookup"><span data-stu-id="3572d-105">In this article, we provide an overview of the SAS model, review SAS best practices, and look at some examples.</span></span>

<span data-ttu-id="3572d-106">Дополнительные примеры кода, использующего SAS, кроме представленных здесь, см. в статье [Приступая к работе с хранилищем BLOB-объектов Azure в .NET](https://azure.microsoft.com/documentation/samples/storage-blob-dotnet-getting-started/). Другие примеры см. в библиотеке [Примеры кода Azure](https://azure.microsoft.com/documentation/samples/?service=storage).</span><span class="sxs-lookup"><span data-stu-id="3572d-106">For additional code examples using SAS beyond those presented here, see [Getting Started with Azure Blob Storage in .NET](https://azure.microsoft.com/documentation/samples/storage-blob-dotnet-getting-started/) and other samples available in the [Azure Code Samples](https://azure.microsoft.com/documentation/samples/?service=storage) library.</span></span> <span data-ttu-id="3572d-107">Вы можете скачать примеры приложений и запустить их или просмотреть код на GitHub.</span><span class="sxs-lookup"><span data-stu-id="3572d-107">You can download the sample applications and run them, or browse the code on GitHub.</span></span>

## <a name="what-is-a-shared-access-signature"></a><span data-ttu-id="3572d-108">Что такое подписанный URL-адрес?</span><span class="sxs-lookup"><span data-stu-id="3572d-108">What is a shared access signature?</span></span>
<span data-ttu-id="3572d-109">Подпись общего доступа обеспечивает делегированный доступ к ресурсам в вашей учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="3572d-109">A shared access signature provides delegated access to resources in your storage account.</span></span> <span data-ttu-id="3572d-110">С помощью SAS можно предоставить клиентам доступ к ресурсам в учетной записи хранения, не предоставляя общий доступ к ключам учетной записи.</span><span class="sxs-lookup"><span data-stu-id="3572d-110">With a SAS, you can grant clients access to resources in your storage account, without sharing your account keys.</span></span> <span data-ttu-id="3572d-111">Это ключевой момент использования подписанного URL-адреса в приложениях — SAS представляет собой безопасный способ предоставления общего доступа к ресурсам хранилища без ущерба для ключей учетной записи.</span><span class="sxs-lookup"><span data-stu-id="3572d-111">This is the key point of using shared access signatures in your applications--a SAS is a secure way to share your storage resources without compromising your account keys.</span></span>

[!INCLUDE [storage-account-key-note-include](../../includes/storage-account-key-note-include.md)]

<span data-ttu-id="3572d-112">SAS обеспечивает детализированный контроль над типом доступа, предоставляемого клиентам, имеющим SAS, включая:</span><span class="sxs-lookup"><span data-stu-id="3572d-112">A SAS gives you granular control over the type of access you grant to clients who have the SAS, including:</span></span>

* <span data-ttu-id="3572d-113">Период действия SAS, включая время начала и окончания срока действия.</span><span class="sxs-lookup"><span data-stu-id="3572d-113">The interval over which the SAS is valid, including the start time and the expiry time.</span></span>
* <span data-ttu-id="3572d-114">Разрешения, предоставляемые с помощью SAS.</span><span class="sxs-lookup"><span data-stu-id="3572d-114">The permissions granted by the SAS.</span></span> <span data-ttu-id="3572d-115">Например, SAS для большого двоичного объекта может предоставить разрешения на чтение и запись для него, но не разрешение на удаление.</span><span class="sxs-lookup"><span data-stu-id="3572d-115">For example, a SAS for a blob might grant read and write permissions to that blob, but not delete permissions.</span></span>
* <span data-ttu-id="3572d-116">Дополнительный IP-адрес или диапазон IP-адресов, по которым служба хранилища Azure будет принимать SAS.</span><span class="sxs-lookup"><span data-stu-id="3572d-116">An optional IP address or range of IP addresses from which Azure Storage will accept the SAS.</span></span> <span data-ttu-id="3572d-117">Например, можно указать диапазон IP-адресов, принадлежащих организации.</span><span class="sxs-lookup"><span data-stu-id="3572d-117">For example, you might specify a range of IP addresses belonging to your organization.</span></span>
* <span data-ttu-id="3572d-118">Протокол, по которому служба хранилища Azure будет принимать SAS.</span><span class="sxs-lookup"><span data-stu-id="3572d-118">The protocol over which Azure Storage will accept the SAS.</span></span> <span data-ttu-id="3572d-119">С помощью этого необязательного параметра можно ограничить доступ к клиентам, использующим протокол HTTPS.</span><span class="sxs-lookup"><span data-stu-id="3572d-119">You can use this optional parameter to restrict access to clients using HTTPS.</span></span>

## <a name="when-should-you-use-a-shared-access-signature"></a><span data-ttu-id="3572d-120">Когда следует использовать подписанный URL-адрес?</span><span class="sxs-lookup"><span data-stu-id="3572d-120">When should you use a shared access signature?</span></span>
<span data-ttu-id="3572d-121">SAS можно использовать, когда доступ к ресурсам в вашей учетной записи хранения требуется предоставить клиенту, который не имеет ключей доступа к вашей учетной записи.</span><span class="sxs-lookup"><span data-stu-id="3572d-121">You can use a SAS when you want to provide access to resources in your storage account to any client not possessing your storage account's access keys.</span></span> <span data-ttu-id="3572d-122">Ваша учетная запись хранения включает в себя как первичный, так и вторичный ключ, и оба эти ключа предоставляют административный доступ к вашей учетной записи и всем ее ресурсам.</span><span class="sxs-lookup"><span data-stu-id="3572d-122">Your storage account includes both a primary and secondary access key, both of which grant administrative access to your account, and all resources within it.</span></span> <span data-ttu-id="3572d-123">Предоставление любого из этих ключей делает учетную запись уязвимой для вредоносного или небрежного использования.</span><span class="sxs-lookup"><span data-stu-id="3572d-123">Exposing either of these keys opens your account to the possibility of malicious or negligent use.</span></span> <span data-ttu-id="3572d-124">Подписанные URL-адреса обеспечивают безопасную альтернативу, позволяющую клиентам считывать, записывать и удалять данные в вашей учетной записи хранения в соответствии с явно выданными вами разрешениями и без потребности в ключе учетной записи.</span><span class="sxs-lookup"><span data-stu-id="3572d-124">Shared access signatures provide a safe alternative that allows clients to read, write, and delete data in your storage account according to the permissions you've explicitly granted, and without need for an account key.</span></span>

<span data-ttu-id="3572d-125">Распространенным сценарием использования подписей общего доступа является служба, где пользователи считывают и записывают собственные данные в вашей учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="3572d-125">A common scenario where a SAS is useful is a service where users read and write their own data to your storage account.</span></span> <span data-ttu-id="3572d-126">В сценарии, где в учетной записи хранения хранятся пользовательские данные, существует два направления разработки:</span><span class="sxs-lookup"><span data-stu-id="3572d-126">In a scenario where a storage account stores user data, there are two typical design patterns:</span></span>

1. <span data-ttu-id="3572d-127">Клиенты отправляют и скачивают данные с помощью службы интерфейсного прокси-сервера, выполняющей аутентификацию.</span><span class="sxs-lookup"><span data-stu-id="3572d-127">Clients upload and download data via a front-end proxy service, which performs authentication.</span></span> <span data-ttu-id="3572d-128">Эта служба интерфейсного прокси-сервера позволяет проверять бизнес-правила, однако для больших объемов данных или крупных транзакций создание службы, поддерживающей масштабирование в соответствии с потребностями, может оказаться дорогостоящей или сложной задачей.</span><span class="sxs-lookup"><span data-stu-id="3572d-128">This front-end proxy service has the advantage of allowing validation of business rules, but for large amounts of data or high-volume transactions, creating a service that can scale to match demand may be expensive or difficult.</span></span>

  ![Схема сценария. Служба интерфейсного прокси-сервера][sas-storage-fe-proxy-service]

1. <span data-ttu-id="3572d-130">Облегченная служба аутентифицирует клиент по мере необходимости, а затем создает SAS.</span><span class="sxs-lookup"><span data-stu-id="3572d-130">A lightweight service authenticates the client as needed and then generates a SAS.</span></span> <span data-ttu-id="3572d-131">Клиент, получив эту подпись общего доступа, может осуществлять прямой доступ к ресурсам учетной записи хранения с разрешениями, определенными в подписи, и в течение разрешенного подписью периода времени.</span><span class="sxs-lookup"><span data-stu-id="3572d-131">Once the client receives the SAS, they can access storage account resources directly with the permissions defined by the SAS and for the interval allowed by the SAS.</span></span> <span data-ttu-id="3572d-132">Подпись общего доступа уменьшает потребность в маршрутизации всех данных через службу интерфейсного прокси-сервера.</span><span class="sxs-lookup"><span data-stu-id="3572d-132">The SAS mitigates the need for routing all data through the front-end proxy service.</span></span>

  ![Схема сценария. Служба поставщика SAS][sas-storage-provider-service]

<span data-ttu-id="3572d-134">Многие реальные службы могут использовать сочетание этих двух подходов.</span><span class="sxs-lookup"><span data-stu-id="3572d-134">Many real-world services may use a hybrid of these two approaches.</span></span> <span data-ttu-id="3572d-135">Например, некоторые данные обрабатываются и проверяются через интерфейсный прокси-сервер, а другие данные сохраняются и (или) считываются непосредственно с помощью SAS.</span><span class="sxs-lookup"><span data-stu-id="3572d-135">For example, some data might be processed and validated via the front-end proxy, while other data is saved and/or read directly using SAS.</span></span>

<span data-ttu-id="3572d-136">Кроме того, SAS потребуется использовать для проверки подлинности исходного объекта в операции копирования при определенных сценариях:</span><span class="sxs-lookup"><span data-stu-id="3572d-136">Additionally, you will need to use a SAS to authenticate the source object in a copy operation in certain scenarios:</span></span>

* <span data-ttu-id="3572d-137">При копировании большого двоичного объекта в другой большой двоичный объект, который относится к другой учетной записи, необходимо использовать SAS для проверки подлинности исходного большого двоичного объекта.</span><span class="sxs-lookup"><span data-stu-id="3572d-137">When you copy a blob to another blob that resides in a different storage account, you must use a SAS to authenticate the source blob.</span></span> <span data-ttu-id="3572d-138">Вы можете по желанию использовать SAS также для аутентификации конечного большого двоичного объекта.</span><span class="sxs-lookup"><span data-stu-id="3572d-138">You can optionally use a SAS to authenticate the destination blob as well.</span></span>
* <span data-ttu-id="3572d-139">При копировании файла в другой файл, который относится к другой учетной записи, необходимо использовать SAS для проверки подлинности исходного файла.</span><span class="sxs-lookup"><span data-stu-id="3572d-139">When you copy a file to another file that resides in a different storage account, you must use a SAS to authenticate the source file.</span></span> <span data-ttu-id="3572d-140">Вы можете по желанию использовать SAS также для аутентификации конечного файла.</span><span class="sxs-lookup"><span data-stu-id="3572d-140">You can optionally use a SAS to authenticate the destination file as well.</span></span>
* <span data-ttu-id="3572d-141">При копировании большого двоичного объекта в файл или файла в большой двоичный объект, необходимо использовать SAS для проверки подлинности исходного объекта, даже если исходный и конечный объекты относятся к одной и той же учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="3572d-141">When you copy a blob to a file, or a file to a blob, you must use a SAS to authenticate the source object, even if the source and destination objects reside within the same storage account.</span></span>

## <a name="types-of-shared-access-signatures"></a><span data-ttu-id="3572d-142">Типы подписанных URL-адресов</span><span class="sxs-lookup"><span data-stu-id="3572d-142">Types of shared access signatures</span></span>
<span data-ttu-id="3572d-143">Теперь вы можете создавать подписанные URL-адреса двух типов:</span><span class="sxs-lookup"><span data-stu-id="3572d-143">You can create two types of shared access signatures:</span></span>

* <span data-ttu-id="3572d-144">**SAS службы.**</span><span class="sxs-lookup"><span data-stu-id="3572d-144">**Service SAS.**</span></span> <span data-ttu-id="3572d-145">SAS службы делегирует доступ к ресурсу только в одной из служб хранения: службе BLOB-объектов, очередей, таблиц или файлов.</span><span class="sxs-lookup"><span data-stu-id="3572d-145">The service SAS delegates access to a resource in just one of the storage services: the Blob, Queue, Table, or File service.</span></span> <span data-ttu-id="3572d-146">Подробные сведения о создании маркеров SAS службы см. в статьях [Создание SAS службы](https://msdn.microsoft.com/library/dn140255.aspx) и [Примеры SAS службы](https://msdn.microsoft.com/library/dn140256.aspx).</span><span class="sxs-lookup"><span data-stu-id="3572d-146">See [Constructing a Service SAS](https://msdn.microsoft.com/library/dn140255.aspx) and [Service SAS Examples](https://msdn.microsoft.com/library/dn140256.aspx) for in-depth information about constructing the service SAS token.</span></span>
* <span data-ttu-id="3572d-147">**SAS учетной записи.**</span><span class="sxs-lookup"><span data-stu-id="3572d-147">**Account SAS.**</span></span> <span data-ttu-id="3572d-148">SAS учетной записи делегирует доступ к ресурсам в одной или нескольких службах хранилища.</span><span class="sxs-lookup"><span data-stu-id="3572d-148">The account SAS delegates access to resources in one or more of the storage services.</span></span> <span data-ttu-id="3572d-149">SAS учетной записи предоставляет доступ ко всем операциям, которые доступны через SAS службы.</span><span class="sxs-lookup"><span data-stu-id="3572d-149">All of the operations available via a service SAS are also available via an account SAS.</span></span> <span data-ttu-id="3572d-150">Кроме того, SAS учетной записи позволяет делегировать доступ к операциям, относящимся к конкретной службе, таким как **получение и установка свойств службы** или **получение статистики службы**.</span><span class="sxs-lookup"><span data-stu-id="3572d-150">Additionally, with the account SAS, you can delegate access to operations that apply to a given service, such as **Get/Set Service Properties** and **Get Service Stats**.</span></span> <span data-ttu-id="3572d-151">Вы также можете делегировать доступ к операциям чтения, записи и удаления в контейнерах больших двоичных объектов, таблицах, очередях и общих папках, которые запрещены в SAS службы.</span><span class="sxs-lookup"><span data-stu-id="3572d-151">You can also delegate access to read, write, and delete operations on blob containers, tables, queues, and file shares that are not permitted with a service SAS.</span></span> <span data-ttu-id="3572d-152">Подробные сведения о создании маркера SAS учетной записи см. в статье [Создание подписанного URL-адреса уровня учетной записи](https://msdn.microsoft.com/library/mt584140.aspx).</span><span class="sxs-lookup"><span data-stu-id="3572d-152">See [Constructing an Account SAS](https://msdn.microsoft.com/library/mt584140.aspx) for in-depth information about constructing the account SAS token.</span></span>

## <a name="how-a-shared-access-signature-works"></a><span data-ttu-id="3572d-153">Принцип работы подписанного URL-адреса</span><span class="sxs-lookup"><span data-stu-id="3572d-153">How a shared access signature works</span></span>
<span data-ttu-id="3572d-154">Подписанный URL-адрес — это подписанный URI, который указывает на один или несколько ресурсов хранилища и содержит маркер с особым набором параметров запроса.</span><span class="sxs-lookup"><span data-stu-id="3572d-154">A shared access signature is a signed URI that points to one or more storage resources and includes a token that contains a special set of query parameters.</span></span> <span data-ttu-id="3572d-155">Маркер определяет способы доступа к ресурсам, предоставляемые клиенту.</span><span class="sxs-lookup"><span data-stu-id="3572d-155">The token indicates how the resources may be accessed by the client.</span></span> <span data-ttu-id="3572d-156">Один из параметров запроса (подпись) состоит из параметров SAS и подписывается с помощью ключа учетной записи.</span><span class="sxs-lookup"><span data-stu-id="3572d-156">One of the query parameters, the signature, is constructed from the SAS parameters and signed with the account key.</span></span> <span data-ttu-id="3572d-157">Эта подпись используется хранилищем Azure для проверки подлинности подписи общего доступа.</span><span class="sxs-lookup"><span data-stu-id="3572d-157">This signature is used by Azure Storage to authenticate the SAS.</span></span>

<span data-ttu-id="3572d-158">Ниже представлен пример URI SAS, показывающий URI ресурса и маркер SAS:</span><span class="sxs-lookup"><span data-stu-id="3572d-158">Here's an example of a SAS URI, showing the resource URI and the SAS token:</span></span>

![Компоненты URI SAS][sas-storage-uri]

<span data-ttu-id="3572d-160">Маркер SAS — это строка, созданная на стороне [клиента](#sas-examples) (примеры кода см. в разделе *Примеры SAS* ниже).</span><span class="sxs-lookup"><span data-stu-id="3572d-160">The SAS token is a string you generate on the *client* side (see the [SAS examples](#sas-examples) section for code examples).</span></span> <span data-ttu-id="3572d-161">Например, служба хранилища Azure не отслеживает маркер SAS, созданный клиентской библиотекой хранилища.</span><span class="sxs-lookup"><span data-stu-id="3572d-161">A SAS token you generate with the storage client library, for example, is not tracked by Azure Storage in any way.</span></span> <span data-ttu-id="3572d-162">На стороне клиента можно создать неограниченное число маркеров SAS.</span><span class="sxs-lookup"><span data-stu-id="3572d-162">You can create an unlimited number of SAS tokens on the client side.</span></span>

<span data-ttu-id="3572d-163">Если клиент предоставляет URI SAS в службу хранилища Azure как часть запроса, то служба проверяет параметры и подпись SAS, чтобы убедиться, что он является допустимым для аутентификации запроса.</span><span class="sxs-lookup"><span data-stu-id="3572d-163">When a client provides a SAS URI to Azure Storage as part of a request, the service checks the SAS parameters and signature to verify that it is valid for authenticating the request.</span></span> <span data-ttu-id="3572d-164">Если в ходе проверки подпись оказывается допустимой, запрос проходит аутентификацию.</span><span class="sxs-lookup"><span data-stu-id="3572d-164">If the service verifies that the signature is valid, then the request is authenticated.</span></span> <span data-ttu-id="3572d-165">В противном случае запрос отклоняется и происходит ошибка с кодом 403 (запрещено).</span><span class="sxs-lookup"><span data-stu-id="3572d-165">Otherwise, the request is declined with error code 403 (Forbidden).</span></span>

## <a name="shared-access-signature-parameters"></a><span data-ttu-id="3572d-166">Параметры подписанного URL-адреса</span><span class="sxs-lookup"><span data-stu-id="3572d-166">Shared access signature parameters</span></span>
<span data-ttu-id="3572d-167">Некоторые параметры маркеров SAS учетной записи и SAS службы совпадают, но есть и параметры, которые различаются.</span><span class="sxs-lookup"><span data-stu-id="3572d-167">The account SAS and service SAS tokens include some common parameters, and also take a few parameters that that are different.</span></span>

### <a name="parameters-common-to-account-sas-and-service-sas-tokens"></a><span data-ttu-id="3572d-168">Параметры, общие для маркеров SAS учетной записи и SAS службы</span><span class="sxs-lookup"><span data-stu-id="3572d-168">Parameters common to account SAS and service SAS tokens</span></span>
* <span data-ttu-id="3572d-169">**Версия API.** Необязательный параметр, который указывает версию службы хранилища для выполнения запроса.</span><span class="sxs-lookup"><span data-stu-id="3572d-169">**Api version** An optional parameter that specifies the storage service version to use to execute the request.</span></span>
* <span data-ttu-id="3572d-170">**Версия службы.** Обязательный параметр, который указывает версию службы хранилища для аутентификации запроса.</span><span class="sxs-lookup"><span data-stu-id="3572d-170">**Service version** A required parameter that specifies the storage service version to use to authenticate the request.</span></span>
* <span data-ttu-id="3572d-171">**Время начала.**</span><span class="sxs-lookup"><span data-stu-id="3572d-171">**Start time.**</span></span> <span data-ttu-id="3572d-172">Это время, когда подпись общего доступа становится действительной.</span><span class="sxs-lookup"><span data-stu-id="3572d-172">This is the time at which the SAS becomes valid.</span></span> <span data-ttu-id="3572d-173">Оно необязательно для подписанного URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="3572d-173">The start time for a shared access signature is optional.</span></span> <span data-ttu-id="3572d-174">Если время начала не указано, SAS вступает в силу немедленно.</span><span class="sxs-lookup"><span data-stu-id="3572d-174">If a start time is omitted, the SAS is effective immediately.</span></span> <span data-ttu-id="3572d-175">Время начала должно быть выражено в формате UTC с соответствующим указателем ("Z"), например `1994-11-05T13:15:30Z`.</span><span class="sxs-lookup"><span data-stu-id="3572d-175">The start time must be expressed in UTC (Coordinated Universal Time), with a special UTC designator ("Z"), for example `1994-11-05T13:15:30Z`.</span></span>
* <span data-ttu-id="3572d-176">**Время окончания срока действия.**</span><span class="sxs-lookup"><span data-stu-id="3572d-176">**Expiry time.**</span></span> <span data-ttu-id="3572d-177">Это время, после которого подпись общего доступа перестает быть действительной.</span><span class="sxs-lookup"><span data-stu-id="3572d-177">This is the time after which the SAS is no longer valid.</span></span> <span data-ttu-id="3572d-178">Рекомендуется указать время окончания срока действия для подписи общего доступа или связать ее с хранимой политикой доступа.</span><span class="sxs-lookup"><span data-stu-id="3572d-178">Best practices recommend that you either specify an expiry time for a SAS, or associate it with a stored access policy.</span></span> <span data-ttu-id="3572d-179">Время окончания срока действия должно быть выражено в формате UTC с соответствующим указателем ("Z"), например `1994-11-05T13:15:30Z` (дополнительные сведения см. ниже).</span><span class="sxs-lookup"><span data-stu-id="3572d-179">The expiry time must be expressed in UTC (Coordinated Universal Time), with a special UTC designator ("Z"), for example `1994-11-05T13:15:30Z` (see more below).</span></span>
* <span data-ttu-id="3572d-180">**Разрешения.**</span><span class="sxs-lookup"><span data-stu-id="3572d-180">**Permissions.**</span></span> <span data-ttu-id="3572d-181">Разрешения, заданные для подписи общего доступа, указывают операции, которые клиент может выполнять для ресурсов хранилища с помощью этой подписи общего доступа.</span><span class="sxs-lookup"><span data-stu-id="3572d-181">The permissions specified on the SAS indicate what operations the client can perform against the storage resource using the SAS.</span></span> <span data-ttu-id="3572d-182">Разрешения, доступные для SAS учетной записи и SAS службы, различаются.</span><span class="sxs-lookup"><span data-stu-id="3572d-182">Available permissions differ for an account SAS and a service SAS.</span></span>
* <span data-ttu-id="3572d-183">**IP-адрес.**</span><span class="sxs-lookup"><span data-stu-id="3572d-183">**IP.**</span></span> <span data-ttu-id="3572d-184">Необязательный параметр, который указывает IP-адрес или диапазон IP-адресов за пределами Azure (см. раздел [Состояние конфигурации сеанса маршрутизации](../expressroute/expressroute-workflows.md#routing-session-configuration-state) для ExpressRoute), с которых следует принимать запросы.</span><span class="sxs-lookup"><span data-stu-id="3572d-184">An optional parameter that specifies an IP address or a range of IP addresses outside of Azure (see the section [Routing session configuration state](../expressroute/expressroute-workflows.md#routing-session-configuration-state) for Express Route) from which to accept requests.</span></span>
* <span data-ttu-id="3572d-185">**Протокол.**</span><span class="sxs-lookup"><span data-stu-id="3572d-185">**Protocol.**</span></span> <span data-ttu-id="3572d-186">Необязательный параметр, который задает допустимый протокол для запроса.</span><span class="sxs-lookup"><span data-stu-id="3572d-186">An optional parameter that specifies the protocol permitted for a request.</span></span> <span data-ttu-id="3572d-187">Параметр может иметь значение `https,http` (принимаются протоколы HTTPS и HTTP, это значение используется по умолчанию) или `https` (только протокол HTTPS).</span><span class="sxs-lookup"><span data-stu-id="3572d-187">Possible values are both HTTPS and HTTP (`https,http`), which is the default value, or HTTPS only (`https`).</span></span> <span data-ttu-id="3572d-188">Обратите внимание, что использовать только протокол HTTP нельзя.</span><span class="sxs-lookup"><span data-stu-id="3572d-188">Note that HTTP only is not a permitted value.</span></span>
* <span data-ttu-id="3572d-189">**Подпись.**</span><span class="sxs-lookup"><span data-stu-id="3572d-189">**Signature.**</span></span> <span data-ttu-id="3572d-190">Подпись составляется из других параметров, указанных в маркере, а затем шифруется.</span><span class="sxs-lookup"><span data-stu-id="3572d-190">The signature is constructed from the other parameters specified as part token and then encrypted.</span></span> <span data-ttu-id="3572d-191">Она используется для проверки подлинности SAS.</span><span class="sxs-lookup"><span data-stu-id="3572d-191">It's used to authenticate the SAS.</span></span>

### <a name="parameters-for-a-service-sas-token"></a><span data-ttu-id="3572d-192">Параметры маркера SAS службы</span><span class="sxs-lookup"><span data-stu-id="3572d-192">Parameters for a service SAS token</span></span>
* <span data-ttu-id="3572d-193">**Ресурс хранилища.**</span><span class="sxs-lookup"><span data-stu-id="3572d-193">**Storage resource.**</span></span> <span data-ttu-id="3572d-194">SAS службы позволяет делегировать доступ к следующим ресурсам хранилища:</span><span class="sxs-lookup"><span data-stu-id="3572d-194">Storage resources for which you can delegate access with a service SAS include:</span></span>
  * <span data-ttu-id="3572d-195">контейнеры и большие двоичные объекты;</span><span class="sxs-lookup"><span data-stu-id="3572d-195">Containers and blobs</span></span>
  * <span data-ttu-id="3572d-196">Общие папки и файлы</span><span class="sxs-lookup"><span data-stu-id="3572d-196">File shares and files</span></span>
  * <span data-ttu-id="3572d-197">Очереди</span><span class="sxs-lookup"><span data-stu-id="3572d-197">Queues</span></span>
  * <span data-ttu-id="3572d-198">Таблицы и диапазоны сущностей таблицы</span><span class="sxs-lookup"><span data-stu-id="3572d-198">Tables and ranges of table entities.</span></span>

### <a name="parameters-for-an-account-sas-token"></a><span data-ttu-id="3572d-199">Параметры маркера SAS учетной записи</span><span class="sxs-lookup"><span data-stu-id="3572d-199">Parameters for an account SAS token</span></span>
* <span data-ttu-id="3572d-200">**Служба или службы.**</span><span class="sxs-lookup"><span data-stu-id="3572d-200">**Service or services.**</span></span> <span data-ttu-id="3572d-201">SAS учетной записи может делегировать доступ к одной или нескольким службам хранилища.</span><span class="sxs-lookup"><span data-stu-id="3572d-201">An account SAS can delegate access to one or more of the storage services.</span></span> <span data-ttu-id="3572d-202">Например, вы можете создать подписанный URL-адрес учетной записи, делегирующий доступ к службе BLOB-объектов или службе файлов.</span><span class="sxs-lookup"><span data-stu-id="3572d-202">For example, you can create an account SAS that delegates access to the Blob and File service.</span></span> <span data-ttu-id="3572d-203">Также вы можете создать подписанный URL-адрес, делегирующий доступ ко всем четырем службам (BLOB-объектов, очередей, таблиц и файлов).</span><span class="sxs-lookup"><span data-stu-id="3572d-203">Or you can create a SAS that delegates access to all four services (Blob, Queue, Table, and File).</span></span>
* <span data-ttu-id="3572d-204">**Типы ресурсов хранилища.**</span><span class="sxs-lookup"><span data-stu-id="3572d-204">**Storage resource types.**</span></span> <span data-ttu-id="3572d-205">SAS учетной записи применяется к одному или нескольким классам ресурсов хранилища, а не к конкретному ресурсу.</span><span class="sxs-lookup"><span data-stu-id="3572d-205">An account SAS applies to one or more classes of storage resources, rather than a specific resource.</span></span> <span data-ttu-id="3572d-206">С помощью SAS учетной записи можно делегировать доступ к следующим типам ресурсов:</span><span class="sxs-lookup"><span data-stu-id="3572d-206">You can create an account SAS to delegate access to:</span></span>
  * <span data-ttu-id="3572d-207">API-интерфейсы уровня службы, которые вызываются для ресурсов учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="3572d-207">Service-level APIs, which are called against the storage account resource.</span></span> <span data-ttu-id="3572d-208">Вот некоторые примеры: **Get/Set Service Properties**, **Get Service Stats** и **List Containers/Queues/Tables/Shares**.</span><span class="sxs-lookup"><span data-stu-id="3572d-208">Examples include **Get/Set Service Properties**, **Get Service Stats**, and **List Containers/Queues/Tables/Shares**.</span></span>
  * <span data-ttu-id="3572d-209">API-интерфейсы уровня контейнеров, которые вызываются для объектов-контейнеров каждой службы: BLOB-контейнеров, очередей, таблиц и общих папок.</span><span class="sxs-lookup"><span data-stu-id="3572d-209">Container-level APIs, which are called against the container objects for each service: blob containers, queues, tables, and file shares.</span></span> <span data-ttu-id="3572d-210">Вот некоторые примеры: **Create/Delete Container**, **Create/Delete Queue**, **Create/Delete Table**, **Create/Delete Share** и **List Blobs/Files and Directories**.</span><span class="sxs-lookup"><span data-stu-id="3572d-210">Examples include **Create/Delete Container**, **Create/Delete Queue**, **Create/Delete Table**, **Create/Delete Share**, and **List Blobs/Files and Directories**.</span></span>
  * <span data-ttu-id="3572d-211">API-интерфейсы уровня объектов, которые вызываются для больших двоичных объектов, сообщений в очереди, сущностей таблицы и отдельных файлов.</span><span class="sxs-lookup"><span data-stu-id="3572d-211">Object-level APIs, which are called against blobs, queue messages, table entities, and files.</span></span> <span data-ttu-id="3572d-212">Например: **Put Blob**, **Query Entity**, **Get Messages** и **Create File**.</span><span class="sxs-lookup"><span data-stu-id="3572d-212">For example, **Put Blob**, **Query Entity**, **Get Messages**, and **Create File**.</span></span>

## <a name="examples-of-sas-uris"></a><span data-ttu-id="3572d-213">Примеры универсального кода ресурса (URI) подписанного URL-адреса</span><span class="sxs-lookup"><span data-stu-id="3572d-213">Examples of SAS URIs</span></span>

### <a name="service-sas-uri-example"></a><span data-ttu-id="3572d-214">Пример службы URI SAS</span><span class="sxs-lookup"><span data-stu-id="3572d-214">Service SAS URI example</span></span>

<span data-ttu-id="3572d-215">В примере ниже универсальный код ресурса (URI) подписанного URL-адреса службы предоставляет разрешения на чтение и запись для BLOB-объекта.</span><span class="sxs-lookup"><span data-stu-id="3572d-215">Here is an example of a service SAS URI that provides read and write permissions to a blob.</span></span> <span data-ttu-id="3572d-216">В таблице описана каждая из частей URI, чтобы можно было понять ее роль в работе подписи общего доступа:</span><span class="sxs-lookup"><span data-stu-id="3572d-216">The table breaks down each part of the URI to understand how it contributes to the SAS:</span></span>

```
https://myaccount.blob.core.windows.net/sascontainer/sasblob.txt?sv=2015-04-05&st=2015-04-29T22%3A18%3A26Z&se=2015-04-30T02%3A23%3A26Z&sr=b&sp=rw&sip=168.1.5.60-168.1.5.70&spr=https&sig=Z%2FRHIX5Xcg0Mq2rqI3OlWTjEg2tYkboXr1P9ZUXDtkk%3D
```

| <span data-ttu-id="3572d-217">Имя</span><span class="sxs-lookup"><span data-stu-id="3572d-217">Name</span></span> | <span data-ttu-id="3572d-218">Сегмент SAS</span><span class="sxs-lookup"><span data-stu-id="3572d-218">SAS portion</span></span> | <span data-ttu-id="3572d-219">Описание</span><span class="sxs-lookup"><span data-stu-id="3572d-219">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="3572d-220">URI BLOB-объекта</span><span class="sxs-lookup"><span data-stu-id="3572d-220">Blob URI</span></span> |`https://myaccount.blob.core.windows.net/sascontainer/sasblob.txt` |<span data-ttu-id="3572d-221">Адрес BLOB-объекта.</span><span class="sxs-lookup"><span data-stu-id="3572d-221">The address of the blob.</span></span> <span data-ttu-id="3572d-222">Обратите внимание, что настоятельно рекомендуется использовать HTTPS.</span><span class="sxs-lookup"><span data-stu-id="3572d-222">Note that using HTTPS is highly recommended.</span></span> |
| <span data-ttu-id="3572d-223">Версия служб хранилища</span><span class="sxs-lookup"><span data-stu-id="3572d-223">Storage services version</span></span> |`sv=2015-04-05` |<span data-ttu-id="3572d-224">Для служб хранилища версии 2012-02-12 и более поздней этот параметр указывает используемую версию.</span><span class="sxs-lookup"><span data-stu-id="3572d-224">For storage services version 2012-02-12 and later, this parameter indicates the version to use.</span></span> |
| <span data-ttu-id="3572d-225">Время начала</span><span class="sxs-lookup"><span data-stu-id="3572d-225">Start time</span></span> |`st=2015-04-29T22%3A18%3A26Z` |<span data-ttu-id="3572d-226">Указывается в формате UTC.</span><span class="sxs-lookup"><span data-stu-id="3572d-226">Specified in UTC time.</span></span> <span data-ttu-id="3572d-227">Чтобы подпись общего доступа вступала в силу сразу же, не указывайте время начала действия.</span><span class="sxs-lookup"><span data-stu-id="3572d-227">If you want the SAS to be valid immediately, omit the start time.</span></span> |
| <span data-ttu-id="3572d-228">Время окончания срока действия</span><span class="sxs-lookup"><span data-stu-id="3572d-228">Expiry time</span></span> |`se=2015-04-30T02%3A23%3A26Z` |<span data-ttu-id="3572d-229">Указывается в формате UTC.</span><span class="sxs-lookup"><span data-stu-id="3572d-229">Specified in UTC time.</span></span> |
| <span data-ttu-id="3572d-230">Ресурс</span><span class="sxs-lookup"><span data-stu-id="3572d-230">Resource</span></span> |`sr=b` |<span data-ttu-id="3572d-231">Ресурс является BLOB-объектом.</span><span class="sxs-lookup"><span data-stu-id="3572d-231">The resource is a blob.</span></span> |
| <span data-ttu-id="3572d-232">Разрешения</span><span class="sxs-lookup"><span data-stu-id="3572d-232">Permissions</span></span> |`sp=rw` |<span data-ttu-id="3572d-233">Разрешения, предоставляемые подписью общего доступа, включают в себя чтение (r) и запись (w).</span><span class="sxs-lookup"><span data-stu-id="3572d-233">The permissions granted by the SAS include Read (r) and Write (w).</span></span> |
| <span data-ttu-id="3572d-234">Диапазон IP-адресов</span><span class="sxs-lookup"><span data-stu-id="3572d-234">IP range</span></span> |`sip=168.1.5.60-168.1.5.70` |<span data-ttu-id="3572d-235">Диапазон IP-адресов, с которых будут приниматься запросы.</span><span class="sxs-lookup"><span data-stu-id="3572d-235">The range of IP addresses from which a request will be accepted.</span></span> |
| <span data-ttu-id="3572d-236">Протокол</span><span class="sxs-lookup"><span data-stu-id="3572d-236">Protocol</span></span> |`spr=https` |<span data-ttu-id="3572d-237">Разрешены запросы только по протоколу HTTPS.</span><span class="sxs-lookup"><span data-stu-id="3572d-237">Only requests using HTTPS are permitted.</span></span> |
| <span data-ttu-id="3572d-238">Подпись</span><span class="sxs-lookup"><span data-stu-id="3572d-238">Signature</span></span> |`sig=Z%2FRHIX5Xcg0Mq2rqI3OlWTjEg2tYkboXr1P9ZUXDtkk%3D` |<span data-ttu-id="3572d-239">Используется для проверки подлинности доступа к BLOB-объекту.</span><span class="sxs-lookup"><span data-stu-id="3572d-239">Used to authenticate access to the blob.</span></span> <span data-ttu-id="3572d-240">Подпись представляет собой код HMAC, рассчитанный по алгоритму SHA256 с использованием ключа и преобразования строки в символы. Полученное значение преобразуется в кодировку Base64.</span><span class="sxs-lookup"><span data-stu-id="3572d-240">The signature is an HMAC computed over a string-to-sign and key using the SHA256 algorithm, and then encoded using Base64 encoding.</span></span> |

### <a name="account-sas-uri-example"></a><span data-ttu-id="3572d-241">Пример URI SAS учетной записи</span><span class="sxs-lookup"><span data-stu-id="3572d-241">Account SAS URI example</span></span>

<span data-ttu-id="3572d-242">В этом примере представлен SAS учетной записи c теми же общими параметрами маркера.</span><span class="sxs-lookup"><span data-stu-id="3572d-242">Here is an example of an account SAS that uses the same common parameters on the token.</span></span> <span data-ttu-id="3572d-243">Описание этих параметров приведено выше.</span><span class="sxs-lookup"><span data-stu-id="3572d-243">Since these parameters are described above, they are not described here.</span></span> <span data-ttu-id="3572d-244">В следующей таблице указаны только те параметры, которые относятся к SAS учетной записи.</span><span class="sxs-lookup"><span data-stu-id="3572d-244">Only the parameters that are specific to account SAS are described in the table below.</span></span>

```
https://myaccount.blob.core.windows.net/?restype=service&comp=properties&sv=2015-04-05&ss=bf&srt=s&st=2015-04-29T22%3A18%3A26Z&se=2015-04-30T02%3A23%3A26Z&sr=b&sp=rw&sip=168.1.5.60-168.1.5.70&spr=https&sig=F%6GRVAZ5Cdj2Pw4tgU7IlSTkWgn7bUkkAg8P6HESXwmf%4B
```

| <span data-ttu-id="3572d-245">Имя</span><span class="sxs-lookup"><span data-stu-id="3572d-245">Name</span></span> | <span data-ttu-id="3572d-246">Сегмент SAS</span><span class="sxs-lookup"><span data-stu-id="3572d-246">SAS portion</span></span> | <span data-ttu-id="3572d-247">Описание</span><span class="sxs-lookup"><span data-stu-id="3572d-247">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="3572d-248">Универсальный код ресурса (URI)</span><span class="sxs-lookup"><span data-stu-id="3572d-248">Resource URI</span></span> |`https://myaccount.blob.core.windows.net/?restype=service&comp=properties` |<span data-ttu-id="3572d-249">Конечная точка службы BLOB-объектов с параметрами для получения свойств службы (для запроса GET) или задания свойств службы (для запроса SET).</span><span class="sxs-lookup"><span data-stu-id="3572d-249">The Blob service endpoint, with parameters for getting service properties (when called with GET) or setting service properties (when called with SET).</span></span> |
| <span data-ttu-id="3572d-250">Службы</span><span class="sxs-lookup"><span data-stu-id="3572d-250">Services</span></span> |`ss=bf` |<span data-ttu-id="3572d-251">SAS применяется к службам больших двоичных объектов и службам файлов.</span><span class="sxs-lookup"><span data-stu-id="3572d-251">The SAS applies to the Blob and File services</span></span> |
| <span data-ttu-id="3572d-252">Типы ресурсов</span><span class="sxs-lookup"><span data-stu-id="3572d-252">Resource types</span></span> |`srt=s` |<span data-ttu-id="3572d-253">SAS применяется к операциям на уровне службы.</span><span class="sxs-lookup"><span data-stu-id="3572d-253">The SAS applies to service-level operations.</span></span> |
| <span data-ttu-id="3572d-254">Разрешения</span><span class="sxs-lookup"><span data-stu-id="3572d-254">Permissions</span></span> |`sp=rw` |<span data-ttu-id="3572d-255">Разрешения предоставляют доступ к операциям чтения и записи.</span><span class="sxs-lookup"><span data-stu-id="3572d-255">The permissions grant access to read and write operations.</span></span> |

<span data-ttu-id="3572d-256">Так как разрешения ограничены уровнем служб, этот SAS позволяет выполнять такие операции: **Get Blob Service Properties** (чтение) и **Set Blob Service Properties** (запись).</span><span class="sxs-lookup"><span data-stu-id="3572d-256">Given that permissions are restricted to the service level, accessible operations with this SAS are **Get Blob Service Properties** (read) and **Set Blob Service Properties** (write).</span></span> <span data-ttu-id="3572d-257">Этот же токен SAS с другим универсальным кодом ресурса (URI) ресурса будет предоставлять доступ к операции **Получение статистики службы BLOB-объектов** (чтение).</span><span class="sxs-lookup"><span data-stu-id="3572d-257">However, with a different resource URI, the same SAS token could also be used to delegate access to **Get Blob Service Stats** (read).</span></span>

## <a name="controlling-a-sas-with-a-stored-access-policy"></a><span data-ttu-id="3572d-258">Использование хранимой политики доступа для управления SAS</span><span class="sxs-lookup"><span data-stu-id="3572d-258">Controlling a SAS with a stored access policy</span></span>
<span data-ttu-id="3572d-259">Подпись общего доступа может принимать одну из двух форм:</span><span class="sxs-lookup"><span data-stu-id="3572d-259">A shared access signature can take one of two forms:</span></span>

* <span data-ttu-id="3572d-260">**Нерегламентированный SAS.** При создании нерегламентированного SAS время начала, время окончания срока действия и разрешения для SAS указываются в URI SAS (или подразумеваются в случае, когда опускается время начала).</span><span class="sxs-lookup"><span data-stu-id="3572d-260">**Ad hoc SAS:** When you create an ad hoc SAS, the start time, expiry time, and permissions for the SAS are all specified in the SAS URI (or implied, in the case where start time is omitted).</span></span> <span data-ttu-id="3572d-261">Этот тип можно использовать для SAS учетной записи и SAS службы.</span><span class="sxs-lookup"><span data-stu-id="3572d-261">This type of SAS can be created as an account SAS or a service SAS.</span></span>
* <span data-ttu-id="3572d-262">**SAS с хранимой политикой доступа.** Хранимая политика доступа определяется в контейнере ресурсов (контейнере больших двоичных объектов, таблице, очереди или общей папке) и может использоваться для управления ограничениями одного или нескольких подписанных URL-адресов.</span><span class="sxs-lookup"><span data-stu-id="3572d-262">**SAS with stored access policy:** A stored access policy is defined on a resource container--a blob container, table, queue, or file share--and can be used to manage constraints for one or more shared access signatures.</span></span> <span data-ttu-id="3572d-263">При сопоставлении подписанного URL-адреса с хранимой политикой доступа этот адрес наследует ограничения (время начала, время окончания и разрешения), определенные для данной хранимой политики доступа.</span><span class="sxs-lookup"><span data-stu-id="3572d-263">When you associate a SAS with a stored access policy, the SAS inherits the constraints--the start time, expiry time, and permissions--defined for the stored access policy.</span></span>

> [!NOTE]
> <span data-ttu-id="3572d-264">На данный момент SAS учетной записи может быть только нерегламентированным.</span><span class="sxs-lookup"><span data-stu-id="3572d-264">Currently, an account SAS must be an ad hoc SAS.</span></span> <span data-ttu-id="3572d-265">Хранимые политики доступа для SAS учетной записи пока не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="3572d-265">Stored access policies are not yet supported for account SAS.</span></span>

<span data-ttu-id="3572d-266">Различие между этими двумя формами важно для одного ключевого сценария — отзыва.</span><span class="sxs-lookup"><span data-stu-id="3572d-266">The difference between the two forms is important for one key scenario: revocation.</span></span> <span data-ttu-id="3572d-267">Так как URI SAS представляет собой URL-адрес, любой пользователь, который получает SAS, может его использовать независимо от того, кто его первоначально создал.</span><span class="sxs-lookup"><span data-stu-id="3572d-267">Because a SAS URI is a URL, anyone that obtains the SAS can use it, regardless of who originally created it.</span></span> <span data-ttu-id="3572d-268">Размещенный в свободном доступе подписанный URL-адрес сможет использовать любой человек.</span><span class="sxs-lookup"><span data-stu-id="3572d-268">If a SAS is published publicly, it can be used by anyone in the world.</span></span> <span data-ttu-id="3572d-269">SAS предоставляет доступ к ресурсам любому пользователю, который им обладает, пока не произойдет одно из четырех возможных событий:</span><span class="sxs-lookup"><span data-stu-id="3572d-269">A SAS grants access to resources to anyone possessing it until one of four things happens:</span></span>

1. <span data-ttu-id="3572d-270">Наступает время истечения срока действия, указанное для данной подписи общего доступа.</span><span class="sxs-lookup"><span data-stu-id="3572d-270">The expiry time specified on the SAS is reached.</span></span>
2. <span data-ttu-id="3572d-271">Наступает время истечения срока действия, указанное в хранимой политике доступа, на которую ссылается подпись общего доступа (если имеется ссылка на хранимую политику доступа, в которой задано время окончания срока действия).</span><span class="sxs-lookup"><span data-stu-id="3572d-271">The expiry time specified on the stored access policy referenced by the SAS is reached (if a stored access policy is referenced, and if it specifies an expiry time).</span></span> <span data-ttu-id="3572d-272">Это может произойти либо из-за истечения заданного времени, либо из-за изменения хранимой политики доступа с переносом времени окончания срока действия в прошлое, что является одним из способов отозвать подписанный URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="3572d-272">This can occur either because the interval elapses, or because you've modified the stored access policy with an expiry time in the past, which is one way to revoke the SAS.</span></span>
3. <span data-ttu-id="3572d-273">Удаляется хранимая политика доступа, на которую ссылается подпись, что является другим способом отозвать подпись общего доступа.</span><span class="sxs-lookup"><span data-stu-id="3572d-273">The stored access policy referenced by the SAS is deleted, which is another way to revoke the SAS.</span></span> <span data-ttu-id="3572d-274">Заметьте, что при повторном создании хранимой политики доступа с таким же именем все существующие маркеры подписи общего доступа снова станут действительными в соответствии с разрешениями, связанными с этой хранимой политикой доступа (предполагается, что время окончания срока действия для подписи общего доступа еще не истекло).</span><span class="sxs-lookup"><span data-stu-id="3572d-274">Note that if you recreate the stored access policy with exactly the same name, all existing SAS tokens will again be valid according to the permissions associated with that stored access policy (assuming that the expiry time on the SAS has not passed).</span></span> <span data-ttu-id="3572d-275">Если планируется отозвать подпись общего доступа, следует использовать другое имя при повторном создании политики доступа, у которой время окончания срока действия относится к будущему.</span><span class="sxs-lookup"><span data-stu-id="3572d-275">If you are intending to revoke the SAS, be sure to use a different name if you recreate the access policy with an expiry time in the future.</span></span>
4. <span data-ttu-id="3572d-276">Повторно создается ключ учетной записи, который был использован для создания подписи общего доступа.</span><span class="sxs-lookup"><span data-stu-id="3572d-276">The account key that was used to create the SAS is regenerated.</span></span> <span data-ttu-id="3572d-277">Повторное создание ключа учетной записи приведет к тому, что все компоненты приложения, которые используют этот ключ, будут неспособны пройти аутентификацию до тех пор, пока они не будут обновлены, чтобы использовать другой действительный или вновь созданный ключ учетной записи.</span><span class="sxs-lookup"><span data-stu-id="3572d-277">Regenerating an account key will cause all application components using that key to fail to authenticate until they're updated to use either the other valid account key or the newly regenerated account key.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="3572d-278">URI подписанного URL-адреса связан с ключом учетной записи, который использовался для создания подписи и соответствующей хранимой политики доступа (при наличии таковой).</span><span class="sxs-lookup"><span data-stu-id="3572d-278">A shared access signature URI is associated with the account key used to create the signature, and the associated stored access policy (if any).</span></span> <span data-ttu-id="3572d-279">Если хранимая политика доступа не указана, то единственный способ отменить подписанный URL-адрес — изменить ключ учетной записи.</span><span class="sxs-lookup"><span data-stu-id="3572d-279">If no stored access policy is specified, the only way to revoke a shared access signature is to change the account key.</span></span>

## <a name="authenticating-from-a-client-application-with-a-sas"></a><span data-ttu-id="3572d-280">Аутентификация в клиентском приложении с SAS</span><span class="sxs-lookup"><span data-stu-id="3572d-280">Authenticating from a client application with a SAS</span></span>
<span data-ttu-id="3572d-281">Клиент, владеющий SAS, может использовать его для аутентификации запроса к учетной записи хранения, для которой у него нет ключей учетной записи.</span><span class="sxs-lookup"><span data-stu-id="3572d-281">A client who is in possession of a SAS can use the SAS to authenticate a request against a storage account for which they do not possess the account keys.</span></span> <span data-ttu-id="3572d-282">SAS можно добавить в строку подключения и непосредственно использовать в соответствующем конструкторе или методе.</span><span class="sxs-lookup"><span data-stu-id="3572d-282">A SAS can be included in a connection string, or used directly from the appropriate constructor or method.</span></span>

### <a name="using-a-sas-in-a-connection-string"></a><span data-ttu-id="3572d-283">Использование SAS в строке подключения</span><span class="sxs-lookup"><span data-stu-id="3572d-283">Using a SAS in a connection string</span></span>
[!INCLUDE [storage-use-sas-in-connection-string-include](../../includes/storage-use-sas-in-connection-string-include.md)]

### <a name="using-a-sas-in-a-constructor-or-method"></a><span data-ttu-id="3572d-284">Использование SAS в конструкторе или методе</span><span class="sxs-lookup"><span data-stu-id="3572d-284">Using a SAS in a constructor or method</span></span>
<span data-ttu-id="3572d-285">Несколько конструкторов и перегрузок методов из клиентской библиотеки службы хранилища Azure предлагают параметр SAS, чтобы можно было аутентифицировать запрос к службе с использованием SAS.</span><span class="sxs-lookup"><span data-stu-id="3572d-285">Several Azure Storage client library constructors and method overloads offer a SAS parameter, so that you can authenticate a request to the service with a SAS.</span></span>

<span data-ttu-id="3572d-286">Например, здесь URI SAS позволяет создать ссылку на большой двоичный объект.</span><span class="sxs-lookup"><span data-stu-id="3572d-286">For example, here a SAS URI is used to create a reference to a block blob.</span></span> <span data-ttu-id="3572d-287">SAS предоставляет только учетные данные, необходимые для запроса.</span><span class="sxs-lookup"><span data-stu-id="3572d-287">The SAS provides the only credentials needed for the request.</span></span> <span data-ttu-id="3572d-288">Затем ссылка на блочный BLOB-объект используется для операции записи:</span><span class="sxs-lookup"><span data-stu-id="3572d-288">The block blob reference is then used for a write operation:</span></span>

```csharp
string sasUri = "https://storagesample.blob.core.windows.net/sample-container/" +
    "sampleBlob.txt?sv=2015-07-08&sr=b&sig=39Up9JzHkxhUIhFEjEH9594DJxe7w6cIRCg0V6lCGSo%3D" +
    "&se=2016-10-18T21%3A51%3A37Z&sp=rcw";

CloudBlockBlob blob = new CloudBlockBlob(new Uri(sasUri));

// Create operation: Upload a blob with the specified name to the container.
// If the blob does not exist, it will be created. If it does exist, it will be overwritten.
try
{
    MemoryStream msWrite = new MemoryStream(Encoding.UTF8.GetBytes(blobContent));
    msWrite.Position = 0;
    using (msWrite)
    {
        await blob.UploadFromStreamAsync(msWrite);
    }

    Console.WriteLine("Create operation succeeded for SAS {0}", sasUri);
    Console.WriteLine();
}
catch (StorageException e)
{
    if (e.RequestInformation.HttpStatusCode == 403)
    {
        Console.WriteLine("Create operation failed for SAS {0}", sasUri);
        Console.WriteLine("Additional error information: " + e.Message);
        Console.WriteLine();
    }
    else
    {
        Console.WriteLine(e.Message);
        Console.ReadLine();
        throw;
    }
}

```

## <a name="best-practices-when-using-sas"></a><span data-ttu-id="3572d-289">Рекомендации по использованию SAS</span><span class="sxs-lookup"><span data-stu-id="3572d-289">Best practices when using SAS</span></span>
<span data-ttu-id="3572d-290">При использовании подписей общего доступа в приложениях необходимо иметь в виду две потенциальные проблемы:</span><span class="sxs-lookup"><span data-stu-id="3572d-290">When you use shared access signatures in your applications, you need to be aware of two potential risks:</span></span>

* <span data-ttu-id="3572d-291">В случае утечки подписи ей сможет пользоваться любой человек, что потенциально может нарушить безопасность вашей учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="3572d-291">If a SAS is leaked, it can be used by anyone who obtains it, which can potentially compromise your storage account.</span></span>
* <span data-ttu-id="3572d-292">Если срок действия подписи, предоставленной клиентскому приложению, истекает и приложение не может получить новую подпись из вашей службы, это может нарушить работу приложения.</span><span class="sxs-lookup"><span data-stu-id="3572d-292">If a SAS provided to a client application expires and the application is unable to retrieve a new SAS from your service, then the application's functionality may be hindered.</span></span>

<span data-ttu-id="3572d-293">Следующие рекомендации по использованию подписанных URL-адресов помогут нейтрализовать эти риски:</span><span class="sxs-lookup"><span data-stu-id="3572d-293">The following recommendations for using shared access signatures can help mitigate these risks:</span></span>

1. <span data-ttu-id="3572d-294">**Всегда используйте HTTPS** для создания подписанного URL-адреса или его распространения.</span><span class="sxs-lookup"><span data-stu-id="3572d-294">**Always use HTTPS** to create or distribute a SAS.</span></span> <span data-ttu-id="3572d-295">Если SAS передается по протоколу HTTP и перехватывается, посредством атак "злоумышленник в середине" злоумышленник сможет считать SAS и затем использовать его вместо предполагаемого пользователя, что может привести к раскрытию конфиденциальных данных или к повреждению данных злоумышленником.</span><span class="sxs-lookup"><span data-stu-id="3572d-295">If a SAS is passed over HTTP and intercepted, an attacker performing a man-in-the-middle attack is able to read the SAS and then use it just as the intended user could have, potentially compromising sensitive data or allowing for data corruption by the malicious user.</span></span>
2. <span data-ttu-id="3572d-296">**Ссылайтесь на хранимые политики доступа, где это возможно.**</span><span class="sxs-lookup"><span data-stu-id="3572d-296">**Reference stored access policies where possible.**</span></span> <span data-ttu-id="3572d-297">Хранимые политики доступа дают возможность отозвать разрешения без повторного создания ключей учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="3572d-297">Stored access policies give you the option to revoke permissions without having to regenerate the storage account keys.</span></span> <span data-ttu-id="3572d-298">Задайте для них очень большой (или бесконечный) срок действия и убедитесь, что он регулярно переносится на будущее время.</span><span class="sxs-lookup"><span data-stu-id="3572d-298">Set the expiration on these very far in the future (or infinite) and make sure it's regularly updated to move it farther into the future.</span></span>
3. <span data-ttu-id="3572d-299">**Используйте небольшой срок для нерегламентированной SAS.**</span><span class="sxs-lookup"><span data-stu-id="3572d-299">**Use near-term expiration times on an ad hoc SAS.**</span></span> <span data-ttu-id="3572d-300">Таким образом, даже если SAS скомпрометирован, он будет действителен только в течение короткого времени.</span><span class="sxs-lookup"><span data-stu-id="3572d-300">In this way, even if a SAS is compromised, it's valid only for a short time.</span></span> <span data-ttu-id="3572d-301">Это особенно важно в случаях, когда нельзя ссылаться на хранимую политику доступа.</span><span class="sxs-lookup"><span data-stu-id="3572d-301">This practice is especially important if you cannot reference a stored access policy.</span></span> <span data-ttu-id="3572d-302">Небольшой срок также позволяет ограничить объем данных, который может быть записан в большой двоичный объект, путем ограничения времени на отправку этих данных.</span><span class="sxs-lookup"><span data-stu-id="3572d-302">Near-term expiration times also limit the amount of data that can be written to a blob by limiting the time available to upload to it.</span></span>
4. <span data-ttu-id="3572d-303">**Запрограммируйте автоматическое обновление подписи клиентами при необходимости.**</span><span class="sxs-lookup"><span data-stu-id="3572d-303">**Have clients automatically renew the SAS if necessary.**</span></span> <span data-ttu-id="3572d-304">Клиенты должны обновлять SAS задолго до окончания его срока действия, чтобы оставить время для повторных попыток в случае недоступности службы, предоставляющей SAS.</span><span class="sxs-lookup"><span data-stu-id="3572d-304">Clients should renew the SAS well before the expiration, in order to allow time for retries if the service providing the SAS is unavailable.</span></span> <span data-ttu-id="3572d-305">Если SAS будет использоваться для небольшого числа кратковременных операций, которые должны быть завершены в течение заданного периода действия, такая мера может оказаться лишней, так как обновление SAS не предусматривается.</span><span class="sxs-lookup"><span data-stu-id="3572d-305">If your SAS is meant to be used for a small number of immediate, short-lived operations that are expected to be completed within the expiration period, then this may be unnecessary as the SAS is not expected to be renewed.</span></span> <span data-ttu-id="3572d-306">Однако если имеется клиент, регулярно выполняющий запросы через подпись, то возможность истечения срока действия следует принять во внимание.</span><span class="sxs-lookup"><span data-stu-id="3572d-306">However, if you have client that is routinely making requests via SAS, then the possibility of expiration comes into play.</span></span> <span data-ttu-id="3572d-307">Рекомендуется сбалансировать требование к кратковременности использования подписи (как указано ранее) с требованием того, чтобы клиент запрашивал обновление достаточно рано во избежание проблем, связанных с истечением срока действия SAS до завершения обновления.</span><span class="sxs-lookup"><span data-stu-id="3572d-307">The key consideration is to balance the need for the SAS to be short-lived (as previously stated) with the need to ensure that the client is requesting renewal early enough (to avoid disruption due to the SAS expiring prior to successful renewal).</span></span>
5. <span data-ttu-id="3572d-308">**Будьте осторожны со временем начала действия SAS.**</span><span class="sxs-lookup"><span data-stu-id="3572d-308">**Be careful with SAS start time.**</span></span> <span data-ttu-id="3572d-309">Если задать для времени начала действия SAS значение **now**, то из-за разницы во времени (разницы в текущем времени на разных компьютерах) могут наблюдаться периодические сбои в течение первых нескольких минут.</span><span class="sxs-lookup"><span data-stu-id="3572d-309">If you set the start time for a SAS to **now**, then due to clock skew (differences in current time according to different machines), failures may be observed intermittently for the first few minutes.</span></span> <span data-ttu-id="3572d-310">В общем, устанавливайте время начала действия на 15 минут или более в прошлом времени.</span><span class="sxs-lookup"><span data-stu-id="3572d-310">In general, set the start time to be at least 15 minutes in the past.</span></span> <span data-ttu-id="3572d-311">Или не задавайте вообще. Так SAS будет немедленно становиться действительным во всех случаях.</span><span class="sxs-lookup"><span data-stu-id="3572d-311">Or, don't set it at all, which will make it valid immediately in all cases.</span></span> <span data-ttu-id="3572d-312">То же касается и времени истечения срока действия. Помните, что для каждого запроса может наблюдаться рассинхронизация по времени до 15 минут в любом направлении.</span><span class="sxs-lookup"><span data-stu-id="3572d-312">The same generally applies to expiry time as well--remember that you may observe up to 15 minutes of clock skew in either direction on any request.</span></span> <span data-ttu-id="3572d-313">Для клиентов, использующих версию REST, предшествующую версии 2012-02-12, максимальный срок действия SAS, который не ссылается на хранимую политику, составляет 1 час, а все политики, где указано большее время, вызовут сбой.</span><span class="sxs-lookup"><span data-stu-id="3572d-313">For clients using a REST version prior to 2012-02-12, the maximum duration for a SAS that does not reference a stored access policy is 1 hour, and any policies specifying longer term than that will fail.</span></span>
6. <span data-ttu-id="3572d-314">**Четко указывайте ресурс, к которому осуществляется доступ.**</span><span class="sxs-lookup"><span data-stu-id="3572d-314">**Be specific with the resource to be accessed.**</span></span> <span data-ttu-id="3572d-315">Из соображений безопасности рекомендуется предоставить пользователю минимально необходимый набор прав.</span><span class="sxs-lookup"><span data-stu-id="3572d-315">A security best practice is to provide a user with the minimum required privileges.</span></span> <span data-ttu-id="3572d-316">Если пользователю требуется только доступ для чтения к отдельной сущности, предоставьте доступ на чтение к этой сущности, а не доступ на чтение, запись и удаление для всех сущностей.</span><span class="sxs-lookup"><span data-stu-id="3572d-316">If a user only needs read access to a single entity, then grant them read access to that single entity, and not read/write/delete access to all entities.</span></span> <span data-ttu-id="3572d-317">Это также позволяет уменьшить ущерб, если SAS скомпрометирован, так как такой SAS предоставляет меньше возможностей злоумышленнику.</span><span class="sxs-lookup"><span data-stu-id="3572d-317">This also helps lessen the damage if a SAS is compromised because the SAS has less power in the hands of an attacker.</span></span>
7. <span data-ttu-id="3572d-318">**Учитывайте, что ваша учетная запись тарифицируется за любое использование, включая то, что осуществляется посредством SAS.**</span><span class="sxs-lookup"><span data-stu-id="3572d-318">**Understand that your account will be billed for any usage, including that done with SAS.**</span></span> <span data-ttu-id="3572d-319">Если вы предоставляете доступ на запись к BLOB-объекту, пользователь может отправить BLOB-объект размером 200 ГБ.</span><span class="sxs-lookup"><span data-stu-id="3572d-319">If you provide write access to a blob, a user may choose to upload a 200GB blob.</span></span> <span data-ttu-id="3572d-320">Если вы также предоставляете доступ на чтение, пользователь может скачать его 10 раз, в результате чего вам потребуется оплачивать исходящий трафик объемом 2 ТБ.</span><span class="sxs-lookup"><span data-stu-id="3572d-320">If you've given them read access as well, they may choose to download it 10 times, incurring 2 TB in egress costs for you.</span></span> <span data-ttu-id="3572d-321">Опять же, ограниченные разрешения помогают сузить спектр возможностей злоумышленников.</span><span class="sxs-lookup"><span data-stu-id="3572d-321">Again, provide limited permissions to help mitigate the potential actions of malicious users.</span></span> <span data-ttu-id="3572d-322">Используйте краткосрочные подписи, чтобы снизить угрозу (но помните о влиянии рассинхронизации часов на время окончания действия).</span><span class="sxs-lookup"><span data-stu-id="3572d-322">Use short-lived SAS to reduce this threat (but be mindful of clock skew on the end time).</span></span>
8. <span data-ttu-id="3572d-323">**Проверьте данные, записанные с помощью SAS.**</span><span class="sxs-lookup"><span data-stu-id="3572d-323">**Validate data written using SAS.**</span></span> <span data-ttu-id="3572d-324">Когда клиентское приложение записывает данные в вашу учетную запись хранения, помните, что эти данные могут стать источником проблем.</span><span class="sxs-lookup"><span data-stu-id="3572d-324">When a client application writes data to your storage account, keep in mind that there can be problems with that data.</span></span> <span data-ttu-id="3572d-325">Если приложение требует проверять достоверность или подлинность данных перед их использованием, такую проверку следует выполнять после записи данных и перед их использованием в приложении.</span><span class="sxs-lookup"><span data-stu-id="3572d-325">If your application requires that that data be validated or authorized before it is ready to use, you should perform this validation after the data is written and before it is used by your application.</span></span> <span data-ttu-id="3572d-326">Такой подход также обеспечивает защиту от поврежденных или вредоносных данных, записываемых в вашу учетную запись как пользователем, который получил подпись правомерно, так и пользователем, использующим подпись после ее утечки.</span><span class="sxs-lookup"><span data-stu-id="3572d-326">This practice also protects against corrupt or malicious data being written to your account, either by a user who properly acquired the SAS, or by a user exploiting a leaked SAS.</span></span>
9. <span data-ttu-id="3572d-327">**Не следует всегда использовать SAS.**</span><span class="sxs-lookup"><span data-stu-id="3572d-327">**Don't always use SAS.**</span></span> <span data-ttu-id="3572d-328">Иногда риски для вашей учетной записи хранения, связанные с конкретной операцией, перевешивают преимущества подписи общего доступа.</span><span class="sxs-lookup"><span data-stu-id="3572d-328">Sometimes the risks associated with a particular operation against your storage account outweigh the benefits of SAS.</span></span> <span data-ttu-id="3572d-329">Для таких операций создавайте службу среднего уровня, которая записывает данные в вашу учетную запись хранения после выполнения проверки, проверки подлинности и аудита на основании бизнес-правил.</span><span class="sxs-lookup"><span data-stu-id="3572d-329">For such operations, create a middle-tier service that writes to your storage account after performing business rule validation, authentication, and auditing.</span></span> <span data-ttu-id="3572d-330">Кроме того, иногда проще организовать управление доступом другим образом.</span><span class="sxs-lookup"><span data-stu-id="3572d-330">Also, sometimes it's simpler to manage access in other ways.</span></span> <span data-ttu-id="3572d-331">Например, если вы хотите сделать все BLOB-объекты в контейнере общедоступными для чтения, можно сделать этот контейнер открытым, не предоставляя всем клиентам подпись общего доступа.</span><span class="sxs-lookup"><span data-stu-id="3572d-331">For example, if you want to make all blobs in a container publically readable, you can make the container Public, rather than providing a SAS to every client for access.</span></span>
10. <span data-ttu-id="3572d-332">**Используйте аналитику хранилища для мониторинга приложения.**</span><span class="sxs-lookup"><span data-stu-id="3572d-332">**Use Storage Analytics to monitor your application.**</span></span> <span data-ttu-id="3572d-333">Вы можете использовать ведение журнала и метрики, чтобы определять всплески сбоев проверки подлинности, вызванных сбоем в службе поставщика подписей общего доступа или непреднамеренным удалением хранимой политики доступа.</span><span class="sxs-lookup"><span data-stu-id="3572d-333">You can use logging and metrics to observe any spike in authentication failures due to an outage in your SAS provider service or to the inadvertent removal of a stored access policy.</span></span> <span data-ttu-id="3572d-334">Дополнительные сведения см. в [блоге группы разработчиков хранилища Azure](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/08/03/windows-azure-storage-logging-using-logs-to-track-storage-requests.aspx).</span><span class="sxs-lookup"><span data-stu-id="3572d-334">See the [Azure Storage Team Blog](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/08/03/windows-azure-storage-logging-using-logs-to-track-storage-requests.aspx) for additional information.</span></span>

## <a name="sas-examples"></a><span data-ttu-id="3572d-335">Примеры SAS</span><span class="sxs-lookup"><span data-stu-id="3572d-335">SAS examples</span></span>
<span data-ttu-id="3572d-336">Ниже приведены примеры подписанных URL-адресов обоих типов: SAS учетной записи и SAS службы.</span><span class="sxs-lookup"><span data-stu-id="3572d-336">Below are some examples of both types of shared access signatures, account SAS and service SAS.</span></span>

<span data-ttu-id="3572d-337">Для выполнения этих примеров C# необходимо ссылаться на следующие пакеты NuGet в своем проекте:</span><span class="sxs-lookup"><span data-stu-id="3572d-337">To run these C# examples, you need to reference the following NuGet packages in your project:</span></span>

* <span data-ttu-id="3572d-338">[Клиентская библиотека службы хранилища Azure для .NET](http://www.nuget.org/packages/WindowsAzure.Storage)версии 6.0 или более поздней (для использования учетной записи SAS).</span><span class="sxs-lookup"><span data-stu-id="3572d-338">[Azure Storage Client Library for .NET](http://www.nuget.org/packages/WindowsAzure.Storage), version 6.x or later (to use account SAS).</span></span>
* [<span data-ttu-id="3572d-339">Диспетчер конфигураций Azure</span><span class="sxs-lookup"><span data-stu-id="3572d-339">Azure Configuration Manager</span></span>](http://www.nuget.org/packages/Microsoft.WindowsAzure.ConfigurationManager)

<span data-ttu-id="3572d-340">Дополнительные примеры, в которых показано, как создать и проверить SAS, см. в разделе [Примеры кода Azure для хранилища](https://azure.microsoft.com/documentation/samples/?service=storage).</span><span class="sxs-lookup"><span data-stu-id="3572d-340">For additional examples that show how to create and test a SAS, see [Azure Code Samples for Storage](https://azure.microsoft.com/documentation/samples/?service=storage).</span></span>

### <a name="example-create-and-use-an-account-sas"></a><span data-ttu-id="3572d-341">Пример. Создание и использование учетной записи SAS</span><span class="sxs-lookup"><span data-stu-id="3572d-341">Example: Create and use an account SAS</span></span>
<span data-ttu-id="3572d-342">В следующем примере кода показано создание подписанного URL-адреса учетной записи, который действует для службы BLOB-объектов или службы файлов и предоставляет клиенту права на чтение, запись и получение списков через API-интерфейсы уровня службы.</span><span class="sxs-lookup"><span data-stu-id="3572d-342">The following code example creates an account SAS that is valid for the Blob and File services, and gives the client permissions read, write, and list permissions to access service-level APIs.</span></span> <span data-ttu-id="3572d-343">В SAS учетной записи указано ограничение на использование протоколов, поэтому запрос должен быть выполнен с помощью протокола HTTPS.</span><span class="sxs-lookup"><span data-stu-id="3572d-343">The account SAS restricts the protocol to HTTPS, so the request must be made with HTTPS.</span></span>

```csharp
static string GetAccountSASToken()
{
    // To create the account SAS, you need to use your shared key credentials. Modify for your account.
    const string ConnectionString = "DefaultEndpointsProtocol=https;AccountName=account-name;AccountKey=account-key";
    CloudStorageAccount storageAccount = CloudStorageAccount.Parse(ConnectionString);

    // Create a new access policy for the account.
    SharedAccessAccountPolicy policy = new SharedAccessAccountPolicy()
        {
            Permissions = SharedAccessAccountPermissions.Read | SharedAccessAccountPermissions.Write | SharedAccessAccountPermissions.List,
            Services = SharedAccessAccountServices.Blob | SharedAccessAccountServices.File,
            ResourceTypes = SharedAccessAccountResourceTypes.Service,
            SharedAccessExpiryTime = DateTime.UtcNow.AddHours(24),
            Protocols = SharedAccessProtocol.HttpsOnly
        };

    // Return the SAS token.
    return storageAccount.GetSharedAccessSignature(policy);
}
```

<span data-ttu-id="3572d-344">Чтобы использовать SAS учетной записи для доступа к API-интерфейсам уровня службы для службы BLOB-объектов, создайте клиентский BLOB-объект с помощью SAS и конечной точки хранилища BLOB-объектов для вашей учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="3572d-344">To use the account SAS to access service-level APIs for the Blob service, construct a Blob client object using the SAS and the Blob storage endpoint for your storage account.</span></span>

```csharp
static void UseAccountSAS(string sasToken)
{
    // Create new storage credentials using the SAS token.
    StorageCredentials accountSAS = new StorageCredentials(sasToken);
    // Use these credentials and the account name to create a Blob service client.
    CloudStorageAccount accountWithSAS = new CloudStorageAccount(accountSAS, "account-name", endpointSuffix: null, useHttps: true);
    CloudBlobClient blobClientWithSAS = accountWithSAS.CreateCloudBlobClient();

    // Now set the service properties for the Blob client created with the SAS.
    blobClientWithSAS.SetServiceProperties(new ServiceProperties()
    {
        HourMetrics = new MetricsProperties()
        {
            MetricsLevel = MetricsLevel.ServiceAndApi,
            RetentionDays = 7,
            Version = "1.0"
        },
        MinuteMetrics = new MetricsProperties()
        {
            MetricsLevel = MetricsLevel.ServiceAndApi,
            RetentionDays = 7,
            Version = "1.0"
        },
        Logging = new LoggingProperties()
        {
            LoggingOperations = LoggingOperations.All,
            RetentionDays = 14,
            Version = "1.0"
        }
    });

    // The permissions granted by the account SAS also permit you to retrieve service properties.
    ServiceProperties serviceProperties = blobClientWithSAS.GetServiceProperties();
    Console.WriteLine(serviceProperties.HourMetrics.MetricsLevel);
    Console.WriteLine(serviceProperties.HourMetrics.RetentionDays);
    Console.WriteLine(serviceProperties.HourMetrics.Version);
}
```

### <a name="example-create-a-stored-access-policy"></a><span data-ttu-id="3572d-345">Пример. Создание хранимой политики доступа</span><span class="sxs-lookup"><span data-stu-id="3572d-345">Example: Create a stored access policy</span></span>
<span data-ttu-id="3572d-346">Следующий код создает хранимую политику доступа для контейнера.</span><span class="sxs-lookup"><span data-stu-id="3572d-346">The following code creates a stored access policy on a container.</span></span> <span data-ttu-id="3572d-347">Политики доступа можно использовать для указания ограничений для SAS службы, накладываемые на контейнер или BLOB-объекты.</span><span class="sxs-lookup"><span data-stu-id="3572d-347">You can use the access policy to specify constraints for a service SAS on the container or its blobs.</span></span>

```csharp
private static async Task CreateSharedAccessPolicyAsync(CloudBlobContainer container, string policyName)
{
    // Create a new shared access policy and define its constraints.
    // The access policy provides create, write, read, list, and delete permissions.
    SharedAccessBlobPolicy sharedPolicy = new SharedAccessBlobPolicy()
    {
        // When the start time for the SAS is omitted, the start time is assumed to be the time when the storage service receives the request.
        // Omitting the start time for a SAS that is effective immediately helps to avoid clock skew.
        SharedAccessExpiryTime = DateTime.UtcNow.AddHours(24),
        Permissions = SharedAccessBlobPermissions.Read | SharedAccessBlobPermissions.List |
            SharedAccessBlobPermissions.Write | SharedAccessBlobPermissions.Create | SharedAccessBlobPermissions.Delete
    };

    // Get the container's existing permissions.
    BlobContainerPermissions permissions = await container.GetPermissionsAsync();

    // Add the new policy to the container's permissions, and set the container's permissions.
    permissions.SharedAccessPolicies.Add(policyName, sharedPolicy);
    await container.SetPermissionsAsync(permissions);
}
```

### <a name="example-create-a-service-sas-on-a-container"></a><span data-ttu-id="3572d-348">Пример. Создание SAS службы для контейнера</span><span class="sxs-lookup"><span data-stu-id="3572d-348">Example: Create a service SAS on a container</span></span>
<span data-ttu-id="3572d-349">Следующий код создает SAS для контейнера.</span><span class="sxs-lookup"><span data-stu-id="3572d-349">The following code creates a SAS on a container.</span></span> <span data-ttu-id="3572d-350">Если указано имя существующей хранимой политики доступа, то эта политика будет связана с SAS.</span><span class="sxs-lookup"><span data-stu-id="3572d-350">If the name of an existing stored access policy is provided, that policy is associated with the SAS.</span></span> <span data-ttu-id="3572d-351">Если хранимая политика доступа не указана, код создает для контейнера временную SAS.</span><span class="sxs-lookup"><span data-stu-id="3572d-351">If no stored access policy is provided, then the code creates an ad-hoc SAS on the container.</span></span>

```csharp
private static string GetContainerSasUri(CloudBlobContainer container, string storedPolicyName = null)
{
    string sasContainerToken;

    // If no stored policy is specified, create a new access policy and define its constraints.
    if (storedPolicyName == null)
    {
        // Note that the SharedAccessBlobPolicy class is used both to define the parameters of an ad-hoc SAS, and
        // to construct a shared access policy that is saved to the container's shared access policies.
        SharedAccessBlobPolicy adHocPolicy = new SharedAccessBlobPolicy()
        {
            // When the start time for the SAS is omitted, the start time is assumed to be the time when the storage service receives the request.
            // Omitting the start time for a SAS that is effective immediately helps to avoid clock skew.
            SharedAccessExpiryTime = DateTime.UtcNow.AddHours(24),
            Permissions = SharedAccessBlobPermissions.Write | SharedAccessBlobPermissions.List
        };

        // Generate the shared access signature on the container, setting the constraints directly on the signature.
        sasContainerToken = container.GetSharedAccessSignature(adHocPolicy, null);

        Console.WriteLine("SAS for blob container (ad hoc): {0}", sasContainerToken);
        Console.WriteLine();
    }
    else
    {
        // Generate the shared access signature on the container. In this case, all of the constraints for the
        // shared access signature are specified on the stored access policy, which is provided by name.
        // It is also possible to specify some constraints on an ad-hoc SAS and others on the stored access policy.
        sasContainerToken = container.GetSharedAccessSignature(null, storedPolicyName);

        Console.WriteLine("SAS for blob container (stored access policy): {0}", sasContainerToken);
        Console.WriteLine();
    }

    // Return the URI string for the container, including the SAS token.
    return container.Uri + sasContainerToken;
}
```

### <a name="example-create-a-service-sas-on-a-blob"></a><span data-ttu-id="3572d-352">Пример. Создание SAS службы для BLOB-объекта</span><span class="sxs-lookup"><span data-stu-id="3572d-352">Example: Create a service SAS on a blob</span></span>
<span data-ttu-id="3572d-353">Следующий код создает SAS для BLOB-объекта.</span><span class="sxs-lookup"><span data-stu-id="3572d-353">The following code creates a SAS on a blob.</span></span> <span data-ttu-id="3572d-354">Если указано имя существующей хранимой политики доступа, то эта политика будет связана с SAS.</span><span class="sxs-lookup"><span data-stu-id="3572d-354">If the name of an existing stored access policy is provided, that policy is associated with the SAS.</span></span> <span data-ttu-id="3572d-355">Если хранимая политика доступа не указана, код создает для BLOB-объекта временную SAS.</span><span class="sxs-lookup"><span data-stu-id="3572d-355">If no stored access policy is provided, then the code creates an ad-hoc SAS on the blob.</span></span>

```csharp
private static string GetBlobSasUri(CloudBlobContainer container, string blobName, string policyName = null)
{
    string sasBlobToken;

    // Get a reference to a blob within the container.
    // Note that the blob may not exist yet, but a SAS can still be created for it.
    CloudBlockBlob blob = container.GetBlockBlobReference(blobName);

    if (policyName == null)
    {
        // Create a new access policy and define its constraints.
        // Note that the SharedAccessBlobPolicy class is used both to define the parameters of an ad-hoc SAS, and
        // to construct a shared access policy that is saved to the container's shared access policies.
        SharedAccessBlobPolicy adHocSAS = new SharedAccessBlobPolicy()
        {
            // When the start time for the SAS is omitted, the start time is assumed to be the time when the storage service receives the request.
            // Omitting the start time for a SAS that is effective immediately helps to avoid clock skew.
            SharedAccessExpiryTime = DateTime.UtcNow.AddHours(24),
            Permissions = SharedAccessBlobPermissions.Read | SharedAccessBlobPermissions.Write | SharedAccessBlobPermissions.Create
        };

        // Generate the shared access signature on the blob, setting the constraints directly on the signature.
        sasBlobToken = blob.GetSharedAccessSignature(adHocSAS);

        Console.WriteLine("SAS for blob (ad hoc): {0}", sasBlobToken);
        Console.WriteLine();
    }
    else
    {
        // Generate the shared access signature on the blob. In this case, all of the constraints for the
        // shared access signature are specified on the container's stored access policy.
        sasBlobToken = blob.GetSharedAccessSignature(null, policyName);

        Console.WriteLine("SAS for blob (stored access policy): {0}", sasBlobToken);
        Console.WriteLine();
    }

    // Return the URI string for the container, including the SAS token.
    return blob.Uri + sasBlobToken;
}
```

## <a name="conclusion"></a><span data-ttu-id="3572d-356">Заключение</span><span class="sxs-lookup"><span data-stu-id="3572d-356">Conclusion</span></span>
<span data-ttu-id="3572d-357">Подписи общего доступа удобно применять в целях предоставления ограниченных разрешений для вашей учетной записи хранения тем клиентам, которые нельзя передавать ключ учетной записи.</span><span class="sxs-lookup"><span data-stu-id="3572d-357">Shared access signatures are useful for providing limited permissions to your storage account to clients that should not have the account key.</span></span> <span data-ttu-id="3572d-358">Таким образом, они являются важной частью модели обеспечения безопасности для любого приложения, использующего хранилище Azure.</span><span class="sxs-lookup"><span data-stu-id="3572d-358">As such, they are a vital part of the security model for any application using Azure Storage.</span></span> <span data-ttu-id="3572d-359">Если следовать указанным здесь рекомендациям, подписи общего доступа позволяют повысить гибкость доступа к ресурсам в вашей учетной записи хранения без ущерба для безопасности приложения.</span><span class="sxs-lookup"><span data-stu-id="3572d-359">If you follow the best practices listed here, you can use SAS to provide greater flexibility of access to resources in your storage account, without compromising the security of your application.</span></span>

## <a name="next-steps"></a><span data-ttu-id="3572d-360">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="3572d-360">Next Steps</span></span>
* [<span data-ttu-id="3572d-361">Управление анонимным доступом на чтение к контейнерам и большим двоичным объектам</span><span class="sxs-lookup"><span data-stu-id="3572d-361">Manage anonymous read access to containers and blobs</span></span>](storage-manage-access-to-resources.md)
* [<span data-ttu-id="3572d-362">Делегирование доступа с помощью подписанного URL-адреса</span><span class="sxs-lookup"><span data-stu-id="3572d-362">Delegating Access with a Shared Access Signature</span></span>](http://msdn.microsoft.com/library/azure/ee395415.aspx)
* [<span data-ttu-id="3572d-363">Введение в использование SAS таблиц и очередей</span><span class="sxs-lookup"><span data-stu-id="3572d-363">Introducing Table and Queue SAS</span></span>](http://blogs.msdn.com/b/windowsazurestorage/archive/2012/06/12/introducing-table-sas-shared-access-signature-queue-sas-and-update-to-blob-sas.aspx)

[sas-storage-fe-proxy-service]: ./media/storage-dotnet-shared-access-signature-part-1/sas-storage-fe-proxy-service.png
[sas-storage-provider-service]: ./media/storage-dotnet-shared-access-signature-part-1/sas-storage-provider-service.png
[sas-storage-uri]: ./media/storage-dotnet-shared-access-signature-part-1/sas-storage-uri.png
