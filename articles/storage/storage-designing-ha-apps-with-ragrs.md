---
title: "aaaDesigning высокой доступные приложения, использующие географически избыточное хранилище Azure доступ для чтения (RA-GRS) | Документы Microsoft"
description: "Как tooarchitect хранилища Azure RA-GRS toouse приложение с высокой доступностью гибкие достаточно toohandle сбоев."
services: storage
documentationcenter: .net
author: robinsh
manager: timlt
editor: tysonn
ms.assetid: 8f040b0f-8926-4831-ac07-79f646f31926
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 1/19/2017
ms.author: robinsh
ms.openlocfilehash: e4a9fe7ef33eecd894408b3c1ef59920a248d1bd
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="designing-highly-available-applications-using-ra-grs"></a><span data-ttu-id="ef11a-103">Проектирование высокодоступных приложений с использованием RA-GRS</span><span class="sxs-lookup"><span data-stu-id="ef11a-103">Designing Highly Available Applications using RA-GRS</span></span>

<span data-ttu-id="ef11a-104">Характерной чертой облачных инфраструктур является то, что они предоставляют высокодоступную платформу для размещения приложений.</span><span class="sxs-lookup"><span data-stu-id="ef11a-104">A common feature of cloud-based infrastructures is that they provide a highly available platform for hosting applications.</span></span> <span data-ttu-id="ef11a-105">Разработчикам облачных приложений необходимо учитывать как тщательно tooleverage такое платформы приложения с высокой доступностью toodeliver tootheir пользователи.</span><span class="sxs-lookup"><span data-stu-id="ef11a-105">Developers of cloud-based applications must consider carefully how tooleverage this platform toodeliver highly available applications tootheir users.</span></span> <span data-ttu-id="ef11a-106">Эта статья посвящена специально как разработчики могут использовать hello Azure хранилища доступ на чтение географически избыточное хранилище (RA-GRS) toomake больше доступных приложений.</span><span class="sxs-lookup"><span data-stu-id="ef11a-106">This article focuses specifically on how developers can use hello Azure Storage Read Access Geo Redundant Storage (RA-GRS) toomake their applications more available.</span></span>

<span data-ttu-id="ef11a-107">Доступно четыре варианта обеспечения избыточности: LRS (локально избыточное хранилище), ZRS (хранилище, избыточное в пределах зоны), GRS (геоизбыточное хранилище) и RA-GRS (геоизбыточное хранилище с доступом на чтение).</span><span class="sxs-lookup"><span data-stu-id="ef11a-107">There are four choices for redundancy – LRS (Locally Redundant Storage), ZRS (Zone Redundant Storage), GRS (Geo-Redundant Storage), and RA-GRS (Read Access Geo-Redundant Storage).</span></span> <span data-ttu-id="ef11a-108">Мы будем toodiscuss GRS и RA-GRS в этой статье.</span><span class="sxs-lookup"><span data-stu-id="ef11a-108">We are going toodiscuss GRS and RA-GRS in this article.</span></span> <span data-ttu-id="ef11a-109">При использовании GRS три копии данных хранятся в основной регион hello, выбранных при настройке учетной записи хранилища hello.</span><span class="sxs-lookup"><span data-stu-id="ef11a-109">With GRS, three copies of your data are kept in hello primary region you selected when setting up hello storage account.</span></span> <span data-ttu-id="ef11a-110">Три дополнительные копии сохраняются асинхронно в дополнительном регионе, заданном Azure.</span><span class="sxs-lookup"><span data-stu-id="ef11a-110">Three additional copies are maintained asynchronously in a secondary region specified by Azure.</span></span> <span data-ttu-id="ef11a-111">RA-GRS — hello же, что и GRS, за исключением того, что у вас есть доступ для чтения toohello дополнительная копия.</span><span class="sxs-lookup"><span data-stu-id="ef11a-111">RA-GRS is hello same thing as GRS except that you have read access toohello secondary copy.</span></span> <span data-ttu-id="ef11a-112">Дополнительные сведения о hello различные варианты избыточности хранилища Azure см. в разделе [репликацию хранилища Azure](https://docs.microsoft.com/en-us/azure/storage/storage-redundancy).</span><span class="sxs-lookup"><span data-stu-id="ef11a-112">For more information about hello different Azure Storage redundancy options, see [Azure Storage replication](https://docs.microsoft.com/en-us/azure/storage/storage-redundancy).</span></span> <span data-ttu-id="ef11a-113">статьи для репликации Hello также показаны пары hello hello основного и дополнительного регионов.</span><span class="sxs-lookup"><span data-stu-id="ef11a-113">hello replication article also shows hello pairings of hello primary and secondary regions.</span></span>

<span data-ttu-id="ef11a-114">Существует фрагментов кода в этой статье и полный пример tooa ссылку в конце hello, можно загрузить и запустить.</span><span class="sxs-lookup"><span data-stu-id="ef11a-114">There are code snippets included in this article, and a link tooa complete sample at hello end that you can download and run.</span></span>

## <a name="key-features-of-ra-grs"></a><span data-ttu-id="ef11a-115">Ключевые возможности RA-GRS</span><span class="sxs-lookup"><span data-stu-id="ef11a-115">Key features of RA-GRS</span></span>

<span data-ttu-id="ef11a-116">Прежде чем мы расскажем, как toouse хранилище RA-GRS, давайте поговорим об его свойства и поведение.</span><span class="sxs-lookup"><span data-stu-id="ef11a-116">Before we talk about how toouse RA-GRS storage, let's talk about its properties and behavior.</span></span>

* <span data-ttu-id="ef11a-117">Хранилище Azure поддерживает только для чтения копию данных hello, хранящихся в основном регионе в дополнительном регионе; как указано выше, служба хранилища hello определяет расположение hello hello дополнительный регион.</span><span class="sxs-lookup"><span data-stu-id="ef11a-117">Azure Storage maintains a read-only copy of hello data you store in your primary region in a secondary region; as noted above, hello storage service determines hello location of hello secondary region.</span></span>

* <span data-ttu-id="ef11a-118">только для чтения копия Hello [согласованным](https://en.wikipedia.org/wiki/Eventual_consistency) с данными hello в основном регионе hello.</span><span class="sxs-lookup"><span data-stu-id="ef11a-118">hello read-only copy is [eventually consistent](https://en.wikipedia.org/wiki/Eventual_consistency) with hello data in hello primary region.</span></span>

* <span data-ttu-id="ef11a-119">Для больших двоичных объектов, таблиц и очередей, можно запросить hello дополнительный регион для *время последней синхронизации* значение, которое указывает, когда произошла Последняя репликация hello из вторичного региона основной toohello hello.</span><span class="sxs-lookup"><span data-stu-id="ef11a-119">For blobs, tables, and queues, you can query hello secondary region for a *Last Sync Time* value that tells you when hello last replication from hello primary toohello secondary region occurred.</span></span> <span data-ttu-id="ef11a-120">(Это не работает для хранилища файлов Azure, которое не обеспечивает избыточность RA-GRS.)</span><span class="sxs-lookup"><span data-stu-id="ef11a-120">(This is not supported for Azure File storage, which doesn't have RA-GRS redundancy at this time.)</span></span>

* <span data-ttu-id="ef11a-121">Клиентская библиотека хранилища toointeract hello можно использовать с данными hello в основном или дополнительном регионе либо hello.</span><span class="sxs-lookup"><span data-stu-id="ef11a-121">You can use hello Storage Client Library toointeract with hello data in either hello primary or secondary region.</span></span> <span data-ttu-id="ef11a-122">Также можно перенаправлять чтения автоматически запрашивает toohello дополнительный регион, если запрос чтения основного региона toohello времени ожидания.</span><span class="sxs-lookup"><span data-stu-id="ef11a-122">You can also redirect read requests automatically toohello secondary region if a read request toohello primary region times out.</span></span>

* <span data-ttu-id="ef11a-123">В случае очень важна влияния на доступность hello hello данные в основном регионе hello hello команды Azure может запускать географическая отработка отказа, после чего hello DNS-записей, указывающий основной регион toohello будет измененные toopoint toohello дополнительный регион.</span><span class="sxs-lookup"><span data-stu-id="ef11a-123">If there is a major issue affecting hello accessibility of hello data in hello primary region, hello Azure team may trigger a geo-failover, at which point hello DNS entries pointing toohello primary region will be changed toopoint toohello secondary region.</span></span>

* <span data-ttu-id="ef11a-124">В случае географическая отработка отказа Azure выбрать новое местоположение вторичного и реплицировать расположение toothat данных hello, затем пункт hello вторичного DNS записи tooit.</span><span class="sxs-lookup"><span data-stu-id="ef11a-124">If a geo-failover occurs, Azure will select a new secondary location and replicate hello data toothat location, then point hello secondary DNS entries tooit.</span></span> <span data-ttu-id="ef11a-125">Вторичная конечная точка Hello будет оставаться недоступным до завершения репликации hello учетной записи хранилища.</span><span class="sxs-lookup"><span data-stu-id="ef11a-125">hello secondary endpoint will be unavailable until hello storage account has finished replicating.</span></span> <span data-ttu-id="ef11a-126">Дополнительные сведения см. в разделе [какие toodo в случае сбоя хранилища Azure](https://docs.microsoft.com/en-us/azure/storage/storage-disaster-recovery-guidance).</span><span class="sxs-lookup"><span data-stu-id="ef11a-126">For more information, please see [What toodo if an Azure Storage outage occurs](https://docs.microsoft.com/en-us/azure/storage/storage-disaster-recovery-guidance).</span></span>

## <a name="application-design-considerations-when-using-ra-grs"></a><span data-ttu-id="ef11a-127">Рекомендации по проектированию приложений при использовании RA-GRS</span><span class="sxs-lookup"><span data-stu-id="ef11a-127">Application design considerations when using RA-GRS</span></span>

<span data-ttu-id="ef11a-128">Основная цель этой статьи Hello — tooshow вы как center toodesign приложение, которое будет продолжать работу toofunction (хотя и в ограниченного объема) даже в событии hello серьезной аварии в hello основных данных.</span><span class="sxs-lookup"><span data-stu-id="ef11a-128">hello main purpose of this article is tooshow you how toodesign an application that will continue toofunction (albeit in a limited capacity) even in hello event of a major disaster at hello primary data center.</span></span> <span data-ttu-id="ef11a-129">Для этого с вашей временной toohandle приложения или долго выполняющихся проблемы, переключение tooread из вторичного региона hello, пока проблема и переключение основной регион hello снова не станет доступным.</span><span class="sxs-lookup"><span data-stu-id="ef11a-129">You do this by having your application toohandle transient or long-running issues by switching tooread from hello secondary region while there is a problem, and switching back when hello primary region is available again.</span></span>

### <a name="using-eventually-consistent-data"></a><span data-ttu-id="ef11a-130">Использование данных, согласованных в конечном счете</span><span class="sxs-lookup"><span data-stu-id="ef11a-130">Using eventually consistent data</span></span>

<span data-ttu-id="ef11a-131">Это предлагаемое решение предполагает, он хорошо tooreturn чем может быть устаревшие данные toohello вызывающему приложению.</span><span class="sxs-lookup"><span data-stu-id="ef11a-131">This proposed solution assumes that it is okay tooreturn what could be stale data toohello calling application.</span></span> <span data-ttu-id="ef11a-132">Так как база данных-получатель hello согласованным, возможна hello данные были записаны toohello основной, но toohello обновления hello получателя не был завершен репликации при hello первичный регион стал недоступен.</span><span class="sxs-lookup"><span data-stu-id="ef11a-132">Because hello secondary data is eventually consistent, it is possible that hello data was written toohello primary but hello update toohello secondary had not finished replicating when hello primary region became inaccessible.</span></span>

<span data-ttu-id="ef11a-133">Например клиент может отправить обновление, которое успешно, а затем hello основной удалось перейдите до hello обновления получателей распространенный toohello.</span><span class="sxs-lookup"><span data-stu-id="ef11a-133">For example, your customer could submit an update that is successful, and then hello primary could go down before hello update is propagated toohello secondary.</span></span> <span data-ttu-id="ef11a-134">В этом случае если hello клиента, после чего просит tooread hello данные назад, он получает hello устаревшие данные вместо hello обновления данных.</span><span class="sxs-lookup"><span data-stu-id="ef11a-134">In this case, if hello customer then asks tooread hello data back, he receives hello stale data instead of hello updated data.</span></span> <span data-ttu-id="ef11a-135">Если это допустимо и если да, необходимо решить, каким образом будет сообщения приветствия клиента.</span><span class="sxs-lookup"><span data-stu-id="ef11a-135">You must decide if this is acceptable, and if so, how you will message hello customer.</span></span> <span data-ttu-id="ef11a-136">Вы увидите, как toocheck hello время последней синхронизации на hello получателя данных далее в этой статье toosee, если актуально hello получателей.</span><span class="sxs-lookup"><span data-stu-id="ef11a-136">You'll see how toocheck hello Last Sync Time on hello secondary data later in this article toosee if hello secondary is up-to-date.</span></span>

### <a name="handling-services-separately-or-all-together"></a><span data-ttu-id="ef11a-137">Отдельная или совместная обработка служб</span><span class="sxs-lookup"><span data-stu-id="ef11a-137">Handling services separately or all together</span></span>

<span data-ttu-id="ef11a-138">Хотя это маловероятно, возможна toobecome одна служба недоступна во время hello другие службы работают по-прежнему полностью.</span><span class="sxs-lookup"><span data-stu-id="ef11a-138">While not likely, it is possible for one service toobecome unavailable while hello other services are still fully functional.</span></span> <span data-ttu-id="ef11a-139">Вы можно попыток дескриптор hello и режиме только для чтения для каждой службы отдельно (больших двоичных объектов, очередей, таблиц) или повторных попыток, общим для всех служб хранилища hello можно обрабатывать вместе.</span><span class="sxs-lookup"><span data-stu-id="ef11a-139">You can handle hello retries and read-only mode for each service separately (blobs, queues, tables), or you can handle retries generically for all hello storage services together.</span></span>

<span data-ttu-id="ef11a-140">Например при использовании очередей и больших двоичных объектов в приложении можно tooput ошибкам повторяемая toohandle отдельный код для каждого из них.</span><span class="sxs-lookup"><span data-stu-id="ef11a-140">For example, if you use queues and blobs in your application, you may decide tooput in separate code toohandle retryable errors for each of these.</span></span> <span data-ttu-id="ef11a-141">Затем Если повторная попытка получить из службы BLOB-объектов hello, но по-прежнему работает служба очередей hello, будут затронуты только hello часть приложения, которые обрабатывают большие двоичные объекты.</span><span class="sxs-lookup"><span data-stu-id="ef11a-141">Then if you get a retry from hello blob service, but hello queue service is still working, only hello part of your application that handles blobs will be impacted.</span></span> <span data-ttu-id="ef11a-142">Если вы решите toohandle универсальной повторяет все службы хранилища и службы больших двоичных объектов toohello вызов возвращает Повторяемая ошибка, а затем запросов tooboth hello BLOB-объектов службы и службы очередей hello повлияет.</span><span class="sxs-lookup"><span data-stu-id="ef11a-142">If you decide toohandle all storage service retries generically and a call toohello blob service returns a retryable error, then requests tooboth hello blob service and hello queue service will be impacted.</span></span>

<span data-ttu-id="ef11a-143">В конечном счете это зависит от сложности приложения hello.</span><span class="sxs-lookup"><span data-stu-id="ef11a-143">Ultimately, this depends on hello complexity of your application.</span></span> <span data-ttu-id="ef11a-144">Вы можете решить не сбоев hello toohandle службой, а tooredirect запросов на чтение для всех служб toohello дополнительный регион хранилища и запустите приложение hello в режиме только для чтения, при обнаружении проблемы с любой службой хранения в первичном регионе hello.</span><span class="sxs-lookup"><span data-stu-id="ef11a-144">You may decide not toohandle hello failures by service, but instead tooredirect read requests for all storage services toohello secondary region and run hello application in read-only mode when you detect a problem with any storage service in hello primary region.</span></span>

### <a name="other-considerations"></a><span data-ttu-id="ef11a-145">Дополнительные рекомендации</span><span class="sxs-lookup"><span data-stu-id="ef11a-145">Other considerations</span></span>

<span data-ttu-id="ef11a-146">Они являются hello другие вопросы, которые обсуждаются в hello оставшейся части этой статьи.</span><span class="sxs-lookup"><span data-stu-id="ef11a-146">These are hello other considerations we will discuss in hello rest of this article.</span></span>

*   <span data-ttu-id="ef11a-147">Обработка повторных запросов на чтение, используя шаблон Размыкатель цепи hello</span><span class="sxs-lookup"><span data-stu-id="ef11a-147">Handling retries of read requests using hello Circuit Breaker pattern</span></span>

*   <span data-ttu-id="ef11a-148">В конечном итоге целостность данных и время последней синхронизации hello</span><span class="sxs-lookup"><span data-stu-id="ef11a-148">Eventually-consistent data and hello Last Sync Time</span></span>

*   <span data-ttu-id="ef11a-149">Тестирование</span><span class="sxs-lookup"><span data-stu-id="ef11a-149">Testing</span></span>

## <a name="running-your-application-in-read-only-mode"></a><span data-ttu-id="ef11a-150">Выполнение приложения в режиме только для чтения</span><span class="sxs-lookup"><span data-stu-id="ef11a-150">Running your application in read-only mode</span></span>

<span data-ttu-id="ef11a-151">toouse хранилища RA-GRS, вы должны быть запросов может toohandle как сбой чтения и неудачных запросов update (с обновления в данном случае это означает операции вставки, обновления и удаления).</span><span class="sxs-lookup"><span data-stu-id="ef11a-151">toouse RA-GRS storage, you must be able toohandle both failed read requests and failed update requests (with update in this case meaning inserts, updates, and deletions).</span></span> <span data-ttu-id="ef11a-152">Если hello завершается ошибкой center первичных данных, для чтения запросы могут быть перенаправленный toohello вторичный центр обработки данных, но запросы на обновление невозможно, так как hello получателя доступно только для чтения.</span><span class="sxs-lookup"><span data-stu-id="ef11a-152">If hello primary data center fails, read requests can be redirected toohello secondary data center, but update requests cannot because hello secondary is read only.</span></span> <span data-ttu-id="ef11a-153">По этой причине необходимо некоторые toorun способом приложения в режиме только для чтения.</span><span class="sxs-lookup"><span data-stu-id="ef11a-153">For this reason, you need some way toorun your application in read-only mode.</span></span>

<span data-ttu-id="ef11a-154">Например можно задать флаг, который будет проверяться перед отправкой любой службы хранилища toohello запросы обновления.</span><span class="sxs-lookup"><span data-stu-id="ef11a-154">For example, you can set a flag that will be checked before submitting any update requests toohello storage service.</span></span> <span data-ttu-id="ef11a-155">Если один из запросов на обновление hello поступает может пропустить этот и возвращать toohello соответствующий ответ клиенту.</span><span class="sxs-lookup"><span data-stu-id="ef11a-155">When one of hello update requests comes through, you can skip it and return an appropriate response toohello customer.</span></span> <span data-ttu-id="ef11a-156">Можно даже toodisable полностью определенные компоненты пока не будет устранена проблема hello и уведомить пользователей, что эти функции будут временно недоступна.</span><span class="sxs-lookup"><span data-stu-id="ef11a-156">You may even want toodisable certain features altogether until hello problem is resolved and notify users that those features are temporarily unavailable.</span></span>

<span data-ttu-id="ef11a-157">В случае ошибки toohandle для каждой службы отдельно, необходимо также toohandle hello возможности toorun приложения в режиме только для чтения службой.</span><span class="sxs-lookup"><span data-stu-id="ef11a-157">If you decide toohandle errors for each service separately, you will also need toohandle hello ability toorun your application in read-only mode by service.</span></span> <span data-ttu-id="ef11a-158">У вас может быть только для чтения флаги для каждой службы, который может быть включен и отключен и дескриптор hello соответствующий флаг в нужных местах hello в коде.</span><span class="sxs-lookup"><span data-stu-id="ef11a-158">You could have read-only flags for each service that can be enabled and disabled and handle hello appropriate flag in hello appropriate places in your code.</span></span>

<span data-ttu-id="ef11a-159">Может toorun приложение в режиме только для чтения имеет другой дополнительное преимущество — она предоставляет возможность tooensure hello ограниченной функциональностью во время обновления основного приложения.</span><span class="sxs-lookup"><span data-stu-id="ef11a-159">Being able toorun your application in read-only mode has another side benefit – it gives you hello ability tooensure limited functionality during a major application upgrade.</span></span> <span data-ttu-id="ef11a-160">Вы можете активировать toorun вашего приложения в только для чтения режим и toohello точки вторичный центр обработки данных, гарантируя, что никто не обращается к данным hello в основном регионе hello время выполнения обновления.</span><span class="sxs-lookup"><span data-stu-id="ef11a-160">You can trigger your application toorun in read-only mode and point toohello secondary data center, ensuring nobody is accessing hello data in hello primary region while you're making upgrades.</span></span>

## <a name="handling-updates-when-running-in-read-only-mode"></a><span data-ttu-id="ef11a-161">Обработка обновлений в режиме только для чтения</span><span class="sxs-lookup"><span data-stu-id="ef11a-161">Handling updates when running in read-only mode</span></span>

<span data-ttu-id="ef11a-162">Существует множество способов обновления toohandle запрашивает при работе в режиме только для чтения.</span><span class="sxs-lookup"><span data-stu-id="ef11a-162">There are many ways toohandle update requests when running in read-only mode.</span></span> <span data-ttu-id="ef11a-163">Мы не сможем подробно рассмотреть их все, но в целом существует несколько шаблонов, которые вам стоит принять во внимание.</span><span class="sxs-lookup"><span data-stu-id="ef11a-163">We won't cover this comprehensively, but generally, there are a couple of patterns that you consider.</span></span>

1.  <span data-ttu-id="ef11a-164">Можно ответить пользователь tooyour и сообщите, что вы не принимаете в настоящее время обновления.</span><span class="sxs-lookup"><span data-stu-id="ef11a-164">You can respond tooyour user and tell them you are not currently accepting updates.</span></span> <span data-ttu-id="ef11a-165">Например в системе управления контактами может включить заказчиков tooaccess контактные данные, но не выполнять обновления.</span><span class="sxs-lookup"><span data-stu-id="ef11a-165">For example, a contact management system could enable customers tooaccess contact information but not make updates.</span></span>

2.  <span data-ttu-id="ef11a-166">Можно поставить обновления в очередь в другом регионе.</span><span class="sxs-lookup"><span data-stu-id="ef11a-166">You can enqueue your updates in another region.</span></span> <span data-ttu-id="ef11a-167">В этом случае следует писать запросы tooa ожидает обновления очереди в другом регионе и затем после tooprocess способом эти запросы hello основного центра обработки данных в оперативный еще раз.</span><span class="sxs-lookup"><span data-stu-id="ef11a-167">In this case, you would write your pending update requests tooa queue in a different region, and then have a way tooprocess those requests after hello primary data center comes online again.</span></span> <span data-ttu-id="ef11a-168">В этом сценарии должен сообщить клиенту hello информацию о запросе обновления hello помещается в очередь для последующей обработки.</span><span class="sxs-lookup"><span data-stu-id="ef11a-168">In this scenario, you should let hello customer know that hello update requested is queued for later processing.</span></span>

3.  <span data-ttu-id="ef11a-169">Можно написать обновления tooa учетной записи хранилища в другом регионе.</span><span class="sxs-lookup"><span data-stu-id="ef11a-169">You can write your updates tooa storage account in another region.</span></span> <span data-ttu-id="ef11a-170">Затем hello основного центра обработки данных в оперативный после будет toomerge способом эти обновления в hello первичных данных, в зависимости от структуры hello hello данных.</span><span class="sxs-lookup"><span data-stu-id="ef11a-170">Then when hello primary data center comes back online, you can have a way toomerge those updates into hello primary data, depending on hello structure of hello data.</span></span> <span data-ttu-id="ef11a-171">Например при создании отдельные файлы с метки даты и времени в имени hello можно скопировать основной регион задней toohello эти файлы.</span><span class="sxs-lookup"><span data-stu-id="ef11a-171">For example, if you are creating separate files with a date/time stamp in hello name, you can copy those files back toohello primary region.</span></span> <span data-ttu-id="ef11a-172">Это подходит для некоторых рабочих нагрузок, например ведения журнала и данных Интернета вещей.</span><span class="sxs-lookup"><span data-stu-id="ef11a-172">This works for some workloads such as logging and iOT data.</span></span>

## <a name="handling-retries"></a><span data-ttu-id="ef11a-173">Обработка повторных попыток</span><span class="sxs-lookup"><span data-stu-id="ef11a-173">Handling retries</span></span>

<span data-ttu-id="ef11a-174">Как узнать, какие ошибки допускают повторение?</span><span class="sxs-lookup"><span data-stu-id="ef11a-174">How do you know which errors are retryable?</span></span> <span data-ttu-id="ef11a-175">Это определяется клиентской библиотеки хранилища hello.</span><span class="sxs-lookup"><span data-stu-id="ef11a-175">This is determined by hello storage client library.</span></span> <span data-ttu-id="ef11a-176">Например сообщение об ошибке 404 (ресурс не найден) является возможности повторной попытки, поскольку повторная попытка его не является скорее всего, tooresult в успех.</span><span class="sxs-lookup"><span data-stu-id="ef11a-176">For example, a 404 error (resource not found) is not retryable because retrying it is not likely tooresult in success.</span></span> <span data-ttu-id="ef11a-177">На hello другой стороны, ошибка 500 можно выполнить повторно, так как это ошибка сервера, и может быть просто временная проблема.</span><span class="sxs-lookup"><span data-stu-id="ef11a-177">On hello other hand, a 500 error is retryable because it is a server error, and it may simply be a transient issue.</span></span> <span data-ttu-id="ef11a-178">Дополнительные сведения см. hello [открытый исходный код для класса ExponentialRetry hello](https://github.com/Azure/azure-storage-net/blob/87b84b3d5ee884c7adc10e494e2c7060956515d0/Lib/Common/RetryPolicies/ExponentialRetry.cs) в клиентской библиотеки хранилища .NET hello.</span><span class="sxs-lookup"><span data-stu-id="ef11a-178">For more details, check out hello [open source code for hello ExponentialRetry class](https://github.com/Azure/azure-storage-net/blob/87b84b3d5ee884c7adc10e494e2c7060956515d0/Lib/Common/RetryPolicies/ExponentialRetry.cs) in hello .NET storage client library.</span></span> <span data-ttu-id="ef11a-179">(Найдите hello метод ShouldRetry).</span><span class="sxs-lookup"><span data-stu-id="ef11a-179">(Look for hello ShouldRetry method.)</span></span>

### <a name="read-requests"></a><span data-ttu-id="ef11a-180">Запросы на чтение</span><span class="sxs-lookup"><span data-stu-id="ef11a-180">Read requests</span></span>

<span data-ttu-id="ef11a-181">Запросов на чтение может быть перенаправленный toosecondary хранилища, если имеется проблема с основного хранилища.</span><span class="sxs-lookup"><span data-stu-id="ef11a-181">Read requests can be redirected toosecondary storage if there is a problem with primary storage.</span></span> <span data-ttu-id="ef11a-182">Как было отмечено выше, в [с помощью со временем согласованных данных](#using-eventually-consistent-data), он должен быть приемлемым для вашего приложения toopotentially читать устаревшие данные.</span><span class="sxs-lookup"><span data-stu-id="ef11a-182">As noted above in [Using Eventually Consistent Data](#using-eventually-consistent-data), it must be acceptable for your application toopotentially read stale data.</span></span> <span data-ttu-id="ef11a-183">При использовании hello хранилища клиента библиотеки tooaccess RA-GRS данных можно указать поведение запроса на чтение "Повторить" hello, задав значение для hello **LocationMode** tooone свойство hello следующее:</span><span class="sxs-lookup"><span data-stu-id="ef11a-183">If you are using hello storage client library tooaccess RA-GRS data, you can specify hello retry behavior of a read request by setting a value for hello **LocationMode** property tooone of hello following:</span></span>

*   <span data-ttu-id="ef11a-184">**PrimaryOnly** (hello по умолчанию)</span><span class="sxs-lookup"><span data-stu-id="ef11a-184">**PrimaryOnly** (hello default)</span></span>

*   <span data-ttu-id="ef11a-185">**PrimaryThenSecondary**;</span><span class="sxs-lookup"><span data-stu-id="ef11a-185">**PrimaryThenSecondary**</span></span>

*   <span data-ttu-id="ef11a-186">**SecondaryOnly**;</span><span class="sxs-lookup"><span data-stu-id="ef11a-186">**SecondaryOnly**</span></span>

*   <span data-ttu-id="ef11a-187">**SecondaryThenPrimary**.</span><span class="sxs-lookup"><span data-stu-id="ef11a-187">**SecondaryThenPrimary**</span></span>

<span data-ttu-id="ef11a-188">При задании hello **LocationMode** слишком**PrimaryThenSecondary**, если начальный hello чтения основную конечную точку toohello запрос завершается с Повторяемая ошибка, клиент hello автоматически делает другая операция чтения запрос toohello вторичной конечной точки.</span><span class="sxs-lookup"><span data-stu-id="ef11a-188">When you set hello **LocationMode** too**PrimaryThenSecondary**, if hello initial read request toohello primary endpoint fails with a retryable error, hello client automatically makes another read request toohello secondary endpoint.</span></span> <span data-ttu-id="ef11a-189">Если hello ошибка времени ожидания сервера, клиента hello будет иметь toowait для hello tooexpire время ожидания до получения от службы hello Повторяемая ошибка.</span><span class="sxs-lookup"><span data-stu-id="ef11a-189">If hello error is a server timeout, then hello client will have toowait for hello timeout tooexpire before it receives a retryable error from hello service.</span></span>

<span data-ttu-id="ef11a-190">Существуют две сценарии tooconsider при выборе как toorespond tooa Повторяемая ошибка:</span><span class="sxs-lookup"><span data-stu-id="ef11a-190">There are basically two scenarios tooconsider when you are deciding how toorespond tooa retryable error:</span></span>

*   <span data-ttu-id="ef11a-191">Это изолированной проблемы и основную конечную точку toohello последующие запросы не вернет Повторяемая ошибка.</span><span class="sxs-lookup"><span data-stu-id="ef11a-191">This is an isolated problem and subsequent requests toohello primary endpoint will not return a retryable error.</span></span> <span data-ttu-id="ef11a-192">Например, такая ситуация может сложиться при временной ошибке в сети.</span><span class="sxs-lookup"><span data-stu-id="ef11a-192">An example of where this might happen is when there is a transient network error.</span></span>

    <span data-ttu-id="ef11a-193">В этом сценарии ничего страшного значительного увеличения производительности в необходимости **LocationMode** значение слишком**PrimaryThenSecondary** как это происходит редко.</span><span class="sxs-lookup"><span data-stu-id="ef11a-193">In this scenario, there is no significant performance penalty in having **LocationMode** set too**PrimaryThenSecondary** as this only happens infrequently.</span></span>

*   <span data-ttu-id="ef11a-194">Это проблема с по крайней мере одной из служб хранения hello в основном регионе hello и все последующие запросы службы toothat, в основном регионе hello повторяемая ошибок tooreturn скорее всего, в течение заданного времени.</span><span class="sxs-lookup"><span data-stu-id="ef11a-194">This is a problem with at least one of hello storage services in hello primary region and all subsequent requests toothat service in hello primary region are likely tooreturn retryable errors for a period of time.</span></span> <span data-ttu-id="ef11a-195">Примером этого является ли основной регион hello полностью недоступен.</span><span class="sxs-lookup"><span data-stu-id="ef11a-195">An example of this is if hello primary region is completely inaccessible.</span></span>

    <span data-ttu-id="ef11a-196">В этом сценарии существует производительность снижается, так как все запросы чтения будет сначала hello основной конечной точки, дождитесь hello tooexpire время ожидания, а затем переключиться toohello вторичной конечной точки.</span><span class="sxs-lookup"><span data-stu-id="ef11a-196">In this scenario, there is a performance penalty because all your read requests will try hello primary endpoint first, wait for hello timeout tooexpire, then switch toohello secondary endpoint.</span></span>

<span data-ttu-id="ef11a-197">В таких случаях необходимо определить, что текущая проблема с основной конечной точки hello и отправки всех запросов на чтение напрямую hello toohello вторичной конечной точки, задав **LocationMode** свойство слишком **SecondaryOnly**.</span><span class="sxs-lookup"><span data-stu-id="ef11a-197">For these scenarios, you should identify that there is an ongoing issue with hello primary endpoint and send all read requests directly toohello secondary endpoint by setting hello **LocationMode** property too**SecondaryOnly**.</span></span> <span data-ttu-id="ef11a-198">В данный момент необходимо также изменить toorun приложения hello в режиме только для чтения.</span><span class="sxs-lookup"><span data-stu-id="ef11a-198">At this time, you should also change hello application toorun in read-only mode.</span></span> <span data-ttu-id="ef11a-199">Такой подход известен как hello [шаблон Размыкатель цепи](https://msdn.microsoft.com/library/dn589784.aspx).</span><span class="sxs-lookup"><span data-stu-id="ef11a-199">This approach is known as hello [Circuit Breaker Pattern](https://msdn.microsoft.com/library/dn589784.aspx).</span></span>

### <a name="update-requests"></a><span data-ttu-id="ef11a-200">Запросы на обновление</span><span class="sxs-lookup"><span data-stu-id="ef11a-200">Update requests</span></span>

<span data-ttu-id="ef11a-201">шаблон Hello Размыкатель цепи также может быть применен tooupdate запросов.</span><span class="sxs-lookup"><span data-stu-id="ef11a-201">hello Circuit Breaker pattern can also be applied tooupdate requests.</span></span> <span data-ttu-id="ef11a-202">Тем не менее запросы на обновление не может быть перенаправленный toosecondary хранилища, которое доступно только для чтения.</span><span class="sxs-lookup"><span data-stu-id="ef11a-202">However, update requests cannot be redirected toosecondary storage, which is read-only.</span></span> <span data-ttu-id="ef11a-203">Для этих запросов, следует оставить hello **LocationMode** значение свойства слишком**PrimaryOnly** (по умолчанию hello).</span><span class="sxs-lookup"><span data-stu-id="ef11a-203">For these requests, you should leave hello **LocationMode** property set too**PrimaryOnly** (hello default).</span></span> <span data-ttu-id="ef11a-204">toohandle эти ошибки можно применять запросы, метрики toothese — например 10 сбоев подряд — и при соблюдении порог переключения приложения hello в режиме только для чтения.</span><span class="sxs-lookup"><span data-stu-id="ef11a-204">toohandle these errors, you can apply a metric toothese requests – such as 10 failures in a row – and when your threshold is met, switch hello application into read-only mode.</span></span> <span data-ttu-id="ef11a-205">Можно использовать такие же методы, возвращающие режим tooupdate как описанных ниже в следующем разделе hello о шаблоне Размыкатель цепи hello hello.</span><span class="sxs-lookup"><span data-stu-id="ef11a-205">You can use hello same methods for returning tooupdate mode as those described below in hello next section about hello Circuit Breaker pattern.</span></span>

## <a name="circuit-breaker-pattern"></a><span data-ttu-id="ef11a-206">Шаблон автоматического выключения</span><span class="sxs-lookup"><span data-stu-id="ef11a-206">Circuit Breaker pattern</span></span>

<span data-ttu-id="ef11a-207">С помощью шаблона Размыкатель цепи hello в приложении можно запретить его повторной попытки выполнения операции, скорее всего, toofail несколько раз.</span><span class="sxs-lookup"><span data-stu-id="ef11a-207">Using hello Circuit Breaker pattern in your application can prevent it from retrying an operation that is likely toofail repeatedly.</span></span> <span data-ttu-id="ef11a-208">Она позволяет toorun toocontinue приложения hello, а не занимают время, пока операция hello повторяется экспоненциально.</span><span class="sxs-lookup"><span data-stu-id="ef11a-208">It allows hello application toocontinue toorun rather than taking up time while hello operation is retried exponentially.</span></span> <span data-ttu-id="ef11a-209">Также обнаруживает ошибку hello была исправлена, по которому приложение hello времени можно попытку hello.</span><span class="sxs-lookup"><span data-stu-id="ef11a-209">It also detects when hello fault has been fixed, at which time hello application can try hello operation again.</span></span>

### <a name="how-tooimplement-hello-circuit-breaker-pattern"></a><span data-ttu-id="ef11a-210">Как tooimplement hello шаблон Размыкатель цепи</span><span class="sxs-lookup"><span data-stu-id="ef11a-210">How tooimplement hello circuit breaker pattern</span></span>

<span data-ttu-id="ef11a-211">tooidentify наличие постоянная проблема с основную конечную точку, можно отслеживать, как часто клиент hello возникли ошибки при возможности повторной попытки.</span><span class="sxs-lookup"><span data-stu-id="ef11a-211">tooidentify that there is an ongoing problem with a primary endpoint, you can monitor how frequently hello client encounters retryable errors.</span></span> <span data-ttu-id="ef11a-212">Поскольку каждый вариант отличается, у вас есть toodecide на пороговое значение hello toouse для hello решение tooswitch toohello вторичной конечной точки и запустите приложение hello в режиме только для чтения.</span><span class="sxs-lookup"><span data-stu-id="ef11a-212">Because each case is different, you have toodecide on hello threshold you want toouse for hello decision tooswitch toohello secondary endpoint and run hello application in read-only mode.</span></span> <span data-ttu-id="ef11a-213">Например можно принять решение коммутатора hello tooperform случае в строке нет успешных 10 сбоев.</span><span class="sxs-lookup"><span data-stu-id="ef11a-213">For example, you could decide tooperform hello switch if there are 10 failures in a row with no successes.</span></span> <span data-ttu-id="ef11a-214">Другой пример — tooswitch при сбое 90% hello запросов в течение 2 минут.</span><span class="sxs-lookup"><span data-stu-id="ef11a-214">Another example is tooswitch if 90% of hello requests in a 2-minute period fail.</span></span>

<span data-ttu-id="ef11a-215">Для первого сценария hello можно просто вести счетчик сбоев hello и при наличии до достижения успеха hello задней toozero hello, необходимо задать максимальное число.</span><span class="sxs-lookup"><span data-stu-id="ef11a-215">For hello first scenario, you can simply keep a count of hello failures, and if there is a success before reaching hello maximum, set hello count back toozero.</span></span> <span data-ttu-id="ef11a-216">Для второй сценарий hello одним из способов tooimplement это toouse hello объекта MemoryCache (в .NET).</span><span class="sxs-lookup"><span data-stu-id="ef11a-216">For hello second scenario, one way tooimplement it is toouse hello MemoryCache object (in .NET).</span></span> <span data-ttu-id="ef11a-217">Для каждого запроса добавления кэша toohello CacheItem, задайте значение hello toosuccess (1) или сбой (0) и задание минут too2 времени истечения срока действия hello с теперь (или что там ограничение времени).</span><span class="sxs-lookup"><span data-stu-id="ef11a-217">For each request, add a CacheItem toohello cache, set hello value toosuccess (1) or fail (0), and set hello expiration time too2 minutes from now (or whatever your time constraint is).</span></span> <span data-ttu-id="ef11a-218">По истечении времени истечения срока действия записи hello запись автоматически удаляется.</span><span class="sxs-lookup"><span data-stu-id="ef11a-218">When an entry's expiration time is reached, hello entry is automatically removed.</span></span> <span data-ttu-id="ef11a-219">Это обеспечит скользящее окно в 2 минуты.</span><span class="sxs-lookup"><span data-stu-id="ef11a-219">This will give you a rolling 2-minute window.</span></span> <span data-ttu-id="ef11a-220">Каждый раз при внесении в службу хранилища toohello запрос, сначала используется запрос Linq через hello MemoryCache объекта toocalculate hello процент успешных операций путем суммирования значений hello hello count.</span><span class="sxs-lookup"><span data-stu-id="ef11a-220">Each time you make a request toohello storage service, you first use a Linq query across hello MemoryCache object toocalculate hello percent success by summing hello values and dividing by hello count.</span></span> <span data-ttu-id="ef11a-221">Если процент успешных операций hello становится меньше некоторое пороговое значение (например, 10%), задать hello **LocationMode** свойство для чтения запросов слишком**SecondaryOnly** и переключение приложения hello в режиме только для чтения, прежде чем Продолжение.</span><span class="sxs-lookup"><span data-stu-id="ef11a-221">When hello percent success drops below some threshold (such as 10%), set hello **LocationMode** property for read requests too**SecondaryOnly** and switch hello application into read-only mode before continuing.</span></span>

<span data-ttu-id="ef11a-222">Порог ошибок, произошедших Hello используется toodetermine при toomake hello коммутатор может отличаться от tooservice службы в приложении, это следует учитывать, что их можно настроить параметры.</span><span class="sxs-lookup"><span data-stu-id="ef11a-222">hello threshold of errors used toodetermine when toomake hello switch may vary from service tooservice in your application, so you should consider making them configurable parameters.</span></span> <span data-ttu-id="ef11a-223">Это также где решить повторяемая ошибки toohandle из каждой службы, отдельно или как один, как описано выше.</span><span class="sxs-lookup"><span data-stu-id="ef11a-223">This is also where you decide toohandle retryable errors from each service separately or as one, as discussed previously.</span></span>

<span data-ttu-id="ef11a-224">Другой аспект — как toohandle несколько экземпляров приложения и какие toodo при обнаружении ошибки, допускающей повторение попытки в каждом экземпляре.</span><span class="sxs-lookup"><span data-stu-id="ef11a-224">Another consideration is how toohandle multiple instances of an application, and what toodo when you detect retryable errors in each instance.</span></span> <span data-ttu-id="ef11a-225">Например имеется 20 виртуальных машин, работающих с hello загрузки того же приложения.</span><span class="sxs-lookup"><span data-stu-id="ef11a-225">For example, you may have 20 VMs running with hello same application loaded.</span></span> <span data-ttu-id="ef11a-226">Каждый экземпляр будет обрабатываться отдельно?</span><span class="sxs-lookup"><span data-stu-id="ef11a-226">Do you handle each instance separately?</span></span> <span data-ttu-id="ef11a-227">Если один экземпляр начинается возникают проблемы, действительно toojust ответ toolimit hello, один экземпляр или вы хотите tootry toohave все экземпляры ответ в hello таким же, каким образом в том случае, когда один экземпляр возникла проблема?</span><span class="sxs-lookup"><span data-stu-id="ef11a-227">If one instance starts having problems, do you want toolimit hello response toojust that one instance, or do you want tootry toohave all instances respond in hello same way when one instance has a problem?</span></span> <span data-ttu-id="ef11a-228">Обработка экземпляров hello отдельно гораздо проще, чем toocoordinate hello ответа между ними, но способ определения зависит от архитектуры приложения.</span><span class="sxs-lookup"><span data-stu-id="ef11a-228">Handling hello instances separately is much simpler than trying toocoordinate hello response across them, but how you do this depends on your application's architecture.</span></span>

### <a name="options-for-monitoring-hello-error-frequency"></a><span data-ttu-id="ef11a-229">Средства наблюдения за частоты ошибок hello</span><span class="sxs-lookup"><span data-stu-id="ef11a-229">Options for monitoring hello error frequency</span></span>

<span data-ttu-id="ef11a-230">У вас есть три основные параметры для мониторинга hello частоту повторов в первичном регионе hello в порядке toodetermine при tooswitch над toohello дополнительный регион и изменение hello toorun приложения в режиме только для чтения.</span><span class="sxs-lookup"><span data-stu-id="ef11a-230">You have three main options for monitoring hello frequency of retries in hello primary region in order toodetermine when tooswitch over toohello secondary region and change hello application toorun in read-only mode.</span></span>

*   <span data-ttu-id="ef11a-231">Добавление обработчика для hello [ **Повтор** ](http://msdn.microsoft.com/en-us/library/microsoft.windowsazure.storage.operationcontext.retrying.aspx) события hello [ **OperationContext** ](http://msdn.microsoft.com/en-us/library/microsoft.windowsazure.storage.operationcontext.aspx) объекта передачи запросов хранилища tooyour — в данном случае hello метод отображается в этой статье и используется в сообщения, сопровождающие образец hello.</span><span class="sxs-lookup"><span data-stu-id="ef11a-231">Add a handler for hello [**Retrying**](http://msdn.microsoft.com/en-us/library/microsoft.windowsazure.storage.operationcontext.retrying.aspx) event on hello [**OperationContext**](http://msdn.microsoft.com/en-us/library/microsoft.windowsazure.storage.operationcontext.aspx) object you pass tooyour storage requests – this is hello method displayed in this article and used in hello accompanying sample.</span></span> <span data-ttu-id="ef11a-232">Эти события возникают всякий раз, когда клиент hello пытается выполнить запрос, позволяя tootrack как часто клиент hello обнаруживает повторяемая ошибки на основную конечную точку.</span><span class="sxs-lookup"><span data-stu-id="ef11a-232">These events fire whenever hello client retries a request, enabling you tootrack how often hello client encounters retryable errors on a primary endpoint.</span></span>

    ```csharp 
    operationContext.Retrying += (sender, arguments) =>
    {
        // Retrying in hello primary region
        if (arguments.Request.Host == primaryhostname)
            ...
    };
    ```

*   <span data-ttu-id="ef11a-233">В hello [ **Evaluate** ](http://msdn.microsoft.com/en-us/library/microsoft.windowsazure.storage.retrypolicies.iextendedretrypolicy.evaluate.aspx) метод в пользовательскую политику повторения можно выполнять пользовательский код каждый раз, когда выполняется повторная попытка.</span><span class="sxs-lookup"><span data-stu-id="ef11a-233">In hello [**Evaluate**](http://msdn.microsoft.com/en-us/library/microsoft.windowsazure.storage.retrypolicies.iextendedretrypolicy.evaluate.aspx) method in a custom retry policy, you can run custom code whenever a retry takes place.</span></span> <span data-ttu-id="ef11a-234">В дополнение toorecording, когда происходит повторная попытка, это также дает возможности toomodify hello поведение повторных попыток.</span><span class="sxs-lookup"><span data-stu-id="ef11a-234">In addition toorecording when a retry happens, this also gives you hello opportunity toomodify your retry behavior.</span></span>

    ```csharp 
    public RetryInfo Evaluate(RetryContext retryContext,
    OperationContext operationContext)
    {
        var statusCode = retryContext.LastRequestResult.HttpStatusCode;
        if (retryContext.CurrentRetryCount >= this.maximumAttempts
        || ((statusCode &gt;= 300 && statusCode &lt; 500 && statusCode != 408)
        || statusCode == 501 // Not Implemented
        || statusCode == 505 // Version Not Supported
            ))
        {
        // Do not retry
            return null;
        }

        // Monitor retries in hello primary location
        ...

        // Determine RetryInterval and TargetLocation
        RetryInfo info =
            CreateRetryInfo(retryContext.CurrentRetryCount);

        return info;
    }
    ```

*   <span data-ttu-id="ef11a-235">Hello третий способ — tooimplement пользовательского компонента мониторинга в приложении, которое постоянно опрашивает ваш конечная точка основного хранилища с фиктивным прочитать его работоспособности toodetermine запросов (таких как чтение небольших больших двоичных объектов).</span><span class="sxs-lookup"><span data-stu-id="ef11a-235">hello third approach is tooimplement a custom monitoring component in your application that continually pings your primary storage endpoint with dummy read requests (such as reading a small blob) toodetermine its health.</span></span> <span data-ttu-id="ef11a-236">Это может потребовать какое-то количество ресурсов, но не значительное.</span><span class="sxs-lookup"><span data-stu-id="ef11a-236">This would take up some resources, but not a significant amount.</span></span> <span data-ttu-id="ef11a-237">При обнаружении проблемы, который достигает порог, которые затем выполняются коммутатора hello слишком**SecondaryOnly** и только для чтения.</span><span class="sxs-lookup"><span data-stu-id="ef11a-237">When a problem is discovered that reaches your threshold, you would then perform hello switch too**SecondaryOnly** and read-only mode.</span></span>

<span data-ttu-id="ef11a-238">На некотором этапе может потребоваться назад toousing tooswitch hello основную конечную точку и разрешение обновлений.</span><span class="sxs-lookup"><span data-stu-id="ef11a-238">At some point, you will want tooswitch back toousing hello primary endpoint and allowing updates.</span></span> <span data-ttu-id="ef11a-239">Если используется один из перечисленных выше первые два метода hello, можно просто переключиться назад toohello основную конечную точку и включите режим обновления после выполнения произвольно выбранного периода времени или несколько операций.</span><span class="sxs-lookup"><span data-stu-id="ef11a-239">If using one of hello first two methods listed above, you could simply switch back toohello primary endpoint and enable update mode after an arbitrarily selected amount of time or number of operations has been performed.</span></span> <span data-ttu-id="ef11a-240">Затем можно его пройти hello логику повторных попыток.</span><span class="sxs-lookup"><span data-stu-id="ef11a-240">You can then let it go through hello retry logic again.</span></span> <span data-ttu-id="ef11a-241">Если hello проблема была исправлена, оно основную конечную точку hello toouse продолжить и разрешить обновления.</span><span class="sxs-lookup"><span data-stu-id="ef11a-241">If hello problem has been fixed, it will continue toouse hello primary endpoint and allow updates.</span></span> <span data-ttu-id="ef11a-242">Если проблема остается, он еще раз переключается назад toohello вторичной конечной точки и только для чтения после сбоя hello критерии, которые заданы.</span><span class="sxs-lookup"><span data-stu-id="ef11a-242">If there is still a problem, it will once more switch back toohello secondary endpoint and read-only mode after failing hello criteria you've set.</span></span>

<span data-ttu-id="ef11a-243">Для третьего сценария hello, когда обмен пакетами конечная точка основного хранилища hello становится успешно снова, вы можете активировать вернуться к использованию hello слишком**PrimaryOnly** и продолжить разрешение обновлений.</span><span class="sxs-lookup"><span data-stu-id="ef11a-243">For hello third scenario, when pinging hello primary storage endpoint becomes successful again, you can trigger hello switch back too**PrimaryOnly** and continue allowing updates.</span></span>

## <a name="handling-eventually-consistent-data"></a><span data-ttu-id="ef11a-244">Обработка данных, согласованных в конечном счете</span><span class="sxs-lookup"><span data-stu-id="ef11a-244">Handling eventually consistent data</span></span>

<span data-ttu-id="ef11a-245">RA-GRS работает путем репликации транзакции из вторичного региона основной toohello hello.</span><span class="sxs-lookup"><span data-stu-id="ef11a-245">RA-GRS works by replicating transactions from hello primary toohello secondary region.</span></span> <span data-ttu-id="ef11a-246">Репликация обеспечивает hello данные в дополнительный регион hello *согласованным*.</span><span class="sxs-lookup"><span data-stu-id="ef11a-246">This replication process guarantees that hello data in hello secondary region is *eventually consistent*.</span></span> <span data-ttu-id="ef11a-247">Это означает, что все транзакции hello в основном регионе hello в конечном счете будут отображаться в дополнительный регион hello, но что возможна задержка до их появления, а что нет никакой гарантии hello транзакции поступают в дополнительный регион hello в же порядка следования hello в котором они были первоначально применены в основном регионе hello.</span><span class="sxs-lookup"><span data-stu-id="ef11a-247">This means that all hello transactions in hello primary region will eventually appear in hello secondary region, but that there may be a lag before they appear, and that there is no guarantee hello transactions arrive in hello secondary region in hello same order as that in which they were originally applied in hello primary region.</span></span> <span data-ttu-id="ef11a-248">Если в транзакциях поступают в дополнительный регион hello не по порядку, вы *может* рассмотрите возможность данные в toobe hello дополнительный регион в несогласованном состоянии, пока захватывается hello службы.</span><span class="sxs-lookup"><span data-stu-id="ef11a-248">If your transactions arrive in hello secondary region out of order, you *may* consider your data in hello secondary region toobe in an inconsistent state until hello service catches up.</span></span>

<span data-ttu-id="ef11a-249">Hello следующей таблице показан пример что может произойти при обновлении hello подробные сведения о сотрудниках toomake ей членом hello *Администраторы* роли.</span><span class="sxs-lookup"><span data-stu-id="ef11a-249">hello following table shows an example of what might happen when you update hello details of an employee toomake her a member of hello *administrators* role.</span></span> <span data-ttu-id="ef11a-250">Ради hello в этом примере для этого необходимо обновить hello **сотрудника** сущности и обновление **роли администратора** сущности с количеством hello общее число администраторов.</span><span class="sxs-lookup"><span data-stu-id="ef11a-250">For hello sake of this example, this requires you update hello **employee** entity and update an **administrator role** entity with a count of hello total number of administrators.</span></span> <span data-ttu-id="ef11a-251">Обратите внимание на то, как hello обновления применяются по порядку в дополнительный регион hello.</span><span class="sxs-lookup"><span data-stu-id="ef11a-251">Notice how hello updates are applied out of order in hello secondary region.</span></span>

| <span data-ttu-id="ef11a-252">**Время**</span><span class="sxs-lookup"><span data-stu-id="ef11a-252">**Time**</span></span> | <span data-ttu-id="ef11a-253">**Транзакция**</span><span class="sxs-lookup"><span data-stu-id="ef11a-253">**Transaction**</span></span>                                            | <span data-ttu-id="ef11a-254">**Репликация**</span><span class="sxs-lookup"><span data-stu-id="ef11a-254">**Replication**</span></span>                       | <span data-ttu-id="ef11a-255">**Last Sync Time**</span><span class="sxs-lookup"><span data-stu-id="ef11a-255">**Last Sync Time**</span></span> | <span data-ttu-id="ef11a-256">**Результат**</span><span class="sxs-lookup"><span data-stu-id="ef11a-256">**Result**</span></span> |
|----------|------------------------------------------------------------|---------------------------------------|--------------------|------------| 
| <span data-ttu-id="ef11a-257">T0</span><span class="sxs-lookup"><span data-stu-id="ef11a-257">T0</span></span>       | <span data-ttu-id="ef11a-258">Транзакция А:</span><span class="sxs-lookup"><span data-stu-id="ef11a-258">Transaction A:</span></span> <br> <span data-ttu-id="ef11a-259">вставка сущности</span><span class="sxs-lookup"><span data-stu-id="ef11a-259">Insert employee</span></span> <br> <span data-ttu-id="ef11a-260">сотрудника в основном регионе.</span><span class="sxs-lookup"><span data-stu-id="ef11a-260">entity in primary</span></span> |                                   |                    | <span data-ttu-id="ef11a-261">Транзакция А вставлены tooprimary,</span><span class="sxs-lookup"><span data-stu-id="ef11a-261">Transaction A inserted tooprimary,</span></span><br> <span data-ttu-id="ef11a-262">но еще не реплицирована.</span><span class="sxs-lookup"><span data-stu-id="ef11a-262">not replicated yet.</span></span> |
| <span data-ttu-id="ef11a-263">T1</span><span class="sxs-lookup"><span data-stu-id="ef11a-263">T1</span></span>       |                                                            | <span data-ttu-id="ef11a-264">Транзакция А</span><span class="sxs-lookup"><span data-stu-id="ef11a-264">Transaction A</span></span> <br> <span data-ttu-id="ef11a-265">реплицирована в</span><span class="sxs-lookup"><span data-stu-id="ef11a-265">replicated to</span></span><br> <span data-ttu-id="ef11a-266">дополнительный регион.</span><span class="sxs-lookup"><span data-stu-id="ef11a-266">secondary</span></span> | <span data-ttu-id="ef11a-267">T1</span><span class="sxs-lookup"><span data-stu-id="ef11a-267">T1</span></span> | <span data-ttu-id="ef11a-268">Транзакция А реплицируются toosecondary.</span><span class="sxs-lookup"><span data-stu-id="ef11a-268">Transaction A replicated toosecondary.</span></span> <br><span data-ttu-id="ef11a-269">Значение Last Sync Time обновлено.</span><span class="sxs-lookup"><span data-stu-id="ef11a-269">Last Sync Time updated.</span></span>    |
| <span data-ttu-id="ef11a-270">T2</span><span class="sxs-lookup"><span data-stu-id="ef11a-270">T2</span></span>       | <span data-ttu-id="ef11a-271">Транзакция Б:</span><span class="sxs-lookup"><span data-stu-id="ef11a-271">Transaction B:</span></span><br><span data-ttu-id="ef11a-272">Блокировка изменений</span><span class="sxs-lookup"><span data-stu-id="ef11a-272">Update</span></span><br> <span data-ttu-id="ef11a-273">обновление сущности сотрудника</span><span class="sxs-lookup"><span data-stu-id="ef11a-273">employee entity</span></span><br> <span data-ttu-id="ef11a-274">в основном регионе.</span><span class="sxs-lookup"><span data-stu-id="ef11a-274">in primary</span></span>  |                                | <span data-ttu-id="ef11a-275">T1</span><span class="sxs-lookup"><span data-stu-id="ef11a-275">T1</span></span>                 | <span data-ttu-id="ef11a-276">Транзакция Б, записанных tooprimary,</span><span class="sxs-lookup"><span data-stu-id="ef11a-276">Transaction B written tooprimary,</span></span><br> <span data-ttu-id="ef11a-277">но еще не реплицирована.</span><span class="sxs-lookup"><span data-stu-id="ef11a-277">not replicated yet.</span></span>  |
| <span data-ttu-id="ef11a-278">T3</span><span class="sxs-lookup"><span data-stu-id="ef11a-278">T3</span></span>       | <span data-ttu-id="ef11a-279">Транзакция В:</span><span class="sxs-lookup"><span data-stu-id="ef11a-279">Transaction C:</span></span><br> <span data-ttu-id="ef11a-280">Блокировка изменений</span><span class="sxs-lookup"><span data-stu-id="ef11a-280">Update</span></span> <br><span data-ttu-id="ef11a-281">administrator</span><span class="sxs-lookup"><span data-stu-id="ef11a-281">administrator</span></span><br><span data-ttu-id="ef11a-282">сущности роли в</span><span class="sxs-lookup"><span data-stu-id="ef11a-282">role entity in</span></span><br><span data-ttu-id="ef11a-283">primary</span><span class="sxs-lookup"><span data-stu-id="ef11a-283">primary</span></span> |                    | <span data-ttu-id="ef11a-284">T1</span><span class="sxs-lookup"><span data-stu-id="ef11a-284">T1</span></span>                 | <span data-ttu-id="ef11a-285">Транзакции записываются tooprimary, C</span><span class="sxs-lookup"><span data-stu-id="ef11a-285">Transaction C written tooprimary,</span></span><br> <span data-ttu-id="ef11a-286">но еще не реплицирована.</span><span class="sxs-lookup"><span data-stu-id="ef11a-286">not replicated yet.</span></span>  |
| <span data-ttu-id="ef11a-287">*T4*</span><span class="sxs-lookup"><span data-stu-id="ef11a-287">*T4*</span></span>     |                                                       | <span data-ttu-id="ef11a-288">Транзакция В</span><span class="sxs-lookup"><span data-stu-id="ef11a-288">Transaction C</span></span> <br><span data-ttu-id="ef11a-289">реплицирована в</span><span class="sxs-lookup"><span data-stu-id="ef11a-289">replicated to</span></span><br> <span data-ttu-id="ef11a-290">дополнительный регион.</span><span class="sxs-lookup"><span data-stu-id="ef11a-290">secondary</span></span> | <span data-ttu-id="ef11a-291">T1</span><span class="sxs-lookup"><span data-stu-id="ef11a-291">T1</span></span>         | <span data-ttu-id="ef11a-292">Операции C реплицируются toosecondary.</span><span class="sxs-lookup"><span data-stu-id="ef11a-292">Transaction C replicated toosecondary.</span></span><br><span data-ttu-id="ef11a-293">Значение Last Sync Time не обновлено, так как</span><span class="sxs-lookup"><span data-stu-id="ef11a-293">LastSyncTime not updated because</span></span> <br><span data-ttu-id="ef11a-294">транзакция Б еще не реплицирована.</span><span class="sxs-lookup"><span data-stu-id="ef11a-294">transaction B has not been replicated yet.</span></span>|
| <span data-ttu-id="ef11a-295">*T5*</span><span class="sxs-lookup"><span data-stu-id="ef11a-295">*T5*</span></span>     | <span data-ttu-id="ef11a-296">Чтение сущностей</span><span class="sxs-lookup"><span data-stu-id="ef11a-296">Read entities</span></span> <br><span data-ttu-id="ef11a-297">из дополнительного региона.</span><span class="sxs-lookup"><span data-stu-id="ef11a-297">from secondary</span></span>                           |                                  | <span data-ttu-id="ef11a-298">T1</span><span class="sxs-lookup"><span data-stu-id="ef11a-298">T1</span></span>                 | <span data-ttu-id="ef11a-299">Получить hello устаревшее значение для сотрудника</span><span class="sxs-lookup"><span data-stu-id="ef11a-299">You get hello stale value for employee</span></span> <br> <span data-ttu-id="ef11a-300">сущности employee, так как транзакция Б</span><span class="sxs-lookup"><span data-stu-id="ef11a-300">entity because transaction B hasn't</span></span> <br> <span data-ttu-id="ef11a-301">еще не реплицирована.</span><span class="sxs-lookup"><span data-stu-id="ef11a-301">replicated yet.</span></span> <span data-ttu-id="ef11a-302">Получить hello новое значение</span><span class="sxs-lookup"><span data-stu-id="ef11a-302">You get hello new value for</span></span><br> <span data-ttu-id="ef11a-303">сущности administrator role, так как</span><span class="sxs-lookup"><span data-stu-id="ef11a-303">administrator role entity because C has</span></span><br> <span data-ttu-id="ef11a-304">транзакция В реплицирована.</span><span class="sxs-lookup"><span data-stu-id="ef11a-304">replicated.</span></span> <span data-ttu-id="ef11a-305">Значение Last Sync Time</span><span class="sxs-lookup"><span data-stu-id="ef11a-305">Last Sync Time still hasn't</span></span><br> <span data-ttu-id="ef11a-306">все еще не обновлено, так как транзакция Б</span><span class="sxs-lookup"><span data-stu-id="ef11a-306">been updated because transaction B</span></span><br> <span data-ttu-id="ef11a-307">не реплицирована.</span><span class="sxs-lookup"><span data-stu-id="ef11a-307">hasn't replicated.</span></span> <span data-ttu-id="ef11a-308">Можно считать сущность</span><span class="sxs-lookup"><span data-stu-id="ef11a-308">You can tell the</span></span><br><span data-ttu-id="ef11a-309">administrator role несогласованной,</span><span class="sxs-lookup"><span data-stu-id="ef11a-309">administrator role entity is inconsistent</span></span> <br><span data-ttu-id="ef11a-310">так как после hello объекта даты и времени</span><span class="sxs-lookup"><span data-stu-id="ef11a-310">because hello entity date/time is after</span></span> <br><span data-ttu-id="ef11a-311">Здравствуйте, время последней синхронизации.</span><span class="sxs-lookup"><span data-stu-id="ef11a-311">hello Last Sync Time.</span></span> |
| <span data-ttu-id="ef11a-312">*T6*</span><span class="sxs-lookup"><span data-stu-id="ef11a-312">*T6*</span></span>     |                                                      | <span data-ttu-id="ef11a-313">Транзакция Б</span><span class="sxs-lookup"><span data-stu-id="ef11a-313">Transaction B</span></span><br> <span data-ttu-id="ef11a-314">реплицирована в</span><span class="sxs-lookup"><span data-stu-id="ef11a-314">replicated to</span></span><br> <span data-ttu-id="ef11a-315">дополнительный регион.</span><span class="sxs-lookup"><span data-stu-id="ef11a-315">secondary</span></span> | <span data-ttu-id="ef11a-316">T6</span><span class="sxs-lookup"><span data-stu-id="ef11a-316">T6</span></span>                 | <span data-ttu-id="ef11a-317">*T6* — всех транзакции вплоть до В</span><span class="sxs-lookup"><span data-stu-id="ef11a-317">*T6* – All transactions through C have</span></span> <br><span data-ttu-id="ef11a-318">реплицированы, значение Last Sync Time</span><span class="sxs-lookup"><span data-stu-id="ef11a-318">been replicated, Last Sync Time</span></span><br> <span data-ttu-id="ef11a-319">обновлено.</span><span class="sxs-lookup"><span data-stu-id="ef11a-319">is updated.</span></span> |

<span data-ttu-id="ef11a-320">В этом примере предполагается tooreading коммутаторы hello клиента из вторичного региона hello в T5.</span><span class="sxs-lookup"><span data-stu-id="ef11a-320">In this example, assume hello client switches tooreading from hello secondary region at T5.</span></span> <span data-ttu-id="ef11a-321">Успешно прочитать hello **роли администратора** сущности в данный момент, но hello объекта содержит значение для hello число администраторов, не согласуется с количеством hello **сотрудника** сущностей в настоящее время, которые помечены как администраторов в дополнительный регион hello.</span><span class="sxs-lookup"><span data-stu-id="ef11a-321">It can successfully read hello **administrator role** entity at this time, but hello entity contains a value for hello count of administrators that is not consistent with hello number of **employee** entities that are marked as administrators in hello secondary region at this time.</span></span> <span data-ttu-id="ef11a-322">Клиент может просто отобразить это значение с hello риск, что это несогласованные данные.</span><span class="sxs-lookup"><span data-stu-id="ef11a-322">Your client could simply display this value, with hello risk that it is inconsistent information.</span></span> <span data-ttu-id="ef11a-323">Кроме того, hello клиент может попытаться toodetermine, hello **роли администратора** находится в состоянии несовместимости, поскольку обновления hello произойти не по порядку и уведомите пользователя hello этого факта.</span><span class="sxs-lookup"><span data-stu-id="ef11a-323">Alternatively, hello client could attempt toodetermine that hello **administrator role** is in a potentially inconsistent state because hello updates have happened out of order, and then inform hello user of this fact.</span></span>

<span data-ttu-id="ef11a-324">toorecognize при наличии потенциально несогласованности данных, hello клиент может использовать значение hello hello *время последней синхронизации* получить в любое время с помощью запроса к службе хранения.</span><span class="sxs-lookup"><span data-stu-id="ef11a-324">toorecognize that it has potentially inconsistent data, hello client can use hello value of hello *Last Sync Time* that you can get at any time by querying a storage service.</span></span> <span data-ttu-id="ef11a-325">Это значит hello время, время последнего hello данные в дополнительный регион hello согласованное и когда hello службы был применен все hello точки предыдущего toothat транзакции времени.</span><span class="sxs-lookup"><span data-stu-id="ef11a-325">This tells you hello time when hello data in hello secondary region was last consistent and when hello service had applied all hello transactions prior toothat point in time.</span></span> <span data-ttu-id="ef11a-326">В примере hello, показанном выше, после обновления hello вставок hello **сотрудника** сущности в дополнительный регион hello hello время последней синхронизации задано слишком*T1*.</span><span class="sxs-lookup"><span data-stu-id="ef11a-326">In hello example shown above, after hello service inserts hello **employee** entity in hello secondary region, hello last sync time is set too*T1*.</span></span> <span data-ttu-id="ef11a-327">Остается на *T1* до обновления службы hello hello **сотрудника** сущности в дополнительный регион hello, если он установлен слишком*T6*.</span><span class="sxs-lookup"><span data-stu-id="ef11a-327">It remains at *T1* until hello service updates hello **employee** entity in hello secondary region when it is set too*T6*.</span></span> <span data-ttu-id="ef11a-328">Если клиент hello получает hello чтением hello объекта во время последней синхронизации *T5*, его можно сравнить с меткой времени hello hello сущности.</span><span class="sxs-lookup"><span data-stu-id="ef11a-328">If hello client retrieves hello last sync time when it reads hello entity at *T5*, it can compare it with hello timestamp on hello entity.</span></span> <span data-ttu-id="ef11a-329">Если отметки времени hello сущности hello позже hello время последней синхронизации, а затем hello сущность является потенциально несогласованное состояние на, а может занять все, что является hello необходимые действия для приложения.</span><span class="sxs-lookup"><span data-stu-id="ef11a-329">If hello timestamp on hello entity is later than hello last sync time, then hello entity is in a potentially inconsistent state, and you can take whatever is hello appropriate action for your application.</span></span> <span data-ttu-id="ef11a-330">С помощью этого поля требуется знать завершения hello последнего обновления toohello первичной.</span><span class="sxs-lookup"><span data-stu-id="ef11a-330">Using this field requires that you know when hello last update toohello primary was completed.</span></span>

## <a name="testing"></a><span data-ttu-id="ef11a-331">Тестирование</span><span class="sxs-lookup"><span data-stu-id="ef11a-331">Testing</span></span>

<span data-ttu-id="ef11a-332">Это важные tootest поведения приложения должным образом при обнаружении ошибки, допускающей повторение попытки.</span><span class="sxs-lookup"><span data-stu-id="ef11a-332">It's important tootest that your application behaves as expected when it encounters retryable errors.</span></span> <span data-ttu-id="ef11a-333">Например потребуется tootest, hello toohello коммутаторы приложение получателей, и в режиме только для чтения после обнаруживает проблему, и возвращается при первичном регионе hello снова становится доступным.</span><span class="sxs-lookup"><span data-stu-id="ef11a-333">For example, you need tootest that hello application switches toohello secondary and into read-only mode when it detects a problem, and switches back when hello primary region becomes available again.</span></span> <span data-ttu-id="ef11a-334">toodo это, нужно ошибки, допускающей повторение попытки способом toosimulate и контролировать, как часто они встречаются.</span><span class="sxs-lookup"><span data-stu-id="ef11a-334">toodo this, you need a way toosimulate retryable errors and control how often they occur.</span></span>

<span data-ttu-id="ef11a-335">Можно использовать [Fiddler](http://www.telerik.com/fiddler) toointercept и изменить HTTP-ответов в скрипте.</span><span class="sxs-lookup"><span data-stu-id="ef11a-335">You can use [Fiddler](http://www.telerik.com/fiddler) toointercept and modify HTTP responses in a script.</span></span> <span data-ttu-id="ef11a-336">Этот скрипт можно определить ответов, полученных от первичной конечной точки и изменение tooone код состояния HTTP hello приветствия, клиентская библиотека хранилища распознает как Повторяемая ошибка.</span><span class="sxs-lookup"><span data-stu-id="ef11a-336">This script can identify responses that come from your primary endpoint and change hello HTTP status code tooone that hello Storage Client Library recognizes as a retryable error.</span></span> <span data-ttu-id="ef11a-337">Этот фрагмент кода показан простой пример Fiddler скрипта, который перехватывает запросы tooread ответы на основе hello **employeedata** tooreturn таблицы 502 состояния:</span><span class="sxs-lookup"><span data-stu-id="ef11a-337">This code snippet shows a simple example of a Fiddler script that intercepts responses tooread requests against hello **employeedata** table tooreturn a 502 status:</span></span>

```java
static function OnBeforeResponse(oSession: Session) {
    ...
    if ((oSession.hostname == "\[yourstorageaccount\].table.core.windows.net")
      && (oSession.PathAndQuery.StartsWith("/employeedata?$filter"))) {
        oSession.responseCode = 502;
    }
}
```

<span data-ttu-id="ef11a-338">Можно расширить этот пример toointercept более широкого круга запросов и изменять только hello **responseCode** на некоторые из них toobetter имитировать реальном сценарии.</span><span class="sxs-lookup"><span data-stu-id="ef11a-338">You could extend this example toointercept a wider range of requests and only change hello **responseCode** on some of them toobetter simulate a real-world scenario.</span></span> <span data-ttu-id="ef11a-339">Дополнительные сведения о настройке Fiddler скриптов см. в разделе [изменения запроса или ответа](http://docs.telerik.com/fiddler/KnowledgeBase/FiddlerScript/ModifyRequestOrResponse) в hello Fiddler документации.</span><span class="sxs-lookup"><span data-stu-id="ef11a-339">For more information about customizing Fiddler scripts, see [Modifying a Request or Response](http://docs.telerik.com/fiddler/KnowledgeBase/FiddlerScript/ModifyRequestOrResponse) in hello Fiddler documentation.</span></span>

<span data-ttu-id="ef11a-340">При внесении hello пороговые значения для вашего приложения tooread режиме можно настроить переключение будет проще поведение hello tootest с объемами транзакций нерабочей.</span><span class="sxs-lookup"><span data-stu-id="ef11a-340">If you have made hello thresholds for switching your application tooread-only mode configurable, it will be easier tootest hello behavior with non-production transaction volumes.</span></span>

## <a name="next-steps"></a><span data-ttu-id="ef11a-341">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="ef11a-341">Next Steps</span></span>

* <span data-ttu-id="ef11a-342">Дополнительные сведения о доступ на чтение географической избыточности, включая настроек hello LastSyncTime, еще один пример см. в разделе [параметры избыточности хранилища Windows Azure и доступ для чтения Geo Redundant Storage](https://blogs.msdn.microsoft.com/windowsazurestorage/2013/12/11/windows-azure-storage-redundancy-options-and-read-access-geo-redundant-storage/).</span><span class="sxs-lookup"><span data-stu-id="ef11a-342">For more information about Read Access Geo-Redundancy, including another example of how hello LastSyncTime is set, please see [Windows Azure Storage Redundancy Options and Read Access Geo Redundant Storage](https://blogs.msdn.microsoft.com/windowsazurestorage/2013/12/11/windows-azure-storage-redundancy-options-and-read-access-geo-redundant-storage/).</span></span>

* <span data-ttu-id="ef11a-343">Полный пример, показывающий, как toomake hello коммутатора вперед и назад между конечными точками hello первичной и вторичной, см. в разделе [образцы Azure — с помощью шаблона Размыкателя цепи hello с хранилищем RA-GRS](https://github.com/Azure-Samples/storage-dotnet-circuit-breaker-pattern-ha-apps-using-ra-grs).</span><span class="sxs-lookup"><span data-stu-id="ef11a-343">For a complete sample showing how toomake hello switch back and forth between hello Primary and Secondary endpoints, please see [Azure Samples – Using hello Circuit Breaker Pattern with RA-GRS storage](https://github.com/Azure-Samples/storage-dotnet-circuit-breaker-pattern-ha-apps-using-ra-grs).</span></span>
