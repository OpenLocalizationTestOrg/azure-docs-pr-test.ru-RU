---
title: "aaaTroubleshooting хранилища Azure с помощью диагностики и анализатор сообщений | Документы Microsoft"
description: "Учебник, демонстрирующий комплексное устранение неполадок с помощью аналитики хранилища Azure, AzCopy и анализатора сообщений Майкрософт"
services: storage
documentationcenter: dotnet
author: robinsh
manager: timlt
ms.assetid: 643372a3-1c07-4e88-b4ef-042512a43086
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 03/15/2017
ms.author: robinsh
ms.openlocfilehash: f0b7886911c35de1fdc0bcbe6f83c220ddb38cf5
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="end-to-end-troubleshooting-using-azure-storage-metrics-and-logging-azcopy-and-message-analyzer"></a>Комплексный поиск и устранение неполадок с помощью метрик хранилища Azure и ведения журнала, AzCopy и анализатора сообщений
[!INCLUDE [storage-selector-portal-e2e-troubleshooting](../../includes/storage-selector-portal-e2e-troubleshooting.md)]

Диагностика и устранение неполадок является ключевым навыком, необходимым для создания и поддержки клиентских приложений с хранилищем Microsoft Azure. Из-за особенностей toohello распределенного приложения Azure Диагностика и устранение ошибок и проблем с производительностью может быть сложнее, чем в традиционных сред.

В этом учебнике показано как tooidentify определенные ошибки, которые могут повлиять на производительность и устраните эти ошибки от начала до конца с помощью средств, предоставляемых корпорацией Майкрософт и хранилища Azure, в порядке toooptimize hello клиентское приложение.

В этом учебнике содержатся практические исследования сквозного сценария устранения неполадок. Подробное руководство концептуальной tootroubleshooting хранилища Azure, см [монитора, диагностики и устранения неполадок хранилища Microsoft Azure](storage-monitoring-diagnosing-troubleshooting.md).

## <a name="tools-for-troubleshooting-azure-storage-applications"></a>Средства для устранения неполадок приложений хранилища Azure
tootroubleshoot клиентских приложений, использующих хранилище Microsoft Azure, можно использовать сочетание toodetermine средств, когда возникла проблема и может быть причиной проблемы hello какие hello. Вот эти средства.

* **Аналитика службы хранилища Azure**. [Аналитика службы хранилища Azure](/rest/api/storageservices/Storage-Analytics) обеспечивает метрики и ведение журнала для службы хранилища Azure.
  
  * **Метрики службы хранилища** отслеживают метрики транзакций и метрики емкости для учетной записи хранения. С помощью метрик, можно определить, как приложение выполняет соответствующим tooa множество различных мер. В разделе [схема таблицы метрик аналитики хранилища](/rest/api/storageservices/Storage-Analytics-Metrics-Table-Schema) Дополнительные сведения о типах hello метрик под контролем аналитики хранилища.
  * **Ведение журнала хранилища** регистрирует каждый журнал toohello хранилища Azure службы tooa серверных запросов. выполнить Hello журнала отслеживает подробные данные для каждого запроса, включая операции hello hello состояние операции hello и сведения о задержке. В разделе [формат журнала аналитики хранилища](/rest/api/storageservices/Storage-Analytics-Log-Format) Дополнительные сведения о hello данные запросов и ответов, которые записываются журналы toohello аналитикой хранилища.

> [!NOTE]
> Учетные записи хранилища с типом репликации из зоны избыточности хранилища (ZRS) имеют hello показателей или возможность ведения журнала, которые включены в данный момент. 
> 
> 

* **портал Azure**. Можно настроить метрик и ведения журнала для вашей учетной записи в hello [портал Azure](https://portal.azure.com). Можно также просматривать диаграммы и графики, показывающие, как приложение работает со временем и настроить toonotify предупреждения, если приложение выполняет иначе, чем ожидаемым для указанной метрики.
  
    В разделе [отслеживание учетной записи хранилища в hello портал Azure](storage-monitor-storage-account.md) сведения о настройке мониторинга в hello портал Azure.
* **AzCopy**. Журналы сервера для хранилища Azure хранятся в виде больших двоичных объектов, поэтому AzCopy toocopy hello большие двоичные объекты tooa локальный каталог журнала можно использовать для анализа с помощью Microsoft Message Analyzer. В разделе [перенесите данные с помощью служебной программы командной строки AzCopy hello](storage-use-azcopy.md) Дополнительные сведения о AzCopy.
* **Анализатор сообщений (Майкрософт)**. Анализатор сообщений — это средство, который использует файлы журналов и отображает данные журнала в визуальном формате, который позволяет легко toofilter, поиск и группы, которые записываются в журнал в полезные наборы можно использовать tooanalyze ошибок и проблем с производительностью. См. [Руководство по работе с анализатором сообщений (Майкрософт)](http://technet.microsoft.com/library/jj649776.aspx) для получения дополнительных сведений об анализаторе сообщений.

## <a name="about-hello-sample-scenario"></a>О hello образец сценария
В этом учебнике мы рассмотрим сценарий, где метрики службы хранилища Azure указывают на низкий процент успешных операций для приложения, выполняющего обращения к службе хранилища Azure. Здравствуйте, метрику скорости низкий процент успешных операций (показано как **PercentSuccess** в hello [портал Azure](https://portal.azure.com) и в таблицах метрик hello) отслеживает операции, выполнено успешно, но которые возвращают код состояния HTTP, который больше до 299. В файлах журнала хранилища на стороне сервера hello, эти операции записываются с состоянием транзакции **ClientOtherErrors**. Дополнительные сведения о метрика низкий процент успешных операций hello. в разделе [метрики низкий PercentSuccess или аналитика записи журнала операций с состоянием транзакции ClientOtherErrors](storage-monitoring-diagnosing-troubleshooting.md#metrics-show-low-percent-success).

Операции службы хранилища Azure могут возвращать коды состояния HTTP, большие 299 в ходе обычной работы. Но в некоторых случаях эти ошибки указывает, что может быть toooptimize доступ клиентского приложения для более высокую производительность.

В этом сценарии мы обсудим toobe скорость низкий процент успешных операций ничего менее 100%. Можно выбрать другой метрики уровень, тем не менее, в соответствии с потребностями tooyour. Рекомендуется во время тестирования приложения установить допуск базовых показателей для ключевых метрик производительности. Например, на основе тестирования может быть определено, что приложение должно иметь согласованный процент успешных операций, равный 90 % или 85 %. Если данные метрик показывает, что приложение hello уклониться от этого числа, можно выяснить, что могут быть причиной увеличения hello.

Для нашего примера сценария после мы определили, что метрику скорости hello процент успешных операций меньше 100%, мы проверки на наличие ошибок hello hello журналы toofind, вычисляющие корреляцию toohello метрики и использовать их toofigure, что приводит к низкой скоростью процент успешных операций hello. Мы рассмотрим специально ошибки в диапазоне 400 hello. Затем мы подробнее исследуем ошибку 404 (Не найден).

### <a name="some-causes-of-400-range-errors"></a>Некоторые причины ошибок диапазона 400
Hello приведенных ниже примерах показано примерное некоторые ошибки 400 диапазона для запросов в службу хранилища больших двоичных объектов Azure, а также их возможные причины ее возникновения. Любой из этих ошибок, а также ошибки в диапазоне 300 hello и hello 500 диапазон, могут участвовать tooa низкий процент успешных операций.

Обратите внимание, что ниже списки hello далеко не завершена. В разделе [коды состояний и ошибок](http://msdn.microsoft.com/library/azure/dd179382.aspx) в библиотеке MSDN, Дополнительные сведения об общих ошибках хранилища Azure, а также о конкретных tooeach ошибки служб хранилища hello.

**Примеры кода состояния 404 (не найдено)**

Происходит при сбое операции чтения для контейнера или большого двоичного объекта, так как не найдено hello большого двоичного объекта или контейнера.

* Возникает, если контейнер или BLOB-объект был удален другим клиентом до этого запроса.
* Происходит при использовании вызова API, который создает hello контейнера или большого двоичного объекта после проверки того, существует ли. Hello API-интерфейсы CreateIfNotExists сделать HEAD вызовите первый toocheck наличие hello hello контейнера или большого двоичного объекта; Если не существует, возвращается сообщение об ошибке 404 и затем второй PUT вызове toowrite hello контейнера или большого двоичного объекта.

**Примеры кода состояния 409 (конфликт)**

* Возникает, если вы используете toocreate API для создания нового контейнера или большого двоичного объекта, не проверяя наличие и контейнера или BLOB-объект с таким именем уже существует.
* Возникает, если контейнер удаляется, и попытке toocreate новый контейнер с hello одинаковые имена, до завершения операции удаления hello.
* Возникает, если указать аренду контейнера или BLOB-объекта при ее наличии.

**Примеры кода состояния 412 (необходимое условие не выполнено)**

* Происходит, когда не было выполнено hello условию, указанному предикатом условный заголовок.
* Происходит, когда указанный идентификатор аренды hello не соответствует Идентификатору аренды hello hello контейнера или большого двоичного объекта.

## <a name="generate-log-files-for-analysis"></a>Создание файлов журналов для анализа
В этом учебнике мы будем использовать анализатор сообщений toowork с тремя разными типами файлов журнала, несмотря на то, что можно выбрать toowork с одной из них:

* Hello **журнал сервера**, который создается при включении ведения журнала хранилища Azure. Журнал сервера Hello содержит данные о каждой операции при вызове для одной из служб хранилища Azure hello - больших двоичных объектов, очередей, таблицы и файла. Журнал сервера Hello указывает, какая операция была вызвана и какой код состояния: возвращенный, а также другие сведения о hello запроса и ответа.
* Hello **журнала клиента .NET**, который создается при включении ведение журнала на стороне клиента из приложения .NET. Hello клиента журнала содержит подробные сведения о как hello клиент подготавливает hello запрос и получает и обрабатывает ответ hello.
* Hello **журнал трассировки сети HTTP**, который собирает данные о HTTP/HTTPS запроса и ответа данные, включая для операций в службу хранилища Azure. В этом учебнике мы создать сетевую трассировку hello через анализатор сообщений.

### <a name="configure-server-side-logging-and-metrics"></a>Настройка серверных журналов и метрик
Во-первых мы потребуется tooconfigure хранилища Azure журналов и показателей, таким образом, что мы данные из tooanalyze приложения hello клиента. Можно настроить ведение журнала и метрик в различными способами — через hello [портал Azure](https://portal.azure.com), с помощью PowerShell или программно. Подробные сведения о настройке ведения журнала и метрик см. в статье [Включение метрик хранения и просмотр данных метрик](http://msdn.microsoft.com/library/azure/dn782843.aspx) и [Включение ведения журнала хранилища и доступ к данным журнала](http://msdn.microsoft.com/library/azure/dn782840.aspx) на сайте MSDN.

**Через портал Azure hello**

Здравствуйте, tooconfigure журналов и показателей для учетной записи хранилища с помощью [портал Azure](https://portal.azure.com), следуйте инструкциям hello в [отслеживание учетной записи хранилища в hello портал Azure](storage-monitor-storage-account.md).

> [!NOTE]
> Это не возможные tooset минутных метрик с помощью портала Azure hello. Тем не менее рекомендуется установить их для hello целей этого учебника и для диагностики проблем производительности с приложением. Можно задать с помощью PowerShell, как показано ниже, или программно с помощью клиентской библиотеки хранилища hello минутные метрики.
> 
> Обратите внимание, что hello портал Azure не удается отобразить минутные показатели, только для почасовых метрик.
> 
> 

**Через PowerShell**

tooget работы с PowerShell для Azure, в разделе [как tooinstall и настройка Azure PowerShell](/powershell/azure/overview).

1. Используйте hello [Add-AzureAccount](/powershell/module/azure/add-azureaccount?view=azuresmps-3.7.0) tooadd командлет окно PowerShell toohello учетной записи пользователя Azure:
   
    ```powershell
    Add-AzureAccount
    ```

2. В hello **входа в tooMicrosoft Azure** окно, введите адрес электронной почты hello и пароль, связанный с вашей учетной записью. Azure выполняет проверку подлинности и сохраняет hello учетные данные и затем закрывает окно приветствия.
3. Задать hello по умолчанию учетная запись toohello хранилища учетную запись хранилища, используется в учебнике hello путем выполнения этих команд в окне PowerShell hello.
   
    ```powershell
    $SubscriptionName = 'Your subscription name'
    $StorageAccountName = 'yourstorageaccount'
    Set-AzureSubscription -CurrentStorageAccountName $StorageAccountName -SubscriptionName $SubscriptionName
    ```

4. Включите ведение журнала для hello службы BLOB-объектов хранилища.
   
    ```powershell
    Set-AzureStorageServiceLoggingProperty -ServiceType Blob -LoggingOperations Read,Write,Delete -PassThru -RetentionDays 7 -Version 1.0
    ```

5. Включение метрик хранилища для службы BLOB-объектов, чтобы убедиться, что tooset hello **- MetricsType** слишком`Minute`:
   
    ```powershell
    Set-AzureStorageServiceMetricsProperty -ServiceType Blob -MetricsType Minute -MetricsLevel ServiceAndApi -PassThru -RetentionDays 7 -Version 1.0
    ```

### <a name="configure-net-client-side-logging"></a>Настройка ведения журнала на стороне клиента .NET
tooconfigure клиентский ведение журналов для приложений .NET, включение диагностики .NET в файле конфигурации приложения hello (web.config или app.config). . В разделе [ведение журнала, используя hello клиентской библиотеки хранилища .NET на стороне клиента](http://msdn.microsoft.com/library/azure/dn782839.aspx) и [ведение журнала, используя пакет SDK хранилища Microsoft Azure для Java hello на стороне клиента](http://msdn.microsoft.com/library/azure/dn782844.aspx) в MSDN для сведения.

журнала клиентской части Hello содержит подробные сведения о клиентских hello подготавливает hello запрос и получает и обрабатывает ответ hello.

Hello клиентской библиотеки хранилища сохраняет данные журнала для клиента в hello местоположения, указанного в файле конфигурации приложения hello (web.config или app.config).

### <a name="collect-a-network-trace"></a>Сбор данных трассировки сети
Во время выполнения клиентского приложения можно использовать анализатор сообщений toocollect трассировку сети HTTP или HTTPS. Использует анализатор сообщений [Fiddler](http://www.telerik.com/fiddler) на hello серверной части. Перед тем как вы соберете hello сетевой трассировки, рекомендуется настроить трафика HTTPS без шифрования toorecord Fiddler.

1. Установите [Fiddler](http://www.telerik.com/download/fiddler).
2. Запустите Fiddler.
3. Выберите **Инструменты | Параметры Fiddler**.
4. Убедитесь, что в диалоговом окне приветствия **захвата подключение HTTPS** и **расшифровать HTTPS-трафика** активированы, как показано ниже.

![Настройка параметров Fiddler](./media/storage-e2e-troubleshooting/fiddler-options-1.png)

Учебник hello собирать и сначала сохранить трассировку в сети в анализатор сообщений, создать трассировку служб analysis tooanalyze сеанса hello и hello журналы. toocollect сетевой трассировки в анализатор сообщений:

1. В анализаторе сообщений выберите **Файл | Быстрая трассировка | HTTPS в незашифрованном виде**.
2. Hello трассировка начнется немедленно. Выберите **остановить** toostop hello трассировки, чтобы мы можно настроить только tootrace трафика хранилища.
3. Выберите **изменить** tooedit hello трассировки сеанса.
4. Выберите hello **Настройка** связать toohello справа от приветствия **Microsoft Pef-WebProxy** поставщика трассировки событий Windows.
5. В hello **Дополнительные параметры** диалоговое окно, нажмите кнопку hello **поставщика** вкладки.
6. В hello **фильтра Hostname** укажите хранения конечных точек, разделяя их пробелами. Например можно указать конечные точки следующим образом: изменить `storagesample` toohello имя учетной записи:

    ```   
    storagesample.blob.core.windows.net storagesample.queue.core.windows.net storagesample.table.core.windows.net
    ```

7. Закройте диалоговое окно приветствия и нажмите кнопку **перезапустите** toobegin сбор трассировки для hello с фильтром hostname hello в месте, так что в hello трассировку включается только сетевой трафик хранилища Azure.

> [!NOTE]
> После завершения сбора трассировки сети настоятельно рекомендуется восстанавливать hello параметры, которые изменились в Fiddler toodecrypt HTTPS-трафика. В диалоговом окне Параметры Fiddler hello, отмените выделение hello **захвата подключение HTTPS** и **расшифровать HTTPS-трафика** флажки.
> 
> 

В разделе [с помощью функции трассировки сети hello](http://technet.microsoft.com/library/jj674819.aspx) в библиотеке Technet для получения дополнительных сведений.

## <a name="review-metrics-data-in-hello-azure-portal"></a>Просмотрите данные показателей в hello портал Azure
После выполнения приложения в течение определенного периода времени, можно просмотреть hello диаграммы метрик, отображаемых в hello [портал Azure](https://portal.azure.com) tooobserve как операции службы.

Во-первых перейдите tooyour учетной записи хранилища в hello портал Azure. По умолчанию мониторинг диаграмма с hello **процент успешных** метрика отображается в колонке hello учетной записи. Если ранее был изменен hello диаграммы toodisplay различных показателей, добавить hello **процент успешных** метрику.

Теперь вы увидите **процент успешных** в hello диаграмма мониторинга, а также любые другие показатели, возможно, были добавлены. В случае hello изучаться мы будем рядом, проанализировав журналы hello в анализатор сообщений hello процент успешных операций является немного меньше 100%.

Дополнительные сведения о добавлении и настройке диаграмм метрик см. в разделе о [настройке диаграмм метрик](storage-monitor-storage-account.md#customize-metrics-charts).

> [!NOTE]
> После включения метрик хранилища, он может занять некоторое время для вашей tooappear данные метрик в hello портал Azure. Это происходит потому часовых метрик для hello предыдущий час не отображаются в hello портал Azure, пока не истечет hello текущий час. Кроме того ежеминутных метрик не отображаются в настоящее время в hello портал Azure. Поэтому в зависимости от того, при включении метрик, может потребоваться копирование данных метрик toosee tootwo часов.
> 
> 

## <a name="use-azcopy-toocopy-server-logs-tooa-local-directory"></a>Использовать AzCopy toocopy сервер регистрирует tooa локальный каталог
Хранилище Azure записывает tooblobs данных журнала сервера, метрики записываются tootables. BLOB-объекты журнала доступны в хорошо известных hello `$logs` контейнер для вашей учетной записи хранилища. BLOB-объекты журнала обозначаются иерархически года, месяца, дня и часа, образом, можно упростить поиск hello диапазон времени, в течение которого нужно tooinvestigate. Например, в hello `storagesample` учетная запись, hello контейнер больших двоичных объектов журнала hello для 01/02/2015 из 8-9: 00, `https://storagesample.blob.core.windows.net/$logs/blob/2015/01/08/0800`. Hello отдельные большие двоичные объекты в этом контейнере именуются последовательно, начиная с версии `000000.log`.

Можно использовать эти серверные файлы tooa журнала по своему усмотрению hello AzCopy средство командной строки toodownload на локальном компьютере. Например, можно использовать следующие файлы журнала hello toodownload команду для размещения операции BLOB-объекта, которое ушло на hello папку toohello 2 января 2015 г. `C:\Temp\Logs\Server`; замените `<storageaccountname>` с именем hello вашей учетной записи хранилища и `<storageaccountkey>` с вашей ключ доступа учетной записи:

```azcopy
AzCopy.exe /Source:http://<storageaccountname>.blob.core.windows.net/$logs /Dest:C:\Temp\Logs\Server /Pattern:"blob/2015/01/02" /SourceKey:<storageaccountkey> /S /V
```
AzCopy можно загрузить на hello [загрузки Azure](https://azure.microsoft.com/downloads/) страницы. Дополнительные сведения об использовании AzCopy см. в разделе [перенесите данные с помощью служебной программы командной строки AzCopy hello](storage-use-azcopy.md).

Дополнительные сведения о скачивании серверных журналов см. в разделе [Загрузка данных журнала хранилища](http://msdn.microsoft.com/library/azure/dn782840.aspx#DownloadingStorageLogginglogdata).

## <a name="use-microsoft-message-analyzer-tooanalyze-log-data"></a>Использовать данные журналов tooanalyze Microsoft Message Analyzer
Анализатор сообщений (Майкрософт) — это средство для записи, отображения и анализа протокола обмена сообщениями трафика, событий и других сообщений системы или приложений в сценариях устранения неполадок и диагностики. Анализатор сообщений также позволяет tooload, aggregate и анализа данных из журнала и сохранить файлы трассировки. Для получения дополнительных сведений об анализаторе сообщений см. [Руководство по работе с анализатором сообщений (Майкрософт)](http://technet.microsoft.com/library/jj649776.aspx).

Анализатор сообщений включает ресурсы для хранилища Azure, которые помогут tooanalyze сервера, клиента и журналы сети. В этом разделе мы обсудим, как toouse tooaddress этих средств hello низкий процент успешных операций в выпуске hello хранения журналов.

### <a name="download-and-install-message-analyzer-and-hello-azure-storage-assets"></a>Загрузите и установите анализатор сообщений и hello активов хранилища Azure
1. Загрузить [анализатор сообщений](http://www.microsoft.com/download/details.aspx?id=44226) из hello центра загрузки Майкрософт и запустите установщик hello.
2. Запустите анализатор сообщений.
3. Из hello **средства** последовательно выберите пункты **менеджера по активам**. В hello **менеджера по активам** диалогового окна выберите **загружает**, установите фильтр на **хранилища Azure**. Вы увидите активы хранилища Azure hello, как показано на рисунке hello.
4. Нажмите кнопку **синхронизации все элементы отображаются** tooinstall hello активов хранилища Azure. Доступные ресурсы Hello включают:
   * **Правила цвета Azure хранилища:** правила цвета хранилища Azure позволяют toodefine специальные фильтры, использующие цвет текста, и начертания toohighlight сообщений, содержащих конкретные сведения в трассировке.
   * **Диаграммы хранилища Azure.** Диаграммы хранилища Azure — стандартные диаграммы, отображающие данные журнала сервера. Обратите внимание, что toouse хранилища Azure диаграммы в данный момент возможно только загрузить журнал сервера hello в hello анализа сетки.
   * **Синтаксического анализа хранилища Azure:** hello хранилища Azure анализаторы синтаксического анализа hello хранилища Azure клиента, сервера и HTTP регистрирует в порядке toodisplay их в hello анализа сетки.
   * **Фильтры Azure хранилища:** хранилища Azure фильтры, которые являются предопределенными критериями, tooquery можно использовать данные в hello анализа сетки.
   * **Azure представление структуры хранилища:** макеты хранилища Azure, макеты предопределенных столбцов и группирований в hello анализа сетки.
5. После установки средств hello, перезапустите анализатор сообщений.

![Диспетчер ресурсов в анализаторе сообщений](./media/storage-e2e-troubleshooting/mma-start-page-1.png)

> [!NOTE]
> Установите все активы хранилища Azure hello, показанный для целей данного учебника hello.
> 
> 

### <a name="import-your-log-files-into-message-analyzer"></a>Импорт файлов журнала в анализатор сообщений
Все сохраненные файлы журнала (серверного, клиентского и сетевого) можно импортировать в один сеанс анализатора сообщений (Майкрософт) для проведения анализа.

1. На hello **файл** в Microsoft Message Analyzer, выберите пункт **новый сеанс**, а затем нажмите кнопку **пустого сеанса**. В hello **новый сеанс** диалоговое окно, введите имя для сеанса анализа. В hello **подробные сведения о сеансе** панели можно, щелкнув hello **файлы** кнопки.
2. Щелкните tooload hello сетевой трассировки данных, создаваемых анализатор сообщений **добавить файлы**, поиск toohello расположения, где был сохранен файл .matp из сеанса трассировки web, выберите hello .matp файл, и нажмите кнопку **откройте**.
3. данные журнала серверной части tooload hello, щелкните на **добавить файлы**найдите toohello расположение, куда вы загрузили серверных журналов, выберите файлы журнала hello hello временном диапазоне tooanalyze и нажмите кнопку **откройте**. Затем в hello **подробные сведения о сеансе** панель, набор hello **текст журнала конфигурации** раскрывающегося списка для каждого файла журнала на стороне сервера слишком**AzureStorageLog** tooensure Microsoft Анализатор сообщений можно выполнить синтаксический анализ файла журнала hello правильно.
4. данные журнала клиентской части tooload hello, щелкните **добавить файлы**найдите расположение toohello для сохранения журналов клиентские, выберите файлы журнала hello tooanalyze и нажмите кнопку **откройте**. Затем в hello **подробные сведения о сеансе** панель, набор hello **текст журнала конфигурации** раскрывающегося списка для каждого файла журнала на стороне клиента слишком**AzureStorageClientDotNetV4** tooensure, Microsoft Message Analyzer можно выполнить синтаксический анализ файла журнала hello правильно.
5. Нажмите кнопку **запустить** в hello **новый сеанс** диалоговое окно tooload и синтаксический анализ hello данные журнала. данные журнала Hello отображаются в сетке анализа анализатора сообщений hello.

Hello рисунке показан пример сеанса настраивается с сервера, клиента и файлы журнала трассировки сети.

![Настройка сеанса анализатора сообщений](./media/storage-e2e-troubleshooting/configure-mma-session-1.png)

Обратите внимание, что анализатор сообщений загружает файлы журнала в память. При наличии большого набора данных журнала, вы будете toofilter в порядке tooget hello наилучшей производительности анализатор сообщений.

Во-первых определите hello промежуток времени, который вы заинтересованы в просмотре и небольшие этот промежуток времени. Во многих случаях требуется tooreview период минут или часов в большинстве случаев. Импорт hello наименьший набор журналы, которые могут соответствовать вашим потребностям.

Если по-прежнему имеется большой объем данных журнала, затем можно toospecify toofilter сеанса фильтра данных журнала перед их загрузкой. В hello **сеанса фильтра** поле, выберите hello **библиотеки** кнопку toochoose стандартный фильтр, например, выбрать **глобального времени фильтра I** из хранилища Azure фильтрует hello toofilter в течение промежутка времени. Можно редактировать hello критериев фильтра toospecify hello начала и конца отметки времени для интервала hello необходимо toosee. Можно также осуществлять фильтрацию по коду определенного состояния; Например вы можете tooload где hello код состояния 404 только записи журнала.

Дополнительные сведения об импорте данных журнала в анализатор сообщений (Майкрософт) см. в разделе [Получение данных сообщений](http://technet.microsoft.com/library/dn772437.aspx) на сайте TechNet.

### <a name="use-hello-client-request-id-toocorrelate-log-file-data"></a>Используйте hello идентификатор запроса клиента toocorrelate данных файла журнала
Hello клиентская библиотека хранилища Azure автоматически создает идентификатор запроса клиента, уникальный для каждого запроса. Данное значение записывается журнал toohello клиентов, журнал сервера hello и hello сетевой трассировки, воспользуйтесь его toocorrelate данных для всех трех журналов в анализатор сообщений. В разделе [идентификатор запроса клиента](storage-monitoring-diagnosing-troubleshooting.md#client-request-id) Дополнительные сведения о клиенте hello идентификатор запроса.

Hello следующих разделах описываются как готовые toouse и пользовательский макет представления, toocorrelate и как группировать данные, основанные на запрос клиента hello идентификатор.

### <a name="select-a-view-layout-toodisplay-in-hello-analysis-grid"></a>Выберите представление макета toodisplay в hello анализа сетки
Активы хранилища Hello для анализатор сообщений включают структуры представления хранилища Azure, которые являются предварительно настроенные представления, можно использовать toodisplay данных со столбцами и столбцами группирования полезно для различных сценариев. Также можно создавать пользовательские макеты и сохранять их для повторного использования.

Hello рисунке показано hello **разметки представления** меню, выбрав **разметки представления** hello ленте инструментов. Hello макеты для хранилища Azure сгруппированы под hello **хранилища Azure** узла в меню hello. Можно выполнить поиск `Azure Storage` просмотрите макеты только в hello toofilter поле поиска в хранилище Azure. Можно также выбрать hello звезда Далее tooa представление макета toomake ему Избранное и вывести ее в верхней hello меню «hello».

![Меню макета представления](./media/storage-e2e-troubleshooting/view-layout-menu.png)

toobegin с помощью select **группируются по ClientRequestID и модуль**. Этот макет представления группирует данные журналов из всех трех журналов сначала по идентификатору запроса клиента, а затем по исходному файлу журнала (или **модулю** в анализаторе сообщений). В этом представлении можно детализировать укрупнением идентификатор запроса конкретного клиента и просматривать данные из всех трех журналов для запроса клиента по идентификатору.

Приведенный далее рисунок Hello эти данные отображаются для макета применено представление toohello образец журнала, с подмножеством столбцов, отображаемых. Вы увидите, что для ИД запроса конкретного клиента, hello анализа сетки отображаются данные из журнала клиента hello, журнал сервера и сетевой трассировки.

![Макет представления хранилища Azure](./media/storage-e2e-troubleshooting/view-layout-client-request-id-module.png)

> [!NOTE]
> Файлы журналов имеют разные столбцы, поэтому при отображении данных из нескольких файлов журналов в hello сетки анализ, некоторые столбцы не может содержать любые данные для строки. Например, на приведенном выше рисунке hello, строк журнала клиента больше не показывать все данные для hello **Timestamp**, **TimeElapsed**, **источника**, и **назначения** столбцов, так как эти столбцы не существуют в журнал клиента hello, однако существуют в hello сетевой трассировки. Аналогичным образом hello **Timestamp** столбец отображает данные отметки времени из журнала сервера hello, но данные не отображаются для hello **TimeElapsed**, **источника**, и  **Назначение** столбцы, которые не являются частью журнала сервера hello.
> 
> 

В дополнение к этому toousing hello Azure представление структуры хранилища, можно также определить и сохранить представление макеты. Можно выбрать другие нужные поля для группирования данных и сохранять как часть пользовательский макет hello группирования.

### <a name="apply-color-rules-toohello-analysis-grid"></a>Применяются правила цвета toohello анализа сетки
Активы хранилища Hello включают также правила цвета, которые предоставляют визуальный означает tooidentify ошибок в hello сетки анализа различных типов. Hello предопределенные правила цвета применяются tooHTTP ошибки, могут быть отображены только для сервера hello журнала и сетевой трассировки.

Выберите правила цвета tooapply, **правила цвета** hello ленте инструментов. Вы увидите правила цвета hello хранилища Azure в меню hello. В учебнике hello выберите **ошибки клиента (StatusCode от 400 до 499)**, как показано на рисунке hello.

![Макет представления хранилища Azure](./media/storage-e2e-troubleshooting/color-rules-menu.png)

В дополнение к этому toousing hello хранилища Azure цветовые правила, можно определить и сохранить правила цвета.

### <a name="group-and-filter-log-data-toofind-400-range-errors"></a>Группы и фильтровать ошибки 400 диапазон журнала данных toofind
Затем мы группы и фильтровать toofind данных журнала hello все ошибки в диапазоне hello 400.

1. Найдите hello **StatusCode** столбца в hello анализа сетки, щелкните правой кнопкой мыши столбец hello заголовка и выберите **группы**.
2. Далее группировать по hello **ClientRequestId** столбца. Вы увидите что hello данные в сетки анализа теперь организованы по состоянию приветствия кода и запросом клиента по идентификатору.
3. Отображается окно инструментов hello фильтр представления, если не отображается. Выберите на ленте инструментов hello **окна инструментов**, затем **фильтр представления**.
4. toofilter hello журнала toodisplay только 400 диапазон ошибки данных, добавить hello, следуя toohello критерии фильтра **фильтр представления** и выберите **применить**:

    ```   
    (AzureStorageLog.StatusCode >= 400 && AzureStorageLog.StatusCode <=499) || (HTTP.StatusCode >= 400 && HTTP.StatusCode <= 499)
    ```

Hello рисунке ниже показаны результаты hello данного группирования и фильтра. Расширяемые hello **ClientRequestID** поле под hello группирования для, например, код состояния 409, показана операция, которая привела к указанный код состояния.

![Макет представления хранилища Azure](./media/storage-e2e-troubleshooting/400-range-errors1.png)

После применения фильтра, вы увидите, что исключаются строки из журнала клиента hello, как hello журнала клиента не включает **StatusCode** столбца. Затем мы вернемся toohello журнала tooexamine hello клиентских операций клиента, ставших toothem toobegin с мы изучим приветствия сервера и ошибки 404 toolocate журналы трассировки сети

> [!NOTE]
> Можно выполнить фильтрацию по hello **StatusCode** столбец и по-прежнему отображать данные из всех трех журналов, включая hello журнала клиента при добавлении фильтр toohello выражения, содержит записи журнала, где hello код состояния имеет значение null. tooconstruct этот критерий фильтра, используйте:
> 
> <code>&#42;StatusCode >= 400 or !&#42;StatusCode</code>
> 
> Этот фильтр возвращает все строки из клиента hello журнала и только строки из hello server и журналах HTTP которых код состояния hello больше 400. Если применить его toohello представление макета, сгруппированных по ИД запроса клиента и модуль, можно выполнить поиск или войдите в прокрутите hello toofind записи историй, где представлены все три журнала.   
> 
> 

### <a name="filter-log-data-toofind-404-errors"></a>Отфильтровать ошибки 404 toofind данных журнала
Активы хранилища Hello включают встроенные фильтры, которые можно использовать toonarrow журнала toofind hello ошибки данных или тенденций, которую вы ищете. Далее мы будем применить два фильтра предопределенных:, который фильтрует hello server и журналы трассировки сети для ошибки 404 и которая фильтрует данные hello указанный временной диапазон.

1. Отображается окно инструментов hello фильтр представления, если не отображается. Выберите на ленте инструментов hello **окна инструментов**, затем **фильтр представления**.
2. Выберите в окне фильтра представления hello **библиотеки**и поиска `Azure Storage` toofind hello фильтрует хранилища Azure. Выберите hello фильтр для **404 (не найдено) сообщения из всех журналов**.
3. Экран приветствия **библиотеки** меню еще раз, найдите и выделите hello **глобальный фильтр времени**.
4. Измените hello отметки времени, чтобы отобразить в диапазоне toohello hello фильтра нужно tooview. Это поможет toonarrow hello диапазон tooanalyze данных.
5. Фильтр должен появиться примерно toohello приведенном ниже примере. Нажмите кнопку **применить** tooapply hello фильтра toohello анализа сетки.

    ```   
    ((AzureStorageLog.StatusCode == 404 || HTTP.StatusCode == 404)) And
    (#Timestamp >= 2014-10-20T16:36:38 and #Timestamp <= 2014-10-20T16:36:39)
    ```

    ![Макет представления хранилища Azure](./media/storage-e2e-troubleshooting/404-filtered-errors1.png)

### <a name="analyze-your-log-data"></a>Анализ данных журнала
Теперь, после группировки и фильтрации данных, можно проверить сведения hello отдельных запросов, которые создали ошибки 404. В макете текущее представление hello hello данные группируются по ИД запроса клиента, затем по источник журнала. Поскольку мы фильтруется в запросах, где поле StatusCode hello содержит 404, мы рассмотрим только hello сервера и данные трассировки сети, не hello данные журнала клиента.

Приведенный далее рисунок Hello показано конкретный запрос, где операция Get Blob дали 404, поскольку hello большого двоичного объекта не существует. Обратите внимание, что некоторые столбцы были удалены из hello стандартные представления в порядке toodisplay hello важные данные.

![Отфильтрованные журналы трассировки сети и сервера](./media/storage-e2e-troubleshooting/server-filtered-404-error.png)

Далее мы будем корреляции идентификатор запроса клиента с toosee данных журнала клиента hello какой клиент hello действия заняла, когда произошла ошибка hello. Можно отобразить новое представление сетки анализ для этого сеанса tooview hello клиента журнала данных, которые откроется на второй вкладке:

1. Во-первых, скопируйте значение hello hello **ClientRequestId** буфер обмена toohello поля. Это можно сделать, выбрав либо строки поиска hello **ClientRequestId** поля, щелкните правой кнопкой мыши на значение данных hello и выбрав **копирования «ClientRequestId»**.
2. Выберите на ленте инструментов hello **новое средство просмотра**, а затем выберите **сетки анализа** tooopen вкладку hello новой вкладки отображает все данные в файлы журнала без группирования, фильтрации или правила цвета.
3. Выберите на ленте инструментов hello **разметки представления**, а затем выберите **все столбцы клиента .NET** под hello **хранилища Azure** раздела. Этот макет в представлении отображаются данные на приветствия клиента журнала, а также hello журналов трассировки сервера и сети. По умолчанию он отсортирован по hello **MessageNumber** столбца.
4. Теперь выполните поиск журнала клиента hello hello клиента, код запроса. Выберите на ленте инструментов hello **найти сообщения**, затем указать настраиваемый фильтр на идентификатор запроса клиента hello в hello **найти** поля. Используйте следующий синтаксис для hello фильтр, указав собственный идентификатор запроса клиента:

    ```
    *ClientRequestId == "398bac41-7725-484b-8a69-2a9e48fc669a"
    ```

Анализатор сообщений находит и выделяет hello первая запись в журнал где условия поиска hello соответствует идентификатору hello клиентского запроса. В журнале клиента hello, существует несколько записей для каждого идентификатора клиентского запроса, поэтому можно toogroup их на hello **ClientRequestId** toomake поля его проще toosee их все вместе. Рисунок Hello ниже показан журнал все сообщения hello в клиенте hello для hello указан идентификатор запроса клиента.

![Ошибки 404 в журнале клиента](./media/storage-e2e-troubleshooting/client-log-analysis-grid1.png)

С помощью hello данные, отображенные в макеты hello в эти две вкладки, можно анализировать hello запрос данных toodetermine возможной причине ошибки hello. Можно также просмотреть запросы, предшествующие этой один toosee, если предыдущее событие могли привести toohello сообщение об ошибке 404. Например можно просмотреть записи журнала клиента hello, предшествующие этой toodetermine идентификатор запроса клиента ли hello большой двоичный объект был удален или hello произошла ошибка из-за toohello клиентское приложение вызова CreateIfNotExists API контейнера или большого двоичного объекта. В журнале клиента hello, можно найти адрес hello большого двоичного объекта в hello **описание** поле; в журнале трассировки сети и сервера hello, эта информация отображается в hello **Сводка** поля.

Зная hello адрес hello BLOB-объект, который выдавал ошибки hello 404, вы дальнейшего исследования проблемы. Если поиск записи в журнале hello для других сообщений, связанных с операций над hello же больших двоичных объектов, можно проверить, удален ли ранее клиент hello hello сущности.

## <a name="analyze-other-types-of-storage-errors"></a>Анализ других типов ошибок хранилища
Теперь, когда вы знакомы с данными журнала с помощью tooanalyze анализатор сообщений, можно анализировать другие типы ошибок с помощью представления макеты, правила цвета и поиска и фильтрации. Hello таблицы ниже перечислены некоторые проблемы могут возникнуть и hello условия фильтра можно использовать toolocate их. Дополнительные сведения о создании фильтров и анализатор сообщений hello. Фильтрация языка, в разделе [фильтрации данных сообщения](http://technet.microsoft.com/library/jj819365.aspx).

| tooInvestigate... | Использование выражения фильтра | Выражение применяется tooLog (клиента, сервера и сети, все) |
| --- | --- | --- |
| Непредвиденные задержки при доставке сообщений в очередь |AzureStorageClientDotNetV4.Description содержит "Повторное выполнение неудавшейся операции". |Клиент |
| Увеличение HTTP в PercentThrottlingError |HTTP.Response.StatusCode == 500 &#124;&#124; HTTP.Response.StatusCode == 503 |Сеть |
| Увеличение PercentTimeoutError |HTTP.Response.StatusCode == 500 |Сеть |
| Увеличение PercentTimeoutError (все) |*StatusCode == 500 |Все |
| Увеличение PercentNetworkError |AzureStorageClientDotNetV4.EventLogEntry.Level < 2 |Клиент |
| Сообщения HTTP 403 (запрещено) |HTTP.Response.StatusCode == 403 |Сеть |
| Сообщения HTTP 404 (не найдено) |HTTP.Response.StatusCode == 404 |Сеть |
| 404 (все) |*StatusCode == 404 |Все |
| Общие проблемы авторизации подписи доступа (SAS) |AzureStorageLog.RequestStatus == "SASAuthorizationError" |Сеть |
| Сообщения HTTP 409 (конфликт) |HTTP.Response.StatusCode == 409 |Сеть |
| 409 (все) |*StatusCode == 409 |Все |
| Низкие значения PercentSuccess или присутствие операций с состоянием транзакции ClientOtherErrors в записях журналов аналитики |AzureStorageLog.RequestStatus == "ClientOtherError" |сервер; |
| Предупреждение Nagle |((AzureStorageLog.EndToEndLatencyMS - AzureStorageLog.ServerLatencyMS) > (AzureStorageLog.ServerLatencyMS * 1.5)) and (AzureStorageLog.RequestPacketSize <1460) and (AzureStorageLog.EndToEndLatencyMS - AzureStorageLog.ServerLatencyMS >= 200) |сервер; |
| Диапазон времени в журналах сервера и сети |#Timestamp   >= 2014-10-20T16:36:38 and #Timestamp <= 2014-10-20T16:36:39 |Сервер, сеть |
| Диапазон времени в журналах сервера |AzureStorageLog.Timestamp >= 2014-10-20T16:36:38 and AzureStorageLog.Timestamp <= 2014-10-20T16:36:39 |сервер; |

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о сквозных сценариях устранения ошибок в службы хранилище Azure см. следующие ресурсы:

* [Наблюдение, диагностика и устранение неисправностей хранилища Microsoft Azure](storage-monitoring-diagnosing-troubleshooting.md)
* [Аналитика службы хранилища](http://msdn.microsoft.com/library/azure/hh343270.aspx)
* [Отслеживание учетной записи хранилища в hello портал Azure](storage-monitor-storage-account.md)
* [Перенесите данные с помощью служебной программы командной строки AzCopy hello](storage-use-azcopy.md)
* [Руководство по работе с анализатором сообщений (Майкрософт)](http://technet.microsoft.com/library/jj649776.aspx)
