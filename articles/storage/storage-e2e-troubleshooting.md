---
title: "Устранение неполадок службы хранилища Azure с помощью диагностики и анализатора сообщений | Документация Майкрософт"
description: "Учебник, демонстрирующий комплексное устранение неполадок с помощью аналитики хранилища Azure, AzCopy и анализатора сообщений Майкрософт"
services: storage
documentationcenter: dotnet
author: robinsh
manager: timlt
ms.assetid: 643372a3-1c07-4e88-b4ef-042512a43086
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 03/15/2017
ms.author: robinsh
ms.openlocfilehash: e2b739772f98a9c23253c58bb2bbd3560814ccaa
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="end-to-end-troubleshooting-using-azure-storage-metrics-and-logging-azcopy-and-message-analyzer"></a><span data-ttu-id="81f07-103">Комплексный поиск и устранение неполадок с помощью метрик хранилища Azure и ведения журнала, AzCopy и анализатора сообщений</span><span class="sxs-lookup"><span data-stu-id="81f07-103">End-to-End Troubleshooting using Azure Storage metrics and logging, AzCopy, and Message Analyzer</span></span>
[!INCLUDE [storage-selector-portal-e2e-troubleshooting](../../includes/storage-selector-portal-e2e-troubleshooting.md)]

<span data-ttu-id="81f07-104">Диагностика и устранение неполадок является ключевым навыком, необходимым для создания и поддержки клиентских приложений с хранилищем Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="81f07-104">Diagnosing and troubleshooting is a key skill for building and supporting client applications with Microsoft Azure Storage.</span></span> <span data-ttu-id="81f07-105">Из-за особенностей распределенного характера приложений Azure диагностика и устранение ошибок и проблем с производительностью могут оказаться сложнее, чем в традиционных средах.</span><span class="sxs-lookup"><span data-stu-id="81f07-105">Due to the distributed nature of an Azure application, diagnosing and troubleshooting errors and performance issues may be more complex than in traditional environments.</span></span>

<span data-ttu-id="81f07-106">В этом учебнике показано, как определить конкретные ошибки, которые могут повлиять на производительность, и устранить их с помощью инструментов, предоставляемых корпорацией Майкрософт и службой хранилища Azure, для оптимизации клиентского приложения.</span><span class="sxs-lookup"><span data-stu-id="81f07-106">In this tutorial, we demonstrate how to identify certain errors that may affect performance, and troubleshoot those errors from end-to-end using tools provided by Microsoft and Azure Storage, in order to optimize the client application.</span></span>

<span data-ttu-id="81f07-107">В этом учебнике содержатся практические исследования сквозного сценария устранения неполадок.</span><span class="sxs-lookup"><span data-stu-id="81f07-107">This tutorial provides a hands-on exploration of an end-to-end troubleshooting scenario.</span></span> <span data-ttu-id="81f07-108">Подробное концептуальное руководство по устранению неполадок в приложениях службы хранилища Azure см. в статье [Мониторинг, диагностика и устранение неисправностей службы хранилища Microsoft Azure](storage-monitoring-diagnosing-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="81f07-108">For an in-depth conceptual guide to troubleshooting Azure storage applications, see [Monitor, diagnose, and troubleshoot Microsoft Azure Storage](storage-monitoring-diagnosing-troubleshooting.md).</span></span>

## <a name="tools-for-troubleshooting-azure-storage-applications"></a><span data-ttu-id="81f07-109">Средства для устранения неполадок приложений хранилища Azure</span><span class="sxs-lookup"><span data-stu-id="81f07-109">Tools for troubleshooting Azure Storage applications</span></span>
<span data-ttu-id="81f07-110">Для устранения неполадок клиентских приложений, использующих службу хранилища Microsoft Azure, можно использовать сочетание средств, чтобы определить, когда возникла проблема, и причину, по которой она могла возникнуть.</span><span class="sxs-lookup"><span data-stu-id="81f07-110">To troubleshoot client applications using Microsoft Azure Storage, you can use a combination of tools to determine when an issue has occurred and what the cause of the problem may be.</span></span> <span data-ttu-id="81f07-111">Вот эти средства.</span><span class="sxs-lookup"><span data-stu-id="81f07-111">These tools include:</span></span>

* <span data-ttu-id="81f07-112">**Аналитика службы хранилища Azure**.</span><span class="sxs-lookup"><span data-stu-id="81f07-112">**Azure Storage Analytics**.</span></span> <span data-ttu-id="81f07-113">[Аналитика службы хранилища Azure](/rest/api/storageservices/Storage-Analytics) обеспечивает метрики и ведение журнала для службы хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="81f07-113">[Azure Storage Analytics](/rest/api/storageservices/Storage-Analytics) provides metrics and logging for Azure Storage.</span></span>
  
  * <span data-ttu-id="81f07-114">**Метрики службы хранилища** отслеживают метрики транзакций и метрики емкости для учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="81f07-114">**Storage metrics** tracks transaction metrics and capacity metrics for your storage account.</span></span> <span data-ttu-id="81f07-115">С помощью метрик можно оценить производительность приложения с позиций различных показателей.</span><span class="sxs-lookup"><span data-stu-id="81f07-115">Using metrics, you can determine how your application is performing according to a variety of different measures.</span></span> <span data-ttu-id="81f07-116">В разделе [Схема таблицы метрик аналитики службы хранилища](/rest/api/storageservices/Storage-Analytics-Metrics-Table-Schema) приведены дополнительные сведения о типах метрик, которые отслеживаются аналитикой службы хранилища.</span><span class="sxs-lookup"><span data-stu-id="81f07-116">See [Storage Analytics Metrics Table Schema](/rest/api/storageservices/Storage-Analytics-Metrics-Table-Schema) for more information about the types of metrics tracked by Storage Analytics.</span></span>
  * <span data-ttu-id="81f07-117">**Ведение журналов службы хранилища** отслеживает каждый запрос к службе хранилища Azure и заносит его в журнал сервера.</span><span class="sxs-lookup"><span data-stu-id="81f07-117">**Storage logging** logs each request to the Azure Storage services to a server-side log.</span></span> <span data-ttu-id="81f07-118">Журнал содержит подробные данные для каждого запроса, включая выполняемые операции, состояние операций, а также сведения о задержке.</span><span class="sxs-lookup"><span data-stu-id="81f07-118">The log tracks detailed data for each request, including the operation performed, the status of the operation, and latency information.</span></span> <span data-ttu-id="81f07-119">В разделе [Формат журналов аналитики службы хранилища](/rest/api/storageservices/Storage-Analytics-Log-Format) приведены дополнительные сведения о данных запросов и ответов, которые заносятся в журналы аналитики службы хранилища.</span><span class="sxs-lookup"><span data-stu-id="81f07-119">See [Storage Analytics Log Format](/rest/api/storageservices/Storage-Analytics-Log-Format) for more information about the request and response data that is written to the logs by Storage Analytics.</span></span>

> [!NOTE]
> <span data-ttu-id="81f07-120">В настоящее время учетные записи хранения с типом репликации "Хранилище, избыточное в пределах зоны (ZRS)" не имеют действующих функций метрик или ведения журнала.</span><span class="sxs-lookup"><span data-stu-id="81f07-120">Storage accounts with a replication type of Zone-Redundant Storage (ZRS) do not have the metrics or logging capability enabled at this time.</span></span> 
> 
> 

* <span data-ttu-id="81f07-121">**портал Azure**.</span><span class="sxs-lookup"><span data-stu-id="81f07-121">**Azure portal**.</span></span> <span data-ttu-id="81f07-122">Настроить метрики и ведение журнала для учетной записи хранения можно на [портале Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="81f07-122">You can configure metrics and logging for your storage account in the [Azure portal](https://portal.azure.com).</span></span> <span data-ttu-id="81f07-123">Можно также просматривать диаграммы и графики, которые показывают, как производительность приложения изменяется со временем, и настроить оповещения для уведомления в случае, если производительность выполняемого приложения отличается от ожидаемой для указанной метрики.</span><span class="sxs-lookup"><span data-stu-id="81f07-123">You can also view charts and graphs that show how your application is performing over time, and configure alerts to notify you if your application performs differently than expected for a specified metric.</span></span>
  
    <span data-ttu-id="81f07-124">Сведения о настройке мониторинга на портале Azure см. в статье [Мониторинг учетной записи хранения на портале Azure](storage-monitor-storage-account.md).</span><span class="sxs-lookup"><span data-stu-id="81f07-124">See [Monitor a storage account in the Azure portal](storage-monitor-storage-account.md) for information about configuring monitoring in the Azure portal.</span></span>
* <span data-ttu-id="81f07-125">**AzCopy**.</span><span class="sxs-lookup"><span data-stu-id="81f07-125">**AzCopy**.</span></span> <span data-ttu-id="81f07-126">Журналы сервера для службы хранилища Azure хранятся в виде BLOB-объектов, чтобы можно было использовать AzCopy для копирования BLOB-объектов журнала в локальный каталог для анализа с помощью анализатора сообщений (Майкрософт).</span><span class="sxs-lookup"><span data-stu-id="81f07-126">Server logs for Azure Storage are stored as blobs, so you can use AzCopy to copy the log blobs to a local directory for analysis using Microsoft Message Analyzer.</span></span> <span data-ttu-id="81f07-127">Дополнительные сведения об AzCopy см. в статье [Передача данных с помощью служебной программы командной строки AzCopy](storage-use-azcopy.md).</span><span class="sxs-lookup"><span data-stu-id="81f07-127">See [Transfer data with the AzCopy Command-Line Utility](storage-use-azcopy.md) for more information about AzCopy.</span></span>
* <span data-ttu-id="81f07-128">**Анализатор сообщений (Майкрософт)**.</span><span class="sxs-lookup"><span data-stu-id="81f07-128">**Microsoft Message Analyzer**.</span></span> <span data-ttu-id="81f07-129">Анализатор сообщений — это средство, которое использует файлы журналов и отображает данные журнала в визуальном формате, упрощающем фильтрацию, поиск и группирование данных журнала в полезные выборки, которые можно использовать для анализа ошибок и проблем производительности.</span><span class="sxs-lookup"><span data-stu-id="81f07-129">Message Analyzer is a tool that consumes log files and displays log data in a visual format that makes it easy to filter, search, and group log data into useful sets that you can use to analyze errors and performance issues.</span></span> <span data-ttu-id="81f07-130">См. [Руководство по работе с анализатором сообщений (Майкрософт)](http://technet.microsoft.com/library/jj649776.aspx) для получения дополнительных сведений об анализаторе сообщений.</span><span class="sxs-lookup"><span data-stu-id="81f07-130">See [Microsoft Message Analyzer Operating Guide](http://technet.microsoft.com/library/jj649776.aspx) for more information about Message Analyzer.</span></span>

## <a name="about-the-sample-scenario"></a><span data-ttu-id="81f07-131">О примере сценария</span><span class="sxs-lookup"><span data-stu-id="81f07-131">About the sample scenario</span></span>
<span data-ttu-id="81f07-132">В этом учебнике мы рассмотрим сценарий, где метрики службы хранилища Azure указывают на низкий процент успешных операций для приложения, выполняющего обращения к службе хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="81f07-132">For this tutorial, we'll examine a scenario where Azure Storage metrics indicates a low percent success rate for an application that calls Azure storage.</span></span> <span data-ttu-id="81f07-133">Метрика низкого процента успешных операций (показана как **PercentSuccess** на [портале Azure](https://portal.azure.com) и в таблицах метрик) отслеживает успешно завершенные операции, которые возвращают код состояния HTTP, превышающий 299.</span><span class="sxs-lookup"><span data-stu-id="81f07-133">The low percent success rate metric (shown as **PercentSuccess** in the [Azure portal](https://portal.azure.com) and in the metrics tables) tracks operations that succeed, but that return an HTTP status code that is greater than 299.</span></span> <span data-ttu-id="81f07-134">В файлах журналов хранилища на стороне сервера такие операции отображаются с состоянием транзакции **ClientOtherErrors**(Другие ошибки клиента).</span><span class="sxs-lookup"><span data-stu-id="81f07-134">In the server-side storage log files, these operations are recorded with a transaction status of **ClientOtherErrors**.</span></span> <span data-ttu-id="81f07-135">Дополнительные сведения о метрике низкого процента успешных операций см. в разделе [Метрики содержат низкие значения PercentSuccess, или в записях журналов аналитики присутствуют операции с состоянием транзакции ClientOtherErrors](storage-monitoring-diagnosing-troubleshooting.md#metrics-show-low-percent-success).</span><span class="sxs-lookup"><span data-stu-id="81f07-135">For more details about the low percent success metric, see [Metrics show low PercentSuccess or analytics log entries have operations with transaction status of ClientOtherErrors](storage-monitoring-diagnosing-troubleshooting.md#metrics-show-low-percent-success).</span></span>

<span data-ttu-id="81f07-136">Операции службы хранилища Azure могут возвращать коды состояния HTTP, большие 299 в ходе обычной работы.</span><span class="sxs-lookup"><span data-stu-id="81f07-136">Azure Storage operations may return HTTP status codes greater than 299 as part of their normal functionality.</span></span> <span data-ttu-id="81f07-137">Однако в некоторых случаях эти ошибки указывают на возможность оптимизации клиентского приложения для повышения производительности.</span><span class="sxs-lookup"><span data-stu-id="81f07-137">But these errors in some cases indicate that you may be able to optimize your client application for improved performance.</span></span>

<span data-ttu-id="81f07-138">В этом сценарии под низким процентом частоты успешных операций подразумеваются значения меньше 100 %.</span><span class="sxs-lookup"><span data-stu-id="81f07-138">In this scenario, we'll consider a low percent success rate to be anything below 100%.</span></span> <span data-ttu-id="81f07-139">Тем не менее при необходимости можно выбрать другой уровень метрики.</span><span class="sxs-lookup"><span data-stu-id="81f07-139">You can choose a different metric level, however, according to your needs.</span></span> <span data-ttu-id="81f07-140">Рекомендуется во время тестирования приложения установить допуск базовых показателей для ключевых метрик производительности.</span><span class="sxs-lookup"><span data-stu-id="81f07-140">We recommend that during testing of your application, you establish a baseline tolerance for your key performance metrics.</span></span> <span data-ttu-id="81f07-141">Например, на основе тестирования может быть определено, что приложение должно иметь согласованный процент успешных операций, равный 90 % или 85 %.</span><span class="sxs-lookup"><span data-stu-id="81f07-141">For example, you might determine, based on testing, that your application should have a consistent percent success rate of 90%, or 85%.</span></span> <span data-ttu-id="81f07-142">Если данные метрик показывают, что приложение отклоняется от этого значения, можно выяснить, что способно являться причиной увеличения.</span><span class="sxs-lookup"><span data-stu-id="81f07-142">If your metrics data shows that the application is deviating from that number, then you can investigate what may be causing the increase.</span></span>

<span data-ttu-id="81f07-143">Для нашего примера сценария после того, как мы определили, что метрика процента успешных операций меньше 100 %, проверим журналы, чтобы найти ошибки, которые соответствуют метрике, и используем их для выяснения причины низкого процента успешных операций.</span><span class="sxs-lookup"><span data-stu-id="81f07-143">For our sample scenario, once we've established that the percent success rate metric is below 100%, we will examine the logs to find the errors that correlate to the metrics, and use them to figure out what is causing the lower percent success rate.</span></span> <span data-ttu-id="81f07-144">Отдельно рассмотрим ошибки в диапазоне 400.</span><span class="sxs-lookup"><span data-stu-id="81f07-144">We'll look specifically at errors in the 400 range.</span></span> <span data-ttu-id="81f07-145">Затем мы подробнее исследуем ошибку 404 (Не найден).</span><span class="sxs-lookup"><span data-stu-id="81f07-145">Then we'll more closely investigate 404 (Not Found) errors.</span></span>

### <a name="some-causes-of-400-range-errors"></a><span data-ttu-id="81f07-146">Некоторые причины ошибок диапазона 400</span><span class="sxs-lookup"><span data-stu-id="81f07-146">Some causes of 400-range errors</span></span>
<span data-ttu-id="81f07-147">В приведенных ниже примерах показаны выборки для запросов к службе хранилища BLOB-объектов Azure и возможные причины ошибок диапазона 400.</span><span class="sxs-lookup"><span data-stu-id="81f07-147">The examples below shows a sampling of some 400-range errors for requests against Azure Blob Storage, and their possible causes.</span></span> <span data-ttu-id="81f07-148">Любая из этих ошибок, а также ошибки в диапазонах 300 и 500 могут вызывать низкий процент успешных операций.</span><span class="sxs-lookup"><span data-stu-id="81f07-148">Any of these errors, as well as errors in the 300 range and the 500 range, can contribute to a low percent success rate.</span></span>

<span data-ttu-id="81f07-149">Обратите внимание, что перечисленные ниже сведения являются далеко не полными.</span><span class="sxs-lookup"><span data-stu-id="81f07-149">Note that the lists below are far from complete.</span></span> <span data-ttu-id="81f07-150">В разделе [Коды состояний и ошибок](http://msdn.microsoft.com/library/azure/dd179382.aspx) на сайте MSDN приведены подробные сведения об общих ошибках службы хранилища Azure, а также об ошибках, относящихся к каждой из служб хранилища.</span><span class="sxs-lookup"><span data-stu-id="81f07-150">See [Status and Error Codes](http://msdn.microsoft.com/library/azure/dd179382.aspx) on MSDN for details about general Azure Storage errors and about errors specific to each of the storage services.</span></span>

<span data-ttu-id="81f07-151">**Примеры кода состояния 404 (не найдено)**</span><span class="sxs-lookup"><span data-stu-id="81f07-151">**Status Code 404 (Not Found) Examples**</span></span>

<span data-ttu-id="81f07-152">Возникает при сбое операции чтения для BLOB-объекта или контейнера, если не найден BLOB-объект или контейнер.</span><span class="sxs-lookup"><span data-stu-id="81f07-152">Occurs when a read operation against a container or blob fails because the blob or container is not found.</span></span>

* <span data-ttu-id="81f07-153">Возникает, если контейнер или BLOB-объект был удален другим клиентом до этого запроса.</span><span class="sxs-lookup"><span data-stu-id="81f07-153">Occurs if a container or blob has been deleted by another client before this request.</span></span>
* <span data-ttu-id="81f07-154">Возникает при использовании вызова интерфейса API, создающего контейнер или BLOB-объект после проверки того, существуют ли они.</span><span class="sxs-lookup"><span data-stu-id="81f07-154">Occurs if you are using an API call that creates the container or blob after checking whether it exists.</span></span> <span data-ttu-id="81f07-155">API-интерфейсы CreateIfNotExists сначала выполняют вызов метода HEAD, чтобы проверить существование контейнера или BLOB-объекта. Если он не существует, возвращается сообщение об ошибке 404 и производится второй вызов метода PUT для записи контейнера или BLOB-объекта.</span><span class="sxs-lookup"><span data-stu-id="81f07-155">The CreateIfNotExists APIs make a HEAD call first to check for the existence of the container or blob; if it does not exist, a 404 error is returned, and then a second PUT call is made to write the container or blob.</span></span>

<span data-ttu-id="81f07-156">**Примеры кода состояния 409 (конфликт)**</span><span class="sxs-lookup"><span data-stu-id="81f07-156">**Status Code 409 (Conflict) Examples**</span></span>

* <span data-ttu-id="81f07-157">Возникает при использовании API для создания нового контейнера или BLOB-объекта без проверки наличия существующего контейнера или BLOB-объекта с таким именем.</span><span class="sxs-lookup"><span data-stu-id="81f07-157">Occurs if you use a Create API to create a new container or blob, without checking for existence first, and a container or blob with that name already exists.</span></span>
* <span data-ttu-id="81f07-158">Возникает, если контейнер удаляется и предпринимается попытка создать новый контейнер с тем же именем до завершения операции удаления.</span><span class="sxs-lookup"><span data-stu-id="81f07-158">Occurs if a container is being deleted, and you attempt to create a new container with the same name before the deletion operation is complete.</span></span>
* <span data-ttu-id="81f07-159">Возникает, если указать аренду контейнера или BLOB-объекта при ее наличии.</span><span class="sxs-lookup"><span data-stu-id="81f07-159">Occurs if you specify a lease on a container or blob, and there is already a lease present.</span></span>

<span data-ttu-id="81f07-160">**Примеры кода состояния 412 (необходимое условие не выполнено)**</span><span class="sxs-lookup"><span data-stu-id="81f07-160">**Status Code 412 (Precondition Failed) Examples**</span></span>

* <span data-ttu-id="81f07-161">Возникает, когда не было выполнено условие, заданное условным заголовком.</span><span class="sxs-lookup"><span data-stu-id="81f07-161">Occurs when the condition specified by a conditional header has not been met.</span></span>
* <span data-ttu-id="81f07-162">Возникает, когда указанный идентификатор аренды не соответствует идентификатору аренды контейнера или BLOB-объекта.</span><span class="sxs-lookup"><span data-stu-id="81f07-162">Occurs when the lease ID specified does not match the lease ID on the container or blob.</span></span>

## <a name="generate-log-files-for-analysis"></a><span data-ttu-id="81f07-163">Создание файлов журналов для анализа</span><span class="sxs-lookup"><span data-stu-id="81f07-163">Generate log files for analysis</span></span>
<span data-ttu-id="81f07-164">В этом учебнике мы будем использовать анализатор сообщений для работы с тремя различными типами файлов журнала, хотя можно работать с одним из них:</span><span class="sxs-lookup"><span data-stu-id="81f07-164">In this tutorial, we'll use Message Analyzer to work with three different types of log files, although you could choose to work with any one of these:</span></span>

* <span data-ttu-id="81f07-165">**Журнал сервера**, который создается при включении ведения журнала хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="81f07-165">The **server log**, which is created when you enable Azure Storage logging.</span></span> <span data-ttu-id="81f07-166">Журнал сервера содержит данные о каждой операции, вызываемой для одной из служб хранилища Azure — BLOB-объектов, очередей, таблиц и файлов.</span><span class="sxs-lookup"><span data-stu-id="81f07-166">The server log contains data about each operation called against one of the Azure Storage services - blob, queue, table, and file.</span></span> <span data-ttu-id="81f07-167">Журнал сервера указывает, какая операция была вызвана и какой код состояния был возвращен, а также другие сведения о запросе и ответе.</span><span class="sxs-lookup"><span data-stu-id="81f07-167">The server log indicates which operation was called and what status code was returned, as well as other details about the request and response.</span></span>
* <span data-ttu-id="81f07-168">**Журнал клиента .NET**, который создается при включении ведения журнала на стороне клиента из приложения .NET.</span><span class="sxs-lookup"><span data-stu-id="81f07-168">The **.NET client log**, which is created when you enable client-side logging from within your .NET application.</span></span> <span data-ttu-id="81f07-169">Журнал клиента содержит подробные сведения о том, как клиент готовит запрос, а также получает и обрабатывает ответ.</span><span class="sxs-lookup"><span data-stu-id="81f07-169">The client log includes detailed information about how the client prepares the request and receives and processes the response.</span></span>
* <span data-ttu-id="81f07-170">**Журнал трассировки сети HTTP**, который собирает сведения о данных HTTP/HTTPS-запросов и ответов, в том числе для операций в хранилище Azure.</span><span class="sxs-lookup"><span data-stu-id="81f07-170">The **HTTP network trace log**, which collects data on HTTP/HTTPS request and response data, including for operations against Azure Storage.</span></span> <span data-ttu-id="81f07-171">В этом учебнике мы создадим трассировку сети через анализатор сообщений.</span><span class="sxs-lookup"><span data-stu-id="81f07-171">In this tutorial, we'll generate the network trace via Message Analyzer.</span></span>

### <a name="configure-server-side-logging-and-metrics"></a><span data-ttu-id="81f07-172">Настройка серверных журналов и метрик</span><span class="sxs-lookup"><span data-stu-id="81f07-172">Configure server-side logging and metrics</span></span>
<span data-ttu-id="81f07-173">Во-первых, необходимо настроить ведение журнала хранилища Azure и метрик таким образом, чтобы у нас имелись данные из клиентского приложения для анализа.</span><span class="sxs-lookup"><span data-stu-id="81f07-173">First, we'll need to configure Azure Storage logging and metrics, so that we have data from the client application to analyze.</span></span> <span data-ttu-id="81f07-174">Ведение журнала и метрики можно настроить различными способами: через [портал Azure](https://portal.azure.com), с помощью PowerShell или программно.</span><span class="sxs-lookup"><span data-stu-id="81f07-174">You can configure logging and metrics in a variety of ways - via the [Azure portal](https://portal.azure.com), by using PowerShell, or programmatically.</span></span> <span data-ttu-id="81f07-175">Подробные сведения о настройке ведения журнала и метрик см. в статье [Включение метрик хранения и просмотр данных метрик](http://msdn.microsoft.com/library/azure/dn782843.aspx) и [Включение ведения журнала хранилища и доступ к данным журнала](http://msdn.microsoft.com/library/azure/dn782840.aspx) на сайте MSDN.</span><span class="sxs-lookup"><span data-stu-id="81f07-175">See [Enabling Storage Metrics and Viewing Metrics Data](http://msdn.microsoft.com/library/azure/dn782843.aspx) and [Enabling Storage Logging and Accessing Log Data](http://msdn.microsoft.com/library/azure/dn782840.aspx) on MSDN for details about configuring logging and metrics.</span></span>

<span data-ttu-id="81f07-176">**На портале Azure**</span><span class="sxs-lookup"><span data-stu-id="81f07-176">**Via the Azure portal**</span></span>

<span data-ttu-id="81f07-177">Чтобы настроить ведение журнала и метрики для учетной записи хранения с помощью [портала Azure](https://portal.azure.com), следуйте инструкциям в статье [Мониторинг учетной записи хранения на портале Azure](storage-monitor-storage-account.md).</span><span class="sxs-lookup"><span data-stu-id="81f07-177">To configure logging and metrics for your storage account using the [Azure portal](https://portal.azure.com), follow the instructions at [Monitor a storage account in the Azure portal](storage-monitor-storage-account.md).</span></span>

> [!NOTE]
> <span data-ttu-id="81f07-178">Поминутные метрики невозможно задавать с помощью портала Azure.</span><span class="sxs-lookup"><span data-stu-id="81f07-178">It's not possible to set minute metrics using the Azure portal.</span></span> <span data-ttu-id="81f07-179">Тем не менее рекомендуется установить их для целей данного учебника, а также для изучения проблем производительности в приложении.</span><span class="sxs-lookup"><span data-stu-id="81f07-179">However, we recommend that you do set them for the purposes of this tutorial, and for investigating performance issues with your application.</span></span> <span data-ttu-id="81f07-180">Поминутные метрики можно задать с помощью PowerShell, как показано ниже, или программно с помощью клиентской библиотеки хранилища.</span><span class="sxs-lookup"><span data-stu-id="81f07-180">You can set minute metrics using PowerShell as shown below, or programmatically using the storage client library.</span></span>
> 
> <span data-ttu-id="81f07-181">Обратите внимание, что на портале Azure невозможно отобразить поминутные метрики, так как доступны только почасовые метрики.</span><span class="sxs-lookup"><span data-stu-id="81f07-181">Note that the Azure portal cannot display minute metrics, only hourly metrics.</span></span>
> 
> 

<span data-ttu-id="81f07-182">**Через PowerShell**</span><span class="sxs-lookup"><span data-stu-id="81f07-182">**Via PowerShell**</span></span>

<span data-ttu-id="81f07-183">Чтобы начать работу с PowerShell для Azure, см. раздел [Как установить и настроить Azure PowerShell](/powershell/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="81f07-183">To get started with PowerShell for Azure, see [How to install and configure Azure PowerShell](/powershell/azure/overview).</span></span>

1. <span data-ttu-id="81f07-184">Выполните командлет [Add-AzureAccount](/powershell/module/azure/add-azureaccount?view=azuresmps-3.7.0) в окне PowerShell, чтобы добавить свою учетную запись пользователя Azure.</span><span class="sxs-lookup"><span data-stu-id="81f07-184">Use the [Add-AzureAccount](/powershell/module/azure/add-azureaccount?view=azuresmps-3.7.0) cmdlet to add your Azure user account to the PowerShell window:</span></span>
   
    ```powershell
    Add-AzureAccount
    ```

2. <span data-ttu-id="81f07-185">В окне **Вход в Microsoft Azure** введите адрес электронной почты и пароль, связанный с вашей учетной записью.</span><span class="sxs-lookup"><span data-stu-id="81f07-185">In the **Sign in to Microsoft Azure** window, type the email address and password associated with your account.</span></span> <span data-ttu-id="81f07-186">Azure выполняет проверку подлинности и сохраняет учетные данные, а затем закрывает окно.</span><span class="sxs-lookup"><span data-stu-id="81f07-186">Azure authenticates and saves the credential information, and then closes the window.</span></span>
3. <span data-ttu-id="81f07-187">Задайте в качестве учетной записи хранения по умолчанию учетную запись хранения, используемую для учебника, выполнив следующие команды в окне PowerShell:</span><span class="sxs-lookup"><span data-stu-id="81f07-187">Set the default storage account to the storage account you are using for the tutorial by executing these commands in the PowerShell window:</span></span>
   
    ```powershell
    $SubscriptionName = 'Your subscription name'
    $StorageAccountName = 'yourstorageaccount'
    Set-AzureSubscription -CurrentStorageAccountName $StorageAccountName -SubscriptionName $SubscriptionName
    ```

4. <span data-ttu-id="81f07-188">Включение ведения журнала хранилища для службы BLOB-объектов.</span><span class="sxs-lookup"><span data-stu-id="81f07-188">Enable storage logging for the Blob service:</span></span>
   
    ```powershell
    Set-AzureStorageServiceLoggingProperty -ServiceType Blob -LoggingOperations Read,Write,Delete -PassThru -RetentionDays 7 -Version 1.0
    ```

5. <span data-ttu-id="81f07-189">Включите метрики хранилища для службы BLOB-объектов, установив параметр **-MetricsType** в `Minute`:</span><span class="sxs-lookup"><span data-stu-id="81f07-189">Enable storage metrics for the Blob service, making sure to set **-MetricsType** to `Minute`:</span></span>
   
    ```powershell
    Set-AzureStorageServiceMetricsProperty -ServiceType Blob -MetricsType Minute -MetricsLevel ServiceAndApi -PassThru -RetentionDays 7 -Version 1.0
    ```

### <a name="configure-net-client-side-logging"></a><span data-ttu-id="81f07-190">Настройка ведения журнала на стороне клиента .NET</span><span class="sxs-lookup"><span data-stu-id="81f07-190">Configure .NET client-side logging</span></span>
<span data-ttu-id="81f07-191">Чтобы настроить ведение журнала клиентского приложения .NET, включите диагностику .NET в файле конфигурации приложения (web.config или app.config).</span><span class="sxs-lookup"><span data-stu-id="81f07-191">To configure client-side logging for a .NET application, enable .NET diagnostics in the application's configuration file (web.config or app.config).</span></span> <span data-ttu-id="81f07-192">Подробные сведения см. в статьях [Клиентские ведения журнала с клиентской библиотеки хранилища .NET](http://msdn.microsoft.com/library/azure/dn782839.aspx) и [Ведение журнала на стороне клиента с помощью SDK хранилища Microsoft Azure для Java](http://msdn.microsoft.com/library/azure/dn782844.aspx) на сайте MSDN.</span><span class="sxs-lookup"><span data-stu-id="81f07-192">See [Client-side Logging with the .NET Storage Client Library](http://msdn.microsoft.com/library/azure/dn782839.aspx) and [Client-side Logging with the Microsoft Azure Storage SDK for Java](http://msdn.microsoft.com/library/azure/dn782844.aspx) on MSDN for details.</span></span>

<span data-ttu-id="81f07-193">Клиентский журнал содержит подробные сведения о том, как клиент готовит запрос, получает и обрабатывает ответ.</span><span class="sxs-lookup"><span data-stu-id="81f07-193">The client-side log includes detailed information about how the client prepares the request and receives and processes the response.</span></span>

<span data-ttu-id="81f07-194">Клиентская библиотека хранилища хранит данные журнала на стороне клиента в расположении, указанном в файле конфигурации приложения (web.config или app.config).</span><span class="sxs-lookup"><span data-stu-id="81f07-194">The Storage Client Library stores client-side log data in the location specified in the application's configuration file (web.config or app.config).</span></span>

### <a name="collect-a-network-trace"></a><span data-ttu-id="81f07-195">Сбор данных трассировки сети</span><span class="sxs-lookup"><span data-stu-id="81f07-195">Collect a network trace</span></span>
<span data-ttu-id="81f07-196">Анализатор сообщений можно использовать для сбора данных трассировки сети HTTP или HTTPS во время выполнения клиентского приложения.</span><span class="sxs-lookup"><span data-stu-id="81f07-196">You can use Message Analyzer to collect an HTTP/HTTPS network trace while your client application is running.</span></span> <span data-ttu-id="81f07-197">Анализатор сообщений использует [Fiddler](http://www.telerik.com/fiddler) на внутреннем сервере.</span><span class="sxs-lookup"><span data-stu-id="81f07-197">Message Analyzer uses [Fiddler](http://www.telerik.com/fiddler) on the back end.</span></span> <span data-ttu-id="81f07-198">Перед началом сбора трассировки сети рекомендуется настроить Fiddler для записи незашифрованного трафика HTTPS:</span><span class="sxs-lookup"><span data-stu-id="81f07-198">Before you collect the network trace, we recommend that you configure Fiddler to record unencrypted HTTPS traffic:</span></span>

1. <span data-ttu-id="81f07-199">Установите [Fiddler](http://www.telerik.com/download/fiddler).</span><span class="sxs-lookup"><span data-stu-id="81f07-199">Install [Fiddler](http://www.telerik.com/download/fiddler).</span></span>
2. <span data-ttu-id="81f07-200">Запустите Fiddler.</span><span class="sxs-lookup"><span data-stu-id="81f07-200">Launch Fiddler.</span></span>
3. <span data-ttu-id="81f07-201">Выберите **Инструменты | Параметры Fiddler**.</span><span class="sxs-lookup"><span data-stu-id="81f07-201">Select **Tools | Fiddler Options**.</span></span>
4. <span data-ttu-id="81f07-202">Убедитесь, что в диалоговом окне "Параметры" выбраны пункты **Захват подключений HTTPS** и **Расшифровка трафика HTTPS**, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="81f07-202">In the Options dialog, ensure that **Capture HTTPS CONNECTs** and **Decrypt HTTPS Traffic** are both selected, as shown below.</span></span>

![Настройка параметров Fiddler](./media/storage-e2e-troubleshooting/fiddler-options-1.png)

<span data-ttu-id="81f07-204">В учебнике сначала производится сбор и сохранение сетевой трассировки в анализаторе сообщений, а затем создание сеанса анализа для анализа трассировки и журналов.</span><span class="sxs-lookup"><span data-stu-id="81f07-204">For the tutorial, collect and save a network trace first in Message Analyzer, then create an analysis session to analyze the trace and the logs.</span></span> <span data-ttu-id="81f07-205">Сбор трассировки сети в анализаторе сообщений:</span><span class="sxs-lookup"><span data-stu-id="81f07-205">To collect a network trace in Message Analyzer:</span></span>

1. <span data-ttu-id="81f07-206">В анализаторе сообщений выберите **Файл | Быстрая трассировка | HTTPS в незашифрованном виде**.</span><span class="sxs-lookup"><span data-stu-id="81f07-206">In Message Analyzer, select **File | Quick Trace | Unencrypted HTTPS**.</span></span>
2. <span data-ttu-id="81f07-207">Немедленно начнется трассировка.</span><span class="sxs-lookup"><span data-stu-id="81f07-207">The trace will begin immediately.</span></span> <span data-ttu-id="81f07-208">Выберите **Остановить** , чтобы остановить трассировку и настроить для трассировки только трафик хранилища.</span><span class="sxs-lookup"><span data-stu-id="81f07-208">Select **Stop** to stop the trace so that we can configure it to trace storage traffic only.</span></span>
3. <span data-ttu-id="81f07-209">Выберите **Изменить** для изменения сеанса трассировки.</span><span class="sxs-lookup"><span data-stu-id="81f07-209">Select **Edit** to edit the tracing session.</span></span>
4. <span data-ttu-id="81f07-210">Выберите ссылку **Настройка** справа от поставщика трассировки событий Windows **Microsoft-Pef-WebProxy**.</span><span class="sxs-lookup"><span data-stu-id="81f07-210">Select the **Configure** link to the right of the **Microsoft-Pef-WebProxy** ETW provider.</span></span>
5. <span data-ttu-id="81f07-211">В диалоговом окне **Дополнительные параметры** щелкните вкладку **Поставщик**.</span><span class="sxs-lookup"><span data-stu-id="81f07-211">In the **Advanced Settings** dialog, click the **Provider** tab.</span></span>
6. <span data-ttu-id="81f07-212">В поле **Фильтр по имени узла** укажите конечные точки хранилища, разделенные пробелами.</span><span class="sxs-lookup"><span data-stu-id="81f07-212">In the **Hostname Filter** field, specify your storage endpoints, separated by spaces.</span></span> <span data-ttu-id="81f07-213">Например, можно указать конечные точки следующим образом, изменив `storagesample` на имя учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="81f07-213">For example, you can specify your endpoints as follows; change `storagesample` to the name of your storage account:</span></span>

    ```   
    storagesample.blob.core.windows.net storagesample.queue.core.windows.net storagesample.table.core.windows.net
    ```

7. <span data-ttu-id="81f07-214">Выйдите из диалогового окна и нажмите кнопку **Перезапуск** для начала сбора трассировки с фильтром по имени узла, чтобы в трассировку включался только сетевой трафик службы хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="81f07-214">Exit the dialog, and click **Restart** to begin collecting the trace with the hostname filter in place, so that only Azure Storage network traffic is included in the trace.</span></span>

> [!NOTE]
> <span data-ttu-id="81f07-215">После завершения сбора трассировки сети настоятельно рекомендуется восстанавливать параметры, которые могли быть изменены Fiddler для расшифровки HTTPS-трафика.</span><span class="sxs-lookup"><span data-stu-id="81f07-215">After you have finished collecting your network trace, we strongly recommend that you revert the settings that you may have changed in Fiddler to decrypt HTTPS traffic.</span></span> <span data-ttu-id="81f07-216">В диалоговом окне "Параметры Fiddler" снимите флажки **Захват подключений HTTPS** и **Расшифровка трафика HTTPS**.</span><span class="sxs-lookup"><span data-stu-id="81f07-216">In the Fiddler Options dialog, deselect the **Capture HTTPS CONNECTs** and **Decrypt HTTPS Traffic** checkboxes.</span></span>
> 
> 

<span data-ttu-id="81f07-217">Для получения дополнительных сведений см. раздел [Использование трассировки сети](http://technet.microsoft.com/library/jj674819.aspx) в библиотеке Technet.</span><span class="sxs-lookup"><span data-stu-id="81f07-217">See [Using the Network Tracing Features](http://technet.microsoft.com/library/jj674819.aspx) on Technet for more details.</span></span>

## <a name="review-metrics-data-in-the-azure-portal"></a><span data-ttu-id="81f07-218">Просмотр данных метрик на портале Azure</span><span class="sxs-lookup"><span data-stu-id="81f07-218">Review metrics data in the Azure portal</span></span>
<span data-ttu-id="81f07-219">После того как приложение будет выполняться в течение какого-то времени, можно просмотреть диаграммы метрик, отображаемые на [портале Azure](https://portal.azure.com), чтобы проверить выполнение операций службой.</span><span class="sxs-lookup"><span data-stu-id="81f07-219">Once your application has been running for a period of time, you can review the metrics charts that appear in the [Azure portal](https://portal.azure.com) to observe how your service has been performing.</span></span>

<span data-ttu-id="81f07-220">Сначала войдите в свою учетную запись хранения на портале Azure.</span><span class="sxs-lookup"><span data-stu-id="81f07-220">First, navigate to your storage account in the Azure portal.</span></span> <span data-ttu-id="81f07-221">По умолчанию диаграмма мониторинга с метрикой **процента успешных операций** отображается в колонке учетной записи.</span><span class="sxs-lookup"><span data-stu-id="81f07-221">By default, a monitoring chart with the **Success percentage** metric is displayed on the account blade.</span></span> <span data-ttu-id="81f07-222">Если ранее вы изменили диаграмму для отображения различных метрик, добавьте метрику **процента успешных операций**.</span><span class="sxs-lookup"><span data-stu-id="81f07-222">If you've previously modified the chart to display different metrics, add the **Success percentage** metric.</span></span>

<span data-ttu-id="81f07-223">В диаграмме наблюдения появится метрика **процента успешных операций**, а также любые другие метрики, которые могли быть добавлены ранее.</span><span class="sxs-lookup"><span data-stu-id="81f07-223">You'll now see **Success percentage** in the monitoring chart, along with any other metrics you may have added.</span></span> <span data-ttu-id="81f07-224">По нашему сценарию путем анализа журналов в анализаторе сообщений мы постараемся узнать, почему доля успешных операций немного ниже 100 %.</span><span class="sxs-lookup"><span data-stu-id="81f07-224">In the scenario we'll investigate next by analyzing the logs in Message Analyzer, the percent success rate is somewhat below 100%.</span></span>

<span data-ttu-id="81f07-225">Дополнительные сведения о добавлении и настройке диаграмм метрик см. в разделе о [настройке диаграмм метрик](storage-monitor-storage-account.md#customize-metrics-charts).</span><span class="sxs-lookup"><span data-stu-id="81f07-225">For more details on adding and customizing metrics charts, see [Customize metrics charts](storage-monitor-storage-account.md#customize-metrics-charts).</span></span>

> [!NOTE]
> <span data-ttu-id="81f07-226">После включения метрик хранилища может потребоваться некоторое время, чтобы данные метрик отобразились на портале Azure.</span><span class="sxs-lookup"><span data-stu-id="81f07-226">It may take some time for your metrics data to appear in the Azure portal after you enable storage metrics.</span></span> <span data-ttu-id="81f07-227">Это вызвано тем, что почасовые метрики для предыдущего часа не отображаются на портале Azure, пока не истечет текущий час.</span><span class="sxs-lookup"><span data-stu-id="81f07-227">This is because hourly metrics for the previous hour are not displayed in the Azure portal until the current hour has elapsed.</span></span> <span data-ttu-id="81f07-228">Кроме того, в настоящее время на портале Azure не отображаются поминутные метрики.</span><span class="sxs-lookup"><span data-stu-id="81f07-228">Also, minute metrics are not currently displayed in the Azure portal.</span></span> <span data-ttu-id="81f07-229">Поэтому в зависимости от времени включения метрик может потребоваться до двух часов, чтобы увидеть данные метрик на портале.</span><span class="sxs-lookup"><span data-stu-id="81f07-229">So depending on when you enable metrics, it may take up to two hours to see metrics data.</span></span>
> 
> 

## <a name="use-azcopy-to-copy-server-logs-to-a-local-directory"></a><span data-ttu-id="81f07-230">Использование AzCopy для копирования журналов сервера в локальный каталог</span><span class="sxs-lookup"><span data-stu-id="81f07-230">Use AzCopy to copy server logs to a local directory</span></span>
<span data-ttu-id="81f07-231">Хранилища Azure записывает данные журналов сервера в BLOB-объекты, а метрики записываются в таблицы.</span><span class="sxs-lookup"><span data-stu-id="81f07-231">Azure Storage writes server log data to blobs, while metrics are written to tables.</span></span> <span data-ttu-id="81f07-232">BLOB-объекты журнала доступны в уже известном контейнере `$logs` для учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="81f07-232">Log blobs are available in the well-known `$logs` container for your storage account.</span></span> <span data-ttu-id="81f07-233">BLOB-объекты журнала именуются иерархически годом, месяцем, днем и часом, так что можно легко найти диапазон времени, который нужно проанализировать.</span><span class="sxs-lookup"><span data-stu-id="81f07-233">Log blobs are named hierarchically by year, month, day, and hour, so that you can easily locate the range of time you wish to investigate.</span></span> <span data-ttu-id="81f07-234">Например, в `storagesample` учетной записи контейнер BLOB-объектов журнала на 02.01.2015 г. с 8:00 до 9:00 часов имеет имя `https://storagesample.blob.core.windows.net/$logs/blob/2015/01/08/0800`.</span><span class="sxs-lookup"><span data-stu-id="81f07-234">For example, in the `storagesample` account, the container for the log blobs for 01/02/2015, from 8-9 am, is `https://storagesample.blob.core.windows.net/$logs/blob/2015/01/08/0800`.</span></span> <span data-ttu-id="81f07-235">Отдельные BLOB-объекты в этом контейнере называются последовательно, начиная с `000000.log`.</span><span class="sxs-lookup"><span data-stu-id="81f07-235">The individual blobs in this container are named sequentially, beginning with `000000.log`.</span></span>

<span data-ttu-id="81f07-236">Можно использовать программу командной строки AzCopy для скачивания этих файлов журнала на стороне сервера на локальный компьютер.</span><span class="sxs-lookup"><span data-stu-id="81f07-236">You can use the AzCopy command-line tool to download these server-side log files to a location of your choice on your local machine.</span></span> <span data-ttu-id="81f07-237">Например, можно использовать следующую команду для загрузки файлов журналов для больших двоичных объектов операций, выполняемых на 2 января 2015 г., в папку `C:\Temp\Logs\Server`; замените `<storageaccountname>` на имя вашей учетной записи хранения и `<storageaccountkey>` на ключ доступа к учетной записи.</span><span class="sxs-lookup"><span data-stu-id="81f07-237">For example, you can use the following command to download the log files for blob operations that took place on January 2, 2015 to the folder `C:\Temp\Logs\Server`; replace `<storageaccountname>` with the name of your storage account, and `<storageaccountkey>` with your account access key:</span></span>

```azcopy
AzCopy.exe /Source:http://<storageaccountname>.blob.core.windows.net/$logs /Dest:C:\Temp\Logs\Server /Pattern:"blob/2015/01/02" /SourceKey:<storageaccountkey> /S /V
```
<span data-ttu-id="81f07-238">AzCopy можно скачать на странице [Загрузки Azure](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="81f07-238">AzCopy is available for download on the [Azure Downloads](https://azure.microsoft.com/downloads/) page.</span></span> <span data-ttu-id="81f07-239">Дополнительные сведения об использовании AzCopy см. в статье [Передача данных с помощью служебной программы командной строки AzCopy](storage-use-azcopy.md).</span><span class="sxs-lookup"><span data-stu-id="81f07-239">For details about using AzCopy, see [Transfer data with the AzCopy Command-Line Utility](storage-use-azcopy.md).</span></span>

<span data-ttu-id="81f07-240">Дополнительные сведения о скачивании серверных журналов см. в разделе [Загрузка данных журнала хранилища](http://msdn.microsoft.com/library/azure/dn782840.aspx#DownloadingStorageLogginglogdata).</span><span class="sxs-lookup"><span data-stu-id="81f07-240">For additional information about downloading server-side logs, see [Download Storage Logging log data](http://msdn.microsoft.com/library/azure/dn782840.aspx#DownloadingStorageLogginglogdata).</span></span>

## <a name="use-microsoft-message-analyzer-to-analyze-log-data"></a><span data-ttu-id="81f07-241">Использование анализатора сообщений (Майкрософт) для анализа данных журнала</span><span class="sxs-lookup"><span data-stu-id="81f07-241">Use Microsoft Message Analyzer to analyze log data</span></span>
<span data-ttu-id="81f07-242">Анализатор сообщений (Майкрософт) — это средство для записи, отображения и анализа протокола обмена сообщениями трафика, событий и других сообщений системы или приложений в сценариях устранения неполадок и диагностики.</span><span class="sxs-lookup"><span data-stu-id="81f07-242">Microsoft Message Analyzer is a tool for capturing, displaying, and analyzing protocol messaging traffic, events, and other system or application messages in troubleshooting and diagnostic scenarios.</span></span> <span data-ttu-id="81f07-243">Анализатор сообщений также дает возможность загрузки, статистической обработки и анализа данных из журнала и сохраненных файлов трассировки.</span><span class="sxs-lookup"><span data-stu-id="81f07-243">Message Analyzer also enables you to load, aggregate, and analyze data from log and saved trace files.</span></span> <span data-ttu-id="81f07-244">Для получения дополнительных сведений об анализаторе сообщений см. [Руководство по работе с анализатором сообщений (Майкрософт)](http://technet.microsoft.com/library/jj649776.aspx).</span><span class="sxs-lookup"><span data-stu-id="81f07-244">For more information about Message Analyzer, see [Microsoft Message Analyzer Operating Guide](http://technet.microsoft.com/library/jj649776.aspx).</span></span>

<span data-ttu-id="81f07-245">Анализатор сообщений включает средства для хранилища Azure, которые помогают анализировать журналы сервера, клиента и сети.</span><span class="sxs-lookup"><span data-stu-id="81f07-245">Message Analyzer includes assets for Azure Storage that help you to analyze server, client, and network logs.</span></span> <span data-ttu-id="81f07-246">В этом разделе мы обсудим, как использовать эти средства для решения конкретной проблемы низкого процента успешных операций в журналах хранилища.</span><span class="sxs-lookup"><span data-stu-id="81f07-246">In this section, we'll discuss how to use those tools to address the issue of low percent success in the storage logs.</span></span>

### <a name="download-and-install-message-analyzer-and-the-azure-storage-assets"></a><span data-ttu-id="81f07-247">Скачивание и установка анализатора сообщений и ресурсов службы хранилища Azure</span><span class="sxs-lookup"><span data-stu-id="81f07-247">Download and install Message Analyzer and the Azure Storage Assets</span></span>
1. <span data-ttu-id="81f07-248">Загрузите [анализатор сообщений](http://www.microsoft.com/download/details.aspx?id=44226) из Центра загрузки Майкрософт и запустите программу установки.</span><span class="sxs-lookup"><span data-stu-id="81f07-248">Download [Message Analyzer](http://www.microsoft.com/download/details.aspx?id=44226) from the Microsoft Download Center, and run the installer.</span></span>
2. <span data-ttu-id="81f07-249">Запустите анализатор сообщений.</span><span class="sxs-lookup"><span data-stu-id="81f07-249">Launch Message Analyzer.</span></span>
3. <span data-ttu-id="81f07-250">В меню **Инструменты** выберите **Диспетчер ресурсов**.</span><span class="sxs-lookup"><span data-stu-id="81f07-250">From the **Tools** menu, select **Asset Manager**.</span></span> <span data-ttu-id="81f07-251">В окне **Диспетчер ресурсов** выберите **Загрузки** и отфильтруйте данные для **хранилища Azure**.</span><span class="sxs-lookup"><span data-stu-id="81f07-251">In the **Asset Manager** dialog, select **Downloads**, then filter on **Azure Storage**.</span></span> <span data-ttu-id="81f07-252">Вы увидите ресурсы хранилища Azure, как показано на рисунке ниже.</span><span class="sxs-lookup"><span data-stu-id="81f07-252">You will see the Azure Storage Assets, as shown in the picture below.</span></span>
4. <span data-ttu-id="81f07-253">Щелкните **Синхронизировать все отображаемые элементы** для установки ресурсов хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="81f07-253">Click **Sync All Displayed Items** to install the Azure Storage Assets.</span></span> <span data-ttu-id="81f07-254">Доступные ресурсы включают:</span><span class="sxs-lookup"><span data-stu-id="81f07-254">The available assets include:</span></span>
   * <span data-ttu-id="81f07-255">**Цветовые правила хранилища Azure.** Цветовые правила хранилища Azure позволяют определить специальные фильтры, использующие стили шрифта, текст и цвет для выделения сообщений, содержащих определенные данные трассировки.</span><span class="sxs-lookup"><span data-stu-id="81f07-255">**Azure Storage Color Rules:** Azure Storage color rules enable you to define special filters that use color, text, and font styles to highlight messages that contain specific information in a trace.</span></span>
   * <span data-ttu-id="81f07-256">**Диаграммы хранилища Azure.** Диаграммы хранилища Azure — стандартные диаграммы, отображающие данные журнала сервера.</span><span class="sxs-lookup"><span data-stu-id="81f07-256">**Azure Storage Charts:** Azure Storage charts are predefined charts that graph server log data.</span></span> <span data-ttu-id="81f07-257">Обратите внимание, что для использования диаграмм хранилища Azure в настоящее время можно только загружать журнал сервера в сетку анализа.</span><span class="sxs-lookup"><span data-stu-id="81f07-257">Note that to use Azure Storage charts at this time, you may only load the server log into the Analysis Grid.</span></span>
   * <span data-ttu-id="81f07-258">**Синтаксические анализаторы хранилища Azure.** Синтаксические анализаторы хранилища Azure позволяют проанализировать журналы HTTP, сервера и клиента хранилища Azure для их отображения в сетке анализа.</span><span class="sxs-lookup"><span data-stu-id="81f07-258">**Azure Storage Parsers:** The Azure Storage parsers parse the Azure Storage client, server, and HTTP logs in order to display them in the Analysis Grid.</span></span>
   * <span data-ttu-id="81f07-259">**Фильтры хранилища Azure.** Фильтры хранилища Azure являются предопределенными критериями, которые можно использовать для запроса данных в сетке анализа.</span><span class="sxs-lookup"><span data-stu-id="81f07-259">**Azure Storage Filters:** Azure Storage filters are predefined criteria that you can use to query your data in the Analysis Grid.</span></span>
   * <span data-ttu-id="81f07-260">**Макеты представления хранилища Azure.** Макеты представления хранилища Azure — это предопределенные макеты и группировки в сетке анализа.</span><span class="sxs-lookup"><span data-stu-id="81f07-260">**Azure Storage View Layouts:** Azure Storage view layouts are predefined column layouts and groupings in the Analysis Grid.</span></span>
5. <span data-ttu-id="81f07-261">После установки ресурсов перезапустите анализатор сообщений.</span><span class="sxs-lookup"><span data-stu-id="81f07-261">Restart Message Analyzer after you've installed the assets.</span></span>

![Диспетчер ресурсов в анализаторе сообщений](./media/storage-e2e-troubleshooting/mma-start-page-1.png)

> [!NOTE]
> <span data-ttu-id="81f07-263">Для целей данного учебника установите все ресурсы хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="81f07-263">Install all of the Azure Storage assets shown for the purposes of this tutorial.</span></span>
> 
> 

### <a name="import-your-log-files-into-message-analyzer"></a><span data-ttu-id="81f07-264">Импорт файлов журнала в анализатор сообщений</span><span class="sxs-lookup"><span data-stu-id="81f07-264">Import your log files into Message Analyzer</span></span>
<span data-ttu-id="81f07-265">Все сохраненные файлы журнала (серверного, клиентского и сетевого) можно импортировать в один сеанс анализатора сообщений (Майкрософт) для проведения анализа.</span><span class="sxs-lookup"><span data-stu-id="81f07-265">You can import all of your saved log files (server-side, client-side, and network) into a single session in Microsoft Message Analyzer for analysis.</span></span>

1. <span data-ttu-id="81f07-266">В меню **Файл** анализатора сообщений (Майкрософт) щелкните **Новый сеанс** и нажмите кнопку **Пустой сеанс**.</span><span class="sxs-lookup"><span data-stu-id="81f07-266">On the **File** menu in Microsoft Message Analyzer, click **New Session**, and then click **Blank Session**.</span></span> <span data-ttu-id="81f07-267">В диалоговом окне **Новый сеанс** введите имя для сеанса анализа.</span><span class="sxs-lookup"><span data-stu-id="81f07-267">In the **New Session** dialog, enter a name for your analysis session.</span></span> <span data-ttu-id="81f07-268">На панели **Подробные сведения о сеансе** щелкните **Файлы**.</span><span class="sxs-lookup"><span data-stu-id="81f07-268">In the **Session Details** panel, click on the **Files** button.</span></span>
2. <span data-ttu-id="81f07-269">Чтобы загрузить данные трассировки сети, созданные анализатором сообщений, нажмите кнопку **Добавить файлы**, перейдите в папку, в которой был сохранен файл MATP сеанса веб-трассировки, выберите файл MATP и нажмите кнопку **Открыть**.</span><span class="sxs-lookup"><span data-stu-id="81f07-269">To load the network trace data generated by Message Analyzer, click on **Add Files**, browse to the location where you saved your .matp file from your web tracing session, select the .matp file, and click **Open**.</span></span>
3. <span data-ttu-id="81f07-270">Чтобы загрузить данные журнала сервера, нажмите кнопку **Добавить файлы**, перейдите в папку, куда были загружены серверные журналы, выберите диапазон времени файлов журнала, который необходимо проанализировать, а затем нажмите кнопку **Открыть**.</span><span class="sxs-lookup"><span data-stu-id="81f07-270">To load the server-side log data, click on **Add Files**, browse to the location where you downloaded your server-side logs, select the log files for the time range you want to analyze, and click **Open**.</span></span> <span data-ttu-id="81f07-271">Затем на панели **Подробные сведения о сеансе** установите значение из раскрывающегося списка **Параметры текста журнала** для каждого файла журнала сервера в **AzureStorageLog**, чтобы анализатор сообщений (Майкрософт) мог правильно проанализировать файл журнала.</span><span class="sxs-lookup"><span data-stu-id="81f07-271">Then, in the **Session Details** panel, set the **Text Log Configuration** drop-down for each server-side log file to **AzureStorageLog** to ensure that Microsoft Message Analyzer can parse the log file correctly.</span></span>
4. <span data-ttu-id="81f07-272">Чтобы загрузить данные журнала на стороне клиента, нажмите кнопку **Добавить файлы**, перейдите в папку, где были сохранены клиентские журналы, выберите файлы журнала, которые нужно проанализировать, и нажмите кнопку **Открыть**.</span><span class="sxs-lookup"><span data-stu-id="81f07-272">To load the client-side log data, click on **Add Files**, browse to the location where you saved your client-side logs, select the log files you want to analyze, and click **Open**.</span></span> <span data-ttu-id="81f07-273">Затем на панели **Подробные сведения о сеансе** установите значение из раскрывающегося списка **Параметры текста журнала** для каждого файла журнала клиента в **AzureStorageClientDotNetV4**, чтобы анализатор сообщений (Майкрософт) мог правильно проанализировать файл журнала.</span><span class="sxs-lookup"><span data-stu-id="81f07-273">Then, in the **Session Details** panel, set the **Text Log Configuration** drop-down for each client-side log file to **AzureStorageClientDotNetV4** to ensure that Microsoft Message Analyzer can parse the log file correctly.</span></span>
5. <span data-ttu-id="81f07-274">Щелкните **Запуск** в диалоговом окне **Новый сеанс**, чтобы загрузить и проанализировать данные журнала.</span><span class="sxs-lookup"><span data-stu-id="81f07-274">Click **Start** in the **New Session** dialog to load and parse the log data.</span></span> <span data-ttu-id="81f07-275">Данные журнала отображаются в сетке анализа анализатора сообщений.</span><span class="sxs-lookup"><span data-stu-id="81f07-275">The log data displays in the Message Analyzer Analysis Grid.</span></span>

<span data-ttu-id="81f07-276">На рисунке ниже показан пример сеанса, настроенного для анализа файлов журналов сервера, клиента и журнала трассировки сети.</span><span class="sxs-lookup"><span data-stu-id="81f07-276">The picture below shows an example session configured with server, client, and network trace log files.</span></span>

![Настройка сеанса анализатора сообщений](./media/storage-e2e-troubleshooting/configure-mma-session-1.png)

<span data-ttu-id="81f07-278">Обратите внимание, что анализатор сообщений загружает файлы журнала в память.</span><span class="sxs-lookup"><span data-stu-id="81f07-278">Note that Message Analyzer loads log files into memory.</span></span> <span data-ttu-id="81f07-279">При наличии больших объемов данных журнала необходимо фильтровать их для получения наилучшей производительности с помощью анализатора сообщения.</span><span class="sxs-lookup"><span data-stu-id="81f07-279">If you have a large set of log data, you will want to filter it in order to get the best performance from Message Analyzer.</span></span>

<span data-ttu-id="81f07-280">Во-первых, определите промежуток времени, который вас интересует, стараясь делать так, чтобы этот промежуток времени был небольшим.</span><span class="sxs-lookup"><span data-stu-id="81f07-280">First, determine the time frame that you are interested in reviewing, and keep this time frame as small as possible.</span></span> <span data-ttu-id="81f07-281">В большинстве случаев требуется просмотреть период в несколько минут или часов.</span><span class="sxs-lookup"><span data-stu-id="81f07-281">In many cases you will want to review a period of minutes or hours at most.</span></span> <span data-ttu-id="81f07-282">Импортируйте наименьший необходимый набор журналов, который сможет отвечать вашим потребностям.</span><span class="sxs-lookup"><span data-stu-id="81f07-282">Import the smallest set of logs that can meet your needs.</span></span>

<span data-ttu-id="81f07-283">Если по-прежнему имеется большой объем данных журнала, может потребоваться указать фильтр сеанса для фильтрации данных журнала до его загрузки.</span><span class="sxs-lookup"><span data-stu-id="81f07-283">If you still have a large amount of log data, then you may want to specify a session filter to filter your log data before you load it.</span></span> <span data-ttu-id="81f07-284">В поле **Фильтр сеанса** нажмите кнопку **Библиотека**, чтобы выбрать стандартный фильтр. Например, выберите **Глобальный фильтр времени I** из фильтров службы хранилища Azure для фильтрации по определенному интервалу времени.</span><span class="sxs-lookup"><span data-stu-id="81f07-284">In the **Session Filter** box, select the **Library** button to choose a predefined filter; for example, choose **Global Time Filter I** from the Azure Storage filters to filter on a time interval.</span></span> <span data-ttu-id="81f07-285">Затем можно изменить условия фильтра для указания начальной и конечной отметки времени требуемого интервала.</span><span class="sxs-lookup"><span data-stu-id="81f07-285">You can then edit the filter criteria to specify the starting and ending timestamp for the interval you want to see.</span></span> <span data-ttu-id="81f07-286">Также можно фильтровать по коду определенного состояния. Например, можно загрузить только записи журнала, где код состояния равен 404.</span><span class="sxs-lookup"><span data-stu-id="81f07-286">You can also filter on a particular status code; for example, you can choose to load only log entries where the status code is 404.</span></span>

<span data-ttu-id="81f07-287">Дополнительные сведения об импорте данных журнала в анализатор сообщений (Майкрософт) см. в разделе [Получение данных сообщений](http://technet.microsoft.com/library/dn772437.aspx) на сайте TechNet.</span><span class="sxs-lookup"><span data-stu-id="81f07-287">For more information about importing log data into Microsoft Message Analyzer, see [Retrieving Message Data](http://technet.microsoft.com/library/dn772437.aspx) on TechNet.</span></span>

### <a name="use-the-client-request-id-to-correlate-log-file-data"></a><span data-ttu-id="81f07-288">Использование идентификатора запроса клиента для сопоставления данных файла журнала</span><span class="sxs-lookup"><span data-stu-id="81f07-288">Use the client request ID to correlate log file data</span></span>
<span data-ttu-id="81f07-289">Клиентская библиотека хранилища Azure автоматически создает уникальный код запроса клиента для каждого запроса.</span><span class="sxs-lookup"><span data-stu-id="81f07-289">The Azure Storage Client Library automatically generates a unique client request ID for every request.</span></span> <span data-ttu-id="81f07-290">Это значение записывается в журнал клиента, журнал сервера и трассировки сети, чтобы его можно было использовать для сопоставления данных всех трех журналов в анализаторе сообщений.</span><span class="sxs-lookup"><span data-stu-id="81f07-290">This value is written to the client log, the server log, and the network trace, so you can use it to correlate data across all three logs within Message Analyzer.</span></span> <span data-ttu-id="81f07-291">В разделе [Идентификатор запроса клиента](storage-monitoring-diagnosing-troubleshooting.md#client-request-id) приведены дополнительные сведения о идентификаторе запроса клиента.</span><span class="sxs-lookup"><span data-stu-id="81f07-291">See [Client request ID](storage-monitoring-diagnosing-troubleshooting.md#client-request-id) for additional information about the client request ID.</span></span>

<span data-ttu-id="81f07-292">В следующих разделах описываются способы использования предварительно настроенных и пользовательских макетов представления для сопоставления и группировки данных на основании идентификатора запроса клиента.</span><span class="sxs-lookup"><span data-stu-id="81f07-292">The sections below describe how to use pre-configured and custom layout views to correlate and group data based on the client request ID.</span></span>

### <a name="select-a-view-layout-to-display-in-the-analysis-grid"></a><span data-ttu-id="81f07-293">Выбор макета представления для отображения в сетке анализа</span><span class="sxs-lookup"><span data-stu-id="81f07-293">Select a view layout to display in the Analysis Grid</span></span>
<span data-ttu-id="81f07-294">Ресурсы хранилища для анализатора сообщения включают макеты хранилища Azure, которые представляют собой предварительно настроенные представления, которые можно использовать для отображения данных с помощью полезного группирования и столбцы для различных сценариев.</span><span class="sxs-lookup"><span data-stu-id="81f07-294">The Storage Assets for Message Analyzer include Azure Storage View Layouts, which are pre-configured views that you can use to display your data with useful groupings and columns for different scenarios.</span></span> <span data-ttu-id="81f07-295">Также можно создавать пользовательские макеты и сохранять их для повторного использования.</span><span class="sxs-lookup"><span data-stu-id="81f07-295">You can also create custom view layouts and save them for reuse.</span></span>

<span data-ttu-id="81f07-296">Ниже показано меню **Макет представления**, которое можно открыть, выбрав **Макет представления** на ленте инструментов.</span><span class="sxs-lookup"><span data-stu-id="81f07-296">The picture below shows the **View Layout** menu, available by selecting **View Layout** from the toolbar ribbon.</span></span> <span data-ttu-id="81f07-297">Макеты для службы хранилища Azure сгруппированы в узле меню **Служба хранилища Azure** .</span><span class="sxs-lookup"><span data-stu-id="81f07-297">The view layouts for Azure Storage are grouped under the **Azure Storage** node in the menu.</span></span> <span data-ttu-id="81f07-298">Можно искать `Azure Storage` в поле поиска для фильтрации просмотра макетов только для службы хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="81f07-298">You can search for `Azure Storage` in the search box to filter on Azure Storage view layouts only.</span></span> <span data-ttu-id="81f07-299">Можно также выбрать звездочку рядом с представлением макета, чтобы добавить его в избранные и отображать в верхней части меню.</span><span class="sxs-lookup"><span data-stu-id="81f07-299">You can also select the star next to a view layout to make it a favorite and display it at the top of the menu.</span></span>

![Меню макета представления](./media/storage-e2e-troubleshooting/view-layout-menu.png)

<span data-ttu-id="81f07-301">Сначала выберите **Сгруппированы по ClientRequestID и модулю**.</span><span class="sxs-lookup"><span data-stu-id="81f07-301">To begin with, select **Grouped by ClientRequestID and Module**.</span></span> <span data-ttu-id="81f07-302">Этот макет представления группирует данные журналов из всех трех журналов сначала по идентификатору запроса клиента, а затем по исходному файлу журнала (или **модулю** в анализаторе сообщений).</span><span class="sxs-lookup"><span data-stu-id="81f07-302">This view layout groups log data from all three logs first by client request ID, then by source log file (or **Module** in Message Analyzer).</span></span> <span data-ttu-id="81f07-303">В этом представлении можно детализировать укрупнением идентификатор запроса конкретного клиента и просматривать данные из всех трех журналов для запроса клиента по идентификатору.</span><span class="sxs-lookup"><span data-stu-id="81f07-303">With this view, you can drill down into a particular client request ID, and see data from all three log files for that client request ID.</span></span>

<span data-ttu-id="81f07-304">На рисунке ниже показан этот режим применительно к примеру данных журнала с подмножеством отображаемых столбцов.</span><span class="sxs-lookup"><span data-stu-id="81f07-304">The picture below shows this layout view applied to the sample log data, with a subset of columns displayed.</span></span> <span data-ttu-id="81f07-305">Видно, что для конкретного идентификатора запроса клиента сетка анализа отображает данные из журнала клиента, журнала сервера и трассировки сети.</span><span class="sxs-lookup"><span data-stu-id="81f07-305">You can see that for a particular client request ID, the Analysis Grid displays data from the client log, server log, and network trace.</span></span>

![Макет представления хранилища Azure](./media/storage-e2e-troubleshooting/view-layout-client-request-id-module.png)

> [!NOTE]
> <span data-ttu-id="81f07-307">Файлы журналов имеют разные столбцы, поэтому при отображении данных из нескольких файлов журналов в сетке анализа некоторые столбцы могут не содержать данные для конкретной строки.</span><span class="sxs-lookup"><span data-stu-id="81f07-307">Different log files have different columns, so when data from multiple log files is displayed in the Analysis Grid, some columns may not contain any data for a given row.</span></span> <span data-ttu-id="81f07-308">Например, на вышеприведенном рисунке в строках журнала клиента отсутствуют данные для столбцов **Отметка времени**, **Прошло времени**, **Источник** и **Назначение**, так как эти столбцы отсутствуют в журнале клиента, но присутствуют в трассировке сети.</span><span class="sxs-lookup"><span data-stu-id="81f07-308">For example, in the picture above, the client log rows do not show any data for the **Timestamp**, **TimeElapsed**, **Source**, and **Destination** columns, because these columns do not exist in the client log, but do exist in the network trace.</span></span> <span data-ttu-id="81f07-309">Аналогичным образом в столбце **Отметка времени** отображаются данные об отметках времени из журнала сервера, но не отображаются данные для столбцов **Прошло времени**, **Источник** и **Назначение**, которые не являются частью журнала сервера.</span><span class="sxs-lookup"><span data-stu-id="81f07-309">Similarly, the **Timestamp** column displays timestamp data from the server log, but no data is displayed for the **TimeElapsed**, **Source**, and **Destination** columns, which are not part of the server log.</span></span>
> 
> 

<span data-ttu-id="81f07-310">С помощью структуры представления службы хранилища Azure можно также определить и сохранить собственные макеты.</span><span class="sxs-lookup"><span data-stu-id="81f07-310">In addition to using the Azure Storage view layouts, you can also define and save your own view layouts.</span></span> <span data-ttu-id="81f07-311">Можно выбрать другие необходимые поля для группирования данных и сохранить группирование в рамках пользовательского макета.</span><span class="sxs-lookup"><span data-stu-id="81f07-311">You can select other desired fields for grouping data and save the grouping as part of your custom layout as well.</span></span>

### <a name="apply-color-rules-to-the-analysis-grid"></a><span data-ttu-id="81f07-312">Применение цветовых правил к сетке анализа</span><span class="sxs-lookup"><span data-stu-id="81f07-312">Apply color rules to the Analysis Grid</span></span>
<span data-ttu-id="81f07-313">Ресурсы хранилища также включают цветовые правила, которые обеспечивают визуальное средство для выявления различных типов ошибок в сетке анализа.</span><span class="sxs-lookup"><span data-stu-id="81f07-313">The Storage Assets also include color rules, which offer a visual means to identify different types of errors in the Analysis Grid.</span></span> <span data-ttu-id="81f07-314">Предопределенные цветовые правила применяются для ошибок HTTP, поэтому они отображаются только для журнала сервера и трассировки сети.</span><span class="sxs-lookup"><span data-stu-id="81f07-314">The predefined color rules apply to HTTP errors, so they appear only for the server log and network trace.</span></span>

<span data-ttu-id="81f07-315">Чтобы применить цветовые правила, выберите **Цветовые правила** на ленте панели инструментов.</span><span class="sxs-lookup"><span data-stu-id="81f07-315">To apply color rules, select **Color Rules** from the toolbar ribbon.</span></span> <span data-ttu-id="81f07-316">Вы увидите цветовые правила для хранилища Azure в меню.</span><span class="sxs-lookup"><span data-stu-id="81f07-316">You'll see the Azure Storage color rules in the menu.</span></span> <span data-ttu-id="81f07-317">Для целей учебника выберите **Ошибки клиента (значения StatusCode от 400 до 499)**, как показано на рисунке ниже.</span><span class="sxs-lookup"><span data-stu-id="81f07-317">For the tutorial, select **Client Errors (StatusCode between 400 and 499)**, as shown in the picture below.</span></span>

![Макет представления хранилища Azure](./media/storage-e2e-troubleshooting/color-rules-menu.png)

<span data-ttu-id="81f07-319">С помощью цветовых правил хранилища Azure можно определить и сохранить собственные правила.</span><span class="sxs-lookup"><span data-stu-id="81f07-319">In addition to using the Azure Storage color rules, you can also define and save your own color rules.</span></span>

### <a name="group-and-filter-log-data-to-find-400-range-errors"></a><span data-ttu-id="81f07-320">Группирование и фильтрация данных журнала для поиска ошибок диапазона 400</span><span class="sxs-lookup"><span data-stu-id="81f07-320">Group and filter log data to find 400-range errors</span></span>
<span data-ttu-id="81f07-321">Далее мы сгруппируем и отфильтруем данные журнала, чтобы найти все ошибки в диапазоне 400.</span><span class="sxs-lookup"><span data-stu-id="81f07-321">Next, we'll group and filter the log data to find all errors in the 400 range.</span></span>

1. <span data-ttu-id="81f07-322">Найдите столбец **Код состояния** в сетке анализа, щелкните правой кнопкой мыши заголовок столбца и выберите **Группировка**.</span><span class="sxs-lookup"><span data-stu-id="81f07-322">Locate the **StatusCode** column in the Analysis Grid, right-click the column heading, and select **Group**.</span></span>
2. <span data-ttu-id="81f07-323">Далее сгруппируйте по столбцу **ClientRequestId** .</span><span class="sxs-lookup"><span data-stu-id="81f07-323">Next, group on the **ClientRequestId** column.</span></span> <span data-ttu-id="81f07-324">Теперь данные распределены в сетке анализа с учетом кода состояния и идентификатора запроса клиента.</span><span class="sxs-lookup"><span data-stu-id="81f07-324">You'll see that the data in the Analysis Grid is now organized by status code and by client request ID.</span></span>
3. <span data-ttu-id="81f07-325">Откройте окно инструментов фильтра представления, если оно еще не отображается.</span><span class="sxs-lookup"><span data-stu-id="81f07-325">Display the View Filter tool window if it is not already displayed.</span></span> <span data-ttu-id="81f07-326">На ленте панели инструментов выберите **Окна инструментов**, затем **Фильтр представления**.</span><span class="sxs-lookup"><span data-stu-id="81f07-326">On the toolbar ribbon, select **Tool Windows**, then **View Filter**.</span></span>
4. <span data-ttu-id="81f07-327">Чтобы отфильтровать данные журнала для отображения ошибок в диапазоне 400, добавьте следующий критерий фильтра в окно **Фильтр представления** и нажмите кнопку **Применить**:</span><span class="sxs-lookup"><span data-stu-id="81f07-327">To filter the log data to display only 400-range errors, add the following filter criteria to the **View Filter** window, and click **Apply**:</span></span>

    ```   
    (AzureStorageLog.StatusCode >= 400 && AzureStorageLog.StatusCode <=499) || (HTTP.StatusCode >= 400 && HTTP.StatusCode <= 499)
    ```

<span data-ttu-id="81f07-328">На рисунке ниже показаны результаты фильтрации и группирования.</span><span class="sxs-lookup"><span data-stu-id="81f07-328">The picture below shows the results of this grouping and filter.</span></span> <span data-ttu-id="81f07-329">Например, раскрытие поля **ClientRequestID** под группированием для кода состояния 409 показывает операцию, которая привела к появлению указанного кода состояния.</span><span class="sxs-lookup"><span data-stu-id="81f07-329">Expanding the **ClientRequestID** field beneath the grouping for status code 409, for example, shows an operation that resulted in that status code.</span></span>

![Макет представления хранилища Azure](./media/storage-e2e-troubleshooting/400-range-errors1.png)

<span data-ttu-id="81f07-331">После применения фильтра вы увидите, что строки из клиентского журнала исключены, поскольку в клиентском журнале нет столбца **StatusCode** .</span><span class="sxs-lookup"><span data-stu-id="81f07-331">After applying this filter, you'll see that rows from the client log are excluded, as the client log does not include a **StatusCode** column.</span></span> <span data-ttu-id="81f07-332">Для начала просмотрим журналы сервера и трассировки сети, чтобы найти ошибки 404, а затем вернемся в журнал клиента для проверки операций клиента, которые приводят к их возникновению.</span><span class="sxs-lookup"><span data-stu-id="81f07-332">To begin with, we'll review the server and network trace logs to locate 404 errors, and then we'll return to the client log to examine the client operations that led to them.</span></span>

> [!NOTE]
> <span data-ttu-id="81f07-333">Можно выполнить фильтрацию по столбцу **StatusCode** и по-прежнему отображать данные из всех трех журналов, включая журнал клиента, если добавить выражение в фильтр, которое включает записи журнала с кодом состояния, имеющим значение null.</span><span class="sxs-lookup"><span data-stu-id="81f07-333">You can filter on the **StatusCode** column and still display data from all three logs, including the client log, if you add an expression to the filter that includes log entries where the status code is null.</span></span> <span data-ttu-id="81f07-334">Чтобы создать этот критерий фильтра, используйте следующее:</span><span class="sxs-lookup"><span data-stu-id="81f07-334">To construct this filter expression, use:</span></span>
> 
> <code>&#42;StatusCode >= 400 or !&#42;StatusCode</code>
> 
> <span data-ttu-id="81f07-335">Этот фильтр возвращает все строки из журнала клиента и только те строки из журнала сервера и журнала HTTP, для которых код состояния больше 400.</span><span class="sxs-lookup"><span data-stu-id="81f07-335">This filter returns all rows from the client log and only rows from the server log and HTTP log where the status code is greater than 400.</span></span> <span data-ttu-id="81f07-336">Если применить его к макету представления, сгруппированному по идентификатору запроса клиента и модулю, можно выполнить поиск или прокрутить до записи журнала, чтобы найти такие, где представлены все три журнала.</span><span class="sxs-lookup"><span data-stu-id="81f07-336">If you apply it to the view layout grouped by client request ID and module, you can search or scroll through the log entries to find ones where all three logs are represented.</span></span>   
> 
> 

### <a name="filter-log-data-to-find-404-errors"></a><span data-ttu-id="81f07-337">Фильтрация данных журнала для поиска ошибки 404</span><span class="sxs-lookup"><span data-stu-id="81f07-337">Filter log data to find 404 errors</span></span>
<span data-ttu-id="81f07-338">Ресурсы службы хранилища включают встроенные фильтры, которые можно использовать для уточнения данных журнала для поиска ошибок или тенденций.</span><span class="sxs-lookup"><span data-stu-id="81f07-338">The Storage Assets include predefined filters that you can use to narrow log data to find the errors or trends you are looking for.</span></span> <span data-ttu-id="81f07-339">После этого мы применим два стандартных фильтра: первый фильтрует журналы сервера и трассировки сети для ошибки 404, а второй фильтрует данные для определенного диапазона времени.</span><span class="sxs-lookup"><span data-stu-id="81f07-339">Next, we'll apply two predefined filters: one that filters the server and network trace logs for 404 errors, and one that filters the data on a specified time range.</span></span>

1. <span data-ttu-id="81f07-340">Откройте окно инструментов фильтра представления, если оно еще не отображается.</span><span class="sxs-lookup"><span data-stu-id="81f07-340">Display the View Filter tool window if it is not already displayed.</span></span> <span data-ttu-id="81f07-341">На ленте панели инструментов выберите **Окна инструментов**, затем **Фильтр представления**.</span><span class="sxs-lookup"><span data-stu-id="81f07-341">On the toolbar ribbon, select **Tool Windows**, then **View Filter**.</span></span>
2. <span data-ttu-id="81f07-342">В окне "Фильтр представления" выберите **Библиотека`Azure Storage` и выполните поиск по**, чтобы найти фильтры службы хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="81f07-342">In the View Filter window, select **Library**, and search on `Azure Storage` to find the Azure Storage filters.</span></span> <span data-ttu-id="81f07-343">Выберите фильтр для **сообщения 404 (не найдено) во всех журналах**.</span><span class="sxs-lookup"><span data-stu-id="81f07-343">Select the filter for **404 (Not Found) messages in all logs**.</span></span>
3. <span data-ttu-id="81f07-344">Снова откройте меню **Библиотека**, найдите и выделите **Глобальный фильтр по времени**.</span><span class="sxs-lookup"><span data-stu-id="81f07-344">Display the **Library** menu again, and locate and select the **Global Time Filter**.</span></span>
4. <span data-ttu-id="81f07-345">Измените отметки времени, показанные в фильтре в соответствии с диапазоном, который нужно просмотреть.</span><span class="sxs-lookup"><span data-stu-id="81f07-345">Edit the timestamps shown in the filter to the range you wish to view.</span></span> <span data-ttu-id="81f07-346">Это позволит сузить область данных для анализа.</span><span class="sxs-lookup"><span data-stu-id="81f07-346">This will help to narrow the range of data to analyze.</span></span>
5. <span data-ttu-id="81f07-347">Фильтр будет выглядеть аналогично приведенному ниже.</span><span class="sxs-lookup"><span data-stu-id="81f07-347">Your filter should appear similar to the example below.</span></span> <span data-ttu-id="81f07-348">Щелкните **Применить** , чтобы применить фильтр к сетке анализа.</span><span class="sxs-lookup"><span data-stu-id="81f07-348">Click **Apply** to apply the filter to the Analysis Grid.</span></span>

    ```   
    ((AzureStorageLog.StatusCode == 404 || HTTP.StatusCode == 404)) And
    (#Timestamp >= 2014-10-20T16:36:38 and #Timestamp <= 2014-10-20T16:36:39)
    ```

    ![Макет представления хранилища Azure](./media/storage-e2e-troubleshooting/404-filtered-errors1.png)

### <a name="analyze-your-log-data"></a><span data-ttu-id="81f07-350">Анализ данных журнала</span><span class="sxs-lookup"><span data-stu-id="81f07-350">Analyze your log data</span></span>
<span data-ttu-id="81f07-351">Теперь, после группировки и фильтрации данных, можно просмотреть подробные сведения для отдельных запросов, которые вызвали появление ошибки 404.</span><span class="sxs-lookup"><span data-stu-id="81f07-351">Now that you have grouped and filtered your data, you can examine the details of individual requests that generated 404 errors.</span></span> <span data-ttu-id="81f07-352">В макете текущего представления данные группируются по идентификатору запроса клиента, затем по источнику журнала.</span><span class="sxs-lookup"><span data-stu-id="81f07-352">In the current view layout, the data is grouped by client request ID, then by log source.</span></span> <span data-ttu-id="81f07-353">Поскольку происходит фильтрация запросов, в которых поле StatusCode содержит значение 404, мы рассмотрим только данные сервера и трассировки сети, а не данные журнала клиента.</span><span class="sxs-lookup"><span data-stu-id="81f07-353">Since we are filtering on requests where the StatusCode field contains 404, we'll see only the server and network trace data, not the client log data.</span></span>

<span data-ttu-id="81f07-354">На рисунке ниже показан пример запроса, где операция Get Blob возвратила ошибку 404, поскольку BLOB-объекта не существует.</span><span class="sxs-lookup"><span data-stu-id="81f07-354">The picture below shows a specific request where a Get Blob operation yielded a 404 because the blob did not exist.</span></span> <span data-ttu-id="81f07-355">Обратите внимание, что некоторые столбцы были удалены из стандартного представления для отображения необходимых данных.</span><span class="sxs-lookup"><span data-stu-id="81f07-355">Note that some columns have been removed from the standard view in order to display the relevant data.</span></span>

![Отфильтрованные журналы трассировки сети и сервера](./media/storage-e2e-troubleshooting/server-filtered-404-error.png)

<span data-ttu-id="81f07-357">Далее предстоит сопоставить этот идентификатор запроса клиента с данными журнала клиента, чтобы увидеть, какие действия предпринимались клиентом в момент возникновения ошибки.</span><span class="sxs-lookup"><span data-stu-id="81f07-357">Next, we'll correlate this client request ID with the client log data to see what actions the client was taking when the error happened.</span></span> <span data-ttu-id="81f07-358">Можно вывести новое представление сетки анализа для этого сеанса, чтобы просмотреть данных журнала клиента, которое открывается на второй вкладке:</span><span class="sxs-lookup"><span data-stu-id="81f07-358">You can display a new Analysis Grid view for this session to view the client log data, which opens in a second tab:</span></span>

1. <span data-ttu-id="81f07-359">Во-первых, скопируйте значение поля **ClientRequestId** в буфер обмена.</span><span class="sxs-lookup"><span data-stu-id="81f07-359">First, copy the value of the **ClientRequestId** field to the clipboard.</span></span> <span data-ttu-id="81f07-360">Это можно сделать, выбрав строку, найдя поле **ClientRequestId**, щелкнув правой кнопкой мыши значение данных и выбрав **Скопировать ClientRequestId**.</span><span class="sxs-lookup"><span data-stu-id="81f07-360">You can do this by selecting either row, locating the **ClientRequestId** field, right-clicking on the data value, and choosing **Copy 'ClientRequestId'**.</span></span>
2. <span data-ttu-id="81f07-361">На ленте панели инструментов выберите **Новое средство просмотра**, а затем выберите **Сетка анализа** для открытия новой вкладки.</span><span class="sxs-lookup"><span data-stu-id="81f07-361">On the toolbar ribbon, select **New Viewer**, then select **Analysis Grid** to open a new tab.</span></span> <span data-ttu-id="81f07-362">Новая вкладка отображает все данные в файлах журнала без группировки, фильтрации или цветовых правил.</span><span class="sxs-lookup"><span data-stu-id="81f07-362">The new tab shows all data in your log files, without grouping, filtering, or color rules.</span></span>
3. <span data-ttu-id="81f07-363">На ленте панели инструментов выберите **Макет представления**, а затем — **Все столбцы клиента .NET** в разделе **Служба хранилища Azure**.</span><span class="sxs-lookup"><span data-stu-id="81f07-363">On the toolbar ribbon, select **View Layout**, then select **All .NET Client Columns** under the **Azure Storage** section.</span></span> <span data-ttu-id="81f07-364">Этот макет представления отображает данные от клиента журнала, а также журналы трассировки сервера и сети.</span><span class="sxs-lookup"><span data-stu-id="81f07-364">This view layout shows data from the client log as well as the server and network trace logs.</span></span> <span data-ttu-id="81f07-365">По умолчанию он отсортирован по столбцу **MessageNumber** .</span><span class="sxs-lookup"><span data-stu-id="81f07-365">By default it is sorted on the **MessageNumber** column.</span></span>
4. <span data-ttu-id="81f07-366">Далее найдите идентификатор запроса клиента в журнале клиента</span><span class="sxs-lookup"><span data-stu-id="81f07-366">Next, search the client log for the client request ID.</span></span> <span data-ttu-id="81f07-367">На ленте панели инструментов выберите **Найти сообщения**, затем укажите настраиваемый фильтр по идентификатору запроса клиента в поле **Найти**.</span><span class="sxs-lookup"><span data-stu-id="81f07-367">On the toolbar ribbon, select **Find Messages**, then specify a custom filter on the client request ID in the **Find** field.</span></span> <span data-ttu-id="81f07-368">Используйте следующий синтаксис для фильтра, указав идентификатор запроса клиента:</span><span class="sxs-lookup"><span data-stu-id="81f07-368">Use this syntax for the filter, specifying your own client request ID:</span></span>

    ```
    *ClientRequestId == "398bac41-7725-484b-8a69-2a9e48fc669a"
    ```

<span data-ttu-id="81f07-369">Анализатор сообщений находит и выделяет первую запись журнала, где условия поиска соответствует идентификатору запроса клиента</span><span class="sxs-lookup"><span data-stu-id="81f07-369">Message Analyzer locates and selects the first log entry where the search criteria matches the client request ID.</span></span> <span data-ttu-id="81f07-370">В журнале клиента имеется несколько записей для каждого идентификатора клиентского запроса, поэтому для более удобного просмотра можно сгруппировать их по полю **ClientRequestId**.</span><span class="sxs-lookup"><span data-stu-id="81f07-370">In the client log, there are several entries for each client request ID, so you may want to group them on the **ClientRequestId** field to make it easier to see them all together.</span></span> <span data-ttu-id="81f07-371">На рисунке ниже показаны все сообщения в журнале клиента для указанного идентификатора запроса клиента.</span><span class="sxs-lookup"><span data-stu-id="81f07-371">The picture below shows all of the messages in the client log for the specified client request ID.</span></span>

![Ошибки 404 в журнале клиента](./media/storage-e2e-troubleshooting/client-log-analysis-grid1.png)

<span data-ttu-id="81f07-373">С помощью данных, отображаемых в макетах представлений на этих двух вкладках, можно анализировать данные запроса, чтобы определить, что вызвало ошибку.</span><span class="sxs-lookup"><span data-stu-id="81f07-373">Using the data shown in the view layouts in these two tabs, you can analyze the request data to determine what may have caused the error.</span></span> <span data-ttu-id="81f07-374">Также можно просмотреть запросы, предшествовавшие этому, чтобы понять, могло ли предыдущее событие привести к возникновению ошибки 404.</span><span class="sxs-lookup"><span data-stu-id="81f07-374">You can also look at requests that preceded this one to see if a previous event may have led to the 404 error.</span></span> <span data-ttu-id="81f07-375">Например, можно просмотреть записи журнала клиента, предшествующие этому идентификатору запроса клиента, чтобы определить был ли удален BLOB-объект, или что ошибка возникла из-за клиентского приложения, вызвавшего API CreateIfNotExists контейнера или BLOB-объекта.</span><span class="sxs-lookup"><span data-stu-id="81f07-375">For example, you can review the client log entries preceding this client request ID to determine whether the blob may have been deleted, or if the error was due to the client application calling a CreateIfNotExists API on a container or blob.</span></span> <span data-ttu-id="81f07-376">В журнале клиента можно найти адрес BLOB-объекта в поле **Описание**; в журналах сервера и трассировки сети эта информация отображается в поле **Сводка**.</span><span class="sxs-lookup"><span data-stu-id="81f07-376">In the client log, you can find the blob's address in the **Description** field; in the server and network trace logs, this information appears in the **Summary** field.</span></span>

<span data-ttu-id="81f07-377">Узнав адрес BLOB-объекта, который возвратил ошибку 404, можно проводить дальнейшее исследование проблемы.</span><span class="sxs-lookup"><span data-stu-id="81f07-377">Once you know the address of the blob that yielded the 404 error, you can investigate further.</span></span> <span data-ttu-id="81f07-378">При поиске в записях журнала для других сообщений, связанных с операциями с тем же BLOB-объектом, можно проверить, удалял ли клиент сущность ранее.</span><span class="sxs-lookup"><span data-stu-id="81f07-378">If you search the log entries for other messages associated with operations on the same blob, you can check whether the client previously deleted the entity.</span></span>

## <a name="analyze-other-types-of-storage-errors"></a><span data-ttu-id="81f07-379">Анализ других типов ошибок хранилища</span><span class="sxs-lookup"><span data-stu-id="81f07-379">Analyze other types of storage errors</span></span>
<span data-ttu-id="81f07-380">Теперь, когда вы знакомы с использованием анализатора сообщений для анализа данных журнала, можно анализировать другие типы ошибок с помощью макетов представлений, цветовых правил и фильтрации или поиска.</span><span class="sxs-lookup"><span data-stu-id="81f07-380">Now that you are familiar with using Message Analyzer to analyze your log data, you can analyze other types of errors using view layouts, color rules, and searching/filtering.</span></span> <span data-ttu-id="81f07-381">В приведенных ниже таблицах перечислены некоторые проблемы, которые могут возникнуть, и условия фильтра, которые можно использовать для их поиска.</span><span class="sxs-lookup"><span data-stu-id="81f07-381">The tables below lists some issues you may encounter and the filter criteria you can use to locate them.</span></span> <span data-ttu-id="81f07-382">Дополнительные сведения о создании фильтров и языке фильтрации анализатора сообщений см. в разделе [Фильтрация данных сообщений](http://technet.microsoft.com/library/jj819365.aspx).</span><span class="sxs-lookup"><span data-stu-id="81f07-382">For more information on constructing filters and the Message Analyzer filtering language, see [Filtering Message Data](http://technet.microsoft.com/library/jj819365.aspx).</span></span>

| <span data-ttu-id="81f07-383">Для изучения...</span><span class="sxs-lookup"><span data-stu-id="81f07-383">To Investigate…</span></span> | <span data-ttu-id="81f07-384">Использование выражения фильтра</span><span class="sxs-lookup"><span data-stu-id="81f07-384">Use Filter Expression…</span></span> | <span data-ttu-id="81f07-385">Выражение применяется к журналу (клиента, сервера, сети, всех)</span><span class="sxs-lookup"><span data-stu-id="81f07-385">Expression Applies to Log (Client, Server,   Network, All)</span></span> |
| --- | --- | --- |
| <span data-ttu-id="81f07-386">Непредвиденные задержки при доставке сообщений в очередь</span><span class="sxs-lookup"><span data-stu-id="81f07-386">Unexpected delays in message delivery on a queue</span></span> |<span data-ttu-id="81f07-387">AzureStorageClientDotNetV4.Description содержит "Повторное выполнение неудавшейся операции".</span><span class="sxs-lookup"><span data-stu-id="81f07-387">AzureStorageClientDotNetV4.Description   contains "Retrying failed operation."</span></span> |<span data-ttu-id="81f07-388">Клиент</span><span class="sxs-lookup"><span data-stu-id="81f07-388">Client</span></span> |
| <span data-ttu-id="81f07-389">Увеличение HTTP в PercentThrottlingError</span><span class="sxs-lookup"><span data-stu-id="81f07-389">HTTP Increase in PercentThrottlingError</span></span> |<span data-ttu-id="81f07-390">HTTP.Response.StatusCode == 500 &#124;&#124; HTTP.Response.StatusCode == 503</span><span class="sxs-lookup"><span data-stu-id="81f07-390">HTTP.Response.StatusCode   == 500 &#124;&#124; HTTP.Response.StatusCode == 503</span></span> |<span data-ttu-id="81f07-391">Сеть</span><span class="sxs-lookup"><span data-stu-id="81f07-391">Network</span></span> |
| <span data-ttu-id="81f07-392">Увеличение PercentTimeoutError</span><span class="sxs-lookup"><span data-stu-id="81f07-392">Increase in PercentTimeoutError</span></span> |<span data-ttu-id="81f07-393">HTTP.Response.StatusCode == 500</span><span class="sxs-lookup"><span data-stu-id="81f07-393">HTTP.Response.StatusCode   == 500</span></span> |<span data-ttu-id="81f07-394">Сеть</span><span class="sxs-lookup"><span data-stu-id="81f07-394">Network</span></span> |
| <span data-ttu-id="81f07-395">Увеличение PercentTimeoutError (все)</span><span class="sxs-lookup"><span data-stu-id="81f07-395">Increase in PercentTimeoutError (all)</span></span> |<span data-ttu-id="81f07-396">*StatusCode == 500</span><span class="sxs-lookup"><span data-stu-id="81f07-396">*StatusCode   == 500</span></span> |<span data-ttu-id="81f07-397">Все</span><span class="sxs-lookup"><span data-stu-id="81f07-397">All</span></span> |
| <span data-ttu-id="81f07-398">Увеличение PercentNetworkError</span><span class="sxs-lookup"><span data-stu-id="81f07-398">Increase in PercentNetworkError</span></span> |<span data-ttu-id="81f07-399">AzureStorageClientDotNetV4.EventLogEntry.Level < 2</span><span class="sxs-lookup"><span data-stu-id="81f07-399">AzureStorageClientDotNetV4.EventLogEntry.Level   < 2</span></span> |<span data-ttu-id="81f07-400">Клиент</span><span class="sxs-lookup"><span data-stu-id="81f07-400">Client</span></span> |
| <span data-ttu-id="81f07-401">Сообщения HTTP 403 (запрещено)</span><span class="sxs-lookup"><span data-stu-id="81f07-401">HTTP 403 (Forbidden) messages</span></span> |<span data-ttu-id="81f07-402">HTTP.Response.StatusCode == 403</span><span class="sxs-lookup"><span data-stu-id="81f07-402">HTTP.Response.StatusCode   == 403</span></span> |<span data-ttu-id="81f07-403">Сеть</span><span class="sxs-lookup"><span data-stu-id="81f07-403">Network</span></span> |
| <span data-ttu-id="81f07-404">Сообщения HTTP 404 (не найдено)</span><span class="sxs-lookup"><span data-stu-id="81f07-404">HTTP 404 (Not found) messages</span></span> |<span data-ttu-id="81f07-405">HTTP.Response.StatusCode == 404</span><span class="sxs-lookup"><span data-stu-id="81f07-405">HTTP.Response.StatusCode   == 404</span></span> |<span data-ttu-id="81f07-406">Сеть</span><span class="sxs-lookup"><span data-stu-id="81f07-406">Network</span></span> |
| <span data-ttu-id="81f07-407">404 (все)</span><span class="sxs-lookup"><span data-stu-id="81f07-407">404 (all)</span></span> |<span data-ttu-id="81f07-408">*StatusCode == 404</span><span class="sxs-lookup"><span data-stu-id="81f07-408">*StatusCode   == 404</span></span> |<span data-ttu-id="81f07-409">Все</span><span class="sxs-lookup"><span data-stu-id="81f07-409">All</span></span> |
| <span data-ttu-id="81f07-410">Общие проблемы авторизации подписи доступа (SAS)</span><span class="sxs-lookup"><span data-stu-id="81f07-410">Shared Access Signature (SAS) authorization issue</span></span> |<span data-ttu-id="81f07-411">AzureStorageLog.RequestStatus == "SASAuthorizationError"</span><span class="sxs-lookup"><span data-stu-id="81f07-411">AzureStorageLog.RequestStatus ==  "SASAuthorizationError"</span></span> |<span data-ttu-id="81f07-412">Сеть</span><span class="sxs-lookup"><span data-stu-id="81f07-412">Network</span></span> |
| <span data-ttu-id="81f07-413">Сообщения HTTP 409 (конфликт)</span><span class="sxs-lookup"><span data-stu-id="81f07-413">HTTP 409 (Conflict) messages</span></span> |<span data-ttu-id="81f07-414">HTTP.Response.StatusCode == 409</span><span class="sxs-lookup"><span data-stu-id="81f07-414">HTTP.Response.StatusCode   == 409</span></span> |<span data-ttu-id="81f07-415">Сеть</span><span class="sxs-lookup"><span data-stu-id="81f07-415">Network</span></span> |
| <span data-ttu-id="81f07-416">409 (все)</span><span class="sxs-lookup"><span data-stu-id="81f07-416">409 (all)</span></span> |<span data-ttu-id="81f07-417">*StatusCode == 409</span><span class="sxs-lookup"><span data-stu-id="81f07-417">*StatusCode   == 409</span></span> |<span data-ttu-id="81f07-418">Все</span><span class="sxs-lookup"><span data-stu-id="81f07-418">All</span></span> |
| <span data-ttu-id="81f07-419">Низкие значения PercentSuccess или присутствие операций с состоянием транзакции ClientOtherErrors в записях журналов аналитики</span><span class="sxs-lookup"><span data-stu-id="81f07-419">Low PercentSuccess or analytics log entries have   operations with transaction status of ClientOtherErrors</span></span> |<span data-ttu-id="81f07-420">AzureStorageLog.RequestStatus == "ClientOtherError"</span><span class="sxs-lookup"><span data-stu-id="81f07-420">AzureStorageLog.RequestStatus ==   "ClientOtherError"</span></span> |<span data-ttu-id="81f07-421">сервер;</span><span class="sxs-lookup"><span data-stu-id="81f07-421">Server</span></span> |
| <span data-ttu-id="81f07-422">Предупреждение Nagle</span><span class="sxs-lookup"><span data-stu-id="81f07-422">Nagle   Warning</span></span> |<span data-ttu-id="81f07-423">((AzureStorageLog.EndToEndLatencyMS - AzureStorageLog.ServerLatencyMS) > (AzureStorageLog.ServerLatencyMS * 1.5)) and (AzureStorageLog.RequestPacketSize <1460) and (AzureStorageLog.EndToEndLatencyMS - AzureStorageLog.ServerLatencyMS >= 200)</span><span class="sxs-lookup"><span data-stu-id="81f07-423">((AzureStorageLog.EndToEndLatencyMS   - AzureStorageLog.ServerLatencyMS) > (AzureStorageLog.ServerLatencyMS *   1.5)) and (AzureStorageLog.RequestPacketSize <1460) and (AzureStorageLog.EndToEndLatencyMS -   AzureStorageLog.ServerLatencyMS >= 200)</span></span> |<span data-ttu-id="81f07-424">сервер;</span><span class="sxs-lookup"><span data-stu-id="81f07-424">Server</span></span> |
| <span data-ttu-id="81f07-425">Диапазон времени в журналах сервера и сети</span><span class="sxs-lookup"><span data-stu-id="81f07-425">Range of   time in Server and Network logs</span></span> |<span data-ttu-id="81f07-426">#Timestamp   >= 2014-10-20T16:36:38 and #Timestamp <= 2014-10-20T16:36:39</span><span class="sxs-lookup"><span data-stu-id="81f07-426">#Timestamp   >= 2014-10-20T16:36:38 and #Timestamp <= 2014-10-20T16:36:39</span></span> |<span data-ttu-id="81f07-427">Сервер, сеть</span><span class="sxs-lookup"><span data-stu-id="81f07-427">Server, Network</span></span> |
| <span data-ttu-id="81f07-428">Диапазон времени в журналах сервера</span><span class="sxs-lookup"><span data-stu-id="81f07-428">Range of   time in Server logs</span></span> |<span data-ttu-id="81f07-429">AzureStorageLog.Timestamp >= 2014-10-20T16:36:38 and AzureStorageLog.Timestamp <= 2014-10-20T16:36:39</span><span class="sxs-lookup"><span data-stu-id="81f07-429">AzureStorageLog.Timestamp   >= 2014-10-20T16:36:38 and AzureStorageLog.Timestamp <=   2014-10-20T16:36:39</span></span> |<span data-ttu-id="81f07-430">сервер;</span><span class="sxs-lookup"><span data-stu-id="81f07-430">Server</span></span> |

## <a name="next-steps"></a><span data-ttu-id="81f07-431">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="81f07-431">Next steps</span></span>
<span data-ttu-id="81f07-432">Дополнительные сведения о сквозных сценариях устранения ошибок в службы хранилище Azure см. следующие ресурсы:</span><span class="sxs-lookup"><span data-stu-id="81f07-432">For more information about troubleshooting end-to-end scenarios in Azure Storage, see these resources:</span></span>

* [<span data-ttu-id="81f07-433">Наблюдение, диагностика и устранение неисправностей хранилища Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="81f07-433">Monitor, diagnose, and troubleshoot Microsoft Azure Storage</span></span>](storage-monitoring-diagnosing-troubleshooting.md)
* [<span data-ttu-id="81f07-434">Аналитика службы хранилища</span><span class="sxs-lookup"><span data-stu-id="81f07-434">Storage Analytics</span></span>](http://msdn.microsoft.com/library/azure/hh343270.aspx)
* [<span data-ttu-id="81f07-435">Мониторинг учетной записи хранения на портале Azure</span><span class="sxs-lookup"><span data-stu-id="81f07-435">Monitor a storage account in the Azure portal</span></span>](storage-monitor-storage-account.md)
* [<span data-ttu-id="81f07-436">Приступая к работе со служебной программой командной строки AzCopy</span><span class="sxs-lookup"><span data-stu-id="81f07-436">Transfer data with the AzCopy Command-Line Utility</span></span>](storage-use-azcopy.md)
* [<span data-ttu-id="81f07-437">Руководство по работе с анализатором сообщений (Майкрософт)</span><span class="sxs-lookup"><span data-stu-id="81f07-437">Microsoft Message Analyzer Operating Guide</span></span>](http://technet.microsoft.com/library/jj649776.aspx)
