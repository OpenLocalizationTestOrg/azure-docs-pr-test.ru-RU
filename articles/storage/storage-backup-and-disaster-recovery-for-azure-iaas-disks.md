---
title: "aaaBackup и аварийного восстановления для дисков Azure IaaS | Документы Microsoft"
description: "В этой статье объясняется, как tooplan для резервного копирования и аварийного восстановления (DR) IaaS виртуальных машин (ВМ) и дисков в Azure. В этом документе рассматриваются как управляемые, так и неуправляемые диски."
services: storage
cloud: Azure
documentationcenter: na
author: luywang
manager: kavithag
ms.assetid: 
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/19/2017
ms.author: luywang
ms.openlocfilehash: 17c697bc411fb47c4b7483b59829af1c40732ac1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="backup-and-disaster-recovery-for-azure-iaas-disks"></a><span data-ttu-id="989f5-104">Архивация и аварийное восстановление для дисков IaaS Azure</span><span class="sxs-lookup"><span data-stu-id="989f5-104">Backup and disaster recovery for Azure IaaS disks</span></span>

<span data-ttu-id="989f5-105">В этой статье объясняется, как tooplan для резервного копирования и аварийного восстановления (DR) IaaS виртуальных машин (ВМ) и дисков в Azure.</span><span class="sxs-lookup"><span data-stu-id="989f5-105">In this article, we will explain how tooplan for Backup and Disaster Recovery (DR) of IaaS virtual machines (VMs) and Disks in Azure.</span></span> <span data-ttu-id="989f5-106">В этом документе рассматриваются как управляемые, так и неуправляемые диски.</span><span class="sxs-lookup"><span data-stu-id="989f5-106">This document covers both Managed and Unmanaged Disks.</span></span>

<span data-ttu-id="989f5-107">Сначала рассмотрим hello встроенные возможности отказоустойчивости в hello платформы Azure которых защиту от локальных сбоев.</span><span class="sxs-lookup"><span data-stu-id="989f5-107">We’ll first talk about hello built-in fault tolerance capabilities in hello Azure platform which help guard against local failures.</span></span> <span data-ttu-id="989f5-108">Затем мы обсудим hello аварийного сценарии не полностью, hello встроенными возможностями, который является основной раздел hello, описанной в этом документе.</span><span class="sxs-lookup"><span data-stu-id="989f5-108">We’ll then discuss hello disaster scenarios not fully covered by hello built-in capabilities, which is hello main topic addressed by this document.</span></span> <span data-ttu-id="989f5-109">Мы также рассмотрим несколько примеров сценариев рабочей нагрузки, в которых могут применяться различные вопросы архивации и аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="989f5-109">We’ll also show several examples of workload scenarios where different Backup and DR considerations may apply.</span></span> <span data-ttu-id="989f5-110">Затем мы рассмотрим возможные решения для аварийного восстановления дисков IaaS.</span><span class="sxs-lookup"><span data-stu-id="989f5-110">We’ll then review possible solutions for DR of IaaS Disks.</span></span> 

## <a name="introduction"></a><span data-ttu-id="989f5-111">Введение</span><span class="sxs-lookup"><span data-stu-id="989f5-111">Introduction</span></span>

<span data-ttu-id="989f5-112">Hello платформы Azure использует различные методы для обеспечения избыточности и toohelp отклонения ошибки защититься от сбоев оборудования локализованные, которые могут возникнуть.</span><span class="sxs-lookup"><span data-stu-id="989f5-112">hello Azure platform uses various methods for redundancy and fault tolerance toohelp protect customers from localized hardware failures that can occur.</span></span> <span data-ttu-id="989f5-113">Локальные ошибки могут вызвать проблемы с машиной сервера хранилища Azure, которая содержит часть данных hello для виртуального диска или SSD или HDD сбоев на этом сервере.</span><span class="sxs-lookup"><span data-stu-id="989f5-113">Local failures may include problems with an Azure storage server machine that stores part of hello data for a virtual disk or failures of an SSD or HDD on that server.</span></span> <span data-ttu-id="989f5-114">Таких сбоев компонентов изолированное оборудовании может произойти во время обычной работы и платформа hello — спроектированный toobe устойчивым toothese сбоев.</span><span class="sxs-lookup"><span data-stu-id="989f5-114">Such isolated hardware component failures can happen during normal operations and hello platform is designed toobe resilient toothese failures.</span></span> <span data-ttu-id="989f5-115">Серьезные аварии могут привести к сбоям или недоступности большого количества серверов хранилища или всего центра обработки данных.</span><span class="sxs-lookup"><span data-stu-id="989f5-115">Major disasters can result in failures or inaccessibility of a large numbers of storage servers or a whole datacenter.</span></span> <span data-ttu-id="989f5-116">Хотя виртуальные машины и диски обычно защита от сбоев локализованные, дополнительные действия, необходимые tooprotect рабочей нагрузки от всей области критическим сбоям (например серьезной аварии), влияющих на ВМ и дисков.</span><span class="sxs-lookup"><span data-stu-id="989f5-116">While your VMs and disks are normally protected from localized failures, additional steps are necessary tooprotect your workload from region-wide catastrophic failures (such as a major disaster) that can affect your VM and disks.</span></span>

<span data-ttu-id="989f5-117">В дополнение к этому toohello вероятность сбоев платформы, с клиентского приложения hello или данных могут возникнуть проблемы.</span><span class="sxs-lookup"><span data-stu-id="989f5-117">In addition toohello possibility of platform failures, problems with hello customer application or data can occur.</span></span> <span data-ttu-id="989f5-118">Например новая версия приложения может непреднамеренно становится критические изменения toohello данных.</span><span class="sxs-lookup"><span data-stu-id="989f5-118">For example, a new version of your application may inadvertently make a breaking change toohello data.</span></span> <span data-ttu-id="989f5-119">В этом случае можно привести приложение hello toorevert и hello данных tooa предыдущей версии содержащего hello последнее удачное состояние.</span><span class="sxs-lookup"><span data-stu-id="989f5-119">In that case, you may want toorevert hello application and hello data tooa prior version containing hello last known good state.</span></span> <span data-ttu-id="989f5-120">Для этого необходима регулярная архивация.</span><span class="sxs-lookup"><span data-stu-id="989f5-120">This requires maintaining regular backups.</span></span>

<span data-ttu-id="989f5-121">Для региональных аварийного восстановления должен создать резервную вашей диски ВМ IaaS tooa другой регион.</span><span class="sxs-lookup"><span data-stu-id="989f5-121">For regional disaster recovery, you must backup your IaaS VM disks tooa different region.</span></span> 

<span data-ttu-id="989f5-122">Прежде чем мы рассмотрим параметры резервного копирования и аварийного восстановления, давайте освежим в памяти несколько методов обработки локальных сбоев.</span><span class="sxs-lookup"><span data-stu-id="989f5-122">Before we look at Backup and DR options, let’s recap a few methods available for handling localized failures.</span></span>

### <a name="azure-iaas-resiliency"></a><span data-ttu-id="989f5-123">Устойчивость Azure IaaS</span><span class="sxs-lookup"><span data-stu-id="989f5-123">Azure IaaS Resiliency</span></span>

<span data-ttu-id="989f5-124">*Устойчивость* означает toohello отклонения для обычных ошибок, возникающих в аппаратных компонентов.</span><span class="sxs-lookup"><span data-stu-id="989f5-124">*Resiliency* refers toohello tolerance for normal failures that occur in hardware components.</span></span> <span data-ttu-id="989f5-125">Устойчивость является toorecover возможность hello от сбоев и продолжить toofunction.</span><span class="sxs-lookup"><span data-stu-id="989f5-125">Resiliency is hello ability toorecover from failures and continue toofunction.</span></span> <span data-ttu-id="989f5-126">Не о как избежать ошибок, но отвечает toofailures образом, чтобы избежать простоя и потери данных.</span><span class="sxs-lookup"><span data-stu-id="989f5-126">It's not about avoiding failures, but responding toofailures in a way that avoids downtime or data loss.</span></span> <span data-ttu-id="989f5-127">Задача Hello устойчивости — tooreturn hello tooa полнофункциональной состояние приложения после сбоя.</span><span class="sxs-lookup"><span data-stu-id="989f5-127">hello goal of resiliency is tooreturn hello application tooa fully functioning state following a failure.</span></span> <span data-ttu-id="989f5-128">Виртуальные машины Azure и диски, спроектированный toobe устойчивым toocommon аппаратных сбоев.</span><span class="sxs-lookup"><span data-stu-id="989f5-128">Azure Virtual Machines and Disks are designed toobe resilient toocommon hardware faults.</span></span> <span data-ttu-id="989f5-129">Рассмотрим как платформы Azure IaaS hello предоставляет этот устойчивости.</span><span class="sxs-lookup"><span data-stu-id="989f5-129">Let us look at how hello Azure IaaS platform provides this resiliency.</span></span>

<span data-ttu-id="989f5-130">Виртуальная машина основном состоит из двух частей: (1) A вычислений сервера и постоянные диски hello (2).</span><span class="sxs-lookup"><span data-stu-id="989f5-130">A virtual machine consists mainly of two parts: (1) A compute server, and (2) hello persistent disks.</span></span> <span data-ttu-id="989f5-131">Оба влияет на отказоустойчивость hello виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="989f5-131">Both affect hello fault tolerance of a virtual machine.</span></span>

<span data-ttu-id="989f5-132">Если сервер узла hello вычислений Azure, содержащий ВМ происходит сбой оборудования (что бывает редко), Azure — hello спроектированный tooautomatically восстановления виртуальной Машины на другом сервере.</span><span class="sxs-lookup"><span data-stu-id="989f5-132">If hello Azure compute host server that houses your VM experiences a hardware failure (which is rare), Azure is designed tooautomatically restore hello VM on another server.</span></span> <span data-ttu-id="989f5-133">В этом случае будет возникать перезагрузка и hello виртуальной Машины будет резервное копирование через некоторое время.</span><span class="sxs-lookup"><span data-stu-id="989f5-133">If this happens, you will experience a reboot, and hello VM will be back up after some time.</span></span> <span data-ttu-id="989f5-134">Azure автоматически обнаруживает такие сбои оборудования и выполняет восстановление toohelp обеспечить hello клиента виртуальной Машины будут доступны как можно быстрее.</span><span class="sxs-lookup"><span data-stu-id="989f5-134">Azure automatically detects such hardware failures and executes recoveries toohelp ensure hello customer VM will be available as soon as possible.</span></span>

<span data-ttu-id="989f5-135">О дисках IaaS Устойчивость данных крайне важна для платформы hello постоянное хранилище.</span><span class="sxs-lookup"><span data-stu-id="989f5-135">Regarding IaaS disks, durability of data is critical for hello persistent storage platform.</span></span> <span data-ttu-id="989f5-136">Azure клиенты имеют важные бизнес-приложений, выполняемой в IaaS, и они зависят от hello сохраняемости данных hello.</span><span class="sxs-lookup"><span data-stu-id="989f5-136">Azure customers have important business applications running on IaaS and they depend on hello persistence of hello data.</span></span> <span data-ttu-id="989f5-137">Azure обеспечивает защиту этих дисков IaaS, создавая три избыточных локальных копии данных, что позволяет получить высокий уровень защиты от локальных сбоев.</span><span class="sxs-lookup"><span data-stu-id="989f5-137">Azure designs protection for these IaaS disks with three redundant copies of data stored locally, providing high durability against local failures.</span></span> <span data-ttu-id="989f5-138">В случае сбоя одного hello аппаратных компонентов, которые хранятся на диске виртуальной Машины не влияет на так как имеются два дополнительных копий toosupport диска запросы.</span><span class="sxs-lookup"><span data-stu-id="989f5-138">If one of hello hardware components that holds your disk fails, your VM is not impacted because there are two additional copies toosupport disk requests.</span></span> <span data-ttu-id="989f5-139">Устройство работает даже в случае отказа двух различных аппаратных компонентов, поддерживающих диск на hello же времени (что было бы очень редко).</span><span class="sxs-lookup"><span data-stu-id="989f5-139">It works fine even if two different hardware components supporting a disk fail at hello same time (which would be very rare).</span></span> <span data-ttu-id="989f5-140">toohelp убедитесь, мы всегда поддерживать три реплики, службе хранилища Azure hello автоматически порождает новую копию данных в фоновом режиме hello, если один из трех копий hello становится недоступным.</span><span class="sxs-lookup"><span data-stu-id="989f5-140">toohelp ensure we always maintain three replicas, hello Azure Storage service automatically spawns a new copy of data in hello background if one of hello three copies becomes unavailable.</span></span> <span data-ttu-id="989f5-141">Таким образом не следует необходимые toouse RAID с дисками Azure для обеспечения отказоустойчивости.</span><span class="sxs-lookup"><span data-stu-id="989f5-141">Therefore, it should not be necessary toouse RAID with Azure disks for fault tolerance.</span></span> <span data-ttu-id="989f5-142">Простой RAID 0 конфигурации должно быть достаточно для чередование дисков hello, при необходимости toocreate больших томах.</span><span class="sxs-lookup"><span data-stu-id="989f5-142">A simple RAID 0 configuration should be sufficient for striping hello disks if necessary toocreate larger volumes.</span></span>

<span data-ttu-id="989f5-143">Благодаря этой архитектуре **в Azure удалось гарантировать надежность дисков IaaS корпоративного уровня с ведущим в отрасли [нулевым показателем процента сбоев в течение года](https://en.wikipedia.org/wiki/Annualized_failure_rate).**</span><span class="sxs-lookup"><span data-stu-id="989f5-143">Because of this architecture, **Azure has consistently delivered enterprise-grade durability for IaaS disks, with an industry-leading ZERO % [Annualized Failure Rate](https://en.wikipedia.org/wiki/Annualized_failure_rate).**</span></span>

<span data-ttu-id="989f5-144">Локализованным сбоям оборудования на hello вычислений размещения или в хранилище hello платформы иногда может привести к временной недоступности для виртуальной Машины, описанном hello hello [соглашения об уровне ОБСЛУЖИВАНИЯ Azure](https://azure.microsoft.com/support/legal/sla/virtual-machines/) для обеспечения доступности виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="989f5-144">Localized hardware faults on hello compute host or in hello storage platform can sometimes result in temporary unavailability for hello VM which is covered by hello [Azure SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines/) for VM Availability.</span></span> <span data-ttu-id="989f5-145">Azure также предоставляет ведущее в отрасли Соглашение об уровне обслуживания для отдельных экземпляров виртуальных машин, в которых используются диски хранилища класса "Премиум".</span><span class="sxs-lookup"><span data-stu-id="989f5-145">Azure also provides an industry-leading SLA for single VM instances that use Premium Storage disks.</span></span>

<span data-ttu-id="989f5-146">рабочие нагрузки приложений toosafeguard от простоев из-за временной недоступности toohello диска или виртуальных Машин, клиенты могут использовать [наборов доступности](../virtual-machines/windows/manage-availability.md).</span><span class="sxs-lookup"><span data-stu-id="989f5-146">toosafeguard application workloads from downtime due toohello temporary unavailability of a disk or VM, customers can leverage [Availability Sets](../virtual-machines/windows/manage-availability.md).</span></span> <span data-ttu-id="989f5-147">Два или несколько виртуальных машин в наборе доступности обеспечивает избыточность для приложения hello.</span><span class="sxs-lookup"><span data-stu-id="989f5-147">Two or more virtual machines in an availability set provides redundancy for hello application.</span></span> <span data-ttu-id="989f5-148">Azure создает эти виртуальные машины и диски в отдельных доменах сбоя с различными компонентами питания, сетевыми компонентами и серверными компонентами.</span><span class="sxs-lookup"><span data-stu-id="989f5-148">Azure then creates these VMs and disks in separate fault domains with different power, network, and server components.</span></span> <span data-ttu-id="989f5-149">Таким образом, сбоев оборудования локализованные обычно не влияют на несколько виртуальных машин в hello равным hello одновременно, обеспечивая высокий уровень доступности для вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="989f5-149">Thus, localized hardware failures typically do not affect multiple VMs in hello set at hello same time, providing high availability for your application.</span></span> <span data-ttu-id="989f5-150">Считается, что задает доступности toouse рекомендуется всегда, когда требуется высокая доступность.</span><span class="sxs-lookup"><span data-stu-id="989f5-150">It is considered a good practice toouse availability sets when high availability is required.</span></span> <span data-ttu-id="989f5-151">Дополнительные сведения см. в разделе аспекты hello аварийного восстановления, см. ниже.</span><span class="sxs-lookup"><span data-stu-id="989f5-151">For more information, see hello Disaster Recovery aspects detailed below.</span></span>

### <a name="backup-and-disaster-recovery"></a><span data-ttu-id="989f5-152">Резервное копирование и аварийное восстановление</span><span class="sxs-lookup"><span data-stu-id="989f5-152">Backup and Disaster Recovery</span></span>

<span data-ttu-id="989f5-153">Аварийное восстановление (DR) является toorecover возможность hello из редко, но основные инцидентов: Повторяющаяся, масштаб всей неполадок, например нарушения обслуживания, которая влияет на весь регион.</span><span class="sxs-lookup"><span data-stu-id="989f5-153">Disaster recovery (DR) is hello ability toorecover from rare but major incidents: non-transient, wide-scale failures, such as service disruption that affects an entire region.</span></span> <span data-ttu-id="989f5-154">Аварийное восстановление включает резервное копирование данных и архивацию и может включать ручное вмешательство, например восстановление базы данных из резервной копии.</span><span class="sxs-lookup"><span data-stu-id="989f5-154">Disaster recovery includes data backup and archiving, and may include manual intervention, such as restoring a database from backup.</span></span>

<span data-ttu-id="989f5-155">Hello платформы Azure встроенную защиту от сбоев локализованные может не защищают полностью hello виртуальные машины и диски, в случае серьезных аварий, заставляющие крупномасштабных простои hello.</span><span class="sxs-lookup"><span data-stu-id="989f5-155">hello Azure platform’s built-in protection against localized failures may not fully protect hello VMs/disks in hello case of major disasters which can cause large-scale outages.</span></span> <span data-ttu-id="989f5-156">К таким сбоям относятся катастрофические события, такие как воздействие на центр обработки данных урагана, землетрясения, пожара, или крупномасштабный сбой оборудования.</span><span class="sxs-lookup"><span data-stu-id="989f5-156">This includes catastrophic events such as a data center being hit by a hurricane, earthquake, fire, or large scale hardware unit failures.</span></span> <span data-ttu-id="989f5-157">Кроме того возможны сбои из-за проблем с tooapplication или данных.</span><span class="sxs-lookup"><span data-stu-id="989f5-157">In addition, you may encounter failures due tooapplication or data issues.</span></span>

<span data-ttu-id="989f5-158">toohelp рабочих нагрузок IaaS защиты от сбоев, необходимо запланировать восстановления tooenable избыточность и резервные копии.</span><span class="sxs-lookup"><span data-stu-id="989f5-158">toohelp protect your IaaS workloads from outages, you should plan for redundancy and backups tooenable recovery.</span></span> <span data-ttu-id="989f5-159">Для аварийного восстановления следует запланировать избыточность и резервной копии в разных географических расположениях hello основной узел.</span><span class="sxs-lookup"><span data-stu-id="989f5-159">For disaster recovery, you should plan redundancy and backup in a different geographic location away from hello primary site.</span></span> <span data-ttu-id="989f5-160">Это помогает обеспечить резервного копирования не подвержены hello того же события, которое изначально повлиять hello виртуальной Машины или дисков.</span><span class="sxs-lookup"><span data-stu-id="989f5-160">This helps ensure your backup is not affected by hello same event that originally impacted hello VM or disks.</span></span> <span data-ttu-id="989f5-161">Дополнительные сведения см. в статье [Аварийное восстановление для приложений на платформе Azure](https://docs.microsoft.com/azure/architecture/resiliency/disaster-recovery-azure-applications).</span><span class="sxs-lookup"><span data-stu-id="989f5-161">For more information, see [Disaster Recovery for Applications built on Azure](https://docs.microsoft.com/azure/architecture/resiliency/disaster-recovery-azure-applications).</span></span>

<span data-ttu-id="989f5-162">Вопросы вашей аварийного восстановления может включать hello следующие аспекты:</span><span class="sxs-lookup"><span data-stu-id="989f5-162">Your DR considerations may include hello following aspects:</span></span>

1. <span data-ttu-id="989f5-163">Высокий уровень доступности (HA) — это способность hello toocontinue приложения hello в работоспособное состояние, без значительно увеличить время простоя.</span><span class="sxs-lookup"><span data-stu-id="989f5-163">High Availability (HA) is hello ability of hello application toocontinue running in a healthy state, without significant downtime.</span></span> <span data-ttu-id="989f5-164">«Исправен», мы означает приложения hello отвечать на запросы, и пользователи могут подключаться toohello приложения и взаимодействовать с ней.</span><span class="sxs-lookup"><span data-stu-id="989f5-164">By "healthy state," we mean hello application is responsive, and users can connect toohello application and interact with it.</span></span> <span data-ttu-id="989f5-165">Некоторые критически важных приложений и баз данных может быть обязательным toobe доступны всегда, даже в том случае, когда происходит ошибка в платформе hello.</span><span class="sxs-lookup"><span data-stu-id="989f5-165">Certain mission-critical applications and databases may be required toobe available always, even when there are failures in hello platform.</span></span> <span data-ttu-id="989f5-166">Для этих рабочих нагрузок может потребоваться tooplan избыточность для приложения hello, а также данные hello.</span><span class="sxs-lookup"><span data-stu-id="989f5-166">For these workloads, you may need tooplan redundancy for hello application as well as hello data.</span></span>

2. <span data-ttu-id="989f5-167">Надежность данных: В некоторых случаях hello главное, помнить убедитесь, что hello данные сохраняются в случае аварийной ситуации, когда hello.</span><span class="sxs-lookup"><span data-stu-id="989f5-167">Data Durability: In some cases, hello main consideration is ensuring hello data is preserved in hello case of a disaster.</span></span> <span data-ttu-id="989f5-168">Поэтому может потребоваться создание резервной копии данных на другом сайте.</span><span class="sxs-lookup"><span data-stu-id="989f5-168">Therefore, you may need a backup of your data in a different site.</span></span> <span data-ttu-id="989f5-169">Для таких рабочих нагрузок которые могут потребоваться полную избыточность для приложения hello, но регулярного резервного копирования дисков hello.</span><span class="sxs-lookup"><span data-stu-id="989f5-169">For such workloads, you may not need full redundancy for hello application, but a regular backup of hello disks.</span></span>

## <a name="backup-and-dr-scenarios"></a><span data-ttu-id="989f5-170">Сценарии архивации и аварийного восстановления</span><span class="sxs-lookup"><span data-stu-id="989f5-170">Backup and DR Scenarios</span></span>

<span data-ttu-id="989f5-171">Рассмотрим несколько примеров типичных сценариев рабочей нагрузки приложения и hello размышления о планировании аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="989f5-171">Let’s look at a few typical examples of application workload scenarios and hello considerations for planning Disaster Recovery.</span></span>

### <a name="scenario-1-major-database-solutions"></a><span data-ttu-id="989f5-172">Сценарий 1. Решения для крупных баз данных</span><span class="sxs-lookup"><span data-stu-id="989f5-172">Scenario 1: Major Database Solutions</span></span>

<span data-ttu-id="989f5-173">Рассмотрим рабочий сервер базы данных, например SQL Server или Oracle, поддерживающий высокий уровень доступности.</span><span class="sxs-lookup"><span data-stu-id="989f5-173">Consider a production database server like SQL Server or Oracle that can support High Availability.</span></span> <span data-ttu-id="989f5-174">От этой базы данных зависят критически важные рабочие приложения и пользователи.</span><span class="sxs-lookup"><span data-stu-id="989f5-174">Critical production applications and users depend on this database.</span></span> <span data-ttu-id="989f5-175">Hello план аварийного восстановления для этой системы может понадобиться hello toosupport следующие требования:</span><span class="sxs-lookup"><span data-stu-id="989f5-175">hello Disaster Recovery plan for this system may need toosupport hello following requirements:</span></span>

1. <span data-ttu-id="989f5-176">Данные должны быть защищены и иметь возможность восстановления.</span><span class="sxs-lookup"><span data-stu-id="989f5-176">Data must be protected and recoverable.</span></span>
2.  <span data-ttu-id="989f5-177">Сервер должен быть доступен для использования.</span><span class="sxs-lookup"><span data-stu-id="989f5-177">Server must be available for use.</span></span>

<span data-ttu-id="989f5-178">Для этого может потребоваться поддержание реплики базы данных hello в другом регионе в качестве резервной копии.</span><span class="sxs-lookup"><span data-stu-id="989f5-178">This may require maintaining a replica of hello database in a different region as a backup.</span></span> <span data-ttu-id="989f5-179">В зависимости от требований hello для обеспечения доступности сервера и восстановление данных hello решение может включать активный / активный "или" активный / пассивный реплики сайта tooperiodic автономного резервного копирования данных hello.</span><span class="sxs-lookup"><span data-stu-id="989f5-179">Depending on hello requirements for server availability and data recovery, hello solution could range from an Active-Active or Active-Passive replica site tooperiodic offline backups of hello data.</span></span> <span data-ttu-id="989f5-180">Реляционные базы данных, такие как SQL Server и Oracle, предоставляют различные варианты репликации.</span><span class="sxs-lookup"><span data-stu-id="989f5-180">Relational databases such as SQL Server and Oracle provide various options for replication.</span></span> <span data-ttu-id="989f5-181">Для обеспечения высокого уровня доступности в SQL Server можно использовать [Группы доступности Always On SQL Server](https://msdn.microsoft.com/library/hh510230.aspx).</span><span class="sxs-lookup"><span data-stu-id="989f5-181">For SQL Server, [SQL Server Always On Availability Groups](https://msdn.microsoft.com/library/hh510230.aspx) can be used for high availability.</span></span>

<span data-ttu-id="989f5-182">Для обеспечения избыточности в базах данных NoSQL, таких как MongoDB, также поддерживаются [реплики](https://docs.mongodb.com/manual/replication/).</span><span class="sxs-lookup"><span data-stu-id="989f5-182">NoSQL databases like MongoDB also support [replicas](https://docs.mongodb.com/manual/replication/) for redundancy.</span></span> <span data-ttu-id="989f5-183">можно использовать Hello реплики для обеспечения высокой доступности.</span><span class="sxs-lookup"><span data-stu-id="989f5-183">hello replicas for high availability can be used.</span></span>

### <a name="scenario-2-a-cluster-of-redundant-vms"></a><span data-ttu-id="989f5-184">Сценарий 2. Кластер избыточных виртуальных машин</span><span class="sxs-lookup"><span data-stu-id="989f5-184">Scenario 2: A cluster of redundant VMs</span></span>

<span data-ttu-id="989f5-185">Рассмотрим рабочую нагрузку, поддерживаемую кластером виртуальных машин, который обеспечивает избыточность и балансировку нагрузки.</span><span class="sxs-lookup"><span data-stu-id="989f5-185">Consider a workload handled by a cluster of VMs that provide redundancy and load balancing.</span></span> <span data-ttu-id="989f5-186">В качестве примера такой нагрузки можно рассмотреть кластер Cassandra, развернутый в регионе.</span><span class="sxs-lookup"><span data-stu-id="989f5-186">One example would be a Cassandra cluster deployed in a region.</span></span> <span data-ttu-id="989f5-187">Этот тип архитектуры уже обеспечивает высокий уровень избыточности в этом регионе.</span><span class="sxs-lookup"><span data-stu-id="989f5-187">This type of architecture already provides a high level of redundancy within that region.</span></span> <span data-ttu-id="989f5-188">Тем не менее рабочая нагрузка hello tooprotect региональных уровня после сбоя, следует распространение hello кластеров в двух областях или сделав области tooanother периодическое резервное копирование.</span><span class="sxs-lookup"><span data-stu-id="989f5-188">However, tooprotect hello workload from a regional level failure, you should consider spreading hello cluster across two regions or making periodic backups tooanother region.</span></span>

### <a name="scenario-3-iaas-application-workload"></a><span data-ttu-id="989f5-189">Сценарий 3. Рабочая нагрузка приложения IaaS</span><span class="sxs-lookup"><span data-stu-id="989f5-189">Scenario 3: IaaS Application Workload</span></span>

<span data-ttu-id="989f5-190">К такой рабочей нагрузке можно отнести обычную рабочую нагрузку, запущенную на виртуальной машине Azure.</span><span class="sxs-lookup"><span data-stu-id="989f5-190">This could be a typical production workload running on an Azure VM.</span></span> <span data-ttu-id="989f5-191">Например это может быть веб-сервера или файлового сервера, удерживая hello содержимое и другие ресурсы сайта.</span><span class="sxs-lookup"><span data-stu-id="989f5-191">For example, it could be a web server or file server holding hello content and other resources of a site.</span></span> <span data-ttu-id="989f5-192">Это также может быть запущен на виртуальной Машине, хранятся на дисках виртуальной Машины hello его данных, ресурсов и состояния приложения пользовательские бизнес-приложений.</span><span class="sxs-lookup"><span data-stu-id="989f5-192">It could also be a custom-built business application running on a VM that stored its data, resources, and application state on hello VM disks.</span></span> <span data-ttu-id="989f5-193">В этом случае это важно toomake в том, что резервные копии на регулярной основе.</span><span class="sxs-lookup"><span data-stu-id="989f5-193">In this case, it is important toomake sure you take backups on a regular basis.</span></span> <span data-ttu-id="989f5-194">Интервал резервного копирования должно быть основано на характер hello нагрузки виртуальной Машины hello.</span><span class="sxs-lookup"><span data-stu-id="989f5-194">Backup frequency should be based on hello nature of hello VM workload.</span></span> <span data-ttu-id="989f5-195">Например приложение hello запускается каждый день и изменяет данные, затем hello резервная копия должна ли быть принята каждый час.</span><span class="sxs-lookup"><span data-stu-id="989f5-195">For example, if hello application runs every day and modifies data, then hello backup should be taken every hour.</span></span>

<span data-ttu-id="989f5-196">Еще один пример — сервер отчетов, который извлекает данные из других источников и создает статистические отчеты.</span><span class="sxs-lookup"><span data-stu-id="989f5-196">Another example is a reporting server that pull data from other sources and generates aggregated reports.</span></span> <span data-ttu-id="989f5-197">Потери этой виртуальной Машины или дисков могут стать причиной потери toohello hello отчетов.</span><span class="sxs-lookup"><span data-stu-id="989f5-197">Loss of this VM or disks will lead toohello loss of hello reports.</span></span> <span data-ttu-id="989f5-198">Тем не менее часто бывает hello возможных toorerun процесса и повторное создание hello выходные данные отчетов.</span><span class="sxs-lookup"><span data-stu-id="989f5-198">However, it may be possible toorerun hello reporting process and regenerate hello output.</span></span> <span data-ttu-id="989f5-199">В этом случае не нужно действительно потери данных, даже если hello сервера отчетов с аварии, поэтому может иметь более высокий уровень отклонения для потери части данных hello на приветствия сервера отчетов.</span><span class="sxs-lookup"><span data-stu-id="989f5-199">In that case, you don’t really have a loss of data even if hello reporting server is hit with a disaster, so you could have a higher level of tolerance for losing part of hello data on hello reporting server.</span></span> <span data-ttu-id="989f5-200">В этом случае более частое создание резервных копий является параметр tooreduce hello затрат.</span><span class="sxs-lookup"><span data-stu-id="989f5-200">In that case, less frequent backups is an option tooreduce hello cost.</span></span>

### <a name="scenario-4-iaas-application-data-issues"></a><span data-ttu-id="989f5-201">Сценарий 4. Проблемы с данными для приложения IaaS</span><span class="sxs-lookup"><span data-stu-id="989f5-201">Scenario 4: IaaS Application data issues</span></span>

<span data-ttu-id="989f5-202">У вас есть приложение, которое вычисляет, хранит и обслуживает критически важные коммерческие данные, такие как сведения о ценах.</span><span class="sxs-lookup"><span data-stu-id="989f5-202">You have an application that computes, maintains, and serves critical commercial data such as pricing information.</span></span> <span data-ttu-id="989f5-203">Новая версия приложения были ошибки программного обеспечения, которой неправильно вычислено цены hello и поврежденные данные commerce существующих hello, обслуживаемых hello платформы.</span><span class="sxs-lookup"><span data-stu-id="989f5-203">A new version of your application had a software bug which incorrectly computed hello pricing and corrupted hello existing commerce data served by hello platform.</span></span> <span data-ttu-id="989f5-204">Здесь hello наилучшее решение будет toorevert toohello более ранней версии приложения hello и hello данных первого.</span><span class="sxs-lookup"><span data-stu-id="989f5-204">Here, hello best course of action would be toorevert toohello earlier version of hello application and hello data first.</span></span> <span data-ttu-id="989f5-205">tooenable этого, принимают периодическое резервное копирование системы.</span><span class="sxs-lookup"><span data-stu-id="989f5-205">tooenable this, take periodic backups of your system.</span></span>

## <a name="disaster-recovery-solution-azure-backup-service"></a><span data-ttu-id="989f5-206">Решение для аварийного восстановления: служба архивация Azure</span><span class="sxs-lookup"><span data-stu-id="989f5-206">Disaster Recovery Solution: Azure Backup Service</span></span>

<span data-ttu-id="989f5-207">[Службу архивации Azure](https://azure.microsoft.com/services/backup/) можно использовать для архивации и аварийного восстановления. Эта служба работает как с [управляемыми](storage-managed-disks-overview.md), так и с [неуправляемыми](storage-about-disks-and-vhds-windows.md#unmanaged-disks) дисками.</span><span class="sxs-lookup"><span data-stu-id="989f5-207">[Azure Backup Service](https://azure.microsoft.com/services/backup/) is can be used for Backup and DR, and it works with [Managed Disks](storage-managed-disks-overview.md) as well as [Unmanaged Disks](storage-about-disks-and-vhds-windows.md#unmanaged-disks).</span></span> <span data-ttu-id="989f5-208">Вы можете создавать задания архивации с учетом времени, легко восстанавливать виртуальные машины и использовать политики хранения архивов.</span><span class="sxs-lookup"><span data-stu-id="989f5-208">You can create a backup job with time-based backups, easy VM restoration and backup retention policies.</span></span> 

<span data-ttu-id="989f5-209">При использовании [дисках хранилища Premium](storage-premium-storage.md), [управляемых дисков](storage-managed-disks-overview.md), или другие типы дисков с помощью hello [локально избыточное хранилище (LRS)](storage-redundancy.md#locally-redundant-storage) параметр, это особенно важно tooleverage Периодическое резервное копирование аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="989f5-209">If you use [Premium Storage disks](storage-premium-storage.md), [Managed Disks](storage-managed-disks-overview.md), or other disk types with hello [locally redundant storage (LRS)](storage-redundancy.md#locally-redundant-storage) option, it is especially important tooleverage periodic DR backups.</span></span> <span data-ttu-id="989f5-210">Резервное копирование Azure хранит данные hello в хранилище служб восстановления для долговременного хранения.</span><span class="sxs-lookup"><span data-stu-id="989f5-210">Azure Backup stores hello data in your Recovery Services vault for long term retention.</span></span> <span data-ttu-id="989f5-211">Выберите hello [географически избыточное хранилище (GRS)](storage-redundancy.md#geo-redundant-storage) параметр для hello службы восстановления резервной копии в хранилище.</span><span class="sxs-lookup"><span data-stu-id="989f5-211">Choose hello [Geo-redundant storage (GRS)](storage-redundancy.md#geo-redundant-storage) option for hello Backup Recovery Services vault.</span></span> <span data-ttu-id="989f5-212">Убедитесь, что резервные копии находятся в другом регионе Azure реплицированных tooa для защиты от аварий регионального.</span><span class="sxs-lookup"><span data-stu-id="989f5-212">That will ensure backups are replicated tooa different Azure region for safeguarding from regional disasters.</span></span>

<span data-ttu-id="989f5-213">Для [неуправляемые дисков](storage-about-disks-and-vhds-windows.md#unmanaged-disks), можно использовать тип хранения LRS hello для дисков IaaS, но включить резервное копирование Azure с hello параметр GRS для hello хранилище служб восстановления.</span><span class="sxs-lookup"><span data-stu-id="989f5-213">For [Unmanaged Disks](storage-about-disks-and-vhds-windows.md#unmanaged-disks), you can use hello LRS storage type for IaaS disks, but ensure that Azure Backup is enabled with hello GRS option for hello Recovery Services Vault.</span></span>

<span data-ttu-id="989f5-214">**Если вы используете hello [GRS](storage-redundancy.md#geo-redundant-storage)/[RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage) параметр для неуправляемых дисков, вы по-прежнему требуется моментальных снимков для резервного копирования и аварийного восстановления.**</span><span class="sxs-lookup"><span data-stu-id="989f5-214">**If you use hello [GRS](storage-redundancy.md#geo-redundant-storage)/[RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage) option for your Unmanaged Disks, you still need consistent snapshots for Backup and DR.**</span></span> <span data-ttu-id="989f5-215">Необходимо использовать [службу архивации Azure](https://azure.microsoft.com/services/backup/) или [моментальные снимки](#alternative-solution-consistent-snapshots).</span><span class="sxs-lookup"><span data-stu-id="989f5-215">You must use either [Azure Backup Service](https://azure.microsoft.com/services/backup/) or [consistent snapshots](#alternative-solution-consistent-snapshots).</span></span>

<span data-ttu-id="989f5-216">Hello ниже приводится сводка решений для аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="989f5-216">hello following is a summary of solutions for DR.</span></span>

| <span data-ttu-id="989f5-217">Сценарий</span><span class="sxs-lookup"><span data-stu-id="989f5-217">Scenario</span></span> | <span data-ttu-id="989f5-218">Автоматическая репликация</span><span class="sxs-lookup"><span data-stu-id="989f5-218">Automatic Replication</span></span> | <span data-ttu-id="989f5-219">Решение аварийного восстановления</span><span class="sxs-lookup"><span data-stu-id="989f5-219">DR Solution</span></span> |
| --- | --- | --- |
| <span data-ttu-id="989f5-220">*Диски хранилища класса "Премиум"*</span><span class="sxs-lookup"><span data-stu-id="989f5-220">*Premium Storage Disks*</span></span> | <span data-ttu-id="989f5-221">Локальная ([локально избыточное хранилище](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="989f5-221">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="989f5-222">Служба архивации Azure</span><span class="sxs-lookup"><span data-stu-id="989f5-222">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="989f5-223">*Управляемые диски*</span><span class="sxs-lookup"><span data-stu-id="989f5-223">*Managed Disks*</span></span> | <span data-ttu-id="989f5-224">Локальная ([локально избыточное хранилище](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="989f5-224">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="989f5-225">Служба архивации Azure</span><span class="sxs-lookup"><span data-stu-id="989f5-225">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="989f5-226">*Неуправляемые диски локально избыточного хранилища*</span><span class="sxs-lookup"><span data-stu-id="989f5-226">*Unmanaged LRS Disks*</span></span> | <span data-ttu-id="989f5-227">Локальная ([локально избыточное хранилище](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="989f5-227">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="989f5-228">Служба архивации Azure</span><span class="sxs-lookup"><span data-stu-id="989f5-228">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="989f5-229">*Неуправляемые диски геоизбыточного хранилища*</span><span class="sxs-lookup"><span data-stu-id="989f5-229">*Unmanaged GRS Disks*</span></span> | <span data-ttu-id="989f5-230">Межрегиональная ([геоизбыточное хранилище](storage-redundancy.md#geo-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="989f5-230">Cross region ([GRS](storage-redundancy.md#geo-redundant-storage))</span></span> | [<span data-ttu-id="989f5-231">Служба архивации Azure</span><span class="sxs-lookup"><span data-stu-id="989f5-231">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/)<br/>[<span data-ttu-id="989f5-232">Согласованные моментальные снимки</span><span class="sxs-lookup"><span data-stu-id="989f5-232">Consistent snapshots</span></span>](#alternative-solution-consistent-snapshots) |
| <span data-ttu-id="989f5-233">*Неуправляемые диски геоизбыточного хранилища с доступом на чтение*</span><span class="sxs-lookup"><span data-stu-id="989f5-233">*Unmanaged RA-GRS Disks*</span></span> | <span data-ttu-id="989f5-234">Межрегиональная ([геоизбыточное хранилище с доступом на чтение](storage-redundancy.md#read-access-geo-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="989f5-234">Cross region ([RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage))</span></span> | [<span data-ttu-id="989f5-235">Служба архивации Azure</span><span class="sxs-lookup"><span data-stu-id="989f5-235">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/)<br/>[<span data-ttu-id="989f5-236">Согласованные моментальные снимки</span><span class="sxs-lookup"><span data-stu-id="989f5-236">Consistent snapshots</span></span>](#alternative-solution-consistent-snapshots) |

<span data-ttu-id="989f5-237">Высокий уровень доступности можно путем соответствовать посредством использования hello управляемый дисков в группе доступности вместе с Azure Backup.</span><span class="sxs-lookup"><span data-stu-id="989f5-237">High availability can best by met through hello use of Managed Disks in an Availability Set along with Azure Backup.</span></span> <span data-ttu-id="989f5-238">Для неуправляемых дисков все равно можно использовать службу архивации Azure для аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="989f5-238">If you are using Unmanaged Disks, you can still  use Azure Backup for DR.</span></span> <span data-ttu-id="989f5-239">Если не удается toouse резервного копирования Azure, затем выполняя [снимков](#alternative-solution-consistent-snapshots) как описано в следующем разделе является альтернативным решением для резервного копирования и аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="989f5-239">If you are unable toouse Azure Backup, then taking [consistent snapshots](#alternative-solution-consistent-snapshots) as described in a later section is an alternative solution for Backup and DR.</span></span>

<span data-ttu-id="989f5-240">Выбранные параметры высокой доступности, архивации и аварийного восстановления на уровне приложения или инфраструктуры можно представить следующим образом:</span><span class="sxs-lookup"><span data-stu-id="989f5-240">Your choices for high availability, backup and DR at Application or Infrastructure levels can be represented as below:</span></span>

| <span data-ttu-id="989f5-241">*Level*</span><span class="sxs-lookup"><span data-stu-id="989f5-241">*Level*</span></span> | <span data-ttu-id="989f5-242">Высокая доступность</span><span class="sxs-lookup"><span data-stu-id="989f5-242">High Availability</span></span>   | <span data-ttu-id="989f5-243">Архивация/аварийное восстановление</span><span class="sxs-lookup"><span data-stu-id="989f5-243">Backup / DR</span></span> |
| --- | --- | --- |
| <span data-ttu-id="989f5-244">*Приложения*</span><span class="sxs-lookup"><span data-stu-id="989f5-244">*Application*</span></span> | <span data-ttu-id="989f5-245">SQL Always On</span><span class="sxs-lookup"><span data-stu-id="989f5-245">SQL Always On</span></span> | <span data-ttu-id="989f5-246">Служба архивации Azure</span><span class="sxs-lookup"><span data-stu-id="989f5-246">Azure Backup</span></span> |
| <span data-ttu-id="989f5-247">*Инфраструктура*</span><span class="sxs-lookup"><span data-stu-id="989f5-247">*Infrastructure*</span></span>  | <span data-ttu-id="989f5-248">Группа доступности</span><span class="sxs-lookup"><span data-stu-id="989f5-248">Availability Set</span></span>  | <span data-ttu-id="989f5-249">Геоизбыточное хранилище с согласованными моментальными снимками</span><span class="sxs-lookup"><span data-stu-id="989f5-249">GRS with consistent snapshots</span></span> |

### <a name="using-hello-azure-backup-service"></a><span data-ttu-id="989f5-250">С помощью службы архивации Azure hello</span><span class="sxs-lookup"><span data-stu-id="989f5-250">Using hello Azure Backup Service</span></span>

<span data-ttu-id="989f5-251">[Резервное копирование Azure](../backup/backup-azure-vms-introduction.md) может выполнять резервное копирование виртуальных машин под управлением Windows или Linux toohello хранилище служб восстановления Azure.</span><span class="sxs-lookup"><span data-stu-id="989f5-251">[Azure Backup](../backup/backup-azure-vms-introduction.md) can backup your VMs running Windows or Linux toohello Azure Recovery Services Vault.</span></span> <span data-ttu-id="989f5-252">Резервное копирование и восстановление данных на важных осложняется hello факт, что важные данные, следует воспользоваться резервным копированием при hello приложений, обеспечивающих hello данных работают.</span><span class="sxs-lookup"><span data-stu-id="989f5-252">Backing up and restoring business-critical data is complicated by hello fact that business-critical data must be backed up while hello applications that produce hello data are running.</span></span> <span data-ttu-id="989f5-253">tooaddress, служба архивации Azure предлагает резервных копий, согласованных приложения для рабочих нагрузок Майкрософт с помощью tooensure hello службы теневого тома (VSS), что данные записываются правильно toostorage.</span><span class="sxs-lookup"><span data-stu-id="989f5-253">tooaddress this, Azure Backup provides application-consistent backups for Microsoft workloads by using hello Volume Shadow Service (VSS) tooensure that data is written correctly toostorage.</span></span> <span data-ttu-id="989f5-254">Для виртуальных машин Linux только совместимые в файлами резервных копий возможны, поскольку Linux отсутствует эквивалент tooVSS функциональные возможности.</span><span class="sxs-lookup"><span data-stu-id="989f5-254">For Linux VMs, only file-consistent backups are possible, since Linux does not have functionality equivalent tooVSS.</span></span>

![][1]

<span data-ttu-id="989f5-255">При архивации Azure инициирует задание резервного копирования во время запланированного hello, система инициирует установлены в hello tootake ВМ моментальный снимок в момент расширение резервного копирования hello.</span><span class="sxs-lookup"><span data-stu-id="989f5-255">When Azure Backup initiates a backup job at hello scheduled time, it triggers hello backup extension installed in hello VM tootake a point-in-time snapshot.</span></span> <span data-ttu-id="989f5-256">Моментальный снимок совместно с VSS tooget согласованный моментальный снимок hello дисков на виртуальной машине hello без необходимости tooshut его работу.</span><span class="sxs-lookup"><span data-stu-id="989f5-256">A snapshot is taken in coordination with VSS tooget a consistent snapshot of hello disks in hello virtual machine without having tooshut it down.</span></span> <span data-ttu-id="989f5-257">расширение резервного копирования Hello в hello ВМ очищает все операции записи перед созданием hello согласованный моментальный снимок всех дисков hello.</span><span class="sxs-lookup"><span data-stu-id="989f5-257">hello backup extension in hello VM flushes all writes before taking hello consistent snapshot of all hello disks.</span></span> <span data-ttu-id="989f5-258">После hello моментальный снимок, hello данные передаются с резервного копирования Azure toohello резервного хранилища.</span><span class="sxs-lookup"><span data-stu-id="989f5-258">After hello snapshot is taken, hello data is transferred by Azure Backup toohello backup vault.</span></span> <span data-ttu-id="989f5-259">toomake hello процесс резервного копирования более эффективно, служба hello идентифицирует и передает только hello блоков данных, которые были изменены с момента последнего резервного копирования hello.</span><span class="sxs-lookup"><span data-stu-id="989f5-259">toomake hello backup process more efficient, hello service identifies and transfers only hello blocks of data that have changed since hello last backup.</span></span>


<span data-ttu-id="989f5-260">toorestore, вы можете просматривать hello доступные резервные копии Azure с помощью и затем запустить восстановление.</span><span class="sxs-lookup"><span data-stu-id="989f5-260">toorestore, you can view hello available backups through Azure Backup and then initiate a restore.</span></span> <span data-ttu-id="989f5-261">Можно создать и восстановления резервных копий в Azure через hello [портал Azure](https://portal.azure.com/), [с помощью PowerShell](../backup/backup-azure-vms-automation.md ), или с помощью hello [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install).</span><span class="sxs-lookup"><span data-stu-id="989f5-261">You can create and restore Azure backups through hello [Azure portal](https://portal.azure.com/), [using PowerShell](../backup/backup-azure-vms-automation.md ), or using hello [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install).</span></span> <span data-ttu-id="989f5-262">Дополнительные сведения см. в разделе "Служба архивации Azure".</span><span class="sxs-lookup"><span data-stu-id="989f5-262">For more information, see Azure Backup.</span></span>

### <a name="steps-tooenable-backup"></a><span data-ttu-id="989f5-263">TooEnable действия резервной копии</span><span class="sxs-lookup"><span data-stu-id="989f5-263">Steps tooEnable Backup</span></span>

<span data-ttu-id="989f5-264">Hello следующие действия являются типовыми tooenable резервные копии виртуальных машин с помощью hello [портала Azure](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="989f5-264">hello following steps are typically used tooenable backups of your VMs using hello [Azure Portal](https://portal.azure.com/).</span></span> <span data-ttu-id="989f5-265">Возможны некоторые различия в зависимости от вашего сценария.</span><span class="sxs-lookup"><span data-stu-id="989f5-265">There will be some variations depending on your exact scenario.</span></span> <span data-ttu-id="989f5-266">См. toohello [резервного копирования Azure](../backup/backup-azure-vms-introduction.md) документации полные сведения.</span><span class="sxs-lookup"><span data-stu-id="989f5-266">Refer toohello [Azure Backup](../backup/backup-azure-vms-introduction.md) documentation for full details.</span></span> <span data-ttu-id="989f5-267">Служба архивации Azure также [поддерживает виртуальные машины с управляемыми дисками](https://azure.microsoft.com/blog/azure-managed-disk-backup/).</span><span class="sxs-lookup"><span data-stu-id="989f5-267">Azure Backup also [supports VMs with Managed Disks](https://azure.microsoft.com/blog/azure-managed-disk-backup/).</span></span>

1.  <span data-ttu-id="989f5-268">Создайте хранилище служб восстановления для виртуальной Машины с помощью hello следующие шаги:</span><span class="sxs-lookup"><span data-stu-id="989f5-268">Create a recovery services vault for a VM using hello following steps:</span></span>

    <span data-ttu-id="989f5-269">а.</span><span class="sxs-lookup"><span data-stu-id="989f5-269">a.</span></span>  <span data-ttu-id="989f5-270">С помощью hello [портал Azure](https://portal.azure.com/)найдите все ресурсы и найти «Хранилищами служб восстановления».</span><span class="sxs-lookup"><span data-stu-id="989f5-270">Using hello [Azure portal](https://portal.azure.com/), browse all resources and find “Recovery Services vaults”.</span></span>

    <span data-ttu-id="989f5-271">b.</span><span class="sxs-lookup"><span data-stu-id="989f5-271">b.</span></span>  <span data-ttu-id="989f5-272">На hello службы восстановления хранилищ меню, нажмите кнопку Добавить и выполните шаги hello toocreate новое хранилище в hello же регионе, что hello виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="989f5-272">On hello Recovery Services vaults menu, click Add and follow hello steps toocreate a new vault in hello same region as hello VM.</span></span> <span data-ttu-id="989f5-273">Например если ваша ВМ находится в регионе, Запад США, выберите Запад США для hello хранилища.</span><span class="sxs-lookup"><span data-stu-id="989f5-273">For example, if your VM is in West US region, pick West US for hello vault.</span></span>

2.  <span data-ttu-id="989f5-274">Проверьте репликацию хранилища hello для hello созданное хранилище.</span><span class="sxs-lookup"><span data-stu-id="989f5-274">Verify hello Storage replication for hello newly created vault.</span></span> <span data-ttu-id="989f5-275">toodo хранилища hello, доступ из hello службы восстановления хранилищ колонки и go toohello параметры резервного копирования или конфигурации.</span><span class="sxs-lookup"><span data-stu-id="989f5-275">toodo this, access hello vault from hello Recovery Services vaults blade and go toohello settings/Backup Configuration.</span></span> <span data-ttu-id="989f5-276">Убедитесь, что hello GRS параметр выбран по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="989f5-276">Ensure hello GRS option is selected by default.</span></span> <span data-ttu-id="989f5-277">Это обеспечит ваше хранилище автоматически реплицированных tooa вторичный центр обработки данных.</span><span class="sxs-lookup"><span data-stu-id="989f5-277">This will ensure that your vault is automatically replicated tooa secondary data center.</span></span> <span data-ttu-id="989f5-278">Например хранилище на Западе США будет автоматически реплицированных tooEast США.</span><span class="sxs-lookup"><span data-stu-id="989f5-278">For example, your vault in West US will be automatically replicated tooEast US.</span></span>

3.  <span data-ttu-id="989f5-279">Настройте политику резервного копирования hello и выберите hello виртуальной Машины из hello же пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="989f5-279">Configure hello backup policy and select hello VM from hello same UI.</span></span>

4.  <span data-ttu-id="989f5-280">Убедитесь, что приветствия на hello виртуальной Машине установлен агент резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="989f5-280">Make sure hello Backup Agent is installed on hello VM.</span></span> <span data-ttu-id="989f5-281">Если ВМ создается с помощью образа коллекции Azure, уже установлены агент резервного копирования hello.</span><span class="sxs-lookup"><span data-stu-id="989f5-281">If your VM is created using an Azure gallery image, then hello Backup agent is already installed.</span></span> <span data-ttu-id="989f5-282">В противном случае (Если вы используете пользовательский образ), используйте инструкции слишком[hello установки агента виртуальной Машины на виртуальной машине hello](../backup/backup-azure-arm-vms-prepare.md#install-the-vm-agent-on-the-virtual-machine).</span><span class="sxs-lookup"><span data-stu-id="989f5-282">Otherwise (that is, if you are using a custom image), use instructions too[Install hello VM Agent on hello virtual machine](../backup/backup-azure-arm-vms-prepare.md#install-the-vm-agent-on-the-virtual-machine).</span></span>

5.  <span data-ttu-id="989f5-283">Убедитесь, что hello виртуальной Машины позволяет сетевым подключением toofunction hello службы резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="989f5-283">Make sure that hello VM allows network connectivity for hello backup service toofunction.</span></span> <span data-ttu-id="989f5-284">Для настройки сетевого подключения выполните действия, описанные в [этом разделе](../backup/backup-azure-arm-vms-prepare.md#network-connectivity).</span><span class="sxs-lookup"><span data-stu-id="989f5-284">Follow these instructions for [Network connectivity](../backup/backup-azure-arm-vms-prepare.md#network-connectivity).</span></span>

6.  <span data-ttu-id="989f5-285">После завершения hello выше шаги для запуска архивации hello через регулярные интервалы, как указано в политику резервного копирования hello.</span><span class="sxs-lookup"><span data-stu-id="989f5-285">Once hello above steps are completed, hello backup will run at regular intervals as specified in hello backup policy.</span></span> <span data-ttu-id="989f5-286">При необходимости вы можете активировать hello первой резервной копии вручную из hello мониторинга хранилища на hello портал Azure.</span><span class="sxs-lookup"><span data-stu-id="989f5-286">If necessary, you can trigger hello first backup manually from hello vault dashboard on hello Azure portal.</span></span>

<span data-ttu-id="989f5-287">Для автоматизации резервного копирования Azure с помощью скриптов, можно найти слишком[командлеты PowerShell для резервного копирования виртуальной Машины](../backup/backup-azure-vms-automation.md).</span><span class="sxs-lookup"><span data-stu-id="989f5-287">For automating Azure Backup using scripts, please refer too[PowerShell cmdlets for VM backup](../backup/backup-azure-vms-automation.md).</span></span>

### <a name="steps-for-recovery"></a><span data-ttu-id="989f5-288">Действия для восстановления</span><span class="sxs-lookup"><span data-stu-id="989f5-288">Steps for Recovery</span></span>

<span data-ttu-id="989f5-289">Если необходимо toorepair или перестроить виртуальной Машины, hello виртуальной Машины можно восстановить из любой точки восстановления резервной копии hello в хранилище hello.</span><span class="sxs-lookup"><span data-stu-id="989f5-289">If you need toorepair or rebuild a VM, you can restore hello VM from any of hello backup recovery points in hello vault.</span></span> <span data-ttu-id="989f5-290">Существует несколько различных параметров для выполнения восстановления hello:</span><span class="sxs-lookup"><span data-stu-id="989f5-290">There are a couple of different options for performing hello recovery:</span></span>

1.  <span data-ttu-id="989f5-291">Вы можете создать новую виртуальную машину, которая будет представлять собой архивированную виртуальную машину в определенный момент времени.</span><span class="sxs-lookup"><span data-stu-id="989f5-291">You can create a new VM as a point-in-time representation of your backed-up VM.</span></span>

2.  <span data-ttu-id="989f5-292">Можно восстановить диски hello и затем применять шаблон hello для виртуальной Машины toocustomize hello и перестроения hello восстановления виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="989f5-292">You can restore hello disks and then use hello template for hello VM toocustomize and rebuild hello restored VM.</span></span> 

<span data-ttu-id="989f5-293">См. инструкции слишком[виртуальных машин Azure используйте портала toorestore](../backup/backup-azure-arm-restore-vms.md#restoring-a-vm-during-azure-datacenter-disaster).</span><span class="sxs-lookup"><span data-stu-id="989f5-293">See instructions too[Use Azure portal toorestore virtual machines](../backup/backup-azure-arm-restore-vms.md#restoring-a-vm-during-azure-datacenter-disaster).</span></span> <span data-ttu-id="989f5-294">Hello документ также объясняется hello конкретные шаги для восстановления резервных копий виртуальных машин toohello парной ЦОД с помощью геоизбыточных резервного хранилища в случае аварии на hello основного центра обработки данных, когда hello.</span><span class="sxs-lookup"><span data-stu-id="989f5-294">hello document also explains hello specific steps for restoring backed-up VMs toohello paired data center using your geo-redundant backup vault in hello case of a disaster at hello primary data center.</span></span> <span data-ttu-id="989f5-295">В этом случае резервного копирования Azure использует службы вычислений hello hello дополнительный регион toocreate hello восстановления виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="989f5-295">In that case, Azure Backup uses hello Compute service from hello secondary region toocreate hello restored virtual machine.</span></span>

<span data-ttu-id="989f5-296">Вы также можете [восстановить виртуальную машину](../backup/backup-azure-vms-automation.md#restore-an-azure-vm) с помощью PowerShell или [создать новую виртуальную машину из восстановленных дисков](../backup/backup-azure-vms-automation.md#create-a-vm-from-restored-disks).</span><span class="sxs-lookup"><span data-stu-id="989f5-296">You can also use PowerShell for [restoring a VM](../backup/backup-azure-vms-automation.md#restore-an-azure-vm) or for [creating a new VM from restored disks](../backup/backup-azure-vms-automation.md#create-a-vm-from-restored-disks).</span></span>

## <a name="alternative-solution-consistent-snapshots"></a><span data-ttu-id="989f5-297">Альтернативное решение: согласованные моментальные снимки</span><span class="sxs-lookup"><span data-stu-id="989f5-297">Alternative Solution: Consistent Snapshots</span></span>

<span data-ttu-id="989f5-298">Если не удается toouse hello службы резервного копирования Azure, можно реализовать собственный механизм резервного копирования, с использованием моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="989f5-298">If you are unable toouse hello Azure Backup Service, you can implement your own backup mechanism using snapshots.</span></span> <span data-ttu-id="989f5-299">Он является сложной toocreate моментальные снимки для всех дисков, используемых виртуальной машиной, а затем реплицировать эти области tooanother моментальные снимки.</span><span class="sxs-lookup"><span data-stu-id="989f5-299">It is complicated toocreate consistent snapshots for all disks used by a VM and then replicate those snapshots tooanother region.</span></span> <span data-ttu-id="989f5-300">По этой причине Azure считает, что использование hello службы резервного копирования лучшим вариантом, чем создание пользовательского решения.</span><span class="sxs-lookup"><span data-stu-id="989f5-300">For this reason, Azure considers leveraging hello Backup Service a better option than building a custom solution.</span></span> <span data-ttu-id="989f5-301">При использовании хранилища GRS или RA-GRS для дисков, моментальные снимки доступны автоматически реплицированных tooa вторичный центр обработки данных.</span><span class="sxs-lookup"><span data-stu-id="989f5-301">If you use RA-GRS/GRS storage for disks, snapshots are automatically replicated tooa secondary data center.</span></span> <span data-ttu-id="989f5-302">При использовании LRS хранения для дисков, необходимо будет tooreplicate hello данных самостоятельно.</span><span class="sxs-lookup"><span data-stu-id="989f5-302">If you use LRS storage for disks, you will need tooreplicate hello data yourself.</span></span> <span data-ttu-id="989f5-303">Дополнительные сведения см. в разделе [Архивация неуправляемых дисков виртуальной машины Azure с помощью добавочных моментальных снимков](storage-incremental-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="989f5-303">For more information, see [Back up Azure unmanaged VM disks with incremental snapshots](storage-incremental-snapshots.md).</span></span>

<span data-ttu-id="989f5-304">Моментальный снимок — это представление объекта в определенный момент времени.</span><span class="sxs-lookup"><span data-stu-id="989f5-304">A snapshot is a representation of an object at a specific point in time.</span></span> <span data-ttu-id="989f5-305">Моментальный снимок повлечет за собой выставления счетов для hello добавочное размер hello данных он содержит.</span><span class="sxs-lookup"><span data-stu-id="989f5-305">A snapshot will incur billing for hello incremental size of hello data it holds.</span></span> <span data-ttu-id="989f5-306">Дополнительные сведения см. в разделе [Создание моментального снимка BLOB-объекта](storage-blob-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="989f5-306">For more information, see [Create a blob snapshot](storage-blob-snapshots.md).</span></span>

### <a name="creating-snapshots-while-hello-vm-is-running"></a><span data-ttu-id="989f5-307">Создание моментальных снимков при hello Виртуальная машина запущена</span><span class="sxs-lookup"><span data-stu-id="989f5-307">Creating snapshots while hello VM is running</span></span>

<span data-ttu-id="989f5-308">Моментального снимка можно выполнить в любое время, в случае hello Виртуальная машина запущена, по-прежнему данных потоковой передачи toohello диски и моментальные снимки hello может содержать частичного операций, которые были в процессе передачи.</span><span class="sxs-lookup"><span data-stu-id="989f5-308">While you can take a snapshot at any time, if hello VM is running, there is still data being streamed toohello disks, and hello snapshots may contain partial operations that were in flight.</span></span> <span data-ttu-id="989f5-309">Кроме того если задействованы несколько дисков, моментальные снимки hello различных дисков мог произойти в разное время, что означает, что эти моментальные снимки не может быть согласован.</span><span class="sxs-lookup"><span data-stu-id="989f5-309">Also, if there are several disks involved, hello snapshots of different disks may have occurred at different times, which means these snapshots may not be coordinated.</span></span> <span data-ttu-id="989f5-310">Это представляет особенную сложность для томов с чередованием, файлы на которых могут быть повреждены, если в ходе архивации данные были изменены.</span><span class="sxs-lookup"><span data-stu-id="989f5-310">This is especially problematic for striped volumes whose files can be corrupted if changes were being made during backup.</span></span>

<span data-ttu-id="989f5-311">tooavoid этой ситуации hello процесс резервного копирования необходимо реализовать hello следующие шаги:</span><span class="sxs-lookup"><span data-stu-id="989f5-311">tooavoid this situation, hello backup process must implement hello following steps:</span></span>

1.  <span data-ttu-id="989f5-312">Заморозить все диски hello</span><span class="sxs-lookup"><span data-stu-id="989f5-312">Freeze all hello disks</span></span>

2.  <span data-ttu-id="989f5-313">Очистить все hello ожидающие операции записи</span><span class="sxs-lookup"><span data-stu-id="989f5-313">Flush all hello pending writes</span></span>

3.  <span data-ttu-id="989f5-314">Затем [создания моментального снимка большого двоичного объекта](storage-blob-snapshots.md) для всех hello дисков</span><span class="sxs-lookup"><span data-stu-id="989f5-314">Then, [create a blob snapshot](storage-blob-snapshots.md) for all hello disks</span></span>

<span data-ttu-id="989f5-315">Некоторые приложения Windows, как SQL Server предоставляет механизм скоординированного резервного копирования через VSS, согласованные с приложениями toocreate резервных копий.</span><span class="sxs-lookup"><span data-stu-id="989f5-315">Some Windows applications like SQL Server provide a coordinated backup mechanism via VSS toocreate application-consistent backups.</span></span> <span data-ttu-id="989f5-316">В Linux можно использовать средства, подобного fsfreeze координацию hello диски, обеспечивающие совместимые в файлами резервных копий, но не моментальные снимки приложений.</span><span class="sxs-lookup"><span data-stu-id="989f5-316">On Linux, you can use a tool like fsfreeze for coordinating hello disks, which will provide file-consistent backups, but not application-consistent snapshots.</span></span> <span data-ttu-id="989f5-317">Этот процесс весьма сложен, поэтому следует воспользоваться [службой архивации Azure](../backup/backup-azure-vms-introduction.md) или сторонним решением архивации, в котором уже реализован этот механизм.</span><span class="sxs-lookup"><span data-stu-id="989f5-317">This process is complicated, so and you should consider using [Azure Backup](../backup/backup-azure-vms-introduction.md) or a third-party backup solution which already implement this.</span></span>

<span data-ttu-id="989f5-318">Hello выше процесса приведет к коллекции скоординированного моментальных снимков для всех дисков виртуальной Машины hello, представления конкретного момента времени hello виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="989f5-318">hello above process will result in a collection of coordinated snapshots for all hello VM disks, representing a specific point-in-time view of hello VM.</span></span> <span data-ttu-id="989f5-319">Это точка резервного копирования и восстановления для виртуальной Машины hello.</span><span class="sxs-lookup"><span data-stu-id="989f5-319">This is a backup restore point for hello VM.</span></span> <span data-ttu-id="989f5-320">Можно повторить процесс hello для периодического резервного копирования toocreate запланированные интервалы времени.</span><span class="sxs-lookup"><span data-stu-id="989f5-320">You can repeat hello process at scheduled intervals toocreate periodic backups.</span></span> <span data-ttu-id="989f5-321">Ниже приведены шаги hello слишком[копирования hello резервные копии tooanother области](#copy-the-snapshots-to-another-region) для аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="989f5-321">See below for hello steps too[copy hello backups tooanother region](#copy-the-snapshots-to-another-region) for DR.</span></span>

### <a name="creating-snapshots-while-hello-vm-is-offline"></a><span data-ttu-id="989f5-322">Создание моментальных снимков при hello виртуальная машина находится в автономном режиме</span><span class="sxs-lookup"><span data-stu-id="989f5-322">Creating snapshots while hello VM is offline</span></span>

<span data-ttu-id="989f5-323">Другой вариант toocreate согласованных копий завершает работу hello виртуальной Машины и создание больших двоичных объектов моментальные снимки для каждого диска.</span><span class="sxs-lookup"><span data-stu-id="989f5-323">Another option toocreate consistent backups is shutting down hello VM and taking blob snapshots of each disk.</span></span> <span data-ttu-id="989f5-324">Этот вариант проще, чем создание скоординированных моментальных снимков работающей виртуальной машины, но для его выполнения потребуется несколько минут простоя.</span><span class="sxs-lookup"><span data-stu-id="989f5-324">This is easier than coordinating snapshots of a running VM, but it requires a few minutes of downtime.</span></span> <span data-ttu-id="989f5-325">Для реализации этого варианта выполните следующие действия:</span><span class="sxs-lookup"><span data-stu-id="989f5-325">For this process, follow these steps:</span></span>

1. <span data-ttu-id="989f5-326">Завершите работу виртуальной Машины hello.</span><span class="sxs-lookup"><span data-stu-id="989f5-326">Shut down hello VM.</span></span>

2. <span data-ttu-id="989f5-327">Создайте моментальный снимок BLOB-объекта для каждого виртуального жесткого диска. Это займет всего несколько секунд.</span><span class="sxs-lookup"><span data-stu-id="989f5-327">Create a snapshot of each VHD blob, which only takes a few seconds.</span></span>

    <span data-ttu-id="989f5-328">toocreate моментального снимка, можно использовать [PowerShell](storage-powershell-guide-full.md#how-to-manage-azure-blob-snapshots), hello [API Rest хранилища Azure](https://msdn.microsoft.com/library/azure/ee691971.aspx), [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install), или один из клиентских библиотек хранилища hello Azure как [ Hello клиентская библиотека хранилища для .NET](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span><span class="sxs-lookup"><span data-stu-id="989f5-328">toocreate a snapshot, you can use [PowerShell](storage-powershell-guide-full.md#how-to-manage-azure-blob-snapshots), hello [Azure Storage Rest API](https://msdn.microsoft.com/library/azure/ee691971.aspx), [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install), or one of hello Azure Storage Client Libraries such as [hello Storage client library for .NET](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span></span>

3. <span data-ttu-id="989f5-329">Запустите виртуальную Машину, которая заканчивается простоя hello hello.</span><span class="sxs-lookup"><span data-stu-id="989f5-329">Start hello VM, which ends hello downtime.</span></span> <span data-ttu-id="989f5-330">Обычно в течение нескольких минут завершения всего процесса hello.</span><span class="sxs-lookup"><span data-stu-id="989f5-330">Typically hello entire process completes within a few minutes.</span></span>

<span data-ttu-id="989f5-331">Этот процесс создает коллекцию моментальных снимков для всех дисков hello, предоставляя точки резервного копирования и восстановления для hello виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="989f5-331">This process yields a collection of consistent snapshots for all hello disks, providing a backup restore point for hello VM.</span></span> <span data-ttu-id="989f5-332">Ниже приведена hello действия toocopy hello моментальные снимки tooanother регионе для аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="989f5-332">See below for hello steps toocopy hello snapshots tooanother region for DR.</span></span>

### <a name="copy-hello-snapshots-tooanother-region"></a><span data-ttu-id="989f5-333">Скопируйте hello моментальные снимки tooanother области</span><span class="sxs-lookup"><span data-stu-id="989f5-333">Copy hello snapshots tooanother region</span></span>

<span data-ttu-id="989f5-334">Создание моментальных снимков hello сама по себе может быть недостаточно для аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="989f5-334">Creation of hello snapshots alone may not be sufficient for DR.</span></span> <span data-ttu-id="989f5-335">Также необходимо реплицировать область tooanother резервные копии моментальных снимков hello.</span><span class="sxs-lookup"><span data-stu-id="989f5-335">You must also replicate hello snapshot backups tooanother region.</span></span>

<span data-ttu-id="989f5-336">При использовании GRS или RA-GRS для дисков, затем hello моментальные снимки доступны дополнительный регион реплицированных toohello автоматически.</span><span class="sxs-lookup"><span data-stu-id="989f5-336">If you are using GRS or RA-GRS for your disks, then hello snapshots are replicated toohello secondary region automatically.</span></span> <span data-ttu-id="989f5-337">Может существовать несколько минут задержки до репликации hello и если hello основного центра обработки данных выходит из строя до завершения hello моментальных снимков репликации, не будет моментальных снимков может tooaccess hello hello вторичный центр обработки данных.</span><span class="sxs-lookup"><span data-stu-id="989f5-337">There can be a few minutes of lag before hello replication, and if hello primary data center goes down before hello snapshots finish replicating, you will not be able tooaccess hello snapshots from hello secondary data center.</span></span> <span data-ttu-id="989f5-338">Hello вероятность того, что это очень мал.</span><span class="sxs-lookup"><span data-stu-id="989f5-338">hello likelihood of this is small.</span></span>

> [!Note] 
> <span data-ttu-id="989f5-339">Только наличие hello дисков в учетной записи GRS или RA-GRS не защищает hello виртуальной Машины после сбоев.</span><span class="sxs-lookup"><span data-stu-id="989f5-339">Only having hello disks in a GRS or RA-GRS account does not protect hello VM from disasters.</span></span> <span data-ttu-id="989f5-340">Также необходимо создать скоординированные моментальные снимки или использовать службу архивации Azure.</span><span class="sxs-lookup"><span data-stu-id="989f5-340">You must also create coordinated snapshots or use Azure Backup.</span></span> <span data-ttu-id="989f5-341">Это обязательный toorecover в согласованное состояние виртуальной Машины tooa.</span><span class="sxs-lookup"><span data-stu-id="989f5-341">This is required toorecover a VM tooa consistent state.</span></span>

<span data-ttu-id="989f5-342">При использовании LRS необходимо скопировать hello моментальные снимки tooa другую учетную запись хранения сразу после создания моментального снимка hello.</span><span class="sxs-lookup"><span data-stu-id="989f5-342">If you are using LRS, you must copy hello snapshots tooa different storage account immediately after creating hello snapshot.</span></span> <span data-ttu-id="989f5-343">Копирование конечного Hello может быть LRS учетной записи хранения в другом регионе, возникающие при копировании hello в удаленной области.</span><span class="sxs-lookup"><span data-stu-id="989f5-343">hello copy target could be an LRS storage account in a different region, resulting in hello copy being in a remote region.</span></span> <span data-ttu-id="989f5-344">Учетная запись хранения RA-GRS tooan hello моментальных снимков также можно скопировать в hello одного региона.</span><span class="sxs-lookup"><span data-stu-id="989f5-344">You can also copy hello snapshot tooan RA-GRS storage account in hello same region.</span></span> <span data-ttu-id="989f5-345">В этом случае hello моментального снимка будет неактивно реплицированных toohello удаленный дополнительный регион.</span><span class="sxs-lookup"><span data-stu-id="989f5-345">In this case, hello snapshot will be lazily replicated toohello remote secondary region.</span></span> <span data-ttu-id="989f5-346">Резервной копии защищен от аварий в первичном сайте hello после завершения копирования hello и репликации.</span><span class="sxs-lookup"><span data-stu-id="989f5-346">Your backup is protected from disasters at hello primary site once hello copying and replication is complete.</span></span>

<span data-ttu-id="989f5-347">toocopy вашей добавочных моментальных снимков для аварийного восстановления, эффективно, изучите инструкции hello в [резервное копирование Azure неуправляемые дисков виртуальной Машины с добавочных моментальных снимков](storage-incremental-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="989f5-347">toocopy your incremental snapshots for DR efficiently, review hello instructions in [Back up Azure unmanaged VM disks with incremental snapshots](storage-incremental-snapshots.md).</span></span>

![][2]

### <a name="recovery-from-snapshots"></a><span data-ttu-id="989f5-348">Восстановление из моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="989f5-348">Recovery from Snapshots</span></span>

<span data-ttu-id="989f5-349">tooretrieve моментального снимка, скопируйте его toomake новый большой двоичный объект.</span><span class="sxs-lookup"><span data-stu-id="989f5-349">tooretrieve a snapshot, copy it toomake a new blob.</span></span> <span data-ttu-id="989f5-350">При копировании из основной учетной записи hello hello моментального снимка можно скопировать hello моментальных снимков через toohello базового BLOB-объекта моментального снимка hello, таким образом отката hello диск toohello моментального снимка; Это известно как повышение уровня моментального снимка hello.</span><span class="sxs-lookup"><span data-stu-id="989f5-350">If you are copying hello snapshot from hello primary account, you can copy hello snapshot over toohello base blob of hello snapshot, thus reverting hello disk toohello snapshot; this is known as promoting hello snapshot.</span></span> <span data-ttu-id="989f5-351">Если вы копируете hello резервного копирования моментальных снимков из вторичную учетную запись (в случае hello RA-GRS), он должен быть скопирован tooa основной учетной записи.</span><span class="sxs-lookup"><span data-stu-id="989f5-351">If you are copying hello snapshot backup from a secondary account (in hello case of RA-GRS), it must be copied tooa primary account.</span></span> <span data-ttu-id="989f5-352">Можно скопировать моментальный снимок [с помощью PowerShell](storage-powershell-guide-full.md#how-to-copy-a-snapshot-of-a-blob) или с помощью служебной программы AzCopy hello.</span><span class="sxs-lookup"><span data-stu-id="989f5-352">You can copy a snapshot [using PowerShell](storage-powershell-guide-full.md#how-to-copy-a-snapshot-of-a-blob) or using hello AzCopy utility.</span></span> <span data-ttu-id="989f5-353">Дополнительные сведения см. в разделе [перенесите данные с помощью служебной программы командной строки AzCopy hello](storage-use-azcopy.md).</span><span class="sxs-lookup"><span data-stu-id="989f5-353">For more information, see [Transfer data with hello AzCopy Command-Line Utility](storage-use-azcopy.md).</span></span>

<span data-ttu-id="989f5-354">В случае hello виртуальных машин с несколькими дисками, необходимо скопировать все точки восстановления hello моментальных снимков, которые являются частью hello, координируемых с таким же.</span><span class="sxs-lookup"><span data-stu-id="989f5-354">In hello case of VMs with multiple disks, you must copy all hello snapshots that are part of hello same coordinated restore point.</span></span> <span data-ttu-id="989f5-355">После копирования больших двоичных объектов VHD toowritable hello моментальные снимки можно использовать toorecreate большие двоичные объекты hello ВМ с помощью шаблона hello для hello виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="989f5-355">Once you copy hello snapshots toowritable VHD blobs, you can use hello blobs toorecreate your VM using hello template for hello VM.</span></span>

## <a name="other-options"></a><span data-ttu-id="989f5-356">Другие варианты</span><span class="sxs-lookup"><span data-stu-id="989f5-356">Other options</span></span>

### <a name="sql-server"></a><span data-ttu-id="989f5-357">SQL Server</span><span class="sxs-lookup"><span data-stu-id="989f5-357">SQL Server</span></span>

<span data-ttu-id="989f5-358">SQL Server, запущенный на виртуальной машине имеет свой собственный toobackup Встроенные возможности вашего tooAzure базы данных SQL Server хранилища BLOB-объектов или в общей папке.</span><span class="sxs-lookup"><span data-stu-id="989f5-358">SQL Server running in a VM has its own built-in capabilities toobackup your SQL Server database tooAzure Blob storage or a file share.</span></span> <span data-ttu-id="989f5-359">Если учетная запись хранения hello GRS или RA-GRS, доступные через этих резервных копий в учетной записи хранилища hello вторичный центр обработки данных в событии hello авария, hello те же ограничения, как описано выше.</span><span class="sxs-lookup"><span data-stu-id="989f5-359">If hello storage account is GRS or RA-GRS, you can access those backups in hello storage account’s secondary data center in hello event of a disaster, with hello same restrictions as discussed previously.</span></span> <span data-ttu-id="989f5-360">Дополнительные сведения см. в статье [Резервное копирование и восстановление SQL Server в виртуальных машинах Azure](../virtual-machines/windows/sql/virtual-machines-windows-sql-backup-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="989f5-360">For more information, see [Backup and Restore for SQL Server in Azure Virtual Machines](../virtual-machines/windows/sql/virtual-machines-windows-sql-backup-recovery.md).</span></span> <span data-ttu-id="989f5-361">В дополнение toobackup и восстановления [SQL Server группы доступности AlwaysOn](../virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr.md) могут поддерживать вторичные реплики базы данных toogreatly сократить время восстановления после сбоев hello.</span><span class="sxs-lookup"><span data-stu-id="989f5-361">In addition toobackup and restore, [SQL Server Always On Availability Groups](../virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr.md) can maintain secondary replicas of databases toogreatly reduce hello disaster recovery time.</span></span>

## <a name="other-considerations"></a><span data-ttu-id="989f5-362">Дополнительные рекомендации</span><span class="sxs-lookup"><span data-stu-id="989f5-362">Other considerations</span></span>

<span data-ttu-id="989f5-363">В этой статье описывается, как toobackup или take моментальные снимки виртуальных машин и их восстановление после сбоя дисков toosupport и как toouse этих toorecover.</span><span class="sxs-lookup"><span data-stu-id="989f5-363">This article has discussed how toobackup or take snapshots of your VMs and their disks toosupport disaster recovery, and how toouse those toorecover.</span></span> <span data-ttu-id="989f5-364">С моделью hello диспетчера ресурсов Azure многие пользователи используют шаблоны toocreate их виртуальные машины и другие инфраструктуры в Azure.</span><span class="sxs-lookup"><span data-stu-id="989f5-364">With hello Azure Resource Manager model, many people use templates toocreate their VMs and other infrastructure in Azure.</span></span> <span data-ttu-id="989f5-365">Можно использовать toocreate шаблона виртуальной Машины с hello одной конфигурации каждый раз.</span><span class="sxs-lookup"><span data-stu-id="989f5-365">You can use a template toocreate a VM that has hello same configuration every time.</span></span> <span data-ttu-id="989f5-366">При использовании пользовательских образов для создания виртуальных машин, кроме того, необходимо убедиться, что образы защищены с помощью учетных записей RA-GRS toostore их.</span><span class="sxs-lookup"><span data-stu-id="989f5-366">If you use custom images for creating your VMs, you must also make sure your images are protected by using an RA-GRS account toostore them.</span></span>

<span data-ttu-id="989f5-367">Следовательно, процесс архивации представляет собой сочетание двух вещей:</span><span class="sxs-lookup"><span data-stu-id="989f5-367">Consequently, your backup process may be a combination of two things:</span></span>

1. <span data-ttu-id="989f5-368">Hello резервного копирования данных (дисков)</span><span class="sxs-lookup"><span data-stu-id="989f5-368">Backup hello data (disks)</span></span>
2. <span data-ttu-id="989f5-369">Конфигурация резервного копирования hello (шаблоны, пользовательских образов)</span><span class="sxs-lookup"><span data-stu-id="989f5-369">Backup hello configuration (templates, custom images)</span></span>

<span data-ttu-id="989f5-370">В зависимости от hello резервного копирования выбранного параметра можно использовать toohandle hello резервной копии данных hello и конфигурации hello или hello службы резервного копирования могут обрабатывать все это для вас.</span><span class="sxs-lookup"><span data-stu-id="989f5-370">Depending on hello backup option you choose, you may have toohandle hello backup of both hello data and hello configuration, or hello backup service may handle all of that for you.</span></span>

## <a name="appendix---understanding-hello-impact-of-lrs-grs-and-ra-grs"></a><span data-ttu-id="989f5-371">Приложение - понимание влияния hello LRS, GRS и RA-GRS</span><span class="sxs-lookup"><span data-stu-id="989f5-371">Appendix - Understanding hello impact of LRS, GRS, and RA-GRS</span></span>

<span data-ttu-id="989f5-372">Для учетных записей хранения Azure существует три типа обеспечения избыточности данных, которые следует использовать при планировании аварийного восстановления: локально избыточное хранилище (LRS), геоизбыточное хранилище (GRS) и геоизбыточное хранилище с доступом на чтение (RA-GRS).</span><span class="sxs-lookup"><span data-stu-id="989f5-372">For storage accounts in Azure, there are three types of data redundancy that you should consider regarding disaster recovery – locally redundant (LRS), geo-redundant (GRS), or geo-redundant with read access (RA-GRS).</span></span> 

<span data-ttu-id="989f5-373">Локально избыточное хранилище (LRS) сохраняет три копии данных hello в hello одного центра обработки данных.</span><span class="sxs-lookup"><span data-stu-id="989f5-373">Locally Redundant Storage (LRS) retains three copies of hello data in hello same data center.</span></span> <span data-ttu-id="989f5-374">При записи данных hello, все три копии обновляются до успехе toohello вызывающего объекта, поэтому известно, что они совпадают.</span><span class="sxs-lookup"><span data-stu-id="989f5-374">When writing hello data, all three copies are updated before success is returned toohello caller, so you know they are identical.</span></span> <span data-ttu-id="989f5-375">На диске защищен после локальных сбоев, так как она является крайне маловероятно, что все три копии повлияет на hello то же время.</span><span class="sxs-lookup"><span data-stu-id="989f5-375">Your disk is protected from local failures, since it is extremely unlikely that all three copies would be impacted at hello same time.</span></span> <span data-ttu-id="989f5-376">В случае hello LRS нет не географической избыточности, поэтому hello дисков не защищены от катастрофических сбоев, которые могут повлиять на единице center или хранилища данных.</span><span class="sxs-lookup"><span data-stu-id="989f5-376">In hello case of LRS, there is no geo-redundancy, so hello disk is not protected from catastrophic failures that can impact an entire data center or storage unit.</span></span>

<span data-ttu-id="989f5-377">GRS и RA-GRS три копии данных хранятся в основной регион hello (выбрана), и три дополнительные копии данных сохраняются в соответствующих дополнительном регионе (назначение Azure).</span><span class="sxs-lookup"><span data-stu-id="989f5-377">With GRS and RA-GRS, three copies of your data are retained in hello primary region (selected by you), and three more copies of your data are retained in a corresponding secondary region (set by Azure).</span></span> <span data-ttu-id="989f5-378">Например если данные хранятся на Западе США, hello данные будут реплицированных tooEast США.</span><span class="sxs-lookup"><span data-stu-id="989f5-378">For example, if you store data in West US, hello data will be replicated tooEast US.</span></span> <span data-ttu-id="989f5-379">Это происходит в асинхронном режиме, и между toohello обновлений первичного и вторичного небольшая задержка.</span><span class="sxs-lookup"><span data-stu-id="989f5-379">This is done asynchronously, and there is a small delay between updates toohello primary and secondary.</span></span> <span data-ttu-id="989f5-380">Реплики hello дисков на вторичном сайте hello соответствуют отдельно для каждого диска (hello задержка), но реплик нескольких дисков active может быть нарушена синхронизация **друг с другом**.</span><span class="sxs-lookup"><span data-stu-id="989f5-380">Replicas of hello disks on hello secondary site are consistent on a per-disk basis (with hello delay), but replicas of multiple active disks may not be in sync **with each other**.</span></span> <span data-ttu-id="989f5-381">необходимы toohave согласованных реплик на нескольких дисках, моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="989f5-381">toohave consistent replicas across multiple disks, consistent snapshots are needed.</span></span>

<span data-ttu-id="989f5-382">Hello основное различие между GRS и RA-GRS —, с RA-GRS, вы можете узнать дополнительная копия hello в любое время.</span><span class="sxs-lookup"><span data-stu-id="989f5-382">hello main difference between GRS and RA-GRS is that with RA-GRS, you can read hello secondary copy at any time.</span></span> <span data-ttu-id="989f5-383">Если имеется проблема, которая отображает данные hello в основном регионе hello недоступен, hello команды Azure сделает каждой доступ toorestore усилий.</span><span class="sxs-lookup"><span data-stu-id="989f5-383">If there is a problem that renders hello data in hello primary region inaccessible, hello Azure team will make every effort toorestore access.</span></span> <span data-ttu-id="989f5-384">Хотя первичный hello не работает, если включена функция RA-GRS, данные hello в hello вторичный центр обработки данных доступны.</span><span class="sxs-lookup"><span data-stu-id="989f5-384">While hello primary is down, if you have RA-GRS enabled, you can access hello data in hello secondary data center.</span></span> <span data-ttu-id="989f5-385">Таким образом Если планируется tooread из hello реплики при отсутствии доступа основной hello, затем RA-GRS следует рассматривать.</span><span class="sxs-lookup"><span data-stu-id="989f5-385">Therefore, if you plan tooread from hello replica while hello primary is inaccessible, then RA-GRS should be considered.</span></span>

<span data-ttu-id="989f5-386">Если оказалось toobe значительные сбоя, hello команды Azure может активировать географическая отработка отказа и hello основного DNS записи toopoint toosecondary хранилища.</span><span class="sxs-lookup"><span data-stu-id="989f5-386">If it turns out toobe a significant outage, hello Azure team may trigger a geo-failover and change hello primary DNS entries toopoint toosecondary storage.</span></span> <span data-ttu-id="989f5-387">На этом этапе при наличии либо GRS или RA-GRS включено, можно доступ к данным hello hello область, которая используется toobe hello получателей.</span><span class="sxs-lookup"><span data-stu-id="989f5-387">At this point, if you have either GRS or RA-GRS enabled, you can access hello data in hello region that used toobe hello secondary.</span></span> <span data-ttu-id="989f5-388">Другими словами Если в вашей учетной записи хранилища GRS и возникает проблема, можно открыть hello вторичного хранилища только в том случае, если географическая отработка отказа.</span><span class="sxs-lookup"><span data-stu-id="989f5-388">In other words, if your storage account is GRS and there is a problem, you can access hello secondary storage only if there is a geo-failover.</span></span>

<span data-ttu-id="989f5-389">Дополнительные сведения см. в разделе [какие toodo в случае сбоя хранилища Azure](storage-disaster-recovery-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="989f5-389">For more information, see [What toodo if an Azure Storage outage occurs](storage-disaster-recovery-guidance.md).</span></span> 

<span data-ttu-id="989f5-390">Обратите внимание, что отработкой отказа управляет корпорация Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="989f5-390">Note that Microsoft controls whether a failover occurs.</span></span> <span data-ttu-id="989f5-391">Отработка отказа не контролируется на уровне отдельных учетных записей, поэтому она не может быть запущена по запросу отдельных клиентов.</span><span class="sxs-lookup"><span data-stu-id="989f5-391">Failover is not controlled per storage account, therefore it is not decided by individual customers.</span></span> <span data-ttu-id="989f5-392">tooimplement аварийного восстановления для конкретное хранилище учетных записей или диски виртуальной машины, необходимо использовать hello методик, описанных ранее в этой статье.</span><span class="sxs-lookup"><span data-stu-id="989f5-392">tooimplement Disaster Recovery for specific storage accounts or virtual machine disks, you must use hello techniques described previously in this article.</span></span>



[1]: ./media/storage-backup-and-disaster-recovery-for-azure-iaas-disks/backup-and-disaster-recovery-for-azure-iaas-disks-1.png
[2]: ./media/storage-backup-and-disaster-recovery-for-azure-iaas-disks/backup-and-disaster-recovery-for-azure-iaas-disks-2.png