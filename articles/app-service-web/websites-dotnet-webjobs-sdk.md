---
title: "Информация о пакете SDK веб-заданий"
description: "Общие сведения о пакете SDK веб-заданий. В данном материале объясняется, что из себя представляет пакет инструментов SDK и в каких ситуациях он может оказаться полезным, а также приводятся примеры программного кода."
services: app-service\web, storage
documentationcenter: .net
author: ggailey777
manager: erikre
editor: jimbe
ms.assetid: 8281267b-572b-4b14-a328-6704493ea682
ms.service: app-service-web
ms.workload: web
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/01/2016
ms.author: glenga
ms.openlocfilehash: 8eb05b7cbfb4505f2e94c5b8e6d367ec63a2f033
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="what-is-the-azure-webjobs-sdk"></a>Информация о пакете SDK веб-заданий
## <a id="overview"></a>Обзор
В настоящей статье объясняется, что из себя представляет пакет инструментов SDK веб-заданий, выполняется разбор нескольких наиболее характерных ситуаций, в которых он может применяться, а также приводится краткий обзор его возможного использования при разработке собственного программного кода.

[!INCLUDE [app-service-web-webjobs-corenote](../../includes/app-service-web-webjobs-corenote.md)]

[Веб-задания](websites-webjobs-resources.md) — это функция службы приложений Azure, которая позволяет запускать программу или сценарий в том же контексте, что и веб-приложение, приложение API или мобильное приложение. Назначение [пакета SDK для веб-заданий](websites-webjobs-resources.md) — это упрощение кода, с помощью которого веб-задание выполняет такие распространенные задачи, как обработка изображений, обработка очереди, объединение RSS-каналов, обслуживание файлов и отправка сообщений электронной почты. Пакет SDK для веб-заданий имеет встроенные функции для работы с хранилищем Azure и служебной шиной для планирования задач и обработки ошибок, а также других распространенных сценариев. Кроме того, этот пакет расширяемый. [Пакет SDK для веб-заданий является проектом с открытым кодом](https://github.com/Azure/azure-webjobs-sdk/), а также существует [репозиторий открытого кода для расширений](https://github.com/Azure/azure-webjobs-sdk-extensions/wiki/Binding-Extensions-Overview).

Пакет SDK веб-заданий содержит следующие компоненты.

* **Пакеты NuGet**. Пакеты NuGet, которые добавляются в проект консольного приложения Visual Studio, предоставляют платформу, которую код использует для обрамления методов атрибутами пакета SDK веб-заданий.
* **Панель мониторинга**. Часть пакета SDK веб-заданий включена в службу приложений Azure и предоставляет обширные возможности мониторинга и диагностики для программ, которые создаются с помощью пакетов NuGet. Чтобы использовать эти функции мониторинга и диагностики, не нужно писать код.

## <a id="scenarios"></a>Сценарии
Ниже представлены стандартные сценарии, которые можно проще обработать с помощью пакета SDK веб-заданий Azure:

* Обработка изображений или другая нагружающая ЦП задача. Стандартной функцией веб-сайтов является возможность отправлять изображения или видео. Часто требуется изменить контент после его отправки, но вы не хотите, чтобы пользователь при этом ждал.
* Обработка очередей. Обычно для взаимодействия внешнего сервера с внутренним используются очереди. Когда веб-сайту требуется выполнить задание, он отправляет сообщение в очередь. Служба внутреннего сервера извлекает сообщения из очереди и выполняет задание. Очереди можно использовать для обработки изображений: например, после того, как пользователь загрузит несколько файлов, их имена можно поместить в сообщение очереди, чтобы внутренний сервер мог выбрать их для обработки. Также можно использовать очереди для ускорения отклика сайта. Например, вместо записи непосредственно в базу данных SQL выполните запись в очередь, сообщите пользователю о готовности и позвольте службе внутреннего сервера обработать задание реляционной базы данных с высокой задержкой. Пример обработки очереди с процессом, работающим с изображениями, приводится в [учебнике "Начало работы с пакетом SDK веб-заданий"](websites-dotnet-webjobs-sdk-get-started.md).
* Объединение RSS-каналов. Если ваш сайт обрабатывает список RSS-каналов, можно получить все статьи из веб-каналов в фоновом процессе.
* Обработка файлов, например, объединение или очистка файлов журнала.  Файлы журнала могут быть созданы несколькими сайтами или в течение отдельных интервалов времени, которые следует совместить для запуска в них заданий анализа. Также можно запланировать еженедельную задачу для очистки старых файлов журнала.
* Ввод данных в таблицы Azure. В системе могут находится некоторые файлы и BLOB-объекты, и может возникнуть необходимость их обработать и сохранить данные в таблицах. Функции ввода данных могут выполнять запись огромного количества строк (в некоторых случаях этот показатель может исчисляться миллионами), и пакет SDK для веб-заданий позволяет очень просто реализовать подобные функциональные возможности. Помимо этого, пакет SDK предоставляет индикаторы для отслеживания в реальном времени показателей, характеризующих ход выполнения каких-либо операций, среди которых, например, показатель количества строк, записанных в таблицу.
* Другие долгосрочные задачи, которые необходимо запустить в фоновом потоке, например [отправка электронной почты](https://github.com/victorhurdugaci/AzureWebJobsSamples/tree/master/SendEmailOnFailure). 
* Все задачи, которые будут выполняться по расписанию, например резервное копирование, которое выполняется каждую ночь.

Во многих из этих сценариев можно масштабировать веб-приложение для запуска на нескольких виртуальных машинах, которые будут выполнять несколько веб-заданий одновременно. В некоторых случаях это может привести к многократной обработке одних и тех же данных. Однако этой проблемы можно избежать при использовании встроенной очереди, BLOB-объектов и триггеров служебной шины пакета SDK веб-заданий. Пакет SDK гарантирует, что функции для каждого сообщения или BLOB-объекта будут обрабатываться только один раз.

Пакет SDK веб-заданий также упрощает работу с распространенными сценариями по обработке ошибок. Можно настроить оповещения для отправки уведомлений при сбое функции и установить время ожидания, чтобы функция автоматически отменялась, если она не была завершена в течение заданного времени.

## <a id="code"></a> Примеры кода
Код для обработки стандартных задач, которые работают с хранилищем Azure, прост. В методе `Main` консольного приложения создается объект `JobHost`, который координирует вызовы методов, которые вы напишете. На основе атрибутов пакета SDK веб-заданий, которые вы используете, платформа SDK веб-заданий узнает, когда следует вызывать ваши методы и какие значения параметров использовать. Пакет SDK предоставляет *триггеры*, которые определяют условия вызова функции, и *привязки*, которые определяют передачу информации в параметры метода и обратно.

Например, атрибут [QueueTrigger](websites-dotnet-webjobs-sdk-storage-queues-how-to.md) приводит к тому, что функция будет вызываться при поступлении сообщения в очередь, и если сообщение имеет формат JSON для массива байтов или пользовательского типа, сообщение автоматически десериализуется. Атрибут [BlobTrigger](websites-dotnet-webjobs-sdk-storage-blobs-how-to.md) вызывает запуск процесса при каждом создании нового большого двоичного объекта в учетной записи хранения Azure.

Здесь приводится пример программы, которая опрашивает очередь и для каждого полученного от очереди сообщения создает BLOB-объект.

        public static void Main()
        {
            JobHost host = new JobHost();
            host.RunAndBlock();
        }

        public static void ProcessQueueMessage([QueueTrigger("webjobsqueue")] string inputText, 
            [Blob("containername/blobname")]TextWriter writer)
        {
            writer.WriteLine(inputText);
        }

Объект `JobHost` является контейнером для набора фоновых функций. Объект `JobHost` выполняет мониторинг функций, просматривает события, которые активируют их, и выполняет функции при возникновении событий-триггеров. Метод `JobHost` вызывается, чтобы указать, где следует запускать обработку контейнера: в текущем потоке или в фоновом потоке. В этом примере метод `RunAndBlock` запускает постоянную обработку в текущем потоке.

Так как у метода `ProcessQueueMessage` в этом примере есть атрибут `QueueTrigger`, триггер для этой функции — получение нового сообщения очереди. Объект `JobHost` ищет новые сообщения очереди в указанной очереди (webjobsqueue в этом примере) и при нахождении вызывает `ProcessQueueMessage`. 

Атрибут `QueueTrigger` связывает параметр `inputText` со значением сообщения очереди. Атрибут `Blob` также привязывает объект `TextWriter` к BLOB-объекту с именем blobname в контейнере с именем containername.  

        public static void ProcessQueueMessage([QueueTrigger("webjobsqueue")]] string inputText, 
            [Blob("containername/blobname")]TextWriter writer)

Затем функция использует эти параметры для записи значения сообщения очереди в большой двоичный объект:

        writer.WriteLine(inputText);

Функции триггера и модуля привязки пакета SDK веб-заданий значительно упрощают написание программного кода. Код низкого уровня, необходимый для обработки очередей, больших двоичных объектов или файлов или для запуска запланированных задач, выполняется для вас платформой SDK веб-заданий. Например, платформа создает очереди, которые еще не существуют, открывает очередь, читает сообщения очереди, удаляет сообщения очереди по завершении обработки, создает контейнеры больших двоичных объектов, которые еще не существуют, выполняет запись в большие двоичные объекты и т. д.

В следующем примере кода показаны разнообразные триггеры в одном веб-задании: `QueueTrigger`, `FileTrigger`, `WebHookTrigger` и `ErrorTrigger`. 

```
    public class Functions
    {
        public static void ProcessQueueMessage([QueueTrigger("queue")] string message,
        TextWriter log)
        {
            log.WriteLine(message);
        }

        public static void ProcessFileAndUploadToBlob(
            [FileTrigger(@"import\{name}", "*.*", autoDelete: true)] Stream file,
            [Blob(@"processed/{name}", FileAccess.Write)] Stream output,
            string name,
            TextWriter log)
        {
            output = file;
            file.Close();
            log.WriteLine(string.Format("Processed input file '{0}'!", name));
        }

        [Singleton]
        public static void ProcessWebHookA([WebHookTrigger] string body, TextWriter log)
        {
            log.WriteLine(string.Format("WebHookA invoked! Body: {0}", body));
        }

        public static void ProcessGitHubWebHook([WebHookTrigger] string body, TextWriter log)
        {
            dynamic issueEvent = JObject.Parse(body);
            log.WriteLine(string.Format("GitHub WebHook invoked! ('{0}', '{1}')",
                issueEvent.issue.title, issueEvent.action));
        }

        public static void ErrorMonitor(
        [ErrorTrigger("00:01:00", 1)] TraceFilter filter, TextWriter log,
        [SendGrid(
            To = "admin@emailaddress.com",
            Subject = "Error!")]
         SendGridMessage message)
        {
            // log last 5 detailed errors to the Dashboard
            log.WriteLine(filter.GetDetailedMessage(5));
            message.Text = filter.GetDetailedMessage(1);
        }
    }
```

## <a id="schedule"></a> Планирование
Атрибут `TimerTrigger` дает возможность настраивать вызов функций по расписанию. Можно запланировать веб-задания в целом с помощью Azure или запланировать вызов отдельных функций веб-задания с помощью пакета SDK веб-заданий `TimerTrigger`. Ниже приведен пример кода.

```
public class Functions
{
    public static void ProcessTimer([TimerTrigger("*/15 * * * * *", RunOnStartup = true)]
    TimerInfo info, [Queue("queue")] out string message)
    {
        message = info.FormatNextOccurrences(1);
    }
}
```

Дополнительные примеры кода приведены в файле [TimerSamples.cs](https://github.com/Azure/azure-webjobs-sdk-extensions/blob/master/src/ExtensionsSample/Samples/TimerSamples.cs) в репозитории azure-webjobs-sdk-extensions на GitHub.com.

## <a name="extensibility"></a>Расширяемость
Вы не ограничены встроенными функциями — пакет SDK веб-заданий позволяет писать пользовательские триггеры и привязки.  Например, можно написать триггеры событий кэша и периодического расписания. [Репозиторий открытого кода](https://github.com/Azure/azure-webjobs-sdk-extensions) содержит [подробное руководство по расширяемости пакета SDK для веб-заданий](https://github.com/Azure/azure-webjobs-sdk-extensions/wiki/Binding-Extensions-Overview) и пример кода, которые помогут приступить к написанию собственных триггеров и привязок.

## <a id="workerrole"></a>Использование пакета SDK для веб-заданий вне сферы применения веб-заданий
Программа, которая использует пакет SDK для заданий WebJob представляет собой стандартное консольное приложение и может запускаться из любого места; ее необязательно запускать как задание WebJob. Протестировать такую программу можно локально на компьютере разработчика, а в производственной среде ее можно запустить в рабочей роли облачной службы или службе Windows, в соответствии с предпочтениями в отношении какой-либо из этих сред. 

Панель мониторинга доступна только как расширение сайта для веб-приложения службы приложений Azure. Если необходимо запустить программу вне веб-заданий и при этом использовать панель мониторинга, можно настроить веб-приложение Azure на использование той же самой учетной записи хранения, которая указана в строке подключения панели мониторинга из пакета SDK веб-заданий. В таком случае в панели мониторинга веб-заданий этого веб-приложения будет отображаться информация о выполнении функций программы, которая работает в иной среде. Перейти к панели мониторинга можно по следующему URL-адресу: https://*{имя_веб-приложения}*.scm.azurewebsites.net/azurejobs/#/functions. Дополнительные сведения доступны в записи блога [Getting a dashboard for local development with the WebJobs SDK](http://blogs.msdn.com/b/jmstall/archive/2014/01/27/getting-a-dashboard-for-local-development-with-the-webjobs-sdk.aspx) (Получение панели мониторинга для локальной разработки с помощью пакета SDK веб-заданий), однако следует обратить внимание, что в ней приводится имя старой строки подключения. 

## <a id="nostorage"></a>Функции панели мониторинга
Пакет SDK для веб-заданий обеспечивает ряд преимуществ, даже если вы не пользуетесь триггерами и привязками:

* Можно вызывать необходимые функции из панели мониторинга.
* Можно осуществлять повторное выполнение функций из панели мониторинга.
* Вы можете просматривать журналы на панели мониторинга, связанные с конкретным веб-заданием (журналы приложения, записанные с помощью Console.Out, Console.Error, Trace и т. п.) или с вызовом определенной функции, которая создает их (журналы, записанные с помощью объекта `TextWriter`, который пакет SDK передает функции в качестве параметра). 

Дополнительную информацию см. в разделах: [Как вызывать функцию в ручном режиме](websites-dotnet-webjobs-sdk-storage-queues-how-to.md#manual) и [Как записывать журналы](websites-dotnet-webjobs-sdk-storage-queues-how-to.md#logs). 

## <a id="nextsteps"></a>Дальнейшие действия
Дополнительные сведения о пакете SDK веб-заданий приводятся в разделе [Веб-задания Azure — рекомендуемые ресурсы](http://go.microsoft.com/fwlink/?linkid=390226).

Сведения о последних улучшениях в пакете SDK для веб-заданий см. в разделе [Заметки о выпуске](https://github.com/Azure/azure-webjobs-sdk/wiki/Release-Notes).

