---
title: "Выполнение фоновых задач с веб-заданиями"
description: "Узнайте, как выполнять фоновые задачи в веб-приложениях Azure."
services: app-service
documentationcenter: 
author: ggailey777
manager: erikre
editor: jimbe
ms.assetid: af01771e-54eb-4aea-af5f-f883ff39572b
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 11/27/2016
ms.author: glenga
ms.openlocfilehash: 3f8ae748e3d9c6b4e342536926a52b4e8f37ee51
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="run-background-tasks-with-webjobs"></a>Выполнение фоновых задач с веб-заданиями
## <a name="overview"></a>Обзор
Программы или сценарии можно выполнять в веб-заданиях в веб-приложении [службы приложений Azure](http://go.microsoft.com/fwlink/?LinkId=529714) тремя способами: по запросу, непрерывно или по расписанию. Для использования веб-заданий дополнительные затраты не требуются.

[!INCLUDE [app-service-web-webjobs-corenote](../../includes/app-service-web-webjobs-corenote.md)]

В данной статье показано, как развернуть веб-задания с помощью [портала Azure](https://portal.azure.com). Информацию о развертывании с помощью Visual Studio или процесса непрерывной доставки см. в разделе [Развертывание веб-заданий с помощью Visual Studio](websites-dotnet-deploy-webjobs.md).

Пакет SDK веб-заданий Azure упрощает многие задачи программирования для веб-заданий. Дополнительные сведения см. в разделе [Информация о пакете SDK веб-заданий](websites-dotnet-webjobs-sdk.md).

 Функции Azure предоставляют еще один способ запуска программ и сценариев из безсерверной среды или приложения службы приложений. Дополнительные сведения см. в статье [Обзор функций Azure](../azure-functions/functions-overview.md).

[!INCLUDE [app-service-web-to-api-and-mobile](../../includes/app-service-web-to-api-and-mobile.md)]

## <a name="acceptablefiles"></a>Допустимые типы файлов для скриптов и программ
Допустимы следующие типы файлов:

* .cmd, .bat, .exe (с использованием командной строки windows)
* .ps1 (с использованием powershell)
* .sh (с использованием bash)
* .PHP (с использованием php)
* .py (с использованием python)
* .js (с использованием node)
* .jar (с использованием java)

## <a name="CreateOnDemand"></a>Создание веб-задания по запросу на портале
1. В колонке **Веб-приложение** на [портале Azure](https://portal.azure.com) щелкните **Все параметры > Веб-задания** для отображения колонки **Веб-задания**.
   
    ![Колонка "Веб-задания"](./media/web-sites-create-web-jobs/wjblade.png)
2. Щелкните **Добавить**. Появится диалоговое окно **Добавление веб-задания** .
   
    ![Колонка "Добавление веб-задания"](./media/web-sites-create-web-jobs/addwjblade.png)
3. В поле **Имя**укажите имя веб-задания. Имя должно начинаться с буквы или цифры и не может содержать специальные символы, отличные от "-" и "_".
4. В поле **Как выполнить** выберите пункт **Выполнять по требованию**.
5. В поле **Отправка файла** щелкните значок папки и перейдите к ZIP-файлу, который содержит скрипт. ZIP-файл должен содержать исполняемый файл (.exe .cmd .bat .sh .php .py .js), а также все вспомогательные файлы, необходимые для запуска программы или скрипта.
6. Поставьте флажок **Создать** , чтобы передать скрипт в веб-приложение. 
   
    Имя, которое вы присвоили веб-заданию, появится в списке, приведенном в колонке **Веб-задания** .
7. Чтобы запустить веб-задание, щелкните правой кнопкой мыши его имя в списке и нажмите **Запустить**.
   
    ![Запуск веб-задания](./media/web-sites-create-web-jobs/runondemand.png)

## <a name="CreateContinuous"></a>Создание непрерывно выполняющегося веб-задания
1. Чтобы создать непрерывно выполняющееся веб-задание, следуйте инструкциям по созданию задания, которое запускается один раз, только в поле **Как выполнить** выберите значение **Непрерывно**.
2. Чтобы запустить или остановить непрерывное веб-задание, щелкните правой кнопкой мыши веб-задание в списке и выберите **Запустить** или **Остановить**.

> [!NOTE]
> Если веб-приложение работает на нескольких экземплярах, непрерывно выполняемое веб-задание будет работать на всех экземплярах. Веб-задания по требованию и запланированные задачи запускаются на отдельном экземпляре, выбранном Microsoft Azure для балансировки нагрузки.
> 
> Для надежной работы непрерывных веб-заданий на всех экземплярах включите параметр конфигурации "Всегда включено*" для веб-приложения, иначе они могут прекращать работу при слишком долгом простое сайта-хоста SCM.
> 
> 

## <a name="CreateScheduledCRON"></a>Создание запланированного веб-задания с использованием выражения CRON
Этот метод можно использовать для веб-приложений, работающих в режимах "Базовый", "Стандартный" или "Премиум". В этом случае в приложении необходимо включить параметр **Всегда включено**.

Чтобы превратить веб-задание по запросу в запланированное веб-задание, просто добавьте файл `settings.job` в корень ZIP-файла веб-задания. JSON-файл должен содержать свойство `schedule` с [выражением CRON](https://en.wikipedia.org/wiki/Cron), как в примере ниже.

Выражение CRON состоит из 6 полей: `{second} {minute} {hour} {day} {month} {day of the week}`.

Например, чтобы веб-задание активировалось каждые 15 минут, `settings.job` должно выглядеть следующим образом:

```json
{
    "schedule": "0 */15 * * * *"
}
``` 

Другие примеры расписания для выражения CRON:

* Каждый час (т. е. когда количество минут — 0): `0 0 * * * *` 
* Каждый час с 9:00 до 17:00: `0 0 9-17 * * *` 
* Каждый день в 9:30: `0 30 9 * * *`
* Каждый рабочий день в 9:30: `0 30 9 * * 1-5`

**Примечание**. При развертывании веб-задания из Visual Studio для свойств файла `settings.job` установите значение "Копировать, если новее".

## <a name="CreateScheduled"></a>Создание запланированного веб-задания с использованием планировщика Azure
В следующем альтернативном методе используется планировщик Azure. В этом случае у веб-задания нет достоверных данных о расписании. Вместо этого планировщик Azure активирует веб-задания по расписанию. 

На классическом портале Azure еще нет возможности создавать запланированные веб-задания, но, пока эта функция не добавлена, вы можете использовать для создания запланированного веб-задания [классический портал](http://manage.windowsazure.com).

1. На [классическом портале](http://manage.windowsazure.com) перейдите на страницу веб-задания и нажмите кнопку **Добавить**.
2. В поле **Как выполнить** выберите **Выполнять по расписанию**.
   
    ![Новое запланированное задание][NewScheduledJob]
3. Выберите **Регион планировщика** для задания и нажмите кнопку со стрелкой в правом нижнем углу диалогового окна, чтобы перейти к следующему экрану.
4. В диалоговом окне **Создать задание** выберите нужный тип в разделе **Повторение**: **Разовое задание** или **Повторяющееся задание**.
   
    ![Запланированное повторение][SchdRecurrence]
5. Кроме того, выберите время запуска в разделе **Запуск**: **Сейчас** или **В определенное время**.
   
    ![Время начала по расписанию][SchdStart]
6. Если необходимо начать в определенное время, выберите значения времени запуска в поле **Начало в**.
   
    ![Расписание запуска в определенное время][SchdStartOn]
7. Если выбрано повторяющееся задание, с помощью параметра **Повторять каждые** можно указать частоту повторения, а с помощью параметра **Заканчивается** – время завершения.
   
    ![Запланированное повторение][SchdRecurEvery]
8. При выборе значения **Недели** можно выбрать поле **В определенном расписании** и указать дни недели, в которые должно запускаться это задание.
   
    ![Запланированные дни недели][SchdWeeksOnParticular]
9. При выборе значения **Месяцы** и выбора поля **В определенном расписании** можно определить запуск задания в определенные, пронумерованные **дни** месяца. 
   
    ![Планирование определенных дат месяца][SchdMonthsOnPartDays]
10. При выборе значения **Дни недели**можно выбрать, в какой день или в какие дни недели месяца необходимо запускать задание.
    
     ![Планирование определенных дней недели в месяце][SchdMonthsOnPartWeekDays]
11. Наконец, можно также использовать параметр **Вхождения** для выбора недели месяца (первая, вторая, третья и т. д.), во время которой задание должно выполняться в указанные дни недели.
    
    ![Планирование определенных дней недели в определенные недели месяца][SchdMonthsOnPartWeekDaysOccurences]
12. Имена созданных заданий будут отображаться на вкладке "Веб-задания" вместе с данными об их состоянии, типе расписания и прочей информацией. Сохраняются журнальные данные для последних 30 выполненных веб-заданий.
    
    ![Список заданий][WebJobsListWithSeveralJobs]

### <a name="Scheduler"></a>Запланированные задания и планировщик Azure
На страницах планировщика Azure на [классическом портале](http://manage.windowsazure.com)можно выполнить дополнительную настройку запланированных заданий.

1. Чтобы перейти на страницу портала планировщика Azure, щелкните **расписание** задания на странице "Веб-задания". 
   
   ![Ссылка на планировщик Azure][LinkToScheduler]
2. Выберите задание на странице планировщика.
   
    ![Задание на странице портала планировщика][SchedulerPortal]
3. Откроется страница **Действие задания** , на которой можно выполнить дополнительную настройку задания. 
   
    ![Страница "Действие задания" в планировщике][JobActionPageInScheduler]

## <a name="ViewJobHistory"></a>Просмотр журнала заданий
1. Чтобы просмотреть журнал выполнения задания, включая задания, созданные с помощью пакета SDK для веб-заданий, щелкните соответствующую ссылку в столбце **Журналы** колонки "Веб-задания". Можно также использовать значок буфера обмена для копирования URL-адреса страницы файла журнала в буфер обмена.
   
    ![Ссылка на журналы](./media/web-sites-create-web-jobs/wjbladelogslink.png)
2. При щелчке ссылки открывается страница информации о веб-задании. На этой странице отображаются имя выполненной команды, время ее последнего выполнения, а также сведения об успешности выполнения. Укажите время в разделе **Недавно выполненные задания**, чтобы просмотреть дополнительные сведения.
   
    ![Сведения о веб-задании][WebJobDetails]
3. Откроется страница **Сведения о выполнении WebJob** . Щелкните **Переключить вывод** , чтобы просмотреть текст журнала. Журнал выводится в текстовом формате. 
   
    ![Сведения о выполнении веб-задания][WebJobRunDetails]
4. Чтобы просмотреть текст вывода в отдельном окне браузера, щелкните ссылку **скачать** . Чтобы загрузить текст, щелкните ссылку правой кнопкой мыши и выберите команду для сохранения содержимого файла в контекстном меню браузера.
   
    ![Загрузка выходных данных журнала][DownloadLogOutput]
5. Чтобы получить список веб-заданий на панели мониторинга журнала, вы можете воспользоваться ссылкой **Веб-задания** вверху страницы.
   
    ![Ссылка на список веб-заданий][WebJobsLinkToDashboardList]
   
    ![Список веб-заданий на панели мониторинга журнала][WebJobsListInJobsDashboard]
   
    При щелчке одной из этих ссылок открывается страница "Сведения о веб-задании" для выбранного задания.

## <a name="WHPNotes"></a>Примечания
* В бесплатном режиме веб-приложений время ожидания может истекать, если в Azure не открыт портал веб-приложения и запросы к сайту SCM (развертывание) не поступают в течение 20 минут. При этом такое поведение наблюдается даже при наличии запросов к фактическому сайту.
* Код непрерывно выполняющегося задания должен выполняться в бесконечном цикле.
* Задания выполняются непрерывно только во время работы веб-приложения.
* В базовом и стандартном режимах реализована функция "Всегда включено", которая позволяет предотвратить переход веб-приложений в неактивное состояние.
* Можно отладить только те веб-задания, которые выполняются непрерывно. Отладка веб-заданий, выполняющихся по расписанию или по требованию, не поддерживается.

## <a name="NextSteps"></a>Дальнейшие действия
Дополнительные сведения см. в разделе [Рекомендуемые ресурсы для веб-заданий Azure][WebJobsRecommendedResources].

[PSonWebJobs]:http://blogs.msdn.com/b/nicktrog/archive/2014/01/22/running-powershell-web-jobs-on-azure-websites.aspx
[WebJobsRecommendedResources]:http://go.microsoft.com/fwlink/?LinkId=390226

[OnDemandWebJob]: ./media/web-sites-create-web-jobs/01aOnDemandWebJob.png
[WebJobsList]: ./media/web-sites-create-web-jobs/02aWebJobsList.png
[NewContinuousJob]: ./media/web-sites-create-web-jobs/03aNewContinuousJob.png
[NewScheduledJob]: ./media/web-sites-create-web-jobs/04aNewScheduledJob.png
[SchdRecurrence]: ./media/web-sites-create-web-jobs/05SchdRecurrence.png
[SchdStart]: ./media/web-sites-create-web-jobs/06SchdStart.png
[SchdStartOn]: ./media/web-sites-create-web-jobs/07SchdStartOn.png
[SchdRecurEvery]: ./media/web-sites-create-web-jobs/08SchdRecurEvery.png
[SchdWeeksOnParticular]: ./media/web-sites-create-web-jobs/09SchdWeeksOnParticular.png
[SchdMonthsOnPartDays]: ./media/web-sites-create-web-jobs/10SchdMonthsOnPartDays.png
[SchdMonthsOnPartWeekDays]: ./media/web-sites-create-web-jobs/11SchdMonthsOnPartWeekDays.png
[SchdMonthsOnPartWeekDaysOccurences]: ./media/web-sites-create-web-jobs/12SchdMonthsOnPartWeekDaysOccurences.png
[RunOnce]: ./media/web-sites-create-web-jobs/13RunOnce.png
[WebJobsListWithSeveralJobs]: ./media/web-sites-create-web-jobs/13WebJobsListWithSeveralJobs.png
[WebJobLogs]: ./media/web-sites-create-web-jobs/14WebJobLogs.png
[WebJobDetails]: ./media/web-sites-create-web-jobs/15WebJobDetails.png
[WebJobRunDetails]: ./media/web-sites-create-web-jobs/16WebJobRunDetails.png
[DownloadLogOutput]: ./media/web-sites-create-web-jobs/17DownloadLogOutput.png
[WebJobsLinkToDashboardList]: ./media/web-sites-create-web-jobs/18WebJobsLinkToDashboardList.png
[WebJobsListInJobsDashboard]: ./media/web-sites-create-web-jobs/19WebJobsListInJobsDashboard.png
[LinkToScheduler]: ./media/web-sites-create-web-jobs/31LinkToScheduler.png
[SchedulerPortal]: ./media/web-sites-create-web-jobs/32SchedulerPortal.png
[JobActionPageInScheduler]: ./media/web-sites-create-web-jobs/33JobActionPageInScheduler.png

