---
title: "Развертывание aaaFlighting (бета-тестирования) в службе приложений Azure"
description: "Узнайте, как tooflight новые функции в приложении или бета-версии протестировать изменения в этом учебнике начала до конца. Этот режим тестирования объединяет такие функции службы приложений, как непрерывная публикация, управление слотами, маршрутизация трафика и интеграция с Application Insights."
services: app-service\web
documentationcenter: 
author: cephalin
manager: erikre
editor: 
ms.assetid: 17953c51-38f8-442d-bb0b-f69c1542f0e9
ms.service: app-service-web
ms.workload: web
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/02/2016
ms.author: cephalin
ms.openlocfilehash: e83477b1fe46be09e5baa7bc2bd239b840b05cf7
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="flighting-deployment-beta-testing-in-azure-app-service"></a><span data-ttu-id="122eb-104">Развертывание в режиме фокус-тестирования (бета-тестирование) в службе приложений Azure</span><span class="sxs-lookup"><span data-stu-id="122eb-104">Flighting deployment (beta testing) in Azure App Service</span></span>
<span data-ttu-id="122eb-105">В этом учебнике показано как toodo *развертываний в проекте, которая должна* интегрируя hello различные функциональные возможности [службе приложений Azure](http://go.microsoft.com/fwlink/?LinkId=529714) и [Azure Application Insights](/services/application-insights/).</span><span class="sxs-lookup"><span data-stu-id="122eb-105">This tutorial shows you how toodo *flighting deployments* by integrating hello various capabilities of [Azure App Service](http://go.microsoft.com/fwlink/?LinkId=529714) and [Azure Application Insights](/services/application-insights/).</span></span>

<span data-ttu-id="122eb-106">*Фокус-тестирование* — это процесс развертывания, в ходе которого выполняется проверка новой функции или внесенного изменения с привлечением ограниченного количества реальных клиентов. В рабочих сценариях это основной режим тестирования.</span><span class="sxs-lookup"><span data-stu-id="122eb-106">*Flighting* is a deployment process that validates a new feature or change with a limited number of real customers, and is a major testing in production scenario.</span></span> <span data-ttu-id="122eb-107">Это Иванов toobeta тестирования и иногда называется «управляемой тестовой рейсов».</span><span class="sxs-lookup"><span data-stu-id="122eb-107">It is akin toobeta testing and is sometimes known as "controlled test flight".</span></span> <span data-ttu-id="122eb-108">Многие крупные предприятия, обозначившие свое веб-присутствие, используют этот подход для выполнения ранней проверки обновлений своих приложений в рамках методологии [гибкой разработки](https://en.wikipedia.org/wiki/Agile_software_development).</span><span class="sxs-lookup"><span data-stu-id="122eb-108">Many large enterprises with a web presence use this approach to get early validation on their app updates in their practice of [agile development](https://en.wikipedia.org/wiki/Agile_software_development).</span></span> <span data-ttu-id="122eb-109">Служба приложений Azure позволяет toointegrate тестирования в рабочей среде с непрерывной публикации и Application Insights tooimplement hello одного сценария DevOps.</span><span class="sxs-lookup"><span data-stu-id="122eb-109">Azure App Service enables you toointegrate test in production with continous publishing and Application Insights tooimplement hello same DevOps scenario.</span></span> <span data-ttu-id="122eb-110">Этот подход отличается следующими преимуществами.</span><span class="sxs-lookup"><span data-stu-id="122eb-110">Benefits of this approach include:</span></span>

* <span data-ttu-id="122eb-111">**Получить данные реальном *перед* обновления, выпущенные tooproduction** -hello только лучше, чем получения отзывов по мере выпуска приобретает все отзывы перед выпуском.</span><span class="sxs-lookup"><span data-stu-id="122eb-111">**Gain real feedback *before* updates are released tooproduction** - hello only thing better than gaining feedback as soon as you release is gaining feedback before you release.</span></span> <span data-ttu-id="122eb-112">Как можно раньше в жизненном цикле продукта hello можно проверить обновления с реальными пользовательского трафика и поведения.</span><span class="sxs-lookup"><span data-stu-id="122eb-112">You can test updates with real user traffic and behaviors as early as you desire in hello product life cycle.</span></span>
* <span data-ttu-id="122eb-113">**Оптимизация [непрерывной разработки на основе тестирования (CTDD)](https://en.wikipedia.org/wiki/Continuous_test-driven_development)**. Непрерывная интеграция в рабочую среду процессов тестирования и инструментирования средствами Application Insights делает возможным раннюю автоматическую проверку с привлечением пользователей, выполняемую на требуемом этапе жизненного цикла продукта.</span><span class="sxs-lookup"><span data-stu-id="122eb-113">**Enhance [continuous test-driven development (CTDD)](https://en.wikipedia.org/wiki/Continuous_test-driven_development)** - By integrating test in production with continuous integration and instrumentation with Application Insights, user validation happens early and automatically in your product life cycle.</span></span> <span data-ttu-id="122eb-114">Это помогает сократить временные затраты при выполнении тестирования вручную.</span><span class="sxs-lookup"><span data-stu-id="122eb-114">This helps reduce time investments in manual test execution.</span></span>
* <span data-ttu-id="122eb-115">**Оптимизировать процесс тестирования** -путем автоматизации тестирования в рабочей среде с непрерывной инструментария мониторинга, можно потенциально решать hello задачи разные виды тестов в одном процессе, такие как [интеграции](https://en.wikipedia.org/wiki/Integration_testing), [регрессии](https://en.wikipedia.org/wiki/Regression_testing), [удобство использования](https://en.wikipedia.org/wiki/Usability_testing), доступность, локализации, [производительности](https://en.wikipedia.org/wiki/Software_performance_testing), [безопасности](https://en.wikipedia.org/wiki/Security_testing), и [ Принятие](https://en.wikipedia.org/wiki/Acceptance_testing).</span><span class="sxs-lookup"><span data-stu-id="122eb-115">**Optimize test workflow** - By automating test in production with continuous monitoring instrumentation, you can potentially accomplish hello goals of various kinds of tests in a single process, such as [integration](https://en.wikipedia.org/wiki/Integration_testing), [regression](https://en.wikipedia.org/wiki/Regression_testing), [usability](https://en.wikipedia.org/wiki/Usability_testing), accessibility, localization, [performance](https://en.wikipedia.org/wiki/Software_performance_testing), [security](https://en.wikipedia.org/wiki/Security_testing), and [acceptance](https://en.wikipedia.org/wiki/Acceptance_testing).</span></span>

<span data-ttu-id="122eb-116">Развертывание в режиме фокус-тестирования используется не только для маршрутизации текущего трафика.</span><span class="sxs-lookup"><span data-stu-id="122eb-116">A flighting deployment is not just about routing live traffic.</span></span> <span data-ttu-id="122eb-117">В такой среде требуется анализ toogain как можно скорее, будь непредвиденные ошибки, снижение производительности, проблемы взаимодействия пользователя.</span><span class="sxs-lookup"><span data-stu-id="122eb-117">In such a deployment you want toogain insight as quickly as possible, whether it be an unexpected bug, performance degradation, user experience issues.</span></span> <span data-ttu-id="122eb-118">Помните: вы имеете дело с реальными пользователями.</span><span class="sxs-lookup"><span data-stu-id="122eb-118">Remember, you are dealing with real customers.</span></span> <span data-ttu-id="122eb-119">Поэтому toodo его вправо, необходимо убедиться, что вы настроили ваш flighting toogather развертывания все hello данные, необходимые в заказе toomake обоснованное решение для перехода к следующему этапу.</span><span class="sxs-lookup"><span data-stu-id="122eb-119">So toodo it right, you must make sure that you have set up your flighting deployment toogather all hello data you need in order toomake an informed decision for your next step.</span></span> <span data-ttu-id="122eb-120">В этом учебнике показано использование toocollect данных с помощью Application Insights, но New Relic или других технологий, подходящий для вашего сценария.</span><span class="sxs-lookup"><span data-stu-id="122eb-120">This tutorial shows you how toocollect data with Application Insights, but you can use New Relic or other technologies that suits your scenario.</span></span>

## <a name="what-you-will-do"></a><span data-ttu-id="122eb-121">Выполняемая задача</span><span class="sxs-lookup"><span data-stu-id="122eb-121">What you will do</span></span>
<span data-ttu-id="122eb-122">В этом учебнике вы узнаете, как toobring hello следующие сценарии вместе tootest приложение службы приложений в рабочей среде:</span><span class="sxs-lookup"><span data-stu-id="122eb-122">In this tutorial, you will learn how toobring hello following scenarios together tootest your App Service app in production:</span></span>

* <span data-ttu-id="122eb-123">[Перенаправлять трафик рабочей](app-service-web-test-in-production-get-start.md) tooyour бета-версии приложения</span><span class="sxs-lookup"><span data-stu-id="122eb-123">[Route production traffic](app-service-web-test-in-production-get-start.md) tooyour beta app</span></span>
* <span data-ttu-id="122eb-124">[Инструментирование приложения](../application-insights/app-insights-web-track-usage.md) tooobtain полезных метрик</span><span class="sxs-lookup"><span data-stu-id="122eb-124">[Instrument your app](../application-insights/app-insights-web-track-usage.md) tooobtain useful metrics</span></span>
* <span data-ttu-id="122eb-125">Непрерывное развертывание бета-версии приложения с отслеживанием метрик в режиме реального времени.</span><span class="sxs-lookup"><span data-stu-id="122eb-125">Continuously deploy your beta app and track live app metrics</span></span>
* <span data-ttu-id="122eb-126">Показатели сравнения между рабочее приложение hello и toosee приложения hello бета-версии, как меняется код преобразования tooresults</span><span class="sxs-lookup"><span data-stu-id="122eb-126">Compare metrics between hello production app and hello beta app toosee how code changes translate tooresults</span></span>

## <a name="what-you-will-need"></a><span data-ttu-id="122eb-127">Необходимые условия</span><span class="sxs-lookup"><span data-stu-id="122eb-127">What you will need</span></span>
* <span data-ttu-id="122eb-128">Учетная запись Azure.</span><span class="sxs-lookup"><span data-stu-id="122eb-128">An Azure account</span></span>
* <span data-ttu-id="122eb-129">Учетная запись [GitHub](https://github.com/) .</span><span class="sxs-lookup"><span data-stu-id="122eb-129">A [GitHub](https://github.com/) account</span></span>
* <span data-ttu-id="122eb-130">Visual Studio 2015 — вы можете загрузить hello [Community edition](https://www.visualstudio.com/en-us/products/visual-studio-express-vs.aspx).</span><span class="sxs-lookup"><span data-stu-id="122eb-130">Visual Studio 2015 - you can download hello [Community edition](https://www.visualstudio.com/en-us/products/visual-studio-express-vs.aspx).</span></span>
* <span data-ttu-id="122eb-131">Оболочка Git (устанавливается вместе с [GitHub для Windows](https://windows.github.com/))-это позволяет вам toorun обе команды Git и PowerShell hello в hello того же сеанса</span><span class="sxs-lookup"><span data-stu-id="122eb-131">Git Shell (installed with [GitHub for Windows](https://windows.github.com/)) - this enables you toorun both hello Git and PowerShell commands in hello same session</span></span>
* <span data-ttu-id="122eb-132">Последняя версия [Azure PowerShell](https://github.com/Azure/azure-powershell/releases/download/v0.9.8-September2015/azure-powershell.0.9.8.msi) .</span><span class="sxs-lookup"><span data-stu-id="122eb-132">Latest [Azure PowerShell](https://github.com/Azure/azure-powershell/releases/download/v0.9.8-September2015/azure-powershell.0.9.8.msi) bits</span></span>
* <span data-ttu-id="122eb-133">Базовое представление о hello следующее:</span><span class="sxs-lookup"><span data-stu-id="122eb-133">Basic understanding of hello following:</span></span>
  * <span data-ttu-id="122eb-134">Развертывание шаблона [Azure Resource Manager](../azure-resource-manager/resource-group-overview.md) (ознакомьтесь также с разделом [Предсказуемое развертывание сложного приложения в Azure](app-service-deploy-complex-application-predictably.md)).</span><span class="sxs-lookup"><span data-stu-id="122eb-134">[Azure Resource Manager](../azure-resource-manager/resource-group-overview.md) template deployment (see [Deploy a complex application predictably in Azure](app-service-deploy-complex-application-predictably.md))</span></span>
  * [<span data-ttu-id="122eb-135">Git.</span><span class="sxs-lookup"><span data-stu-id="122eb-135">Git</span></span>](http://git-scm.com/documentation)
  * [<span data-ttu-id="122eb-136">PowerShell</span><span class="sxs-lookup"><span data-stu-id="122eb-136">PowerShell</span></span>](https://technet.microsoft.com/library/bb978526.aspx)

> [!NOTE]
> <span data-ttu-id="122eb-137">Требуется учетная запись Azure toocomplete этого учебника:</span><span class="sxs-lookup"><span data-stu-id="122eb-137">You need an Azure account toocomplete this tutorial:</span></span>
>
> * <span data-ttu-id="122eb-138">Вы можете [открыть учетную запись Azure бесплатно](https://azure.microsoft.com/pricing/free-trial/) -вы получаете кредиты можно использовать tootry out платных служб Azure и даже после того, они используются hello учетной записи, можно сохранить и использовать освободить служб Azure, таких как веб-приложений.</span><span class="sxs-lookup"><span data-stu-id="122eb-138">You can [open an Azure account for free](https://azure.microsoft.com/pricing/free-trial/) - You get credits you can use tootry out paid Azure services, and even after they're used up you can keep hello account and use free Azure services, such as Web Apps.</span></span>
> * <span data-ttu-id="122eb-139">Вы можете [активировать преимущества подписчика Visual Studio](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) — каждый месяц ваша подписка Visual Studio предоставляет вам кредиты, которые можно использовать для оплаты служб Azure.</span><span class="sxs-lookup"><span data-stu-id="122eb-139">You can [activate Visual Studio subscriber benefits](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) - Your Visual Studio subscription gives you credits every month that you can use for paid Azure services.</span></span>
>
> <span data-ttu-id="122eb-140">Tooget работы в службе приложений Azure перед регистрацией учетную запись Azure, перейдите слишком[повторите служб приложений](https://azure.microsoft.com/try/app-service/), в котором можно немедленно создать кратковременных начальный веб-приложения в службе приложений.</span><span class="sxs-lookup"><span data-stu-id="122eb-140">If you want tooget started with Azure App Service before signing up for an Azure account, go too[Try App Service](https://azure.microsoft.com/try/app-service/), where you can immediately create a short-lived starter web app in App Service.</span></span> <span data-ttu-id="122eb-141">Никаких кредитных карт и обязательств.</span><span class="sxs-lookup"><span data-stu-id="122eb-141">No credit cards required; no commitments.</span></span>
>
>

## <a name="set-up-your-production-web-app"></a><span data-ttu-id="122eb-142">Настройка рабочего веб-приложения</span><span class="sxs-lookup"><span data-stu-id="122eb-142">Set up your production web app</span></span>
> [!NOTE]
> <span data-ttu-id="122eb-143">сценарий Hello, используемые в этом учебнике автоматически настраивает непрерывной публикации из репозитория GitHub.</span><span class="sxs-lookup"><span data-stu-id="122eb-143">hello script used in this tutorial will automatically configure continuous publishing from your GitHub repository.</span></span> <span data-ttu-id="122eb-144">Это требует учетные данные GitHub уже были сохранены в Azure, в противном случае возникнет hello в скрипт развертывания, при попытке tooconfigure параметры системы управления версиями для веб-приложения hello.</span><span class="sxs-lookup"><span data-stu-id="122eb-144">This requires that your GitHub credentials are already stored in Azure, otherwise hello scripted deployment will fail when attempting tooconfigure source control settings for hello web apps.</span></span>
>
> <span data-ttu-id="122eb-145">toostore GitHub учетные данные в Azure, создайте веб-приложения в hello [портала Azure](https://portal.azure.com/) и [настройки развертывания GitHub](app-service-continuous-deployment.md).</span><span class="sxs-lookup"><span data-stu-id="122eb-145">toostore your GitHub credentials in Azure, create a web app in hello [Azure Portal](https://portal.azure.com/) and [configure GitHub deployment](app-service-continuous-deployment.md).</span></span> <span data-ttu-id="122eb-146">Требуется только toodo этом один раз.</span><span class="sxs-lookup"><span data-stu-id="122eb-146">You only need toodo this once.</span></span>
>
>

<span data-ttu-id="122eb-147">В типичном сценарии DevOps у вас есть приложение, которое работает в активном состоянии в Azure и требуется toomake tooit изменения в непрерывной публикации.</span><span class="sxs-lookup"><span data-stu-id="122eb-147">In a typical DevOps scenario, you have an application that’s running live in Azure, and you want toomake changes tooit through continuous publishing.</span></span> <span data-ttu-id="122eb-148">В этом сценарии будет развернуть tooproduction шаблона, разработки и тестирования.</span><span class="sxs-lookup"><span data-stu-id="122eb-148">In this scenario, you will deploy tooproduction a template that you have developed and tested.</span></span>

1. <span data-ttu-id="122eb-149">Создание собственных вилки hello [ToDoApp](https://github.com/azure-appservice-samples/ToDoApp) репозитория.</span><span class="sxs-lookup"><span data-stu-id="122eb-149">Create your own fork of hello [ToDoApp](https://github.com/azure-appservice-samples/ToDoApp) repository.</span></span> <span data-ttu-id="122eb-150">Дополнительные сведения о создании разветвления см. в статье [Fork a Repo](https://help.github.com/articles/fork-a-repo/) (Разветвление репозитория).</span><span class="sxs-lookup"><span data-stu-id="122eb-150">For information on creating your fork, see [Fork a Repo](https://help.github.com/articles/fork-a-repo/).</span></span> <span data-ttu-id="122eb-151">После создания разветвления его можно просматривать в браузере.</span><span class="sxs-lookup"><span data-stu-id="122eb-151">Once your fork is created, you can see it in your browser.</span></span>

   ![](./media/app-service-agile-software-development/production-1-private-repo.png)
2. <span data-ttu-id="122eb-152">Откройте сеанс Git Shell.</span><span class="sxs-lookup"><span data-stu-id="122eb-152">Open a Git Shell session.</span></span> <span data-ttu-id="122eb-153">Если у вас нет Git Shell, установите [GitHub для Windows](https://windows.github.com/) .</span><span class="sxs-lookup"><span data-stu-id="122eb-153">If you don't have Git Shell yet, install [GitHub for Windows](https://windows.github.com/) now.</span></span>
3. <span data-ttu-id="122eb-154">Создайте локальный клон на разветвление, выполнив следующую команду hello:</span><span class="sxs-lookup"><span data-stu-id="122eb-154">Create a local clone of your fork by executing hello following command:</span></span>

     <span data-ttu-id="122eb-155">git clone https://github.com/<разветвление>/ToDoApp.git</span><span class="sxs-lookup"><span data-stu-id="122eb-155">git clone https://github.com/<your_fork>/ToDoApp.git</span></span>
4. <span data-ttu-id="122eb-156">При наличии локального клона перейдите слишком*&lt;repository_root >*\ARMTemplates и выполнения hello deploy.ps1 скрипт с уникальный суффикс, как показано ниже:</span><span class="sxs-lookup"><span data-stu-id="122eb-156">Once you have your local clone, navigate too*&lt;repository_root>*\ARMTemplates, and run hello deploy.ps1 script with a unique suffix, as shown below:</span></span>

     <span data-ttu-id="122eb-157">.\deploy.ps1 –RepoUrl https://github.com/<разветвление>/todoapp.git -ResourceGroupSuffix <суффикс></span><span class="sxs-lookup"><span data-stu-id="122eb-157">.\deploy.ps1 –RepoUrl https://github.com/<your_fork>/todoapp.git -ResourceGroupSuffix <your_suffix></span></span>
5. <span data-ttu-id="122eb-158">При появлении запроса введите hello необходимое имя пользователя и пароль для доступа к базе данных.</span><span class="sxs-lookup"><span data-stu-id="122eb-158">When prompted, type in hello desired username and password for database access.</span></span> <span data-ttu-id="122eb-159">Запомнить учетные данные базы данных, поскольку они потребуются toospecify их еще раз при обновлении hello группы ресурсов.</span><span class="sxs-lookup"><span data-stu-id="122eb-159">Remember your database credentials because you will need toospecify them again when updating hello resource group.</span></span>

   <span data-ttu-id="122eb-160">Вы увидите ход выполнения различных ресурсов Azure подготовки hello.</span><span class="sxs-lookup"><span data-stu-id="122eb-160">You should see hello provisioning progress of various Azure resources.</span></span> <span data-ttu-id="122eb-161">После завершения развертывания hello скрипта запустите приложение hello в браузере hello и позволяют понятное звукового сигнала.</span><span class="sxs-lookup"><span data-stu-id="122eb-161">When deployment completes, hello script will launch hello application in hello browser and give you a friendly beep.</span></span>
   ![](./media/app-service-web-test-in-production-controlled-test-flight/00.1-app-in-browser.png)
6. <span data-ttu-id="122eb-162">Вернитесь в сеанс Git Shell и выполните следующую команду:</span><span class="sxs-lookup"><span data-stu-id="122eb-162">Back in your Git Shell session, run:</span></span>

     <span data-ttu-id="122eb-163">.\swap –Name ToDoApp<суффикс></span><span class="sxs-lookup"><span data-stu-id="122eb-163">.\swap –Name ToDoApp<your_suffix></span></span>

   ![](./media/app-service-web-test-in-production-controlled-test-flight/00.2-swap-to-production.png)
7. <span data-ttu-id="122eb-164">После завершения скрипта hello, вернитесь к предыдущему окну адрес внешнего интерфейса toohello toobrowse (http://ToDoApp*&lt;your_suffix >*.azurewebsites.net/) toosee приложения hello, работающего в производственной среде.</span><span class="sxs-lookup"><span data-stu-id="122eb-164">When hello script finishes, go back toobrowse toohello frontend’s address (http://ToDoApp*&lt;your_suffix>*.azurewebsites.net/) toosee hello application running in production.</span></span>
8. <span data-ttu-id="122eb-165">Войти в hello [портала Azure](https://portal.azure.com/) Обратите внимание на то, что создается.</span><span class="sxs-lookup"><span data-stu-id="122eb-165">Log into hello [Azure Portal](https://portal.azure.com/) and take a look at what’s created.</span></span>

   <span data-ttu-id="122eb-166">После этого можно будет toosee двух веб-приложений в hello одну группу ресурсов, один из которых hello `Api` суффикса в имени hello.</span><span class="sxs-lookup"><span data-stu-id="122eb-166">You should be able toosee two web apps in hello same resource group, one with hello `Api` suffix in hello name.</span></span> <span data-ttu-id="122eb-167">Если взглянуть на представление группы ресурсов hello, также появится hello базы данных SQL и сервер, hello план служб приложений и hello промежуточных слотов для hello веб-приложений.</span><span class="sxs-lookup"><span data-stu-id="122eb-167">If you look at hello resource group view, you will also see hello SQL Database and server, hello App Service plan, and hello staging slots for hello web apps.</span></span> <span data-ttu-id="122eb-168">Просматривать различные ресурсы hello и сравнить их с  *&lt;repository_root >*toosee \ARMTemplates\ProdAndStage.json, как они настроены в шаблоне hello.</span><span class="sxs-lookup"><span data-stu-id="122eb-168">Browse through hello different resources and compare them with *&lt;repository_root>*\ARMTemplates\ProdAndStage.json toosee how they are configured in hello template.</span></span>

   ![](./media/app-service-web-test-in-production-controlled-test-flight/00.3-resource-group-view.png)

<span data-ttu-id="122eb-169">Настройки производства приложение hello.</span><span class="sxs-lookup"><span data-stu-id="122eb-169">You have set up hello production app.</span></span>  <span data-ttu-id="122eb-170">Теперь предположим, вы получите отзыв, низка, удобство использования для приложения hello.</span><span class="sxs-lookup"><span data-stu-id="122eb-170">Now, let's imagine that you receive feedback that usability is poor for hello app.</span></span> <span data-ttu-id="122eb-171">Поэтому определить tooinvestigate.</span><span class="sxs-lookup"><span data-stu-id="122eb-171">So you decide tooinvestigate.</span></span> <span data-ttu-id="122eb-172">Вы собираетесь tooinstrument toogive вашего приложения вы обратной связи.</span><span class="sxs-lookup"><span data-stu-id="122eb-172">You're going tooinstrument your app toogive you feedback.</span></span>

## <a name="investigate-instrument-your-client-app-for-monitoringmetrics"></a><span data-ttu-id="122eb-173">Анализ: инструментирование клиентского приложения для мониторинга метрик</span><span class="sxs-lookup"><span data-stu-id="122eb-173">Investigate: Instrument your client app for monitoring/metrics</span></span>
1. <span data-ttu-id="122eb-174">Откройте в Visual Studio файл *&lt;корень_репозитория>*\src\MultiChannelToDo.sln.</span><span class="sxs-lookup"><span data-stu-id="122eb-174">Open *&lt;repository_root>*\src\MultiChannelToDo.sln in Visual Studio.</span></span>
2. <span data-ttu-id="122eb-175">Восстановите все пакеты NuGet, щелкнув правой кнопкой мыши нужное решение и выбрав **Управление пакетами NuGet для решения** > **Восстановить**.</span><span class="sxs-lookup"><span data-stu-id="122eb-175">Restore all Nuget packages by right-clicking solution > **Manage NuGet Packages for Solution** > **Restore**.</span></span>
3. <span data-ttu-id="122eb-176">Щелкните правой кнопкой мыши **MultiChannelToDo.Web** > **добавить Телеметрию Application Insights** > **Настройка параметров** > изменить группу ресурсов tooToDoApp*&lt;your_suffix >* > **tooProject добавить Application Insights**.</span><span class="sxs-lookup"><span data-stu-id="122eb-176">Right-click **MultiChannelToDo.Web** > **Add Application Insights Telemetry** > **Configure Settings** > Change resource group tooToDoApp*&lt;your_suffix>* > **Add Application Insights tooProject**.</span></span>
4. <span data-ttu-id="122eb-177">В hello портал Azure, откройте колонку hello для hello **MultiChannelToDo.Web** Application Insight ресурсов.</span><span class="sxs-lookup"><span data-stu-id="122eb-177">In hello Azure Portal, open hello blade for hello **MultiChannelToDo.Web** Application Insight resource.</span></span> <span data-ttu-id="122eb-178">Затем в hello **работоспособности приложения** часть, нажмите кнопку **узнать, как страница обозревателя toocollect загрузки данных** > скопируйте код.</span><span class="sxs-lookup"><span data-stu-id="122eb-178">Then in hello **Application health** part, click **Learn how toocollect browser page load data** > copy code.</span></span>
5. <span data-ttu-id="122eb-179">Добавить hello скопировать код инструментирования JS слишком*&lt;repository_root >*\src\MultiChannelToDo.Web\app\Index.cshtml непосредственно перед закрывающим hello `<heading>` тег.</span><span class="sxs-lookup"><span data-stu-id="122eb-179">Add hello copied JS instrumentation code too*&lt;repository_root>*\src\MultiChannelToDo.Web\app\Index.cshtml, just before hello closing `<heading>` tag.</span></span> <span data-ttu-id="122eb-180">Она должна содержать ключ hello уникальный инструментирования Application Insight ресурса.</span><span class="sxs-lookup"><span data-stu-id="122eb-180">It should contain hello unique instrumentation key of your Application Insight resource.</span></span>

        <script type="text/javascript">
        var appInsights=window.appInsights||function(config){
            function s(config){t[config]=function(){var i=arguments;t.queue.push(function(){t[config].apply(t,i)})}}var t={config:config},r=document,f=window,e="script",o=r.createElement(e),i,u;for(o.src=config.url||"//az416426.vo.msecnd.net/scripts/a/ai.0.js",r.getElementsByTagName(e)[0].parentNode.appendChild(o),t.cookie=r.cookie,t.queue=[],i=["Event","Exception","Metric","PageView","Trace"];i.length;)s("track"+i.pop());return config.disableExceptionTracking||(i="onerror",s("_"+i),u=f[i],f[i]=function(config,r,f,e,o){var s=u&&u(config,r,f,e,o);return s!==!0&&t["_"+i](config,r,f,e,o),s}),t
        }({
            instrumentationKey:"<your_unique_instrumentation_key>"
        });

        window.appInsights=appInsights;
        appInsights.trackPageView();
        </script>
6. <span data-ttu-id="122eb-181">Отправьте tooApplication аналитики для щелчки мышью пользовательских событий, добавив следующий код toohello внизу текста hello:</span><span class="sxs-lookup"><span data-stu-id="122eb-181">Send custom events tooApplication Insights for mouse clicks by adding hello following code toohello bottom of body:</span></span>

       <script>
           $(document.body).find("*").click(function(event) {

               appInsights.trackEvent(event.target.tagName + ": " + event.target.className);
           });
       </script>

   <span data-ttu-id="122eb-182">Этот фрагмент JavaScript отправляет tooApplication пользовательское событие аналитики каждый раз при щелчке в любом месте в веб-приложения hello.</span><span class="sxs-lookup"><span data-stu-id="122eb-182">This JavaScript snippet sends a custom event tooApplication Insights every time a user clicks anywhere in hello web app.</span></span>
7. <span data-ttu-id="122eb-183">В оболочке Git зафиксируйте и отправьте на разветвление tooyour изменения в GitHub.</span><span class="sxs-lookup"><span data-stu-id="122eb-183">In Git Shell, commit and push your changes tooyour fork in GitHub.</span></span> <span data-ttu-id="122eb-184">Дождитесь, пока клиенты toorefresh браузера.</span><span class="sxs-lookup"><span data-stu-id="122eb-184">Then, wait for clients toorefresh browser.</span></span>

       git add -A :/
       git commit -m "add AI configuration for client app"
       git push origin master
8. <span data-ttu-id="122eb-185">Поменяйте tooproduction изменения приложения hello развертывания:</span><span class="sxs-lookup"><span data-stu-id="122eb-185">Swap hello deployed app changes tooproduction:</span></span>

     <span data-ttu-id="122eb-186">.\swap –Name ToDoApp<суффикс></span><span class="sxs-lookup"><span data-stu-id="122eb-186">.\swap –Name ToDoApp<your_suffix></span></span>
9. <span data-ttu-id="122eb-187">Обзор toohello Application Insights ресурс, который можно настроить.</span><span class="sxs-lookup"><span data-stu-id="122eb-187">Browse toohello Application Insights resource that you configured.</span></span> <span data-ttu-id="122eb-188">Щелкните «Настраиваемые события».</span><span class="sxs-lookup"><span data-stu-id="122eb-188">Click Custom events.</span></span>

   ![](./media/app-service-web-test-in-production-controlled-test-flight/01-custom-events.png)

   <span data-ttu-id="122eb-189">Если вы не видите метрик, характеризующих пользовательские события, подождите несколько минут и щелкните **Обновить**.</span><span class="sxs-lookup"><span data-stu-id="122eb-189">If you don't see metrics for custom events, wait a few minutes and click **Refresh**.</span></span>

<span data-ttu-id="122eb-190">Предположим, что вы видите диаграмму, похожую на представленную ниже:</span><span class="sxs-lookup"><span data-stu-id="122eb-190">Suppose you see a chart like below:</span></span>

![](./media/app-service-web-test-in-production-controlled-test-flight/02-custom-events-chart-view.png)

<span data-ttu-id="122eb-191">И сетки событий hello под ней:</span><span class="sxs-lookup"><span data-stu-id="122eb-191">And hello event grid below it:</span></span>

![](./media/app-service-web-test-in-production-controlled-test-flight/03-custom-event-grid-view.png)

<span data-ttu-id="122eb-192">Здравствуйте, в соответствии с кодом приложения ToDoApp tooyour, **кнопку** событие соответствует toohello кнопку "Отправить" и hello **ввода** событие соответствует toohello текстовое поле.</span><span class="sxs-lookup"><span data-stu-id="122eb-192">According tooyour ToDoApp application code, hello **BUTTON** event corresponds toohello submit button, and hello **INPUT** event corresponds toohello textbox.</span></span> <span data-ttu-id="122eb-193">С этим все понятно.</span><span class="sxs-lookup"><span data-stu-id="122eb-193">So far, things make sense.</span></span> <span data-ttu-id="122eb-194">Однако, похоже, имеется достаточно большой объем щелчками мышью и очень мало щелчков мыши на элементы задача hello (hello **LI** событий).</span><span class="sxs-lookup"><span data-stu-id="122eb-194">However, it looks like there's a good amount of clicks and very few clicks on hello to-do items (hello **LI** events).</span></span>

<span data-ttu-id="122eb-195">На основе этого, вы формы предположение, некоторым пользователям не путать hello какой части пользовательского интерфейса являются интерактивными и тем, что курсор hello реализуется для выделения текста, при его наведении на элементы списка hello и соответствующие значки.</span><span class="sxs-lookup"><span data-stu-id="122eb-195">Based on this, you form your hypothesis that some users are confused which part of hello UI is clickable and it is because hello cursor is styled for text selection when it hovers on hello list items and their icons.</span></span>

![](./media/app-service-web-test-in-production-controlled-test-flight/04-to-do-list-item-ui.png)

<span data-ttu-id="122eb-196">Этот пример может выглядеть несколько надуманным.</span><span class="sxs-lookup"><span data-stu-id="122eb-196">This might be a contrived example.</span></span> <span data-ttu-id="122eb-197">Тем не менее вы будете toomake текущее приложение tooyour улучшения, а затем выполните flighting отзыв удобство использования tooget развертывания от динамической клиентов.</span><span class="sxs-lookup"><span data-stu-id="122eb-197">Nevertheless, you're going toomake an improvement tooyour app, and then perform a flighting deployment tooget usability feedback from live customers.</span></span>

### <a name="instrument-your-server-app-for-monitoringmetrics"></a><span data-ttu-id="122eb-198">Инструментирование серверного приложения для получения метрик и для мониторинга</span><span class="sxs-lookup"><span data-stu-id="122eb-198">Instrument your server app for monitoring/metrics</span></span>
<span data-ttu-id="122eb-199">Это касательной, поскольку сценарий hello, демонстрируются в данном учебнике рассматриваются только hello клиентского приложения.</span><span class="sxs-lookup"><span data-stu-id="122eb-199">This is a tangent since hello scenario demonstrated in this tutorial only deals with hello client app.</span></span> <span data-ttu-id="122eb-200">Тем не менее для обеспечения полноты вы настроите серверное приложение hello.</span><span class="sxs-lookup"><span data-stu-id="122eb-200">However, for completeness you will set up hello server-side app.</span></span>

1. <span data-ttu-id="122eb-201">Щелкните правой кнопкой мыши **MultiChannelToDo** > **добавить Телеметрию Application Insights** > **Настройка параметров** > изменить группу ресурсов tooToDoApp*&lt;your_suffix >* > **tooProject добавить Application Insights**.</span><span class="sxs-lookup"><span data-stu-id="122eb-201">Right-click **MultiChannelToDo** > **Add Application Insights Telemetry** > **Configure Settings** > Change resource group tooToDoApp*&lt;your_suffix>* > **Add Application Insights tooProject**.</span></span>
2. <span data-ttu-id="122eb-202">В оболочке Git зафиксируйте и отправьте на разветвление tooyour изменения в GitHub.</span><span class="sxs-lookup"><span data-stu-id="122eb-202">In Git Shell, commit and push your changes tooyour fork in GitHub.</span></span> <span data-ttu-id="122eb-203">Дождитесь, пока клиенты toorefresh браузера.</span><span class="sxs-lookup"><span data-stu-id="122eb-203">Then, wait for clients toorefresh browser.</span></span>

       git add -A :/
       git commit -m "add AI configuration for server app"
       git push origin master
3. <span data-ttu-id="122eb-204">Поменяйте tooproduction изменения приложения hello развертывания:</span><span class="sxs-lookup"><span data-stu-id="122eb-204">Swap hello deployed app changes tooproduction:</span></span>

     <span data-ttu-id="122eb-205">.\swap –Name ToDoApp<суффикс></span><span class="sxs-lookup"><span data-stu-id="122eb-205">.\swap –Name ToDoApp<your_suffix></span></span>

<span data-ttu-id="122eb-206">Вот и все!</span><span class="sxs-lookup"><span data-stu-id="122eb-206">That's it!</span></span>

## <a name="investigate-add-slot-specific-tags-tooyour-client-app-metrics"></a><span data-ttu-id="122eb-207">Изучить: Добавление слота специальные теги tooyour клиентского приложения метрик</span><span class="sxs-lookup"><span data-stu-id="122eb-207">Investigate: Add slot-specific tags tooyour client app metrics</span></span>
<span data-ttu-id="122eb-208">В этом разделе вы настроите hello развертывания слоты toosend телеметрии конкретного слот toohello того же ресурса Application Insights.</span><span class="sxs-lookup"><span data-stu-id="122eb-208">In this section, you will configure hello different deployment slots toosend slot-specific telemetry toohello same Application Insights resource.</span></span> <span data-ttu-id="122eb-209">Таким образом, можно сравнить телеметрии данных между трафик от tooeasily различных слотов (сред развертывания). в статье hello влияние изменения приложения.</span><span class="sxs-lookup"><span data-stu-id="122eb-209">This way, you can compare telemetry data between traffic from different slots (deployment environments) tooeasily see hello effect of your app changes.</span></span> <span data-ttu-id="122eb-210">AT hello же времени, можно отделить hello рабочего трафика от hello rest, чтобы продолжить toomonitor на рабочее приложение при необходимости.</span><span class="sxs-lookup"><span data-stu-id="122eb-210">At hello same time, you can separate hello production traffic from hello rest so you can continue toomonitor your production app as needed.</span></span>

<span data-ttu-id="122eb-211">Так как при сборе данных на поведение клиента будет [добавить tooyour инициализатора телеметрии код JavaScript](../application-insights/app-insights-api-filtering-sampling.md) в index.cshtml.</span><span class="sxs-lookup"><span data-stu-id="122eb-211">Since you're gathering data on client behavior, you will [add a telemetry initializer tooyour JavaScript code](../application-insights/app-insights-api-filtering-sampling.md) in index.cshtml.</span></span> <span data-ttu-id="122eb-212">Если вы хотите tootest производительности на стороне сервера, например, аналогичную процедуру можно также выполнить в коде сервера (в разделе [Application Insights API пользовательские события и метрики](../application-insights/app-insights-api-custom-events-metrics.md).</span><span class="sxs-lookup"><span data-stu-id="122eb-212">If you want tootest server-side performance, for example, you can also do similarly in your server code (see [Application Insights API for custom events and metrics](../application-insights/app-insights-api-custom-events-metrics.md).</span></span>

1. <span data-ttu-id="122eb-213">Сначала добавьте hello bewteen кода hello двух `//` комментарии ниже в блоке hello JavaScript, которые добавлены toohello `<heading>` тег ранее.</span><span class="sxs-lookup"><span data-stu-id="122eb-213">First, add hello code bewteen hello two `//` comments below in hello JavaScript block that you added toohello `<heading>` tag earlier.</span></span>

        window.appInsights = appInsights;

        // Begin new code
        appInsights.queue.push(function () {
            appInsights.context.addTelemetryInitializer(function (envelope) {
                var telemetryItem = envelope.data.baseData;
                telemetryItem.properties = telemetryItem.properties || {};
                telemetryItem.properties["Environment"] = "@System.Configuration.ConfigurationManager.AppSettings["environment"]";
            });
        });
        // End new code

        appInsights.trackPageView();

    <span data-ttu-id="122eb-214">Этот код инициализатор вызывает hello `appInsights` настраиваемое свойство hello объекта tooadd `Environment` tooevery часть отправляет данные телеметрии.</span><span class="sxs-lookup"><span data-stu-id="122eb-214">This initializer code causes hello `appInsights` object tooadd hello a custom property called `Environment` tooevery piece of telemetry it sends.</span></span>
2. <span data-ttu-id="122eb-215">Затем добавьте это пользовательское свойство как [параметр слота](web-sites-staged-publishing.md#AboutConfiguration) для веб-приложения Azure.</span><span class="sxs-lookup"><span data-stu-id="122eb-215">Next, add this custom property as a [slot setting](web-sites-staged-publishing.md#AboutConfiguration) for your web app in Azure.</span></span> <span data-ttu-id="122eb-216">toodo, выполнения hello, следующие команды в сеансе оболочки Git.</span><span class="sxs-lookup"><span data-stu-id="122eb-216">toodo this, run hello following commands in your Git Shell session.</span></span>

        $app = Get-AzureWebsite -Name todoapp<your_suffix> -Slot production
        $app.AppSettings.Add("environment", "Production")
        $app.SlotStickyAppSettingNames.Add("environment")
        $app | Set-AzureWebsite -Name todoapp<your_suffix> -Slot production

    <span data-ttu-id="122eb-217">Hello Web.config в проекте уже имеется определение hello `environment` параметра приложения.</span><span class="sxs-lookup"><span data-stu-id="122eb-217">hello Web.config in your project already defines hello `environment` app setting.</span></span> <span data-ttu-id="122eb-218">Этот параметр при тестировании локально, приложение hello показатели будут тегом `VS Debugger`.</span><span class="sxs-lookup"><span data-stu-id="122eb-218">With this setting, when you test hello app locally, your metrics will be tagged with `VS Debugger`.</span></span> <span data-ttu-id="122eb-219">Однако при выполнении отправки к tooAzure изменения, Azure будет найти и использовать hello `environment` приложения, вместо этого параметра в конфигурации веб-приложения hello и показатели будут тегом `Production`.</span><span class="sxs-lookup"><span data-stu-id="122eb-219">However, when you push your changes tooAzure, Azure will find and use hello `environment` app setting in hello web app's configuration instead, and your metrics will be tagged with `Production`.</span></span>
3. <span data-ttu-id="122eb-220">Фиксация и нажать на разветвление tooyour изменения кода на GitHub и ожидание пользователей toouse hello нового приложения (требуется toorefresh hello браузер).</span><span class="sxs-lookup"><span data-stu-id="122eb-220">Commit and push your code changes tooyour fork on GitHub, and then wait for your users toouse hello new app (need toorefresh hello browser).</span></span> <span data-ttu-id="122eb-221">Он занимает около 15 минут для нового свойства tooshow hello в вашей Application Insights `MultiChannelToDo.Web` ресурсов.</span><span class="sxs-lookup"><span data-stu-id="122eb-221">It takes about 15 minutes for hello new property tooshow up in your Application Insights `MultiChannelToDo.Web` resource.</span></span>

        git add -A :/
        git commit -m "add environment property tooAI events for client app"
        git push origin master
4. <span data-ttu-id="122eb-222">Теперь перейдите toohello **пользовательские события** снова колонки и фильтр hello метрики на `Environment=Production`.</span><span class="sxs-lookup"><span data-stu-id="122eb-222">Now, go toohello **Custom events** blade again and filter hello metrics on `Environment=Production`.</span></span> <span data-ttu-id="122eb-223">Теперь должен быть доступ toosee hello новые пользовательские события в рабочей среде hello слот с данным фильтром.</span><span class="sxs-lookup"><span data-stu-id="122eb-223">You should now be able toosee all hello new custom events in hello production slot with this filter.</span></span>

    ![](./media/app-service-web-test-in-production-controlled-test-flight/05-filter-on-production-environment.png)
5. <span data-ttu-id="122eb-224">Нажмите кнопку hello **Избранное** как кнопка toosave hello текущего обозревателя метрик параметры toosomething **пользовательские события: рабочей**.</span><span class="sxs-lookup"><span data-stu-id="122eb-224">Click hello **Favorites** button toosave hello current Metrics Explorer settings toosomething like **Custom events: Production**.</span></span> <span data-ttu-id="122eb-225">Позже вы сможете легко переключаться между этим представлением и представлением слота развертывания.</span><span class="sxs-lookup"><span data-stu-id="122eb-225">You can easily switch between this view and a deployment slot view later.</span></span>

   > [!TIP]
   > <span data-ttu-id="122eb-226">Если вам нужны более мощные средства аналитики, рассмотрите возможность [интеграции ресурса Application Insights с Power BI](../application-insights/app-insights-export-power-bi.md).</span><span class="sxs-lookup"><span data-stu-id="122eb-226">For even more powerful analytics, consider [integrating your Application Insights resource with Power BI](../application-insights/app-insights-export-power-bi.md).</span></span>
   >
   >

### <a name="add-slot-specific-tags-tooyour-server-app-metrics"></a><span data-ttu-id="122eb-227">Добавить метрики приложений гнездо специальные теги tooyour сервера</span><span class="sxs-lookup"><span data-stu-id="122eb-227">Add slot-specific tags tooyour server app metrics</span></span>
<span data-ttu-id="122eb-228">Опять же для обеспечения полноты вы настроите серверное приложение hello.</span><span class="sxs-lookup"><span data-stu-id="122eb-228">Again, for completeness you will set up hello server-side app.</span></span> <span data-ttu-id="122eb-229">В отличие от клиентского приложения hello которой инструментированы на языке JavaScript слот специальные теги для серверного приложения hello снабжается кода .NET.</span><span class="sxs-lookup"><span data-stu-id="122eb-229">Unlike hello client app which is instrumented in JavaScript, slot-specific tags for hello server app is instrumented with .NET code.</span></span>

1. <span data-ttu-id="122eb-230">Откройте файл *&lt;корень_репозитория>*\src\MultiChannelToDo\Global.asax.cs.</span><span class="sxs-lookup"><span data-stu-id="122eb-230">Open *&lt;repository_root>*\src\MultiChannelToDo\Global.asax.cs.</span></span> <span data-ttu-id="122eb-231">Добавьте блок кода hello ниже, перед закрывающей фигурной скобки имен hello.</span><span class="sxs-lookup"><span data-stu-id="122eb-231">Add hello code block below, just before hello closing namespace curly brace.</span></span>

        namespace MultiChannelToDo
        {
                ...

                // Begin new code
            public class ConfigInitializer
            : ITelemetryInitializer
            {
                void ITelemetryInitializer.Initialize(ITelemetry telemetry)
                {
                    telemetry.Context.Properties["Environment"] = System.Configuration.ConfigurationManager.AppSettings["environment"];
                }
            }
                // End new code
        }
2. <span data-ttu-id="122eb-232">Исправьте ошибки разрешения имен hello, добавив hello `using` инструкции ниже toohello начало hello файла:</span><span class="sxs-lookup"><span data-stu-id="122eb-232">Correct hello name resolution errors by adding hello `using` statements below toohello beginning of hello file:</span></span>

        using Microsoft.ApplicationInsights.Channel;
        using Microsoft.ApplicationInsights.Extensibility;
3. <span data-ttu-id="122eb-233">Добавьте код hello под toohello начало hello `Application_Start()` метод:</span><span class="sxs-lookup"><span data-stu-id="122eb-233">Add hello code below toohello beginning of hello `Application_Start()` method:</span></span>

        TelemetryConfiguration.Active.TelemetryInitializers.Add(new ConfigInitializer());
4. <span data-ttu-id="122eb-234">Фиксация и нажать на разветвление tooyour изменения кода на GitHub и ожидание пользователей toouse hello нового приложения (требуется toorefresh hello браузер).</span><span class="sxs-lookup"><span data-stu-id="122eb-234">Commit and push your code changes tooyour fork on GitHub, and then wait for your users toouse hello new app (need toorefresh hello browser).</span></span> <span data-ttu-id="122eb-235">Он занимает около 15 минут для нового свойства tooshow hello в вашей Application Insights `MultiChannelToDo` ресурсов.</span><span class="sxs-lookup"><span data-stu-id="122eb-235">It takes about 15 minutes for hello new property tooshow up in your Application Insights `MultiChannelToDo` resource.</span></span>

        git add -A :/
        git commit -m "add environment property tooAI events for server app"
        git push origin master

## <a name="update-set-up-your-beta-branch"></a><span data-ttu-id="122eb-236">Обновление: настройка ветви бета-версии</span><span class="sxs-lookup"><span data-stu-id="122eb-236">Update: Set up your beta branch</span></span>
1. <span data-ttu-id="122eb-237">Откройте  *&lt;repository_root >*\ARMTemplates\ProdAndStagetest.json и найти hello `appsettings` ресурсы (поиск `"name": "appsettings"`).</span><span class="sxs-lookup"><span data-stu-id="122eb-237">Open *&lt;repository_root>*\ARMTemplates\ProdAndStagetest.json and find hello `appsettings` resources (search for `"name": "appsettings"`).</span></span> <span data-ttu-id="122eb-238">Существует 4 таких ресурса, по одному для каждого слота.</span><span class="sxs-lookup"><span data-stu-id="122eb-238">There are 4 of them, one for each slot.</span></span>
2. <span data-ttu-id="122eb-239">Для каждого `appsettings` ресурса, добавление `"environment": "[parameters('slotName')]"` приложения параметр toohello конец hello `properties` массива.</span><span class="sxs-lookup"><span data-stu-id="122eb-239">For each `appsettings` resource, add an  `"environment": "[parameters('slotName')]"` app setting toohello end of hello `properties` array.</span></span> <span data-ttu-id="122eb-240">Не забывайте tooend hello предыдущей строки с помощью символа запятой.</span><span class="sxs-lookup"><span data-stu-id="122eb-240">Don't forget tooend hello previous line with a comma.</span></span>

    ![](./media/app-service-web-test-in-production-controlled-test-flight/06-arm-app-setting-with-slot-name.png)

    <span data-ttu-id="122eb-241">Вы только что добавили hello `environment` параметр tooall слоты hello в шаблоне hello приложения.</span><span class="sxs-lookup"><span data-stu-id="122eb-241">You have just added hello `environment` app setting tooall hello slots in hello template.</span></span>
3. <span data-ttu-id="122eb-242">В hello того же файла, найти hello `slotconfignames` ресурсы (поиск `"name": "slotconfignames"`).</span><span class="sxs-lookup"><span data-stu-id="122eb-242">In hello same file, find hello `slotconfignames` resources (search for `"name": "slotconfignames"`).</span></span> <span data-ttu-id="122eb-243">Существует 2 таких ресурса, по одному для каждого приложения.</span><span class="sxs-lookup"><span data-stu-id="122eb-243">There are 2 of them, one for each app.</span></span>
4. <span data-ttu-id="122eb-244">Для каждого `slotconfignames` ресурса, добавление `"environment"` toohello конец hello `appSettingNames` массива.</span><span class="sxs-lookup"><span data-stu-id="122eb-244">For each `slotconfignames` resource, add `"environment"` toohello end of hello `appSettingNames` array.</span></span> <span data-ttu-id="122eb-245">Не забывайте tooend hello предыдущей строки с помощью символа запятой.</span><span class="sxs-lookup"><span data-stu-id="122eb-245">Don't forget tooend hello previous line with a comma.</span></span>

    <span data-ttu-id="122eb-246">Только что внесенные hello `environment` приложения параметр манипулятор tooits соответствующих слот развернутого приложения для обоих приложений.</span><span class="sxs-lookup"><span data-stu-id="122eb-246">You have just made hello `environment` app setting stick tooits respective deployment slot for both apps.</span></span>  
5. <span data-ttu-id="122eb-247">В сеансе оболочки Git следующие hello выполнения команды с помощью hello же суффикс группы ресурсов, который использовался ранее.</span><span class="sxs-lookup"><span data-stu-id="122eb-247">In your Git Shell session, run hello following commands with hello same resource group suffix that you used before.</span></span>

        git checkout -b beta
        git push origin beta
        .\deploy.ps1 -RepoUrl https://github.com/<your_fork>/ToDoApp.git -ResourceGroupSuffix <your_suffix> -SlotName beta -Branch beta
6. <span data-ttu-id="122eb-248">При появлении запроса укажите hello же учетные данные базы данных SQL, как и раньше.</span><span class="sxs-lookup"><span data-stu-id="122eb-248">When prompted, specify hello same SQL database credentials as before.</span></span> <span data-ttu-id="122eb-249">Затем, ответ на вопрос о группе ресурсов hello tooupdate, тип `Y`, затем `ENTER`.</span><span class="sxs-lookup"><span data-stu-id="122eb-249">Then, when asked tooupdate hello resource group, type `Y`, then `ENTER`.</span></span>

    <span data-ttu-id="122eb-250">После завершения скрипта hello, сохраняются все ресурсы в группе ресурсов исходного hello, но новый слот с именем «бета» создания в ней с hello же конфигурацию, что и слот «Staging» hello, созданный в начале hello.</span><span class="sxs-lookup"><span data-stu-id="122eb-250">Once hello script finishes, all your resources in hello original resource group are retained, but a new slot named "beta" is created in it with hello same configuration as hello "Staging" slot that was created in hello beginning.</span></span>

   > [!NOTE]
   > <span data-ttu-id="122eb-251">Этот метод создания сред развертывания отличается от метода hello в [гибкой разработки программного обеспечения с помощью службы приложения Azure](app-service-agile-software-development.md).</span><span class="sxs-lookup"><span data-stu-id="122eb-251">This method of creating different deployment environments is different from hello method in [Agile software development with Azure App Service](app-service-agile-software-development.md).</span></span> <span data-ttu-id="122eb-252">Он предполагает создание сред развертывания со слотами развертывания — как если бы вы создавали среды развертывания с группами ресурсов.</span><span class="sxs-lookup"><span data-stu-id="122eb-252">Here, you create deployment environments with deployment slots, where as there you create deployment environments with resource groups.</span></span> <span data-ttu-id="122eb-253">Управление средами развертывания с группами ресурсов позволяет off-limits toodevelopers tookeep hello рабочей среды, но это не просто toodo тестирования в рабочей среде, в которой можно легко сделать с помощью слотов.</span><span class="sxs-lookup"><span data-stu-id="122eb-253">Managing deployment environments with resource groups enables you tookeep hello production environment off-limits toodevelopers, but it's not easy toodo testing in production, which you can do easily with slots.</span></span>
   >
   >

<span data-ttu-id="122eb-254">При желании вы можете создать альфа-версию приложения, запустив следующий код:</span><span class="sxs-lookup"><span data-stu-id="122eb-254">If you wish, you can also create an alpha app by running</span></span>

    git checkout -b alpha
    git push origin alpha
    .\deploy.ps1 -RepoUrl https://github.com/<your_fork>/ToDoApp.git -ResourceGroupSuffix <your_suffix> -SlotName beta -Branch alpha

<span data-ttu-id="122eb-255">Этот учебник предполагает использование бета-версии приложения.</span><span class="sxs-lookup"><span data-stu-id="122eb-255">For this tutorial, you will just keep using your beta app.</span></span>

## <a name="update-push-your-updates-toohello-beta-app"></a><span data-ttu-id="122eb-256">Обновление: Push toohello бета-версии обновления приложения</span><span class="sxs-lookup"><span data-stu-id="122eb-256">Update: Push your updates toohello beta app</span></span>
<span data-ttu-id="122eb-257">Назад tooyour приложения, которые должны tooimprove.</span><span class="sxs-lookup"><span data-stu-id="122eb-257">Back tooyour app that you want tooimprove.</span></span>

1. <span data-ttu-id="122eb-258">Убедитесь, что вы находитесь в ветке бета-версии.</span><span class="sxs-lookup"><span data-stu-id="122eb-258">Make sure you're now in your beta branch</span></span>

        git checkout beta
2. <span data-ttu-id="122eb-259">В  *&lt;repository_root >*\src\MultiChannelToDo.Web\app\Index.cshtml, найти hello `<li>` теги и добавить hello `style="cursor:pointer"` атрибута, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="122eb-259">In *&lt;repository_root>*\src\MultiChannelToDo.Web\app\Index.cshtml, find hello `<li>` tag and add hello `style="cursor:pointer"` attribute, as shown below.</span></span>

    ![](./media/app-service-web-test-in-production-controlled-test-flight/07-change-cursor-style-on-li.png)
3. <span data-ttu-id="122eb-260">Зафиксируйте и отправьте tooAzure.</span><span class="sxs-lookup"><span data-stu-id="122eb-260">commit and push tooAzure.</span></span>
4. <span data-ttu-id="122eb-261">Убедитесь, что изменение hello теперь отражается в слот hello бета-версии, перейдя по toohttp://todoapp*&lt;your_suffix >*-beta.azurewebsites.net/.</span><span class="sxs-lookup"><span data-stu-id="122eb-261">Verify that hello change is now reflected in hello beta slot by navigating toohttp://todoapp*&lt;your_suffix>*-beta.azurewebsites.net/.</span></span> <span data-ttu-id="122eb-262">Если вы не видите hello изменение еще не, обновите браузер tooget hello новый код javascript.</span><span class="sxs-lookup"><span data-stu-id="122eb-262">If you don't see hello change yet, refresh your browser tooget hello new javascript code.</span></span>

    ![](./media/app-service-web-test-in-production-controlled-test-flight/08-verify-change-in-beta-site.png)

<span data-ttu-id="122eb-263">Теперь, у вас есть изменения в слот hello бета-версии, все готово tooperform flighting развертывания.</span><span class="sxs-lookup"><span data-stu-id="122eb-263">Now that you have your change running in hello beta slot, you are ready tooperform a flighting deployment.</span></span>

## <a name="validate-route-traffic-toohello-beta-app"></a><span data-ttu-id="122eb-264">Проверка: Приложение бета-версии toohello маршрутизации трафика</span><span class="sxs-lookup"><span data-stu-id="122eb-264">Validate: Route traffic toohello beta app</span></span>
<span data-ttu-id="122eb-265">В этом разделе будет направлять трафик toohello бета-версии приложения.</span><span class="sxs-lookup"><span data-stu-id="122eb-265">In this section, you will route traffic toohello beta app.</span></span> <span data-ttu-id="122eb-266">Для ясности демонстрации ты tooroute значительную часть трафика tooit hello пользователя.</span><span class="sxs-lookup"><span data-stu-id="122eb-266">For sake of clarity of demonstration, you're going tooroute a significant portion of hello user traffic tooit.</span></span> <span data-ttu-id="122eb-267">На самом деле hello объем трафика, который вы хотите tooroute будет зависеть от конкретной ситуации.</span><span class="sxs-lookup"><span data-stu-id="122eb-267">In reality, hello amount of traffic you want tooroute will depend on your specific situation.</span></span> <span data-ttu-id="122eb-268">Например если веб-сайт будет в масштабе hello объекта microsoft.com, может потребоваться меньше 1% всего трафика в порядке toogain полезных данных.</span><span class="sxs-lookup"><span data-stu-id="122eb-268">For example, if your site is at hello scale of microsoft.com, then you may need less than one percent of your total traffic in order toogain useful data.</span></span>

1. <span data-ttu-id="122eb-269">В сеансе оболочки Git выполните следующие команды tooroute hello половины hello производственный трафика toohello бета-версии слот:</span><span class="sxs-lookup"><span data-stu-id="122eb-269">In your Git Shell session, run hello following commands tooroute half of hello production traffic toohello beta slot:</span></span>

        $siteName = "ToDoApp<your suffix>"
        $rule = New-Object Microsoft.WindowsAzure.Commands.Utilities.Websites.Services.WebEntities.RampUpRule
        $rule.ActionHostName = "$siteName-beta.azurewebsites.net"
        $rule.ReroutePercentage = 50
        $rule.Name = "beta"
        Set-AzureWebsite $siteName -Slot Production -RoutingRules $rule

   <span data-ttu-id="122eb-270">Hello `ReroutePercentage=50` свойство указывает, 50% от рабочего трафика hello URL-адреса перенаправленное toohello бета-версии приложения (определяемое hello `ActionHostName` свойство).</span><span class="sxs-lookup"><span data-stu-id="122eb-270">hello `ReroutePercentage=50` property specifies that 50% of hello production traffic will be routed toohello beta app's URL (specified by hello `ActionHostName` property).</span></span>
2. <span data-ttu-id="122eb-271">Теперь перейдите toohttp://ToDoApp*&lt;your_suffix >*. azurewebsites.net.</span><span class="sxs-lookup"><span data-stu-id="122eb-271">Now navigate toohttp://ToDoApp*&lt;your_suffix>*.azurewebsites.net.</span></span> <span data-ttu-id="122eb-272">50% от трафика hello, теперь будет слот перенаправленный toohello бета-версии.</span><span class="sxs-lookup"><span data-stu-id="122eb-272">50% of hello traffic should now be redirected toohello beta slot.</span></span>
3. <span data-ttu-id="122eb-273">В ресурс Application Insights, отфильтровать показатели hello средой = «бета».</span><span class="sxs-lookup"><span data-stu-id="122eb-273">In your Application Insights resource, filter hello metrics by environment="beta".</span></span>

   > [!NOTE]
   > <span data-ttu-id="122eb-274">При сохранении этого отфильтрованное представление другой список избранного, можно легко отразить представления обозревателя метрик hello между производства и бета-версии представления.</span><span class="sxs-lookup"><span data-stu-id="122eb-274">If you save this filtered view as another favorite, then you can easily flip hello metric explorer views between production and beta views.</span></span>
   >
   >

<span data-ttu-id="122eb-275">Предположим, что в Application Insights вы видите что-нибудь подобное toohello следующее:</span><span class="sxs-lookup"><span data-stu-id="122eb-275">Suppose in Application Insights you see something similar toohello following:</span></span>

![](./media/app-service-web-test-in-production-controlled-test-flight/09-test-beta-site-in-production.png)

<span data-ttu-id="122eb-276">Не является это отображаются только что существует множество дополнительных переходов по hello `<li>` теги, но похоже, что toobe Наплыв щелчков мыши на `<li>` тегов.</span><span class="sxs-lookup"><span data-stu-id="122eb-276">Not only is this showing that there are many more clicks on hello `<li>` tags, but there seems toobe a surge of clicks on `<li>` tags.</span></span> <span data-ttu-id="122eb-277">Затем можно заключить, что люди обнаружены новые hello `<li>` теги являются интерактивными и теперь очищаемой все их ранее выполненные задачи в приложение hello.</span><span class="sxs-lookup"><span data-stu-id="122eb-277">You can then conclude that people have discovered hello new `<li>` tags are clickable and are now clearing all their previously-completed tasks in hello app.</span></span>

<span data-ttu-id="122eb-278">На основании данных hello flighting развертывания вы решите, новый пользовательский Интерфейс будет готов для рабочей среды.</span><span class="sxs-lookup"><span data-stu-id="122eb-278">Based on hello data of your flighting deployment, you decide that your new UI is ready for production.</span></span>

## <a name="go-live-move-your-new-code-into-production"></a><span data-ttu-id="122eb-279">Ввод в эксплуатацию: перенос нового кода в рабочую среду</span><span class="sxs-lookup"><span data-stu-id="122eb-279">Go live: Move your new code into production</span></span>
<span data-ttu-id="122eb-280">Вы являетесь toomove теперь все готово к tooproduction обновления.</span><span class="sxs-lookup"><span data-stu-id="122eb-280">You're now ready toomove your update tooproduction.</span></span> <span data-ttu-id="122eb-281">Значительные является, теперь вы знаете, что обновление уже были проверены *перед* отправлена tooproduction.</span><span class="sxs-lookup"><span data-stu-id="122eb-281">What's great is that now you know that your update has already been validated *before* it is pushed tooproduction.</span></span> <span data-ttu-id="122eb-282">Теперь его можно с уверенностью развернуть.</span><span class="sxs-lookup"><span data-stu-id="122eb-282">So now you can confidently deploy it.</span></span> <span data-ttu-id="122eb-283">С момента внесения клиентского приложения AngularJS toohello обновления вы только проверить код на стороне клиента hello.</span><span class="sxs-lookup"><span data-stu-id="122eb-283">Since you made an update toohello AngularJS client app, you only validated hello client-side code.</span></span> <span data-ttu-id="122eb-284">Если toomake изменения toohello серверной части веб-API приложения, легко и точно так же можно проверить внесенные изменения.</span><span class="sxs-lookup"><span data-stu-id="122eb-284">If you were toomake changes toohello back-end Web API app, you could validate your changes similarly and easily.</span></span>

1. <span data-ttu-id="122eb-285">В оболочке Git удалите правило маршрутизации трафика hello, выполнив hello следующую команду:</span><span class="sxs-lookup"><span data-stu-id="122eb-285">In Git Shell, remove hello traffic routing rule by running hello following command:</span></span>

        Set-AzureWebsite $siteName -Slot Production -RoutingRules @()
2. <span data-ttu-id="122eb-286">Выполните команды Git hello.</span><span class="sxs-lookup"><span data-stu-id="122eb-286">Run hello Git commands:</span></span>

        git checkout master
        git pull origin master
        git merge beta
        git push origin master
3. <span data-ttu-id="122eb-287">Подождите, пока в течение нескольких минут hello новые закодировать промежуточных слотах toohello toobe развертывания, а затем запустите http://ToDoApp*&lt;your_suffix >*-активированию tooverify staging.azurewebsites.net, hello нового обновления в промежуточной hello разъем.</span><span class="sxs-lookup"><span data-stu-id="122eb-287">Wait for a few minutes for hello new code toobe deployed toohello staging slot, then launch http://ToDoApp*&lt;your_suffix>*-staging.azurewebsites.net tooverify that hello new update is warmed up in hello staging slot.</span></span> <span data-ttu-id="122eb-288">Помните, hello главную ветвь на разветвление является связанной toohello промежуточной области памяти приложения.</span><span class="sxs-lookup"><span data-stu-id="122eb-288">Remember that hello your fork's master branch is linked toohello staging slot of your app.</span></span>
4. <span data-ttu-id="122eb-289">Теперь замены hello промежуточного слота в рабочей среде</span><span class="sxs-lookup"><span data-stu-id="122eb-289">Now, swap hello staging slot into production</span></span>

        cd <ROOT>\ToDoApp\ARMTemplates
        .\swap.ps1 -Name todoapp<your_suffix>

## <a name="summary"></a><span data-ttu-id="122eb-290">Сводка</span><span class="sxs-lookup"><span data-stu-id="122eb-290">Summary</span></span>
<span data-ttu-id="122eb-291">Служба приложений Azure упрощает для предприятий малого размера toomedium tootest свои приложения с клиентом в рабочей среде, что-нибудь, традиционно выполнялась в больших организациях.</span><span class="sxs-lookup"><span data-stu-id="122eb-291">Azure App Service makes it easy for small- toomedium-sized businesses tootest their customer-facing apps in production, something that has been traditionally done in big enterprises.</span></span> <span data-ttu-id="122eb-292">Надеюсь, этого учебника вы получили hello знания, необходимые в вашей среде DevOps toobring вместе приложения службы и Application Insights toomake возможных проекте, которая должна развертывания и даже другие сценарии в тестовой.</span><span class="sxs-lookup"><span data-stu-id="122eb-292">Hopefully, this tutorial has given you hello knowledge you need toobring together App Service and Application Insights toomake possible flighting deployment, and even other test-in-production scenarios, in your DevOps world.</span></span>

## <a name="more-resources"></a><span data-ttu-id="122eb-293">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="122eb-293">More resources</span></span>
* [<span data-ttu-id="122eb-294">Гибкая разработка программного обеспечения с помощью службы приложений Azure.</span><span class="sxs-lookup"><span data-stu-id="122eb-294">Agile software development with Azure App Service</span></span>](app-service-agile-software-development.md)
* [<span data-ttu-id="122eb-295">Настройка промежуточных сред для веб-приложений в службе приложений Azure</span><span class="sxs-lookup"><span data-stu-id="122eb-295">Set up staging environments for web apps in Azure App Service</span></span>](web-sites-staged-publishing.md)
* [<span data-ttu-id="122eb-296">Предсказуемое развертывание сложного приложения в Azure</span><span class="sxs-lookup"><span data-stu-id="122eb-296">Deploy a complex application predictably in Azure</span></span>](app-service-deploy-complex-application-predictably.md)
* [<span data-ttu-id="122eb-297">Создание шаблонов диспетчера ресурсов Azure</span><span class="sxs-lookup"><span data-stu-id="122eb-297">Authoring Azure Resource Manager Templates</span></span>](../azure-resource-manager/resource-group-authoring-templates.md)
* [<span data-ttu-id="122eb-298">JSONLint - hello JSON проверяющий элемент управления</span><span class="sxs-lookup"><span data-stu-id="122eb-298">JSONLint - hello JSON Validator</span></span>](http://jsonlint.com/)
* [<span data-ttu-id="122eb-299">Ветвление Git — основные ветвления и слияния</span><span class="sxs-lookup"><span data-stu-id="122eb-299">Git Branching – Basic Branching and Merging</span></span>](http://www.git-scm.com/book/en/v2/Git-Branching-Basic-Branching-and-Merging)
* [<span data-ttu-id="122eb-300">Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="122eb-300">Azure PowerShell</span></span>](/powershell/azure/overview)
* [<span data-ttu-id="122eb-301">Вики-сайт проекта Kudu</span><span class="sxs-lookup"><span data-stu-id="122eb-301">Project Kudu Wiki</span></span>](https://github.com/projectkudu/kudu/wiki)
