---
title: "aaaEnable ведения журнала диагностики для веб-приложений в службе приложений Azure"
description: "Узнайте, как tooenable ведения журнала диагностики и добавить инструментарий tooyour приложения, а также как tooaccess hello сведений, регистрируемых в Azure."
services: app-service
documentationcenter: .net
author: cephalin
manager: erikre
editor: jimbe
ms.assetid: c9da27b2-47d4-4c33-a3cb-1819955ee43b
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/06/2016
ms.author: cephalin
ms.openlocfilehash: 4b2903ff31cc93180552cf51196c33505ffbaf07
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="enable-diagnostics-logging-for-web-apps-in-azure-app-service"></a>Включение ведения журнала диагностики для веб-приложений в службе приложений Azure
## <a name="overview"></a>Обзор
Azure предоставляет tooassist встроенных средств диагностики с отладкой [веб-приложения служб приложений](http://go.microsoft.com/fwlink/?LinkId=529714). В этой статье вы узнаете, как сбор данных диагностики tooenable и добавить инструментарий tooyour приложения, а также как tooaccess hello сведений, регистрируемых в Azure.

В этой статье используется hello [портала Azure](https://portal.azure.com), Azure PowerShell и toowork hello Azure командной строки (CLI Azure) с журналы диагностики. Дополнительные сведения о работе с журналами диагностики с использованием Visual Studio см. в статье [Устранение неполадок Azure в Visual Studio](web-sites-dotnet-troubleshoot-visual-studio.md).

[!INCLUDE [app-service-web-to-api-and-mobile](../../includes/app-service-web-to-api-and-mobile.md)]

## <a name="whatisdiag"></a>Диагностика веб-сервера и приложений
Веб-приложения служб приложений предоставляют диагностических функций для записи в журнал из hello веб-сервер и веб-приложения hello. Используется следующее логическое разделение: **диагностика веб-сервера** и **диагностика приложений**.

### <a name="web-server-diagnostics"></a>Диагностика веб-сервера
Можно включить или отключить hello следующие виды журналы:

* **Подробное ведение журнала ошибок** — регистрация подробной информации об ошибке для кодов состояния HTTP, которые указывают на сбой (код состояния 400 и выше). Это может содержать сведения, которые могут помочь определить, почему hello сервер вернул код ошибки hello.
* **Не удалось выполнить запрос трассировки** -подробные сведения о невыполненных запросов, включая трассировки запрос hello tooprocess компоненты, используемые IIS hello и hello время, затраченное в каждом компоненте. Это может быть полезно, если пытаетесь tooincrease производительность сайта или выявить причину вернул конкретных toobe ошибки HTTP.
* **Ведение журналов сервера веб-** -сведения о HTTP-транзакций с помощью hello [расширенного формата файла журнала W3C](http://msdn.microsoft.com/library/windows/desktop/aa814385.aspx). Это полезно при определении общей сайта метрик, таких как количество hello запросы обрабатываются или сколько запросы отправляются определенный IP-адрес.

### <a name="application-diagnostics"></a>диагностика приложений
Диагностика приложений позволяет toocapture данные, созданные веб-приложением. Приложения ASP.NET могут использовать hello [System.Diagnostics.Trace](http://msdn.microsoft.com/library/36hhw2t6.aspx) консоли диагностики приложений toohello класса toolog сведения журнала. Например:

    System.Diagnostics.Trace.TraceError("If you're seeing this, something bad happened");

Во время выполнения можно получить эти журналы toohelp по устранению неполадок. Дополнительную информацию см. в разделе [Устранение неполадок веб-приложений Azure в Visual Studio](web-sites-dotnet-troubleshoot-visual-studio.md).

Службы приложений веб-приложения также вести журнал развертывания при публикации содержимого tooa веб-приложения. Это происходит автоматически, а параметры конфигурации для ведения журнала развертывания отсутствуют. Ведение журнала развертывания позволяет toodetermine, почему не удалось выполнить развертывание. Например при использовании сценария развертывания можно использовать toodetermine ведения журнала развертывания, почему происходит сбой сценария hello.

## <a name="enablediag"></a>Как tooenable диагностики
Диагностика tooenable hello [портала Azure](https://portal.azure.com)откройте колонку toohello веб-приложения и щелкните **параметры > журналы диагностики**.

<!-- todo:cleanup dogfood addresses in screenshot -->
![Часть журналов](./media/web-sites-enable-diagnostic-log/logspart.png)

При включении **диагностики приложений** выборе hello **уровень**. Этот параметр позволяет toofilter hello информации, слишком**Информационное**, **предупреждение** или **ошибка** сведения. Установка этого параметра слишком**verbose** регистрируют все данные, созданные приложением hello.

> [!NOTE]
> В отличие от изменения hello web.config файл, включение диагностики приложения или изменение уровней диагностического журнала не перезапускает домена приложения hello, поддерживаемом приложения hello.
>
>

В hello [классический портал](https://manage.windowsazure.com) веб-приложения **Настройка** вкладку, можно выбрать **хранения** или **файловая система** для **веб-сервера Ведение журнала**. При выборе **хранения** позволяет tooselect учетной записи хранилища, а затем контейнер больших двоичных объектов, который будут записаны журналы hello. Все журналы для **Диагностика сайта** записываются toohello файловой системы.

Hello [классический портал](https://manage.windowsazure.com) веб-приложения **Настройка** вкладка также содержит дополнительные параметры для диагностики приложений:

* **Файловая система** -магазины hello приложения toohello сведения диагностики веб-системы файл приложения. Эти файлы можно доступ по протоколу FTP или скачать в виде ZIP-архив с помощью hello Azure PowerShell или интерфейса командной строки Azure (Azure CLI).
* **Хранилище таблиц** -магазины hello приложения диагностической информации в hello указанной учетной записи хранилища Azure и имя таблицы.
* **Хранилище больших двоичных объектов** -магазины hello приложения диагностической информации в hello указанной учетной записи хранилища Azure и BLOB-контейнере.
* **Срок хранения** — по умолчанию журналы из **хранилища BLOB-объектов** не удаляются автоматически. Выберите **задать политику хранения** и введите количество дней, tookeep журналы при желании tooautomatically удалить журналы в hello.

> [!NOTE]
> Если вы [заново создать ключи доступа учетной записи хранения](../storage/common/storage-create-storage-account.md), необходимо сбросить hello соответствующие ключи ведения журнала конфигурации toouse hello обновлены. toodo это:
>
> 1. В hello **Настройка** установите функции hello соответствующих ведения журнала слишком**Off**. Сохраните вашу настройку.
> 2. Снова включите BLOB-объекта учетной записи хранилища toohello ведения журнала или таблицы. Сохраните вашу настройку.
>
>

Любое сочетание файловую систему, хранилище таблиц или хранилище больших двоичных объектов может быть включена в hello же времени и имеют отдельный журнал уровня конфигурации. Например вы можете toolog ошибки и предупреждения tooblob хранилища долговременное ведения журнала при включении ведения журналов файловой системы с уровнем подробных сведений.

Все три места хранения предоставляют hello же основную информацию о событиях, **хранилище таблиц** и **хранилище больших двоичных объектов** входа Дополнительные сведения, такие как идентификатор экземпляра hello, идентификатор потока и более детальные отметка времени (формат тактов) чем ведения журнала слишком**файловая система**.

> [!NOTE]
> Доступ к сведениям, хранящимся в **хранилищах таблиц** или **хранилищах BLOB-объектов**, можно получить только с помощью клиента хранилища или приложения, которое может напрямую работать с этими системами хранения данных. Например обозреватель хранилища, который может быть таблиц или BLOB-хранилище используется tooexplore содержит Visual Studio 2013 и HDInsight можно доступ к данным в хранилище больших двоичных объектов. Можно также написать приложение, которое обращается к службе хранилища Azure с помощью одного из hello [пакеты SDK Azure](/downloads/#).
>
> [!NOTE]
> Также диагностику можно включить с помощью hello Azure PowerShell **AzureWebsite набор** командлета. Если Azure PowerShell не установлена или не настроена toouse подписки Azure в разделе [как tooUse Azure PowerShell](/develop/nodejs/how-to-guides/powershell-cmdlets/).
>
>

## <a name="download"></a> Практическое руководство. Загрузка журналов
Диагностические сведения, которые хранятся toohello веб-приложения файл системы может осуществляться непосредственно с помощью протокола FTP. Кроме того, ее можно загрузить как ZIP-архив с помощью Azure PowerShell или интерфейса командной строки Azure hello.

Структура каталогов Hello, hello журналы хранятся в выглядит следующим образом:

* **Журналы приложений** — /LogFiles/Application/. Эта папка содержит один или несколько текстовых файлов со сведениями, созданными при ведении журнала приложения.
* **Трассировка невыполненных запросов** — /LogFiles/W3SVC#########/. Эта папка содержит XSL-файл и один или несколько XML-файлов. Убедитесь, необходимо загрузить hello XSL-файл в один каталог с XML-файлов, так как hello XSL-файл предоставляет функциональные возможности для форматирования и фильтрации содержимого hello hello XML приветствия файлов при просмотре в Internet Explorer hello.
* **Подробные журналы ошибок** — /LogFiles/DetailedErrors/. Эта папка содержит один или несколько HTM-файлов с подробными сведениями обо всех произошедших ошибках HTTP.
* **Журналы веб-сервера** — /LogFiles/http/RawLogs. Эта папка содержит один или несколько текстовых файлов, отформатированном hello [расширенного формата файла журнала W3C](http://msdn.microsoft.com/library/windows/desktop/aa814385.aspx).
* **Журналы развертывания** — /LogFiles/Git. Эта папка содержит журналы, формируемые службой процессов развертывания внутренней hello, используемых веб-приложениях Azure, а также в журналах развертывания Git.

### <a name="ftp"></a>FTP
tooaccess диагностические сведения с помощью FTP, посещение hello **мониторинга** веб-приложения в hello [классический портал](https://manage.windowsazure.com). В hello **беглого** используйте hello **журналы диагностики FTP** связать файлы журнала hello tooaccess по протоколу FTP. Hello **пользователя развертывания и FTP** запись содержит hello имя пользователя, который должен быть сайт используется tooaccess hello FTP.

> [!NOTE]
> Если hello **пользователя развертывания и FTP** входа не задано, или вы забыли пароль hello для этого пользователя, можно создать нового пользователя и пароль с помощью hello **сбросить учетные данные развертывания** ссылку в hello **беглого** раздел hello **мониторинга**.
>
>

### <a name="download-with-azure-powershell"></a>Загрузка с использованием Azure PowerShell
файлы журнала toodownload hello, запустите новый экземпляр Azure PowerShell и использовать hello следующую команду:

    Save-AzureWebSiteLog -Name webappname

Будут сохранены hello журналов для веб-приложения hello, определяемое hello **-имя** файл tooa параметр с именем **logs.zip** в текущем каталоге hello.

> [!NOTE]
> Если Azure PowerShell не установлена или не настроена toouse подписки Azure в разделе [как tooUse Azure PowerShell](/develop/nodejs/how-to-guides/powershell-cmdlets/).
>
>

### <a name="download-with-azure-command-line-interface"></a>Скачивание с использованием интерфейса командной строки Azure
файлы журналов hello toodownload, с помощью интерфейса командной строки Azure hello откройте новое окно командной строки, PowerShell, Bash или сеанс терминала и введите hello следующую команду:

    azure site log download webappname

Это избавляет hello журналы для hello веб-приложения с именем «webappname» tooa файл с именем **diagnostics.zip** в текущем каталоге hello.

> [!NOTE]
> Если вы не установили hello Azure командной строки (CLI Azure) или еще не настроили отладку toouse подписки Azure в разделе [как tooUse Azure CLI](../cli-install-nodejs.md).
>
>

## <a name="how-to-view-logs-in-application-insights"></a>Практическое руководство. Просмотр журналов в Application Insights
Visual Studio Application Insights предоставляет средства для фильтрации и поиска журналов, а также для корреляции с запросами и другими событиями журналы hello.

1. Добавьте проект tooyour hello пакет SDK Application Insights в Visual Studio.
   * В обозревателе решений щелкните проект правой кнопкой мыши и выберите пункт "Добавить Application Insights". Откроется мастер, состоящий из нескольких шагов, в том числе шаг создания ресурса Application Insights. [Дополнительные сведения](../application-insights/app-insights-asp-net.md)
2. Добавьте проект tooyour пакета прослушиватель трассировки hello.
   * Щелкните правой кнопкой мыши проект и выберите "Управление пакетами NuGet". Выберите `Microsoft.ApplicationInsights.TraceListener` [Подробнее](../application-insights/app-insights-asp-net-trace-logs.md)
3. Загрузите проект и выполнить его toogenerate данные журнала.
4. В hello [портала Azure](https://portal.azure.com/)tooyour новый ресурс Application Insights найдите и откройте **поиска**. Вы увидите данные журнала, а также запросы, сведения об использовании и другую телеметрию. Некоторые данные телеметрии может занять несколько минут tooarrive: щелкните "Обновить". [Дополнительные сведения](../application-insights/app-insights-diagnostic-search.md)

[Дополнительные сведения об отслеживании производительности с помощью Application Insights](../application-insights/app-insights-azure-web-apps.md)

## <a name="streamlogs"></a> Практическое руководство. Потоковая передача журналов
При разработке приложения, часто бывает полезно toosee данные протоколирования в практически в режиме реального времени. Это можно сделать при потоковой передаче ведения журнала сведения tooyour разработки среды с помощью Azure PowerShell или интерфейса командной строки Azure hello.

> [!NOTE]
> Некоторые типы буфера журнала записать файл журнала toohello, что может привести к неупорядоченные события в потоке hello. Например запись в журнале приложений, возникающее при посещении страницы могут отображаться в поток hello перед соответствующей записи журнала HTTP hello для запроса страницы приветствия.
>
> [!NOTE]
> Потоковая передача журналов также записывать данные, записанные tooany текстового файла, который хранится в hello **D:\\домашней\\LogFiles\\**  папки.
>
>

### <a name="streaming-with-azure-powershell"></a>Потоковая передача с использованием Azure PowerShell
информацию журнала toostream, запустите новый экземпляр Azure PowerShell и использовать hello следующую команду:

    Get-AzureWebSiteLog -Name webappname -Tail

При этом осуществляется подключение toohello веб-приложение, определяемое hello **-имя** параметра с последующим потоковой передачи окно PowerShell toohello сведения на веб-приложения hello возникновения событий журнала. Любые данные, записанные toofiles заканчиваются txt, .log или htm, которые хранятся в каталоге /LogFiles hello (d:/home/logfiles) будет выполняться потоковая передача toohello локальной консоли.

toofilter событиями, например ошибки, используйте hello **-сообщение** параметра. Например:

    Get-AzureWebSiteLog -Name webappname -Tail -Message Error

toofilter определенном журнале типов, таких как HTTP, используйте hello **-путь** параметра. Например:

    Get-AzureWebSiteLog -Name webappname -Tail -Path http

toosee список доступных путей, использовать параметр - ListPath hello.

> [!NOTE]
> Если Azure PowerShell не установлена или не настроена toouse подписки Azure в разделе [как tooUse Azure PowerShell](/develop/nodejs/how-to-guides/powershell-cmdlets/).
>
>

### <a name="streaming-with-azure-command-line-interface"></a>Потоковая передача с использованием интерфейса командной строки Azure
toostream информацию журнала, откройте новое окно командной строки, PowerShell, Bash или сеанс терминала и введите hello следующую команду:

    azure site log tail webappname

Это подключение toohello веб-приложения с именем «webappname» и начать потоковой передачи окна toohello сведения при возникновении события журнала на веб-приложения hello. Любые данные, записанные toofiles заканчиваются txt, .log или htm, которые хранятся в каталоге /LogFiles hello (d:/home/logfiles) будет выполняться потоковая передача toohello локальной консоли.

toofilter событиями, например ошибки, используйте hello **--фильтра** параметра. Например:

    azure site log tail webappname --filter Error

toofilter определенном журнале типов, таких как HTTP, используйте hello **--путь** параметра. Например:

    azure site log tail webappname --path http

> [!NOTE]
> Если вы не установили hello интерфейса командной строки Azure или еще не настроили отладку toouse подписки Azure в разделе [как tooUse интерфейса командной строки Azure](../cli-install-nodejs.md).
>
>

## <a name="understandlogs"></a> Практическое руководство. Интерпретация журналов диагностики
### <a name="application-diagnostics-logs"></a>Журналы диагностики приложений
Диагностика приложений хранятся в определенном формате для приложений .NET, в зависимости от того, можно хранить журналы toohello файловой системы, хранилище таблиц или хранилище BLOB-объектов. Hello базового набора данных, хранящихся — hello одинаково для всех трех типов хранения — произошло событие hello hello даты и времени, идентификатор процесса hello, создавший событие hello, тип события hello (сведения, предупреждение, ошибка) и сообщение о событии hello.

**Файловая система**

Каждая строка в журнале toohello файловой системы, или получены с помощью потоковой передачи будут иметь hello следующий формат:

    {Date}  PID[{process id}] {event type/level} {message}

Например событие ошибки будет выглядеть аналогично toohello следующее:

    2014-01-30T16:36:59  PID[3096] Error       Fatal error on hello page!

Ведение журнала toohello файловой системы hello наиболее общая информация hello три доступных методов, предоставляя только время hello, идентификатор процесса, уровень события и сообщения.

**Хранилище таблиц**

При входе tootable хранилища, дополнительные свойства, используемые toofacilitate поиск hello данные, хранящиеся в таблице hello, а также детальные сведения о событии hello. Hello используются следующие свойства (столбцы) для каждой сущности (строка), хранящиеся в таблице hello.

| Имя свойства | Значение/формат |
| --- | --- |
| PartitionKey |Дата и время события hello в формате Ггггммддчч |
| RowKey |Значение GUID, которое уникальным образом идентифицирует этот объект |
| Timestamp |Hello Дата и время, которое hello событий |
| EventTickCount |Hello дату и время hello событие произошло, в формат тактов (точность) |
| ApplicationName |Имя веб-приложения Hello |
| Уровень |Уровень события (например, ошибка, предупреждение, информация) |
| EventId |Идентификатор события Hello этого события<p><p>Если значение не указано, по умолчанию используется too0 |
| InstanceId |Экземпляр веб-приложения hello, даже hello произошла в |
| Pid |ИД процесса |
| Tid |Идентификатор Hello hello потока, которое вызвало событие hello |
| Сообщение |Сообщение с подробными сведениями о событии |

**Хранилище BLOB-объектов**

При входе tooblob хранения, данные хранятся в формате с разделителями-запятыми (CSV). Аналогичные tootable хранилища, дополнительные поля, выполнившего tooprovide более подробные сведения о событии hello. Hello используются следующие свойства для каждой строки в hello CSV:

| Имя свойства | Значение/формат |
| --- | --- |
| Дата |Hello Дата и время, которое hello событий |
| Уровень |Уровень события (например, ошибка, предупреждение, информация) |
| ApplicationName |Имя веб-приложения Hello |
| InstanceId |Экземпляр веб-приложения hello, hello событие произошло на |
| EventTickCount |Hello дату и время hello событие произошло, в формат тактов (точность) |
| EventId |Идентификатор события Hello этого события<p><p>Если значение не указано, по умолчанию используется too0 |
| Pid |ИД процесса |
| Tid |Идентификатор Hello hello потока, которое вызвало событие hello |
| Сообщение |Сообщение с подробными сведениями о событии |

Hello данные, хранящиеся в большой двоичный объект будет выглядеть аналогично toohello следующее:

    date,level,applicationName,instanceId,eventTickCount,eventId,pid,tid,message
    2014-01-30T16:36:52,Error,mywebapp,6ee38a,635266966128818593,0,3096,9,An error occurred

> [!NOTE]
> Первая строка Hello hello журнала будет содержать заголовки столбцов hello, представленные в этом примере.
>
>

### <a name="failed-request-traces"></a>Трассировка невыполненных запросов
Трассировки неудачно завершенных запросов хранятся в XML-файлах с именами **fr######.xml**. toomake его проще tooview hello в журнал сведения, с именем таблицы стилей XSL **freb.xsl** предоставляется в hello же каталог как hello XML-файлов. Открыть один из hello XML-файлов в Internet Explorer будет использовать tooprovide таблицы стилей XSL hello форматированный вывод данных трассировки hello. Это имя появится примерно следующее toohello:

![для просмотра в обозревателе hello невыполненных запросов](./media/web-sites-enable-diagnostic-log/tws-failedrequestinbrowser.png)

### <a name="detailed-error-logs"></a>Подробные журналы ошибок
Подробные журналы ошибок представляют собой документы HTML, в которых содержатся более подробные сведения о возникших ошибках HTTP. Поскольку они являются простыми HTML-документами, их можно просматривать с помощью веб-браузера.

### <a name="web-server-logs"></a>Журналы веб-сервера
Hello журналы веб-сервера могут быть форматированы hello [расширенного формата файла журнала W3C](http://msdn.microsoft.com/library/windows/desktop/aa814385.aspx). Эти данные могут быть прочитаны с помощью текстового редактора, либо можно провести их синтаксический анализ с помощью служебных программ, таких как [Log Parser](http://go.microsoft.com/fwlink/?LinkId=246619)

> [!NOTE]
> Hello журналы, созданные веб-приложениях Azure не поддерживают hello **s-computername**, **s-ip**, или **cs-version** поля.
>
>

## <a name="nextsteps"></a> Дальнейшие действия
* [Как tooMonitor веб-приложений](http://docs.microsoft.com/en-us/azure/app-service-web/web-sites-monitor)
* [Устранение неполадок веб-приложений Azure в Visual Studio](web-sites-dotnet-troubleshoot-visual-studio.md)
* [Анализ журналов веб-приложения в HDInsight](http://gallery.technet.microsoft.com/scriptcenter/Analyses-Windows-Azure-web-0b27d413)

> [!NOTE]
> Tooget работы в службе приложений Azure перед регистрацией учетную запись Azure, перейдите слишком[повторите служб приложений](https://azure.microsoft.com/try/app-service/), в котором можно немедленно создать кратковременных начальный веб-приложения в службе приложений. Никаких кредитных карт и обязательств.
>
>

## <a name="whats-changed"></a>Изменения
* Toohello руководство изменений из tooApp веб-сайтов службы. в разделе: [службе приложений Azure и ее влияние на существующие службы Azure](http://go.microsoft.com/fwlink/?LinkId=529714)
* Toohello руководства в разделе Изменение hello старого портала toohello новый портал: [ссылки для навигации по hello портал Azure](http://go.microsoft.com/fwlink/?LinkId=529715)
