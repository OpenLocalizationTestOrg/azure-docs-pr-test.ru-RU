---
title: "Введение в тестирование веб-приложений в рабочей среде"
description: "Дополнительные сведения о тестировании веб-приложений службы приложений Azure в рабочей среде."
services: app-service\web
documentationcenter: 
author: cephalin
manager: erikre
editor: 
ms.assetid: 4623468d-886e-4203-8012-8f86deb2790b
ms.service: app-service-web
ms.workload: web
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/13/2016
ms.author: cephalin
ms.openlocfilehash: 9f38b635140cacf0513c75385bce3c110a930969
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="get-started-with-test-in-production-for-web-apps"></a><span data-ttu-id="26a45-103">Введение в тестирование веб-приложений в рабочей среде</span><span class="sxs-lookup"><span data-stu-id="26a45-103">Get started with test in production for Web Apps</span></span>
<span data-ttu-id="26a45-104">Тестирование в рабочей среде или тестирование веб-приложения с использованием текущего пользовательского трафика является популярной стратегией тестирования, которую разработчики приложений широко интегрируют в методологию [гибкой разработки](https://en.wikipedia.org/wiki/Agile_software_development).</span><span class="sxs-lookup"><span data-stu-id="26a45-104">Testing in production, or live-testing your web app using live customer traffic, is a test strategy that app developers increasingly integrate into their [agile development](https://en.wikipedia.org/wiki/Agile_software_development) methodology.</span></span> <span data-ttu-id="26a45-105">Эта стратегия позволяет выполнять проверку качества приложений с использованием текущего пользовательского трафика в рабочей среде — в отличие от использования синтезированных данных в тестовой среде.</span><span class="sxs-lookup"><span data-stu-id="26a45-105">It enables you to test the quality of your apps with live user traffic in your production environment, as opposed to synthesized data in a test environment.</span></span> <span data-ttu-id="26a45-106">Предоставляя новое приложение реальным пользователям, вы можете получать сведения о реальных проблемах, которые могут возникнуть после развертывания приложения.</span><span class="sxs-lookup"><span data-stu-id="26a45-106">By exposing your new app to real users, you can be informed on the real problems your app may face once it is deployed.</span></span> <span data-ttu-id="26a45-107">Вы можете проверить функциональность, производительность и объем обновлений на основе данных об объеме, скорости и отличиях в показателях текущего пользовательского трафика. Иными словами, выполнить то, что не позволяет сделать тестовая среда.</span><span class="sxs-lookup"><span data-stu-id="26a45-107">You can verify the functionality, performance, and value of your app updates against the volume, velocity, and variety of real user traffic, which you can never approximate in a test environment.</span></span>

## <a name="traffic-routing-in-app-service-web-apps"></a><span data-ttu-id="26a45-108">Маршрутизация трафика в веб-приложениях службы приложений</span><span class="sxs-lookup"><span data-stu-id="26a45-108">Traffic Routing in App Service Web Apps</span></span>
<span data-ttu-id="26a45-109">С помощью функции маршрутизации трафика [службы приложений Azure](http://go.microsoft.com/fwlink/?LinkId=529714) вы можете перенаправить часть реального пользовательского трафика в один или несколько [слотов развертывания](web-sites-staged-publishing.md), а затем проанализировать приложения с помощью [Azure Application Insights](/services/application-insights/) или [Azure HDInsight](/services/hdinsight/), или средства сторонних производителей, например [New Relic](/marketplace/partners/newrelic/newrelic/), чтобы проверить внесенные изменения.</span><span class="sxs-lookup"><span data-stu-id="26a45-109">With the Traffic Routing feature in [Azure App Service](http://go.microsoft.com/fwlink/?LinkId=529714), you can direct a portion of live user traffic to one or more [deployment slots](web-sites-staged-publishing.md), and then analyze your app with [Azure Application Insights](/services/application-insights/) or [Azure HDInsight](/services/hdinsight/), or a third-party tool like [New Relic](/marketplace/partners/newrelic/newrelic/) to validate your change.</span></span> <span data-ttu-id="26a45-110">Например, вы можете реализовать следующие сценарии со службой приложений.</span><span class="sxs-lookup"><span data-stu-id="26a45-110">For example, you can implement the following scenarios with App Service:</span></span>

* <span data-ttu-id="26a45-111">Обнаружение функциональных ошибок или выявление ограничивающих факторов производительности в обновлениях перед развертыванием компонентов на уровне сайта.</span><span class="sxs-lookup"><span data-stu-id="26a45-111">Discover functional bugs or pinpoint performance bottlenecks in your updates prior to site-wide deployment</span></span>
* <span data-ttu-id="26a45-112">Выполнение управляемого фокус-тестирования изменений путем измерения метрик удобства использования в бета-версии приложения.</span><span class="sxs-lookup"><span data-stu-id="26a45-112">Perform "controlled test flights" of your changes by measuring usability metrics on the beta app</span></span>
* <span data-ttu-id="26a45-113">Постепенное разворачивание нового обновления и корректный откат к текущей версии при возникновении ошибок.</span><span class="sxs-lookup"><span data-stu-id="26a45-113">Gradually ramp up to a new update, and gracefully back down to the current version if an error occurs</span></span> 
* <span data-ttu-id="26a45-114">Оптимизация результатов бизнес-приложения путем выполнения [альфа- и бета-тестирования](https://en.wikipedia.org/wiki/A/B_testing) или [многовариантного тестирования](https://en.wikipedia.org/wiki/Multivariate_testing_in_marketing) в нескольких слотах развертывания.</span><span class="sxs-lookup"><span data-stu-id="26a45-114">Optimize your app's business results by running [A/B tests](https://en.wikipedia.org/wiki/A/B_testing) or [multivariate tests](https://en.wikipedia.org/wiki/Multivariate_testing_in_marketing) in multiple deployment slots</span></span>

### <a name="requirements-for-using-traffic-routing-in-web-apps"></a><span data-ttu-id="26a45-115">Требования для использования маршрутизации трафика в веб-приложениях</span><span class="sxs-lookup"><span data-stu-id="26a45-115">Requirements for using Traffic Routing in Web Apps</span></span>
* <span data-ttu-id="26a45-116">Веб-приложение должно выполняться в категории **Стандартный** или **Премиум**, так как это требуется для нескольких слотов развертывания.</span><span class="sxs-lookup"><span data-stu-id="26a45-116">Your web app must run in **Standard** or **Premium** tier, as it is required for multiple deployment slots.</span></span>
* <span data-ttu-id="26a45-117">Для правильной маршрутизации трафика в браузере пользователей должны быть включены файлы cookie.</span><span class="sxs-lookup"><span data-stu-id="26a45-117">In order to work properly, Traffic Routing requires cookies to be enabled in the users' browser.</span></span> <span data-ttu-id="26a45-118">Маршрутизация трафика использует файлы cookie, чтобы привязать клиентский браузер к слоту развертывания на время клиентского сеанса.</span><span class="sxs-lookup"><span data-stu-id="26a45-118">Traffic Routing uses cookies to pin a client browser to a deployment slot for the life the client session.</span></span>
* <span data-ttu-id="26a45-119">Маршрутизация трафика поддерживает расширенные сценарии тестирования в рабочей среде с использованием командлетов Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="26a45-119">Traffic Routing supports advanced TiP scenarios through Azure PowerShell cmdlets.</span></span>

## <a name="route-traffic-segment-to-a-deployment-slot"></a><span data-ttu-id="26a45-120">Маршрутизация сегмента трафика в слот развертывания</span><span class="sxs-lookup"><span data-stu-id="26a45-120">Route traffic segment to a deployment slot</span></span>
<span data-ttu-id="26a45-121">На базовом уровне каждый сценарий тестирования в рабочей среде предполагает маршрутизацию предопределенного процента текущего трафика в нерабочий слот развертывания.</span><span class="sxs-lookup"><span data-stu-id="26a45-121">At the basic level in every TiP scenario, you route a predefined percentage of your live traffic to a non-production deployment slot.</span></span> <span data-ttu-id="26a45-122">Для этого сделайте следующее.</span><span class="sxs-lookup"><span data-stu-id="26a45-122">To do this, follow the steps below:</span></span>

> [!NOTE]
> <span data-ttu-id="26a45-123">В этих инструкциях предполагается, что у вас уже есть [нерабочая область развертывания](web-sites-staged-publishing.md), а также что нужное содержимое уже [развернуто](web-sites-deploy.md) в веб-приложении.</span><span class="sxs-lookup"><span data-stu-id="26a45-123">The steps here assumes that you already have a [non-production deployment slot](web-sites-staged-publishing.md) and that the desired web app content is already [deployed](web-sites-deploy.md) to it.</span></span>
> 
> 

1. <span data-ttu-id="26a45-124">Войдите на [портал Azure](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="26a45-124">Log into the [Azure Portal](https://portal.azure.com/).</span></span>
2. <span data-ttu-id="26a45-125">В колонке веб-приложения щелкните **Параметры** > **Маршрутизация трафика**.</span><span class="sxs-lookup"><span data-stu-id="26a45-125">In your web app's blade, click **Settings** > **Traffic Routing**.</span></span>
   ![](./media/app-service-web-test-in-production/01-traffic-routing.png)
3. <span data-ttu-id="26a45-126">Выберите слот для перенаправления трафика и укажите требуемый процент от общего трафика, а затем нажмите кнопку **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="26a45-126">Select the slot that you want to route traffic to and the percentage of the total traffic you desire, then click **Save**.</span></span>
   
    ![](./media/app-service-web-test-in-production/02-select-slot.png)
4. <span data-ttu-id="26a45-127">Перейдите в колонку слота развертывания</span><span class="sxs-lookup"><span data-stu-id="26a45-127">Go to the deployment slot's blade.</span></span> <span data-ttu-id="26a45-128">и вы увидите, что текущий трафик перенаправляется в него.</span><span class="sxs-lookup"><span data-stu-id="26a45-128">You should now see live traffic being routed to it.</span></span>
   
    ![](./media/app-service-web-test-in-production/03-traffic-routed.png)

<span data-ttu-id="26a45-129">После настройки маршрутизации трафика указанный процент клиентов будет случайным образом перенаправляться в нерабочий слот.</span><span class="sxs-lookup"><span data-stu-id="26a45-129">Once Traffic Routing is configured, the specified percentage of clients will be randomly routed to your non-production slot.</span></span> <span data-ttu-id="26a45-130">При этом следует отметить, что автоматическая маршрутизация клиента в конкретный слот означает его привязку к этому слоту в течение данного клиентского сеанса.</span><span class="sxs-lookup"><span data-stu-id="26a45-130">However, it is important to note that once a client is automatically routed to a specific slot, it will be "pinned" to that slot for the life of that client session.</span></span> <span data-ttu-id="26a45-131">Это реализуется с помощью файлов cookie.</span><span class="sxs-lookup"><span data-stu-id="26a45-131">This done using a cookie to pin the user session.</span></span> <span data-ttu-id="26a45-132">При проверке HTTP-запросов вы обнаружите файл cookie `TipMix` в каждом последующем запросе.</span><span class="sxs-lookup"><span data-stu-id="26a45-132">If you inspect the HTTP requests, you will find a `TipMix` cookie in every subsequent request.</span></span>

![](./media/app-service-web-test-in-production/04-tip-cookie.png)

## <a name="force-client-requests-to-a-specific-slot"></a><span data-ttu-id="26a45-133">Принудительная отправка клиентских запросов в конкретный слот</span><span class="sxs-lookup"><span data-stu-id="26a45-133">Force client requests to a specific slot</span></span>
<span data-ttu-id="26a45-134">Кроме автоматизации маршрутизации трафика служба приложений может перенаправлять запросы в конкретные слоты.</span><span class="sxs-lookup"><span data-stu-id="26a45-134">In addition to automatic traffic routing, App Service is able to route requests to a specific slot.</span></span> <span data-ttu-id="26a45-135">Это полезно, если вы хотите предоставить пользователям возможность согласиться или отказаться от использования бета-версии приложения.</span><span class="sxs-lookup"><span data-stu-id="26a45-135">This is useful when you want your users to be able to opt-into or opt-out of your beta app.</span></span> <span data-ttu-id="26a45-136">Это можно сделать с помощью параметра запросов `x-ms-routing-name` .</span><span class="sxs-lookup"><span data-stu-id="26a45-136">To do this, you use the `x-ms-routing-name` query parameter.</span></span>

<span data-ttu-id="26a45-137">Чтобы перенаправить пользователей в конкретный слот с помощью `x-ms-routing-name`, проверьте, добавлен ли этот слот в список маршрутизации трафика.</span><span class="sxs-lookup"><span data-stu-id="26a45-137">To reroute users to a specific slot using `x-ms-routing-name`, you must make sure that the slot is already added to the Traffic Routing list.</span></span> <span data-ttu-id="26a45-138">Так как вам требуется явная маршрутизация в слот, фактический процент маршрутизации, который вы укажете, не имеет значения.</span><span class="sxs-lookup"><span data-stu-id="26a45-138">Since you want to route to a slot explicitly, the actual routing percentage you set doesn't matter.</span></span> <span data-ttu-id="26a45-139">При необходимости можно создать бета-версию ссылки, которую пользователь сможет использовать для доступа к бета-версии приложения.</span><span class="sxs-lookup"><span data-stu-id="26a45-139">If you want, you can craft a "beta link" that users can click to access the beta app.</span></span>

![](./media/app-service-web-test-in-production/06-enable-x-ms-routing-name.png)

### <a name="opt-users-out-of-beta-app"></a><span data-ttu-id="26a45-140">Отказ пользователей от использования бета-версии приложения</span><span class="sxs-lookup"><span data-stu-id="26a45-140">Opt users out of beta app</span></span>
<span data-ttu-id="26a45-141">Чтобы пользователи могли отказаться от использования бета-версии приложения, можно поместить эту ссылку на своей веб-странице:</span><span class="sxs-lookup"><span data-stu-id="26a45-141">To let users opt out of your beta app, for example, you can put this link in your web page:</span></span>

    <a href="<webappname>.azurewebsites.net/?x-ms-routing-name=self">Go back to production app</a>

<span data-ttu-id="26a45-142">Строка `x-ms-routing-name=self` определяет рабочий слот.</span><span class="sxs-lookup"><span data-stu-id="26a45-142">The string `x-ms-routing-name=self` specifies the production slot.</span></span> <span data-ttu-id="26a45-143">Когда браузер клиента получает доступ к ссылке, он не только перенаправляется в рабочий слот. Каждый последующий запрос будет содержать файл cookie `x-ms-routing-name=self`, который связывает данный сеанс с рабочим слотом.</span><span class="sxs-lookup"><span data-stu-id="26a45-143">Once the client browser access the link, not only is it redirected to the production slot, but every subsequent request will contain the `x-ms-routing-name=self` cookie that pins the session to the production slot.</span></span>

![](./media/app-service-web-test-in-production/05-access-production-slot.png)

### <a name="opt-users-in-to-beta-app"></a><span data-ttu-id="26a45-144">Согласие пользователей на использование бета-версии приложения</span><span class="sxs-lookup"><span data-stu-id="26a45-144">Opt users in to beta app</span></span>
<span data-ttu-id="26a45-145">Чтобы пользователи могли согласиться использовать бета-версию приложения, укажите для имени нерабочей области один параметр запроса, например:</span><span class="sxs-lookup"><span data-stu-id="26a45-145">To let users opt in to your beta app, set the same query parameter to the name of the non-production slot, for example:</span></span>

        <webappname>.azurewebsites.net/?x-ms-routing-name=staging

## <a name="more-resources"></a><span data-ttu-id="26a45-146">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="26a45-146">More resources</span></span>
* [<span data-ttu-id="26a45-147">Настройка промежуточных сред для веб-приложений в службе приложений Azure</span><span class="sxs-lookup"><span data-stu-id="26a45-147">Set up staging environments for web apps in Azure App Service</span></span>](web-sites-staged-publishing.md)
* [<span data-ttu-id="26a45-148">Предсказуемое развертывание сложного приложения в Azure</span><span class="sxs-lookup"><span data-stu-id="26a45-148">Deploy a complex application predictably in Azure</span></span>](app-service-deploy-complex-application-predictably.md)
* [<span data-ttu-id="26a45-149">Гибкая разработка программного обеспечения с помощью службы приложений Azure.</span><span class="sxs-lookup"><span data-stu-id="26a45-149">Agile software development with Azure App Service</span></span>](app-service-agile-software-development.md)
* [<span data-ttu-id="26a45-150">Эффективное использование сред разработки и операций для веб-приложений</span><span class="sxs-lookup"><span data-stu-id="26a45-150">Use DevOps environments effectively for your web apps</span></span>](app-service-web-staged-publishing-realworld-scenarios.md)

