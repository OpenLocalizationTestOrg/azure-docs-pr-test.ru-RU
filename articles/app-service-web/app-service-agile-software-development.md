---
title: "Гибкая разработка программного обеспечения с помощью службы приложений Azure."
description: "Сведения о создании крупномасштабных сложных приложений с помощью приложений Azure и гибкой разработки программного обеспечения."
services: app-service
documentationcenter: 
author: cephalin
manager: erikre
editor: 
ms.assetid: c0fdb676-36a6-4738-925f-65b4835d187f
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/01/2016
ms.author: cephalin
ms.openlocfilehash: 5ed888cbb422766cf2094f5980dfd1c599bd431c
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2017
---
# <a name="agile-software-development-with-azure-app-service"></a>Гибкая разработка программного обеспечения с помощью службы приложений Azure.
Из этого учебника вы узнаете, как создавать крупномасштабные сложные приложения с помощью [службы приложений Azure](/azure/app-service/) и [гибкой разработки программного обеспечения](https://en.wikipedia.org/wiki/Agile_software_development). Предполагается, что вы уже знаете, как [предсказуемо развертывать сложные приложения в Azure](app-service-deploy-complex-application-predictably.md).

Ограничения в технических процессах часто могут препятствовать успешной реализации гибких методологий. Служба приложений Azure с такими компонентами, как [непрерывная публикация](app-service-continuous-deployment.md), [промежуточные среды](web-sites-staged-publishing.md) (слоты) и [мониторинг](web-sites-monitor.md) в сочетании с оркестрацией развертывания и управлением им в [Azure Resource Manager](../azure-resource-manager/resource-group-overview.md), может входить в состав идеального решения для разработчиков, которые используют гибкую разработку программного обеспечения.

Следующая таблица содержит краткий список требований, связанных с гибкой разработкой, и способы включения каждого из них в службах Azure.

| Требование | Как Azure включает его |
| --- | --- |
| - Сборка после каждой фиксации<br>- Автоматическая и быстрая сборка |При настройке с непрерывным развертыванием служба приложений Azure может работать как динамические сборки с учетом ветви разработки. Каждый раз, когда код отправляется в ветвь, автоматически выполняется его сборка и динамический запуск в Azure. |
| - Самопроверка сборок |Загрузка тестов, веб-тесты и т. д., которые могут развертываться с помощью шаблона диспетчера ресурсов Azure. |
| - Выполнение тестов в клоне рабочей среды |Шаблоны диспетчера ресурсов Azure можно использовать для создания клонов рабочей среды Azure (включая параметры приложения, шаблоны строк подключения, масштабирование и т. д.) для быстрого и предсказуемого тестирования. |
| - Удобный просмотр результата последней сборки |Непрерывное развертывание в Azure из репозитория означает, что новый код можно протестировать в динамическом приложении в режиме реального времени сразу после фиксации изменений. |
| - Ежедневная фиксация в главной ветви<br>-Автоматическое развертывание |Непрерывная интеграция рабочего приложения с главной ветвью репозитория автоматически развертывает каждую фиксацию/слияние в главную ветвь рабочей среды. |

[!INCLUDE [app-service-web-to-api-and-mobile](../../includes/app-service-web-to-api-and-mobile.md)]

## <a name="what-you-will-do"></a>Выполняемая задача
Здесь пошагово описывается типичный рабочий процесс (разработка, тестирование, промежуточное хранение и производство) публикации новых изменений в примере приложения [ToDoApp](https://github.com/azure-appservice-samples/ToDoApp), которое состоит из двух [веб-приложений](/services/app-service/web/). Первое является внешним интерфейсом, а второе — серверной частью веб-API и [базой данных SQL](/services/sql-database/). Вы будете работать со следующей архитектурой развертывания.

![](./media/app-service-agile-software-development/what-1-architecture.png)

Расшифровка рисунка:

* Архитектура развертывания разделена на три отдельные среды (или [группы ресурсов](../azure-resource-manager/resource-group-overview.md)в Azure), у каждой из которой есть собственные [план службы приложений](../app-service/azure-web-sites-web-hosting-plans-in-depth-overview.md), настройки [масштабирования](web-sites-scale.md) и база данных SQL. 
* Каждой средой можно управлять отдельно. Они даже могут находиться в разных подписках.
* Промежуточная и рабочая среды реализуются как два слота одной и той же службы приложений. Главная ветвь настроена для непрерывной интеграции с промежуточным слотом.
* После проверки изменения в главной ветви в промежуточном слоте (с рабочими данными), проверенное промежуточное приложение пересылается в рабочий слот [без простоя](web-sites-staged-publishing.md).

Рабочая и промежуточная среды определяются шаблоном в файле [*&lt;repository_root>*/ARMTemplates/ProdandStage.json](https://github.com/azure-appservice-samples/ToDoApp/blob/master/ARMTemplates/ProdAndStage.json).

Среда разработки и среда тестирования определяются шаблоном в файле [*&lt;repository_root>*/ARMTemplates/Dev.json](https://github.com/azure-appservice-samples/ToDoApp/blob/master/ARMTemplates/Dev.json).

Вы будет использовать обычную стратегию ветвления, перемещая код из ветви разработки в ветвь тестирования, а затем — в главную ветвь (перемещая по мере повышения качества кода).

![](./media/app-service-agile-software-development/what-2-branches.png) 

## <a name="what-you-need"></a>Необходимые элементы
* Учетная запись Azure.
* Учетная запись [GitHub](https://github.com/) .
* Оболочка Git Shell (устанавливается вместе с [GitHub для Windows](https://windows.github.com/)) — позволяет запускать команды PowerShell и Git в рамках одного сеанса. 
* Последняя версия [Azure PowerShell](https://docs.microsoft.com/en-us/powershell/azure/install-azurerm-ps) .
* Базовые знания следующих инструментов:
  * Развертывание шаблона [Azure Resource Manager](../azure-resource-manager/resource-group-overview.md) (см. также [Предсказуемое развертывание сложного приложения в Azure](app-service-deploy-complex-application-predictably.md)).
  * [Git.](http://git-scm.com/documentation)
  * [PowerShell](https://technet.microsoft.com/library/bb978526.aspx)

> [!NOTE]
> Для работы с этим учебником требуется учетная запись Azure.
> 
> * Вы можете [открыть учетную запись Azure бесплатно](https://azure.microsoft.com/pricing/free-trial/) — вы получаете кредиты, которые можно использовать для опробования платных служб Azure, и даже после израсходования кредитов вы сохраняете учетную запись и возможность использовать бесплатные службы Azure, такие как веб-приложения.
> * Вы можете [активировать преимущества подписчика Visual Studio](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) — каждый месяц ваша подписка Visual Studio предоставляет вам кредиты, которые можно использовать для оплаты служб Azure.
> 
> Чтобы приступить к работе со службой приложений Azure до создания учетной записи Azure, перейдите к разделу [Пробное использование службы приложений](https://azure.microsoft.com/try/app-service/), где вы можете быстро создать кратковременное веб-приложение начального уровня в службе приложений. Никаких кредитных карт и обязательств.
> 
> 

## <a name="set-up-your-production-environment"></a>Настройка рабочей среды
> [!NOTE]
> Сценарий, используемый в этом учебнике, автоматически настраивает непрерывную публикацию из репозитория GitHub. Для этого необходимо, чтобы учетные данные GitHub уже хранились в Azure. Иначе при попытке настроить параметры системы управления версиями для веб-приложений произойдет сбой развертывания, заложенного в сценарий. 
> 
> Чтобы сохранить учетные данные GitHub в Azure, создайте веб-приложение на [портале Azure](https://portal.azure.com/) и [настройте развертывание GitHub](app-service-continuous-deployment.md). Это нужно сделать только один раз. 
> 
> 

В типичном сценарии DevOps у вас есть приложение, которое работает в Azure, и вам нужно внести в него изменения с помощью непрерывной публикации. В этом сценарии у вас есть шаблон, который вы разработали, протестировали и использовали для развертывания в рабочей среде. Он будет настроен в этом разделе.

1. Создайте разветвление в репозитории [ToDoApp](https://github.com/azure-appservice-samples/ToDoApp). Дополнительные сведения о создании разветвления см. в статье [Fork a Repo](https://help.github.com/articles/fork-a-repo/) (Разветвление репозитория). После создания разветвления его можно просматривать в браузере.
   
    ![](./media/app-service-agile-software-development/production-1-private-repo.png)
2. Откройте сеанс Git Shell. Если у вас нет Git Shell, установите [GitHub для Windows](https://windows.github.com/) .
3. Создайте локальный клон разветвления, выполнив следующую команду:

        git clone https://github.com/<your_fork>/ToDoApp.git 
4. После создания локального клона перейдите в каталог *&lt;repository_root>*\ARMTemplates и запустите скрипт deploy.ps1 следующим образом:
   
        .\deploy.ps1 –RepoUrl https://github.com/<your_fork>/todoapp.git
5. При появлении запроса введите желаемое имя пользователя и пароль для доступа к базе данных.
   
   Вы увидите ход подготовки различных ресурсов Azure. После завершения развертывания скрипт запустит приложение в браузере и сообщит вам об этом с помощью звукового сигнала.
   
    ![](./media/app-service-agile-software-development/production-2-app-in-browser.png)
   
   > [!TIP]
   > Узнайте, как сценарий *&lt;repository_root>*\ARMTemplates\Deploy.ps1 создает ресурсы с уникальными идентификаторами. Тот же подход можно использовать для создания клонов одного и того же развертывания, не беспокоясь о конфликтующих именах ресурсов.
   > 
   > 
6. Вернитесь в сеанс Git Shell и выполните следующую команду:
   
        .\swap –Name ToDoApp<unique_string>master
   
    ![](./media/app-service-agile-software-development/production-4-swap.png)
7. После выполнения скрипта вернитесь назад и перейдите по адресу внешнего интерфейса (http://ToDoApp*&lt;unique_string>*master.azurewebsites.net/), чтобы посмотреть на работу приложения в рабочей среде.
8. Войдите на [портал Azure](https://portal.azure.com/) и посмотрите на результаты.
   
   Вы увидите два веб-приложения в одной группе ресурсов. Имя одного из них будет содержать суффикс `Api`. Если вы посмотрите на представление группы ресурсов, вы также увидите базу данных SQL и сервер, план службы приложений и промежуточные слоты для веб-приложений. Просмотрите различные ресурсы и сравните их с файлом *&lt;repository_root>*\ARMTemplates\ProdAndStage.json, чтобы узнать, как они настроены в шаблоне.
   
    ![](./media/app-service-agile-software-development/production-3-resource-group-view.png)

Вы настроили рабочую среду. Теперь приступим к новому обновлению приложения.

## <a name="create-dev-and-test-branches"></a>Создание ветвей разработки и тестирования
Теперь, когда сложные приложения запущены в рабочей среде Azure, вы можете выполнить обновление приложения в соответствии с гибкой методологией. В этом разделе вы создадите ветви разработки и тестирования, которые необходимы для внесения необходимых обновлений.

1. Сначала создайте тестовую среду. В сеансе Git Shell выполните следующие команды, чтобы создать среду для новой ветви с именем **NewUpdate**. 
   
        git checkout -b NewUpdate
        git push origin NewUpdate 
        .\deploy.ps1 -TemplateFile .\Dev.json -RepoUrl https://github.com/<your_fork>/ToDoApp.git -Branch NewUpdate
2. При появлении запроса введите желаемое имя пользователя и пароль для доступа к базе данных. 
   
   После завершения развертывания скрипт запустит приложение в браузере и сообщит вам об этом с помощью звукового сигнала. Теперь у вас есть новая ветвь с собственной тестовой средой. Уделите минуту, чтобы ознакомиться с некоторыми особенностями этой тестовой среды.
   
   * Вы можете создать ее в любой подписке Azure. Это означает, что рабочей средой можно управлять отдельно от тестовой среды.
   * Тестовая среда работает в Azure в режиме реального времени.
   * Тестовая среда идентична рабочей среде, они отличаются только промежуточными слотами и параметрами масштабирования. Вы поймете это, так как это единственные отличия между ProdandStage.json и Dev.json.
   * Вы можете управлять тестовой средой в ее собственном плане службы приложений с другой ценовой категорией (например, **Free**).
   * Удалить эту тестовую среду также просто, как удалить группу ресурсов. [Позже](#delete)вы узнаете, как это сделать.
3. Перейдите к созданию ветви разработки, выполнив следующие команды:
   
        git checkout -b Dev
        git push origin Dev
        .\deploy.ps1 -TemplateFile .\Dev.json -RepoUrl https://github.com/<your_fork>/ToDoApp.git -Branch Dev
4. При появлении запроса введите желаемое имя пользователя и пароль для доступа к базе данных. 
   
   Уделите минуту, чтобы ознакомиться с некоторыми особенностями этой среды разработки. 
   
   * Среда разработки имеет такую же конфигурацию, как и тестовая среда, так как она развертывается с помощью того же шаблона.
   * Каждую среду разработки можно создавать в собственной подписке Azure разработчика, при этом тестовой средой можно управлять отдельно.
   * Среда разработки работает в Azure в режиме реального времени.
   * Удалить тестовую среду разработки также просто, как удалить группу ресурсов. [Позже](#delete)вы узнаете, как это сделать.

> [!NOTE]
> Если несколько разработчиков работают над новым обновлением, каждый из них может легко создать ветвь и выделенную среду разработки, выполнив следующие действия.
> 
> 1. Создайте собственное разветвление репозитория в GitHub (см. статью [Fork a Repo](https://help.github.com/articles/fork-a-repo/) (Разветвление репозитория).
> 2. Клонируйте разветвление на своем локальном компьютере.
> 3. Запустите те же команды, чтобы создать собственную ветвь и среду разработки.
> 
> 

Когда все будет готово, ваше ветвление GitHub будет содержать три ветви:

![](./media/app-service-agile-software-development/test-1-github-view.png)

И у вас будет шесть веб-приложений (три набора по два) в трех отдельных группах ресурсов:

![](./media/app-service-agile-software-development/test-2-all-webapps.png)

> [!NOTE]
> Файл ProdandStage.json задает для рабочей среды ценовую категорию **Стандартный**, которая уместна для масштабируемости рабочего приложения.
> 
> 

## <a name="build-and-test-every-commit"></a>Добавление в сборку и тестирование каждой фиксации
В файлах шаблонов ProdAndStage.json и Dev.json уже указан источник параметров управления, который по умолчанию настраивает непрерывную публикацию для веб-приложения. Таким образом, каждая фиксация в ветви GitHub запускает автоматическое развертывание из этой ветви в Azure. Давайте посмотрим, как работает ваша система.

1. Зайдите в ветвь разработки локального репозитория. Чтобы сделать это, выполните следующую команду в оболочке Git Shell:
   
        git checkout Dev
2. Внесите изменение на уровне пользовательского интерфейса приложения, прописав в коде использование списков [начальной загрузки](http://getbootstrap.com/components/). Откройте файл *&lt;repository_root>*\src\MultiChannelToDo.Web\index.cshtml и внесите следующее выделенное цветом изменение.
   
    ![](./media/app-service-agile-software-development/commit-1-changes.png)
   
    > [!NOTE]
    > Если вы не можете прочитать код на предыдущем изображении, внесите указанные ниже изменения. 
    > 
    > * В строке 18 измените `check-list` на `list-group`.
    > * В строке 19 измените `class="check-list-item"` на `class="list-group-item"`.
    > 
    > 
3. Сохраните изменения. Вернитесь в Git Shell и выполните следующие команды:
   
        cd <repository_root>
        git add .
        git commit -m "changed to bootstrap style"
        git push origin Dev
   
   Эти команды Git аналогичны команде "загрузка кода" в другой системе управления версиями, например TFS. Когда вы выполняете команду `git push`, новое изменение запускает автоматическую отправку кода в Azure, а затем перестраивает приложение в соответствии с изменениями в среде разработки.
4. Чтобы убедиться, что этот код отправлен в среду разработки, перейдите на страницу веб-приложения в среде разработки и просмотрите раздел **Развертывание**. Вы должны увидеть такое сообщение о последнем изменении.
   
    ![](./media/app-service-agile-software-development/commit-2-deployed.png)
5. Затем нажмите кнопку **Обзор** , чтобы увидеть новое изменение в динамическом приложении в Azure.
   
    ![](./media/app-service-agile-software-development/commit-3-webapp-in-browser.png)
   
   Это незначительное изменение в приложении. Но иногда новые изменения в сложных веб-приложениях имеют непредвиденные и нежелательные побочные эффекты. Возможность легко тестировать каждую фиксацию в динамических сборках позволяет обнаружить эти проблемы, прежде чем их увидят ваши клиенты.

На данный момент вы уже знаете, что вы, как разработчик проекта **NewUpdate**, можете создавать среду разработки для себя, а затем вносить изменения и тестировать сборки.

## <a name="merge-code-into-test-environment"></a>Слияние кода в тестовой среде
Когда вы будете готовы отправить код из ветви разработки в ветвь NewUpdate, воспользуйтесь стандартной процедурой git.

1. Объедините все новые фиксации для NewUpdate в ветви разработки GitHub, например фиксации, созданные другими разработчиками. Любая новая фиксация в GitHub активирует отправку кода и создание сборки в среде разработки. Затем вы можете убедиться, что код в ветви разработки по-прежнему работает с последними обновлениями из ветви NewUpdate.
2. Объедините все новые изменения из ветви разработки в ветви NewUpdate на GitHub. Это действие активирует отправку кода и создание сборки в тестовой среде. 

Еще раз обратите внимание, что непрерывное развертывание уже настроено в этих ветвях git и вам не нужно предпринимать никаких действий, например выполнять интегрированные сборки. Вам нужно следовать стандартным рекомендациям управления источником с помощью git, и Azure выполнит все процессы сборки за вас.

Теперь отправим код в ветвь **NewUpdate** . В Git Shell выполните следующие команды:

    git checkout NewUpdate
    git pull origin NewUpdate
    git merge Dev
    git push origin NewUpdate

Это все! 

Перейдите на страницу веб-приложения для тестовой среды, чтобы увидеть новую фиксацию (объединенную с ветвью NewUpdate), отправленную в тестовую среду. Нажмите кнопку **Обзор** , чтобы увидеть изменения стиля в динамическом приложении Azure.

## <a name="deploy-update-to-production"></a>Развертывание обновления в рабочей среде
Отправка кода в промежуточную и рабочую среды не должна отличаться от процедуры отправки кода в среду тестирования. Это действительно просто. 

В Git Shell выполните следующие команды:

    git checkout master
    git pull origin master
    git merge NewUpdate
    git push origin master

Следует помнить, что в соответствии с настройкой промежуточной и рабочей среды в файле ProdandStage.json новый код отправляется в **промежуточный** слот и выполняется в нем. Поэтому при переходе на URL-адрес промежуточного слота вы увидите, что в нем выполняется новый код. Чтобы сделать это, выполните следующий командлет в оболочке Git Shell.

    Start-Process -FilePath "http://ToDoApp<unique_string>master-Staging.azurewebsites.net"

Теперь после проверки обновления в промежуточном слоте нам остается только передать его в рабочую среду. Просто выполните следующие команды в Git Shell:

    cd <repository_root>\ARMTemplates
    .\swap.ps1 -Name ToDoApp<unique_string>master

Поздравляем! Вы успешно опубликовали новое обновление в рабочем веб-приложении. Для этого вы просто создали среды разработки и тестирования и выполнили сборку и тестирование каждой фиксации. Эти процессы являются ключевыми элементами для гибкой разработки программного обеспечения.

<a name="delete"></a>

## <a name="delete-dev-and-test-environments"></a>Удаление сред разработки и тестирования
Так как ваши среды разработки и тестирования специально спроектированы в виде самодостаточных групп ресурсов, их легко удалить. Чтобы удалить среды, созданные под руководством этого учебника, то есть ветви GitHub и артефакты Azure, просто выполните следующие команды в Git Shell:

    git branch -d Dev
    git push origin :Dev
    git branch -d NewUpdate
    git push origin :NewUpdate
    Remove-AzureRmResourceGroup -Name ToDoApp<unique_string>dev-group -Force -Verbose
    Remove-AzureRmResourceGroup -Name ToDoApp<unique_string>newupdate-group -Force -Verbose

## <a name="summary"></a>Сводка
Гибкая разработка программного обеспечения является обязательной для многих компаний, которые хотят использовать Azure в качестве платформы для приложений. Из этого учебника вы узнали, как без усилий создавать и удалять точные или приблизительные реплики рабочей среды, в том числе для сложных приложений. Вы также узнали, как использовать эту возможность для создания процесса разработки, который умеет добавлять в сборку и тестировать каждую фиксацию в Azure. Надеюсь, вы узнали из этого учебника, как лучше всего использовать службы приложений Azure и диспетчер ресурсов Azure для создания решения DevOps, предназначенного для гибкой методологии. Теперь можно выполнить построение этого сценария, выполнив дополнительные методы DevOps, такие как [тестирование в производственной среде](app-service-web-test-in-production-get-start.md). Распространенный сценарий тестирования в производственной среде см. в статье [Развертывание в режиме фокус-тестирования (бета-тестирование) в службе приложений Azure](app-service-web-test-in-production-controlled-test-flight.md).

## <a name="more-resources"></a>Дополнительные ресурсы
* [Предсказуемое развертывание сложного приложения в Azure](app-service-deploy-complex-application-predictably.md)
* [Практика гибкой разработки: советы и рекомендации для модернизированного цикла разработки](http://channel9.msdn.com/Events/Ignite/2015/BRK3707)
* [Стратегии расширенного развертывания для веб-приложений Azure с помощью шаблонов диспетчера ресурсов](http://channel9.msdn.com/Events/Build/2015/2-620)
* [Создание шаблонов диспетчера ресурсов Azure](../azure-resource-manager/resource-group-authoring-templates.md)
* [JSONLint — проверяющий элемент управления JSON](http://jsonlint.com/)
* [ARMClient — настройка публикации GitHub на веб-сайте](https://github.com/projectKudu/ARMClient/wiki/Setup-GitHub-publishing-to-Site)
* [Ветвление Git — основные ветвления и слияния](http://www.git-scm.com/book/en/v2/Git-Branching-Basic-Branching-and-Merging)
* [Блог Дэвида Эббо (David Ebbo)](http://blog.davidebbo.com/)
* [Azure PowerShell](/powershell/azure/overview)
* [Кроссплатформенные программы командной строки Azure.](../cli-install-nodejs.md)
* [Создание и изменение пользователей в Azure AD](https://msdn.microsoft.com/library/azure/hh967632.aspx#BKMK_1)
* [Вики-сайт проекта Kudu](https://github.com/projectkudu/kudu/wiki)

