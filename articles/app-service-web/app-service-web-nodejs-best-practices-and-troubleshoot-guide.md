---
title: "Рекомендации и руководство по устранению неполадок приложений Node в веб-приложениях Azure"
description: "Узнайте рекомендации и способы устранения неполадок приложений Node в веб-приложениях Azure."
services: app-service\web
documentationcenter: nodejs
author: ranjithr
manager: wadeh
editor: 
ms.assetid: 387ea217-7910-4468-8987-9a1022a99bef
ms.service: app-service-web
ms.workload: web
ms.tgt_pltfrm: na
ms.devlang: nodejs
ms.topic: article
ms.date: 06/06/2016
ms.author: ranjithr
ms.openlocfilehash: d820ef3438e13332657641b06b57fa277e79f811
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="best-practices-and-troubleshooting-guide-for-node-applications-on-azure-web-apps"></a><span data-ttu-id="9cae6-103">Рекомендации и руководство по устранению неполадок приложений Node в веб-приложениях Azure</span><span class="sxs-lookup"><span data-stu-id="9cae6-103">Best practices and troubleshooting guide for node applications on Azure Web Apps</span></span>
[!INCLUDE [tabs](../../includes/app-service-web-get-started-nav-tabs.md)]

<span data-ttu-id="9cae6-104">В этой статье описываются рекомендации и способы устранения неполадок [приложений Node](app-service-web-get-started-nodejs.md), запущенных в веб-приложениях Azure (с помощью [iisnode](https://github.com/azure/iisnode)).</span><span class="sxs-lookup"><span data-stu-id="9cae6-104">In this article, you will learn the best practices and troubleshooting steps for [node applications](app-service-web-get-started-nodejs.md) running on Azure Webapps (with [iisnode](https://github.com/azure/iisnode)).</span></span>

> [!WARNING]
> <span data-ttu-id="9cae6-105">Будьте осторожны при выполнении действий по устранению неполадок на рабочем сайте.</span><span class="sxs-lookup"><span data-stu-id="9cae6-105">Use caution when using troubleshooting steps on your production site.</span></span> <span data-ttu-id="9cae6-106">Действия по устранению неполадок приложения рекомендуется выполнять на нерабочем сайте. Например, настройте там промежуточный слот, а когда проблема будет решена, замените промежуточный слот на рабочий.</span><span class="sxs-lookup"><span data-stu-id="9cae6-106">Recommendation is to troubleshoot your app on a non-production setup for example your staging slot and when the issue is fixed, swap your staging slot with your production slot.</span></span>
> 
> 

## <a name="iisnode-configuration"></a><span data-ttu-id="9cae6-107">Конфигурация IISNODE</span><span class="sxs-lookup"><span data-stu-id="9cae6-107">IISNODE configuration</span></span>
<span data-ttu-id="9cae6-108">В этом [файле схемы](https://github.com/Azure/iisnode/blob/master/src/config/iisnode_schema_x64.xml) показаны все параметры, которые можно настроить для iisnode.</span><span class="sxs-lookup"><span data-stu-id="9cae6-108">This [schema file](https://github.com/Azure/iisnode/blob/master/src/config/iisnode_schema_x64.xml) shows all the settings that can be configured for iisnode.</span></span> <span data-ttu-id="9cae6-109">Ниже приведены параметры, которые будут полезны для вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="9cae6-109">Some of the settings that will be useful for your application are:</span></span>

* <span data-ttu-id="9cae6-110">nodeProcessCountPerApplication</span><span class="sxs-lookup"><span data-stu-id="9cae6-110">nodeProcessCountPerApplication</span></span>
  
    <span data-ttu-id="9cae6-111">Этот параметр определяет количество процессов Node, запущенных в одном приложении IIS.</span><span class="sxs-lookup"><span data-stu-id="9cae6-111">This setting controls the number of node processes that are launched per IIS application.</span></span> <span data-ttu-id="9cae6-112">Значение по умолчанию — 1.</span><span class="sxs-lookup"><span data-stu-id="9cae6-112">Default value is 1.</span></span> <span data-ttu-id="9cae6-113">Задав для него значение 0, можно запустить количество файлов node.exe, равное количеству ядер виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="9cae6-113">You can launch as many node.exe’s as your VM core count by setting this to 0.</span></span> <span data-ttu-id="9cae6-114">Для большинства приложений рекомендуемое значение — 0. Это позволяет использовать все ядра виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="9cae6-114">Recommended value is 0 for most application so you can utilize all of the cores on your machine.</span></span> <span data-ttu-id="9cae6-115">Файл node.exe является однопоточным. Это значит, что для запуска одного файла node.exe требуется 1 ядро, а чтобы обеспечить максимальную производительность приложения Node, необходимо использовать все ядра.</span><span class="sxs-lookup"><span data-stu-id="9cae6-115">Node.exe is single threaded so one node.exe will consume a maximum of 1 core and to get maximum performance out of your node application you would want to utilize all cores.</span></span>
* <span data-ttu-id="9cae6-116">nodeProcessCommandLine</span><span class="sxs-lookup"><span data-stu-id="9cae6-116">nodeProcessCommandLine</span></span>
  
    <span data-ttu-id="9cae6-117">Этот параметр определяет путь к файлу node.exe.</span><span class="sxs-lookup"><span data-stu-id="9cae6-117">This setting controls the path to the node.exe.</span></span> <span data-ttu-id="9cae6-118">Это значение можно задать таким образом, чтобы оно указывало версию файла node.exe.</span><span class="sxs-lookup"><span data-stu-id="9cae6-118">You can set this value to point to your node.exe version.</span></span>
* <span data-ttu-id="9cae6-119">maxConcurrentRequestsPerProcess</span><span class="sxs-lookup"><span data-stu-id="9cae6-119">maxConcurrentRequestsPerProcess</span></span>
  
    <span data-ttu-id="9cae6-120">Этот параметр определяет максимальное количество одновременных запросов, отправленных с помощью iisnode в каждый файл node.exe.</span><span class="sxs-lookup"><span data-stu-id="9cae6-120">This setting controls the maximum number of concurrent requests sent by iisnode to each node.exe.</span></span> <span data-ttu-id="9cae6-121">В веб-приложениях Azure для этого параметра по умолчанию используется значение Infinite.</span><span class="sxs-lookup"><span data-stu-id="9cae6-121">On azure webapps, the default value for this is Infinite.</span></span> <span data-ttu-id="9cae6-122">Об этом параметре не нужно беспокоиться.</span><span class="sxs-lookup"><span data-stu-id="9cae6-122">You will not have to worry about this setting.</span></span> <span data-ttu-id="9cae6-123">В веб-приложениях за пределами Azure значение по умолчанию равно 1024.</span><span class="sxs-lookup"><span data-stu-id="9cae6-123">Outside azure webapps, the default value is 1024.</span></span> <span data-ttu-id="9cae6-124">В зависимости от количества отправленных в приложение запросов и скорости их обработки, возможно, понадобится настроить это значение.</span><span class="sxs-lookup"><span data-stu-id="9cae6-124">You might want to configure this depending on how many requests your application gets and how fast your application processes each request.</span></span>
* <span data-ttu-id="9cae6-125">maxNamedPipeConnectionRetry</span><span class="sxs-lookup"><span data-stu-id="9cae6-125">maxNamedPipeConnectionRetry</span></span>
  
    <span data-ttu-id="9cae6-126">Этот параметр определяет максимальное количество повторных подключений с помощью iisnode к именованному каналу для отправки запроса в файл node.exe.</span><span class="sxs-lookup"><span data-stu-id="9cae6-126">This setting controls the maximum number of times iisnode will retry making connection on the named pipe to send the request over to node.exe.</span></span> <span data-ttu-id="9cae6-127">В сочетании с параметром namedPipeConnectionRetryDelay он определяет общее значение времени ожидания каждого запроса в iisnode.</span><span class="sxs-lookup"><span data-stu-id="9cae6-127">This setting in combination with namedPipeConnectionRetryDelay determines the total timeout of each request within iisnode.</span></span> <span data-ttu-id="9cae6-128">В веб-приложениях Azure для этого параметра по умолчанию задано значение 200.</span><span class="sxs-lookup"><span data-stu-id="9cae6-128">Default value is 200 on Azure Webapps.</span></span> <span data-ttu-id="9cae6-129">Общее время ожидания в секундах равно произведению maxNamedPipeConnectionRetry \*на namedPipeConnectionRetryDelay, разделенному на 1000.</span><span class="sxs-lookup"><span data-stu-id="9cae6-129">Total Timeout in seconds = (maxNamedPipeConnectionRetry \* namedPipeConnectionRetryDelay) / 1000</span></span>
* <span data-ttu-id="9cae6-130">namedPipeConnectionRetryDelay</span><span class="sxs-lookup"><span data-stu-id="9cae6-130">namedPipeConnectionRetryDelay</span></span>
  
    <span data-ttu-id="9cae6-131">Этот параметр определяет интервал (в мс), с которым iisnode будет отправлять повторные запросы в файл node.exe через именованный канал.</span><span class="sxs-lookup"><span data-stu-id="9cae6-131">This setting controls the amount of time (in ms) iisnode will wait for between each retry to send request to node.exe over the named pipe.</span></span> <span data-ttu-id="9cae6-132">Значение по умолчанию — 250 мс.</span><span class="sxs-lookup"><span data-stu-id="9cae6-132">Default value is 250ms.</span></span>
    <span data-ttu-id="9cae6-133">Общее время ожидания в секундах равно произведению maxNamedPipeConnectionRetry \*на namedPipeConnectionRetryDelay, разделенному на 1000.</span><span class="sxs-lookup"><span data-stu-id="9cae6-133">Total Timeout in seconds = (maxNamedPipeConnectionRetry \* namedPipeConnectionRetryDelay) / 1000</span></span>
  
    <span data-ttu-id="9cae6-134">По умолчанию общее время ожидания для iisnode в веб-приложениях Azure составляет 50 секунд (200 \* 250 мс = 50 с).</span><span class="sxs-lookup"><span data-stu-id="9cae6-134">By default the total timeout in iisnode on azure webapps is 200 \* 250ms = 50 seconds.</span></span>
* <span data-ttu-id="9cae6-135">logDirectory</span><span class="sxs-lookup"><span data-stu-id="9cae6-135">logDirectory</span></span>
  
    <span data-ttu-id="9cae6-136">Этот параметр определяет каталог, в который iisnode будет записывать сведения журналов stdout и stderr.</span><span class="sxs-lookup"><span data-stu-id="9cae6-136">This setting controls the directory where iisnode will log stdout/stderr.</span></span> <span data-ttu-id="9cae6-137">По умолчанию для этого параметра задано значение iisnode. Оно задается относительно основного каталога скрипта (каталога, в котором находится основной файл server.js).</span><span class="sxs-lookup"><span data-stu-id="9cae6-137">Default value is iisnode which is relative to the main script directory (directory where main server.js is present)</span></span>
* <span data-ttu-id="9cae6-138">debuggerExtensionDll</span><span class="sxs-lookup"><span data-stu-id="9cae6-138">debuggerExtensionDll</span></span>
  
    <span data-ttu-id="9cae6-139">Этот параметр определяет версию средства node-inspector, которую iisnode будет использовать при выполнении отладки приложения Node.</span><span class="sxs-lookup"><span data-stu-id="9cae6-139">This setting controls what version of node-inspector iisnode will use when debugging your node application.</span></span> <span data-ttu-id="9cae6-140">Сейчас для этого параметра доступны только значения iisnode-inspector-0.7.3.dll и iisnode-inspector.dll.</span><span class="sxs-lookup"><span data-stu-id="9cae6-140">Currently iisnode-inspector-0.7.3.dll and iisnode-inspector.dll are the only 2 valid values for this setting.</span></span> <span data-ttu-id="9cae6-141">По умолчанию для этого параметра задано значение iisnode-inspector-0.7.3.dll.</span><span class="sxs-lookup"><span data-stu-id="9cae6-141">Default value is iisnode-inspector-0.7.3.dll.</span></span> <span data-ttu-id="9cae6-142">Так как в этой версии используется node-inspector-0.7.3 и протокол websockets, в веб-приложении Azure для протокола websockets понадобится включить поддержку этой версии.</span><span class="sxs-lookup"><span data-stu-id="9cae6-142">iisnode-inspector-0.7.3.dll version uses node-inspector-0.7.3 and uses websockets, so you will need to enable websockets on your azure webapp to use this version.</span></span> <span data-ttu-id="9cae6-143">Дополнительные сведения о настройке новой версии node-inspector в iisnode см. по ссылке <http://www.ranjithr.com/?p=98>.</span><span class="sxs-lookup"><span data-stu-id="9cae6-143">See <http://www.ranjithr.com/?p=98> for more details on how to configure iisnode to use the new node-inspector.</span></span>
* <span data-ttu-id="9cae6-144">flushResponse</span><span class="sxs-lookup"><span data-stu-id="9cae6-144">flushResponse</span></span>
  
    <span data-ttu-id="9cae6-145">По умолчанию перед освобождением ответа или до его завершения (в зависимости от того, что произойдет раньше) IIS помещает в буфер до 4 МБ данных ответа.</span><span class="sxs-lookup"><span data-stu-id="9cae6-145">The default behavior of IIS is that it buffers response data up to 4MB before flushing, or until the end of the response, whichever comes first.</span></span> <span data-ttu-id="9cae6-146">В iisnode предоставляется параметр конфигурации, который позволяет переопределить это поведение. Чтобы освободить фрагмент тела объекта ответа после того, как iisnode его получит, для атрибута iisnode/@flushResponse в файле web.config необходимо задать значение true:</span><span class="sxs-lookup"><span data-stu-id="9cae6-146">iisnode offers a configuration setting to override this behavior: to flush a fragment of the response entity body as soon as iisnode receives it from node.exe, you need to set the iisnode/@flushResponse attribute in web.config to 'true':</span></span>
  
    ```
    <configuration>    
        <system.webServer>    
            <!-- ... -->    
            <iisnode flushResponse="true" />    
        </system.webServer>    
    </configuration>
    ```
  
    <span data-ttu-id="9cae6-147">Включение освобождения каждого фрагмента тела объекта ответа приводит к значительному снижению производительности, что, в свою очередь, уменьшает скорость работы системы приблизительно на 5 % (для версии v0.1.13). Поэтому этот параметр рекомендуется применять только к конечным точкам, для которых требуется потоковая передача ответа (например, при использовании элемента <location> в файле web.config).</span><span class="sxs-lookup"><span data-stu-id="9cae6-147">Enabling flushing of every fragment of the response entity body adds performance overhead that reduces the throughput of the system by ~5% (as of v0.1.13), so it is best to scope this setting only to endpoints that require response streaming (e.g. using the <location> element in the web.config)</span></span>
  
    <span data-ttu-id="9cae6-148">Кроме того, в приложениях потоковой передачи для параметра responseBufferLimit обработчика iisnode необходимо задать значение 0.</span><span class="sxs-lookup"><span data-stu-id="9cae6-148">In addition to this, for streaming applications, you will need to also set responseBufferLimit of your iisnode handler to 0.</span></span>
  
    ```
    <handlers>    
        <add name="iisnode" path="app.js" verb="\*" modules="iisnode" responseBufferLimit="0"/>    
    </handlers>
    ```
* <span data-ttu-id="9cae6-149">watchedFiles</span><span class="sxs-lookup"><span data-stu-id="9cae6-149">watchedFiles</span></span>
  
    <span data-ttu-id="9cae6-150">Это список разделенных точкой с запятой файлов, в которых будут отслеживаться изменения.</span><span class="sxs-lookup"><span data-stu-id="9cae6-150">This is a semi-colon separated list of files that will be watched for changes.</span></span> <span data-ttu-id="9cae6-151">Изменение файла приводит к перезапуску приложения.</span><span class="sxs-lookup"><span data-stu-id="9cae6-151">A change to a file causes the application to recycle.</span></span> <span data-ttu-id="9cae6-152">Каждая запись состоит из необязательного имени каталога и обязательного имени файла, которые задаются относительно каталога, в котором находится основная точка входа приложения.</span><span class="sxs-lookup"><span data-stu-id="9cae6-152">Each entry consists of an optional directory name plus required file name which are relative to the directory where the main application entry point is located.</span></span> <span data-ttu-id="9cae6-153">Подстановочные знаки можно использовать только в части имени файла.</span><span class="sxs-lookup"><span data-stu-id="9cae6-153">Wild cards are allowed in the file name portion only.</span></span> <span data-ttu-id="9cae6-154">Значение по умолчанию — \*.js;web.config.</span><span class="sxs-lookup"><span data-stu-id="9cae6-154">Default value is “\*.js;web.config”</span></span>
* <span data-ttu-id="9cae6-155">recycleSignalEnabled</span><span class="sxs-lookup"><span data-stu-id="9cae6-155">recycleSignalEnabled</span></span>
  
    <span data-ttu-id="9cae6-156">Значение по умолчанию — false.</span><span class="sxs-lookup"><span data-stu-id="9cae6-156">Default value is false.</span></span> <span data-ttu-id="9cae6-157">Этот параметр, если он включен, позволяет приложению Node подключаться к определенному каналу (переменная среды — IISNODE\_CONTROL\_PIPE) и отправлять сообщение о перезапуске.</span><span class="sxs-lookup"><span data-stu-id="9cae6-157">If enabled, your node application can connect to a named pipe (environment variable IISNODE\_CONTROL\_PIPE) and send a “recycle” message.</span></span> <span data-ttu-id="9cae6-158">Это позволит надлежащим образом перезапустить процесс w3wp.</span><span class="sxs-lookup"><span data-stu-id="9cae6-158">This will cause the w3wp to recycle gracefully.</span></span>
* <span data-ttu-id="9cae6-159">idlePageOutTimePeriod</span><span class="sxs-lookup"><span data-stu-id="9cae6-159">idlePageOutTimePeriod</span></span>
  
    <span data-ttu-id="9cae6-160">По умолчанию для этого параметра используется значение 0, а это значит, что он отключен.</span><span class="sxs-lookup"><span data-stu-id="9cae6-160">Default value is 0 which means this feature is disabled.</span></span> <span data-ttu-id="9cae6-161">Если задать значение больше нуля, iisnode будет выполнять выгрузку всех дочерних процессов с интервалом, указанным для этого параметра (в мс).</span><span class="sxs-lookup"><span data-stu-id="9cae6-161">When set to some value greater than 0, iisnode will page out all its child processes every ‘idlePageOutTimePeriod’ milliseconds.</span></span> <span data-ttu-id="9cae6-162">Дополнительные сведения о выгрузке см. в этой [документации](https://msdn.microsoft.com/library/windows/desktop/ms682606.aspx).</span><span class="sxs-lookup"><span data-stu-id="9cae6-162">To understand what page out means, please refer to this [documentation](https://msdn.microsoft.com/library/windows/desktop/ms682606.aspx).</span></span> <span data-ttu-id="9cae6-163">Этот параметр полезен для приложений, которые используют большой объем памяти и которым необходимо время от времени выгружать память на диск, чтобы освободить ОЗУ.</span><span class="sxs-lookup"><span data-stu-id="9cae6-163">This setting will be useful for applications that consume a lot of memory and want to pageout memory to disk occasionally to free up some RAM.</span></span>

> [!WARNING]
> <span data-ttu-id="9cae6-164">Соблюдайте осторожность при включении следующих параметров конфигурации в рабочих приложениях.</span><span class="sxs-lookup"><span data-stu-id="9cae6-164">Use caution when enabling the following configuration settings on production applications.</span></span> <span data-ttu-id="9cae6-165">Эти параметры не рекомендуется включать в активных рабочих приложениях.</span><span class="sxs-lookup"><span data-stu-id="9cae6-165">Recommendation is to not enable them on live production applications.</span></span>
> 
> 

* <span data-ttu-id="9cae6-166">debugHeaderEnabled</span><span class="sxs-lookup"><span data-stu-id="9cae6-166">debugHeaderEnabled</span></span>
  
    <span data-ttu-id="9cae6-167">По умолчанию для этого параметра используется значение false.</span><span class="sxs-lookup"><span data-stu-id="9cae6-167">The default value is false.</span></span> <span data-ttu-id="9cae6-168">Если изменить его на true, iisnode будет добавлять HTTP-заголовок ответа iisnode-debug к каждому отправленному им ответу HTTP. Значение заголовка iisnode-debug — это URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="9cae6-168">If set to true, iisnode will add an HTTP response header iisnode-debug to every HTTP response it sends the iisnode-debug header value is a URL.</span></span> <span data-ttu-id="9cae6-169">Из фрагмента URL-адреса можно извлечь только отдельную часть диагностических данных. Более детальные сведения можно получить, открыв URL-адрес в веб-браузере.</span><span class="sxs-lookup"><span data-stu-id="9cae6-169">Individual pieces of diagnostic information can be gleaned by looking at the URL fragment, but a much better visualization is achieved by opening the URL in the browser.</span></span>
* <span data-ttu-id="9cae6-170">loggingEnabled</span><span class="sxs-lookup"><span data-stu-id="9cae6-170">loggingEnabled</span></span>
  
    <span data-ttu-id="9cae6-171">Этот параметр управляет ведением журналов stdout и stderr с помощью iisnode.</span><span class="sxs-lookup"><span data-stu-id="9cae6-171">This setting controls the logging of stdout and stderr by iisnode.</span></span> <span data-ttu-id="9cae6-172">Обработчик iisnode собирает из запущенных в нем процессов Node данные stdout и stderr, а затем записывает их в каталог, определенный в параметре logDirectory.</span><span class="sxs-lookup"><span data-stu-id="9cae6-172">Iisnode will capture stdout/stderr from node processes it launches and write to the directory specified in the ‘logDirectory’ setting.</span></span> <span data-ttu-id="9cae6-173">Если этот параметр включен, приложение будет записывать журналы в файловую систему, а производительность приложения будет зависеть от объема собранных приложением данных.</span><span class="sxs-lookup"><span data-stu-id="9cae6-173">Once this is enable, your application will be writing logs to the file system and depending on the amount of logging done by the application, there could be performance implications.</span></span>
* <span data-ttu-id="9cae6-174">devErrorsEnabled</span><span class="sxs-lookup"><span data-stu-id="9cae6-174">devErrorsEnabled</span></span>
  
    <span data-ttu-id="9cae6-175">Значение по умолчанию — false.</span><span class="sxs-lookup"><span data-stu-id="9cae6-175">Default value is false.</span></span> <span data-ttu-id="9cae6-176">Если изменить его на true, iisnode отобразит в браузере код состояния HTTP и код ошибки Win32.</span><span class="sxs-lookup"><span data-stu-id="9cae6-176">When set to true, iisnode will display the HTTP status code and Win32 error code on your browser.</span></span> <span data-ttu-id="9cae6-177">Этот код понадобится при отладке определенных типов проблем.</span><span class="sxs-lookup"><span data-stu-id="9cae6-177">The win32 code will be helpful in debugging certain types of issues.</span></span>
* <span data-ttu-id="9cae6-178">debuggingEnabled (не включайте этот параметр на активном рабочем сайте)</span><span class="sxs-lookup"><span data-stu-id="9cae6-178">debuggingEnabled (do not enable on live production site)</span></span>
  
    <span data-ttu-id="9cae6-179">Этот параметр определяет функцию отладки.</span><span class="sxs-lookup"><span data-stu-id="9cae6-179">This setting controls debugging feature.</span></span> <span data-ttu-id="9cae6-180">В iisnode интегрировано средство node-inspector.</span><span class="sxs-lookup"><span data-stu-id="9cae6-180">Iisnode is integrated with node-inspector.</span></span> <span data-ttu-id="9cae6-181">Включение этого параметра активирует отладку приложения Node.</span><span class="sxs-lookup"><span data-stu-id="9cae6-181">By enabling this setting, you enable debugging of your node application.</span></span> <span data-ttu-id="9cae6-182">После включения параметра при первом запросе на отладку к приложению node обработчик iisnode разместит необходимые файлы node-inspector в каталоге debuggerVirtualDir.</span><span class="sxs-lookup"><span data-stu-id="9cae6-182">Once this setting is enabled, iisnode will layout the necessary node-inspector files in ‘debuggerVirtualDir’ directory on the first debug request to your node application.</span></span> <span data-ttu-id="9cae6-183">Средство node-inspector можно загрузить, отправив запрос на страницу http://yoursite/server.js/debug.</span><span class="sxs-lookup"><span data-stu-id="9cae6-183">You can load the node-inspector by sending a request to http://yoursite/server.js/debug.</span></span> <span data-ttu-id="9cae6-184">С помощью параметра debuggerPathSegment можно управлять сегментом URL-адреса отладки.</span><span class="sxs-lookup"><span data-stu-id="9cae6-184">You can control the debug URL segment with ‘debuggerPathSegment’ setting.</span></span> <span data-ttu-id="9cae6-185">По умолчанию для этого параметра используется значение debug.</span><span class="sxs-lookup"><span data-stu-id="9cae6-185">By default debuggerPathSegment=’debug’.</span></span> <span data-ttu-id="9cae6-186">Если задать для него, к примеру, значение GUID, другим пользователям будет труднее его отследить.</span><span class="sxs-lookup"><span data-stu-id="9cae6-186">You can set this to a GUID for example so that it is more difficult to be discovered by others.</span></span>
  
    <span data-ttu-id="9cae6-187">Дополнительные сведения об отладке см. [здесь](https://tomasz.janczuk.org/2011/11/debug-nodejs-applications-on-windows.html).</span><span class="sxs-lookup"><span data-stu-id="9cae6-187">Check this [link](https://tomasz.janczuk.org/2011/11/debug-nodejs-applications-on-windows.html) for more details on debugging.</span></span>

## <a name="scenarios-and-recommendationstroubleshooting"></a><span data-ttu-id="9cae6-188">Сценарии, рекомендации и устранение неполадок</span><span class="sxs-lookup"><span data-stu-id="9cae6-188">Scenarios and recommendations/troubleshooting</span></span>
### <a name="my-node-application-is-making-too-many-outbound-calls"></a><span data-ttu-id="9cae6-189">В этом сценарии приложение Node отравляет слишком много вызовов.</span><span class="sxs-lookup"><span data-stu-id="9cae6-189">My node application is making too many outbound calls.</span></span>
<span data-ttu-id="9cae6-190">В рамках своих операций многие приложения попытаются установить с ним исходящие подключения.</span><span class="sxs-lookup"><span data-stu-id="9cae6-190">Many applications would want to make outbound connections as part of their regular operation.</span></span> <span data-ttu-id="9cae6-191">Например, при получении запроса для его обработки приложению Node потребуется связаться с REST API и получить необходимые для этого сведения.</span><span class="sxs-lookup"><span data-stu-id="9cae6-191">For example, when a request comes in, your node app would want to contact a REST API elsewhere and get some information to process the request.</span></span> <span data-ttu-id="9cae6-192">Возможно, при вызовах HTTP или HTTPS понадобится использовать активный агент.</span><span class="sxs-lookup"><span data-stu-id="9cae6-192">You would want to use a keep alive agent when making http or https calls.</span></span> <span data-ttu-id="9cae6-193">Например, при выполнении этих исходящих вызовов в качестве активного агента можно использовать модуль agentkeepalive.</span><span class="sxs-lookup"><span data-stu-id="9cae6-193">For example, you could use the agentkeepalive module as your keep alive agent when making these outbound calls.</span></span> <span data-ttu-id="9cae6-194">Это гарантирует, что на виртуальной машине с веб-приложением сокеты повторно используются, а также позволяет снизить затраты на создание сокетов для каждого исходящего вызова.</span><span class="sxs-lookup"><span data-stu-id="9cae6-194">This makes sure that the sockets are reused on your azure webapp VM and reducing the overhead of creating new sockets for every outbound request.</span></span> <span data-ttu-id="9cae6-195">Кроме того, это гарантирует, что для выполнения исходящих вызовов используется меньшее количество сокетов и, следовательно, максимальное количество сокетов, выделенных на одну виртуальную машину, не превышается.</span><span class="sxs-lookup"><span data-stu-id="9cae6-195">Also, this makes sure that you are using less number of sockets to make many outbound requests and therefore you don’t exceed the maxSockets that are allocated per VM.</span></span> <span data-ttu-id="9cae6-196">В веб-приложении Azure для параметра agentKeepAlive maxSockets рекомендуется задать значение 160 сокетов на одну виртуальную машину.</span><span class="sxs-lookup"><span data-stu-id="9cae6-196">Recommendation on Azure Webapps would be to set the agentKeepAlive maxSockets value to a total of 160 sockets per VM.</span></span> <span data-ttu-id="9cae6-197">Это означает, что при наличии 4 файлов node.exe, запущенных на виртуальной машине, на один файл выделяется 40 сокетов, что в суме дает 160 сокетов на одну виртуальную машину.</span><span class="sxs-lookup"><span data-stu-id="9cae6-197">This means that if you have 4 node.exe running on the VM, you would want to set the agentKeepAlive maxSockets to 40 per node.exe which is 160 total per VM.</span></span>

<span data-ttu-id="9cae6-198">Пример конфигурации модуля [agentKeepALive](https://www.npmjs.com/package/agentkeepalive):</span><span class="sxs-lookup"><span data-stu-id="9cae6-198">Example [agentKeepALive](https://www.npmjs.com/package/agentkeepalive) configuration:</span></span>

```
var keepaliveAgent = new Agent({    
    maxSockets: 40,    
    maxFreeSockets: 10,    
    timeout: 60000,    
    keepAliveTimeout: 300000    
});
```

<span data-ttu-id="9cae6-199">В этом примере предполагается, что на виртуальной машине запущено 4 файла node.exe.</span><span class="sxs-lookup"><span data-stu-id="9cae6-199">This example assumes you have 4 node.exe running on your VM.</span></span> <span data-ttu-id="9cae6-200">Если используется другое количество, параметр maxSockets необходимо изменить соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="9cae6-200">If you have a different number of node.exe running on the VM, you will have to modify the maxSockets setting accordingly.</span></span>

### <a name="my-node-application-is-consuming-too-much-cpu"></a><span data-ttu-id="9cae6-201">Чрезмерное потребление ресурсов ЦП приложением Node</span><span class="sxs-lookup"><span data-stu-id="9cae6-201">My node application is consuming too much CPU.</span></span>
<span data-ttu-id="9cae6-202">На вашем портале может отобразиться оповещение от веб-приложений Azure о высоком потреблении ресурсов ЦП.</span><span class="sxs-lookup"><span data-stu-id="9cae6-202">You will probably get a recommendation from Azure Webapps on your portal about high cpu consumption.</span></span> <span data-ttu-id="9cae6-203">Эти [метрики](web-sites-monitor.md)также можно отслеживать, настроив для этого мониторы.</span><span class="sxs-lookup"><span data-stu-id="9cae6-203">You can also setup monitors to watch for certain [metrics](web-sites-monitor.md).</span></span> <span data-ttu-id="9cae6-204">Перед проверкой использования ЦП на [панели мониторинга портала Azure](../application-insights/app-insights-web-monitor-performance.md)сначала проверьте максимальные значения ЦП, чтобы не пропустить пиковые значения.</span><span class="sxs-lookup"><span data-stu-id="9cae6-204">When checking the CPU usage on the [Azure Portal Dashboard](../application-insights/app-insights-web-monitor-performance.md), please check the MAX values for CPU so you don’t miss out the peak values.</span></span>
<span data-ttu-id="9cae6-205">Если приложение Node потребляет слишком много ресурсов ЦП и не удается выяснить причину этого, необходимо выполнить его профилирование.</span><span class="sxs-lookup"><span data-stu-id="9cae6-205">In cases where you think your application is consuming too much CPU and you cannot explain why, you will need to profile your node application.</span></span>

### 
#### <a name="profiling-your-node-application-on-azure-webapps-with-v8-profiler"></a><span data-ttu-id="9cae6-206">Профилирование приложения Node в веб-приложениях Azure с помощью средства V8-Profiler</span><span class="sxs-lookup"><span data-stu-id="9cae6-206">Profiling your node application on azure webapps with V8-Profiler</span></span>
<span data-ttu-id="9cae6-207">Например, предположим, что у вас есть приложение Hello World, для которого необходимо выполнить профилирование, как показано ниже:</span><span class="sxs-lookup"><span data-stu-id="9cae6-207">For example, lets say you have a hello world app that you want to profile as shown below:</span></span>

```
var http = require('http');    
function WriteConsoleLog() {    
    for(var i=0;i<99999;++i) {    
        console.log('hello world');    
    }    
}

function HandleRequest() {    
    WriteConsoleLog();    
}

http.createServer(function (req, res) {    
    res.writeHead(200, {'Content-Type': 'text/html'});    
    HandleRequest();    
    res.end('Hello world!');    
}).listen(process.env.PORT);
```

<span data-ttu-id="9cae6-208">Перейдите на сайт SCM по адресу https://yoursite.scm.azurewebsites.net/DebugConsole.</span><span class="sxs-lookup"><span data-stu-id="9cae6-208">Go to your scm site https://yoursite.scm.azurewebsites.net/DebugConsole</span></span>

<span data-ttu-id="9cae6-209">Откроется следующая командная строка.</span><span class="sxs-lookup"><span data-stu-id="9cae6-209">You will see a command prompt as shown below.</span></span> <span data-ttu-id="9cae6-210">Перейдите в каталог site/wwwroot.</span><span class="sxs-lookup"><span data-stu-id="9cae6-210">Go into your site/wwwroot directory</span></span>

![](./media/app-service-web-nodejs-best-practices-and-troubleshoot-guide/scm_install_v8.png)

<span data-ttu-id="9cae6-211">Выполните команду npm install v8-profiler.</span><span class="sxs-lookup"><span data-stu-id="9cae6-211">Run the command “npm install v8-profiler”</span></span>

<span data-ttu-id="9cae6-212">В каталоге node\_modules установится средство v8-profiler и все его зависимости.</span><span class="sxs-lookup"><span data-stu-id="9cae6-212">This should install v8-profiler under node\_modules directory and all of its dependencies.</span></span>
<span data-ttu-id="9cae6-213">Далее, чтобы выполнить профилирование приложения, измените файл server.js.</span><span class="sxs-lookup"><span data-stu-id="9cae6-213">Now, edit your server.js to profile your application.</span></span>

```
var http = require('http');    
var profiler = require('v8-profiler');    
var fs = require('fs');

function WriteConsoleLog() {    
    for(var i=0;i<99999;++i) {    
        console.log('hello world');    
    }    
}

function HandleRequest() {    
    profiler.startProfiling('HandleRequest');    
    WriteConsoleLog();    
    fs.writeFileSync('profile.cpuprofile', JSON.stringify(profiler.stopProfiling('HandleRequest')));    
}

http.createServer(function (req, res) {    
    res.writeHead(200, {'Content-Type': 'text/html'});    
    HandleRequest();    
    res.end('Hello world!');    
}).listen(process.env.PORT);
```

<span data-ttu-id="9cae6-214">Указанные выше действия позволяют выполнить профилирование функции WriteConsoleLog, а затем записать выходные данные в файл profile.cpuprofile, расположенный в каталоге site wwwroot.</span><span class="sxs-lookup"><span data-stu-id="9cae6-214">The above changes will profile the WriteConsoleLog function and then write the profile output to ‘profile.cpuprofile’ file under your site wwwroot.</span></span> <span data-ttu-id="9cae6-215">Отправьте запрос в приложение.</span><span class="sxs-lookup"><span data-stu-id="9cae6-215">Send a request to your application.</span></span> <span data-ttu-id="9cae6-216">В каталоге site wwwroot будет создан файл profile.cpuprofile.</span><span class="sxs-lookup"><span data-stu-id="9cae6-216">You will see a ‘profile.cpuprofile’ file created under your site wwwroot.</span></span>

![](./media/app-service-web-nodejs-best-practices-and-troubleshoot-guide/scm_profile.cpuprofile.png)

<span data-ttu-id="9cae6-217">Загрузите этот файл и откройте его, нажав в браузере Chrome клавишу F12.</span><span class="sxs-lookup"><span data-stu-id="9cae6-217">Download this file and you will need to open this file with Chrome F12 Tools.</span></span> <span data-ttu-id="9cae6-218">Затем перейдите на вкладку "Профили".</span><span class="sxs-lookup"><span data-stu-id="9cae6-218">Hit F12 on chrome, then click on the “Profiles Tab”.</span></span> <span data-ttu-id="9cae6-219">Нажмите кнопку "Загрузить".</span><span class="sxs-lookup"><span data-stu-id="9cae6-219">Click on “Load” Button.</span></span> <span data-ttu-id="9cae6-220">Выберите только что загруженный файл profile.cpuprofile.</span><span class="sxs-lookup"><span data-stu-id="9cae6-220">Select your profile.cpuprofile file that you just downloaded.</span></span> <span data-ttu-id="9cae6-221">Щелкните только что загруженный профиль.</span><span class="sxs-lookup"><span data-stu-id="9cae6-221">Click on the profile you just loaded.</span></span>

![](./media/app-service-web-nodejs-best-practices-and-troubleshoot-guide/chrome_tools_view.png)

<span data-ttu-id="9cae6-222">Вы увидите, что на работу функции WriteConsoleLog ушло 95 % времени, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="9cae6-222">You will see that 95% of the time was consumed by WriteConsoleLog function as shown below.</span></span> <span data-ttu-id="9cae6-223">Вы также увидите точные номера строк и исходные файлы, которые вызывают проблемы.</span><span class="sxs-lookup"><span data-stu-id="9cae6-223">This also shows you the exact line numbers and source files that cause the issue.</span></span>

### <a name="my-node-application-is-consuming-too-much-memory"></a><span data-ttu-id="9cae6-224">Чрезмерное потребление памяти приложением Node</span><span class="sxs-lookup"><span data-stu-id="9cae6-224">My node application is consuming too much memory.</span></span>
<span data-ttu-id="9cae6-225">На вашем портале может отобразиться оповещение от веб-приложений Azure о высоком потреблении памяти.</span><span class="sxs-lookup"><span data-stu-id="9cae6-225">You will probably get a recommendation from Azure Webapps on your portal about high memory consumption.</span></span> <span data-ttu-id="9cae6-226">Эти [метрики](web-sites-monitor.md)также можно отслеживать, настроив для этого мониторы.</span><span class="sxs-lookup"><span data-stu-id="9cae6-226">You can also setup monitors to watch for certain [metrics](web-sites-monitor.md).</span></span> <span data-ttu-id="9cae6-227">Перед проверкой потребления памяти на [панели мониторинга портала Azure](../application-insights/app-insights-web-monitor-performance.md)сначала проверьте максимальный объем памяти, чтобы не пропустить пиковые значения.</span><span class="sxs-lookup"><span data-stu-id="9cae6-227">When checking the memory usage on the [Azure Portal Dashboard](../application-insights/app-insights-web-monitor-performance.md), please check the MAX values for memory so you don’t miss out the peak values.</span></span>

#### <a name="leak-detection-and-heap-diffing-for-nodejs"></a><span data-ttu-id="9cae6-228">Обнаружение утечки и определение различий кучи для node.js</span><span class="sxs-lookup"><span data-stu-id="9cae6-228">Leak detection and Heap Diffing for node.js</span></span>
<span data-ttu-id="9cae6-229">Чтобы обнаружить утечки памяти, можно использовать [node-memwatch](https://github.com/lloyd/node-memwatch) .</span><span class="sxs-lookup"><span data-stu-id="9cae6-229">You could use [node-memwatch](https://github.com/lloyd/node-memwatch) to help you identify memory leaks.</span></span>
<span data-ttu-id="9cae6-230">Установите memwatch (аналогично средству V8-Profiler) и измените код, чтобы извлечь кучи и выявить в них различия, что позволяет определить утечки памяти в приложении.</span><span class="sxs-lookup"><span data-stu-id="9cae6-230">You can install memwatch just like v8-profiler and edit your code to capture and diff heaps to identify the memory leaks in your application.</span></span>

### <a name="my-nodeexes-are-getting-killed-randomly"></a><span data-ttu-id="9cae6-231">Случайное завершение работы файла node.exe</span><span class="sxs-lookup"><span data-stu-id="9cae6-231">My node.exe’s are getting killed randomly</span></span>
<span data-ttu-id="9cae6-232">Это может произойти по нескольким причинам.</span><span class="sxs-lookup"><span data-stu-id="9cae6-232">There are a few reasons why this could be happening:</span></span>

1. <span data-ttu-id="9cae6-233">В приложении создаются неперехваченные исключения. Дополнительные сведения о создании исключений можно просмотреть в файле d:\\home\\LogFiles\\Application\\logging-errors.txt.</span><span class="sxs-lookup"><span data-stu-id="9cae6-233">Your application is throwing uncaught exceptions – Please check d:\\home\\LogFiles\\Application\\logging-errors.txt file for the details on the exception thrown.</span></span> <span data-ttu-id="9cae6-234">В этом файле доступна трассировка стека, что позволяет исправить эту проблему в приложении.</span><span class="sxs-lookup"><span data-stu-id="9cae6-234">This file has the stack trace so you can fix your application based on this.</span></span>
2. <span data-ttu-id="9cae6-235">Приложение потребляет слишком много памяти, что изначально влияет на другие процессы.</span><span class="sxs-lookup"><span data-stu-id="9cae6-235">Your application is consuming too much memory which is affecting other processes from getting started.</span></span> <span data-ttu-id="9cae6-236">Если общий объем памяти виртуальной машины составляет около 100 %, диспетчер процессов может завершить работу файла node.exe, чтобы остальные процессы могли выполнить определенные задания.</span><span class="sxs-lookup"><span data-stu-id="9cae6-236">If the total VM memory is close to 100%, your node.exe’s could be killed by the process manager to let other processes get a chance to do some work.</span></span> <span data-ttu-id="9cae6-237">Чтобы устранить эту проблему, убедитесь, что в приложении нет утечки памяти, или, если для него действительно требуется большой объем памяти, выполните масштабирование до большего размера виртуальной машины, увеличив объем ОЗУ.</span><span class="sxs-lookup"><span data-stu-id="9cae6-237">To fix this, either make sure your application is not leaking memory OR if you application really needs to use a lot of memory, please scale up to a larger VM with a lot more RAM.</span></span>

### <a name="my-node-application-does-not-start"></a><span data-ttu-id="9cae6-238">Ошибка запуска приложения Node</span><span class="sxs-lookup"><span data-stu-id="9cae6-238">My node application does not start</span></span>
<span data-ttu-id="9cae6-239">Если при запуске приложения возвращаются ошибки с кодом 500, причин может быть несколько.</span><span class="sxs-lookup"><span data-stu-id="9cae6-239">If your application is returning 500 Errors at startup, there could be a few reasons:</span></span>

1. <span data-ttu-id="9cae6-240">Файл node.exe находится в неправильном расположении.</span><span class="sxs-lookup"><span data-stu-id="9cae6-240">Node.exe is not present at the correct location.</span></span> <span data-ttu-id="9cae6-241">Проверьте параметр nodeProcessCommandLine.</span><span class="sxs-lookup"><span data-stu-id="9cae6-241">Check nodeProcessCommandLine setting.</span></span>
2. <span data-ttu-id="9cae6-242">Основной файл сценария находится в неправильном расположении.</span><span class="sxs-lookup"><span data-stu-id="9cae6-242">Main script file is not present at the correct location.</span></span> <span data-ttu-id="9cae6-243">Проверьте файл web.config и убедитесь, что в разделе обработчиков задано соответствующее имя основного файла сценария.</span><span class="sxs-lookup"><span data-stu-id="9cae6-243">Check web.config and make sure the name of the main script file in the handlers section matches the main script file.</span></span>
3. <span data-ttu-id="9cae6-244">Используется неправильная конфигурация файла web.config. Проверьте имена и значения параметров.</span><span class="sxs-lookup"><span data-stu-id="9cae6-244">Web.config configuration is not correct – check the settings names/values.</span></span>
4. <span data-ttu-id="9cae6-245">Холодный запуск. Приложение запускается слишком долго.</span><span class="sxs-lookup"><span data-stu-id="9cae6-245">Cold Start – Your application is taking too long to startup.</span></span> <span data-ttu-id="9cae6-246">Если для запуска приложения требуется больше времени, чем задано для общего времени ожидания в секундах ((maxNamedPipeConnectionRetry \* namedPipeConnectionRetryDelay), разделенное на 1000), iisnode вернет ошибку с кодом 500.</span><span class="sxs-lookup"><span data-stu-id="9cae6-246">If your application takes longer than (maxNamedPipeConnectionRetry \* namedPipeConnectionRetryDelay) / 1000 seconds, iisnode will return 500 error.</span></span> <span data-ttu-id="9cae6-247">Чтобы предотвратить превышение времени ожидания iisnode и возвращение ошибки с кодом 500, увеличьте значения этих параметров для соответствия времени запуска приложения.</span><span class="sxs-lookup"><span data-stu-id="9cae6-247">Increase the values of these settings to match your application start time to prevent iisnode from timing out and returning the 500 error.</span></span>

### <a name="my-node-application-crashed"></a><span data-ttu-id="9cae6-248">Сбой приложения Node</span><span class="sxs-lookup"><span data-stu-id="9cae6-248">My node application crashed</span></span>
<span data-ttu-id="9cae6-249">В приложении создаются неперехваченные исключения. Дополнительные сведения о создании исключений можно просмотреть в файле d:\\home\\LogFiles\\Application\\logging-errors.txt.</span><span class="sxs-lookup"><span data-stu-id="9cae6-249">Your application is throwing uncaught exceptions – Please check d:\\home\\LogFiles\\Application\\logging-errors.txt file for the details on the exception thrown.</span></span> <span data-ttu-id="9cae6-250">В этом файле доступна трассировка стека, что позволяет исправить эту проблему в приложении.</span><span class="sxs-lookup"><span data-stu-id="9cae6-250">This file has the stack trace so you can fix your application based on this.</span></span>

### <a name="my-node-application-takes-too-much-time-to-startup-cold-start"></a><span data-ttu-id="9cae6-251">Запуск приложения Node занимает слишком много времени (холодный запуск)</span><span class="sxs-lookup"><span data-stu-id="9cae6-251">My node application takes too much time to startup (Cold Start)</span></span>
<span data-ttu-id="9cae6-252">Вероятнее всего, это происходит потому, что в каталоге node\_modules содержится много файлов и приложение пытается загрузить большинство этих файлов при запуске.</span><span class="sxs-lookup"><span data-stu-id="9cae6-252">Most common reason for this is that the application has a lot of files in the node\_modules and the application tries to load most of these files during startup.</span></span> <span data-ttu-id="9cae6-253">Так как по умолчанию эти файлы содержатся в сетевой папке в веб-приложениях Azure, загрузка такого количества файлов занимает больше времени.</span><span class="sxs-lookup"><span data-stu-id="9cae6-253">By default, since your files reside on the network share on Azure Webapps, loading so many files can take some time.</span></span>
<span data-ttu-id="9cae6-254">Чтобы ускорить этот процесс, сделайте следующее:</span><span class="sxs-lookup"><span data-stu-id="9cae6-254">Some solutions to make this faster are:</span></span>

1. <span data-ttu-id="9cae6-255">Убедитесь, что используется плоская структура зависимости и нет дубликатов зависимостей, установив модули с помощью npm3.</span><span class="sxs-lookup"><span data-stu-id="9cae6-255">Make sure you have a flat dependency structure and no duplicate dependencies by using npm3 to install your modules.</span></span>
2. <span data-ttu-id="9cae6-256">Попробуйте выполнить отложенную загрузку node\_modules и не загружайте при запуске все модули.</span><span class="sxs-lookup"><span data-stu-id="9cae6-256">Try to lazy load your node\_modules and not load all of the modules at startup.</span></span> <span data-ttu-id="9cae6-257">Это означает, что требуемый вызов ("модуль") должен выполниться при использовании в функции модуля.</span><span class="sxs-lookup"><span data-stu-id="9cae6-257">This means that the call to require(‘module’) should be done when you actually need it within the function you try to use the module.</span></span>
3. <span data-ttu-id="9cae6-258">В веб-приложениях Azure используется функция, которая называется "локальный кэш".</span><span class="sxs-lookup"><span data-stu-id="9cae6-258">Azure Webapps offers a feature called local cache.</span></span> <span data-ttu-id="9cae6-259">С помощью этой функции можно скопировать содержимое сетевой папки на локальный диск виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="9cae6-259">This feature copies your content from the network share to the local disk on the VM.</span></span> <span data-ttu-id="9cae6-260">Так как файлы расположены локально, загрузка node\_modules происходит значительно быстрее.</span><span class="sxs-lookup"><span data-stu-id="9cae6-260">Since the files are local, the load time of node\_modules is much faster.</span></span> <span data-ttu-id="9cae6-261">Дополнительные сведения о функции локального кэша см. в этой [документации](../app-service/app-service-local-cache.md).</span><span class="sxs-lookup"><span data-stu-id="9cae6-261">- This [documentation](../app-service/app-service-local-cache.md) explains how to use Local Cache in more detail.</span></span>

## <a name="iisnode-http-status-and-substatus"></a><span data-ttu-id="9cae6-262">Состояние и подсостояние HTTP обработчика iisnode</span><span class="sxs-lookup"><span data-stu-id="9cae6-262">IISNODE http status and substatus</span></span>
<span data-ttu-id="9cae6-263">В этом [исходном файле](https://github.com/Azure/iisnode/blob/master/src/iisnode/cnodeconstants.h) перечислены все возможные сочетания состояний и подсостояний, которые может возвратить iisnode в случае возникновения ошибок.</span><span class="sxs-lookup"><span data-stu-id="9cae6-263">This [source file](https://github.com/Azure/iisnode/blob/master/src/iisnode/cnodeconstants.h) lists all the possible status/substatus combination iisnode can return in case of error.</span></span>

<span data-ttu-id="9cae6-264">Чтобы отобразить код ошибки Win32, включите для своего приложения FREB (для обеспечения производительности FREB рекомендуется включать только на нерабочих сайтах).</span><span class="sxs-lookup"><span data-stu-id="9cae6-264">Enable FREB for your application to see the win32 error code (please make sure you enable FREB only on non-production sites for performance reasons).</span></span>

| <span data-ttu-id="9cae6-265">Состояние HTTP</span><span class="sxs-lookup"><span data-stu-id="9cae6-265">Http Status</span></span> | <span data-ttu-id="9cae6-266">Подсостояние HTTP</span><span class="sxs-lookup"><span data-stu-id="9cae6-266">Http SubStatus</span></span> | <span data-ttu-id="9cae6-267">Возможная причина</span><span class="sxs-lookup"><span data-stu-id="9cae6-267">Possible Reason?</span></span> |
| --- | --- | --- |
| <span data-ttu-id="9cae6-268">500</span><span class="sxs-lookup"><span data-stu-id="9cae6-268">500</span></span> |<span data-ttu-id="9cae6-269">1000</span><span class="sxs-lookup"><span data-stu-id="9cae6-269">1000</span></span> |<span data-ttu-id="9cae6-270">При отправке запроса к iisnode возникла ошибка. Проверьте, запущен ли файл node.exe.</span><span class="sxs-lookup"><span data-stu-id="9cae6-270">There was some issue dispatching the request to IISNODE – check if node.exe was started up.</span></span> <span data-ttu-id="9cae6-271">Возможно, при запуске этого файла произошел сбой.</span><span class="sxs-lookup"><span data-stu-id="9cae6-271">Node.exe could have crashed on startup.</span></span> <span data-ttu-id="9cae6-272">Проверьте конфигурацию web.config на наличие ошибок.</span><span class="sxs-lookup"><span data-stu-id="9cae6-272">Check your web.config configuration for errors.</span></span> |
| <span data-ttu-id="9cae6-273">500</span><span class="sxs-lookup"><span data-stu-id="9cae6-273">500</span></span> |<span data-ttu-id="9cae6-274">1001</span><span class="sxs-lookup"><span data-stu-id="9cae6-274">1001</span></span> |<span data-ttu-id="9cae6-275">Win32Error 0x2. Приложение не отвечает URL-адресу.</span><span class="sxs-lookup"><span data-stu-id="9cae6-275">- Win32Error 0x2 - App is not responding to the URL.</span></span> <span data-ttu-id="9cae6-276">Проверьте правила подстановки URL-адреса или определение маршрутов приложения Express.</span><span class="sxs-lookup"><span data-stu-id="9cae6-276">Check URL rewrite rules or if your express app has the correct routes defined.</span></span> <span data-ttu-id="9cae6-277">Win32Error 0x6d — именованный канал занят. Файл node.exe не принимает запросы, так как канал занят.</span><span class="sxs-lookup"><span data-stu-id="9cae6-277">- Win32Error 0x6d – named pipe is busy – Node.exe is not accepting requests because the pipe is busy.</span></span> <span data-ttu-id="9cae6-278">Проверьте потребление ресурсов ЦП.</span><span class="sxs-lookup"><span data-stu-id="9cae6-278">Check high cpu usage.</span></span> <span data-ttu-id="9cae6-279">Другие ошибки. Проверьте файл node.exe на наличие повреждений.</span><span class="sxs-lookup"><span data-stu-id="9cae6-279">- Other errors – check if node.exe crashed.</span></span> |
| <span data-ttu-id="9cae6-280">500</span><span class="sxs-lookup"><span data-stu-id="9cae6-280">500</span></span> |<span data-ttu-id="9cae6-281">1002</span><span class="sxs-lookup"><span data-stu-id="9cae6-281">1002</span></span> |<span data-ttu-id="9cae6-282">Файл node.exe поврежден. Для трассировки стека проверьте файл d:\\home\\LogFiles\\logging-errors.txt.</span><span class="sxs-lookup"><span data-stu-id="9cae6-282">Node.exe crashed – check d:\\home\\LogFiles\\logging-errors.txt for stack trace.</span></span> |
| <span data-ttu-id="9cae6-283">500</span><span class="sxs-lookup"><span data-stu-id="9cae6-283">500</span></span> |<span data-ttu-id="9cae6-284">1003</span><span class="sxs-lookup"><span data-stu-id="9cae6-284">1003</span></span> |<span data-ttu-id="9cae6-285">Ошибка конфигурации канала. Это оповещение не должно отображаться, в противном случае конфигурация именованного канала неправильна.</span><span class="sxs-lookup"><span data-stu-id="9cae6-285">Pipe configuration Issue – You should never see this but if you do, the named pipe configuration is incorrect.</span></span> |
| <span data-ttu-id="9cae6-286">500</span><span class="sxs-lookup"><span data-stu-id="9cae6-286">500</span></span> |<span data-ttu-id="9cae6-287">1004–1018</span><span class="sxs-lookup"><span data-stu-id="9cae6-287">1004-1018</span></span> |<span data-ttu-id="9cae6-288">При отправке запроса к файлу node.exe или обработке ответа от него произошла ошибка.</span><span class="sxs-lookup"><span data-stu-id="9cae6-288">There was some error while sending the request or processing the response to/from node.exe.</span></span> <span data-ttu-id="9cae6-289">Проверьте файл node.exe на наличие повреждений.</span><span class="sxs-lookup"><span data-stu-id="9cae6-289">Check if node.exe crashed.</span></span> <span data-ttu-id="9cae6-290">Для трассировки стека проверьте файл d:\\home\\LogFiles\\logging-errors.txt.</span><span class="sxs-lookup"><span data-stu-id="9cae6-290">check d:\\home\\LogFiles\\logging-errors.txt for stack trace.</span></span> |
| <span data-ttu-id="9cae6-291">503</span><span class="sxs-lookup"><span data-stu-id="9cae6-291">503</span></span> |<span data-ttu-id="9cae6-292">1000</span><span class="sxs-lookup"><span data-stu-id="9cae6-292">1000</span></span> |<span data-ttu-id="9cae6-293">Недостаточно памяти для выделения большего количества подключений по именованным каналам.</span><span class="sxs-lookup"><span data-stu-id="9cae6-293">Not enough memory to allocate more named pipe connections.</span></span> <span data-ttu-id="9cae6-294">Проверьте, почему приложение потребляет такое большое количество памяти.</span><span class="sxs-lookup"><span data-stu-id="9cae6-294">Check why your app is consuming so much memory.</span></span> <span data-ttu-id="9cae6-295">Проверьте значение параметра maxConcurrentRequestsPerProcess.</span><span class="sxs-lookup"><span data-stu-id="9cae6-295">Check maxConcurrentRequestsPerProcess setting value.</span></span> <span data-ttu-id="9cae6-296">Если для него не задано значение Infinite и выполняется большое количество запросов, увеличьте это значение, чтобы предотвратить возникновение этой ошибки.</span><span class="sxs-lookup"><span data-stu-id="9cae6-296">If its not infinite and you have a lot of requests, increase this value to prevent this error.</span></span> |
| <span data-ttu-id="9cae6-297">503</span><span class="sxs-lookup"><span data-stu-id="9cae6-297">503</span></span> |<span data-ttu-id="9cae6-298">1001</span><span class="sxs-lookup"><span data-stu-id="9cae6-298">1001</span></span> |<span data-ttu-id="9cae6-299">Не удалось отправить запрос к файлу node.exe, так как приложение перезапускается.</span><span class="sxs-lookup"><span data-stu-id="9cae6-299">Request could not be dispatched to node.exe because the application is recycling.</span></span> <span data-ttu-id="9cae6-300">После перезапуска запросы будут обработаны должным образом.</span><span class="sxs-lookup"><span data-stu-id="9cae6-300">After the application has recycled, requests should be served normally.</span></span> |
| <span data-ttu-id="9cae6-301">503</span><span class="sxs-lookup"><span data-stu-id="9cae6-301">503</span></span> |<span data-ttu-id="9cae6-302">1002</span><span class="sxs-lookup"><span data-stu-id="9cae6-302">1002</span></span> |<span data-ttu-id="9cae6-303">Проверьте фактическую причину в коде ошибки Win32. Не удается отправить запрос к файлу node.exe.</span><span class="sxs-lookup"><span data-stu-id="9cae6-303">Check win32 error code for actual reason – Request could not be dispatched to a node.exe.</span></span> |
| <span data-ttu-id="9cae6-304">503</span><span class="sxs-lookup"><span data-stu-id="9cae6-304">503</span></span> |<span data-ttu-id="9cae6-305">1003</span><span class="sxs-lookup"><span data-stu-id="9cae6-305">1003</span></span> |<span data-ttu-id="9cae6-306">Именованный канал слишком занят. Проверьте, не потребляет ли узел слишком много ресурсов ЦП.</span><span class="sxs-lookup"><span data-stu-id="9cae6-306">Named pipe is too Busy – Check if node is consuming a lot of CPU</span></span> |

<span data-ttu-id="9cae6-307">В файле node.exe содержится параметр, который называется NODE\_PENDING\_PIPE\_INSTANCES.</span><span class="sxs-lookup"><span data-stu-id="9cae6-307">There is a setting within NODE.exe called NODE\_PENDING\_PIPE\_INSTANCES.</span></span> <span data-ttu-id="9cae6-308">По умолчанию за пределами веб-приложения Azure для этого параметра задано значение 4.</span><span class="sxs-lookup"><span data-stu-id="9cae6-308">By default outside of azure webapps this value is 4.</span></span> <span data-ttu-id="9cae6-309">Это означает, что файл node.exe в именованном канале может принять только 4 запроса за раз.</span><span class="sxs-lookup"><span data-stu-id="9cae6-309">This means that node.exe can only accept 4 requests at a time on the named pipe.</span></span> <span data-ttu-id="9cae6-310">В веб-приложениях Azure для этого параметра задано значение 5000, и его достаточно для большинства приложений Node, запущенных в веб-приложениях Azure.</span><span class="sxs-lookup"><span data-stu-id="9cae6-310">On Azure Webapps, this value is set to 5000 and this value should be good enough for most node applications running on azure webapps.</span></span> <span data-ttu-id="9cae6-311">В веб-приложениях Azure для параметра NODE\_PENDING\_PIPE\_INSTANCES не используется значение 503.1003, так как для него задается наибольшее значение.</span><span class="sxs-lookup"><span data-stu-id="9cae6-311">You should not see 503.1003 on azure webapps because we have a high value for the NODE\_PENDING\_PIPE\_INSTANCES.</span></span>  |

## <a name="more-resources"></a><span data-ttu-id="9cae6-312">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="9cae6-312">More resources</span></span>
<span data-ttu-id="9cae6-313">Дополнительные сведения о приложениях Node.js в службе приложений Azure см. по следующим ссылкам.</span><span class="sxs-lookup"><span data-stu-id="9cae6-313">Follow these links to learn more about node.js applications on Azure App Service.</span></span>

* [<span data-ttu-id="9cae6-314">Приступая к работе с веб-приложениями Node.js в службе приложений Azure</span><span class="sxs-lookup"><span data-stu-id="9cae6-314">Get started with Node.js web apps in Azure App Service</span></span>](app-service-web-get-started-nodejs.md)
* [<span data-ttu-id="9cae6-315">Отладка веб-приложения Node.js в службе приложений Azure</span><span class="sxs-lookup"><span data-stu-id="9cae6-315">How to debug a Node.js web app in Azure App Service</span></span>](web-sites-nodejs-debug.md)
* [<span data-ttu-id="9cae6-316">Использование модулей Node.js с приложениями Azure</span><span class="sxs-lookup"><span data-stu-id="9cae6-316">Using Node.js Modules with Azure applications</span></span>](../nodejs-use-node-modules-azure-apps.md)
* [<span data-ttu-id="9cae6-317">Azure App Service Web Apps: Node.js (Веб-приложения службы приложений Azure: Node.js)</span><span class="sxs-lookup"><span data-stu-id="9cae6-317">Azure App Service Web Apps: Node.js</span></span>](https://blogs.msdn.microsoft.com/silverlining/2012/06/14/windows-azure-websites-node-js/)
* [<span data-ttu-id="9cae6-318">Центр разработчиков Node.js.</span><span class="sxs-lookup"><span data-stu-id="9cae6-318">Node.js Developer Center</span></span>](../nodejs-use-node-modules-azure-apps.md)
* [<span data-ttu-id="9cae6-319">Exploring the Super Secret Kudu Debug Console (Обзор сверхсекретной консоли для отладки Kudu)</span><span class="sxs-lookup"><span data-stu-id="9cae6-319">Exploring the Super Secret Kudu Debug Console</span></span>](https://azure.microsoft.com/documentation/videos/super-secret-kudu-debug-console-for-azure-web-sites/)

