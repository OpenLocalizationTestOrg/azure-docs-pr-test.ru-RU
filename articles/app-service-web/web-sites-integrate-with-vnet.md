---
title: "Интеграция приложения с виртуальной сетью Azure"
description: "В этой статье показано, как подключить приложение к новой или существующей виртуальной сети Azure."
services: app-service
documentationcenter: 
author: ccompy
manager: erikre
editor: cephalin
ms.assetid: 90bc6ec6-133d-4d87-a867-fcf77da75f5a
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/23/2017
ms.author: ccompy
ms.openlocfilehash: 61508f759cad92a8c17d72a5d68fb54994c393bc
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="integrate-your-app-with-an-azure-virtual-network"></a><span data-ttu-id="893c8-103">Интеграция приложения с виртуальной сетью Azure</span><span class="sxs-lookup"><span data-stu-id="893c8-103">Integrate your app with an Azure Virtual Network</span></span>
<span data-ttu-id="893c8-104">В этом документе описана функция службы приложений Azure — интеграция с виртуальной сетью. Кроме того, приведены инструкции по ее настройке для приложений в [службе приложений Azure](http://go.microsoft.com/fwlink/?LinkId=529714).</span><span class="sxs-lookup"><span data-stu-id="893c8-104">This document describes the Azure App Service virtual network integration feature and shows how to set it up with apps in [Azure App Service](http://go.microsoft.com/fwlink/?LinkId=529714).</span></span> <span data-ttu-id="893c8-105">Если вы не знакомы с виртуальными сетями Azure, вот краткое описание. Эта функция позволяет размещать множество ресурсов Azure в сети, недоступной из Интернета, а также самостоятельно управлять доступом к ним.</span><span class="sxs-lookup"><span data-stu-id="893c8-105">If you are unfamiliar with Azure Virtual Networks (VNets), this is a capability that allows you to place many of your Azure resources in a non-internet routeable network that you control access to.</span></span> <span data-ttu-id="893c8-106">Эти сети можно подключать к локальным сетям с помощью разных технологий VPN.</span><span class="sxs-lookup"><span data-stu-id="893c8-106">These networks can then be connected to your on-premises networks using a variety of VPN technologies.</span></span> <span data-ttu-id="893c8-107">Начать изучение виртуальных сетей Azure лучше всего со статьи [Обзор виртуальной сети][VNETOverview].</span><span class="sxs-lookup"><span data-stu-id="893c8-107">To learn more about Azure Virtual Networks, start with the information here: [Azure Virtual Network Overview][VNETOverview].</span></span> 

<span data-ttu-id="893c8-108">Служба приложений Azure реализована в виде двух моделей.</span><span class="sxs-lookup"><span data-stu-id="893c8-108">The Azure App Service has two forms.</span></span> 

1. <span data-ttu-id="893c8-109">Мультитенантные системы с поддержкой всей линейки тарифных планов</span><span class="sxs-lookup"><span data-stu-id="893c8-109">The multi-tenant systems that support the full range of pricing plans</span></span>
2. <span data-ttu-id="893c8-110">Среда службы приложений (ASE), которая развертывается в виртуальной сети клиента и предоставляет более широкие возможности.</span><span class="sxs-lookup"><span data-stu-id="893c8-110">The App Service Environment (ASE) premium feature, which deploys into your VNet.</span></span> 

<span data-ttu-id="893c8-111">В этом документе рассматривается интеграция с виртуальной сетью, а не среда службы приложений.</span><span class="sxs-lookup"><span data-stu-id="893c8-111">This document goes through VNet Integration and not App Service Environment.</span></span> <span data-ttu-id="893c8-112">Если вы хотите узнать больше о функции ASE, то начните ее изучение со статьи [Введение в среду службы приложений][ASEintro].</span><span class="sxs-lookup"><span data-stu-id="893c8-112">If you want to learn more about the ASE feature, start with the information here: [App Service Environment introduction][ASEintro].</span></span>

<span data-ttu-id="893c8-113">Интеграция с виртуальной сетью предоставляет веб-приложению доступ к ресурсам виртуальной сети, при этом само приложение остается для этой сети недоступным.</span><span class="sxs-lookup"><span data-stu-id="893c8-113">VNet Integration gives your web app access to resources in your virtual network but does not grant private access to your web app from the virtual network.</span></span> <span data-ttu-id="893c8-114">Доступ к частным сайтам подразумевает доступность приложения только из частной сети, например из виртуальной сети Azure.</span><span class="sxs-lookup"><span data-stu-id="893c8-114">Private site access refers to making your app only accessible from a private network such as from within an Azure virtual network.</span></span> <span data-ttu-id="893c8-115">Доступ к частным сайтам возможен, только если для ASE настроен внутренний балансировщик нагрузки (ILB).</span><span class="sxs-lookup"><span data-stu-id="893c8-115">Private site access is only available with an ASE configured with an Internal Load Balancer (ILB).</span></span> <span data-ttu-id="893c8-116">Дополнительные сведения об использовании ILB ASE см. в статье [Использование внутреннего балансировщика нагрузки в среде службы приложений][ILBASE].</span><span class="sxs-lookup"><span data-stu-id="893c8-116">For details on using an ILB ASE, start with the article here: [Creating and using an ILB ASE][ILBASE].</span></span> 

<span data-ttu-id="893c8-117">Обычно интеграция с виртуальной сетью используется, чтобы предоставить веб-приложению доступ к базе данных или веб-службе, которые выполняются на виртуальной машине в виртуальной сети Azure.</span><span class="sxs-lookup"><span data-stu-id="893c8-117">A common scenario where you would use VNet Integration is enabling access from your web app to a database or a web service running on a virtual machine in your Azure virtual network.</span></span> <span data-ttu-id="893c8-118">Благодаря интеграции с виртуальной сетью вам не нужно предоставлять общедоступную конечную точку приложениям, запущенным на виртуальной машине. Вместо этого будут использоваться частные адреса, недоступные из Интернета.</span><span class="sxs-lookup"><span data-stu-id="893c8-118">With VNet Integration, you don't need to expose a public endpoint for applications on your VM but can use the private non-internet routable addresses instead.</span></span> 

<span data-ttu-id="893c8-119">Интеграция с виртуальной сетью связана со следующими особенностями:</span><span class="sxs-lookup"><span data-stu-id="893c8-119">The VNet Integration feature:</span></span>

* <span data-ttu-id="893c8-120">требуется тарифный план "Стандартный", "Премиум" или "Isolated";</span><span class="sxs-lookup"><span data-stu-id="893c8-120">requires a Standard, Premium, or Isolated pricing plan</span></span> 
* <span data-ttu-id="893c8-121">работает с классической виртуальной сетью или с виртуальной сетью Resource Manager;</span><span class="sxs-lookup"><span data-stu-id="893c8-121">works with Classic or Resource Manager VNet</span></span> 
* <span data-ttu-id="893c8-122">поддерживает TCP и UDP;</span><span class="sxs-lookup"><span data-stu-id="893c8-122">supports TCP and UDP</span></span>
* <span data-ttu-id="893c8-123">поддерживается веб-приложениями, мобильными приложениями и приложениями API;</span><span class="sxs-lookup"><span data-stu-id="893c8-123">works with Web, Mobile, and API apps</span></span>
* <span data-ttu-id="893c8-124">позволяет приложению в один момент времени подключаться только к одной виртуальной сети;</span><span class="sxs-lookup"><span data-stu-id="893c8-124">enables an app to connect to only 1 VNet at a time</span></span>
* <span data-ttu-id="893c8-125">позволяет интегрировать до пяти виртуальных сетей в рамках плана службы приложений;</span><span class="sxs-lookup"><span data-stu-id="893c8-125">enables up to five VNets to be integrated with in an App Service Plan</span></span> 
* <span data-ttu-id="893c8-126">позволяет нескольким приложениям использовать одну виртуальную сеть в рамках плана службы приложений;</span><span class="sxs-lookup"><span data-stu-id="893c8-126">allows the same VNet to be used by multiple apps in an App Service Plan</span></span>
* <span data-ttu-id="893c8-127">гарантирует практически постоянную доступность ресурсов (99,9 % согласно соглашению об уровне обслуживания) благодаря использованию шлюза виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-127">supports a 99.9% SLA due to the SLA on the VNet Gateway</span></span>

<span data-ttu-id="893c8-128">Функции, не поддерживаемые при интеграции с виртуальной сетью:</span><span class="sxs-lookup"><span data-stu-id="893c8-128">There are some things that VNet Integration does not support including:</span></span>

* <span data-ttu-id="893c8-129">подключение диска;</span><span class="sxs-lookup"><span data-stu-id="893c8-129">mounting a drive</span></span>
* <span data-ttu-id="893c8-130">интеграция с AD;</span><span class="sxs-lookup"><span data-stu-id="893c8-130">AD integration</span></span> 
* <span data-ttu-id="893c8-131">NetBios;</span><span class="sxs-lookup"><span data-stu-id="893c8-131">NetBios</span></span>
* <span data-ttu-id="893c8-132">доступ к частным сайтам.</span><span class="sxs-lookup"><span data-stu-id="893c8-132">private site access</span></span>

### <a name="getting-started"></a><span data-ttu-id="893c8-133">Приступая к работе</span><span class="sxs-lookup"><span data-stu-id="893c8-133">Getting started</span></span>
<span data-ttu-id="893c8-134">Перед подключением веб-приложения к виртуальной сети обратите внимание на следующие моменты.</span><span class="sxs-lookup"><span data-stu-id="893c8-134">Here are some things to keep in mind before connecting your web app to a virtual network:</span></span>

* <span data-ttu-id="893c8-135">К виртуальной сети можно подключить только приложения тарифного плана **Стандартный**, **Премиум** или **Isolated**.</span><span class="sxs-lookup"><span data-stu-id="893c8-135">VNet Integration only works with apps in a **Standard**, **Premium**, or **Isolated** pricing plan.</span></span> <span data-ttu-id="893c8-136">Если вы включите функцию, а затем перейдете на план службы приложений, который не поддерживается, то существующие подключения между приложениями и виртуальными сетями будут разорваны.</span><span class="sxs-lookup"><span data-stu-id="893c8-136">If you enable the feature, and then scale your App Service Plan to an unsupported pricing plan your apps lose their connections to the VNets they are using.</span></span> 
* <span data-ttu-id="893c8-137">Если необходимая виртуальная сеть уже существует, перед подключением приложения в ней необходимо активировать VPN-подключение типа «точка-сеть», использующее шлюз с динамической маршрутизацией.</span><span class="sxs-lookup"><span data-stu-id="893c8-137">If your target virtual network already exists, it must have point-to-site VPN enabled with a Dynamic routing gateway before it can be connected to an app.</span></span> <span data-ttu-id="893c8-138">Если для шлюза настроена статическая маршрутизация, то подключение виртуальной частной сети типа "точка — сеть" (VPN) невозможно активировать.</span><span class="sxs-lookup"><span data-stu-id="893c8-138">If your gateway is configured with Static routing, you cannot enable point-to-site Virtual Private Network (VPN).</span></span>
* <span data-ttu-id="893c8-139">Виртуальная сеть должна относиться к той же подписке, что и план службы приложений (ASP).</span><span class="sxs-lookup"><span data-stu-id="893c8-139">The VNet must be in the same subscription as your App Service Plan(ASP).</span></span> 
* <span data-ttu-id="893c8-140">Приложения, которые интегрируются с виртуальной сетью, используют DNS-сервер, указанный для этой виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-140">The apps that integrate with a VNet use the DNS that is specified for that VNet.</span></span>
* <span data-ttu-id="893c8-141">По умолчанию трафик от подключаемых приложений направляется в виртуальную сеть только по тем маршрутам, которые определены в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-141">By default your integrating apps only route traffic into your VNet based on the routes that are defined in your VNet.</span></span> 

## <a name="enabling-vnet-integration"></a><span data-ttu-id="893c8-142">Включение интеграции с виртуальной сетью</span><span class="sxs-lookup"><span data-stu-id="893c8-142">Enabling VNet Integration</span></span>
<span data-ttu-id="893c8-143">В этом документе основное внимание уделяется интеграции с виртуальной сетью с помощью портала Azure.</span><span class="sxs-lookup"><span data-stu-id="893c8-143">This document is focused primarily on using the Azure portal for VNet Integration.</span></span> <span data-ttu-id="893c8-144">Чтобы включить интеграцию приложения с виртуальной сетью с помощью PowerShell, следуйте указаниям из статьи [Подключение приложения к виртуальной сети с помощью PowerShell][IntPowershell].</span><span class="sxs-lookup"><span data-stu-id="893c8-144">To enable VNet Integration with your app using PowerShell, follow the directions here: [Connect your app to your virtual network by using PowerShell][IntPowershell].</span></span>

<span data-ttu-id="893c8-145">Вы можете подключить приложение к имеющейся виртуальной сети или создать новую.</span><span class="sxs-lookup"><span data-stu-id="893c8-145">You have the option to connect your app to a new or existing virtual network.</span></span> <span data-ttu-id="893c8-146">Во время создания новой сети в рамках интеграции с виртуальной сетью автоматически настраивается шлюз с динамической маршрутизацией и активируется VPN-подключение типа "точка — сеть".</span><span class="sxs-lookup"><span data-stu-id="893c8-146">If you create a new network as a part of your integration, then in addition to just creating the VNet, a dynamic routing gateway is pre-configured for you and Point to Site VPN is enabled.</span></span> 

> [!NOTE]
> <span data-ttu-id="893c8-147">Настройка интеграции с новой виртуальной сетью может занять несколько минут.</span><span class="sxs-lookup"><span data-stu-id="893c8-147">Configuring a new virtual network integration can take several minutes.</span></span> 
> 
> 

<span data-ttu-id="893c8-148">Чтобы включить интеграцию с виртуальной сетью, в параметрах приложения выберите элемент "Сеть".</span><span class="sxs-lookup"><span data-stu-id="893c8-148">To enable VNet Integration, open your app Settings and then select Networking.</span></span> <span data-ttu-id="893c8-149">Вы увидите интерфейс с тремя вариантами доступа к сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-149">The UI that opens up offers three networking choices.</span></span> <span data-ttu-id="893c8-150">В этом руководстве подробно описывается только интеграция с виртуальной сетью. Использование гибридных подключений и сред службы приложений вкратце рассматривается в конце документа.</span><span class="sxs-lookup"><span data-stu-id="893c8-150">This guide is only going into VNet Integration though Hybrid Connections and App Service Environments are discussed later in this document.</span></span> 

<span data-ttu-id="893c8-151">Если тарифный план приложения не поддерживает эту функцию, то пользовательский интерфейс позволяет изменить его на более высокий.</span><span class="sxs-lookup"><span data-stu-id="893c8-151">If your app is not in the correct pricing plan, the UI enables you to scale your plan to a higher pricing plan of your choice.</span></span>

![][1]

### <a name="enabling-vnet-integration-with-a-pre-existing-vnet"></a><span data-ttu-id="893c8-152">Включение интеграции с существующей виртуальной сетью</span><span class="sxs-lookup"><span data-stu-id="893c8-152">Enabling VNet Integration with a pre-existing VNet</span></span>
<span data-ttu-id="893c8-153">Пользовательский интерфейс интеграции с виртуальной сетью позволяет делать выбор в списке виртуальных сетей.</span><span class="sxs-lookup"><span data-stu-id="893c8-153">The VNet Integration UI allows you to select from a list of your VNets.</span></span> <span data-ttu-id="893c8-154">Классические виртуальные сети обозначены словом Classic (классическая) в скобках рядом с именем виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-154">The Classic VNets indicate that they are such with the word "Classic" in parentheses next to the VNet name.</span></span> <span data-ttu-id="893c8-155">Список отсортирован так, что сначала указаны виртуальные сети Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="893c8-155">The list is sorted such that the Resource Manager VNets are listed first.</span></span> <span data-ttu-id="893c8-156">На рисунке ниже показано, что можно выбрать только одну виртуальную сеть.</span><span class="sxs-lookup"><span data-stu-id="893c8-156">In the image shown below you can see that only one VNet can be selected.</span></span> <span data-ttu-id="893c8-157">Виртуальные сети могут быть неактивными в этом списке по разным причинам, например:</span><span class="sxs-lookup"><span data-stu-id="893c8-157">There are multiple reasons that a VNet can be grayed out including:</span></span>

* <span data-ttu-id="893c8-158">виртуальная сеть относится к другой подписке, к которой имеет доступ ваша учетная запись;</span><span class="sxs-lookup"><span data-stu-id="893c8-158">the VNet is in another subscription that your account has access to</span></span>
* <span data-ttu-id="893c8-159">для виртуальной сети не активировано подключение типа "точка — сеть";</span><span class="sxs-lookup"><span data-stu-id="893c8-159">the VNet does not have Point to Site enabled</span></span>
* <span data-ttu-id="893c8-160">для виртуальной сети не настроен шлюз с динамической маршрутизацией.</span><span class="sxs-lookup"><span data-stu-id="893c8-160">the VNet does not have a dynamic routing gateway</span></span>

![][2]

<span data-ttu-id="893c8-161">Чтобы включить интеграцию, просто щелкните нужную виртуальную сеть.</span><span class="sxs-lookup"><span data-stu-id="893c8-161">To enable integration simply click on the VNet you wish to integrate with.</span></span> <span data-ttu-id="893c8-162">После выбора виртуальной сети приложение автоматически перезапускается, чтобы изменения вступили в силу.</span><span class="sxs-lookup"><span data-stu-id="893c8-162">After you select the VNet, your app is automatically restarted for the changes to take effect.</span></span> 

##### <a name="enable-point-to-site-in-a-classic-vnet"></a><span data-ttu-id="893c8-163">Включение подключения типа "точка — сеть" в классической виртуальной сети</span><span class="sxs-lookup"><span data-stu-id="893c8-163">Enable Point to Site in a Classic VNet</span></span>
<span data-ttu-id="893c8-164">Если для виртуальной сети не настроен шлюз или не активировано подключение типа "точка — сеть", то это нужно сделать до интеграции.</span><span class="sxs-lookup"><span data-stu-id="893c8-164">If your VNet does not have a gateway nor has Point to Site, then you have to set that up first.</span></span> <span data-ttu-id="893c8-165">Чтобы выполнить эту задачу для классической виртуальной сети, перейдите на [портал Azure][AzurePortal] и откройте список "Виртуальные сети (классика)".</span><span class="sxs-lookup"><span data-stu-id="893c8-165">To do this for a Classic VNet, go to the [Azure portal][AzurePortal] and bring up the list of Virtual Networks(classic).</span></span> <span data-ttu-id="893c8-166">Выберите сети для интеграции, а затем в разделе "Основные компоненты" щелкните поле "VPN-подключения".</span><span class="sxs-lookup"><span data-stu-id="893c8-166">From here, click on the network you want to integrate with and click on the big box under Essentials called VPN Connections.</span></span> <span data-ttu-id="893c8-167">Здесь вы можете создать VPN-подключение типа "точка — сеть" и настроить шлюз.</span><span class="sxs-lookup"><span data-stu-id="893c8-167">From here, you can create your point to site VPN and even have it create a gateway.</span></span> <span data-ttu-id="893c8-168">Активация созданного подключения типа "точка — сеть" и шлюза занимает около 30 минут.</span><span class="sxs-lookup"><span data-stu-id="893c8-168">After you go through the point to site with gateway creation experience it is about 30 minutes before it is ready.</span></span> 

![][8]

##### <a name="enabling-point-to-site-in-a-resource-manager-vnet"></a><span data-ttu-id="893c8-169">Включение подключения типа "точка — сеть" в виртуальной сети Resource Manager</span><span class="sxs-lookup"><span data-stu-id="893c8-169">Enabling Point to Site in a Resource Manager VNet</span></span>
<span data-ttu-id="893c8-170">Чтобы настроить виртуальную сеть Resource Manager со шлюзом и подключением типа "точка — сеть", можно использовать PowerShell, как описано в статье [Настройка подключения типа "точка — сеть" к виртуальной сети с помощью PowerShell][V2VNETP2S], или использовать портал Azure, как описано в статье [Настройка подключения типа "точка — сеть" к виртуальной сети с помощью портала Azure][V2VNETPortal].</span><span class="sxs-lookup"><span data-stu-id="893c8-170">To configure a Resource Manager VNet with a gateway and Point to Site, you can use either PowerShell as documented here, [Configure a Point-to-Site connection to a virtual network using PowerShell][V2VNETP2S] or use the Azure portal as documented here, [Configure a Point-to-Site connection to a VNet using the Azure portal][V2VNETPortal].</span></span> <span data-ttu-id="893c8-171">Пользовательский интерфейс для выполнения этой процедуры пока недоступен.</span><span class="sxs-lookup"><span data-stu-id="893c8-171">The UI to perform this capability is not yet available.</span></span> <span data-ttu-id="893c8-172">Обратите внимание, что создавать сертификаты для конфигурации "точка — сеть" не требуется.</span><span class="sxs-lookup"><span data-stu-id="893c8-172">Note that you need to create certificates for the Point to Site configuration.</span></span> <span data-ttu-id="893c8-173">Она настраивается автоматически при подключении веб-приложения к виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-173">This is automatically configured when you connect your WebApp to the VNet.</span></span> 

### <a name="creating-a-pre-configured-vnet"></a><span data-ttu-id="893c8-174">Создание предварительно настроенной виртуальной сети</span><span class="sxs-lookup"><span data-stu-id="893c8-174">Creating a pre-configured VNet</span></span>
<span data-ttu-id="893c8-175">Если вы хотите создать виртуальную сеть, для которой настроен шлюз и подключение "точка — сеть", то можно воспользоваться сетевым пользовательским интерфейсом службы приложений. Но в нем вы можете создать только виртуальную сеть Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="893c8-175">If you want to create a new VNet that is configured with a gateway and Point-to-Site, then the App Service networking UI has the capability to do that but only for a Resource Manager VNet.</span></span> <span data-ttu-id="893c8-176">Если вы хотите создать классическую виртуальную сеть со шлюзом и подключением "точка — сеть", это придется сделать вручную с помощью сетевого пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="893c8-176">If you wish to create a Classic VNet with a gateway and Point-to-Site, then you need to do this manually through the Networking user interface.</span></span> 

<span data-ttu-id="893c8-177">Чтобы создать виртуальную сеть Resource Manager с помощью интерфейса интеграции с виртуальной сетью, просто выберите пункт **Создать виртуальную сеть** и укажите следующие сведения:</span><span class="sxs-lookup"><span data-stu-id="893c8-177">To create a Resource Manager VNet through the VNet Integration UI, simply select **Create New Virtual Network** and provide the:</span></span>

* <span data-ttu-id="893c8-178">имя виртуальной сети;</span><span class="sxs-lookup"><span data-stu-id="893c8-178">Virtual Network Name</span></span>
* <span data-ttu-id="893c8-179">блок адресов виртуальной сети;</span><span class="sxs-lookup"><span data-stu-id="893c8-179">Virtual Network Address Block</span></span>
* <span data-ttu-id="893c8-180">Имя подсети</span><span class="sxs-lookup"><span data-stu-id="893c8-180">Subnet Name</span></span>
* <span data-ttu-id="893c8-181">блок адресов подсети;</span><span class="sxs-lookup"><span data-stu-id="893c8-181">Subnet Address Block</span></span>
* <span data-ttu-id="893c8-182">блок адресов шлюза;</span><span class="sxs-lookup"><span data-stu-id="893c8-182">Gateway Address Block</span></span>
* <span data-ttu-id="893c8-183">блок адресов подключения "точка-сеть".</span><span class="sxs-lookup"><span data-stu-id="893c8-183">Point-to-Site Address Block</span></span>

<span data-ttu-id="893c8-184">Если вы хотите подключать эту виртуальную сеть к любым другим сетям, то постарайтесь избежать пересечения пространств IP-адресов этих сетей.</span><span class="sxs-lookup"><span data-stu-id="893c8-184">If you want this VNet to connect to any other networks, then you should avoid picking IP address space that overlaps with those networks.</span></span> 

> [!NOTE]
> <span data-ttu-id="893c8-185">Создание виртуальной сети Resource Manager со шлюзом занимает около 30 минут. В настоящее время интеграция виртуальной сети с приложением не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="893c8-185">Resource Manager VNet creation with a gateway takes about 30 minutes and currently does not integrate the VNet with your app.</span></span> <span data-ttu-id="893c8-186">После создания виртуальной сети со шлюзом необходимо вернуться в пользовательский интерфейс интеграции с виртуальной сетью и выбрать новую виртуальную сеть.</span><span class="sxs-lookup"><span data-stu-id="893c8-186">After your VNet is created with the gateway you need to come back to your app VNet Integration UI and select your new VNet.</span></span>
> 
> 

![][3]

<span data-ttu-id="893c8-187">Виртуальные сети Azure обычно создаются с адресами, принадлежащими к диапазону частных сетей.</span><span class="sxs-lookup"><span data-stu-id="893c8-187">Azure VNets normally are created within private network addresses.</span></span> <span data-ttu-id="893c8-188">По умолчанию интеграция с виртуальной сетью направляет в виртуальную сеть весь трафик, предназначенный для этого диапазона.</span><span class="sxs-lookup"><span data-stu-id="893c8-188">By default the VNet Integration feature routes any traffic destined for those IP address ranges into your VNet.</span></span> <span data-ttu-id="893c8-189">Ниже перечислены диапазоны частных IP-адресов:</span><span class="sxs-lookup"><span data-stu-id="893c8-189">The private IP address ranges are:</span></span>

* <span data-ttu-id="893c8-190">10.0.0.0/8 — соответствует диапазону 10.0.0.0–10.255.255.255;</span><span class="sxs-lookup"><span data-stu-id="893c8-190">10.0.0.0/8 - this is the same as 10.0.0.0 - 10.255.255.255</span></span>
* <span data-ttu-id="893c8-191">172.16.0.0/12 — соответствует диапазону 172.16.0.0–172.31.255.255;</span><span class="sxs-lookup"><span data-stu-id="893c8-191">172.16.0.0/12 - this is the same as 172.16.0.0 - 172.31.255.255</span></span> 
* <span data-ttu-id="893c8-192">192.168.0.0/16 — соответствует диапазону 192.168.0.0–192.168.255.255.</span><span class="sxs-lookup"><span data-stu-id="893c8-192">192.168.0.0/16 - this is the same as 192.168.0.0 - 192.168.255.255</span></span>

<span data-ttu-id="893c8-193">Адресное пространство виртуальной сети определяется в нотации CIDR.</span><span class="sxs-lookup"><span data-stu-id="893c8-193">The VNet address space needs to be specified in CIDR notation.</span></span> <span data-ttu-id="893c8-194">Если вы не знакомы с нотацией CIDR, это метод определения блоков адресов с использованием IP-адреса и целого числа, представляющего маску подсети.</span><span class="sxs-lookup"><span data-stu-id="893c8-194">If you are unfamiliar with CIDR notation, it is a method for specifying address blocks using an IP address and an integer that represents the network mask.</span></span> <span data-ttu-id="893c8-195">Например, запись 10.1.0.0/24 представляет 256 адресов, а запись 10.1.0.0/25 — 128 адресов.</span><span class="sxs-lookup"><span data-stu-id="893c8-195">As a quick reference, consider that 10.1.0.0/24 would be 256 addresses and 10.1.0.0/25 would be 128 addresses.</span></span> <span data-ttu-id="893c8-196">Для протокола IPv4 маска /32 представляет только один адрес.</span><span class="sxs-lookup"><span data-stu-id="893c8-196">An IPv4 address with a /32 would be just 1 address.</span></span> 

<span data-ttu-id="893c8-197">Здесь вы можете указать сведения о DNS-сервере, чтобы настроить его для своей виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-197">If you set the DNS server information here, then that is set for your VNet.</span></span> <span data-ttu-id="893c8-198">После создания виртуальной сети вы сможете изменить эти данные через пользовательский интерфейс сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-198">After VNet creation you can edit this information from the VNet user experiences.</span></span> <span data-ttu-id="893c8-199">Если изменить DNS виртуальной сети, то необходимо выполнить операцию "Синхронизировать сеть".</span><span class="sxs-lookup"><span data-stu-id="893c8-199">If you change the DNS of the VNet, then you need to perform a Sync Network operation.</span></span>

<span data-ttu-id="893c8-200">Классическая виртуальная сеть, созданная через интерфейс интеграции с виртуальной сетью, включается в ту же группу ресурсов, что и ваше приложение.</span><span class="sxs-lookup"><span data-stu-id="893c8-200">When you create a Classic VNet using the VNet Integration UI, it creates a VNet in the same resource group as your app.</span></span> 

## <a name="how-the-system-works"></a><span data-ttu-id="893c8-201">Принципы работы системы</span><span class="sxs-lookup"><span data-stu-id="893c8-201">How the system works</span></span>
<span data-ttu-id="893c8-202">Эта функция подключает ваше приложение к виртуальной сети, используя технологию VPN "точка — сеть".</span><span class="sxs-lookup"><span data-stu-id="893c8-202">Under the covers this feature builds on top of Point-to-Site VPN technology to connect your app to your VNet.</span></span> <span data-ttu-id="893c8-203">Приложения в службе приложений Azure имеют мультитенантную архитектуру, которая не позволяет подготовить приложение непосредственно в виртуальной сети, как это происходит с виртуальными машинами.</span><span class="sxs-lookup"><span data-stu-id="893c8-203">Apps in Azure App Service have a multi-tenant system architecture, which precludes provisioning an app directly in a VNet as is done with virtual machines.</span></span> <span data-ttu-id="893c8-204">Технология «точка-сеть» ограничивает доступ к сети средой виртуальной машины, на которой размещено веб-приложение.</span><span class="sxs-lookup"><span data-stu-id="893c8-204">By building on point-to-site technology we limit network access to just the virtual machine hosting the app.</span></span> <span data-ttu-id="893c8-205">В дальнейшем доступ к сети ограничивается этими узлами приложений. Приложения получат доступ только к тем сетям, которые вы укажете в настройках.</span><span class="sxs-lookup"><span data-stu-id="893c8-205">Access to the network is further restricted on those app hosts so that your apps can only access the networks that you configure them to access.</span></span> 

![][4]

<span data-ttu-id="893c8-206">Если в виртуальной сети не настроен DNS-сервер, то для доступа к ресурсу в виртуальной сети приложению придется использовать IP-адреса.</span><span class="sxs-lookup"><span data-stu-id="893c8-206">If you haven’t configured a DNS server with your virtual network, your app will need to use IP addresses to reach resource in the VNet.</span></span> <span data-ttu-id="893c8-207">Помните, что основное преимущество интеграции с виртуальной сетью представлено возможностью использовать частные адреса, выделенные в частной сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-207">While using IP addresses, remember that the major benefit of this feature is that it enables you to use the private addresses within your private network.</span></span> <span data-ttu-id="893c8-208">Если настройки приложения позволяют ему обращаться к любой из виртуальных машин по общедоступным IP-адресам, это значит, что обмен данными происходит через Интернет, а не с помощью интеграции с виртуальной сетью.</span><span class="sxs-lookup"><span data-stu-id="893c8-208">If you set your app up to use public IP addresses for one of your VMs, then you aren't using the VNet Integration feature and are communicating over the internet.</span></span>

## <a name="managing-the-vnet-integrations"></a><span data-ttu-id="893c8-209">Управление интеграцией с виртуальной сетью</span><span class="sxs-lookup"><span data-stu-id="893c8-209">Managing the VNet Integrations</span></span>
<span data-ttu-id="893c8-210">Возможность подключаться к виртуальной сети и отключаться от нее реализуется на уровне приложения.</span><span class="sxs-lookup"><span data-stu-id="893c8-210">The ability to connect and disconnect to a VNet is at an app level.</span></span> <span data-ttu-id="893c8-211">Операции, которые могут повлиять на интеграцию нескольких приложений с виртуальной сетью, выполняются на уровне плана ASP.</span><span class="sxs-lookup"><span data-stu-id="893c8-211">Operations that can affect the VNet Integration across multiple apps are at an ASP level.</span></span> <span data-ttu-id="893c8-212">Пользовательский интерфейс на уровне приложения предоставляет информацию о виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-212">From the UI that is shown at the app level, you can get details on your VNet.</span></span> <span data-ttu-id="893c8-213">Большая часть этой информации доступна и на уровне плана ASP.</span><span class="sxs-lookup"><span data-stu-id="893c8-213">Most of the same information is also shown at the ASP level.</span></span> 

![][5]

<span data-ttu-id="893c8-214">На странице состояния сетевых компонентов вы можете отследить, подключено ли приложение к виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-214">From the Network Feature Status page, you can see if your app is connected to your VNet.</span></span> <span data-ttu-id="893c8-215">Если шлюз виртуальной сети по какой-либо причине не работает, здесь будет указано, что подключение не установлено.</span><span class="sxs-lookup"><span data-stu-id="893c8-215">If your VNet gateway is down for whatever reason, then this would show as not-connected.</span></span> 

<span data-ttu-id="893c8-216">Теперь в пользовательском интерфейсе интеграции с виртуальной сетью на уровне приложения отображаются те же сведения, что и на уровне ASP.</span><span class="sxs-lookup"><span data-stu-id="893c8-216">The information you now have available to you in the app level VNet Integration UI is the same as the detail information you get from the ASP.</span></span> <span data-ttu-id="893c8-217">Они представлены ниже.</span><span class="sxs-lookup"><span data-stu-id="893c8-217">Here are those items:</span></span>

* <span data-ttu-id="893c8-218">Имя виртуальной сети. Эта ссылка открывает окно пользовательского интерфейса виртуальной сети Azure.</span><span class="sxs-lookup"><span data-stu-id="893c8-218">VNet Name - This link opens the Azure virtual network UI</span></span>
* <span data-ttu-id="893c8-219">Расположение. Здесь указано расположение виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-219">Location - This reflects the location of your VNet.</span></span> <span data-ttu-id="893c8-220">Вы можете подключиться к сети в другом расположении.</span><span class="sxs-lookup"><span data-stu-id="893c8-220">It is possible to integrate with a VNet in another location.</span></span>
* <span data-ttu-id="893c8-221">Состояние сертификата. Для защиты VPN-подключения между приложением и виртуальной сетью используются сертификаты.</span><span class="sxs-lookup"><span data-stu-id="893c8-221">Certificate Status - There are certificates used to secure the VPN connection between the app and the VNet.</span></span> <span data-ttu-id="893c8-222">Здесь вы можете проверить, синхронизированы ли они.</span><span class="sxs-lookup"><span data-stu-id="893c8-222">This reflects a test to ensure they are in sync.</span></span>
* <span data-ttu-id="893c8-223">Состояние шлюза. Если по какой-либо причине шлюз не работает, приложение не сможет получить доступ к ресурсам в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-223">Gateway Status - Should your gateways be down for whatever reason then your app cannot access resources in the VNet.</span></span> 
* <span data-ttu-id="893c8-224">Адресное пространство виртуальной сети. Здесь указаны IP-адреса, которые используются в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-224">VNet address space - This is the IP address space for your VNet.</span></span> 
* <span data-ttu-id="893c8-225">Адресное пространство "точка — сеть". Здесь указаны IP-адреса, которые используются при подключении типа "точка — сеть" к виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-225">Point to Site address space - This is the point to site IP address space for your VNet.</span></span> <span data-ttu-id="893c8-226">Для обмена данными приложение использует один из IP-адресов этого адресного пространства.</span><span class="sxs-lookup"><span data-stu-id="893c8-226">Your app shows communication as coming from one of the IPs in this address space.</span></span> 
* <span data-ttu-id="893c8-227">Адресное пространство "сеть — сеть". VPN-подключение типа "сеть — сеть" можно использовать для подключения виртуальной сети к ресурсам в локальной сети или к другим виртуальным сетям.</span><span class="sxs-lookup"><span data-stu-id="893c8-227">Site to site address space - You can use Site to Site VPNs to connect your VNet to your on-premises resources or to other VNet.</span></span> <span data-ttu-id="893c8-228">Если вы используете эту функцию, то здесь отображаются диапазоны IP-адресов, определенные для этого VPN-подключения.</span><span class="sxs-lookup"><span data-stu-id="893c8-228">Should you have that configured then the IP ranges defined with that VPN connection shows here.</span></span>
* <span data-ttu-id="893c8-229">DNS-серверы. Здесь перечислены DNS-серверы, настроенные для виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-229">DNS Servers - If you have DNS Servers configured with your VNet, then they are listed here.</span></span>
* <span data-ttu-id="893c8-230">IP-адреса маршрутизации в виртуальную сеть. Для некоторых IP-адресов в виртуальной сети можно определить маршрутизацию. Такие адреса отображаются здесь.</span><span class="sxs-lookup"><span data-stu-id="893c8-230">IPs routed to the VNet - There are a list of IP addresses that your VNet has routing defined for, and those addresses show here.</span></span> 

<span data-ttu-id="893c8-231">В представлении интеграции с виртуальной сетью на уровне приложения можно выполнить только одну операцию — отключить приложение от той виртуальной сети, к которой оно сейчас подключено.</span><span class="sxs-lookup"><span data-stu-id="893c8-231">The only operation you can take in the app view of your VNet Integration is to disconnect your app from the VNet it is currently connected to.</span></span> <span data-ttu-id="893c8-232">Для этого щелкните вверху значок «Отключить».</span><span class="sxs-lookup"><span data-stu-id="893c8-232">To do this simply click Disconnect at the top.</span></span> <span data-ttu-id="893c8-233">Это действие не изменяет настройки виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-233">This action does not change your VNet.</span></span> <span data-ttu-id="893c8-234">Конфигурация виртуальной сети, включая настроенные шлюзы, останется неизменной.</span><span class="sxs-lookup"><span data-stu-id="893c8-234">The VNet and its configuration including the gateways remains unchanged.</span></span> <span data-ttu-id="893c8-235">Если вы хотите удалить виртуальную сеть, необходимо сначала удалить все ее ресурсы, включая шлюзы.</span><span class="sxs-lookup"><span data-stu-id="893c8-235">If you then want to delete your VNet, you need to first delete the resources in it including the gateways.</span></span> 

<span data-ttu-id="893c8-236">В представлении плана службы приложений доступны несколько дополнительных операций.</span><span class="sxs-lookup"><span data-stu-id="893c8-236">The App Service Plan view has a number of additional operations.</span></span> <span data-ttu-id="893c8-237">Доступ к этому представлению осуществляется не через приложение.</span><span class="sxs-lookup"><span data-stu-id="893c8-237">It is also accessed differently than from the app.</span></span> <span data-ttu-id="893c8-238">Чтобы открыть сетевой пользовательский интерфейс ASP, зайдите в основной пользовательский интерфейс ASP и прокрутите страницу вниз.</span><span class="sxs-lookup"><span data-stu-id="893c8-238">To reach the ASP Networking UI simply open your ASP UI and scroll down.</span></span> <span data-ttu-id="893c8-239">Здесь вы увидите элемент интерфейса «Состояние компонентов сети».</span><span class="sxs-lookup"><span data-stu-id="893c8-239">There is a UI element called Network Feature Status.</span></span> <span data-ttu-id="893c8-240">Он содержит некоторые краткие сведения, имеющие отношение к интеграции с виртуальной сетью.</span><span class="sxs-lookup"><span data-stu-id="893c8-240">It gives some minor details around your VNet Integration.</span></span> <span data-ttu-id="893c8-241">Щелкнув этот элемент, вы откроете пользовательский интерфейс состояния компонентов сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-241">Clicking on this UI opens the Network Feature Status UI.</span></span> <span data-ttu-id="893c8-242">Ссылка "Щелкните здесь для управления" открывает раздел со списком подключений к виртуальным сетям в рамках плана ASP.</span><span class="sxs-lookup"><span data-stu-id="893c8-242">If you then click on "Click here to manage", the UI that lists the VNet Integrations in this ASP opens.</span></span>

![][6]

<span data-ttu-id="893c8-243">Оценивая расположение виртуальных сетей, с которыми осуществляется обмен данными, важно помнить о расположении самого плана ASP.</span><span class="sxs-lookup"><span data-stu-id="893c8-243">The location of the ASP is good to remember when looking at the locations of the VNets you are integrating with.</span></span> <span data-ttu-id="893c8-244">Подключение к виртуальной сети в другом расположении может сопровождаться задержками.</span><span class="sxs-lookup"><span data-stu-id="893c8-244">When the VNet is in another location you are far more likely to see latency issues.</span></span> 

<span data-ttu-id="893c8-245">Список подключенных виртуальных сетей позволяет отслеживать текущее количество виртуальных сетей, к которым подключены приложения в рамках плана ASP, а также максимально возможное количество таких подключений.</span><span class="sxs-lookup"><span data-stu-id="893c8-245">The VNets integrated with is a reminder on how many VNets your apps are integrated with in this ASP and how many you can have.</span></span> 

<span data-ttu-id="893c8-246">Дополнительную информацию о каждой виртуальной сети можно получить, щелкнув ее имя.</span><span class="sxs-lookup"><span data-stu-id="893c8-246">To see added details on each VNet, just click on the VNet you are interested in.</span></span> <span data-ttu-id="893c8-247">Помимо описанных выше сведений вы можете увидеть список приложений, которые подключены к этой сети в рамках плана ASP.</span><span class="sxs-lookup"><span data-stu-id="893c8-247">In addition to the details that were noted earlier, you can also see a list of the apps in this ASP that are using that VNet.</span></span> 

<span data-ttu-id="893c8-248">Здесь вы можете выполнить два действия.</span><span class="sxs-lookup"><span data-stu-id="893c8-248">With respect to actions there are two primary actions.</span></span> <span data-ttu-id="893c8-249">Во-первых, вы можете добавлять маршруты, по которым трафик от приложения будет направляться к виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-249">The first is the ability to add routes that drive traffic leaving your app into your VNet.</span></span> <span data-ttu-id="893c8-250">Во-вторых, вы можете синхронизировать сертификаты и сведения о сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-250">The second action is the ability to sync certificates and network information.</span></span>

![][7]

<span data-ttu-id="893c8-251">**Маршрутизация**. Как указано выше, для перенаправления трафика от приложения к виртуальной сети используются маршруты, которые определены в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-251">**Routing** As noted earlier the routes that are defined in your VNet are what is used for directing traffic into your VNet from your app.</span></span> <span data-ttu-id="893c8-252">В некоторых случаях пользователям нужно отправлять из приложения в виртуальную сеть дополнительный исходящий трафик. Маршрутизация позволяет решить эту задачу.</span><span class="sxs-lookup"><span data-stu-id="893c8-252">There are some uses though where customers want to send additional outbound traffic from an app into the VNet and for them this capability is provided.</span></span> <span data-ttu-id="893c8-253">Дальнейшие действия с трафиком зависят от того, как пользователь настроил виртуальную сеть.</span><span class="sxs-lookup"><span data-stu-id="893c8-253">What happens to the traffic after that is up to how the customer configures their VNet.</span></span> 

<span data-ttu-id="893c8-254">**Сертификаты**. Состояние сертификатов отображает результаты проверки, которую выполняет служба приложений. Цель этой проверки — оценка пригодности сертификатов, используемых для VPN-подключения.</span><span class="sxs-lookup"><span data-stu-id="893c8-254">**Certificates** The Certificate Status reflects a check being performed by the App Service to validate that the certificates that we are using for the VPN connection are still good.</span></span> <span data-ttu-id="893c8-255">При первой интеграции любого приложения в рамках ASP с виртуальной сетью происходит обязательный обмен сертификатами для обеспечения безопасности подключения.</span><span class="sxs-lookup"><span data-stu-id="893c8-255">When VNet Integration enabled, then if this is the first integration to that VNet from any apps in this ASP, there is a required exchange of certificates to ensure the security of the connection.</span></span> <span data-ttu-id="893c8-256">Одновременно с сертификатами мы получаем конфигурацию DNS, маршруты и другую полезную информацию о сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-256">Along with the certificates we get the DNS configuration, routes and other similar things that describe the network.</span></span>
<span data-ttu-id="893c8-257">Если сертификаты или сведения о сети изменились, то щелкните элемент "Синхронизировать сеть".</span><span class="sxs-lookup"><span data-stu-id="893c8-257">If those certificates or network information is changed, then you need to click "Sync Network".</span></span> <span data-ttu-id="893c8-258">**Примечание**. Выполнение синхронизации с сетью сопровождается кратковременной потерей подключения между приложением и виртуальной сетью.</span><span class="sxs-lookup"><span data-stu-id="893c8-258">**NOTE**: When you click "Sync Network" then you cause a brief outage in connectivity between your app and your VNet.</span></span> <span data-ttu-id="893c8-259">Хотя приложение не перезапускается, потеря подключения может привести к нарушению его работоспособности.</span><span class="sxs-lookup"><span data-stu-id="893c8-259">While your app is not restarted, the loss of connectivity could cause your site to not function properly.</span></span> 

## <a name="accessing-on-premises-resources"></a><span data-ttu-id="893c8-260">Доступ к локальным ресурсам</span><span class="sxs-lookup"><span data-stu-id="893c8-260">Accessing on-premises resources</span></span>
<span data-ttu-id="893c8-261">Одним из преимуществ использования интеграции с виртуальной сетью является возможность подключения виртуальной сети к локальной сети через VPN-подключение типа "сеть — сеть". Благодаря этому приложение получает доступ к локальным ресурсам.</span><span class="sxs-lookup"><span data-stu-id="893c8-261">One of the benefits of the VNet Integration feature is that if your VNet is connected to your on-premises network with a Site to Site VPN then your apps can have access to your on-premises resources from your app.</span></span> <span data-ttu-id="893c8-262">Для слаженной работы вам может понадобиться обновить маршруты для диапазона адресов "точка — сеть" в локальном VPN-шлюзе.</span><span class="sxs-lookup"><span data-stu-id="893c8-262">For this to work though you may need to update your on-premises VPN gateway with the routes for your Point to Site IP range.</span></span> <span data-ttu-id="893c8-263">При первой настройке VPN-подключения «сеть-сеть» с использованием скриптов нужно настроить маршруты, в том числе для VPN-подключения «точка-сеть».</span><span class="sxs-lookup"><span data-stu-id="893c8-263">When the Site to Site VPN is first set up then the scripts used to configure it should set up routes including your Point to Site VPN.</span></span> <span data-ttu-id="893c8-264">Если VPN-подключение типа "точка — сеть" добавлено после создания VPN-подключения типа "сеть — сеть", то маршруты нужно обновить вручную.</span><span class="sxs-lookup"><span data-stu-id="893c8-264">If you add the Point to Site VPN after you create your Site to Site VPN, then you need to update the routes manually.</span></span> <span data-ttu-id="893c8-265">Эта процедура отличается для разных типов шлюзов, поэтому здесь мы ее не рассматриваем.</span><span class="sxs-lookup"><span data-stu-id="893c8-265">Details on how to do that vary per gateway and are not described here.</span></span> 

> [!NOTE]
> <span data-ttu-id="893c8-266">Функция интеграции c виртуальной сетью не предусматривает интеграции приложения с виртуальной сетью, в которой установлен шлюз ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="893c8-266">The VNet Integration feature does not integrate an app with a VNet that has an ExpressRoute Gateway.</span></span> <span data-ttu-id="893c8-267">Даже если шлюз ExpressRoute настроен в [режиме сосуществования][VPNERCoex], функция интеграции c виртуальной сетью работать не будет.</span><span class="sxs-lookup"><span data-stu-id="893c8-267">Even if the ExpressRoute Gateway is configured in [coexistence mode][VPNERCoex] the VNet Integration does not work.</span></span> <span data-ttu-id="893c8-268">Если требуется получить доступ к ресурсам через соединение ExpressRoute, можно использовать [среду службы приложений][ASE], которая работает в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-268">If you need to access resources through an ExpressRoute connection, then you can use an [App Service Environment][ASE], which runs in your VNet.</span></span>
> 
> 

## <a name="pricing-details"></a><span data-ttu-id="893c8-269">Сведения о тарифах</span><span class="sxs-lookup"><span data-stu-id="893c8-269">Pricing details</span></span>
<span data-ttu-id="893c8-270">Есть несколько нюансов тарификации, которые следует учитывать при использовании интеграции с виртуальной сетью.</span><span class="sxs-lookup"><span data-stu-id="893c8-270">There are a few pricing nuances that you should be aware of when using the VNet Integration feature.</span></span> <span data-ttu-id="893c8-271">Использование этой функции связано со следующими расходами:</span><span class="sxs-lookup"><span data-stu-id="893c8-271">There are 3 related charges to the use of this feature:</span></span>

* <span data-ttu-id="893c8-272">требования к ценовой категории плана ASP;</span><span class="sxs-lookup"><span data-stu-id="893c8-272">ASP pricing tier requirements</span></span>
* <span data-ttu-id="893c8-273">расходы, связанные с передачей данных;</span><span class="sxs-lookup"><span data-stu-id="893c8-273">Data transfer costs</span></span>
* <span data-ttu-id="893c8-274">расходы, связанные с использованием VPN-шлюза.</span><span class="sxs-lookup"><span data-stu-id="893c8-274">VPN Gateway costs.</span></span>

<span data-ttu-id="893c8-275">Использовать эту функцию могут только те приложения, которые входят в план службы приложений класса «Стандартный» или «Премиум».</span><span class="sxs-lookup"><span data-stu-id="893c8-275">For your apps to be able to use this feature, they need to be in a Standard or Premium App Service Plan.</span></span> <span data-ttu-id="893c8-276">Дополнительные сведения о ценах на планы см. на странице [цен на службу приложений][ASPricing].</span><span class="sxs-lookup"><span data-stu-id="893c8-276">You can see more details on those costs here: [App Service Pricing][ASPricing].</span></span> 

<span data-ttu-id="893c8-277">Из-за особенностей VPN-подключения типа "точка — сеть" трафик всегда тарифицируется как исходящий при подключении к виртуальной сети, даже если виртуальная сеть находится в том же центре обработки данных.</span><span class="sxs-lookup"><span data-stu-id="893c8-277">Due to the way Point to Site VPNs are handled, you always have a charge for outbound data through your VNet Integration connection even if the VNet is in the same data center.</span></span> <span data-ttu-id="893c8-278">Узнать соответствующие расценки можно на странице [Сведения о ценах — передача данных][DataPricing].</span><span class="sxs-lookup"><span data-stu-id="893c8-278">To see what those charges are, take a look here: [Data Transfer Pricing Details][DataPricing].</span></span> 

<span data-ttu-id="893c8-279">И последний компонент, определяющий стоимость услуги, — это расходы, связанные с использованием шлюзов виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-279">The last item is the cost of the VNet gateways.</span></span> <span data-ttu-id="893c8-280">Если шлюзы не используются для других целей, например для VPN-подключения типа "сеть — сеть", то вы платите только за использование шлюзов в рамках поддержки интеграции с виртуальной сетью.</span><span class="sxs-lookup"><span data-stu-id="893c8-280">If you don't need the gateways for something else such as Site to Site VPNs, then you are paying for gateways to support the VNet Integration feature.</span></span> <span data-ttu-id="893c8-281">Сведения о связанных расценках см. на странице [Цены — VPN-шлюзы][VNETPricing].</span><span class="sxs-lookup"><span data-stu-id="893c8-281">There are details on those costs here: [VPN Gateway Pricing][VNETPricing].</span></span> 

## <a name="troubleshooting"></a><span data-ttu-id="893c8-282">Устранение неполадок</span><span class="sxs-lookup"><span data-stu-id="893c8-282">Troubleshooting</span></span>
<span data-ttu-id="893c8-283">Простота настройки этой функции не гарантирует отсутствия проблем при ее использовании.</span><span class="sxs-lookup"><span data-stu-id="893c8-283">While the feature is easy to set up, that doesn't mean that your experience will be problem free.</span></span> <span data-ttu-id="893c8-284">При проблемах с доступом к нужной конечной точке можно воспользоваться некоторыми служебными программами для проверки подключения из консоли приложения.</span><span class="sxs-lookup"><span data-stu-id="893c8-284">Should you encounter problems accessing your desired endpoint there are some utilities you can use to test connectivity from the app console.</span></span> <span data-ttu-id="893c8-285">Есть два варианта использования консоли:</span><span class="sxs-lookup"><span data-stu-id="893c8-285">There are two console experiences you can use.</span></span> <span data-ttu-id="893c8-286">консоль Kudu и консоль на портале Azure.</span><span class="sxs-lookup"><span data-stu-id="893c8-286">One is from the Kudu console and the other is the console that you can reach in the Azure portal.</span></span> <span data-ttu-id="893c8-287">Чтобы открыть консоль Kudu из приложения, щелкните "Сервис" -> "Kudu".</span><span class="sxs-lookup"><span data-stu-id="893c8-287">To get to the Kudu console from your app go to Tools -> Kudu.</span></span> <span data-ttu-id="893c8-288">Этот же интерфейс доступен по адресу [имя_сайта].scm.azurewebsites.net.</span><span class="sxs-lookup"><span data-stu-id="893c8-288">This is the same as going to [sitename].scm.azurewebsites.net.</span></span> <span data-ttu-id="893c8-289">В консоли перейдите на вкладку отладки. Чтобы воспользоваться консолью на портале Azure, откройте меню «Сервис» -> «Консоль».</span><span class="sxs-lookup"><span data-stu-id="893c8-289">Once that opens simply go to the Debug console tab. To get to the Azure portal hosted console then from your app go to Tools -> Console.</span></span> 

#### <a name="tools"></a><span data-ttu-id="893c8-290">Средства</span><span class="sxs-lookup"><span data-stu-id="893c8-290">Tools</span></span>
<span data-ttu-id="893c8-291">Средства ping, nslookup и tracert нельзя использовать в консоли из-за ограничений безопасности.</span><span class="sxs-lookup"><span data-stu-id="893c8-291">The tools ping, nslookup and tracert won’t work through the console due to security constraints.</span></span> <span data-ttu-id="893c8-292">Чтобы компенсировать это, добавлены два других средства.</span><span class="sxs-lookup"><span data-stu-id="893c8-292">To fill the void there have been two separate tools added.</span></span> <span data-ttu-id="893c8-293">Для проверки работоспособности DNS мы добавили средство nameresolver.exe.</span><span class="sxs-lookup"><span data-stu-id="893c8-293">In order to test DNS functionality we added a tool named nameresolver.exe.</span></span> <span data-ttu-id="893c8-294">Синтаксис:</span><span class="sxs-lookup"><span data-stu-id="893c8-294">The syntax is:</span></span>

    nameresolver.exe hostname [optional: DNS Server]

<span data-ttu-id="893c8-295">Nameresolver можно использовать для проверки имен узлов, которые использует ваше приложение.</span><span class="sxs-lookup"><span data-stu-id="893c8-295">You can use nameresolver to check the hostnames that your app depends on.</span></span> <span data-ttu-id="893c8-296">Так вы сможете обнаружить ошибки в настройке DNS-сервера или проблемы с доступом к DNS-серверу.</span><span class="sxs-lookup"><span data-stu-id="893c8-296">This way you can test if you have anything mis-configured with your DNS or perhaps don't have access to your DNS server.</span></span>

<span data-ttu-id="893c8-297">Следующее средство позволяет проверить подключение к комбинации «узел:порт» по протоколу TCP.</span><span class="sxs-lookup"><span data-stu-id="893c8-297">The next tool allows you to test for TCP connectivity to a host and port combination.</span></span> <span data-ttu-id="893c8-298">Это средство называется tcpping.exe и имеет следующий синтаксис:</span><span class="sxs-lookup"><span data-stu-id="893c8-298">This tool is called tcpping.exe and the syntax is:</span></span>

    tcpping.exe hostname [optional: port]

<span data-ttu-id="893c8-299">Служебная программа tcpping сообщает, возможно ли получить доступ к определенному узлу и порту.</span><span class="sxs-lookup"><span data-stu-id="893c8-299">The tcpping utility tells you if you can reach a specific host and port.</span></span> <span data-ttu-id="893c8-300">Сообщение об успешном выполнении отображается только с том случае, когда приложение ожидает передачи данных от комбинации "узел:порт", а также есть доступ по сети из приложения к указанным узлу и порту.</span><span class="sxs-lookup"><span data-stu-id="893c8-300">It only can show success if: there is an application listening at the host and port combination, and there is network access from your app to the specified host and port.</span></span>

#### <a name="debugging-access-to-vnet-hosted-resources"></a><span data-ttu-id="893c8-301">Доступ к ресурсам виртуальной сети для отладки</span><span class="sxs-lookup"><span data-stu-id="893c8-301">Debugging access to VNet hosted resources</span></span>
<span data-ttu-id="893c8-302">У приложения могут возникнуть проблемы с доступом к определенной комбинации «узел:порт». Это происходит по многим причинам.</span><span class="sxs-lookup"><span data-stu-id="893c8-302">There are a number of things that can prevent your app from reaching a specific host and port.</span></span> <span data-ttu-id="893c8-303">Вот три наиболее распространенные причины:</span><span class="sxs-lookup"><span data-stu-id="893c8-303">Most of the time it is one of three things:</span></span>

* <span data-ttu-id="893c8-304">**В пути есть брандмауэр**. Если вы используете брандмауэр, то может быть превышено время ожидания TCP.</span><span class="sxs-lookup"><span data-stu-id="893c8-304">**There is a firewall in the way** If you have a firewall in the way, you will hit the TCP timeout.</span></span> <span data-ttu-id="893c8-305">В нашем случае это 21 секунда.</span><span class="sxs-lookup"><span data-stu-id="893c8-305">That is 21 seconds in this case.</span></span> <span data-ttu-id="893c8-306">Проверьте подключение с помощью средства tcpping.</span><span class="sxs-lookup"><span data-stu-id="893c8-306">Use the tcpping tool to test connectivity.</span></span> <span data-ttu-id="893c8-307">Время ожидания TCP может превышаться и по многим другим причинам, но начать стоит именно с этой.</span><span class="sxs-lookup"><span data-stu-id="893c8-307">TCP timeouts can be due to many things beyond firewalls but start there.</span></span> 
* <span data-ttu-id="893c8-308">**Служба DNS недоступна**. Время ожидания для DNS составляет три секунды на каждый DNS-сервер.</span><span class="sxs-lookup"><span data-stu-id="893c8-308">**DNS is not accessible** The DNS timeout is three seconds per DNS server.</span></span> <span data-ttu-id="893c8-309">Если у вас два DNS-сервера, то время ожидания составляет 6 секунд.</span><span class="sxs-lookup"><span data-stu-id="893c8-309">If you have two DNS servers, the timeout is 6 seconds.</span></span> <span data-ttu-id="893c8-310">Используйте средство nameresolver для проверки работы DNS.</span><span class="sxs-lookup"><span data-stu-id="893c8-310">Use nameresolver to see if DNS is working.</span></span> <span data-ttu-id="893c8-311">Помните, что средство nslookup не подходит для проверки, так как оно игнорирует настройки DNS для виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-311">Remember you can't use nslookup as that does not use the DNS your VNet is configured with.</span></span>
* <span data-ttu-id="893c8-312">**Недопустимый диапазон IP-адресов P2S**. Диапазон IP-адресов для подключения "точка — сеть" должен находиться в диапазоне частных IP-адресов согласно RFC 1918 (10.0.0.0–10.255.255.255, 172.16.0.0–172.31.255.255, 192.168.0.0–192.168.255.255).</span><span class="sxs-lookup"><span data-stu-id="893c8-312">**Invalid P2S IP range** The point to site IP range needs to be in the RFC 1918 private IP ranges (10.0.0.0-10.255.255.255 / 172.16.0.0-172.31.255.255 / 192.168.0.0-192.168.255.255).</span></span> <span data-ttu-id="893c8-313">Если использовать IP-адреса вне этих диапазонов, то подключение не будет работать.</span><span class="sxs-lookup"><span data-stu-id="893c8-313">If the range uses IPs outside of that, then things won't work.</span></span> 

<span data-ttu-id="893c8-314">Если эти рекомендации не помогут вам решить проблему, проверьте еще несколько простых вещей.</span><span class="sxs-lookup"><span data-stu-id="893c8-314">If those items don't answer your problem, look first for the simple things like:</span></span> 

* <span data-ttu-id="893c8-315">Отображается ли на портале шлюз в рабочем состоянии?</span><span class="sxs-lookup"><span data-stu-id="893c8-315">Does the Gateway show as being up in the portal?</span></span>
* <span data-ttu-id="893c8-316">Синхронизированы ли сертификаты?</span><span class="sxs-lookup"><span data-stu-id="893c8-316">Do certificates show as being in sync?</span></span>
* <span data-ttu-id="893c8-317">Менялась ли конфигурация сети после последнего выполнения синхронизации с сетью для соответствующих планов ASP?</span><span class="sxs-lookup"><span data-stu-id="893c8-317">Did anybody change the network configuration without doing a "Sync Network" in the affected ASPs?</span></span> 

<span data-ttu-id="893c8-318">Если шлюз не работает, восстановите его работоспособность.</span><span class="sxs-lookup"><span data-stu-id="893c8-318">If your gateway is down, then bring it back up.</span></span> <span data-ttu-id="893c8-319">Если сертификаты не синхронизированы, перейдите к представлению интеграции с виртуальной сетью на уровне ASP и нажмите "Синхронизировать сеть".</span><span class="sxs-lookup"><span data-stu-id="893c8-319">If your certificates are out of sync, then go to the ASP view of your VNet Integration and hit "Sync Network".</span></span> <span data-ttu-id="893c8-320">Если вы подозреваете, что конфигурация виртуальной сети была изменена без синхронизации в рамках планов ASP, то перейдите к представлению интеграции с виртуальной сетью на уровне ASP и щелкните "Синхронизировать сеть". Напоминаем, что это вызовет кратковременную потерю подключения к виртуальной сети, что скажется на работе приложений.</span><span class="sxs-lookup"><span data-stu-id="893c8-320">If you suspect that there has been a change made to your VNet configuration and it wasn't sync'd with your ASPs, then go to the ASP view of your VNet Integration and hit "Sync Network" Just as a reminder, this causes a brief outage with your VNet connection and your apps.</span></span> 

<span data-ttu-id="893c8-321">Если все описанные выше пункты в порядке, вам нужно провести расширенную проверку.</span><span class="sxs-lookup"><span data-stu-id="893c8-321">If all of that is fine, then you need to dig in a bit deeper:</span></span>

* <span data-ttu-id="893c8-322">Существуют ли другие приложения, которые используют интеграцию с виртуальной сетью для доступа к ресурсам в той же виртуальной сети?</span><span class="sxs-lookup"><span data-stu-id="893c8-322">Are there any other apps using VNet Integration to reach resources in the same VNet?</span></span> 
* <span data-ttu-id="893c8-323">Можете ли вы открыть консоль приложений и обратиться к другим ресурсам виртуальной сети с помощью средства tcpping?</span><span class="sxs-lookup"><span data-stu-id="893c8-323">Can you go to the app console and use tcpping to reach any other resources in your VNet?</span></span> 

<span data-ttu-id="893c8-324">Если на любой из этих вопросов ответ будет положительным, то интеграция с виртуальной сетью выполнена. Причина проблемы в другом.</span><span class="sxs-lookup"><span data-stu-id="893c8-324">If either of the above are true, then your VNet Integration is fine and the problem is somewhere else.</span></span> <span data-ttu-id="893c8-325">Это сложная ситуация, так как простых методов, которые позволяют определить причину проблем с доступом к комбинации «узел:порт», не существует.</span><span class="sxs-lookup"><span data-stu-id="893c8-325">This is where it gets to be more of a challenge because there is no simple way to see why you can't reach a host:port.</span></span> <span data-ttu-id="893c8-326">Ниже представлено несколько возможных причин этой проблемы.</span><span class="sxs-lookup"><span data-stu-id="893c8-326">Some of the causes include:</span></span>

* <span data-ttu-id="893c8-327">На нужном узле запущен брандмауэр, который блокирует доступ к порту приложения для диапазона IP-адресов "точка — сеть".</span><span class="sxs-lookup"><span data-stu-id="893c8-327">you have a firewall up on your host preventing access to the application port from your point to site IP range.</span></span> <span data-ttu-id="893c8-328">Для подключения между подсетями часто требуется разрешить общий доступ.</span><span class="sxs-lookup"><span data-stu-id="893c8-328">Crossing subnets often requires Public access.</span></span>
* <span data-ttu-id="893c8-329">Целевой узел не работает.</span><span class="sxs-lookup"><span data-stu-id="893c8-329">your target host is down</span></span>
* <span data-ttu-id="893c8-330">Целевое приложение не работает.</span><span class="sxs-lookup"><span data-stu-id="893c8-330">your application is down</span></span>
* <span data-ttu-id="893c8-331">Указан неверный IP-адрес или неверное имя узла.</span><span class="sxs-lookup"><span data-stu-id="893c8-331">you had the wrong IP or hostname</span></span>
* <span data-ttu-id="893c8-332">Приложение ожидает передачи данных не по тому порту, который предполагается.</span><span class="sxs-lookup"><span data-stu-id="893c8-332">your application is listening on a different port than what you expected.</span></span> <span data-ttu-id="893c8-333">Это можно проверить, войдя на нужный узел и выполнив команду netstat -aon из командной строки.</span><span class="sxs-lookup"><span data-stu-id="893c8-333">You can check this by going onto that host and using "netstat -aon" from the cmd prompt.</span></span> <span data-ttu-id="893c8-334">Вы видите идентификаторы процессов и прослушиваемые ими порты.</span><span class="sxs-lookup"><span data-stu-id="893c8-334">This shows you what process ID is listening on what port.</span></span> 
* <span data-ttu-id="893c8-335">Группы безопасности сети настроены на блокирование доступа к узлу и порту приложения для диапазона IP-адресов «точка-сеть».</span><span class="sxs-lookup"><span data-stu-id="893c8-335">your network security groups are configured in such a manner that they prevent access to your application host and port from your point to site IP range</span></span>

<span data-ttu-id="893c8-336">Помните о том, что у вас нет возможности определить точный IP-адрес, используемый приложением. Поэтому вам нужно разрешить доступ для всего диапазона адресов «точка-сеть».</span><span class="sxs-lookup"><span data-stu-id="893c8-336">Remember that you don't know what IP in your Point to Site IP range that your app will use so you need to allow access from the entire range.</span></span> 

<span data-ttu-id="893c8-337">Можно выполнить дополнительные действия по отладке.</span><span class="sxs-lookup"><span data-stu-id="893c8-337">Additional debug steps include:</span></span>

* <span data-ttu-id="893c8-338">Войдите на другую виртуальную машину в этой виртуальной сети и попробуйте с нее обратиться к нужной комбинации "узел:порт".</span><span class="sxs-lookup"><span data-stu-id="893c8-338">log onto another VM in your VNet and attempt to reach your resource host:port from there.</span></span> <span data-ttu-id="893c8-339">Это можно сделать с помощью любых служебных программ на основе TCP ping или средства telnet.</span><span class="sxs-lookup"><span data-stu-id="893c8-339">There are some TCP ping utilities that you can use for this purpose or can even use telnet if need be.</span></span> <span data-ttu-id="893c8-340">Вам нужно поверить возможность подключения с другой виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="893c8-340">The purpose here is just to determine if connectivity is there from this other VM.</span></span> 
* <span data-ttu-id="893c8-341">Откройте приложение на другой виртуальной машине и проверьте из консоли приложения доступ к узлу и порту.</span><span class="sxs-lookup"><span data-stu-id="893c8-341">bring up an application on another VM and test access to that host and port from the console from your app</span></span>

#### <a name="on-premises-resources"></a><span data-ttu-id="893c8-342">Локальные ресурсы</span><span class="sxs-lookup"><span data-stu-id="893c8-342">On-premises resources</span></span> ####
<span data-ttu-id="893c8-343">Если ваше приложение не может получить доступ к ресурсам в локальной среде, то первым делом следует проверить доступ к ресурсу в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="893c8-343">If your app cannot reach resources on-premises, then the first thing you should check is if you can reach a resource in your VNet.</span></span> <span data-ttu-id="893c8-344">Если это работает, то попробуйте обратиться к локальному приложению с виртуальной машины, входящей в виртуальную сеть.</span><span class="sxs-lookup"><span data-stu-id="893c8-344">If that works, try to reach the on-premises application from a VM in the VNet.</span></span> <span data-ttu-id="893c8-345">Для этого используйте служебную программу telnet или TCP ping.</span><span class="sxs-lookup"><span data-stu-id="893c8-345">You can use telnet or a TCP ping utility.</span></span> <span data-ttu-id="893c8-346">Если получить доступ к локальному ресурсу с этой виртуальной машины не удастся, проверьте состояние VPN-подключения типа "сеть — сеть".</span><span class="sxs-lookup"><span data-stu-id="893c8-346">If your VM can't reach your on-premises resource, then make sure your Site to Site VPN connection is working.</span></span> <span data-ttu-id="893c8-347">Если подключение установлено, проверьте описанные выше пункты, а также конфигурацию и состояние локального шлюза.</span><span class="sxs-lookup"><span data-stu-id="893c8-347">If it is working, then check the same things noted earlier as well as the on-premises gateway configuration and status.</span></span> 

<span data-ttu-id="893c8-348">Теперь, если размещенная в виртуальной сети виртуальная машина может взаимодействовать с локальной системой, а приложение не может, то возможна одна из следующих причин этого:</span><span class="sxs-lookup"><span data-stu-id="893c8-348">Now if your VNet hosted VM can reach your on-premises system but your app can't then the reason is likely one of the following:</span></span>

* <span data-ttu-id="893c8-349">для маршрутов в локальном шлюзе не настроены диапазоны IP-адресов подключений "точка — сеть";</span><span class="sxs-lookup"><span data-stu-id="893c8-349">your routes are not configured with your point to site IP ranges in your on-premises gateway</span></span>
* <span data-ttu-id="893c8-350">ваши группы безопасности сети блокируют доступ к диапазону IP-адресов подключений "точка-сеть";</span><span class="sxs-lookup"><span data-stu-id="893c8-350">your network security groups are blocking access for your Point to Site IP range</span></span>
* <span data-ttu-id="893c8-351">локальные брандмауэры блокируют трафик из диапазона IP-адресов подключений "точка — сеть";</span><span class="sxs-lookup"><span data-stu-id="893c8-351">your on-premises firewalls are blocking traffic from your Point to Site IP range</span></span>
* <span data-ttu-id="893c8-352">в виртуальной сети задан определенный пользователем маршрут, который не дает трафику подключений "точка — сеть" попасть в локальную сеть.</span><span class="sxs-lookup"><span data-stu-id="893c8-352">you have a User Defined Route(UDR) in your VNet that prevents your Point to Site based traffic from reaching your on-premises network</span></span>

## <a name="hybrid-connections-and-app-service-environments"></a><span data-ttu-id="893c8-353">Гибридные подключения и среда службы приложений</span><span class="sxs-lookup"><span data-stu-id="893c8-353">Hybrid Connections and App Service Environments</span></span>
<span data-ttu-id="893c8-354">Доступ к ресурсам виртуальной сети осуществляется тремя способами.</span><span class="sxs-lookup"><span data-stu-id="893c8-354">There are three features that enable access to VNet hosted resources.</span></span> <span data-ttu-id="893c8-355">К ним относятся:</span><span class="sxs-lookup"><span data-stu-id="893c8-355">They are:</span></span>

* <span data-ttu-id="893c8-356">интеграция с виртуальной сетью;</span><span class="sxs-lookup"><span data-stu-id="893c8-356">VNet Integration</span></span>
* <span data-ttu-id="893c8-357">через гибридные подключения</span><span class="sxs-lookup"><span data-stu-id="893c8-357">Hybrid Connections</span></span>
* <span data-ttu-id="893c8-358">среда службы приложений.</span><span class="sxs-lookup"><span data-stu-id="893c8-358">App Service Environments</span></span>

<span data-ttu-id="893c8-359">Для гибридных подключений необходимо установить в сети агент ретрансляции, который называется диспетчером гибридного подключения.</span><span class="sxs-lookup"><span data-stu-id="893c8-359">Hybrid Connections requires you to install a relay agent called the Hybrid Connection Manager(HCM) in your network.</span></span> <span data-ttu-id="893c8-360">Диспетчер должен иметь возможность подключаться к Azure и к вашему приложению.</span><span class="sxs-lookup"><span data-stu-id="893c8-360">The HCM needs to be able to connect to Azure and also to your application.</span></span> <span data-ttu-id="893c8-361">Это решение особенно удобно для доступа из удаленной сети (локальной или другой облачной сети), так как для него не требуется конечная точка, доступная из Интернета.</span><span class="sxs-lookup"><span data-stu-id="893c8-361">This solution is especially great from a remote network such as your on-premises network or even another cloud hosted network because it does not require an internet accessible endpoint.</span></span> <span data-ttu-id="893c8-362">Диспетчер гибридного подключения работает только на платформе Windows. Можно запустить до пяти его экземпляров, чтобы обеспечить высокую доступность.</span><span class="sxs-lookup"><span data-stu-id="893c8-362">The HCM only runs on Windows and you can have up to five instances running to provide high availability.</span></span> <span data-ttu-id="893c8-363">Гибридные подключения поддерживают только протокол TCP, поэтому для каждой конечной точки должна быть определена комбинация «узел:порт».</span><span class="sxs-lookup"><span data-stu-id="893c8-363">Hybrid Connections only supports TCP though and each HC endpoint has to match to a specific host:port combination.</span></span> 

<span data-ttu-id="893c8-364">Среда службы приложений (ASE) позволяет запустить в виртуальной сети экземпляр службы приложений Azure.</span><span class="sxs-lookup"><span data-stu-id="893c8-364">The App Service Environment feature allows you to run an instance of the Azure App Service in your VNet.</span></span> <span data-ttu-id="893c8-365">Приложение получает доступ к ресурсам виртуальной сети без каких-либо дополнительных действий.</span><span class="sxs-lookup"><span data-stu-id="893c8-365">This lets your apps access resources in your VNet without any extra steps.</span></span> <span data-ttu-id="893c8-366">У среды службы приложений есть и другие преимущества. Например, вы можете использовать рабочие роли на основе Dv2 с 14 ГБ ОЗУ.</span><span class="sxs-lookup"><span data-stu-id="893c8-366">Some of the other benefits of an App Service Environment are that you can use Dv2 based workers with up to 14 GB of RAM.</span></span> <span data-ttu-id="893c8-367">Также вы получаете возможность масштабировать систему по мере необходимости.</span><span class="sxs-lookup"><span data-stu-id="893c8-367">Another benefit is that you can scale the system to meet your needs.</span></span> <span data-ttu-id="893c8-368">В отличие от мультитенантных сред, где размер плана ASP ограничен 20 экземплярами, в среде ASE можно выполнить масштабирование до 100 экземпляров ASP.</span><span class="sxs-lookup"><span data-stu-id="893c8-368">Unlike the multi-tenant environments where your ASP is limited to 20 instances, in an ASE you can scale up to 100 ASP instances.</span></span> <span data-ttu-id="893c8-369">Среда ASE, в отличие от функции интеграции с виртуальной сетью, поддерживает VPN ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="893c8-369">One of the things you get with an ASE that you don't with VNet Integration is that an App Service Environment can work with an ExpressRoute VPN.</span></span> 

<span data-ttu-id="893c8-370">Хотя эти решения используются в сходных сценариях, они не являются взаимозаменяемыми.</span><span class="sxs-lookup"><span data-stu-id="893c8-370">While there is some use case overlap, none of these feature can replace any of the others.</span></span> <span data-ttu-id="893c8-371">Выбор подходящего способа подключения напрямую зависит от понимания своих задач.</span><span class="sxs-lookup"><span data-stu-id="893c8-371">Knowing what feature to use is tied to your needs.</span></span> <span data-ttu-id="893c8-372">Например:</span><span class="sxs-lookup"><span data-stu-id="893c8-372">For example:</span></span>

* <span data-ttu-id="893c8-373">Если вы разработчик и просто хотите запустить сайт в Azure, который будет обращаться к базе данных на вашем настольном компьютере, проще всего использовать гибридные подключения.</span><span class="sxs-lookup"><span data-stu-id="893c8-373">If you are a developer and simply want to run a site in Azure and have it access the database on the workstation under your desk, then the easiest thing to use is Hybrid Connections.</span></span> 
* <span data-ttu-id="893c8-374">Если вы представляете большую организацию, которой нужно поместить большое количество веб-свойств в общедоступное облако для управления из своей сети, вам подойдет среда службы приложений.</span><span class="sxs-lookup"><span data-stu-id="893c8-374">If you are a large organization that wants to put a large number of web properties in the public cloud and manage them in your own network, then you want to go with the App Service Environment.</span></span> 
* <span data-ttu-id="893c8-375">Если у вас есть несколько приложений, размещенных в службе приложений, которым нужно предоставить доступ к ресурсам виртуальной сети, выберите интеграцию с виртуальной сетью.</span><span class="sxs-lookup"><span data-stu-id="893c8-375">If you have a number of App Service hosted apps and simply want to access resources in your VNet, then VNet Integration is the way to go.</span></span> 

<span data-ttu-id="893c8-376">Еще одним фактором, кроме соответствия решения определенным задачам, является простота его реализации.</span><span class="sxs-lookup"><span data-stu-id="893c8-376">Beyond the use cases, there are some simplicity related aspects.</span></span> <span data-ttu-id="893c8-377">Если ваша виртуальная сеть уже подключена к локальной сети, использование интеграции с виртуальной сетью или среды службы приложений будет более простым способом доступа к локальным ресурсам.</span><span class="sxs-lookup"><span data-stu-id="893c8-377">If your VNet is already connected to your on-premises network, then using VNet Integration or an App Service Environment is an easy way to consume on-premises resources.</span></span> <span data-ttu-id="893c8-378">С другой стороны, если виртуальная сеть не подключена к локальной сети, то настройка VPN-подключения типа "сеть — сеть" окажется гораздо более затратным мероприятием по сравнению с установкой диспетчера гибридных подключений.</span><span class="sxs-lookup"><span data-stu-id="893c8-378">On the other hand, if your VNet is not connected to your on-premises network then it's a lot more overhead to set up a site to site VPN with your VNet compared with installing the HCM.</span></span> 

<span data-ttu-id="893c8-379">Помимо функциональных различий учитывайте также разницу в стоимости решений.</span><span class="sxs-lookup"><span data-stu-id="893c8-379">Beyond the functional differences, there are also pricing differences.</span></span> <span data-ttu-id="893c8-380">Среда службы приложений — это предложение класса «Премиум», которое предоставляет расширенные возможности настройки и множество других полезных функций.</span><span class="sxs-lookup"><span data-stu-id="893c8-380">The App Service Environment feature is a Premium service offering but offers the most network configuration possibilities in addition to other great features.</span></span> <span data-ttu-id="893c8-381">Интеграция с виртуальной сетью поддерживается в планах ASP уровня "Стандартный" или "Премиум". Эта функция идеально подходит для безопасного использования ресурсов в виртуальной сети из мультитенантной службы приложений.</span><span class="sxs-lookup"><span data-stu-id="893c8-381">VNet Integration can be used with Standard or Premium ASPs and is perfect for securely consuming resources in your VNet from the multi-tenant App Service.</span></span> <span data-ttu-id="893c8-382">Для гибридных подключений сейчас требуется учетная запись BizTalk, которая доступна в виде бесплатной версии, а также в виде предложения, которое тарифицируется на основе используемых ресурсов.</span><span class="sxs-lookup"><span data-stu-id="893c8-382">Hybrid Connections currently depends on a BizTalk account, which has pricing levels that start free and then get progressively more expensive based on the amount you need.</span></span> <span data-ttu-id="893c8-383">Если вам нужно работать с большим количеством сетей, лучшее решение — это гибридные подключения. Эта функция позволяет получить доступ к ресурсам, содержащимся более чем в 100 отдельных сетях.</span><span class="sxs-lookup"><span data-stu-id="893c8-383">When it comes to working across many networks though, there is no other feature like Hybrid Connections, which can enable you to access resources in well over 100 separate networks.</span></span> 

<!--Image references-->
[1]: ./media/web-sites-integrate-with-vnet/vnetint-upgradeplan.png
[2]: ./media/web-sites-integrate-with-vnet/vnetint-existingvnet.png
[3]: ./media/web-sites-integrate-with-vnet/vnetint-createvnet.png
[4]: ./media/web-sites-integrate-with-vnet/vnetint-howitworks.png
[5]: ./media/web-sites-integrate-with-vnet/vnetint-appmanage.png
[6]: ./media/web-sites-integrate-with-vnet/vnetint-aspmanage.png
[7]: ./media/web-sites-integrate-with-vnet/vnetint-aspmanagedetail.png
[8]: ./media/web-sites-integrate-with-vnet/vnetint-vnetp2s.png

<!--Links-->
[VNETOverview]: http://azure.microsoft.com/documentation/articles/virtual-networks-overview/ 
[AzurePortal]: http://portal.azure.com/
[ASPricing]: http://azure.microsoft.com/pricing/details/app-service/
[VNETPricing]: http://azure.microsoft.com/pricing/details/vpn-gateway/
[DataPricing]: http://azure.microsoft.com/pricing/details/data-transfers/
[V2VNETP2S]: http://azure.microsoft.com/documentation/articles/vpn-gateway-howto-point-to-site-rm-ps/
[IntPowershell]: http://azure.microsoft.com/documentation/articles/app-service-vnet-integration-powershell/
[ASEintro]: http://docs.microsoft.com/azure/app-service/app-service-environment/intro
[ILBASE]: http://docs.microsoft.com/azure/app-service/app-service-environment/create-ilb-ase
[V2VNETPortal]: https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-howto-point-to-site-resource-manager-portal
[VPNERCoex]: http://docs.microsoft.com/en-us/azure/expressroute/expressroute-howto-coexist-resource-manager
[ASE]: http://docs.microsoft.com/azure/app-service/app-service-environment/intro
