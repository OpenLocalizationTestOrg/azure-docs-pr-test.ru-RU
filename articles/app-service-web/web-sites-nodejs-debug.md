---
title: "Отладка веб-приложения Node.js в службе приложений Azure"
description: "Подробнее об отладке веб-приложения Node.js в службе приложений Azure."
tags: azure-portal
services: app-service\web
documentationcenter: nodejs
author: TomArcher
manager: routlaw
editor: 
ms.assetid: a48f906c-1a3e-43bc-ae84-7d2dde175b15
ms.service: app-service-web
ms.workload: web
ms.tgt_pltfrm: na
ms.devlang: nodejs
ms.topic: article
ms.date: 08/17/2016
ms.author: tarcher
ms.openlocfilehash: 5e302a4c58a171d40e43a22c34c724e868019ec8
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2017
---
# <a name="how-to-debug-a-nodejs-web-app-in-azure-app-service"></a>Отладка веб-приложения Node.js в службе приложений Azure
Azure предоставляет встроенные средства диагностики, которые помогают отлаживать приложения Node.js, размещенные в веб-приложениях [службы приложений Azure](http://go.microsoft.com/fwlink/?LinkId=529714) . В этой статье вы узнаете, как включить ведение журналов stdout и stderr, отображать сведения об ошибке в браузере, а также загружать и просматривать файлы журнала.

Диагностика приложений Node.js, размещенных в Azure, обеспечивается [IISNode]. Хотя в данной статье рассматриваются наиболее общие параметры для сбора диагностических сведений, она не является полным справочником по работе с IISNode. Дополнительные сведения о работе с IISNode см. в [файле сведений IISNode] на GitHub.

<a id="enablelogging"></a>

## <a name="enable-logging"></a>Включение ведения журналов
По умолчанию веб-приложения службы приложений записывают только диагностические сведения о развертывании, например при развертывании веб-приложения с использованием Git. Эта информация полезна при возникновении проблем во время развертывания, таких как сбой при установке модуля, на который ссылается файл **package.json**, или при использовании пользовательских сценариев развертывания.

Чтобы включить ведение журнала для потоков stdout и stderr, необходимо создать файл **IISNode.yml** в корне приложения Node.js и добавить следующий код:

    loggingEnabled: true

Это обеспечивает ведение журнала для потоков stderr и stdout из приложения Node.js.

Файл **IISNode.yml** может также использоваться для управления возвратом понятных пользователю ошибок или ошибок разработчика в браузер при сбое. Чтобы включить вывод ошибок разработчика, добавьте в файл **IISNode.yml** следующую строку:

    devErrorsEnabled: true

После включения этого параметра IISNode будет возвращать последние 64 КБ данных, отправленных в stderr, вместо понятного пользователю сообщения об ошибке, такого как "Внутренняя ошибка сервера".

> [!NOTE]
> Хотя параметр devErrorsEnabled полезен при диагностике проблем во время разработки, его включение в рабочей среде может привести к тому, что конечному пользователю будут отправляться ошибки разработки.
> 
> 

Если файл **IISNode.yml** еще не существует в приложении, необходимо перезапустить веб-приложение после публикации обновленного приложения. При простом изменении настроек в существующем файле **IISNode.yml** , который ранее был опубликован, перезагрузка не требуется.

> [!NOTE]
> Если веб-приложение было создано с помощью средства командной строки Azure или командлетов PowerShell Azure, автоматически создается файл по умолчанию **IISNode.yml** .
> 
> 

Чтобы перезапустить веб-приложение, выберите его на [портале Azure](https://portal.azure.com)и нажмите кнопку **ПЕРЕЗАПУСТИТЬ** .

![кнопка перезагрузки][restart-button]

Если в среде разработки установлены средства командной строки Azure, чтобы перезапустить веб-приложение, можно воспользоваться следующей командой:

    azure site restart [sitename]

> [!NOTE]
> Параметры конфигурации LoggingEnabled и devErrorsEnabled нужны в IISNode.yml для сбора диагностических сведений, однако IISNode.yml можно использовать для настройки различных параметров среды размещения. Полный список параметров конфигурации доступен в файле [iisnode_schema.xml](https://github.com/tjanczuk/iisnode/blob/master/src/config/iisnode_schema.xml).
> 
> 

<a id="viewlogs"></a>

## <a name="accessing-logs"></a>Доступ к журналам
Доступ к журналам диагностики может осуществляться тремя способами; с использованием протокола FTP (File Transfer), путем загрузки ZIP-архива или в режиме потока журнала с обновлением в реальном времени (также известного как заключительный фрагмент). Загрузка ZIP-архива файлов журналов или просмотр потока в режиме реального времени требует наличия средств командной строки Azure. Их можно установить с помощью следующей команды:

    npm install azure-cli -g

После установки доступ к данным средствам осуществляется с помощью команды "azure". Предварительно в средствах командной строки должно быть настроено использование подписки Azure. Сведения о том, как это сделать, см. в разделе **Загрузка и импорт настроек публикации** статьи [Использование средств командной строки Azure](../xplat-cli-connect.md).

### <a name="ftp"></a>FTP
Чтобы получить доступ к диагностической информации через FTP, перейдите на [портал Azure](https://portal.azure.com), выберите свое веб-приложение, а затем выберите команду **ПАНЕЛЬ МОНИТОРИНГА**. В разделе **быстрых ссылок** ссылки **Журналы диагностики FTP** и **Журналы диагностики FTPS** позволяют перейти к журналам с использованием протокола FTP.

> [!NOTE]
> Если имя пользователя и пароль для FTP или развертывания еще не указаны, это можно сделать на странице управления **Быстрый запуск**, выбрав **Настроить учетные данные развертывания**.
> 
> 

URL-адрес FTP, возвращаемый в панели мониторинга, относится к каталогу **LogFiles** , который будет содержать следующие вложенные папки:

* [Метод развертывания](web-sites-deploy.md). При использовании метода развертывания, например Git, будет создан одноименный каталог со сведениями, связанными с развертываниями.
* nodejs — данные Stdout и stderr, регистрируемые во всех экземплярах вашего приложения, если параметр loggingEnabled имеет значение true.

### <a name="zip-archive"></a>ZIP-архив
Чтобы загрузить ZIP-архив журналов диагностики, выполните следующую команду в средствах командной строки Azure:

    azure site log download [sitename]

В результате в текущий каталог будет помещен файл **diagnostics.zip** . Данный архив содержит следующую структуру каталогов:

* deployments — журнал сведений о развертываниях вашего приложения.
* LogFiles
  
  * [Метод развертывания](web-sites-deploy.md). При использовании метода развертывания, например Git, будет создан одноименный каталог со сведениями, связанными с развертываниями.
  * nodejs — данные Stdout и stderr, регистрируемые во всех экземплярах вашего приложения, если параметр loggingEnabled имеет значение true.

### <a name="live-stream-tail"></a>Поток в реальном времени (заключительный фрагмент)
Чтобы просмотреть поток журналов диагностики в реальном времени, выполните следующую команду в средствах командной строки Azure:

    azure site log tail [sitename]

В результате будет возвращен поток событий журнала, которые обновляются по мере их возникновения на сервере. Этот поток будет возвращать сведения о развертывании, а также сведения stdout и stderr (если параметр loggingEnabled имеет значение true).

<a id="nextsteps"></a>

## <a name="next-steps"></a>Дальнейшие действия
В этой статье было показано, как включить данные диагностики для Azure и получить к ним доступ. Хотя эта информация полезна для понимания проблем, возникающих в приложении, она может указывать на проблему с используемым модулем или на то, что версия Node.js, используемая веб-приложениями службы приложений, отличается от версии в среде развертывания.

Сведения по работе с модулями Azure см. в разделе [Использование модулей Node.js с приложениями Azure](../nodejs-use-node-modules-azure-apps.md).

Сведения об определении версии Node.js для своего приложения см. в разделе [Установка версии Node.js в приложении Azure].

Дополнительные сведения см. также в [центре по разработке для Node.js](/develop/nodejs/).

## <a name="whats-changed"></a>Изменения
* Руководство по переходу от веб-сайтов к службе приложений см. в статье [Служба приложений Azure и существующие службы Azure](http://go.microsoft.com/fwlink/?LinkId=529714).

> [!NOTE]
> Чтобы приступить к работе со службой приложений Azure до создания учетной записи Azure, перейдите к разделу [Пробное использование службы приложений](https://azure.microsoft.com/try/app-service/), где вы можете быстро создать кратковременное веб-приложение начального уровня в службе приложений. Никаких кредитных карт и обязательств.
> 
> 

[IISNode]: https://github.com/tjanczuk/iisnode
[файле сведений IISNode]: https://github.com/tjanczuk/iisnode#readme
[How to Use The Azure Command-Line Interface]:../cli-install-nodejs.md
[Using Node.js Modules with Azure Applications]: ../nodejs-use-node-modules-azure-apps.md
[Установка версии Node.js в приложении Azure]: ../nodejs-specify-node-version-azure-apps.md

[restart-button]: ./media/web-sites-nodejs-debug/restartbutton.png

