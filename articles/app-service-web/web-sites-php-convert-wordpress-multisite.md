---
title: "Преобразование сайта WordPress в мультисайт с помощью службы приложений Azure"
description: "Узнайте, как преобразовать существующее веб-приложение WordPress, созданное с помощью коллекции в Azure, в мультисайт WordPress"
services: app-service\web
documentationcenter: php
author: rmcmurray
manager: erikre
editor: 
ms.assetid: fe52dbf4-179c-42f1-adf9-d6a9af920c39
ms.service: app-service-web
ms.workload: web
ms.tgt_pltfrm: na
ms.devlang: PHP
ms.topic: article
ms.date: 04/25/2017
ms.author: robmcm
ms.openlocfilehash: 4a15fb5e97d2ca57e5883c07651c372c54021c92
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="convert-wordpress-to-multisite-in-azure-app-service"></a>Преобразование сайта WordPress в мультисайт с помощью службы приложений Azure
## <a name="overview"></a>Обзор
*Автор [Бен Лобо (Ben Lobaugh)][ben-lobaugh], [Microsoft Open Technologies Inc.][ms-open-tech]*

В этом учебнике описано, как преобразовать существующее веб-приложение WordPress, созданное с помощью коллекции в Azure, в мультисайт WordPress. Кроме того вы узнаете, как назначить пользовательский домен каждому из дочерних сайтов в установке.

Предполагается наличие существующей установки WordPress. В противном случае следуйте инструкциям раздела [Создание веб-приложения из Azure Marketplace][website-from-gallery].

Преобразование существующего отдельного сайта WordPress выполнить достаточно просто, и многие из перечисленных здесь начальных действий взяты непосредственно со страницы [Create A Network][wordpress-codex-create-a-network] (Создание сети) в [кодексе WordPress](http://codex.wordpress.org).

Давайте приступим.

## <a name="allow-multisite"></a>Включение функциональности мультисайта
Сначала необходимо активировать функциональность Мультисайт с помощью файла `wp-config.php` с константой **WP\_ALLOW\_MULTISITE**. Существует два способа изменить файлы веб-приложения: по протоколу FTP и через Git. Если вы не знаете, как настроить хотя бы один из этих способов, вы можете обратиться к одному из следующих учебных курсов:

* [Веб-сайт PHP с MySQL и FTP][website-w-mysql-and-ftp-ftp-setup]
* [Веб-сайт PHP с MySQL и Git][website-w-mysql-and-git-git-setup]

Откройте в выбранном редакторе файл `wp-config.php` и в строку `/* That's all, stop editing! Happy blogging. */` добавьте следующий код:

    /* Multisite */

    define( 'WP_ALLOW_MULTISITE', true );

Не забудьте сохранить файл и загрузить его на сервер!

## <a name="network-setup"></a>Настройка сети
Войдите в область веб-сайта *wp-admin*, где в меню **Сервис** вы увидите новый элемент **Настройка сети**. Нажмите кнопку **Настройка сети** и введите сведения о своей сети.

![Экран настройки сети][wordpress-network-setup]

В этом руководстве используется схема сайта *Sub-directories*, так как она должна работать при любых обстоятельствах. Позже мы настроим личные домены для каждого дочернего сайта. Однако должна быть возможность настроить поддомен, если вы сопоставляете домен через [портал Azure](https://portal.azure.com) и правильно настраиваете DNS с подстановочными знаками.

Дополнительные сведения о сравнении поддоменов с подкаталогами см. в статье [Types of multisite network][wordpress-codex-types-of-networks] (Типы многосайтовых сетей) в кодексе WordPress.

## <a name="enable-the-network"></a>Включение сети
Теперь сеть настроена в базе данных, но для включения функций сети осталось выполнить еще один шаг. Завершите настройку параметров `wp-config.php` и убедитесь, что файл `web.config` правильно направляет все веб-сайты.

После нажатия кнопки **Установить** на странице *Настройка сети* WordPress предпримет попытку обновить файлы `wp-config.php` и `web.config`. Тем не менее, всегда следует выполнять проверку файлов, чтобы убедиться, что обновление выполнено успешно. В противном случае на этом экране будут отображаться необходимые обновления. Измените и сохраните файлы.

После выполнения этих обновлений вам необходимо выйти с панели мониторинга wp-admin и войти в нее снова.

На панели администратора должно появиться дополнительное меню с именем **Мои сайты**. Это меню позволяет управлять новой сетью на панели мониторинга **Администратор сети** .

## <a name="adding-custom-domains"></a>Добавление пользовательских доменов
Подключаемый модуль [WordPress MU Domain Mapping][wordpress-plugin-wordpress-mu-domain-mapping] делает добавление пользовательских доменов для любого сайта в сети очень простым. Для обеспечения правильной работы этого подключаемого модуля необходимо выполнить дополнительную настройку на портале, а также в регистраторе доменов.

## <a name="enable-domain-mapping-to-the-web-app"></a>Включение сопоставления доменов с веб-приложением
В плане обслуживания **Бесплатный** [службы приложений](http://go.microsoft.com/fwlink/?LinkId=529714) не поддерживается добавление в веб-приложение пользовательских доменов. Потребуется переключиться в режим **Общий** или **Стандартный**. Для этого:

* Войдите на портал Azure и найдите свое веб-приложение. 
* Откройте вкладку **Масштабирование** в разделе **Параметры**.
* В разделе **Общие** выберите *Общий* или *Стандартный*.
* Нажмите кнопку **Сохранить**

Может появиться сообщение с просьбой проверить изменения и подтвердить, что за это веб-приложение начнет взиматься плата в зависимости от использования и других настроек.

Обработка новых параметров займет несколько минут, поэтому сейчас самое время приступить к настройке домена.

## <a name="verify-your-domain"></a>Проверка домена
Чтобы веб-приложения Azure позволили сопоставить домен с сайтом, вам необходима авторизация для сопоставления домена. Для этого необходимо добавить в запись DNS новую запись CNAME.

* Выполните вход в диспетчер DNS домена.
* Создайте новую запись CNAME *awverify*
* Укажите в *awverify* путь *awverify.ВАШ_ДОМЕН.azurewebsites.net*.

Для полного вступления в силу внесенных изменений DNS может потребоваться некоторое время, так что если перечисленные ниже действия не получается выполнить сразу, выпейте чашку кофе, а затем повторите попытку.

## <a name="add-the-domain-to-the-web-app"></a>Добавление домена в веб-приложение
Вернитесь в свое веб-приложение на портале Azure, откройте меню **Параметры** и щелкните **Пользовательские домены и SSL**.

Когда отобразятся *Параметры SSL* , вы увидите поля для ввода всех доменов, которые вы хотите назначить своему веб-приложению. Если домен отсутствует в списке, он будет недоступен для сопоставления в WordPress независимо от настроек DNS домена.

![Диалоговое окно "Управление пользовательскими доменами"][wordpress-manage-domains]

После ввода своего домена в текстовом поле в Azure будет проверена созданная ранее запись CNAME. Если распространение DNS не завершено, будет отображаться красный индикатор. Если все успешно выполнено, появится зеленый флажок. 

Запишите IP-адреса, перечисленные в нижней части диалогового окна. Они потребуются для установки A-записи для домена.

## <a name="setup-the-domain-a-record"></a>Настройка A-записи домена
Если предыдущие шаги выполнены успешно, теперь вы можете назначить домен веб-приложению Azure через запись A DNS. 

Важно отметить, что веб-приложения Azure принимают как CNAME, так и записи A, но для правильного сопоставления домена *следует* использовать запись A. CNAME нельзя передать в другую CNAME, созданную в Azure с использованием ссылки "ВАШ_ДОМЕН.azurewebsites.net".

При помощи IP-адреса из предыдущего шага вернитесь в диспетчер DNS и настройте A-запись таким образом, чтобы она указывала на данный IP.

## <a name="install-and-setup-the-plugin"></a>Установка и настройка подключаемого модуля
В функциональности мультисайтов WordPress в настоящее время отсутствует встроенный метод сопоставления пользовательских доменов. Однако есть подключаемый модуль [WordPress MU Domain Mapping][wordpress-plugin-wordpress-mu-domain-mapping], который добавляет эти функциональные возможности. Войдите в среду администрирования сайта и установите подключаемый модуль **Сопоставление доменов WordPress MU** .

После установки и активации подключаемого модуля выберите команды **Параметры** > **Сопоставление доменов** , чтобы настроить этот подключаемый модуль. В первом текстовом поле *IP-адрес сервера*введите IP-адрес, который использовался при настройке A-записи для домена. Задайте нужные *параметры домена* (значения по умолчанию часто являются оптимальными) и нажмите кнопку **Сохранить**.

## <a name="map-the-domain"></a>Сопоставление домена
Перейдите на **Панель мониторинга** сайта, с которым требуется сопоставить домен. Щелкните **Сервис** > **Domain Mapping** (Сопоставление доменов), введите новый домен в текстовом поле и нажмите кнопку **Добавить**.

По умолчанию новый домен перезапишет автоматически созданный домен сайта. Если требуется, чтобы весь трафик отправлялся в новый домен, перед сохранением установите флажок *Основной домен для этого блога* . Для сайта можно добавить неограниченное количество доменов, но только один будет основным.

## <a name="do-it-again"></a>Повторение процедуры
Веб-приложения Azure позволяют добавить для веб-приложения неограниченное число доменов. Чтобы добавить другой домен, необходимо будет выполнить инструкции в разделах **Проверка домена** и **Настройка A-записи домена** для каждого домена.    

> [!NOTE]
> Чтобы приступить к работе со службой приложений Azure до создания учетной записи Azure, перейдите к разделу [Пробное использование службы приложений](https://azure.microsoft.com/try/app-service/), где вы можете быстро создать кратковременное веб-приложение начального уровня в службе приложений. Никаких кредитных карт и обязательств.
> 
> 

## <a name="whats-changed"></a>Изменения
* Руководство по переходу от веб-сайтов к службе приложений см. в статье [Служба приложений Azure и существующие службы Azure](http://go.microsoft.com/fwlink/?LinkId=529714).

[ben-lobaugh]: http://ben.lobaugh.net
[ms-open-tech]: http://msopentech.com
[website-from-gallery]: https://www.windowsazure.com/develop/php/tutorials/website-from-gallery/
[wordpress-codex-create-a-network]: http://codex.wordpress.org/Create_A_Network
[website-w-mysql-and-ftp-ftp-setup]: https://www.windowsazure.com/develop/php/tutorials/website-w-mysql-and-ftp/#header-0
[website-w-mysql-and-git-git-setup]: https://www.windowsazure.com/develop/php/tutorials/website-w-mysql-and-git/#header-1
[wordpress-network-setup]: ./media/web-sites-php-convert-wordpress-multisite/wordpress-network-setup.png
[wordpress-codex-types-of-networks]: http://codex.wordpress.org/Before_You_Create_A_Network#Types_of_multisite_network
[wordpress-plugin-wordpress-mu-domain-mapping]: http://wordpress.org/extend/plugins/wordpress-mu-domain-mapping/

[wordpress-manage-domains]: ./media/web-sites-php-convert-wordpress-multisite/wordpress-manage-domains.png


