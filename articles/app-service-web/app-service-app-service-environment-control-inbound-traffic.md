---
title: "Как управлять входящим трафиком в среде службы приложений"
description: "Дополнительные сведения о настройке правил сетевой безопасности для управления входящим трафиком в среде службы приложений."
services: app-service
documentationcenter: 
author: ccompy
manager: erikre
editor: 
ms.assetid: 4cc82439-8791-48a4-9485-de6d8e1d1a08
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/11/2017
ms.author: stefsch
ms.openlocfilehash: ee0a2248a1cd5d76f87b280de05410b94f96c8af
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="how-to-control-inbound-traffic-to-an-app-service-environment"></a><span data-ttu-id="55d66-103">Как управлять входящим трафиком в среде службы приложений</span><span class="sxs-lookup"><span data-stu-id="55d66-103">How To Control Inbound Traffic to an App Service Environment</span></span>
## <a name="overview"></a><span data-ttu-id="55d66-104">Обзор</span><span class="sxs-lookup"><span data-stu-id="55d66-104">Overview</span></span>
<span data-ttu-id="55d66-105">Среду службы приложений можно создать **либо** в виртуальной сети Azure Resource Manager, **либо** в [виртуальной сети][virtualnetwork], использующей классическую модель развертывания.</span><span class="sxs-lookup"><span data-stu-id="55d66-105">An App Service Environment can be created in **either** an Azure Resource Manager virtual network, **or** a classic deployment model [virtual network][virtualnetwork].</span></span>  <span data-ttu-id="55d66-106">Новые виртуальную сеть и подсеть можно определить во время создания среды службы приложений.</span><span class="sxs-lookup"><span data-stu-id="55d66-106">A new virtual network and new subnet can be defined at the time an App Service Environment is created.</span></span>  <span data-ttu-id="55d66-107">Кроме того, среду службы приложений можно создать в существующих виртуальной сети и подсети.</span><span class="sxs-lookup"><span data-stu-id="55d66-107">Alternatively, an App Service Environment can be created in a pre-existing virtual network and pre-existing subnet.</span></span>  <span data-ttu-id="55d66-108">В связи с изменением от июня 2016 г. среды ASE можно также развертывать в виртуальных сетях, использующих либо диапазоны общедоступных адресов, либо адресные пространства RFC1918 (т. е.</span><span class="sxs-lookup"><span data-stu-id="55d66-108">With a change made in June 2016, ASEs can also be deployed into virtual networks that use either public address ranges, or RFC1918 address spaces (i.e.</span></span> <span data-ttu-id="55d66-109">частные адреса).</span><span class="sxs-lookup"><span data-stu-id="55d66-109">private addresses).</span></span>  <span data-ttu-id="55d66-110">Дополнительные сведения о создании среды службы приложений см. в [этой статье][HowToCreateAnAppServiceEnvironment].</span><span class="sxs-lookup"><span data-stu-id="55d66-110">For more details on creating an App Service Environment see [How To Create an App Service Environment][HowToCreateAnAppServiceEnvironment].</span></span>

<span data-ttu-id="55d66-111">Среда службы приложений всегда должна создаваться в подсети, поскольку подсеть обеспечивает границы сети, которые можно использовать для блокировки входящего трафика за вышестоящими устройствами и службами, например трафик HTTP и HTTPS допускается только от определенных вышестоящих IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="55d66-111">An App Service Environment must always be created within a subnet because a subnet provides a network boundary which can be used to lock down inbound traffic behind upstream devices and services such that HTTP and HTTPS traffic is only accepted from specific upstream IP addresses.</span></span>

<span data-ttu-id="55d66-112">Входящий и исходящий сетевой трафик в подсети контролируется с помощью [группы сетевой безопасности][NetworkSecurityGroups].</span><span class="sxs-lookup"><span data-stu-id="55d66-112">Inbound and outbound network traffic on a subnet is controlled using a [network security group][NetworkSecurityGroups].</span></span> <span data-ttu-id="55d66-113">Для управления входящим трафиком необходимо создать правила сетевой безопасности в группе сетевой безопасности, а затем назначить группу сетевой безопасности для подсети, содержащей среду службы приложений.</span><span class="sxs-lookup"><span data-stu-id="55d66-113">Controlling inbound traffic requires creating network security rules in a network security group, and then assigning the network security group the subnet containing the App Service Environment.</span></span>

<span data-ttu-id="55d66-114">После назначения группы сетевой безопасности для подсети входящий трафик на приложения в среде службы приложений разрешается или блокируется в зависимости от правил разрешения или блокировки, определенных в группе сетевой безопасности.</span><span class="sxs-lookup"><span data-stu-id="55d66-114">Once a network security group is assigned to a subnet, inbound traffic to apps in the App Service Environment is allowed/blocked based on the allow and deny rules defined in the network security group.</span></span>

[!INCLUDE [app-service-web-to-api-and-mobile](../../includes/app-service-web-to-api-and-mobile.md)]

## <a name="inbound-network-ports-used-in-an-app-service-environment"></a><span data-ttu-id="55d66-115">Входящие сетевые порты, используемые в среде службы приложений</span><span class="sxs-lookup"><span data-stu-id="55d66-115">Inbound Network Ports Used in an App Service Environment</span></span>
<span data-ttu-id="55d66-116">Перед блокировкой входящего сетевого трафика с помощью группы сетевой безопасности важно знать набор обязательных и необязательных сетевых портов, используемых средой службы приложений.</span><span class="sxs-lookup"><span data-stu-id="55d66-116">Before locking down inbound network traffic with a network security group, it is important to know the set of required and optional network ports used by an App Service Environment.</span></span>  <span data-ttu-id="55d66-117">Случайное закрытие трафика на некоторых портах может привести к потере функциональности в среде службы приложений.</span><span class="sxs-lookup"><span data-stu-id="55d66-117">Accidentally closing off traffic to some ports can result in loss of functionality in an App Service Environment.</span></span>

<span data-ttu-id="55d66-118">Ниже приведен список портов, используемых средой службы приложений.</span><span class="sxs-lookup"><span data-stu-id="55d66-118">The following is a list of ports used by an App Service Environment.</span></span> <span data-ttu-id="55d66-119">Это все **TCP**-порты, если явно не указано иное.</span><span class="sxs-lookup"><span data-stu-id="55d66-119">All ports are **TCP**, unless otherwise clearly noted:</span></span>

* <span data-ttu-id="55d66-120">454: **обязательный порт**, используемый инфраструктурой Azure для обслуживания сред службы приложений и управления ими через SSL.</span><span class="sxs-lookup"><span data-stu-id="55d66-120">454:  **Required port** used by Azure infrastructure for managing and maintaining App Service Environments via SSL.</span></span>  <span data-ttu-id="55d66-121">Не блокируйте трафик на этом порту.</span><span class="sxs-lookup"><span data-stu-id="55d66-121">Do not block traffic to this port.</span></span>  <span data-ttu-id="55d66-122">Этот порт всегда привязан к общедоступному виртуальному IP-адресу ASE.</span><span class="sxs-lookup"><span data-stu-id="55d66-122">This port is always bound to the public VIP of an ASE.</span></span>
* <span data-ttu-id="55d66-123">455: **обязательный порт**, используемый инфраструктурой Azure для обслуживания сред службы приложений и управления ими через SSL.</span><span class="sxs-lookup"><span data-stu-id="55d66-123">455:  **Required port** used by Azure infrastructure for managing and maintaining App Service Environments via SSL.</span></span>  <span data-ttu-id="55d66-124">Не блокируйте трафик на этом порту.</span><span class="sxs-lookup"><span data-stu-id="55d66-124">Do not block traffic to this port.</span></span>  <span data-ttu-id="55d66-125">Этот порт всегда привязан к общедоступному виртуальному IP-адресу ASE.</span><span class="sxs-lookup"><span data-stu-id="55d66-125">This port is always bound to the public VIP of an ASE.</span></span>
* <span data-ttu-id="55d66-126">80: порт по умолчанию для входящего HTTP-трафика для приложений, выполняемых в планах службы приложений в среде службы приложений.</span><span class="sxs-lookup"><span data-stu-id="55d66-126">80:  Default port for inbound HTTP traffic to apps running in App Service Plans in an App Service Environment.</span></span>  <span data-ttu-id="55d66-127">В ASE с внутренним балансировщиком нагрузки этот порт привязан к адресу балансировщика нагрузки ASE.</span><span class="sxs-lookup"><span data-stu-id="55d66-127">On an ILB-enabled ASE, this port is bound to the ILB address of the ASE.</span></span>
* <span data-ttu-id="55d66-128">443: порт по умолчанию для входящего трафика SSL для приложений, выполняемых в планах службы приложений в среде службы приложений.</span><span class="sxs-lookup"><span data-stu-id="55d66-128">443: Default port for inbound SSL traffic to apps running in App Service Plans in an App Service Environment.</span></span>  <span data-ttu-id="55d66-129">В ASE с внутренним балансировщиком нагрузки этот порт привязан к адресу балансировщика нагрузки ASE.</span><span class="sxs-lookup"><span data-stu-id="55d66-129">On an ILB-enabled ASE, this port is bound to the ILB address of the ASE.</span></span>
* <span data-ttu-id="55d66-130">21: канал управления для FTP.</span><span class="sxs-lookup"><span data-stu-id="55d66-130">21:  Control channel for FTP.</span></span>  <span data-ttu-id="55d66-131">Этот порт можно безопасно заблокировано, если FTP не используется.</span><span class="sxs-lookup"><span data-stu-id="55d66-131">This port can be safely blocked if FTP is not being used.</span></span>  <span data-ttu-id="55d66-132">В ASE с внутренним балансировщиком нагрузки этот порт может быть привязан к адресу балансировщика нагрузки ASE.</span><span class="sxs-lookup"><span data-stu-id="55d66-132">On an ILB-enabled ASE, this port can be bound to the ILB address for an ASE.</span></span>
* <span data-ttu-id="55d66-133">990: канал управления для FTPS.</span><span class="sxs-lookup"><span data-stu-id="55d66-133">990:  Control channel for FTPS.</span></span>  <span data-ttu-id="55d66-134">Этот порт можно благополучно заблокировать, если не используется FTPS.</span><span class="sxs-lookup"><span data-stu-id="55d66-134">This port can be safely blocked if FTPS is not being used.</span></span>  <span data-ttu-id="55d66-135">В ASE с внутренним балансировщиком нагрузки этот порт может быть привязан к адресу балансировщика нагрузки ASE.</span><span class="sxs-lookup"><span data-stu-id="55d66-135">On an ILB-enabled ASE, this port can be bound to the ILB address for an ASE.</span></span>
* <span data-ttu-id="55d66-136">10001 10020: каналы данных для FTP.</span><span class="sxs-lookup"><span data-stu-id="55d66-136">10001-10020: Data channels for FTP.</span></span>  <span data-ttu-id="55d66-137">Как и при использовании канала управления, эти порты можно безопасно заблокировать, если FTP не используется.</span><span class="sxs-lookup"><span data-stu-id="55d66-137">As with the control channel, these ports can be safely blocked if FTP is not being used.</span></span>  <span data-ttu-id="55d66-138">В ASE с внутренним балансировщиком нагрузки этот порт может быть привязан к адресу балансировщика нагрузки ASE.</span><span class="sxs-lookup"><span data-stu-id="55d66-138">On an ILB-enabled ASE, this port can be bound to the ASE's ILB address.</span></span>
* <span data-ttu-id="55d66-139">4016: используется для удаленной отладки с помощью Visual Studio 2012.</span><span class="sxs-lookup"><span data-stu-id="55d66-139">4016: Used for remote debugging with Visual Studio 2012.</span></span>  <span data-ttu-id="55d66-140">Этот порт можно безопасно заблокировано, если функция не используется.</span><span class="sxs-lookup"><span data-stu-id="55d66-140">This port can be safely blocked if the feature is not being used.</span></span>  <span data-ttu-id="55d66-141">В ASE с внутренним балансировщиком нагрузки этот порт привязан к адресу балансировщика нагрузки ASE.</span><span class="sxs-lookup"><span data-stu-id="55d66-141">On an ILB-enabled ASE, this port is bound to the ILB address of the ASE.</span></span>
* <span data-ttu-id="55d66-142">4018: используется для удаленной отладки с помощью Visual Studio 2013.</span><span class="sxs-lookup"><span data-stu-id="55d66-142">4018: Used for remote debugging with Visual Studio 2013.</span></span>  <span data-ttu-id="55d66-143">Этот порт можно безопасно заблокировано, если функция не используется.</span><span class="sxs-lookup"><span data-stu-id="55d66-143">This port can be safely blocked if the feature is not being used.</span></span>  <span data-ttu-id="55d66-144">В ASE с внутренним балансировщиком нагрузки этот порт привязан к адресу балансировщика нагрузки ASE.</span><span class="sxs-lookup"><span data-stu-id="55d66-144">On an ILB-enabled ASE, this port is bound to the ILB address of the ASE.</span></span>
* <span data-ttu-id="55d66-145">4020: используется для удаленной отладки с помощью Visual Studio 2015.</span><span class="sxs-lookup"><span data-stu-id="55d66-145">4020: Used for remote debugging with Visual Studio 2015.</span></span>  <span data-ttu-id="55d66-146">Этот порт можно безопасно заблокировано, если функция не используется.</span><span class="sxs-lookup"><span data-stu-id="55d66-146">This port can be safely blocked if the feature is not being used.</span></span>  <span data-ttu-id="55d66-147">В ASE с внутренним балансировщиком нагрузки этот порт привязан к адресу балансировщика нагрузки ASE.</span><span class="sxs-lookup"><span data-stu-id="55d66-147">On an ILB-enabled ASE, this port is bound to the ILB address of the ASE.</span></span>

## <a name="outbound-connectivity-and-dns-requirements"></a><span data-ttu-id="55d66-148">Требования к DNS и исходящим подключениям</span><span class="sxs-lookup"><span data-stu-id="55d66-148">Outbound Connectivity and DNS Requirements</span></span>
<span data-ttu-id="55d66-149">Для надлежащего функционирования среды службы приложений также требуется исходящий доступ к различным конечным точкам.</span><span class="sxs-lookup"><span data-stu-id="55d66-149">For an App Service Environment to function properly, it also requires outbound access to various endpoints.</span></span> <span data-ttu-id="55d66-150">Полный список внешних конечных точек, используемых в ASE, приведен в разделе "Необходимое сетевое подключение" статьи [Сведения о конфигурации сети для сред службы приложений с ExpressRoute](app-service-app-service-environment-network-configuration-expressroute.md#required-network-connectivity) .</span><span class="sxs-lookup"><span data-stu-id="55d66-150">A full list of the external endpoints used by an ASE is in the "Required Network Connectivity" section of the [Network Configuration for ExpressRoute](app-service-app-service-environment-network-configuration-expressroute.md#required-network-connectivity) article.</span></span>

<span data-ttu-id="55d66-151">Для сред службы приложений требуется, чтобы для виртуальной сети была настроена допустимая инфраструктура DNS.</span><span class="sxs-lookup"><span data-stu-id="55d66-151">App Service Environments require a valid DNS infrastructure configured for the virtual network.</span></span>  <span data-ttu-id="55d66-152">Если после создания среды службы приложений по какой-либо причине меняется конфигурация DNS, разработчик может принудительно задать выбор новой конфигурации DNS в среде службы приложений.</span><span class="sxs-lookup"><span data-stu-id="55d66-152">If for any reason the DNS configuration is changed after an App Service Environment has been created, developers can force an App Service Environment to pick up the new DNS configuration.</span></span>  <span data-ttu-id="55d66-153">Если перезагрузить разворачиваемую среду, используя значок "Перезапуск", расположенный в верхней части колонки управления средой службы приложений на [классическом портале Azure][NewPortal], будет выбрана новая конфигурация DNS в среде.</span><span class="sxs-lookup"><span data-stu-id="55d66-153">Triggering a rolling environment reboot using the "Restart" icon located at the top of the App Service Environment management blade in the [Azure portal][NewPortal] will cause the environment to pick up the new DNS configuration.</span></span>

<span data-ttu-id="55d66-154">Также рекомендуется настроить пользовательские DNS-серверы в виртуальной сети заранее, т. е. до создания среды службы приложений.</span><span class="sxs-lookup"><span data-stu-id="55d66-154">It is also recommended that any custom DNS servers on the vnet be setup ahead of time prior to creating an App Service Environment.</span></span>  <span data-ttu-id="55d66-155">Если конфигурация виртуальной сети DNS изменяется во время создания среды службы приложений, это приведет к сбою процесса создания среды службы приложений.</span><span class="sxs-lookup"><span data-stu-id="55d66-155">If a virtual network's DNS configuration is changed while an App Service Environment is being created, that will result in the App Service Environment creation process failing.</span></span>  <span data-ttu-id="55d66-156">Аналогично, если на другой стороне VPN-шлюза имеется пользовательский DNS-сервер, который недоступен, процесс создания среды службы приложений будет прерван.</span><span class="sxs-lookup"><span data-stu-id="55d66-156">In a similar vein, if a custom DNS server exists on the other end of a VPN gateway, and the DNS server is unreachable or unavailable, the App Service Environment creation process will also fail.</span></span>

## <a name="creating-a-network-security-group"></a><span data-ttu-id="55d66-157">Создание группы сетевой безопасности</span><span class="sxs-lookup"><span data-stu-id="55d66-157">Creating a Network Security Group</span></span>
<span data-ttu-id="55d66-158">Подробные сведения о принципах работы групп сетевой безопасности см. [здесь][NetworkSecurityGroups].</span><span class="sxs-lookup"><span data-stu-id="55d66-158">For full details on how network security groups work see the following [information][NetworkSecurityGroups].</span></span>  <span data-ttu-id="55d66-159">Ниже приведен пример управления службами Azure, в котором рассматриваются группы сетевой безопасности. Особое внимание уделено настройке и применению группы сетевой безопасности к подсети, которая содержит среду службы приложений.</span><span class="sxs-lookup"><span data-stu-id="55d66-159">The Azure Service Management example below touches on highlights of network security groups, with a focus on configuring and applying a network security group to a subnet that contains an App Service Environment.</span></span>

<span data-ttu-id="55d66-160">**Примечание**. Группы безопасности сети можно настроить с помощью графического пользовательского интерфейса на [портале Azure](https://portal.azure.com) или с помощью Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="55d66-160">**Note:** Network security groups can be configured graphically using the [Azure Portal](https://portal.azure.com) or through Azure PowerShell.</span></span>

<span data-ttu-id="55d66-161">Сначала группы сетевой безопасности создаются как отдельные сущности, связанные с подпиской.</span><span class="sxs-lookup"><span data-stu-id="55d66-161">Network security groups are first created as a standalone entity associated with a subscription.</span></span> <span data-ttu-id="55d66-162">Так как группы сетевой безопасности создаются в области Azure, убедитесь, что группа сетевой безопасности создана в той же области, что и среда службы приложений.</span><span class="sxs-lookup"><span data-stu-id="55d66-162">Since network security groups are created in an Azure region, ensure that the network security group is created in the same region as the App Service Environment.</span></span>

<span data-ttu-id="55d66-163">Ниже показано создание группы сетевой безопасности.</span><span class="sxs-lookup"><span data-stu-id="55d66-163">The following demonstrates creating a network security group:</span></span>

    New-AzureNetworkSecurityGroup -Name "testNSGexample" -Location "South Central US" -Label "Example network security group for an app service environment"

<span data-ttu-id="55d66-164">После создания группы сетевой безопасности к ней добавляются одно или несколько правил сетевой безопасности.</span><span class="sxs-lookup"><span data-stu-id="55d66-164">Once a network security group is created, one or more network security rules are added to it.</span></span>  <span data-ttu-id="55d66-165">Поскольку набор правил может со временем меняться, рекомендуется организовать схему нумерации, используемую для приоритетов правил, таким образом, чтобы дополнительные правила можно было просто вставить в дальнейшем.</span><span class="sxs-lookup"><span data-stu-id="55d66-165">Since the set of rules may change over time, it is recommended to space out the numbering scheme used for rule priorities to make it easy to insert additional rules over time.</span></span>

<span data-ttu-id="55d66-166">В приведенном ниже примере показано правило, которое разрешает доступ к портам управления, необходимым для управления и обслуживания среды службы приложений инфраструктурой Azure.</span><span class="sxs-lookup"><span data-stu-id="55d66-166">The example below shows a rule that explicitly grants access to the management ports needed by the Azure infrastructure to manage and maintain an App Service Environment.</span></span>  <span data-ttu-id="55d66-167">Обратите внимание, что весь трафик управления проходит по SSL и защищен клиентскими сертификатами, поэтому, несмотря на то, что порты открыты, они недоступны для любой сущности, кроме инфраструктуры управления Azure.</span><span class="sxs-lookup"><span data-stu-id="55d66-167">Note that all management traffic flows over SSL and is secured by client certificates, so even though the ports are opened they are inaccessible by any entity other than Azure management infrastructure.</span></span>

    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "ALLOW AzureMngmt" -Type Inbound -Priority 100 -Action Allow -SourceAddressPrefix 'INTERNET'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '454-455' -Protocol TCP


<span data-ttu-id="55d66-168">При блокировании доступа к портам 80 и 443, чтобы «скрыть» среду службы приложений за вышестоящими устройствами или службами, необходимо знать вышестоящий IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="55d66-168">When locking down access to port 80 and 443 to "hide" an App Service Environment behind upstream devices or services, you will need to know the upstream IP address.</span></span>  <span data-ttu-id="55d66-169">Например, если вы используете брандмауэр веб-приложения (WAF), WAF будет иметь свой собственный IP-адрес (или адреса), которые он использует при перенаправлении трафика на нисходящую среду службы приложений.</span><span class="sxs-lookup"><span data-stu-id="55d66-169">For example, if you are using a web application firewall (WAF), the WAF will have its own IP address (or addresses) which it uses when proxying traffic to a downstream App Service Environment.</span></span>  <span data-ttu-id="55d66-170">Необходимо будет использовать этот IP-адрес в параметре *SourceAddressPrefix* правила сетевой безопасности.</span><span class="sxs-lookup"><span data-stu-id="55d66-170">You will need to use this IP address in the *SourceAddressPrefix* parameter of a network security rule.</span></span>

<span data-ttu-id="55d66-171">В следующем примере входящий трафик от конкретного вышестоящего IP-адреса полностью разрешен.</span><span class="sxs-lookup"><span data-stu-id="55d66-171">In the example below, inbound traffic from a specific upstream IP address is explicitly allowed.</span></span>  <span data-ttu-id="55d66-172">Адрес *1.2.3.4* используется как заполнитель для IP-адреса вышестоящего WAF.</span><span class="sxs-lookup"><span data-stu-id="55d66-172">The address *1.2.3.4* is used as a placeholder for the IP address of an upstream WAF.</span></span>  <span data-ttu-id="55d66-173">Измените значение адреса на адрес, используемый вышестоящим устройством или службой.</span><span class="sxs-lookup"><span data-stu-id="55d66-173">Change the value to match the address used by your upstream device or service.</span></span>

    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT HTTP" -Type Inbound -Priority 200 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '80' -Protocol TCP
    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT HTTPS" -Type Inbound -Priority 300 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '443' -Protocol TCP

<span data-ttu-id="55d66-174">Если требуется поддержка FTP, следующие правила можно использовать как шаблон для предоставления доступа к порту управления FTP и портал каналов данных.</span><span class="sxs-lookup"><span data-stu-id="55d66-174">If FTP support is desired, the following rules can be used as a template to grant access to the FTP control port and data channel ports.</span></span>  <span data-ttu-id="55d66-175">Поскольку протокол FTP является протоколом с отслеживанием состояния, нельзя будет направить FTP-трафик через обычный брандмауэр HTTP/HTTPS или прокси-устройство.</span><span class="sxs-lookup"><span data-stu-id="55d66-175">Since FTP is a stateful protocol, you may not be able to route FTP traffic through a traditional HTTP/HTTPS firewall or proxy device.</span></span>  <span data-ttu-id="55d66-176">В этом случае необходимо задать для параметра *SourceAddressPrefix* другое значение, например диапазон IP-адресов машин разработчика или развертывания, на которых запущены FTP-клиенты.</span><span class="sxs-lookup"><span data-stu-id="55d66-176">In this case you will need to set the *SourceAddressPrefix* to a different value - for example the IP address range of developer or deployment machines on which FTP clients are running.</span></span> 

    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT FTPCtrl" -Type Inbound -Priority 400 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '21' -Protocol TCP
    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT FTPDataRange" -Type Inbound -Priority 500 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '10001-10020' -Protocol TCP

<span data-ttu-id="55d66-177">(**Примечание.** Диапазон портов канала данных может измениться в период использования предварительной версии.)</span><span class="sxs-lookup"><span data-stu-id="55d66-177">(**Note:**  the data channel port range may change during the preview period.)</span></span>

<span data-ttu-id="55d66-178">Следующие правила показывают, как предоставить доступ при использовании удаленной отладки с помощью Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="55d66-178">If remote debugging with Visual Studio is used, the following rules demonstrate how to grant access.</span></span>  <span data-ttu-id="55d66-179">Существует отдельное правило для каждой поддерживаемой версии Visual Studio, поскольку каждая версия использует другой порт для удаленной отладки.</span><span class="sxs-lookup"><span data-stu-id="55d66-179">There is a separate rule for each supported version of Visual Studio since each version uses a different port for remote debugging.</span></span>  <span data-ttu-id="55d66-180">Как и для FTP-доступа, трафик удаленной отладки не может правильно проходить через традиционный брандмауэр WAF или прокси-устройство.</span><span class="sxs-lookup"><span data-stu-id="55d66-180">As with FTP access, remote debugging traffic may not flow properly through a traditional WAF or proxy device.</span></span>  <span data-ttu-id="55d66-181">Для параметра *SourceAddressPrefix* вместо этого можно задать значение диапазона IP-адресов машины разработчиков, на которых запущена программа Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="55d66-181">The *SourceAddressPrefix* can instead be set to the IP address range of developer machines running Visual Studio.</span></span>

    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT RemoteDebuggingVS2012" -Type Inbound -Priority 600 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '4016' -Protocol TCP
    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT RemoteDebuggingVS2013" -Type Inbound -Priority 700 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '4018' -Protocol TCP
    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityRule -Name "RESTRICT RemoteDebuggingVS2015" -Type Inbound -Priority 800 -Action Allow -SourceAddressPrefix '1.2.3.4/32'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '4020' -Protocol TCP

## <a name="assigning-a-network-security-group-to-a-subnet"></a><span data-ttu-id="55d66-182">Назначение группы сетевой безопасности для подсети</span><span class="sxs-lookup"><span data-stu-id="55d66-182">Assigning a Network Security Group to a Subnet</span></span>
<span data-ttu-id="55d66-183">Группа сетевой безопасности имеет правило безопасности по умолчанию, которое запрещает доступ для любого внешнего трафика.</span><span class="sxs-lookup"><span data-stu-id="55d66-183">A network security group has a default security rule which denies access to all external traffic.</span></span>  <span data-ttu-id="55d66-184">Результатом объединения описанных выше правил сетевой безопасности и правила безопасности по умолчанию, которое блокирует входящий трафик, является то, что только трафик из исходных диапазонов адресов, связанных с действием *Разрешить* , будет отправляться к приложениям, работающим в среде службы приложений.</span><span class="sxs-lookup"><span data-stu-id="55d66-184">The result from combining the network security rules described above, and the default security rule blocking inbound traffic, is that only traffic from source address ranges associated with an *Allow* action will be able to send traffic to apps running in an App Service Environment.</span></span>

<span data-ttu-id="55d66-185">После заполнения группы сетевой безопасности правилами безопасности ее необходимо назначить для подсети, содержащей среду службы приложений.</span><span class="sxs-lookup"><span data-stu-id="55d66-185">After a network security group is populated with security rules, it needs to be assigned to the subnet containing the App Service Environment.</span></span>  <span data-ttu-id="55d66-186">Команда назначения ссылается как на имя виртуальной сети, в которой находится среда службы приложений, так и на имя подсети, в которой была создана среда службы приложений.</span><span class="sxs-lookup"><span data-stu-id="55d66-186">The assignment command references both the name of the virtual network where the App Service Environment resides, as well as the name of the subnet where the App Service Environment was created.</span></span>  

<span data-ttu-id="55d66-187">В приведенном ниже примере показана группа сетевой безопасности, назначаемая для подсети и виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="55d66-187">The example below shows a network security group being assigned to a subnet and virtual network:</span></span>

    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Set-AzureNetworkSecurityGroupToSubnet -VirtualNetworkName 'testVNet' -SubnetName 'Subnet-test'

<span data-ttu-id="55d66-188">После успешного назначения группы сетевой безопасности (назначение является длительным процессом и может занять несколько минут) только входящий трафик, соответствующий правилам *Разрешить* , успешно дойдет до приложений в среде службы приложений.</span><span class="sxs-lookup"><span data-stu-id="55d66-188">Once the network security group assignment succeeds (the assignment is a long-running operations and can take a few minutes to complete), only inbound traffic matching *Allow* rules will successfully reach apps in the App Service Environment.</span></span>

<span data-ttu-id="55d66-189">Для полноты картины в приведенном ниже примере показано, как удалить группу сетевой безопасности для подсети и тем самым отменить связь между ними.</span><span class="sxs-lookup"><span data-stu-id="55d66-189">For completeness the following example shows how to remove and thus dis-associate the network security group from the subnet:</span></span>

    Get-AzureNetworkSecurityGroup -Name "testNSGexample" | Remove-AzureNetworkSecurityGroupFromSubnet -VirtualNetworkName 'testVNet' -SubnetName 'Subnet-test'

## <a name="special-considerations-for-explicit-ip-ssl"></a><span data-ttu-id="55d66-190">Специальные рекомендации для SSL на основе явного IP</span><span class="sxs-lookup"><span data-stu-id="55d66-190">Special Considerations for Explicit IP-SSL</span></span>
<span data-ttu-id="55d66-191">Если для приложения настроен явный адрес SSL на основе IP (применяемый *только* к ASE, у которых есть общедоступный виртуальный IP-адрес), то вместо IP-адреса по умолчанию среды службы приложений трафик HTTP и HTTPS пропускается в подсеть через другой набор портов, отличный от портов 80 и 443.</span><span class="sxs-lookup"><span data-stu-id="55d66-191">If an app is configured with an explicit IP-SSL address (applicable *only* to ASEs that have a public VIP), instead of using the default IP address of the App Service Environment, both HTTP and HTTPS traffic flows into the subnet over a different set of ports other than ports 80 and 443.</span></span>

<span data-ttu-id="55d66-192">Отдельные пары портов, используемых каждым адресом SSL на основе IP, можно найти в пользовательском интерфейсе портала, в колонке со сведениями о среде службы приложений.</span><span class="sxs-lookup"><span data-stu-id="55d66-192">The individual pair of ports used by each IP-SSL address can be found in the portal user interface from the App Service Environment's details UX blade.</span></span>  <span data-ttu-id="55d66-193">Выберите "Все параметры" > "IP-адреса".</span><span class="sxs-lookup"><span data-stu-id="55d66-193">Select "All settings" --> "IP addresses".</span></span>  <span data-ttu-id="55d66-194">В колонке "IP-адреса" показана таблица всех явно заданных адресов SSL на основе IP для среды службы приложений, а также специальные пары портов, используемых для маршрутизации трафика HTTP и HTTPS, связанного с каждым адресом SSL на основе IP.</span><span class="sxs-lookup"><span data-stu-id="55d66-194">The "IP addresses" blade shows a table of all explicitly configured IP-SSL addresses for the App Service Environment, along with the special port pair that is used to route HTTP and HTTPS traffic associated with each IP-SSL address.</span></span>  <span data-ttu-id="55d66-195">Эти пары портов необходимо использовать для параметров DestinationPortRange при настройке правил в группе безопасности сети.</span><span class="sxs-lookup"><span data-stu-id="55d66-195">It is this port pair that needs to be used for the DestinationPortRange parameters when configuring rules in a network security group.</span></span>

<span data-ttu-id="55d66-196">Если настроить приложение в ASE для использования SSL на основе IP, то внешним клиентам можно будет не беспокоиться о сопоставлении специальных пар портов, так как это будет выполняться незаметно для них.</span><span class="sxs-lookup"><span data-stu-id="55d66-196">When an app on an ASE is configured to use IP-SSL, external customers will not see and do not need to worry about the special port pair mapping.</span></span>  <span data-ttu-id="55d66-197">Трафик к приложениям будет проходить обычным образом по настроенному адресу SSL на основе IP.</span><span class="sxs-lookup"><span data-stu-id="55d66-197">Traffic to the apps will flow normally to the configured IP-SSL address.</span></span>  <span data-ttu-id="55d66-198">Трансляция в специальную пару портов происходит внутри автоматически во время маршрутизации трафика по последнему участку в подсети, содержащей ASE.</span><span class="sxs-lookup"><span data-stu-id="55d66-198">The translation to the special port pair automatically happens internally during the final leg of routing traffic into the subnet containing the ASE.</span></span> 

## <a name="getting-started"></a><span data-ttu-id="55d66-199">Приступая к работе</span><span class="sxs-lookup"><span data-stu-id="55d66-199">Getting started</span></span>
<span data-ttu-id="55d66-200">Сведения о том, как начать работу со средами службы приложений, см. в статье [Введение в среду службы приложений][IntroToAppServiceEnvironment].</span><span class="sxs-lookup"><span data-stu-id="55d66-200">To get started with App Service Environments, see [Introduction to App Service Environment][IntroToAppServiceEnvironment]</span></span>

<span data-ttu-id="55d66-201">Все статьи и практические руководства, посвященные средам службы приложений, доступны в [файле сведений для сред службы приложений](../app-service/app-service-app-service-environments-readme.md).</span><span class="sxs-lookup"><span data-stu-id="55d66-201">All articles and How-To's for App Service Environments are available in the [README for Application Service Environments](../app-service/app-service-app-service-environments-readme.md).</span></span>

<span data-ttu-id="55d66-202">Подробные сведения о безопасном подключении приложений к серверным ресурсам из среды службы приложений см. в статье [Безопасное подключение к серверным ресурсам из среды службы приложений][SecurelyConnecttoBackend].</span><span class="sxs-lookup"><span data-stu-id="55d66-202">For details around apps securely connecting to backend resource from an App Service Environment, see [Securely connecting to Backend resources from an App Service Environment][SecurelyConnecttoBackend]</span></span>

<span data-ttu-id="55d66-203">Дополнительные сведения о платформе службы приложений Azure см. в статье [Что такое служба приложений Azure?][AzureAppService]</span><span class="sxs-lookup"><span data-stu-id="55d66-203">For more information about the Azure App Service platform, see [Azure App Service][AzureAppService].</span></span>

[!INCLUDE [app-service-web-whats-changed](../../includes/app-service-web-whats-changed.md)]

[!INCLUDE [app-service-web-try-app-service](../../includes/app-service-web-try-app-service.md)]

<!-- LINKS -->
[virtualnetwork]: https://azure.microsoft.com/documentation/articles/virtual-networks-faq/
[HowToCreateAnAppServiceEnvironment]: http://azure.microsoft.com/documentation/articles/app-service-web-how-to-create-an-app-service-environment/
[NetworkSecurityGroups]: https://azure.microsoft.com/documentation/articles/virtual-networks-nsg/
[AzureAppService]: http://azure.microsoft.com/documentation/articles/app-service-value-prop-what-is/
[IntroToAppServiceEnvironment]:  http://azure.microsoft.com/documentation/articles/app-service-app-service-environment-intro/
[SecurelyConnecttoBackend]:  http://azure.microsoft.com/documentation/articles/app-service-app-service-environment-securely-connecting-to-backend-resources/
[NewPortal]:  https://portal.azure.com  

<!-- IMAGES -->

