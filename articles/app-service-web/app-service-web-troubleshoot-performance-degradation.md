---
title: "Низкая производительность веб-приложения в службе приложений | Документация Майкрософт"
description: "Эта статья поможет устранить причины снижения производительности веб-приложения, размещенного в службе приложений Azure."
services: app-service\web
documentationcenter: 
author: cephalin
manager: erikre
editor: 
tags: top-support-issue
keywords: "Производительность веб-приложения, медленное приложение, приложение работает медленно"
ms.assetid: b8783c10-3a4a-4dd6-af8c-856baafbdde5
ms.service: app-service-web
ms.workload: web
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/03/2016
ms.author: cephalin
ms.openlocfilehash: 1cfe7ec37ad8b24a8bd9ab2bf67e95675a57b675
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2017
---
# <a name="troubleshoot-slow-web-app-performance-issues-in-azure-app-service"></a><span data-ttu-id="5bcb2-104">Устранение причин низкой производительности веб-приложения в службе приложений Azure</span><span class="sxs-lookup"><span data-stu-id="5bcb2-104">Troubleshoot slow web app performance issues in Azure App Service</span></span>
<span data-ttu-id="5bcb2-105">Эта статья поможет устранить причины снижения производительности веб-приложения, размещенного в [службе приложений Azure](http://go.microsoft.com/fwlink/?LinkId=529714).</span><span class="sxs-lookup"><span data-stu-id="5bcb2-105">This article helps you troubleshoot slow web app performance issues in [Azure App Service](http://go.microsoft.com/fwlink/?LinkId=529714).</span></span>

<span data-ttu-id="5bcb2-106">Если вам потребуется дополнительная помощь по любому из вопросов, рассматриваемых в статье, вы можете обратиться к экспертам по Azure на [форумах MSDN Azure и Stack Overflow](https://azure.microsoft.com/support/forums/).</span><span class="sxs-lookup"><span data-stu-id="5bcb2-106">If you need more help at any point in this article, you can contact the Azure experts on [the MSDN Azure and the Stack Overflow forums](https://azure.microsoft.com/support/forums/).</span></span> <span data-ttu-id="5bcb2-107">Кроме того, можно зарегистрировать обращение в службу поддержки Azure.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-107">Alternatively, you can also file an Azure support incident.</span></span> <span data-ttu-id="5bcb2-108">Перейдите на [сайт службы поддержки Azure](https://azure.microsoft.com/support/options/) и щелкните **Поддержка**.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-108">Go to the [Azure Support site](https://azure.microsoft.com/support/options/) and click on **Get Support**.</span></span>

## <a name="symptom"></a><span data-ttu-id="5bcb2-109">Симптом</span><span class="sxs-lookup"><span data-stu-id="5bcb2-109">Symptom</span></span>
<span data-ttu-id="5bcb2-110">При обращении к веб-приложению загрузка страницы идет медленно и может прерваться, превысив время ожидания.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-110">When you browse the web app, the pages load slowly and sometimes timeout.</span></span>

## <a name="cause"></a><span data-ttu-id="5bcb2-111">Причина:</span><span class="sxs-lookup"><span data-stu-id="5bcb2-111">Cause</span></span>
<span data-ttu-id="5bcb2-112">Эта проблема часто связана с проблемами на уровне приложения, например:</span><span class="sxs-lookup"><span data-stu-id="5bcb2-112">This problem is often caused by application level issues, such as:</span></span>

* <span data-ttu-id="5bcb2-113">слишком долгое выполнение сетевых запросов;</span><span class="sxs-lookup"><span data-stu-id="5bcb2-113">network requests taking a long time</span></span>
* <span data-ttu-id="5bcb2-114">неэффективный код приложения или запросы к базе данных;</span><span class="sxs-lookup"><span data-stu-id="5bcb2-114">application code or database queries being inefficient</span></span>
* <span data-ttu-id="5bcb2-115">слишком высокие требования приложения к памяти и процессору;</span><span class="sxs-lookup"><span data-stu-id="5bcb2-115">application using high memory/CPU</span></span>
* <span data-ttu-id="5bcb2-116">сбой приложения из-за исключения.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-116">application crashing due to an exception</span></span>

## <a name="troubleshooting-steps"></a><span data-ttu-id="5bcb2-117">Действия по устранению неполадок</span><span class="sxs-lookup"><span data-stu-id="5bcb2-117">Troubleshooting steps</span></span>
<span data-ttu-id="5bcb2-118">Процесс устранения неполадок можно разделить на три последовательных задачи.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-118">Troubleshooting can be divided into three distinct tasks, in sequential order:</span></span>

1. [<span data-ttu-id="5bcb2-119">Наблюдение за поведением приложения.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-119">Observe and monitor application behavior</span></span>](#observe)
2. [<span data-ttu-id="5bcb2-120">Сбор данных.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-120">Collect data</span></span>](#collect)
3. [<span data-ttu-id="5bcb2-121">Устранение проблемы.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-121">Mitigate the issue</span></span>](#mitigate)

<span data-ttu-id="5bcb2-122">[Веб-приложения службы приложений](/services/app-service/web/) содержат несколько инструментов для каждого из этих этапов.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-122">[App Service Web Apps](/services/app-service/web/) gives you various options at each step.</span></span>

<a name="observe" />

### <a name="1-observe-and-monitor-application-behavior"></a><span data-ttu-id="5bcb2-123">1. Наблюдение за поведением приложения</span><span class="sxs-lookup"><span data-stu-id="5bcb2-123">1. Observe and monitor application behavior</span></span>
#### <a name="track-service-health"></a><span data-ttu-id="5bcb2-124">Мониторинг работоспособности службы</span><span class="sxs-lookup"><span data-stu-id="5bcb2-124">Track Service health</span></span>
<span data-ttu-id="5bcb2-125">Microsoft Azure информирует о каждом случае прерывания работы или снижения производительности службы.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-125">Microsoft Azure publicizes each time there is a service interruption or performance degradation.</span></span> <span data-ttu-id="5bcb2-126">За работоспособностью службы можно следить на [портале Azure](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="5bcb2-126">You can track the health of the service on the [Azure portal](https://portal.azure.com/).</span></span> <span data-ttu-id="5bcb2-127">Дополнительные сведения см. в статье [Получение информации о работоспособности службы](../monitoring-and-diagnostics/insights-service-health.md).</span><span class="sxs-lookup"><span data-stu-id="5bcb2-127">For more information, see [Track service health](../monitoring-and-diagnostics/insights-service-health.md).</span></span>

#### <a name="monitor-your-web-app"></a><span data-ttu-id="5bcb2-128">Мониторинг веб-приложения</span><span class="sxs-lookup"><span data-stu-id="5bcb2-128">Monitor your web app</span></span>
<span data-ttu-id="5bcb2-129">Этот инструмент позволяет определить наличие проблем с приложением.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-129">This option enables you to find out if your application is having any issues.</span></span> <span data-ttu-id="5bcb2-130">В колонке веб-приложения щелкните элемент **Запросы и ошибки** .</span><span class="sxs-lookup"><span data-stu-id="5bcb2-130">In your web app’s blade, click the **Requests and errors** tile.</span></span> <span data-ttu-id="5bcb2-131">Колонка **Метрика** содержит все метрики, которые вы можете добавить.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-131">The **Metric** blade shows you all the metrics you can add.</span></span>

<span data-ttu-id="5bcb2-132">Некоторые из этих метрик помогут вам отслеживать работу веб-приложения, например:</span><span class="sxs-lookup"><span data-stu-id="5bcb2-132">Some of the metrics that you might want to monitor for your web app are</span></span>

* <span data-ttu-id="5bcb2-133">средний размер рабочего набора памяти;</span><span class="sxs-lookup"><span data-stu-id="5bcb2-133">Average memory working set</span></span>
* <span data-ttu-id="5bcb2-134">Среднее время ответа</span><span class="sxs-lookup"><span data-stu-id="5bcb2-134">Average response time</span></span>
* <span data-ttu-id="5bcb2-135">время ЦП;</span><span class="sxs-lookup"><span data-stu-id="5bcb2-135">CPU time</span></span>
* <span data-ttu-id="5bcb2-136">рабочий набор памяти;</span><span class="sxs-lookup"><span data-stu-id="5bcb2-136">Memory working set</span></span>
* <span data-ttu-id="5bcb2-137">Запросы</span><span class="sxs-lookup"><span data-stu-id="5bcb2-137">Requests</span></span>

![Мониторинг производительности веб-приложения](./media/app-service-web-troubleshoot-performance-degradation/1-monitor-metrics.png)

<span data-ttu-id="5bcb2-139">Дополнительные сведения можно найти в разделе </span><span class="sxs-lookup"><span data-stu-id="5bcb2-139">For more information, see:</span></span>

* [<span data-ttu-id="5bcb2-140">Мониторинг веб-приложений в службе приложений Azure</span><span class="sxs-lookup"><span data-stu-id="5bcb2-140">Monitor Web Apps in Azure App Service</span></span>](web-sites-monitor.md)
* [<span data-ttu-id="5bcb2-141">Создание оповещений для служб Azure с помощью портала Azure</span><span class="sxs-lookup"><span data-stu-id="5bcb2-141">Receive alert notifications</span></span>](../monitoring-and-diagnostics/insights-receive-alert-notifications.md)

#### <a name="monitor-web-endpoint-status"></a><span data-ttu-id="5bcb2-142">Мониторинг состояния конечной веб-точки</span><span class="sxs-lookup"><span data-stu-id="5bcb2-142">Monitor web endpoint status</span></span>
<span data-ttu-id="5bcb2-143">Если вы запускаете веб-приложение в ценовой категории **Стандартный**, то веб-приложения позволяют отслеживать две конечных точки из трех географических расположений.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-143">If you are running your web app in the **Standard** pricing tier, Web Apps lets you monitor two endpoints from three geographic locations.</span></span>

<span data-ttu-id="5bcb2-144">Функция мониторинга конечных точек настраивает веб-тесты из географически распределенных местоположений, позволяя проверить время ответа и время непрерывной работы URL-адресов.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-144">Endpoint monitoring configures web tests from geo-distributed locations that test response time and uptime of web URLs.</span></span> <span data-ttu-id="5bcb2-145">Тест выполняет операцию HTTP GET для URL-адреса веб-приложения и определяет время ответа и время непрерывной работы для каждого местоположения.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-145">The test performs an HTTP GET operation on the web URL to determine the response time and uptime from each location.</span></span> <span data-ttu-id="5bcb2-146">Для каждого настроенного расположения тест выполняется каждые пять минут.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-146">Each configured location runs a test every five minutes.</span></span>

<span data-ttu-id="5bcb2-147">Время непрерывной работы контролируется при помощи кодов ответов HTTP, а время ответа измеряется в миллисекундах.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-147">Uptime is monitored using HTTP response codes, and response time is measured in milliseconds.</span></span> <span data-ttu-id="5bcb2-148">Тест завершается с ошибкой, если код ответа HTTP больше или равен 400 или если на ответ требуется более 30 секунд.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-148">A monitoring test fails if the HTTP response code is greater than or equal to 400 or if the response takes more than 30 seconds.</span></span> <span data-ttu-id="5bcb2-149">Конечная точка считается доступной, если тесты мониторинга завершились для нее успешно для всех указанных расположений.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-149">An endpoint is considered available if its monitoring tests succeed from all the specified locations.</span></span>

<span data-ttu-id="5bcb2-150">Настройка описана в статье [Мониторинг приложений в службе приложений Azure](web-sites-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="5bcb2-150">To set it up, see [Monitor apps in Azure App Service](web-sites-monitor.md).</span></span>

<span data-ttu-id="5bcb2-151">Кроме того, вы можете посмотреть видео, посвященное контролю конечных точек: [Поддержка работы веб-сайтов Azure с помощью мониторинга конечных точек (со Стефаном Щаковым ((Stefan Schackow))](https://channel9.msdn.com/Shows/Azure-Friday/Keeping-Azure-Web-Sites-up-plus-Endpoint-Monitoring-with-Stefan-Schackow) .</span><span class="sxs-lookup"><span data-stu-id="5bcb2-151">Also, see [Keeping Azure Web Sites up plus Endpoint Monitoring - with Stefan Schackow](https://channel9.msdn.com/Shows/Azure-Friday/Keeping-Azure-Web-Sites-up-plus-Endpoint-Monitoring-with-Stefan-Schackow) for a video on endpoint monitoring.</span></span>

#### <a name="application-performance-monitoring-using-extensions"></a><span data-ttu-id="5bcb2-152">Контроль производительности приложений с помощью расширений</span><span class="sxs-lookup"><span data-stu-id="5bcb2-152">Application performance monitoring using Extensions</span></span>
<span data-ttu-id="5bcb2-153">Вы можете также отслеживать производительность приложения через *расширения сайта*.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-153">You can also monitor your application performance by using *site extensions*.</span></span>

<span data-ttu-id="5bcb2-154">Каждое веб-приложение службы приложений дает возможность использовать расширяемую конечную точку управления, которая позволяет применять набор мощных инструментов, развернутых в виде расширений сайта.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-154">Each App Service web app provides an extensible management end point that allows you to use a powerful set of tools deployed as site extensions.</span></span> <span data-ttu-id="5bcb2-155">Расширения включают в себя:</span><span class="sxs-lookup"><span data-stu-id="5bcb2-155">Extensions include:</span></span> 

- <span data-ttu-id="5bcb2-156">редакторы исходного кода, например [Visual Studio Team Services](https://www.visualstudio.com/products/what-is-visual-studio-online-vs.aspx);</span><span class="sxs-lookup"><span data-stu-id="5bcb2-156">Source code editors like [Visual Studio Team Services](https://www.visualstudio.com/products/what-is-visual-studio-online-vs.aspx).</span></span> 
- <span data-ttu-id="5bcb2-157">инструменты управления для подключенных ресурсов, таких как база данных MySQL, подключенная к веб-приложению.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-157">Management tools for connected resources such as a MySQL database connected to a web app.</span></span>

<span data-ttu-id="5bcb2-158">Для контроля производительности можно использовать расширения [Azure Application Insights](/services/application-insights/) и [New Relic](/marketplace/partners/newrelic/newrelic/).</span><span class="sxs-lookup"><span data-stu-id="5bcb2-158">[Azure Application Insights](/services/application-insights/) and [New Relic](/marketplace/partners/newrelic/newrelic/) are two of the performance monitoring site extensions that are available.</span></span> <span data-ttu-id="5bcb2-159">Чтобы использовать New Relic, необходимо установить агент в среде выполнения.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-159">To use New Relic, you install an agent at runtime.</span></span> <span data-ttu-id="5bcb2-160">Чтобы использовать Application Insights, перестройте код с помощью пакета SDK. Кроме того, вы можете установить расширение для доступа к дополнительным данным.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-160">To use Azure Application Insights, you rebuild your code with an SDK, and you can also install an extension that provides access to additional data.</span></span> <span data-ttu-id="5bcb2-161">Пакет SDK позволяет писать код для более подробного отслеживания использования и производительности приложения.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-161">The SDK lets you write code to monitor the usage and performance of your app in more detail.</span></span>

<span data-ttu-id="5bcb2-162">Использование Application Insights описано в статье [Отслеживание производительности в веб-приложениях](../application-insights/app-insights-web-monitor-performance.md).</span><span class="sxs-lookup"><span data-stu-id="5bcb2-162">To use Application Insights, see [Monitor performance in web applications](../application-insights/app-insights-web-monitor-performance.md).</span></span>

<span data-ttu-id="5bcb2-163">Использование New Relic описано в статье [Инструмент управления производительностью приложений New Relic для Azure](../store-new-relic-cloud-services-dotnet-application-performance-management.md).</span><span class="sxs-lookup"><span data-stu-id="5bcb2-163">To use New Relic, see [New Relic Application Performance Management on Azure](../store-new-relic-cloud-services-dotnet-application-performance-management.md).</span></span>

<a name="collect" />

### <a name="2-collect-data"></a><span data-ttu-id="5bcb2-164">2) Сбор данных</span><span class="sxs-lookup"><span data-stu-id="5bcb2-164">2. Collect data</span></span>
<span data-ttu-id="5bcb2-165">Среда веб-приложений содержит функции диагностики, которые позволяют сохранять в журналы информацию от веб-сервера и веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-165">The Web Apps environment provides diagnostic functionality for logging information from both the web server and the web application.</span></span> <span data-ttu-id="5bcb2-166">Информация разделена следующим образом: диагностика веб-сервера и диагностика приложений.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-166">The information is separated into web server diagnostics and application diagnostics.</span></span>

#### <a name="enable-web-server-diagnostics"></a><span data-ttu-id="5bcb2-167">Включение диагностики веб-сервера</span><span class="sxs-lookup"><span data-stu-id="5bcb2-167">Enable web server diagnostics</span></span>
<span data-ttu-id="5bcb2-168">Вы можете включить или отключить такие виды журналов:</span><span class="sxs-lookup"><span data-stu-id="5bcb2-168">You can enable or disable the following kinds of logs:</span></span>

* <span data-ttu-id="5bcb2-169">**Подробное ведение журнала ошибок** — регистрация подробной информации об ошибке для кодов состояния HTTP, которые указывают на сбой (код состояния 400 и выше).</span><span class="sxs-lookup"><span data-stu-id="5bcb2-169">**Detailed Error Logging** - Detailed error information for HTTP status codes that indicate a failure (status code 400 or greater).</span></span> <span data-ttu-id="5bcb2-170">Здесь могут содержаться сведения, которые помогут определить причину, по которой сервер вернул код ошибки.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-170">This may contain information that can help determine why the server returned the error code.</span></span>
* <span data-ttu-id="5bcb2-171">**Трассировка неудачно завершенных запросов** — регистрация подробной информации о неудачных запросах, включая трассировку компонентов IIS для обработки запроса и время каждого компонента.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-171">**Failed Request Tracing** - Detailed information on failed requests, including a trace of the IIS components used to process the request and the time taken in each component.</span></span> <span data-ttu-id="5bcb2-172">Это может быть полезно, если вы пытаетесь повысить производительность веб-приложения или определить причину конкретной ошибки HTTP.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-172">This can be useful if you are attempting to improve web app performance or isolate what is causing a specific HTTP error.</span></span>
* <span data-ttu-id="5bcb2-173">**Журналы веб-сервера** — регистрация сведений о HTTP-транзакциях в расширенном формате файла журнала W3C.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-173">**Web Server Logging** - Information about HTTP transactions using the W3C extended log file format.</span></span> <span data-ttu-id="5bcb2-174">Это удобно при определении общих показателей веб-приложения, например количества обработанных запросов или количества запросов с определенного IP-адреса.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-174">This is useful when determining overall web app metrics, such as the number of requests handled or how many requests are from a specific IP address.</span></span>

#### <a name="enable-application-diagnostics"></a><span data-ttu-id="5bcb2-175">Включение диагностики приложений</span><span class="sxs-lookup"><span data-stu-id="5bcb2-175">Enable application diagnostics</span></span>
<span data-ttu-id="5bcb2-176">Доступно несколько параметров сбора данных о производительности приложений из веб-приложений, динамического профилирования приложения из Visual Studio или изменения кода приложения для записи в журналы дополнительных сведений и трассировок.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-176">There are several options to collect application performance data from Web Apps, profile your application live from Visual Studio, or modify your application code to log more information and traces.</span></span> <span data-ttu-id="5bcb2-177">Эти параметры можно выбрать в зависимости имеющегося уровня доступа к приложению и информации, собранной инструментами мониторинга.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-177">You can choose the options based on how much access you have to the application and what you observed from the monitoring tools.</span></span>

##### <a name="use-application-insights-profiler"></a><span data-ttu-id="5bcb2-178">Использование Application Insights Profiler</span><span class="sxs-lookup"><span data-stu-id="5bcb2-178">Use Application Insights Profiler</span></span>
<span data-ttu-id="5bcb2-179">Вы можете включить Application Insights Profiler, чтобы начать запись подробных трассировок производительности.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-179">You can enable the Application Insights Profiler to start capturing detailed performance traces.</span></span> <span data-ttu-id="5bcb2-180">Можно просмотреть трассировки, записанные за последние пять дней, если требуется изучить проблемы, возникшие в прошлом.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-180">You can access traces captured up to five days ago when you need to investigate problems happened in the past.</span></span> <span data-ttu-id="5bcb2-181">Этот параметр можно выбрать при условии, что у вас имеется доступ к ресурсу Application Insights веб-приложения на портале Azure.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-181">You can choose this option as long as you have access to the web app's Application Insights resource on Azure portal.</span></span>

<span data-ttu-id="5bcb2-182">Application Insights Profiler предоставляет статистику по времени отклика каждого веб-вызова и выполняет трассировку, что помогает определить строку кода, которая привела к медленным откликам.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-182">Application Insights Profiler provides statistics on response time for each web call and traces that indicates which line of code caused the slow responses.</span></span> <span data-ttu-id="5bcb2-183">Иногда приложение службы приложений работает медленно из-за определенного кода, который обеспечивает низкопроизводительное выполнения.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-183">Sometimes the App Service app is slow because certain code is not written in a performant way.</span></span> <span data-ttu-id="5bcb2-184">К таким кодам относится последовательный код, который может выполняться параллельно и вызывать нежелательные конфликты в базе данных.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-184">Examples include sequential code that can be run in parallel and undesired database lock contentions.</span></span> <span data-ttu-id="5bcb2-185">Удаление этих узких мест в коде позволяет увеличить производительность приложения, но их трудно определить без настройки сбора событий трассировки и журналов.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-185">Removing these bottlenecks in the code increases the app's performance, but they are hard to detect without setting up elaborate traces and logs.</span></span> <span data-ttu-id="5bcb2-186">Данные трассировки, собранные Application Insights Profiler, помогают найти строки кода, замедляющие работу приложения, и устранить эту проблему для приложений службы приложений.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-186">The traces collected by Application Insights Profiler helps identifying the lines of code that slows down the application and overcome this challenge for App Service apps.</span></span>

 <span data-ttu-id="5bcb2-187">Дополнительные сведения см. в статье [Профилирование динамических веб-приложений Azure с помощью Application Insights](../application-insights/app-insights-profiler.md).</span><span class="sxs-lookup"><span data-stu-id="5bcb2-187">For more information, see [Profiling live Azure web apps with Application Insights](../application-insights/app-insights-profiler.md).</span></span>

##### <a name="use-remote-profiling"></a><span data-ttu-id="5bcb2-188">Используйте удаленное профилирование</span><span class="sxs-lookup"><span data-stu-id="5bcb2-188">Use Remote Profiling</span></span>
<span data-ttu-id="5bcb2-189">Служба приложений Azure позволяет удаленно профилировать веб-приложения, интерфейсные приложения и веб-задания.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-189">In Azure App Service, Web Apps, API Apps, and WebJobs can be remotely profiled.</span></span> <span data-ttu-id="5bcb2-190">Выберите этот параметр, если у вас имеется доступ к ресурсу веб-приложения и вы знаете, как воспроизвести проблему, либо вам известен точный интервал времени, на котором были выявлены проблемы производительности.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-190">Choose this option if you have access to the web app resource and you know how to reproduce the issue, or if you know the exact time interval the performance issue happens.</span></span>

<span data-ttu-id="5bcb2-191">Если процесс потребляет слишком много ресурсов ЦП и выполняется медленнее, чем вы ожидали, или если задержка HTTP-запросов выше обычной, то вы можете удаленно профилировать такой процесс. Вы получите стеки вызовов с выборками циклов ЦП, по которым можно выполнить анализ действий процесса и критических путей в программном коде.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-191">Remote Profiling is useful if the CPU usage of the process is high and your process is running slower than expected, or the latency of HTTP requests are higher than normal, you can remotely profile your process and get the CPU sampling call stacks to analyze the process activity and code hot paths.</span></span>

<span data-ttu-id="5bcb2-192">Дополнительные сведения см. в статье [Поддержка удаленного профилирования в службе приложений Azure](https://azure.microsoft.com/blog/remote-profiling-support-in-azure-app-service).</span><span class="sxs-lookup"><span data-stu-id="5bcb2-192">For more information, see [Remote Profiling support in Azure App Service](https://azure.microsoft.com/blog/remote-profiling-support-in-azure-app-service).</span></span>

##### <a name="set-up-diagnostic-traces-manually"></a><span data-ttu-id="5bcb2-193">Настройка диагностических трассировок вручную</span><span class="sxs-lookup"><span data-stu-id="5bcb2-193">Set up diagnostic traces manually</span></span>
<span data-ttu-id="5bcb2-194">Если у вас имеется доступ к исходному коду веб-приложения, то с помощью диагностики приложений вы сможете записывать сведения, созданные этим веб-приложением.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-194">If you have access to the web application source code, Application diagnostics enables you to capture information produced by a web application.</span></span> <span data-ttu-id="5bcb2-195">Приложения ASP.NET могут использовать класс `System.Diagnostics.Trace` для записи информации в журнал диагностики приложений.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-195">ASP.NET applications can use the `System.Diagnostics.Trace` class to log information to the application diagnostics log.</span></span> <span data-ttu-id="5bcb2-196">Тем не менее необходимо изменить код приложения и повторно развернуть его.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-196">However, you need to change the code and redeploy your application.</span></span> <span data-ttu-id="5bcb2-197">Этот метод рекомендуется в том случае, если приложение выполняется в тестовой среде.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-197">This method is recommended if your app is running on a testing environment.</span></span>

<span data-ttu-id="5bcb2-198">Подробные инструкции по настройке приложения для ведения журнала вы можете изучить в статье [Включение ведения журнала диагностики для веб-приложений в службе приложений Azure](web-sites-enable-diagnostic-log.md).</span><span class="sxs-lookup"><span data-stu-id="5bcb2-198">For detailed instructions on how to configure your application for logging, see [Enable diagnostics logging for web apps in Azure App Service](web-sites-enable-diagnostic-log.md).</span></span>

#### <a name="use-the-azure-app-service-support-portal"></a><span data-ttu-id="5bcb2-199">Использование портала поддержки службы приложений Azure</span><span class="sxs-lookup"><span data-stu-id="5bcb2-199">Use the Azure App Service support portal</span></span>
<span data-ttu-id="5bcb2-200">Веб-приложения позволяют вам просматривать HTTP-журналы, журналы событий, дампы процессов и другую информацию для диагностики неполадок, связанных с вашим приложением.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-200">Web Apps provides you with the ability to troubleshoot issues related to your web app by looking at HTTP logs, event logs, process dumps, and more.</span></span> <span data-ttu-id="5bcb2-201">Эту информацию вы сможете найти на нашем портале поддержки по адресу **http://&lt;имя приложения>.scm.azurewebsites.net/Support**</span><span class="sxs-lookup"><span data-stu-id="5bcb2-201">You can access all this information using our Support portal at **http://&lt;your app name>.scm.azurewebsites.net/Support**</span></span>

<span data-ttu-id="5bcb2-202">На портале поддержки службы приложений Azure вы увидите три отдельные вкладки, соответствующие трем этапам стандартного процесса устранения неполадок.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-202">The Azure App Service support portal provides you with three separate tabs to support the three steps of a common troubleshooting scenario:</span></span>

1. <span data-ttu-id="5bcb2-203">Наблюдение за поведением.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-203">Observe current behavior</span></span>
2. <span data-ttu-id="5bcb2-204">Сбор диагностических данных и запуск встроенных средств анализа.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-204">Analyze by collecting diagnostics information and running the built-in analyzers</span></span>
3. <span data-ttu-id="5bcb2-205">Устранение неполадки.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-205">Mitigate</span></span>

<span data-ttu-id="5bcb2-206">Если проблема происходит прямо сейчас, щелкните **Анализ** > **Диагностика** > **Диагностировать**. Так вы создадите сеанс диагностики, в ходе которого будут собираться журналы HTTP, журналы просмотра событий, дампы памяти, журналы ошибок PHP и отчет о процессах PHP.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-206">If the issue is happening right now, click **Analyze** > **Diagnostics** > **Diagnose Now** to create a diagnostic session for you, which collects HTTP logs, event viewer logs, memory dumps, PHP error logs, and PHP process report.</span></span>

<span data-ttu-id="5bcb2-207">После сбора данных на портале поддержки будет выполнен их анализ и создан отчет в формате HTML.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-207">Once the data is collected, the support portal runs an analysis on the data and provides you with an HTML report.</span></span>

<span data-ttu-id="5bcb2-208">Вы также можете загрузить собранные данные на свой компьютер. По умолчанию они сохраняются в папке D:\home\data\DaaS.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-208">In case you want to download the data, by default, it would be stored in the D:\home\data\DaaS folder.</span></span>

<span data-ttu-id="5bcb2-209">Дополнительные сведения о возможностях портала поддержки службы приложений Azure см. в записи блога [New Updates to Support Site Extension for Azure Websites](https://azure.microsoft.com/blog/new-updates-to-support-site-extension-for-azure-websites) (Новые обновления для поддержки расширения сайта поддержки для службы "Веб-сайты Azure").</span><span class="sxs-lookup"><span data-stu-id="5bcb2-209">For more information on the Azure App Service support portal, see [New Updates to Support Site Extension for Azure Websites](https://azure.microsoft.com/blog/new-updates-to-support-site-extension-for-azure-websites).</span></span>

#### <a name="use-the-kudu-debug-console"></a><span data-ttu-id="5bcb2-210">Использование консоли отладки Kudu</span><span class="sxs-lookup"><span data-stu-id="5bcb2-210">Use the Kudu Debug Console</span></span>
<span data-ttu-id="5bcb2-211">Веб-приложения оснащены консолью отладки, с помощью которой вы можете получать сведения о среде, используя функции отладки, изучения, передачи файлов и конечных точек JSON.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-211">Web Apps comes with a debug console that you can use for debugging, exploring, uploading files, as well as JSON endpoints for getting information about your environment.</span></span> <span data-ttu-id="5bcb2-212">Она называется *консолью Kudu* или *панелью мониторинга SCM* веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-212">This console is called the *Kudu Console* or the *SCM Dashboard* for your web app.</span></span>

<span data-ttu-id="5bcb2-213">Вы можете открыть эту панель по ссылке **https://&lt;имя приложения>.scm.azurewebsites.net/**.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-213">You can access this dashboard by going to the link **https://&lt;Your app name>.scm.azurewebsites.net/**.</span></span>

<span data-ttu-id="5bcb2-214">Вот некоторые возможности консоли Kudu:</span><span class="sxs-lookup"><span data-stu-id="5bcb2-214">Some of the things that Kudu provides are:</span></span>

* <span data-ttu-id="5bcb2-215">настройки среды для вашего приложения;</span><span class="sxs-lookup"><span data-stu-id="5bcb2-215">environment settings for your application</span></span>
* <span data-ttu-id="5bcb2-216">потоковая передача журналов;</span><span class="sxs-lookup"><span data-stu-id="5bcb2-216">log stream</span></span>
* <span data-ttu-id="5bcb2-217">диагностический дамп;</span><span class="sxs-lookup"><span data-stu-id="5bcb2-217">diagnostic dump</span></span>
* <span data-ttu-id="5bcb2-218">консоль отладки с возможностью запуска командлетов Powershell и основных команд DOS.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-218">debug console in which you can run Powershell cmdlets and basic DOS commands.</span></span>

<span data-ttu-id="5bcb2-219">У консоли Kudu есть еще одна очень полезная функция. Если приложение создает обрабатываемые исключения, с помощью консоли Kudu и средства SysInternals Procdump вы можете получать дампы памяти.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-219">Another useful feature of Kudu is that, in case your application is throwing first-chance exceptions, you can use Kudu and the SysInternals tool Procdump to create memory dumps.</span></span> <span data-ttu-id="5bcb2-220">Эти дампы представляют собой снимок процессов, выполняемых в момент создания исключения. Вы можете использовать эти данные при анализе сложных проблем в веб-приложении.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-220">These memory dumps are snapshots of the process and can often help you troubleshoot more complicated issues with your web app.</span></span>

<span data-ttu-id="5bcb2-221">Дополнительные сведения о возможностях консоли Kudu см. в статье об [инструментах в Интернете для веб-сайтов Microsoft Azure](https://azure.microsoft.com/blog/windows-azure-websites-online-tools-you-should-know-about/).</span><span class="sxs-lookup"><span data-stu-id="5bcb2-221">For more information on features available in Kudu, see [Azure Websites Team Services tools you should know about](https://azure.microsoft.com/blog/windows-azure-websites-online-tools-you-should-know-about/).</span></span>

<a name="mitigate" />

### <a name="3-mitigate-the-issue"></a><span data-ttu-id="5bcb2-222">3. Устранение проблемы</span><span class="sxs-lookup"><span data-stu-id="5bcb2-222">3. Mitigate the issue</span></span>
#### <a name="scale-the-web-app"></a><span data-ttu-id="5bcb2-223">Масштабирование веб-приложения</span><span class="sxs-lookup"><span data-stu-id="5bcb2-223">Scale the web app</span></span>
<span data-ttu-id="5bcb2-224">В службе приложений Azure вы можете изменять масштаб выполнения приложения, чтобы увеличить его производительность и пропускную способность.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-224">In Azure App Service, for increased performance and throughput,  you can adjust the scale at which you are running your application.</span></span> <span data-ttu-id="5bcb2-225">Масштабирование веб-приложений предполагает два связанных действия: изменение ценовой категории для используемого плана службы приложений на более высокую с последующей настройкой некоторых параметров.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-225">Scaling up a web app involves two related actions: changing your App Service plan to a higher pricing tier, and configuring certain settings after you have switched to the higher pricing tier.</span></span>

<span data-ttu-id="5bcb2-226">Дополнительные сведения о масштабировании см. в статье [Увеличение масштаба приложения в Azure](web-sites-scale.md).</span><span class="sxs-lookup"><span data-stu-id="5bcb2-226">For more information on scaling, see [Scale a web app in Azure App Service](web-sites-scale.md).</span></span>

<span data-ttu-id="5bcb2-227">Кроме того, вы можете запустить более одного экземпляра приложения.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-227">Additionally, you can choose to run your application on more than one instance.</span></span> <span data-ttu-id="5bcb2-228">Увеличение масштаба не только увеличит возможности обработки, но и повысит отказоустойчивость приложения.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-228">Scaling out not only provides you with more processing capability, but also gives you some amount of fault tolerance.</span></span> <span data-ttu-id="5bcb2-229">Если прекратит работу процесс на одном экземпляре, другой экземпляр продолжит обрабатывать запросы.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-229">If the process goes down on one instance, the other instances continue to serve requests.</span></span>

<span data-ttu-id="5bcb2-230">Вы можете выбрать ручной или автоматический режим масштабирования.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-230">You can set the scaling to be Manual or Automatic.</span></span>

#### <a name="use-autoheal"></a><span data-ttu-id="5bcb2-231">Использование функции AutoHeal</span><span class="sxs-lookup"><span data-stu-id="5bcb2-231">Use AutoHeal</span></span>
<span data-ttu-id="5bcb2-232">Функция AutoHeal перезапускает рабочий процесс вашего приложения при определенных условиях, которые вы определяете в настройках (например, при изменении конфигурации, при определенном количестве запросов, при достижении ограничений памяти или времени выполнения запроса).</span><span class="sxs-lookup"><span data-stu-id="5bcb2-232">AutoHeal recycles the worker process for your app based on settings you choose (like configuration changes, requests, memory-based limits, or the time needed to execute a request).</span></span> <span data-ttu-id="5bcb2-233">В большинстве случаев повторный запуск процесса будет самым быстрым способом устранения проблемы.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-233">Most of the time, recycle the process is the fastest way to recover from a problem.</span></span> <span data-ttu-id="5bcb2-234">Хотя веб-приложение всегда можно вручную перезапустить на портале Azure, функция AutoHeal позволяет выполнять перезапуск автоматически.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-234">Though you can always restart the web app from directly within the Azure portal, AutoHeal does it automatically for you.</span></span> <span data-ttu-id="5bcb2-235">Для этого достаточно добавить в корневой файл web.config вашего веб-приложения некоторые триггеры.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-235">All you need to do is add some triggers in the root web.config for your web app.</span></span> <span data-ttu-id="5bcb2-236">Эти параметры одинаково работают во всех приложениях, а не только в приложениях .NET.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-236">These settings would work in the same way even if your application is not a .Net app.</span></span>

<span data-ttu-id="5bcb2-237">Дополнительные сведения см. в статье об [автоматическом восстановлении веб-сайтов Microsoft Azure](https://azure.microsoft.com/blog/auto-healing-windows-azure-web-sites/).</span><span class="sxs-lookup"><span data-stu-id="5bcb2-237">For more information, see [Auto-Healing Azure Web Sites](https://azure.microsoft.com/blog/auto-healing-windows-azure-web-sites/).</span></span>

#### <a name="restart-the-web-app"></a><span data-ttu-id="5bcb2-238">Перезапуск веб-приложения</span><span class="sxs-lookup"><span data-stu-id="5bcb2-238">Restart the web app</span></span>
<span data-ttu-id="5bcb2-239">Обычно перезапуск — самый простой способ восстановления работы после проблемы, которая возникла один раз.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-239">Restarting is often the simplest way to recover from one-time issues.</span></span> <span data-ttu-id="5bcb2-240">Остановить или перезапустить приложение можно с помощью колонки веб-приложения на [портале Azure](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="5bcb2-240">On the [Azure portal](https://portal.azure.com/), on your web app’s blade, you have the options to stop or restart your app.</span></span>

 ![Перезапуск веб-приложение для устранения проблем с производительностью](./media/app-service-web-troubleshoot-performance-degradation/2-restart.png)

<span data-ttu-id="5bcb2-242">Управлять приложениями можно также с помощью Azure Powershell.</span><span class="sxs-lookup"><span data-stu-id="5bcb2-242">You can also manage your web app using Azure Powershell.</span></span> <span data-ttu-id="5bcb2-243">Дополнительные сведения см. в статье [Использование Azure PowerShell с диспетчером ресурсов Azure](../powershell-azure-resource-manager.md).</span><span class="sxs-lookup"><span data-stu-id="5bcb2-243">For more information, see [Using Azure PowerShell with Azure Resource Manager](../powershell-azure-resource-manager.md).</span></span>
