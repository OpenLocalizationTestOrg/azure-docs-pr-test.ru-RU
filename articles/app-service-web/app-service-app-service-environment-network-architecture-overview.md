---
title: "Общие сведения об архитектуре сетевых сред службы приложений"
description: "Общие сведения об архитектуре топологии сети сред службы приложений."
services: app-service
documentationcenter: 
author: stefsch
manager: erikre
editor: 
ms.assetid: 13d03a37-1fe2-4e3e-9d57-46dfb330ba52
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/04/2016
ms.author: stefsch
ms.openlocfilehash: b2afe86d8774b449a257312d4e60b5f6125336ca
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="network-architecture-overview-of-app-service-environments"></a><span data-ttu-id="d7205-103">Общие сведения об архитектуре сетевых сред службы приложений</span><span class="sxs-lookup"><span data-stu-id="d7205-103">Network Architecture Overview of App Service Environments</span></span>
## <a name="introduction"></a><span data-ttu-id="d7205-104">Введение</span><span class="sxs-lookup"><span data-stu-id="d7205-104">Introduction</span></span>
<span data-ttu-id="d7205-105">Среда службы приложений всегда создается в подсети [виртуальной сети][virtualnetwork]. Приложения, работающие в среде службы приложений, могут взаимодействовать с частными конечными точками, расположенными в пределах той же топологии виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="d7205-105">App Service Environments are always created within a subnet of a [virtual network][virtualnetwork] - apps running in an App Service Environment can communicate with private endpoints located within the same virtual network topology.</span></span>  <span data-ttu-id="d7205-106">Поскольку клиенты могут заблокировать части инфраструктуры виртуальной сети, важно понять типы потоков сетевой связи, которые возникают в среде службы приложений.</span><span class="sxs-lookup"><span data-stu-id="d7205-106">Since customers may lock down parts of their virtual network infrastructure, it is important to understand the types of network communication flows that occur with an App Service Environment.</span></span>

## <a name="general-network-flow"></a><span data-ttu-id="d7205-107">Общий поток сетевого трафика</span><span class="sxs-lookup"><span data-stu-id="d7205-107">General Network Flow</span></span>
<span data-ttu-id="d7205-108">Когда среда службы приложений (ASE) использует общедоступный виртуальный IP-адрес для приложений, на него поступает весь входящий трафик.</span><span class="sxs-lookup"><span data-stu-id="d7205-108">When an App Service Environment (ASE) uses a public virtual IP address (VIP) for apps, all inbound traffic arrives on that public VIP.</span></span>  <span data-ttu-id="d7205-109">Он включает в себя трафик HTTP и HTTPS приложений, а также прочий трафик FTP, удаленной отладки и операций управления Azure.</span><span class="sxs-lookup"><span data-stu-id="d7205-109">This includes HTTP and HTTPS traffic for apps, as well as other traffic for FTP, remote debugging functionality, and Azure management operations.</span></span>  <span data-ttu-id="d7205-110">Полный список всех портов (обязательных и необязательных) для общедоступного виртуального IP-адреса см. в статье [Как управлять входящим трафиком в среде службы приложений][controllinginboundtraffic].</span><span class="sxs-lookup"><span data-stu-id="d7205-110">For a full list of the specific ports (both required and optional) that are available on the public VIP see the article on [controlling inbound traffic][controllinginboundtraffic] to an App Service Environment.</span></span> 

<span data-ttu-id="d7205-111">Кроме того, среда службы приложений поддерживают работающие приложения, которые привязаны только к внутреннему адресу виртуальной сети, также называемому адресом внутреннего балансировщика нагрузки (ILB).</span><span class="sxs-lookup"><span data-stu-id="d7205-111">App Service Environments also support running apps that are bound only to a virtual network internal address, also referred to as an ILB (internal load balancer) address.</span></span>  <span data-ttu-id="d7205-112">В ASE с внутренним балансировщиком нагрузки весь трафик HTTP и HTTPS приложений и вызовы удаленной отладки поступают на адрес ILB.</span><span class="sxs-lookup"><span data-stu-id="d7205-112">On an ILB enabled ASE, HTTP and HTTPS traffic for apps as well as remote debugging calls, arrive on the ILB address.</span></span>  <span data-ttu-id="d7205-113">В наиболее распространенных конфигурациях ASE с внутренним балансировщиком нагрузки трафик FTP или FTPS также будет поступать на адрес ILB.</span><span class="sxs-lookup"><span data-stu-id="d7205-113">For most common ILB-ASE configurations, FTP/FTPS traffic will also arrive on the ILB address.</span></span>  <span data-ttu-id="d7205-114">Тем не менее операции управления Azure по-прежнему будут поступать через порты 454 и 455 на общедоступный виртуальный IP-адрес ASE с внутренним балансировщиком нагрузки.</span><span class="sxs-lookup"><span data-stu-id="d7205-114">However Azure management operations will still flow to ports 454/455 on the public VIP of an ILB enabled ASE.</span></span>

<span data-ttu-id="d7205-115">На схеме ниже показаны общие сведения о различных входящих и исходящих сетевых трафиках для среды службы приложений, в которой приложения привязаны к общедоступному виртуальному IP-адресу.</span><span class="sxs-lookup"><span data-stu-id="d7205-115">The diagram below shows an overview of the various inbound and outbound network flows for an App Service Environment where the apps are bound to a public virtual IP address:</span></span>

![Общие потоки сетевого трафика][GeneralNetworkFlows]

<span data-ttu-id="d7205-117">Среда службы приложений может взаимодействовать с разными конечными точками частных клиентов.</span><span class="sxs-lookup"><span data-stu-id="d7205-117">An App Service Environment can communicate with a variety of private customer endpoints.</span></span>  <span data-ttu-id="d7205-118">Например приложения, выполняющиеся в среде службы приложений, можно подключить к серверам баз данных, работающих на виртуальных машинах IaaS в виртуальной сети той же топологии.</span><span class="sxs-lookup"><span data-stu-id="d7205-118">For example, apps running in the App Service Environment can connect to database server(s) running on IaaS virtual machines in the same virtual network topology.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d7205-119">Согласно схеме сети, "Другие ресурсы компьютера" развертываются в другой подсети по сравнению со средой службы приложений.</span><span class="sxs-lookup"><span data-stu-id="d7205-119">Looking at the network diagram, the "Other Compute Resources" are deployed in a different Subnet from the App Service Environment.</span></span> <span data-ttu-id="d7205-120">Развертывание ресурсов в одной подсети со средой службы приложений заблокирует подключения среды службы приложений к этим ресурсам (за исключением определенной маршрутизации внутри среды службы приложений).</span><span class="sxs-lookup"><span data-stu-id="d7205-120">Deploying resources in the same Subnet with the ASE will block connectivity from ASE to those resources (except for specific intra-ASE routing).</span></span> <span data-ttu-id="d7205-121">Вместо этого выполните развертывание в другую подсеть (в той же виртуальной сети).</span><span class="sxs-lookup"><span data-stu-id="d7205-121">Deploy to a different Subnet instead (in the same VNET).</span></span> <span data-ttu-id="d7205-122">После этого среда службы приложений сможет выполнить подключение.</span><span class="sxs-lookup"><span data-stu-id="d7205-122">The App Service Environment will then be able to connect.</span></span> <span data-ttu-id="d7205-123">Никаких дополнительных настроек не требуется.</span><span class="sxs-lookup"><span data-stu-id="d7205-123">No additional configuration is necessary.</span></span>
> 
> 

<span data-ttu-id="d7205-124">Среды служб приложений также взаимодействуют с базами данных SQL и ресурсами хранилищ Azure, необходимыми для работы сред и управления ими.</span><span class="sxs-lookup"><span data-stu-id="d7205-124">App Service Environments also communicate with Sql DB and Azure Storage resources necessary for managing and operating an App Service Environment.</span></span>  <span data-ttu-id="d7205-125">Некоторые ресурсы SQL и хранилищ, с которыми взаимодействует среда службы приложений, находятся в одном регионе со средой службы приложений, тогда как другие расположены в удаленных регионах Azure.</span><span class="sxs-lookup"><span data-stu-id="d7205-125">Some of the Sql and Storage resources that an App Service Environment communicates with are located in the same region as the App Service Environment, while others are located in remote Azure regions.</span></span>  <span data-ttu-id="d7205-126">Следовательно, для правильной работы среды службы приложений необходимо исходящее подключение к Интернету.</span><span class="sxs-lookup"><span data-stu-id="d7205-126">As a result, outbound connectivity to the Internet is always required for an App Service Environment to function properly.</span></span> 

<span data-ttu-id="d7205-127">Поскольку среда службы приложений развертывается в подсети, группы безопасности сети можно использовать для управления входящим трафиком подсети.</span><span class="sxs-lookup"><span data-stu-id="d7205-127">Since an App Service Environment is deployed in a subnet, network security groups can be used to control inbound traffic to the subnet.</span></span>  <span data-ttu-id="d7205-128">Дополнительные сведения об управлении входящим трафиком в среде службы приложений см. в следующей [статье][controllinginboundtraffic].</span><span class="sxs-lookup"><span data-stu-id="d7205-128">For details on how to control inbound traffic to an App Service Environment, see the following [article][controllinginboundtraffic].</span></span>

<span data-ttu-id="d7205-129">Дополнительную информацию о разрешении исходящего подключения к Интернету в среде службы приложений см. в статье о работе с [Express Route][ExpressRoute].</span><span class="sxs-lookup"><span data-stu-id="d7205-129">For details on how to allow outbound Internet connectivity from an App Service Environment, see the following article about working with [Express Route][ExpressRoute].</span></span>  <span data-ttu-id="d7205-130">Метод, описанный в статье, применяется также при работе с подключением «сеть — сеть» и при использовании принудительного туннелирования.</span><span class="sxs-lookup"><span data-stu-id="d7205-130">The same approach described in the article applies when working with Site-to-Site connectivity and using forced tunneling.</span></span>

## <a name="outbound-network-addresses"></a><span data-ttu-id="d7205-131">Исходящие сетевые адреса</span><span class="sxs-lookup"><span data-stu-id="d7205-131">Outbound Network Addresses</span></span>
<span data-ttu-id="d7205-132">Когда среда службы приложений отправляет исходящие вызовы, с ними всегда ассоциирован IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="d7205-132">When an App Service Environment makes outbound calls, an IP Address is always associated with the outbound calls.</span></span>  <span data-ttu-id="d7205-133">Используемый IP-адрес определяется расположением вызываемой конечной точки — в виртуальной сети или за ее пределами.</span><span class="sxs-lookup"><span data-stu-id="d7205-133">The specific IP address that is used depends on whether the endpoint being called is located within the virtual network topology, or outside of the virtual network topology.</span></span>

<span data-ttu-id="d7205-134">Если вызываемая конечная точка расположена **за пределами** виртуальной сети, используемый исходящий адрес (или исходящий адрес NAT), является общедоступным виртуальным IP-адресом среды службы приложений.</span><span class="sxs-lookup"><span data-stu-id="d7205-134">If the endpoint being called is **outside** of the virtual network topology, then the outbound address (aka the outbound NAT address) that is used is the public VIP of the App Service Environment.</span></span>  <span data-ttu-id="d7205-135">Этот адрес можно найти в пользовательском интерфейсе портала для среды службы приложений в колонке «Свойства».</span><span class="sxs-lookup"><span data-stu-id="d7205-135">This address can be found in the portal user interface for the App Service Environment in Properties blade.</span></span>

![Исходящий IP-адрес][OutboundIPAddress]

<span data-ttu-id="d7205-137">Данный адрес можно также определить для сред службы приложений, имеющих только общедоступный виртуальный IP-адрес, создав приложение в среде службы приложений, а затем выполнив команду *nslookup* для адреса этого приложения.</span><span class="sxs-lookup"><span data-stu-id="d7205-137">This address can also be determined for ASEs that only have a public VIP by creating an app in the App Service Environment, and then performing an *nslookup* on the app's address.</span></span> <span data-ttu-id="d7205-138">Полученный IP-адрес является общедоступным виртуальным IP-адресом и исходящим адресом NAT среды службы приложений.</span><span class="sxs-lookup"><span data-stu-id="d7205-138">The resultant IP address is both the public VIP, as well as the App Service Environment's outbound NAT address.</span></span>

<span data-ttu-id="d7205-139">Если вызываемая конечная точка расположена **внутри** виртуальной сети, исходящим адресом вызывающего приложения будет внутренний IP-адрес отдельного вычислительного ресурса, на котором запущено приложение.</span><span class="sxs-lookup"><span data-stu-id="d7205-139">If the endpoint being called is **inside** of the virtual network topology, the outbound address of the calling app will be the internal IP address of the individual compute resource running the app.</span></span>  <span data-ttu-id="d7205-140">Однако постоянное сопоставление внутренних IP-адресов виртуальной сети с приложениями не происходит.</span><span class="sxs-lookup"><span data-stu-id="d7205-140">However there is not a persistent mapping of virtual network internal IP addresses to apps.</span></span>  <span data-ttu-id="d7205-141">Приложения можно перемещать между различными вычислительными ресурсами, но из-за операций масштабирования размер пула доступных вычислительных ресурсов в среде службы приложений может меняться.</span><span class="sxs-lookup"><span data-stu-id="d7205-141">Apps can move around across different compute resources, and the pool of available compute resources in an App Service Environment can change due to scaling operations.</span></span>

<span data-ttu-id="d7205-142">Но поскольку среда службы приложений всегда расположена в подсети, внутренний IP-адрес вычислительного ресурса, на котором работает приложение, будет всегда находиться в диапазоне подсети CIDR.</span><span class="sxs-lookup"><span data-stu-id="d7205-142">However, since an App Service Environment is always located within a subnet, you are guaranteed that the internal IP address of a compute resource running an app will always lie within the CIDR range of the subnet.</span></span>  <span data-ttu-id="d7205-143">Поэтому при использовании детальных списков управления доступом или групп безопасности сети для защиты доступа к другим конечным точкам в виртуальной сети необходимо предоставить доступ к подсети, содержащей среду службы приложений.</span><span class="sxs-lookup"><span data-stu-id="d7205-143">As a result, when fine-grained ACLs or network security groups are used to secure access to other endpoints within the virtual network, the subnet range containing the App Service Environment needs to be granted access.</span></span>

<span data-ttu-id="d7205-144">На следующей схеме эти понятия показаны более подробно.</span><span class="sxs-lookup"><span data-stu-id="d7205-144">The following diagram shows these concepts in more detail:</span></span>

![Исходящие сетевые адреса][OutboundNetworkAddresses]

<span data-ttu-id="d7205-146">Расшифровка схемы выше.</span><span class="sxs-lookup"><span data-stu-id="d7205-146">In the above diagram:</span></span>

* <span data-ttu-id="d7205-147">Так как общедоступный виртуальный IP-адрес среды службы приложений — 192.23.1.2, он является исходящим IP-адресом, используемым при отправке вызовов к конечным точкам в «Интернете».</span><span class="sxs-lookup"><span data-stu-id="d7205-147">Since the public VIP of the App Service Environment is 192.23.1.2, that is the outbound IP address used when making calls to "Internet" endpoints.</span></span>
* <span data-ttu-id="d7205-148">Диапазон CIDR подсети, содержащей среду службы приложений — 10.0.1.0/26.</span><span class="sxs-lookup"><span data-stu-id="d7205-148">The CIDR range of the containing subnet for the App Service Environment is 10.0.1.0/26.</span></span>  <span data-ttu-id="d7205-149">Другие конечные точки в пределах инфраструктуры той же виртуальной сети будут «видеть» вызовы из приложений как исходящие из какого-то адреса в этом диапазоне.</span><span class="sxs-lookup"><span data-stu-id="d7205-149">Other endpoints within the same virtual network infrastructure will see calls from apps as originating from somewhere within this address range.</span></span>

## <a name="calls-between-app-service-environments"></a><span data-ttu-id="d7205-150">Вызовы между средами службы приложений</span><span class="sxs-lookup"><span data-stu-id="d7205-150">Calls Between App Service Environments</span></span>
<span data-ttu-id="d7205-151">Более сложный сценарий может наблюдаться в случае, если несколько сред службы приложений развернуты в одной и той же виртуальной сети, при этом из одной среды службы приложений в другую выполняются исходящие вызовы.</span><span class="sxs-lookup"><span data-stu-id="d7205-151">A more complex scenario can occur if you deploy multiple App Service Environments in the same virtual network, and make outbound calls from one App Service Environment to another App Service Environment.</span></span>  <span data-ttu-id="d7205-152">Такие типы вызовов между разными средами службы приложений также рассматриваются как «интернет-вызовы».</span><span class="sxs-lookup"><span data-stu-id="d7205-152">These types of cross App Service Environment calls will also be treated as "Internet" calls.</span></span>

<span data-ttu-id="d7205-153">На схеме ниже показан пример многоуровневой архитектуры с приложениями в одной среде службы приложений (например,  веб-приложения «входной двери»), которые вызывают приложения во второй среде службы приложений (например, внутренние приложения API серверной части, которые не должны быть доступны из Интернета).</span><span class="sxs-lookup"><span data-stu-id="d7205-153">The following diagram shows an example of a layered architecture with apps on one App Service Environment (e.g. "Front door" web apps) calling apps on a second App Service Environment (e.g. internal back-end API apps not intended to be accessible from the Internet).</span></span> 

![Вызовы между средами службы приложений][CallsBetweenAppServiceEnvironments] 

<span data-ttu-id="d7205-155">В приведенном выше примере среда службы приложений «ASE 1» имеет исходящий IP-адрес 192.23.1.2.</span><span class="sxs-lookup"><span data-stu-id="d7205-155">In the example above the App Service Environment "ASE One" has an outbound IP address of 192.23.1.2.</span></span>  <span data-ttu-id="d7205-156">Если приложение, запущенное в этой среде службы приложений, выполняет исходящий вызов приложения, запущенного во второй среде службы приложений («ASE 2»), которая расположена в той же виртуальной сети, то исходящий вызов будет считаться «обращением к Интернету».</span><span class="sxs-lookup"><span data-stu-id="d7205-156">If an app running on this App Service Environment makes an outbound call to an app running on a second App Service Environment ("ASE Two") located in the same virtual network, the outbound call will be treated as an "Internet" call.</span></span>  <span data-ttu-id="d7205-157">В результате сетевой трафик, поступающий во вторую среду службы приложений, будет выглядеть так, как будто он поступает с IP-адреса 192.23.1.2 (т. е. с адреса, не входящего в диапазон адресов подсети первой среды службы приложений).</span><span class="sxs-lookup"><span data-stu-id="d7205-157">As a result the network traffic arriving on the second App Service Environment will show as originating from 192.23.1.2 (i.e. not the subnet address range of the first App Service Environment).</span></span>

<span data-ttu-id="d7205-158">Даже несмотря на то, что вызовы между различными средами службы приложений считаются вызовами «через Интернет», если обе среды службы приложений находятся в одном регионе Azure, сетевой трафик будет оставаться в региональной сети Azure и физически не будет проходить через общедоступный Интернет.</span><span class="sxs-lookup"><span data-stu-id="d7205-158">Even though calls between different App Service Environments are treated as "Internet" calls, when both App Service Environments are located in the same Azure region the network traffic will remain on the regional Azure network and will not physically flow over the public Internet.</span></span>  <span data-ttu-id="d7205-159">В итоге вы можете использовать сетевую группу безопасности в подсети второй среды службы приложений, чтобы разрешить только входящие вызовы с адреса первой среды службы приложений (исходящий IP-адрес которой 192.23.1.2). Тем самым вы обеспечите защищенный обмен данными между средами службы приложений.</span><span class="sxs-lookup"><span data-stu-id="d7205-159">As a result you can use a network security group on the subnet of the second App Service Environment to only allow inbound calls from the first App Service Environment (whose outbound IP address is 192.23.1.2), thus ensuring secure communication between the App Service Environments.</span></span>

## <a name="additional-links-and-information"></a><span data-ttu-id="d7205-160">Дополнительные ссылки и сведения</span><span class="sxs-lookup"><span data-stu-id="d7205-160">Additional Links and Information</span></span>
<span data-ttu-id="d7205-161">Все статьи и практические руководства, посвященные средам службы приложений, доступны в [файле сведений для сред службы приложений](../app-service/app-service-app-service-environments-readme.md).</span><span class="sxs-lookup"><span data-stu-id="d7205-161">All articles and How-To's for App Service Environments are available in the [README for Application Service Environments](../app-service/app-service-app-service-environments-readme.md).</span></span>

<span data-ttu-id="d7205-162">Подробные сведения о входящих портах, используемых средами службы приложений, и о регулировании входящего трафика с помощью групп безопасности сети см. [здесь][controllinginboundtraffic].</span><span class="sxs-lookup"><span data-stu-id="d7205-162">Details on inbound ports used by App Service Environments and using network security groups to control inbound traffic is available [here][controllinginboundtraffic].</span></span>

<span data-ttu-id="d7205-163">Подробные сведения о том, как использовать определенные пользователями маршруты для предоставления средам службы приложений исходящего доступа к Интернету, см. в этой [статье][ExpressRoute].</span><span class="sxs-lookup"><span data-stu-id="d7205-163">Details on using user defined routes to grant outbound Internet access to App Service Environments is available in this [article][ExpressRoute].</span></span> 

<!-- LINKS -->
[virtualnetwork]: http://azure.microsoft.com/services/virtual-network/
[controllinginboundtraffic]:  http://azure.microsoft.com/documentation/articles/app-service-app-service-environment-control-inbound-traffic/
[ExpressRoute]:  http://azure.microsoft.com/documentation/articles/app-service-app-service-environment-network-configuration-expressroute/

<!-- IMAGES -->
[GeneralNetworkFlows]: ./media/app-service-app-service-environment-network-architecture-overview/NetworkOverview-1.png
[OutboundIPAddress]: ./media/app-service-app-service-environment-network-architecture-overview/OutboundIPAddress-1.png
[OutboundNetworkAddresses]: ./media/app-service-app-service-environment-network-architecture-overview/OutboundNetworkAddresses-1.png
[CallsBetweenAppServiceEnvironments]: ./media/app-service-app-service-environment-network-architecture-overview/CallsBetweenEnvironments-1.png

