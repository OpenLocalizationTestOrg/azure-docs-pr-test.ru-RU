---
title: "aaaNetwork сведения о конфигурации для работы с маршрутом, экспресс-выпуск"
description: "Сведения о конфигурации сети для запуска среды службы приложения в виртуальные сети подключены tooan канал ExpressRoute."
services: app-service
documentationcenter: 
author: stefsch
manager: nirma
editor: 
ms.assetid: 34b49178-2595-4d32-9b41-110c96dde6bf
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/14/2016
ms.author: stefsch
ms.openlocfilehash: 85bbc45cfed619485957ee2a898aa0a7604173cb
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="network-configuration-details-for-app-service-environments-with-expressroute"></a>Сведения о конфигурации сети для сред службы приложений с ExpressRoute
## <a name="overview"></a>Обзор
Клиенты могут подключаться [Azure ExpressRoute] [ ExpressRoute] цепь tootheir виртуальная сетевая инфраструктура, расширяя их tooAzure в локальной сети.  Среду службы приложений можно создать в подсети этой инфраструктуры [виртуальной сети][virtualnetwork].  Приложения, работающие на hello среды службы приложений после этого можно установить доступные ресурсы tooback окончания безопасных соединений только через подключение ExpressRoute hello.  

Среду службы приложений можно создать **либо** в виртуальной сети Azure Resource Manager, **либо** в виртуальной сети, использующей классическую модель развертывания.  В связи с последним изменением от июня 2016 г. среды ASE теперь можно также развертывать в виртуальных сетях, использующих либо диапазоны общедоступных адресов, либо адресные пространства RFC1918 (т. е. частные адреса). 

[!INCLUDE [app-service-web-to-api-and-mobile](../../includes/app-service-web-to-api-and-mobile.md)]

## <a name="required-network-connectivity"></a>Необходимое сетевое подключение
Существуют требования сетевого подключения для среды службы приложения, может не соответствовать изначально в виртуальную сеть, подключенную tooan ExpressRoute.  Среды службы приложений требуются все следующие hello в порядке toofunction должным образом:

* Исходящее сетевое подключение tooAzure конечные точки хранилища по всему миру на оба порта 80 и 443.  Сюда входят конечных точках, найденных в hello же регионе, что hello среды службы приложений, а также конечные точки хранилища, расположенный в **других** регионах Azure.  Разрешить конечные точки хранилища Azure в следующих доменов DNS hello: *table.core.windows.net*, *blob.core.windows.net*, *queue.core.windows.net* и *file.core.windows.net*.  
* Исходящее сетевое подключение toohello службы файлов Azure через порт 445.
* Исходящих сетевых конечных точек tooSql DB подключения находятся в hello же региона, как hello среды службы приложений.  Разрешить конечные точки баз данных SQL Server в следующий домен hello: *database.windows.net*.  Для этого необходимо открыть доступ tooports 1433 11000 11999 и 14000 14999.  Дополнительные сведения см. в статье, посвященной [использованию порта базы данных SQL версии 12](../sql-database/sql-database-develop-direct-route-ports-adonet-v12.md).
* Исходящее сетевое подключение toohello плоскость конечные точки управления Azure (конечные точки ассемблерного кода и ARM).  Это включает исходящие подключения tooboth *management.core.windows.net* и *management.azure.com*. 
* Исходящие сетевое подключение слишком*ocsp.msocsp.com*, *mscrl.microsoft.com* и *crl.microsoft.com*.  Это необходимые toosupport функциональность SSL.
* Hello конфигурацию DNS для виртуальной сети hello должны быть способны все конечные точки hello и домены упомянутые в более ранних точек hello.  Если эти конечные точки разрешить нельзя, попытка создания среды службы приложений завершится ошибкой, а существующие среды службы приложений будут помечены как неработоспособные.
* Исходящий доступ через порт 53 необходим для обмена данными с DNS-серверами.
* Если существует пользовательского DNS-сервера на Здравствуйте другом конце VPN-шлюза, hello DNS-сервер должен быть доступен из подсети hello, содержащий hello среды службы приложений. 
* Hello исходящий сетевой путь не может перемещаться по внутренних корпоративных прокси-серверов, а также может быть принудительного туннелирования tooon организациями.  Таким образом, изменения hello эффективный адрес NAT для исходящего сетевого трафика из hello среды службы приложений.  Изменение hello адрес NAT для исходящего сетевого трафика среды службы приложений приведет к потере подключения к toomany сбоев hello конечных точек, перечисленные выше.  Это приведет к неудачным попыткам создания среды службы приложений, а также присвоению ранее работоспособной среде службы приложений статуса неработоспособной.  
* Входящие порты toorequired сетевого доступа для среды службы приложений должны быть разрешены, как описано в этом [статьи][requiredports].

за счет того, настроен и поддерживается для виртуальной сети hello допустимым инфраструктуры DNS может удовлетворить требованиям DNS Hello.  Если для любого hello причина будет изменена конфигурация DNS после создания среды службы приложений, разработчики можно принудительно toopick среды службы приложения hello новой конфигурации DNS.  Последовательное среды перезагрузку, используя значок «Перезапуск» hello hello верхней части колонки управления hello среды службы приложений в hello [портал Azure] [ NewPortal] вызовет toopick среды hello копирование hello новую конфигурацию DNS.

Hello входящего сетевого доступа требования могут быть выполнены путем настройки [сетевой группы безопасности] [ NetworkSecurityGroups] tooallow hello необходимые подсети hello среды службы приложений доступ, как описано в этом [статье][requiredports].

## <a name="enabling-outbound-network-connectivity-for-an-app-service-environment"></a>Активация исходящего сетевого подключения для среды службы приложений
По умолчанию только что созданный канал ExpressRoute объявляет основной маршрут, который позволяет создавать исходящее подключение к Интернету.  В этой конфигурации в среде службы приложений будет tooother может tooconnect конечные точки Azure.

Однако общая конфигурация клиента является toodefine собственные маршрут по умолчанию (0.0.0.0/0), благодаря чему исходящего потока tooinstead трафик Интернета локальной.  Этот поток трафика неизменно прерывается среды службы приложения из-за исходящий трафик hello заблокированных локально, или NAT, где tooan неопознанное набор адресов, которые больше не работают с различные конечные точки Azure.

Hello решением является toodefine один (или более) определяемых пользователем маршрутов (UDRs) на hello подсети, содержащей hello среды службы приложений.  UDR определяет маршруты конкретной подсети, которые будут соблюдаться вместо маршрут по умолчанию hello.

Если это возможно рекомендуется следующая конфигурация hello toouse:

* Конфигурация ExpressRoute Hello объявляет 0.0.0.0/0 и по умолчанию force туннелей всех исходящего трафика в локальной.
* Hello UDR применения toohello подсеть, содержащая hello среды службы приложений определяет 0.0.0.0/0 с тип следующего прыжка (примером этого является дальше вниз в этой статье) через Интернет.

Hello воздействии этих шагов — что уровне подсети hello UDR будет иметь приоритет над hello ExpressRoute принудительного туннелирования, обеспечивая исходящие подключения к Интернету из hello среды службы приложений.

> [!IMPORTANT]
> Здравствуйте маршрутов, указанных в UDR **должен** быть достаточно точным, слишком имеют приоритет над любой маршруты объявляет hello конфигурации ExpressRoute.  пример Hello использует диапазон адресов широкий 0.0.0.0/0 hello и таким образом могут быть случайно переписаны объявлений маршрутов с помощью более конкретных диапазонов адресов.
> 
> Среды службы приложения не поддерживаются с конфигурациями ExpressRoute, **кросс объявлять маршруты из hello открытого пиринга путь toohello частным путем пиринга**.  Конфигурации ExpressRoute, для которых настроен общедоступный пиринг, будут получать объявления маршрутов от корпорации Майкрософт для большого набора диапазонов IP-адресов Microsoft Azure.  Если эти диапазоны адресов между объявленных частным путем пиринга hello, hello конечным результатом является, всех исходящих сетевых пакетов из подсети среды для hello приложения службы будет принудительного туннелирования tooa клиента в локальной сетевой инфраструктуры.  В настоящее время этот сетевой поток не поддерживается в среде службы приложений.  Одна проблема toothis решение — toostop маршруты между рекламу от hello открытого пиринга путь toohello частным путем пиринга.
> 
> 

Справочные сведения об определяемых пользователем маршрутах см. в этом [обзоре][UDROverview].  

Сведения о создании и настройке определяемых пользователем маршрутов доступна в этом [как tooGuide][UDRHowTo].

## <a name="example-udr-configuration-for-an-app-service-environment"></a>Пример настройки UDR для среды службы приложений
**Предварительные требования**

1. Установите Azure Powershell из hello [страницу загрузок Azure] [ AzureDownloads] (от июня 2015 или более поздней версии).  В разделе «Средства командной строки» есть ссылка «Установить» в разделе «Windows Powershell», будут установлены новые командлеты Powershell hello.
2. Мы рекомендуем создать уникальную подсеть для монопольного использования средой службы приложений.  Благодаря этой подсети toohello UDRs применения hello открываются только исходящий трафик для hello среды службы приложений.
3. **Важные**: не развертывайте hello среды службы приложений до **после** выполняются следующие действия по настройке hello.  Это гарантирует, что доступен исходящего сетевого подключения перед выполнением toodeploy среды службы приложений.

**Шаг 1. Создание именованной таблицы маршрутов**

Hello следующий фрагмент кода создает таблицу маршрут с именем «DirectInternetRouteTable» в регионе hello Azure Западная часть США:

    New-AzureRouteTable -Name 'DirectInternetRouteTable' -Location uswest

**Шаг 2: Создайте один или несколько маршрутов в таблице маршрутов hello**

Вам потребуется tooadd один или несколько маршрутов таблицы маршрутов toohello в порядке tooenable исходящие подключения к Интернету.  

Привет, рекомендуется использовать подход для настройки toohello исходящий доступ к Интернету является toodefine маршрут для 0.0.0.0/0, как показано ниже.

    Get-AzureRouteTable -Name 'DirectInternetRouteTable' | Set-AzureRoute -RouteName 'Direct Internet Range 0' -AddressPrefix 0.0.0.0/0 -NextHopType Internet

Следует помните, что 0.0.0.0/0 — это адрес широкий диапазон таким образом, будут переопределяться более конкретные диапазоны адресов, объявленных с hello ExpressRoute.  toore-прохода hello предыдущих рекомендаций, UDR 0.0.0.0/0 маршрут должен использоваться вместе с конфигурацией, объявляет лишь также 0.0.0.0/0 ExressRoute. 

В качестве альтернативы можно загрузить полный и обновленный список диапазонов CIDR, используемый Azure.  Hello XML-файл, содержащий все hello Azure диапазонов адресов доступен из hello [центра загрузки Майкрософт][DownloadCenterAddressRanges].  

Хотя Обратите внимание, что эти диапазоны изменяться со временем, таким образом создавая необходимость toohello периодических обновлений вручную пользователем маршруты tookeep синхронизацию.  Кроме того, так как значение по умолчанию верхний предел в 100 маршрутов в одном UDR будут требуется слишком» использованы Помесячные» hello Azure IP-адрес в диапазоне toofit выходит за пределы hello 100 маршрута, учитывая, что UDR определенных маршрутов должны toobe более точным определением, чем hello маршруты, объявленные с вашей ExpressRoute.  

**Шаг 3: Свяжите hello маршрута таблицы toohello подсети содержащего hello среды службы приложений**

Последний шаг настройки Hello — tooassociate hello маршрута таблицы toohello подсети развертывания hello среды службы приложений.  Hello следующая команда связывает toohello «DirectInternetRouteTable» hello «ASESubnet», который в конечном итоге будет содержать среды службы приложений.

    Set-AzureSubnetRouteTable -VirtualNetworkName 'YourVirtualNetworkNameHere' -SubnetName 'ASESubnet' -RouteTableName 'DirectInternetRouteTable'


**Шаг 4. Заключительные действия**

После таблицы маршрутов hello привязанного toohello подсети, он рекомендуется toofirst теста и убедитесь, что hello предназначен эффект.  Например развертывание виртуальной машины в подсети hello и убедитесь, что:

* Исходящий трафик tooboth Azure и конечные точки не Azure упомянутых ранее в Эта статья является **не** передаче вниз hello канал ExpressRoute.  Очень важно tooverify такое поведение, так как в случае исходящего трафика из подсети hello по-прежнему принудительного туннелирования локально, создание среды службы приложений всегда будет ошибкой. 
* Уточняющие запросы DNS для конечных точек hello упоминалось ранее, все разрешают должным образом. 

После подтверждения hello выше шаги потребуется toodelete hello виртуальной машины, поскольку hello подсеть должна toobe «empty» во время hello hello, при создании среды службы приложений.

После этого продолжите создание среды службы приложений.

## <a name="getting-started"></a>Приступая к работе
Все статьи и как-для пользователя для среды службы приложений теперь доступны в hello [файл README для среды службы приложения](../app-service/app-service-app-service-environments-readme.md).

tooget к работе с среды службы приложения, в разделе [tooApp введение среды службы][IntroToAppServiceEnvironment]

Дополнительные сведения о платформе hello службе приложений Azure см. в разделе [службе приложений Azure][AzureAppService].

<!-- LINKS -->
[virtualnetwork]: http://azure.microsoft.com/services/virtual-network/
[ExpressRoute]: http://azure.microsoft.com/services/expressroute/
[requiredports]: http://azure.microsoft.com/documentation/articles/app-service-app-service-environment-control-inbound-traffic/
[NetworkSecurityGroups]: http://azure.microsoft.com/documentation/articles/virtual-networks-nsg/
[UDROverview]: http://azure.microsoft.com/documentation/articles/virtual-networks-udr-overview/
[UDRHowTo]: http://azure.microsoft.com/documentation/articles/virtual-networks-udr-how-to/
[HowToCreateAnAppServiceEnvironment]: http://azure.microsoft.com/documentation/articles/app-service-web-how-to-create-an-app-service-environment/
[AzureDownloads]: http://azure.microsoft.com/en-us/downloads/ 
[DownloadCenterAddressRanges]: http://www.microsoft.com/download/details.aspx?id=41653  
[NetworkSecurityGroups]: https://azure.microsoft.com/documentation/articles/virtual-networks-nsg/
[AzureAppService]: http://azure.microsoft.com/documentation/articles/app-service-value-prop-what-is/
[IntroToAppServiceEnvironment]:  http://azure.microsoft.com/documentation/articles/app-service-app-service-environment-intro/
[NewPortal]:  https://portal.azure.com


<!-- IMAGES -->
