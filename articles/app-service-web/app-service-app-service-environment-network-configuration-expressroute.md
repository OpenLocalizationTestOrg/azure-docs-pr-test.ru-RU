---
title: "Сведения о настройке сети для работы с Express Route"
description: "Сведения о настройке сети для выполнения сред службы приложений в виртуальных сетях, подключенных к каналу ExpressRoute."
services: app-service
documentationcenter: 
author: stefsch
manager: nirma
editor: 
ms.assetid: 34b49178-2595-4d32-9b41-110c96dde6bf
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/14/2016
ms.author: stefsch
ms.openlocfilehash: de1d998ee86c127149dee18e9df577705054ddb4
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="network-configuration-details-for-app-service-environments-with-expressroute"></a><span data-ttu-id="d3c47-103">Сведения о конфигурации сети для сред службы приложений с ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="d3c47-103">Network Configuration Details for App Service Environments with ExpressRoute</span></span>
## <a name="overview"></a><span data-ttu-id="d3c47-104">Обзор</span><span class="sxs-lookup"><span data-stu-id="d3c47-104">Overview</span></span>
<span data-ttu-id="d3c47-105">Клиенты могут подключить канал [Azure ExpressRoute][ExpressRoute] к своей инфраструктуре виртуальной сети, расширяя таким образом локальную сеть в Azure.</span><span class="sxs-lookup"><span data-stu-id="d3c47-105">Customers can connect an [Azure ExpressRoute][ExpressRoute] circuit to their virtual network infrastructure, thus extending their on-premises network to Azure.</span></span>  <span data-ttu-id="d3c47-106">Среду службы приложений можно создать в подсети этой инфраструктуры [виртуальной сети][virtualnetwork].</span><span class="sxs-lookup"><span data-stu-id="d3c47-106">An App Service Environment can  be created in a subnet of this [virtual network][virtualnetwork] infrastructure.</span></span>  <span data-ttu-id="d3c47-107">Затем с помощью приложений, работающих в среде службы приложений, можно установить безопасное подключение к серверным ресурсам, доступным только через соединение ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="d3c47-107">Apps running on the App Service Environment can then establish secure connections to back-end resources accessible only over the ExpressRoute connection.</span></span>  

<span data-ttu-id="d3c47-108">Среду службы приложений можно создать **либо** в виртуальной сети Azure Resource Manager, **либо** в виртуальной сети, использующей классическую модель развертывания.</span><span class="sxs-lookup"><span data-stu-id="d3c47-108">An App Service Environment can be created in **either** an Azure Resource Manager virtual network, **or** a classic deployment model virtual network.</span></span>  <span data-ttu-id="d3c47-109">В связи с последним изменением от июня 2016 г. среды ASE теперь можно также развертывать в виртуальных сетях, использующих либо диапазоны общедоступных адресов, либо адресные пространства RFC1918 (т. е.</span><span class="sxs-lookup"><span data-stu-id="d3c47-109">With a recent change made in June 2016, ASEs can also now be deployed into virtual networks that use either public address ranges, or RFC1918 address spaces (i.e.</span></span> <span data-ttu-id="d3c47-110">частные адреса).</span><span class="sxs-lookup"><span data-stu-id="d3c47-110">private addresses).</span></span> 

[!INCLUDE [app-service-web-to-api-and-mobile](../../includes/app-service-web-to-api-and-mobile.md)]

## <a name="required-network-connectivity"></a><span data-ttu-id="d3c47-111">Необходимое сетевое подключение</span><span class="sxs-lookup"><span data-stu-id="d3c47-111">Required Network Connectivity</span></span>
<span data-ttu-id="d3c47-112">Существуют требования к сетевому подключению для среды службы приложений, которым изначально может не соответствовать виртуальная сеть, подключенная к ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="d3c47-112">There are network connectivity requirements for App Service Environments that may not be initially met in a virtual network connected to an ExpressRoute.</span></span>  <span data-ttu-id="d3c47-113">Для правильной работы среды службы приложений необходимы следующие компоненты.</span><span class="sxs-lookup"><span data-stu-id="d3c47-113">App Service Environments require all of the following in order to function properly:</span></span>

* <span data-ttu-id="d3c47-114">Исходящие сетевые подключения к конечным точкам службы хранилища Azure по всему миру на портах 80 и 443.</span><span class="sxs-lookup"><span data-stu-id="d3c47-114">Outbound network connectivity to Azure Storage endpoints worldwide on both ports 80 and 443.</span></span>  <span data-ttu-id="d3c47-115">Сюда входят конечные точки, находящиеся в одном регионе со средой службы приложений, а также конечные точки хранилища, расположенные в **других** регионах Azure.</span><span class="sxs-lookup"><span data-stu-id="d3c47-115">This includes endpoints located in the same region as the App Service Environment, as well as storage endpoints located in **other** Azure regions.</span></span>  <span data-ttu-id="d3c47-116">Конечные точки службы хранилища Azure разрешаются в следующих DNS-доменах: *table.core.windows.net*, *blob.core.windows.net*, *queue.core.windows.net* и *file.core.windows.net*.</span><span class="sxs-lookup"><span data-stu-id="d3c47-116">Azure Storage endpoints resolve under the following DNS domains: *table.core.windows.net*, *blob.core.windows.net*, *queue.core.windows.net* and *file.core.windows.net*.</span></span>  
* <span data-ttu-id="d3c47-117">Исходящее сетевое подключение к службе файлов Azure через порт 445.</span><span class="sxs-lookup"><span data-stu-id="d3c47-117">Outbound network connectivity to the Azure Files service on port 445.</span></span>
* <span data-ttu-id="d3c47-118">Исходящие сетевые подключения к конечным точкам баз данных SQL, которые находятся в одном регионе со средой службы приложений.</span><span class="sxs-lookup"><span data-stu-id="d3c47-118">Outbound network connectivity to Sql DB endpoints located in the same region as the App Service Environment.</span></span>  <span data-ttu-id="d3c47-119">Конечные точки баз данных SQL разрешаются в следующем домене: *database.windows.net*.</span><span class="sxs-lookup"><span data-stu-id="d3c47-119">Sql DB endpoints resolve under the following domain:  *database.windows.net*.</span></span>  <span data-ttu-id="d3c47-120">Для этого необходимо открыть доступ к портам 1433, 11000–11999 и 14000–14999.</span><span class="sxs-lookup"><span data-stu-id="d3c47-120">This requires opening access to ports 1433, 11000-11999 and 14000-14999.</span></span>  <span data-ttu-id="d3c47-121">Дополнительные сведения см. в статье, посвященной [использованию порта базы данных SQL версии 12](../sql-database/sql-database-develop-direct-route-ports-adonet-v12.md).</span><span class="sxs-lookup"><span data-stu-id="d3c47-121">For more details see [this article on Sql Database V12 port usage](../sql-database/sql-database-develop-direct-route-ports-adonet-v12.md).</span></span>
* <span data-ttu-id="d3c47-122">Исходящие сетевые подключения к конечным точкам плоскости управления Azure (конечные точки ASM и ARM).</span><span class="sxs-lookup"><span data-stu-id="d3c47-122">Outbound network connectivity to the Azure management plane endpoints (both ASM and ARM endpoints).</span></span>  <span data-ttu-id="d3c47-123">В том числе исходящие подключения к *management.core.windows.net* и *management.azure.com*.</span><span class="sxs-lookup"><span data-stu-id="d3c47-123">This includes outbound connectivity to both *management.core.windows.net* and *management.azure.com*.</span></span> 
* <span data-ttu-id="d3c47-124">Исходящие сетевые подключения к *ocsp.msocsp.com*, *mscrl.microsoft.com* и *crl.microsoft.com*.</span><span class="sxs-lookup"><span data-stu-id="d3c47-124">Outbound network connectivity to *ocsp.msocsp.com*, *mscrl.microsoft.com* and *crl.microsoft.com*.</span></span>  <span data-ttu-id="d3c47-125">Это необходимо для поддержки функций протокола SSL.</span><span class="sxs-lookup"><span data-stu-id="d3c47-125">This is needed to support SSL functionality.</span></span>
* <span data-ttu-id="d3c47-126">Конфигурация DNS для виртуальной сети должна поддерживать разрешение всех конечных точек и доменов, указанных в предыдущих точках.</span><span class="sxs-lookup"><span data-stu-id="d3c47-126">The DNS configuration for the virtual network must be capable of resolving all of the endpoints and domains mentioned in the earlier points.</span></span>  <span data-ttu-id="d3c47-127">Если эти конечные точки разрешить нельзя, попытка создания среды службы приложений завершится ошибкой, а существующие среды службы приложений будут помечены как неработоспособные.</span><span class="sxs-lookup"><span data-stu-id="d3c47-127">If these endpoints cannot be resolved, App Service Environment creation attempts will fail, and existing App Service Environments will be marked as unhealthy.</span></span>
* <span data-ttu-id="d3c47-128">Исходящий доступ через порт 53 необходим для обмена данными с DNS-серверами.</span><span class="sxs-lookup"><span data-stu-id="d3c47-128">Outbound access on port 53 is required for communication with DNS servers.</span></span>
* <span data-ttu-id="d3c47-129">Если на другой стороне VPN-шлюза имеется пользовательский DNS-сервер, этот сервер должен быть доступен из подсети, в которой находится среда службы приложений.</span><span class="sxs-lookup"><span data-stu-id="d3c47-129">If a custom DNS server exists on the other end of a VPN gateway, the DNS server must be reachable from the subnet containing the App Service Environment.</span></span> 
* <span data-ttu-id="d3c47-130">Путь для исходящих сетевых подключений не может проходить через внутренние корпоративные прокси и не может принудительно туннелироваться в локальную среду,</span><span class="sxs-lookup"><span data-stu-id="d3c47-130">The outbound network path cannot travel through internal corporate proxies, nor can it be force tunneled to on-premises.</span></span>  <span data-ttu-id="d3c47-131">потому что в этом случае меняется действующий адрес NAT для исходящего сетевого трафика из среды службы приложений.</span><span class="sxs-lookup"><span data-stu-id="d3c47-131">Doing so changes the effective NAT address of outbound network traffic from the App Service Environment.</span></span>  <span data-ttu-id="d3c47-132">Изменение адреса NAT для исходящего сетевого трафика среды службы приложений приведет к появлению проблем подключения ко многим указанным выше конечным точкам.</span><span class="sxs-lookup"><span data-stu-id="d3c47-132">Changing the NAT address of an App Service Environment's outbound network traffic will cause connectivity failures to many of the endpoints listed above.</span></span>  <span data-ttu-id="d3c47-133">Это приведет к неудачным попыткам создания среды службы приложений, а также присвоению ранее работоспособной среде службы приложений статуса неработоспособной.</span><span class="sxs-lookup"><span data-stu-id="d3c47-133">This results in failed App Service Environment creation attempts, as well as previously healthy App Service Environments being marked as unhealthy.</span></span>  
* <span data-ttu-id="d3c47-134">Необходимо предоставить разрешения для входящих сетевых подключений на нужных портах для сред службы приложений согласно процедуре, описанной в этой [статье][requiredports].</span><span class="sxs-lookup"><span data-stu-id="d3c47-134">Inbound network access to required ports for App Service Environments must be allowed as described in this [article][requiredports].</span></span>

<span data-ttu-id="d3c47-135">Требования DNS обеспечиваются за счет создания допустимой инфраструктуры DNS и ее поддержания для виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="d3c47-135">The DNS requirements can be met by ensuring a valid DNS infrastructure is configured and maintained for the virtual network.</span></span>  <span data-ttu-id="d3c47-136">Если после создания среды службы приложений по какой-либо причине меняется конфигурация DNS, разработчик может принудительно задать выбор новой конфигурации DNS в среде службы приложений.</span><span class="sxs-lookup"><span data-stu-id="d3c47-136">If for any reason the DNS configuration is changed after an App Service Environment has been created, developers can force an App Service Environment to pick up the new DNS configuration.</span></span>  <span data-ttu-id="d3c47-137">Если перезагрузить разворачиваемую среду, используя значок "Перезапуск", расположенный в верхней части колонки управления средой службы приложений на [классическом портале Azure][NewPortal], будет выбрана новая конфигурация DNS в среде.</span><span class="sxs-lookup"><span data-stu-id="d3c47-137">Triggering a rolling environment reboot using the "Restart" icon located at the top of the App Service Environment management blade in the [Azure portal][NewPortal] will cause the environment to pick up the new DNS configuration.</span></span>

<span data-ttu-id="d3c47-138">Требования ко входящим сетевым подключениям можно выполнить, настроив [группу безопасности сети][NetworkSecurityGroups] в подсети среды службы приложений. Дополнительные сведения о предоставлении необходимого доступа см. в этой [статье][requiredports].</span><span class="sxs-lookup"><span data-stu-id="d3c47-138">The inbound network access requirements can be met by configuring a [network security group][NetworkSecurityGroups] on the App Service Environment's subnet to allow the required access as described in this [article][requiredports].</span></span>

## <a name="enabling-outbound-network-connectivity-for-an-app-service-environment"></a><span data-ttu-id="d3c47-139">Активация исходящего сетевого подключения для среды службы приложений</span><span class="sxs-lookup"><span data-stu-id="d3c47-139">Enabling Outbound Network Connectivity for an App Service Environment</span></span>
<span data-ttu-id="d3c47-140">По умолчанию только что созданный канал ExpressRoute объявляет основной маршрут, который позволяет создавать исходящее подключение к Интернету.</span><span class="sxs-lookup"><span data-stu-id="d3c47-140">By default, a newly created ExpressRoute circuit advertises a default route that allows outbound Internet connectivity.</span></span>  <span data-ttu-id="d3c47-141">С такой конфигурацией среда службы приложений сможет подключаться к другим конечным точкам Azure.</span><span class="sxs-lookup"><span data-stu-id="d3c47-141">With this configuration an App Service Environment will be able to connect to other Azure endpoints.</span></span>

<span data-ttu-id="d3c47-142">Тем не менее в типовой клиентской конфигурации определяется собственный основной маршрут (0.0.0.0/0), который вместо этого направляет исходящий интернет-трафик в локальную среду.</span><span class="sxs-lookup"><span data-stu-id="d3c47-142">However a common customer configuration is to define their own default route (0.0.0.0/0) which forces outbound Internet traffic to instead flow on-premises.</span></span>  <span data-ttu-id="d3c47-143">Этот поток трафика постоянно прерывает среды службы приложений, поскольку исходящий трафик заблокирован локально или транслирован с помощью NAT в нераспознаваемый набор адресов, которые больше не относятся к различным конечным точкам Azure.</span><span class="sxs-lookup"><span data-stu-id="d3c47-143">This traffic flow invariably breaks App Service Environments because the outbound traffic is either blocked on-premises, or NAT'd to an unrecognizable set of addresses that no longer work with various Azure endpoints.</span></span>

<span data-ttu-id="d3c47-144">Чтобы решить проблему, следует указать один или несколько определяемых пользователем маршрутов в подсети, которая содержит среду службы приложений.</span><span class="sxs-lookup"><span data-stu-id="d3c47-144">The solution is to define one (or more) user defined routes (UDRs) on the subnet that contains the App Service Environment.</span></span>  <span data-ttu-id="d3c47-145">Определяемые пользователем маршруты задают маршруты для подсети, которые будут использоваться вместо основного маршрута.</span><span class="sxs-lookup"><span data-stu-id="d3c47-145">A UDR defines subnet-specific routes that will be honored instead of the default route.</span></span>

<span data-ttu-id="d3c47-146">При возможности рекомендуется использовать следующую конфигурацию:</span><span class="sxs-lookup"><span data-stu-id="d3c47-146">If possible, it is recommended to use the following configuration:</span></span>

* <span data-ttu-id="d3c47-147">Конфигурация ExpressRoute объявляет маршрут 0.0.0.0/0 и по умолчанию организует принудительное туннелирование всех исходящих подключений в локальную среду.</span><span class="sxs-lookup"><span data-stu-id="d3c47-147">The ExpressRoute configuration advertises 0.0.0.0/0 and by default force tunnels all outbound traffic on-premises.</span></span>
* <span data-ttu-id="d3c47-148">UDR, примененный к подсети, содержащей среду службы приложений, задает маршрут 0.0.0.0/0 со следующим переходом типа «Интернет» (пример см. ниже в этой статье).</span><span class="sxs-lookup"><span data-stu-id="d3c47-148">The UDR applied to the subnet containing the App Service Environment defines 0.0.0.0/0 with a next hop type of Internet (an example of this is farther down in this article).</span></span>

<span data-ttu-id="d3c47-149">В результате этих действий UDR уровня подсети будет иметь приоритет над принудительным туннелированием ExpressRoute, обеспечивая исходящий интернет-доступ из среды службы приложений.</span><span class="sxs-lookup"><span data-stu-id="d3c47-149">The combined effect of these steps is that the subnet level UDR will take precedence over the ExpressRoute forced tunneling, thus ensuring outbound Internet access from the App Service Environment.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d3c47-150">Маршруты, указанные в UDR, **должны** быть достаточно конкретными, чтобы иметь приоритет над всеми маршрутами, объявленными в конфигурации ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="d3c47-150">The routes defined in a UDR **must** be specific enough to  take precedence over any routes advertised by the ExpressRoute configuration.</span></span>  <span data-ttu-id="d3c47-151">В приведенном ниже примере используется широкий диапазон адресов 0.0.0.0/0, и, таким образом, он может быть случайно заменен объявлениями маршрутов с более узкими диапазонами адресов.</span><span class="sxs-lookup"><span data-stu-id="d3c47-151">The example below uses the broad 0.0.0.0/0 address range, and as such can potentially be accidentally overridden by route advertisements using more specific address ranges.</span></span>
> 
> <span data-ttu-id="d3c47-152">Среды службы приложений с конфигурациями ExpressRoute, **осуществляющие перекрестное объявление маршрутов из пути общедоступного пиринга в путь частного пиринга**, не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="d3c47-152">App Service Environments are not supported with ExpressRoute configurations that **cross-advertise routes from the public peering path to the private peering path**.</span></span>  <span data-ttu-id="d3c47-153">Конфигурации ExpressRoute, для которых настроен общедоступный пиринг, будут получать объявления маршрутов от корпорации Майкрософт для большого набора диапазонов IP-адресов Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="d3c47-153">ExpressRoute configurations that have public peering configured, will receive route advertisements from Microsoft for a large set of Microsoft Azure IP address ranges.</span></span>  <span data-ttu-id="d3c47-154">Если эти диапазоны адресов перекрестно объявляются по пути закрытого пиринга, то все исходящие сетевые пакеты из подсети среды службы приложений будут принудительно туннелироваться в локальную сетевую инфраструктуру клиента.</span><span class="sxs-lookup"><span data-stu-id="d3c47-154">If these address ranges are cross-advertised on the private peering path, the end result is that all outbound network packets from the App Service Environment's subnet will be force-tunneled to a customer's on-premises network infrastructure.</span></span>  <span data-ttu-id="d3c47-155">В настоящее время этот сетевой поток не поддерживается в среде службы приложений.</span><span class="sxs-lookup"><span data-stu-id="d3c47-155">This network flow is currently not supported with App Service Environments.</span></span>  <span data-ttu-id="d3c47-156">Чтобы решить эту проблему, необходимо остановить перекрестное объявление маршрутов между путем общедоступного и закрытого пиринга.</span><span class="sxs-lookup"><span data-stu-id="d3c47-156">One solution to this problem is to stop cross-advertising routes from the public peering path to the private peering path.</span></span>
> 
> 

<span data-ttu-id="d3c47-157">Справочные сведения об определяемых пользователем маршрутах см. в этом [обзоре][UDROverview].</span><span class="sxs-lookup"><span data-stu-id="d3c47-157">Background information on user defined routes is available in this [overview][UDROverview].</span></span>  

<span data-ttu-id="d3c47-158">Сведения о создании и настройке определяемых пользователем маршрутов см. в этом [руководстве][UDRHowTo].</span><span class="sxs-lookup"><span data-stu-id="d3c47-158">Details on creating and configuring user defined routes is available in this [How To Guide][UDRHowTo].</span></span>

## <a name="example-udr-configuration-for-an-app-service-environment"></a><span data-ttu-id="d3c47-159">Пример настройки UDR для среды службы приложений</span><span class="sxs-lookup"><span data-stu-id="d3c47-159">Example UDR Configuration for an App Service Environment</span></span>
<span data-ttu-id="d3c47-160">**Предварительные требования**</span><span class="sxs-lookup"><span data-stu-id="d3c47-160">**Pre-requisites**</span></span>

1. <span data-ttu-id="d3c47-161">Скачайте Azure Powershell на [странице загружаемых файлов Azure][AzureDownloads] (за июнь 2015 г. или позже).</span><span class="sxs-lookup"><span data-stu-id="d3c47-161">Install Azure Powershell from the [Azure Downloads page][AzureDownloads] (dated June 2015 or later).</span></span>  <span data-ttu-id="d3c47-162">В разделе "Средства командной строки" выберите ссылку "Установка" в разделе Windows Powershell, чтобы установить последние командлеты Powershell.</span><span class="sxs-lookup"><span data-stu-id="d3c47-162">Under "Command-line tools" there is an "Install" link under "Windows Powershell" that will install the latest Powershell cmdlets.</span></span>
2. <span data-ttu-id="d3c47-163">Мы рекомендуем создать уникальную подсеть для монопольного использования средой службы приложений.</span><span class="sxs-lookup"><span data-stu-id="d3c47-163">It is recommended that a unique subnet is created for exclusive use by an App Service Environment.</span></span>  <span data-ttu-id="d3c47-164">В этом случае маршруты UDR, используемые в подсети, будут открывать только исходящий трафик для среды службы приложений.</span><span class="sxs-lookup"><span data-stu-id="d3c47-164">This ensures that the UDRs applied to the subnet will only open outbound traffic for the App Service Environment.</span></span>
3. <span data-ttu-id="d3c47-165">**Важно!** Не развертывайте среду службы приложений, **не** выполнив следующих действий по настройке.</span><span class="sxs-lookup"><span data-stu-id="d3c47-165">**Important**:  do not deploy the App Service Environment until **after** the following configuration steps are followed.</span></span>  <span data-ttu-id="d3c47-166">Это гарантирует наличие исходящего сетевого подключения до развертывания среды службы приложений.</span><span class="sxs-lookup"><span data-stu-id="d3c47-166">This ensures that outbound network connectivity is available before attempting to deploy an App Service Environment.</span></span>

<span data-ttu-id="d3c47-167">**Шаг 1. Создание именованной таблицы маршрутов**</span><span class="sxs-lookup"><span data-stu-id="d3c47-167">**Step 1:  Create a named route table**</span></span>

<span data-ttu-id="d3c47-168">Следующий фрагмент кода создает таблицу маршрутов с именем DirectInternetRouteTable в регионе Azure Запад США.</span><span class="sxs-lookup"><span data-stu-id="d3c47-168">The following snippet creates a route table called "DirectInternetRouteTable" in the West US Azure region:</span></span>

    New-AzureRouteTable -Name 'DirectInternetRouteTable' -Location uswest

<span data-ttu-id="d3c47-169">**Шаг 2. Создание одного или нескольких маршрутов в таблице**</span><span class="sxs-lookup"><span data-stu-id="d3c47-169">**Step 2:  Create one or more routes in the route table**</span></span>

<span data-ttu-id="d3c47-170">Чтобы включить исходящий доступ к Интернету, в таблицу необходимо добавить один или несколько маршрутов.</span><span class="sxs-lookup"><span data-stu-id="d3c47-170">You will need to add one or more routes to the route table in order to enable outbound Internet access.</span></span>  

<span data-ttu-id="d3c47-171">При настройке исходящих интернет-подключений рекомендуется задать маршрут 0.0.0.0/0, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="d3c47-171">The recommended approach for configuring outbound access to the Internet is to define a route for 0.0.0.0/0 as shown below.</span></span>

    Get-AzureRouteTable -Name 'DirectInternetRouteTable' | Set-AzureRoute -RouteName 'Direct Internet Range 0' -AddressPrefix 0.0.0.0/0 -NextHopType Internet

<span data-ttu-id="d3c47-172">Помните, что 0.0.0.0/0 — это широкий диапазон адресов, поэтому он будет замещен более узкими диапазонами адресов, объявленными в ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="d3c47-172">Remember that 0.0.0.0/0 is a broad address range, and as such will be overridden by more specific address ranges advertised by the ExpressRoute.</span></span>  <span data-ttu-id="d3c47-173">Повторим уже упоминавшуюся рекомендацию: UDR с маршрутом 0.0.0.0/0 следует использовать вместе с конфигурацией ExressRoute, которая также объявляет лишь 0.0.0.0/0.</span><span class="sxs-lookup"><span data-stu-id="d3c47-173">To re-iterate the earlier recommendation, a UDR with a 0.0.0.0/0 route should be used in conjunction with an ExressRoute configuration that only advertises 0.0.0.0/0 as well.</span></span> 

<span data-ttu-id="d3c47-174">В качестве альтернативы можно загрузить полный и обновленный список диапазонов CIDR, используемый Azure.</span><span class="sxs-lookup"><span data-stu-id="d3c47-174">As an alternative, you can download a comprehensive and updated list of CIDR ranges in use by Azure.</span></span>  <span data-ttu-id="d3c47-175">XML-файл, содержащий все диапазоны IP-адресов Azure, доступен в [Центре загрузки Майкрософт][DownloadCenterAddressRanges].</span><span class="sxs-lookup"><span data-stu-id="d3c47-175">The Xml file containing all of the Azure IP address ranges is available from the [Microsoft Download Center][DownloadCenterAddressRanges].</span></span>  

<span data-ttu-id="d3c47-176">Тем не менее обратите внимание, что эти диапазоны иногда меняются, поэтому определяемые пользователем маршруты нужно периодически обновлять вручную.</span><span class="sxs-lookup"><span data-stu-id="d3c47-176">Note though that these ranges change over time, thus necessitating periodic manual updates to the user defined routes to keep in sync.</span></span>  <span data-ttu-id="d3c47-177">Кроме того, в одном определяемом пользователем маршруте верхний предел по умолчанию составляет 100 маршрутов, поэтому потребуется "объединить" диапазоны IP-адресов Azure в соответствии с ограничением на 100 маршрутов, не забывая о том, что маршруты, определенные в UDR, должны быть более точными, чем маршруты, объявленные в ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="d3c47-177">Also, since there is a default upper limit of 100 routes in a single UDR, you will need to "summarize" the Azure IP address ranges to fit within the 100 route limit, keeping in mind that UDR defined routes need to be more specific than the routes advertised by your ExpressRoute.</span></span>  

<span data-ttu-id="d3c47-178">**Шаг 3. Привязка таблицы маршрутов к подсети, содержащей среду службы приложений**</span><span class="sxs-lookup"><span data-stu-id="d3c47-178">**Step 3:  Associate the route table to the subnet containing the App Service Environment**</span></span>

<span data-ttu-id="d3c47-179">В последнем шаге настройки таблицу маршрутов необходимо привязать к подсети, в которой будет развернута среда службы приложений.</span><span class="sxs-lookup"><span data-stu-id="d3c47-179">The last  configuration step is to associate the route table to the subnet where the App Service Environment will be deployed.</span></span>  <span data-ttu-id="d3c47-180">Следующая команда привязывает DirectInternetRouteTable к ASESubnet, которая в конечном итоге будет содержать среду службы приложений.</span><span class="sxs-lookup"><span data-stu-id="d3c47-180">The following command associates the "DirectInternetRouteTable" to the "ASESubnet" that will eventually contain an App Service Environment.</span></span>

    Set-AzureSubnetRouteTable -VirtualNetworkName 'YourVirtualNetworkNameHere' -SubnetName 'ASESubnet' -RouteTableName 'DirectInternetRouteTable'


<span data-ttu-id="d3c47-181">**Шаг 4. Заключительные действия**</span><span class="sxs-lookup"><span data-stu-id="d3c47-181">**Step 4:  Final Steps**</span></span>

<span data-ttu-id="d3c47-182">После привязки таблицы маршрутов к подсети мы рекомендуем сначала выполнить тестирование и убедиться в требуемом результате.</span><span class="sxs-lookup"><span data-stu-id="d3c47-182">Once the route table is bound to the subnet, it is recommended to first test and confirm the intended effect.</span></span>  <span data-ttu-id="d3c47-183">Например, разверните виртуальную машину в подсети и убедитесь в следующем, что следующие утверждения верны.</span><span class="sxs-lookup"><span data-stu-id="d3c47-183">For example, deploy a virtual machine into the subnet and confirm that:</span></span>

* <span data-ttu-id="d3c47-184">Исходящий трафик на конечные точки Azure и другие, указанные выше в этой статье, **не** проходит по кругу ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="d3c47-184">Outbound traffic to both Azure and non-Azure endpoints mentioned earlier in this article is **not** flowing down the ExpressRoute circuit.</span></span>  <span data-ttu-id="d3c47-185">Очень важно убедиться, что это так, поскольку, если исходящий трафик из подсети по-прежнему принудительно туннелируется в локальную среду, все попытки создать среду службы приложений завершатся неудачей.</span><span class="sxs-lookup"><span data-stu-id="d3c47-185">It is very important to verify this behavior, since if outbound traffic from the subnet is still being forced tunneled on-premises, App Service Environment creation will always fail.</span></span> 
* <span data-ttu-id="d3c47-186">Все уточняющие запросы DNS для конечных точек, упомянутых выше, разрешаются правильно.</span><span class="sxs-lookup"><span data-stu-id="d3c47-186">DNS lookups for the endpoints mentioned earlier are all resolving properly.</span></span> 

<span data-ttu-id="d3c47-187">После подтверждения описанных выше действий нужно будет удалить виртуальную машину, поскольку подсеть должна быть «пустой» во время создания среды службы приложений.</span><span class="sxs-lookup"><span data-stu-id="d3c47-187">Once the above steps are confirmed, you will need to delete the virtual machine because the subnet needs to be "empty" at the time the App Service Environment is created.</span></span>

<span data-ttu-id="d3c47-188">После этого продолжите создание среды службы приложений.</span><span class="sxs-lookup"><span data-stu-id="d3c47-188">Then proceed with creating an App Service Environment!</span></span>

## <a name="getting-started"></a><span data-ttu-id="d3c47-189">Приступая к работе</span><span class="sxs-lookup"><span data-stu-id="d3c47-189">Getting started</span></span>
<span data-ttu-id="d3c47-190">Все статьи и практические руководства, посвященные средам службы приложений, доступны в [файле сведений для сред службы приложений](../app-service/app-service-app-service-environments-readme.md).</span><span class="sxs-lookup"><span data-stu-id="d3c47-190">All articles and How-To's for App Service Environments are available in the [README for Application Service Environments](../app-service/app-service-app-service-environments-readme.md).</span></span>

<span data-ttu-id="d3c47-191">Сведения о том, как начать работу со средами службы приложений, см. в статье [Введение в среду службы приложений][IntroToAppServiceEnvironment].</span><span class="sxs-lookup"><span data-stu-id="d3c47-191">To get started with App Service Environments, see [Introduction to App Service Environment][IntroToAppServiceEnvironment]</span></span>

<span data-ttu-id="d3c47-192">Дополнительные сведения о платформе службы приложений Azure см. в статье [Что такое служба приложений Azure?][AzureAppService]</span><span class="sxs-lookup"><span data-stu-id="d3c47-192">For more information about the Azure App Service platform, see [Azure App Service][AzureAppService].</span></span>

<!-- LINKS -->
[virtualnetwork]: http://azure.microsoft.com/services/virtual-network/
[ExpressRoute]: http://azure.microsoft.com/services/expressroute/
[requiredports]: http://azure.microsoft.com/documentation/articles/app-service-app-service-environment-control-inbound-traffic/
[NetworkSecurityGroups]: http://azure.microsoft.com/documentation/articles/virtual-networks-nsg/
[UDROverview]: http://azure.microsoft.com/documentation/articles/virtual-networks-udr-overview/
[UDRHowTo]: http://azure.microsoft.com/documentation/articles/virtual-networks-udr-how-to/
[HowToCreateAnAppServiceEnvironment]: http://azure.microsoft.com/documentation/articles/app-service-web-how-to-create-an-app-service-environment/
[AzureDownloads]: http://azure.microsoft.com/en-us/downloads/ 
[DownloadCenterAddressRanges]: http://www.microsoft.com/download/details.aspx?id=41653  
[NetworkSecurityGroups]: https://azure.microsoft.com/documentation/articles/virtual-networks-nsg/
[AzureAppService]: http://azure.microsoft.com/documentation/articles/app-service-value-prop-what-is/
[IntroToAppServiceEnvironment]:  http://azure.microsoft.com/documentation/articles/app-service-app-service-environment-intro/
[NewPortal]:  https://portal.azure.com


<!-- IMAGES -->
