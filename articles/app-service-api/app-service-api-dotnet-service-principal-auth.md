---
title: "aaaService основной проверки подлинности для приложений API в службе приложений Azure | Документы Microsoft"
description: "Узнайте, как tooprotect API приложения в службе приложений Azure для сценариев служба служба."
services: app-service\api
documentationcenter: .net
author: alexkarcher-msft
manager: erikre
editor: 
ms.assetid: 7ca0bab2-1d29-4d51-b779-dce0edd34f8b
ms.service: app-service-api
ms.workload: na
ms.tgt_pltfrm: dotnet
ms.devlang: na
ms.topic: article
ms.date: 06/30/2016
ms.author: alkarche
ms.openlocfilehash: 94d9ee11f38293df4a2fd815ef02c59cc6defed4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="service-principal-authentication-for-api-apps-in-azure-app-service"></a><span data-ttu-id="d2493-103">Проверка подлинности с использованием субъекта-службы для приложений API в службе приложений Azure</span><span class="sxs-lookup"><span data-stu-id="d2493-103">Service principal authentication for API Apps in Azure App Service</span></span>
## <a name="overview"></a><span data-ttu-id="d2493-104">Обзор</span><span class="sxs-lookup"><span data-stu-id="d2493-104">Overview</span></span>
<span data-ttu-id="d2493-105">В этой статье объясняется способ проверки подлинности службы приложения toouse для *внутренней* доступа к приложениям tooAPI.</span><span class="sxs-lookup"><span data-stu-id="d2493-105">This article explains how toouse App Service authentication for *internal* access tooAPI apps.</span></span> <span data-ttu-id="d2493-106">Внутренний сценарий вас есть приложение API, что требуется toobe использоваться только в коде приложения.</span><span class="sxs-lookup"><span data-stu-id="d2493-106">An internal scenario is where you have an API app that you want toobe consumable only by your own application code.</span></span> <span data-ttu-id="d2493-107">Hello рекомендуется tooimplement способом этот сценарий в службе приложений Azure AD toouse tooprotect hello называется приложения API.</span><span class="sxs-lookup"><span data-stu-id="d2493-107">hello recommended way tooimplement this scenario in App Service is toouse Azure AD tooprotect hello called API app.</span></span> <span data-ttu-id="d2493-108">Вызов приложения hello защищенный API с токен носителя, получаемые из Azure AD, предоставляя удостоверение приложения учетные данные (субъекта-службы).</span><span class="sxs-lookup"><span data-stu-id="d2493-108">You call hello protected API app with a bearer token that you get from Azure AD by providing application identity (service principal) credentials.</span></span> <span data-ttu-id="d2493-109">Альтернативные варианты toousing Azure AD, в разделе hello **проверки подлинности службы для службы** раздел hello [обзор проверки подлинности в службе приложений Azure](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span><span class="sxs-lookup"><span data-stu-id="d2493-109">For alternatives toousing Azure AD, see hello **Service-to-service authentication** section of hello [Azure App Service authentication overview](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span></span>

<span data-ttu-id="d2493-110">Из этой статьи вы узнаете следующее.</span><span class="sxs-lookup"><span data-stu-id="d2493-110">In this article, you'll learn:</span></span>

* <span data-ttu-id="d2493-111">Как приложения Azure Active Directory (Azure AD) tooprotect API toouse доступ без проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="d2493-111">How toouse Azure Active Directory (Azure AD) tooprotect an API app from unauthenticated access.</span></span>
* <span data-ttu-id="d2493-112">Как tooconsume защищенный API приложения из приложения API, веб-приложения или мобильные приложения с помощью учетных данных участника (удостоверение приложения) службы Azure AD.</span><span class="sxs-lookup"><span data-stu-id="d2493-112">How tooconsume a protected API app from an API app, web app, or mobile app by using Azure AD service principal (app identity) credentials.</span></span> <span data-ttu-id="d2493-113">Сведения о том, как tooconsume из логики приложения, в разделе [с помощью настраиваемого API, размещенных в службе приложений с приложениями логики](../logic-apps/logic-apps-custom-hosted-api.md).</span><span class="sxs-lookup"><span data-stu-id="d2493-113">For information about how tooconsume from a logic app, see [Using your custom API hosted on App Service with Logic apps](../logic-apps/logic-apps-custom-hosted-api.md).</span></span>
* <span data-ttu-id="d2493-114">Как toomake, убедитесь, что этот hello защищен приложения API не может вызываться из браузера, в системе работают пользователи.</span><span class="sxs-lookup"><span data-stu-id="d2493-114">How toomake sure that hello protected API app can't be called from a browser by logged on users.</span></span>
* <span data-ttu-id="d2493-115">Как убедиться, что hello защищенные приложения API toomake только может вызываться с конкретного участника-службы Azure AD.</span><span class="sxs-lookup"><span data-stu-id="d2493-115">How toomake sure that hello protected API app can only be called by a specific Azure AD service principal.</span></span>

<span data-ttu-id="d2493-116">статья Hello содержит два раздела:</span><span class="sxs-lookup"><span data-stu-id="d2493-116">hello article contains two sections:</span></span>

* <span data-ttu-id="d2493-117">Hello [как tooconfigure службы основной проверки подлинности в службе приложений Azure](#authconfig) разделе объясняется, как общие tooconfigure проверки подлинности для любого приложения API и защищать приложения API tooconsume hello.</span><span class="sxs-lookup"><span data-stu-id="d2493-117">hello [How tooconfigure service principal authentication in Azure App Service](#authconfig) section explains in general how tooconfigure authentication for any API app, and how tooconsume hello protected API app.</span></span> <span data-ttu-id="d2493-118">В этом разделе, одинаково применимо tooall платформы, поддерживаемые службой приложений, включая .NET, Node.js и Java.</span><span class="sxs-lookup"><span data-stu-id="d2493-118">This section applies equally tooall frameworks supported by App Service, including .NET, Node.js, and Java.</span></span>
* <span data-ttu-id="d2493-119">Начиная с hello [продолжением учебники Приступая к работе .NET hello](#tutorialstart) разделе hello учебник поможет настроить сценарий «внутренний доступ» для образца приложения .NET, запущенные в службе приложений.</span><span class="sxs-lookup"><span data-stu-id="d2493-119">Starting with hello [Continuing hello .NET getting-started tutorials](#tutorialstart) section, hello tutorial guides you through configuring an "internal access" scenario for a .NET sample application running in App Service.</span></span> 

## <span data-ttu-id="d2493-120"><a id="authconfig"></a>Как tooconfigure службы основной проверки подлинности в службе приложений Azure</span><span class="sxs-lookup"><span data-stu-id="d2493-120"><a id="authconfig"></a> How tooconfigure service principal authentication in Azure App Service</span></span>
<span data-ttu-id="d2493-121">В этом разделе приведены общие инструкции, применимые tooany приложения API.</span><span class="sxs-lookup"><span data-stu-id="d2493-121">This section provides general instructions that apply tooany API app.</span></span> <span data-ttu-id="d2493-122">TooDo toohello конкретного действия .NET списка образец приложения, см. слишком[продолжением учебника ряда приложений .NET API hello](#tutorialstart).</span><span class="sxs-lookup"><span data-stu-id="d2493-122">For steps specific toohello tooDo List .NET sample application, go too[Continuing hello .NET API Apps tutorial series](#tutorialstart).</span></span>

1. <span data-ttu-id="d2493-123">В hello [портал Azure](https://portal.azure.com/), перейдите toohello **параметры** колонке приложение hello API требуется tooprotect и затем найти hello **функции** и нажмите кнопку **Проверки подлинности и авторизации**.</span><span class="sxs-lookup"><span data-stu-id="d2493-123">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you want tooprotect, and then find hello **Features** section and click **Authentication/ Authorization**.</span></span>
   
    ![Проверка подлинности и авторизация на портале Azure](./media/app-service-api-dotnet-user-principal-auth/features.png)
2. <span data-ttu-id="d2493-125">В hello **проверки подлинности и авторизации** колонка, щелкните **на**.</span><span class="sxs-lookup"><span data-stu-id="d2493-125">In hello **Authentication / Authorization** blade, click **On**.</span></span>
3. <span data-ttu-id="d2493-126">В hello **tootake действия, если запрос не прошел проверку подлинности** раскрывающемся списке выберите **войти с использованием Azure Active Directory** .</span><span class="sxs-lookup"><span data-stu-id="d2493-126">In hello **Action tootake when request is not authenticated** drop-down list, select **Log in with Azure Active Directory** .</span></span>
4. <span data-ttu-id="d2493-127">В разделе **Поставщики проверки подлинности** выберите **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="d2493-127">Under **Authentication Providers**, select **Azure Active Directory**.</span></span>
   
    ![Колонка "Проверка подлинности и авторизация" на портале Azure](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
5. <span data-ttu-id="d2493-129">Настройка hello **параметры Azure Active Directory** колонке toocreate новый Azure AD приложения или использование существующего приложения Azure AD, если она уже есть, которые должны toouse.</span><span class="sxs-lookup"><span data-stu-id="d2493-129">Configure hello **Azure Active Directory Settings** blade toocreate a new Azure AD application, or use an existing Azure AD application if you already have one that you want toouse.</span></span>
   
    <span data-ttu-id="d2493-130">Во внутренних сценариях обычно участвует приложение API, которое вызывает приложение API.</span><span class="sxs-lookup"><span data-stu-id="d2493-130">Internal scenarios typically involve an API app calling an API app.</span></span> <span data-ttu-id="d2493-131">Вы можете использовать отдельные приложения Azure AD для каждого приложения API или только одно приложение Azure AD.</span><span class="sxs-lookup"><span data-stu-id="d2493-131">You can use separate Azure AD applications for each API app or just one Azure AD application.</span></span>
   
    <span data-ttu-id="d2493-132">Подробные инструкции по этой колонке см. в разделе [как tooconfigure вход службы приложений toouse приложения Azure Active Directory](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="d2493-132">For detailed instructions on this blade, see [How tooconfigure your App Service application toouse Azure Active Directory login](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span></span>
6. <span data-ttu-id="d2493-133">После завершения работы с колонке конфигурации поставщика проверки подлинности hello, нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="d2493-133">When you're done with hello authentication provider configuration blade, click **OK**.</span></span>
7. <span data-ttu-id="d2493-134">В hello **проверки подлинности и авторизации** колонка, щелкните **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="d2493-134">In hello **Authentication / Authorization** blade, click **Save**.</span></span>
   
    ![Щелкните Сохранить](./media/app-service-api-dotnet-service-principal-auth/authsave.png)

<span data-ttu-id="d2493-136">После этого, службы приложений позволяет только запросы от вызывающих объектов в клиенте Azure AD настроена hello.</span><span class="sxs-lookup"><span data-stu-id="d2493-136">When this is done, App Service only allows requests from callers in hello configured Azure AD tenant.</span></span> <span data-ttu-id="d2493-137">Без проверки подлинности или авторизации кода является обязательным в hello защищенные приложения API.</span><span class="sxs-lookup"><span data-stu-id="d2493-137">No authentication or authorization code is required in hello protected API app.</span></span> <span data-ttu-id="d2493-138">Hello токена носителя передается toohello API приложения вместе с часто используемые утверждений в заголовках HTTP, и можно прочитать эту информацию в toovalidate кода, которые запросов от определенного вызывающего объекта, например субъекта-службы.</span><span class="sxs-lookup"><span data-stu-id="d2493-138">hello bearer token is passed toohello API app along with commonly used claims in HTTP headers, and you can read that information in code toovalidate that requests are from a particular caller, such as a service principal.</span></span>

<span data-ttu-id="d2493-139">Эта функция проверки подлинности может применяться hello одинаково для всех языков этой службы приложения поддерживает, включая .NET, Node.js и Java.</span><span class="sxs-lookup"><span data-stu-id="d2493-139">This authentication functionality works hello same way for all languages that App service supports, including .NET, Node.js, and Java.</span></span> 

#### <a name="how-tooconsume-hello-protected-api-app"></a><span data-ttu-id="d2493-140">Защищать приложения API tooconsume hello</span><span class="sxs-lookup"><span data-stu-id="d2493-140">How tooconsume hello protected API app</span></span>
<span data-ttu-id="d2493-141">вызывающий объект Hello необходимо предоставить токена носителя Azure AD с вызовами API.</span><span class="sxs-lookup"><span data-stu-id="d2493-141">hello caller must provide an Azure AD bearer token with API calls.</span></span> <span data-ttu-id="d2493-142">tooget токен носителя, с помощью учетных данных участника службы, вызывающий объект hello использует библиотеку аутентификации Active Directory (ADAL для [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), или [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span><span class="sxs-lookup"><span data-stu-id="d2493-142">tooget a bearer token using service principal credentials, hello caller uses Active Directory Authentication Library (ADAL for [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), or [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span></span> <span data-ttu-id="d2493-143">tooget маркер hello код, который вызывает ADAL предоставляет hello tooADAL следующую информацию:</span><span class="sxs-lookup"><span data-stu-id="d2493-143">tooget a token, hello code that calls ADAL provides tooADAL hello following information:</span></span>

* <span data-ttu-id="d2493-144">Hello имя вашего клиента Azure AD.</span><span class="sxs-lookup"><span data-stu-id="d2493-144">hello name of your Azure AD tenant.</span></span>
* <span data-ttu-id="d2493-145">Hello клиента идентификатор и секрет клиента (ключ приложения) приложения hello Azure AD, связанные с hello вызывающего объекта.</span><span class="sxs-lookup"><span data-stu-id="d2493-145">hello client ID and client secret (app key) of hello Azure AD app associated with hello caller.</span></span>
* <span data-ttu-id="d2493-146">Идентификатор клиента приложения Azure AD, связанного с hello hello Hello защищенного приложения API.</span><span class="sxs-lookup"><span data-stu-id="d2493-146">hello client ID of hello Azure AD application associated with hello protected API app.</span></span> <span data-ttu-id="d2493-147">(Если используется только одно приложение Azure AD, это является hello же идентификатор клиента как Здравствуйте, один для вызывающего объекта hello.)</span><span class="sxs-lookup"><span data-stu-id="d2493-147">(If just one Azure AD application is used, this is hello same client ID as hello one for hello caller.)</span></span>

<span data-ttu-id="d2493-148">Эти значения доступны на страницах hello Azure AD hello [классический портал Azure](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="d2493-148">These values are available in hello Azure AD pages of hello [Azure classic portal](https://manage.windowsazure.com/).</span></span>

<span data-ttu-id="d2493-149">После получил токен hello hello вызывающего объекта содержит это HTTP-запросов в заголовке авторизации hello.</span><span class="sxs-lookup"><span data-stu-id="d2493-149">Once hello token has been acquired, hello caller includes it with HTTP requests in hello Authorization header.</span></span>  <span data-ttu-id="d2493-150">Службы приложений проверяет токен hello и позволяет приложения API, защищенный hello tooreach hello запросов.</span><span class="sxs-lookup"><span data-stu-id="d2493-150">App Service validates hello token and allows hello requests tooreach hello protected API app.</span></span>

#### <a name="how-tooprotect-hello-api-app-from-access-by-users-in-hello-same-tenant"></a><span data-ttu-id="d2493-151">Как приложение hello API tooprotect от доступа пользователей в hello же клиента</span><span class="sxs-lookup"><span data-stu-id="d2493-151">How tooprotect hello API app from access by users in hello same tenant</span></span>
<span data-ttu-id="d2493-152">Токены носителя для пользователей в одном клиенте считаются допустимыми для hello hello защищенного приложения API.</span><span class="sxs-lookup"><span data-stu-id="d2493-152">Bearer tokens for users in hello same tenant are considered valid for hello protected API app.</span></span>  <span data-ttu-id="d2493-153">Если требуется, можно вызвать только субъект-служба tooensure Здравствуйте защищенного приложения API, добавьте код в hello защищенные API приложения toovalidate hello после утверждения из токена hello:</span><span class="sxs-lookup"><span data-stu-id="d2493-153">If you want tooensure that only a service principal can call hello protected API app, add code in hello protected API app toovalidate hello following claims from hello token:</span></span>

* <span data-ttu-id="d2493-154">`appid`должно быть hello идентификатор клиента приложения Azure AD hello, связанный с вызывающим объектом hello.</span><span class="sxs-lookup"><span data-stu-id="d2493-154">`appid` should be hello client ID of hello Azure AD application that is associated with hello caller.</span></span> 
* <span data-ttu-id="d2493-155">`oid`(`objectidentifier`) должен быть идентификатор участника службы hello hello вызывающего метода.</span><span class="sxs-lookup"><span data-stu-id="d2493-155">`oid` (`objectidentifier`) should be hello service principal ID of hello caller.</span></span> 

<span data-ttu-id="d2493-156">Служба приложения также предоставляет hello `objectidentifier` утверждений в заголовке X-MS-CLIENT-УЧАСТНИК-ID hello.</span><span class="sxs-lookup"><span data-stu-id="d2493-156">App Service also provides hello `objectidentifier` claim in hello X-MS-CLIENT-PRINCIPAL-ID header.</span></span>

### <a name="how-tooprotect-hello-api-app-from-browser-access"></a><span data-ttu-id="d2493-157">Как tooprotect hello приложение API из доступ в браузере</span><span class="sxs-lookup"><span data-stu-id="d2493-157">How tooprotect hello API app from browser access</span></span>
<span data-ttu-id="d2493-158">Если не проверить утверждения в код в приложение hello защищенный API и использовать отдельный приложения Azure AD для hello защищенного приложения API убедитесь в том, что hello, URL-адрес ответа приложения Azure AD не hello так же, как hello базовый URL-адрес приложения API.</span><span class="sxs-lookup"><span data-stu-id="d2493-158">If you don't validate claims in code in hello protected API app, and if you use a separate Azure AD application for hello protected API app, make sure that hello Azure AD application's Reply URL is not hello same as hello API app's base URL.</span></span> <span data-ttu-id="d2493-159">Если hello URL-адрес ответа указывает непосредственно toohello защищенные приложения API, пользователь в клиенте hello же Azure AD может Обзор toohello приложения API, войти в систему и успешного вызова hello API.</span><span class="sxs-lookup"><span data-stu-id="d2493-159">If hello Reply URL points directly toohello protected API app, a user in hello same Azure AD tenant could browse toohello API app, log on, and successfully call hello API.</span></span>

## <span data-ttu-id="d2493-160"><a id="tutorialstart"></a>Продолжение ряда учебного приложения API .NET hello</span><span class="sxs-lookup"><span data-stu-id="d2493-160"><a id="tutorialstart"></a> Continuing hello .NET API Apps tutorial series</span></span>
<span data-ttu-id="d2493-161">Если вы следуете hello Node.js или Java учебника рядов для приложений API, пропустите toohello [дальнейшие действия](#next-steps) раздела.</span><span class="sxs-lookup"><span data-stu-id="d2493-161">If you are following hello Node.js or Java tutorial series for API apps, skip toohello [Next steps](#next-steps) section.</span></span> 

<span data-ttu-id="d2493-162">Hello оставшейся части этой статьи продолжает учебник ряда приложений .NET API hello и предполагается, что вы выполнили hello [учебника проверки подлинности пользователя](app-service-api-dotnet-user-principal-auth.md) и иметь пример приложения hello, запущенных в Azure с проверкой подлинности пользователя включена.</span><span class="sxs-lookup"><span data-stu-id="d2493-162">hello remainder of this article continues hello .NET API Apps tutorial series and assumes that you have completed hello [user authentication tutorial](app-service-api-dotnet-user-principal-auth.md) and have hello sample application running in Azure with user authentication enabled.</span></span>

## <a name="set-up-authentication-in-azure"></a><span data-ttu-id="d2493-163">Настройка проверки подлинности в Azure</span><span class="sxs-lookup"><span data-stu-id="d2493-163">Set up authentication in Azure</span></span>
<span data-ttu-id="d2493-164">В этом разделе Настройка приложения службы, таким образом, что hello только HTTP-запросы, она позволяет tooreach hello данных уровня API приложения будут hello те, которые имеют допустимые Azure AD токены носителя.</span><span class="sxs-lookup"><span data-stu-id="d2493-164">In this section you configure App Service so that hello only HTTP requests it allows tooreach hello data tier API app are hello ones that have valid Azure AD bearer tokens.</span></span> 

<span data-ttu-id="d2493-165">В следующем разделе hello настройте tooAzure приложения учетных данных для среднего уровня API приложения hello toosend AD, вернемся токен носителя и отправить hello носителя токена toohello данных уровня API приложение.</span><span class="sxs-lookup"><span data-stu-id="d2493-165">In hello following section, you configure hello middle tier API app toosend application credentials tooAzure AD, get back a bearer token, and send hello bearer token toohello data tier API app.</span></span> <span data-ttu-id="d2493-166">Этот процесс показан на диаграмме hello.</span><span class="sxs-lookup"><span data-stu-id="d2493-166">This process is illustrated in hello diagram.</span></span>

![Схема проверки подлинности службы](./media/app-service-api-dotnet-service-principal-auth/appdiagram.png)

<span data-ttu-id="d2493-168">Если возникли проблемы при следующих инструкций учебника hello. в разделе hello [Устранение неполадок](#troubleshooting) раздел в конце hello hello учебника.</span><span class="sxs-lookup"><span data-stu-id="d2493-168">If you run into problems while following hello tutorial directions, see hello [Troubleshooting](#troubleshooting) section at hello end of hello tutorial.</span></span> 

1. <span data-ttu-id="d2493-169">В hello [портал Azure](https://portal.azure.com/), перейдите toohello **параметры** колонке hello API приложения, созданного для приложения API hello ToDoListDataAPI (уровень данных) и нажмите кнопку **параметры**.</span><span class="sxs-lookup"><span data-stu-id="d2493-169">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you created for hello ToDoListDataAPI (data tier) API app, and then click **Settings**.</span></span>
2. <span data-ttu-id="d2493-170">В hello **параметры** колонки, найти hello **функции** , а затем выберите **проверки подлинности и авторизации**.</span><span class="sxs-lookup"><span data-stu-id="d2493-170">In hello **Settings** blade, find hello **Features** section, and then click **Authentication / Authorization**.</span></span>
   
    ![Проверка подлинности и авторизация на портале Azure](./media/app-service-api-dotnet-user-principal-auth/features.png)
3. <span data-ttu-id="d2493-172">В hello **проверки подлинности и авторизации** колонка, щелкните **на**.</span><span class="sxs-lookup"><span data-stu-id="d2493-172">In hello **Authentication / Authorization** blade, click **On**.</span></span>
4. <span data-ttu-id="d2493-173">В hello **tootake действия, если запрос не прошел проверку подлинности** раскрывающемся списке выберите **войти с использованием Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="d2493-173">In hello **Action tootake when request is not authenticated** drop-down list, select **Log in with Azure Active Directory**.</span></span>
   
    <span data-ttu-id="d2493-174">Это параметр hello, вызывающая tooensure приложения службы, проверку подлинности только приложение API hello reach запросов.</span><span class="sxs-lookup"><span data-stu-id="d2493-174">This is hello setting that causes App Service tooensure that only authenticated requests reach hello API app.</span></span> <span data-ttu-id="d2493-175">Для запросов, имеющих маркеров допустимым носителя, службы приложений, передает токены hello вдоль toohello API приложения и заполняет заголовки HTTP с toomake часто используемые утверждений этих сведений легко доступны tooyour кода.</span><span class="sxs-lookup"><span data-stu-id="d2493-175">For requests that have valid bearer tokens, App Service passes hello tokens along toohello API app and populates HTTP headers with commonly used claims toomake that information more easily available tooyour code.</span></span>
5. <span data-ttu-id="d2493-176">В разделе **Поставщики проверки подлинности** щелкните **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="d2493-176">Under **Authentication Providers**, click **Azure Active Directory**.</span></span>
   
    ![Колонка "Проверка подлинности и авторизация" на портале Azure](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
6. <span data-ttu-id="d2493-178">В hello **параметры Azure Active Directory** колонка, щелкните **Express**.</span><span class="sxs-lookup"><span data-stu-id="d2493-178">In hello **Azure Active Directory Settings** blade, click **Express**.</span></span>
   
    <span data-ttu-id="d2493-179">С hello **Express** параметр Azure можно автоматически создать приложение AAD в Azure AD [клиента](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span><span class="sxs-lookup"><span data-stu-id="d2493-179">With hello **Express** option Azure can automatically create an AAD application in your Azure AD [tenant](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span></span> 
   
    <span data-ttu-id="d2493-180">У вас нет toocreate клиента, так как каждая Azure учетная запись автоматически имеет один.</span><span class="sxs-lookup"><span data-stu-id="d2493-180">You don't have toocreate a tenant, because every Azure account automatically has one.</span></span>
7. <span data-ttu-id="d2493-181">В разделе **Режим управления** щелкните **Создать новое приложение AD**, если этот параметр еще не выбран.</span><span class="sxs-lookup"><span data-stu-id="d2493-181">Under **Management mode**, click **Create New AD App** if it isn't already selected.</span></span>
   
    <span data-ttu-id="d2493-182">портал Hello подключается hello **Создание приложения** поля ввода и значение по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="d2493-182">hello portal plugs hello **Create App** input box with a default value.</span></span> <span data-ttu-id="d2493-183">По умолчанию с именем hello приложения Azure AD Здравствуйте таким же, как приложение hello API.</span><span class="sxs-lookup"><span data-stu-id="d2493-183">By default, hello Azure AD application is named hello same as hello API app.</span></span> <span data-ttu-id="d2493-184">Вы можете ввести другое имя.</span><span class="sxs-lookup"><span data-stu-id="d2493-184">If you prefer, you can enter a different name.</span></span>
   
    ![параметры Azure AD](./media/app-service-api-dotnet-service-principal-auth/aadsettings.png)
   
    <span data-ttu-id="d2493-186">**Примечание**: в качестве альтернативы можно использовать один Azure AD приложения для обоих hello вызывающего приложения API и hello защищенные приложения API.</span><span class="sxs-lookup"><span data-stu-id="d2493-186">**Note**: As an alternative, you could use a single Azure AD application for both hello calling API app and hello protected API app.</span></span> <span data-ttu-id="d2493-187">Если выбран этот вариант не потребуются hello **создать новое приложение AD** параметр здесь, так как приложения Azure AD уже созданы ранее в учебнике проверки подлинности пользователя hello.</span><span class="sxs-lookup"><span data-stu-id="d2493-187">If you chose that alternative, you would not need hello **Create New AD App** option here because you already created an Azure AD application earlier in hello user authentication tutorial.</span></span> <span data-ttu-id="d2493-188">В этом учебнике будет использоваться разделения приложения Azure AD для вызова API приложения и hello hello защищенного приложения API.</span><span class="sxs-lookup"><span data-stu-id="d2493-188">For this tutorial, you'll use separate Azure AD applications for hello calling API app and hello protected API app.</span></span>
8. <span data-ttu-id="d2493-189">Запишите значение hello в hello **Создание приложения** поле ввода; позволяет просмотреть в этом приложении AAD в hello классический портал Azure позже.</span><span class="sxs-lookup"><span data-stu-id="d2493-189">Make a note of hello value that is in hello **Create App** input box; you'll look up this AAD application in hello Azure classic portal later.</span></span>
9. <span data-ttu-id="d2493-190">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="d2493-190">Click **OK**.</span></span>
10. <span data-ttu-id="d2493-191">В hello **проверки подлинности и авторизации** колонка, щелкните **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="d2493-191">In hello **Authentication / Authorization** blade, click **Save**.</span></span>
    
    ![Щелкните Сохранить](./media/app-service-api-dotnet-service-principal-auth/saveauth.png)
    
    <span data-ttu-id="d2493-193">Приложение службы создается приложение Azure Active Directory с **URL-адрес входа** и **URL-адрес ответа** автоматически устанавливается toohello URL-адрес приложения API.</span><span class="sxs-lookup"><span data-stu-id="d2493-193">App Service creates an Azure Active Directory application with **Sign-on URL** and **Reply URL** automatically set toohello URL of your API app.</span></span> <span data-ttu-id="d2493-194">Последнее значение Hello позволяет пользователям в вашей toolog клиента AAD в и приложения API hello доступа.</span><span class="sxs-lookup"><span data-stu-id="d2493-194">hello latter value enables users in your AAD tenant toolog in and access hello API app.</span></span>

### <a name="verify-that-hello-api-app-is-protected"></a><span data-ttu-id="d2493-195">Убедитесь, что приложение hello API защищен</span><span class="sxs-lookup"><span data-stu-id="d2493-195">Verify that hello API app is protected</span></span>
1. <span data-ttu-id="d2493-196">В браузере перейдите toohello URL-адрес приложения hello API: в hello **приложения API** колонки в hello портал Azure, щелкните ссылку hello под **URL-адрес**.</span><span class="sxs-lookup"><span data-stu-id="d2493-196">In a browser go toohello URL of hello API app: in hello **API app** blade in hello Azure portal, click hello link under **URL**.</span></span> 
   
    <span data-ttu-id="d2493-197">Перенаправленный tooa экран входа являются, так как не прошедшие проверку подлинности запросы запрещены приложение API tooreach hello.</span><span class="sxs-lookup"><span data-stu-id="d2493-197">You are redirected tooa login screen because unauthenticated requests are not allowed tooreach hello API app.</span></span> 
   
    <span data-ttu-id="d2493-198">Если браузер перехода toohello Swagger пользовательского интерфейса, браузер уже вошел — в этом случае откройте окно InPrivate или анонимный и перейдите toohello Swagger URL-адрес пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="d2493-198">If your browser does go toohello Swagger UI, your browser might already be logged on -- in that case, open an InPrivate or Incognito window and go toohello Swagger UI URL.</span></span>
2. <span data-ttu-id="d2493-199">Войдите с помощью учетных данных, используемых в клиенте AAD.</span><span class="sxs-lookup"><span data-stu-id="d2493-199">Log in with credentials of a user in your AAD tenant.</span></span>
   
   <span data-ttu-id="d2493-200">При входе странице «успешно создан» hello появится в браузере hello.</span><span class="sxs-lookup"><span data-stu-id="d2493-200">When you're logged on, hello "successfully created" page appears in hello browser.</span></span>

## <a name="configure-hello-todolistapi-project-tooacquire-and-send-hello-azure-ad-token"></a><span data-ttu-id="d2493-201">Настройка проекта tooacquire hello ToDoListAPI и отправлять hello маркера Azure AD</span><span class="sxs-lookup"><span data-stu-id="d2493-201">Configure hello ToDoListAPI project tooacquire and send hello Azure AD token</span></span>
<span data-ttu-id="d2493-202">В этом разделе hello следующие задания:</span><span class="sxs-lookup"><span data-stu-id="d2493-202">In this section you do hello following tasks:</span></span>

* <span data-ttu-id="d2493-203">Добавьте код в приложении API hello среднего уровня, которое использует tooacquire учетные данные приложения Azure AD токен и отправьте HTTP-запросов приложения API уровня toohello данных.</span><span class="sxs-lookup"><span data-stu-id="d2493-203">Add code in hello middle tier API app that uses Azure AD application credentials tooacquire a token and send it with HTTP requests toohello data tier API app.</span></span>
* <span data-ttu-id="d2493-204">Hello учетные данные, которые необходимо получите из Azure AD.</span><span class="sxs-lookup"><span data-stu-id="d2493-204">Get hello credentials you need from Azure AD.</span></span>
* <span data-ttu-id="d2493-205">Введите учетные данные hello в службе приложений Azure параметры среды выполнения в hello среднего уровня приложения API.</span><span class="sxs-lookup"><span data-stu-id="d2493-205">Enter hello credentials into Azure App Service runtime environment settings in hello middle tier API app.</span></span> 

### <a name="configure-hello-todolistapi-project-tooacquire-and-send-hello-azure-ad-token"></a><span data-ttu-id="d2493-206">Настройка проекта tooacquire hello ToDoListAPI и отправлять hello маркера Azure AD</span><span class="sxs-lookup"><span data-stu-id="d2493-206">Configure hello ToDoListAPI project tooacquire and send hello Azure AD token</span></span>
<span data-ttu-id="d2493-207">Внесите следующие изменения в проекте ToDoListAPI hello в Visual Studio hello.</span><span class="sxs-lookup"><span data-stu-id="d2493-207">Make hello following changes in hello ToDoListAPI project in Visual Studio.</span></span>

1. <span data-ttu-id="d2493-208">Раскомментируйте весь код hello в hello *ServicePrincipal.cs* файла.</span><span class="sxs-lookup"><span data-stu-id="d2493-208">Uncomment all of hello code in hello *ServicePrincipal.cs* file.</span></span>
   
    <span data-ttu-id="d2493-209">Это hello код, который использует ADAL для токена носителя .NET tooacquire hello Azure AD.</span><span class="sxs-lookup"><span data-stu-id="d2493-209">This is hello code that uses ADAL for .NET tooacquire hello Azure AD bearer token.</span></span>  <span data-ttu-id="d2493-210">Она использует несколько значений конфигурации, которые можно задать в среде выполнения Azure hello позже.</span><span class="sxs-lookup"><span data-stu-id="d2493-210">It uses several configuration values that you'll set in hello Azure runtime environment later.</span></span> <span data-ttu-id="d2493-211">Ниже приведен код hello.</span><span class="sxs-lookup"><span data-stu-id="d2493-211">Here's hello code:</span></span> 
   
        public static class ServicePrincipal
        {
            static string authority = ConfigurationManager.AppSettings["ida:Authority"];
            static string clientId = ConfigurationManager.AppSettings["ida:ClientId"];
            static string clientSecret = ConfigurationManager.AppSettings["ida:ClientSecret"];
            static string resource = ConfigurationManager.AppSettings["ida:Resource"];
   
            public static AuthenticationResult GetS2SAccessTokenForProdMSA()
            {
                return GetS2SAccessToken(authority, resource, clientId, clientSecret);
            }
   
            static AuthenticationResult GetS2SAccessToken(string authority, string resource, string clientId, string clientSecret)
            {
                var clientCredential = new ClientCredential(clientId, clientSecret);
                AuthenticationContext context = new AuthenticationContext(authority, false);
                AuthenticationResult authenticationResult = context.AcquireToken(
                    resource,
                    clientCredential);
                return authenticationResult;
            }
        }
   
    <span data-ttu-id="d2493-212">**Примечание:** этого примера кода требуются hello ADAL для пакета .NET NuGet (Microsoft.IdentityModel.Clients.ActiveDirectory), который еще не установлен в проекте hello.</span><span class="sxs-lookup"><span data-stu-id="d2493-212">**Note:** This code requires hello ADAL for .NET NuGet package (Microsoft.IdentityModel.Clients.ActiveDirectory), which is already installed in hello project.</span></span> <span data-ttu-id="d2493-213">Если этот проект был создан с нуля, будет иметь tooinstall этого пакета.</span><span class="sxs-lookup"><span data-stu-id="d2493-213">If you were creating this project from scratch, you would have tooinstall this package.</span></span> <span data-ttu-id="d2493-214">Этот пакет не устанавливается автоматически с шаблона новый проект приложения hello API.</span><span class="sxs-lookup"><span data-stu-id="d2493-214">This package is not automatically installed by hello API app new-project template.</span></span>
2. <span data-ttu-id="d2493-215">В *контроллеров или ToDoListController*, раскомментируйте код hello в hello `NewDataAPIClient` метод, который добавляет запросы маркера tooHTTP hello в заголовке авторизации hello.</span><span class="sxs-lookup"><span data-stu-id="d2493-215">In *Controllers/ToDoListController*, uncomment hello code in hello `NewDataAPIClient` method that adds hello token tooHTTP requests in hello authorization header.</span></span>
   
        client.HttpClient.DefaultRequestHeaders.Authorization =
            new AuthenticationHeaderValue("Bearer", ServicePrincipal.GetS2SAccessTokenForProdMSA().AccessToken);
3. <span data-ttu-id="d2493-216">Разверните проект ToDoListAPI hello.</span><span class="sxs-lookup"><span data-stu-id="d2493-216">Deploy hello ToDoListAPI project.</span></span> <span data-ttu-id="d2493-217">(Щелкните правой кнопкой мыши проект hello, а затем нажмите кнопку **публикации > публикации**.)</span><span class="sxs-lookup"><span data-stu-id="d2493-217">(Right-click hello project, then click **Publish > Publish**.)</span></span>
   
    <span data-ttu-id="d2493-218">Visual Studio развертывает проект hello и открывает базовый URL-адрес браузера toohello веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="d2493-218">Visual Studio deploys hello project and opens a browser toohello web app's base URL.</span></span> <span data-ttu-id="d2493-219">При этом будут отображены ошибка 403 страницы, которая является нормальным попытки toogo tooa веб-API базовый URL-адрес в браузере.</span><span class="sxs-lookup"><span data-stu-id="d2493-219">This will show a 403 error page, which is normal for an attempt toogo tooa Web API base URL from a browser.</span></span>
4. <span data-ttu-id="d2493-220">Hello закрыть браузер.</span><span class="sxs-lookup"><span data-stu-id="d2493-220">Close hello browser.</span></span>

### <a name="get-azure-ad-configuration-values"></a><span data-ttu-id="d2493-221">Получение значений конфигурации Azure AD</span><span class="sxs-lookup"><span data-stu-id="d2493-221">Get Azure AD configuration values</span></span>
1. <span data-ttu-id="d2493-222">В hello [классический портал Azure](https://manage.windowsazure.com/), перейдите в слишком**Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="d2493-222">In hello [Azure classic portal](https://manage.windowsazure.com/), go too**Azure Active Directory**.</span></span>
2. <span data-ttu-id="d2493-223">На hello **каталога** щелкните клиенте AAD.</span><span class="sxs-lookup"><span data-stu-id="d2493-223">On hello **Directory** tab, click your AAD tenant.</span></span>
3. <span data-ttu-id="d2493-224">Нажмите кнопку **приложений > приложений, которыми владеет Моя компания**, а затем нажмите кнопку флажок hello.</span><span class="sxs-lookup"><span data-stu-id="d2493-224">Click **Applications > Applications my company owns**, and then click hello check mark.</span></span>
4. <span data-ttu-id="d2493-225">В списке hello приложений щелкните имя hello hello, Azure создается при включении проверки подлинности для приложения API hello ToDoListDataAPI (уровень данных).</span><span class="sxs-lookup"><span data-stu-id="d2493-225">In hello list of applications, click hello name of hello one that Azure created for you when you enabled authentication for hello ToDoListDataAPI (data tier) API app.</span></span>
5. <span data-ttu-id="d2493-226">Нажмите кнопку hello **Настройка** вкладки.</span><span class="sxs-lookup"><span data-stu-id="d2493-226">Click hello **Configure** tab.</span></span>
6. <span data-ttu-id="d2493-227">Копировать hello **идентификатор клиента** значение и сохраните его где-то ее можно загрузить из более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="d2493-227">Copy hello **Client ID** value and save it someplace you can get it from later.</span></span> 
7. <span data-ttu-id="d2493-228">На классический портал Azure hello вернитесь toohello список **приложений, которыми владеет Моя компания**, а затем выберите приложение hello AAD, созданный для приложения ToDoListAPI API hello среднего уровня (hello один, созданный в предыдущем учебнике hello не Здравствуйте, где создается в этом учебнике).</span><span class="sxs-lookup"><span data-stu-id="d2493-228">In hello Azure classic portal go back toohello list of **Applications my company owns**, and click hello AAD application that you created for hello middle tier ToDoListAPI API app (hello one you created in hello previous tutorial, not hello one you created in this tutorial).</span></span>
8. <span data-ttu-id="d2493-229">Нажмите кнопку hello **Настройка** вкладки.</span><span class="sxs-lookup"><span data-stu-id="d2493-229">Click hello **Configure** tab.</span></span>
9. <span data-ttu-id="d2493-230">Копировать hello **идентификатор клиента** значение и сохраните его где-то ее можно загрузить из более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="d2493-230">Copy hello **Client ID** value and save it someplace you can get it from later.</span></span>
10. <span data-ttu-id="d2493-231">В разделе **ключей**выберите **1 год** из hello **выберите длительность** раскрывающегося списка.</span><span class="sxs-lookup"><span data-stu-id="d2493-231">Under **keys**, select **1 year** from hello **Select duration** drop-down list.</span></span>
11. <span data-ttu-id="d2493-232">Щелкните **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="d2493-232">Click **Save**.</span></span>
    
     ![Создать ключ приложения](./media/app-service-api-dotnet-service-principal-auth/genkey.png)
12. <span data-ttu-id="d2493-234">Скопируйте значение ключа hello и сохраните где-то, которые можно получить его из более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="d2493-234">Copy hello key value and save it someplace you can get it from later.</span></span>
    
     ![Скопировать новый ключ приложения](./media/app-service-api-dotnet-service-principal-auth/genkeycopy.png)

### <a name="configure-azure-ad-settings-in-hello-middle-tier-api-apps-runtime-environment"></a><span data-ttu-id="d2493-236">Настройте параметры Azure AD в приложение hello среднего уровня API среды выполнения</span><span class="sxs-lookup"><span data-stu-id="d2493-236">Configure Azure AD settings in hello middle tier API app's runtime environment</span></span>
1. <span data-ttu-id="d2493-237">Go toohello [портал Azure](https://portal.azure.com/)и перейдите toohello **приложения API** колонке приложение hello API, которая содержит проект hello TodoListAPI (средний уровень).</span><span class="sxs-lookup"><span data-stu-id="d2493-237">Go toohello [Azure portal](https://portal.azure.com/), and then navigate toohello **API App** blade for hello API app that hosts hello TodoListAPI (middle tier) project.</span></span>
2. <span data-ttu-id="d2493-238">Щелкните элементы **Параметры > Параметры приложения**.</span><span class="sxs-lookup"><span data-stu-id="d2493-238">Click **Settings > Application Settings**.</span></span>
3. <span data-ttu-id="d2493-239">В hello **параметры приложения** добавьте следующие hello ключам и значениям:</span><span class="sxs-lookup"><span data-stu-id="d2493-239">In hello **App settings** section, add hello following keys and values:</span></span>
   
   | <span data-ttu-id="d2493-240">**Ключ**</span><span class="sxs-lookup"><span data-stu-id="d2493-240">**Key**</span></span> | <span data-ttu-id="d2493-241">ida:Authority</span><span class="sxs-lookup"><span data-stu-id="d2493-241">ida:Authority</span></span> |
   | --- | --- |
   | <span data-ttu-id="d2493-242">**Значение**</span><span class="sxs-lookup"><span data-stu-id="d2493-242">**Value**</span></span> |<span data-ttu-id="d2493-243">https://login.microsoftonline.com/{имя клиента Azure AD}</span><span class="sxs-lookup"><span data-stu-id="d2493-243">https://login.microsoftonline.com/{your Azure AD tenant name}</span></span> |
   | <span data-ttu-id="d2493-244">**Пример**</span><span class="sxs-lookup"><span data-stu-id="d2493-244">**Example**</span></span> |<span data-ttu-id="d2493-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="d2493-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span></span> |
   
   | <span data-ttu-id="d2493-246">**Ключ**</span><span class="sxs-lookup"><span data-stu-id="d2493-246">**Key**</span></span> | <span data-ttu-id="d2493-247">ida:ClientId</span><span class="sxs-lookup"><span data-stu-id="d2493-247">ida:ClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="d2493-248">**Значение**</span><span class="sxs-lookup"><span data-stu-id="d2493-248">**Value**</span></span> |<span data-ttu-id="d2493-249">Идентификатор клиента для вызова приложения (средний уровень - ToDoListAPI) hello</span><span class="sxs-lookup"><span data-stu-id="d2493-249">Client ID of hello calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="d2493-250">**Пример**</span><span class="sxs-lookup"><span data-stu-id="d2493-250">**Example**</span></span> |<span data-ttu-id="d2493-251">960adec2-b74a-484a-960adec2-b74a-484a</span><span class="sxs-lookup"><span data-stu-id="d2493-251">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
   
   | <span data-ttu-id="d2493-252">**Ключ**</span><span class="sxs-lookup"><span data-stu-id="d2493-252">**Key**</span></span> | <span data-ttu-id="d2493-253">ida:ClientSecret</span><span class="sxs-lookup"><span data-stu-id="d2493-253">ida:ClientSecret</span></span> |
   | --- | --- |
   | <span data-ttu-id="d2493-254">**Значение**</span><span class="sxs-lookup"><span data-stu-id="d2493-254">**Value**</span></span> |<span data-ttu-id="d2493-255">Ключ приложения hello вызов приложения (средний уровень - ToDoListAPI)</span><span class="sxs-lookup"><span data-stu-id="d2493-255">App key of hello calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="d2493-256">**Пример**</span><span class="sxs-lookup"><span data-stu-id="d2493-256">**Example**</span></span> |<span data-ttu-id="d2493-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="d2493-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
   | <span data-ttu-id="d2493-258">**Ключ**</span><span class="sxs-lookup"><span data-stu-id="d2493-258">**Key**</span></span> | <span data-ttu-id="d2493-259">ida:Resource</span><span class="sxs-lookup"><span data-stu-id="d2493-259">ida:Resource</span></span> |
   | --- | --- |
   | <span data-ttu-id="d2493-260">**Значение**</span><span class="sxs-lookup"><span data-stu-id="d2493-260">**Value**</span></span> |<span data-ttu-id="d2493-261">Идентификатор клиента приложения вызывается hello (уровень данных — ToDoListDataAPI)</span><span class="sxs-lookup"><span data-stu-id="d2493-261">Client ID of hello called application (data tier - ToDoListDataAPI)</span></span> |
   | <span data-ttu-id="d2493-262">**Пример**</span><span class="sxs-lookup"><span data-stu-id="d2493-262">**Example**</span></span> |<span data-ttu-id="d2493-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="d2493-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
    <span data-ttu-id="d2493-264">**Примечание**: для `ida:Resource`, убедитесь, что используют вызывается приложения hello **идентификатор клиента** и не его **URI идентификатора приложения**.</span><span class="sxs-lookup"><span data-stu-id="d2493-264">**Note**: For `ida:Resource`, make sure you use hello called application's **client ID** and not its **App ID URI**.</span></span>
   
    <span data-ttu-id="d2493-265">`ida:ClientId`и `ida:Resource` отличаются значения для этого учебника, так как вы используете разделения applicaations Azure AD для hello средний уровень и уровень данных.</span><span class="sxs-lookup"><span data-stu-id="d2493-265">`ida:ClientId` and `ida:Resource` are different values for this tutorial because you're using separate Azure AD applicaations for hello middle tier and data tier.</span></span> <span data-ttu-id="d2493-266">Если вы использовали один приложения Azure AD для вызова API приложения и hello hello защищенные приложения API, может использовать одинаковое значение в обоих hello `ida:ClientId` и `ida:Resource`.</span><span class="sxs-lookup"><span data-stu-id="d2493-266">If you were using a single Azure AD application for hello calling API app and hello protected API app, you would use hello same value in both `ida:ClientId` and `ida:Resource`.</span></span>
   
    <span data-ttu-id="d2493-267">Hello код использует ConfigurationManager tooget эти значения, поэтому они могут храниться в файле Web.config hello проекта или в среде выполнения Azure hello.</span><span class="sxs-lookup"><span data-stu-id="d2493-267">hello code uses ConfigurationManager tooget these values, so they could be stored in hello project's Web.config file or in hello Azure runtime environment.</span></span> <span data-ttu-id="d2493-268">Пока приложение ASP.NET работает в службе приложений Azure, параметры среды автоматически переопределяют параметры в файле Web.config. Параметры среды являются обычно [более безопасный способ toostore конфиденциальной информации по сравнению файл Web.config tooa](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span><span class="sxs-lookup"><span data-stu-id="d2493-268">While an ASP.NET application is running in Azure App Service, environment settings automatically override settings from Web.config. Environment settings are generally a [more secure way toostore sensitive information compared tooa Web.config file](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span></span>
4. <span data-ttu-id="d2493-269">Щелкните **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="d2493-269">Click **Save**.</span></span>
   
    ![Щелкните Сохранить](./media/app-service-api-dotnet-service-principal-auth/appsettings.png)

### <a name="test-hello-application"></a><span data-ttu-id="d2493-271">Тестирование приложения hello</span><span class="sxs-lookup"><span data-stu-id="d2493-271">Test hello application</span></span>
1. <span data-ttu-id="d2493-272">В браузере перейдите toohello URL-адреса HTTPS hello AngularJS внешнего интерфейса веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="d2493-272">In a browser go toohello HTTPS URL of hello AngularJS front end web app.</span></span>
2. <span data-ttu-id="d2493-273">Нажмите кнопку hello **tooDo списка** вкладку и войти в систему с учетными данными пользователя в клиенте Azure AD.</span><span class="sxs-lookup"><span data-stu-id="d2493-273">Click hello **tooDo List** tab and log in with credentials for a user in your Azure AD tenant.</span></span> 
3. <span data-ttu-id="d2493-274">Добавьте tooverify элементов задачи, работа приложения hello.</span><span class="sxs-lookup"><span data-stu-id="d2493-274">Add to-do items tooverify that hello application is working.</span></span>
   
    ![Страница списка tooDo](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)
   
    <span data-ttu-id="d2493-276">Если приложение hello не работает должным образом, повторно проверьте все параметры hello, введенное на портал Azure hello.</span><span class="sxs-lookup"><span data-stu-id="d2493-276">If hello application doesn't work as expected, double-check all of hello settings you entered in hello Azure portal.</span></span> <span data-ttu-id="d2493-277">Если все параметры hello отображаются правильные toobe, см. раздел hello [Устранение неполадок](#troubleshooting) далее в этом учебнике.</span><span class="sxs-lookup"><span data-stu-id="d2493-277">If all of hello settings appear toobe correct, see hello [Troubleshooting](#troubleshooting) section later in this tutorial.</span></span>

## <a name="protect-hello-api-app-from-browser-access"></a><span data-ttu-id="d2493-278">Приложение hello API предотвратить доступ в браузере</span><span class="sxs-lookup"><span data-stu-id="d2493-278">Protect hello API app from browser access</span></span>
<span data-ttu-id="d2493-279">В этом учебнике вы создали отдельный приложения Azure AD для приложения hello API ToDoListDataAPI (уровень данных).</span><span class="sxs-lookup"><span data-stu-id="d2493-279">For this tutorial you created a separate Azure AD application for hello ToDoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="d2493-280">Как вы уже видели, когда службы приложений создает приложение AAD настраивает hello AAD приложения, что позволяет пользователю toogo toohello API приложения URL-адрес в браузере и войдите на.</span><span class="sxs-lookup"><span data-stu-id="d2493-280">As you've seen, when App Service creates an AAD application, it configures hello AAD application in a way that enables a user toogo toohello API app's URL in a browser and log on.</span></span> <span data-ttu-id="d2493-281">Это означает, что возможно для конечного пользователя в клиенте Azure AD не только участника-службы, tooaccess hello API.</span><span class="sxs-lookup"><span data-stu-id="d2493-281">That means it's possible for an end user in your Azure AD tenant, not just a service principal, tooaccess hello API.</span></span> 

<span data-ttu-id="d2493-282">Если требуется доступ через браузер tooprevent без написания кода в hello защищенные приложения API, можно изменить hello **URL-адрес ответа** в AAD приложения hello, чтобы оно отличается от приложения hello API базовый URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="d2493-282">If you want tooprevent browser access without writing any code in hello protected API app, you can change hello **Reply URL** in hello AAD application so that it's different from hello API app's base URL.</span></span> 

### <a name="disable-browser-access"></a><span data-ttu-id="d2493-283">Отключение доступа через браузер</span><span class="sxs-lookup"><span data-stu-id="d2493-283">Disable browser access</span></span>
1. <span data-ttu-id="d2493-284">В классическом портале hello **Настройка** для hello AAD приложений, созданных для hello TodoListService, измените значение hello в hello **URL-адрес ответа** таким образом, чтобы он является допустимым URL-адресом, но не hello API приложения URL-АДРЕС.</span><span class="sxs-lookup"><span data-stu-id="d2493-284">In hello classic portal's **Configure** tab for hello AAD application that was created for hello TodoListService, change hello value in hello **Reply URL** field so that it is a valid URL but not hello API app's URL.</span></span>
2. <span data-ttu-id="d2493-285">Щелкните **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="d2493-285">Click **Save**.</span></span>

### <a name="verify-browser-access-no-longer-works"></a><span data-ttu-id="d2493-286">Проверка отсутствия доступа через браузер</span><span class="sxs-lookup"><span data-stu-id="d2493-286">Verify browser access no longer works</span></span>
<span data-ttu-id="d2493-287">Ранее вы проверили, можно перейти URL-адрес приложения API toohello из браузера войдя в систему с учетными данными для отдельного пользователя.</span><span class="sxs-lookup"><span data-stu-id="d2493-287">Earlier you verified that you can go toohello API app URL from a browser by logging on with an individual user's credentials.</span></span> <span data-ttu-id="d2493-288">В этом разделе вы убедитесь, что это больше нельзя сделать.</span><span class="sxs-lookup"><span data-stu-id="d2493-288">In this section, you verify that this is no longer possible.</span></span> 

1. <span data-ttu-id="d2493-289">В новом окне браузера перейдите снова toohello URL-адрес приложения hello API.</span><span class="sxs-lookup"><span data-stu-id="d2493-289">In a new browser window, go toohello URL of hello API app again.</span></span>
2. <span data-ttu-id="d2493-290">Если вход запрос toodo таким образом.</span><span class="sxs-lookup"><span data-stu-id="d2493-290">Log in when prompted toodo so.</span></span>
3. <span data-ttu-id="d2493-291">Имя входа выполняется успешно, но ведет tooan страницы ошибки.</span><span class="sxs-lookup"><span data-stu-id="d2493-291">Login succeeds but leads tooan error page.</span></span>
   
    <span data-ttu-id="d2493-292">Вы настроили приложение hello AAD, чтобы пользователи в клиенте AAD hello не может войти и получить доступ к hello API из браузера.</span><span class="sxs-lookup"><span data-stu-id="d2493-292">You've configured hello AAD app so that users in hello AAD tenant cannot log in and access hello API from a browser.</span></span> <span data-ttu-id="d2493-293">Можно по-прежнему получить доступ к API приложение hello с помощью токена участника службы, это можно проверить URL-адрес веб-приложения toohello и добавлять дополнительные элементы задачи.</span><span class="sxs-lookup"><span data-stu-id="d2493-293">You can still access hello API app by using a service principal token, which you can verify by going toohello web app's URL and adding more to-do items.</span></span>

## <a name="restrict-access-tooa-particular-service-principal"></a><span data-ttu-id="d2493-294">Ограничить участник определенной службы доступа к tooa</span><span class="sxs-lookup"><span data-stu-id="d2493-294">Restrict access tooa particular service principal</span></span>
<span data-ttu-id="d2493-295">В данный момент, любой вызывающий объект, который может получить маркер для пользователя или субъекта-службы в клиенте Azure AD может вызывать приложение hello API TodoListDataAPI (уровень данных).</span><span class="sxs-lookup"><span data-stu-id="d2493-295">Right now, any caller that can get a token for a user or service principal in your Azure AD tenant can call hello TodoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="d2493-296">Может потребоваться toomake том, что приложение hello уровня данных API-Интерфейс только принимает вызовы из приложения API hello TodoListAPI (средний уровень) и только с участником определенной службы.</span><span class="sxs-lookup"><span data-stu-id="d2493-296">You might want toomake sure that hello data tier API app only accepts calls from hello TodoListAPI (middle tier) API app, and only from a particular service principal.</span></span> 

<span data-ttu-id="d2493-297">Эти ограничения можно добавлять путем добавления кода hello toovalidate `appid` и `objectidentifier` утверждений от входящих вызовов.</span><span class="sxs-lookup"><span data-stu-id="d2493-297">You can add these restrictions by adding code toovalidate hello `appid` and `objectidentifier` claims on incoming calls.</span></span>

<span data-ttu-id="d2493-298">В этом учебнике поместите hello код, который проверяет идентификатор приложения и идентификатор участника службы непосредственно в ваши действия контроллера.</span><span class="sxs-lookup"><span data-stu-id="d2493-298">For this tutorial you put hello code that validates app ID and service principal ID directly in your controller actions.</span></span>  <span data-ttu-id="d2493-299">Существуют варианты toouse пользовательского `Authorize` атрибута или toodo проверки в последовательностях запуска (например по промежуточного слоя OWIN).</span><span class="sxs-lookup"><span data-stu-id="d2493-299">Alternatives are toouse a custom `Authorize` attribute or toodo this validation in your startup sequences (e.g. OWIN middleware).</span></span> <span data-ttu-id="d2493-300">Пример hello в последнем разделе [в этом образце приложения](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span><span class="sxs-lookup"><span data-stu-id="d2493-300">For an example of hello latter, see [this sample application](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span></span> 

<span data-ttu-id="d2493-301">Сделайте следующие изменения toohello TodoListDataAPI проекта hello.</span><span class="sxs-lookup"><span data-stu-id="d2493-301">Make hello following changes toohello TodoListDataAPI project.</span></span>

1. <span data-ttu-id="d2493-302">Откройте hello *Controllers/TodoListController.cs* файла.</span><span class="sxs-lookup"><span data-stu-id="d2493-302">Open hello *Controllers/TodoListController.cs* file.</span></span>
2. <span data-ttu-id="d2493-303">Раскомментируйте строки hello заданных `trustedCallerClientId` и `trustedCallerServicePrincipalId`.</span><span class="sxs-lookup"><span data-stu-id="d2493-303">Uncomment hello lines that set `trustedCallerClientId` and `trustedCallerServicePrincipalId`.</span></span>
   
        private static string trustedCallerClientId = ConfigurationManager.AppSettings["todo:TrustedCallerClientId"];
        private static string trustedCallerServicePrincipalId = ConfigurationManager.AppSettings["todo:TrustedCallerServicePrincipalId"];
3. <span data-ttu-id="d2493-304">Раскомментируйте hello код в метод CheckCallerId hello.</span><span class="sxs-lookup"><span data-stu-id="d2493-304">Uncomment hello code in hello CheckCallerId method.</span></span> <span data-ttu-id="d2493-305">Этот метод вызывается в начале каждого метода действия в контроллере hello hello.</span><span class="sxs-lookup"><span data-stu-id="d2493-305">This method is called at hello start of every action method in hello controller.</span></span> 
   
        private static void CheckCallerId()
        {
            string currentCallerClientId = ClaimsPrincipal.Current.FindFirst("appid").Value;
            string currentCallerServicePrincipalId = ClaimsPrincipal.Current.FindFirst("http://schemas.microsoft.com/identity/claims/objectidentifier").Value;
            if (currentCallerClientId != trustedCallerClientId || currentCallerServicePrincipalId != trustedCallerServicePrincipalId)
            {
                throw new HttpResponseException(new HttpResponseMessage { StatusCode = HttpStatusCode.Unauthorized, ReasonPhrase = "hello appID or service principal ID is not hello expected value." });
            }
        }
4. <span data-ttu-id="d2493-306">Повторное развертывание hello ToDoListDataAPI проекта tooAzure службы приложений.</span><span class="sxs-lookup"><span data-stu-id="d2493-306">Redeploy hello ToDoListDataAPI project tooAzure App Service.</span></span>
5. <span data-ttu-id="d2493-307">В браузере перейдите на URL-адрес внешнего интерфейса веб-toohello AngularJS приложения HTTPS, а на главной странице приветствия нажмите кнопку hello **tooDo списка** вкладки.</span><span class="sxs-lookup"><span data-stu-id="d2493-307">In your browser, go toohello AngularJS front end web app's HTTPS URL, and in hello home page click hello **tooDo List** tab.</span></span>
   
    <span data-ttu-id="d2493-308">приложение Hello не работает из-за ошибки при выполнении вызовов завершить toohello обратно.</span><span class="sxs-lookup"><span data-stu-id="d2493-308">hello application doesn't work because calls toohello back end are failing.</span></span> <span data-ttu-id="d2493-309">Hello новый код проверки, фактический appid и objectidentifier, но он еще не определен toocheck hello правильные значения для них.</span><span class="sxs-lookup"><span data-stu-id="d2493-309">hello new code is checking actual appid and objectidentifier but it doesn't yet have hello correct values toocheck them against.</span></span> <span data-ttu-id="d2493-310">браузер Hello консоль средств разработчика сообщает, hello сервер вернул ошибку HTTP 401.</span><span class="sxs-lookup"><span data-stu-id="d2493-310">hello browser Developer Tools Console reports that hello server is returning an HTTP 401 error.</span></span>
   
    ![Ошибка в консоли инструментов для разработчиков](./media/app-service-api-dotnet-service-principal-auth/webapperror.png)
   
    <span data-ttu-id="d2493-312">В hello следующие шаги настройки hello ожидаемые значения.</span><span class="sxs-lookup"><span data-stu-id="d2493-312">In hello following steps you configure hello expected values.</span></span>
6. <span data-ttu-id="d2493-313">С помощью Azure AD PowerShell, получите значение hello hello службы участника для приложения Azure AD, созданный для проекта TodoListWebApp hello hello.</span><span class="sxs-lookup"><span data-stu-id="d2493-313">Using Azure AD PowerShell, get hello value of hello service principal for hello Azure AD application that you created for hello TodoListWebApp project.</span></span>
   
    <span data-ttu-id="d2493-314">а.</span><span class="sxs-lookup"><span data-stu-id="d2493-314">a.</span></span> <span data-ttu-id="d2493-315">Дополнительные сведения о tooinstall Azure PowerShell и tooyour подписки, обратитесь к подразделу [с помощью Azure PowerShell с помощью диспетчера ресурсов Azure](../powershell-azure-resource-manager.md).</span><span class="sxs-lookup"><span data-stu-id="d2493-315">For instructions on how tooinstall Azure PowerShell and connect tooyour subscription, see [Using Azure PowerShell with Azure Resource Manager](../powershell-azure-resource-manager.md).</span></span>
   
    <span data-ttu-id="d2493-316">b.</span><span class="sxs-lookup"><span data-stu-id="d2493-316">b.</span></span> <span data-ttu-id="d2493-317">список участников, tooget выполнение hello `Login-AzureRmAccount` команды и затем hello `Get-AzureRmADServicePrincipal` команды.</span><span class="sxs-lookup"><span data-stu-id="d2493-317">tooget a list of service principals, execute hello `Login-AzureRmAccount` command and then hello `Get-AzureRmADServicePrincipal` command.</span></span>
   
    <span data-ttu-id="d2493-318">c.</span><span class="sxs-lookup"><span data-stu-id="d2493-318">c.</span></span> <span data-ttu-id="d2493-319">Найдите hello objectid hello участника-службы приложения hello TodoListAPI и сохраните его в расположение, которое можно скопировать из более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="d2493-319">Find hello objectid for hello service principal of hello TodoListAPI application, and save it in a location you can copy from later.</span></span>
7. <span data-ttu-id="d2493-320">В hello портал Azure перейдите toohello колонка приложения API для приложения hello API, который был развернут проект ToDoListDataAPI hello.</span><span class="sxs-lookup"><span data-stu-id="d2493-320">In hello Azure portal, navigate toohello API app blade for hello API app that you deployed hello ToDoListDataAPI project to.</span></span>
8. <span data-ttu-id="d2493-321">Щелкните элементы **Параметры > Параметры приложения**.</span><span class="sxs-lookup"><span data-stu-id="d2493-321">Click **Settings > Application settings**.</span></span>
9. <span data-ttu-id="d2493-322">В hello **параметры приложения** добавьте следующие hello ключам и значениям:</span><span class="sxs-lookup"><span data-stu-id="d2493-322">In hello **App settings** section, add hello following keys and values:</span></span>
   
   | <span data-ttu-id="d2493-323">**Ключ**</span><span class="sxs-lookup"><span data-stu-id="d2493-323">**Key**</span></span> | <span data-ttu-id="d2493-324">todo:TrustedCallerServicePrincipalId</span><span class="sxs-lookup"><span data-stu-id="d2493-324">todo:TrustedCallerServicePrincipalId</span></span> |
   | --- | --- |
   | <span data-ttu-id="d2493-325">**Значение**</span><span class="sxs-lookup"><span data-stu-id="d2493-325">**Value**</span></span> |<span data-ttu-id="d2493-326">Идентификатор субъекта-службы вызывающего приложения</span><span class="sxs-lookup"><span data-stu-id="d2493-326">Service principal id of calling application</span></span> |
   | <span data-ttu-id="d2493-327">**Пример**</span><span class="sxs-lookup"><span data-stu-id="d2493-327">**Example**</span></span> |<span data-ttu-id="d2493-328">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span><span class="sxs-lookup"><span data-stu-id="d2493-328">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span></span> |
   
   | <span data-ttu-id="d2493-329">**Ключ**</span><span class="sxs-lookup"><span data-stu-id="d2493-329">**Key**</span></span> | <span data-ttu-id="d2493-330">todo:TrustedCallerClientId</span><span class="sxs-lookup"><span data-stu-id="d2493-330">todo:TrustedCallerClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="d2493-331">**Значение**</span><span class="sxs-lookup"><span data-stu-id="d2493-331">**Value**</span></span> |<span data-ttu-id="d2493-332">Идентификатор клиента для вызова приложения - скопированы из приложения hello TodoListAPI Azure AD</span><span class="sxs-lookup"><span data-stu-id="d2493-332">Client ID of calling application - copied from hello TodoListAPI Azure AD application</span></span> |
   | <span data-ttu-id="d2493-333">**Пример**</span><span class="sxs-lookup"><span data-stu-id="d2493-333">**Example**</span></span> |<span data-ttu-id="d2493-334">960adec2-b74a-484a-960adec2-b74a-484a</span><span class="sxs-lookup"><span data-stu-id="d2493-334">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
10. <span data-ttu-id="d2493-335">Щелкните **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="d2493-335">Click **Save**.</span></span>
    
     ![Щелкните Сохранить](./media/app-service-api-dotnet-service-principal-auth/trustedcaller.png)
11. <span data-ttu-id="d2493-337">В браузере URL-адрес веб-приложения toohello возврата, а на главной странице приветствия нажмите кнопку hello **tooDo списка** вкладки.</span><span class="sxs-lookup"><span data-stu-id="d2493-337">In your browser, return toohello web app's URL, and in hello home page click hello **tooDo List** tab.</span></span>
    
     <span data-ttu-id="d2493-338">Это приложение hello времени работает как ожидается, поскольку приложение hello доверенного вызывающего объекта, идентификатор и идентификатор участника службы, hello ожидаемые значения.</span><span class="sxs-lookup"><span data-stu-id="d2493-338">This time hello application works as expected because hello trusted caller app ID and service principal ID are hello expected values.</span></span>
    
     ![Страница списка tooDo](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)

## <a name="building-hello-projects-from-scratch"></a><span data-ttu-id="d2493-340">Построение проектов hello с нуля</span><span class="sxs-lookup"><span data-stu-id="d2493-340">Building hello projects from scratch</span></span>
<span data-ttu-id="d2493-341">Hello двух веб-API проекты были созданы с помощью hello **приложения API Azure** проекта шаблона и замена контроллера значения по умолчанию hello с ToDoList.</span><span class="sxs-lookup"><span data-stu-id="d2493-341">hello two Web API projects were created by using hello **Azure API App** project template and replacing hello default Values controller with a ToDoList controller.</span></span> <span data-ttu-id="d2493-342">Для получения токенов основной службы Azure AD в проекте ToDoListAPI hello, hello [Active Directory Authentication библиотеки (ADAL) для .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) был установлен пакет NuGet.</span><span class="sxs-lookup"><span data-stu-id="d2493-342">For acquiring Azure AD service principal tokens in hello ToDoListAPI project, hello [Active Directory Authentication Library (ADAL) for .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet package was installed.</span></span>

<span data-ttu-id="d2493-343">Слишком сведения о создании одностраничного приложения AngularJS с серверную часть веб-API как ToDoListAngular, см. в разделе [руки на лаборатории: построение одной страницы приложений (SPA) с веб-API ASP.NET и Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span><span class="sxs-lookup"><span data-stu-id="d2493-343">For information about how too create an AngularJS single-page application with a Web API back end like ToDoListAngular, see  [Hands On Lab: Build a Single Page Application (SPA) with ASP.NET Web API and Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span></span> <span data-ttu-id="d2493-344">Сведения о том, как tooadd код проверки подлинности Azure AD, в разделе [защита AngularJS одной страницы приложений с Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span><span class="sxs-lookup"><span data-stu-id="d2493-344">For information about how tooadd Azure AD authentication code, see [Securing AngularJS Single Page Apps with Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="d2493-345">Устранение неполадок</span><span class="sxs-lookup"><span data-stu-id="d2493-345">Troubleshooting</span></span>
[!INCLUDE [troubleshooting](../../includes/app-service-api-auth-troubleshooting.md)]

* <span data-ttu-id="d2493-346">Убедитесь, что вы не путаете ToDoListAPI (средний уровень) и ToDoListDataAPI (уровень данных).</span><span class="sxs-lookup"><span data-stu-id="d2493-346">Make sure that you don't confuse ToDoListAPI (middle tier) and ToDoListDataAPI (data tier).</span></span> <span data-ttu-id="d2493-347">Например, в этом учебнике вы добавить приложения API уровня данных toohello проверки подлинности, **, но ключ приложения hello должны поступать из приложения Azure AD, созданный для приложения среднего уровня API hello hello**.</span><span class="sxs-lookup"><span data-stu-id="d2493-347">For example, in this tutorial you add authentication toohello data tier API app, **but hello app key must come from hello Azure AD application that you created for hello middle tier API app**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="d2493-348">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="d2493-348">Next steps</span></span>
<span data-ttu-id="d2493-349">Это последний учебник hello в hello ряда приложений API.</span><span class="sxs-lookup"><span data-stu-id="d2493-349">This is hello last tutorial in hello API Apps series.</span></span> 

<span data-ttu-id="d2493-350">Дополнительные сведения о Azure Active Directory см. следующие ресурсы hello.</span><span class="sxs-lookup"><span data-stu-id="d2493-350">For more information about Azure Active Directory, see hello following resources.</span></span>

* [<span data-ttu-id="d2493-351">Руководство разработчика по Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="d2493-351">Azure AD developers' guide</span></span>](http://aka.ms/aaddev)
* [<span data-ttu-id="d2493-352">Сценарии проверки подлинности в Azure AD</span><span class="sxs-lookup"><span data-stu-id="d2493-352">Azure AD scenarios</span></span>](http://aka.ms/aadscenarios)
* [<span data-ttu-id="d2493-353">Azure Samples (Примеры для Azure)</span><span class="sxs-lookup"><span data-stu-id="d2493-353">Azure AD samples</span></span>](http://aka.ms/aadsamples)
  
    <span data-ttu-id="d2493-354">Hello [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) пример аналогичен toowhat отображается в этом учебнике, но без использования проверки подлинности службы приложений.</span><span class="sxs-lookup"><span data-stu-id="d2493-354">hello [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) sample is similar toowhat is shown in this tutorial, but without using App Service authentication.</span></span>

<span data-ttu-id="d2493-355">Сведения о других способах toodeploy Visual Studio проектов tooAPI приложений с помощью Visual Studio или [автоматизации развертывания](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) из [система управления версиями](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), в разделе [как toodeploy Приложение службы приложений Azure](../app-service-web/web-sites-deploy.md).</span><span class="sxs-lookup"><span data-stu-id="d2493-355">For information about other ways toodeploy Visual Studio projects tooAPI apps, by using Visual Studio or by [automating deployment](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) from a [source control system](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), see [How toodeploy an Azure App Service app](../app-service-web/web-sites-deploy.md).</span></span>

