---
title: "Изменения в приложениях API службы приложений | Документация Майкрософт"
description: "Узнайте о новых возможностях приложений API в службе приложений Azure."
services: app-service\api
documentationcenter: .net
author: mohitsriv
manager: erikre
editor: tdykstra
ms.assetid: a9b58066-e8fd-48b8-a651-4613b1736433
ms.service: app-service-api
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/29/2016
ms.author: rachelap
ms.openlocfilehash: e4e25f2cd1d39bb0113e3fe2bc37120f92227b28
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="app-service-api-apps---whats-changed"></a>Изменения в приложениях API службы приложений
На мероприятии Connect(), состоявшемся в ноябре 2015 года, было [объявлено](https://azure.microsoft.com/blog/azure-app-service-updates-november-2015/)о ряде улучшений в службе приложений Azure. К ним относятся базовые изменения в приложениях API для лучшей работы с мобильными и веб-приложениями, использование меньшего количества концепций, а также повышение эффективности развертывания и среды выполнения. Соответствующие изменения в создании приложений API с использованием портала управления Azure и нового инструментария вступили в силу 30 ноября 2015 года. В этой статье описаны эти изменения, а также то, как развернуть существующие приложения заново, чтобы использовать все преимущества предоставленных возможностей.

## <a name="feature-changes"></a>Изменения функций
Такие ключевые функции приложений API, как проверка подлинности, CORS и использование метаданных API, теперь перемещены прямо в службу приложений. Благодаря этому изменению ключевые функции стали доступными в веб- и мобильных приложениях, а также приложениях API. По факту в диспетчере ресурсов все они используют ресурс одного и того же типа **Microsoft.Web/sites** . Приложениям API больше не нужен шлюз, поэтому они предоставляются без него. Это также упрощает управление API Azure, так как теперь нужно использовать всего один шлюз.

![Обзор приложений API](./media/app-service-api-whats-changed/api-apps-overview.png)

Основной принцип проектирования, заложенный в обновлении приложений API, состоит в том, чтобы можно было использовать API «как есть» на желаемом языке.  Если вы уже развернули API как веб- или мобильное приложение, вам не нужно развертывать приложение заново, чтобы получить все преимущества новых функций. Если вы используете предварительную версию приложений API, подробные сведения по переходу на новую модель можно просмотреть ниже.

### <a name="authentication"></a>Аутентификация
Существующие и уже готовые функции проверки подлинности для приложений API, мобильных служб, а также веб-приложений теперь унифицированы и доступны в единой колонке проверки подлинности службы приложений Azure на портале управления. Общие сведения о проверке подлинности в службе приложений см. в записи блога [Расширение проверки подлинности и авторизации службы приложений](https://azure.microsoft.com/blog/announcing-app-service-authentication-authorization/).

Сценарии использования API предоставляют множество новых возможностей:

* **Прямое использование Azure Active Directory** без кода клиента для обмена токена AAD на токен сеанса. Согласно спецификации токена носителя клиенту достаточно включить токены AAD в заголовок авторизации. Это также означает, что на стороне клиента или сервера больше не требуется устанавливать пакет SDK для конкретной службы приложений. 
* **Взаимодействие между службами или внутренний доступ.**Чтобы пройти проверку подлинности в приложении при использовании управляющей программы или другого клиента, для работы которых обязателен доступ к API без интерфейса, можно запросить токен с помощью субъекта-службы AAD и передать его в службу приложений.
* **Отложенная авторизация.**Во множестве приложений для разных частей приложения есть различные ограничения доступа. Вам может понадобиться, чтобы одни интерфейсы API были общедоступными, а для использования других требовалось выполнение входа. Изначально проверка подлинности и авторизация осуществлялись согласно одному подходу, требующему входа в приложение. Это по-прежнему возможно, но теперь для принятия решений в отношении доступа, когда служба приложений уже выполнила проверку подлинности пользователя, можно использовать код приложения.

Дополнительные сведения о новых функциях проверки подлинности см. в статье [Проверка подлинности и авторизация для приложений API в службе приложений Azure](app-service-api-authentication.md). Сведения о миграции существующих приложений API из предыдущей модели приложений API в новую см. в разделе [Перенос существующих приложений API](#migrating-existing-api-apps) далее в этой статье.

### <a name="cors"></a>CORS
Теперь для настройки CORS используется колонка на портале управления Azure, а не параметр приложения **MS_CrossDomainOrigins** со значениями, разделенными запятыми. Также приложение можно настроить с помощью таких средств диспетчера ресурсов, как Azure PowerShell, интерфейс командной строки или [обозреватель ресурсов](https://resources.azure.com/). Задайте свойство **cors** типа ресурса **Microsoft.Web/sites/config** для ресурса **&lt;site name&gt;/web**. Например:

    {
        "cors": {
            "allowedOrigins": [
                "https://localhost:44300"
            ]
        }
    } 

### <a name="api-metadata"></a>Метаданные API
Колонка определения API теперь доступна в веб-, мобильных приложениях, а также приложениях API. На портале управления можно указать относительный или абсолютный URL-адрес конечной точки, в которой размещено представление Swagger 2.0 вашего API. Кроме того, возможна настройка с помощью инструментария диспетчера ресурсов. Задайте свойство **apiDefinition** типа ресурса **Microsoft.Web/sites/config** для ресурса **&lt;site name&gt;/web**. Например:

    {
        "apiDefinition":
        {
            "url": "https://myStorageAccount.blob.core.windows.net/swagger/apiDefinition.json"
        }
    }

Сейчас нужна общедоступная конечная точка метаданных, не требующая проверки подлинности, которую будут использовать подчиненные клиенты (например, для создания REST API Visual Studio и потока «Добавить API» PowerApps). Это значит, что если используется проверка подлинности службы приложений и необходимо предоставить определение API из самого приложения, вам нужно использовать отложенную проверку подлинности, описанную выше, чтобы маршрут к метаданным Swagger был общедоступен.

## <a name="management-portal"></a>Портал управления
Выбрав на портале **Создать > Интернет+мобильные устройства > Приложение API**, вы можете создать приложения API со всеми новыми возможностями, описанными в этой статье. Выбрав **Обзор > Приложения API**, вы только отобразите новые приложения API. Когда вы входите в приложение API, колонка использует тот же макет и возможности, что используют веб- и мобильные приложения. Единственное отличие заключается в содержимом быстрого запуска и порядке параметров.

Существующие приложения API (или приложения API Marketplace, созданные из приложений логики) с возможностями предварительной версии, доступными ранее, по-прежнему будут отображаться в конструкторе приложений логики и при просмотре всех ресурсов в группе.

## <a name="visual-studio"></a>Visual Studio
Большая часть средств для веб-приложений совместимо с новыми приложениями API, так как они используют один и тот же базовый тип ресурсов **Microsoft.Web/sites** . Тем не менее, инструментарий Azure Visual Studio следует обновить до версии 2.8.1 или более поздней, так как это предоставит ряд возможностей в зависимости от API. Скачайте пакет SDK на [странице загрузок Azure](https://azure.microsoft.com/downloads/).

В ходе рационализации типов службы приложений также унифицирована функция публикации, которую можно использовать, выбрав **Публикация > Служба приложений Microsoft Azure**:

![Публикация приложений API](./media/app-service-api-whats-changed/api-apps-publish.png)

Дополнительные сведения о пакете SDK 2.8.1 см. в объявлении в этой [записи блога](https://azure.microsoft.com/blog/announcing-azure-sdk-2-8-1-for-net/).

Кроме того, профиль публикации можно импортировать вручную на портале управления, чтобы включить публикацию. Однако, чтобы использовать Cloud Explorer, создавать код и выбирать или создавать приложения API, необходимо установить пакет SDK 2.8.1 или более поздней версии.

## <a name="migrating-existing-api-apps"></a>Миграция существующих приложений API
Если настраиваемый API развернут в предыдущей предварительной версии приложений API, до 31 декабря 2015 г. нужно перенести эти приложения в новую модель. Так как и старая, и новая модель используют веб-API в службе приложений, основную часть существующего кода можно использовать снова.

### <a name="hosting-and-redeployment"></a>Размещение и повторное развертывание
Шаги повторного развертывания такие же, как при развертывании любого существующего веб-API в службе приложений. Шаги:

1. Создайте пустое приложение API. Это можно сделать на портале, выбрав «Создать > Приложение API», с использованием публикации в Visual Studio или инструментария диспетчера ресурсов. При использовании шаблонов и средств Resource Manager задайте свойству **kind** типа ресурса **Microsoft.Web/sites** значение **api**. Это приведет быстрый запуск и параметры на портале управления в соответствие сценариям API.
2. Подключите проект к пустому приложению API и разверните его, используя любой механизм развертывания, который поддерживает служба приложений. Дополнительные сведения см. в [документации по развертыванию службы приложений Azure](../app-service-web/web-sites-deploy.md). 

### <a name="authentication"></a>Аутентификация
Службы проверки подлинности службы приложений поддерживают те же возможности, что и предыдущая модель приложений API. Если вы используете токены сеансов и вам необходимы пакеты SDK, используйте следующие пакеты для клиента и сервера:

* Для клиента: [пакет Azure SDK для мобильного клиента](http://www.nuget.org/packages/Microsoft.Azure.Mobile.Client/)
* Для сервера: [расширение проверки подлинности .NET для мобильных приложений Microsoft Azure](http://www.nuget.org/packages/Microsoft.Azure.Mobile.Server.Authentication/) 

Если же вы используете альфа-версию пакета SDK для службы приложений, такие пакеты являются устаревшими:

* Для клиента: [пакет SDK для службы приложений Microsoft Azure](http://www.nuget.org/packages/Microsoft.Azure.AppService)
* Для сервера: [Microsoft.Azure.AppService.ApiApps.Service](http://www.nuget.org/packages/Microsoft.Azure.AppService.ApiApps.Service)

Для Azure Active Directory не нужна специальная служба приложений, если вы используете токен AAD напрямую.

### <a name="internal-access"></a>Внутренний доступ
Предыдущая модель приложений API предусматривала встроенный уровень внутреннего доступа. При этом было необходимо использовать пакет SDK для подписи запросов. Как описано ранее в этой статье, субъект-службу AAD можно использовать с новой моделью приложений API в качестве альтернативного метода проверки подлинности с взаимодействием между службами, и при этом не нужно устанавливать специальный пакет SDK для службы приложений. Дополнительные сведения см. в статье [Проверка подлинности с использованием субъекта-службы для приложений API в службе приложений Azure](app-service-api-dotnet-service-principal-auth.md).

### <a name="discovery"></a>Обнаружение
В предыдущей модели приложений API был API для обнаружения других приложений API в среде выполнения в той же группе ресурсов для одного шлюза. Это особенно полезно в архитектурах, где реализуются шаблоны микрослужб. Хотя эта возможность не поддерживается напрямую, есть несколько доступных вариантов.

1. Используйте API Диспетчера ресурсов Azure для обнаружения.
2. Разместите службу управления API Azure перед API, размещенными в службе приложений. Служба управления API Azure выступает в качестве интерфейсной части и может предоставлять постоянные URL-адреса, доступные извне приложения, даже при изменении внутренней топологии.
3. Вы можете создать собственное приложение API для обнаружения и использовать его для регистрации других приложений при запуске.
4. Во время развертывания задайте для параметров всех приложений API (и клиентов) значения конечных точек других приложений API. Это эффективно в шаблонах развертывания, так как теперь приложения API позволяют управлять URL-адресами.

## <a name="using-api-apps-with-logic-apps"></a>Использование приложений API с приложениями логики
Новая модель приложений API хорошо работает с [версией схемы приложений логики от 01-08-2015](../logic-apps/logic-apps-schema-2015-08-01.md).

## <a name="next-steps"></a>Дальнейшие действия
Дополнительную информацию см. в статьях в [разделе документации по приложениям API](https://azure.microsoft.com/documentation/services/app-service/api/). В эти статьи уже добавлены сведения о новой модели для приложений API. Кроме того, используйте форумы, чтобы получить дополнительные сведения или рекомендации по миграции:

* [Форум MSDN](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureAPIApps)
* [Stack Overflow](http://stackoverflow.com/questions/tagged/azure-api-apps)

