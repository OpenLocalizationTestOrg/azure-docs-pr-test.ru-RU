---
title: "aaaUser проверки подлинности для приложений API в службе приложений Azure | Документы Microsoft"
description: "Узнайте, как tooprotect приложения API в службе приложений Azure, разрешив доступ к tooauthenticated только пользователей."
services: app-service\api
documentationcenter: .net
author: alexkarcher-msft
manager: erikre
editor: 
ms.assetid: 3896760d-46ff-4b67-b98a-edd233f24758
ms.service: app-service-api
ms.workload: na
ms.tgt_pltfrm: dotnet
ms.devlang: na
ms.topic: article
ms.date: 06/30/2016
ms.author: alkarche
ms.openlocfilehash: 4702fc77fcfe736405e22b033c35d22ae3c5a300
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="user-authentication-for-api-apps-in-azure-app-service"></a><span data-ttu-id="08d05-103">Проверка подлинности пользователя для приложений API в службе приложений Azure</span><span class="sxs-lookup"><span data-stu-id="08d05-103">User authentication for API Apps in Azure App Service</span></span>
## <a name="overview"></a><span data-ttu-id="08d05-104">Обзор</span><span class="sxs-lookup"><span data-stu-id="08d05-104">Overview</span></span>
<span data-ttu-id="08d05-105">В этой статье показано, как tooprotect приложения Azure API, так что только прошедшие проверку пользователи могут вызвать его.</span><span class="sxs-lookup"><span data-stu-id="08d05-105">This article shows how tooprotect an Azure API app so that only authenticated users can call it.</span></span> <span data-ttu-id="08d05-106">Hello статьи предполагается, что вы прочитали hello [обзор проверки подлинности в службе приложений Azure](../app-service/app-service-authentication-overview.md).</span><span class="sxs-lookup"><span data-stu-id="08d05-106">hello article assumes that you have read hello [Azure App Service authentication overview](../app-service/app-service-authentication-overview.md).</span></span>

<span data-ttu-id="08d05-107">Вы узнаете:</span><span class="sxs-lookup"><span data-stu-id="08d05-107">You'll learn:</span></span>

* <span data-ttu-id="08d05-108">Как tooconfigure поставщик проверки подлинности со сведениями для Azure Active Directory (Azure AD).</span><span class="sxs-lookup"><span data-stu-id="08d05-108">How tooconfigure an authentication provider, with details for Azure Active Directory (Azure AD).</span></span>
* <span data-ttu-id="08d05-109">Как hello tooconsume защищенного приложения API с помощью [Active Directory Authentication библиотеки (ADAL) для JavaScript](https://github.com/AzureAD/azure-activedirectory-library-for-js).</span><span class="sxs-lookup"><span data-stu-id="08d05-109">How tooconsume a protected API app by using hello [Active Directory Authentication Library (ADAL) for JavaScript](https://github.com/AzureAD/azure-activedirectory-library-for-js).</span></span>

<span data-ttu-id="08d05-110">статья Hello содержит два раздела:</span><span class="sxs-lookup"><span data-stu-id="08d05-110">hello article contains two sections:</span></span>

* <span data-ttu-id="08d05-111">Hello [как tooconfigure проверки подлинности пользователя в службе приложений Azure](#authconfig) разделе объясняется, как общие tooconfigure проверки подлинности пользователя для любого приложения API и tooall платформы, поддерживаемые службой приложений, включая .NET, в равной степени относится Node.js и Java.</span><span class="sxs-lookup"><span data-stu-id="08d05-111">hello [How tooconfigure user authentication in Azure App Service](#authconfig) section explains in general how tooconfigure user authentication for any API app and applies equally tooall frameworks supported by App Service, including .NET, Node.js, and Java.</span></span>
* <span data-ttu-id="08d05-112">Начиная с hello [продолжением учебники по .NET API приложения hello](#tutorialstart) статьи, hello статьи руководства по настройке образца приложения с .NET резервное интерфейса и интерфейса AngularJS, чтобы он использовал Azure Active Directory для пользователя Проверка подлинности.</span><span class="sxs-lookup"><span data-stu-id="08d05-112">Starting with hello [Continuing hello .NET API Apps tutorials](#tutorialstart) section, hello article guides you through configuring a sample application with a .NET back end and an AngularJS front end so that it uses Azure Active Directory for user authentication.</span></span> 

## <span data-ttu-id="08d05-113"><a id="authconfig"></a>Способ проверки подлинности пользователя tooconfigure в службе приложений Azure</span><span class="sxs-lookup"><span data-stu-id="08d05-113"><a id="authconfig"></a> How tooconfigure user authentication in Azure App Service</span></span>
<span data-ttu-id="08d05-114">В этом разделе приведены общие инструкции, применимые tooany приложения API.</span><span class="sxs-lookup"><span data-stu-id="08d05-114">This section provides general instructions that apply tooany API app.</span></span> <span data-ttu-id="08d05-115">TooDo toohello конкретного действия .NET списка образец приложения, см. слишком[продолжением учебники Приступая к работе hello .NET](#tutorialstart).</span><span class="sxs-lookup"><span data-stu-id="08d05-115">For steps specific toohello tooDo List .NET sample application, go too[Continuing hello .NET getting-started tutorials](#tutorialstart).</span></span>

1. <span data-ttu-id="08d05-116">В hello [портал Azure](https://portal.azure.com/), перейдите toohello **параметры** колонке приложение hello API, которые должны tooprotect поиска hello **функции** , а затем выберите  **Проверка подлинности и авторизации**.</span><span class="sxs-lookup"><span data-stu-id="08d05-116">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you want tooprotect, find hello **Features** section, and then click **Authentication/ Authorization**.</span></span>
   
    ![Проверка подлинности и авторизация на портале Azure](./media/app-service-api-dotnet-user-principal-auth/features.png)
2. <span data-ttu-id="08d05-118">В hello **проверки подлинности и авторизации** колонка, щелкните **на**.</span><span class="sxs-lookup"><span data-stu-id="08d05-118">In hello **Authentication / Authorization** blade, click **On**.</span></span>
3. <span data-ttu-id="08d05-119">Выберите один из параметров hello hello **tootake действия, если запрос не прошел проверку подлинности** раскрывающегося списка.</span><span class="sxs-lookup"><span data-stu-id="08d05-119">Select one of hello options from hello **Action tootake when request is not authenticated** drop-down list.</span></span>
   
   * <span data-ttu-id="08d05-120">Если требуется только проверенные на подлинность вызовы tooreach приложение API, выберите один из hello **входа в систему...**  параметры.</span><span class="sxs-lookup"><span data-stu-id="08d05-120">If you want only authenticated calls tooreach your API app, choose one of hello **Log in with ...** options.</span></span> <span data-ttu-id="08d05-121">Этот параметр позволяет вам tooprotect API приложение hello без написания кода, работающего в его.</span><span class="sxs-lookup"><span data-stu-id="08d05-121">This option enables you tooprotect hello API app without writing any code that runs in it.</span></span>
   * <span data-ttu-id="08d05-122">Если требуется, чтобы все вызовы API приложения tooreach, выберите **разрешить запрос (никаких действий)**.</span><span class="sxs-lookup"><span data-stu-id="08d05-122">If you want all calls tooreach your API app, choose **Allow request (no action)**.</span></span> <span data-ttu-id="08d05-123">Можно использовать этот выбор параметра toodirect не прошедшие проверку подлинности вызывающим объектам tooa поставщиков проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="08d05-123">You can use this option toodirect unauthenticated callers tooa choice of authentication providers.</span></span> <span data-ttu-id="08d05-124">В этом случае у вас есть авторизации toohandle toowrite кода.</span><span class="sxs-lookup"><span data-stu-id="08d05-124">With this option you have toowrite code toohandle authorization.</span></span>
     
     <span data-ttu-id="08d05-125">Дополнительные сведения см. в статье [Проверка подлинности и авторизация для приложений API в службе приложений Azure](app-service-api-authentication.md#multiple-protection-options).</span><span class="sxs-lookup"><span data-stu-id="08d05-125">For more information, see [Authentication and authorization for API Apps in Azure App Service](app-service-api-authentication.md#multiple-protection-options).</span></span>
4. <span data-ttu-id="08d05-126">Выберите одну или несколько hello **поставщики проверки подлинности**.</span><span class="sxs-lookup"><span data-stu-id="08d05-126">Select one or more of hello **Authentication Providers**.</span></span>
   
    <span data-ttu-id="08d05-127">изображение Hello варианты выбора, требующих все вызывающие объекты toobe, проверку подлинности с помощью Azure AD.</span><span class="sxs-lookup"><span data-stu-id="08d05-127">hello image shows    choices that require all callers toobe authenticated by Azure AD.</span></span>
   
    ![Колонка "Проверка подлинности и авторизация" на портале Azure](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
   
    <span data-ttu-id="08d05-129">При выборе поставщика проверки подлинности портал hello отображает колонке конфигурации для данного поставщика.</span><span class="sxs-lookup"><span data-stu-id="08d05-129">When you choose an authentication provider, hello portal displays a configuration blade for that provider.</span></span> 
   
    <span data-ttu-id="08d05-130">Подробные инструкции, в которых объясняется, как tooconfigure hello колонках конфигурации поставщика проверки подлинности см. в разделе [как tooconfigure вход службы приложений toouse приложения Azure Active Directory](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="08d05-130">For detailed instructions that explain how tooconfigure hello authentication provider configuration blades, see [How tooconfigure your App Service application toouse Azure Active Directory login](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span></span> <span data-ttu-id="08d05-131">(ссылка hello указывает tooan статьи об Azure AD, но самой статье hello содержит вкладки, которые связываются tooarticles для hello других поставщиков проверки подлинности).</span><span class="sxs-lookup"><span data-stu-id="08d05-131">(hello link goes tooan article about Azure AD, but hello article itself contains tabs that link tooarticles for hello other authentication providers.)</span></span>
5. <span data-ttu-id="08d05-132">После завершения работы с колонке конфигурации поставщика проверки подлинности hello, нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="08d05-132">When you're done with hello authentication provider configuration blade, click **OK**.</span></span>
6. <span data-ttu-id="08d05-133">В hello **проверки подлинности и авторизации** колонка, щелкните **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="08d05-133">In hello **Authentication / Authorization** blade, click **Save**.</span></span>

<span data-ttu-id="08d05-134">После этого, приложение службы проверяет подлинность все вызовы API, прежде чем они достигнут приложения hello API.</span><span class="sxs-lookup"><span data-stu-id="08d05-134">When this is done, App Service authenticates all API calls before they reach hello API app.</span></span> <span data-ttu-id="08d05-135">Работа служб проверки подлинности Hello hello одинаково для всех языков, поддерживаемых службы приложений, включая .NET, Node.js и Java.</span><span class="sxs-lookup"><span data-stu-id="08d05-135">hello authentication services work hello same for all languages that App service supports, including .NET, Node.js, and Java.</span></span> 

<span data-ttu-id="08d05-136">toomake проверкой подлинности вызовов API, вызывающий объект hello включает поставщика проверки подлинности hello токена носителя OAuth 2.0 в hello заголовок авторизации HTTP-запросов.</span><span class="sxs-lookup"><span data-stu-id="08d05-136">toomake authenticated API calls, hello caller includes hello authentication provider's OAuth 2.0 bearer token in hello Authorization header of HTTP requests.</span></span> <span data-ttu-id="08d05-137">токен Hello можно получить с помощью пакета SDK поставщика проверки подлинности hello.</span><span class="sxs-lookup"><span data-stu-id="08d05-137">hello token can be acquired by using hello authentication provider's SDK.</span></span>

## <span data-ttu-id="08d05-138"><a id="tutorialstart"></a>Продолжение учебники по .NET API приложения hello</span><span class="sxs-lookup"><span data-stu-id="08d05-138"><a id="tutorialstart"></a> Continuing hello .NET API Apps tutorials</span></span>
<span data-ttu-id="08d05-139">Если вы следуете hello Node.js или Java учебники для приложений API, пропустить следующей статье toohello [основной проверки подлинности службы для приложений API](app-service-api-dotnet-service-principal-auth.md).</span><span class="sxs-lookup"><span data-stu-id="08d05-139">If you are following hello Node.js or Java tutorials for API apps, skip toohello next article, [service principal authentication for API apps](app-service-api-dotnet-service-principal-auth.md).</span></span> 

<span data-ttu-id="08d05-140">Если следуете учебника ряда hello .NET для приложений API и уже развернули пример приложения hello, как указано в hello [первый](app-service-api-dotnet-get-started.md) и [второй](app-service-api-cors-consume-javascript.md) учебники, пропустить toohello [Настройка Проверка подлинности в службе приложений и Azure AD](#azureauth) раздела.</span><span class="sxs-lookup"><span data-stu-id="08d05-140">If you are following hello .NET tutorial series for API apps and have already deployed hello sample application as directed in hello [first](app-service-api-dotnet-get-started.md) and [second](app-service-api-cors-consume-javascript.md) tutorials, skip toohello [Set up authentication in App Service and Azure AD](#azureauth) section.</span></span>

<span data-ttu-id="08d05-141">Следует toofollow этого учебника минуя hello первого и второго учебники hello следующие шаги, в которых объясняется, как tooget запущена с помощью образца приложения hello toodeploy автоматизированного процесса.</span><span class="sxs-lookup"><span data-stu-id="08d05-141">If you want toofollow this tutorial without going through hello first and second tutorials, do hello following steps which explain how tooget started by using an automated process toodeploy hello sample application.</span></span>

> [!NOTE]
> <span data-ttu-id="08d05-142">Hello следующее приступить toohello же начальной точки, как если бы hello первые два учебника, за одним исключением: Visual Studio уже могут не узнать, какие веб-приложения или приложения API, который разворачивается каждого проекта.</span><span class="sxs-lookup"><span data-stu-id="08d05-142">hello following steps get you toohello same starting point as if you did hello first two tutorials, with one exception: Visual Studio won't already know which web app or API app that each project gets deployed to.</span></span> <span data-ttu-id="08d05-143">Это означает, что вы не будете иметь точные инструкции этого учебника, в которых объясняется, как toodeploy toohello вправо цели.</span><span class="sxs-lookup"><span data-stu-id="08d05-143">That means you won't have exact instructions in this tutorial that explain how toodeploy toohello right targets.</span></span> <span data-ttu-id="08d05-144">Если вы не освоите поняли как шаги развертывания hello toodo самостоятельно, это лучше toofollow hello учебника ряд hello [первом учебнике](app-service-api-dotnet-get-started.md) чем toostart с этим автоматизировать процесс развертывания.</span><span class="sxs-lookup"><span data-stu-id="08d05-144">If you're not comfortable with figuring out how toodo hello deployment steps on your own, it's better toofollow hello tutorial series from hello [first tutorial](app-service-api-dotnet-get-started.md) than toostart with this automated deployment process.</span></span>
> 
> 

1. <span data-ttu-id="08d05-145">Убедитесь, что есть все необходимые компоненты hello, перечисленные в hello [первом учебнике](app-service-api-dotnet-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="08d05-145">Make sure that you have all of hello prerequisites listed in hello [first tutorial](app-service-api-dotnet-get-started.md).</span></span> <span data-ttu-id="08d05-146">В добавление toohello предварительные условия эти учебники проверки подлинности предполагается работали с веб-приложений служб приложения и приложения API в Visual Studio и hello портал Azure.</span><span class="sxs-lookup"><span data-stu-id="08d05-146">In addition toohello prerequisites listed, these authentication tutorials assume that you have worked with App Service web apps and API apps in Visual Studio and hello Azure portal.</span></span>
2. <span data-ttu-id="08d05-147">Щелкните hello **развертывание tooAzure** кнопку в hello [файл readme репозитория образец списка tooDo](https://github.com/azure-samples/app-service-api-dotnet-todo-list/blob/master/readme.md) toodeploy hello API приложения и hello веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="08d05-147">Click hello **Deploy tooAzure** button in hello [tooDo List sample repository readme file](https://github.com/azure-samples/app-service-api-dotnet-todo-list/blob/master/readme.md) toodeploy hello API apps and hello web app.</span></span> <span data-ttu-id="08d05-148">Запишите hello группы ресурсов Azure, который создается, как можно использовать этот более поздней версии toolook веб-приложения и имена приложений API.</span><span class="sxs-lookup"><span data-stu-id="08d05-148">Make a note of hello Azure resource group that gets created, as you can use this later toolook up web app and API app names.</span></span>
3. <span data-ttu-id="08d05-149">Загрузка или клон hello [репозитории примеров список tooDo](https://github.com/Azure-Samples/app-service-api-dotnet-todo-list) tooget hello код, который вы будете работать с локально в Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="08d05-149">Download or clone hello [tooDo List sample repository](https://github.com/Azure-Samples/app-service-api-dotnet-todo-list) tooget hello code that you'll work with locally in Visual Studio.</span></span>

## <span data-ttu-id="08d05-150"><a id="azureauth"></a> Настройка проверки подлинности в службе приложений и Azure AD</span><span class="sxs-lookup"><span data-stu-id="08d05-150"><a id="azureauth"></a> Set up authentication in App Service and Azure AD</span></span>
<span data-ttu-id="08d05-151">Теперь у вас есть приложение hello, запущенные в службе приложений Azure, не требуя проверки подлинности пользователей.</span><span class="sxs-lookup"><span data-stu-id="08d05-151">You now have hello application running in Azure App Service without requiring that users be authenticated.</span></span> <span data-ttu-id="08d05-152">В этом разделе добавьте проверки подлинности, выполнив следующие задачи hello:</span><span class="sxs-lookup"><span data-stu-id="08d05-152">In this section you add authentication by doing hello following tasks:</span></span>

* <span data-ttu-id="08d05-153">Настройка проверки подлинности Azure Active Directory (Azure AD) toorequire службы приложений для вызова приложения среднего уровня API hello.</span><span class="sxs-lookup"><span data-stu-id="08d05-153">Configure App Service toorequire Azure Active Directory (Azure AD) authentication for calling hello middle tier API app.</span></span>
* <span data-ttu-id="08d05-154">Создадим приложение Azure AD.</span><span class="sxs-lookup"><span data-stu-id="08d05-154">Create an Azure AD application.</span></span>
* <span data-ttu-id="08d05-155">После входа в систему toohello AngularJS внешнего интерфейса настройте токена носителя hello toosend приложения hello Azure AD.</span><span class="sxs-lookup"><span data-stu-id="08d05-155">Configure hello Azure AD application toosend hello bearer token after logon toohello AngularJS front end.</span></span> 

<span data-ttu-id="08d05-156">Если возникли проблемы при следующих инструкций учебника hello. в разделе hello [Устранение неполадок](#troubleshooting) раздел в конце hello hello учебника.</span><span class="sxs-lookup"><span data-stu-id="08d05-156">If you run into problems while following hello tutorial directions, see hello [Troubleshooting](#troubleshooting) section at hello end of hello tutorial.</span></span> 

### <a name="configure-authentication-for-hello-middle-tier-api-app"></a><span data-ttu-id="08d05-157">Настройка проверки подлинности для hello среднего уровня приложения API</span><span class="sxs-lookup"><span data-stu-id="08d05-157">Configure authentication for hello middle tier API app</span></span>
1. <span data-ttu-id="08d05-158">В hello [портал Azure](https://portal.azure.com/), перейдите toohello **параметры** колонке приложение hello API, созданный для проекта ToDoListAPI hello, найти hello **функции** раздела, а затем Нажмите кнопку **проверки подлинности и авторизации**.</span><span class="sxs-lookup"><span data-stu-id="08d05-158">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you created for hello ToDoListAPI project, find hello **Features** section, and then click **Authentication / Authorization**.</span></span>
   
    ![Проверка подлинности и авторизация на портале Azure](./media/app-service-api-dotnet-user-principal-auth/features.png)
2. <span data-ttu-id="08d05-160">В hello **проверки подлинности и авторизации** колонка, щелкните **на**.</span><span class="sxs-lookup"><span data-stu-id="08d05-160">In hello **Authentication / Authorization** blade, click **On**.</span></span>
3. <span data-ttu-id="08d05-161">В hello **tootake действия, если запрос не прошел проверку подлинности** раскрывающемся списке выберите **войти с использованием Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="08d05-161">In hello **Action tootake when request is not authenticated** drop-down list, select **Log in with Azure Active Directory**.</span></span>
   
    <span data-ttu-id="08d05-162">Этот параметр гарантирует, что запросы не unauathenticated достигнет API приложение hello.</span><span class="sxs-lookup"><span data-stu-id="08d05-162">This option ensures that no unauathenticated requests will reach hello API app.</span></span> 
4. <span data-ttu-id="08d05-163">В разделе **Поставщики проверки подлинности** щелкните **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="08d05-163">Under **Authentication Providers**, click **Azure Active Directory**.</span></span>
   
    ![Колонка "Проверка подлинности и авторизация" на портале Azure](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
5. <span data-ttu-id="08d05-165">В hello **параметры Azure Active Directory** колонка, щелкните **Express**</span><span class="sxs-lookup"><span data-stu-id="08d05-165">In hello **Azure Active Directory Settings** blade, click **Express**</span></span>
   
    ![Параметр "Экспресс" для проверки подлинности и авторизации на портале Azure](./media/app-service-api-dotnet-user-principal-auth/aadsettings.png)
   
    <span data-ttu-id="08d05-167">С hello **Express** , службы приложений можно автоматически создавать приложения Azure AD в Azure AD [клиента](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span><span class="sxs-lookup"><span data-stu-id="08d05-167">With hello **Express** option, App Service can automatically create an Azure AD application in your Azure AD [tenant](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span></span> 
   
    <span data-ttu-id="08d05-168">У вас нет toocreate клиента, так как каждая Azure учетная запись автоматически имеет один.</span><span class="sxs-lookup"><span data-stu-id="08d05-168">You don't have toocreate a tenant, because every Azure account automatically has one.</span></span>
6. <span data-ttu-id="08d05-169">В разделе **режим управления**, нажмите кнопку **создать новое приложение AD** , если он еще не выбран и обратите внимание, значение hello в hello **Создание приложения** текстовое поле; будет искать этот AAD приложение в hello Azure классический портал позже.</span><span class="sxs-lookup"><span data-stu-id="08d05-169">Under **Management mode**, click **Create New AD App** if it isn't already selected, and notice hello value that is in hello **Create App** text box; you'll look up this AAD application in hello Azure classic portal later.</span></span>
   
    ![Параметры Azure AD на портале Azure](./media/app-service-api-dotnet-user-principal-auth/aadsettings2.png)
   
    <span data-ttu-id="08d05-171">Azure автоматически создаст приложения Azure AD с указанным именем hello в клиенте Azure AD.</span><span class="sxs-lookup"><span data-stu-id="08d05-171">Azure will automatically create an Azure AD application with hello indicated name in your Azure AD tenant.</span></span> <span data-ttu-id="08d05-172">По умолчанию с именем hello приложения Azure AD Здравствуйте таким же, как приложение hello API.</span><span class="sxs-lookup"><span data-stu-id="08d05-172">By default, hello Azure AD application is named hello same as hello API app.</span></span> <span data-ttu-id="08d05-173">Вы можете ввести другое имя.</span><span class="sxs-lookup"><span data-stu-id="08d05-173">If you prefer, you can enter a different name.</span></span>
7. <span data-ttu-id="08d05-174">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="08d05-174">Click **OK**.</span></span>
8. <span data-ttu-id="08d05-175">В hello **проверки подлинности и авторизации** колонка, щелкните **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="08d05-175">In hello **Authentication / Authorization** blade, click **Save**.</span></span>
   
    ![Щелкните Сохранить](./media/app-service-api-dotnet-user-principal-auth/authsave.png)

<span data-ttu-id="08d05-177">Теперь только пользователи из вашего клиента Azure AD можно вызвать API приложение hello.</span><span class="sxs-lookup"><span data-stu-id="08d05-177">Now only users in your Azure AD tenant can call hello API app.</span></span>

### <a name="optional-test-hello-api-app"></a><span data-ttu-id="08d05-178">Необязательно: Протестировать приложение hello API</span><span class="sxs-lookup"><span data-stu-id="08d05-178">Optional: Test hello API app</span></span>
1. <span data-ttu-id="08d05-179">В браузере перейдите toohello URL-адрес приложения hello API: в hello **приложения API** колонки в hello портал Azure, щелкните ссылку hello под **URL-адрес**.</span><span class="sxs-lookup"><span data-stu-id="08d05-179">In a browser go toohello URL of hello API app: in hello **API app** blade in hello Azure portal, click hello link under **URL**.</span></span>  
   
    <span data-ttu-id="08d05-180">Перенаправленный tooa экран входа являются, так как не прошедшие проверку подлинности запросы запрещены приложение API tooreach hello.</span><span class="sxs-lookup"><span data-stu-id="08d05-180">You are redirected tooa login screen because unauthenticated requests are not allowed tooreach hello API app.</span></span>
   
    <span data-ttu-id="08d05-181">Если браузер переходит в «успешно создан» toohello страницу, браузер hello уже вошли--в этом случае откройте окно InPrivate или анонимный и перейти на URL-адрес приложения toohello API.</span><span class="sxs-lookup"><span data-stu-id="08d05-181">If your browser goes toohello "successfully created" page, hello browser might already be logged on -- in that case, open an InPrivate or Incognito window and go toohello API app's URL.</span></span>
2. <span data-ttu-id="08d05-182">Войдите с помощью учетных данных, используемых в клиенте Azure AD.</span><span class="sxs-lookup"><span data-stu-id="08d05-182">Log on using credentials for a user in your Azure AD tenant.</span></span>
   
    <span data-ttu-id="08d05-183">При входе странице «успешно создан» hello появится в браузере hello.</span><span class="sxs-lookup"><span data-stu-id="08d05-183">When you're logged on, hello "successfully created" page appears in hello browser.</span></span>
3. <span data-ttu-id="08d05-184">Hello закрыть браузер.</span><span class="sxs-lookup"><span data-stu-id="08d05-184">Close hello browser.</span></span>

### <a name="configure-hello-azure-ad-application"></a><span data-ttu-id="08d05-185">Настройка приложения hello Azure AD</span><span class="sxs-lookup"><span data-stu-id="08d05-185">Configure hello Azure AD application</span></span>
<span data-ttu-id="08d05-186">При настройке проверки подлинности в Azure AD служба приложений автоматически создала приложение Azure AD.</span><span class="sxs-lookup"><span data-stu-id="08d05-186">When you configured Azure AD authentication, App Service created an Azure AD application for you.</span></span> <span data-ttu-id="08d05-187">По умолчанию hello новый Azure AD приложению не настроенный tooprovide hello носителя токена toohello API приложения URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="08d05-187">By default hello new Azure AD application was configured tooprovide hello bearer token toohello API app's URL.</span></span> <span data-ttu-id="08d05-188">В этом разделе Настройка hello Azure AD tooprovide hello носителя токена toohello AngularJS интерфейсом приложения вместо непосредственно toohello приложения среднего уровня API.</span><span class="sxs-lookup"><span data-stu-id="08d05-188">In this section you configure hello Azure AD application tooprovide hello bearer token toohello AngularJS front end instead of directly toohello middle tier API app.</span></span> <span data-ttu-id="08d05-189">Hello AngularJS переднего плана будет отправлять токен toohello API приложение hello, при вызове API приложение hello.</span><span class="sxs-lookup"><span data-stu-id="08d05-189">hello AngularJS front end will send hello token toohello API app when it calls hello API app.</span></span>

> [!NOTE]
> <span data-ttu-id="08d05-190">процесс hello tookeep как можно более простыми, в этом учебнике используется один Azure AD приложение hello переднего плана и приложение среднего уровня API hello.</span><span class="sxs-lookup"><span data-stu-id="08d05-190">tookeep hello process as simple as possible, this tutorial uses a single Azure AD application for both hello front end and hello middle tier API app.</span></span> <span data-ttu-id="08d05-191">Другой вариант — toouse два приложения Azure AD.</span><span class="sxs-lookup"><span data-stu-id="08d05-191">Another option is toouse two Azure AD applications.</span></span> <span data-ttu-id="08d05-192">В этом случае имеется toogive hello переднего плана в Azure AD приложения разрешение toocall hello среднего уровня приложение Azure AD.</span><span class="sxs-lookup"><span data-stu-id="08d05-192">In that case you would have toogive hello front end's Azure AD application permission toocall hello middle tier's Azure AD application.</span></span> <span data-ttu-id="08d05-193">Этот подход нескольких приложений предоставляют более детальный контроль над tooeach уровня разрешений.</span><span class="sxs-lookup"><span data-stu-id="08d05-193">This multi-application approach would give you more granular control over permissions tooeach tier.</span></span>
> 
> 

1. <span data-ttu-id="08d05-194">В hello [классический портал Azure](https://manage.windowsazure.com/), перейдите в слишком**Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="08d05-194">In hello [Azure classic portal](https://manage.windowsazure.com/), go too**Azure Active Directory**.</span></span>
   
   <span data-ttu-id="08d05-195">Поскольку некоторые параметры Azure Active Directory, которые необходимо получить доступ к tooare еще недоступна в текущем портале Azure hello имеется toouse hello классического портала.</span><span class="sxs-lookup"><span data-stu-id="08d05-195">You have toouse hello classic portal because certain Azure Active Directory settings that you need access tooare not yet available in hello current Azure portal.</span></span>
2. <span data-ttu-id="08d05-196">На hello **каталога** щелкните клиенте AAD.</span><span class="sxs-lookup"><span data-stu-id="08d05-196">On hello **Directory** tab, click your AAD tenant.</span></span>
   
   ![Azure AD на классическом портале](./media/app-service-api-dotnet-user-principal-auth/selecttenant.png)
3. <span data-ttu-id="08d05-198">Нажмите кнопку **приложений > приложений, которыми владеет Моя компания**, а затем нажмите кнопку флажок hello.</span><span class="sxs-lookup"><span data-stu-id="08d05-198">Click **Applications > Applications my company owns**, and then click hello check mark.</span></span>
   
   <span data-ttu-id="08d05-199">Также возможно toorefresh hello страницы toosee hello нового приложения.</span><span class="sxs-lookup"><span data-stu-id="08d05-199">You might also have toorefresh hello page toosee hello new application.</span></span>
4. <span data-ttu-id="08d05-200">В списке hello приложений щелкните имя hello hello, Azure создается при включении проверки подлинности для приложения API.</span><span class="sxs-lookup"><span data-stu-id="08d05-200">In hello list of applications, click hello name of hello one that Azure created for you when you enabled authentication for your API app.</span></span>
   
   ![Вкладка "Приложения Azure AD"](./media/app-service-api-dotnet-user-principal-auth/appstab.png)
5. <span data-ttu-id="08d05-202">Нажмите **Настроить**.</span><span class="sxs-lookup"><span data-stu-id="08d05-202">Click **Configure**.</span></span>
   
   ![Вкладка "Настройка Azure AD"](./media/app-service-api-dotnet-user-principal-auth/configure.png)
6. <span data-ttu-id="08d05-204">Задать **URL-адрес входа** toohello URL-адрес для веб-приложения AngularJS, без замыкающей косой черты.</span><span class="sxs-lookup"><span data-stu-id="08d05-204">Set **Sign-on URL** toohello URL for your AngularJS web app, no trailing slash.</span></span>
   
   <span data-ttu-id="08d05-205">Например, https://todolistangular.azurewebsites.net.</span><span class="sxs-lookup"><span data-stu-id="08d05-205">For example: https://todolistangular.azurewebsites.net</span></span>
   
   ![URL-адрес входа](./media/app-service-api-dotnet-user-principal-auth/signonurlazure.png)
7. <span data-ttu-id="08d05-207">Задать **URL-адрес ответа** toohello URL-адрес для веб-приложения без замыкающей косой черты.</span><span class="sxs-lookup"><span data-stu-id="08d05-207">Set **Reply URL** toohello URL for your web app, no trailing slash.</span></span>
   
   <span data-ttu-id="08d05-208">Например, https://todolistsangular.azurewebsites.net.</span><span class="sxs-lookup"><span data-stu-id="08d05-208">For example: https://todolistsangular.azurewebsites.net</span></span>
8. <span data-ttu-id="08d05-209">Щелкните **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="08d05-209">Click **Save**.</span></span>
   
   ![URL-адрес ответа](./media/app-service-api-dotnet-user-principal-auth/replyurlazure.png)
9. <span data-ttu-id="08d05-211">Внизу hello страницы приветствия щелкните **управление манифест > загрузки манифеста**.</span><span class="sxs-lookup"><span data-stu-id="08d05-211">At hello bottom of hello page, click **Manage manifest > Download manifest**.</span></span>
   
   ![Загрузить манифест](./media/app-service-api-dotnet-user-principal-auth/downloadmanifest.png)
10. <span data-ttu-id="08d05-213">Загрузите tooa hello местоположения, где его можно изменить.</span><span class="sxs-lookup"><span data-stu-id="08d05-213">Download hello file tooa location where you can edit it.</span></span>
11. <span data-ttu-id="08d05-214">В файле манифеста загружаются hello, поиск hello `oauth2AllowImplicitFlow` свойство.</span><span class="sxs-lookup"><span data-stu-id="08d05-214">In hello downloaded manifest file, search for hello  `oauth2AllowImplicitFlow` property.</span></span> <span data-ttu-id="08d05-215">Измените значение этого свойства из hello `false` слишком`true`, а затем сохраните файл hello.</span><span class="sxs-lookup"><span data-stu-id="08d05-215">Change hello value of this property from `false` too`true`, and then save hello file.</span></span>
    
    <span data-ttu-id="08d05-216">Это нужно для того, чтобы был возможен доступ из одностраничного приложения JavaScript.</span><span class="sxs-lookup"><span data-stu-id="08d05-216">This setting is required for access from a JavaScript single-page application.</span></span> <span data-ttu-id="08d05-217">Она позволяет hello Oauth 2.0 носителя токена toobe возвращается в hello фрагмент URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="08d05-217">It enables hello Oauth 2.0 bearer token toobe returned in hello URL fragment.</span></span>
12. <span data-ttu-id="08d05-218">Нажмите кнопку **управление манифест > передачи манифест**и файл hello передачи, была обновлена в hello предыдущих шага.</span><span class="sxs-lookup"><span data-stu-id="08d05-218">Click **Manage manifest > Upload manifest**, and upload hello file that you updated in hello preceding step.</span></span>
    
    ![Отправить манифест](./media/app-service-api-dotnet-user-principal-auth/uploadmanifest.png)
13. <span data-ttu-id="08d05-220">Копировать hello **идентификатор клиента** значение и сохраните его где-то ее можно загрузить из более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="08d05-220">Copy hello **Client ID** value and save it somewhere you can get it from later.</span></span>

## <a name="configure-hello-todolistangular-project-toouse-authentication"></a><span data-ttu-id="08d05-221">Настройка проверки подлинности для toouse проекта ToDoListAngular hello</span><span class="sxs-lookup"><span data-stu-id="08d05-221">Configure hello ToDoListAngular project toouse authentication</span></span>
<span data-ttu-id="08d05-222">В этом разделе изменить hello AngularJS переднего плана, чтобы он использовал библиотеку проверки подлинности Active Directory (ADAL) для tooacquire JS токен носителя для hello вошедшего в систему пользователя из Azure AD.</span><span class="sxs-lookup"><span data-stu-id="08d05-222">In this section you change hello AngularJS front end so that it uses Active Directory Authentication Library (ADAL) for JS tooacquire a bearer token for hello logged-on user from Azure AD.</span></span> <span data-ttu-id="08d05-223">будет включить токен hello в HTTP-запросов, отправляемых toohello среднего уровня, кода Hello, как показано в hello следующие схемы.</span><span class="sxs-lookup"><span data-stu-id="08d05-223">hello code will include hello token in HTTP requests sent toohello middle tier, as shown in hello following diagram.</span></span> 

![Схема проверки подлинности пользователей](./media/app-service-api-dotnet-user-principal-auth/appdiagram.png)

<span data-ttu-id="08d05-225">Сделайте следующие изменения toofiles в проекте ToDoListAngular hello hello.</span><span class="sxs-lookup"><span data-stu-id="08d05-225">Make hello following changes toofiles in hello ToDoListAngular project.</span></span>

1. <span data-ttu-id="08d05-226">Откройте hello *index.cshtml* файла.</span><span class="sxs-lookup"><span data-stu-id="08d05-226">Open hello *index.cshtml* file.</span></span>
2. <span data-ttu-id="08d05-227">Раскомментируйте hello строк, которые ссылаются hello библиотеку проверки подлинности Active Directory (ADAL) для скриптов JS.</span><span class="sxs-lookup"><span data-stu-id="08d05-227">Uncomment hello lines that reference hello Active Directory Authentication Library (ADAL) for JS scripts.</span></span>
   
        <script src="app/scripts/adal.js"></script>
        <script src="app/scripts/adal-angular.js"></script>
3. <span data-ttu-id="08d05-228">Откройте hello *app/scripts/app.js* файла.</span><span class="sxs-lookup"><span data-stu-id="08d05-228">Open hello *app/scripts/app.js* file.</span></span>
4. <span data-ttu-id="08d05-229">Закомментируйте hello блок кода, помеченные для «без проверки подлинности» и раскомментируйте hello блок кода, помеченные для «с» проверка подлинности.</span><span class="sxs-lookup"><span data-stu-id="08d05-229">Comment out hello block of code marked for "without authentication" and uncomment hello block of code marked for "with authentication".</span></span>
   
    <span data-ttu-id="08d05-230">Это изменение ссылается на поставщика проверки подлинности ADAL JS hello и предоставляет tooit значения конфигурации.</span><span class="sxs-lookup"><span data-stu-id="08d05-230">This change references hello ADAL JS authentication provider and provides configuration values tooit.</span></span> <span data-ttu-id="08d05-231">В следующие шаги hello задать hello значения конфигурации для приложения API и приложения Azure AD.</span><span class="sxs-lookup"><span data-stu-id="08d05-231">In hello following steps you set hello configuration values for your API app and Azure AD application.</span></span>
5. <span data-ttu-id="08d05-232">В коде hello, который задает hello `endpoints` hello переменной, задайте URL-адрес API toohello URL-адрес приложения hello API для hello ToDoListAPI проекта создан, и задайте hello Azure AD приложения идентификатор toohello идентификатор клиента, который был скопирован из hello классический портал Azure.</span><span class="sxs-lookup"><span data-stu-id="08d05-232">In hello code that sets hello `endpoints` variable, set hello API URL toohello URL of hello API app that you created for hello ToDoListAPI project, and set hello Azure AD application ID toohello client ID that you copied from hello Azure classic portal.</span></span>
   
    <span data-ttu-id="08d05-233">Код Hello стал примерно toohello следующий пример.</span><span class="sxs-lookup"><span data-stu-id="08d05-233">hello code is now similar toohello following example.</span></span>
   
        var endpoints = {
            "https://todolistapi0121.azurewebsites.net/": "1cf55bc9-9ed8-4df31cf55bc9-9ed8-4df3"
        };
6. <span data-ttu-id="08d05-234">В hello вызовите слишком`adalProvider.init`, задайте `tenant` tooyour имя клиента и `clientId` значение toosame, используемый в предыдущем шаге hello.</span><span class="sxs-lookup"><span data-stu-id="08d05-234">In hello call too`adalProvider.init`, set `tenant` tooyour tenant name and `clientId` toosame value you used in hello previous step.</span></span>
   
    <span data-ttu-id="08d05-235">Код Hello стал примерно toohello следующий пример.</span><span class="sxs-lookup"><span data-stu-id="08d05-235">hello code is now similar toohello following example.</span></span>
   
        adalProvider.init(
            {
                instance: 'https://login.microsoftonline.com/', 
                tenant: 'contoso.onmicrosoft.com',
                clientId: '1cf55bc9-9ed8-4df31cf55bc9-9ed8-4df3',
                extraQueryParameter: 'nux=1',
                endpoints: endpoints
            },
            $httpProvider
            );
   
    <span data-ttu-id="08d05-236">Эти изменения слишком`app.js` указать, что вызывающий код hello и вызывается API hello в приложение hello же Azure AD.</span><span class="sxs-lookup"><span data-stu-id="08d05-236">These changes too`app.js` specify that hello calling code and hello called API are in hello same Azure AD application.</span></span>
7. <span data-ttu-id="08d05-237">Откройте hello *app/scripts/homeCtrl.js* файла.</span><span class="sxs-lookup"><span data-stu-id="08d05-237">Open hello *app/scripts/homeCtrl.js* file.</span></span>
8. <span data-ttu-id="08d05-238">Закомментируйте hello блок кода, помеченные для «без проверки подлинности» и раскомментируйте hello блок кода, помеченные для «с» проверка подлинности.</span><span class="sxs-lookup"><span data-stu-id="08d05-238">Comment out hello block of code marked for "without authentication" and uncomment hello block of code marked for "with authentication".</span></span>
9. <span data-ttu-id="08d05-239">Откройте hello *app/scripts/indexCtrl.js* файла.</span><span class="sxs-lookup"><span data-stu-id="08d05-239">Open hello *app/scripts/indexCtrl.js* file.</span></span>
10. <span data-ttu-id="08d05-240">Закомментируйте hello блок кода, помеченные для «без проверки подлинности» и раскомментируйте hello блок кода, помеченные для «с» проверка подлинности.</span><span class="sxs-lookup"><span data-stu-id="08d05-240">Comment out hello block of code marked for "without authentication" and uncomment hello block of code marked for "with authentication".</span></span>

### <a name="deploy-hello-todolistangular-project-tooazure"></a><span data-ttu-id="08d05-241">Развертывание проекта tooAzure hello ToDoListAngular</span><span class="sxs-lookup"><span data-stu-id="08d05-241">Deploy hello ToDoListAngular project tooAzure</span></span>
1. <span data-ttu-id="08d05-242">В **обозревателе решений**, щелкните правой кнопкой мыши проект ToDoListAngular hello и нажмите кнопку **публикации**.</span><span class="sxs-lookup"><span data-stu-id="08d05-242">In **Solution Explorer**, right-click hello ToDoListAngular project, and then click **Publish**.</span></span>
2. <span data-ttu-id="08d05-243">Щелкните **Опубликовать**.</span><span class="sxs-lookup"><span data-stu-id="08d05-243">Click **Publish**.</span></span>
   
    <span data-ttu-id="08d05-244">Visual Studio развертывает проект hello и открывает базовый URL-адрес браузера toohello веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="08d05-244">Visual Studio deploys hello project and opens a browser toohello web app's base URL.</span></span> <span data-ttu-id="08d05-245">При этом будут отображены ошибка 403 страницы, которая является нормальным попытки toogo tooa веб-API базовый URL-адрес в браузере.</span><span class="sxs-lookup"><span data-stu-id="08d05-245">This will show a 403 error page, which is normal for an attempt toogo tooa Web API base URL from a browser.</span></span>
   
    <span data-ttu-id="08d05-246">У вас по-прежнему есть toomake изменение toohello средний уровень приложения API перед тестированием приложения hello.</span><span class="sxs-lookup"><span data-stu-id="08d05-246">You still have toomake a change toohello middle tier API app before you can test hello application.</span></span>
3. <span data-ttu-id="08d05-247">Hello закрыть браузер.</span><span class="sxs-lookup"><span data-stu-id="08d05-247">Close hello browser.</span></span>

## <a name="configure-hello-todolistapi-project-toouse-authentication"></a><span data-ttu-id="08d05-248">Настройка проверки подлинности для toouse проекта ToDoListAPI hello</span><span class="sxs-lookup"><span data-stu-id="08d05-248">Configure hello ToDoListAPI project toouse authentication</span></span>
<span data-ttu-id="08d05-249">В настоящее время hello отправляет ToDoListAPI проекта «*» как hello `owner` tooToDoListDataAPI значение.</span><span class="sxs-lookup"><span data-stu-id="08d05-249">Currently hello ToDoListAPI project sends "*" as hello `owner` value tooToDoListDataAPI.</span></span> <span data-ttu-id="08d05-250">В этом разделе изменить идентификатор hello toosend кода hello приветствия вошедшего пользователя.</span><span class="sxs-lookup"><span data-stu-id="08d05-250">In this section you change hello code toosend hello ID of hello logged-on user.</span></span>

<span data-ttu-id="08d05-251">Внесите следующие изменения в проекте ToDoListAPI hello hello.</span><span class="sxs-lookup"><span data-stu-id="08d05-251">Make hello following changes in hello ToDoListAPI project.</span></span>

1. <span data-ttu-id="08d05-252">Откройте hello *Controllers/ToDoListController.cs* файла и раскомментируйте строку hello в каждый метод действия, который задает `owner` toohello Azure AD `NameIdentifier` значение утверждения.</span><span class="sxs-lookup"><span data-stu-id="08d05-252">Open hello *Controllers/ToDoListController.cs* file, and uncomment hello line in each action method that sets `owner` toohello Azure AD `NameIdentifier` claim value.</span></span> <span data-ttu-id="08d05-253">Например:</span><span class="sxs-lookup"><span data-stu-id="08d05-253">For example:</span></span>
   
        owner = ((ClaimsIdentity)User.Identity).FindFirst(ClaimTypes.NameIdentifier).Value;
   
    <span data-ttu-id="08d05-254">**Важные**: не раскомментируйте код в hello `ToDoListDataAPI` метода; вы выполните, далее в учебнике основной проверки подлинности службы hello.</span><span class="sxs-lookup"><span data-stu-id="08d05-254">**Important**: Don't uncomment code in hello `ToDoListDataAPI` method; you'll do that later for hello service principal authentication tutorial.</span></span>

### <a name="deploy-hello-todolistapi-project-tooazure"></a><span data-ttu-id="08d05-255">Развертывание проекта tooAzure hello ToDoListAPI</span><span class="sxs-lookup"><span data-stu-id="08d05-255">Deploy hello ToDoListAPI project tooAzure</span></span>
1. <span data-ttu-id="08d05-256">В **обозревателе решений**, щелкните правой кнопкой мыши проект ToDoListAPI hello и нажмите кнопку **публикации**.</span><span class="sxs-lookup"><span data-stu-id="08d05-256">In **Solution Explorer**, right-click hello ToDoListAPI project, and then click **Publish**.</span></span>
2. <span data-ttu-id="08d05-257">Щелкните **Опубликовать**.</span><span class="sxs-lookup"><span data-stu-id="08d05-257">Click **Publish**.</span></span>
   
    <span data-ttu-id="08d05-258">Visual Studio развертывает проект hello и открывает базовый URL-адрес приложения toohello обозреватель API.</span><span class="sxs-lookup"><span data-stu-id="08d05-258">Visual Studio deploys hello project and opens a browser toohello API app's base URL.</span></span>
3. <span data-ttu-id="08d05-259">Hello закрыть браузер.</span><span class="sxs-lookup"><span data-stu-id="08d05-259">Close hello browser.</span></span>

### <a name="test-hello-application"></a><span data-ttu-id="08d05-260">Тестирование приложения hello</span><span class="sxs-lookup"><span data-stu-id="08d05-260">Test hello application</span></span>
1. <span data-ttu-id="08d05-261">Go toohello URL-адрес веб-приложения hello, **с использованием HTTPS, а не HTTP**.</span><span class="sxs-lookup"><span data-stu-id="08d05-261">Go toohello URL of hello web app, **using HTTPS, not HTTP**.</span></span>
2. <span data-ttu-id="08d05-262">Нажмите кнопку hello **tooDo списка** вкладки.</span><span class="sxs-lookup"><span data-stu-id="08d05-262">Click hello **tooDo List** tab.</span></span>
   
    <span data-ttu-id="08d05-263">Все запрашиваемые toolog в.</span><span class="sxs-lookup"><span data-stu-id="08d05-263">You are prompted toolog in.</span></span>
3. <span data-ttu-id="08d05-264">Войдите в систему с учетными данными пользователя в клиенте AAD hello.</span><span class="sxs-lookup"><span data-stu-id="08d05-264">Log in with hello credentials of a user in your AAD tenant.</span></span>
4. <span data-ttu-id="08d05-265">Hello **tooDo списка** появится страница.</span><span class="sxs-lookup"><span data-stu-id="08d05-265">hello **tooDo List** page appears.</span></span>
   
   ![Страница списка tooDo](./media/app-service-api-dotnet-user-principal-auth/webappindex.png)
   
   <span data-ttu-id="08d05-267">Элементы списка дел не отображаются, так как до этого момента все они принадлежали владельцу "*".</span><span class="sxs-lookup"><span data-stu-id="08d05-267">No to-do items are displayed because until now they have all been for owner "*".</span></span> <span data-ttu-id="08d05-268">Теперь запрашивает элементы для hello вошедшего пользователя hello среднего уровня и none пока не создано.</span><span class="sxs-lookup"><span data-stu-id="08d05-268">Now hello middle tier is requesting items for hello logged-on user, and none have been created yet.</span></span>
5. <span data-ttu-id="08d05-269">Добавьте новый tooverify элементов задачи, работа приложения hello.</span><span class="sxs-lookup"><span data-stu-id="08d05-269">Add new to-do items tooverify that hello application is working.</span></span>
6. <span data-ttu-id="08d05-270">В другом окне браузера перейдите toohello Swagger URL-адрес пользовательского интерфейса для приложения ToDoListDataAPI API hello и щелкните **ToDoList > получить**.</span><span class="sxs-lookup"><span data-stu-id="08d05-270">In another browser window, go toohello Swagger UI URL for hello ToDoListDataAPI API app and click **ToDoList > Get**.</span></span> <span data-ttu-id="08d05-271">Введите звездочку для hello `owner` параметр и нажмите кнопку **попробуйте**.</span><span class="sxs-lookup"><span data-stu-id="08d05-271">Enter an asterisk for hello `owner` parameter, and then click **Try it out**.</span></span>
   
   <span data-ttu-id="08d05-272">Hello ответа показывает, что новые элементы задача hello быть hello Azure AD, фактический идентификатор пользователя в свойстве Owner hello.</span><span class="sxs-lookup"><span data-stu-id="08d05-272">hello response shows that hello new to-do items have hello actual Azure AD user ID in hello Owner property.</span></span>
   
   ![Идентификатор владельца в ответе JSON](./media/app-service-api-dotnet-user-principal-auth/todolistapiauth.png)

## <a name="building-hello-projects-from-scratch"></a><span data-ttu-id="08d05-274">Построение проектов hello с нуля</span><span class="sxs-lookup"><span data-stu-id="08d05-274">Building hello projects from scratch</span></span>
<span data-ttu-id="08d05-275">Hello двух веб-API проекты были созданы с помощью hello **приложения API Azure** проекта шаблона и замена контроллера значения по умолчанию hello с ToDoList.</span><span class="sxs-lookup"><span data-stu-id="08d05-275">hello two Web API projects were created by using hello **Azure API App** project template and replacing hello default Values controller with a ToDoList controller.</span></span> 

<span data-ttu-id="08d05-276">Слишком сведения о создании приложения AngularJS одну страницу и серверной части веб-API 2, см. в разделе [руки на лаборатории: построение одной страницы приложений (SPA) с веб-API ASP.NET и Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span><span class="sxs-lookup"><span data-stu-id="08d05-276">For information about how too create an AngularJS single-page application with a Web API 2 back end, see  [Hands On Lab: Build a Single Page Application (SPA) with ASP.NET Web API and Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span></span> <span data-ttu-id="08d05-277">Сведения о том, как tooadd код проверки подлинности Azure AD, см. следующие ресурсы hello:</span><span class="sxs-lookup"><span data-stu-id="08d05-277">For information about how tooadd Azure AD authentication code, see hello following resources:</span></span>

* <span data-ttu-id="08d05-278">[Защита одностраничных приложений AngularJS с помощью Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span><span class="sxs-lookup"><span data-stu-id="08d05-278">[Securing AngularJS Single Page Apps with Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span></span>
* [<span data-ttu-id="08d05-279">Introducing ADAL JS v1 (Введение в ADAL JS, версия 1)</span><span class="sxs-lookup"><span data-stu-id="08d05-279">Introducing ADAL JS v1</span></span>](http://www.cloudidentity.com/blog/2015/02/19/introducing-adal-js-v1/)

## <a name="troubleshooting"></a><span data-ttu-id="08d05-280">Устранение неполадок</span><span class="sxs-lookup"><span data-stu-id="08d05-280">Troubleshooting</span></span>
[!INCLUDE [troubleshooting](../../includes/app-service-api-auth-troubleshooting.md)]

* <span data-ttu-id="08d05-281">Убедитесь, что вы не путаете ToDoListAPI (средний уровень) и ToDoListDataAPI (уровень данных).</span><span class="sxs-lookup"><span data-stu-id="08d05-281">Make sure that you don't confuse ToDoListAPI (middle tier) and ToDoListDataAPI (data tier).</span></span> <span data-ttu-id="08d05-282">Например у добавляемых проверки подлинности toohello среднего уровня API приложения hello уровня данных.</span><span class="sxs-lookup"><span data-stu-id="08d05-282">For example, verify that you added authentication toohello middle tier API app, not hello data tier.</span></span> 
* <span data-ttu-id="08d05-283">Убедитесь, что hello AngularJS исходного кода ссылок hello среднего уровня API URL-адрес приложения (ToDoListAPI, не ToDoListDataAPI) и hello правильными идентификатор клиента Azure AD.</span><span class="sxs-lookup"><span data-stu-id="08d05-283">Make sure that hello AngularJS source code references hello middle tier API app URL (ToDoListAPI, not ToDoListDataAPI)and hello correct Azure AD client ID.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="08d05-284">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="08d05-284">Next steps</span></span>
<span data-ttu-id="08d05-285">В этом учебнике вы узнали, как toouse проверки подлинности службы приложений для приложения API и как toocall hello приложения API с помощью hello библиотеки ADAL JS.</span><span class="sxs-lookup"><span data-stu-id="08d05-285">In this tutorial you learned how toouse App Service authentication for an API app and how toocall hello API app by using hello ADAL JS library.</span></span> <span data-ttu-id="08d05-286">В следующем уроке hello вы узнаете, как слишком[приложения tooyour API безопасного доступа для service to service сценариев](app-service-api-dotnet-service-principal-auth.md).</span><span class="sxs-lookup"><span data-stu-id="08d05-286">In hello next tutorial you'll learn how too[secure access tooyour API app for service-to-service scenarios](app-service-api-dotnet-service-principal-auth.md).</span></span>

