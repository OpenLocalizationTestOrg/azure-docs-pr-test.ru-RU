---
title: "Проверка подлинности и авторизация для приложений API в службе приложений Azure | Документация Майкрософт"
description: "Узнайте о функциях проверки подлинности и авторизации, которые служба приложений Azure предоставляет для приложений API."
services: app-service\api
documentationcenter: .net
author: alexkarcher-msft
manager: erikre
editor: 
ms.assetid: d620b53a-5a6f-41c9-84c7-f7ef5ff02ae7
ms.service: app-service-api
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/23/2016
ms.author: alkarche
ms.openlocfilehash: f9fd533dfbd54517232f9dae5000ed4779baebd4
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="authentication-and-authorization-for-api-apps-in-azure-app-service"></a><span data-ttu-id="b3f6e-103">Проверка подлинности и авторизация для приложений API в службе приложений Azure</span><span class="sxs-lookup"><span data-stu-id="b3f6e-103">Authentication and authorization for API Apps in Azure App Service</span></span>
## <a name="overview"></a><span data-ttu-id="b3f6e-104">Обзор</span><span class="sxs-lookup"><span data-stu-id="b3f6e-104">Overview</span></span>
> [!NOTE]
> <span data-ttu-id="b3f6e-105">Эта статья будет перенесена в сводную статью [Проверка подлинности и авторизация в службе приложений Azure](../app-service/app-service-authentication-overview.md) , которая содержит информацию о веб-приложениях, мобильных приложениях и приложениях API.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-105">This topic will be migrated to a consolidated [App Service Authentication / Authorization](../app-service/app-service-authentication-overview.md) topic, which covers Web, Mobile, and API Apps.</span></span>
> 
> 

<span data-ttu-id="b3f6e-106">В службе приложений Azure есть встроенные службы проверки подлинности и авторизации, которые реализуют протоколы [OAuth 2.0](#oauth) и [OpenID Connect](#oauth).</span><span class="sxs-lookup"><span data-stu-id="b3f6e-106">Azure App Service offers built-in authentication and authorization services that implement [OAuth 2.0](#oauth) and [OpenID Connect](#oauth).</span></span> <span data-ttu-id="b3f6e-107">В этой статье описаны службы и параметры, доступные для приложений API в службе приложений Azure.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-107">This article describes the services and options that are available for API Apps in Azure App Service.</span></span>

<span data-ttu-id="b3f6e-108">Следующая схема иллюстрирует важные характеристики проверки подлинности в службе приложений.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-108">The following diagram illustrates some key characteristics of App Service authentication:</span></span>

* <span data-ttu-id="b3f6e-109">Выполняется предварительная обработка входящих запросов API. Это означает, что проверка подлинности работает с любыми языками и средами, которые поддерживает служба приложений.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-109">It preprocesses incoming API requests, which means it works with any language or framework supported by App Service.</span></span>
* <span data-ttu-id="b3f6e-110">Вы можете выбрать, насколько подробной должна быть проверка подлинности в коде приложения.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-110">It gives you several options for how much authentication work you want to do in your own code.</span></span>
* <span data-ttu-id="b3f6e-111">Выполняется проверка подлинности как конечных пользователей, так и учетных записей служб.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-111">It works for both end user and service account authentication.</span></span> 
* <span data-ttu-id="b3f6e-112">Поддерживаются пять поставщиков удостоверений: Azure Active Directory, Facebook, Google, Twitter и учетная запись Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-112">It supports five identity providers: Azure Active Directory, Facebook, Google, Twitter, and Microsoft Account.</span></span>
* <span data-ttu-id="b3f6e-113">Работает одинаково для приложений API, веб-приложений и мобильных приложений.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-113">It works the same for API Apps, Web Apps, and Mobile Apps.</span></span>

![](./media/app-service-api-authentication/api-apps-overview.png)

## <a name="language-agnostic"></a><span data-ttu-id="b3f6e-114">Независимость от языка</span><span class="sxs-lookup"><span data-stu-id="b3f6e-114">Language agnostic</span></span>
<span data-ttu-id="b3f6e-115">Обработка проверки подлинности в службе приложений происходит до того, как запрос достигнет приложении API. Это означает, что функции проверки подлинности будут одинаково работать для приложений API, написанных на любом языке и на любой платформе.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-115">App Service authentication processing happens before requests reach your API app, which means that the authentication features work for API apps written in any language or framework.</span></span>  <span data-ttu-id="b3f6e-116">API может основываться на ASP.NET, Java, Node.js или любой платформе, которую поддерживает служба приложений.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-116">Your API can be based on ASP.NET, Java, Node.js, or any framework that App Service supports.</span></span>

<span data-ttu-id="b3f6e-117">Служба приложений передает приложению веб-маркер JSON (JWT), который приходит в заголовке авторизации HTTP-запроса. Дальше код (на любом языке или на любой платформе) может получить из маркера необходимые сведения.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-117">App Service passes on the JSON web token (JWT) in the Authorization header of an HTTP request, and code written in any language or framework can get the information it needs from the token.</span></span> <span data-ttu-id="b3f6e-118">Кроме того, служба приложений позволяет упростить доступ к самым часто используемым утверждениям. Служба задает некоторые специальные заголовки, как например:</span><span class="sxs-lookup"><span data-stu-id="b3f6e-118">In addition, App Service gives you easier access to the most commonly used claims by setting some special headers, such as the following:</span></span>

* <span data-ttu-id="b3f6e-119">X-MS-CLIENT-PRINCIPAL-NAME</span><span class="sxs-lookup"><span data-stu-id="b3f6e-119">X-MS-CLIENT-PRINCIPAL-NAME</span></span>
* <span data-ttu-id="b3f6e-120">X-MS-CLIENT-PRINCIPAL-ID</span><span class="sxs-lookup"><span data-stu-id="b3f6e-120">X-MS-CLIENT-PRINCIPAL-ID</span></span>
* <span data-ttu-id="b3f6e-121">X-MS-TOKEN-FACEBOOK-ACCESS-TOKEN</span><span class="sxs-lookup"><span data-stu-id="b3f6e-121">X-MS-TOKEN-FACEBOOK-ACCESS-TOKEN</span></span>
* <span data-ttu-id="b3f6e-122">X-MS-TOKEN-FACEBOOK-EXPIRES-ON</span><span class="sxs-lookup"><span data-stu-id="b3f6e-122">X-MS-TOKEN-FACEBOOK-EXPIRES-ON</span></span>

<span data-ttu-id="b3f6e-123">В API .NET можно использовать атрибут `Authorize` , а для точной авторизации нетрудно написать код на основе утверждений, поскольку вся эта информация занесена для вас в классы .NET.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-123">In a .NET API, you can use the `Authorize` attribute, and for fine-grained authorization you can easily write code based on claims because claims information is populated for you in .NET classes.</span></span>

## <a name="multiple-protection-options"></a><span data-ttu-id="b3f6e-124">Варианты защиты</span><span class="sxs-lookup"><span data-stu-id="b3f6e-124">Multiple protection options</span></span>
<span data-ttu-id="b3f6e-125">Служба приложений может предотвращать поступление анонимных HTTP-запросов в приложение API, передавать все запросы и проверять маркеры на предмет содержащихся в них запросов либо пропускать все запросы, не выполняя с ними никаких действий.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-125">App Service can prevent anonymous HTTP requests from reaching your API app, it can pass on all requests and validate tokens for requests that include them, or it can let through all requests without taking any action on them:</span></span>

1. <span data-ttu-id="b3f6e-126">Пропускать к приложению API только запросы, прошедшие проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-126">Allow only authenticated requests to reach your API app.</span></span>
   
    <span data-ttu-id="b3f6e-127">Если из браузера поступает анонимный запрос, служба приложений перенаправляет его на страницу входа выбранного вами поставщика проверки подлинности (Azure AD, Google, Twitter и т. д.).</span><span class="sxs-lookup"><span data-stu-id="b3f6e-127">If an anonymous request is received from a browser, App Service will redirect to a logon page for the authentication provider (Azure AD, Google, Twitter, etc.) that you choose.</span></span> 
   
    <span data-ttu-id="b3f6e-128">В этом случае в приложении не нужно создавать код проверки подлинности. Код авторизации становится проще, так как наиболее важные утверждения указываются в заголовках HTTP.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-128">With this option, you don't need to write any authentication code at all in your app, and authorization code is simplified because the most important claims are provided in the HTTP headers.</span></span>
2. <span data-ttu-id="b3f6e-129">Пропускать к приложению API все запросы, но проверять запросы проверки подлинности и передавать в заголовках HTTP сведения о проверке подлинности.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-129">Allow all requests to reach your API app, but validate authenticated requests and pass along authentication information in the HTTP headers.</span></span>
   
    <span data-ttu-id="b3f6e-130">Этот параметр обеспечивает дополнительную гибкость в обработке анонимных запросов, но если вы хотите запретить анонимным пользователям пользоваться API, вам придется написать код.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-130">This option gives you more flexibility in handling anonymous requests, but you have to write code if you want to prevent anonymous users from using your API.</span></span> <span data-ttu-id="b3f6e-131">Так как наиболее популярные утверждения передаются в заголовках HTTP-запросов, код авторизации относительно прост.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-131">Since the most popular claims are passed in the headers of HTTP requests, authorization code is relatively simple.</span></span>
3. <span data-ttu-id="b3f6e-132">Пропускать к приложению API все запросы и не выполнять никаких действий для проверки информации о проверке подлинности.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-132">Allow all requests to reach your API, take no action on authentication information in the requests.</span></span>
   
    <span data-ttu-id="b3f6e-133">В этом варианте задачи проверки подлинности и авторизации полностью ложатся на код приложения.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-133">This option leaves the tasks of authentication and authorization entirely up to your application code.</span></span>

<span data-ttu-id="b3f6e-134">На [портале Azure](https://portal.azure.com/), выберите нужный вариант в колонке **Проверка подлинности и авторизация** .</span><span class="sxs-lookup"><span data-stu-id="b3f6e-134">In the [Azure portal](https://portal.azure.com/), you select the option you want on the **Authentication / Authorization** blade.</span></span>

![](./media/app-service-api-authentication/authblade.png)

<span data-ttu-id="b3f6e-135">Для вариантов 1 и 2 включите **проверку подлинности службы приложений**, а в раскрывающемся списке **Предпринимаемое действие, если проверка подлинности для запроса не выполнена** выберите вариант **Вход** или **Разрешить запрос (нет действия)**.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-135">For options 1 and 2, turn on **App Service Authentication**, and in the **Action to take when request is not authenticated** drop-down list choose **Log in** or **Allow request (no action)**.</span></span>  <span data-ttu-id="b3f6e-136">Если вы выберете вариант **Вход**, нужно выбрать поставщик проверки подлинности и указать для него конфигурацию.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-136">If you choose **Log in**, you have to choose an authentication provider and configure that provider.</span></span>

![](./media/app-service-api-authentication/actiontotake.png)

<span data-ttu-id="b3f6e-137">Подробные инструкции по настройке проверки подлинности см. в статье [Настройка приложения службы приложений для использования службы входа Azure Active Directory](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="b3f6e-137">For detailed information about how to configure authentication, see [How to configure your App Service application to use Azure Active Directory login](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span></span> <span data-ttu-id="b3f6e-138">Сведения, приведенные в этой статье, актуальны для приложений API, а также мобильных приложений. Кроме того, статья содержит ссылки на статьи с описанием других поставщиков проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-138">The article applies to API apps as well as mobile apps, and it links to other articles for the other authentication providers.</span></span>

## <span data-ttu-id="b3f6e-139"><a id="internal"></a> Проверка подлинности учетной записи службы</span><span class="sxs-lookup"><span data-stu-id="b3f6e-139"><a id="internal"></a> Service account authentication</span></span>
<span data-ttu-id="b3f6e-140">Проверка подлинности службы приложений эффективна при внутреннем взаимодействии, например при обращении одного приложения API к другому.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-140">App Service authentication works for internal scenarios such as for calling from one API app to another API app.</span></span> <span data-ttu-id="b3f6e-141">В этом случае для получения маркера используются учетные данные службы вместо учетных данных пользователя.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-141">In this scenario you get a token by using credentials for a service account instead of end user credentials.</span></span> <span data-ttu-id="b3f6e-142">Учетная запись службы также называется *субъектом-службой* , а проверка подлинности с использованием такой учетной записи называется сценарием взаимодействия между службами.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-142">A service account is also known as a *service principal* in Azure Active Directory, and authentication using such an account is also known as a service-to-service scenario.</span></span> 

<span data-ttu-id="b3f6e-143">При взаимодействии между службами вызываемое приложение API можно защитить с помощью Azure Active Directory, а для вызова этого приложения API можно предоставить маркер авторизации субъекта-службы AAD.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-143">For service-to-service scenarios, protect the called API app by using Azure Active Directory, and provide an AAD service principal authorization token when you call the API app.</span></span> <span data-ttu-id="b3f6e-144">Вы можете получить маркер из приложения AAD, предоставив идентификатор и секрет клиента.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-144">You get a token by providing the client ID and client secret from the AAD application.</span></span> <span data-ttu-id="b3f6e-145">Не требуется использование специального кода для Azure, в отличие, например, от обработки токена Zumo мобильных служб.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-145">No special Azure-only code is required, such as used to be true for handling the Mobile Services Zumo token.</span></span> <span data-ttu-id="b3f6e-146">Пример такого сценария для приложений API ASP.NET приводится в руководстве [Проверка подлинности с использованием субъекта-службы для приложений API в службе приложений Azure](app-service-api-dotnet-service-principal-auth.md).</span><span class="sxs-lookup"><span data-stu-id="b3f6e-146">An example of this scenario using ASP.NET API apps is covered by the tutorial [Service principal authentication for API Apps](app-service-api-dotnet-service-principal-auth.md).</span></span>

<span data-ttu-id="b3f6e-147">Если в сценарии взаимодействия между службами вы хотите обойтись без проверки подлинности службы приложений, используйте сертификаты клиентов или базовую проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-147">If you want to handle a service-to-service scenario without using App Service authentication, you can use client certificates or basic authentication.</span></span> <span data-ttu-id="b3f6e-148">Сведения о клиентских сертификатах в Azure см. в статье [Настройка взаимной проверки подлинности TLS для веб-приложения](../app-service-web/app-service-web-configure-tls-mutual-auth.md).</span><span class="sxs-lookup"><span data-stu-id="b3f6e-148">For information about client certificates in Azure, see [How To Configure TLS Mutual Authentication for Web Apps](../app-service-web/app-service-web-configure-tls-mutual-auth.md).</span></span> <span data-ttu-id="b3f6e-149">Сведения об обычной проверке подлинности в ASP.NET см. в статье [Authentication Filters in ASP.NET Web API 2](http://www.asp.net/web-api/overview/security/authentication-filters) (Фильтры проверки подлинности в веб-API ASP.NET 2).</span><span class="sxs-lookup"><span data-stu-id="b3f6e-149">For information about basic authentication in ASP.NET, see [Authentication Filters in ASP.NET Web API 2](http://www.asp.net/web-api/overview/security/authentication-filters).</span></span>

<span data-ttu-id="b3f6e-150">Отдельно следует рассмотреть проверку подлинности учетной записи службы из приложения логики службы приложений. Она описана в статье [Использование настраиваемого интерфейса API, размещенного в службе приложений, с приложениями логики](../logic-apps/logic-apps-custom-hosted-api.md).</span><span class="sxs-lookup"><span data-stu-id="b3f6e-150">Service account authentication from an App Service logic app to an API app is a special case that is explained in [Using your custom API hosted on App Service with Logic apps](../logic-apps/logic-apps-custom-hosted-api.md).</span></span>

## <a name="mobile-client-authentication"></a><span data-ttu-id="b3f6e-151">Проверка подлинности клиентов мобильных устройств</span><span class="sxs-lookup"><span data-stu-id="b3f6e-151">Mobile client authentication</span></span>
<span data-ttu-id="b3f6e-152">Сведения о способах обработки проверки подлинности от мобильных клиентов см. в [документации по проверке подлинности для мобильных приложений](../app-service-mobile/app-service-mobile-ios-get-started-users.md).</span><span class="sxs-lookup"><span data-stu-id="b3f6e-152">For information about how to handle authentication from mobile clients, see the [documentation on authentication for mobile apps](../app-service-mobile/app-service-mobile-ios-get-started-users.md).</span></span> <span data-ttu-id="b3f6e-153">Проверка подлинности службы приложений работает одинаково для мобильных приложений и приложений API.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-153">App Service authentication works the same way for mobile apps and API apps.</span></span>

## <a name="more-information"></a><span data-ttu-id="b3f6e-154">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="b3f6e-154">More information</span></span>
<span data-ttu-id="b3f6e-155">Дополнительную информацию о проверке подлинности и авторизации в службе приложений Azure см. на следующих ресурсах:</span><span class="sxs-lookup"><span data-stu-id="b3f6e-155">For more information about authentication and authorization in Azure App Service, see the following resources:</span></span>

* [<span data-ttu-id="b3f6e-156">Расширение проверки подлинности и авторизации службы приложений</span><span class="sxs-lookup"><span data-stu-id="b3f6e-156">Expanding App Service authentication / authorization</span></span>](https://azure.microsoft.com/blog/announcing-app-service-authentication-authorization/)
* <span data-ttu-id="b3f6e-157">[Настройка приложения службы приложений для использования входа Azure Active Directory](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md) (содержит ссылки на описания других поставщиков проверки подлинности в верхней части страницы).</span><span class="sxs-lookup"><span data-stu-id="b3f6e-157">[How to configure your App Service application to use Azure Active Directory login](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md) (Includes links for other authentication providers at the top of the page.)</span></span> 

<span data-ttu-id="b3f6e-158">Дополнительные сведения о протоколах OAuth 2.0, OpenID Connect и веб-маркерах JSON (JWT) см. в следующих статьях:</span><span class="sxs-lookup"><span data-stu-id="b3f6e-158">For more information about OAuth 2.0, OpenID Connect, and JSON Web Tokens (JWT), see the following resources.</span></span>

* [<span data-ttu-id="b3f6e-159">Приступая к работе с протоколом OAuth 2.0</span><span class="sxs-lookup"><span data-stu-id="b3f6e-159">Getting started with OAuth 2.0</span></span>](http://shop.oreilly.com/product/0636920021810.do "Getting Started with OAuth 2.0") 
* [<span data-ttu-id="b3f6e-160">Общие сведения о протоколах OAuth2, OpenID Connect и JSON Web Tokens (JWT), курс Pluralsight</span><span class="sxs-lookup"><span data-stu-id="b3f6e-160">Introduction to OAuth2, OpenID Connect and JSON Web Tokens (JWT) - Pluralsight Course</span></span>](http://www.pluralsight.com/courses/oauth2-json-web-tokens-openid-connect-introduction) 
* [<span data-ttu-id="b3f6e-161">Создание и защита REST API для нескольких клиентов в ASP.NET, курс Pluralsight</span><span class="sxs-lookup"><span data-stu-id="b3f6e-161">Building and Securing a RESTful API for Multiple Clients in ASP.NET - Pluralsight course</span></span>](http://www.pluralsight.com/courses/building-securing-restful-api-aspdotnet)

<span data-ttu-id="b3f6e-162">Дополнительные сведения об Azure Active Directory см. в следующих статьях.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-162">For more information about Azure Active Directory, see the following resources.</span></span>

* [<span data-ttu-id="b3f6e-163">Сценарии проверки подлинности в Azure AD</span><span class="sxs-lookup"><span data-stu-id="b3f6e-163">Azure AD scenarios</span></span>](http://aka.ms/aadscenarios)
* [<span data-ttu-id="b3f6e-164">Руководство разработчика по Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="b3f6e-164">Azure AD developers' guide</span></span>](http://aka.ms/aaddev)
* [<span data-ttu-id="b3f6e-165">Azure Samples (Примеры для Azure)</span><span class="sxs-lookup"><span data-stu-id="b3f6e-165">Azure AD samples</span></span>](http://aka.ms/aadsamples)

## <a name="next-steps"></a><span data-ttu-id="b3f6e-166">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="b3f6e-166">Next steps</span></span>
<span data-ttu-id="b3f6e-167">В этой статье вы познакомились с функциями проверки подлинности и авторизации службы приложений, которые можно использовать для приложений API.</span><span class="sxs-lookup"><span data-stu-id="b3f6e-167">This article has explained authentication and authorization features of App Service that you can use for API apps.</span></span> <span data-ttu-id="b3f6e-168">В следующем учебнике начальной серии вы узнаете, как реализовать [проверку подлинности пользователя для приложений API службы приложений Azure](app-service-api-dotnet-user-principal-auth.md).</span><span class="sxs-lookup"><span data-stu-id="b3f6e-168">The next tutorial in the getting started series shows how to implement [user authentication in App Service API Apps](app-service-api-dotnet-user-principal-auth.md).</span></span>

