---
title: "Проверка подлинности и авторизация для приложений API в службе приложений Azure | Документация Майкрософт"
description: "Узнайте о функциях проверки подлинности и авторизации, которые служба приложений Azure предоставляет для приложений API."
services: app-service\api
documentationcenter: .net
author: alexkarcher-msft
manager: erikre
editor: 
ms.assetid: d620b53a-5a6f-41c9-84c7-f7ef5ff02ae7
ms.service: app-service-api
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/23/2016
ms.author: alkarche
ms.openlocfilehash: f9fd533dfbd54517232f9dae5000ed4779baebd4
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="authentication-and-authorization-for-api-apps-in-azure-app-service"></a>Проверка подлинности и авторизация для приложений API в службе приложений Azure
## <a name="overview"></a>Обзор
> [!NOTE]
> Эта статья будет перенесена в сводную статью [Проверка подлинности и авторизация в службе приложений Azure](../app-service/app-service-authentication-overview.md) , которая содержит информацию о веб-приложениях, мобильных приложениях и приложениях API.
> 
> 

В службе приложений Azure есть встроенные службы проверки подлинности и авторизации, которые реализуют протоколы [OAuth 2.0](#oauth) и [OpenID Connect](#oauth). В этой статье описаны службы и параметры, доступные для приложений API в службе приложений Azure.

Следующая схема иллюстрирует важные характеристики проверки подлинности в службе приложений.

* Выполняется предварительная обработка входящих запросов API. Это означает, что проверка подлинности работает с любыми языками и средами, которые поддерживает служба приложений.
* Вы можете выбрать, насколько подробной должна быть проверка подлинности в коде приложения.
* Выполняется проверка подлинности как конечных пользователей, так и учетных записей служб. 
* Поддерживаются пять поставщиков удостоверений: Azure Active Directory, Facebook, Google, Twitter и учетная запись Майкрософт.
* Работает одинаково для приложений API, веб-приложений и мобильных приложений.

![](./media/app-service-api-authentication/api-apps-overview.png)

## <a name="language-agnostic"></a>Независимость от языка
Обработка проверки подлинности в службе приложений происходит до того, как запрос достигнет приложении API. Это означает, что функции проверки подлинности будут одинаково работать для приложений API, написанных на любом языке и на любой платформе.  API может основываться на ASP.NET, Java, Node.js или любой платформе, которую поддерживает служба приложений.

Служба приложений передает приложению веб-маркер JSON (JWT), который приходит в заголовке авторизации HTTP-запроса. Дальше код (на любом языке или на любой платформе) может получить из маркера необходимые сведения. Кроме того, служба приложений позволяет упростить доступ к самым часто используемым утверждениям. Служба задает некоторые специальные заголовки, как например:

* X-MS-CLIENT-PRINCIPAL-NAME
* X-MS-CLIENT-PRINCIPAL-ID
* X-MS-TOKEN-FACEBOOK-ACCESS-TOKEN
* X-MS-TOKEN-FACEBOOK-EXPIRES-ON

В API .NET можно использовать атрибут `Authorize` , а для точной авторизации нетрудно написать код на основе утверждений, поскольку вся эта информация занесена для вас в классы .NET.

## <a name="multiple-protection-options"></a>Варианты защиты
Служба приложений может предотвращать поступление анонимных HTTP-запросов в приложение API, передавать все запросы и проверять маркеры на предмет содержащихся в них запросов либо пропускать все запросы, не выполняя с ними никаких действий.

1. Пропускать к приложению API только запросы, прошедшие проверку подлинности.
   
    Если из браузера поступает анонимный запрос, служба приложений перенаправляет его на страницу входа выбранного вами поставщика проверки подлинности (Azure AD, Google, Twitter и т. д.). 
   
    В этом случае в приложении не нужно создавать код проверки подлинности. Код авторизации становится проще, так как наиболее важные утверждения указываются в заголовках HTTP.
2. Пропускать к приложению API все запросы, но проверять запросы проверки подлинности и передавать в заголовках HTTP сведения о проверке подлинности.
   
    Этот параметр обеспечивает дополнительную гибкость в обработке анонимных запросов, но если вы хотите запретить анонимным пользователям пользоваться API, вам придется написать код. Так как наиболее популярные утверждения передаются в заголовках HTTP-запросов, код авторизации относительно прост.
3. Пропускать к приложению API все запросы и не выполнять никаких действий для проверки информации о проверке подлинности.
   
    В этом варианте задачи проверки подлинности и авторизации полностью ложатся на код приложения.

На [портале Azure](https://portal.azure.com/), выберите нужный вариант в колонке **Проверка подлинности и авторизация** .

![](./media/app-service-api-authentication/authblade.png)

Для вариантов 1 и 2 включите **проверку подлинности службы приложений**, а в раскрывающемся списке **Предпринимаемое действие, если проверка подлинности для запроса не выполнена** выберите вариант **Вход** или **Разрешить запрос (нет действия)**.  Если вы выберете вариант **Вход**, нужно выбрать поставщик проверки подлинности и указать для него конфигурацию.

![](./media/app-service-api-authentication/actiontotake.png)

Подробные инструкции по настройке проверки подлинности см. в статье [Настройка приложения службы приложений для использования службы входа Azure Active Directory](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md). Сведения, приведенные в этой статье, актуальны для приложений API, а также мобильных приложений. Кроме того, статья содержит ссылки на статьи с описанием других поставщиков проверки подлинности.

## <a id="internal"></a> Проверка подлинности учетной записи службы
Проверка подлинности службы приложений эффективна при внутреннем взаимодействии, например при обращении одного приложения API к другому. В этом случае для получения маркера используются учетные данные службы вместо учетных данных пользователя. Учетная запись службы также называется *субъектом-службой* , а проверка подлинности с использованием такой учетной записи называется сценарием взаимодействия между службами. 

При взаимодействии между службами вызываемое приложение API можно защитить с помощью Azure Active Directory, а для вызова этого приложения API можно предоставить маркер авторизации субъекта-службы AAD. Вы можете получить маркер из приложения AAD, предоставив идентификатор и секрет клиента. Не требуется использование специального кода для Azure, в отличие, например, от обработки токена Zumo мобильных служб. Пример такого сценария для приложений API ASP.NET приводится в руководстве [Проверка подлинности с использованием субъекта-службы для приложений API в службе приложений Azure](app-service-api-dotnet-service-principal-auth.md).

Если в сценарии взаимодействия между службами вы хотите обойтись без проверки подлинности службы приложений, используйте сертификаты клиентов или базовую проверку подлинности. Сведения о клиентских сертификатах в Azure см. в статье [Настройка взаимной проверки подлинности TLS для веб-приложения](../app-service-web/app-service-web-configure-tls-mutual-auth.md). Сведения об обычной проверке подлинности в ASP.NET см. в статье [Authentication Filters in ASP.NET Web API 2](http://www.asp.net/web-api/overview/security/authentication-filters) (Фильтры проверки подлинности в веб-API ASP.NET 2).

Отдельно следует рассмотреть проверку подлинности учетной записи службы из приложения логики службы приложений. Она описана в статье [Использование настраиваемого интерфейса API, размещенного в службе приложений, с приложениями логики](../logic-apps/logic-apps-custom-hosted-api.md).

## <a name="mobile-client-authentication"></a>Проверка подлинности клиентов мобильных устройств
Сведения о способах обработки проверки подлинности от мобильных клиентов см. в [документации по проверке подлинности для мобильных приложений](../app-service-mobile/app-service-mobile-ios-get-started-users.md). Проверка подлинности службы приложений работает одинаково для мобильных приложений и приложений API.

## <a name="more-information"></a>Дополнительные сведения
Дополнительную информацию о проверке подлинности и авторизации в службе приложений Azure см. на следующих ресурсах:

* [Расширение проверки подлинности и авторизации службы приложений](https://azure.microsoft.com/blog/announcing-app-service-authentication-authorization/)
* [Настройка приложения службы приложений для использования входа Azure Active Directory](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md) (содержит ссылки на описания других поставщиков проверки подлинности в верхней части страницы). 

Дополнительные сведения о протоколах OAuth 2.0, OpenID Connect и веб-маркерах JSON (JWT) см. в следующих статьях:

* [Приступая к работе с протоколом OAuth 2.0](http://shop.oreilly.com/product/0636920021810.do "Getting Started with OAuth 2.0") 
* [Общие сведения о протоколах OAuth2, OpenID Connect и JSON Web Tokens (JWT), курс Pluralsight](http://www.pluralsight.com/courses/oauth2-json-web-tokens-openid-connect-introduction) 
* [Создание и защита REST API для нескольких клиентов в ASP.NET, курс Pluralsight](http://www.pluralsight.com/courses/building-securing-restful-api-aspdotnet)

Дополнительные сведения об Azure Active Directory см. в следующих статьях.

* [Сценарии проверки подлинности в Azure AD](http://aka.ms/aadscenarios)
* [Руководство разработчика по Azure Active Directory](http://aka.ms/aaddev)
* [Azure Samples (Примеры для Azure)](http://aka.ms/aadsamples)

## <a name="next-steps"></a>Дальнейшие действия
В этой статье вы познакомились с функциями проверки подлинности и авторизации службы приложений, которые можно использовать для приложений API. В следующем учебнике начальной серии вы узнаете, как реализовать [проверку подлинности пользователя для приложений API службы приложений Azure](app-service-api-dotnet-user-principal-auth.md).

