---
title: "aaaAuthentication и авторизации для приложения API в службе приложений Azure | Документы Microsoft"
description: "Дополнительные сведения о hello службы аутентификации и авторизации, предоставляемые службе приложений Azure для приложений API."
services: app-service\api
documentationcenter: .net
author: alexkarcher-msft
manager: erikre
editor: 
ms.assetid: d620b53a-5a6f-41c9-84c7-f7ef5ff02ae7
ms.service: app-service-api
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/23/2016
ms.author: alkarche
ms.openlocfilehash: 6d26754b8b606ec232a74768787922ea80577c95
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="authentication-and-authorization-for-api-apps-in-azure-app-service"></a><span data-ttu-id="78d07-103">Проверка подлинности и авторизация для приложений API в службе приложений Azure</span><span class="sxs-lookup"><span data-stu-id="78d07-103">Authentication and authorization for API Apps in Azure App Service</span></span>
## <a name="overview"></a><span data-ttu-id="78d07-104">Обзор</span><span class="sxs-lookup"><span data-stu-id="78d07-104">Overview</span></span>
> [!NOTE]
> <span data-ttu-id="78d07-105">В этом разделе будет перенесенных tooa консолидированные [проверки подлинности службы для приложения / авторизации](../app-service/app-service-authentication-overview.md) темы, который охватывает Web, мобильных устройств и приложения API.</span><span class="sxs-lookup"><span data-stu-id="78d07-105">This topic will be migrated tooa consolidated [App Service Authentication / Authorization](../app-service/app-service-authentication-overview.md) topic, which covers Web, Mobile, and API Apps.</span></span>
> 
> 

<span data-ttu-id="78d07-106">В службе приложений Azure есть встроенные службы проверки подлинности и авторизации, которые реализуют протоколы [OAuth 2.0](#oauth) и [OpenID Connect](#oauth).</span><span class="sxs-lookup"><span data-stu-id="78d07-106">Azure App Service offers built-in authentication and authorization services that implement [OAuth 2.0](#oauth) and [OpenID Connect](#oauth).</span></span> <span data-ttu-id="78d07-107">Эта статья описывает hello службы и параметры, доступные для приложения API в службе приложений Azure.</span><span class="sxs-lookup"><span data-stu-id="78d07-107">This article describes hello services and options that are available for API Apps in Azure App Service.</span></span>

<span data-ttu-id="78d07-108">Привет, следующая схема иллюстрирует некоторые ключевые характеристики приложения службы проверки подлинности:</span><span class="sxs-lookup"><span data-stu-id="78d07-108">hello following diagram illustrates some key characteristics of App Service authentication:</span></span>

* <span data-ttu-id="78d07-109">Выполняется предварительная обработка входящих запросов API. Это означает, что проверка подлинности работает с любыми языками и средами, которые поддерживает служба приложений.</span><span class="sxs-lookup"><span data-stu-id="78d07-109">It preprocesses incoming API requests, which means it works with any language or framework supported by App Service.</span></span>
* <span data-ttu-id="78d07-110">Он предоставляет нужные несколько вариантов какая проверка подлинности работает вы toodo в собственном коде.</span><span class="sxs-lookup"><span data-stu-id="78d07-110">It gives you several options for how much authentication work you want toodo in your own code.</span></span>
* <span data-ttu-id="78d07-111">Выполняется проверка подлинности как конечных пользователей, так и учетных записей служб.</span><span class="sxs-lookup"><span data-stu-id="78d07-111">It works for both end user and service account authentication.</span></span> 
* <span data-ttu-id="78d07-112">Поддерживаются пять поставщиков удостоверений: Azure Active Directory, Facebook, Google, Twitter и учетная запись Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="78d07-112">It supports five identity providers: Azure Active Directory, Facebook, Google, Twitter, and Microsoft Account.</span></span>
* <span data-ttu-id="78d07-113">Он работает hello одинаково для приложения API, веб-приложения и мобильные приложения.</span><span class="sxs-lookup"><span data-stu-id="78d07-113">It works hello same for API Apps, Web Apps, and Mobile Apps.</span></span>

![](./media/app-service-api-authentication/api-apps-overview.png)

## <a name="language-agnostic"></a><span data-ttu-id="78d07-114">Независимость от языка</span><span class="sxs-lookup"><span data-stu-id="78d07-114">Language agnostic</span></span>
<span data-ttu-id="78d07-115">Обработка проверки подлинности службы приложений происходит перед запросы попадают в приложении API, что означает, что функции проверки подлинности hello работать API приложений, написанных на любом языке, framework.</span><span class="sxs-lookup"><span data-stu-id="78d07-115">App Service authentication processing happens before requests reach your API app, which means that hello authentication features work for API apps written in any language or framework.</span></span>  <span data-ttu-id="78d07-116">API может основываться на ASP.NET, Java, Node.js или любой платформе, которую поддерживает служба приложений.</span><span class="sxs-lookup"><span data-stu-id="78d07-116">Your API can be based on ASP.NET, Java, Node.js, or any framework that App Service supports.</span></span>

<span data-ttu-id="78d07-117">Служба приложения передает hello веб-токен JSON (JWT) в заголовке авторизации hello HTTP-запроса, и код, написанный на любом языке, framework может получить hello информации, необходимой с hello токена.</span><span class="sxs-lookup"><span data-stu-id="78d07-117">App Service passes on hello JSON web token (JWT) in hello Authorization header of an HTTP request, and code written in any language or framework can get hello information it needs from hello token.</span></span> <span data-ttu-id="78d07-118">Кроме того службы приложений предоставляет упрощенный доступ toohello чаще всего используются утверждения, задав некоторые специальные заголовки, например hello следующие:</span><span class="sxs-lookup"><span data-stu-id="78d07-118">In addition, App Service gives you easier access toohello most commonly used claims by setting some special headers, such as hello following:</span></span>

* <span data-ttu-id="78d07-119">X-MS-CLIENT-PRINCIPAL-NAME</span><span class="sxs-lookup"><span data-stu-id="78d07-119">X-MS-CLIENT-PRINCIPAL-NAME</span></span>
* <span data-ttu-id="78d07-120">X-MS-CLIENT-PRINCIPAL-ID</span><span class="sxs-lookup"><span data-stu-id="78d07-120">X-MS-CLIENT-PRINCIPAL-ID</span></span>
* <span data-ttu-id="78d07-121">X-MS-TOKEN-FACEBOOK-ACCESS-TOKEN</span><span class="sxs-lookup"><span data-stu-id="78d07-121">X-MS-TOKEN-FACEBOOK-ACCESS-TOKEN</span></span>
* <span data-ttu-id="78d07-122">X-MS-TOKEN-FACEBOOK-EXPIRES-ON</span><span class="sxs-lookup"><span data-stu-id="78d07-122">X-MS-TOKEN-FACEBOOK-EXPIRES-ON</span></span>

<span data-ttu-id="78d07-123">В .NET API, можно использовать hello `Authorize` атрибута, а для точного авторизации, можно легко писать код на основе утверждений, поскольку информацию об утверждениях заполняется автоматически в классы .NET.</span><span class="sxs-lookup"><span data-stu-id="78d07-123">In a .NET API, you can use hello `Authorize` attribute, and for fine-grained authorization you can easily write code based on claims because claims information is populated for you in .NET classes.</span></span>

## <a name="multiple-protection-options"></a><span data-ttu-id="78d07-124">Варианты защиты</span><span class="sxs-lookup"><span data-stu-id="78d07-124">Multiple protection options</span></span>
<span data-ttu-id="78d07-125">Служба приложений может предотвращать поступление анонимных HTTP-запросов в приложение API, передавать все запросы и проверять маркеры на предмет содержащихся в них запросов либо пропускать все запросы, не выполняя с ними никаких действий.</span><span class="sxs-lookup"><span data-stu-id="78d07-125">App Service can prevent anonymous HTTP requests from reaching your API app, it can pass on all requests and validate tokens for requests that include them, or it can let through all requests without taking any action on them:</span></span>

1. <span data-ttu-id="78d07-126">Разрешить только tooreach запросов проверки подлинности приложения API.</span><span class="sxs-lookup"><span data-stu-id="78d07-126">Allow only authenticated requests tooreach your API app.</span></span>
   
    <span data-ttu-id="78d07-127">Если анонимный запрос поступает из браузера, службы приложений будет перенаправлен на страницу входа в систему tooa hello поставщика проверки подлинности (Azure AD, Google, Twitter, т. д.), выбрать.</span><span class="sxs-lookup"><span data-stu-id="78d07-127">If an anonymous request is received from a browser, App Service will redirect tooa logon page for hello authentication provider (Azure AD, Google, Twitter, etc.) that you choose.</span></span> 
   
    <span data-ttu-id="78d07-128">Этот параметр не требуется toowrite любой код проверки подлинности во всех в приложении, и код авторизации становится проще, поскольку hello наиболее важных утверждения предоставляются в заголовках hello HTTP.</span><span class="sxs-lookup"><span data-stu-id="78d07-128">With this option, you don't need toowrite any authentication code at all in your app, and authorization code is simplified because hello most important claims are provided in hello HTTP headers.</span></span>
2. <span data-ttu-id="78d07-129">Разрешить все запросы tooreach приложения API, но проверки запросов на проверку подлинности и передают сведения о проверке подлинности в заголовках hello HTTP.</span><span class="sxs-lookup"><span data-stu-id="78d07-129">Allow all requests tooreach your API app, but validate authenticated requests and pass along authentication information in hello HTTP headers.</span></span>
   
    <span data-ttu-id="78d07-130">Этот параметр обеспечивает большую гибкость при обработке анонимных запросов, но у вас есть код toowrite Если tooprevent анонимных пользователей с помощью API.</span><span class="sxs-lookup"><span data-stu-id="78d07-130">This option gives you more flexibility in handling anonymous requests, but you have toowrite code if you want tooprevent anonymous users from using your API.</span></span> <span data-ttu-id="78d07-131">Поскольку hello наиболее популярных утверждения передаются в hello заголовки HTTP-запросов, код авторизации относительно проста.</span><span class="sxs-lookup"><span data-stu-id="78d07-131">Since hello most popular claims are passed in hello headers of HTTP requests, authorization code is relatively simple.</span></span>
3. <span data-ttu-id="78d07-132">Разрешить все запросы tooreach API, на сведения о проверке подлинности в запросах hello не выполнять никаких действий.</span><span class="sxs-lookup"><span data-stu-id="78d07-132">Allow all requests tooreach your API, take no action on authentication information in hello requests.</span></span>
   
    <span data-ttu-id="78d07-133">Этот параметр оставляет hello задачи проверки подлинности и авторизации полностью вверх tooyour кода приложения.</span><span class="sxs-lookup"><span data-stu-id="78d07-133">This option leaves hello tasks of authentication and authorization entirely up tooyour application code.</span></span>

<span data-ttu-id="78d07-134">В hello [портал Azure](https://portal.azure.com/), выберите параметр hello на hello **проверки подлинности и авторизации** колонку.</span><span class="sxs-lookup"><span data-stu-id="78d07-134">In hello [Azure portal](https://portal.azure.com/), you select hello option you want on hello **Authentication / Authorization** blade.</span></span>

![](./media/app-service-api-authentication/authblade.png)

<span data-ttu-id="78d07-135">Для параметров 1 и 2, включите **проверки подлинности службы приложения**и в hello **tootake действия, если запрос не прошел проверку подлинности** раскрывающемся списке выберите **вход** или **Разрешить запрос (никаких действий)**.</span><span class="sxs-lookup"><span data-stu-id="78d07-135">For options 1 and 2, turn on **App Service Authentication**, and in hello **Action tootake when request is not authenticated** drop-down list choose **Log in** or **Allow request (no action)**.</span></span>  <span data-ttu-id="78d07-136">При выборе **входа**, имеют toochoose поставщика проверки подлинности и настройка этого поставщика.</span><span class="sxs-lookup"><span data-stu-id="78d07-136">If you choose **Log in**, you have toochoose an authentication provider and configure that provider.</span></span>

![](./media/app-service-api-authentication/actiontotake.png)

<span data-ttu-id="78d07-137">Подробные сведения о том, как tooconfigure проверки подлинности, в разделе [как tooconfigure вход службы приложений toouse приложения Azure Active Directory](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="78d07-137">For detailed information about how tooconfigure authentication, see [How tooconfigure your App Service application toouse Azure Active Directory login](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span></span> <span data-ttu-id="78d07-138">статья Hello относится tooAPI приложений, а также мобильные приложения и приводятся ссылки на статьи, посвященные tooother hello других поставщиков проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="78d07-138">hello article applies tooAPI apps as well as mobile apps, and it links tooother articles for hello other authentication providers.</span></span>

## <span data-ttu-id="78d07-139"><a id="internal"></a> Проверка подлинности учетной записи службы</span><span class="sxs-lookup"><span data-stu-id="78d07-139"><a id="internal"></a> Service account authentication</span></span>
<span data-ttu-id="78d07-140">Проверки подлинности службы приложений работает для внутренних сценариях, например для вызова из одного приложения tooanother API приложения API.</span><span class="sxs-lookup"><span data-stu-id="78d07-140">App Service authentication works for internal scenarios such as for calling from one API app tooanother API app.</span></span> <span data-ttu-id="78d07-141">В этом случае для получения маркера используются учетные данные службы вместо учетных данных пользователя.</span><span class="sxs-lookup"><span data-stu-id="78d07-141">In this scenario you get a token by using credentials for a service account instead of end user credentials.</span></span> <span data-ttu-id="78d07-142">Учетная запись службы также называется *субъектом-службой* , а проверка подлинности с использованием такой учетной записи называется сценарием взаимодействия между службами.</span><span class="sxs-lookup"><span data-stu-id="78d07-142">A service account is also known as a *service principal* in Azure Active Directory, and authentication using such an account is also known as a service-to-service scenario.</span></span> 

<span data-ttu-id="78d07-143">Для сценариев служба служба защиты hello вызвать API приложения с помощью Azure Active Directory и предоставить маркер AAD службы основной авторизации при вызове приложение hello API.</span><span class="sxs-lookup"><span data-stu-id="78d07-143">For service-to-service scenarios, protect hello called API app by using Azure Active Directory, and provide an AAD service principal authorization token when you call hello API app.</span></span> <span data-ttu-id="78d07-144">Получить маркер, предоставляя идентификатор клиента hello и клиента, секрет из hello AAD приложения.</span><span class="sxs-lookup"><span data-stu-id="78d07-144">You get a token by providing hello client ID and client secret from hello AAD application.</span></span> <span data-ttu-id="78d07-145">Нет специального кода только в Azure не требуется, например true toobe используется для обработки маркера hello Zumo мобильных служб.</span><span class="sxs-lookup"><span data-stu-id="78d07-145">No special Azure-only code is required, such as used toobe true for handling hello Mobile Services Zumo token.</span></span> <span data-ttu-id="78d07-146">Пример такого сценария с помощью приложения ASP.NET API, связанная с hello учебника [основной проверки подлинности службы для приложений API](app-service-api-dotnet-service-principal-auth.md).</span><span class="sxs-lookup"><span data-stu-id="78d07-146">An example of this scenario using ASP.NET API apps is covered by hello tutorial [Service principal authentication for API Apps](app-service-api-dotnet-service-principal-auth.md).</span></span>

<span data-ttu-id="78d07-147">Следует toohandle сценарии для служб без использования проверки подлинности службы приложений можно использовать клиентские сертификаты или обычной проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="78d07-147">If you want toohandle a service-to-service scenario without using App Service authentication, you can use client certificates or basic authentication.</span></span> <span data-ttu-id="78d07-148">Сведения о клиентских сертификатов в Azure см. в разделе [как tooConfigure TLS взаимной проверки подлинности для веб-приложений](../app-service-web/app-service-web-configure-tls-mutual-auth.md).</span><span class="sxs-lookup"><span data-stu-id="78d07-148">For information about client certificates in Azure, see [How tooConfigure TLS Mutual Authentication for Web Apps](../app-service-web/app-service-web-configure-tls-mutual-auth.md).</span></span> <span data-ttu-id="78d07-149">Сведения об обычной проверке подлинности в ASP.NET см. в статье [Authentication Filters in ASP.NET Web API 2](http://www.asp.net/web-api/overview/security/authentication-filters) (Фильтры проверки подлинности в веб-API ASP.NET 2).</span><span class="sxs-lookup"><span data-stu-id="78d07-149">For information about basic authentication in ASP.NET, see [Authentication Filters in ASP.NET Web API 2](http://www.asp.net/web-api/overview/security/authentication-filters).</span></span>

<span data-ttu-id="78d07-150">Проверка подлинности учетной записи службы из приложения tooan API службы приложений логики приложения является особым случаем, который описан в [с помощью настраиваемого API, размещенных в службе приложений с приложениями логики](../logic-apps/logic-apps-custom-hosted-api.md).</span><span class="sxs-lookup"><span data-stu-id="78d07-150">Service account authentication from an App Service logic app tooan API app is a special case that is explained in [Using your custom API hosted on App Service with Logic apps](../logic-apps/logic-apps-custom-hosted-api.md).</span></span>

## <a name="mobile-client-authentication"></a><span data-ttu-id="78d07-151">Проверка подлинности клиентов мобильных устройств</span><span class="sxs-lookup"><span data-stu-id="78d07-151">Mobile client authentication</span></span>
<span data-ttu-id="78d07-152">Сведения о том, как toohandle проверки подлинности мобильных клиентов. в разделе hello [документации о проверке подлинности для мобильных приложений](../app-service-mobile/app-service-mobile-ios-get-started-users.md).</span><span class="sxs-lookup"><span data-stu-id="78d07-152">For information about how toohandle authentication from mobile clients, see hello [documentation on authentication for mobile apps](../app-service-mobile/app-service-mobile-ios-get-started-users.md).</span></span> <span data-ttu-id="78d07-153">Проверка подлинности службы приложений работает hello одинаково для мобильных приложений и API.</span><span class="sxs-lookup"><span data-stu-id="78d07-153">App Service authentication works hello same way for mobile apps and API apps.</span></span>

## <a name="more-information"></a><span data-ttu-id="78d07-154">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="78d07-154">More information</span></span>
<span data-ttu-id="78d07-155">Дополнительные сведения о проверке подлинности и авторизации в службе приложений Azure см. в разделе hello следующие ресурсы:</span><span class="sxs-lookup"><span data-stu-id="78d07-155">For more information about authentication and authorization in Azure App Service, see hello following resources:</span></span>

* [<span data-ttu-id="78d07-156">Расширение проверки подлинности и авторизации службы приложений</span><span class="sxs-lookup"><span data-stu-id="78d07-156">Expanding App Service authentication / authorization</span></span>](https://azure.microsoft.com/blog/announcing-app-service-authentication-authorization/)
* <span data-ttu-id="78d07-157">[Как tooconfigure вход службы приложений toouse приложения Azure Active Directory](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md) (ссылки для других поставщиков проверки подлинности в начале hello страницы приветствия.)</span><span class="sxs-lookup"><span data-stu-id="78d07-157">[How tooconfigure your App Service application toouse Azure Active Directory login](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md) (Includes links for other authentication providers at hello top of hello page.)</span></span> 

<span data-ttu-id="78d07-158">Дополнительные сведения об OAuth 2.0, OpenID Connect и веб-токены JSON (JWT) см. следующие ресурсы hello.</span><span class="sxs-lookup"><span data-stu-id="78d07-158">For more information about OAuth 2.0, OpenID Connect, and JSON Web Tokens (JWT), see hello following resources.</span></span>

* [<span data-ttu-id="78d07-159">Приступая к работе с протоколом OAuth 2.0</span><span class="sxs-lookup"><span data-stu-id="78d07-159">Getting started with OAuth 2.0</span></span>](http://shop.oreilly.com/product/0636920021810.do "Getting Started with OAuth 2.0") 
* [<span data-ttu-id="78d07-160">TooOAuth2 введение OpenID Connect и JSON Web токены (JWT) — Pluralsight курса</span><span class="sxs-lookup"><span data-stu-id="78d07-160">Introduction tooOAuth2, OpenID Connect and JSON Web Tokens (JWT) - Pluralsight Course</span></span>](http://www.pluralsight.com/courses/oauth2-json-web-tokens-openid-connect-introduction) 
* [<span data-ttu-id="78d07-161">Создание и защита REST API для нескольких клиентов в ASP.NET, курс Pluralsight</span><span class="sxs-lookup"><span data-stu-id="78d07-161">Building and Securing a RESTful API for Multiple Clients in ASP.NET - Pluralsight course</span></span>](http://www.pluralsight.com/courses/building-securing-restful-api-aspdotnet)

<span data-ttu-id="78d07-162">Дополнительные сведения о Azure Active Directory см. следующие ресурсы hello.</span><span class="sxs-lookup"><span data-stu-id="78d07-162">For more information about Azure Active Directory, see hello following resources.</span></span>

* [<span data-ttu-id="78d07-163">Сценарии проверки подлинности в Azure AD</span><span class="sxs-lookup"><span data-stu-id="78d07-163">Azure AD scenarios</span></span>](http://aka.ms/aadscenarios)
* [<span data-ttu-id="78d07-164">Руководство разработчика по Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="78d07-164">Azure AD developers' guide</span></span>](http://aka.ms/aaddev)
* [<span data-ttu-id="78d07-165">Azure Samples (Примеры для Azure)</span><span class="sxs-lookup"><span data-stu-id="78d07-165">Azure AD samples</span></span>](http://aka.ms/aadsamples)

## <a name="next-steps"></a><span data-ttu-id="78d07-166">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="78d07-166">Next steps</span></span>
<span data-ttu-id="78d07-167">В этой статье вы познакомились с функциями проверки подлинности и авторизации службы приложений, которые можно использовать для приложений API.</span><span class="sxs-lookup"><span data-stu-id="78d07-167">This article has explained authentication and authorization features of App Service that you can use for API apps.</span></span> <span data-ttu-id="78d07-168">Следующее руководство Hello в получении hello работы показывает ряды как tooimplement [проверки подлинности пользователя в приложениях API службы приложения](app-service-api-dotnet-user-principal-auth.md).</span><span class="sxs-lookup"><span data-stu-id="78d07-168">hello next tutorial in hello getting started series shows how tooimplement [user authentication in App Service API Apps](app-service-api-dotnet-user-principal-auth.md).</span></span>

