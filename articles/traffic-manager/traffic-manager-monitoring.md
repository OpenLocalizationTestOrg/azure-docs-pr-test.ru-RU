---
title: "мониторинг конечной точки диспетчера трафика aaaAzure | Документы Microsoft"
description: "Эта статья поможет вам понять, как диспетчер трафика использует мониторинга конечных точек и конечной точки автоматического перехода на другой ресурс toohelp Azure клиентам развертывать приложения высокой доступности"
services: traffic-manager
documentationcenter: 
author: kumudd
manager: timlt
editor: 
ms.assetid: fff25ac3-d13a-4af9-8916-7c72e3d64bc7
ms.service: traffic-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 06/22/2017
ms.author: kumud
ms.openlocfilehash: b4862499c88bdb1951833d06199b034a07ac7576
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="traffic-manager-endpoint-monitoring"></a>Мониторинг конечных точек в диспетчере трафика

Диспетчер трафика Azure включает в себя встроенные возможности мониторинга и автоматическую отработку отказа конечных точек. Эта функция позволяет вам предоставлять высокого уровня доступности приложения, которые являются устойчивыми tooendpoint сбоя, включая сбои регион Azure.

## <a name="configure-endpoint-monitoring"></a>Настройка мониторинга конечных точек

tooconfigure мониторинга конечной точки, необходимо указать следующие параметры для профиля диспетчера трафика hello:

* **Протокол**. Выберите HTTP, HTTPS или TCP в качестве протокола hello, диспетчер трафика использует при поиске ваш конечная точка toocheck его работоспособности. Мониторинг HTTPS не проверяет допустимость SSL-сертификат — он только проверяет, что hello отсутствует сертификат.
* **Порт**. Выберите hello порт, используемый для запроса hello.
* **Путь**. Этот параметр конфигурации является допустимым только для hello протоколов HTTP и HTTPS, для которых требуется указание параметра пути hello. Предоставление этот параметр для hello TCP мониторинга протокола приведет к ошибке. Для протокола TCP предоставьте hello относительный путь и имя hello hello веб-страницу или файл hello, hello мониторинга обращается к. Косую черту (/) является допустимой записью для относительного пути hello. Это значение означает, что это файл hello в корневом каталоге hello (по умолчанию).
* **Интервал проверки**. Это значение указывает, как часто проверяется работоспособность конечной точки с помощью агента проверки диспетчера трафика. Вы можете указать здесь два значения: 30 секунд (обычная проверка) и 10 секунд (быстрая проверка). Если значения не указаны, профиль hello задает значение по умолчанию tooa 30 секунд. Посетите hello [диспетчера трафика цены](https://azure.microsoft.com/pricing/details/traffic-manager) toolearn страницы, Дополнительные сведения о ценах быстрой проверки.
* **Допустимое число сбоев**. Это значение указывает количество сбоев, которое допускает агент проверки диспетчера трафика. По достижении этого количества конечная точка будет помечена как неработоспособная. Значение должно быть в диапазоне от 0 до 9. Значение 0 означает сбой одного мониторинга может привести к этой конечной точке toobe, отмечен как неработоспособный. Если значение не указано, то используется значение по умолчанию hello 3.
* **Время ожидания мониторинга**. Это свойство указывает hello объем времени hello проверки агента будет ожидать перед тем, как диспетчер трафика, проверьте сбоя при отправке проверки зонда работоспособности toohello конечной точки. Если приветствия зондирования интервал too30 секунд, то можно задать значение времени ожидания hello между 5 и 10 секунд. Если значение не задано, используется значение по умолчанию 10 секунд. Если приветствия зондирования интервал too10 секунд, то можно задать значение времени ожидания hello от 5 до 9 секунд. Если значение времени ожидания не задано, используется значение по умолчанию 9 секунд.

![Мониторинг конечных точек в диспетчере трафика](./media/traffic-manager-monitoring/endpoint-monitoring-settings.png)

**Рис. 1. Мониторинг конечных точек в диспетчере трафика**

## <a name="how-endpoint-monitoring-works"></a>Как выполняется мониторинг конечных точек

Если протокол мониторинга hello задано как HTTP или HTTPS, агент проверки диспетчера трафика hello создает конечную точку toohello запрос GET с помощью hello протокол, порт и относительный путь, указанный. Если он возвращает ответ 200-OK, тогда эта конечная точка считается работоспособной. Если ответ hello другое значение или, если отклик не получен в течение указанного периода ожидания hello, hello зондирования агент диспетчера трафика повторно пытается параметр допустимое число сбоев toohello (повторно пытается выполняются, если этот параметр равен 0) в соответствии с . Если hello число последовательных сбоев превышает допустимое количество сбоев приветствия, этой конечной точки будет отмечен как неработоспособный. 

Если hello мониторинга протокола TCP, hello диспетчера трафика проверки агент инициирует запрос подключения TCP, через указанный порт hello. Если конечная точка hello отвечает toohello запроса с соединением hello tooestablish ответа, что проверка работоспособности помечается как успешно завершенного и проверки агента диспетчера трафика hello сбрасывает hello TCP-соединение. Если ответ hello другое значение или если отклик не получен в течение периода ожидания hello указана, hello зондирования агент диспетчера трафика повторно пытается параметр допустимое число сбоев toohello (повторно пытается производится, если этот параметр равен 0) в соответствии с. Если hello число последовательных сбоев превышает допустимое количество сбоев приветствия, эту конечную точку помечается неработоспособен.

Во всех случаях диспетчер трафика проверяет из нескольких мест и определение hello последовательный сбой происходит в каждом регионе. Это также означает, что конечные точки получают пробы работоспособности из диспетчера трафика с частотой выше, чем hello параметра, который используется для проверки интервала.

>[!NOTE]
>Для протоколов HTTP и HTTPS, протокол мониторинга чаще всего выполняются на стороне конечной точки hello — tooimplement настраиваемой страницы в приложении - например, /health.aspx. Используя этот путь для мониторинга, можно выполнить проверки для конкретного приложения, такие как проверка счетчиков производительности или проверка доступности базы данных. Страница приветствия на основании этих пользовательских проверок, и возвращает соответствующий код состояния HTTP.

Все конечные точки в профиле диспетчера трафика имеют общие параметры мониторинга. Если вам требуется toouse разные параметры мониторинга для различных конечных точках, можно создать [вложенных профилей диспетчера трафика](traffic-manager-nested-profiles.md#example-5-per-endpoint-monitoring-settings).

## <a name="endpoint-and-profile-status"></a>Состояние конечной точки и профиля

Можно включать и отключать профили и конечные точки диспетчера трафика. Однако изменение состояния конечной точки также может произойти в результате автоматической настройки и процессов диспетчера трафика.

### <a name="endpoint-status"></a>Состояние конечной точки

Можно включить или отключить определенную конечную точку. Hello базовой службы, которая все еще может быть работоспособности, не влияет. Изменение элементов управления состояние конечной точки hello hello доступности конечной точки hello в hello профиля диспетчера трафика. При отключении состояние конечной точки диспетчера трафика не проверяет его работоспособность и hello конечной точки не включается в ответ DNS.

### <a name="profile-status"></a>Состояние профиля

Состояние профиля приветствия можно включить или отключить конфигурацию. Пока состояние конечной точки может повлиять на одну конечную точку, состояние профиля влияет на весь профиль hello, включая все конечные точки. При отключении профиля hello конечные точки не проверяются на работоспособность и конечные точки не включены в ответ DNS. [NXDOMAIN](https://tools.ietf.org/html/rfc2308) возвращается код ответа для запроса DNS hello.

### <a name="endpoint-monitor-status"></a>Отслеживаемое состояние конечной точки

Наблюдаемое состояние конечной точки является значением созданный диспетчера трафика, которое показывает состояние hello hello конечной точки. Этот параметр нельзя изменить вручную. наблюдаемое состояние конечной точки Hello представляет собой сочетание отслеживание конечных результатов hello и hello состояние конечной точки. Возможные значения Hello наблюдаемое состояние конечной точки показаны в следующей таблице hello:

| Состояние профиля | Состояние конечной точки | Отслеживаемое состояние конечной точки | Примечания |
| --- | --- | --- | --- |
| Отключено |Включено |Неактивно |Hello профиль был отключен. Состояние конечной точки hello включен, но состояние профиля hello (выключена) имеет приоритет. Конечные точки в отключенных профилях не отслеживаются. Код ответа NXDOMAIN возвращается для hello DNS-запрос. |
| &lt;любой&gt; |Отключено |Отключено |Hello конечная точка отключена. Отключенные конечные точки не отслеживаются. Конечная точка Hello не включается в ответы DNS, таким образом, он не принимает трафика. |
| Включено |Включено |В сети |Hello конечная точка отслеживается и находится в работоспособном состоянии. Она включается в ответы DNS и может получать трафик. |
| Включено |Включено |Деградация |Проверки работоспособности мониторинга конечной точки завершаются ошибкой. Конечная точка Hello не включается в ответы DNS и не принимает трафика. <br>Toothis исключение — Если снижение работоспособности всех конечных точек, в этом случае все они считаются toobe, возвращаемых в ответ на запрос hello).</br>|
| Включено |Включено |Проверка конечной точки |Hello конечная точка отслеживается, но еще не были получены результаты hello hello первой проверки. «Checkingendpoint» — это временное состояние, которое обычно происходит сразу после добавления или включение конечной точки в профиле hello. Конечная точка в таком состоянии включается в ответы DNS и может получать трафик. |
| Включено |Включено |Остановлено |Облачные службы или веб-приложение Hello, hello конечной точки toois не запущена. Проверьте hello облачной службы или веб-приложения параметры. Это также может произойти, если конечная точка hello объекта введите вложенных конечной точки и hello дочернем профиле отключена или подписка неактивна. <br>Конечная точка в остановленном состоянии не отслеживается. Она не включается в ответы DNS и поэтому не получает трафик. Toothis исключение — Если снижение работоспособности всех конечных точек, в этом случае все они будут считаться toobe, возвращаемых в ответ на запрос hello.</br>|

Дополнительные сведения о вычислении отслеживаемого состояния конечной точки для вложенных конечных точек см. в статье [Вложенные профили диспетчера трафика](traffic-manager-nested-profiles.md).

### <a name="profile-monitor-status"></a>Состояние монитора профиля

состояние монитора Hello профиля представляет собой сочетание состояние профиля настроен hello и значения состояния монитора hello конечной точки для всех конечных точек. Hello возможные значения описаны в следующей таблице hello:

| Состояние профиля (согласно настройкам) | Отслеживаемое состояние конечной точки | Состояние монитора профиля | Примечания |
| --- | --- | --- | --- |
| Отключено |&lt;любой&gt; или профиль без определенных конечных точек. |Отключено |Hello профиль был отключен. |
| Включено |Снижается Hello состояние по крайней мере одной конечной точки. |Деградация |Просмотрите hello отдельной конечной точки состояние значения toodetermine какие конечные точки требуют дополнительной настройки. |
| Включено |состояние Hello по крайней мере одной конечной точки — Online. Отсутствуют конечные точки в состоянии пониженной функциональности. |В сети |Hello служба принимает трафик. Никаких действий от пользователя не требуется. |
| Включено |состояние Hello по крайней мере одной конечной точки — CheckingEndpoint. Нет конечных точек, находящихся в сети или в состоянии пониженной функциональности. |Проверка конечных точек |Это переходное состояние возникает при создании или включении профиля. Hello исправности конечной точки проверяется hello первый раз. |
| Включено |Hello состояния всех конечных точек в профиле hello остановлена или отключена, или hello профиль без определенных конечных точек. |Неактивно |Нет конечных точек, активной, но по-прежнему включенный профиль hello. |

## <a name="endpoint-failover-and-recovery"></a>Отработка отказа и восстановление конечной точки

Диспетчер трафика периодически проверяет работоспособность всех конечных точках, включая конечные точки неработоспособности hello. Он обнаруживает, когда конечная точка восстановила работоспособность, и возвращает ее в работу.

Конечная точка — неработоспособное при возникновении hello следующие события:
- Если hello мониторинга протокол HTTP или HTTPS:
    - получен ответ, отличный от 200 (включая различные коды 2xx или перенаправление 301/302).
- Если hello мониторинга протокола TCP: 
    - Ответ отличного от ACK или SYN ACK получено в запросе SYNC toohello ответа, отправленные tooattempt диспетчера трафика установление соединения.
- Превышено время ожидания. 
- Любые другие соединения проблема, приведшая к hello конечная точка не доступен.

Дополнительную информацию об устранении неполадок, вызвавших сбой при проверке, см. в разделе [Устранение неполадок с состоянием пониженной функциональности в диспетчере трафика Azure](traffic-manager-troubleshooting-degraded.md). 

Hello следующую временную шкалу на рис. 2 является подробное описание hello, наблюдение за процессом конечной точки диспетчера трафика с hello следующие параметры: мониторинга протокола HTTP, интервал проверки составляет 30 секунд, количество сбоев отклонения равно 3, время ожидания равен 10 секундам и DNS TTL — 30 секунд.

![Последовательность действий при отработке отказа и восстановлении после сбоя конечной точки диспетчера трафика](./media/traffic-manager-monitoring/timeline.png)

**Рис. 2. Последовательность восстановления и отработки отказа конечной точки диспетчера трафика**

1. **GET**. Для каждой конечной точки hello система мониторинга диспетчера трафика выполняет запрос GET hello пути, указанному в hello параметры мониторинга.
2. **200 ОК**. Hello, система мониторинга ожидает сообщение HTTP 200 OK toobe, возвращаются в течение 10 секунд. Получив этот ответ, он распознает, что hello служба доступна.
3. **30 секунд между проверками**. Проверка работоспособности конечной точки Hello повторяется каждые 30 секунд.
4. **Служба недоступна**. Hello служба становится недоступной. Диспетчер трафика это неизвестно до следующей проверки работоспособности hello.
5. **Мониторинг путь hello tooaccess попыток**. Привет, система мониторинга выполняет запрос GET, но не получает ответ в течение периода ожидания hello 10 секунд (Кроме того, отличный от 200 может быть получен ответ). Затем выполняется еще три попытки с интервалом в 30 секунд. При успешном выполнении одного из попыток hello hello число попыток сбрасывается.
6. **Задать состояние tooDegraded**. После четырех неудачных попыток подряд система мониторинга hello помечает состояние hello недоступен конечной точки как деградация.
7. **Трафик — конечные точки перенаправленных tooother**. Hello диспетчера трафика DNS-серверами обновляются и диспетчера трафика больше не возвращает конечную точку hello в ответ tooDNS запросах. Новые подключения, направленные tooother, доступных конечных точек. Однако рекурсивные DNS-серверы и DNS-клиенты могут по-прежнему содержать в кэше предыдущие ответы DNS с этой конечной точкой. Клиенты будут конечной точки hello toouse до истечения срока действия кэша DNS hello. Как истекает hello кэш DNS, клиенты создавать новые запросы DNS и расширенный toodifferent конечных точек. длительность кэширования Hello контролируются параметром TTL hello в hello профиля диспетчера трафика, например, в течение 30 секунд.
8. **Проверки работоспособности продолжаются**. Диспетчер трафика продолжается работоспособности hello toocheck hello конечной точки, пока она находится в состоянии Деградация. Диспетчер трафика определяет, когда конечная точка hello возвращает toohealth.
9. **Служба возвращается в сеть**. Hello служба становится доступной. Конечная точка Hello сохраняет состояние Деградация в диспетчере трафика до hello, система мониторинга выполняет проверку работоспособности Далее.
10. **Возобновляет трафика tooservice**. Диспетчер трафика отправляет запрос GET и получает ответ о состоянии "200 OK". Hello служба возвратила tooa работоспособное состояние. серверы имен диспетчера трафика Hello обновляются, и они начинают toohand out hello службы DNS-имени в ответов DNS. Трафик возвращает toohello конечной точки, как срок действия кэшированных ответов DNS, которые возвращают другие конечные точки, и как существующие подключения прерываются tooother конечных точек.

    > [!NOTE]
    > Так как диспетчер трафика работает на уровне DNS hello, не может повлиять на существующую конечную точку соединения tooany. Если он направляет трафик между конечными точками (или путем настройки профиля измененные или во время отработки отказа или восстановления размещения), диспетчер трафика направляет новые конечные точки tooavailable подключений. Тем не менее другие конечные точки может по-прежнему tooreceive трафика через существующие соединения до эти сеансы прерываются. tooenable toodrain трафика из существующих подключений, приложений следует ограничить hello длительность сеанса, использовать с каждой конечной точки.

## <a name="traffic-routing-methods"></a>Методы маршрутизации трафика

Конечная точка имеет состояние Деградация, больше не возвращаются в запросах tooDNS ответа. Вместо этого выбирается и возвращается альтернативная конечная точка. Метод маршрутизации трафика Hello, настроенных в профиле hello определяет, как выбирается альтернативный hello конечной точки.

* **Приоритет**. Конечные точки формируют список по приоритетам. Hello первой доступной конечной точки в список hello всегда возвращается. Если состояние конечной точки снижается, возвращается hello следующую доступную конечных точек.
* **Взвешивание**. Любой доступной конечной точки выбирается случайным образом в зависимости от их назначенного веса и hello весов hello других доступных конечных точек.
* **Производительность**. возвращается Hello конечной точки ближайший toohello конечного пользователя. Недоступность этой конечной точкой, конечной точки выбирается случайным образом из всех hello других доступных конечных точек. Выбор конечной точки случайных помогает избежать каскадных ошибок, которые могут возникнуть при перегрузке ближайшей конечной точки hello. С помощью [вложенных профилей диспетчера трафика](traffic-manager-nested-profiles.md#example-4-controlling-performance-traffic-routing-between-multiple-endpoints-in-the-same-region) можно настроить альтернативные планы отработки отказа для повышения производительности маршрутизации.
* **Географический**. Конечная точка Hello сопоставлен tooserve hello географическое расположение в зависимости от hello запрос вернул IP-адреса. В случае недоступности этой конечной точки другой конечной точкой не будет выбранных toofailover, так как географическое расположение может быть сопоставленный только конечная точка tooone в профиле (Дополнительные сведения находятся в hello [часто задаваемые вопросы о](traffic-manager-FAQs.md#traffic-manager-geographic-traffic-routing-method)). Рекомендуется, при использовании географического маршрутизации мы рекомендуем toouse вложенных профилей диспетчера трафика с более чем одной конечной точкой как конечные точки hello hello профиля.

Дополнительные сведения см. в разделе [Методы маршрутизации трафика диспетчером трафика](traffic-manager-routing-methods.md).

> [!NOTE]
> Одно исключение toonormal маршрутизации трафика происходит, когда все подходящие конечные точки со статусом ограниченной. Диспетчер трафика делает попытку «максимум усилий» и *будет считать, что все конечные точки состояние Деградация hello фактически находятся в оперативном состоянии*. Такое поведение является более предпочтительным, чем toohello вместо того, что было бы toonot возвращают любой конечной точке в hello ответ DNS. Отключенные и остановленные конечные точки не отслеживаются, таким образом, они не считаются допустимыми для трафика.
>
> Это условие обычно вызвана неправильной конфигурации службы hello, такие как:
>
> * Список управления доступом [ACL] Блокирование проверки работоспособности hello диспетчера трафика.
> * Неправильная конфигурация hello мониторинга порта или протокол в hello профиль диспетчера трафика.
>
> Hello вследствие такого поведения —, если проверку на работоспособность диспетчера трафика не настроен правильно, она может оказаться hello трафика, как будто Маршрутизация диспетчера трафика *—* работает должным образом. Кроме того, в этом случае при сбое конечной точки не происходит отработка отказа, что негативно влияет на общую доступность приложения. Это важные toocheck, что профиль hello показывает состояние не состояние Деградация. Состояние указывает, hello диспетчера трафика работоспособности проверяет работают надлежащим образом.

Дополнительную информацию об устранении неполадок, вызвавших сбой при проверке работоспособности, см. в разделе [Устранение неполадок с состоянием пониженной функциональности в диспетчере трафика Azure](traffic-manager-troubleshooting-degraded.md).



## <a name="next-steps"></a>Дальнейшие действия

Узнайте о том, [как работает диспетчер трафика](traffic-manager-how-traffic-manager-works.md)

Дополнительные сведения о hello [методов маршрутизации трафика](traffic-manager-routing-methods.md) поддерживается диспетчером трафика

Узнайте, каким образом слишком[создать профиль диспетчера трафика](traffic-manager-manage-profiles.md)

[устранении неполадок с состоянием пониженной функциональности](traffic-manager-troubleshooting-degraded.md) конечной точки диспетчера трафика.
