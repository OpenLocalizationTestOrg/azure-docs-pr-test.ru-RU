---
title: "Мониторинг конечных точек диспетчера трафика Azure | Документация Майкрософт"
description: "Из этой статьи вы узнаете, каким образом благодаря мониторингу и автоматической отработке отказа конечных точек в диспетчере трафика пользователи Azure могут развертывать высокодоступные приложения."
services: traffic-manager
documentationcenter: 
author: kumudd
manager: timlt
editor: 
ms.assetid: fff25ac3-d13a-4af9-8916-7c72e3d64bc7
ms.service: traffic-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 06/22/2017
ms.author: kumud
ms.openlocfilehash: 5ce000814f2f5899a7338fdefb39c4873c006b1d
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="traffic-manager-endpoint-monitoring"></a><span data-ttu-id="41d9f-103">Мониторинг конечных точек в диспетчере трафика</span><span class="sxs-lookup"><span data-stu-id="41d9f-103">Traffic Manager endpoint monitoring</span></span>

<span data-ttu-id="41d9f-104">Диспетчер трафика Azure включает в себя встроенные возможности мониторинга и автоматическую отработку отказа конечных точек.</span><span class="sxs-lookup"><span data-stu-id="41d9f-104">Azure Traffic Manager includes built-in endpoint monitoring and automatic endpoint failover.</span></span> <span data-ttu-id="41d9f-105">Благодаря этому можно получать высокодоступные приложения, которые устойчивы к сбоям конечной точки, в том числе к сбоям региона Azure.</span><span class="sxs-lookup"><span data-stu-id="41d9f-105">This feature helps you deliver high-availability applications that are resilient to endpoint failure, including Azure region failures.</span></span>

## <a name="configure-endpoint-monitoring"></a><span data-ttu-id="41d9f-106">Настройка мониторинга конечных точек</span><span class="sxs-lookup"><span data-stu-id="41d9f-106">Configure endpoint monitoring</span></span>

<span data-ttu-id="41d9f-107">Чтобы настроить мониторинг конечных точек, необходимо указать следующие параметры в профиле диспетчера трафика.</span><span class="sxs-lookup"><span data-stu-id="41d9f-107">To configure endpoint monitoring, you must specify the following settings on your Traffic Manager profile:</span></span>

* <span data-ttu-id="41d9f-108">**Протокол**.</span><span class="sxs-lookup"><span data-stu-id="41d9f-108">**Protocol**.</span></span> <span data-ttu-id="41d9f-109">Выберите протокол HTTP, HTTPS или TCP, который диспетчер трафика будет использовать при проверке работоспособности конечной точки.</span><span class="sxs-lookup"><span data-stu-id="41d9f-109">Choose HTTP, HTTPS, or TCP as the protocol that Traffic Manager uses when probing your endpoint to check its health.</span></span> <span data-ttu-id="41d9f-110">Мониторинг HTTPS проверяет не действительность SSL-сертификата, а только его наличие.</span><span class="sxs-lookup"><span data-stu-id="41d9f-110">HTTPS monitoring does not verify whether your SSL certificate is valid--it only checks that the certificate is present.</span></span>
* <span data-ttu-id="41d9f-111">**Порт**.</span><span class="sxs-lookup"><span data-stu-id="41d9f-111">**Port**.</span></span> <span data-ttu-id="41d9f-112">Выберите порт, используемый для запроса.</span><span class="sxs-lookup"><span data-stu-id="41d9f-112">Choose the port used for the request.</span></span>
* <span data-ttu-id="41d9f-113">**Путь**.</span><span class="sxs-lookup"><span data-stu-id="41d9f-113">**Path**.</span></span> <span data-ttu-id="41d9f-114">Этот параметр конфигурации является допустимым только для протоколов HTTP и HTTPS, для которых требуется указание параметра пути.</span><span class="sxs-lookup"><span data-stu-id="41d9f-114">This configuration setting is valid only for the HTTP and HTTPS protocols, for which specifying the path setting is required.</span></span> <span data-ttu-id="41d9f-115">Если указать этот параметр для протокола мониторинга TCP, вы получите ошибку.</span><span class="sxs-lookup"><span data-stu-id="41d9f-115">Providing this setting for the TCP monitoring protocol results in an error.</span></span> <span data-ttu-id="41d9f-116">Для протокола TCP введите относительный путь и имя веб-страницы или файла, к которому обращается средство мониторинга.</span><span class="sxs-lookup"><span data-stu-id="41d9f-116">For TCP protocol, give the relative path and the name of the webpage or the file that the monitoring accesses.</span></span> <span data-ttu-id="41d9f-117">В качестве относительного пути можно указать косую черту (/).</span><span class="sxs-lookup"><span data-stu-id="41d9f-117">A forward slash (/) is a valid entry for the relative path.</span></span> <span data-ttu-id="41d9f-118">Это значение указывает, что файл находится в корневом каталоге (по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="41d9f-118">This value implies that the file is in the root directory (default).</span></span>
* <span data-ttu-id="41d9f-119">**Интервал проверки**.</span><span class="sxs-lookup"><span data-stu-id="41d9f-119">**Probing Interval**.</span></span> <span data-ttu-id="41d9f-120">Это значение указывает, как часто проверяется работоспособность конечной точки с помощью агента проверки диспетчера трафика.</span><span class="sxs-lookup"><span data-stu-id="41d9f-120">This value specifies how often an endpoint is checked for its health from a Traffic Manager probing agent.</span></span> <span data-ttu-id="41d9f-121">Вы можете указать здесь два значения: 30 секунд (обычная проверка) и 10 секунд (быстрая проверка).</span><span class="sxs-lookup"><span data-stu-id="41d9f-121">You can specify two values here: 30 seconds (normal probing) and 10 seconds (fast probing).</span></span> <span data-ttu-id="41d9f-122">Если не указать значения, профиль задаст значение по умолчанию 30 секунд.</span><span class="sxs-lookup"><span data-stu-id="41d9f-122">If no values are provided, the profile sets to a default value of 30 seconds.</span></span> <span data-ttu-id="41d9f-123">Посетите страницу [цен диспетчера трафика](https://azure.microsoft.com/pricing/details/traffic-manager), чтобы узнать больше о ценах на быструю проверку.</span><span class="sxs-lookup"><span data-stu-id="41d9f-123">Visit the [Traffic Manager Pricing](https://azure.microsoft.com/pricing/details/traffic-manager) page to learn more about fast probing pricing.</span></span>
* <span data-ttu-id="41d9f-124">**Допустимое число сбоев**.</span><span class="sxs-lookup"><span data-stu-id="41d9f-124">**Tolerated Number of Failures**.</span></span> <span data-ttu-id="41d9f-125">Это значение указывает количество сбоев, которое допускает агент проверки диспетчера трафика. По достижении этого количества конечная точка будет помечена как неработоспособная.</span><span class="sxs-lookup"><span data-stu-id="41d9f-125">This value specifies how many failures a Traffic Manager probing agent tolerates before marking that endpoint as unhealthy.</span></span> <span data-ttu-id="41d9f-126">Значение должно быть в диапазоне от 0 до 9.</span><span class="sxs-lookup"><span data-stu-id="41d9f-126">Its value can range between 0 and 9.</span></span> <span data-ttu-id="41d9f-127">Значение 0 означает, что при первом сбое конечная точка будет помечена как неработоспособная.</span><span class="sxs-lookup"><span data-stu-id="41d9f-127">A value of 0 means a single monitoring failure can cause that endpoint to be marked as unhealthy.</span></span> <span data-ttu-id="41d9f-128">Если значение не задано, используется значение по умолчанию 3.</span><span class="sxs-lookup"><span data-stu-id="41d9f-128">If no value is specified, it uses the default value of 3.</span></span>
* <span data-ttu-id="41d9f-129">**Время ожидания мониторинга**.</span><span class="sxs-lookup"><span data-stu-id="41d9f-129">**Monitoring Timeout**.</span></span> <span data-ttu-id="41d9f-130">Это свойство указывает количество времени ожидания (когда проба проверки работоспособности отправлена в конечную точку), по достижении которого диспетчер трафика определяет, что проверка завершилась сбоем.</span><span class="sxs-lookup"><span data-stu-id="41d9f-130">This property specifies the amount of time the Traffic Manager probing agent should wait before considering that check a failure when a health check probe is sent to the endpoint.</span></span> <span data-ttu-id="41d9f-131">Если для интервала проверки задано значение 30 секунд, тогда вы можете задать значение времени ожидания 5–10 секунд.</span><span class="sxs-lookup"><span data-stu-id="41d9f-131">If the Probing Interval is set to 30 seconds, then you can set the Timeout value between 5 and 10 seconds.</span></span> <span data-ttu-id="41d9f-132">Если значение не задано, используется значение по умолчанию 10 секунд.</span><span class="sxs-lookup"><span data-stu-id="41d9f-132">If no value is specified, it uses a default value of 10 seconds.</span></span> <span data-ttu-id="41d9f-133">Если для интервала проверки задано значение 10 секунд, тогда вы можете задать значение времени ожидания 5–9 секунд.</span><span class="sxs-lookup"><span data-stu-id="41d9f-133">If the Probing Interval is set to 10 seconds, then you can set the Timeout value between 5 and 9 seconds.</span></span> <span data-ttu-id="41d9f-134">Если значение времени ожидания не задано, используется значение по умолчанию 9 секунд.</span><span class="sxs-lookup"><span data-stu-id="41d9f-134">If no Timeout value is specified, it uses a default value of 9 seconds.</span></span>

![Мониторинг конечных точек в диспетчере трафика](./media/traffic-manager-monitoring/endpoint-monitoring-settings.png)

<span data-ttu-id="41d9f-136">**Рис. 1. Мониторинг конечных точек в диспетчере трафика**</span><span class="sxs-lookup"><span data-stu-id="41d9f-136">**Figure 1:  Traffic Manager endpoint monitoring**</span></span>

## <a name="how-endpoint-monitoring-works"></a><span data-ttu-id="41d9f-137">Как выполняется мониторинг конечных точек</span><span class="sxs-lookup"><span data-stu-id="41d9f-137">How endpoint monitoring works</span></span>

<span data-ttu-id="41d9f-138">Если в качестве протокола мониторинга используется протокол HTTP или HTTPS, агент проверки диспетчера трафика выполняет запрос GET в конечную точку, используя указанные протокол, порт и относительный путь.</span><span class="sxs-lookup"><span data-stu-id="41d9f-138">If the monitoring protocol is set as HTTP or HTTPS, the Traffic Manager probing agent makes a GET request to the endpoint using the protocol, port, and relative path given.</span></span> <span data-ttu-id="41d9f-139">Если он возвращает ответ 200-OK, тогда эта конечная точка считается работоспособной.</span><span class="sxs-lookup"><span data-stu-id="41d9f-139">If it gets back a 200-OK response, then that endpoint is considered healthy.</span></span> <span data-ttu-id="41d9f-140">Если ответ имеет другое значение или отсутствует в течение указанного периода ожидания, тогда агент проверки диспетчера трафика повторяет попытки согласно параметру "Допустимое число сбоев" (если для этого параметра задано значение 0, повторная попытка не выполняется).</span><span class="sxs-lookup"><span data-stu-id="41d9f-140">If the response is a different value, or, if no response is received within the timeout period specified, then the Traffic Manager probing agent re-attempts according to the Tolerated Number of Failures setting (no re-attempts are done if this setting is 0).</span></span> <span data-ttu-id="41d9f-141">Если число последовательных сбоев превышает значение, указанное в параметре допустимого числа сбоев, тогда эта конечная точка помечается как неработоспособная.</span><span class="sxs-lookup"><span data-stu-id="41d9f-141">If the number of consecutive failures is higher than the Tolerated Number of Failures setting, then that endpoint is marked as unhealthy.</span></span> 

<span data-ttu-id="41d9f-142">Если протоколом мониторинга является протокол TCP, агент проверки диспетчера трафика запускает запрос на подключение TCP, используя указанный порт.</span><span class="sxs-lookup"><span data-stu-id="41d9f-142">If the monitoring protocol is TCP, the Traffic Manager probing agent initiates a TCP connection request using the port specified.</span></span> <span data-ttu-id="41d9f-143">Если конечная точка отвечает на этот запрос ответом на установку подключения, проверка работоспособности помечается как успешно завершенная и агент проверки диспетчера трафика сбрасывает подключение TCP.</span><span class="sxs-lookup"><span data-stu-id="41d9f-143">If the endpoint responds to the request with a response to establish the connection, that health check is marked as a success and the Traffic Manager probing agent resets the TCP connection.</span></span> <span data-ttu-id="41d9f-144">Если ответ имеет другое значение или отсутствует в течение указанного периода ожидания, тогда агент проверки диспетчера трафика повторяет попытки согласно параметру "Допустимое число сбоев" (если для этого параметра задано значение 0, повторная попытка не выполняется).</span><span class="sxs-lookup"><span data-stu-id="41d9f-144">If the response is a different value, or if no response is received within the timeout period specified, the Traffic Manager probing agent re-attempts according to the Tolerated Number of Failures setting (no re-attempts are made if this setting is 0).</span></span> <span data-ttu-id="41d9f-145">Если число последовательных сбоев превышает значение, указанное в параметре допустимого числа сбоев, тогда эта конечная точка помечается как неработоспособная.</span><span class="sxs-lookup"><span data-stu-id="41d9f-145">If the number of consecutive failures is higher than the Tolerated Number of Failures setting, then that endpoint is marked unhealthy.</span></span>

<span data-ttu-id="41d9f-146">Во всех случаях диспетчер трафика выполняет проверку из нескольких расположений, а последовательное определение сбоев предусмотрено для каждого региона.</span><span class="sxs-lookup"><span data-stu-id="41d9f-146">In all cases, Traffic Manager probes from multiple locations and the consecutive failure determination happens within each region.</span></span> <span data-ttu-id="41d9f-147">Это также означает, что проверка работоспособности конечных точек диспетчером трафика выполняется с большей частотой, чем задано параметром, используемым для интервала проверки.</span><span class="sxs-lookup"><span data-stu-id="41d9f-147">This also means that endpoints are receiving health probes from Traffic Manager with a higher frequency than the setting used for Probing Interval.</span></span>

>[!NOTE]
><span data-ttu-id="41d9f-148">На стороне конечной точки для протоколов мониторинга HTTP и HTTPS распространенной практикой является реализация пользовательской страницы в приложении, например /health.aspx.</span><span class="sxs-lookup"><span data-stu-id="41d9f-148">For HTTP or HTTPS monitoring protocol, a common practice on the endpoint side is to implement a custom page within your application - for example, /health.aspx.</span></span> <span data-ttu-id="41d9f-149">Используя этот путь для мониторинга, можно выполнить проверки для конкретного приложения, такие как проверка счетчиков производительности или проверка доступности базы данных.</span><span class="sxs-lookup"><span data-stu-id="41d9f-149">Using this path for monitoring, you can perform application-specific checks, such as checking performance counters or verifying database availability.</span></span> <span data-ttu-id="41d9f-150">На основании этих пользовательских проверок страница возвращает соответствующий код состояния HTTP.</span><span class="sxs-lookup"><span data-stu-id="41d9f-150">Based on these custom checks, the page returns an appropriate HTTP status code.</span></span>

<span data-ttu-id="41d9f-151">Все конечные точки в профиле диспетчера трафика имеют общие параметры мониторинга.</span><span class="sxs-lookup"><span data-stu-id="41d9f-151">All endpoints in a Traffic Manager profile share monitoring settings.</span></span> <span data-ttu-id="41d9f-152">Если необходимо использовать разные параметры мониторинга для разных конечных точек, можно создать [вложенные профили диспетчера трафика](traffic-manager-nested-profiles.md#example-5-per-endpoint-monitoring-settings).</span><span class="sxs-lookup"><span data-stu-id="41d9f-152">If you need to use different monitoring settings for different endpoints, you can create [nested Traffic Manager profiles](traffic-manager-nested-profiles.md#example-5-per-endpoint-monitoring-settings).</span></span>

## <a name="endpoint-and-profile-status"></a><span data-ttu-id="41d9f-153">Состояние конечной точки и профиля</span><span class="sxs-lookup"><span data-stu-id="41d9f-153">Endpoint and profile status</span></span>

<span data-ttu-id="41d9f-154">Можно включать и отключать профили и конечные точки диспетчера трафика.</span><span class="sxs-lookup"><span data-stu-id="41d9f-154">You can enable and disable Traffic Manager profiles and endpoints.</span></span> <span data-ttu-id="41d9f-155">Однако изменение состояния конечной точки также может произойти в результате автоматической настройки и процессов диспетчера трафика.</span><span class="sxs-lookup"><span data-stu-id="41d9f-155">However, a change in endpoint status also might occur as a result of Traffic Manager automated settings and processes.</span></span>

### <a name="endpoint-status"></a><span data-ttu-id="41d9f-156">Состояние конечной точки</span><span class="sxs-lookup"><span data-stu-id="41d9f-156">Endpoint status</span></span>

<span data-ttu-id="41d9f-157">Можно включить или отключить определенную конечную точку.</span><span class="sxs-lookup"><span data-stu-id="41d9f-157">You can enable or disable a specific endpoint.</span></span> <span data-ttu-id="41d9f-158">Это не повлияет на базовую службу, которая может остаться работоспособной.</span><span class="sxs-lookup"><span data-stu-id="41d9f-158">The underlying service, which might still be healthy, is unaffected.</span></span> <span data-ttu-id="41d9f-159">Изменение состояния конечной точки определяет ее доступность в профиле диспетчера трафика.</span><span class="sxs-lookup"><span data-stu-id="41d9f-159">Changing the endpoint status controls the availability of the endpoint in the Traffic Manager profile.</span></span> <span data-ttu-id="41d9f-160">Если конечная точка отключена, то диспетчер трафика не проверяет ее работоспособность и эта конечная точка не включается в ответ DNS.</span><span class="sxs-lookup"><span data-stu-id="41d9f-160">When an endpoint status is disabled, Traffic Manager does not check its health and the endpoint is not included in a DNS response.</span></span>

### <a name="profile-status"></a><span data-ttu-id="41d9f-161">Состояние профиля</span><span class="sxs-lookup"><span data-stu-id="41d9f-161">Profile status</span></span>

<span data-ttu-id="41d9f-162">С помощью параметра "состояние профиля" можно включить или отключить определенный профиль.</span><span class="sxs-lookup"><span data-stu-id="41d9f-162">Using the profile status setting, you can enable or disable a specific profile.</span></span> <span data-ttu-id="41d9f-163">Если состояние конечной точки влияет на одну конечную точку, то состояние профиля влияет на весь профиль, включая все конечные точки.</span><span class="sxs-lookup"><span data-stu-id="41d9f-163">While endpoint status affects a single endpoint, profile status affects the entire profile, including all endpoints.</span></span> <span data-ttu-id="41d9f-164">При отключении профиля конечные точки не проверяются на работоспособность и не включаются в ответ DNS.</span><span class="sxs-lookup"><span data-stu-id="41d9f-164">When you disable a profile, the endpoints are not checked for health and no endpoints are included in a DNS response.</span></span> <span data-ttu-id="41d9f-165">Для запроса DNS возвращается код ответа [NXDOMAIN](https://tools.ietf.org/html/rfc2308).</span><span class="sxs-lookup"><span data-stu-id="41d9f-165">An [NXDOMAIN](https://tools.ietf.org/html/rfc2308) response code is returned for the DNS query.</span></span>

### <a name="endpoint-monitor-status"></a><span data-ttu-id="41d9f-166">Отслеживаемое состояние конечной точки</span><span class="sxs-lookup"><span data-stu-id="41d9f-166">Endpoint monitor status</span></span>

<span data-ttu-id="41d9f-167">Отслеживаемое состояние конечной точки — это параметр, создаваемый диспетчером трафика, который отражает состояние конечной точки.</span><span class="sxs-lookup"><span data-stu-id="41d9f-167">Endpoint monitor status is a Traffic Manager-generated value that shows the status of the endpoint.</span></span> <span data-ttu-id="41d9f-168">Этот параметр нельзя изменить вручную.</span><span class="sxs-lookup"><span data-stu-id="41d9f-168">You cannot change this setting manually.</span></span> <span data-ttu-id="41d9f-169">Отслеживаемое состояние конечной точки представляет собой сочетание отслеживания и настроенного состояния конечной точки.</span><span class="sxs-lookup"><span data-stu-id="41d9f-169">The endpoint monitor status is a combination of the results of endpoint monitoring and the configured endpoint status.</span></span> <span data-ttu-id="41d9f-170">В следующей таблице показаны возможные значения отслеживаемого состояния конечной точки:</span><span class="sxs-lookup"><span data-stu-id="41d9f-170">The possible values of endpoint monitor status are shown in the following table:</span></span>

| <span data-ttu-id="41d9f-171">Состояние профиля</span><span class="sxs-lookup"><span data-stu-id="41d9f-171">Profile status</span></span> | <span data-ttu-id="41d9f-172">Состояние конечной точки</span><span class="sxs-lookup"><span data-stu-id="41d9f-172">Endpoint status</span></span> | <span data-ttu-id="41d9f-173">Отслеживаемое состояние конечной точки</span><span class="sxs-lookup"><span data-stu-id="41d9f-173">Endpoint monitor status</span></span> | <span data-ttu-id="41d9f-174">Примечания</span><span class="sxs-lookup"><span data-stu-id="41d9f-174">Notes</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="41d9f-175">Отключено</span><span class="sxs-lookup"><span data-stu-id="41d9f-175">Disabled</span></span> |<span data-ttu-id="41d9f-176">Включено</span><span class="sxs-lookup"><span data-stu-id="41d9f-176">Enabled</span></span> |<span data-ttu-id="41d9f-177">Неактивно</span><span class="sxs-lookup"><span data-stu-id="41d9f-177">Inactive</span></span> |<span data-ttu-id="41d9f-178">Профиль отключен.</span><span class="sxs-lookup"><span data-stu-id="41d9f-178">The profile has been disabled.</span></span> <span data-ttu-id="41d9f-179">Хотя конечная точка остается в состоянии "Включено", состояние профиля ("Отключено") имеет более высокий приоритет.</span><span class="sxs-lookup"><span data-stu-id="41d9f-179">Although the endpoint status is Enabled, the profile status (Disabled) takes precedence.</span></span> <span data-ttu-id="41d9f-180">Конечные точки в отключенных профилях не отслеживаются.</span><span class="sxs-lookup"><span data-stu-id="41d9f-180">Endpoints in disabled profiles are not monitored.</span></span> <span data-ttu-id="41d9f-181">Для запроса DNS возвращается код ответа NXDOMAIN.</span><span class="sxs-lookup"><span data-stu-id="41d9f-181">An NXDOMAIN response code is returned for the DNS query.</span></span> |
| <span data-ttu-id="41d9f-182">&lt;любой&gt;</span><span class="sxs-lookup"><span data-stu-id="41d9f-182">&lt;any&gt;</span></span> |<span data-ttu-id="41d9f-183">Отключено</span><span class="sxs-lookup"><span data-stu-id="41d9f-183">Disabled</span></span> |<span data-ttu-id="41d9f-184">Отключено</span><span class="sxs-lookup"><span data-stu-id="41d9f-184">Disabled</span></span> |<span data-ttu-id="41d9f-185">Конечная точка отключена.</span><span class="sxs-lookup"><span data-stu-id="41d9f-185">The endpoint has been disabled.</span></span> <span data-ttu-id="41d9f-186">Отключенные конечные точки не отслеживаются.</span><span class="sxs-lookup"><span data-stu-id="41d9f-186">Disabled endpoints are not monitored.</span></span> <span data-ttu-id="41d9f-187">Эта конечная точка не включается в ответы DNS и поэтому не получает трафик.</span><span class="sxs-lookup"><span data-stu-id="41d9f-187">The endpoint is not included in DNS responses, therefore, it does not receive traffic.</span></span> |
| <span data-ttu-id="41d9f-188">Включено</span><span class="sxs-lookup"><span data-stu-id="41d9f-188">Enabled</span></span> |<span data-ttu-id="41d9f-189">Включено</span><span class="sxs-lookup"><span data-stu-id="41d9f-189">Enabled</span></span> |<span data-ttu-id="41d9f-190">В сети</span><span class="sxs-lookup"><span data-stu-id="41d9f-190">Online</span></span> |<span data-ttu-id="41d9f-191">Конечная точка отслеживается и работоспособна.</span><span class="sxs-lookup"><span data-stu-id="41d9f-191">The endpoint is monitored and is healthy.</span></span> <span data-ttu-id="41d9f-192">Она включается в ответы DNS и может получать трафик.</span><span class="sxs-lookup"><span data-stu-id="41d9f-192">It is included in DNS responses and can receive traffic.</span></span> |
| <span data-ttu-id="41d9f-193">Включено</span><span class="sxs-lookup"><span data-stu-id="41d9f-193">Enabled</span></span> |<span data-ttu-id="41d9f-194">Включено</span><span class="sxs-lookup"><span data-stu-id="41d9f-194">Enabled</span></span> |<span data-ttu-id="41d9f-195">Деградация</span><span class="sxs-lookup"><span data-stu-id="41d9f-195">Degraded</span></span> |<span data-ttu-id="41d9f-196">Проверки работоспособности мониторинга конечной точки завершаются ошибкой.</span><span class="sxs-lookup"><span data-stu-id="41d9f-196">Endpoint monitoring health checks are failing.</span></span> <span data-ttu-id="41d9f-197">Эта конечная точка не включается в ответы DNS и поэтому не получает трафик.</span><span class="sxs-lookup"><span data-stu-id="41d9f-197">The endpoint is not included in DNS responses and does not receive traffic.</span></span> <br><span data-ttu-id="41d9f-198">Исключение возможно в том случае, если все конечные точки имеют "пониженную функциональность", тогда все они возвращаются в ответе на запрос.</span><span class="sxs-lookup"><span data-stu-id="41d9f-198">An exception to this is if all endpoints are degraded, in which case all of them are considered to be returned in the query response).</span></span></br>|
| <span data-ttu-id="41d9f-199">Включено</span><span class="sxs-lookup"><span data-stu-id="41d9f-199">Enabled</span></span> |<span data-ttu-id="41d9f-200">Включено</span><span class="sxs-lookup"><span data-stu-id="41d9f-200">Enabled</span></span> |<span data-ttu-id="41d9f-201">Проверка конечной точки</span><span class="sxs-lookup"><span data-stu-id="41d9f-201">CheckingEndpoint</span></span> |<span data-ttu-id="41d9f-202">Конечная точка отслеживается, но результаты первой проверки еще не получены.</span><span class="sxs-lookup"><span data-stu-id="41d9f-202">The endpoint is monitored, but the results of the first probe have not been received yet.</span></span> <span data-ttu-id="41d9f-203">CheckingEndpoint — это временное состояние, которое обычно возникает сразу же после добавления конечной точки или ее включения в профиле.</span><span class="sxs-lookup"><span data-stu-id="41d9f-203">CheckingEndpoint is a temporary state that usually occurs immediately after adding or enabling an endpoint in the profile.</span></span> <span data-ttu-id="41d9f-204">Конечная точка в таком состоянии включается в ответы DNS и может получать трафик.</span><span class="sxs-lookup"><span data-stu-id="41d9f-204">An endpoint in this state is included in DNS responses and can receive traffic.</span></span> |
| <span data-ttu-id="41d9f-205">Включено</span><span class="sxs-lookup"><span data-stu-id="41d9f-205">Enabled</span></span> |<span data-ttu-id="41d9f-206">Включено</span><span class="sxs-lookup"><span data-stu-id="41d9f-206">Enabled</span></span> |<span data-ttu-id="41d9f-207">Остановлено</span><span class="sxs-lookup"><span data-stu-id="41d9f-207">Stopped</span></span> |<span data-ttu-id="41d9f-208">Облачная служба или веб-приложение, на которое указывает конечная точка, не работает.</span><span class="sxs-lookup"><span data-stu-id="41d9f-208">The cloud service or web app that the endpoint points to is not running.</span></span> <span data-ttu-id="41d9f-209">Проверьте параметры облачной службы или веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="41d9f-209">Check the cloud service or web app settings.</span></span> <span data-ttu-id="41d9f-210">Это также возможно, если конечная точка является конечной точкой вложенного типа, а дочерний профиль отключен или неактивен.</span><span class="sxs-lookup"><span data-stu-id="41d9f-210">This can also happen if the endpoint is of type nested endpoint and the child profile is disabled or is inactive.</span></span> <br><span data-ttu-id="41d9f-211">Конечная точка в остановленном состоянии не отслеживается.</span><span class="sxs-lookup"><span data-stu-id="41d9f-211">An endpoint with a Stopped status is not monitored.</span></span> <span data-ttu-id="41d9f-212">Она не включается в ответы DNS и поэтому не получает трафик.</span><span class="sxs-lookup"><span data-stu-id="41d9f-212">It is not included in DNS responses and does not receive traffic.</span></span> <span data-ttu-id="41d9f-213">Исключение возможно в том случае, если все конечные точки имеют "пониженную функциональность", тогда все они вернутся в ответе на запрос.</span><span class="sxs-lookup"><span data-stu-id="41d9f-213">An exception to this is if all endpoints are degraded, in which case all of them will be considered to be returned in the query response.</span></span></br>|

<span data-ttu-id="41d9f-214">Дополнительные сведения о вычислении отслеживаемого состояния конечной точки для вложенных конечных точек см. в статье [Вложенные профили диспетчера трафика](traffic-manager-nested-profiles.md).</span><span class="sxs-lookup"><span data-stu-id="41d9f-214">For details about how endpoint monitor status is calculated for nested endpoints, see [nested Traffic Manager profiles](traffic-manager-nested-profiles.md).</span></span>

### <a name="profile-monitor-status"></a><span data-ttu-id="41d9f-215">Состояние монитора профиля</span><span class="sxs-lookup"><span data-stu-id="41d9f-215">Profile monitor status</span></span>

<span data-ttu-id="41d9f-216">Отслеживаемое состояние профиля — это сочетание настроенного состояния профиля и отслеживаемых состояний для всех конечных точек.</span><span class="sxs-lookup"><span data-stu-id="41d9f-216">The profile monitor status is a combination of the configured profile status and the endpoint monitor status values for all endpoints.</span></span> <span data-ttu-id="41d9f-217">В следующей таблице приведены возможные значения.</span><span class="sxs-lookup"><span data-stu-id="41d9f-217">The possible values are described in the following table:</span></span>

| <span data-ttu-id="41d9f-218">Состояние профиля (согласно настройкам)</span><span class="sxs-lookup"><span data-stu-id="41d9f-218">Profile status (as configured)</span></span> | <span data-ttu-id="41d9f-219">Отслеживаемое состояние конечной точки</span><span class="sxs-lookup"><span data-stu-id="41d9f-219">Endpoint monitor status</span></span> | <span data-ttu-id="41d9f-220">Состояние монитора профиля</span><span class="sxs-lookup"><span data-stu-id="41d9f-220">Profile monitor status</span></span> | <span data-ttu-id="41d9f-221">Примечания</span><span class="sxs-lookup"><span data-stu-id="41d9f-221">Notes</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="41d9f-222">Отключено</span><span class="sxs-lookup"><span data-stu-id="41d9f-222">Disabled</span></span> |<span data-ttu-id="41d9f-223">&lt;любой&gt; или профиль без определенных конечных точек.</span><span class="sxs-lookup"><span data-stu-id="41d9f-223">&lt;any&gt; or a profile with no defined endpoints.</span></span> |<span data-ttu-id="41d9f-224">Отключено</span><span class="sxs-lookup"><span data-stu-id="41d9f-224">Disabled</span></span> |<span data-ttu-id="41d9f-225">Профиль отключен.</span><span class="sxs-lookup"><span data-stu-id="41d9f-225">The profile has been disabled.</span></span> |
| <span data-ttu-id="41d9f-226">Включено</span><span class="sxs-lookup"><span data-stu-id="41d9f-226">Enabled</span></span> |<span data-ttu-id="41d9f-227">По крайней мере одна конечная точка находится в состоянии пониженной функциональности.</span><span class="sxs-lookup"><span data-stu-id="41d9f-227">The status of at least one endpoint is Degraded.</span></span> |<span data-ttu-id="41d9f-228">Деградация</span><span class="sxs-lookup"><span data-stu-id="41d9f-228">Degraded</span></span> |<span data-ttu-id="41d9f-229">Просмотрите значения состояния отдельных конечных точек, чтобы определить, какие конечные точки необходимо рассмотреть.</span><span class="sxs-lookup"><span data-stu-id="41d9f-229">Review the individual endpoint status values to determine which endpoints require further attention.</span></span> |
| <span data-ttu-id="41d9f-230">Включено</span><span class="sxs-lookup"><span data-stu-id="41d9f-230">Enabled</span></span> |<span data-ttu-id="41d9f-231">По крайней мере одна конечная точка находится в сети.</span><span class="sxs-lookup"><span data-stu-id="41d9f-231">The status of at least one endpoint is Online.</span></span> <span data-ttu-id="41d9f-232">Отсутствуют конечные точки в состоянии пониженной функциональности.</span><span class="sxs-lookup"><span data-stu-id="41d9f-232">No endpoints have a Degraded status.</span></span> |<span data-ttu-id="41d9f-233">В сети</span><span class="sxs-lookup"><span data-stu-id="41d9f-233">Online</span></span> |<span data-ttu-id="41d9f-234">Служба принимает трафик.</span><span class="sxs-lookup"><span data-stu-id="41d9f-234">The service is accepting traffic.</span></span> <span data-ttu-id="41d9f-235">Никаких действий от пользователя не требуется.</span><span class="sxs-lookup"><span data-stu-id="41d9f-235">No further action is required.</span></span> |
| <span data-ttu-id="41d9f-236">Включено</span><span class="sxs-lookup"><span data-stu-id="41d9f-236">Enabled</span></span> |<span data-ttu-id="41d9f-237">По крайней мере одна конечная точка находится в состоянии проверки конечной точки.</span><span class="sxs-lookup"><span data-stu-id="41d9f-237">The status of at least one endpoint is CheckingEndpoint.</span></span> <span data-ttu-id="41d9f-238">Нет конечных точек, находящихся в сети или в состоянии пониженной функциональности.</span><span class="sxs-lookup"><span data-stu-id="41d9f-238">No endpoints are in Online or Degraded status.</span></span> |<span data-ttu-id="41d9f-239">Проверка конечных точек</span><span class="sxs-lookup"><span data-stu-id="41d9f-239">CheckingEndpoints</span></span> |<span data-ttu-id="41d9f-240">Это переходное состояние возникает при создании или включении профиля.</span><span class="sxs-lookup"><span data-stu-id="41d9f-240">This transition state occurs when a profile if created or enabled.</span></span> <span data-ttu-id="41d9f-241">Работоспособность конечной точки проверяется в первый раз.</span><span class="sxs-lookup"><span data-stu-id="41d9f-241">The endpoint health is being checked for the first time.</span></span> |
| <span data-ttu-id="41d9f-242">Включено</span><span class="sxs-lookup"><span data-stu-id="41d9f-242">Enabled</span></span> |<span data-ttu-id="41d9f-243">Все конечные точки профиля отключены или остановлены, либо в профиле не определены конечные точки.</span><span class="sxs-lookup"><span data-stu-id="41d9f-243">The statuses of all endpoints in the profile are either Disabled or Stopped, or the profile has no defined endpoints.</span></span> |<span data-ttu-id="41d9f-244">Неактивно</span><span class="sxs-lookup"><span data-stu-id="41d9f-244">Inactive</span></span> |<span data-ttu-id="41d9f-245">Конечные точки не активны, но профиль включен.</span><span class="sxs-lookup"><span data-stu-id="41d9f-245">No endpoints are active, but the profile is still Enabled.</span></span> |

## <a name="endpoint-failover-and-recovery"></a><span data-ttu-id="41d9f-246">Отработка отказа и восстановление конечной точки</span><span class="sxs-lookup"><span data-stu-id="41d9f-246">Endpoint failover and recovery</span></span>

<span data-ttu-id="41d9f-247">Диспетчер трафика периодически проверяет работоспособность всех конечных точек, включая неработоспособные конечные точки.</span><span class="sxs-lookup"><span data-stu-id="41d9f-247">Traffic Manager periodically checks the health of every endpoint, including unhealthy endpoints.</span></span> <span data-ttu-id="41d9f-248">Он обнаруживает, когда конечная точка восстановила работоспособность, и возвращает ее в работу.</span><span class="sxs-lookup"><span data-stu-id="41d9f-248">Traffic Manager detects when an endpoint becomes healthy and brings it back into rotation.</span></span>

<span data-ttu-id="41d9f-249">Конечная точка считается неработоспособной при возникновении любого из следующих событий:</span><span class="sxs-lookup"><span data-stu-id="41d9f-249">An endpoint is unhealthy when any of the following events occur:</span></span>
- <span data-ttu-id="41d9f-250">Если используется протокол мониторинга HTTP или HTTPS:</span><span class="sxs-lookup"><span data-stu-id="41d9f-250">If the monitoring protocol is HTTP or HTTPS:</span></span>
    - <span data-ttu-id="41d9f-251">получен ответ, отличный от 200 (включая различные коды 2xx или перенаправление 301/302).</span><span class="sxs-lookup"><span data-stu-id="41d9f-251">A non-200 response is received (including a different 2xx code, or a 301/302 redirect).</span></span>
- <span data-ttu-id="41d9f-252">Если используется протокол мониторинга TCP:</span><span class="sxs-lookup"><span data-stu-id="41d9f-252">If the monitoring protocol is TCP:</span></span> 
    - <span data-ttu-id="41d9f-253">в ответ на запрос SYNC, отправленный диспетчером трафика, чтобы установить подключение, получен ответ, отличный от ACK или SYN-ACK.</span><span class="sxs-lookup"><span data-stu-id="41d9f-253">A response other than ACK or SYN-ACK is received in response to the SYNC request sent by Traffic Manager to attempt a connection establishment.</span></span>
- <span data-ttu-id="41d9f-254">Превышено время ожидания.</span><span class="sxs-lookup"><span data-stu-id="41d9f-254">Timeout.</span></span> 
- <span data-ttu-id="41d9f-255">Любые другие проблемы с подключением, из-за которых невозможно получить доступ к конечной точке.</span><span class="sxs-lookup"><span data-stu-id="41d9f-255">Any other connection issue resulting in the endpoint being not reachable.</span></span>

<span data-ttu-id="41d9f-256">Дополнительную информацию об устранении неполадок, вызвавших сбой при проверке, см. в разделе [Устранение неполадок с состоянием пониженной функциональности в диспетчере трафика Azure](traffic-manager-troubleshooting-degraded.md).</span><span class="sxs-lookup"><span data-stu-id="41d9f-256">For more information about troubleshooting failed checks, see [Troubleshooting Degraded status on Azure Traffic Manager](traffic-manager-troubleshooting-degraded.md).</span></span> 

<span data-ttu-id="41d9f-257">Следующая временная шкала на рисунке 2 представляет подробное описание процесса мониторинга конечной точки в диспетчере трафика с применением следующих параметров: протокол мониторинга — HTTP, интервал проверки — 30 секунд, число допустимых сбоев — 3, значение времени ожидания — 10 секунд и срок жизни DNS — 30 секунд.</span><span class="sxs-lookup"><span data-stu-id="41d9f-257">The following timeline in Figure 2 is a detailed description of the monitoring process of Traffic Manager endpoint that has the following settings: monitoring protocol is HTTP, probing interval is 30 seconds, number of tolerated failures is 3, timeout value is 10 seconds, and DNS TTL is 30 seconds.</span></span>

![Последовательность действий при отработке отказа и восстановлении после сбоя конечной точки диспетчера трафика](./media/traffic-manager-monitoring/timeline.png)

<span data-ttu-id="41d9f-259">**Рис. 2. Последовательность восстановления и отработки отказа конечной точки диспетчера трафика**</span><span class="sxs-lookup"><span data-stu-id="41d9f-259">**Figure 2:  Traffic manager endpoint failover and recovery sequence**</span></span>

1. <span data-ttu-id="41d9f-260">**GET**.</span><span class="sxs-lookup"><span data-stu-id="41d9f-260">**GET**.</span></span> <span data-ttu-id="41d9f-261">Для каждой конечной точки система мониторинга диспетчера трафика выполняет запрос GET для пути, указанного в параметрах мониторинга.</span><span class="sxs-lookup"><span data-stu-id="41d9f-261">For each endpoint, the Traffic Manager monitoring system performs a GET request on the path specified in the monitoring settings.</span></span>
2. <span data-ttu-id="41d9f-262">**200 ОК**.</span><span class="sxs-lookup"><span data-stu-id="41d9f-262">**200 OK**.</span></span> <span data-ttu-id="41d9f-263">Система мониторинга ожидает возврата сообщения HTTP "200 ОК" в течение 10 секунд.</span><span class="sxs-lookup"><span data-stu-id="41d9f-263">The monitoring system expects an HTTP 200 OK message to be returned within 10 seconds.</span></span> <span data-ttu-id="41d9f-264">Получив этот ответ, система распознает облачную службу как доступную.</span><span class="sxs-lookup"><span data-stu-id="41d9f-264">When it receives this response, it recognizes that the service is available.</span></span>
3. <span data-ttu-id="41d9f-265">**30 секунд между проверками**.</span><span class="sxs-lookup"><span data-stu-id="41d9f-265">**30 seconds between checks**.</span></span> <span data-ttu-id="41d9f-266">Проверка работоспособности конечной точки выполняется каждые 30 секунд.</span><span class="sxs-lookup"><span data-stu-id="41d9f-266">The endpoint health check is repeated every 30 seconds.</span></span>
4. <span data-ttu-id="41d9f-267">**Служба недоступна**.</span><span class="sxs-lookup"><span data-stu-id="41d9f-267">**Service unavailable**.</span></span> <span data-ttu-id="41d9f-268">Служба становится недоступной.</span><span class="sxs-lookup"><span data-stu-id="41d9f-268">The service becomes unavailable.</span></span> <span data-ttu-id="41d9f-269">Диспетчеру трафика станет известно об этом только при следующей проверке работоспособности.</span><span class="sxs-lookup"><span data-stu-id="41d9f-269">Traffic Manager will not know until the next health check.</span></span>
5. <span data-ttu-id="41d9f-270">**Попытки получить доступ к пути мониторинга**.</span><span class="sxs-lookup"><span data-stu-id="41d9f-270">**Attempts to access the monitoring path**.</span></span> <span data-ttu-id="41d9f-271">Система мониторинга выполняет запрос GET, но не получает ответ в течение периода ожидания длительностью 10 секунд (также может быть получен ответ, отличный от 200).</span><span class="sxs-lookup"><span data-stu-id="41d9f-271">The monitoring system performs a GET request, but does not receive a response within the timeout period of 10 seconds (alternatively, a non-200 response may be received).</span></span> <span data-ttu-id="41d9f-272">Затем выполняется еще три попытки с интервалом в 30 секунд.</span><span class="sxs-lookup"><span data-stu-id="41d9f-272">It then tries three more times, at 30-second intervals.</span></span> <span data-ttu-id="41d9f-273">Если одна из попыток оказывается успешной, число попыток сбрасывается.</span><span class="sxs-lookup"><span data-stu-id="41d9f-273">If one of the tries is successful, then the number of tries is reset.</span></span>
6. <span data-ttu-id="41d9f-274">**Устанавливается состояние пониженной функциональности**.</span><span class="sxs-lookup"><span data-stu-id="41d9f-274">**Status set to Degraded**.</span></span> <span data-ttu-id="41d9f-275">После четырех последовательных неудачных попыток система мониторинга помечает недоступную конечную точку как находящуюся в состоянии пониженной функциональности.</span><span class="sxs-lookup"><span data-stu-id="41d9f-275">After a fourth consecutive failure, the monitoring system marks the unavailable endpoint status as Degraded.</span></span>
7. <span data-ttu-id="41d9f-276">**Трафик направляется на другие конечные точки**.</span><span class="sxs-lookup"><span data-stu-id="41d9f-276">**Traffic is diverted to other endpoints**.</span></span> <span data-ttu-id="41d9f-277">DNS-серверы диспетчера трафика обновляются, и диспетчер трафика больше не возвращает эту конечную точку в ответ на запросы DNS.</span><span class="sxs-lookup"><span data-stu-id="41d9f-277">The Traffic Manager DNS name servers are updated and Traffic Manager no longer returns the endpoint in response to DNS queries.</span></span> <span data-ttu-id="41d9f-278">Новые подключения направляются к другим, доступным конечным точкам.</span><span class="sxs-lookup"><span data-stu-id="41d9f-278">New connections are directed to other, available endpoints.</span></span> <span data-ttu-id="41d9f-279">Однако рекурсивные DNS-серверы и DNS-клиенты могут по-прежнему содержать в кэше предыдущие ответы DNS с этой конечной точкой.</span><span class="sxs-lookup"><span data-stu-id="41d9f-279">However, previous DNS responses that include this endpoint may still be cached by recursive DNS servers and DNS clients.</span></span> <span data-ttu-id="41d9f-280">Клиенты продолжат использовать конечную точку, пока не истечет срок действия кэша DNS.</span><span class="sxs-lookup"><span data-stu-id="41d9f-280">Clients continue to use the endpoint until the DNS cache expires.</span></span> <span data-ttu-id="41d9f-281">По истечении срока действия этого кэша клиенты создадут новые запросы DNS и будут направлены к другим конечным точкам.</span><span class="sxs-lookup"><span data-stu-id="41d9f-281">As the DNS cache expires, clients make new DNS queries and are directed to different endpoints.</span></span> <span data-ttu-id="41d9f-282">Длительность кэширования задается с помощью параметра срока жизни в профиле диспетчера трафика. Например, это может быть 30 секунд.</span><span class="sxs-lookup"><span data-stu-id="41d9f-282">The cache duration is controlled by the TTL setting in the Traffic Manager profile, for example, 30 seconds.</span></span>
8. <span data-ttu-id="41d9f-283">**Проверки работоспособности продолжаются**.</span><span class="sxs-lookup"><span data-stu-id="41d9f-283">**Health checks continue**.</span></span> <span data-ttu-id="41d9f-284">Диспетчер трафика продолжает проверять работоспособность конечной точки, пока она находится в состоянии пониженной функциональности.</span><span class="sxs-lookup"><span data-stu-id="41d9f-284">Traffic Manager continues to check the health of the endpoint while it has a Degraded status.</span></span> <span data-ttu-id="41d9f-285">Диспетчер трафика обнаруживает, когда конечная точка восстановила работоспособность.</span><span class="sxs-lookup"><span data-stu-id="41d9f-285">Traffic Manager detects when the endpoint returns to health.</span></span>
9. <span data-ttu-id="41d9f-286">**Служба возвращается в сеть**.</span><span class="sxs-lookup"><span data-stu-id="41d9f-286">**Service comes back online**.</span></span> <span data-ttu-id="41d9f-287">Служба становится доступной.</span><span class="sxs-lookup"><span data-stu-id="41d9f-287">The service becomes available.</span></span> <span data-ttu-id="41d9f-288">Конечная точка будет оставаться в состоянии пониженной функциональности в диспетчере трафика, пока система мониторинга не выполнит следующую проверку работоспособности.</span><span class="sxs-lookup"><span data-stu-id="41d9f-288">The endpoint retains its Degraded status in Traffic Manager until the monitoring system performs its next health check.</span></span>
10. <span data-ttu-id="41d9f-289">**Возобновляется направление трафика к службе**.</span><span class="sxs-lookup"><span data-stu-id="41d9f-289">**Traffic to service resumes**.</span></span> <span data-ttu-id="41d9f-290">Диспетчер трафика отправляет запрос GET и получает ответ о состоянии "200 OK".</span><span class="sxs-lookup"><span data-stu-id="41d9f-290">Traffic Manager sends a GET request and receives a 200 OK status response.</span></span> <span data-ttu-id="41d9f-291">Служба вернулась в работоспособное состояние.</span><span class="sxs-lookup"><span data-stu-id="41d9f-291">The service has returned to a healthy state.</span></span> <span data-ttu-id="41d9f-292">Серверы имен диспетчера трафика снова обновляются и начинают передавать DNS-имя службы в ответах DNS.</span><span class="sxs-lookup"><span data-stu-id="41d9f-292">The Traffic Manager name servers are updated, and they begin to hand out the service's DNS name in DNS responses.</span></span> <span data-ttu-id="41d9f-293">Трафик вернется к конечной точке, так как срок действия кэшированных ответов DNS, возвращающих другие конечные точки, истек, и существующие подключения к другим конечным точкам завершены.</span><span class="sxs-lookup"><span data-stu-id="41d9f-293">Traffic returns to the endpoint as cached DNS responses that return other endpoints expire, and as existing connections to other endpoints are terminated.</span></span>

    > [!NOTE]
    > <span data-ttu-id="41d9f-294">Так как диспетчер трафика работает на уровне DNS, он не может влиять на существующие подключения к какой-либо конечной точке.</span><span class="sxs-lookup"><span data-stu-id="41d9f-294">Because Traffic Manager works at the DNS level, it cannot influence existing connections to any endpoint.</span></span> <span data-ttu-id="41d9f-295">При маршрутизации трафика между конечными точками (путем изменения параметров профиля либо во время отработки отказа или восстановления размещения) диспетчер трафика направляет новые подключения к доступным конечным точкам.</span><span class="sxs-lookup"><span data-stu-id="41d9f-295">When it directs traffic between endpoints (either by changed profile settings, or during failover or failback), Traffic Manager directs new connections to available endpoints.</span></span> <span data-ttu-id="41d9f-296">Однако другие конечные точки могут по-прежнему получать трафик через имеющиеся подключения, пока эти сеансы не будут завершены.</span><span class="sxs-lookup"><span data-stu-id="41d9f-296">However, other endpoints might continue to receive traffic via existing connections until those sessions are terminated.</span></span> <span data-ttu-id="41d9f-297">Чтобы трафик не проходил через имеющиеся подключения, для приложений следует ограничить продолжительность сеанса в каждой конечной точке.</span><span class="sxs-lookup"><span data-stu-id="41d9f-297">To enable traffic to drain from existing connections, applications should limit the session duration used with each endpoint.</span></span>

## <a name="traffic-routing-methods"></a><span data-ttu-id="41d9f-298">Методы маршрутизации трафика</span><span class="sxs-lookup"><span data-stu-id="41d9f-298">Traffic-routing methods</span></span>

<span data-ttu-id="41d9f-299">Если конечная точка переходит в состояние пониженной функциональности, она больше не возвращается в ответ на запросы DNS.</span><span class="sxs-lookup"><span data-stu-id="41d9f-299">When an endpoint has a Degraded status, it is no longer returned in response to DNS queries.</span></span> <span data-ttu-id="41d9f-300">Вместо этого выбирается и возвращается альтернативная конечная точка.</span><span class="sxs-lookup"><span data-stu-id="41d9f-300">Instead, an alternative endpoint is chosen and returned.</span></span> <span data-ttu-id="41d9f-301">Метод маршрутизации трафика, заданный в профиле, определяет, как выбирается альтернативная конечная точка.</span><span class="sxs-lookup"><span data-stu-id="41d9f-301">The traffic-routing method configured in the profile determines how the alternative endpoint is chosen.</span></span>

* <span data-ttu-id="41d9f-302">**Приоритет**.</span><span class="sxs-lookup"><span data-stu-id="41d9f-302">**Priority**.</span></span> <span data-ttu-id="41d9f-303">Конечные точки формируют список по приоритетам.</span><span class="sxs-lookup"><span data-stu-id="41d9f-303">Endpoints form a prioritized list.</span></span> <span data-ttu-id="41d9f-304">Всегда возвращается первая доступная конечная точка в списке.</span><span class="sxs-lookup"><span data-stu-id="41d9f-304">The first available endpoint on the list is always returned.</span></span> <span data-ttu-id="41d9f-305">Если она переходит в состояние пониженной функциональности, то возвращается следующая доступная конечная точка.</span><span class="sxs-lookup"><span data-stu-id="41d9f-305">If an endpoint status is Degraded, then the next available endpoint is returned.</span></span>
* <span data-ttu-id="41d9f-306">**Взвешивание**.</span><span class="sxs-lookup"><span data-stu-id="41d9f-306">**Weighted**.</span></span> <span data-ttu-id="41d9f-307">Случайным образом выбирается любая доступная конечная точка в зависимости от назначенного ей весового коэффициента и весовых коэффициентов других доступных конечных точек.</span><span class="sxs-lookup"><span data-stu-id="41d9f-307">Any available endpoint is chosen at random based on their assigned weights and the weights of the other available endpoints.</span></span>
* <span data-ttu-id="41d9f-308">**Производительность**.</span><span class="sxs-lookup"><span data-stu-id="41d9f-308">**Performance**.</span></span> <span data-ttu-id="41d9f-309">Возвращается конечная точка, ближайшая к конечному пользователю.</span><span class="sxs-lookup"><span data-stu-id="41d9f-309">The endpoint closest to the end user is returned.</span></span> <span data-ttu-id="41d9f-310">Если эта конечная точка недоступна, возвращаемая конечная точка выбирается в произвольном порядке из всех остальных доступных конечных точек.</span><span class="sxs-lookup"><span data-stu-id="41d9f-310">If that endpoint is unavailable, an endpoint is randomly chosen from all the other available endpoints.</span></span> <span data-ttu-id="41d9f-311">Случайный выбор конечной точки помогает избежать каскадных сбоев, которые могут возникнуть при перегрузке ближайшей конечной точки.</span><span class="sxs-lookup"><span data-stu-id="41d9f-311">Choosing a random endpoint avoids a cascading failure that can occur when the next-closest endpoint becomes overloaded.</span></span> <span data-ttu-id="41d9f-312">С помощью [вложенных профилей диспетчера трафика](traffic-manager-nested-profiles.md#example-4-controlling-performance-traffic-routing-between-multiple-endpoints-in-the-same-region) можно настроить альтернативные планы отработки отказа для повышения производительности маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="41d9f-312">You can configure alternative failover plans for performance traffic-routing by using [nested Traffic Manager profiles](traffic-manager-nested-profiles.md#example-4-controlling-performance-traffic-routing-between-multiple-endpoints-in-the-same-region).</span></span>
* <span data-ttu-id="41d9f-313">**Географический**.</span><span class="sxs-lookup"><span data-stu-id="41d9f-313">**Geographic**.</span></span> <span data-ttu-id="41d9f-314">Возвращается конечная точка, сопоставленная для обработки географического расположения на основе IP-адреса запроса.</span><span class="sxs-lookup"><span data-stu-id="41d9f-314">The endpoint mapped to serve the geographic location based on the query request IP’s is returned.</span></span> <span data-ttu-id="41d9f-315">Если эта конечная точка недоступна, другая конечная точка для отработки отказа выбрана не будет, так как географическое расположение можно сопоставить только с одной конечной точкой в профиле (дополнительные сведения см. в разделе [часто задаваемых вопросов](traffic-manager-FAQs.md#traffic-manager-geographic-traffic-routing-method)).</span><span class="sxs-lookup"><span data-stu-id="41d9f-315">If that endpoint is unavailable, another endpoint will not be selected to failover to, since a geographic location can be mapped only to one endpoint in a profile (more details are in the [FAQ](traffic-manager-FAQs.md#traffic-manager-geographic-traffic-routing-method)).</span></span> <span data-ttu-id="41d9f-316">В качестве оптимального варианта при использовании географической маршрутизации мы рекомендуем клиентам использовать вложенные профили диспетчера трафика с несколькими конечными точками профиля.</span><span class="sxs-lookup"><span data-stu-id="41d9f-316">As a best practice, when using geographic routing, we recommend customers to use nested Traffic Manager profiles with more than one endpoint as the endpoints of the profile.</span></span>

<span data-ttu-id="41d9f-317">Дополнительные сведения см. в разделе [Методы маршрутизации трафика диспетчером трафика](traffic-manager-routing-methods.md).</span><span class="sxs-lookup"><span data-stu-id="41d9f-317">For more information, see [Traffic Manager traffic-routing methods](traffic-manager-routing-methods.md).</span></span>

> [!NOTE]
> <span data-ttu-id="41d9f-318">Единственное исключение для нормального поведения маршрутизации трафика возникает, когда все конечные точки находятся в состоянии пониженной функциональности.</span><span class="sxs-lookup"><span data-stu-id="41d9f-318">One exception to normal traffic-routing behavior occurs when all eligible endpoints have a degraded status.</span></span> <span data-ttu-id="41d9f-319">В этом случае диспетчер трафика по возможности *воспринимает конечные точки в состоянии пониженной функциональности как работающие и находящиеся в сети*.</span><span class="sxs-lookup"><span data-stu-id="41d9f-319">Traffic Manager makes a "best effort" attempt and *responds as if all the Degraded status endpoints actually are in an online state*.</span></span> <span data-ttu-id="41d9f-320">Такое поведение предпочтительнее альтернативного варианта — вообще не возвращать конечную точку в ответе DNS.</span><span class="sxs-lookup"><span data-stu-id="41d9f-320">This behavior is preferable to the alternative, which would be to not return any endpoint in the DNS response.</span></span> <span data-ttu-id="41d9f-321">Отключенные и остановленные конечные точки не отслеживаются, таким образом, они не считаются допустимыми для трафика.</span><span class="sxs-lookup"><span data-stu-id="41d9f-321">Disabled or Stopped endpoints are not monitored, therefore, they are not considered eligible for traffic.</span></span>
>
> <span data-ttu-id="41d9f-322">Это условие обычно вызвано неправильной конфигурацией службы, например:</span><span class="sxs-lookup"><span data-stu-id="41d9f-322">This condition is commonly caused by improper configuration of the service, such as:</span></span>
>
> * <span data-ttu-id="41d9f-323">проверки работоспособности диспетчера трафика блокируются списком управления доступом [ACL];</span><span class="sxs-lookup"><span data-stu-id="41d9f-323">An access control list [ACL] blocking the Traffic Manager health checks.</span></span>
> * <span data-ttu-id="41d9f-324">неправильная конфигурация порта или протокола мониторинга в профиле диспетчера трафика.</span><span class="sxs-lookup"><span data-stu-id="41d9f-324">An improper configuration of the monitoring port or protocol in the Traffic manager profile.</span></span>
>
> <span data-ttu-id="41d9f-325">В результате такого поведения, даже если проверки работоспособности диспетчера трафика настроены неправильно, с точки зрения маршрутизации трафика может показаться, что диспетчер трафика *работает правильно*.</span><span class="sxs-lookup"><span data-stu-id="41d9f-325">The consequence of this behavior is that if Traffic Manager health checks are not configured correctly, it might appear from the traffic routing as though Traffic Manager *is* working properly.</span></span> <span data-ttu-id="41d9f-326">Кроме того, в этом случае при сбое конечной точки не происходит отработка отказа, что негативно влияет на общую доступность приложения.</span><span class="sxs-lookup"><span data-stu-id="41d9f-326">However, in this case, endpoint failover cannot happen which affects overall application availability.</span></span> <span data-ttu-id="41d9f-327">Поэтому важно убедиться, что профиль находится в сети, а не в состоянии пониженной функциональности.</span><span class="sxs-lookup"><span data-stu-id="41d9f-327">It is important to check that the profile shows an Online status, not a Degraded status.</span></span> <span data-ttu-id="41d9f-328">Состояние "В сети" указывает на то, что проверки работоспособности диспетчера трафика выполняются надлежащим образом.</span><span class="sxs-lookup"><span data-stu-id="41d9f-328">An Online status indicates that the Traffic Manager health checks are working as expected.</span></span>

<span data-ttu-id="41d9f-329">Дополнительную информацию об устранении неполадок, вызвавших сбой при проверке работоспособности, см. в разделе [Устранение неполадок с состоянием пониженной функциональности в диспетчере трафика Azure](traffic-manager-troubleshooting-degraded.md).</span><span class="sxs-lookup"><span data-stu-id="41d9f-329">For more information about troubleshooting failed health checks, see [Troubleshooting Degraded status on Azure Traffic Manager](traffic-manager-troubleshooting-degraded.md).</span></span>



## <a name="next-steps"></a><span data-ttu-id="41d9f-330">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="41d9f-330">Next steps</span></span>

<span data-ttu-id="41d9f-331">Узнайте о том, [как работает диспетчер трафика](traffic-manager-how-traffic-manager-works.md)</span><span class="sxs-lookup"><span data-stu-id="41d9f-331">Learn [how Traffic Manager works](traffic-manager-how-traffic-manager-works.md)</span></span>

<span data-ttu-id="41d9f-332">Узнайте больше о [методах маршрутизации трафика](traffic-manager-routing-methods.md) , поддерживаемых в диспетчере трафика.</span><span class="sxs-lookup"><span data-stu-id="41d9f-332">Learn more about the [traffic-routing methods](traffic-manager-routing-methods.md) supported by Traffic Manager</span></span>

<span data-ttu-id="41d9f-333">Узнайте, как [создать профиль диспетчера трафика](traffic-manager-manage-profiles.md)</span><span class="sxs-lookup"><span data-stu-id="41d9f-333">Learn how to [create a Traffic Manager profile](traffic-manager-manage-profiles.md)</span></span>

<span data-ttu-id="41d9f-334">[устранении неполадок с состоянием пониженной функциональности](traffic-manager-troubleshooting-degraded.md) конечной точки диспетчера трафика.</span><span class="sxs-lookup"><span data-stu-id="41d9f-334">[Troubleshoot Degraded status](traffic-manager-troubleshooting-degraded.md) on a Traffic Manager endpoint</span></span>
