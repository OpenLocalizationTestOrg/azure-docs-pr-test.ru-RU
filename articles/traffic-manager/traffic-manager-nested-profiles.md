---
title: "Вложенные профили диспетчера трафика | Документация Майкрософт"
description: "В этой статье описываются функции \"вложенных профилей\" диспетчера трафика Azure."
services: traffic-manager
documentationcenter: 
author: kumudd
manager: timlt
editor: 
ms.assetid: f1b112c4-a3b1-496e-90eb-41e235a49609
ms.service: traffic-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/22/2017
ms.author: kumud
ms.openlocfilehash: 1ac4ec2775ca9f690f5adf4f939908f8cee3f715
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="nested-traffic-manager-profiles"></a>Вложенные профили диспетчера трафика

Диспетчер трафика предлагает несколько методов маршрутизации трафика, позволяя вам выбрать оптимальный алгоритм распределения трафика пользователей между конечными точками. Дополнительные сведения см. в разделе [Методы маршрутизации трафика диспетчером трафика](traffic-manager-routing-methods.md).

Каждый профиль диспетчера трафика определяет один метод маршрутизации трафика. Но бывают случаи, когда требуется более сложная маршрутизация трафика, чем та, которую может обеспечить отдельный профиль диспетчера трафика. Чтобы воспользоваться преимуществами нескольких методов маршрутизации трафика, можно выполнить вложение профилей диспетчера трафика. Вложенные профили позволяют переопределить стандартное поведение диспетчера трафика, реализуя поддержку крупных и сложных развертываний приложений.

Следующие примеры иллюстрируют использование вложенных профилей диспетчера трафика в разных сценариях.

## <a name="example-1-combining-performance-and-weighted-traffic-routing"></a>Пример 1. Объединение маршрутизации трафика для повышения производительности и маршрутизации трафика со взвешиванием

Предположим, приложение развернуто в нескольких регионах Azure: в западной части США, Западной Европе и Восточной Азии. Вы используете метод маршрутизации трафика по производительности, т. е. диспетчер трафика направляет трафик в ближайший для пользователя регион.

![Отдельный профиль диспетчера трафика][4]

Предположим, вы хотите протестировать обновление службы с привлечением небольшого числа пользователей, прежде чем внедрять решение повсеместно. Вы хотите использовать маршрутизацию трафика по методу взвешивания, чтобы направить небольшую долю трафика в тестовое развертывание. Вы создаете тестовое развертывание в регионе Западная Европа параллельно с существующим основным развертыванием.

И вы не можете использовать одновременно два метода маршрутизации трафика в одном профиле. Чтобы реализовать такой сценарий вам нужно создать отдельный профиль диспетчера трафика для двух конечных точек в регионе Западная Европа с маршрутизацией трафика по методу взвешивания. Затем вам нужно сделать этот профиль дочерним, добавив его в качестве конечной точки в родительский профиль. В родительском профиле используется маршрутизация трафика по производительности, а также содержатся остальные глобальные развертывания в качестве конечных точек.

Этот пример представлен на схеме ниже.

![Вложенные профили диспетчера трафика][2]

В этой конфигурации трафик, направленный через родительский профиль, распределяется между регионами обычным образом. В пределах Западной Европы вложенный профиль распределяет трафик между рабочей и тестовой конечными точками в соответствии с весовыми коэффициентами.

Так как родительский профиль использует маршрутизацию трафика по производительности, каждой конечной точке должно быть назначено расположение. Расположение указывается при настройке конечной точки. Выберите ближайший к вашему развертыванию регион Azure. Именно регионы Azure отслеживаются в таблице задержек Интернета. Дополнительные сведения см. в разделе [Метод маршрутизации трафика по приоритету](traffic-manager-routing-methods.md#performance).

## <a name="example-2-endpoint-monitoring-in-nested-profiles"></a>Пример 2. Мониторинг конечных точек во вложенных профилях

Диспетчер трафика активно отслеживает работоспособность каждой конечной точки службы. Если конечная точка находится в неработоспособном состоянии, диспетчер трафика направляет пользователей к другим конечным точкам, чтобы обеспечить доступность службы. Этот режим мониторинга и отработки отказа конечных точек применяется ко всем методам маршрутизации трафика. Дополнительные сведения см. в статье [Мониторинг и отработка отказов конечной точки диспетчера трафика](traffic-manager-monitoring.md). Мониторинг конечных точек выполняется иначе для вложенных профилей. В таком случае родительский профиль не проверяет состояние дочерних элементов (вложенных профилей) напрямую. Вместо этого вычисляется общая характеристика работоспособности для дочернего профиля с учетом состояния работоспособности всех конечных точек этого профиля. Эта информация передается вверх по иерархии вложенных профилей. Родительский профиль использует сводные данные о работоспособности и определяет, следует ли передавать трафик в дочерний профиль. Процедура мониторинга работоспособности вложенных профилей подробно описана в разделе [Часто задаваемые вопросы](traffic-manager-FAQs.md#traffic-manager-nested-profiles).

Теперь вернемся к предыдущему примеру. Допустим, что в Западной Европе происходит сбой рабочего развертывания. По умолчанию дочерний профиль будет направлять весь трафик в тестовое развертывание. Если тестовое развертывание также перестанет работать, родительский профиль прекратит передачу трафика в дочерний профиль, так как все его конечные точки неработоспособны. Следовательно, родительский профиль будет передавать трафик в другие регионы.

![Отработка отказа вложенного профиля (поведение по умолчанию)][3]

Возможно, такой подход вас вполне устроит. Но также вас может и не устроить то, что в тестовое развертывание будет попадать весь трафик, предназначенный для Западной Европы, а не ограниченная его часть. Возможно, вы бы предпочли, чтобы отработка отказа при сбое рабочего развертывания в Западной Европе выполнялась в другие регионы, независимо от работоспособности тестового развертывания. Чтобы реализовать такой алгоритм, вы можете указать параметр MinChildEndpoints при настройке дочернего профиля в качестве конечной точки в родительском профиле. Этот параметр определяет минимальное допустимое число доступных конечных точек в дочернем профиле. Значение по умолчанию — 1. В нашем примере вы присваиваете параметру MinChildEndpoints значение 2. Если это ограничение нарушается, родительский профиль расценивает весь дочерний профиль как недоступный и направляет трафик в другие регионы.

Эта конфигурация представлена на следующей схеме:

![Отработка отказа для вложенных профилей при MinChildEndpoints = 2][4]

> [!NOTE]
> Метод маршрутизации трафика по приоритетам направляет весь трафик к одной конечной точке. Поэтому в таком случае нет смысла задавать значение выше 1 для параметра MinChildEndpoints.

## <a name="example-3-prioritized-failover-regions-in-performance-traffic-routing"></a>Пример 3. Расположенные по приоритетам регионы отработки отказа при маршрутизации трафика для повышения производительности

Стандартное поведение маршрутизации трафика по производительности позволяет избежать чрезмерной загрузки ближайшей соседней конечной точки, которая может привести к лавинообразной серии сбоев. При сбое конечной точки весь трафик, который мог направляться к этой конечной точке, распределяется равномерно между конечными точками во всех регионах.

![Маршрутизация трафика по производительности с отработкой отказа по умолчанию][5]

Но предположим, что вы хотели бы направлять трафик из Западной Европы при отработке отказа только в западную часть США, и лишь при недоступности обеих конечных точек — в другие регионы. Такое решение можно создать с помощью дочернего профиля и метода маршрутизации трафика по приоритетам.

![Маршрутизация трафика для повышения производительности с отработкой отказа по предпочтению][6]

Так как конечная точка в Западной Европе имеет более высокий приоритет, чем конечная точка в западной части США, весь трафик будет отправляться в конечную точку в Западной Европе пока обе эти точки работоспособны. В случае сбоя конечной точки в Западной Европе ее трафик направляется в западную часть США. При использовании вложенного профиля трафик направляется в Восточную Азию, только если одновременно происходят сбои конечных точек в регионах Западная Европа и Запад США.

Этот шаблон можно распространить на все регионы. Замените все три конечные точки в родительском профиле тремя дочерними профилями, каждый из которых описывает приоритеты ресурсов для отработки отказа.

## <a name="example-4-controlling-performance-traffic-routing-between-multiple-endpoints-in-the-same-region"></a>Пример 4. Управление маршрутизацией трафика для повышения производительности между несколькими конечными точками в одном регионе

Предположим, что в профиле настроена маршрутизация трафика по производительности и в некотором его регионе есть несколько конечных точек. По умолчанию трафик, направленный в этот регион, распределяется равномерно между всеми доступными конечными точками в этом регионе.

![Распределение трафика в регионе при маршрутизации трафика по производительности (поведение по умолчанию)][7]

Чтобы не добавлять в регион Западная Европа несколько конечных точек, мы можем заключить их в отдельный дочерний профиль. Затем дочерний профиль добавляется в родительский профиль как единственная конечная точка в Западной Европе. Теперь можно управлять распределением трафика в Западной Европе с помощью настроек дочернего профиля, например использовать маршрутизацию трафика по приоритету или по методу взвешивания.

![Маршрутизация трафика по производительности с пользовательской настройкой распределения трафика в регионе][8]

## <a name="example-5-per-endpoint-monitoring-settings"></a>Пример 5. Параметры мониторинга каждой конечной точки

Предположим, вы используете диспетчер трафика, чтобы без остановок перенести трафик с устаревшего локального веб-сайта на новую версию, размещенную в облаке Azure. Вы намерены использовать адрес домашней страницы старой версии сайта для мониторинга его работоспособности. В новой облачной версии вы реализуете отдельную страницу мониторинга (по адресу /monitor.aspx) с дополнительными проверками.

![Мониторинг конечных точек диспетчером трафика (поведение по умолчанию)][9]

Параметры мониторинга в профиле диспетчера трафика применяются ко всем конечным точкам в одном профиле. Благодаря вложенным профилям диспетчера трафика вы сможете использовать отдельный дочерний профиль для каждого из сайтов, чтобы определить для них разные параметры мониторинга.

![Мониторинг диспетчером трафика конечных точек с индивидуальными параметрами][10]

## <a name="next-steps"></a>Дальнейшие действия

Узнайте больше о [профилях диспетчера трафика](traffic-manager-overview.md).

Узнайте, как [создать профиль диспетчера трафика](traffic-manager-create-profile.md)

<!--Image references-->
[1]: ./media/traffic-manager-nested-profiles/figure-1.png
[2]: ./media/traffic-manager-nested-profiles/figure-2.png
[3]: ./media/traffic-manager-nested-profiles/figure-3.png
[4]: ./media/traffic-manager-nested-profiles/figure-4.png
[5]: ./media/traffic-manager-nested-profiles/figure-5.png
[6]: ./media/traffic-manager-nested-profiles/figure-6.png
[7]: ./media/traffic-manager-nested-profiles/figure-7.png
[8]: ./media/traffic-manager-nested-profiles/figure-8.png
[9]: ./media/traffic-manager-nested-profiles/figure-9.png
[10]: ./media/traffic-manager-nested-profiles/figure-10.png
