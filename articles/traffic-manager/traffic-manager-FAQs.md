---
title: "Диспетчер трафика Azure: вопросы и ответы | Документация Майкрософт"
description: "Эта статья содержит ответы на часто задаваемые вопросы о диспетчере трафика Azure"
services: traffic-manager
documentationcenter: 
author: kumudd
manager: timlt
editor: 
ms.assetid: 75d5ff9a-f4b9-4b05-af32-700e7bdfea5a
ms.service: traffic-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 06/15/2017
ms.author: kumud
ms.openlocfilehash: 44762864e0a5adf568fcd4928b48661196f05b9e
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="traffic-manager-frequently-asked-questions-faq"></a>Диспетчер трафика Azure: вопросы и ответы

## <a name="traffic-manager-basics"></a>Основные сведения о диспетчере трафика

### <a name="what-ip-address-does-traffic-manager-use"></a>Какой IP-адрес использует диспетчер трафика?

В [обзоре диспетчера трафика How Traffic Manager Works](../traffic-manager/traffic-manager-overview.md#how-traffic-manager-works) объясняется, что диспетчер трафика работает на уровне DNS. Он использует ответы DNS, чтобы направлять клиентов в соответствующую конечную точку службы. Клиенты подключаются к конечной точке службы приложения напрямую, а не через диспетчер трафика.

Следовательно, диспетчер трафика не предоставляет конечную точку или IP-адрес для подключения клиентов. Если, например, вашей службе требуется статический IP-адрес, он должен быть настроен на уровне службы, а не в диспетчере трафика.

### <a name="does-traffic-manager-support-sticky-sessions"></a>Поддерживает ли диспетчер трафика прикрепленные сеансы?

В [обзоре диспетчера трафика How Traffic Manager Works](../traffic-manager/traffic-manager-overview.md#how-traffic-manager-works) объясняется, что диспетчер трафика работает на уровне DNS. Он использует ответы DNS для направления клиентов на соответствующую конечную точку службы. Клиенты подключаются к конечной точке службы приложения напрямую, а не через диспетчер трафика. Таким образом, диспетчер трафика не может отслеживать HTTP-трафик, проходящий между клиентом и сервером.

Кроме того, исходный IP-адрес, откуда диспетчер трафика получает запрос DNS, принадлежит рекурсивной службе DNS, а не клиенту. Это значит, что диспетчер трафика не может отслеживать отдельные клиенты и не может реализовывать прикрепленные сеансы. Это общее ограничение для всех систем управления трафиком на основе DNS, а не особенность диспетчера трафика.

### <a name="why-am-i-seeing-an-http-error-when-using-traffic-manager"></a>Почему при использовании диспетчера трафика отображается HTTP-ошибка?

В [обзоре диспетчера трафика How Traffic Manager Works](../traffic-manager/traffic-manager-overview.md#how-traffic-manager-works) объясняется, что диспетчер трафика работает на уровне DNS. Он использует ответы DNS для направления клиентов на соответствующую конечную точку службы. Клиенты подключаются к конечной точке службы приложения напрямую, а не через диспетчер трафика. Диспетчер трафика не видит трафик HTTP, проходящий между клиентом и сервером. Это значит, что все отображаемые HTTP-ошибки создаются приложением. Если клиент подключился к приложению, значит все действия по разрешению имен DNS уже успешно выполнены. Сюда входят также действия, выполняемые диспетчером в отношении трафика приложения.

Таким образом, вам следует проанализировать возможные проблемы на уровне приложения.

Чаще всего проблемы возникают из-за HTTP-заголовка Host в запросе, который отправляет браузер пользователя. Убедитесь, что приложение правильно обрабатывает заголовок с используемым вами доменным именем. Если конечная точка размещается в службе приложений Azure, см. статью [Настройка личного доменного имени для веб-приложения в службе приложений Azure, использующей диспетчер трафика](../app-service-web/web-sites-traffic-manager-custom-domain-name.md).

### <a name="what-is-the-performance-impact-of-using-traffic-manager"></a>Как сказывается на производительности использование диспетчера трафика?

В [обзоре диспетчера трафика How Traffic Manager Works](../traffic-manager/traffic-manager-overview.md#how-traffic-manager-works) объясняется, что диспетчер трафика работает на уровне DNS. Так как клиенты подключаются к конечным точкам службы напрямую, использование диспетчера трафика при установленном соединении никак не влияет на производительность.

Диспетчер трафика интегрируется с приложениями на уровне DNS, поэтому в цепочку разрешения DNS включается дополнительный поиск DNS. Диспетчер трафика оказывает минимальное влияние на время разрешения DNS. Диспетчер трафика использует глобальную сеть серверов доменных имен и сетевую службу [произвольной рассылки](https://en.wikipedia.org/wiki/Anycast), обеспечивая передачу запросов DNS на ближайший доступный сервер доменных имен. Кроме того, кэширование DNS-ответов означает, что дополнительные задержки DNS, связанные с использованием диспетчера трафика, происходят только в некоторых сеансах.

В ходе маршрутизации по производительности трафик направляется в ближайшую доступную конечную точку. В итоге этот метод маршрутизации оказывает минимальное влияние на общую производительность. Возможное повышение задержки DNS будет компенсироваться снижением задержки сети при взаимодействии с конечной точкой.

### <a name="what-application-protocols-can-i-use-with-traffic-manager"></a>Какие протоколы приложения пригодны для использования с диспетчером трафика?

В [обзоре диспетчера трафика How Traffic Manager Works](../traffic-manager/traffic-manager-overview.md#how-traffic-manager-works) объясняется, что диспетчер трафика работает на уровне DNS. После завершения поиска DNS клиенты подключаются к конечной точке приложения напрямую, а не через диспетчер трафика. Следовательно, это подключение может использовать любой протокол приложения. Если выбрать протокол ТСР в качестве протокола мониторинга, мониторинг работоспособности конечной точки диспетчера трафика можно выполнить без использования любых протоколов приложения. Если для проверки работоспособности вы выбираете протокол приложения, конечная точка должна отвечать на HTTP- или HTTPS-запросы GET.

### <a name="can-i-use-traffic-manager-with-a-naked-domain-name"></a>Можно ли использовать диспетчер трафика с "голым" доменным именем (без префикса www)?

Нет. Стандарты DNS не допускают существование записей CNAME и других записей DNS для одного доменного имени. Для верхнего (корневого) имени в любой зоне DNS всегда определены две записи DNS — SOA и NS (для полномочных серверов доменных имен). Это означает, что на вершине зоны нельзя создать запись CNAME, не нарушив стандарты DNS.

Для работы диспетчера трафика обязательно требуется запись DNS CNAME для сопоставления с личным именем DNS. Например, вы можете сопоставить www.contoso.com с именем DNS профиля диспетчера трафика contoso.trafficmanager.net. Кроме того, профиль диспетчера трафика возвращает еще одну запись DNS CNAME, которая указывает клиенту конечную точку для подключения.

Чтобы решить эту проблему, мы рекомендуем выполнить перенаправление HTTP с "голого" доменного имени на другой URL-адрес, который затем можно использовать с диспетчером трафика. Например, можно перенаправлять пользователей с доменного имени contoso.com на адрес www.contoso.com, для которого указана запись CNAME, ведущая к доменному имени диспетчера трафика.

Полная поддержка таких доменов в диспетчере трафика отслеживается в списке подготавливаемых функций. Если вас интересует эта функция, [проголосуйте за нее на нашем сайте обратной связи](https://feedback.azure.com/forums/217313-networking/suggestions/5485350-support-apex-naked-domains-more-seamlessly).

### <a name="does-traffic-manager-consider-the-client-subnet-address-when-handling-dns-queries"></a>Учитывает ли диспетчер трафика адрес подсети клиента при обработке запросов DNS? 
Нет, сейчас диспетчер трафика учитывает только исходный IP-адрес полученного DNS-запроса. Обычно это IP-адрес сопоставителя DNS, выполняющего запросы для маршрутизации по производительности или географической маршрутизации.  
В частности, диспетчер трафика пока не поддерживает стандарт [7871 RFC — подсети клиента в запросах DNS](https://tools.ietf.org/html/rfc7871), который предоставляет [механизм расширения для DNS (EDNS0)](https://tools.ietf.org/html/rfc2671), позволяющий сопоставителю передавать адрес поддерживаемых подсетей клиента на DNS-сервер. Если вас интересует эта функция, [поддержите запрос на ее реализацию на нашем сайте обратной связи](https://feedback.azure.com/forums/217313-networking).


### <a name="what-is-dns-ttl-and-how-does-it-impact-my-users"></a>Что такое срок жизни DNS и как он влияет на пользователей?

Когда запрос DNS передается диспетчеру трафика, он задает значение в ответе, который называется сроком жизни (TTL). Это значение, измеряющееся в секундах, указывает подчиненным сопоставителям DNS, в течение какого срока нужно хранить в кэше этот ответ. Хотя сопоставители DNS не всегда сохраняют в кэше этот результат, его кэширование позволяет им отвечать на любые последующие запросы из кэша, а не использовать DNS-серверы диспетчера трафика. Это влияет на ответы следующим образом:
- больший срок жизни уменьшает число запросов, передающихся DNS-серверам диспетчера трафика, что снижает для клиента затраты, так как за запросы, обслуживаемые сервером, взимается плата;
- больший срок жизни может потенциально сократить время, необходимое для выполнения поиска в DNS;
- больший срок жизни также означает, что данные не отражают последние сведения о работоспособности, полученные диспетчером трафика через его агенты проверки.

### <a name="how-high-or-low-can-i-set-the-ttl-for-traffic-manager-responses"></a>Каковы минимальный и максимальный сроки жизни, которые можно задать для ответов диспетчера трафика?

Для каждого уровня профиля вы можете задать срок жизни DNS от 0 до 2 147 483 647 секунд (максимальный диапазон согласно [RFC-1035](https://www.ietf.org/rfc/rfc1035.txt )). Срок жизни 0 означает, что подчиненные сопоставители DNS не сохраняют в кэше ответы на запросы, и все запросы будут передаваться на DNS-серверы диспетчера трафика для разрешения.

## <a name="traffic-manager-geographic-traffic-routing-method"></a>Диспетчер трафика: метод географической маршрутизации трафика

### <a name="what-are-some-use-cases-where-geographic-routing-is-useful"></a>В каких случаях следует использовать географическую маршрутизацию? 
Географическую маршрутизацию можно использовать в любой ситуации, когда клиенту Azure требуется различать пользователей из разных географических регионов. Например, географическая маршрутизация позволяет предоставлять разные интерфейсы пользователям из разных регионов. Другой пример — выполнение предписаний о независимости локальных данных, в соответствии с которыми пользователи из определенного региона должны обслуживаться только конечными точками в этом регионе.

### <a name="what-are-the-regions-that-are-supported-by-traffic-manager-for-geographic-routing"></a>Какие регионы диспетчер трафика поддерживает для географической маршрутизации? 
Иерархию стран или регионов, которую использует диспетчер трафика, см. [здесь](traffic-manager-geographic-regions.md). Эта страница регулярно дополняется при внесении изменений, но эту же информацию можно получить программным способом с помощью [REST API диспетчера трафика Azure](https://docs.microsoft.com/rest/api/trafficmanager/). 

### <a name="how-does-traffic-manager-determine-where-a-user-is-querying-from"></a>Как диспетчер трафика определяет, откуда пользователь обращается к приложению? 
Диспетчер трафика проверяет исходный IP-адрес запроса (скорее всего, это будет локальный сопоставитель DNS, который выполняет запрос от имени пользователя) и использует внутренний IP-адрес на карте регионов, чтобы определить расположение. Эта карта регулярно обновляется с учетом изменений в Интернете. 

### <a name="is-it-guaranteed-that-traffic-manager-can-correctly-determine-the-exact-geographic-location-of-the-user-in-every-case"></a>Есть ли гарантия, что диспетчер трафика правильно определит точное географическое расположение пользователя во всех случаях?
Нет, диспетчер трафика не может гарантировать, что географический регион, который мы вычисляем по IP-адресу отправителя DNS-запроса, всегда будет соответствовать расположению пользователя. Это связано сразу с несколькими причинами. 

- Во-первых, как описано в предыдущем вопросе, полученный нами исходный IP-адрес обычно принадлежит сопоставителю DNS, который выполняет поиск от имени пользователя. Географическое расположение сопоставителя DNS может достаточно точно обозначать географическое местоположение пользователя, но они могут и различаться в зависимости от сферы действия сопоставителя DNS и особенностей конкретной службы сопоставителя DNS, выбранной пользователем. Например, клиент из Малайзии может явным образом указать в настройках устройства некоторую службу сопоставителя DNS, обработку запросов к которой для этого пользователя или устройства будет обрабатывать DNS-сервер, расположенный в Сингапуре. В этом случае диспетчер трафика может только увидеть IP-адрес сопоставителя и определить, что он расположен в Сингапуре. См. также ответ о поддержке адресов подсети клиента, представленный на этой странице.

- Во-вторых, диспетчер трафика использует внутреннюю карту для преобразования IP-адресов в географические регионы. Несмотря на то, что эта карта постоянно проверяется и обновляется, чтобы повысить точность преобразования и учесть постоянные изменения сети Интернет, всегда есть вероятность того, что наши сведения неточно отображают географическое расположение некоторых IP-адресов.


###  <a name="does-an-endpoint-need-to-be-physically-located-in-the-same-region-as-the-one-it-is-configured-with-for-geographic-routing"></a>Должна дли конечная точка физически располагаться в том же регионе, что и регион, с которым она сопоставлена для географической маршрутизации? 
Нет, расположение конечной точки не влияет на регионы, с которыми она может быть сопоставлена. Например, на конечную точку в регионе Azure "Центральная часть США" могут быть направлены все пользователи из Индии.

### <a name="can-i-assign-geographic-regions-to-endpoints-in-a-profile-that-is-not-configured-to-do-geographic-routing"></a>Можно ли назначить географические регионы конечным точкам в профиле, в котором не настроена географическая маршрутизация? 

Да. Если в профиле используется другой метод маршрутизации (отличный от географического), вы можете назначить географические регионы конечным точкам в этом профиле с помощью [REST API диспетчера трафика Azure](https://docs.microsoft.com/rest/api/trafficmanager/). В профилях с негеографической маршрутизацией эта конфигурация игнорируется. Если позднее тип маршрутизации в профиле будет изменен на географический, диспетчер трафика может использовать эти сопоставления.


### <a name="why-am-i-getting-an-error-when-i-try-to-change-the-routing-method-of-an-existing-profile-to-geographic"></a>Почему, когда я пытаюсь изменить метод маршрутизации существующего профиля на географический, возникает ошибка?

Каждая конечная точка в профиле с географической маршрутизацией должна быть сопоставлена как минимум с одним регионом. Чтобы изменить тип маршрутизации в существующем профиле на географический, сначала необходимо связать географические регионы со всеми конечными точками профиля, используя [REST API диспетчера трафика Azure](https://docs.microsoft.com/rest/api/trafficmanager/). Если вы используете портал, сначала удалите конечные точки, измените метод маршрутизации профиля на географический, а затем добавьте конечные точки вместе с сопоставлением с географическим регионом. 


###  <a name="why-is-it-strongly-recommended-that-customers-create-nested-profiles-instead-of-endpoints-under-a-profile-with-geographic-routing-enabled"></a>Почему клиентам настоятельно рекомендуется создавать в профиле с географической маршрутизацией вложенные профили вместо конечных точек? 

Если в профиле используется географическая маршрутизация, регион можно назначить только одной точке в этом профиле. Если это не вложенная конечная точка с дочерним профилем, когда она будет неработоспособна, диспетчер трафика продолжит отправлять на нее трафик. Альтернативное поведение диспетчера в этом случае — не отправлять трафик, что ничем не лучше исходного варианта. Диспетчер трафика не отрабатывает отказ на другую конечную точку, даже если ее назначенный регион является родительским для неработоспособной конечной точки. Например, если конечная точка, которой назначен регион "Испания", становится неработоспособной, отказ не отрабатывается на другую конечную точку, которой назначен регион "Европа". Таким образом диспетчер трафика будет учитывать ограничения, связанные с географическими регионами, которые клиент установил в своем профиле. Чтобы использовать отработку отказа на другую конечную точку, когда конечная точка становится неработоспособной, рекомендуется назначать географические регионы вложенным профилям с несколькими конечными точками, а не отдельным конечным точкам. Таким образом, в случае сбоя конечной точки во вложенном дочернем профиле трафик будет перенаправлен на другую конечную точку в том же профиле.

### <a name="are-there-any-restrictions-on-the-api-version-that-supports-this-routing-type"></a>Существуют ли ограничения на версии API, которые поддерживает этот тип маршрутизации?

Да. Географическую маршрутизацию поддерживают только новые API начиная с версии от 01.03.2017. Все более старые версии API не позволяют создавать профили с географической маршрутизацией и сопоставлять географические регионы с конечными точками. Если вы пытаетесь получить профили из подписки Azure с помощью более старой версии API, профили с географической маршрутизацией не будут возвращены. Кроме того, при использовании старых версий API в возвращенных профилях с конечными точками, которым назначен географический регион, этот регион не отображается.



## <a name="traffic-manager-endpoints"></a>Конечные точки диспетчера трафика

### <a name="can-i-use-traffic-manager-with-endpoints-from-multiple-subscriptions"></a>Можно ли использовать в диспетчере трафика конечные точки из нескольких подписок?

Использование конечных точек из нескольких подписок не поддерживается в веб-приложениях Azure. Для работы веб-приложений Azure требуется, чтобы любое имя пользовательского домена, используемое в них, использовалось только в пределах одной подписки. Невозможно использовать веб-приложения из нескольких подписок с одним и тем же доменным именем.

Для других типов конечных точек можно использовать диспетчер трафика, если эти конечные точки расположены в нескольких подписках. В Resource Manager в диспетчер трафика можно добавить конечные точки из любой подписки при условии, что у пользователя, настраивающего профиль диспетчера трафика, есть доступ на чтение к этим конечным точкам. Эти разрешения можно предоставить с помощью [управления доступом на основе ролей Azure Resource Manager](../active-directory/role-based-access-control-configure.md).


### <a name="can-i-use-traffic-manager-with-cloud-service-staging-slots"></a>Можно ли использовать диспетчер трафика с промежуточными слотами облачной службы?

Да. Промежуточные слоты облачной службы можно настроить в диспетчере трафика в качестве внешних конечных точек. Проверки работоспособности будут по-прежнему оплачиваться по тарифу для конечных точек Azure. Так как тип внешней конечной точки уже используется, изменения основной службы не применяются автоматически. При работе с внешними конечными точками диспетчер трафика не может обнаружить остановку или удаление облачной службы. Таким образом, диспетчер трафика продолжает выставлять счета за проверки работоспособности, пока конечная точка не будет отключена или удалена.

### <a name="does-traffic-manager-support-ipv6-endpoints"></a>Поддерживает ли диспетчер трафика конечные точки IP версии 6?

Диспетчер трафика в настоящее время не предоставляет серверы доменных имен с IPv6-адресованием. Тем не менее диспетчер трафика может использоваться IPv6-клиентами, подключающимся к конечным точкам IPv6. Клиент не отправляет DNS-запросы непосредственно к диспетчеру трафика. Вместо этого клиент использует рекурсивную службу DNS. Клиент, использующий только IPv6, отправляет запросы к рекурсивной службе DNS через IPv6. Затем рекурсивная служба должна иметь возможность связаться с серверами доменных имен диспетчера трафика, используя IPv4-адрес.

Диспетчер трафика возвращает ответ с DNS-именем конечной точки. Для поддержки конечной точки IPv6 должна существовать запись DNS типа AAAA, указывающая DNS-имя конечной точки для IPv6-адреса. Проверки работоспособности диспетчера трафика поддерживают только IPv4-адреса. Служба должна предоставлять конечную точку IPv4 с тем же DNS-именем.

### <a name="can-i-use-traffic-manager-with-more-than-one-web-app-in-the-same-region"></a>Можно ли использовать в диспетчере трафика несколько веб-приложений в одном и том же регионе?

Как правило, диспетчер трафика используется для перенаправления трафика в приложения, развернутые в разных регионах. Тем не менее его также можно использовать с приложениями, у которых есть несколько развертываний в одном и том же регионе. Конечные точки Azure диспетчера трафика не допускают добавление нескольких конечных точек веб-приложения, находящихся в одном и том же регионе Azure, в один и тот же профиль.

##  <a name="traffic-manager-endpoint-monitoring"></a>Мониторинг конечных точек в диспетчере трафика

### <a name="is-traffic-manager-resilient-to-azure-region-failures"></a>Устойчив ли диспетчер трафика к сбоям в регионе Azure?

Диспетчер трафика является ключевым компонентом, обеспечивающим высокую доступность приложений в Azure.
Для обеспечения высокого уровня доступности диспетчер трафика должен иметь исключительно высокий уровень доступности и быть устойчивым к сбоям регионов.

По умолчанию компоненты диспетчера трафика отказоустойчивы к полному сбою любого региона Azure. Эта устойчивость применяется ко всем компонентам диспетчера трафика: DNS-серверам, API-интерфейсам, уровню хранилища и службе мониторинга конечных точек.

В маловероятном случае сбоя всего региона Azure диспетчер трафика должен продолжить нормальную работу. Приложения, развернутые в нескольких регионах Azure, могут положиться на диспетчер трафика, который перенаправит трафик к доступному экземпляру приложения.

### <a name="how-does-the-choice-of-resource-group-location-affect-traffic-manager"></a>Каким образом выбор расположения группы ресурсов влияет на диспетчер трафика?

Диспетчер трафика — это единая глобальная служба. Она не является региональной. Выбор расположения группы ресурсов никак не влияет на профили диспетчера трафика, развернутые в этой группе ресурсов.

Для Azure Resource Manager требуется, чтобы все группы ресурсов указывали расположение, которое определяет расположение по умолчанию для ресурсов, развернутых в этой группе ресурсов. При создании профиля диспетчера трафика он создается в группе ресурсов. Во всех профилях диспетчера трафика в качестве расположения задано значение **Глобальный** (тем самым переопределяется группа ресурсов по умолчанию).

### <a name="how-do-i-determine-the-current-health-of-each-endpoint"></a>Как определить текущую работоспособность каждой конечной точки?

На портале управления Azure отображается текущее состояние мониторинга для каждой конечной точки, а также всего профиля. Эти сведения также можно получить с помощью [REST API](https://msdn.microsoft.com/library/azure/mt163667.aspx) отслеживания трафика, [командлетов PowerShell](https://msdn.microsoft.com/library/mt125941.aspx) и [кроссплатформенного интерфейса командной строки Azure](../cli-install-nodejs.md).

Azure не предоставляет информации о работоспособности конечной точки в прошлом и не позволяет выдавать предупреждения об изменении состояния конечной точки.

### <a name="can-i-monitor-https-endpoints"></a>Можно ли отслеживать конечные точки HTTPS?

Да. Диспетчер трафика поддерживает проверку по протоколу HTTPS. Настройте **HTTPS** в качестве протокола в конфигурации мониторинга.

Диспетчер трафика не может предоставить проверку сертификатов. В частности:

* сертификаты на стороне сервера не проверяются;
* сертификаты SNI на стороне сервера не поддерживаются;
* клиентские сертификаты не поддерживаются.

### <a name="can-i-use-traffic-manager-even-if-my-application-does-not-have-support-for-http-or-https"></a>Могу ли я использовать диспетчер трафика, даже если приложение не поддерживает протоколы HTTP и HTTPS?

Да. Вы можете указать протокол ТСР как протокол мониторинга. Диспетчер трафика запустит подключение TCP и будет ожидать ответ от конечной точки. Если конечная точка отвечает на запрос на подключение ответом на установку подключения (в течение периода ожидания), тогда такая конечная точка помечается как работоспособная.

### <a name="what-specific-responses-are-required-from-the-endpoint-when-using-tcp-monitoring"></a>Какие стоит рассмотреть ответы от конечной точки при использовании протокола ТСР как протокола мониторинга?

При использовании протокола мониторинга ТСР диспетчер трафика запускает трехстороннее подтверждение TCP, отправляя запрос SYN в конечную точку на указанном порте. Затем он определенный период времени (указанный в параметрах времени ожидания) ожидает ответ от конечной точки. Если конечная точка отвечает на запрос SYN ответом SYN-ACK в течение периода ожидания, указанного в параметрах мониторинга, тогда такая конечная точка считается работоспособной. При получении ответа SYN ACK диспетчер трафика сбрасывает подключение, отправляя ответ обратно с помощью RST.

### <a name="how-fast-does-traffic-manager-move-my-users-away-from-an-unhealthy-endpoint"></a>Насколько быстро диспетчер трафика перемещает пользователей из неработоспособной конечной точки?

Диспетчер трафика предоставляет несколько параметров, которые могут помочь в управлении отработкой отказа профиля диспетчера трафика следующим образом:
- Вы можете указать частоту проверки конечных точек диспетчером трафика, задав интервал проверки в 10 секунд. Это позволит обнаружить неработоспособную конечную точку как можно скорее. 
- Вы можете указать время ожидания запроса на проверку работоспособности (минимальное значение — 5 секунд).
- Вы можете указать количество сбоев, по достижении которых конечная точка будет помечена как неработоспособная. Вы можете установить значение от 0. В таком случае конечная точка будет помечена как неработоспособная, как только произойдет первый сбой при проверке работоспособности. Тем не менее использование минимального значения 0 для допустимого числа сбоев может привести к тому, что конечные точки перестанут использоваться из-за любых временных сбоев, которые могут произойти во время проверки.
- Вы можете указать для срока жизни ответа DNS значение от 0. Это означает, что сопоставители DNS не могут кэшировать ответ и каждый новый запрос получает ответ, включающий самые последние сведения о работоспособности, которые содержит диспетчер трафика.

С помощью этих параметров диспетчер трафика может обеспечивать отработку отказа в течение 10 секунд после того, как конечная точка определена как неработоспособная, и запрос DNS выполняется для соответствующего профиля.

### <a name="how-can-i-specify-different-monitoring-settings-for-different-endpoints-in-a-profile"></a>Как я могу указать в профиле другие параметры мониторинга для других конечных точек?

Параметры мониторинга диспетчера трафика заданы для каждого уровня профиля. Если вам нужно использовать другие параметры мониторинга только для одной конечной точки, это можно сделать, если задать эту конечную точку как [вложенный профиль](traffic-manager-nested-profiles.md), параметры мониторинга которого отличаются от родительского профиля.

### <a name="what-host-header-do-endpoint-health-checks-use"></a>Какой заголовок узла используется для проверки работоспособности конечной точки?

Для проверки работоспособности HTTP и HTTPS диспетчер трафика использует заголовки узлов. Заголовок узла, используемый диспетчером трафика, представляет собой имя целевой конечной точки, настроенной в профиле. Значение, используемое в заголовке узла, нельзя использовать отдельно от свойства цели.

### <a name="what-are-the-ip-addresses-from-which-the-health-checks-originate"></a>Что такое IP-адресов, используемые при проверке работоспособности?

Следующий список содержит IP-адреса, с которых диспетчер трафика может запускать проверку работоспособности. Этот список позволяет узнать, разрешены ли входящие подключения от этих адресов на конечных точках для проверки состояния их работоспособности.

* 40.68.30.66
* 40.68.31.178
* 137.135.80.149
* 137.135.82.249
* 23.96.236.252
* 65.52.217.19
* 40.87.147.10
* 40.87.151.34
* 13.75.124.254
* 13.75.127.63
* 52.172.155.168
* 52.172.158.37
* 104.215.91.84
* 13.75.153.124
* 13.84.222.37
* 23.101.191.199
* 23.96.213.12
* 137.135.46.163
* 137.135.47.215
* 191.232.208.52
* 191.232.214.62
* 13.75.152.253
* 104.41.187.209
* 104.41.190.203

### <a name="how-many-health-checks-to-my-endpoint-can-i-expect-from-traffic-manager"></a>Сколько проверок работоспособности конечной точки выполняет диспетчер трафика?

Число проверок работоспособности конечной точки диспетчером трафика зависит от следующих условий:
- Значения, которое вы задали для интервала мониторинга (меньший интервал означает больше запросов, которые передаются в конечную точку за любой указанный период времени).
- Количества расположений, из которых выполняются проверки работоспособности (IP-адреса, с которых диспетчер трафика может запускать проверку работоспособности, перечислены выше в часто задаваемых вопросах).

## <a name="traffic-manager-nested-profiles"></a>Вложенные профили диспетчера трафика

### <a name="how-do-i-configure-nested-profiles"></a>Как настроить вложенные профили?

Вложенные профили диспетчера трафика можно настроить с помощью Azure Resource Manager (ARM), классических интерфейсов REST API Azure, командлетов Azure PowerShell и команд кроссплатформенного интерфейса командной строки Azure. Они также поддерживаются на новом портале Azure. Вложенные профили не поддерживаются на классическом портале.

### <a name="how-many-layers-of-nesting-does-traffic-manger-support"></a>Число уровней вложенности поддерживает диспетчер трафика?

Вложенность профилей может достигать 10 уровней. Нельзя использовать циклы (петли).

### <a name="can-i-mix-other-endpoint-types-with-nested-child-profiles-in-the-same-traffic-manager-profile"></a>Можно ли совмещать конечные точки других типов с вложенными дочерними профилями в одном профиле диспетчера трафика?

Да. Можно без каких-либо ограничений комбинировать в профиле конечные точки разных типов.

### <a name="how-does-the-billing-model-apply-for-nested-profiles"></a>Как модель выставления счетов применяется к вложенным профилям?

Использование вложенных профилей не приводит к повышению цен.

При выставлении счетов за использование диспетчера трафика учитываются два фактора: проверки работоспособности конечных точек и число запросов DNS (миллионы).

* Проверки работоспособности конечных точек: плата за дочерний профиль не взимается, если он настроен как конечная точка в родительском профиле. Мониторинг конечных точек в дочернем профиле тарифицируется обычным образом.
* Запросы DNS: каждый запрос учитывается только один раз. Запрос к родительскому профилю, который возвращает конечную точку из дочернего профиля, тарифицируется только для родительского профиля.

Подробнее см. на [странице цен для диспетчера трафика](https://azure.microsoft.com/pricing/details/traffic-manager/).

### <a name="is-there-a-performance-impact-for-nested-profiles"></a>Снижают ли вложенные профили производительность?

Нет. Использование вложенных профилей не отражается на производительности.

Серверы имен диспетчера трафика используют внутренний механизм опроса иерархии профилей при обработке каждого запроса DNS. На запрос DNS к родительскому профилю может предоставляться ответ DNS, указывающий на конечную точку дочернего профиля. Как для отдельного профиля, так и для вложенных профилей достаточно одной записи CNAME. Нет необходимости создавать запись CNAME для каждого профиля в иерархии.

### <a name="how-does-traffic-manager-compute-the-health-of-a-nested-endpoint-in-a-parent-profile"></a>Как диспетчер трафика вычисляет работоспособность вложенной конечной точки в родительском профиле?

Родительский профиль не проверяет состояние дочерних элементов напрямую. Вместо этого вычисляется общая характеристика работоспособности для дочернего профиля с учетом состояния работоспособности всех конечных точек этого профиля. Эта информация передается вверх по иерархии вложенных профилей для определения работоспособности вложенных конечных точек. Родительский профиль использует сводные данные о работоспособности и определяет, можно ли передавать трафик в дочерний профиль.

В следующей таблице описан алгоритм диспетчера трафика для проверки работоспособности вложенной конечной точки.

| Состояние монитора дочернего профиля | Состояние монитора родительской конечной точки | Примечания |
| --- | --- | --- |
| "Отключено". Дочерний профиль отключен. |Остановлен |Состояние родительской конечной точки — «Остановлено», а не «Отключено». Состояние «Отключено» указывает, что вы отключили конечную точку в родительском профиле. |
| "Пониженная функциональность". Как минимум одна конечная точка дочернего профиля находится в состоянии пониженной функциональности. |"В сети": количество конечных точек в дочернем профиле, находящихся в состоянии "В сети", не меньше значения MinChildEndpoints.<BR>"Проверка конечной точки": сумма конечных точек в дочернем профиле, находящихся в состояниях "В сети" и "Проверка конечной точки", не меньше значения MinChildEndpoints.<BR>В противном случае: "Пониженная функциональность". |Трафик перенаправляется к конечной точке с состоянием "Проверка конечной точки". Если задано слишком большое значение MinChildEndpoints, функциональность конечной точки будет понижена. |
| В сети. Как минимум одна конечная точка дочернего профиля находится в подключенном состоянии. Нет конечных точек в состоянии пониженной функциональности. |См. выше. | |
| "Проверка конечных точек". Как минимум одна конечная точка дочернего профиля находится в состоянии проверки конечной точки. Нет конечных точек в подключенном состоянии или в состоянии пониженной функциональности. |То же, что и выше. | |
| "Неактивно". Все конечные точки дочернего профиля находятся в отключенном или остановленном состоянии либо в этом профиле нет конечных точек. |Остановлено | |

## <a name="next-steps"></a>Дальнейшие действия:
- См. дополнительные сведения в статье [Мониторинг и отработка отказов конечной точки диспетчера трафика](../traffic-manager/traffic-manager-monitoring.md).
- См. дополнительные сведения в статье [Методы маршрутизации трафика диспетчером трафика](../traffic-manager/traffic-manager-routing-methods.md).