---
title: "Диспетчер трафика Azure: вопросы и ответы | Документация Майкрософт"
description: "Эта статья содержит ответы на часто задаваемые вопросы о диспетчере трафика Azure"
services: traffic-manager
documentationcenter: 
author: kumudd
manager: timlt
editor: 
ms.assetid: 75d5ff9a-f4b9-4b05-af32-700e7bdfea5a
ms.service: traffic-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 06/15/2017
ms.author: kumud
ms.openlocfilehash: 44762864e0a5adf568fcd4928b48661196f05b9e
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="traffic-manager-frequently-asked-questions-faq"></a><span data-ttu-id="fceae-103">Диспетчер трафика Azure: вопросы и ответы</span><span class="sxs-lookup"><span data-stu-id="fceae-103">Traffic Manager Frequently Asked Questions (FAQ)</span></span>

## <a name="traffic-manager-basics"></a><span data-ttu-id="fceae-104">Основные сведения о диспетчере трафика</span><span class="sxs-lookup"><span data-stu-id="fceae-104">Traffic Manager basics</span></span>

### <a name="what-ip-address-does-traffic-manager-use"></a><span data-ttu-id="fceae-105">Какой IP-адрес использует диспетчер трафика?</span><span class="sxs-lookup"><span data-stu-id="fceae-105">What IP address does Traffic Manager use?</span></span>

<span data-ttu-id="fceae-106">В [обзоре диспетчера трафика How Traffic Manager Works](../traffic-manager/traffic-manager-overview.md#how-traffic-manager-works) объясняется, что диспетчер трафика работает на уровне DNS.</span><span class="sxs-lookup"><span data-stu-id="fceae-106">As explained in [How Traffic Manager Works](../traffic-manager/traffic-manager-overview.md#how-traffic-manager-works), Traffic Manager works at the DNS level.</span></span> <span data-ttu-id="fceae-107">Он использует ответы DNS, чтобы направлять клиентов в соответствующую конечную точку службы.</span><span class="sxs-lookup"><span data-stu-id="fceae-107">It sends DNS responses to direct clients to the appropriate service endpoint.</span></span> <span data-ttu-id="fceae-108">Клиенты подключаются к конечной точке службы приложения напрямую, а не через диспетчер трафика.</span><span class="sxs-lookup"><span data-stu-id="fceae-108">Clients then connect to the service endpoint directly, not through Traffic Manager.</span></span>

<span data-ttu-id="fceae-109">Следовательно, диспетчер трафика не предоставляет конечную точку или IP-адрес для подключения клиентов.</span><span class="sxs-lookup"><span data-stu-id="fceae-109">Therefore, Traffic Manager does not provide an endpoint or IP address for clients to connect to.</span></span> <span data-ttu-id="fceae-110">Если, например, вашей службе требуется статический IP-адрес, он должен быть настроен на уровне службы, а не в диспетчере трафика.</span><span class="sxs-lookup"><span data-stu-id="fceae-110">Therefore, if you want static IP address for your service, that must be configured at the service, not in Traffic Manager.</span></span>

### <a name="does-traffic-manager-support-sticky-sessions"></a><span data-ttu-id="fceae-111">Поддерживает ли диспетчер трафика прикрепленные сеансы?</span><span class="sxs-lookup"><span data-stu-id="fceae-111">Does Traffic Manager support 'sticky' sessions?</span></span>

<span data-ttu-id="fceae-112">В [обзоре диспетчера трафика How Traffic Manager Works](../traffic-manager/traffic-manager-overview.md#how-traffic-manager-works) объясняется, что диспетчер трафика работает на уровне DNS.</span><span class="sxs-lookup"><span data-stu-id="fceae-112">As explained in [How Traffic Manager Works](../traffic-manager/traffic-manager-overview.md#how-traffic-manager-works), Traffic Manager works at the DNS level.</span></span> <span data-ttu-id="fceae-113">Он использует ответы DNS для направления клиентов на соответствующую конечную точку службы.</span><span class="sxs-lookup"><span data-stu-id="fceae-113">It uses DNS responses to direct clients to the appropriate service endpoint.</span></span> <span data-ttu-id="fceae-114">Клиенты подключаются к конечной точке службы приложения напрямую, а не через диспетчер трафика.</span><span class="sxs-lookup"><span data-stu-id="fceae-114">Clients connect to the service endpoint directly, not through Traffic Manager.</span></span> <span data-ttu-id="fceae-115">Таким образом, диспетчер трафика не может отслеживать HTTP-трафик, проходящий между клиентом и сервером.</span><span class="sxs-lookup"><span data-stu-id="fceae-115">Therefore, Traffic Manager does not see the HTTP traffic between the client and the server.</span></span>

<span data-ttu-id="fceae-116">Кроме того, исходный IP-адрес, откуда диспетчер трафика получает запрос DNS, принадлежит рекурсивной службе DNS, а не клиенту.</span><span class="sxs-lookup"><span data-stu-id="fceae-116">Additionally, the source IP address of the DNS query received by Traffic Manager belongs to the recursive DNS service, not the client.</span></span> <span data-ttu-id="fceae-117">Это значит, что диспетчер трафика не может отслеживать отдельные клиенты и не может реализовывать прикрепленные сеансы.</span><span class="sxs-lookup"><span data-stu-id="fceae-117">Therefore, Traffic Manager has no way to track individual clients and cannot implement 'sticky' sessions.</span></span> <span data-ttu-id="fceae-118">Это общее ограничение для всех систем управления трафиком на основе DNS, а не особенность диспетчера трафика.</span><span class="sxs-lookup"><span data-stu-id="fceae-118">This limitation is common to all DNS-based traffic management systems and is not specific to Traffic Manager.</span></span>

### <a name="why-am-i-seeing-an-http-error-when-using-traffic-manager"></a><span data-ttu-id="fceae-119">Почему при использовании диспетчера трафика отображается HTTP-ошибка?</span><span class="sxs-lookup"><span data-stu-id="fceae-119">Why am I seeing an HTTP error when using Traffic Manager?</span></span>

<span data-ttu-id="fceae-120">В [обзоре диспетчера трафика How Traffic Manager Works](../traffic-manager/traffic-manager-overview.md#how-traffic-manager-works) объясняется, что диспетчер трафика работает на уровне DNS.</span><span class="sxs-lookup"><span data-stu-id="fceae-120">As explained in [How Traffic Manager Works](../traffic-manager/traffic-manager-overview.md#how-traffic-manager-works), Traffic Manager works at the DNS level.</span></span> <span data-ttu-id="fceae-121">Он использует ответы DNS для направления клиентов на соответствующую конечную точку службы.</span><span class="sxs-lookup"><span data-stu-id="fceae-121">It uses DNS responses to direct clients to the appropriate service endpoint.</span></span> <span data-ttu-id="fceae-122">Клиенты подключаются к конечной точке службы приложения напрямую, а не через диспетчер трафика.</span><span class="sxs-lookup"><span data-stu-id="fceae-122">Clients then connect to the service endpoint directly, not through Traffic Manager.</span></span> <span data-ttu-id="fceae-123">Диспетчер трафика не видит трафик HTTP, проходящий между клиентом и сервером.</span><span class="sxs-lookup"><span data-stu-id="fceae-123">Traffic Manager does not see HTTP traffic between client and server.</span></span> <span data-ttu-id="fceae-124">Это значит, что все отображаемые HTTP-ошибки создаются приложением.</span><span class="sxs-lookup"><span data-stu-id="fceae-124">Therefore, any HTTP error you see must be coming from your application.</span></span> <span data-ttu-id="fceae-125">Если клиент подключился к приложению, значит все действия по разрешению имен DNS уже успешно выполнены.</span><span class="sxs-lookup"><span data-stu-id="fceae-125">For the client to connect to the application, all DNS resolution steps are complete.</span></span> <span data-ttu-id="fceae-126">Сюда входят также действия, выполняемые диспетчером в отношении трафика приложения.</span><span class="sxs-lookup"><span data-stu-id="fceae-126">That includes any interaction that Traffic Manager has on the application traffic flow.</span></span>

<span data-ttu-id="fceae-127">Таким образом, вам следует проанализировать возможные проблемы на уровне приложения.</span><span class="sxs-lookup"><span data-stu-id="fceae-127">Further investigation should therefore focus on the application.</span></span>

<span data-ttu-id="fceae-128">Чаще всего проблемы возникают из-за HTTP-заголовка Host в запросе, который отправляет браузер пользователя.</span><span class="sxs-lookup"><span data-stu-id="fceae-128">The HTTP host header sent from the client's browser is the most common source of problems.</span></span> <span data-ttu-id="fceae-129">Убедитесь, что приложение правильно обрабатывает заголовок с используемым вами доменным именем.</span><span class="sxs-lookup"><span data-stu-id="fceae-129">Make sure that the application is configured to accept the correct host header for the domain name you are using.</span></span> <span data-ttu-id="fceae-130">Если конечная точка размещается в службе приложений Azure, см. статью [Настройка личного доменного имени для веб-приложения в службе приложений Azure, использующей диспетчер трафика](../app-service-web/web-sites-traffic-manager-custom-domain-name.md).</span><span class="sxs-lookup"><span data-stu-id="fceae-130">For endpoints using the Azure App Service, see [configuring a custom domain name for a web app in Azure App Service using Traffic Manager](../app-service-web/web-sites-traffic-manager-custom-domain-name.md).</span></span>

### <a name="what-is-the-performance-impact-of-using-traffic-manager"></a><span data-ttu-id="fceae-131">Как сказывается на производительности использование диспетчера трафика?</span><span class="sxs-lookup"><span data-stu-id="fceae-131">What is the performance impact of using Traffic Manager?</span></span>

<span data-ttu-id="fceae-132">В [обзоре диспетчера трафика How Traffic Manager Works](../traffic-manager/traffic-manager-overview.md#how-traffic-manager-works) объясняется, что диспетчер трафика работает на уровне DNS.</span><span class="sxs-lookup"><span data-stu-id="fceae-132">As explained in [How Traffic Manager Works](../traffic-manager/traffic-manager-overview.md#how-traffic-manager-works), Traffic Manager works at the DNS level.</span></span> <span data-ttu-id="fceae-133">Так как клиенты подключаются к конечным точкам службы напрямую, использование диспетчера трафика при установленном соединении никак не влияет на производительность.</span><span class="sxs-lookup"><span data-stu-id="fceae-133">Since clients connect to your service endpoints directly, there is no performance impact incurred when using Traffic Manager once the connection is established.</span></span>

<span data-ttu-id="fceae-134">Диспетчер трафика интегрируется с приложениями на уровне DNS, поэтому в цепочку разрешения DNS включается дополнительный поиск DNS.</span><span class="sxs-lookup"><span data-stu-id="fceae-134">Since Traffic Manager integrates with applications at the DNS level, it does require an additional DNS lookup to be inserted into the DNS resolution chain.</span></span> <span data-ttu-id="fceae-135">Диспетчер трафика оказывает минимальное влияние на время разрешения DNS.</span><span class="sxs-lookup"><span data-stu-id="fceae-135">The impact of Traffic Manager on DNS resolution time is minimal.</span></span> <span data-ttu-id="fceae-136">Диспетчер трафика использует глобальную сеть серверов доменных имен и сетевую службу [произвольной рассылки](https://en.wikipedia.org/wiki/Anycast), обеспечивая передачу запросов DNS на ближайший доступный сервер доменных имен.</span><span class="sxs-lookup"><span data-stu-id="fceae-136">Traffic Manager uses a global network of name servers, and uses [anycast](https://en.wikipedia.org/wiki/Anycast) networking to ensure DNS queries are always routed to the closest available name server.</span></span> <span data-ttu-id="fceae-137">Кроме того, кэширование DNS-ответов означает, что дополнительные задержки DNS, связанные с использованием диспетчера трафика, происходят только в некоторых сеансах.</span><span class="sxs-lookup"><span data-stu-id="fceae-137">In addition, caching of DNS responses means that the additional DNS latency incurred by using Traffic Manager applies only to a fraction of sessions.</span></span>

<span data-ttu-id="fceae-138">В ходе маршрутизации по производительности трафик направляется в ближайшую доступную конечную точку.</span><span class="sxs-lookup"><span data-stu-id="fceae-138">The Performance method routes traffic to the closest available endpoint.</span></span> <span data-ttu-id="fceae-139">В итоге этот метод маршрутизации оказывает минимальное влияние на общую производительность.</span><span class="sxs-lookup"><span data-stu-id="fceae-139">The net result is that the overall performance impact associated with this method should be minimal.</span></span> <span data-ttu-id="fceae-140">Возможное повышение задержки DNS будет компенсироваться снижением задержки сети при взаимодействии с конечной точкой.</span><span class="sxs-lookup"><span data-stu-id="fceae-140">Any increase in DNS latency should be offset by lower network latency to the endpoint.</span></span>

### <a name="what-application-protocols-can-i-use-with-traffic-manager"></a><span data-ttu-id="fceae-141">Какие протоколы приложения пригодны для использования с диспетчером трафика?</span><span class="sxs-lookup"><span data-stu-id="fceae-141">What application protocols can I use with Traffic Manager?</span></span>

<span data-ttu-id="fceae-142">В [обзоре диспетчера трафика How Traffic Manager Works](../traffic-manager/traffic-manager-overview.md#how-traffic-manager-works) объясняется, что диспетчер трафика работает на уровне DNS.</span><span class="sxs-lookup"><span data-stu-id="fceae-142">As explained in [How Traffic Manager Works](../traffic-manager/traffic-manager-overview.md#how-traffic-manager-works), Traffic Manager works at the DNS level.</span></span> <span data-ttu-id="fceae-143">После завершения поиска DNS клиенты подключаются к конечной точке приложения напрямую, а не через диспетчер трафика.</span><span class="sxs-lookup"><span data-stu-id="fceae-143">Once the DNS lookup is complete, clients connect to the application endpoint directly, not through Traffic Manager.</span></span> <span data-ttu-id="fceae-144">Следовательно, это подключение может использовать любой протокол приложения.</span><span class="sxs-lookup"><span data-stu-id="fceae-144">Therefore, the connection can use any application protocol.</span></span> <span data-ttu-id="fceae-145">Если выбрать протокол ТСР в качестве протокола мониторинга, мониторинг работоспособности конечной точки диспетчера трафика можно выполнить без использования любых протоколов приложения.</span><span class="sxs-lookup"><span data-stu-id="fceae-145">If you select TCP as the monitoring protocol, Traffic Manager's endpoint health monitoring can be done without using any application protocols.</span></span> <span data-ttu-id="fceae-146">Если для проверки работоспособности вы выбираете протокол приложения, конечная точка должна отвечать на HTTP- или HTTPS-запросы GET.</span><span class="sxs-lookup"><span data-stu-id="fceae-146">If you choose to have the health verified using an application protocol, the endpoint needs to be able to respond to either HTTP or HTTPS GET requests.</span></span>

### <a name="can-i-use-traffic-manager-with-a-naked-domain-name"></a><span data-ttu-id="fceae-147">Можно ли использовать диспетчер трафика с "голым" доменным именем (без префикса www)?</span><span class="sxs-lookup"><span data-stu-id="fceae-147">Can I use Traffic Manager with a 'naked' domain name?</span></span>

<span data-ttu-id="fceae-148">Нет.</span><span class="sxs-lookup"><span data-stu-id="fceae-148">No.</span></span> <span data-ttu-id="fceae-149">Стандарты DNS не допускают существование записей CNAME и других записей DNS для одного доменного имени.</span><span class="sxs-lookup"><span data-stu-id="fceae-149">The DNS standards do not permit CNAMEs to co-exist with other DNS records of the same name.</span></span> <span data-ttu-id="fceae-150">Для верхнего (корневого) имени в любой зоне DNS всегда определены две записи DNS — SOA и NS (для полномочных серверов доменных имен).</span><span class="sxs-lookup"><span data-stu-id="fceae-150">The apex (or root) of a DNS zone always contains two pre-existing DNS records; the SOA and the authoritative NS records.</span></span> <span data-ttu-id="fceae-151">Это означает, что на вершине зоны нельзя создать запись CNAME, не нарушив стандарты DNS.</span><span class="sxs-lookup"><span data-stu-id="fceae-151">This means a CNAME record cannot be created at the zone apex without violating the DNS standards.</span></span>

<span data-ttu-id="fceae-152">Для работы диспетчера трафика обязательно требуется запись DNS CNAME для сопоставления с личным именем DNS.</span><span class="sxs-lookup"><span data-stu-id="fceae-152">Traffic Manager requires a DNS CNAME record to map the vanity DNS name.</span></span> <span data-ttu-id="fceae-153">Например, вы можете сопоставить www.contoso.com с именем DNS профиля диспетчера трафика contoso.trafficmanager.net.</span><span class="sxs-lookup"><span data-stu-id="fceae-153">For example, you map www.contoso.com to the Traffic Manager profile DNS name contoso.trafficmanager.net.</span></span> <span data-ttu-id="fceae-154">Кроме того, профиль диспетчера трафика возвращает еще одну запись DNS CNAME, которая указывает клиенту конечную точку для подключения.</span><span class="sxs-lookup"><span data-stu-id="fceae-154">Additionally, the Traffic Manager profile returns a second DNS CNAME to indicate which endpoint the client should connect to.</span></span>

<span data-ttu-id="fceae-155">Чтобы решить эту проблему, мы рекомендуем выполнить перенаправление HTTP с "голого" доменного имени на другой URL-адрес, который затем можно использовать с диспетчером трафика.</span><span class="sxs-lookup"><span data-stu-id="fceae-155">To work around this issue, we recommend using an HTTP redirect to direct traffic from the naked domain name to a different URL, which can then use Traffic Manager.</span></span> <span data-ttu-id="fceae-156">Например, можно перенаправлять пользователей с доменного имени contoso.com на адрес www.contoso.com, для которого указана запись CNAME, ведущая к доменному имени диспетчера трафика.</span><span class="sxs-lookup"><span data-stu-id="fceae-156">For example, the naked domain 'contoso.com' can redirect users to the CNAME 'www.contoso.com' that points to the Traffic Manager DNS name.</span></span>

<span data-ttu-id="fceae-157">Полная поддержка таких доменов в диспетчере трафика отслеживается в списке подготавливаемых функций.</span><span class="sxs-lookup"><span data-stu-id="fceae-157">Full support for naked domains in Traffic Manager is tracked in our feature backlog.</span></span> <span data-ttu-id="fceae-158">Если вас интересует эта функция, [проголосуйте за нее на нашем сайте обратной связи](https://feedback.azure.com/forums/217313-networking/suggestions/5485350-support-apex-naked-domains-more-seamlessly).</span><span class="sxs-lookup"><span data-stu-id="fceae-158">You can register your support for this feature request by [voting for it on our community feedback site](https://feedback.azure.com/forums/217313-networking/suggestions/5485350-support-apex-naked-domains-more-seamlessly).</span></span>

### <a name="does-traffic-manager-consider-the-client-subnet-address-when-handling-dns-queries"></a><span data-ttu-id="fceae-159">Учитывает ли диспетчер трафика адрес подсети клиента при обработке запросов DNS?</span><span class="sxs-lookup"><span data-stu-id="fceae-159">Does Traffic Manager consider the client subnet address when handling DNS queries?</span></span> 
<span data-ttu-id="fceae-160">Нет, сейчас диспетчер трафика учитывает только исходный IP-адрес полученного DNS-запроса. Обычно это IP-адрес сопоставителя DNS, выполняющего запросы для маршрутизации по производительности или географической маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="fceae-160">No, currently Traffic Manager considers only the source IP address of the DNS query it receives, which usually is the IP address of the DNS resolver, when performing lookups for Geographic and Performance routing methods.</span></span>  
<span data-ttu-id="fceae-161">В частности, диспетчер трафика пока не поддерживает стандарт [7871 RFC — подсети клиента в запросах DNS](https://tools.ietf.org/html/rfc7871), который предоставляет [механизм расширения для DNS (EDNS0)](https://tools.ietf.org/html/rfc2671), позволяющий сопоставителю передавать адрес поддерживаемых подсетей клиента на DNS-сервер.</span><span class="sxs-lookup"><span data-stu-id="fceae-161">Specifically, [RFC 7871 – Client Subnet in DNS Queries](https://tools.ietf.org/html/rfc7871) that provides an [Extension Mechanism for DNS (EDNS0)](https://tools.ietf.org/html/rfc2671) which can pass on the client subnet address from resolvers that support it to DNS servers is currently not supported in Traffic Manager.</span></span> <span data-ttu-id="fceae-162">Если вас интересует эта функция, [поддержите запрос на ее реализацию на нашем сайте обратной связи](https://feedback.azure.com/forums/217313-networking).</span><span class="sxs-lookup"><span data-stu-id="fceae-162">You can register your support for this feature request through our [community feedback site](https://feedback.azure.com/forums/217313-networking).</span></span>


### <a name="what-is-dns-ttl-and-how-does-it-impact-my-users"></a><span data-ttu-id="fceae-163">Что такое срок жизни DNS и как он влияет на пользователей?</span><span class="sxs-lookup"><span data-stu-id="fceae-163">What is DNS TTL and how does it impact my users?</span></span>

<span data-ttu-id="fceae-164">Когда запрос DNS передается диспетчеру трафика, он задает значение в ответе, который называется сроком жизни (TTL).</span><span class="sxs-lookup"><span data-stu-id="fceae-164">When a DNS query lands on Traffic Manager, it sets a value in the response called time-to-live (TTL).</span></span> <span data-ttu-id="fceae-165">Это значение, измеряющееся в секундах, указывает подчиненным сопоставителям DNS, в течение какого срока нужно хранить в кэше этот ответ.</span><span class="sxs-lookup"><span data-stu-id="fceae-165">This value, whose unit is in seconds, indicates to DNS resolvers downstream on how long to cache this response.</span></span> <span data-ttu-id="fceae-166">Хотя сопоставители DNS не всегда сохраняют в кэше этот результат, его кэширование позволяет им отвечать на любые последующие запросы из кэша, а не использовать DNS-серверы диспетчера трафика.</span><span class="sxs-lookup"><span data-stu-id="fceae-166">While DNS resolvers are not guaranteed to cache this result, caching it enables them to respond to any subsequent queries off the cache instead of going to Traffic Manager DNS servers.</span></span> <span data-ttu-id="fceae-167">Это влияет на ответы следующим образом:</span><span class="sxs-lookup"><span data-stu-id="fceae-167">This impacts the responses as follows:</span></span>
- <span data-ttu-id="fceae-168">больший срок жизни уменьшает число запросов, передающихся DNS-серверам диспетчера трафика, что снижает для клиента затраты, так как за запросы, обслуживаемые сервером, взимается плата;</span><span class="sxs-lookup"><span data-stu-id="fceae-168">a higher TTL reduces the number of queries that land on the Traffic Manager DNS servers, which can reduce the cost for a customer since number of queries served is a billable usage.</span></span>
- <span data-ttu-id="fceae-169">больший срок жизни может потенциально сократить время, необходимое для выполнения поиска в DNS;</span><span class="sxs-lookup"><span data-stu-id="fceae-169">a higher TTL can potentially reduce the time it takes to do a DNS lookup.</span></span>
- <span data-ttu-id="fceae-170">больший срок жизни также означает, что данные не отражают последние сведения о работоспособности, полученные диспетчером трафика через его агенты проверки.</span><span class="sxs-lookup"><span data-stu-id="fceae-170">a higher TTL also means that your data does not reflect the latest health information that Traffic Manager has obtained through its probing agents.</span></span>

### <a name="how-high-or-low-can-i-set-the-ttl-for-traffic-manager-responses"></a><span data-ttu-id="fceae-171">Каковы минимальный и максимальный сроки жизни, которые можно задать для ответов диспетчера трафика?</span><span class="sxs-lookup"><span data-stu-id="fceae-171">How high or low can I set the TTL for Traffic Manager responses?</span></span>

<span data-ttu-id="fceae-172">Для каждого уровня профиля вы можете задать срок жизни DNS от 0 до 2 147 483 647 секунд (максимальный диапазон согласно [RFC-1035](https://www.ietf.org/rfc/rfc1035.txt )).</span><span class="sxs-lookup"><span data-stu-id="fceae-172">You can set, at a per profile level, the DNS TTL to be as low as 0 seconds and as high as 2,147,483,647 seconds (the maximum range compliant with [RFC-1035](https://www.ietf.org/rfc/rfc1035.txt )).</span></span> <span data-ttu-id="fceae-173">Срок жизни 0 означает, что подчиненные сопоставители DNS не сохраняют в кэше ответы на запросы, и все запросы будут передаваться на DNS-серверы диспетчера трафика для разрешения.</span><span class="sxs-lookup"><span data-stu-id="fceae-173">A TTL of 0 means that downstream DNS resolvers do not cache query responses and all queries are expected to reach the Traffic Manager DNS servers for resolution.</span></span>

## <a name="traffic-manager-geographic-traffic-routing-method"></a><span data-ttu-id="fceae-174">Диспетчер трафика: метод географической маршрутизации трафика</span><span class="sxs-lookup"><span data-stu-id="fceae-174">Traffic Manager Geographic traffic routing method</span></span>

### <a name="what-are-some-use-cases-where-geographic-routing-is-useful"></a><span data-ttu-id="fceae-175">В каких случаях следует использовать географическую маршрутизацию?</span><span class="sxs-lookup"><span data-stu-id="fceae-175">What are some use cases where geographic routing is useful?</span></span> 
<span data-ttu-id="fceae-176">Географическую маршрутизацию можно использовать в любой ситуации, когда клиенту Azure требуется различать пользователей из разных географических регионов.</span><span class="sxs-lookup"><span data-stu-id="fceae-176">Geographic routing type can be used in any scenario where an Azure customer needs to distinguish their users based on geographic regions.</span></span> <span data-ttu-id="fceae-177">Например, географическая маршрутизация позволяет предоставлять разные интерфейсы пользователям из разных регионов.</span><span class="sxs-lookup"><span data-stu-id="fceae-177">For example, using the Geographic traffic routing method, you can give users from specific regions a different user experience than those from other regions.</span></span> <span data-ttu-id="fceae-178">Другой пример — выполнение предписаний о независимости локальных данных, в соответствии с которыми пользователи из определенного региона должны обслуживаться только конечными точками в этом регионе.</span><span class="sxs-lookup"><span data-stu-id="fceae-178">Another example is complying with local data sovereignty mandates that require that users from a specific region be served only by endpoints in that region.</span></span>

### <a name="what-are-the-regions-that-are-supported-by-traffic-manager-for-geographic-routing"></a><span data-ttu-id="fceae-179">Какие регионы диспетчер трафика поддерживает для географической маршрутизации?</span><span class="sxs-lookup"><span data-stu-id="fceae-179">What are the regions that are supported by Traffic Manager for geographic routing?</span></span> 
<span data-ttu-id="fceae-180">Иерархию стран или регионов, которую использует диспетчер трафика, см. [здесь](traffic-manager-geographic-regions.md).</span><span class="sxs-lookup"><span data-stu-id="fceae-180">The country/region hierarchy that is used by Traffic Manager can be found [here](traffic-manager-geographic-regions.md).</span></span> <span data-ttu-id="fceae-181">Эта страница регулярно дополняется при внесении изменений, но эту же информацию можно получить программным способом с помощью [REST API диспетчера трафика Azure](https://docs.microsoft.com/rest/api/trafficmanager/).</span><span class="sxs-lookup"><span data-stu-id="fceae-181">While this page is kept up-to-date with any changes, you can also programmatically retrieve the same information by using the [Azure Traffic Manager REST API](https://docs.microsoft.com/rest/api/trafficmanager/).</span></span> 

### <a name="how-does-traffic-manager-determine-where-a-user-is-querying-from"></a><span data-ttu-id="fceae-182">Как диспетчер трафика определяет, откуда пользователь обращается к приложению?</span><span class="sxs-lookup"><span data-stu-id="fceae-182">How does traffic manager determine where a user is querying from?</span></span> 
<span data-ttu-id="fceae-183">Диспетчер трафика проверяет исходный IP-адрес запроса (скорее всего, это будет локальный сопоставитель DNS, который выполняет запрос от имени пользователя) и использует внутренний IP-адрес на карте регионов, чтобы определить расположение.</span><span class="sxs-lookup"><span data-stu-id="fceae-183">Traffic Manager looks at the source IP of the query (this most likely is a local DNS resolver doing the querying on behalf of the user) and uses an internal IP to region map to determine the location.</span></span> <span data-ttu-id="fceae-184">Эта карта регулярно обновляется с учетом изменений в Интернете.</span><span class="sxs-lookup"><span data-stu-id="fceae-184">This map is updated on an ongoing basis to account for changes in the internet.</span></span> 

### <a name="is-it-guaranteed-that-traffic-manager-can-correctly-determine-the-exact-geographic-location-of-the-user-in-every-case"></a><span data-ttu-id="fceae-185">Есть ли гарантия, что диспетчер трафика правильно определит точное географическое расположение пользователя во всех случаях?</span><span class="sxs-lookup"><span data-stu-id="fceae-185">Is it guaranteed that Traffic Manager can correctly determine the exact geographic location of the user in every case?</span></span>
<span data-ttu-id="fceae-186">Нет, диспетчер трафика не может гарантировать, что географический регион, который мы вычисляем по IP-адресу отправителя DNS-запроса, всегда будет соответствовать расположению пользователя. Это связано сразу с несколькими причинами.</span><span class="sxs-lookup"><span data-stu-id="fceae-186">No, Traffic Manager cannot guarantee that the geographic region we infer from the source IP address of a DNS query will always correspond to the user’s location due to the following reasons:</span></span> 

- <span data-ttu-id="fceae-187">Во-первых, как описано в предыдущем вопросе, полученный нами исходный IP-адрес обычно принадлежит сопоставителю DNS, который выполняет поиск от имени пользователя.</span><span class="sxs-lookup"><span data-stu-id="fceae-187">First, as described in the previous FAQ, the source IP address we see is that of a DNS resolver doing the lookup on behalf of the user.</span></span> <span data-ttu-id="fceae-188">Географическое расположение сопоставителя DNS может достаточно точно обозначать географическое местоположение пользователя, но они могут и различаться в зависимости от сферы действия сопоставителя DNS и особенностей конкретной службы сопоставителя DNS, выбранной пользователем.</span><span class="sxs-lookup"><span data-stu-id="fceae-188">While the geographic location of the DNS resolver is a good proxy for the geographic location of the user, it can also be different depending upon the footprint of the DNS resolver service and the specific DNS resolver service a customer has chosen to use.</span></span> <span data-ttu-id="fceae-189">Например, клиент из Малайзии может явным образом указать в настройках устройства некоторую службу сопоставителя DNS, обработку запросов к которой для этого пользователя или устройства будет обрабатывать DNS-сервер, расположенный в Сингапуре.</span><span class="sxs-lookup"><span data-stu-id="fceae-189">As an example, a customer located in Malaysia could specify in their device’s settings use a DNS resolver service whose DNS server in Singapore might get picked to handle the query resolutions for that user/device.</span></span> <span data-ttu-id="fceae-190">В этом случае диспетчер трафика может только увидеть IP-адрес сопоставителя и определить, что он расположен в Сингапуре.</span><span class="sxs-lookup"><span data-stu-id="fceae-190">In that case, Traffic Manager can only see the resolver’s IP address that corresponds to the Singapore location.</span></span> <span data-ttu-id="fceae-191">См. также ответ о поддержке адресов подсети клиента, представленный на этой странице.</span><span class="sxs-lookup"><span data-stu-id="fceae-191">Also, see the earlier FAQ regarding client subnet address support on this page.</span></span>

- <span data-ttu-id="fceae-192">Во-вторых, диспетчер трафика использует внутреннюю карту для преобразования IP-адресов в географические регионы.</span><span class="sxs-lookup"><span data-stu-id="fceae-192">Second, Traffic Manager uses an internal map to do the IP address to geographic region translation.</span></span> <span data-ttu-id="fceae-193">Несмотря на то, что эта карта постоянно проверяется и обновляется, чтобы повысить точность преобразования и учесть постоянные изменения сети Интернет, всегда есть вероятность того, что наши сведения неточно отображают географическое расположение некоторых IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="fceae-193">While this map is validated and updated on an ongoing basis to increase its accuracy and account for the evolving nature of the internet, there is still the possibility that our information is not an exact representation of the geographic location of all the IP addresses.</span></span>


###  <a name="does-an-endpoint-need-to-be-physically-located-in-the-same-region-as-the-one-it-is-configured-with-for-geographic-routing"></a><span data-ttu-id="fceae-194">Должна дли конечная точка физически располагаться в том же регионе, что и регион, с которым она сопоставлена для географической маршрутизации?</span><span class="sxs-lookup"><span data-stu-id="fceae-194">Does an endpoint need to be physically located in the same region as the one it is configured with for geographic routing?</span></span> 
<span data-ttu-id="fceae-195">Нет, расположение конечной точки не влияет на регионы, с которыми она может быть сопоставлена.</span><span class="sxs-lookup"><span data-stu-id="fceae-195">No, the location of the endpoint imposes no restrictions on which regions can be mapped to it.</span></span> <span data-ttu-id="fceae-196">Например, на конечную точку в регионе Azure "Центральная часть США" могут быть направлены все пользователи из Индии.</span><span class="sxs-lookup"><span data-stu-id="fceae-196">For example, an endpoint in US-Central Azure region can have all users from India directed to it.</span></span>

### <a name="can-i-assign-geographic-regions-to-endpoints-in-a-profile-that-is-not-configured-to-do-geographic-routing"></a><span data-ttu-id="fceae-197">Можно ли назначить географические регионы конечным точкам в профиле, в котором не настроена географическая маршрутизация?</span><span class="sxs-lookup"><span data-stu-id="fceae-197">Can I assign geographic regions to endpoints in a profile that is not configured to do geographic routing?</span></span> 

<span data-ttu-id="fceae-198">Да. Если в профиле используется другой метод маршрутизации (отличный от географического), вы можете назначить географические регионы конечным точкам в этом профиле с помощью [REST API диспетчера трафика Azure](https://docs.microsoft.com/rest/api/trafficmanager/).</span><span class="sxs-lookup"><span data-stu-id="fceae-198">Yes, if the routing method of a profile is not geographic, you can use the [Azure Traffic Manager REST API](https://docs.microsoft.com/rest/api/trafficmanager/) to assign geographic regions to endpoints in that profile.</span></span> <span data-ttu-id="fceae-199">В профилях с негеографической маршрутизацией эта конфигурация игнорируется.</span><span class="sxs-lookup"><span data-stu-id="fceae-199">In the case of non-geographic routing type profiles, this configuration is ignored.</span></span> <span data-ttu-id="fceae-200">Если позднее тип маршрутизации в профиле будет изменен на географический, диспетчер трафика может использовать эти сопоставления.</span><span class="sxs-lookup"><span data-stu-id="fceae-200">If you change such a profile to geographic routing type at a later time, Traffic Manager can use those mappings.</span></span>


### <a name="why-am-i-getting-an-error-when-i-try-to-change-the-routing-method-of-an-existing-profile-to-geographic"></a><span data-ttu-id="fceae-201">Почему, когда я пытаюсь изменить метод маршрутизации существующего профиля на географический, возникает ошибка?</span><span class="sxs-lookup"><span data-stu-id="fceae-201">Why am I getting an error when I try to change the routing method of an existing profile to Geographic?</span></span>

<span data-ttu-id="fceae-202">Каждая конечная точка в профиле с географической маршрутизацией должна быть сопоставлена как минимум с одним регионом.</span><span class="sxs-lookup"><span data-stu-id="fceae-202">All the endpoints under a profile with geographic routing need to have at least one region mapped to it.</span></span> <span data-ttu-id="fceae-203">Чтобы изменить тип маршрутизации в существующем профиле на географический, сначала необходимо связать географические регионы со всеми конечными точками профиля, используя [REST API диспетчера трафика Azure](https://docs.microsoft.com/rest/api/trafficmanager/).</span><span class="sxs-lookup"><span data-stu-id="fceae-203">To convert an existing profile to geographic routing type, you first need to associate geographic regions to all its endpoints using the [Azure Traffic Manager REST API](https://docs.microsoft.com/rest/api/trafficmanager/) before changing the routing type to geographic.</span></span> <span data-ttu-id="fceae-204">Если вы используете портал, сначала удалите конечные точки, измените метод маршрутизации профиля на географический, а затем добавьте конечные точки вместе с сопоставлением с географическим регионом.</span><span class="sxs-lookup"><span data-stu-id="fceae-204">If using portal, first delete the endpoints, change the routing method of the profile to geographic and then add the endpoints along with their geographic region mapping.</span></span> 


###  <a name="why-is-it-strongly-recommended-that-customers-create-nested-profiles-instead-of-endpoints-under-a-profile-with-geographic-routing-enabled"></a><span data-ttu-id="fceae-205">Почему клиентам настоятельно рекомендуется создавать в профиле с географической маршрутизацией вложенные профили вместо конечных точек?</span><span class="sxs-lookup"><span data-stu-id="fceae-205">Why is it strongly recommended that customers create nested profiles instead of endpoints under a profile with geographic routing enabled?</span></span> 

<span data-ttu-id="fceae-206">Если в профиле используется географическая маршрутизация, регион можно назначить только одной точке в этом профиле.</span><span class="sxs-lookup"><span data-stu-id="fceae-206">A region can be assigned to only one endpoint within a profile if its using geographic routing type.</span></span> <span data-ttu-id="fceae-207">Если это не вложенная конечная точка с дочерним профилем, когда она будет неработоспособна, диспетчер трафика продолжит отправлять на нее трафик. Альтернативное поведение диспетчера в этом случае — не отправлять трафик, что ничем не лучше исходного варианта.</span><span class="sxs-lookup"><span data-stu-id="fceae-207">If that endpoint is not a nested type with a child profile attached to it, if that endpoint going unhealthy, Traffic Manager continues to send traffic to it since the alternative of not sending any traffic isn’t any better.</span></span> <span data-ttu-id="fceae-208">Диспетчер трафика не отрабатывает отказ на другую конечную точку, даже если ее назначенный регион является родительским для неработоспособной конечной точки. Например, если конечная точка, которой назначен регион "Испания", становится неработоспособной, отказ не отрабатывается на другую конечную точку, которой назначен регион "Европа".</span><span class="sxs-lookup"><span data-stu-id="fceae-208">Traffic Manager does not failover to another endpoint, even when the region assigned is a “parent” of the region assigned to the endpoint that went unhealthy (for example, if an endpoint that has region Spain goes unhealthy, we will not failover to another endpoint that has the region Europe assigned to it).</span></span> <span data-ttu-id="fceae-209">Таким образом диспетчер трафика будет учитывать ограничения, связанные с географическими регионами, которые клиент установил в своем профиле.</span><span class="sxs-lookup"><span data-stu-id="fceae-209">This is done to ensure that Traffic Manager respects the geographic boundaries that a customer has setup in their profile.</span></span> <span data-ttu-id="fceae-210">Чтобы использовать отработку отказа на другую конечную точку, когда конечная точка становится неработоспособной, рекомендуется назначать географические регионы вложенным профилям с несколькими конечными точками, а не отдельным конечным точкам.</span><span class="sxs-lookup"><span data-stu-id="fceae-210">To get the benefit of failing over to another endpoint when an endpoint goes unhealthy, it is recommended that geographic regions be assigned to nested profiles with multiple endpoints within it instead of individual endpoints.</span></span> <span data-ttu-id="fceae-211">Таким образом, в случае сбоя конечной точки во вложенном дочернем профиле трафик будет перенаправлен на другую конечную точку в том же профиле.</span><span class="sxs-lookup"><span data-stu-id="fceae-211">In this way, if an endpoint in the nested child profile fails, traffic can failover to another endpoint inside the same nested child profile.</span></span>

### <a name="are-there-any-restrictions-on-the-api-version-that-supports-this-routing-type"></a><span data-ttu-id="fceae-212">Существуют ли ограничения на версии API, которые поддерживает этот тип маршрутизации?</span><span class="sxs-lookup"><span data-stu-id="fceae-212">Are there any restrictions on the API version that supports this routing type?</span></span>

<span data-ttu-id="fceae-213">Да. Географическую маршрутизацию поддерживают только новые API начиная с версии от 01.03.2017.</span><span class="sxs-lookup"><span data-stu-id="fceae-213">Yes, only API version 2017-03-01 and newer supports the Geographic routing type.</span></span> <span data-ttu-id="fceae-214">Все более старые версии API не позволяют создавать профили с географической маршрутизацией и сопоставлять географические регионы с конечными точками.</span><span class="sxs-lookup"><span data-stu-id="fceae-214">Any older API versions cannot be used to created profiles of Geographic routing type or assign geographic regions to endpoints.</span></span> <span data-ttu-id="fceae-215">Если вы пытаетесь получить профили из подписки Azure с помощью более старой версии API, профили с географической маршрутизацией не будут возвращены.</span><span class="sxs-lookup"><span data-stu-id="fceae-215">If an older API version is used to retrieve profiles from an Azure subscription, any profile of Geographic routing type is not returned.</span></span> <span data-ttu-id="fceae-216">Кроме того, при использовании старых версий API в возвращенных профилях с конечными точками, которым назначен географический регион, этот регион не отображается.</span><span class="sxs-lookup"><span data-stu-id="fceae-216">In addition, when using older API versions, any profile returned that has endpoints with a geographic region assignment, does not have its geographic region assignment shown.</span></span>



## <a name="traffic-manager-endpoints"></a><span data-ttu-id="fceae-217">Конечные точки диспетчера трафика</span><span class="sxs-lookup"><span data-stu-id="fceae-217">Traffic Manager endpoints</span></span>

### <a name="can-i-use-traffic-manager-with-endpoints-from-multiple-subscriptions"></a><span data-ttu-id="fceae-218">Можно ли использовать в диспетчере трафика конечные точки из нескольких подписок?</span><span class="sxs-lookup"><span data-stu-id="fceae-218">Can I use Traffic Manager with endpoints from multiple subscriptions?</span></span>

<span data-ttu-id="fceae-219">Использование конечных точек из нескольких подписок не поддерживается в веб-приложениях Azure.</span><span class="sxs-lookup"><span data-stu-id="fceae-219">Using endpoints from multiple subscriptions is not possible with Azure Web Apps.</span></span> <span data-ttu-id="fceae-220">Для работы веб-приложений Azure требуется, чтобы любое имя пользовательского домена, используемое в них, использовалось только в пределах одной подписки.</span><span class="sxs-lookup"><span data-stu-id="fceae-220">Azure Web Apps requires that any custom domain name used with Web Apps is only used within a single subscription.</span></span> <span data-ttu-id="fceae-221">Невозможно использовать веб-приложения из нескольких подписок с одним и тем же доменным именем.</span><span class="sxs-lookup"><span data-stu-id="fceae-221">It is not possible to use Web Apps from multiple subscriptions with the same domain name.</span></span>

<span data-ttu-id="fceae-222">Для других типов конечных точек можно использовать диспетчер трафика, если эти конечные точки расположены в нескольких подписках.</span><span class="sxs-lookup"><span data-stu-id="fceae-222">For other endpoint types, it is possible to use Traffic Manager with endpoints from more than one subscription.</span></span> <span data-ttu-id="fceae-223">В Resource Manager в диспетчер трафика можно добавить конечные точки из любой подписки при условии, что у пользователя, настраивающего профиль диспетчера трафика, есть доступ на чтение к этим конечным точкам.</span><span class="sxs-lookup"><span data-stu-id="fceae-223">In Resource Manager, endpoints from any subscription can be added to Traffic Manager, as long as the person configuring the Traffic Manager profile has read access to the endpoint.</span></span> <span data-ttu-id="fceae-224">Эти разрешения можно предоставить с помощью [управления доступом на основе ролей Azure Resource Manager](../active-directory/role-based-access-control-configure.md).</span><span class="sxs-lookup"><span data-stu-id="fceae-224">These permissions can be granted using [Azure Resource Manager role-based access control (RBAC)](../active-directory/role-based-access-control-configure.md).</span></span>


### <a name="can-i-use-traffic-manager-with-cloud-service-staging-slots"></a><span data-ttu-id="fceae-225">Можно ли использовать диспетчер трафика с промежуточными слотами облачной службы?</span><span class="sxs-lookup"><span data-stu-id="fceae-225">Can I use Traffic Manager with Cloud Service 'Staging' slots?</span></span>

<span data-ttu-id="fceae-226">Да.</span><span class="sxs-lookup"><span data-stu-id="fceae-226">Yes.</span></span> <span data-ttu-id="fceae-227">Промежуточные слоты облачной службы можно настроить в диспетчере трафика в качестве внешних конечных точек.</span><span class="sxs-lookup"><span data-stu-id="fceae-227">Cloud Service 'staging' slots can be configured in Traffic Manager as External endpoints.</span></span> <span data-ttu-id="fceae-228">Проверки работоспособности будут по-прежнему оплачиваться по тарифу для конечных точек Azure.</span><span class="sxs-lookup"><span data-stu-id="fceae-228">Health checks are still be charged at the Azure Endpoints rate.</span></span> <span data-ttu-id="fceae-229">Так как тип внешней конечной точки уже используется, изменения основной службы не применяются автоматически.</span><span class="sxs-lookup"><span data-stu-id="fceae-229">Because the External endpoint type is in use, changes to the underlying service are not picked up automatically.</span></span> <span data-ttu-id="fceae-230">При работе с внешними конечными точками диспетчер трафика не может обнаружить остановку или удаление облачной службы.</span><span class="sxs-lookup"><span data-stu-id="fceae-230">With external endpoints, Traffic Manager cannot detect when the Cloud Service is stopped or deleted.</span></span> <span data-ttu-id="fceae-231">Таким образом, диспетчер трафика продолжает выставлять счета за проверки работоспособности, пока конечная точка не будет отключена или удалена.</span><span class="sxs-lookup"><span data-stu-id="fceae-231">Therefore, the Traffic Manager continues billing for health checks until the endpoint is disabled or deleted.</span></span>

### <a name="does-traffic-manager-support-ipv6-endpoints"></a><span data-ttu-id="fceae-232">Поддерживает ли диспетчер трафика конечные точки IP версии 6?</span><span class="sxs-lookup"><span data-stu-id="fceae-232">Does Traffic Manager support IPv6 endpoints?</span></span>

<span data-ttu-id="fceae-233">Диспетчер трафика в настоящее время не предоставляет серверы доменных имен с IPv6-адресованием.</span><span class="sxs-lookup"><span data-stu-id="fceae-233">Traffic Manager does not currently provide IPv6-addressible name servers.</span></span> <span data-ttu-id="fceae-234">Тем не менее диспетчер трафика может использоваться IPv6-клиентами, подключающимся к конечным точкам IPv6.</span><span class="sxs-lookup"><span data-stu-id="fceae-234">However, Traffic Manager can still be used by IPv6 clients connecting to IPv6 endpoints.</span></span> <span data-ttu-id="fceae-235">Клиент не отправляет DNS-запросы непосредственно к диспетчеру трафика.</span><span class="sxs-lookup"><span data-stu-id="fceae-235">A client does not make DNS requests directly to Traffic Manager.</span></span> <span data-ttu-id="fceae-236">Вместо этого клиент использует рекурсивную службу DNS.</span><span class="sxs-lookup"><span data-stu-id="fceae-236">Instead, the client uses a recursive DNS service.</span></span> <span data-ttu-id="fceae-237">Клиент, использующий только IPv6, отправляет запросы к рекурсивной службе DNS через IPv6.</span><span class="sxs-lookup"><span data-stu-id="fceae-237">An IPv6-only client sends requests to the recursive DNS service via IPv6.</span></span> <span data-ttu-id="fceae-238">Затем рекурсивная служба должна иметь возможность связаться с серверами доменных имен диспетчера трафика, используя IPv4-адрес.</span><span class="sxs-lookup"><span data-stu-id="fceae-238">Then the recursive service should be able to contact the Traffic Manager name servers using IPv4.</span></span>

<span data-ttu-id="fceae-239">Диспетчер трафика возвращает ответ с DNS-именем конечной точки.</span><span class="sxs-lookup"><span data-stu-id="fceae-239">Traffic Manager responds with the DNS name of the endpoint.</span></span> <span data-ttu-id="fceae-240">Для поддержки конечной точки IPv6 должна существовать запись DNS типа AAAA, указывающая DNS-имя конечной точки для IPv6-адреса.</span><span class="sxs-lookup"><span data-stu-id="fceae-240">To support an IPv6 endpoint, a DNS AAAA record pointing the endpoint DNS name to the IPv6 address must exist.</span></span> <span data-ttu-id="fceae-241">Проверки работоспособности диспетчера трафика поддерживают только IPv4-адреса.</span><span class="sxs-lookup"><span data-stu-id="fceae-241">Traffic Manager health checks only support IPv4 addresses.</span></span> <span data-ttu-id="fceae-242">Служба должна предоставлять конечную точку IPv4 с тем же DNS-именем.</span><span class="sxs-lookup"><span data-stu-id="fceae-242">The service needs to expose an IPv4 endpoint on the same DNS name.</span></span>

### <a name="can-i-use-traffic-manager-with-more-than-one-web-app-in-the-same-region"></a><span data-ttu-id="fceae-243">Можно ли использовать в диспетчере трафика несколько веб-приложений в одном и том же регионе?</span><span class="sxs-lookup"><span data-stu-id="fceae-243">Can I use Traffic Manager with more than one Web App in the same region?</span></span>

<span data-ttu-id="fceae-244">Как правило, диспетчер трафика используется для перенаправления трафика в приложения, развернутые в разных регионах.</span><span class="sxs-lookup"><span data-stu-id="fceae-244">Typically, Traffic Manager is used to direct traffic to applications deployed in different regions.</span></span> <span data-ttu-id="fceae-245">Тем не менее его также можно использовать с приложениями, у которых есть несколько развертываний в одном и том же регионе.</span><span class="sxs-lookup"><span data-stu-id="fceae-245">However, it can also be used where an application has more than one deployment in the same region.</span></span> <span data-ttu-id="fceae-246">Конечные точки Azure диспетчера трафика не допускают добавление нескольких конечных точек веб-приложения, находящихся в одном и том же регионе Azure, в один и тот же профиль.</span><span class="sxs-lookup"><span data-stu-id="fceae-246">The Traffic Manager Azure endpoints do not permit more than one Web App endpoint from the same Azure region to be added to the same Traffic Manager profile.</span></span>

##  <a name="traffic-manager-endpoint-monitoring"></a><span data-ttu-id="fceae-247">Мониторинг конечных точек в диспетчере трафика</span><span class="sxs-lookup"><span data-stu-id="fceae-247">Traffic Manager endpoint monitoring</span></span>

### <a name="is-traffic-manager-resilient-to-azure-region-failures"></a><span data-ttu-id="fceae-248">Устойчив ли диспетчер трафика к сбоям в регионе Azure?</span><span class="sxs-lookup"><span data-stu-id="fceae-248">Is Traffic Manager resilient to Azure region failures?</span></span>

<span data-ttu-id="fceae-249">Диспетчер трафика является ключевым компонентом, обеспечивающим высокую доступность приложений в Azure.</span><span class="sxs-lookup"><span data-stu-id="fceae-249">Traffic Manager is a key component of the delivery of highly available applications in Azure.</span></span>
<span data-ttu-id="fceae-250">Для обеспечения высокого уровня доступности диспетчер трафика должен иметь исключительно высокий уровень доступности и быть устойчивым к сбоям регионов.</span><span class="sxs-lookup"><span data-stu-id="fceae-250">To deliver high availability, Traffic Manager must have an exceptionally high level of availability and be resilient to regional failure.</span></span>

<span data-ttu-id="fceae-251">По умолчанию компоненты диспетчера трафика отказоустойчивы к полному сбою любого региона Azure.</span><span class="sxs-lookup"><span data-stu-id="fceae-251">By design, Traffic Manager components are resilient to a complete failure of any Azure region.</span></span> <span data-ttu-id="fceae-252">Эта устойчивость применяется ко всем компонентам диспетчера трафика: DNS-серверам, API-интерфейсам, уровню хранилища и службе мониторинга конечных точек.</span><span class="sxs-lookup"><span data-stu-id="fceae-252">This resilience applies to all Traffic Manager components: the DNS name servers, the API, the storage layer, and the endpoint monitoring service.</span></span>

<span data-ttu-id="fceae-253">В маловероятном случае сбоя всего региона Azure диспетчер трафика должен продолжить нормальную работу.</span><span class="sxs-lookup"><span data-stu-id="fceae-253">In the unlikely event of an outage of an entire Azure region, Traffic Manager is expected to continue to function normally.</span></span> <span data-ttu-id="fceae-254">Приложения, развернутые в нескольких регионах Azure, могут положиться на диспетчер трафика, который перенаправит трафик к доступному экземпляру приложения.</span><span class="sxs-lookup"><span data-stu-id="fceae-254">Applications deployed in multiple Azure regions can rely on Traffic Manager to direct traffic to an available instance of their application.</span></span>

### <a name="how-does-the-choice-of-resource-group-location-affect-traffic-manager"></a><span data-ttu-id="fceae-255">Каким образом выбор расположения группы ресурсов влияет на диспетчер трафика?</span><span class="sxs-lookup"><span data-stu-id="fceae-255">How does the choice of resource group location affect Traffic Manager?</span></span>

<span data-ttu-id="fceae-256">Диспетчер трафика — это единая глобальная служба.</span><span class="sxs-lookup"><span data-stu-id="fceae-256">Traffic Manager is a single, global service.</span></span> <span data-ttu-id="fceae-257">Она не является региональной.</span><span class="sxs-lookup"><span data-stu-id="fceae-257">It is not regional.</span></span> <span data-ttu-id="fceae-258">Выбор расположения группы ресурсов никак не влияет на профили диспетчера трафика, развернутые в этой группе ресурсов.</span><span class="sxs-lookup"><span data-stu-id="fceae-258">The choice of resource group location makes no difference to Traffic Manager profiles deployed in that resource group.</span></span>

<span data-ttu-id="fceae-259">Для Azure Resource Manager требуется, чтобы все группы ресурсов указывали расположение, которое определяет расположение по умолчанию для ресурсов, развернутых в этой группе ресурсов.</span><span class="sxs-lookup"><span data-stu-id="fceae-259">Azure Resource Manager requires all resource groups to specify a location, which determines the default location for resources deployed in that resource group.</span></span> <span data-ttu-id="fceae-260">При создании профиля диспетчера трафика он создается в группе ресурсов.</span><span class="sxs-lookup"><span data-stu-id="fceae-260">When you create a Traffic Manager profile, it is created in a resource group.</span></span> <span data-ttu-id="fceae-261">Во всех профилях диспетчера трафика в качестве расположения задано значение **Глобальный** (тем самым переопределяется группа ресурсов по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="fceae-261">All Traffic Manager profiles use **global** as their location, overriding the resource group default.</span></span>

### <a name="how-do-i-determine-the-current-health-of-each-endpoint"></a><span data-ttu-id="fceae-262">Как определить текущую работоспособность каждой конечной точки?</span><span class="sxs-lookup"><span data-stu-id="fceae-262">How do I determine the current health of each endpoint?</span></span>

<span data-ttu-id="fceae-263">На портале управления Azure отображается текущее состояние мониторинга для каждой конечной точки, а также всего профиля.</span><span class="sxs-lookup"><span data-stu-id="fceae-263">The current monitoring status of each endpoint, in addition to the overall profile, is displayed in the Azure portal.</span></span> <span data-ttu-id="fceae-264">Эти сведения также можно получить с помощью [REST API](https://msdn.microsoft.com/library/azure/mt163667.aspx) отслеживания трафика, [командлетов PowerShell](https://msdn.microsoft.com/library/mt125941.aspx) и [кроссплатформенного интерфейса командной строки Azure](../cli-install-nodejs.md).</span><span class="sxs-lookup"><span data-stu-id="fceae-264">This information also is available via the Traffic Monitor [REST API](https://msdn.microsoft.com/library/azure/mt163667.aspx), [PowerShell cmdlets](https://msdn.microsoft.com/library/mt125941.aspx), and [cross-platform Azure CLI](../cli-install-nodejs.md).</span></span>

<span data-ttu-id="fceae-265">Azure не предоставляет информации о работоспособности конечной точки в прошлом и не позволяет выдавать предупреждения об изменении состояния конечной точки.</span><span class="sxs-lookup"><span data-stu-id="fceae-265">Azure does not provide historical information about past endpoint health or the ability to raise alerts about changes to endpoint health.</span></span>

### <a name="can-i-monitor-https-endpoints"></a><span data-ttu-id="fceae-266">Можно ли отслеживать конечные точки HTTPS?</span><span class="sxs-lookup"><span data-stu-id="fceae-266">Can I monitor HTTPS endpoints?</span></span>

<span data-ttu-id="fceae-267">Да.</span><span class="sxs-lookup"><span data-stu-id="fceae-267">Yes.</span></span> <span data-ttu-id="fceae-268">Диспетчер трафика поддерживает проверку по протоколу HTTPS.</span><span class="sxs-lookup"><span data-stu-id="fceae-268">Traffic Manager supports probing over HTTPS.</span></span> <span data-ttu-id="fceae-269">Настройте **HTTPS** в качестве протокола в конфигурации мониторинга.</span><span class="sxs-lookup"><span data-stu-id="fceae-269">Configure **HTTPS** as the protocol in the monitoring configuration.</span></span>

<span data-ttu-id="fceae-270">Диспетчер трафика не может предоставить проверку сертификатов. В частности:</span><span class="sxs-lookup"><span data-stu-id="fceae-270">Traffic manager cannot provide any certificate validation, including:</span></span>

* <span data-ttu-id="fceae-271">сертификаты на стороне сервера не проверяются;</span><span class="sxs-lookup"><span data-stu-id="fceae-271">Server-side certificates are not validated</span></span>
* <span data-ttu-id="fceae-272">сертификаты SNI на стороне сервера не поддерживаются;</span><span class="sxs-lookup"><span data-stu-id="fceae-272">SNI server-side certificates are not supported</span></span>
* <span data-ttu-id="fceae-273">клиентские сертификаты не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="fceae-273">Client certificates are not supported</span></span>

### <a name="can-i-use-traffic-manager-even-if-my-application-does-not-have-support-for-http-or-https"></a><span data-ttu-id="fceae-274">Могу ли я использовать диспетчер трафика, даже если приложение не поддерживает протоколы HTTP и HTTPS?</span><span class="sxs-lookup"><span data-stu-id="fceae-274">Can I use Traffic Manager even if my application does not have support for HTTP or HTTPS?</span></span>

<span data-ttu-id="fceae-275">Да.</span><span class="sxs-lookup"><span data-stu-id="fceae-275">Yes.</span></span> <span data-ttu-id="fceae-276">Вы можете указать протокол ТСР как протокол мониторинга. Диспетчер трафика запустит подключение TCP и будет ожидать ответ от конечной точки.</span><span class="sxs-lookup"><span data-stu-id="fceae-276">You can specify TCP as the monitoring protocol and Traffic Manager can initiate a TCP connection and wait for a response from the endpoint.</span></span> <span data-ttu-id="fceae-277">Если конечная точка отвечает на запрос на подключение ответом на установку подключения (в течение периода ожидания), тогда такая конечная точка помечается как работоспособная.</span><span class="sxs-lookup"><span data-stu-id="fceae-277">If the endpoint replies to the connection request with a response to establish the connection, within the timeout period, then that endpoint is marked as healthy.</span></span>

### <a name="what-specific-responses-are-required-from-the-endpoint-when-using-tcp-monitoring"></a><span data-ttu-id="fceae-278">Какие стоит рассмотреть ответы от конечной точки при использовании протокола ТСР как протокола мониторинга?</span><span class="sxs-lookup"><span data-stu-id="fceae-278">What specific responses are required from the endpoint when using TCP monitoring?</span></span>

<span data-ttu-id="fceae-279">При использовании протокола мониторинга ТСР диспетчер трафика запускает трехстороннее подтверждение TCP, отправляя запрос SYN в конечную точку на указанном порте.</span><span class="sxs-lookup"><span data-stu-id="fceae-279">When TCP monitoring is used, Traffic Manager starts a three-way TCP handshake by sending a SYN request to endpoint at the specified port.</span></span> <span data-ttu-id="fceae-280">Затем он определенный период времени (указанный в параметрах времени ожидания) ожидает ответ от конечной точки.</span><span class="sxs-lookup"><span data-stu-id="fceae-280">It then waits for a period of time (as specified in the timeout settings) for a response from the endpoint.</span></span> <span data-ttu-id="fceae-281">Если конечная точка отвечает на запрос SYN ответом SYN-ACK в течение периода ожидания, указанного в параметрах мониторинга, тогда такая конечная точка считается работоспособной.</span><span class="sxs-lookup"><span data-stu-id="fceae-281">If the endpoint responds to the SYN request with a SYN-ACK response within the timeout period specified in the monitoring settings, then that endpoint is considered healthy.</span></span> <span data-ttu-id="fceae-282">При получении ответа SYN ACK диспетчер трафика сбрасывает подключение, отправляя ответ обратно с помощью RST.</span><span class="sxs-lookup"><span data-stu-id="fceae-282">If the SYN-ACK response is received, the Traffic Manager resets the connection by responding back with a RST.</span></span>

### <a name="how-fast-does-traffic-manager-move-my-users-away-from-an-unhealthy-endpoint"></a><span data-ttu-id="fceae-283">Насколько быстро диспетчер трафика перемещает пользователей из неработоспособной конечной точки?</span><span class="sxs-lookup"><span data-stu-id="fceae-283">How fast does Traffic Manager move my users away from an unhealthy endpoint?</span></span>

<span data-ttu-id="fceae-284">Диспетчер трафика предоставляет несколько параметров, которые могут помочь в управлении отработкой отказа профиля диспетчера трафика следующим образом:</span><span class="sxs-lookup"><span data-stu-id="fceae-284">Traffic Manager provides multiple settings that can help you to control the failover behavior of your Traffic Manager profile as follows:</span></span>
- <span data-ttu-id="fceae-285">Вы можете указать частоту проверки конечных точек диспетчером трафика, задав интервал проверки в 10 секунд.</span><span class="sxs-lookup"><span data-stu-id="fceae-285">you can specify that the Traffic Manager probes the endpoints more frequently by setting the Probing Interval at 10 seconds.</span></span> <span data-ttu-id="fceae-286">Это позволит обнаружить неработоспособную конечную точку как можно скорее.</span><span class="sxs-lookup"><span data-stu-id="fceae-286">This ensures that any endpoint going unhealthy can be detected as soon as possible.</span></span> 
- <span data-ttu-id="fceae-287">Вы можете указать время ожидания запроса на проверку работоспособности (минимальное значение — 5 секунд).</span><span class="sxs-lookup"><span data-stu-id="fceae-287">you can specify how long to wait before a health check request times out (minimum time out value is 5 sec).</span></span>
- <span data-ttu-id="fceae-288">Вы можете указать количество сбоев, по достижении которых конечная точка будет помечена как неработоспособная.</span><span class="sxs-lookup"><span data-stu-id="fceae-288">you can specify how many failures can occur before the endpoint is marked as unhealthy.</span></span> <span data-ttu-id="fceae-289">Вы можете установить значение от 0. В таком случае конечная точка будет помечена как неработоспособная, как только произойдет первый сбой при проверке работоспособности.</span><span class="sxs-lookup"><span data-stu-id="fceae-289">This value can be low as 0, in which case the endpoint is marked unhealthy as soon as it fails the first health check.</span></span> <span data-ttu-id="fceae-290">Тем не менее использование минимального значения 0 для допустимого числа сбоев может привести к тому, что конечные точки перестанут использоваться из-за любых временных сбоев, которые могут произойти во время проверки.</span><span class="sxs-lookup"><span data-stu-id="fceae-290">However, using the minimum value of 0 for the tolerated number of failures can lead to endpoints being taken out of rotation due to any transient issues that may occur at the time of probing.</span></span>
- <span data-ttu-id="fceae-291">Вы можете указать для срока жизни ответа DNS значение от 0.</span><span class="sxs-lookup"><span data-stu-id="fceae-291">you can specify the time-to-live (TTL) for the DNS response to be as low as 0.</span></span> <span data-ttu-id="fceae-292">Это означает, что сопоставители DNS не могут кэшировать ответ и каждый новый запрос получает ответ, включающий самые последние сведения о работоспособности, которые содержит диспетчер трафика.</span><span class="sxs-lookup"><span data-stu-id="fceae-292">Doing so means that DNS resolvers cannot cache the response and each new query gets a response that incorporates the most up-to-date health information that the Traffic Manager has.</span></span>

<span data-ttu-id="fceae-293">С помощью этих параметров диспетчер трафика может обеспечивать отработку отказа в течение 10 секунд после того, как конечная точка определена как неработоспособная, и запрос DNS выполняется для соответствующего профиля.</span><span class="sxs-lookup"><span data-stu-id="fceae-293">By using these settings, Traffic Manager can provide failovers under 10 seconds after an endpoint goes unhealthy and a DNS query is made against the corresponding profile.</span></span>

### <a name="how-can-i-specify-different-monitoring-settings-for-different-endpoints-in-a-profile"></a><span data-ttu-id="fceae-294">Как я могу указать в профиле другие параметры мониторинга для других конечных точек?</span><span class="sxs-lookup"><span data-stu-id="fceae-294">How can I specify different monitoring settings for different endpoints in a profile?</span></span>

<span data-ttu-id="fceae-295">Параметры мониторинга диспетчера трафика заданы для каждого уровня профиля.</span><span class="sxs-lookup"><span data-stu-id="fceae-295">Traffic Manager monitoring settings are at a per profile level.</span></span> <span data-ttu-id="fceae-296">Если вам нужно использовать другие параметры мониторинга только для одной конечной точки, это можно сделать, если задать эту конечную точку как [вложенный профиль](traffic-manager-nested-profiles.md), параметры мониторинга которого отличаются от родительского профиля.</span><span class="sxs-lookup"><span data-stu-id="fceae-296">If you need to use a different monitoring setting for only one endpoint, it can be done by having that endpoint as a [nested profile](traffic-manager-nested-profiles.md) whose monitoring settings are different from the parent profile.</span></span>

### <a name="what-host-header-do-endpoint-health-checks-use"></a><span data-ttu-id="fceae-297">Какой заголовок узла используется для проверки работоспособности конечной точки?</span><span class="sxs-lookup"><span data-stu-id="fceae-297">What host header do endpoint health checks use?</span></span>

<span data-ttu-id="fceae-298">Для проверки работоспособности HTTP и HTTPS диспетчер трафика использует заголовки узлов.</span><span class="sxs-lookup"><span data-stu-id="fceae-298">Traffic Manager uses host headers in HTTP and HTTPS health checks.</span></span> <span data-ttu-id="fceae-299">Заголовок узла, используемый диспетчером трафика, представляет собой имя целевой конечной точки, настроенной в профиле.</span><span class="sxs-lookup"><span data-stu-id="fceae-299">The host header used by Traffic Manager is the name of the endpoint target configured in the profile.</span></span> <span data-ttu-id="fceae-300">Значение, используемое в заголовке узла, нельзя использовать отдельно от свойства цели.</span><span class="sxs-lookup"><span data-stu-id="fceae-300">The value used in the host header cannot be specified separately from the target property.</span></span>

### <a name="what-are-the-ip-addresses-from-which-the-health-checks-originate"></a><span data-ttu-id="fceae-301">Что такое IP-адресов, используемые при проверке работоспособности?</span><span class="sxs-lookup"><span data-stu-id="fceae-301">What are the IP addresses from which the health checks originate?</span></span>

<span data-ttu-id="fceae-302">Следующий список содержит IP-адреса, с которых диспетчер трафика может запускать проверку работоспособности.</span><span class="sxs-lookup"><span data-stu-id="fceae-302">The following list contains the IP addresses from which Traffic Manager health checks can originate.</span></span> <span data-ttu-id="fceae-303">Этот список позволяет узнать, разрешены ли входящие подключения от этих адресов на конечных точках для проверки состояния их работоспособности.</span><span class="sxs-lookup"><span data-stu-id="fceae-303">You may use this list to ensure that incoming connections from these IP addresses are allowed at the endpoints to check its health status.</span></span>

* <span data-ttu-id="fceae-304">40.68.30.66</span><span class="sxs-lookup"><span data-stu-id="fceae-304">40.68.30.66</span></span>
* <span data-ttu-id="fceae-305">40.68.31.178</span><span class="sxs-lookup"><span data-stu-id="fceae-305">40.68.31.178</span></span>
* <span data-ttu-id="fceae-306">137.135.80.149</span><span class="sxs-lookup"><span data-stu-id="fceae-306">137.135.80.149</span></span>
* <span data-ttu-id="fceae-307">137.135.82.249</span><span class="sxs-lookup"><span data-stu-id="fceae-307">137.135.82.249</span></span>
* <span data-ttu-id="fceae-308">23.96.236.252</span><span class="sxs-lookup"><span data-stu-id="fceae-308">23.96.236.252</span></span>
* <span data-ttu-id="fceae-309">65.52.217.19</span><span class="sxs-lookup"><span data-stu-id="fceae-309">65.52.217.19</span></span>
* <span data-ttu-id="fceae-310">40.87.147.10</span><span class="sxs-lookup"><span data-stu-id="fceae-310">40.87.147.10</span></span>
* <span data-ttu-id="fceae-311">40.87.151.34</span><span class="sxs-lookup"><span data-stu-id="fceae-311">40.87.151.34</span></span>
* <span data-ttu-id="fceae-312">13.75.124.254</span><span class="sxs-lookup"><span data-stu-id="fceae-312">13.75.124.254</span></span>
* <span data-ttu-id="fceae-313">13.75.127.63</span><span class="sxs-lookup"><span data-stu-id="fceae-313">13.75.127.63</span></span>
* <span data-ttu-id="fceae-314">52.172.155.168</span><span class="sxs-lookup"><span data-stu-id="fceae-314">52.172.155.168</span></span>
* <span data-ttu-id="fceae-315">52.172.158.37</span><span class="sxs-lookup"><span data-stu-id="fceae-315">52.172.158.37</span></span>
* <span data-ttu-id="fceae-316">104.215.91.84</span><span class="sxs-lookup"><span data-stu-id="fceae-316">104.215.91.84</span></span>
* <span data-ttu-id="fceae-317">13.75.153.124</span><span class="sxs-lookup"><span data-stu-id="fceae-317">13.75.153.124</span></span>
* <span data-ttu-id="fceae-318">13.84.222.37</span><span class="sxs-lookup"><span data-stu-id="fceae-318">13.84.222.37</span></span>
* <span data-ttu-id="fceae-319">23.101.191.199</span><span class="sxs-lookup"><span data-stu-id="fceae-319">23.101.191.199</span></span>
* <span data-ttu-id="fceae-320">23.96.213.12</span><span class="sxs-lookup"><span data-stu-id="fceae-320">23.96.213.12</span></span>
* <span data-ttu-id="fceae-321">137.135.46.163</span><span class="sxs-lookup"><span data-stu-id="fceae-321">137.135.46.163</span></span>
* <span data-ttu-id="fceae-322">137.135.47.215</span><span class="sxs-lookup"><span data-stu-id="fceae-322">137.135.47.215</span></span>
* <span data-ttu-id="fceae-323">191.232.208.52</span><span class="sxs-lookup"><span data-stu-id="fceae-323">191.232.208.52</span></span>
* <span data-ttu-id="fceae-324">191.232.214.62</span><span class="sxs-lookup"><span data-stu-id="fceae-324">191.232.214.62</span></span>
* <span data-ttu-id="fceae-325">13.75.152.253</span><span class="sxs-lookup"><span data-stu-id="fceae-325">13.75.152.253</span></span>
* <span data-ttu-id="fceae-326">104.41.187.209</span><span class="sxs-lookup"><span data-stu-id="fceae-326">104.41.187.209</span></span>
* <span data-ttu-id="fceae-327">104.41.190.203</span><span class="sxs-lookup"><span data-stu-id="fceae-327">104.41.190.203</span></span>

### <a name="how-many-health-checks-to-my-endpoint-can-i-expect-from-traffic-manager"></a><span data-ttu-id="fceae-328">Сколько проверок работоспособности конечной точки выполняет диспетчер трафика?</span><span class="sxs-lookup"><span data-stu-id="fceae-328">How many health checks to my endpoint can I expect from Traffic Manager?</span></span>

<span data-ttu-id="fceae-329">Число проверок работоспособности конечной точки диспетчером трафика зависит от следующих условий:</span><span class="sxs-lookup"><span data-stu-id="fceae-329">The number of Traffic Manager health checks reaching your endpoint depends on the following:</span></span>
- <span data-ttu-id="fceae-330">Значения, которое вы задали для интервала мониторинга (меньший интервал означает больше запросов, которые передаются в конечную точку за любой указанный период времени).</span><span class="sxs-lookup"><span data-stu-id="fceae-330">the value that you have set for the monitoring interval (smaller interval means more requests landing on your endpoint in any given time period).</span></span>
- <span data-ttu-id="fceae-331">Количества расположений, из которых выполняются проверки работоспособности (IP-адреса, с которых диспетчер трафика может запускать проверку работоспособности, перечислены выше в часто задаваемых вопросах).</span><span class="sxs-lookup"><span data-stu-id="fceae-331">the number of locations from where the health checks originate (the IP addresses from where you can expect these checks is listed in the preceding FAQ).</span></span>

## <a name="traffic-manager-nested-profiles"></a><span data-ttu-id="fceae-332">Вложенные профили диспетчера трафика</span><span class="sxs-lookup"><span data-stu-id="fceae-332">Traffic Manager nested profiles</span></span>

### <a name="how-do-i-configure-nested-profiles"></a><span data-ttu-id="fceae-333">Как настроить вложенные профили?</span><span class="sxs-lookup"><span data-stu-id="fceae-333">How do I configure nested profiles?</span></span>

<span data-ttu-id="fceae-334">Вложенные профили диспетчера трафика можно настроить с помощью Azure Resource Manager (ARM), классических интерфейсов REST API Azure, командлетов Azure PowerShell и команд кроссплатформенного интерфейса командной строки Azure.</span><span class="sxs-lookup"><span data-stu-id="fceae-334">Nested Traffic Manager profiles can be configured using both the Azure Resource Manager and the classic Azure REST APIs, Azure PowerShell cmdlets and cross-platform Azure CLI commands.</span></span> <span data-ttu-id="fceae-335">Они также поддерживаются на новом портале Azure.</span><span class="sxs-lookup"><span data-stu-id="fceae-335">They are also supported via the new Azure portal.</span></span> <span data-ttu-id="fceae-336">Вложенные профили не поддерживаются на классическом портале.</span><span class="sxs-lookup"><span data-stu-id="fceae-336">They are not supported in the classic portal.</span></span>

### <a name="how-many-layers-of-nesting-does-traffic-manger-support"></a><span data-ttu-id="fceae-337">Число уровней вложенности поддерживает диспетчер трафика?</span><span class="sxs-lookup"><span data-stu-id="fceae-337">How many layers of nesting does Traffic Manger support?</span></span>

<span data-ttu-id="fceae-338">Вложенность профилей может достигать 10 уровней.</span><span class="sxs-lookup"><span data-stu-id="fceae-338">You can nest profiles up to 10 levels deep.</span></span> <span data-ttu-id="fceae-339">Нельзя использовать циклы (петли).</span><span class="sxs-lookup"><span data-stu-id="fceae-339">'Loops' are not permitted.</span></span>

### <a name="can-i-mix-other-endpoint-types-with-nested-child-profiles-in-the-same-traffic-manager-profile"></a><span data-ttu-id="fceae-340">Можно ли совмещать конечные точки других типов с вложенными дочерними профилями в одном профиле диспетчера трафика?</span><span class="sxs-lookup"><span data-stu-id="fceae-340">Can I mix other endpoint types with nested child profiles, in the same Traffic Manager profile?</span></span>

<span data-ttu-id="fceae-341">Да.</span><span class="sxs-lookup"><span data-stu-id="fceae-341">Yes.</span></span> <span data-ttu-id="fceae-342">Можно без каких-либо ограничений комбинировать в профиле конечные точки разных типов.</span><span class="sxs-lookup"><span data-stu-id="fceae-342">There are no restrictions on how you combine endpoints of different types within a profile.</span></span>

### <a name="how-does-the-billing-model-apply-for-nested-profiles"></a><span data-ttu-id="fceae-343">Как модель выставления счетов применяется к вложенным профилям?</span><span class="sxs-lookup"><span data-stu-id="fceae-343">How does the billing model apply for Nested profiles?</span></span>

<span data-ttu-id="fceae-344">Использование вложенных профилей не приводит к повышению цен.</span><span class="sxs-lookup"><span data-stu-id="fceae-344">There is no negative pricing impact of using nested profiles.</span></span>

<span data-ttu-id="fceae-345">При выставлении счетов за использование диспетчера трафика учитываются два фактора: проверки работоспособности конечных точек и число запросов DNS (миллионы).</span><span class="sxs-lookup"><span data-stu-id="fceae-345">Traffic Manager billing has two components: endpoint health checks and millions of DNS queries</span></span>

* <span data-ttu-id="fceae-346">Проверки работоспособности конечных точек: плата за дочерний профиль не взимается, если он настроен как конечная точка в родительском профиле.</span><span class="sxs-lookup"><span data-stu-id="fceae-346">Endpoint health checks: There is no charge for a child profile when configured as an endpoint in a parent profile.</span></span> <span data-ttu-id="fceae-347">Мониторинг конечных точек в дочернем профиле тарифицируется обычным образом.</span><span class="sxs-lookup"><span data-stu-id="fceae-347">Monitoring of the endpoints in the child profile is billed in the usual way.</span></span>
* <span data-ttu-id="fceae-348">Запросы DNS: каждый запрос учитывается только один раз.</span><span class="sxs-lookup"><span data-stu-id="fceae-348">DNS queries: Each query is only counted once.</span></span> <span data-ttu-id="fceae-349">Запрос к родительскому профилю, который возвращает конечную точку из дочернего профиля, тарифицируется только для родительского профиля.</span><span class="sxs-lookup"><span data-stu-id="fceae-349">A query against a parent profile that returns an endpoint from a child profile is counted against the parent profile only.</span></span>

<span data-ttu-id="fceae-350">Подробнее см. на [странице цен для диспетчера трафика](https://azure.microsoft.com/pricing/details/traffic-manager/).</span><span class="sxs-lookup"><span data-stu-id="fceae-350">For full details, see the [Traffic Manager pricing page](https://azure.microsoft.com/pricing/details/traffic-manager/).</span></span>

### <a name="is-there-a-performance-impact-for-nested-profiles"></a><span data-ttu-id="fceae-351">Снижают ли вложенные профили производительность?</span><span class="sxs-lookup"><span data-stu-id="fceae-351">Is there a performance impact for nested profiles?</span></span>

<span data-ttu-id="fceae-352">Нет.</span><span class="sxs-lookup"><span data-stu-id="fceae-352">No.</span></span> <span data-ttu-id="fceae-353">Использование вложенных профилей не отражается на производительности.</span><span class="sxs-lookup"><span data-stu-id="fceae-353">There is no performance impact incurred when using nested profiles.</span></span>

<span data-ttu-id="fceae-354">Серверы имен диспетчера трафика используют внутренний механизм опроса иерархии профилей при обработке каждого запроса DNS.</span><span class="sxs-lookup"><span data-stu-id="fceae-354">The Traffic Manager name servers traverse the profile hierarchy internally when processing each DNS query.</span></span> <span data-ttu-id="fceae-355">На запрос DNS к родительскому профилю может предоставляться ответ DNS, указывающий на конечную точку дочернего профиля.</span><span class="sxs-lookup"><span data-stu-id="fceae-355">A DNS query to a parent profile can receive a DNS response with an endpoint from a child profile.</span></span> <span data-ttu-id="fceae-356">Как для отдельного профиля, так и для вложенных профилей достаточно одной записи CNAME.</span><span class="sxs-lookup"><span data-stu-id="fceae-356">A single CNAME record is used whether you are using a single profile or nested profiles.</span></span> <span data-ttu-id="fceae-357">Нет необходимости создавать запись CNAME для каждого профиля в иерархии.</span><span class="sxs-lookup"><span data-stu-id="fceae-357">There is no need to create a CNAME record for each profile in the hierarchy.</span></span>

### <a name="how-does-traffic-manager-compute-the-health-of-a-nested-endpoint-in-a-parent-profile"></a><span data-ttu-id="fceae-358">Как диспетчер трафика вычисляет работоспособность вложенной конечной точки в родительском профиле?</span><span class="sxs-lookup"><span data-stu-id="fceae-358">How does Traffic Manager compute the health of a nested endpoint in a parent profile?</span></span>

<span data-ttu-id="fceae-359">Родительский профиль не проверяет состояние дочерних элементов напрямую.</span><span class="sxs-lookup"><span data-stu-id="fceae-359">The parent profile doesn't perform health checks on the child directly.</span></span> <span data-ttu-id="fceae-360">Вместо этого вычисляется общая характеристика работоспособности для дочернего профиля с учетом состояния работоспособности всех конечных точек этого профиля.</span><span class="sxs-lookup"><span data-stu-id="fceae-360">Instead, the health of the child profile's endpoints are used to calculate the overall health of the child profile.</span></span> <span data-ttu-id="fceae-361">Эта информация передается вверх по иерархии вложенных профилей для определения работоспособности вложенных конечных точек.</span><span class="sxs-lookup"><span data-stu-id="fceae-361">This information is propagated up the nested profile hierarchy to determine the health of the nested endpoint.</span></span> <span data-ttu-id="fceae-362">Родительский профиль использует сводные данные о работоспособности и определяет, можно ли передавать трафик в дочерний профиль.</span><span class="sxs-lookup"><span data-stu-id="fceae-362">The parent profile uses this aggregated health to determine whether the traffic can be directed to the child.</span></span>

<span data-ttu-id="fceae-363">В следующей таблице описан алгоритм диспетчера трафика для проверки работоспособности вложенной конечной точки.</span><span class="sxs-lookup"><span data-stu-id="fceae-363">The following table describes the behavior of Traffic Manager health checks for a nested endpoint.</span></span>

| <span data-ttu-id="fceae-364">Состояние монитора дочернего профиля</span><span class="sxs-lookup"><span data-stu-id="fceae-364">Child Profile Monitor status</span></span> | <span data-ttu-id="fceae-365">Состояние монитора родительской конечной точки</span><span class="sxs-lookup"><span data-stu-id="fceae-365">Parent Endpoint Monitor status</span></span> | <span data-ttu-id="fceae-366">Примечания</span><span class="sxs-lookup"><span data-stu-id="fceae-366">Notes</span></span> |
| --- | --- | --- |
| <span data-ttu-id="fceae-367">"Отключено".</span><span class="sxs-lookup"><span data-stu-id="fceae-367">Disabled.</span></span> <span data-ttu-id="fceae-368">Дочерний профиль отключен.</span><span class="sxs-lookup"><span data-stu-id="fceae-368">The child profile has been disabled.</span></span> |<span data-ttu-id="fceae-369">Остановлен</span><span class="sxs-lookup"><span data-stu-id="fceae-369">Stopped</span></span> |<span data-ttu-id="fceae-370">Состояние родительской конечной точки — «Остановлено», а не «Отключено».</span><span class="sxs-lookup"><span data-stu-id="fceae-370">The parent endpoint state is Stopped, not Disabled.</span></span> <span data-ttu-id="fceae-371">Состояние «Отключено» указывает, что вы отключили конечную точку в родительском профиле.</span><span class="sxs-lookup"><span data-stu-id="fceae-371">The Disabled state is reserved for indicating that you have disabled the endpoint in the parent profile.</span></span> |
| <span data-ttu-id="fceae-372">"Пониженная функциональность".</span><span class="sxs-lookup"><span data-stu-id="fceae-372">Degraded.</span></span> <span data-ttu-id="fceae-373">Как минимум одна конечная точка дочернего профиля находится в состоянии пониженной функциональности.</span><span class="sxs-lookup"><span data-stu-id="fceae-373">At least one child profile endpoint is in a Degraded state.</span></span> |<span data-ttu-id="fceae-374">"В сети": количество конечных точек в дочернем профиле, находящихся в состоянии "В сети", не меньше значения MinChildEndpoints.</span><span class="sxs-lookup"><span data-stu-id="fceae-374">Online: the number of Online endpoints in the child profile is at least the value of MinChildEndpoints.</span></span><BR><span data-ttu-id="fceae-375">"Проверка конечной точки": сумма конечных точек в дочернем профиле, находящихся в состояниях "В сети" и "Проверка конечной точки", не меньше значения MinChildEndpoints.</span><span class="sxs-lookup"><span data-stu-id="fceae-375">CheckingEndpoint: the number of Online plus CheckingEndpoint endpoints in the child profile is at least the value of MinChildEndpoints.</span></span><BR><span data-ttu-id="fceae-376">В противном случае: "Пониженная функциональность".</span><span class="sxs-lookup"><span data-stu-id="fceae-376">Degraded: otherwise.</span></span> |<span data-ttu-id="fceae-377">Трафик перенаправляется к конечной точке с состоянием "Проверка конечной точки".</span><span class="sxs-lookup"><span data-stu-id="fceae-377">Traffic is routed to an endpoint of status CheckingEndpoint.</span></span> <span data-ttu-id="fceae-378">Если задано слишком большое значение MinChildEndpoints, функциональность конечной точки будет понижена.</span><span class="sxs-lookup"><span data-stu-id="fceae-378">If MinChildEndpoints is set too high, the endpoint is always degraded.</span></span> |
| <span data-ttu-id="fceae-379">В сети.</span><span class="sxs-lookup"><span data-stu-id="fceae-379">Online.</span></span> <span data-ttu-id="fceae-380">Как минимум одна конечная точка дочернего профиля находится в подключенном состоянии.</span><span class="sxs-lookup"><span data-stu-id="fceae-380">At least one child profile endpoint is an Online state.</span></span> <span data-ttu-id="fceae-381">Нет конечных точек в состоянии пониженной функциональности.</span><span class="sxs-lookup"><span data-stu-id="fceae-381">No endpoint is in the Degraded state.</span></span> |<span data-ttu-id="fceae-382">См. выше.</span><span class="sxs-lookup"><span data-stu-id="fceae-382">See above.</span></span> | |
| <span data-ttu-id="fceae-383">"Проверка конечных точек".</span><span class="sxs-lookup"><span data-stu-id="fceae-383">CheckingEndpoints.</span></span> <span data-ttu-id="fceae-384">Как минимум одна конечная точка дочернего профиля находится в состоянии проверки конечной точки.</span><span class="sxs-lookup"><span data-stu-id="fceae-384">At least one child profile endpoint is 'CheckingEndpoint'.</span></span> <span data-ttu-id="fceae-385">Нет конечных точек в подключенном состоянии или в состоянии пониженной функциональности.</span><span class="sxs-lookup"><span data-stu-id="fceae-385">No endpoints are 'Online' or 'Degraded'</span></span> |<span data-ttu-id="fceae-386">То же, что и выше.</span><span class="sxs-lookup"><span data-stu-id="fceae-386">Same as above.</span></span> | |
| <span data-ttu-id="fceae-387">"Неактивно".</span><span class="sxs-lookup"><span data-stu-id="fceae-387">Inactive.</span></span> <span data-ttu-id="fceae-388">Все конечные точки дочернего профиля находятся в отключенном или остановленном состоянии либо в этом профиле нет конечных точек.</span><span class="sxs-lookup"><span data-stu-id="fceae-388">All child profile endpoints are either Disabled or Stopped, or this profile has no endpoints.</span></span> |<span data-ttu-id="fceae-389">Остановлено</span><span class="sxs-lookup"><span data-stu-id="fceae-389">Stopped</span></span> | |

## <a name="next-steps"></a><span data-ttu-id="fceae-390">Дальнейшие действия:</span><span class="sxs-lookup"><span data-stu-id="fceae-390">Next steps:</span></span>
- <span data-ttu-id="fceae-391">См. дополнительные сведения в статье [Мониторинг и отработка отказов конечной точки диспетчера трафика](../traffic-manager/traffic-manager-monitoring.md).</span><span class="sxs-lookup"><span data-stu-id="fceae-391">Learn more about Traffic Manager [endpoint monitoring and automatic failover](../traffic-manager/traffic-manager-monitoring.md).</span></span>
- <span data-ttu-id="fceae-392">См. дополнительные сведения в статье [Методы маршрутизации трафика диспетчером трафика](../traffic-manager/traffic-manager-routing-methods.md).</span><span class="sxs-lookup"><span data-stu-id="fceae-392">Learn more about Traffic Manager [traffic routing methods](../traffic-manager/traffic-manager-routing-methods.md).</span></span>