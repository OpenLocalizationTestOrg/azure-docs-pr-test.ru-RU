---
title: "Балансировка нагрузки aaaUsing службами в Azure | Документы Microsoft"
description: "В этом учебнике показано, как сценарий с помощью toocreate hello Azure портфеля балансировки нагрузки: диспетчера трафика, шлюз приложения и подсистемы балансировки нагрузки."
services: traffic-manager
documentationcenter: 
author: liumichelle
manager: vitinnan
editor: 
ms.assetid: f89be3be-a16f-4d47-bcae-db2ab72ade17
ms.service: traffic-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 10/27/2016
ms.author: limichel
ms.openlocfilehash: d217047102d8c4828250dc0733e8ec9ee1e84b3f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="using-load-balancing-services-in-azure"></a>Использование служб балансировки нагрузки в Azure

## <a name="introduction"></a>Введение

Microsoft Azure включает несколько служб, управляющих распределением сетевого трафика и балансировкой нагрузки. Можно использовать эти службы по отдельности или объединять их методов в зависимости от потребностей toobuild hello оптимальное решение.

В этом учебнике мы сначала определить вариант использования клиента и просмотреть с помощью hello, следуя Azure портфеля балансировки нагрузки как его можно сделать более надежный и эффективный: диспетчера трафика, шлюз приложения и подсистемы балансировки нагрузки. Затем представлены пошаговые инструкции по созданию развертывания, которая является географически избыточным, распределяет трафик tooVMs и помогает управлять различными типами запросов.

На концептуальном уровне каждая из этих служб играет роль distinct в иерархии балансировки нагрузки hello.

* **Диспетчер трафика** выполняет глобальную балансировку нагрузки на уровне DNS. Он просматривает входящие запросы DNS и высылает работоспособная конечная точка, в соответствии с hello выбрал маршрутизации клиента hello политики. Используются следующие методы маршрутизации:
  * Производительность маршрутизации toosend hello запрашивающей стороны toohello ближайшей конечной точки с точки зрения задержки.
  * Приоритет маршрутизации toodirect все tooan трафика конечной точки, с другими конечными точками в качестве резервной копии.
  * Взвешенный циклический перебор маршрутизации, который распределяет трафик на основании hello весовой коэффициент, назначенный tooeach конечной точки.

  Клиент Hello напрямую подключается toothat конечной точки. Диспетчер трафика Azure определяет конечную точку работает неправильно, и затем перенаправляет hello работоспособности экземпляра tooanother клиентов. См. слишком[документация диспетчера трафика Azure](traffic-manager-overview.md) toolearn Дополнительные сведения о службе hello.
* **Шлюз приложений** предоставляет контроллер доставки приложений (ADC) как услугу, предлагая для приложения разные функции балансировки нагрузки уровня 7. Это позволяет клиентам toooptimize web фермы производительность за счет разгрузки SSL процессор завершения toohello приложения шлюза. Другие уровня 7 маршрутизации возможности включают циклическое распределение входящего трафика, сходство сеансов на основе файлов cookie, маршрутизация URL-адрес на основе пути и toohost возможность hello несколько веб-сайтов за шлюзом одного приложения. Шлюз приложений можно настроить как шлюз с доступом в Интернет, внутренний шлюз или же как сочетание этих вариантов. Шлюз приложений полностью управляется Azure. Он является масштабируемым и обладает высоким уровнем доступности. Для более эффективного управления предоставляется широкий набор возможностей ведения журнала и диагностики.
* **Подсистема балансировки нагрузки** является неотъемлемой частью стека Azure SDN hello, обслуживании высокой производительности и малой задержкой четвертого уровня балансировки нагрузки для протоколов все UDP и TCP. Она управляет и входящими, и исходящими подключениями. Можно настроить открытых и внутренних балансировки нагрузки конечных точек и определить toomap правила входящих подключений назначения пула подключений tooback узел с помощью TCP и HTTP Проверка работоспособности параметры toomanage доступность службы.

## <a name="scenario"></a>Сценарий

В этом примере мы используем простой веб-сайт, который предоставляет содержимое двух типов: изображения и динамически отображаемые веб-страницы. Hello веб-сайта должен быть географически избыточным, и он должен обслуживать его пользователям hello ближайший (Наименьшая задержка) toothem расположение. Hello разработчик приложения приняла решение, hello все URL-адреса, которые соответствуют шаблону/images / * обслуживаются выделенный пул виртуальных машин, которые отличаются от остальных hello hello веб-фермы.

Кроме того предоставляются динамического содержимого hello пулом виртуальной Машины по умолчанию hello должен tootalk tooa серверную базу данных, размещенной на кластере высокой доступности. всего развертывания Hello настраивается через диспетчер ресурсов Azure.

С помощью диспетчера трафика, шлюз приложения и подсистемы балансировки нагрузки позволяет tooachieve этот веб-сайт, эти цели проектирования:

* **Multi-геоизбыточность**: Если одного региона выходит из строя, маршруты диспетчера трафика легко трафика toohello ближайший регион без какого-либо вмешательства владелец приложения hello.
* **Уменьшая задержку обращений**: так как диспетчер трафика автоматически направляет hello клиента toohello ближайший регион, взаимодействий клиентов hello Уменьшить задержку, при запросе содержимого веб-страницы приветствия.
* **Масштабируемость независимых**: поскольку нагрузки приложения hello web отделяется от типа содержимого, владелец приложения hello можно масштабировать рабочих нагрузок запрос hello независимо друг от друга. Шлюз приложений гарантирует, что трафик hello перенаправленное toohello правой пулов в зависимости от указанного hello правила и hello работоспособности приложения hello.
* **Внутренней балансировки нагрузки**: так как Подсистема балансировки нагрузки — перед hello кластера высокой доступности, используется только предоставляется toohello приложения hello исправна и активной конечной точки для базы данных. Кроме того администратор базы данных может оптимизировать рабочей нагрузки hello распределение активных и пассивных реплик по hello кластера зависит от клиентского приложения hello. Подсистема балансировки нагрузки предоставляет подключений toohello высокого уровня доступности кластера и гарантирует, что только работоспособности базы данных получают запросы на подключение.

Hello следующей схеме показана архитектура hello этого сценария:

![Схема архитектуры балансировки нагрузки](./media/traffic-manager-load-balancing-azure/scenario-diagram.png)

> [!NOTE]
> В этом примере используется только одно из многих возможных конфигураций служб hello балансировки нагрузки, Azure предлагает. Можно комбинировать диспетчера трафика, шлюз приложения и подсистемы балансировки нагрузки и соответствующих toobest при необходимости балансировки нагрузки. Например, если вам не требуется разгрузка SSL или обработка уровня 7, вместо шлюза приложений можно применить подсистему балансировки нагрузки.

## <a name="setting-up-hello-load-balancing-stack"></a>Настройка балансировки нагрузки стека hello

### <a name="step-1-create-a-traffic-manager-profile"></a>Шаг 1. Создание профиля диспетчера трафика

1. В hello портал Azure, щелкните **New**и затем поиска hello marketplace для «Профиля диспетчера трафика».
2. На hello **профиля диспетчера трафика создать** колонке введите hello следующие сведения:

  * **Имя:** присвойте профилю диспетчера трафика уникальное имя префикса DNS.
  * **Метод маршрутизации**: выберите hello политики метод маршрутизации трафика. Дополнительные сведения о методах hello см. в разделе [методы маршрутизации трафика о диспетчере трафика](traffic-manager-routing-methods.md).
  * **Подписки**: выберите hello подписку, которая содержит профиль hello.
  * **Группа ресурсов**: hello выберите группы ресурсов, содержащий профиль hello. Это может быть новая или уже существующая группа ресурсов.
  * **Расположение группы ресурсов**: служба диспетчера трафика является глобальной и не привязана tooa расположение. Тем не менее необходимо указать область группы hello размещения hello метаданные, связанные с профилем диспетчера трафика hello. Это расположение не оказывает влияния на доступность среды выполнения hello hello профиля.

3. Нажмите кнопку **создать** toogenerate hello профиля диспетчера трафика.

  ![Колонка создания диспетчера трафика](./media/traffic-manager-load-balancing-azure/s1-create-tm-blade.png)

### <a name="step-2-create-hello-application-gateways"></a>Шаг 2: Создание hello шлюзы приложений

1. В hello hello левой панели портала Azure щелкните **New** > **сети** > **шлюз приложений**.
2. Введите следующие основные сведения о шлюзе приложения hello hello:

  * **Имя**: hello имя шлюза приложения hello.
  * **Размер SKU**: hello размер шлюза приложения hello, доступной в качестве малый, средний и крупный.
  * **Число экземпляров**: hello количество экземпляров, значение от 2 до 10.
  * **Группа ресурсов**: hello группы ресурсов, содержащий шлюза приложения hello. Это может быть новая или уже существующая группа ресурсов.
  * **Расположение**: hello регион для шлюза приложения hello, который является hello же расположении, что группа ресурсов hello. расположение Hello важен, так как hello виртуальную сеть и общедоступный IP-адрес должен находиться в hello местоположения hello шлюза.
3. Нажмите кнопку **ОК**.
4. Определите hello виртуальной сети, подсети, интерфейсный IP и конфигураций прослушивателей для шлюза приложения hello. В этом сценарии — IP-адрес интерфейса hello **открытый**, что позволяет позднее добавить в качестве toohello конечной точки профиля диспетчера трафика toobe.
5. Настройте прослушиватель hello с одним из следующих вариантов hello:
    * Если используется HTTP, что нет tooconfigure. Нажмите кнопку **ОК**.
    * Если вы используете протокол HTTPS, необходимо настроить дополнительные параметры. См. слишком[создания шлюза приложения](../application-gateway/application-gateway-create-gateway-portal.md), начиная с шага 9. После завершения настройки hello щелкните **ОК**.

#### <a name="configure-url-routing-for-application-gateways"></a>Настройка маршрутизации URL-адресов для шлюзов приложений

При выборе пула внутренней шлюза приложения, настроенного с помощью правила на основе пути принимает шаблон пути URL-адреса запроса hello в распространения tooround по принципу циклического сложения. В этом сценарии мы добавляем toodirect правила на основе пути любой URL-адрес с «/images/\*"пул серверов toohello изображения. Дополнительные сведения о настройке URL-адрес маршрутизации на основе пути для шлюза приложения, см. в разделе слишком[создать правило на основе пути для шлюза приложения](../application-gateway/application-gateway-create-url-route-portal.md).

![Схема веб-уровня шлюза приложений](./media/traffic-manager-load-balancing-azure/web-tier-diagram.png)

1. В группе ресурсов последовательно toohello экземпляр шлюза приложения hello, созданную в предшествующих раздел hello.
2. В разделе **параметры**выберите **внутренние пулы**и выберите **добавить** tooadd hello виртуальных машин, которые должны tooassociate с пулами серверной части веб уровня hello.
3. На hello **Добавление внутреннего пула** колонки, введите имя hello hello серверной части пула и все IP-адреса hello hello машин, которые находятся в пуле hello. В нашем примере мы подключаем два серверных пула виртуальных машин.

  ![Колонка добавления серверного пула для шлюза приложений](./media/traffic-manager-load-balancing-azure/s2-appgw-add-bepool.png)

4. В разделе **параметры** шлюза приложения hello, выберите **правила**и нажмите кнопку hello **путь на основе** кнопку tooadd правило.

  ![Кнопка Path based (На основе пути) для правил шлюза приложения](./media/traffic-manager-load-balancing-azure/s2-appgw-add-pathrule.png)

5. На hello **добавить правило на основе пути** колонки, настройте правило hello, предоставляя hello следующую информацию.

   Основные параметры.

   + **Имя**: hello понятное имя правила hello, доступной на портале hello.
   + **Прослушиватель**: hello прослушиватель, который используется для правила hello.
   + **По умолчанию серверный пул**: hello toobe серверной части пула, использовать правило по умолчанию hello.
   + **Параметры HTTP по умолчанию**: hello HTTP toobe параметры, используемые с правилом по умолчанию hello.

   Правила на основе пути.

   + **Имя**: hello понятное имя правила на основе пути hello.
   + **Пути**: hello правило для пути, используемый для перенаправления трафика.
   + **Внутренний пул**: hello toobe серверной части пула, используемый с этим правилом.
   + **Параметр HTTP**: toobe параметров hello HTTP, используемый с этим правилом.

   > [!IMPORTANT]
   > Пути: допустимые пути должны начинаться с символа /. Здравствуйте, подстановочный знак "\*" допускается только в конце hello. Примеры допустимых значений: /xyz, /xyz\*; или /xyz/\*.

   ![Колонка добавления правила на основе пути для шлюза приложений](./media/traffic-manager-load-balancing-azure/s2-appgw-pathrule-blade.png)

### <a name="step-3-add-application-gateways-toohello-traffic-manager-endpoints"></a>Шаг 3: Добавление конечных точек диспетчера трафика toohello шлюзы приложения

В этом случае диспетчер трафика — подключенных tooapplication шлюзов (согласно настройке в предыдущих шагах hello), которые находятся в разных регионах. Теперь, когда настроены шлюзы приложения hello, hello следующим шагом является tooconnect их tooyour профиль диспетчера трафика.

1. Откройте профиль диспетчера трафика. Таким образом, найдите toodo в группе ресурсов или поиск hello имя профиля диспетчера трафика hello **все ресурсы**.
2. Выберите в левой области hello **конечные точки**и нажмите кнопку **добавить** tooadd конечной точки.

  ![Кнопка добавления конечных точек диспетчера трафика](./media/traffic-manager-load-balancing-azure/s3-tm-add-endpoint.png)

3. На hello **добавить конечную точку** колонки, создайте конечную точку, введя hello следующую информацию:

  * **Тип**: выберите тип hello tooload балансировки конечной точки. В этом случае выберите **конечной точки Azure** так, как мы подключаетесь экземпляры шлюза toohello приложений, которые были настроены ранее.
  * **Имя**: Введите имя hello hello конечной точки.
  * **Целевой тип ресурса**: выберите **общедоступный IP-адрес** и затем в разделе **целевой ресурс**, выберите hello общедоступный IP-адрес шлюза приложения hello, который был настроен ранее.

   ![Колонка добавления конечной точки диспетчера трафика](./media/traffic-manager-load-balancing-azure/s3-tm-add-endpoint-blade.png)

4. Теперь можно проверить настройки программы установки, к нему с hello DNS вашего профиля диспетчера трафика (в этом примере: TrafficManagerScenario.trafficmanager.net). Можно повторно отправить запросы, подключить или привести к остановке виртуальные машины и веб-серверы, которые были созданы в различных регионах и изменение настроек tootest параметры профиля диспетчера трафика hello.

### <a name="step-4-create-a-load-balancer"></a>Шаг 4. Создание балансировщика нагрузки

В этом случае подсистема балансировки нагрузки распределяет подключения из hello веб-уровня toohello базы данных в пределах кластера высокой доступности.

Если кластер высокого уровня доступности базы данных используется SQL Server AlwaysOn, см. слишком[настроить один или несколько всегда на прослушиватели группы доступности](../virtual-machines/windows/sql/virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md) пошаговые инструкции.

Дополнительные сведения о настройке внутренний балансировщик нагрузки см. в разделе [создать внутренний балансировщик нагрузки в hello портал Azure](../load-balancer/load-balancer-get-started-ilb-arm-portal.md).

1. В hello hello левой панели портала Azure щелкните **New** > **сети** > **балансировки нагрузки**.
2. На hello **балансировки нагрузки создать** колонке выберите имя для балансировки нагрузки.
3. Набор hello **тип** слишком**внутренний**и выберите hello соответствующую виртуальную сеть и подсеть для hello tooreside подсистемы балансировки нагрузки в.
4. В разделе **Назначение IP-адресов** выберите вариант **Динамическое** или **Статическое**.
5. В разделе **группы ресурсов**, выбрать группу ресурсов hello hello подсистемы балансировки нагрузки.
6. В разделе **расположение**, выберите соответствующую область hello hello подсистемы балансировки нагрузки.
7. Нажмите кнопку **создать** балансировки нагрузки toogenerate hello.

#### <a name="connect-a-back-end-database-tier-toohello-load-balancer"></a>Подключение подсистемы балансировки нагрузки уровня toohello серверной базы данных

1. Из группы ресурсов найти hello подсистемы балансировки нагрузки, созданный на предыдущих этапах hello.
2. В разделе **параметры**, нажмите кнопку **внутренние пулы**и нажмите кнопку **добавить** tooadd пула серверной части.

  ![Колонка добавления серверного пула к балансировщику нагрузки](./media/traffic-manager-load-balancing-azure/s4-ilb-add-bepool.png)

3. На hello **Добавление внутреннего пула** колонки, введите имя hello пула hello серверной части.
4. Добавьте отдельные компьютеры или пул доступности toohello набор серверной части.

#### <a name="configure-a-probe"></a>Настройка проверки

1. В балансировки нагрузки в разделе **параметры**выберите **проверяет**и нажмите кнопку **добавить** tooadd зонда.

 ![Колонка добавления пробы в балансировщик нагрузки](./media/traffic-manager-load-balancing-azure/s4-ilb-add-probe.png)

2. На hello **пробы добавить** колонки, введите имя hello для пробы hello.
3. Выберите hello **протокола** для пробы hello. Для базы данных вам больше подойдет проба TCP, а не HTTP. toolearn Дополнительные сведения о зондов подсистемы балансировки нагрузки ссылаются слишком[зондов подсистемы балансировки нагрузки понимание](../load-balancer/load-balancer-custom-probe-overview.md).
4. Введите hello **порт** из toobe вашей базы данных, для доступа к пробы hello.
5. В разделе **интервал**, укажите, как часто tooprobe hello приложения.
6. В разделе **порог состояния неработоспособности**, укажите hello число сбоев непрерывного пробы, которые должны быть выполнены для виртуальной Машины toobe hello серверной части, считаются неисправное.
7. Нажмите кнопку **ОК** toocreate hello пробы.

#### <a name="configure-hello-load-balancing-rules"></a>Настройка правил балансировки нагрузки hello

1. В разделе **параметры** балансировки нагрузки, выберите **правила подсистемы балансировки нагрузки**и нажмите кнопку **добавить** toocreate правила.
2. На hello **правило балансировки нагрузки добавить** колонке введите hello **имя** для hello правила балансировки нагрузки.
3. Выберите hello **интерфейсный IP-адрес** из hello подсистемы балансировки нагрузки, **протокола**, и **порт**.
4. В разделе **внутренний порт**, укажите порт toobe hello, используются в пуле hello серверной части.
5. Выберите hello **внутренний пул** и hello **проверки** , созданные в hello предыдущего действия tooapply hello правило.
6. В разделе **Сохранение сеанса**, выберите способ toopersist сеансы hello.
7. В разделе **тайм-ауты простоя**, укажите количество минут, прежде чем время ожидания простоя в hello.
8. В разделе **Плавающий IP-адрес** выберите **Отключен** или **Включен**.
9. Нажмите кнопку **ОК** toocreate hello правило.

### <a name="step-5-connect-web-tier-vms-toohello-load-balancer"></a>Шаг 5: Подключение подсистемы балансировки нагрузки веб уровень виртуальных машин toohello

Теперь мы настраиваем hello IP-адресов и подсистемы балансировки нагрузки переднего плана порт hello приложений, выполняющихся на веб уровень виртуальных машин для подключения к любой базе данных. Такая настройка является toohello конкретных приложений, запущенных на этих виртуальных машинах. tooconfigure hello конечный IP-адрес и порт, см. документацию toohello приложения. toofind hello IP-адрес внешнего интерфейса hello в hello портал Azure, переходите переднего плана пула IP-адресов toohello hello **параметры подсистемы балансировки нагрузки** колонку.

![Область перехода к разделу пула внешних IP-адресов балансировщика нагрузки](./media/traffic-manager-load-balancing-azure/s5-ilb-frontend-ippool.png)

## <a name="next-steps"></a>Дальнейшие действия

* [Обзор диспетчера трафика](traffic-manager-overview.md)
* [Обзор шлюза приложений](../application-gateway/application-gateway-introduction.md)
* [Обзор Azure Load Balancer](../load-balancer/load-balancer-overview.md)
