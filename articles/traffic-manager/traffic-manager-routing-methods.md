---
title: "методы маршрутизации трафика aaaAzure диспетчеру трафика - | Документы Microsoft"
description: "Это поможет вам понять методы маршрутизации трафика различных hello, используемого диспетчером трафика статьи, посвященные"
services: traffic-manager
documentationcenter: 
author: KumudD
manager: timlt
editor: 
ms.assetid: db1efbf6-6762-4c7a-ac99-675d4eeb54d0
ms.service: traffic-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 07/13/2017
ms.author: kumud
ms.openlocfilehash: b3eeca63ab5f2b9cd4a3a6b6a8fd3e40059e32b5
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="traffic-manager-routing-methods"></a><span data-ttu-id="1ad7d-103">Методы маршрутизации диспетчера трафика</span><span class="sxs-lookup"><span data-stu-id="1ad7d-103">Traffic Manager routing methods</span></span>

<span data-ttu-id="1ad7d-104">Azure диспетчера трафика поддерживает четыре маршрутизации трафика методы toodetermine как tooroute сетевой трафик toohello различные конечные точки службы.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-104">Azure Traffic Manager supports four traffic-routing methods toodetermine how tooroute network traffic toohello various service endpoints.</span></span> <span data-ttu-id="1ad7d-105">Диспетчер трафика применяется hello маршрутизации трафика метод tooeach запроса DNS, он получает.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-105">Traffic Manager applies hello traffic-routing method tooeach DNS query it receives.</span></span> <span data-ttu-id="1ad7d-106">Метод маршрутизации трафика Hello определяет, какая конечная точка возвращенный в ответе DNS hello.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-106">hello traffic-routing method determines which endpoint returned in hello DNS response.</span></span>

<span data-ttu-id="1ad7d-107">В диспетчере трафика доступно четыре метода маршрутизации трафика.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-107">There are four traffic routing methods available in Traffic Manager:</span></span>

* <span data-ttu-id="1ad7d-108">**[Приоритет](#priority):** выберите **приоритет** при необходимости toouse конечную точку основной службы для всех типов трафика и обеспечивать резервные копии на случай hello первичного или hello резервных конечных точек недоступны.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-108">**[Priority](#priority):** Select **Priority** when you want toouse a primary service endpoint for all traffic, and provide backups in case hello primary or hello backup endpoints are unavailable.</span></span>
* <span data-ttu-id="1ad7d-109">**[Взвешенное](#weighted):** выберите **Взвешенное** при необходимости toodistribute трафика между несколькими конечными точками, либо равномерно или соответствующим tooweights, который определен.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-109">**[Weighted](#weighted):** Select **Weighted** when you want toodistribute traffic across a set of endpoints, either evenly or according tooweights, which you define.</span></span>
* <span data-ttu-id="1ad7d-110">**[Производительность](#performance):** выберите **производительности** при конечные точки в разных географических регионах и требуется, чтобы конечные пользователи toouse hello «близко расположенные» endpoint с точки зрения hello наименьшим значением задержки сети.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-110">**[Performance](#performance):** Select **Performance** when you have endpoints in different geographic locations and you want end users toouse hello "closest" endpoint in terms of hello lowest network latency.</span></span>
* <span data-ttu-id="1ad7d-111">**[Географические](#geographic):** выберите **географической** таким образом, пользователи направленной toospecific конечным точкам (Azure, внешний или вложенные) на основе какие географическое расположение их DNS-запрос исходит от.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-111">**[Geographic](#geographic):** Select **Geographic** so that users are directed toospecific endpoints (Azure, External, or Nested) based on which geographic location their DNS query originates from.</span></span> <span data-ttu-id="1ad7d-112">Это повышает эффективность диспетчера трафика клиентов tooenable сценарии, где зная географического региона пользователя и перенаправление их на основе этого важные.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-112">This empowers Traffic Manager customers tooenable scenarios where knowing a user’s geographic region and routing them based on that is important.</span></span> <span data-ttu-id="1ad7d-113">К примерам относятся соблюдение предписаний независимости данных, локализация содержимого и взаимодействия с пользователем, а также измерение трафика из разных регионов.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-113">Examples include complying with data sovereignty mandates, localization of content & user experience and measuring traffic from different regions.</span></span>

<span data-ttu-id="1ad7d-114">Все профили диспетчера трафика включают мониторинг работоспособности и автоматическую отработку отказа для всех конечных точек.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-114">All Traffic Manager profiles include monitoring of endpoint health and automatic endpoint failover.</span></span> <span data-ttu-id="1ad7d-115">Дополнительные сведения см. в статье [Мониторинг и отработка отказов конечной точки диспетчера трафика](traffic-manager-monitoring.md).</span><span class="sxs-lookup"><span data-stu-id="1ad7d-115">For more information, see [Traffic Manager Endpoint Monitoring](traffic-manager-monitoring.md).</span></span> <span data-ttu-id="1ad7d-116">Отдельный профиль диспетчера трафика может использовать только один метод маршрутизации трафика.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-116">A single Traffic Manager profile can use only one traffic routing method.</span></span> <span data-ttu-id="1ad7d-117">В любое время для профиля можно выбрать другой метод маршрутизации трафика.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-117">You can select a different traffic routing method for your profile at any time.</span></span> <span data-ttu-id="1ad7d-118">Изменения применяются в течение одной минуты, не приводя к простою.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-118">Changes are applied within one minute, and no downtime is incurred.</span></span> <span data-ttu-id="1ad7d-119">Методы маршрутизации трафика можно комбинировать с помощью вложенных профилей диспетчера трафика.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-119">Traffic-routing methods can be combined by using nested Traffic Manager profiles.</span></span> <span data-ttu-id="1ad7d-120">Вложенность включает сложных и гибкие конфигурации маршрутизации трафика, соответствующие потребностям hello крупных и сложных приложений.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-120">Nesting enables sophisticated and flexible traffic-routing configurations that meet hello needs of larger, complex applications.</span></span> <span data-ttu-id="1ad7d-121">Дополнительную информацию см. в статье [Вложенные профили диспетчера трафика](traffic-manager-nested-profiles.md).</span><span class="sxs-lookup"><span data-stu-id="1ad7d-121">For more information, see [nested Traffic Manager profiles](traffic-manager-nested-profiles.md).</span></span>

## <span data-ttu-id="1ad7d-122"><a name = "priority"></a>Метод маршрутизации трафика по приоритету</span><span class="sxs-lookup"><span data-stu-id="1ad7d-122"><a name = "priority"></a>Priority traffic-routing method</span></span>

<span data-ttu-id="1ad7d-123">Часто организация хочет tooprovide надежность для своих служб, развернув одну или несколько резервных копий служб, в случае, если их основная служба перестает работать.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-123">Often an organization wants tooprovide reliability for its services by deploying one or more backup services in case their primary service goes down.</span></span> <span data-ttu-id="1ad7d-124">Метод маршрутизации трафика «Приоритет» Hello позволяет Azure tooeasily клиентам реализовывать этот шаблон отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-124">hello 'Priority' traffic-routing method allows Azure customers tooeasily implement this failover pattern.</span></span>

![Диспетчер трафика Azure: маршрутизация трафика по приоритету][1]

<span data-ttu-id="1ad7d-126">Hello профиля диспетчера трафика содержит упорядоченный список конечных точек службы.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-126">hello Traffic Manager profile contains a prioritized list of service endpoints.</span></span> <span data-ttu-id="1ad7d-127">По умолчанию диспетчер трафика отправляет все трафика toohello основной (высший приоритет) конечной точки.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-127">By default, Traffic Manager sends all traffic toohello primary (highest-priority) endpoint.</span></span> <span data-ttu-id="1ad7d-128">Если недоступен основной конечной точки hello, диспетчер трафика маршруты hello вторая конечная точка toohello трафика.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-128">If hello primary endpoint is not available, Traffic Manager routes hello traffic toohello second endpoint.</span></span> <span data-ttu-id="1ad7d-129">Если обе конечные точки hello первичного и вторичного недоступны, трафик hello направляется toohello в-третьих, и т. д.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-129">If both hello primary and secondary endpoints are not available, hello traffic goes toohello third, and so on.</span></span> <span data-ttu-id="1ad7d-130">Доступность hello конечной точки зависит от настройки hello состоянии (включен или выключен) и hello мониторинга конечных точек.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-130">Availability of hello endpoint is based on hello configured status (enabled or disabled) and hello ongoing endpoint monitoring.</span></span>

### <a name="configuring-endpoints"></a><span data-ttu-id="1ad7d-131">Настройка конечных точек</span><span class="sxs-lookup"><span data-stu-id="1ad7d-131">Configuring endpoints</span></span>

<span data-ttu-id="1ad7d-132">С помощью диспетчера ресурсов Azure настройте приоритет конечной точки hello явным образом при помощи свойства «priority» hello для каждой конечной точки.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-132">With Azure Resource Manager, you configure hello endpoint priority explicitly using hello 'priority' property for each endpoint.</span></span> <span data-ttu-id="1ad7d-133">Допускаются значения в диапазоне от 1 до 1000.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-133">This property is a value between 1 and 1000.</span></span> <span data-ttu-id="1ad7d-134">Чем меньше значение, тем выше приоритет.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-134">Lower values represent a higher priority.</span></span> <span data-ttu-id="1ad7d-135">Нельзя использовать одинаковые значения приоритетов для нескольких конечных точек.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-135">Endpoints cannot share priority values.</span></span> <span data-ttu-id="1ad7d-136">Задание свойства hello является необязательным.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-136">Setting hello property is optional.</span></span> <span data-ttu-id="1ad7d-137">Если этот параметр опущен, используется приоритет по умолчанию на основе порядка hello конечной точки.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-137">When omitted, a default priority based on hello endpoint order is used.</span></span>

##<span data-ttu-id="1ad7d-138"><a name = "weighted"></a>Метод маршрутизации трафика со взвешиванием</span><span class="sxs-lookup"><span data-stu-id="1ad7d-138"><a name = "weighted"></a>Weighted traffic-routing method</span></span>
<span data-ttu-id="1ad7d-139">Метод маршрутизации трафика «Взвешенное» Hello позволяет toodistribute трафик равномерно или toouse предварительно определенных весовой коэффициент.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-139">hello 'Weighted' traffic-routing method allows you toodistribute traffic evenly or toouse a pre-defined weighting.</span></span>

![Диспетчер трафика Azure: маршрутизации трафика по методу взвешивания][2]

<span data-ttu-id="1ad7d-141">В hello взвешенного маршрутизации трафика метода назначьте вес tooeach конечной точки в конфигурации профиля диспетчера трафика hello.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-141">In hello Weighted traffic-routing method, you assign a weight tooeach endpoint in hello Traffic Manager profile configuration.</span></span> <span data-ttu-id="1ad7d-142">Вес Hello является целым числом от 1 too1000.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-142">hello weight is an integer from 1 too1000.</span></span> <span data-ttu-id="1ad7d-143">Это необязательный параметр.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-143">This parameter is optional.</span></span> <span data-ttu-id="1ad7d-144">Если значение не указано, диспетчер трафика использует коэффициент 1 по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-144">If omitted, Traffic Managers uses a default weight of '1'.</span></span>

<span data-ttu-id="1ad7d-145">Для каждого полученного запроса DNS диспетчер трафика случайным образом выбирает конечную точку из числа доступных.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-145">For each DNS query received, Traffic Manager randomly chooses an available endpoint.</span></span> <span data-ttu-id="1ad7d-146">Hello вероятность того, выбрав конечную точку основан на hello весовые tooall доступных конечных точек.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-146">hello probability of choosing an endpoint is based on hello weights assigned tooall available endpoints.</span></span> <span data-ttu-id="1ad7d-147">С помощью hello же вес через все результаты конечные точки в даже трафика распространения.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-147">Using hello same weight across all endpoints results in an even traffic distribution.</span></span> <span data-ttu-id="1ad7d-148">С помощью весов выше или ниже на специальные конечные точки вызывает toobe эти конечные точки, более или менее часто возвращаются в ответах DNS hello.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-148">Using higher or lower weights on specific endpoints causes those endpoints toobe returned more or less frequently in hello DNS responses.</span></span>

<span data-ttu-id="1ad7d-149">метод Hello Взвешенное обеспечивает некоторые полезные сценарии:</span><span class="sxs-lookup"><span data-stu-id="1ad7d-149">hello weighted method enables some useful scenarios:</span></span>

* <span data-ttu-id="1ad7d-150">Постепенное обновление приложения: выделить процент tooroute трафика tooa новую конечную точку и постепенно увеличивается трафик hello too100% времени.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-150">Gradual application upgrade: Allocate a percentage of traffic tooroute tooa new endpoint, and gradually increase hello traffic over time too100%.</span></span>
* <span data-ttu-id="1ad7d-151">TooAzure миграции приложения: создайте профиль с Azure и внешними конечными точками.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-151">Application migration tooAzure: Create a profile with both Azure and external endpoints.</span></span> <span data-ttu-id="1ad7d-152">Измените вес hello hello конечные точки tooprefer hello новых конечных точек.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-152">Adjust hello weight of hello endpoints tooprefer hello new endpoints.</span></span>
* <span data-ttu-id="1ad7d-153">В облако для получения дополнительной емкости: быстро Расширьте локальное развертывание в облаке hello, изменив профиль диспетчера трафика.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-153">Cloud-bursting for additional capacity: Quickly expand an on-premises deployment into hello cloud by putting it behind a Traffic Manager profile.</span></span> <span data-ttu-id="1ad7d-154">Если вам требуется дополнительная емкость в облаке hello, можно добавить или несколько конечных и указать, какая часть трафика направляется tooeach конечной точки.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-154">When you need extra capacity in hello cloud, you can add or enable more endpoints and specify what portion of traffic goes tooeach endpoint.</span></span>

<span data-ttu-id="1ad7d-155">Hello портала диспетчера ресурсов Azure поддерживает настройку hello маршрутизации взвешенного трафика.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-155">hello Resource Manager Azure portal supports hello configuration of weighted traffic routing.</span></span>  <span data-ttu-id="1ad7d-156">Вы можете настроить веса hello версии диспетчера ресурсов Azure PowerShell, CLI и hello API-интерфейсов REST.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-156">You can configure weights using hello Resource Manager versions of Azure PowerShell, CLI, and hello REST APIs.</span></span>

<span data-ttu-id="1ad7d-157">Это важные toounderstand что ответов DNS кэшироваться клиентами и hello рекурсивный DNS-серверами, hello клиентам использовать tooresolve DNS-имена.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-157">It is important toounderstand that DNS responses are cached by clients and by hello recursive DNS servers that hello clients use tooresolve DNS names.</span></span> <span data-ttu-id="1ad7d-158">Это может повлиять на распределение трафика по приоритетам.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-158">This caching can have an impact on weighted traffic distributions.</span></span> <span data-ttu-id="1ad7d-159">Если существует большое число hello клиентов и рекурсивный DNS-серверы, распределение трафика работает надлежащим образом.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-159">When hello number of clients and recursive DNS servers is large, traffic distribution works as expected.</span></span> <span data-ttu-id="1ad7d-160">Однако при небольшом число hello рекурсивный DNS-серверы и клиенты кэширование может значительно исказить распределение трафика hello.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-160">However, when hello number of clients or recursive DNS servers is small, caching can significantly skew hello traffic distribution.</span></span>

<span data-ttu-id="1ad7d-161">Типичные примеры такой ситуации:</span><span class="sxs-lookup"><span data-stu-id="1ad7d-161">Common use cases include:</span></span>

* <span data-ttu-id="1ad7d-162">среды для разработки и тестирования;</span><span class="sxs-lookup"><span data-stu-id="1ad7d-162">Development and testing environments</span></span>
* <span data-ttu-id="1ad7d-163">обмен данных между приложениями;</span><span class="sxs-lookup"><span data-stu-id="1ad7d-163">Application-to-application communications</span></span>
* <span data-ttu-id="1ad7d-164">приложения, предназначенные для узкого круга пользователей, которые используют общую инфраструктуру рекурсивной DNS-службы (например, сотрудники компании, подключенные через общий прокси-сервер).</span><span class="sxs-lookup"><span data-stu-id="1ad7d-164">Applications aimed at a narrow user-base that share a common recursive DNS infrastructure (for example, employees of company connecting through a proxy)</span></span>

<span data-ttu-id="1ad7d-165">Эти эффекты кэширования DNS являются общие tooall трафика DNS маршрутизации системы, не только диспетчера трафика Azure.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-165">These DNS caching effects are common tooall DNS-based traffic routing systems, not just Azure Traffic Manager.</span></span> <span data-ttu-id="1ad7d-166">В некоторых случаях явно очистить кэш DNS hello может предоставлять временное решение.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-166">In some cases, explicitly clearing hello DNS cache may provide a workaround.</span></span> <span data-ttu-id="1ad7d-167">В других случаях более подходящим может оказаться альтернативный метод маршрутизации трафика.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-167">In other cases, an alternative traffic-routing method may be more appropriate.</span></span>

## <span data-ttu-id="1ad7d-168"><a name = "performance"></a>Метод маршрутизации трафика для повышения производительности</span><span class="sxs-lookup"><span data-stu-id="1ad7d-168"><a name = "performance"></a>Performance traffic-routing method</span></span>

<span data-ttu-id="1ad7d-169">Развертывание конечных точек в двух или нескольких расположениях по всему миру hello может повысить скорость реагирования hello многие приложения путем маршрутизации трафика toohello расположения входящего в tooyou «ближайший».</span><span class="sxs-lookup"><span data-stu-id="1ad7d-169">Deploying endpoints in two or more locations across hello globe can improve hello responsiveness of many applications by routing traffic toohello location that is 'closest' tooyou.</span></span> <span data-ttu-id="1ad7d-170">Метод маршрутизации трафика «Производительность» Hello предоставляет эту возможность.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-170">hello 'Performance' traffic-routing method provides this capability.</span></span>

![Диспетчер трафика Azure: маршрутизация трафика по производительности][3]

<span data-ttu-id="1ad7d-172">Конечная точка «ближайший» Hello не обязательно ближайшая по географическому расстоянию.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-172">hello 'closest' endpoint is not necessarily closest as measured by geographic distance.</span></span> <span data-ttu-id="1ad7d-173">Вместо этого метод маршрутизации трафика «Производительность» hello определяет hello ближайшей конечной точкой, путем измерения задержки в сети.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-173">Instead, hello 'Performance' traffic-routing method determines hello closest endpoint by measuring network latency.</span></span> <span data-ttu-id="1ad7d-174">Диспетчер трафика ведет таблицы задержек Интернета tootrack hello приема-передачи времени между диапазоны IP-адресов и каждый центр обработки данных Azure.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-174">Traffic Manager maintains an Internet Latency Table tootrack hello round-trip time between IP address ranges and each Azure datacenter.</span></span>

<span data-ttu-id="1ad7d-175">Диспетчер трафика определяет hello исходный IP-адрес входящего запроса DNS hello в hello таблицы задержек Интернета.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-175">Traffic Manager looks up hello source IP address of hello incoming DNS request in hello Internet Latency Table.</span></span> <span data-ttu-id="1ad7d-176">Диспетчер трафика выбирает доступную конечную точку в центре обработки данных Azure, имеет наименьшую задержку hello для этого диапазона IP-адресов, а затем возвращает эту конечную точку в ответ DNS hello hello.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-176">Traffic Manager chooses an available endpoint in hello Azure datacenter that has hello lowest latency for that IP address range, then returns that endpoint in hello DNS response.</span></span>

<span data-ttu-id="1ad7d-177">Как описано в статье [Как работает диспетчер трафика](traffic-manager-overview.md#how-traffic-manager-works), запросы DNS поступают к нему не напрямую от клиентов.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-177">As explained in [How Traffic Manager Works](traffic-manager-overview.md#how-traffic-manager-works), Traffic Manager does not receive DNS queries directly from clients.</span></span> <span data-ttu-id="1ad7d-178">Вместо этого DNS-запросы поступают из, настроенных toouse hello клиентов службы DNS рекурсивные hello.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-178">Rather, DNS queries come from hello recursive DNS service that hello clients are configured toouse.</span></span> <span data-ttu-id="1ad7d-179">Таким образом hello IP адрес, используемый toodetermine hello «ближайший» конечная точка не является IP-адрес клиента hello, но это IP-адрес hello hello рекурсивный DNS службы.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-179">Therefore, hello IP address used toodetermine hello 'closest' endpoint is not hello client's IP address, but it is hello IP address of hello recursive DNS service.</span></span> <span data-ttu-id="1ad7d-180">На практике этот IP-адрес является хорошим прокси-сервера для клиента hello.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-180">In practice, this IP address is a good proxy for hello client.</span></span>


<span data-ttu-id="1ad7d-181">Трафик Manager регулярно обновлений hello tooaccount таблицы задержек Интернета для изменения в hello глобальной сети Интернет и новый регионов Azure.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-181">Traffic Manager regularly updates hello Internet Latency Table tooaccount for changes in hello global Internet and new Azure regions.</span></span> <span data-ttu-id="1ad7d-182">Тем не менее производительность приложений различается в зависимости от вариантов нагрузки в режиме реального времени через Интернет hello.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-182">However, application performance varies based on real-time variations in load across hello Internet.</span></span> <span data-ttu-id="1ad7d-183">При маршрутизации трафика по производительности текущая нагрузка на конкретную конечную точку службы не отслеживается.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-183">Performance traffic-routing does not monitor load on a given service endpoint.</span></span> <span data-ttu-id="1ad7d-184">Но если конечная точка становится недоступной, диспетчер трафика перестает включать ее в ответы на запросы DNS.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-184">However, if an endpoint becomes unavailable, Traffic Manager does not include it in DNS query responses.</span></span>


<span data-ttu-id="1ad7d-185">Toonote точек:</span><span class="sxs-lookup"><span data-stu-id="1ad7d-185">Points toonote:</span></span>

* <span data-ttu-id="1ad7d-186">Если профиль содержит несколько конечных точек в hello же регионе Azure, то диспетчер трафика распределяет трафик равномерно по доступным точкам hello в этом регионе.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-186">If your profile contains multiple endpoints in hello same Azure region, then Traffic Manager distributes traffic evenly across hello available endpoints in that region.</span></span> <span data-ttu-id="1ad7d-187">Если вы предпочитаете распределение трафика в пределах региона, используйте [вложенные профили диспетчера трафика](traffic-manager-nested-profiles.md).</span><span class="sxs-lookup"><span data-stu-id="1ad7d-187">If you prefer a different traffic distribution within a region, you can use [nested Traffic Manager profiles](traffic-manager-nested-profiles.md).</span></span>
* <span data-ttu-id="1ad7d-188">Включение всех конечных точек в hello ближайший регион Azure, ограниченной, диспетчера трафика перемещает конечные точки toohello трафик в регион Azure Далее ближайший hello.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-188">If all enabled endpoints in hello closest Azure region are degraded, Traffic Manager moves traffic toohello endpoints in hello next closest Azure region.</span></span> <span data-ttu-id="1ad7d-189">Toodefine последовательность предпочтительный отработки отказа, используйте [вложенных профилей диспетчера трафика](traffic-manager-nested-profiles.md).</span><span class="sxs-lookup"><span data-stu-id="1ad7d-189">If you want toodefine a preferred failover sequence, use [nested Traffic Manager profiles](traffic-manager-nested-profiles.md).</span></span>
* <span data-ttu-id="1ad7d-190">При использовании метода маршрутизации трафика производительности hello с внешними конечными точками или вложенные конечных точек, необходимо toospecify hello расположение этих конечных точек.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-190">When using hello Performance traffic routing method with external endpoints or nested endpoints, you need toospecify hello location of those endpoints.</span></span> <span data-ttu-id="1ad7d-191">Выберите ближайший развертывания tooyour hello регион Azure.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-191">Choose hello Azure region closest tooyour deployment.</span></span> <span data-ttu-id="1ad7d-192">Эти расположения: hello значений, поддерживаемых hello таблицы задержек Интернета.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-192">Those locations are hello values supported by hello Internet Latency Table.</span></span>
* <span data-ttu-id="1ad7d-193">Детерминирована Hello алгоритм, который выбирает hello конечной точки.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-193">hello algorithm that chooses hello endpoint is deterministic.</span></span> <span data-ttu-id="1ad7d-194">Повторяющиеся запросы DNS от hello одного клиента, направленный toohello одной конечной точкой.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-194">Repeated DNS queries from hello same client are directed toohello same endpoint.</span></span> <span data-ttu-id="1ad7d-195">Обычно клиенты используют разные рекурсивные серверы DNS, когда путешествуют.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-195">Typically, clients use different recursive DNS servers when traveling.</span></span> <span data-ttu-id="1ad7d-196">Hello клиент может быть перенаправленное tooa другой конечной точке.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-196">hello client may be routed tooa different endpoint.</span></span> <span data-ttu-id="1ad7d-197">Маршрутизация может также повлиять toohello обновления таблицы Интернет-задержки.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-197">Routing can also be affected by updates toohello Internet Latency Table.</span></span> <span data-ttu-id="1ad7d-198">Таким образом, hello производительности метод маршрутизации трафика не гарантирует, что клиент всегда будет направляться toohello одной конечной точкой.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-198">Therefore, hello Performance traffic-routing method does not guarantee that a client is always routed toohello same endpoint.</span></span>
* <span data-ttu-id="1ad7d-199">При изменении hello таблицы задержек Интернета, можно заметить, некоторые клиенты направленной tooa другой конечной точке.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-199">When hello Internet Latency Table changes, you may notice that some clients are directed tooa different endpoint.</span></span> <span data-ttu-id="1ad7d-200">Такие изменения маршрутизации основываются на свежих данных о задержках.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-200">This routing change is more accurate based on current latency data.</span></span> <span data-ttu-id="1ad7d-201">Эти обновления, важных toomaintain hello точность производительности-маршрутизации трафика в Интернете постоянно развивается приветствия.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-201">These updates are essential toomaintain hello accuracy of Performance traffic-routing as hello Internet continually evolves.</span></span>

## <span data-ttu-id="1ad7d-202"><a name = "geographic"></a>Метод географической маршрутизации трафика</span><span class="sxs-lookup"><span data-stu-id="1ad7d-202"><a name = "geographic"></a>Geographic traffic-routing method</span></span>

<span data-ttu-id="1ad7d-203">Профили диспетчера трафика можно географическая маршрут метод таким образом, чтобы пользователи направляются toospecific конечные точки (Azure, внешний или вложенные) на основе какие географическое расположение их DNS-запрос исходит от настроенного toouse приветствия.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-203">Traffic Manager profiles can be configured toouse hello Geographic routing method so that users are directed toospecific endpoints (Azure, External or Nested) based on which geographic location their DNS query originates from.</span></span> <span data-ttu-id="1ad7d-204">Это повышает эффективность диспетчера трафика клиентов tooenable сценарии, где зная географического региона пользователя и перенаправление их на основе этого важные.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-204">This empowers Traffic Manager customers tooenable scenarios where knowing a user’s geographic region and routing them based on that is important.</span></span> <span data-ttu-id="1ad7d-205">К примерам относятся соблюдение предписаний независимости данных, локализация содержимого и взаимодействия с пользователем, а также измерение трафика из разных регионов.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-205">Examples include complying with data sovereignty mandates, localization of content & user experience and measuring traffic from different regions.</span></span>
<span data-ttu-id="1ad7d-206">При настройке профиля для географической маршрутизации для каждой конечной точки, связанный с необходимость toohave набор tooit географических регионов назначен профиль.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-206">When a profile is configured for geographic routing, each endpoint associated with that profile needs toohave a set of geographic regions assigned tooit.</span></span> <span data-ttu-id="1ad7d-207">Ниже приведены возможные уровни детализации географических регионов.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-207">A geographic region can be at following levels of granularity</span></span> 
- <span data-ttu-id="1ad7d-208">Мир — любой регион.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-208">World– any region</span></span>
- <span data-ttu-id="1ad7d-209">Группа регионов — например, Африка, Ближний Восток, Австралия и Тихоокеанский регион и т. д.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-209">Regional Grouping – for example, Africa, Middle East, Australia/Pacific etc.</span></span> 
- <span data-ttu-id="1ad7d-210">Страна или регион — например, Ирландия, Перу, Гонконг (специальный административный район) и т. д.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-210">Country/Region – for example, Ireland, Peru, Hong Kong SAR etc.</span></span> 
- <span data-ttu-id="1ad7d-211">Область, штат, округ — например, Калифорния (США), Квинсленд (Австралия), Альберта (Канада) и т д. (Обратите внимание: этот уровень детализации поддерживается только для штатов, областей и округов в Австралии, Канаде, Великобритании и США.)</span><span class="sxs-lookup"><span data-stu-id="1ad7d-211">State/Province – for example, USA-California, Australia-Queensland, Canada-Alberta etc. (note: this granularity level is supported only for states / provinces in Australia, Canada, UK, and USA).</span></span>

<span data-ttu-id="1ad7d-212">Когда область или набор областей назначается tooan конечной точки, запросы на любой из этих областей возвращает перенаправленное только конечную toothat.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-212">When a region or a set of regions is assigned tooan endpoint, any requests from those regions gets routed only toothat endpoint.</span></span> <span data-ttu-id="1ad7d-213">Диспетчер трафика использует IP-адрес источника hello hello DNS запроса toodetermine hello региона, из которого пользователь запрашивает из — обычно это IP-адрес hello hello локального разрешения имен DNS выполнив hello запросов от имени пользователя hello.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-213">Traffic Manager uses hello source IP address of hello DNS query toodetermine hello region from which a user is querying from – usually this is hello IP address of hello local DNS resolver doing hello query on behalf of hello user.</span></span>  

![Диспетчер трафика Azure: метод географической маршрутизации трафика](./media/traffic-manager-routing-methods/geographic.png)

<span data-ttu-id="1ad7d-215">Диспетчер трафика считывает hello исходный IP-адрес DNS-запрос hello и решает, какие географического региона, он исходящие от.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-215">Traffic Manager reads hello source IP address of hello DNS query and decides which geographic region it is originating from.</span></span> <span data-ttu-id="1ad7d-216">Он выполняет toosee Если конечная точка, которая содержит этот tooit сопоставлен географического региона.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-216">It then looks toosee if there is an endpoint that has this geographic region mapped tooit.</span></span> <span data-ttu-id="1ad7d-217">Этот поиск начинается на низком уровне детализации (где он поддерживается, в противном случае на уровне страны или региона hello штат или провинция) hello и все далеко hello вверх toohello наивысший уровень, который является **World**.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-217">This lookup starts at hello lowest granularity level (State/Province where it is supported, else at hello Country/Region level) and goes all hello way up toohello highest level, which is **World**.</span></span> <span data-ttu-id="1ad7d-218">Используя этот обход используется в качестве tooreturn конечной точки hello в ответ на запрос hello найденные Hello первое совпадение.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-218">hello first match found using this traversal is designated as hello endpoint tooreturn in hello query response.</span></span> <span data-ttu-id="1ad7d-219">Если это конечная точка вложенного типа, то будет возвращена конечная точка в соответствующем дочернем профиле, в зависимости от его метода маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-219">When matching with a Nested type endpoint, an endpoint within that child profile is returned, based on its routing method.</span></span> <span data-ttu-id="1ad7d-220">следующие точки Hello — поведение применимо toothis:</span><span class="sxs-lookup"><span data-stu-id="1ad7d-220">hello following points are applicable toothis behavior:</span></span>

- <span data-ttu-id="1ad7d-221">Географическом регионе может быть сопоставленный только конечная точка tooone в профиле диспетчера трафика, при маршрутизации географического типа маршрутизации hello.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-221">A geographic region can be mapped only tooone endpoint in a Traffic Manager profile when hello routing type is Geographic Routing.</span></span> <span data-ttu-id="1ad7d-222">Это гарантирует детерминированную маршрутизацию пользователей и дает клиентам возможность реализовывать сценарии, требующие установления однозначных географических границ.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-222">This ensures that routing of users is deterministic, and customers can enable scenarios that require unambiguous geographic boundaries.</span></span>
- <span data-ttu-id="1ad7d-223">Если область пользователя приходит географической сопоставления в двух различных конечных точках, диспетчер трафика выбирает hello конечной точки с наименьшими гранулярности hello и не учитывает маршрутизации запросов от этой области toohello другой конечной точки.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-223">If a user’s region comes under two different endpoints’ geographic mapping, Traffic Manager selects hello endpoint with hello lowest granularity and does not consider routing requests from that region toohello other endpoint.</span></span> <span data-ttu-id="1ad7d-224">Рассмотрим пример профиля с географической маршрутизацией и двумя конечными точками: Endpoint1 и Endpoint2.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-224">For example, consider a Geographic Routing type profile with two endpoints - Endpoint1 and Endpoint2.</span></span> <span data-ttu-id="1ad7d-225">Настроить Endpoint1 tooreceive трафик от Ирландии и Endpoint2 настроен tooreceive трафик от Europe.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-225">Endpoint1 is configured tooreceive traffic from Ireland and Endpoint2 is configured tooreceive traffic from Europe.</span></span> <span data-ttu-id="1ad7d-226">Если запрос исходит из Ирландии, всегда является перенаправленное tooEndpoint1.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-226">If a request originates from Ireland, it is always routed tooEndpoint1.</span></span>
- <span data-ttu-id="1ad7d-227">Поскольку область может быть сопоставленный только tooone конечной точки, диспетчер трафика возвращает его независимо от того, конечная точка hello работоспособное или нет.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-227">Since a region can be mapped only tooone endpoint, Traffic Manager returns it regardless of whether hello endpoint is healthy or not.</span></span>

    >[!IMPORTANT]
    ><span data-ttu-id="1ad7d-228">Настоятельно рекомендуется, клиенты, использующие метод маршрутизации географической hello связать его с конечными точками hello вложенный тип имеет дочерние профили с по крайней мере две конечные точки в каждой.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-228">It is strongly recommended that customers using hello geographic routing method associate it with hello Nested type endpoints that has child profiles containing at least two endpoints within each.</span></span>
- <span data-ttu-id="1ad7d-229">Если совпадения конечной точки, и что конечная точка будет в hello **остановлена** состоянии, диспетчер трафика возвращает ответ NODATA.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-229">If an endpoint match is found and that endpoint is in hello **Stopped** state, Traffic Manager returns a NODATA response.</span></span> <span data-ttu-id="1ad7d-230">В этом случае без дальнейшего уточняющих запросов не производится, чем иерархии hello географического региона.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-230">In this case, no further lookups is made higher up in hello geographic region hierarchy.</span></span> <span data-ttu-id="1ad7d-231">Это поведение также применимо для типов вложенных конечных точек при hello дочернем профиле hello **остановлена** или **отключено** состояния.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-231">This behavior is also applicable for nested endpoint types when hello child profile is in hello **Stopped** or **Disabled** state.</span></span>
- <span data-ttu-id="1ad7d-232">Если отображается конечной точки **отключено** состояние, не будут включены в регионе hello процесс сопоставления.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-232">If an endpoint displays a **Disabled** status, it won’t be included in hello region matching process.</span></span> <span data-ttu-id="1ad7d-233">Это также применимо для типов вложенных конечных точек при hello конечная точка находится в hello **отключено** состояния.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-233">This behavior is also applicable for nested endpoint types when hello endpoint is in hello **Disabled** state.</span></span>
- <span data-ttu-id="1ad7d-234">Если поступает запрос из географического региона, сопоставления с которым в данном профиле нет, то диспетчер трафика возвращает ответ NODATA.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-234">If a query is coming from a geographic region that has no mapping in that profile, Traffic Manager returns a NODATA response.</span></span> <span data-ttu-id="1ad7d-235">Поэтому настоятельно рекомендуется использовать географической маршрутизации с одной конечной точкой, в идеале типа Nested с по крайней мере две конечные точки в дочернем профиле hello с областью hello **World** назначенный tooit.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-235">Therefore, it is strongly recommended that customers use geographic routing with one endpoint, ideally of type Nested with at least two endpoints within hello child profile, with hello region **World** assigned tooit.</span></span> <span data-ttu-id="1ad7d-236">Это также гарантирует обработки IP-адреса, не имеющие соответствия tooa области.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-236">This also ensures that any IP addresses that do not map tooa region are handled.</span></span>

<span data-ttu-id="1ad7d-237">Как описано в статье [Как работает диспетчер трафика](traffic-manager-how-traffic-manager-works.md), запросы DNS поступают к нему не напрямую от клиентов.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-237">As explained in [How Traffic Manager Works](traffic-manager-how-traffic-manager-works.md), Traffic Manager does not receive DNS queries directly from clients.</span></span> <span data-ttu-id="1ad7d-238">Вместо этого DNS-запросы поступают из, настроенных toouse hello клиентов службы DNS рекурсивные hello.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-238">Rather, DNS queries come from hello recursive DNS service that hello clients are configured toouse.</span></span> <span data-ttu-id="1ad7d-239">Таким образом hello IP адрес, используемый toodetermine hello регион не hello IP-адрес клиента, но это IP-адрес hello hello рекурсивный DNS службы.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-239">Therefore, hello IP address used toodetermine hello region is not hello client's IP address, but it is hello IP address of hello recursive DNS service.</span></span> <span data-ttu-id="1ad7d-240">На практике этот IP-адрес является хорошим прокси-сервера для клиента hello.</span><span class="sxs-lookup"><span data-stu-id="1ad7d-240">In practice, this IP address is a good proxy for hello client.</span></span>


## <a name="next-steps"></a><span data-ttu-id="1ad7d-241">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="1ad7d-241">Next steps</span></span>

<span data-ttu-id="1ad7d-242">Узнайте, как toodevelop высокого уровня доступности приложений с помощью [мониторинг конечной точки диспетчера трафика](traffic-manager-monitoring.md)</span><span class="sxs-lookup"><span data-stu-id="1ad7d-242">Learn how toodevelop high-availability applications using [Traffic Manager endpoint monitoring](traffic-manager-monitoring.md)</span></span>

<span data-ttu-id="1ad7d-243">Узнайте, каким образом слишком[создать профиль диспетчера трафика](traffic-manager-create-profile.md)</span><span class="sxs-lookup"><span data-stu-id="1ad7d-243">Learn how too[create a Traffic Manager profile](traffic-manager-create-profile.md)</span></span>

<!--Image references-->
[1]: ./media/traffic-manager-routing-methods/priority.png
[2]: ./media/traffic-manager-routing-methods/weighted.png
[3]: ./media/traffic-manager-routing-methods/performance.png



