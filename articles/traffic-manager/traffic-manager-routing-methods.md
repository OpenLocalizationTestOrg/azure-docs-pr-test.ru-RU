---
title: "Диспетчер трафика Azure: методы маршрутизации трафика | Документация Майкрософт"
description: "Эта статья поможет вам разобраться в различных методах маршрутизации трафика, используемых диспетчером трафика."
services: traffic-manager
documentationcenter: 
author: KumudD
manager: timlt
editor: 
ms.assetid: db1efbf6-6762-4c7a-ac99-675d4eeb54d0
ms.service: traffic-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 07/13/2017
ms.author: kumud
ms.openlocfilehash: fe776e24a4f78b389c6096694055b38befa3c419
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="traffic-manager-routing-methods"></a><span data-ttu-id="c68aa-103">Методы маршрутизации диспетчера трафика</span><span class="sxs-lookup"><span data-stu-id="c68aa-103">Traffic Manager routing methods</span></span>

<span data-ttu-id="c68aa-104">Диспетчер трафика Azure поддерживает четыре метода маршрутизации трафика, которые определяют правила маршрутизации сетевого трафика в разные конечные точки службы.</span><span class="sxs-lookup"><span data-stu-id="c68aa-104">Azure Traffic Manager supports four traffic-routing methods to determine how to route network traffic to the various service endpoints.</span></span> <span data-ttu-id="c68aa-105">Диспетчер трафика применяет выбранный метод маршрутизации трафика к каждому полученному запросу DNS.</span><span class="sxs-lookup"><span data-stu-id="c68aa-105">Traffic Manager applies the traffic-routing method to each DNS query it receives.</span></span> <span data-ttu-id="c68aa-106">Метод маршрутизации трафика определяет, какая конечная точка будет возвращена в ответе DNS.</span><span class="sxs-lookup"><span data-stu-id="c68aa-106">The traffic-routing method determines which endpoint returned in the DNS response.</span></span>

<span data-ttu-id="c68aa-107">В диспетчере трафика доступно четыре метода маршрутизации трафика.</span><span class="sxs-lookup"><span data-stu-id="c68aa-107">There are four traffic routing methods available in Traffic Manager:</span></span>

* <span data-ttu-id="c68aa-108">**[По приоритету](#priority):** выберите метод **По приоритету**, если требуется использовать первичную конечную точку службы для всего трафика, а также предоставлять резервные конечные точки, если первичная или резервные конечные точки станут недоступны.</span><span class="sxs-lookup"><span data-stu-id="c68aa-108">**[Priority](#priority):** Select **Priority** when you want to use a primary service endpoint for all traffic, and provide backups in case the primary or the backup endpoints are unavailable.</span></span>
* <span data-ttu-id="c68aa-109">**[Со взвешиванием](#weighted):** выберите метод **Со взвешиванием**, если требуется распределить трафик между несколькими конечными точками равномерно или согласно определяемым вами весовым коэффициентам.</span><span class="sxs-lookup"><span data-stu-id="c68aa-109">**[Weighted](#weighted):** Select **Weighted** when you want to distribute traffic across a set of endpoints, either evenly or according to weights, which you define.</span></span>
* <span data-ttu-id="c68aa-110">**[Производительность](#performance):** выберите метод **Производительность**, если конечные точки размещены в разных географических расположениях и нужно, чтобы клиенты использовали "ближайшие" конечные точки (с точки зрения минимальных задержек сети).</span><span class="sxs-lookup"><span data-stu-id="c68aa-110">**[Performance](#performance):** Select **Performance** when you have endpoints in different geographic locations and you want end users to use the "closest" endpoint in terms of the lowest network latency.</span></span>
* <span data-ttu-id="c68aa-111">**[Географический](#geographic):** выберите метод **Географический**, чтобы пользователи направлялись к определенным конечным точкам (Azure, внешним или вложенным) в зависимости от географического расположения, из которого исходит их DNS-запрос.</span><span class="sxs-lookup"><span data-stu-id="c68aa-111">**[Geographic](#geographic):** Select **Geographic** so that users are directed to specific endpoints (Azure, External, or Nested) based on which geographic location their DNS query originates from.</span></span> <span data-ttu-id="c68aa-112">Это позволяет клиентам диспетчера трафика реализовать сценарии, в которых важно знать географический регион пользователей и направлять их на основе этих данных.</span><span class="sxs-lookup"><span data-stu-id="c68aa-112">This empowers Traffic Manager customers to enable scenarios where knowing a user’s geographic region and routing them based on that is important.</span></span> <span data-ttu-id="c68aa-113">К примерам относятся соблюдение предписаний независимости данных, локализация содержимого и взаимодействия с пользователем, а также измерение трафика из разных регионов.</span><span class="sxs-lookup"><span data-stu-id="c68aa-113">Examples include complying with data sovereignty mandates, localization of content & user experience and measuring traffic from different regions.</span></span>

<span data-ttu-id="c68aa-114">Все профили диспетчера трафика включают мониторинг работоспособности и автоматическую отработку отказа для всех конечных точек.</span><span class="sxs-lookup"><span data-stu-id="c68aa-114">All Traffic Manager profiles include monitoring of endpoint health and automatic endpoint failover.</span></span> <span data-ttu-id="c68aa-115">Дополнительные сведения см. в статье [Мониторинг и отработка отказов конечной точки диспетчера трафика](traffic-manager-monitoring.md).</span><span class="sxs-lookup"><span data-stu-id="c68aa-115">For more information, see [Traffic Manager Endpoint Monitoring](traffic-manager-monitoring.md).</span></span> <span data-ttu-id="c68aa-116">Отдельный профиль диспетчера трафика может использовать только один метод маршрутизации трафика.</span><span class="sxs-lookup"><span data-stu-id="c68aa-116">A single Traffic Manager profile can use only one traffic routing method.</span></span> <span data-ttu-id="c68aa-117">В любое время для профиля можно выбрать другой метод маршрутизации трафика.</span><span class="sxs-lookup"><span data-stu-id="c68aa-117">You can select a different traffic routing method for your profile at any time.</span></span> <span data-ttu-id="c68aa-118">Изменения применяются в течение одной минуты, не приводя к простою.</span><span class="sxs-lookup"><span data-stu-id="c68aa-118">Changes are applied within one minute, and no downtime is incurred.</span></span> <span data-ttu-id="c68aa-119">Методы маршрутизации трафика можно комбинировать с помощью вложенных профилей диспетчера трафика.</span><span class="sxs-lookup"><span data-stu-id="c68aa-119">Traffic-routing methods can be combined by using nested Traffic Manager profiles.</span></span> <span data-ttu-id="c68aa-120">Вложенность позволяет создавать сложные и гибкие конфигурации для маршрутизации трафика в соответствии с потребностями крупных и сложных приложений.</span><span class="sxs-lookup"><span data-stu-id="c68aa-120">Nesting enables sophisticated and flexible traffic-routing configurations that meet the needs of larger, complex applications.</span></span> <span data-ttu-id="c68aa-121">Дополнительную информацию см. в статье [Вложенные профили диспетчера трафика](traffic-manager-nested-profiles.md).</span><span class="sxs-lookup"><span data-stu-id="c68aa-121">For more information, see [nested Traffic Manager profiles](traffic-manager-nested-profiles.md).</span></span>

## <span data-ttu-id="c68aa-122"><a name = "priority"></a>Метод маршрутизации трафика по приоритету</span><span class="sxs-lookup"><span data-stu-id="c68aa-122"><a name = "priority"></a>Priority traffic-routing method</span></span>

<span data-ttu-id="c68aa-123">Как правило, организация стремится обеспечить надежность своих служб, развертывая одну или несколько резервных служб на случай, если основная служба выйдет из строя.</span><span class="sxs-lookup"><span data-stu-id="c68aa-123">Often an organization wants to provide reliability for its services by deploying one or more backup services in case their primary service goes down.</span></span> <span data-ttu-id="c68aa-124">Метод маршрутизации трафика "По приоритету" позволяет клиентам Azure легко реализовать эту схему отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="c68aa-124">The 'Priority' traffic-routing method allows Azure customers to easily implement this failover pattern.</span></span>

![Диспетчер трафика Azure: маршрутизация трафика по приоритету][1]

<span data-ttu-id="c68aa-126">В этом профиле диспетчера трафика создается упорядоченный список конечных точек службы.</span><span class="sxs-lookup"><span data-stu-id="c68aa-126">The Traffic Manager profile contains a prioritized list of service endpoints.</span></span> <span data-ttu-id="c68aa-127">По умолчанию диспетчер трафика направляет весь трафик в первичную конечную точку (с наивысшим приоритетом).</span><span class="sxs-lookup"><span data-stu-id="c68aa-127">By default, Traffic Manager sends all traffic to the primary (highest-priority) endpoint.</span></span> <span data-ttu-id="c68aa-128">Если основная конечная точка недоступна, диспетчер трафика направляет трафик на вторую конечную точку.</span><span class="sxs-lookup"><span data-stu-id="c68aa-128">If the primary endpoint is not available, Traffic Manager routes the traffic to the second endpoint.</span></span> <span data-ttu-id="c68aa-129">Если и первичная, и вторичная конечные точки становятся недоступны, трафик направляется к третьей и т. д.</span><span class="sxs-lookup"><span data-stu-id="c68aa-129">If both the primary and secondary endpoints are not available, the traffic goes to the third, and so on.</span></span> <span data-ttu-id="c68aa-130">Доступность конечной точки определяется по указанному для нее состоянию (включена или отключена) и данным мониторинга конечных точек.</span><span class="sxs-lookup"><span data-stu-id="c68aa-130">Availability of the endpoint is based on the configured status (enabled or disabled) and the ongoing endpoint monitoring.</span></span>

### <a name="configuring-endpoints"></a><span data-ttu-id="c68aa-131">Настройка конечных точек</span><span class="sxs-lookup"><span data-stu-id="c68aa-131">Configuring endpoints</span></span>

<span data-ttu-id="c68aa-132">В Azure Resource Manager можно явно указать приоритет для каждой конечной точки, изменяя значение свойства priority.</span><span class="sxs-lookup"><span data-stu-id="c68aa-132">With Azure Resource Manager, you configure the endpoint priority explicitly using the 'priority' property for each endpoint.</span></span> <span data-ttu-id="c68aa-133">Допускаются значения в диапазоне от 1 до 1000.</span><span class="sxs-lookup"><span data-stu-id="c68aa-133">This property is a value between 1 and 1000.</span></span> <span data-ttu-id="c68aa-134">Чем меньше значение, тем выше приоритет.</span><span class="sxs-lookup"><span data-stu-id="c68aa-134">Lower values represent a higher priority.</span></span> <span data-ttu-id="c68aa-135">Нельзя использовать одинаковые значения приоритетов для нескольких конечных точек.</span><span class="sxs-lookup"><span data-stu-id="c68aa-135">Endpoints cannot share priority values.</span></span> <span data-ttu-id="c68aa-136">Это необязательное свойство.</span><span class="sxs-lookup"><span data-stu-id="c68aa-136">Setting the property is optional.</span></span> <span data-ttu-id="c68aa-137">Если оно не указано, для конечной точки задается приоритет по умолчанию в соответствии с ее расположением в профиле.</span><span class="sxs-lookup"><span data-stu-id="c68aa-137">When omitted, a default priority based on the endpoint order is used.</span></span>

##<span data-ttu-id="c68aa-138"><a name = "weighted"></a>Метод маршрутизации трафика со взвешиванием</span><span class="sxs-lookup"><span data-stu-id="c68aa-138"><a name = "weighted"></a>Weighted traffic-routing method</span></span>
<span data-ttu-id="c68aa-139">Маршрутизация трафика по методу взвешивания позволяет распределять трафик равномерно или в соответствии с предустановленными весовыми коэффициентами.</span><span class="sxs-lookup"><span data-stu-id="c68aa-139">The 'Weighted' traffic-routing method allows you to distribute traffic evenly or to use a pre-defined weighting.</span></span>

![Диспетчер трафика Azure: маршрутизации трафика по методу взвешивания][2]

<span data-ttu-id="c68aa-141">При использовании метода взвешивания при маршрутизации трафика каждой конечной точке в профиле диспетчера трафика присваивается определенный весовой коэффициент.</span><span class="sxs-lookup"><span data-stu-id="c68aa-141">In the Weighted traffic-routing method, you assign a weight to each endpoint in the Traffic Manager profile configuration.</span></span> <span data-ttu-id="c68aa-142">Это целое число в диапазоне от 1 до 1000.</span><span class="sxs-lookup"><span data-stu-id="c68aa-142">The weight is an integer from 1 to 1000.</span></span> <span data-ttu-id="c68aa-143">Это необязательный параметр.</span><span class="sxs-lookup"><span data-stu-id="c68aa-143">This parameter is optional.</span></span> <span data-ttu-id="c68aa-144">Если значение не указано, диспетчер трафика использует коэффициент 1 по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="c68aa-144">If omitted, Traffic Managers uses a default weight of '1'.</span></span>

<span data-ttu-id="c68aa-145">Для каждого полученного запроса DNS диспетчер трафика случайным образом выбирает конечную точку из числа доступных.</span><span class="sxs-lookup"><span data-stu-id="c68aa-145">For each DNS query received, Traffic Manager randomly chooses an available endpoint.</span></span> <span data-ttu-id="c68aa-146">Вероятность выбора конечной точки определяется сочетанием весовых коэффициентов всех доступных конечных точек.</span><span class="sxs-lookup"><span data-stu-id="c68aa-146">The probability of choosing an endpoint is based on the weights assigned to all available endpoints.</span></span> <span data-ttu-id="c68aa-147">Если для всех конечных точек используются одинаковые коэффициенты, трафик будет распределяться между ними равномерно.</span><span class="sxs-lookup"><span data-stu-id="c68aa-147">Using the same weight across all endpoints results in an even traffic distribution.</span></span> <span data-ttu-id="c68aa-148">Если задать больший (или меньший) вес для определенных конечных точек, они будут чаще (или реже) возвращаться в ответах DNS.</span><span class="sxs-lookup"><span data-stu-id="c68aa-148">Using higher or lower weights on specific endpoints causes those endpoints to be returned more or less frequently in the DNS responses.</span></span>

<span data-ttu-id="c68aa-149">Метод взвешивания позволяет реализовать некоторые полезные сценарии.</span><span class="sxs-lookup"><span data-stu-id="c68aa-149">The weighted method enables some useful scenarios:</span></span>

* <span data-ttu-id="c68aa-150">Постепенное обновление приложения: направляйте часть трафика в новую конечную точку и постепенно доведите объем трафика до 100 %.</span><span class="sxs-lookup"><span data-stu-id="c68aa-150">Gradual application upgrade: Allocate a percentage of traffic to route to a new endpoint, and gradually increase the traffic over time to 100%.</span></span>
* <span data-ttu-id="c68aa-151">Миграция приложений в Azure: создайте профиль, который включает конечные точки, расположенные в среде Azure и за ее пределами.</span><span class="sxs-lookup"><span data-stu-id="c68aa-151">Application migration to Azure: Create a profile with both Azure and external endpoints.</span></span> <span data-ttu-id="c68aa-152">Настройте весовые коэффициенты так, чтобы приоритет отдавался новым конечным точкам.</span><span class="sxs-lookup"><span data-stu-id="c68aa-152">Adjust the weight of the endpoints to prefer the new endpoints.</span></span>
* <span data-ttu-id="c68aa-153">Повышение в облако для получения дополнительной емкости: быстро расширьте локальное развертывание в облако, изменив профиль диспетчера трафика.</span><span class="sxs-lookup"><span data-stu-id="c68aa-153">Cloud-bursting for additional capacity: Quickly expand an on-premises deployment into the cloud by putting it behind a Traffic Manager profile.</span></span> <span data-ttu-id="c68aa-154">Если вам требуется дополнительная емкость в облаке, добавьте конечные точки и укажите, какая часть трафика направляется на ту или иную конечную точку.</span><span class="sxs-lookup"><span data-stu-id="c68aa-154">When you need extra capacity in the cloud, you can add or enable more endpoints and specify what portion of traffic goes to each endpoint.</span></span>

<span data-ttu-id="c68aa-155">Портал Azure на основе Resource Manager поддерживает конфигурацию взвешенной маршрутизации трафика.</span><span class="sxs-lookup"><span data-stu-id="c68aa-155">The Resource Manager Azure portal supports the configuration of weighted traffic routing.</span></span>  <span data-ttu-id="c68aa-156">Весовые коэффициенты можно настроить с помощью версий Azure PowerShell, интерфейса командной строки и интерфейсов REST API для Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="c68aa-156">You can configure weights using the Resource Manager versions of Azure PowerShell, CLI, and the REST APIs.</span></span>

<span data-ttu-id="c68aa-157">Важно понимать, что ответы DNS кэшируются клиентами и рекурсивными DNS-серверами, которые клиенты используют для разрешения имен DNS.</span><span class="sxs-lookup"><span data-stu-id="c68aa-157">It is important to understand that DNS responses are cached by clients and by the recursive DNS servers that the clients use to resolve DNS names.</span></span> <span data-ttu-id="c68aa-158">Это может повлиять на распределение трафика по приоритетам.</span><span class="sxs-lookup"><span data-stu-id="c68aa-158">This caching can have an impact on weighted traffic distributions.</span></span> <span data-ttu-id="c68aa-159">При большом числе клиентов и рекурсивных DNS-серверов распределение трафика работает ожидаемым образом.</span><span class="sxs-lookup"><span data-stu-id="c68aa-159">When the number of clients and recursive DNS servers is large, traffic distribution works as expected.</span></span> <span data-ttu-id="c68aa-160">Но если клиентов и (или) рекурсивных DNS-серверов мало, кэширование может ощутимо исказить распределение трафика.</span><span class="sxs-lookup"><span data-stu-id="c68aa-160">However, when the number of clients or recursive DNS servers is small, caching can significantly skew the traffic distribution.</span></span>

<span data-ttu-id="c68aa-161">Типичные примеры такой ситуации:</span><span class="sxs-lookup"><span data-stu-id="c68aa-161">Common use cases include:</span></span>

* <span data-ttu-id="c68aa-162">среды для разработки и тестирования;</span><span class="sxs-lookup"><span data-stu-id="c68aa-162">Development and testing environments</span></span>
* <span data-ttu-id="c68aa-163">обмен данных между приложениями;</span><span class="sxs-lookup"><span data-stu-id="c68aa-163">Application-to-application communications</span></span>
* <span data-ttu-id="c68aa-164">приложения, предназначенные для узкого круга пользователей, которые используют общую инфраструктуру рекурсивной DNS-службы (например, сотрудники компании, подключенные через общий прокси-сервер).</span><span class="sxs-lookup"><span data-stu-id="c68aa-164">Applications aimed at a narrow user-base that share a common recursive DNS infrastructure (for example, employees of company connecting through a proxy)</span></span>

<span data-ttu-id="c68aa-165">Такое воздействие кэширования DNS характерно для всех систем маршрутизации трафика на основе DNS, а не только для диспетчера трафика.</span><span class="sxs-lookup"><span data-stu-id="c68aa-165">These DNS caching effects are common to all DNS-based traffic routing systems, not just Azure Traffic Manager.</span></span> <span data-ttu-id="c68aa-166">В некоторых случаях может помочь явная очистка кэша DNS.</span><span class="sxs-lookup"><span data-stu-id="c68aa-166">In some cases, explicitly clearing the DNS cache may provide a workaround.</span></span> <span data-ttu-id="c68aa-167">В других случаях более подходящим может оказаться альтернативный метод маршрутизации трафика.</span><span class="sxs-lookup"><span data-stu-id="c68aa-167">In other cases, an alternative traffic-routing method may be more appropriate.</span></span>

## <span data-ttu-id="c68aa-168"><a name = "performance"></a>Метод маршрутизации трафика для повышения производительности</span><span class="sxs-lookup"><span data-stu-id="c68aa-168"><a name = "performance"></a>Performance traffic-routing method</span></span>

<span data-ttu-id="c68aa-169">Скорость реагирования многих приложений можно повысить, развернув конечные точки в двух или больше расположениях в разных регионах и направляя трафик в соответствующее ближайшее расположение.</span><span class="sxs-lookup"><span data-stu-id="c68aa-169">Deploying endpoints in two or more locations across the globe can improve the responsiveness of many applications by routing traffic to the location that is 'closest' to you.</span></span> <span data-ttu-id="c68aa-170">Эта схема реализуется при маршрутизации трафика по производительности.</span><span class="sxs-lookup"><span data-stu-id="c68aa-170">The 'Performance' traffic-routing method provides this capability.</span></span>

![Диспетчер трафика Azure: маршрутизация трафика по производительности][3]

<span data-ttu-id="c68aa-172">Под ближайшей конечной точкой не обязательно подразумевается та, которая ближе всего географически.</span><span class="sxs-lookup"><span data-stu-id="c68aa-172">The 'closest' endpoint is not necessarily closest as measured by geographic distance.</span></span> <span data-ttu-id="c68aa-173">Вместо этого при определении расстояния для маршрутизации трафика по производительности используются характеристики задержки сети.</span><span class="sxs-lookup"><span data-stu-id="c68aa-173">Instead, the 'Performance' traffic-routing method determines the closest endpoint by measuring network latency.</span></span> <span data-ttu-id="c68aa-174">Диспетчер трафика ведет собственную таблицу задержек Интернета, в которой сохраняет время кругового пути между диапазонами IP-адресов и центрами обработки данных Azure.</span><span class="sxs-lookup"><span data-stu-id="c68aa-174">Traffic Manager maintains an Internet Latency Table to track the round-trip time between IP address ranges and each Azure datacenter.</span></span>

<span data-ttu-id="c68aa-175">Для каждого входящего запроса DNS он находит в таблице задержек Интернета строки, соответствующие IP-адресу клиента.</span><span class="sxs-lookup"><span data-stu-id="c68aa-175">Traffic Manager looks up the source IP address of the incoming DNS request in the Internet Latency Table.</span></span> <span data-ttu-id="c68aa-176">Диспетчер трафика выбирает доступную конечную точку, расположенную в том центре обработки данных Azure, который демонстрирует наименьшую задержку для этого диапазона IP-адресов, и возвращает адрес этой конечной точки в ответе DNS.</span><span class="sxs-lookup"><span data-stu-id="c68aa-176">Traffic Manager chooses an available endpoint in the Azure datacenter that has the lowest latency for that IP address range, then returns that endpoint in the DNS response.</span></span>

<span data-ttu-id="c68aa-177">Как описано в статье [Как работает диспетчер трафика](traffic-manager-overview.md#how-traffic-manager-works), запросы DNS поступают к нему не напрямую от клиентов.</span><span class="sxs-lookup"><span data-stu-id="c68aa-177">As explained in [How Traffic Manager Works](traffic-manager-overview.md#how-traffic-manager-works), Traffic Manager does not receive DNS queries directly from clients.</span></span> <span data-ttu-id="c68aa-178">Обычно запросы DNS отправляет рекурсивная служба DNS, которую используют клиенты.</span><span class="sxs-lookup"><span data-stu-id="c68aa-178">Rather, DNS queries come from the recursive DNS service that the clients are configured to use.</span></span> <span data-ttu-id="c68aa-179">Поэтому для определения ближайшей конечной точки используется не IP-адрес пользователя, а IP-адрес рекурсивной службы DNS.</span><span class="sxs-lookup"><span data-stu-id="c68aa-179">Therefore, the IP address used to determine the 'closest' endpoint is not the client's IP address, but it is the IP address of the recursive DNS service.</span></span> <span data-ttu-id="c68aa-180">На практике такая замена адреса обычно дает неплохой результат.</span><span class="sxs-lookup"><span data-stu-id="c68aa-180">In practice, this IP address is a good proxy for the client.</span></span>


<span data-ttu-id="c68aa-181">Чтобы учесть изменения в глобальной сети Интернет и добавление новых регионов Azure, диспетчер трафика регулярно обновляет используемую таблицу задержек Интернета.</span><span class="sxs-lookup"><span data-stu-id="c68aa-181">Traffic Manager regularly updates the Internet Latency Table to account for changes in the global Internet and new Azure regions.</span></span> <span data-ttu-id="c68aa-182">Но производительность приложения зависит от распределения и колебаний загрузки в сети Интернет на определенный момент времени.</span><span class="sxs-lookup"><span data-stu-id="c68aa-182">However, application performance varies based on real-time variations in load across the Internet.</span></span> <span data-ttu-id="c68aa-183">При маршрутизации трафика по производительности текущая нагрузка на конкретную конечную точку службы не отслеживается.</span><span class="sxs-lookup"><span data-stu-id="c68aa-183">Performance traffic-routing does not monitor load on a given service endpoint.</span></span> <span data-ttu-id="c68aa-184">Но если конечная точка становится недоступной, диспетчер трафика перестает включать ее в ответы на запросы DNS.</span><span class="sxs-lookup"><span data-stu-id="c68aa-184">However, if an endpoint becomes unavailable, Traffic Manager does not include it in DNS query responses.</span></span>


<span data-ttu-id="c68aa-185">Примечания:</span><span class="sxs-lookup"><span data-stu-id="c68aa-185">Points to note:</span></span>

* <span data-ttu-id="c68aa-186">Если профиль содержит несколько конечных точек, которые входят в один регион Azure, диспетчер трафика распределяет трафик равномерно между всеми доступными конечными точками в этом регионе.</span><span class="sxs-lookup"><span data-stu-id="c68aa-186">If your profile contains multiple endpoints in the same Azure region, then Traffic Manager distributes traffic evenly across the available endpoints in that region.</span></span> <span data-ttu-id="c68aa-187">Если вы предпочитаете распределение трафика в пределах региона, используйте [вложенные профили диспетчера трафика](traffic-manager-nested-profiles.md).</span><span class="sxs-lookup"><span data-stu-id="c68aa-187">If you prefer a different traffic distribution within a region, you can use [nested Traffic Manager profiles](traffic-manager-nested-profiles.md).</span></span>
* <span data-ttu-id="c68aa-188">Если работоспособность всех задействованных конечных точек в ближайших регионах Azure снижена, диспетчер трафика перенаправляет трафик к конечным точкам в следующем ближайшем регионе Azure.</span><span class="sxs-lookup"><span data-stu-id="c68aa-188">If all enabled endpoints in the closest Azure region are degraded, Traffic Manager moves traffic to the endpoints in the next closest Azure region.</span></span> <span data-ttu-id="c68aa-189">Если вы хотите определить свою логику отработки сбоя, используйте [вложенные профили диспетчера трафика](traffic-manager-nested-profiles.md).</span><span class="sxs-lookup"><span data-stu-id="c68aa-189">If you want to define a preferred failover sequence, use [nested Traffic Manager profiles](traffic-manager-nested-profiles.md).</span></span>
* <span data-ttu-id="c68aa-190">Чтобы использовать маршрутизацию трафика по производительности между внешними или вложенными конечными точками, нужно вручную указать их расположение.</span><span class="sxs-lookup"><span data-stu-id="c68aa-190">When using the Performance traffic routing method with external endpoints or nested endpoints, you need to specify the location of those endpoints.</span></span> <span data-ttu-id="c68aa-191">Выберите ближайший к вашему развертыванию регион Azure.</span><span class="sxs-lookup"><span data-stu-id="c68aa-191">Choose the Azure region closest to your deployment.</span></span> <span data-ttu-id="c68aa-192">Именно эти расположения отслеживаются в таблице задержек Интернета.</span><span class="sxs-lookup"><span data-stu-id="c68aa-192">Those locations are the values supported by the Internet Latency Table.</span></span>
* <span data-ttu-id="c68aa-193">Алгоритм выбора конечной точки детерминирован.</span><span class="sxs-lookup"><span data-stu-id="c68aa-193">The algorithm that chooses the endpoint is deterministic.</span></span> <span data-ttu-id="c68aa-194">Повторные запросы DNS от одного клиента будут направляться к той же конечной точке.</span><span class="sxs-lookup"><span data-stu-id="c68aa-194">Repeated DNS queries from the same client are directed to the same endpoint.</span></span> <span data-ttu-id="c68aa-195">Обычно клиенты используют разные рекурсивные серверы DNS, когда путешествуют.</span><span class="sxs-lookup"><span data-stu-id="c68aa-195">Typically, clients use different recursive DNS servers when traveling.</span></span> <span data-ttu-id="c68aa-196">Возможно, в этом случае клиент будет перенаправлен к другой конечной точке.</span><span class="sxs-lookup"><span data-stu-id="c68aa-196">The client may be routed to a different endpoint.</span></span> <span data-ttu-id="c68aa-197">Кроме того, на маршрутизацию могут влиять изменения в таблице задержек Интернета.</span><span class="sxs-lookup"><span data-stu-id="c68aa-197">Routing can also be affected by updates to the Internet Latency Table.</span></span> <span data-ttu-id="c68aa-198">Таким образом, маршрутизация трафика по производительности не гарантирует, что клиент всегда будет обращаться к одной конечной точке.</span><span class="sxs-lookup"><span data-stu-id="c68aa-198">Therefore, the Performance traffic-routing method does not guarantee that a client is always routed to the same endpoint.</span></span>
* <span data-ttu-id="c68aa-199">При изменении таблицы задержек Интернета вы можете заметить, что некоторые клиенты переключились на другую конечную точку.</span><span class="sxs-lookup"><span data-stu-id="c68aa-199">When the Internet Latency Table changes, you may notice that some clients are directed to a different endpoint.</span></span> <span data-ttu-id="c68aa-200">Такие изменения маршрутизации основываются на свежих данных о задержках.</span><span class="sxs-lookup"><span data-stu-id="c68aa-200">This routing change is more accurate based on current latency data.</span></span> <span data-ttu-id="c68aa-201">Данные обновления необходимы, чтобы обеспечить точность маршрутизации трафика для повышения производительности, так как Интернет постоянно развивается.</span><span class="sxs-lookup"><span data-stu-id="c68aa-201">These updates are essential to maintain the accuracy of Performance traffic-routing as the Internet continually evolves.</span></span>

## <span data-ttu-id="c68aa-202"><a name = "geographic"></a>Метод географической маршрутизации трафика</span><span class="sxs-lookup"><span data-stu-id="c68aa-202"><a name = "geographic"></a>Geographic traffic-routing method</span></span>

<span data-ttu-id="c68aa-203">Можно настроить профили диспетчера трафика для применения метода географической маршрутизации трафика. В этом случае пользователи будут направляться к определенным конечным точкам (Azure, внешним или вложенным) в зависимости от географического расположения, из которого исходит их DNS-запрос.</span><span class="sxs-lookup"><span data-stu-id="c68aa-203">Traffic Manager profiles can be configured to use the Geographic routing method so that users are directed to specific endpoints (Azure, External or Nested) based on which geographic location their DNS query originates from.</span></span> <span data-ttu-id="c68aa-204">Это позволяет клиентам диспетчера трафика реализовать сценарии, в которых важно знать географический регион пользователей и направлять их на основе этих данных.</span><span class="sxs-lookup"><span data-stu-id="c68aa-204">This empowers Traffic Manager customers to enable scenarios where knowing a user’s geographic region and routing them based on that is important.</span></span> <span data-ttu-id="c68aa-205">К примерам относятся соблюдение предписаний независимости данных, локализация содержимого и взаимодействия с пользователем, а также измерение трафика из разных регионов.</span><span class="sxs-lookup"><span data-stu-id="c68aa-205">Examples include complying with data sovereignty mandates, localization of content & user experience and measuring traffic from different regions.</span></span>
<span data-ttu-id="c68aa-206">Если в профиле настроена географическая маршрутизация, то каждой конечной точке, связанной с профилем, необходимо назначить набор географических регионов.</span><span class="sxs-lookup"><span data-stu-id="c68aa-206">When a profile is configured for geographic routing, each endpoint associated with that profile needs to have a set of geographic regions assigned to it.</span></span> <span data-ttu-id="c68aa-207">Ниже приведены возможные уровни детализации географических регионов.</span><span class="sxs-lookup"><span data-stu-id="c68aa-207">A geographic region can be at following levels of granularity</span></span> 
- <span data-ttu-id="c68aa-208">Мир — любой регион.</span><span class="sxs-lookup"><span data-stu-id="c68aa-208">World– any region</span></span>
- <span data-ttu-id="c68aa-209">Группа регионов — например, Африка, Ближний Восток, Австралия и Тихоокеанский регион и т. д.</span><span class="sxs-lookup"><span data-stu-id="c68aa-209">Regional Grouping – for example, Africa, Middle East, Australia/Pacific etc.</span></span> 
- <span data-ttu-id="c68aa-210">Страна или регион — например, Ирландия, Перу, Гонконг (специальный административный район) и т. д.</span><span class="sxs-lookup"><span data-stu-id="c68aa-210">Country/Region – for example, Ireland, Peru, Hong Kong SAR etc.</span></span> 
- <span data-ttu-id="c68aa-211">Область, штат, округ — например, Калифорния (США), Квинсленд (Австралия), Альберта (Канада) и т д. (Обратите внимание: этот уровень детализации поддерживается только для штатов, областей и округов в Австралии, Канаде, Великобритании и США.)</span><span class="sxs-lookup"><span data-stu-id="c68aa-211">State/Province – for example, USA-California, Australia-Queensland, Canada-Alberta etc. (note: this granularity level is supported only for states / provinces in Australia, Canada, UK, and USA).</span></span>

<span data-ttu-id="c68aa-212">Если конечной точкой назначен регион или набор регионов, все запросы из этих регионов направляются только к этой конечной точке.</span><span class="sxs-lookup"><span data-stu-id="c68aa-212">When a region or a set of regions is assigned to an endpoint, any requests from those regions gets routed only to that endpoint.</span></span> <span data-ttu-id="c68aa-213">Диспетчер трафика использует исходный IP-адрес DNS-запроса, чтобы определить регион, из которого пользователь отправляет запрос. Обычно это IP-адрес локального сопоставителя DNS, выполняющего запрос от имени пользователя.</span><span class="sxs-lookup"><span data-stu-id="c68aa-213">Traffic Manager uses the source IP address of the DNS query to determine the region from which a user is querying from – usually this is the IP address of the local DNS resolver doing the query on behalf of the user.</span></span>  

![Диспетчер трафика Azure: метод географической маршрутизации трафика](./media/traffic-manager-routing-methods/geographic.png)

<span data-ttu-id="c68aa-215">Диспетчер трафика считывает исходный IP-адрес DNS-запроса и определяет, из какого географического региона он поступил.</span><span class="sxs-lookup"><span data-stu-id="c68aa-215">Traffic Manager reads the source IP address of the DNS query and decides which geographic region it is originating from.</span></span> <span data-ttu-id="c68aa-216">Затем он определяет, имеется ли конечная точка, с которой сопоставлен этот географический регион.</span><span class="sxs-lookup"><span data-stu-id="c68aa-216">It then looks to see if there is an endpoint that has this geographic region mapped to it.</span></span> <span data-ttu-id="c68aa-217">Этот поиск начинается с самого низкого уровня детализации (с уровня области, штата или округа, если он поддерживается; в противном случае — с уровня страны или региона) и выполняется вплоть до самого высокого уровня — **мира**.</span><span class="sxs-lookup"><span data-stu-id="c68aa-217">This lookup starts at the lowest granularity level (State/Province where it is supported, else at the Country/Region level) and goes all the way up to the highest level, which is **World**.</span></span> <span data-ttu-id="c68aa-218">Первая найденная соответствующая конечная точка при этом обходе будет возвращена в ответе на запрос.</span><span class="sxs-lookup"><span data-stu-id="c68aa-218">The first match found using this traversal is designated as the endpoint to return in the query response.</span></span> <span data-ttu-id="c68aa-219">Если это конечная точка вложенного типа, то будет возвращена конечная точка в соответствующем дочернем профиле, в зависимости от его метода маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="c68aa-219">When matching with a Nested type endpoint, an endpoint within that child profile is returned, based on its routing method.</span></span> <span data-ttu-id="c68aa-220">В такой ситуации возможно следующее.</span><span class="sxs-lookup"><span data-stu-id="c68aa-220">The following points are applicable to this behavior:</span></span>

- <span data-ttu-id="c68aa-221">Если используется географическая маршрутизация, то географический регион может быть сопоставлен только с одной конечной точкой в профиле диспетчера трафика.</span><span class="sxs-lookup"><span data-stu-id="c68aa-221">A geographic region can be mapped only to one endpoint in a Traffic Manager profile when the routing type is Geographic Routing.</span></span> <span data-ttu-id="c68aa-222">Это гарантирует детерминированную маршрутизацию пользователей и дает клиентам возможность реализовывать сценарии, требующие установления однозначных географических границ.</span><span class="sxs-lookup"><span data-stu-id="c68aa-222">This ensures that routing of users is deterministic, and customers can enable scenarios that require unambiguous geographic boundaries.</span></span>
- <span data-ttu-id="c68aa-223">Если регион пользователя географически сопоставлен с двумя разными конечными точками, то диспетчер трафика выбирает конечную точку на нижнем уровне детализации и не учитывает запросы на маршрутизацию, исходящие из другой конечной точки этого региона.</span><span class="sxs-lookup"><span data-stu-id="c68aa-223">If a user’s region comes under two different endpoints’ geographic mapping, Traffic Manager selects the endpoint with the lowest granularity and does not consider routing requests from that region to the other endpoint.</span></span> <span data-ttu-id="c68aa-224">Рассмотрим пример профиля с географической маршрутизацией и двумя конечными точками: Endpoint1 и Endpoint2.</span><span class="sxs-lookup"><span data-stu-id="c68aa-224">For example, consider a Geographic Routing type profile with two endpoints - Endpoint1 and Endpoint2.</span></span> <span data-ttu-id="c68aa-225">Endpoint1 настроена для приема трафика из Ирландии, а Endpoint2 — для приема трафика из Европы.</span><span class="sxs-lookup"><span data-stu-id="c68aa-225">Endpoint1 is configured to receive traffic from Ireland and Endpoint2 is configured to receive traffic from Europe.</span></span> <span data-ttu-id="c68aa-226">Если запрос исходит из Ирландии, он всегда будет направляться к Endpoint1.</span><span class="sxs-lookup"><span data-stu-id="c68aa-226">If a request originates from Ireland, it is always routed to Endpoint1.</span></span>
- <span data-ttu-id="c68aa-227">Так как регион может быть сопоставлен только с одной конечной точкой, диспетчер трафика возвращает ее независимо от того, является ли эта конечная точка работоспособной или нет.</span><span class="sxs-lookup"><span data-stu-id="c68aa-227">Since a region can be mapped only to one endpoint, Traffic Manager returns it regardless of whether the endpoint is healthy or not.</span></span>

    >[!IMPORTANT]
    ><span data-ttu-id="c68aa-228">Клиентам настоятельно рекомендуется использовать метод географической маршрутизации с конечными точками вложенного типа, у которых имеются дочерние профили, содержащие по крайней мере по две конечные точки.</span><span class="sxs-lookup"><span data-stu-id="c68aa-228">It is strongly recommended that customers using the geographic routing method associate it with the Nested type endpoints that has child profiles containing at least two endpoints within each.</span></span>
- <span data-ttu-id="c68aa-229">Если найдена соответствующая конечная точка, которая **остановлена**, то диспетчер трафика вернет ответ NODATA.</span><span class="sxs-lookup"><span data-stu-id="c68aa-229">If an endpoint match is found and that endpoint is in the **Stopped** state, Traffic Manager returns a NODATA response.</span></span> <span data-ttu-id="c68aa-230">В этом случае поиск не продолжается вверх по иерархии географических регионов.</span><span class="sxs-lookup"><span data-stu-id="c68aa-230">In this case, no further lookups is made higher up in the geographic region hierarchy.</span></span> <span data-ttu-id="c68aa-231">Это также относится к конечным точкам вложенного типа, когда дочерний профиль **остановлен** или **отключен**.</span><span class="sxs-lookup"><span data-stu-id="c68aa-231">This behavior is also applicable for nested endpoint types when the child profile is in the **Stopped** or **Disabled** state.</span></span>
- <span data-ttu-id="c68aa-232">Если конечная точка **отключена**, она не участвует в процессе сопоставления с регионом.</span><span class="sxs-lookup"><span data-stu-id="c68aa-232">If an endpoint displays a **Disabled** status, it won’t be included in the region matching process.</span></span> <span data-ttu-id="c68aa-233">Это также относится к конечным точкам вложенного типа, когда конечная точка **отключена**.</span><span class="sxs-lookup"><span data-stu-id="c68aa-233">This behavior is also applicable for nested endpoint types when the endpoint is in the **Disabled** state.</span></span>
- <span data-ttu-id="c68aa-234">Если поступает запрос из географического региона, сопоставления с которым в данном профиле нет, то диспетчер трафика возвращает ответ NODATA.</span><span class="sxs-lookup"><span data-stu-id="c68aa-234">If a query is coming from a geographic region that has no mapping in that profile, Traffic Manager returns a NODATA response.</span></span> <span data-ttu-id="c68aa-235">Поэтому клиентам настоятельно рекомендуется использовать географическую маршрутизацию с одной конечной точкой (лучше всего вложенного типа), в дочернем профиле которой имеются по крайней мере две конечные точки, которым назначен регион **Мир**.</span><span class="sxs-lookup"><span data-stu-id="c68aa-235">Therefore, it is strongly recommended that customers use geographic routing with one endpoint, ideally of type Nested with at least two endpoints within the child profile, with the region **World** assigned to it.</span></span> <span data-ttu-id="c68aa-236">Это также гарантирует обработку всех IP-адресов, которые не соответствуют какому-либо региону.</span><span class="sxs-lookup"><span data-stu-id="c68aa-236">This also ensures that any IP addresses that do not map to a region are handled.</span></span>

<span data-ttu-id="c68aa-237">Как описано в статье [Как работает диспетчер трафика](traffic-manager-how-traffic-manager-works.md), запросы DNS поступают к нему не напрямую от клиентов.</span><span class="sxs-lookup"><span data-stu-id="c68aa-237">As explained in [How Traffic Manager Works](traffic-manager-how-traffic-manager-works.md), Traffic Manager does not receive DNS queries directly from clients.</span></span> <span data-ttu-id="c68aa-238">Обычно запросы DNS отправляет рекурсивная служба DNS, которую используют клиенты.</span><span class="sxs-lookup"><span data-stu-id="c68aa-238">Rather, DNS queries come from the recursive DNS service that the clients are configured to use.</span></span> <span data-ttu-id="c68aa-239">Поэтому для определения региона используется не IP-адрес клиента, а IP-адрес рекурсивной службы DNS.</span><span class="sxs-lookup"><span data-stu-id="c68aa-239">Therefore, the IP address used to determine the region is not the client's IP address, but it is the IP address of the recursive DNS service.</span></span> <span data-ttu-id="c68aa-240">На практике такая замена адреса обычно дает неплохой результат.</span><span class="sxs-lookup"><span data-stu-id="c68aa-240">In practice, this IP address is a good proxy for the client.</span></span>


## <a name="next-steps"></a><span data-ttu-id="c68aa-241">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="c68aa-241">Next steps</span></span>

<span data-ttu-id="c68aa-242">Узнайте, как разрабатывать высокодоступные приложения с помощью [мониторинга конечных точек диспетчером трафика](traffic-manager-monitoring.md)</span><span class="sxs-lookup"><span data-stu-id="c68aa-242">Learn how to develop high-availability applications using [Traffic Manager endpoint monitoring](traffic-manager-monitoring.md)</span></span>

<span data-ttu-id="c68aa-243">Узнайте, как [создать профиль диспетчера трафика](traffic-manager-create-profile.md)</span><span class="sxs-lookup"><span data-stu-id="c68aa-243">Learn how to [create a Traffic Manager profile](traffic-manager-create-profile.md)</span></span>

<!--Image references-->
[1]: ./media/traffic-manager-routing-methods/priority.png
[2]: ./media/traffic-manager-routing-methods/weighted.png
[3]: ./media/traffic-manager-routing-methods/performance.png



