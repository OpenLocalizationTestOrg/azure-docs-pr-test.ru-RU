---
title: "методы маршрутизации трафика aaaAzure диспетчеру трафика - | Документы Microsoft"
description: "Это поможет вам понять методы маршрутизации трафика различных hello, используемого диспетчером трафика статьи, посвященные"
services: traffic-manager
documentationcenter: 
author: KumudD
manager: timlt
editor: 
ms.assetid: db1efbf6-6762-4c7a-ac99-675d4eeb54d0
ms.service: traffic-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 07/13/2017
ms.author: kumud
ms.openlocfilehash: b3eeca63ab5f2b9cd4a3a6b6a8fd3e40059e32b5
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="traffic-manager-routing-methods"></a>Методы маршрутизации диспетчера трафика

Azure диспетчера трафика поддерживает четыре маршрутизации трафика методы toodetermine как tooroute сетевой трафик toohello различные конечные точки службы. Диспетчер трафика применяется hello маршрутизации трафика метод tooeach запроса DNS, он получает. Метод маршрутизации трафика Hello определяет, какая конечная точка возвращенный в ответе DNS hello.

В диспетчере трафика доступно четыре метода маршрутизации трафика.

* **[Приоритет](#priority):** выберите **приоритет** при необходимости toouse конечную точку основной службы для всех типов трафика и обеспечивать резервные копии на случай hello первичного или hello резервных конечных точек недоступны.
* **[Взвешенное](#weighted):** выберите **Взвешенное** при необходимости toodistribute трафика между несколькими конечными точками, либо равномерно или соответствующим tooweights, который определен.
* **[Производительность](#performance):** выберите **производительности** при конечные точки в разных географических регионах и требуется, чтобы конечные пользователи toouse hello «близко расположенные» endpoint с точки зрения hello наименьшим значением задержки сети.
* **[Географические](#geographic):** выберите **географической** таким образом, пользователи направленной toospecific конечным точкам (Azure, внешний или вложенные) на основе какие географическое расположение их DNS-запрос исходит от. Это повышает эффективность диспетчера трафика клиентов tooenable сценарии, где зная географического региона пользователя и перенаправление их на основе этого важные. К примерам относятся соблюдение предписаний независимости данных, локализация содержимого и взаимодействия с пользователем, а также измерение трафика из разных регионов.

Все профили диспетчера трафика включают мониторинг работоспособности и автоматическую отработку отказа для всех конечных точек. Дополнительные сведения см. в статье [Мониторинг и отработка отказов конечной точки диспетчера трафика](traffic-manager-monitoring.md). Отдельный профиль диспетчера трафика может использовать только один метод маршрутизации трафика. В любое время для профиля можно выбрать другой метод маршрутизации трафика. Изменения применяются в течение одной минуты, не приводя к простою. Методы маршрутизации трафика можно комбинировать с помощью вложенных профилей диспетчера трафика. Вложенность включает сложных и гибкие конфигурации маршрутизации трафика, соответствующие потребностям hello крупных и сложных приложений. Дополнительную информацию см. в статье [Вложенные профили диспетчера трафика](traffic-manager-nested-profiles.md).

## <a name = "priority"></a>Метод маршрутизации трафика по приоритету

Часто организация хочет tooprovide надежность для своих служб, развернув одну или несколько резервных копий служб, в случае, если их основная служба перестает работать. Метод маршрутизации трафика «Приоритет» Hello позволяет Azure tooeasily клиентам реализовывать этот шаблон отработки отказа.

![Диспетчер трафика Azure: маршрутизация трафика по приоритету][1]

Hello профиля диспетчера трафика содержит упорядоченный список конечных точек службы. По умолчанию диспетчер трафика отправляет все трафика toohello основной (высший приоритет) конечной точки. Если недоступен основной конечной точки hello, диспетчер трафика маршруты hello вторая конечная точка toohello трафика. Если обе конечные точки hello первичного и вторичного недоступны, трафик hello направляется toohello в-третьих, и т. д. Доступность hello конечной точки зависит от настройки hello состоянии (включен или выключен) и hello мониторинга конечных точек.

### <a name="configuring-endpoints"></a>Настройка конечных точек

С помощью диспетчера ресурсов Azure настройте приоритет конечной точки hello явным образом при помощи свойства «priority» hello для каждой конечной точки. Допускаются значения в диапазоне от 1 до 1000. Чем меньше значение, тем выше приоритет. Нельзя использовать одинаковые значения приоритетов для нескольких конечных точек. Задание свойства hello является необязательным. Если этот параметр опущен, используется приоритет по умолчанию на основе порядка hello конечной точки.

##<a name = "weighted"></a>Метод маршрутизации трафика со взвешиванием
Метод маршрутизации трафика «Взвешенное» Hello позволяет toodistribute трафик равномерно или toouse предварительно определенных весовой коэффициент.

![Диспетчер трафика Azure: маршрутизации трафика по методу взвешивания][2]

В hello взвешенного маршрутизации трафика метода назначьте вес tooeach конечной точки в конфигурации профиля диспетчера трафика hello. Вес Hello является целым числом от 1 too1000. Это необязательный параметр. Если значение не указано, диспетчер трафика использует коэффициент 1 по умолчанию.

Для каждого полученного запроса DNS диспетчер трафика случайным образом выбирает конечную точку из числа доступных. Hello вероятность того, выбрав конечную точку основан на hello весовые tooall доступных конечных точек. С помощью hello же вес через все результаты конечные точки в даже трафика распространения. С помощью весов выше или ниже на специальные конечные точки вызывает toobe эти конечные точки, более или менее часто возвращаются в ответах DNS hello.

метод Hello Взвешенное обеспечивает некоторые полезные сценарии:

* Постепенное обновление приложения: выделить процент tooroute трафика tooa новую конечную точку и постепенно увеличивается трафик hello too100% времени.
* TooAzure миграции приложения: создайте профиль с Azure и внешними конечными точками. Измените вес hello hello конечные точки tooprefer hello новых конечных точек.
* В облако для получения дополнительной емкости: быстро Расширьте локальное развертывание в облаке hello, изменив профиль диспетчера трафика. Если вам требуется дополнительная емкость в облаке hello, можно добавить или несколько конечных и указать, какая часть трафика направляется tooeach конечной точки.

Hello портала диспетчера ресурсов Azure поддерживает настройку hello маршрутизации взвешенного трафика.  Вы можете настроить веса hello версии диспетчера ресурсов Azure PowerShell, CLI и hello API-интерфейсов REST.

Это важные toounderstand что ответов DNS кэшироваться клиентами и hello рекурсивный DNS-серверами, hello клиентам использовать tooresolve DNS-имена. Это может повлиять на распределение трафика по приоритетам. Если существует большое число hello клиентов и рекурсивный DNS-серверы, распределение трафика работает надлежащим образом. Однако при небольшом число hello рекурсивный DNS-серверы и клиенты кэширование может значительно исказить распределение трафика hello.

Типичные примеры такой ситуации:

* среды для разработки и тестирования;
* обмен данных между приложениями;
* приложения, предназначенные для узкого круга пользователей, которые используют общую инфраструктуру рекурсивной DNS-службы (например, сотрудники компании, подключенные через общий прокси-сервер).

Эти эффекты кэширования DNS являются общие tooall трафика DNS маршрутизации системы, не только диспетчера трафика Azure. В некоторых случаях явно очистить кэш DNS hello может предоставлять временное решение. В других случаях более подходящим может оказаться альтернативный метод маршрутизации трафика.

## <a name = "performance"></a>Метод маршрутизации трафика для повышения производительности

Развертывание конечных точек в двух или нескольких расположениях по всему миру hello может повысить скорость реагирования hello многие приложения путем маршрутизации трафика toohello расположения входящего в tooyou «ближайший». Метод маршрутизации трафика «Производительность» Hello предоставляет эту возможность.

![Диспетчер трафика Azure: маршрутизация трафика по производительности][3]

Конечная точка «ближайший» Hello не обязательно ближайшая по географическому расстоянию. Вместо этого метод маршрутизации трафика «Производительность» hello определяет hello ближайшей конечной точкой, путем измерения задержки в сети. Диспетчер трафика ведет таблицы задержек Интернета tootrack hello приема-передачи времени между диапазоны IP-адресов и каждый центр обработки данных Azure.

Диспетчер трафика определяет hello исходный IP-адрес входящего запроса DNS hello в hello таблицы задержек Интернета. Диспетчер трафика выбирает доступную конечную точку в центре обработки данных Azure, имеет наименьшую задержку hello для этого диапазона IP-адресов, а затем возвращает эту конечную точку в ответ DNS hello hello.

Как описано в статье [Как работает диспетчер трафика](traffic-manager-overview.md#how-traffic-manager-works), запросы DNS поступают к нему не напрямую от клиентов. Вместо этого DNS-запросы поступают из, настроенных toouse hello клиентов службы DNS рекурсивные hello. Таким образом hello IP адрес, используемый toodetermine hello «ближайший» конечная точка не является IP-адрес клиента hello, но это IP-адрес hello hello рекурсивный DNS службы. На практике этот IP-адрес является хорошим прокси-сервера для клиента hello.


Трафик Manager регулярно обновлений hello tooaccount таблицы задержек Интернета для изменения в hello глобальной сети Интернет и новый регионов Azure. Тем не менее производительность приложений различается в зависимости от вариантов нагрузки в режиме реального времени через Интернет hello. При маршрутизации трафика по производительности текущая нагрузка на конкретную конечную точку службы не отслеживается. Но если конечная точка становится недоступной, диспетчер трафика перестает включать ее в ответы на запросы DNS.


Toonote точек:

* Если профиль содержит несколько конечных точек в hello же регионе Azure, то диспетчер трафика распределяет трафик равномерно по доступным точкам hello в этом регионе. Если вы предпочитаете распределение трафика в пределах региона, используйте [вложенные профили диспетчера трафика](traffic-manager-nested-profiles.md).
* Включение всех конечных точек в hello ближайший регион Azure, ограниченной, диспетчера трафика перемещает конечные точки toohello трафик в регион Azure Далее ближайший hello. Toodefine последовательность предпочтительный отработки отказа, используйте [вложенных профилей диспетчера трафика](traffic-manager-nested-profiles.md).
* При использовании метода маршрутизации трафика производительности hello с внешними конечными точками или вложенные конечных точек, необходимо toospecify hello расположение этих конечных точек. Выберите ближайший развертывания tooyour hello регион Azure. Эти расположения: hello значений, поддерживаемых hello таблицы задержек Интернета.
* Детерминирована Hello алгоритм, который выбирает hello конечной точки. Повторяющиеся запросы DNS от hello одного клиента, направленный toohello одной конечной точкой. Обычно клиенты используют разные рекурсивные серверы DNS, когда путешествуют. Hello клиент может быть перенаправленное tooa другой конечной точке. Маршрутизация может также повлиять toohello обновления таблицы Интернет-задержки. Таким образом, hello производительности метод маршрутизации трафика не гарантирует, что клиент всегда будет направляться toohello одной конечной точкой.
* При изменении hello таблицы задержек Интернета, можно заметить, некоторые клиенты направленной tooa другой конечной точке. Такие изменения маршрутизации основываются на свежих данных о задержках. Эти обновления, важных toomaintain hello точность производительности-маршрутизации трафика в Интернете постоянно развивается приветствия.

## <a name = "geographic"></a>Метод географической маршрутизации трафика

Профили диспетчера трафика можно географическая маршрут метод таким образом, чтобы пользователи направляются toospecific конечные точки (Azure, внешний или вложенные) на основе какие географическое расположение их DNS-запрос исходит от настроенного toouse приветствия. Это повышает эффективность диспетчера трафика клиентов tooenable сценарии, где зная географического региона пользователя и перенаправление их на основе этого важные. К примерам относятся соблюдение предписаний независимости данных, локализация содержимого и взаимодействия с пользователем, а также измерение трафика из разных регионов.
При настройке профиля для географической маршрутизации для каждой конечной точки, связанный с необходимость toohave набор tooit географических регионов назначен профиль. Ниже приведены возможные уровни детализации географических регионов. 
- Мир — любой регион.
- Группа регионов — например, Африка, Ближний Восток, Австралия и Тихоокеанский регион и т. д. 
- Страна или регион — например, Ирландия, Перу, Гонконг (специальный административный район) и т. д. 
- Область, штат, округ — например, Калифорния (США), Квинсленд (Австралия), Альберта (Канада) и т д. (Обратите внимание: этот уровень детализации поддерживается только для штатов, областей и округов в Австралии, Канаде, Великобритании и США.)

Когда область или набор областей назначается tooan конечной точки, запросы на любой из этих областей возвращает перенаправленное только конечную toothat. Диспетчер трафика использует IP-адрес источника hello hello DNS запроса toodetermine hello региона, из которого пользователь запрашивает из — обычно это IP-адрес hello hello локального разрешения имен DNS выполнив hello запросов от имени пользователя hello.  

![Диспетчер трафика Azure: метод географической маршрутизации трафика](./media/traffic-manager-routing-methods/geographic.png)

Диспетчер трафика считывает hello исходный IP-адрес DNS-запрос hello и решает, какие географического региона, он исходящие от. Он выполняет toosee Если конечная точка, которая содержит этот tooit сопоставлен географического региона. Этот поиск начинается на низком уровне детализации (где он поддерживается, в противном случае на уровне страны или региона hello штат или провинция) hello и все далеко hello вверх toohello наивысший уровень, который является **World**. Используя этот обход используется в качестве tooreturn конечной точки hello в ответ на запрос hello найденные Hello первое совпадение. Если это конечная точка вложенного типа, то будет возвращена конечная точка в соответствующем дочернем профиле, в зависимости от его метода маршрутизации. следующие точки Hello — поведение применимо toothis:

- Географическом регионе может быть сопоставленный только конечная точка tooone в профиле диспетчера трафика, при маршрутизации географического типа маршрутизации hello. Это гарантирует детерминированную маршрутизацию пользователей и дает клиентам возможность реализовывать сценарии, требующие установления однозначных географических границ.
- Если область пользователя приходит географической сопоставления в двух различных конечных точках, диспетчер трафика выбирает hello конечной точки с наименьшими гранулярности hello и не учитывает маршрутизации запросов от этой области toohello другой конечной точки. Рассмотрим пример профиля с географической маршрутизацией и двумя конечными точками: Endpoint1 и Endpoint2. Настроить Endpoint1 tooreceive трафик от Ирландии и Endpoint2 настроен tooreceive трафик от Europe. Если запрос исходит из Ирландии, всегда является перенаправленное tooEndpoint1.
- Поскольку область может быть сопоставленный только tooone конечной точки, диспетчер трафика возвращает его независимо от того, конечная точка hello работоспособное или нет.

    >[!IMPORTANT]
    >Настоятельно рекомендуется, клиенты, использующие метод маршрутизации географической hello связать его с конечными точками hello вложенный тип имеет дочерние профили с по крайней мере две конечные точки в каждой.
- Если совпадения конечной точки, и что конечная точка будет в hello **остановлена** состоянии, диспетчер трафика возвращает ответ NODATA. В этом случае без дальнейшего уточняющих запросов не производится, чем иерархии hello географического региона. Это поведение также применимо для типов вложенных конечных точек при hello дочернем профиле hello **остановлена** или **отключено** состояния.
- Если отображается конечной точки **отключено** состояние, не будут включены в регионе hello процесс сопоставления. Это также применимо для типов вложенных конечных точек при hello конечная точка находится в hello **отключено** состояния.
- Если поступает запрос из географического региона, сопоставления с которым в данном профиле нет, то диспетчер трафика возвращает ответ NODATA. Поэтому настоятельно рекомендуется использовать географической маршрутизации с одной конечной точкой, в идеале типа Nested с по крайней мере две конечные точки в дочернем профиле hello с областью hello **World** назначенный tooit. Это также гарантирует обработки IP-адреса, не имеющие соответствия tooa области.

Как описано в статье [Как работает диспетчер трафика](traffic-manager-how-traffic-manager-works.md), запросы DNS поступают к нему не напрямую от клиентов. Вместо этого DNS-запросы поступают из, настроенных toouse hello клиентов службы DNS рекурсивные hello. Таким образом hello IP адрес, используемый toodetermine hello регион не hello IP-адрес клиента, но это IP-адрес hello hello рекурсивный DNS службы. На практике этот IP-адрес является хорошим прокси-сервера для клиента hello.


## <a name="next-steps"></a>Дальнейшие действия

Узнайте, как toodevelop высокого уровня доступности приложений с помощью [мониторинг конечной точки диспетчера трафика](traffic-manager-monitoring.md)

Узнайте, каким образом слишком[создать профиль диспетчера трафика](traffic-manager-create-profile.md)

<!--Image references-->
[1]: ./media/traffic-manager-routing-methods/priority.png
[2]: ./media/traffic-manager-routing-methods/weighted.png
[3]: ./media/traffic-manager-routing-methods/performance.png



