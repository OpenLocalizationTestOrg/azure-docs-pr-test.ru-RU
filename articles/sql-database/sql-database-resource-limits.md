---
title: "Ограничения ресурсов базы данных SQL Azure | Документация Майкрософт"
description: "На этой странице описываются некоторые общие ограничения ресурсов для Базы данных SQL Azure."
services: sql-database
documentationcenter: na
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: 884e519f-23bb-4b73-a718-00658629646a
ms.service: sql-database
ms.custom: DBs & servers
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: Active
ms.date: 01/12/2018
ms.author: carlrab
ms.openlocfilehash: 13641b190c3c157f5b302314f88a42a160a1f2e0
ms.sourcegitcommit: e19f6a1709b0fe0f898386118fbef858d430e19d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/13/2018
---
# <a name="azure-sql-database-resource-limits"></a>Ограничения ресурсов базы данных SQL Azure

## <a name="single-database-storage-sizes-and-performance-levels"></a>Отдельная база данных: размеры хранилища и уровни производительности

В следующих таблицах приведены доступные ресурсы для отдельных баз данных на каждом уровне служб и уровне производительности. Уровень служб, уровень производительности и объем хранилища для отдельной базы данных можно задать с помощью [портала Azure](sql-database-single-database-resources.md#manage-single-database-resources-using-the-azure-portal), [Transact-SQL](sql-database-single-database-resources.md#manage-single-database-resources-using-transact-sql), [PowerShell](sql-database-single-database-resources.md#manage-single-database-resources-using-powershell), [Azure CLI](sql-database-single-database-resources.md#manage-single-database-resources-using-the-azure-cli) или [REST API](sql-database-single-database-resources.md#manage-single-database-resources-using-the-rest-api).

[!INCLUDE [SQL DB service tiers table](../../includes/sql-database-service-tiers-table.md)]

## <a name="single-database-change-storage-size"></a>Отдельная база данных: изменение размера хранилища

- Цена DTU для отдельной базы данных включает в себя определенный объем хранилища, не требующий дополнительной платы. Дополнительный объем хранилища, сверх включенного, можно подготовить за дополнительную плату в пределах максимального допустимого размера с шагом в 250 ГБ при объеме хранилища до 1 ТБ и с шагом в 256 ГБ — при объеме более 1 ТБ. Сведения о включенном объеме хранилища и ограничениях максимального размера см. в разделе [Отдельная база данных: размеры хранилища и уровни производительности](#single-database-storage-sizes-and-performance-levels).
- Дополнительное хранилище для отдельной базы данных можно подготовить, увеличив ее максимальный размер с помощью [портала Azure](sql-database-single-database-resources.md#manage-single-database-resources-using-the-azure-portal), [Transact-SQL](/sql/t-sql/statements/alter-database-azure-sql-database#examples), [PowerShell](/powershell/module/azurerm.sql/set-azurermsqldatabase), [Azure CLI](/cli/azure/sql/db#az_sql_db_update) или [REST API](/rest/api/sql/databases/update).
- Стоимость дополнительного хранилища для отдельной базы данных равна его объему, умноженному на цену единицы хранения этого хранилища для уровня служб. Сведения о цене на дополнительное хранилище см. на [странице цен на Базу данных SQL](https://azure.microsoft.com/pricing/details/sql-database/).

## <a name="single-database-change-dtus"></a>Отдельная база данных: изменение числа DTU

После выбора первоначального уровня служб, уровня производительности и объема хранилища можно масштабировать отдельную базу данных динамически, исходя из ее фактического использования, с помощью [портала Azure](sql-database-single-database-resources.md#manage-single-database-resources-using-the-azure-portal), [Transact-SQL](/sql/t-sql/statements/alter-database-azure-sql-database#examples), [PowerShell](/powershell/module/azurerm.sql/set-azurermsqldatabase), [Azure CLI](/cli/azure/sql/db#az_sql_db_update) или [REST API](/rest/api/sql/databases/update). 

В следующем видео показано динамическое изменение уровня производительности для увеличения количества доступных DTU для отдельной базы данных.

> [!VIDEO https://channel9.msdn.com/Blogs/Azure/Azure-SQL-Database-dynamically-scale-up-or-scale-down/player]
>

При изменении уровня службы или уровня производительности базы данных создается реплика исходной базы данных с новым уровнем производительности, после чего устанавливаются подключения к реплике. Во время этого процесса данные не теряются, но в течение короткого периода, когда производится переподключение к реплике, соединения с базой данных становятся неактивны, поэтому некоторые текущие транзакции могут откатиться. Интервал времени для переключения не фиксирован, но в 99 % случаев он находится в пределах 4 секунд до показателя в 30 секунд. Если в момент разрыва подключений выполняется большое число транзакций, период переключения может быть продолжительнее. 

Длительность всего процесса вертикального масштабирования зависит от размера и уровня службы базы данных до и после изменения. Например, если база данных размером 250 ГБ переводится с уровня службы "Стандартный", на этот уровень или в его пределах, процесс должен завершиться в течение шести часов. Если уровень производительности базы данных того же размера меняется в пределах уровня службы "Премиум", то увеличение масштаба должно завершиться в течение трех часов.

> [!TIP]
> Чтобы отслеживать выполняемые операции см. статью [Operations — List](/rest/api/sql/Operations/List) (Список операций), [az sql db op](/cli/azure/sql/db/op), [sys.dm_operation_status (Azure SQL Database)](/sql/relational-databases/system-dynamic-management-views/sys-dm-operation-status-azure-sql-database) (sys.dm_operation_status (база данных SQL Azure)) и эти две команды PowerShell: [Get-AzureRmSqlDatabaseActivity](/powershell/module/azurerm.sql/get-azurermsqldatabaseactivity) и [Stop-AzureRmSqlDatabaseActivity](/powershell/module/azurerm.sql/stop-azurermsqldatabaseactivity).

* При переходе к более высокому уровню служб или производительности максимальный размер базы данных не увеличивается, если явно не указать для него большее значение (maxsize).
* При понижении уровня базы данных используемое ею пространство не должно превышать максимальный допустимый размер целевых уровня служб и уровня производительности. 
* При понижении уровня **Премиум** или **Premium RS** до **Стандартный** дополнительная плата взимается, если максимальный размер базы данных поддерживается в целевом уровне производительности и превышает объем включенного хранилища целевого уровня производительности. Например, если уровень базы данных P1 с максимальным размером в 500 ГБ понижается до уровня S3, то взимается плата за дополнительное хранилище, так как S3 поддерживает максимальный размер в 500 ГБ, а его включенный объем хранилища составляет только 250 ГБ. Поэтому дополнительный объем хранилища равен 500 – 250 = 250 ГБ. Чтобы узнать о ценах на дополнительное хранилище, ознакомьтесь с [ценами на Базу данных SQL](https://azure.microsoft.com/pricing/details/sql-database/). Если фактический объем пространства, которое используется, меньше, чем включенный объем хранилища, то этих дополнительных затрат можно избежать, уменьшив максимальный размер базы данных до включенного объема. 
* Если вы обновляете базу данных с включенной [георепликацией](sql-database-geo-replication-portal.md), перед обновлением базы данных-источника обновите базы данных-получатели до требуемого уровня производительности (общая рекомендация). Чтобы выполнить обновление до другого выпуска, сначала необходимо обновить базу данных-получатель.
* Если вы понижаете уровень базы данных с включенной [георепликацией](sql-database-geo-replication-portal.md), перед понижением уровня базы данных-получателя сначала понизьте уровень ее базы данных-источника до требуемого уровня производительности (общая рекомендация). Чтобы понизить уровень до другого выпуска, сначала необходимо понизить уровень базы данных-получателя.
* Предложения службы восстановления отличаются для разных уровней служб. При понижении до уровня **Базовый** уменьшится период удержания резервной копии. Прочитайте раздел [Подробнее об автоматически создаваемых резервных копиях в Базе данных SQL](sql-database-automated-backups.md).
* Новые свойства базы данных не применяются до тех пор, пока изменение не завершится.

## <a name="single-database-limitations-of-p11-and-p15-when-the-maximum-size-greater-than-1-tb"></a>Отдельная база данных: ограничения P11 и P15 при максимальном размере, большем 1 ТБ

Максимальный размер больше 1 ТБ для базы данных P11 и P15 поддерживается в следующих регионах: восточная часть США 2, западная часть США, Виргиния (для обслуживания государственных организаций США), Западная Европа, центральная Германия, Юго-Восточная Азия, восточная Япония, восточная Австралия, центральная Канада и восточная Канада. Ниже приведены рекомендации и ограничения для баз данных P11 и P15 с максимальным размером, превышающим 1 ТБ.

- Если при создании базы данных выбрать максимальный размер больше 1 ТБ (указав значение 4 ТБ или 4096 ГБ), то выполнение команды create завершится ошибкой, если база данных подготавливается в неподдерживаемом регионе.
- Для существующих баз данных P11 или P15, расположенных в одном из поддерживаемых регионов, можно увеличить максимальный размер хранилища до 4 ТБ с шагом в 256 ГБ. Чтобы узнать, поддерживается ли в вашем регионе больший размер, используйте функцию [DATABASEPROPERTYEX](/sql/t-sql/functions/databasepropertyex-transact-sql) или проверьте размер базы данных на портале Azure. Обновление существующей базы данных P11 или P15 может выполнить только учетная запись субъекта уровня сервера или участники роли базы данных dbmanager. 
- При выполнении операции в поддерживаемом регионе конфигурация будет обновлена немедленно. Во время обновления база данных остается подключенной к сети. Тем не менее вы не сможете использовать весь объем хранилища больше 1 ТБ, пока файлы базы данных не будут обновлены до нового максимального размера. Требуемая продолжительность зависит от размера обновляемой базы данных. 
- При создании или обновлении базы данных P11 или P15 можно выбрать максимальный размер хранилища только в пределах 1–4 ТБ с шагом в 256 ГБ. При создании базы данных уровня производительности P11 или P15 уже выбран размер хранилища по умолчанию — 1 ТБ. Для баз данных, расположенных в одном из поддерживаемых регионов, можно увеличить максимальный размер хранилища до 4 ТБ для новой или существующей отдельной базы данных. Для всех других регионов максимальный размер не может превышать 1 ТБ. При выборе хранилища объемом в 4 ТБ цена не меняется.
- Если максимальный размер базы данных имеет значение больше 1 ТБ, то его нельзя изменить на 1 ТБ, даже если для базы данных фактически используется меньше 1 ТБ. Таким образом невозможно понизить базу данных уровня P11 или P15 с максимальным размером более 1 ТБ до базы данных с максимальным размером в 1 ТБ уровня P11 или P15 либо более низкого уровня производительности, например P1–P6. Это ограничение также применяется в сценариях восстановления и копирования, включая восстановление до точки во времени, геовосстановление, долгосрочное хранение резервных копий и копирование базы данных. После настройки максимального размера базы данных больше 1 ТБ все операции восстановления этой базы данных должны выполняться на уровне P11 или P15 с максимальным размером больше 1 ТБ.
- Для сценариев активной георепликации:
   - Настройка отношения георепликации. Если используется база данных-источник P11 или P15, уровень баз данных-получателей также должен быть P11 или P15. Базы данных более низкого уровня производительности отклоняются, так как они не поддерживают максимальный размер больше 1 ТБ.
   - Обновление базы данных-источника в отношениях георепликации. При изменении максимального размера и указании значения больше 1 ТБ в базе данных-источнике такие же изменения произойдут в базе данных-получателе. Чтобы изменения в базе данных-источнике вступили в силу, оба обновления должны быть успешными. При этом применяются ограничения по регионам для максимального размера больше 1 ТБ. Если база данных-получатель находится в регионе, не поддерживающем максимальный размер больше 1 TB, то база данных-источник не обновляется.
- Использование службы импорта и экспорта для загрузки баз данных P11 и P15 с максимальным размером больше 1 ТБ не поддерживается. Для [импорта](sql-database-import.md) и [экспорта](sql-database-export.md) данных используйте файл SqlPackage.exe.

## <a name="elastic-pool-storage-sizes-and-performance-levels"></a>Эластичный пул: размеры хранилища и уровни производительности

В следующих таблицах приведены доступные ресурсы для эластичных пулов баз данных SQL на каждом уровне служб и уровне производительности. Уровень служб, уровень производительности и объем хранилища можно задать с помощью [портала Azure](sql-database-elastic-pool.md#manage-elastic-pools-and-databases-using-the-azure-portal), [PowerShell](sql-database-elastic-pool.md#manage-elastic-pools-and-databases-using-powershell), [Azure CLI](sql-database-elastic-pool.md#manage-elastic-pools-and-databases-using-the-azure-cli) или [REST API](sql-database-elastic-pool.md#manage-elastic-pools-and-databases-using-the-rest-api).

> [!NOTE]
> Ограничения ресурсов отдельных баз данных в эластичных пулах обычно такие же, как и у отдельных баз данных за их пределами, и основаны на DTU и уровне служб. Например, максимальное количество одновременных рабочих экземпляров для базы данных S2 — 120. Таким образом, максимальное количество одновременных рабочих экземпляров в базе данных в стандартном пуле также составляет 120, если максимальное значение DTU для одной базы данных в пуле равно 50 (что эквивалентно уровню S2).
>

[!INCLUDE [SQL DB service tiers table for elastic pools](../../includes/sql-database-service-tiers-table-elastic-pools.md)]

Если использованы все DTU пула эластичных БД, то каждая база данных в пуле получает равное количество ресурсов для обработки запросов. Служба базы данных SQL обеспечивает равное разделение ресурсов между базами данных за счет равных срезов времени вычислений. Если задано минимальное значение DTU на базу данных, отличное от нуля, то такое равное разделение ресурсов в пуле эластичных БД также позволяет гарантировать любое дополнительное количество ресурсов каждой базе данных.

### <a name="database-properties-for-pooled-databases"></a>Свойства базы данных в составе пула

В следующей таблице описаны свойства баз данных в составе пула.

| Свойство | ОПИСАНИЕ |
|:--- |:--- |
| Максимальное количество eDTU на базу данных |Максимальное количество eDTU, которое может использовать любая база данных в пуле, если оно доступно и не используется другими базами данных в пуле. Это значение не гарантирует предоставление ресурсов базе данных. Это глобальный параметр, который применяется ко всем базам данных в пуле. Задайте большое максимальное количество eDTU на базу данных, достаточное для обработки пиков использования базы данных. Значение параметра может быть несколько преувеличенным, так как использование пула предполагает обращение к более и менее активным базам данных в условиях, когда не все базы одновременно обрабатывают пиковое количество запросов. Предположим, например, что пиковая нагрузка одной базы данных равна 20 eDTU и только 20 % из 100 баз данных в пуле одновременно работают с такой нагрузкой. Если в качестве максимального количества eDTU для каждой базы данных задано значение 20, для пула целесообразно увеличить количество eDTU в 5 раз и задать 400 eDTU на пул. |
| Минимальное количество eDTU на базу данных |Минимальное количество eDTU, которое гарантируется любой базе данных в пуле. Это глобальный параметр, который применяется ко всем базам данных в пуле. Можно задать минимальное количество eDTU на базу данных, равное 0, что также является значением по умолчанию. Для этого свойства задается значение в диапазоне от 0 до среднего количества eDTU, используемых на одну базу данных. Произведение количества баз данных в пуле и минимального количества eDTU на базу данных не может превышать количество eDTU на пул. Например, если в пуле 20 баз данных и минимальное количество eDTU на базу данных равно 10, то количество eDTU на пул должно быть не меньше 200. |
| Максимальный размер хранилища на базу данных |Максимальный размер хранилища для базы данных в пуле. Базы данных в составе пула совместно используют хранилище пула, поэтому размер хранилища базы данных находится в пределах от наименьшего оставшегося объема хранилища пула до максимального размера хранилища для базы данных. Максимальный объем хранилища базы данных означает максимальный размер файлов данных и не включает пространство, используемое файлами журнала. |
|||
 
## <a name="elastic-pool-change-storage-size"></a>Эластичный пул: изменение размера хранилища

- Цена DTU для эластичного пула включает в себя определенный объем хранилища, не требующий дополнительной платы. Дополнительный объем хранилища, сверх включенного, можно подготовить за дополнительную плату в пределах максимального допустимого размера с шагом в 250 ГБ при объеме хранилища до 1 ТБ и с шагом в 256 ГБ — при объеме более 1 ТБ. Сведения о включенном объеме хранилища и ограничениях максимального размера см. в разделе [Эластичный пул: размеры хранилища и уровни производительности](#elastic-pool-storage-sizes-and-performance-levels).
- Дополнительное хранилище для эластичного пула можно подготовить, увеличив его максимальный размер с помощью [портала Azure](sql-database-elastic-pool.md#manage-elastic-pools-and-databases-using-the-azure-portal), [PowerShell](/powershell/module/azurerm.sql/set-azurermsqlelasticpool), [Azure CLI](/cli/azure/sql/elastic-pool#az_sql_elastic_pool_update) или [REST API](/rest/api/sql/elasticpools/update).
- Стоимость дополнительного хранилища для эластичного пула равна его объему, умноженному на цену единицы хранения этого хранилища для уровня служб. Сведения о цене на дополнительное хранилище см. на [странице цен на Базу данных SQL](https://azure.microsoft.com/pricing/details/sql-database/).

## <a name="elastic-pool-change-edtus"></a>Эластичный пул: изменение числа eDTU

Можно увеличить или сократить ресурсы, доступные для эластичного пула, на основе потребностей в ресурсах, с помощью[портала Azure](sql-database-elastic-pool.md#manage-elastic-pools-and-databases-using-the-azure-portal), [PowerShell](/powershell/module/azurerm.sql/set-azurermsqlelasticpool), [Azure CLI](/cli/azure/sql/elastic-pool#az_sql_elastic_pool_update) или [REST API](/rest/api/sql/elasticpools/update).

- При масштабировании eDTU пула подключения к базе данных на короткое время разрываются. То же самое происходит при масштабировании DTU для отдельной базы данных (не в пуле). Дополнительные сведения о длительности и влиянии разрыва подключений к базе данных во время операций масштабирования см. в разделе [Ограничения ресурсов базы данных SQL Azure](#single-database-change-storage-size). 
- Время, необходимое для масштабирования eDTU пула, может зависеть от общего объема пространства, используемого всеми базами данных в пуле. Как правило, задержка при изменении масштаба в среднем составляет не более 90 минут на 100 ГБ. Например, если общее пространство, используемое всеми базами данных в пуле, равно 200 ГБ, то ожидаемая задержка при изменении масштаба пула составит до 3 часов. В некоторых случаях в рамках уровней "Стандартный" и "Базовый" задержка при изменении масштаба может составлять меньше пяти минут, вне зависимости от объема используемого пространства.
- Как правило, изменение минимального или максимального числа eDTU для базы данных обычно завершается за пять минут или быстрее.
- При уменьшении числа eDTU пула используемое им пространство не должно превышать максимальное допустимое число eDTU для целевых уровня служб и уровня производительности.
- При изменении масштаба eDTU пула взимается дополнительная плата за хранилище, если максимальный размер хранилища пула поддерживается целевым пулом и превышает включенный объем хранилища целевого пула. Например, если пул категории "Стандартный" с максимальным размером в 100 ГБ, содержащий 100 eDTU, уменьшается до пула категории "Стандартный" с максимальным размером в 100 ГБ, содержащего 50 eDTU, то взимается плата за дополнительное хранилище, так как целевой пул поддерживает максимальный размер в 100 ГБ, а его включенный объем хранилища составляет только 50 ГБ. Поэтому дополнительный объем хранилища равен 100 – 50 = 50 ГБ. Чтобы узнать о ценах на дополнительное хранилище, ознакомьтесь с [ценами на Базу данных SQL](https://azure.microsoft.com/pricing/details/sql-database/). Если фактический объем пространства, которое используется, меньше, чем включенный объем хранилища, то этих дополнительных затрат можно избежать, уменьшив максимальный размер базы данных до включенного объема. 

## <a name="what-happens-when-database-and-elastic-pool-resource-limits-are-reached"></a>Что происходит при достижении ограничения ресурсов базы данных и эластичного пула?

### <a name="compute-dtus-and-edtus"></a>Вычисления (DTU и eDTU)

Когда использование вычислительных ресурсов базы данных (измеряемое в DTU и eDTU) значительно вырастает, то увеличиваются задержки и даже может истечь время ожидания. В этих условиях служба может ставить запросы в очередь и предоставлять ресурсы для их выполнения по мере освобождения этих ресурсов.
При интенсивном использовании вычислительных ресурсов возможны следующие варианты предотвращения последствий:

- Увеличение уровня производительности базы данных или эластичного пула для предоставления базе данных дополнительных DTU и eDTU. Ознакомьтесь с разделами [Отдельная база данных: изменение числа DTU](#single-database-change-dtus) и [Эластичный пул: изменение числа eDTU](#elastic-pool-change-edtus).
- Оптимизация запросов для уменьшения использования ресурсов каждым запросом. Дополнительные сведения см. в разделе [Настройка запросов и указания на них](sql-database-performance-guidance.md#query-tuning-and-hinting).

### <a name="storage"></a>Хранилище

Когда используемое пространство базы данных достигает максимального размера, операции вставки и обновления, увеличивающие размер данных, завершаются сбоем и клиенты получают [сообщение об ошибке](sql-database-develop-error-messages.md). Операции SELECT и DELETE с базой данных продолжают успешно выполняться.

При интенсивном использовании пространства возможны следующие варианты предотвращения последствий:

- Увеличение максимального размера базы данных или эластичного пула либо изменение уровня производительности для получения большего включенного объема хранилища. Ознакомьтесь с разделом [Ограничения ресурсов базы данных SQL Azure](sql-database-resource-limits.md).
- Если база данных находится в эластичном пуле, то в качестве альтернативы ее можно переместить за пределы пула, чтобы ее дисковое пространство не использовалось совместно с другими базами данных.

### <a name="sessions-and-workers-requests"></a>Сеансы и рабочие роли (запросы) 

Максимальное количество одновременных сеансов и рабочих ролей определяется уровнем служб и уровнем производительности (DTU и eDTU).  При достижении ограничения числа сеансов или рабочих ролей новые запросы отклоняются, а клиенты получают сообщение об ошибке. Хотя приложение может управлять числом доступных подключений, число параллельных рабочих ролей зачастую существенно труднее оценивать и контролировать. Это особенно сильно проявляется в периоды пиковой нагрузки, когда достигаются ограничения ресурсов базы данных и рабочие роли накапливаются из-за увеличенной длительности выполнения запросов. 

При интенсивном использовании сеансов и рабочих ролей возможны следующие варианты предотвращения последствий:
- Повышение уровня служб или уровня производительности базы данных или эластичного пула. Ознакомьтесь с разделами [Отдельная база данных: изменение размера хранилища](#single-database-change-storage-size), [Отдельная база данных: изменение числа DTU](#single-database-change-dtus), [Эластичный пул: изменение размера хранилища](#elastic-pool-change-storage-size) и [Эластичный пул: изменение числа eDTU](#elastic-pool-change-edtus).
- Оптимизация запросов для сокращения использования ресурсов, необходимых каждому запросу, если причиной повышенного использования рабочих ролей является состязание за вычислительные ресурсы. Дополнительные сведения см. в разделе [Настройка запросов и указания на них](sql-database-performance-guidance.md#query-tuning-and-hinting).

## <a name="next-steps"></a>Дополнительная информация

- Сведения об уровнях служб см. в разделе [Доступные параметры производительности базы данных SQL Azure](sql-database-service-tiers.md).
- Сведения об отдельных базах данных см. в разделе [Ограничения ресурсов базы данных SQL Azure](sql-database-resource-limits.md).
- Сведения об эластичных пулах см. в разделе [Эластичные пулы помогают управлять несколькими базами данных SQL и масштабировать их](sql-database-elastic-pool.md).
- Сведения об общих ограничениях Azure см. в разделе [Подписка Azure, границы, квоты и ограничения службы](../azure-subscription-service-limits.md).
- Сведения о DTU и eDTU см. в разделе [Общие сведения об обычных единицах передачи данных (DTU) и единицах передачи данных в эластичной базе данных (eDTU)](sql-database-what-is-a-dtu.md).
- Сведения об ограничениях на размер базы данных tempdb см. в разделе "База данных tempdb в базе данных SQL" (https://docs.microsoft.com/sql/relational-databases/databases/tempdb-database#tempdb-database-in-sql-database).
