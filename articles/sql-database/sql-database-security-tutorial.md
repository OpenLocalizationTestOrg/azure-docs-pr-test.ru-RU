---
title: "aaaSecure базы данных Azure SQL | Документы Microsoft"
description: "Дополнительные сведения о методах и функциях toosecure базы данных Azure SQL."
services: sql-database
documentationcenter: 
author: DRediske
manager: jhubbard
editor: 
tags: 
ms.assetid: 
ms.service: sql-database
ms.custom: mvc,security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: 
ms.date: 06/28/2017
ms.author: daredis
ms.openlocfilehash: 1450d633d6f65faf1b8a2dc0dc7dfe996fb0719d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="secure-your-azure-sql-database"></a>Защита базы данных SQL Azure

База данных SQL защищает данные, ограничивая tooyour базы данных access, с помощью правил брандмауэра, требующие tooprove пользователей их идентификации и авторизации toodata через членство в роли и разрешения, а также через механизмы проверки подлинности безопасность на уровне строк и маскирование динамических данных.

Можно улучшить защиту hello базы данных на соответствие пользователей-злоумышленников или несанкционированного доступа с помощью нескольких простых шагов. Из этого руководства вы узнаете, как выполнять такие задачи. 

> [!div class="checklist"]
> * Настройка правил брандмауэра уровня сервера для сервера в hello портал Azure
> * Создание правил брандмауэра на уровне базы данных для базы данных с помощью SSMS.
> * Подключиться с помощью строки безопасного подключения базы данных tooyour
> * Управление доступом пользователей.
> * Защита данных с помощью шифрования
> * Включение аудита базы данных SQL
> * Включение обнаружения угроз базы данных SQL

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/), прежде чем начинать работу.

## <a name="prerequisites"></a>Предварительные требования

toocomplete этого учебника, убедитесь в наличии hello следующие:

- Установленные hello новейшую версию [SQL Server Management Studio](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms) (SSMS). 
- Установите Microsoft Excel.
- Создан на сервер Azure SQL и базы данных — в разделе [создать базу данных Azure SQL в hello портал Azure](sql-database-get-started-portal.md), [создание одной базы данных Azure SQL с помощью Azure CLI hello](sql-database-get-started-cli.md), и [создание единого SQL Azure базы данных с помощью PowerShell](sql-database-get-started-powershell.md). 

## <a name="log-in-toohello-azure-portal"></a>Войдите в toohello портал Azure

Войдите в toohello [портал Azure](https://portal.azure.com/).

## <a name="create-a-server-level-firewall-rule-in-hello-azure-portal"></a>Создание правила брандмауэра уровня сервера в hello портал Azure

Базы данных SQL защищены брандмауэром в Azure. По умолчанию все соединения toohello сервера hello базы данных и внутри сервера hello отклоняются, за исключением соединений с другими службами Azure. Дополнительные сведения см. в разделе [Правила брандмауэра уровня сервера и уровня базы данных SQL Azure](sql-database-firewall-configure.md).

Hello наиболее высокий уровень безопасности — tooset tooOFF «Разрешить доступ tooAzure службы». Если необходимо настроить базу данных toohello tooconnect из виртуальной Машины Azure или облачные службы, необходимо создать [зарезервированный IP-адрес](../virtual-network/virtual-networks-reserved-public-ip.md) и поддерживает только hello зарезервированные IP адрес доступ через брандмауэр hello. 

Выполните эти действия toocreate [правила брандмауэра уровня сервера базы данных SQL](sql-database-firewall-configure.md) для tooallow подключений к серверу из конкретного IP-адреса. 

> [!NOTE]
> Если вы создали образец базы данных в Azure с помощью одного из предыдущих занятий hello или примеры использования и являются этого учебника для выполнения на компьютере с hello же IP-адрес что он имел при рассмотрения этих учебников, можно пропустить этот шаг, вы получите уже создано правило брандмауэра уровня сервера.
>

1. Нажмите кнопку **баз данных SQL** из hello левом меню и выберите пункт hello базы данных следует правило брандмауэра hello tooconfigure для на hello **баз данных SQL** страницы. Hello страница общих сведений для вашей базы данных открывается, показывающая вы полностью hello доменное имя сервера (таких как **mynewserver 20170313.database.windows.net**) и предоставляет параметры для дальнейшей настройки.

      ![правило брандмауэра для сервера](./media/sql-database-security-tutorial/server-firewall-rule.png) 

2. Нажмите кнопку **установить брандмауэр сервера** на hello инструментов, как показано на предыдущем рисунке hello. Hello **параметры брандмауэра** откроется страница приветствия базы данных SQL server. 

3. Нажмите кнопку **добавить IP-адрес клиента** на hello инструментов tooadd hello общедоступный IP-адрес портала подключенных toohello hello компьютера с или вручную введите правило брандмауэра hello и нажмите кнопку **Сохранить**.

      ![Настройка правила брандмауэра для сервера](./media/sql-database-security-tutorial/server-firewall-rule-set.png) 

4. Нажмите кнопку **ОК** и нажмите кнопку hello **X** tooclose hello **параметры брандмауэра** страницы.

Базы данных tooany hello server теперь можно подключиться с hello указан IP-адрес или IP-адрес диапазона.

> [!NOTE]
> База данных SQL обменивается данными через порт 1433. Если вы пытаетесь tooconnect из корпоративной сети, исходящий трафик через порт 1433 может оказаться невозможным брандмауэром вашей сети. В этом случае нельзя сервера базы данных SQL Azure может tooconnect tooyour Если ИТ-отдел открывает порт 1433.
>

## <a name="create-a-database-level-firewall-rule-using-ssms"></a>Создание правила брандмауэра уровня базы данных с помощью SSMS

Правила брандмауэра уровня базы данных включить брандмауэр для разных баз данных в пределах hello же логический сервер и toocreate брандмауэра правила, являются переносимыми - это означает, что они следуют hello базы данных во время различных toocreate [перехода на другой ресурс ](sql-database-geo-replication-overview.md) помещения в hello SQL server. Правила брандмауэра уровня базы данных можно только настроенные с помощью инструкций Transact-SQL и только после настройки первого правила брандмауэра уровня сервера hello. Дополнительные сведения см. в разделе [Правила брандмауэра уровня сервера и уровня базы данных SQL Azure](sql-database-firewall-configure.md).

Ниже эти шаги toocreate правило брандмауэра для конкретной базы данных.

1. Подключение tooyour базы данных, например с помощью [SQL Server Management Studio](./sql-database-connect-query-ssms.md).

2. В обозревателе объектов щелкните правой кнопкой мыши на hello базы данных, которая tooadd правило брандмауэра и нажмите кнопку **новый запрос**. Пустое окно запроса, откроется tooyour подключенной базы данных.

3. В окне запроса hello измените hello tooyour открытый IP-адрес, а затем выполните приветствия при следующем запросе:

    ```sql
    EXECUTE sp_set_database_firewall_rule N'Example DB Rule','0.0.0.4','0.0.0.4';
    ```

4. На панели инструментов hello, нажмите кнопку **Execute** правило брандмауэра toocreate hello.

## <a name="view-how-tooconnect-an-application-tooyour-database-using-a-secure-connection-string"></a>Просматривать как tooconnect tooyour приложения базы данных с помощью строки безопасного подключения

tooensure защищенное зашифрованное подключение между клиентским приложением и базой данных SQL, строка подключения hello имеет toobe настроен для:

- запрашивалось зашифрованное подключение и
- сертификат сервера hello toonot доверия. 

Это устанавливает соединение с помощью Transport Layer Security (TLS) и снижает риск атак в середине hello. Можно получить строки подключения с правильно настроенной для базы данных SQL для поддерживаемых клиентских драйверов из hello портал Azure как показано для ADO.net в этом снимке экрана.

1. Выберите **баз данных SQL** hello левом меню и выберите базу данных на hello **баз данных SQL** страницы.

2. На hello **Обзор** для базы данных и щелкните **Показать строки подключения базы данных**.

3. Просмотрите hello завершения **ADO.NET** строку подключения.

    ![Строка подключения по протоколу ADO.NET](./media/sql-database-security-tutorial/adonet-connection-string.png)

## <a name="creating-database-users"></a>Создание пользователей базы данных

Прежде чем создавать пользователей, необходимо выбрать один из двух типов аутентификации, поддерживаемых базой данных SQL Azure: 

**Проверка подлинности SQL**, которое использует имя пользователя и пароль для входа и Здравствуйте, пользователи, которые допустимы только в контексте конкретной базы данных в логическом сервере. 

**Аутентификация Azure Active Directory**: используются удостоверения, управляемые Azure Active Directory. 

Если требуется, чтобы toouse [Azure Active Directory](./sql-database-aad-authentication.md) tooauthenticate с базой данных SQL, заполненных Azure Active Directory должен существовать прежде чем продолжить.

Выполните эти шаги toocreate пользователя с помощью проверки подлинности SQL.

1. Подключение tooyour базы данных, например с помощью [SQL Server Management Studio](./sql-database-connect-query-ssms.md) с помощью свои учетные данные администратора сервера.

2. В обозревателе объектов щелкните правой кнопкой мыши в базе данных hello tooadd нового пользователя на и щелкните **новый запрос**. Пустое окно запроса, откроется подключенных toohello выбранной базы данных.

3. В окне запроса hello введите приветствия при следующем запросе:

    ```sql
    CREATE USER ApplicationUser WITH PASSWORD = 'YourStrongPassword1';
    ```

4. На панели инструментов hello, нажмите кнопку **Execute** toocreate hello пользователя.

5. По умолчанию hello пользователя могут подключаться toohello базы данных, но не содержит разрешений tooread или записи данных. toogrant toohello эти разрешения только что созданный пользователь, выполните следующие две команды в новое окно запроса hello

    ```sql
    ALTER ROLE db_datareader ADD MEMBER ApplicationUser;
    ALTER ROLE db_datawriter ADD MEMBER ApplicationUser;
    ```

Это лучший подход toocreate, эти учетные записи без прав администратора на уровне tooconnect tooyour hello базы данных базы данных, если только не требуется tooexecute задач администрирования, таких как создание новых пользователей. Просмотрите hello [учебник по Azure Active Directory](./sql-database-aad-authentication-configure.md) о том, как tooauthenticate, с помощью Azure Active Directory.


## <a name="protect-your-data-with-encryption"></a>Защита данных с помощью шифрования

Прозрачное шифрование базы данных SQL Azure (TDE) автоматически шифрует данные при хранении, без необходимости любые изменения toohello приложения доступ к hello зашифрованной базы данных. Для новых баз данных прозрачное шифрование данных включено по умолчанию. tooenable прозрачное шифрование данных для базы данных или tooverify, прозрачное шифрование данных, выполните следующие действия.

1. Выберите **баз данных SQL** hello левом меню и выберите базу данных на hello **баз данных SQL** страницы. 

2. Щелкните **прозрачное шифрование данных** страницы конфигурации hello tooopen для прозрачного шифрования данных.

    ![Прозрачное шифрование данных](./media/sql-database-security-tutorial/transparent-data-encryption-enabled.png)

3. При необходимости задайте **шифрование данных** tooON и нажмите кнопку **Сохранить**.

процесс шифрования Hello запускает в фоновом режиме hello. Отследить ход выполнения hello с помощью подключения базы данных tooSQL [SQL Server Management Studio](./sql-database-connect-query-ssms.md) путем запроса столбца encryption_state hello hello `sys.dm_database_encryption_keys` представления.

## <a name="enable-sql-database-auditing-if-necessary"></a>Включение аудита базы данных SQL (при необходимости)

Azure SQL Database Auditing отслеживает события базы данных и записывает их tooan журнал аудита вашей учетной записи хранилища Azure. Аудит может помочь вам соблюсти требования нормативов, проанализировать работу с базой данных и получить представление о расхождениях и аномалиях, которые могут указывать на предполагаемые нарушения безопасности. Выполните эти шаги toocreate политику аудита по умолчанию для базы данных SQL.

1. Выберите **баз данных SQL** hello левом меню и выберите базу данных на hello **баз данных SQL** страницы. 

2. В колонке параметров hello выберите **аудита и обнаружения угроз**. Обратите внимание, что аудит на уровне сервера отключено и наличии **проверить параметры сервера** ссылку, которая позволяет вам tooview или изменить параметры аудита сервера hello в данном контексте.

    ![Колонка "Аудит"](./media/sql-database-security-tutorial/auditing-get-started-settings.png)

3. При желании tooenable аудита типа (или расположение?) отличается от hello одно указанное на уровне сервера hello, включить **ON** аудита и выберите hello **большой двоичный объект** типа аудита. Если включен аудит сервера больших двоичных объектов, hello настроена как база данных аудита будет существовать параллельно с hello server BLOB-объект аудита.

    ![Включение аудита](./media/sql-database-security-tutorial/auditing-get-started-turn-on.png)

4. Выберите **сведения о хранилище** tooopen hello колонке хранения журналов аудита. Учетной записи хранилища Azure выберите hello, где будут сохраняться журналы и срок хранения hello, после которого hello старые журналы будут удалены, нажмите кнопку **ОК** внизу hello. 

   > [!TIP]
   > Используйте hello же учетная запись хранения для всех hello tooget аудита баз данных, наиболее эффективно использовать аудит hello сообщает шаблонов.
   > 

5. Щелкните **Сохранить**.

> [!IMPORTANT]
> Если требуется toocustomize hello аудиту события, это можно сделать через PowerShell или REST API - разделе hello [автоматизации (PowerShell или REST API)](sql-database-auditing.md#subheading-7) более подробные сведения.
>

## <a name="enable-sql-database-threat-detection"></a>Включение обнаружения угроз базы данных SQL

Обнаружение угроз обеспечивает новый уровень безопасности, которая позволяет клиентам toodetect и отвечать toopotential угроз, как только они происходят, предоставляя предупреждения системы безопасности о подозрительной активности. Пользователи могут анализировать hello подозрительных событий с помощью toodetermine аудита базы данных SQL, если они в результате попытки tooaccess, нарушения или воспользоваться hello базы данных. Обнаружение угроз база данных он простой tooaddress потенциальных угроз toohello без необходимости hello toobe специалист по безопасности или управлять повышенной безопасности, контроль различных систем.
Например, система обнаружения угроз обнаруживает определенную подозрительную активность в базе данных, указывающую на потенциальные попытки внедрения кода SQL. Внедрение кода SQL — одно из hello общих Web вопросами безопасности приложений на hello Интернета, используемых tooattack управляемых данными приложений. Злоумышленникам воспользоваться преимуществами tooinject уязвимостей приложения злонамеренные инструкции SQL в поля записи приложения, для нарушению или изменение данных в базе данных hello.

1. Перейдите в колонку toohello конфигурации из базы данных SQL требуется toomonitor hello. В колонке параметров hello выберите **аудита и обнаружения угроз**.

    ![Область навигации](./media/sql-database-security-tutorial/auditing-get-started-settings.png)
2. В hello **аудита и обнаружения угроз** Включение колонке конфигурации **ON** аудита, который будет отображать параметры обнаружения угроз hello.

3. Переведите переключатель обнаружения угроз в положение **Вкл.**

4. Настройте hello список адресов электронной почты, которые будут получать предупреждения системы безопасности при обнаружении аномальные действия базы данных.

5. Нажмите кнопку **Сохранить** в hello **аудита и угрозы обнаружения** toosave колонке hello новых или обновленных политику аудита и угрозы обнаружения.

    ![Область навигации](./media/sql-database-security-tutorial/td-turn-on-threat-detection.png)

    При обнаружении подозрительных действий в базе данных вы получите уведомление по электронной почте. Hello электронной почты будут представлены сведения события hello подозрительные безопасности, включая характер hello hello аномальных действий, имя базы данных, время события сервера имя и hello. Кроме того он предоставит сведения о возможных причинах и рекомендуется tooinvestigate действия и устранить базы данных toohello hello потенциальных угроз. Hello обход далее шаги можно выполнить с помощью какие toodo вы должны получать такие сообщения электронной почты:

    ![Электронное сообщение об обнаружении угроз](./media/sql-database-threat-detection-get-started/4_td_email.png)

6. В сообщении электронной почты hello, нажмите кнопку hello **журнал аудита SQL Azure** ссылку, которая будет запустите hello портал Azure и показывает соответствующие записи аудита hello вокруг hello время hello подозрительные события.

    ![Записи аудита](./media/sql-database-threat-detection-get-started/5_td_audit_records.png)

7. Дополнительные сведения о действия hello подозрительных баз данных, такие как инструкции SQL, щелкните tooview записей аудита hello сбоя IP причину и клиента.

    ![Сведения о записи](./media/sql-database-security-tutorial/6_td_audit_record_details.png)

8. В колонке hello записей аудита, щелкните **открыть в Excel** excel tooopen предварительно настроенный шаблон tooimport и выполнения углубленного анализа журнала аудита hello вокруг hello время hello подозрительные события.

    > [!NOTE]
    > В Excel 2010 или более поздней версии, Power Query и hello **Быстрое объединение** параметр является обязательным.

    ![Открытые записей в Excel](./media/sql-database-threat-detection-get-started/7_td_audit_records_open_excel.png)

9. tooconfigure hello **Быстрое объединение** параметр - в hello **POWER QUERY** выберите вкладку ленты **параметры** toodisplay диалогового окна параметров hello. Выберите раздел конфиденциальности hello и выберите второй параметр hello - «Игнорировать уровни конфиденциальности hello и повысить производительность»:

    ![Быстрое объединение в Excel](./media/sql-database-threat-detection-get-started/8_td_excel_fast_combine.png)

10. журналы аудита tooload SQL, убедитесь, что hello параметры на вкладке Параметры hello установлены правильно, а затем выберите ленту «Данные» hello и нажмите кнопку «Обновить все» hello.

    ![Параметры Excel](./media/sql-database-threat-detection-get-started/9_td_excel_parameters.png)

11. Hello результаты отображаются в hello **журналы аудита SQL** лист, позволяющий более глубокого анализа toorun hello аномальных действий, которые были обнаружены и сократить влияние hello hello событий безопасности в приложении.


## <a name="next-steps"></a>Дальнейшие действия
Можно улучшить защиту hello базы данных на соответствие пользователей-злоумышленников или несанкционированного доступа с помощью нескольких простых шагов. Из этого руководства вы узнаете, как выполнять такие задачи. 

> [!div class="checklist"]
> * Настройка правил брандмауэра для сервера и базы данных.
> * Подключиться с помощью строки безопасного подключения базы данных tooyour
> * Управление доступом пользователей.
> * Защита данных с помощью шифрования
> * Включение аудита базы данных SQL
> * Включение обнаружения угроз базы данных SQL

> [!div class="nextstepaction"]
>[Troubleshoot performance issues and optimize your database](sql-database-performance-tutorial.md) (Устранение проблем с производительностью и оптимизация базы данных)

