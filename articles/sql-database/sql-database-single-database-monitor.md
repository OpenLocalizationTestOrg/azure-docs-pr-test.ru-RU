---
title: "aaaMonitoring производительность базы данных в базе данных SQL Azure | Документы Microsoft"
description: "Сведения о способах hello мониторинг с помощью средств Azure и динамические административные представления базы данных."
keywords: "мониторинг базы данных, производительность облачной базы данных"
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: a2e47475-c955-4a8d-a65c-cbef9a6d9b9f
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: b13771183d4ccf37f58e2fc518b9b14de38212dc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="monitoring-database-performance-in-azure-sql-database"></a><span data-ttu-id="521a8-104">Мониторинг производительности базы данных в базе данных SQL Azure</span><span class="sxs-lookup"><span data-stu-id="521a8-104">Monitoring database performance in Azure SQL Database</span></span>
<span data-ttu-id="521a8-105">Наблюдение за производительностью hello базы данных SQL в Azure начинается с наблюдения за hello ресурсов относительный toohello уровень использования производительности базы данных, которая выбирается.</span><span class="sxs-lookup"><span data-stu-id="521a8-105">Monitoring hello performance of a SQL database in Azure starts with monitoring hello resource utilization relative toohello level of database performance you choose.</span></span> <span data-ttu-id="521a8-106">Мониторинг помогает определить емкостью лишние или возникли проблемы, так как израсходован ресурсы базы данных, и затем решить, будет ли уровень производительности времени tooadjust hello и [уровень обслуживания](sql-database-service-tiers.md) базы данных.</span><span class="sxs-lookup"><span data-stu-id="521a8-106">Monitoring helps you  determine whether your database has excess capacity or is having trouble because resources are maxed out, and then decide whether it's time tooadjust hello performance level and [service tier](sql-database-service-tiers.md) of your database.</span></span> <span data-ttu-id="521a8-107">Можно отслеживать с помощью графических средств в hello базы данных [портал Azure](https://portal.azure.com) или при помощи SQL [динамические административные представления](https://msdn.microsoft.com/library/ms188754.aspx).</span><span class="sxs-lookup"><span data-stu-id="521a8-107">You can monitor your database using graphical tools in hello [Azure portal](https://portal.azure.com) or using SQL [dynamic management views](https://msdn.microsoft.com/library/ms188754.aspx).</span></span>

## <a name="monitor-databases-using-hello-azure-portal"></a><span data-ttu-id="521a8-108">Мониторинг баз данных с помощью портала Azure hello</span><span class="sxs-lookup"><span data-stu-id="521a8-108">Monitor databases using hello Azure portal</span></span>
<span data-ttu-id="521a8-109">В hello [портал Azure](https://portal.azure.com/), можно наблюдать за одной базы данных, выбрав эту базу данных и выберите пункт hello **мониторинг** диаграммы.</span><span class="sxs-lookup"><span data-stu-id="521a8-109">In hello [Azure portal](https://portal.azure.com/), you can monitor a single database’s utilization by selecting your database and clicking hello **Monitoring** chart.</span></span> <span data-ttu-id="521a8-110">Откроется окно **метрика** окно, в котором можно изменить, щелкнув hello **изменение диаграммы** кнопки.</span><span class="sxs-lookup"><span data-stu-id="521a8-110">This brings up a **Metric** window that you can change by clicking hello **Edit chart** button.</span></span> <span data-ttu-id="521a8-111">Добавьте hello следующие метрики:</span><span class="sxs-lookup"><span data-stu-id="521a8-111">Add hello following metrics:</span></span>

* <span data-ttu-id="521a8-112">Процент использования ЦП</span><span class="sxs-lookup"><span data-stu-id="521a8-112">CPU percentage</span></span>
* <span data-ttu-id="521a8-113">Процент использования DTU</span><span class="sxs-lookup"><span data-stu-id="521a8-113">DTU percentage</span></span>
* <span data-ttu-id="521a8-114">Процент операций ввода/вывода данных</span><span class="sxs-lookup"><span data-stu-id="521a8-114">Data IO percentage</span></span>
* <span data-ttu-id="521a8-115">Размер базы данных в процентах</span><span class="sxs-lookup"><span data-stu-id="521a8-115">Database size percentage</span></span>

<span data-ttu-id="521a8-116">После добавления этих метрик, вы можете продолжить tooview их в hello **мониторинг** диаграмму, содержащую Дополнительные сведения о hello **метрика** окна.</span><span class="sxs-lookup"><span data-stu-id="521a8-116">Once you’ve added these metrics, you can continue tooview them in hello **Monitoring** chart with more details on hello **Metric** window.</span></span> <span data-ttu-id="521a8-117">Все четыре метрики показывают hello среднее использование процент относительного toohello **DTU** базы данных.</span><span class="sxs-lookup"><span data-stu-id="521a8-117">All four metrics show hello average utilization percentage relative toohello **DTU** of your database.</span></span> <span data-ttu-id="521a8-118">В разделе hello [уровней служб](sql-database-service-tiers.md) статьи приведены сведения о Dtu.</span><span class="sxs-lookup"><span data-stu-id="521a8-118">See hello [service tiers](sql-database-service-tiers.md) article for details about DTUs.</span></span>

![Мониторинг производительности базы данных для разных уровней служб.](./media/sql-database-service-tiers/sqldb_service_tier_monitoring.png)

<span data-ttu-id="521a8-120">Также можно настроить предупреждения по метрикам производительности hello.</span><span class="sxs-lookup"><span data-stu-id="521a8-120">You can also configure alerts on hello performance metrics.</span></span> <span data-ttu-id="521a8-121">Нажмите кнопку hello **добавить оповещение** кнопку в hello **метрика** окна.</span><span class="sxs-lookup"><span data-stu-id="521a8-121">Click hello **Add alert** button in hello **Metric** window.</span></span> <span data-ttu-id="521a8-122">Выполните мастер tooconfigure hello оповещения.</span><span class="sxs-lookup"><span data-stu-id="521a8-122">Follow hello wizard tooconfigure your alert.</span></span> <span data-ttu-id="521a8-123">У вас есть параметр tooalert hello метрики hello превышает определенный порог или hello метрика выходит за пределы определенного порогового значения.</span><span class="sxs-lookup"><span data-stu-id="521a8-123">You have hello option tooalert if hello metrics exceed a certain threshold or if hello metric falls below a certain threshold.</span></span>

<span data-ttu-id="521a8-124">Например если предполагается hello рабочей нагрузки на toogrow вашей базы данных, вы можете tooconfigure оповещение по электронной почте каждый раз, когда базы данных достигает 80% на любой из метрик производительности hello.</span><span class="sxs-lookup"><span data-stu-id="521a8-124">For example, if you expect hello workload on your database toogrow, you can choose tooconfigure an email alert whenever your database reaches 80% on any of hello performance metrics.</span></span> <span data-ttu-id="521a8-125">Это можно использовать как раннее toofigure предупреждение, когда может потребоваться tooswitch toohello следующий уровень производительности.</span><span class="sxs-lookup"><span data-stu-id="521a8-125">You can use this as an early warning toofigure out when you might have tooswitch toohello next higher performance level.</span></span>

<span data-ttu-id="521a8-126">метрики производительности Hello также помогают определить, при наличии возможности toodowngrade tooa низкой производительностью.</span><span class="sxs-lookup"><span data-stu-id="521a8-126">hello performance metrics can also help you determine if you are able toodowngrade tooa lower performance level.</span></span> <span data-ttu-id="521a8-127">Предположим, вы используете базы данных Standard S2 и демонстрируют метрики производительности, в среднем hello базы данных не использует более чем 10% в любой момент времени.</span><span class="sxs-lookup"><span data-stu-id="521a8-127">Assume you are using a Standard S2 database and all performance metrics show that hello database on average does not use more than 10% at any given time.</span></span> <span data-ttu-id="521a8-128">Вполне вероятно, hello базы данных будут нормально работать Standard S1.</span><span class="sxs-lookup"><span data-stu-id="521a8-128">It is likely that hello database will work well in Standard S1.</span></span> <span data-ttu-id="521a8-129">Однако иметь в виду рабочих нагрузок, перед внесением hello решение toomove tooa низкий уровень производительности Резкие скачки и изменения.</span><span class="sxs-lookup"><span data-stu-id="521a8-129">However, be aware of workloads that spike or fluctuate before making hello decision toomove tooa lower performance level.</span></span>

## <a name="monitor-databases-using-dmvs"></a><span data-ttu-id="521a8-130">Мониторинг баз данных с помощью динамических административных представлений</span><span class="sxs-lookup"><span data-stu-id="521a8-130">Monitor databases using DMVs</span></span>
<span data-ttu-id="521a8-131">Hello же метрики, предоставляемые в портале hello, также доступны через системные представления: [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) в логической hello **master** базы данных вашего сервера и [sys.dm_db_ resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) в базе данных пользователей hello.</span><span class="sxs-lookup"><span data-stu-id="521a8-131">hello same metrics that are exposed in hello portal are also available through system views: [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) in hello logical **master** database of your server, and [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) in hello user database.</span></span> <span data-ttu-id="521a8-132">Используйте **sys.resource_stats** при необходимости toomonitor менее подробных данных в течение длительного периода времени.</span><span class="sxs-lookup"><span data-stu-id="521a8-132">Use **sys.resource_stats** if you need toomonitor less granular data across a longer period of time.</span></span> <span data-ttu-id="521a8-133">Используйте **sys.dm_db_resource_stats** при необходимости toomonitor более подробных данных в течение меньшего времени.</span><span class="sxs-lookup"><span data-stu-id="521a8-133">Use **sys.dm_db_resource_stats** if you need toomonitor more granular data within a smaller time frame.</span></span> <span data-ttu-id="521a8-134">Дополнительные сведения см. в статье [База данных SQL Azure и производительность отдельных баз данных](sql-database-single-database-monitor.md#monitor-resource-use).</span><span class="sxs-lookup"><span data-stu-id="521a8-134">For more information, see [Azure SQL Database Performance Guidance](sql-database-single-database-monitor.md#monitor-resource-use).</span></span>

> [!NOTE]
> <span data-ttu-id="521a8-135">При использовании в базах данных устаревших выпусков Web Edition и Business Edition **sys.dm_db_resource_stats** возвращает пустой результирующий набор.</span><span class="sxs-lookup"><span data-stu-id="521a8-135">**sys.dm_db_resource_stats** returns an empty result set when used in Web and Business edition databases, which are retired.</span></span>
>
>

### <a name="monitor-resource-use"></a><span data-ttu-id="521a8-136">Отслеживание использования ресурсов</span><span class="sxs-lookup"><span data-stu-id="521a8-136">Monitor resource use</span></span>

<span data-ttu-id="521a8-137">Использование ресурсов можно отслеживать с помощью [анализа производительности запросов базы данных SQL](sql-database-query-performance.md) и [хранилища запросов](https://msdn.microsoft.com/library/dn817826.aspx).</span><span class="sxs-lookup"><span data-stu-id="521a8-137">You can monitor resource usage using [SQL Database Query Performance Insight](sql-database-query-performance.md) and [Query Store](https://msdn.microsoft.com/library/dn817826.aspx).</span></span>

<span data-ttu-id="521a8-138">Кроме того, для отслеживания использования можно применять два приведенных ниже представления.</span><span class="sxs-lookup"><span data-stu-id="521a8-138">You can also monitor usage using these two views:</span></span>

* [<span data-ttu-id="521a8-139">sys.dm_db_resource_stats</span><span class="sxs-lookup"><span data-stu-id="521a8-139">sys.dm_db_resource_stats</span></span>](https://msdn.microsoft.com/library/dn800981.aspx)
* [<span data-ttu-id="521a8-140">sys.resource_stats</span><span class="sxs-lookup"><span data-stu-id="521a8-140">sys.resource_stats</span></span>](https://msdn.microsoft.com/library/dn269979.aspx)

#### <a name="sysdmdbresourcestats"></a><span data-ttu-id="521a8-141">sys.dm_db_resource_stats</span><span class="sxs-lookup"><span data-stu-id="521a8-141">sys.dm_db_resource_stats</span></span>
<span data-ttu-id="521a8-142">Можно использовать hello [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) представление в каждой базе данных SQL.</span><span class="sxs-lookup"><span data-stu-id="521a8-142">You can use hello [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) view in every SQL database.</span></span> <span data-ttu-id="521a8-143">Hello **sys.dm_db_resource_stats** представлении отображаются последние ресурсов уровня обслуживания относительный toohello использования данных.</span><span class="sxs-lookup"><span data-stu-id="521a8-143">hello **sys.dm_db_resource_stats** view shows recent resource use data relative toohello service tier.</span></span> <span data-ttu-id="521a8-144">Средний процент нагрузки ЦП, показатели операций ввода-вывода данных, записи в журнал и данные о памяти записываются каждые 15 секунд и хранятся 1 час.</span><span class="sxs-lookup"><span data-stu-id="521a8-144">Average percentages for CPU, data I/O, log writes, and memory are recorded every 15 seconds and are maintained for 1 hour.</span></span>

<span data-ttu-id="521a8-145">Так как это представление содержит более подробные сведения об использовании ресурсов, сначала используйте представление **sys.dm_db_resource_stats** для любого анализа текущего состояния и устранения неполадок.</span><span class="sxs-lookup"><span data-stu-id="521a8-145">Because this view provides a more granular look at resource use, use **sys.dm_db_resource_stats** first for any current-state analysis or troubleshooting.</span></span> <span data-ttu-id="521a8-146">Например этот запрос показаны hello среднее и максимальное ресурсов используют для текущей базы данных hello по hello последний час:</span><span class="sxs-lookup"><span data-stu-id="521a8-146">For example, this query shows hello average and maximum resource use for hello current database over hello past hour:</span></span>

    SELECT  
        AVG(avg_cpu_percent) AS 'Average CPU use in percent',
        MAX(avg_cpu_percent) AS 'Maximum CPU use in percent',
        AVG(avg_data_io_percent) AS 'Average data I/O in percent',
        MAX(avg_data_io_percent) AS 'Maximum data I/O in percent',
        AVG(avg_log_write_percent) AS 'Average log write use in percent',
        MAX(avg_log_write_percent) AS 'Maximum log write use in percent',
        AVG(avg_memory_usage_percent) AS 'Average memory use in percent',
        MAX(avg_memory_usage_percent) AS 'Maximum memory use in percent'
    FROM sys.dm_db_resource_stats;  

<span data-ttu-id="521a8-147">Для других запросов см. Примеры hello в [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span><span class="sxs-lookup"><span data-stu-id="521a8-147">For other queries, see hello examples in [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span></span>

#### <a name="sysresourcestats"></a><span data-ttu-id="521a8-148">sys.resource_stats</span><span class="sxs-lookup"><span data-stu-id="521a8-148">sys.resource_stats</span></span>
<span data-ttu-id="521a8-149">Hello [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) представления в hello **master** база данных содержит дополнительные сведения, которые можно отслеживать производительность hello базы данных SQL на уровне по производительности и уровня определенной службы .</span><span class="sxs-lookup"><span data-stu-id="521a8-149">hello [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view in hello **master** database has additional information that can help you monitor hello performance of your SQL database at its specific service tier and performance level.</span></span> <span data-ttu-id="521a8-150">Hello данные собираются каждые 5 минут и сохраняется для около 35 дней.</span><span class="sxs-lookup"><span data-stu-id="521a8-150">hello data is collected every 5 minutes and is maintained for approximately 35 days.</span></span> <span data-ttu-id="521a8-151">Это представление полезно для анализа использования ресурсов Базы данных SQL за более долгий период.</span><span class="sxs-lookup"><span data-stu-id="521a8-151">This view is useful for a longer-term historical analysis of how your SQL database uses resources.</span></span>

<span data-ttu-id="521a8-152">Hello следующей диаграмме показано использование ресурсов ЦП hello для расширенной базы данных с уровнем производительности P2 hello за каждый час в течение недели.</span><span class="sxs-lookup"><span data-stu-id="521a8-152">hello following graph shows hello CPU resource use for a Premium database with hello P2 performance level for each hour in a week.</span></span> <span data-ttu-id="521a8-153">На этом графике начинается в понедельник, показывает 5 рабочих дней, а затем показывает выходным, когда происходит гораздо меньшего приложения hello.</span><span class="sxs-lookup"><span data-stu-id="521a8-153">This graph starts on a Monday, shows 5 work days, and then shows a weekend, when much less happens on hello application.</span></span>

![Использование ресурсов Базы данных SQL](./media/sql-database-performance-guidance/sql_db_resource_utilization.png)

<span data-ttu-id="521a8-155">На основе данных hello этой базы данных в настоящее время имеет Пиковая нагрузка ЦП чуть более 50 процентов ЦП использовать уровень производительности относительный toohello P2 (полдень вторника).</span><span class="sxs-lookup"><span data-stu-id="521a8-155">From hello data, this database currently has a peak CPU load of just over 50 percent CPU use relative toohello P2 performance level (midday on Tuesday).</span></span> <span data-ttu-id="521a8-156">Если ЦП hello главным фактором ресурсного профиля приложения hello, может решить, что P2 — hello правой универсальное tooguarantee уровня производительности, который всегда hello рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="521a8-156">If CPU is hello dominant factor in hello application’s resource profile, then you might decide that P2 is hello right performance level tooguarantee that hello workload always fits.</span></span> <span data-ttu-id="521a8-157">Если предполагается, что приложение toogrow со временем, это toohave рекомендуется увеличить буфер ресурсов, чтобы приложение hello не никогда не достигнет лимита уровня производительности hello.</span><span class="sxs-lookup"><span data-stu-id="521a8-157">If you expect an application toogrow over time, it's a good idea toohave an extra resource buffer so that hello application doesn't ever reach hello performance-level limit.</span></span> <span data-ttu-id="521a8-158">При увеличении уровня производительности hello может помочь избежать заметных ошибок, которые могут возникнуть при базы данных не имеет достаточно power tooprocess запросов по сути, особенно в средах с задержками.</span><span class="sxs-lookup"><span data-stu-id="521a8-158">If you increase hello performance level, you can help avoid customer-visible errors that might occur when a database doesn't have enough power tooprocess requests effectively, especially in latency-sensitive environments.</span></span> <span data-ttu-id="521a8-159">Например, базы данных, которая поддерживает приложения, создающего веб-страниц на основе результатов hello вызовов базы данных.</span><span class="sxs-lookup"><span data-stu-id="521a8-159">An example is a database that supports an application that paints webpages based on hello results of database calls.</span></span>

<span data-ttu-id="521a8-160">Другие приложения могут интерпретировать hello же graph по-разному.</span><span class="sxs-lookup"><span data-stu-id="521a8-160">Other application types might interpret hello same graph differently.</span></span> <span data-ttu-id="521a8-161">Например если приложение пытается данные о заработной плате tooprocess каждый день и имеет hello одной диаграмме, в этом kind модели «задание» может сделать детально на уровне производительности P1.</span><span class="sxs-lookup"><span data-stu-id="521a8-161">For example, if an application tries tooprocess payroll data each day and has hello same chart, this kind of "batch job" model might do fine at a P1 performance level.</span></span> <span data-ttu-id="521a8-162">Hello уровнем производительности P1 предоставляет 100 Dtu too200 Dtu по сравнению с уровнем производительности P2 hello.</span><span class="sxs-lookup"><span data-stu-id="521a8-162">hello P1 performance level has 100 DTUs compared too200 DTUs at hello P2 performance level.</span></span> <span data-ttu-id="521a8-163">Hello уровнем производительности P1 предоставляет половину производительность hello hello уровнем производительности P2.</span><span class="sxs-lookup"><span data-stu-id="521a8-163">hello P1 performance level provides half hello performance of hello P2 performance level.</span></span> <span data-ttu-id="521a8-164">Таким образом, 50 процентов использования ЦП на уровне P2 равняется 100 процентам использования ЦП на уровне P1.</span><span class="sxs-lookup"><span data-stu-id="521a8-164">So, 50 percent of CPU use in P2 equals 100 percent CPU use in P1.</span></span> <span data-ttu-id="521a8-165">Если приложение hello не имеет значения времени ожидания, может не важно, если задание занимает 2 часа или toofinish 2,5 часа, если оно закончилось сегодня.</span><span class="sxs-lookup"><span data-stu-id="521a8-165">If hello application does not have timeouts, it might not matter if a job takes 2 hours or 2.5 hours toofinish, if it gets done today.</span></span> <span data-ttu-id="521a8-166">Приложение такой категории может использовать уровень Р1.</span><span class="sxs-lookup"><span data-stu-id="521a8-166">An application in this category probably can use a P1 performance level.</span></span> <span data-ttu-id="521a8-167">Можно воспользоваться преимуществами hello тем, что периоды времени, в течение дня hello, когда ниже, использование ресурсов, чтобы все «больших (пик)» может быть перенесена в одну Пиковая hello позже в день hello.</span><span class="sxs-lookup"><span data-stu-id="521a8-167">You can take advantage of hello fact that there are periods of time during hello day when resource use is lower, so that any "big peak" might spill over into one of hello troughs later in hello day.</span></span> <span data-ttu-id="521a8-168">Hello уровень производительности Р1 может быть хорошо подходит для такого рода приложения (и деньги), при условии, что hello заданий можно вовремя каждый день.</span><span class="sxs-lookup"><span data-stu-id="521a8-168">hello P1 performance level might be good for that kind of application (and save money), as long as hello jobs can finish on time each day.</span></span>

<span data-ttu-id="521a8-169">Azure предоставляет доступ к базе данных SQL сведения об использовании ресурсов для каждой активной базы данных в hello **sys.resource_stats** представление hello **master** базы данных на каждом сервере.</span><span class="sxs-lookup"><span data-stu-id="521a8-169">Azure SQL Database exposes consumed resource information for each active database in hello **sys.resource_stats** view of hello **master** database in each server.</span></span> <span data-ttu-id="521a8-170">Hello в таблице hello собраны для 5-минутные интервалы.</span><span class="sxs-lookup"><span data-stu-id="521a8-170">hello data in hello table is aggregated for 5-minute intervals.</span></span> <span data-ttu-id="521a8-171">Уровней обслуживания по hello Basic, Standard и Premium hello данных может занять более 5 минут tooappear в таблице hello, поэтому эти данные лучше подходит для исторического анализа, а не analysis рядом реального времени.</span><span class="sxs-lookup"><span data-stu-id="521a8-171">With hello Basic, Standard, and Premium service tiers, hello data can take more than 5 minutes tooappear in hello table, so this data is more useful for historical analysis rather than near-real-time analysis.</span></span> <span data-ttu-id="521a8-172">Запрос hello **sys.resource_stats** представление toosee hello в журнале последние данные из базы данных и toovalidate ли резервирование hello выбраны доставляется hello производительности при необходимости.</span><span class="sxs-lookup"><span data-stu-id="521a8-172">Query hello **sys.resource_stats** view toosee hello recent history of a database and toovalidate whether hello reservation you chose delivered hello performance you want when needed.</span></span>

> [!NOTE]
> <span data-ttu-id="521a8-173">Должен быть подключенным toohello **master** базы данных из вашего tooquery логический сервер базы данных SQL **sys.resource_stats** в следующих примерах hello.</span><span class="sxs-lookup"><span data-stu-id="521a8-173">You must be connected toohello **master** database of your logical SQL database server tooquery **sys.resource_stats** in hello following examples.</span></span>
> 
> 

<span data-ttu-id="521a8-174">В этом примере показано, как представляется hello данные в этом представлении:</span><span class="sxs-lookup"><span data-stu-id="521a8-174">This example shows you how hello data in this view is exposed:</span></span>

    SELECT TOP 10 *
    FROM sys.resource_stats
    WHERE database_name = 'resource1'
    ORDER BY start_time DESC

![представление каталога sys.resource_stats Hello](./media/sql-database-performance-guidance/sys_resource_stats.png)

<span data-ttu-id="521a8-176">Hello Приведем пример можно различными способами, которые можно использовать hello **sys.resource_stats** представление tooget сведения об использовании ресурсов в базе данных SQL из каталога:</span><span class="sxs-lookup"><span data-stu-id="521a8-176">hello next example shows you different ways that you can use hello **sys.resource_stats** catalog view tooget information about how your SQL database uses resources:</span></span>

1. <span data-ttu-id="521a8-177">toolook на hello за неделю ресурсов используйте для базы данных userdb1 hello, можно выполнить этот запрос:</span><span class="sxs-lookup"><span data-stu-id="521a8-177">toolook at hello past week’s resource use for hello database userdb1, you can run this query:</span></span>
   
        SELECT *
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND
              start_time > DATEADD(day, -7, GETDATE())
        ORDER BY start_time DESC;
2. <span data-ttu-id="521a8-178">tooevaluate насколько hello уровень производительности подходит для рабочей нагрузки, необходимо toodrill вниз в каждый аспект метрики ресурсов hello: ЦП, операций чтения, записи, количество рабочих потоков и число сеансов.</span><span class="sxs-lookup"><span data-stu-id="521a8-178">tooevaluate how well your workload fits hello performance level, you need toodrill down into each aspect of hello resource metrics: CPU, reads, writes, number of workers, and number of sessions.</span></span> <span data-ttu-id="521a8-179">Ниже приводится измененный запрос с использованием **sys.resource_stats** tooreport Здравствуйте, среднее и максимальное значения эти метрики ресурсов:</span><span class="sxs-lookup"><span data-stu-id="521a8-179">Here's a revised query using **sys.resource_stats** tooreport hello average and maximum values of these resource metrics:</span></span>
   
        SELECT
            avg(avg_cpu_percent) AS 'Average CPU use in percent',
            max(avg_cpu_percent) AS 'Maximum CPU use in percent',
            avg(avg_data_io_percent) AS 'Average physical data I/O use in percent',
            max(avg_data_io_percent) AS 'Maximum physical data I/O use in percent',
            avg(avg_log_write_percent) AS 'Average log write use in percent',
            max(avg_log_write_percent) AS 'Maximum log write use in percent',
            avg(max_session_percent) AS 'Average % of sessions',
            max(max_session_percent) AS 'Maximum % of sessions',
            avg(max_worker_percent) AS 'Average % of workers',
            max(max_worker_percent) AS 'Maximum % of workers'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
3. <span data-ttu-id="521a8-180">По этой информации о hello среднее и максимальное значения по каждому ресурсу можно оценить, насколько хорошо рабочей нагрузки попадают hello выбранный уровень производительности.</span><span class="sxs-lookup"><span data-stu-id="521a8-180">With this information about hello average and maximum values of each resource metric, you can assess how well your workload fits into hello performance level you chose.</span></span> <span data-ttu-id="521a8-181">Как правило, средние значения из **sys.resource_stats** предоставляют хорошую основу toouse hello целевого резервирования.</span><span class="sxs-lookup"><span data-stu-id="521a8-181">Usually, average values from **sys.resource_stats** give you a good baseline toouse against hello target size.</span></span> <span data-ttu-id="521a8-182">Эти сведения следует использовать в качестве отправной точки анализа.</span><span class="sxs-lookup"><span data-stu-id="521a8-182">It should be your primary measurement stick.</span></span> <span data-ttu-id="521a8-183">Например возможно, вы используете уровень обслуживания Standard hello с уровнем производительности S2.</span><span class="sxs-lookup"><span data-stu-id="521a8-183">For an example, you might be using hello Standard service tier with S2 performance level.</span></span> <span data-ttu-id="521a8-184">Hello среднее использование процентов для ЦП и ввода-вывода чтения и записи являются менее 40 процентов hello среднее число рабочих ролей меньше 50 и hello среднее число сеансов меньше 200.</span><span class="sxs-lookup"><span data-stu-id="521a8-184">hello average use percentages for CPU and I/O reads and writes are below 40 percent, hello average number of workers is below 50, and hello average number of sessions is below 200.</span></span> <span data-ttu-id="521a8-185">Рабочая нагрузка может поместиться в hello уровень производительности S1.</span><span class="sxs-lookup"><span data-stu-id="521a8-185">Your workload might fit into hello S1 performance level.</span></span> <span data-ttu-id="521a8-186">Это легко toosee ли базы данных помещается в рабочей роли hello и предельных параметров сеанса.</span><span class="sxs-lookup"><span data-stu-id="521a8-186">It's easy toosee whether your database fits in hello worker and session limits.</span></span> <span data-ttu-id="521a8-187">toosee ли базы данных помещается в более низкий уровень производительности с считает tooCPU, операции чтения и записи, разделите количество DTU hello hello низкий уровень производительности hello число DTU текущего уровня производительности и умножьте результат hello 100:</span><span class="sxs-lookup"><span data-stu-id="521a8-187">toosee whether a database fits into a lower performance level with regards tooCPU, reads, and writes, divide hello DTU number of hello lower performance level by hello DTU number of your current performance level, and then multiply hello result by 100:</span></span>
   
    <span data-ttu-id="521a8-188">**DTU S1 / DTU S2 * 100 = 20 / 50 * 100 = 40**</span><span class="sxs-lookup"><span data-stu-id="521a8-188">**S1 DTU / S2 DTU * 100 = 20 / 50 * 100 = 40**</span></span>
   
    <span data-ttu-id="521a8-189">результат Hello — hello относительная разница производительности между hello два уровня производительности в процентах.</span><span class="sxs-lookup"><span data-stu-id="521a8-189">hello result is hello relative performance difference between hello two performance levels in percentage.</span></span> <span data-ttu-id="521a8-190">Если использование ресурсов не превышает это значение, рабочая нагрузка может поместиться в hello низкий уровень производительности.</span><span class="sxs-lookup"><span data-stu-id="521a8-190">If your resource use doesn't exceed this amount, your workload might fit into hello lower performance level.</span></span> <span data-ttu-id="521a8-191">Тем не менее требуется toolook во все диапазоны значений использования ресурсов и определить, в процентах, как часто рабочей нагрузки базы данных может поместиться в hello низкий уровень производительности.</span><span class="sxs-lookup"><span data-stu-id="521a8-191">However, you need toolook at all ranges of resource use values, and determine, by percentage, how often your database workload would fit into hello lower performance level.</span></span> <span data-ttu-id="521a8-192">Hello следующий запрос отображает hello в соответствии процент на измерение ресурсов, на основе порогового значения hello 40 процентов, который мы вычисляется в данном примере:</span><span class="sxs-lookup"><span data-stu-id="521a8-192">hello following query outputs hello fit percentage per resource dimension, based on hello threshold of 40 percent that we calculated in this example:</span></span>
   
        SELECT
            (COUNT(database_name) - SUM(CASE WHEN avg_cpu_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'CPU Fit Percent'
            ,(COUNT(database_name) - SUM(CASE WHEN avg_log_write_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Log Write Fit Percent'
            ,(COUNT(database_name) - SUM(CASE WHEN avg_data_io_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Physical Data IO Fit Percent'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
   
    <span data-ttu-id="521a8-193">Исходя из вашей базы данных уровень обслуживания (SLO), можно ли рабочей нагрузки попадают hello низкий уровень производительности.</span><span class="sxs-lookup"><span data-stu-id="521a8-193">Based on your database service level objective (SLO), you can decide whether your workload fits into hello lower performance level.</span></span> <span data-ttu-id="521a8-194">Если рабочая нагрузка базы данных SLO — 99,9% и hello предыдущий запрос возвращает значение больше 99,9% для всех трех измерений ресурсов, рабочая нагрузка скорее всего, попадают hello низкий уровень производительности.</span><span class="sxs-lookup"><span data-stu-id="521a8-194">If your database workload SLO is 99.9 percent and hello preceding query returns values greater than 99.9 percent for all three resource dimensions, your workload likely fits into hello lower performance level.</span></span>
   
    <span data-ttu-id="521a8-195">Просмотрев процент соответствия hello также предоставляет регулировать ли следует переместить уровня toomeet Далее выше производительности toohello вашей цели уровня Обслуживания.</span><span class="sxs-lookup"><span data-stu-id="521a8-195">Looking at hello fit percentage also gives you insight into whether you should move toohello next higher performance level toomeet your SLO.</span></span> <span data-ttu-id="521a8-196">Например userdb1 показывает hello после использования ЦП для hello прошлую неделю:</span><span class="sxs-lookup"><span data-stu-id="521a8-196">For example, userdb1 shows hello following CPU use for hello past week:</span></span>
   
   | <span data-ttu-id="521a8-197">Средняя нагрузка ЦП, %</span><span class="sxs-lookup"><span data-stu-id="521a8-197">Average CPU percent</span></span> | <span data-ttu-id="521a8-198">Максимальная нагрузка ЦП, %</span><span class="sxs-lookup"><span data-stu-id="521a8-198">Maximum CPU percent</span></span> |
   | --- | --- |
   | <span data-ttu-id="521a8-199">24,5</span><span class="sxs-lookup"><span data-stu-id="521a8-199">24.5</span></span> |<span data-ttu-id="521a8-200">100,00</span><span class="sxs-lookup"><span data-stu-id="521a8-200">100.00</span></span> |
   
    <span data-ttu-id="521a8-201">Средняя загрузка ЦП Hello — примерно четверти hello ограничения уровня производительности hello, которые попадают в hello уровень производительности базы данных hello.</span><span class="sxs-lookup"><span data-stu-id="521a8-201">hello average CPU is about a quarter of hello limit of hello performance level, which would fit well into hello performance level of hello database.</span></span> <span data-ttu-id="521a8-202">Но hello максимальное значение показывает, что hello базы данных достигает предела hello hello уровня производительности.</span><span class="sxs-lookup"><span data-stu-id="521a8-202">But, hello maximum value shows that hello database reaches hello limit of hello performance level.</span></span> <span data-ttu-id="521a8-203">Требуется toomove toohello следующий уровень производительности?</span><span class="sxs-lookup"><span data-stu-id="521a8-203">Do you need toomove toohello next higher performance level?</span></span> <span data-ttu-id="521a8-204">Определить, как много раз рабочая нагрузка достигает 100 процентов и сравнивают его рабочая нагрузка базы данных tooyour цели уровня Обслуживания.</span><span class="sxs-lookup"><span data-stu-id="521a8-204">Look at how many times your workload reaches 100 percent, and then compare it tooyour database workload SLO.</span></span>
   
        SELECT
        (COUNT(database_name) - SUM(CASE WHEN avg_cpu_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'CPU fit percent'
        ,(COUNT(database_name) - SUM(CASE WHEN avg_log_write_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Log write fit percent'
        ,(COUNT(database_name) - SUM(CASE WHEN avg_data_io_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Physical data I/O fit percent'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
   
    <span data-ttu-id="521a8-205">Если этот запрос возвращает значение меньше 99,9% для любого hello трех измерений ресурсов, рекомендуется либо скользящего toohello следующий уровень производительности или использовать настройки приложения hello-нагрузки tooreduce методы в базе данных SQL hello.</span><span class="sxs-lookup"><span data-stu-id="521a8-205">If this query returns a value less than 99.9 percent for any of hello three resource dimensions, consider either moving toohello next higher performance level or use application-tuning techniques tooreduce hello load on hello SQL database.</span></span>
4. <span data-ttu-id="521a8-206">В этом упражнении также учитывает будущих увеличение hello вашей предполагаемой рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="521a8-206">This exercise also considers your projected workload increase in hello future.</span></span>

<span data-ttu-id="521a8-207">Эластичные пулы можно выполнять мониторинг отдельных баз данных в пуле hello с hello методик, описанных в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="521a8-207">For elastic pools, you can monitor individual databases in hello pool with hello techniques described in this section.</span></span> <span data-ttu-id="521a8-208">Однако вы можете отслеживать пул hello в целом.</span><span class="sxs-lookup"><span data-stu-id="521a8-208">But you can also monitor hello pool as a whole.</span></span> <span data-ttu-id="521a8-209">Дополнительные сведения см. в статье [Мониторинг пула эластичных баз данных и управление им на портале Azure](sql-database-elastic-pool-manage-portal.md).</span><span class="sxs-lookup"><span data-stu-id="521a8-209">For information, see [Monitor and manage an elastic pool](sql-database-elastic-pool-manage-portal.md).</span></span>


### <a name="maximum-concurrent-requests"></a><span data-ttu-id="521a8-210">Максимальное количество параллельных запросов</span><span class="sxs-lookup"><span data-stu-id="521a8-210">Maximum concurrent requests</span></span>
<span data-ttu-id="521a8-211">toosee hello число одновременных запросов, выполните этот запрос Transact-SQL в базе данных SQL.</span><span class="sxs-lookup"><span data-stu-id="521a8-211">toosee hello number of concurrent requests, run this Transact-SQL query on your SQL database:</span></span>

    SELECT COUNT(*) AS [Concurrent_Requests]
    FROM sys.dm_exec_requests R

<span data-ttu-id="521a8-212">Рабочая нагрузка hello tooanalyze локальной базы данных SQL Server и изменить toofilter этот запрос на hello конкретной базы данных будет tooanalyze.</span><span class="sxs-lookup"><span data-stu-id="521a8-212">tooanalyze hello workload of an on-premises SQL Server database, modify this query toofilter on hello specific database you want tooanalyze.</span></span> <span data-ttu-id="521a8-213">Например при наличии локальной базы данных, моябазаданных этот запрос Transact-SQL возвращает hello число одновременных запросов в этой базе данных:</span><span class="sxs-lookup"><span data-stu-id="521a8-213">For example, if you have an on-premises database named MyDatabase, this Transact-SQL query returns hello count of concurrent requests in that database:</span></span>

    SELECT COUNT(*) AS [Concurrent_Requests]
    FROM sys.dm_exec_requests R
    INNER JOIN sys.databases D ON D.database_id = R.database_id
    AND D.name = 'MyDatabase'

<span data-ttu-id="521a8-214">Это только моментальный снимок в один момент времени.</span><span class="sxs-lookup"><span data-stu-id="521a8-214">This is just a snapshot at a single point in time.</span></span> <span data-ttu-id="521a8-215">tooget лучше понять рабочей нагрузкой и требованиями одновременных запросов, вам потребуется toocollect большое количество примеров по времени.</span><span class="sxs-lookup"><span data-stu-id="521a8-215">tooget a better understanding of your workload and concurrent request requirements, you'll need toocollect many samples over time.</span></span>

### <a name="maximum-concurrent-logins"></a><span data-ttu-id="521a8-216">Максимальное число параллельных операций входа</span><span class="sxs-lookup"><span data-stu-id="521a8-216">Maximum concurrent logins</span></span>
<span data-ttu-id="521a8-217">Можно анализировать вашего пользователя и приложения шаблоны tooget представление о частоты приветствия имен входа.</span><span class="sxs-lookup"><span data-stu-id="521a8-217">You can analyze your user and application patterns tooget an idea of hello frequency of logins.</span></span> <span data-ttu-id="521a8-218">Также можно запустить реальных загрузок в toomake для среды тестирования, убедиться, что вы не встретились это или других ограничений, которые мы обсудим в этой статье.</span><span class="sxs-lookup"><span data-stu-id="521a8-218">You also can run real-world loads in a test environment toomake sure that you're not hitting this or other limits we discuss in this article.</span></span> <span data-ttu-id="521a8-219">Нет единого запроса или динамического административного представления, с помощью которых можно просмотреть количество параллельных операций входа или журнал.</span><span class="sxs-lookup"><span data-stu-id="521a8-219">There isn’t a single query or dynamic management view (DMV) that can show you concurrent login counts or history.</span></span>

<span data-ttu-id="521a8-220">Если несколько клиентов используют hello одинаковые строки подключения, hello служба проверяет подлинность каждого имени входа.</span><span class="sxs-lookup"><span data-stu-id="521a8-220">If multiple clients use hello same connection string, hello service authenticates each login.</span></span> <span data-ttu-id="521a8-221">Если 10 пользователей, одновременно подключаться hello tooa базы данных с помощью того же имени пользователя и пароля, будет 10 параллельных операций входа.</span><span class="sxs-lookup"><span data-stu-id="521a8-221">If 10 users simultaneously connect tooa database by using hello same username and password, there would be 10 concurrent logins.</span></span> <span data-ttu-id="521a8-222">Это ограничение применяется только toohello длительность hello входа и проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="521a8-222">This limit applies only toohello duration of hello login and authentication.</span></span> <span data-ttu-id="521a8-223">Если же 10 hello пользователи подключаются toohello базы данных последовательно, hello количество одновременных входов никогда не будет больше, чем 1.</span><span class="sxs-lookup"><span data-stu-id="521a8-223">If hello same 10 users connect toohello database sequentially, hello number of concurrent logins would never be greater than 1.</span></span>

> [!NOTE]
> <span data-ttu-id="521a8-224">В настоящее время это ограничение не применяется toodatabases в пулах эластичных БД.</span><span class="sxs-lookup"><span data-stu-id="521a8-224">Currently, this limit does not apply toodatabases in elastic pools.</span></span>
> 
> 

### <a name="maximum-sessions"></a><span data-ttu-id="521a8-225">Максимальное число сеансов</span><span class="sxs-lookup"><span data-stu-id="521a8-225">Maximum sessions</span></span>
<span data-ttu-id="521a8-226">toosee hello число текущих активных сеансов, выполните этот запрос Transact-SQL в базе данных SQL.</span><span class="sxs-lookup"><span data-stu-id="521a8-226">toosee hello number of current active sessions, run this Transact-SQL query on your SQL database:</span></span>

    SELECT COUNT(*) AS [Sessions]
    FROM sys.dm_exec_connections

<span data-ttu-id="521a8-227">При выполнении анализа рабочей нагрузки в локальной среде SQL Server, измените toofocus запроса hello конкретной базы данных.</span><span class="sxs-lookup"><span data-stu-id="521a8-227">If you're analyzing an on-premises SQL Server workload, modify hello query toofocus on a specific database.</span></span> <span data-ttu-id="521a8-228">Этот запрос позволяет определить потребности возможных сеанс для базы данных hello, в противном случае его перемещения tooAzure базы данных SQL.</span><span class="sxs-lookup"><span data-stu-id="521a8-228">This query helps you determine possible session needs for hello database if you are considering moving it tooAzure SQL Database.</span></span>

    SELECT COUNT(*)  AS [Sessions]
    FROM sys.dm_exec_connections C
    INNER JOIN sys.dm_exec_sessions S ON (S.session_id = C.session_id)
    INNER JOIN sys.databases D ON (D.database_id = S.database_id)
    WHERE D.name = 'MyDatabase'

<span data-ttu-id="521a8-229">Опять же, эти запросы возвращают значение счетчика на определенный момент времени.</span><span class="sxs-lookup"><span data-stu-id="521a8-229">Again, these queries return a point-in-time count.</span></span> <span data-ttu-id="521a8-230">Если со временем собрать несколько образцов, вы получите hello лучшее понимание сеанс использовать.</span><span class="sxs-lookup"><span data-stu-id="521a8-230">If you collect multiple samples over time, you’ll have hello best understanding of your session use.</span></span>

<span data-ttu-id="521a8-231">Для анализа базы данных SQL, можно получить исторические статистики на сеансах, запрашивая hello [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) представление и просмотрев hello **active_session_count** столбца.</span><span class="sxs-lookup"><span data-stu-id="521a8-231">For SQL Database analysis, you can get historical statistics on sessions by querying hello [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view and reviewing hello **active_session_count** column.</span></span> 
