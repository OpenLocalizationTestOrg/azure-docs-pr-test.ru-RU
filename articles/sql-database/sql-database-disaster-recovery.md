---
title: "аварийное восстановление базы данных aaaSQL | Документы Microsoft"
description: "Узнайте, как hello toorecover базы данных от сбоя регионального центра обработки данных или сбой базы данных SQL Azure активной георепликации и геовосстановление возможности."
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 4800960e-3f9d-40ce-9e55-fb7f2784c067
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/14/2017
ms.author: sashan
ms.openlocfilehash: bae08485863067748107ec4808e52d8e88e2de0d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="restore-an-azure-sql-database-or-failover-tooa-secondary"></a>Восстановление вторичного tooa базы данных SQL Azure или отработки отказа
База данных SQL Azure предлагает следующие возможности по восстановлению после сбоя hello.

* [Активная георепликация](sql-database-geo-replication-overview.md)
* [Геовосстановление](sql-database-recovery-using-backups.md#point-in-time-restore)

toolearn о непрерывности бизнес-сценариев и функций hello, поддерживающих эти сценарии, в разделе [непрерывность бизнес-процессов](sql-database-business-continuity.md).

### <a name="prepare-for-hello-event-of-an-outage"></a>Подготовка для события сбоя hello
Для успешного завершения работы с помощью активной георепликации или геоизбыточных архивов области данных tooanother восстановления необходимо tooprepare сервер в другой данных center сбоя toobecome hello новый основной сервер должен hello должны возникать, а также имеют четко определенные действия документированные и проверенный tooensure smooth восстановления. Эти подготовительные действия приведены ниже.

* Определите hello логический сервер в другой регион toobecome hello новый основной сервер. С помощью активной георепликации это будет по крайней мере один и возможно для каждого из серверов-получателей hello. Для геовосстановления, это обычно будет сервера в hello [парном регионе](../best-practices-availability-paired-regions.md) для hello региона, в котором расположена база данных.
* Определите и определять, правила брандмауэра уровня сервера hello необходимые по для пользователей tooaccess hello новой основной базы данных.
* Определите, как будет tooredirect пользователей toohello нового основного сервера, например, путем изменения строки подключения или путем изменения записей DNS.
* Определить и при необходимости создавать, hello имена входа, которые должны присутствовать в базе данных master hello на новый основной сервер hello и убедитесь, что эти имена входа иметь соответствующие разрешения в базе данных master hello, если таковые имеются. Дополнительные сведения см. в разделе [Как управлять безопасностью базы данных SQL после аварийного восстановления](sql-database-geo-replication-security-config.md).
* Определите правила оповещений, потребуется toobe обновленные toomap toohello новой базы данных-источника.
* Настройки аудита hello документов hello текущей базы данных-источника
* Выполните [отработку аварийного восстановления](sql-database-disaster-recovery-drills.md). toosimulate значение сбоя для геовосстановления, можно удалить или переименовать подключения сбоя приложения toocause hello исходной базы данных. toosimulate сбоя для активной георепликации, вы можете отключить веб-приложение hello или виртуальной машиной, подключенной toohello базы данных или отработки отказа hello базы данных toocause приложения отказов подключений.

## <a name="when-tooinitiate-recovery"></a>После восстановления tooinitiate
приложение hello влияет на операции восстановления Hello. Его необходимо изменить строку подключения SQL hello или перенаправление с помощью DNS и может привести к потере постоянных данных. Таким образом это следует делать только в случае сбоя hello скорее всего, toolast длиннее цель времени восстановления приложения. Когда hello приложение развернутой tooproduction необходимо выполнять регулярное Отслеживание работоспособности приложения hello и использовать hello следующие данные, которые tooassert точек, hello восстановления необходимо сделать:

1. Сбой постоянное подключение hello приложения уровня toohello базы данных.
2. оповещение об инциденте показывает Hello портал Azure в области hello с широкое влияние.
3. сервер базы данных SQL Azure Hello помечается как снижении.

В зависимости от приложения отклонения toodowntime и возможных бизнеса ответственность разработчика можно рассмотреть следующие варианты восстановления hello.

Используйте hello [получить Восстановимую базу данных](https://msdn.microsoft.com/library/dn800985.aspx) (*LastAvailableBackupDate*) последней точки восстановления, географически реплицированный tooget hello.

## <a name="wait-for-service-recovery"></a>Ожидание восстановления служб
Hello Azure работают в тщательно toorestore доступность службы как быстро можно, но в зависимости от причины hello может занять несколько часов или дней.  Если ваше приложение может работать значительно увеличить время простоя может просто ожидать toocomplete восстановления hello. В этом случае вам не нужно предпринимать какие-либо действия. Можно просмотреть текущее состояние службы hello на нашем [панель мониторинга работоспособности службы Azure](https://azure.microsoft.com/status/). После восстановления hello hello области будут восстановлены доступности приложения.

## <a name="fail-over-toogeo-replicated-secondary-database"></a>При сбое toogeo реплицированной базы данных-получателя
Если простой в работе приложения может иметь последствия для вашего бизнеса, в приложении следует использовать геореплицируемые базы данных. Активируется hello приложения tooquickly восстановления доступности в другом регионе, в случае сбоя. Узнайте, каким образом слишком[Настройка георепликации](sql-database-geo-replication-portal.md).

доступность toorestore hello баз данных, вы должны tooinitiate hello отработки отказа toohello георепликацией-получателя с помощью одного из методов hello поддерживается.

Используйте один из hello следующие руководства toofail через tooa географическая репликация базы данных-получателя.

* [При сбое tooa георепликацией-получателя с помощью портала Azure](sql-database-geo-replication-portal.md)
* [Отработка отказа tooa георепликацией получателя с помощью PowerShell](scripts/sql-database-setup-geodr-and-failover-database-powershell.md)
* [При сбое tooa георепликацией-получателя с помощью T-SQL](sql-database-geo-replication-transact-sql.md)

## <a name="recover-using-geo-restore"></a>Восстановление с использованием геовосстановления
Если время простоя приложения не приводит к появлению ответственности бизнеса можно использовать [геовосстановление](sql-database-recovery-using-backups.md) как toorecover метод базам данных приложения. Он создает копию базы данных hello из последней резервной копии географически избыточной.

## <a name="configure-your-database-after-recovery"></a>Настройка базы данных после восстановления
При использовании георепликации перехода на другой ресурс или toorecover географическое восстановление после сбоя, убедитесь в правильной настройке подключения hello toohello новых баз данных, чтобы функции hello обычного приложения может быть продолжено. Это приведен контрольный список задач tooget готовности рабочей восстановленной базы данных.

### <a name="update-connection-strings"></a>Обновление строк подключения
Поскольку восстановленной базы данных будет находиться на другом сервере, вам потребуется tooupdate сервера toothat toopoint строка подключения вашего приложения.

Дополнительные сведения об изменении строки соединения см. в разделе hello разработки соответствующий язык для вашего [библиотека подключения](sql-database-libraries.md).

### <a name="configure-firewall-rules"></a>Настройка правил брандмауэра
Необходимо убедиться, что hello настроить правила брандмауэра на сервере и на соответствие hello базы данных тех, которые были настроены на сервере-источнике hello и базы данных-источника toomake. Дополнительные сведения см. в статье [Практическое руководство. Настройка параметров брандмауэра для Базы данных SQL](sql-database-configure-firewall-settings.md).

### <a name="configure-logins-and-database-users"></a>Настройка учетных данных и пользователей базы данных
Необходимо toomake том, что все имена входа hello, используемым в приложении находятся на сервере hello, где размещается восстановленной базы данных. Дополнительные сведения см. в статье [Настройка безопасности Базы данных SQL Azure и управление ею для геовосстановления или отработки отказа](sql-database-geo-replication-security-config.md).

> [!NOTE]
> Необходимо настроить и протестировать правила брандмауэра и имена для входа (и их разрешения) на сервере во время отработки аварийного восстановления. Эти объекты уровня сервера и их конфигурации могут не быть доступны во время сбоя hello.
> 
> 

### <a name="setup-telemetry-alerts"></a>Настройка оповещений телеметрии
Необходимо toomake убедитесь, что существующие параметры правила оповещения обновленные toomap toohello восстановленной базы данных и hello другой сервер.

Подробнее о правилах генерации оповещений базы данных см. в разделах [Получение уведомлений об оповещениях](../monitoring-and-diagnostics/insights-receive-alert-notifications.md) и [Получение информации о работоспособности службы](../monitoring-and-diagnostics/insights-service-health.md).

### <a name="enable-auditing"></a>Включение аудита
Если аудит является обязательным tooaccess базы данных, необходимо tooenable аудит после восстановления базы данных hello. Дополнительные сведения см. в статье [Аудит базы данных](sql-database-auditing.md).

## <a name="next-steps"></a>Дальнейшие действия
* toolearn о резервных копиях автоматических базы данных SQL Azure, в разделе [базы данных SQL автоматическое резервное копирование](sql-database-automated-backups.md)
* toolearn о сценариев разработки и восстановления непрерывности бизнеса, в разделе [сценариев непрерывности](sql-database-business-continuity.md)
* toolearn об использовании автоматического создания резервных копий для восстановления, в разделе [восстановление базы данных из резервных копий, инициируемых службой hello](sql-database-recovery-using-backups.md)

