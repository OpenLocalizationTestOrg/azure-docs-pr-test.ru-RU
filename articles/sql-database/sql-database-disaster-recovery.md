---
title: "аварийное восстановление базы данных aaaSQL | Документы Microsoft"
description: "Узнайте, как hello toorecover базы данных от сбоя регионального центра обработки данных или сбой базы данных SQL Azure активной георепликации и геовосстановление возможности."
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 4800960e-3f9d-40ce-9e55-fb7f2784c067
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/14/2017
ms.author: sashan
ms.openlocfilehash: bae08485863067748107ec4808e52d8e88e2de0d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="restore-an-azure-sql-database-or-failover-tooa-secondary"></a><span data-ttu-id="52933-103">Восстановление вторичного tooa базы данных SQL Azure или отработки отказа</span><span class="sxs-lookup"><span data-stu-id="52933-103">Restore an Azure SQL Database or failover tooa secondary</span></span>
<span data-ttu-id="52933-104">База данных SQL Azure предлагает следующие возможности по восстановлению после сбоя hello.</span><span class="sxs-lookup"><span data-stu-id="52933-104">Azure SQL Database offers hello following capabilities for recovering from an outage:</span></span>

* [<span data-ttu-id="52933-105">Активная георепликация</span><span class="sxs-lookup"><span data-stu-id="52933-105">Active geo-replication</span></span>](sql-database-geo-replication-overview.md)
* [<span data-ttu-id="52933-106">Геовосстановление</span><span class="sxs-lookup"><span data-stu-id="52933-106">Geo-restore</span></span>](sql-database-recovery-using-backups.md#point-in-time-restore)

<span data-ttu-id="52933-107">toolearn о непрерывности бизнес-сценариев и функций hello, поддерживающих эти сценарии, в разделе [непрерывность бизнес-процессов](sql-database-business-continuity.md).</span><span class="sxs-lookup"><span data-stu-id="52933-107">toolearn about business continuity scenarios and hello features supporting these scenarios, see [Business continuity](sql-database-business-continuity.md).</span></span>

### <a name="prepare-for-hello-event-of-an-outage"></a><span data-ttu-id="52933-108">Подготовка для события сбоя hello</span><span class="sxs-lookup"><span data-stu-id="52933-108">Prepare for hello event of an outage</span></span>
<span data-ttu-id="52933-109">Для успешного завершения работы с помощью активной георепликации или геоизбыточных архивов области данных tooanother восстановления необходимо tooprepare сервер в другой данных center сбоя toobecome hello новый основной сервер должен hello должны возникать, а также имеют четко определенные действия документированные и проверенный tooensure smooth восстановления.</span><span class="sxs-lookup"><span data-stu-id="52933-109">For success with recovery tooanother data region using either active geo-replication or geo-redundant backups, you need tooprepare a server in another data center outage toobecome hello new primary server should hello need arise as well as have well-defined steps documented and tested tooensure a smooth recovery.</span></span> <span data-ttu-id="52933-110">Эти подготовительные действия приведены ниже.</span><span class="sxs-lookup"><span data-stu-id="52933-110">These preparation steps include:</span></span>

* <span data-ttu-id="52933-111">Определите hello логический сервер в другой регион toobecome hello новый основной сервер.</span><span class="sxs-lookup"><span data-stu-id="52933-111">Identify hello logical server in another region toobecome hello new primary server.</span></span> <span data-ttu-id="52933-112">С помощью активной георепликации это будет по крайней мере один и возможно для каждого из серверов-получателей hello.</span><span class="sxs-lookup"><span data-stu-id="52933-112">With active geo-replication, this will be at least one and perhaps each of hello secondary servers.</span></span> <span data-ttu-id="52933-113">Для геовосстановления, это обычно будет сервера в hello [парном регионе](../best-practices-availability-paired-regions.md) для hello региона, в котором расположена база данных.</span><span class="sxs-lookup"><span data-stu-id="52933-113">For geo-restore, this will generally be a server in hello [paired region](../best-practices-availability-paired-regions.md) for hello region in which your database is located.</span></span>
* <span data-ttu-id="52933-114">Определите и определять, правила брандмауэра уровня сервера hello необходимые по для пользователей tooaccess hello новой основной базы данных.</span><span class="sxs-lookup"><span data-stu-id="52933-114">Identify, and optionally define, hello server-level firewall rules needed on for users tooaccess hello new primary database.</span></span>
* <span data-ttu-id="52933-115">Определите, как будет tooredirect пользователей toohello нового основного сервера, например, путем изменения строки подключения или путем изменения записей DNS.</span><span class="sxs-lookup"><span data-stu-id="52933-115">Determine how you are going tooredirect users toohello new primary server, such as by changing connection strings or by changing DNS entries.</span></span>
* <span data-ttu-id="52933-116">Определить и при необходимости создавать, hello имена входа, которые должны присутствовать в базе данных master hello на новый основной сервер hello и убедитесь, что эти имена входа иметь соответствующие разрешения в базе данных master hello, если таковые имеются.</span><span class="sxs-lookup"><span data-stu-id="52933-116">Identify, and optionally create, hello logins that must be present in hello master database on hello new primary server, and ensure these logins have appropriate permissions in hello master database, if any.</span></span> <span data-ttu-id="52933-117">Дополнительные сведения см. в разделе [Как управлять безопасностью базы данных SQL после аварийного восстановления](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="52933-117">For more information, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md)</span></span>
* <span data-ttu-id="52933-118">Определите правила оповещений, потребуется toobe обновленные toomap toohello новой базы данных-источника.</span><span class="sxs-lookup"><span data-stu-id="52933-118">Identify alert rules that will need toobe updated toomap toohello new primary database.</span></span>
* <span data-ttu-id="52933-119">Настройки аудита hello документов hello текущей базы данных-источника</span><span class="sxs-lookup"><span data-stu-id="52933-119">Document hello auditing configuration on hello current primary database</span></span>
* <span data-ttu-id="52933-120">Выполните [отработку аварийного восстановления](sql-database-disaster-recovery-drills.md).</span><span class="sxs-lookup"><span data-stu-id="52933-120">Perform a [disaster recovery drill](sql-database-disaster-recovery-drills.md).</span></span> <span data-ttu-id="52933-121">toosimulate значение сбоя для геовосстановления, можно удалить или переименовать подключения сбоя приложения toocause hello исходной базы данных.</span><span class="sxs-lookup"><span data-stu-id="52933-121">toosimulate an outage for geo-restore, you can delete or rename hello source database toocause application connectivity failure.</span></span> <span data-ttu-id="52933-122">toosimulate сбоя для активной георепликации, вы можете отключить веб-приложение hello или виртуальной машиной, подключенной toohello базы данных или отработки отказа hello базы данных toocause приложения отказов подключений.</span><span class="sxs-lookup"><span data-stu-id="52933-122">toosimulate an outage for active geo-replication, you can disable hello web application or virtual machine connected toohello database or failover hello database toocause application connectivity failures.</span></span>

## <a name="when-tooinitiate-recovery"></a><span data-ttu-id="52933-123">После восстановления tooinitiate</span><span class="sxs-lookup"><span data-stu-id="52933-123">When tooinitiate recovery</span></span>
<span data-ttu-id="52933-124">приложение hello влияет на операции восстановления Hello.</span><span class="sxs-lookup"><span data-stu-id="52933-124">hello recovery operation impacts hello application.</span></span> <span data-ttu-id="52933-125">Его необходимо изменить строку подключения SQL hello или перенаправление с помощью DNS и может привести к потере постоянных данных.</span><span class="sxs-lookup"><span data-stu-id="52933-125">It requires changing hello SQL connection string or redirection using DNS and could result in permanent data loss.</span></span> <span data-ttu-id="52933-126">Таким образом это следует делать только в случае сбоя hello скорее всего, toolast длиннее цель времени восстановления приложения.</span><span class="sxs-lookup"><span data-stu-id="52933-126">Therefore, it should be done only when hello outage is likely toolast longer than your application's recovery time objective.</span></span> <span data-ttu-id="52933-127">Когда hello приложение развернутой tooproduction необходимо выполнять регулярное Отслеживание работоспособности приложения hello и использовать hello следующие данные, которые tooassert точек, hello восстановления необходимо сделать:</span><span class="sxs-lookup"><span data-stu-id="52933-127">When hello application is deployed tooproduction you should perform regular monitoring of hello application health and use hello following data points tooassert that hello recovery is warranted:</span></span>

1. <span data-ttu-id="52933-128">Сбой постоянное подключение hello приложения уровня toohello базы данных.</span><span class="sxs-lookup"><span data-stu-id="52933-128">Permanent connectivity failure from hello application tier toohello database.</span></span>
2. <span data-ttu-id="52933-129">оповещение об инциденте показывает Hello портал Azure в области hello с широкое влияние.</span><span class="sxs-lookup"><span data-stu-id="52933-129">hello Azure portal shows an alert about an incident in hello region with broad impact.</span></span>
3. <span data-ttu-id="52933-130">сервер базы данных SQL Azure Hello помечается как снижении.</span><span class="sxs-lookup"><span data-stu-id="52933-130">hello Azure SQL Database server is marked as degraded.</span></span>

<span data-ttu-id="52933-131">В зависимости от приложения отклонения toodowntime и возможных бизнеса ответственность разработчика можно рассмотреть следующие варианты восстановления hello.</span><span class="sxs-lookup"><span data-stu-id="52933-131">Depending on your application tolerance toodowntime and possible business liability you can consider hello following recovery options.</span></span>

<span data-ttu-id="52933-132">Используйте hello [получить Восстановимую базу данных](https://msdn.microsoft.com/library/dn800985.aspx) (*LastAvailableBackupDate*) последней точки восстановления, географически реплицированный tooget hello.</span><span class="sxs-lookup"><span data-stu-id="52933-132">Use hello [Get Recoverable Database](https://msdn.microsoft.com/library/dn800985.aspx) (*LastAvailableBackupDate*) tooget hello latest Geo-replicated restore point.</span></span>

## <a name="wait-for-service-recovery"></a><span data-ttu-id="52933-133">Ожидание восстановления служб</span><span class="sxs-lookup"><span data-stu-id="52933-133">Wait for service recovery</span></span>
<span data-ttu-id="52933-134">Hello Azure работают в тщательно toorestore доступность службы как быстро можно, но в зависимости от причины hello может занять несколько часов или дней.</span><span class="sxs-lookup"><span data-stu-id="52933-134">hello Azure teams work diligently toorestore service availability as quickly as possible but depending on hello root cause it can take hours or days.</span></span>  <span data-ttu-id="52933-135">Если ваше приложение может работать значительно увеличить время простоя может просто ожидать toocomplete восстановления hello.</span><span class="sxs-lookup"><span data-stu-id="52933-135">If your application can tolerate significant downtime you can simply wait for hello recovery toocomplete.</span></span> <span data-ttu-id="52933-136">В этом случае вам не нужно предпринимать какие-либо действия.</span><span class="sxs-lookup"><span data-stu-id="52933-136">In this case, no action on your part is required.</span></span> <span data-ttu-id="52933-137">Можно просмотреть текущее состояние службы hello на нашем [панель мониторинга работоспособности службы Azure](https://azure.microsoft.com/status/).</span><span class="sxs-lookup"><span data-stu-id="52933-137">You can see hello current service status on our [Azure Service Health Dashboard](https://azure.microsoft.com/status/).</span></span> <span data-ttu-id="52933-138">После восстановления hello hello области будут восстановлены доступности приложения.</span><span class="sxs-lookup"><span data-stu-id="52933-138">After hello recovery of hello region your application’s availability will be restored.</span></span>

## <a name="fail-over-toogeo-replicated-secondary-database"></a><span data-ttu-id="52933-139">При сбое toogeo реплицированной базы данных-получателя</span><span class="sxs-lookup"><span data-stu-id="52933-139">Fail over toogeo-replicated secondary database</span></span>
<span data-ttu-id="52933-140">Если простой в работе приложения может иметь последствия для вашего бизнеса, в приложении следует использовать геореплицируемые базы данных.</span><span class="sxs-lookup"><span data-stu-id="52933-140">If your application’s downtime can result in business liability you should be using geo-replicated database(s) in your application.</span></span> <span data-ttu-id="52933-141">Активируется hello приложения tooquickly восстановления доступности в другом регионе, в случае сбоя.</span><span class="sxs-lookup"><span data-stu-id="52933-141">It will enable hello application tooquickly restore availability in a different region in case of an outage.</span></span> <span data-ttu-id="52933-142">Узнайте, каким образом слишком[Настройка георепликации](sql-database-geo-replication-portal.md).</span><span class="sxs-lookup"><span data-stu-id="52933-142">Learn how too[configure geo-replication](sql-database-geo-replication-portal.md).</span></span>

<span data-ttu-id="52933-143">доступность toorestore hello баз данных, вы должны tooinitiate hello отработки отказа toohello георепликацией-получателя с помощью одного из методов hello поддерживается.</span><span class="sxs-lookup"><span data-stu-id="52933-143">toorestore availability of hello database(s) you need tooinitiate hello failover toohello geo-replicated secondary using one of hello supported methods.</span></span>

<span data-ttu-id="52933-144">Используйте один из hello следующие руководства toofail через tooa географическая репликация базы данных-получателя.</span><span class="sxs-lookup"><span data-stu-id="52933-144">Use one of hello following guides toofail over tooa geo-replicated secondary database:</span></span>

* [<span data-ttu-id="52933-145">При сбое tooa георепликацией-получателя с помощью портала Azure</span><span class="sxs-lookup"><span data-stu-id="52933-145">Fail over tooa geo-replicated secondary using Azure Portal</span></span>](sql-database-geo-replication-portal.md)
* [<span data-ttu-id="52933-146">Отработка отказа tooa георепликацией получателя с помощью PowerShell</span><span class="sxs-lookup"><span data-stu-id="52933-146">Fail over tooa geo-replicated secondary using PowerShell</span></span>](scripts/sql-database-setup-geodr-and-failover-database-powershell.md)
* [<span data-ttu-id="52933-147">При сбое tooa георепликацией-получателя с помощью T-SQL</span><span class="sxs-lookup"><span data-stu-id="52933-147">Fail over tooa geo-replicated secondary using T-SQL</span></span>](sql-database-geo-replication-transact-sql.md)

## <a name="recover-using-geo-restore"></a><span data-ttu-id="52933-148">Восстановление с использованием геовосстановления</span><span class="sxs-lookup"><span data-stu-id="52933-148">Recover using geo-restore</span></span>
<span data-ttu-id="52933-149">Если время простоя приложения не приводит к появлению ответственности бизнеса можно использовать [геовосстановление](sql-database-recovery-using-backups.md) как toorecover метод базам данных приложения.</span><span class="sxs-lookup"><span data-stu-id="52933-149">If your application’s downtime does not result in business liability you can use [geo-restore](sql-database-recovery-using-backups.md) as a method toorecover your application database(s).</span></span> <span data-ttu-id="52933-150">Он создает копию базы данных hello из последней резервной копии географически избыточной.</span><span class="sxs-lookup"><span data-stu-id="52933-150">It creates a copy of hello database from its latest geo-redundant backup.</span></span>

## <a name="configure-your-database-after-recovery"></a><span data-ttu-id="52933-151">Настройка базы данных после восстановления</span><span class="sxs-lookup"><span data-stu-id="52933-151">Configure your database after recovery</span></span>
<span data-ttu-id="52933-152">При использовании георепликации перехода на другой ресурс или toorecover географическое восстановление после сбоя, убедитесь в правильной настройке подключения hello toohello новых баз данных, чтобы функции hello обычного приложения может быть продолжено.</span><span class="sxs-lookup"><span data-stu-id="52933-152">If you are using either geo-replication failover or geo-restore toorecover from an outage, you must make sure that hello connectivity toohello new databases is properly configured so that hello normal application function can be resumed.</span></span> <span data-ttu-id="52933-153">Это приведен контрольный список задач tooget готовности рабочей восстановленной базы данных.</span><span class="sxs-lookup"><span data-stu-id="52933-153">This is a checklist of tasks tooget your recovered database production ready.</span></span>

### <a name="update-connection-strings"></a><span data-ttu-id="52933-154">Обновление строк подключения</span><span class="sxs-lookup"><span data-stu-id="52933-154">Update connection strings</span></span>
<span data-ttu-id="52933-155">Поскольку восстановленной базы данных будет находиться на другом сервере, вам потребуется tooupdate сервера toothat toopoint строка подключения вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="52933-155">Because your recovered database will reside in a different server, you need tooupdate your application’s connection string toopoint toothat server.</span></span>

<span data-ttu-id="52933-156">Дополнительные сведения об изменении строки соединения см. в разделе hello разработки соответствующий язык для вашего [библиотека подключения](sql-database-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="52933-156">For more information about changing connection strings, see hello appropriate development language for your [connection library](sql-database-libraries.md).</span></span>

### <a name="configure-firewall-rules"></a><span data-ttu-id="52933-157">Настройка правил брандмауэра</span><span class="sxs-lookup"><span data-stu-id="52933-157">Configure Firewall Rules</span></span>
<span data-ttu-id="52933-158">Необходимо убедиться, что hello настроить правила брандмауэра на сервере и на соответствие hello базы данных тех, которые были настроены на сервере-источнике hello и базы данных-источника toomake.</span><span class="sxs-lookup"><span data-stu-id="52933-158">You need toomake sure that hello firewall rules configured on server and on hello database match those that were configured on hello primary server and primary database.</span></span> <span data-ttu-id="52933-159">Дополнительные сведения см. в статье [Практическое руководство. Настройка параметров брандмауэра для Базы данных SQL](sql-database-configure-firewall-settings.md).</span><span class="sxs-lookup"><span data-stu-id="52933-159">For more information, see [How to: Configure Firewall Settings (Azure SQL Database)](sql-database-configure-firewall-settings.md).</span></span>

### <a name="configure-logins-and-database-users"></a><span data-ttu-id="52933-160">Настройка учетных данных и пользователей базы данных</span><span class="sxs-lookup"><span data-stu-id="52933-160">Configure logins and database users</span></span>
<span data-ttu-id="52933-161">Необходимо toomake том, что все имена входа hello, используемым в приложении находятся на сервере hello, где размещается восстановленной базы данных.</span><span class="sxs-lookup"><span data-stu-id="52933-161">You need toomake sure that all hello logins used by your application exist on hello server which is hosting your recovered database.</span></span> <span data-ttu-id="52933-162">Дополнительные сведения см. в статье [Настройка безопасности Базы данных SQL Azure и управление ею для геовосстановления или отработки отказа](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="52933-162">For more information, see [Security Configuration for geo-replication](sql-database-geo-replication-security-config.md).</span></span>

> [!NOTE]
> <span data-ttu-id="52933-163">Необходимо настроить и протестировать правила брандмауэра и имена для входа (и их разрешения) на сервере во время отработки аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="52933-163">You should configure and test your server firewall rules and logins (and their permissions) during a disaster recovery drill.</span></span> <span data-ttu-id="52933-164">Эти объекты уровня сервера и их конфигурации могут не быть доступны во время сбоя hello.</span><span class="sxs-lookup"><span data-stu-id="52933-164">These server-level objects and their configuration may not be available during hello outage.</span></span>
> 
> 

### <a name="setup-telemetry-alerts"></a><span data-ttu-id="52933-165">Настройка оповещений телеметрии</span><span class="sxs-lookup"><span data-stu-id="52933-165">Setup telemetry alerts</span></span>
<span data-ttu-id="52933-166">Необходимо toomake убедитесь, что существующие параметры правила оповещения обновленные toomap toohello восстановленной базы данных и hello другой сервер.</span><span class="sxs-lookup"><span data-stu-id="52933-166">You need toomake sure your existing alert rule settings are updated toomap toohello recovered database and hello different server.</span></span>

<span data-ttu-id="52933-167">Подробнее о правилах генерации оповещений базы данных см. в разделах [Получение уведомлений об оповещениях](../monitoring-and-diagnostics/insights-receive-alert-notifications.md) и [Получение информации о работоспособности службы](../monitoring-and-diagnostics/insights-service-health.md).</span><span class="sxs-lookup"><span data-stu-id="52933-167">For more information about database alert rules, see [Receive Alert Notifications](../monitoring-and-diagnostics/insights-receive-alert-notifications.md) and [Track Service Health](../monitoring-and-diagnostics/insights-service-health.md).</span></span>

### <a name="enable-auditing"></a><span data-ttu-id="52933-168">Включение аудита</span><span class="sxs-lookup"><span data-stu-id="52933-168">Enable auditing</span></span>
<span data-ttu-id="52933-169">Если аудит является обязательным tooaccess базы данных, необходимо tooenable аудит после восстановления базы данных hello.</span><span class="sxs-lookup"><span data-stu-id="52933-169">If auditing is required tooaccess your database, you need tooenable Auditing after hello database recovery.</span></span> <span data-ttu-id="52933-170">Дополнительные сведения см. в статье [Аудит базы данных](sql-database-auditing.md).</span><span class="sxs-lookup"><span data-stu-id="52933-170">For more information, see [Database auditing](sql-database-auditing.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="52933-171">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="52933-171">Next steps</span></span>
* <span data-ttu-id="52933-172">toolearn о резервных копиях автоматических базы данных SQL Azure, в разделе [базы данных SQL автоматическое резервное копирование](sql-database-automated-backups.md)</span><span class="sxs-lookup"><span data-stu-id="52933-172">toolearn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md)</span></span>
* <span data-ttu-id="52933-173">toolearn о сценариев разработки и восстановления непрерывности бизнеса, в разделе [сценариев непрерывности](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="52933-173">toolearn about business continuity design and recovery scenarios, see [Continuity scenarios](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="52933-174">toolearn об использовании автоматического создания резервных копий для восстановления, в разделе [восстановление базы данных из резервных копий, инициируемых службой hello](sql-database-recovery-using-backups.md)</span><span class="sxs-lookup"><span data-stu-id="52933-174">toolearn about using automated backups for recovery, see [restore a database from hello service-initiated backups](sql-database-recovery-using-backups.md)</span></span>

