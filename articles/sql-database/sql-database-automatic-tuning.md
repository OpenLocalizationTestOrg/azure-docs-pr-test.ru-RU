---
title: "Автоматическая настройка базы данных SQL | Документация Майкрософт"
description: "База данных SQL анализирует SQL-запрос и автоматически подстраивается под рабочую нагрузку пользователей."
services: sql-database
documentationcenter: 
author: jovanpop-msft
manager: jhubbard
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/05/2017
ms.author: jovanpop
ms.openlocfilehash: f5552793db2d89542782b7d9e8f996314f62e429
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="automatic-tuning"></a><span data-ttu-id="c5528-103">Автоматическая настройка</span><span class="sxs-lookup"><span data-stu-id="c5528-103">Automatic tuning</span></span>

<span data-ttu-id="c5528-104">База данных SQL Azure — это полностью управляемая служба данных, которая отслеживает запросы, выполняемые в базе данных и может автоматически повышать производительность рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="c5528-104">Azure SQL Database is a fully managed data service that monitors the queries that are executed on the database and can automatically improve performance of the workload.</span></span> <span data-ttu-id="c5528-105">База данных SQL Azure имеет встроенный механизм, который может автоматически настраивать и повышать производительность запросов путем динамической адаптации базы данных к рабочей нагрузке.</span><span class="sxs-lookup"><span data-stu-id="c5528-105">Azure SQL Database has a built-in intelligence mechanism that can automatically tune and improve performance of your queries by dynamically adapting the database to your workload.</span></span> <span data-ttu-id="c5528-106">Автоматическая настройка в базе данных SQL Azure может быть одной из самых важных функций, которые можно включить в базе данных SQL Azure для оптимизации производительности запросов.</span><span class="sxs-lookup"><span data-stu-id="c5528-106">Automatic tuning in Azure SQL Database might be one of the most important features that you can enable on Azure SQL Database to optimize performance of your queries.</span></span>

<span data-ttu-id="c5528-107">Инструкции о том, как включить автоматическую настройку с помощью портала Azure, см. в [этой статье](sql-database-automatic-tuning-enable.md).</span><span class="sxs-lookup"><span data-stu-id="c5528-107">See this article for the steps to [enable automatic tuning](sql-database-automatic-tuning-enable.md) using the Azure portal.</span></span>

## <a name="why-automatic-tuning"></a><span data-ttu-id="c5528-108">Почему автоматическая настройка</span><span class="sxs-lookup"><span data-stu-id="c5528-108">Why automatic tuning?</span></span>

<span data-ttu-id="c5528-109">Одна из основных задач при администрировании классической базы данных — это мониторинг рабочей нагрузки, определение важных запросов SQL, индексов, которые нужно добавить для повышения производительности и редко используемых индексов.</span><span class="sxs-lookup"><span data-stu-id="c5528-109">One of the main tasks in classic database administration is monitoring the workload, identifying critical SQL queries, indexes that should be added to improve performance, and rarely used indexes.</span></span> <span data-ttu-id="c5528-110">База данных SQL Azure обеспечивает точное представление о запросах и индексах, которые необходимо отслеживать.</span><span class="sxs-lookup"><span data-stu-id="c5528-110">Azure SQL Database provides detailed insight into the queries and indexes that you need to monitor.</span></span> <span data-ttu-id="c5528-111">Однако постоянный мониторинг базы данных — это сложная и трудоемкая задача, особенно при работе с несколькими базами данных.</span><span class="sxs-lookup"><span data-stu-id="c5528-111">However, constantly monitoring database is a hard and tedious task, especially when dealing with many databases.</span></span> <span data-ttu-id="c5528-112">Эффективное управление огромным числом баз данных невозможно даже с учетом всех доступных средств и отчетов, предоставленных базой данных SQL Azure и порталом Azure.</span><span class="sxs-lookup"><span data-stu-id="c5528-112">Managing a huge number of databases might be impossible to do efficiently even with all available tools and reports that Azure SQL Database and Azure portal provide.</span></span> <span data-ttu-id="c5528-113">Вместо того чтобы вручную выполнять мониторинг и настройку базы данных, мы рекомендуем делегировать некоторые действия по настройке и мониторингу базе данных SQL Azure с помощью автоматической функции настройки.</span><span class="sxs-lookup"><span data-stu-id="c5528-113">Instead of monitoring and tuning your database manually, you might consider delegating some of the monitoring and tuning actions to Azure SQL Database using automatic tuning feature.</span></span> 


> [!VIDEO https://channel9.msdn.com/Blogs/Azure-in-the-Enterprise/Enabling-Azure-SQL-Database-Auto-Tuning-at-Scale-for-Microsoft-IT/player]
>

## <a name="how-does-automatic-tuning-work"></a><span data-ttu-id="c5528-114">Как работает автоматическая настройка</span><span class="sxs-lookup"><span data-stu-id="c5528-114">How does automatic tuning work?</span></span>

<span data-ttu-id="c5528-115">В базе данных SQL Azure есть процессы непрерывного мониторинга производительности и анализа, которые постоянно отслеживают характеристики рабочей нагрузки, а также определяют потенциальные проблемы и возможные улучшения.</span><span class="sxs-lookup"><span data-stu-id="c5528-115">Azure SQL Database has a continuous performance monitoring and analysis process that constantly learns about the characteristic of your workload and identify potential issues and improvements.</span></span>

![Процесс автоматической настройки](./media/sql-database-automatic-tuning/tuning-process.png)

<span data-ttu-id="c5528-117">Этот процесс позволяет базе данных SQL Azure динамически адаптироваться к рабочей нагрузке, находя индексы и планы, которые могут способствовать повышению производительности рабочей нагрузки, а также индексы, влияющие на рабочую нагрузку.</span><span class="sxs-lookup"><span data-stu-id="c5528-117">This process enables Azure SQL Database to dynamically adapt to your workload by finding what indexes and plans might improve performance of your workloads and what indexes affect your workloads.</span></span> <span data-ttu-id="c5528-118">На основании этих данных автоматическая настройка применяет действия по настройке производительности при рабочей нагрузке.</span><span class="sxs-lookup"><span data-stu-id="c5528-118">Based on these findings, automatic tuning applies tuning actions that improve performance of your workload.</span></span> <span data-ttu-id="c5528-119">Кроме того, база данных SQL Azure постоянно отслеживает производительность после любых изменений, внесенных автоматической настройкой, чтобы убедиться в том, что они повышают производительность рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="c5528-119">In addition, Azure SQL Database continuously monitors performance after any change made by automatic tuning to ensure that it improves performance of your workload.</span></span> <span data-ttu-id="c5528-120">Любое действие, которое не повысило производительность, автоматически отменяется.</span><span class="sxs-lookup"><span data-stu-id="c5528-120">Any action that didn’t improve performance is automatically reverted.</span></span> <span data-ttu-id="c5528-121">Процесс проверки является ключевой возможностью, которая гарантирует, что любые изменения, сделанные автоматической настройкой, не приведут к снижению производительности рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="c5528-121">This verification process is a key feature that ensures that any change made by automatic tuning does not decrease the performance of your workload.</span></span>

<span data-ttu-id="c5528-122">В базе данных SQL Azure есть две функции автоматической настройки:</span><span class="sxs-lookup"><span data-stu-id="c5528-122">There are two automatic tuning aspects that are available in Azure SQL Database:</span></span>

 -  <span data-ttu-id="c5528-123">**Автоматическое управление индексами**: определяет индексы, которые необходимо добавить в базу данных или удалить.</span><span class="sxs-lookup"><span data-stu-id="c5528-123">**Automatic index management** that identifies indexes that should be added in your database, and indexes that should be removed.</span></span>
 -  <span data-ttu-id="c5528-124">**Автоматическое изменение плана**: определяет проблемные планы и исправляет проблемы производительности плана SQL (ожидается в ближайшее время, уже доступна в SQL Server 2017).</span><span class="sxs-lookup"><span data-stu-id="c5528-124">**Automatic plan correction** (coming soon, already available in SQL Server 2017) that identifies problematic plans and fixes SQL plan performance problems.</span></span>

## <a name="automatic-index-management"></a><span data-ttu-id="c5528-125">Автоматическое управление индексами</span><span class="sxs-lookup"><span data-stu-id="c5528-125">Automatic index management</span></span>

<span data-ttu-id="c5528-126">В базе данных SQL Azure управлять индексами легко, так как база данных SQL Azure отслеживает рабочую нагрузку и всегда обеспечивает оптимальную индексацию данных.</span><span class="sxs-lookup"><span data-stu-id="c5528-126">In Azure SQL Database, index management is easy because Azure SQL Database learns about your workload and ensures that your data is always optimally indexed.</span></span> <span data-ttu-id="c5528-127">Правильное проектирование индекса имеет решающее значение для обеспечения оптимальной производительности при рабочей нагрузке. Автоматическое управление индексами поможет оптимизировать их.</span><span class="sxs-lookup"><span data-stu-id="c5528-127">Proper index design is crucial for optimal performance of your workload, and automatic index management can help you optimize your indexes.</span></span> <span data-ttu-id="c5528-128">Автоматическое управление индексами может как устранять проблемы с производительностью в неправильно индексированных базах данных, так и поддерживать и оптимизировать индексы в существующей схеме базы данных.</span><span class="sxs-lookup"><span data-stu-id="c5528-128">Automatic index management can either fix performance issues in incorrectly indexed databases, or maintain and improve indexes on the existing database schema.</span></span> 

### <a name="why-do-you-need-index-management"></a><span data-ttu-id="c5528-129">Для чего необходимо управление индексами</span><span class="sxs-lookup"><span data-stu-id="c5528-129">Why do you need index management?</span></span>

<span data-ttu-id="c5528-130">Индексы ускоряют некоторые запросы на чтение данных из таблиц. Тем не менее, они могут снизить производительность запросов, используемых для обновления данных.</span><span class="sxs-lookup"><span data-stu-id="c5528-130">Indexes speed up some of your queries that read data from the tables; however, they can slow down the queries that update data.</span></span> <span data-ttu-id="c5528-131">Необходимо тщательно проанализировать необходимость создания индекса и какие столбцы нужно включать в него.</span><span class="sxs-lookup"><span data-stu-id="c5528-131">You need to carefully analyze when to create an index and what columns you need to include in the index.</span></span> <span data-ttu-id="c5528-132">Некоторые индексы могут оказаться ненужными через некоторое время.</span><span class="sxs-lookup"><span data-stu-id="c5528-132">Some indexes might not be needed after some time.</span></span> <span data-ttu-id="c5528-133">Таким образом, необходимо периодически определять индексы, которые не приносят никаких преимуществ, и удалять их.</span><span class="sxs-lookup"><span data-stu-id="c5528-133">Therefore, you would need to periodically identify and drop the indexes that do not bring any benefits.</span></span> <span data-ttu-id="c5528-134">Если вы будете игнорировать неиспользуемые индексы, производительность запросов, которые обновляют данные может уменьшиться без каких-либо преимуществ для запросов, которые считывают данные.</span><span class="sxs-lookup"><span data-stu-id="c5528-134">If you ignore the unused indexes, performance of the queries that update data would be decreased without any benefit on the queries that read data.</span></span> <span data-ttu-id="c5528-135">Неиспользуемые индексы также влияют на общую производительность системы, так как дополнительные обновления требуют ненужного ведения журнала.</span><span class="sxs-lookup"><span data-stu-id="c5528-135">Unused indexes also affect overall performance of the system because additional updates require unnecessary logging.</span></span>

<span data-ttu-id="c5528-136">Поиск оптимального набора индексов, повышающего производительность запросов, которые считывают данные из таблиц и оказывают минимальное влияние на обновления, может потребовать непрерывного и сложного анализа.</span><span class="sxs-lookup"><span data-stu-id="c5528-136">Finding the optimal set of indexes that improve performance of the queries that read data from your tables and have minimal impact on updates might require continuous and complex analysis.</span></span>

<span data-ttu-id="c5528-137">База данных SQL Azure использует встроенную аналитику и расширенные фильтры, которые анализируют запросы, определяют индексы, которые оптимально подходили бы для вашей текущей рабочей нагрузки, а также индексы, которые можно удалить.</span><span class="sxs-lookup"><span data-stu-id="c5528-137">Azure SQL Database uses built-in intelligence and advanced rules that analyze your queries, identify indexes that would be optimal for your current workloads, and the indexes might be removed.</span></span> <span data-ttu-id="c5528-138">База данных Azure SQL гарантирует, что у вас есть минимально необходимый набор индексов, оптимизирующих запросы, которые считывают данные, с минимальным воздействием на другие запросы.</span><span class="sxs-lookup"><span data-stu-id="c5528-138">Azure SQL Database ensures that you have a minimal necessary set of indexes that optimize the queries that read data, with the minimized impact on the other queries.</span></span>

### <a name="how-to-identify-indexes-that-need-to-be-changed-in-your-database"></a><span data-ttu-id="c5528-139">Как определить в базе данных индексы, которые необходимо изменить</span><span class="sxs-lookup"><span data-stu-id="c5528-139">How to identify indexes that need to be changed in your database?</span></span>

<span data-ttu-id="c5528-140">База данных SQL Azure упрощает процесс управления индексами.</span><span class="sxs-lookup"><span data-stu-id="c5528-140">Azure SQL Database makes index management process easy.</span></span> <span data-ttu-id="c5528-141">Вместо трудоемкого процесса анализа рабочей нагрузки вручную и мониторинга индекса, база данных SQL Azure анализирует рабочую нагрузку, определяет запросы, которые могут выполняться быстрее с новым индексом, а также неиспользуемые или повторяющиеся индексы.</span><span class="sxs-lookup"><span data-stu-id="c5528-141">Instead of the tedious process of manual workload analysis and index monitoring, Azure SQL Database analyzes your workload, identifies the queries that could be executed faster with a new index, and identifies unused or duplicated indexes.</span></span> <span data-ttu-id="c5528-142">Дополнительные сведения об идентификации индексов, которые необходимо изменить, см. в статье [Использование помощника по базам данных SQL на портале Azure](sql-database-advisor-portal.md).</span><span class="sxs-lookup"><span data-stu-id="c5528-142">Find more information about identification of indexes that should be changed at [Find index recommendations in Azure portal](sql-database-advisor-portal.md).</span></span>

### <a name="automatic-index-management-considerations"></a><span data-ttu-id="c5528-143">Рекомендации по автоматическому управлению индексами</span><span class="sxs-lookup"><span data-stu-id="c5528-143">Automatic index management considerations</span></span>

<span data-ttu-id="c5528-144">Если обнаружится, что встроенные правила повышают производительность базы данных, можно разрешить базе данных SQL Azure автоматически управлять индексами.</span><span class="sxs-lookup"><span data-stu-id="c5528-144">If you find that the built-in rules improve the performance of your database, you might let Azure SQL database automatically manage your indexes.</span></span>

<span data-ttu-id="c5528-145">Действия, которые нужны для создания необходимых индексов в базах данных SQL Azure, могут потреблять ресурсы и временно повлиять на производительность рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="c5528-145">Actions required to create necessary indexes in Azure SQL Databases might consume resources and temporally affect workload performance.</span></span> <span data-ttu-id="c5528-146">Чтобы свести влияние процесса создания индекса на производительность при рабочей нагрузке к минимуму, база данных SQL Azure находит соответствующее временное окно для любой операции управления индексом.</span><span class="sxs-lookup"><span data-stu-id="c5528-146">To minimize the impact of index creation on workload performance, Azure SQL Database finds the appropriate time window for any index management operation.</span></span> <span data-ttu-id="c5528-147">Действия по настройке будут отложены, если базе данных необходимы ресурсы для выполнения рабочей нагрузки, и запустятся, когда у базы данных будет достаточно неиспользуемых ресурсов, которые могут использоваться для задач обслуживания.</span><span class="sxs-lookup"><span data-stu-id="c5528-147">Tuning action is postponed if the database needs resources to execute your workload, and started when the database has enough unused resources that can be used for the maintenance task.</span></span> <span data-ttu-id="c5528-148">Одна из важных функций автоматического управления индексами — это проверка действий.</span><span class="sxs-lookup"><span data-stu-id="c5528-148">One important feature in automatic index management is a verification of the actions.</span></span> <span data-ttu-id="c5528-149">Если база данных SQL Azure создает или удаляет индекс, процесс мониторинга анализирует производительность при рабочей нагрузке, чтобы убедиться, что производительность действительно улучшилась.</span><span class="sxs-lookup"><span data-stu-id="c5528-149">When Azure SQL Database creates or drops index, a monitoring process analyzes performance of your workload to verify that the action improved the performance.</span></span> <span data-ttu-id="c5528-150">Если действие не привело к значительным улучшениям, оно немедленно отменяется.</span><span class="sxs-lookup"><span data-stu-id="c5528-150">If it didn’t bring significant improvement – the action is immediately reverted.</span></span> <span data-ttu-id="c5528-151">Таким образом, база данных SQL Azure гарантирует, что автоматические действия не снижают производительность при рабочей нагрузке.</span><span class="sxs-lookup"><span data-stu-id="c5528-151">This way, Azure SQL Database ensures that automatic actions do not negatively impact performance of your workload.</span></span> <span data-ttu-id="c5528-152">Индексы, созданные автоматической настройкой, прозрачны для операции обслуживания в базовой схеме.</span><span class="sxs-lookup"><span data-stu-id="c5528-152">Indexes created by automatic tuning are transparent for the maintenance operation on the underlying schema.</span></span> <span data-ttu-id="c5528-153">Изменения схемы, например удаление или переименование столбцов, не блокируются при наличии автоматически созданных индексов.</span><span class="sxs-lookup"><span data-stu-id="c5528-153">Schema changes such as dropping or renaming columns are not blocked by the presence of automatically created indexes.</span></span> <span data-ttu-id="c5528-154">Индексы, которые были автоматически созданы базой данных SQL Azure, немедленно удаляются при удалении связанных таблиц или столбцов.</span><span class="sxs-lookup"><span data-stu-id="c5528-154">Indexes that are automatically created by Azure SQL Database are immediately dropped when related table or columns is dropped.</span></span>

## <a name="automatic-plan-choice-correction"></a><span data-ttu-id="c5528-155">Автоматическое исправление выбора плана</span><span class="sxs-lookup"><span data-stu-id="c5528-155">Automatic plan choice correction</span></span>

<span data-ttu-id="c5528-156">Автоматическое исправление плана — это новая функция автоматической настройки, добавленная в SQL Server 2017 CTP 2.0, которая определяет неправильное поведение планов SQL.</span><span class="sxs-lookup"><span data-stu-id="c5528-156">Automatic plan correction is a new automatic tuning feature added in SQL Server 2017 CTP2.0 that identifies SQL plans that misbehave.</span></span> <span data-ttu-id="c5528-157">Функция автоматической настройки будет добавлена в ближайшее время в базе данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="c5528-157">This automatic tuning option is coming soon on Azure SQL Database.</span></span> <span data-ttu-id="c5528-158">Дополнительные сведения см.в статье [Автоматическая настройка](https://docs.microsoft.com/sql/relational-databases/automatic-tuning/automatic-tuning).</span><span class="sxs-lookup"><span data-stu-id="c5528-158">Find more information at [Automatic tuning in SQL Server 2017](https://docs.microsoft.com/sql/relational-databases/automatic-tuning/automatic-tuning).</span></span>

## <a name="next-steps"></a><span data-ttu-id="c5528-159">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="c5528-159">Next steps</span></span>

- <span data-ttu-id="c5528-160">Дополнительные сведения о том, как включить автоматическую настройку в Базе данных SQL Azure и позволить ей полностью управлять рабочей нагрузкой, см. в [этой статье](sql-database-automatic-tuning-enable.md).</span><span class="sxs-lookup"><span data-stu-id="c5528-160">To enable automatic tuning in Azure SQL Database and let automatic tuning feature fully manage your workload, see [Enable automatic tuning](sql-database-automatic-tuning-enable.md).</span></span>
- <span data-ttu-id="c5528-161">Дополнительные сведения о ручной настройке для повышения производительности запросов см. в статье [Использование помощника по базам данных SQL на портале Azure](sql-database-advisor-portal.md).</span><span class="sxs-lookup"><span data-stu-id="c5528-161">To use manual tuning, you can review [Tuning recommendations in Azure portal](sql-database-advisor-portal.md) and manually apply the ones that improve performance of your queries.</span></span>
