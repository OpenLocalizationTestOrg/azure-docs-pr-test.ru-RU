---
title: "решения аварийного восстановления aaaDesign - базы данных SQL Azure | Документы Microsoft"
description: "Узнайте, как toodesign облачные решения для аварийного восстановления, выбрав шаблон hello правой отработки отказа."
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 2db99057-0c79-4fb0-a7f1-d1c057ec787f
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/07/2017
ms.author: sashan;carlrab
ms.openlocfilehash: 9d9eca7570c7a01c992d0b33d449721709b471c3
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="disaster-recovery-strategies-for-applications-using-sql-database-elastic-pools"></a>Стратегии аварийного восстановления для приложений с использованием пула эластичных баз данных SQL
Hello лет мы узнали, что облачные службы не гарантирует полную надежность и произойти Неустранимая инцидентов. База данных SQL предоставляет несколько возможностей tooprovide для обеспечения непрерывности бизнеса hello приложения при возникновении этих инцидентов. [Эластичные пулы](sql-database-elastic-pool.md) и одной базы данных поддерживают hello одинаковые возможности аварийного восстановления. В этой статье представлены несколько стратегий аварийного восстановления для пулов эластичных БД, в которых используются функции обеспечения непрерывности бизнес-процессов базы данных SQL.

В этой статье используется hello следующие канонические шаблон приложения SaaS независимого поставщика программных Продуктов:

<i>Современных облачных веб-приложение передает одну базу данных SQL для каждого конечного пользователя. Hello ISV имеет большое количество клиентов и таким образом, используя несколько баз данных, известных как базы данных клиента. Поскольку базы данных клиента hello обычно имеют шаблоны непредсказуемое действие, hello ISV использует эластичного пула toomake hello базы данных цену очень прогнозируемого долгое время. Hello эластичного пула также упрощает управление производительностью hello время пиковых hello активности пользователей. В дополнение к этому приложения hello toohello клиента базы данных также использует несколько баз данных профилей пользователей toomanage, безопасности, собирать статистические характеристики интенсивности использования и т. д. Доступность hello отдельных клиентов не влияет на доступность приложения hello в целом. Однако hello доступностью и производительностью баз данных управления критическая для работы приложения hello и если базы данных управления hello всего приложения hello вне сети находится в автономном режиме.</i>  

В этой статье описываются стратегии аварийного восстановления, охватывают широкий спектр возможностей из tooones стоимость конфиденциальные запуска приложений, с требованиями строгой доступности.

## <a name="scenario-1-cost-sensitive-startup"></a>Сценарий 1. Приложения с ограниченным бюджетом
<i>В этом сценарии рассматривается недавно созданная компания с ограниченным бюджетом.  Я хочу toosimplify развертывания и управления ими приложения hello и возникают ограниченный соглашения об уровне ОБСЛУЖИВАНИЯ для отдельных клиентов. Однако требуется приложение hello tooensure как единое целое никогда не находится в автономном режиме.</i>

требование простоты toosatisfy hello, развертывание базы данных для всех клиентов в один эластичного пула в регионе Azure по своему усмотрению hello и развертывание баз данных управления как георепликацией одной базы данных. Для аварийного восстановления hello клиентов используйте геовосстановление, которая расположена без дополнительных затрат. доступность hello tooensure hello баз данных управления, репликации, их область tooanother, используя группу автоматического перехода на другой ресурс (в предварительного просмотра) (шаг 1). Hello текущей конфигурации hello аварийного восстановления, в этом случае обходится равно toohello стоимость hello баз данных-получателей. Эта конфигурация показана на следующей схеме hello.

![На рисунке 1](./media/sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool/diagram-1.png)

В случае сбоя в основном регионе hello hello toobring действия восстановления hello на следующей диаграмме показаны приложение в оперативный режим.

* Hello отработки отказа группой инициирует автоматический переход области аварийного восстановления toohello базы данных управления hello. приложение Hello автоматически повторно подключенный toohello новый основной и все новые учетные записи и базами данных клиента создаются в области hello аварийного восстановления. существующие заказчики Hello просматривать свои данные временно недоступны.
* Создать эластичный пул hello с hello же конфигурации, что исходный пул hello (2).
* Используйте toocreate географическое восстановление копии базы данных клиента hello (3). Можно рассмотрите возможность запуска восстановление отдельных hello соединениями hello конечным пользователем или некоторые другие схемы приоритет конкретного приложения.


На этом этапе приложение вновь подключен к сети в регионе hello аварийного восстановления, но некоторые клиенты задержка при доступе к их данным.

![На рис. 2](./media/sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool/diagram-2.png)

В случае временного сбоя hello возможна основного региона, hello восстанавливаются по Azure перед завершены все операции восстановления базы данных hello в регионе hello аварийного восстановления. В этом случае управлять скользящего hello приложения задней toohello первичного региона. Hello занимает hello шаги показаны на следующей схеме hello.

* Отмена всех ожидающих запросов на геовосстановление.   
* При сбое hello управления базами данных toohello основной регион (5). После восстановления области hello hello в источниках старого автоматически стали баз данных-получателей. Теперь они снова поменяются ролями. 
* Измените приложение hello соединения строки toopoint задней toohello первичный регион. Теперь в основном регионе hello создаются все новые учетные записи и базами данных клиента. Для некоторых клиентов данные будут временно недоступными.   
* Набор всех баз данных в hello DR пула только для tooread tooensure, их нельзя изменить в области hello аварийного восстановления (6). 
* Для каждой базы данных в пул аварийного восстановления, который был изменен с момента восстановления hello hello переименовать или удалить hello соответствующих баз данных в пуле основной hello (7). 
* Копировать hello обновление баз данных из hello DR пула toohello основного пула (8). 
* Удаление пула hello аварийного восстановления (9)

На этом этапе приложение находится в сети в основной регион hello со всех клиентов баз данных, доступных в hello основного пула.

![Рис. 3](./media/sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool/diagram-3.png)

ключ Hello **преимущества** этой стратегии отличается низкой стоимостью текущего уровня избыточности данных. Резервные копии создаются автоматически по hello служба базы данных SQL с без перезаписи приложения и без дополнительных затрат.  только в том случае, когда hello эластичной базы данных восстанавливаются связано с дополнительными затратами Hello. Hello **компромисс** затрачивается значительное время hello завершить восстановление всех баз данных клиента. Hello время зависит от hello допустимое количество восстановление инициировать в hello аварийного восстановления области и общего объема hello клиента базы данных. Даже если некоторые клиенты восстановление приоритет над другими, конкурировать с hello все другие необходимые восстановления, запущенных в hello же регионе, как служба hello управляет и регулирует toominimize hello общее влияние на заказчиков hello существующей базы данных. Кроме того hello восстановление баз данных клиента hello запуск будет невозможен до создается новый эластичный пул hello в регионе аварийного восстановления hello.

## <a name="scenario-2-mature-application-with-tiered-service"></a>Сценарий 2. Отлаженное приложение с многоуровневой службой
<i>В этом сценарии рассматривается готовое приложение SaaS с многоуровневыми службами и разными соглашениями об уровне обслуживания для пользователей бесплатной пробной версии и пользователей платной версии. Для пробной версии клиентов hello у меня есть hello tooreduce затрат, насколько возможно. Пользователи пробной версии может занять время простоя, но требуется tooreduce по вероятности. Для hello клиенты-плательщики простоев представляет угрозу рейса. Поэтому требуется, чтобы убедиться, что клиенты-плательщики всегда имеют доступ tooaccess toomake свои данные.</i> 

toosupport в этом сценарии отдельные hello пробные клиенты из платных клиентов путем помещения их в отдельных пулах эластичных БД. Hello пробной клиенты имеют нижний eDTU на клиент и нижней соглашения об уровне ОБСЛУЖИВАНИЯ с больше времени восстановления. Клиенты-плательщики Hello находятся в пул с более высоким eDTU на клиент и выше соглашение об уровне ОБСЛУЖИВАНИЯ. tooguarantee hello наименьшее время восстановления базы данных клиента hello клиенты-плательщики географически реплицируются. Эта конфигурация показана на следующей схеме hello. 

![Рис. 4](./media/sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool/diagram-4.png)

Как и первый сценарий hello баз данных управления hello активны довольно, использовать одну базу данных георепликацией для него (1). Это гарантирует hello прогнозируемую производительность для новых подписок клиента, профиль обновления и другие операции управления. Hello регион, в которой находятся в источниках hello баз данных управления hello является основной регион hello и hello регион, в котором находятся базы данных-получатели hello баз данных управления hello — регион, hello аварийного восстановления.

Hello реальную прибыль клиента базы данных имеют активных баз данных в hello «платная» Подготовка в основном регионе hello пула. Подготовьте дополнительный пул с hello точно такое же имя в области hello аварийного восстановления. Каждый клиент — дополнительный пул георепликацией toohello (2). Это позволит ускорить восстановление всех баз данных клиента с применением отработки отказа. 

В случае сбоя в основном регионе hello hello приложение в оперативный режим проиллюстрированы в следующей диаграмме hello toobring действия восстановления:

![Рис. 5](./media/sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool/diagram-5.png)

* Выход из строя над областью hello управления базами данных toohello аварийного восстановления (3).
* Измените регион строка toopoint toohello аварийного восстановления для приложения hello соединения. Теперь в регионе аварийного восстановления hello создаются все новые учетные записи и базами данных клиента. существующие заказчики пробной Hello просматривать свои данные временно недоступны.
* Отработка отказа hello платная пула toohello баз данных клиента в область tooimmediately hello аварийного восстановления восстановите их доступность (4). Поскольку отработки отказа hello изменение уровня быстрого метаданных, рассмотрите возможность оптимизации которой запускается hello отдельных переход на другой ресурс по требованию соединениями hello для конечных пользователей. 
* Если размер eDTU пула получателей было меньше, чем основной hello hello баз данных-получателей только необходимые hello tooprocess hello Изменение емкости заносит в журнал при они были баз данных-получателей, немедленно увеличения емкости пула hello теперь tooaccommodate hello полной Рабочая нагрузка всех клиентов (5). 
* Создайте новый эластичный пул hello с hello совпадают имя и hello же конфигурации в регионе hello аварийного восстановления баз данных заказчиков hello пробной (6). 
* После создания пула hello пробной клиентов используйте toorestore hello географическое восстановление отдельных пробной версии клиента-баз данных в новый пул hello (7). Попробуйте активации восстановление отдельных hello соединениями hello конечным пользователем или с помощью некоторых другая схема приоритет конкретного приложения.

На этом этапе приложение будет включен в регионе аварийного восстановления hello. Все клиенты-плательщики имеют доступ tootheir данных во время пробной клиентов hello задержка при доступе к их данным.

Когда восстанавливаются hello первичного региона по Azure *после* восстановления приложения hello в регионе hello аварийного восстановления, можно продолжить выполнение приложения hello в этом регионе или определить основной регион toofail toohello назад. Если восстанавливается первичный регион hello *перед* завершения процесса отработки отказа hello, рассмотрите возможность сбоя назад прямо сейчас. Восстановление после сбоя Hello выполняет действия hello, представленный на следующей диаграмме hello. 

![Рис. 6](./media/sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool/diagram-6.png)

* Отмена всех ожидающих запросов на геовосстановление.   
* Переключение баз данных управления hello (8). После восстановления области hello hello старая первичная автоматически станет hello получателей. Теперь он становится hello основной еще раз.  
* При сбое hello оплачена базы данных клиента (9). Аналогичным образом после восстановления области hello hello в источниках старого автоматически станет hello баз данных-получателей. Теперь они становятся первичные цвета hello еще раз. 
* Набор hello восстановить пробной версии базы данных, которые были изменены в регионе аварийного восстановления hello tooread (10).
* Для каждой базы данных в пуле аварийного восстановления пользователи пробной версии hello, измененных с момента восстановления hello переименуйте или удалите соответствующую базу данных hello в hello пробной клиентов основного пула (11). 
* Копировать hello обновление баз данных из hello DR пула toohello основного пула (12). 
* Удаление пула hello аварийного восстановления (13) 

> [!NOTE]
> режим отработки отказа Hello является асинхронным. время восстановления toominimize hello, очень важно выполнять команда отработки отказа баз данных клиента hello в пакеты по крайней мере 20 баз данных. 
> 
> 

ключ Hello **преимущества** всего эта стратегия заключается в обеспечении hello наибольший соглашения об уровне ОБСЛУЖИВАНИЯ для клиенты-плательщики hello. Он также гарантирует, что новый пробные версии hello разблокированы, как только создан hello пробной пула аварийного восстановления. Hello **компромисс** носителем, эта настройка hello совокупную стоимость hello базами данных клиента по стоимости hello hello получателей пула аварийного восстановления для оплачивается клиентов. Кроме того Если в пуле получателей hello другого размера, клиенты-плательщики hello производительности ниже после отработки отказа до hello пула в регионе hello DR завершения обновления. 

## <a name="scenario-3-geographically-distributed-application-with-tiered-service"></a>Сценарий 3. Географически распределенное приложение с многоуровневой службой
<i>В этом сценарии рассматривается готовое приложение SaaS с многоуровневыми службами. Я требуется toooffer очень активно toomy соглашения об уровне ОБСЛУЖИВАНИЯ платная клиентов и свести к минимуму риск hello влияние при возникновении сбоев, так как даже краткие прерывания в работе может привести к неудовлетворенности клиентов. Очень важно, что hello, что клиенты-плательщики всегда иметь доступ к данным. бесплатные пробные версии Hello и соглашения об уровне ОБСЛУЖИВАНИЯ не будет предлагаться в течение пробного периода hello.</i> 

toosupport этот сценарий, используйте три отдельных пулах эластичных БД. Подготовка к работе два одинакового размера пула с высокой число Edtu на базу данных в двух разных регионах toocontain hello платные клиентов базами данных клиента. Hello третий пул, содержащий hello пробные клиенты могут иметь ниже число Edtu на базу данных и инициализировать в одном из двух областей hello.

tooguarantee hello наименьшее время восстановления во время простоев, базами данных клиента hello клиенты-плательщики географически реплицируются с 50% hello баз данных-источников в каждой из областей hello двух. Аналогичным образом в каждом регионе имеются 50% hello баз данных-получателей. Таким образом, если область находится вне сети, только 50% hello платная баз данных клиентов затронуто и имели toofail. Hello других баз данных остаются неизменными. Эта конфигурация проиллюстрирован в hello, следующая схема:

![Рис. 4](./media/sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool/diagram-7.png)

Как в предыдущих сценариях hello, довольно активны баз данных управления hello таким образом настройте их в одной географической репликации баз данных (1). Это обеспечит прогнозируемую производительность hello hello новые подписки клиента, обновление профиля и другие операции управления. Областью является hello основной регион для баз данных управления hello и hello регион B используется для восстановления баз данных управления hello.

базы данных клиента Hello клиенты-плательщики также географически реплицируются, но с источников и баз данных-получателей, распределенный между областью и регион B (2). Таким образом, hello основной базы данных клиента затронут hello сбоя при сбое toohello другим областям и становятся доступными. Здравствуйте, другие половины hello базами данных клиента не влияет на всех. 

Hello на следующей диаграмме показано tootake действия восстановления hello, в случае сбоя в регионе, а.

![Рис. 5](./media/sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool/diagram-8.png)

* Немедленно при сбое tooregion баз данных управления hello B (3).
* Изменить приложение hello соединения строки toopoint toohello управления базы данных в области б. Изменение hello управления базами данных toomake убедиться, что в регион B создаются новые учетные записи hello и базами данных клиента и существует найдены hello существующих баз данных клиента как хорошо. существующие заказчики пробной Hello просматривать свои данные временно недоступны.
* При сбое toopool баз данных клиента hello платная 2 в регион B tooimmediately восстановить их доступность (4). Поскольку отработки отказа hello изменение уровня быстрого метаданных, можно использовать оптимизацию которой запускается hello отдельных переход на другой ресурс по требованию соединениями hello для конечных пользователей. 
* Начиная с теперь пул 2 содержит только базы данных-источники, hello общей рабочей нагрузки в пуле возрастает hello и сразу же может увеличить его размер eDTU (5). 
* Создайте новый эластичный пул hello с hello совпадают имя и hello же конфигурации в регионе hello B для заказчиков hello пробной версии базы данных (6). 
* После использования hello toorestore географическое восстановление отдельных пробной версии клиента базы данных создается пул hello в пул носителей hello (7). Можно рассмотрите возможность запуска восстановление отдельных hello соединениями hello конечным пользователем или некоторые другие схемы приоритет конкретного приложения.

> [!NOTE]
> режим отработки отказа Hello является асинхронным. время восстановления toominimize hello, очень важно выполнять команда отработки отказа баз данных клиента hello в пакеты по крайней мере 20 баз данных. 
> 

На этом этапе приложение вновь подключен к сети в регионе б. Все клиенты-плательщики имеют доступ tootheir данных во время пробной клиентов hello задержка при доступе к их данным.

При восстановлении региона A требуется toodecide, если требуется toouse регион B для пробной версии клиентов или пула пробной клиентов hello toousing восстановление после сбоя в регионе, а. Одно условие может быть % hello пробной версии клиента баз данных изменены с момента восстановления hello. Независимо от того, это решение необходимо клиентов hello платных toore баланс между двумя пулами. Hello следующей схеме показан процесс hello, если баз данных hello пробной версии клиента не задней tooregion A.  

![Рис. 6](./media/sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool/diagram-9.png)

* Отмените tootrial аварийного восстановления пула всех ожидающих геовосстановление запросов.   
* При сбое базы данных управления hello (8). После восстановления области hello старая первичная hello автоматически стало hello получателей. Теперь он становится hello основной еще раз.  
* Выберите, какие базы данных клиента платной ошибкой задней toopool 1 до запуска отработки отказа tootheir баз данных-получателей (9). После восстановления hello области всех баз данных в группу 1 автоматически стало баз данных-получателей. Теперь половина баз данных снова становятся базами данных-источниками. 
* Уменьшите размер hello eDTU пула к 2 toohello исходный (10).
* Набор всех восстановлен пробной версии баз данных в области hello B только для tooread (11).
* Для каждой базы данных в пуле аварийного восстановления пробной версии hello, которые изменились с момента восстановления hello переименуйте или удалите соответствующую базу данных hello в пробной версии hello основного пула (12). 
* Копировать hello обновление баз данных из hello DR пула toohello основного пула (13). 
* Удаление пула hello аварийного восстановления (14) 

ключ Hello **преимущества** эту стратегию, являются:

* Он поддерживает hello наиболее интенсивными соглашения об уровне ОБСЛУЖИВАНИЯ для hello клиенты-плательщики так как он гарантирует, что сбоя не влияет на более 50% hello базами данных клиента. 
* Он гарантирует, что новый пробные версии hello разблокированы, как можно скорее hello следа DR пул создается во время восстановления hello. 
* Она позволяет более эффективно использовать емкость пула hello как 50% от базы данных-получатели группы 1 и пул 2 гарантируется toobe менее активных чем hello баз данных-источников.

основной Hello **компромиссы** являются:

* Hello операций CRUD в базах данных управления hello иметь меньшей задержке hello конечных пользователей, подключенных tooregion A чем для конечных пользователей, подключенных hello tooregion B, выполняемые на первичной hello hello баз данных управления.
* Требуются более сложные структуры базы данных управления hello. Например каждая запись клиента имеет расположение тег, который должен toobe изменен во время отработки отказа и восстановления размещения.  
* Клиенты-плательщики Hello могут возникнуть скоростью, чем обычно, пока hello пула в регион B завершения обновления. 

## <a name="summary"></a>Сводка
Эта статья посвящена hello стратегии аварийного восстановления для hello уровня базы данных, используемые многопользовательского приложения SaaS независимого поставщика программных Продуктов. Hello стратегия не была выбрана зависит от потребностей hello приложения hello, например модели бизнес-hello hello соглашения об уровне ОБСЛУЖИВАНИЯ должны toooffer tooyour заказчики, бюджета ограничения и т. д. Все описаны преимущества hello контуров стратегии и компромисс, могут принять обоснованное решение. Вероятно, ваше приложение включает другие компоненты Azure. Чтобы просмотреть их руководство по непрерывности бизнеса и координировать восстановление hello hello уровня базы данных с ними. toolearn Дополнительные сведения об управлении восстановления приложений баз данных в Azure, см. слишком[проектирование облачных решений для аварийного восстановления](sql-database-designing-cloud-solutions-for-disaster-recovery.md).  

## <a name="next-steps"></a>Дальнейшие действия
* toolearn о резервных копиях автоматических базы данных SQL Azure, в разделе [базы данных SQL автоматическое резервное копирование](sql-database-automated-backups.md).
* Сведения об обеспечении непрерывности бизнес-процессов и возможные сценарии описаны в [обзоре непрерывности бизнес-процессов](sql-database-business-continuity.md).
* toolearn об использовании автоматического создания резервных копий для восстановления, в разделе [восстановление базы данных из резервных копий, инициируемых службой hello](sql-database-recovery-using-backups.md).
* toolearn о быстрее параметры восстановления, в разделе [активной георепликации](sql-database-geo-replication-overview.md).
* в разделе toolearn об использовании автоматического резервного копирования для архивации, [копирование базы данных](sql-database-copy.md).

