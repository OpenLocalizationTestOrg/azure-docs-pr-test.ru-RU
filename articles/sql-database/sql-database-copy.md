---
title: "aaaCopy базы данных Azure SQL | Документы Microsoft"
description: "Создание копии Базы данных SQL Azure"
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: 5aaf6bcd-3839-49b5-8c77-cbdf786e359b
ms.service: sql-database
ms.custom: load & move data
ms.devlang: NA
ms.date: 06/15/2017
ms.author: carlrab
ms.workload: data-management
ms.topic: article
ms.tgt_pltfrm: NA
ms.openlocfilehash: 64a297d819d6da89600fda60abe8394ae405abfe
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="copy-an-azure-sql-database"></a><span data-ttu-id="db9d1-103">Копирование Базы данных SQL Azure</span><span class="sxs-lookup"><span data-stu-id="db9d1-103">Copy an Azure SQL database</span></span>

<span data-ttu-id="db9d1-104">База данных SQL Azure предоставляет несколько методов для создания транзакционно согласованной копии существующий SQL Azure базы данных на любом hello же сервере или другом сервере.</span><span class="sxs-lookup"><span data-stu-id="db9d1-104">Azure SQL Database provides several methods for creating a transactionally consistent copy of an existing Azure SQL database on either hello same server or a different server.</span></span> <span data-ttu-id="db9d1-105">Можно скопировать базу данных SQL с помощью hello портал Azure, PowerShell или T-SQL.</span><span class="sxs-lookup"><span data-stu-id="db9d1-105">You can copy a SQL database by using hello Azure portal, PowerShell, or T-SQL.</span></span> 

## <a name="overview"></a><span data-ttu-id="db9d1-106">Обзор</span><span class="sxs-lookup"><span data-stu-id="db9d1-106">Overview</span></span>

<span data-ttu-id="db9d1-107">Копия базы данных является моментальным снимком hello базы данных-источника на момент времени hello hello копирования запроса.</span><span class="sxs-lookup"><span data-stu-id="db9d1-107">A database copy is a snapshot of hello source database as of hello time of hello copy request.</span></span> <span data-ttu-id="db9d1-108">Можно выбрать hello того же сервера или другой сервер, уровень производительности и уровня службы или на разных уровнях производительности в рамках hello же уровень обслуживания (выпуск).</span><span class="sxs-lookup"><span data-stu-id="db9d1-108">You can select hello same server or a different server, its service tier and performance level, or a different performance level within hello same service tier (edition).</span></span> <span data-ttu-id="db9d1-109">После завершения копирования hello, оно становится полностью работоспособной независимой базой данных.</span><span class="sxs-lookup"><span data-stu-id="db9d1-109">After hello copy is complete, it becomes a fully functional, independent database.</span></span> <span data-ttu-id="db9d1-110">На этом этапе можно обновить или понизить его tooany выпуска.</span><span class="sxs-lookup"><span data-stu-id="db9d1-110">At this point, you can upgrade or downgrade it tooany edition.</span></span> <span data-ttu-id="db9d1-111">Hello имена входа, пользователей и разрешения можно управлять независимо друг от друга.</span><span class="sxs-lookup"><span data-stu-id="db9d1-111">hello logins, users, and permissions can be managed independently.</span></span>  

## <a name="logins-in-hello-database-copy"></a><span data-ttu-id="db9d1-112">Имена для входа в hello копии базы данных.</span><span class="sxs-lookup"><span data-stu-id="db9d1-112">Logins in hello database copy</span></span>

<span data-ttu-id="db9d1-113">При копировании toohello базы данных на одном логическом сервере, можно использовать одинаковые имена входа в обеих базах данных hello.</span><span class="sxs-lookup"><span data-stu-id="db9d1-113">When you copy a database toohello same logical server, hello same logins can be used on both databases.</span></span> <span data-ttu-id="db9d1-114">Hello субъект безопасности, используемый базы данных hello toocopy становится владельцем базы данных hello hello новой базе данных.</span><span class="sxs-lookup"><span data-stu-id="db9d1-114">hello security principal you use toocopy hello database becomes hello database owner on hello new database.</span></span> <span data-ttu-id="db9d1-115">Все пользователи базы данных, их разрешения и их представляют идентификаторы безопасности копируются toohello копию базы данных.</span><span class="sxs-lookup"><span data-stu-id="db9d1-115">All database users, their permissions, and their security identifiers (SIDs) are copied toohello database copy.</span></span>  

<span data-ttu-id="db9d1-116">При копировании базы данных tooa другой логический сервер участника на новом сервере hello hello безопасности становится владельцем базы данных hello hello новой базе данных.</span><span class="sxs-lookup"><span data-stu-id="db9d1-116">When you copy a database tooa different logical server, hello security principal on hello new server becomes hello database owner on hello new database.</span></span> <span data-ttu-id="db9d1-117">Если вы используете [пользователей автономной базы данных](sql-database-manage-logins.md) для доступа к данным, убедитесь, что оба hello источника и базы данных-получатели всегда имеют одинаковые учетные данные пользователя, завершить, так что после копирования hello вы сразу же доступны hello его с таким же hello учетные данные.</span><span class="sxs-lookup"><span data-stu-id="db9d1-117">If you use [contained database users](sql-database-manage-logins.md) for data access, ensure that both hello primary and secondary databases always have hello same user credentials, so that after hello copy is complete you can immediately access it with hello same credentials.</span></span> 

<span data-ttu-id="db9d1-118">Если вы используете [Azure Active Directory](../active-directory/active-directory-whatis.md), можно полностью исключить hello потребность в управлении учетными данными в копии hello.</span><span class="sxs-lookup"><span data-stu-id="db9d1-118">If you use [Azure Active Directory](../active-directory/active-directory-whatis.md), you can completely eliminate hello need for managing credentials in hello copy.</span></span> <span data-ttu-id="db9d1-119">Тем не менее при копировании hello базы данных tooa новый сервер доступа на основе имени входа hello могут не работать, поскольку приветствия имен входа на новом сервере hello не существуют.</span><span class="sxs-lookup"><span data-stu-id="db9d1-119">However, when you copy hello database tooa new server, hello login-based access might not work, because hello logins do not exist on hello new server.</span></span> <span data-ttu-id="db9d1-120">toolearn об управлении именами входа, при копировании базы данных tooa другого логического сервера, в разделе [как toomanage Azure SQL базы данных безопасности после аварийного восстановления](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="db9d1-120">toolearn about managing logins when you copy a database tooa different logical server, see [How toomanage Azure SQL database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span> 

<span data-ttu-id="db9d1-121">После успешного завершения копирования hello, перед другими пользователями, сопоставляются только hello входа, инициировавший копирование, hello hello владелец базы данных, можно выполнить toohello новой базы данных.</span><span class="sxs-lookup"><span data-stu-id="db9d1-121">After hello copying succeeds and before other users are remapped, only hello login that initiated hello copying, hello database owner, can log in toohello new database.</span></span> <span data-ttu-id="db9d1-122">имена входа tooresolve после завершения операции копирования hello. в разделе [разрешение имен входа](#resolve-logins).</span><span class="sxs-lookup"><span data-stu-id="db9d1-122">tooresolve logins after hello copying operation is complete, see [Resolve logins](#resolve-logins).</span></span>

## <a name="copy-a-database-by-using-hello-azure-portal"></a><span data-ttu-id="db9d1-123">Копирование базы данных с помощью портала Azure hello</span><span class="sxs-lookup"><span data-stu-id="db9d1-123">Copy a database by using hello Azure portal</span></span>

<span data-ttu-id="db9d1-124">toocopy базы данных с помощью hello портал Azure, Привет открыть страницу для базы данных и нажмите кнопку **копирования**.</span><span class="sxs-lookup"><span data-stu-id="db9d1-124">toocopy a database by using hello Azure portal, open hello page for your database, and then click **Copy**.</span></span> 

   ![Копирование базы данных](./media/sql-database-copy/database-copy.png)

## <a name="copy-a-database-by-using-powershell"></a><span data-ttu-id="db9d1-126">Копирование базы данных с помощью PowerShell</span><span class="sxs-lookup"><span data-stu-id="db9d1-126">Copy a database by using PowerShell</span></span>

<span data-ttu-id="db9d1-127">базы данных с помощью PowerShell, используйте hello toocopy [New AzureRmSqlDatabaseCopy](/powershell/module/azurerm.sql/new-azurermsqldatabasecopy) командлета.</span><span class="sxs-lookup"><span data-stu-id="db9d1-127">toocopy a database by using PowerShell, use hello [New-AzureRmSqlDatabaseCopy](/powershell/module/azurerm.sql/new-azurermsqldatabasecopy) cmdlet.</span></span> 

```PowerShell
New-AzureRmSqlDatabaseCopy -ResourceGroupName "myResourceGroup" `
    -ServerName $sourceserver `
    -DatabaseName "MySampleDatabase" `
    -CopyResourceGroupName "myResourceGroup" `
    -CopyServerName $targetserver `
    -CopyDatabaseName "CopyOfMySampleDatabase"
```

<span data-ttu-id="db9d1-128">Полный пример скрипта см. в разделе [скопировать новый сервер базы данных tooa](scripts/sql-database-copy-database-to-new-server-powershell.md).</span><span class="sxs-lookup"><span data-stu-id="db9d1-128">For a complete sample script, see [Copy a database tooa new server](scripts/sql-database-copy-database-to-new-server-powershell.md).</span></span>

## <a name="copy-a-database-by-using-transact-sql"></a><span data-ttu-id="db9d1-129">Копирование базы данных с помощью Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="db9d1-129">Copy a database by using Transact-SQL</span></span>

<span data-ttu-id="db9d1-130">Войдите в базе данных master toohello базы данных с именем входа субъекта серверного уровня hello или hello имя входа, создавшее hello базы данных, которая toocopy.</span><span class="sxs-lookup"><span data-stu-id="db9d1-130">Log in toohello master database with hello server-level principal login or hello login that created hello database you want toocopy.</span></span> <span data-ttu-id="db9d1-131">Для копирования toosucceed базы данных имена входа, которые не являются hello участник уровня сервера должны быть членами роли dbmanager hello.</span><span class="sxs-lookup"><span data-stu-id="db9d1-131">For database copying toosucceed, logins that are not hello server-level principal must be members of hello dbmanager role.</span></span> <span data-ttu-id="db9d1-132">Дополнительные сведения об именах входа и подключения toohello сервера см. в разделе [Управление именами входа](sql-database-manage-logins.md).</span><span class="sxs-lookup"><span data-stu-id="db9d1-132">For more information about logins and connecting toohello server, see [Manage logins](sql-database-manage-logins.md).</span></span>

<span data-ttu-id="db9d1-133">Запустите копирование базы данных-источника hello с hello [CREATE DATABASE](https://msdn.microsoft.com/library/ms176061.aspx) инструкции.</span><span class="sxs-lookup"><span data-stu-id="db9d1-133">Start copying hello source database with hello [CREATE DATABASE](https://msdn.microsoft.com/library/ms176061.aspx) statement.</span></span> <span data-ttu-id="db9d1-134">Выполнение этой инструкции запускает процесс копирования базы данных hello.</span><span class="sxs-lookup"><span data-stu-id="db9d1-134">Executing this statement initiates hello database copying process.</span></span> <span data-ttu-id="db9d1-135">Поскольку копирование базы данных является асинхронным процессом, hello инструкции CREATE DATABASE возвращает до завершения копирования базы данных hello.</span><span class="sxs-lookup"><span data-stu-id="db9d1-135">Because copying a database is an asynchronous process, hello CREATE DATABASE statement returns before hello database copying is complete.</span></span>

### <a name="copy-a-sql-database-toohello-same-server"></a><span data-ttu-id="db9d1-136">Копирование базы данных SQL toohello того же сервера.</span><span class="sxs-lookup"><span data-stu-id="db9d1-136">Copy a SQL database toohello same server</span></span>
<span data-ttu-id="db9d1-137">Войдите в базе данных master toohello базы данных с именем входа субъекта серверного уровня hello или hello имя входа, создавшее hello базы данных, которая toocopy.</span><span class="sxs-lookup"><span data-stu-id="db9d1-137">Log in toohello master database with hello server-level principal login or hello login that created hello database you want toocopy.</span></span> <span data-ttu-id="db9d1-138">Для копирования toosucceed базы данных имена входа, которые не являются hello участник уровня сервера должны быть членами роли dbmanager hello.</span><span class="sxs-lookup"><span data-stu-id="db9d1-138">For database copying toosucceed, logins that are not hello server-level principal must be members of hello dbmanager role.</span></span>

<span data-ttu-id="db9d1-139">Эта команда копирует Database1 tooa новая база данных Database 2 на hello того же сервера.</span><span class="sxs-lookup"><span data-stu-id="db9d1-139">This command copies Database1 tooa new database named Database2 on hello same server.</span></span> <span data-ttu-id="db9d1-140">В зависимости от размера базы данных hello hello, операция копирования может занять некоторое время toocomplete.</span><span class="sxs-lookup"><span data-stu-id="db9d1-140">Depending on hello size of your database, hello copying operation might take some time toocomplete.</span></span>

    -- Execute on hello master database.
    -- Start copying.
    CREATE DATABASE Database1_copy AS COPY OF Database1;

### <a name="copy-a-sql-database-tooa-different-server"></a><span data-ttu-id="db9d1-141">Скопируйте другой сервер tooa базы данных SQL</span><span class="sxs-lookup"><span data-stu-id="db9d1-141">Copy a SQL database tooa different server</span></span>

<span data-ttu-id="db9d1-142">Войдите в базе данных master toohello базы данных на сервере назначения hello, где создан toobe hello новую базу данных сервера базы данных SQL hello.</span><span class="sxs-lookup"><span data-stu-id="db9d1-142">Log in toohello master database of hello destination server, hello SQL database server where hello new database is toobe created.</span></span> <span data-ttu-id="db9d1-143">Используйте имя входа, которое имеет hello же имя и пароль как владелец базы данных hello hello базы данных-источника на сервере базы данных SQL источника hello.</span><span class="sxs-lookup"><span data-stu-id="db9d1-143">Use a login that has hello same name and password as hello database owner of hello source database on hello source SQL database server.</span></span> <span data-ttu-id="db9d1-144">Hello входа на сервер назначения hello также необходимо быть членом роли dbmanager hello или именем входа субъекта серверного уровня hello.</span><span class="sxs-lookup"><span data-stu-id="db9d1-144">hello login on hello destination server must also be a member of hello dbmanager role or be hello server-level principal login.</span></span>

<span data-ttu-id="db9d1-145">Эта команда копирует Database1 на сервере server1 tooa новая база данных Database 2 на сервере server2.</span><span class="sxs-lookup"><span data-stu-id="db9d1-145">This command copies Database1 on server1 tooa new database named Database2 on server2.</span></span> <span data-ttu-id="db9d1-146">В зависимости от размера базы данных hello hello, операция копирования может занять некоторое время toocomplete.</span><span class="sxs-lookup"><span data-stu-id="db9d1-146">Depending on hello size of your database, hello copying operation might take some time toocomplete.</span></span>

    -- Execute on hello master database of hello target server (server2)
    -- Start copying from Server1 tooServer2
    CREATE DATABASE Database1_copy AS COPY OF server1.Database1;


### <a name="monitor-hello-progress-of-hello-copying-operation"></a><span data-ttu-id="db9d1-147">Следить за ходом hello hello операции копирования</span><span class="sxs-lookup"><span data-stu-id="db9d1-147">Monitor hello progress of hello copying operation</span></span>

<span data-ttu-id="db9d1-148">Наблюдать за процессом копирования hello с помощью представления sys.databases и sys.dm_database_copies hello.</span><span class="sxs-lookup"><span data-stu-id="db9d1-148">Monitor hello copying process by querying hello sys.databases and sys.dm_database_copies views.</span></span> <span data-ttu-id="db9d1-149">Здравствуйте, копирование hello во время выполнения, **state_desc** столбца представления sys.databases hello для новой базы данных hello установлено слишком**копирование**.</span><span class="sxs-lookup"><span data-stu-id="db9d1-149">While hello copying is in progress, hello **state_desc** column of hello sys.databases view for hello new database is set too**COPYING**.</span></span>

* <span data-ttu-id="db9d1-150">Здравствуйте, если hello копирование завершилось с ошибкой, **state_desc** столбца представления sys.databases hello для новой базы данных hello установлено слишком**ПОДОЗРЕНИЕ**.</span><span class="sxs-lookup"><span data-stu-id="db9d1-150">If hello copying fails, hello **state_desc** column of hello sys.databases view for hello new database is set too**SUSPECT**.</span></span> <span data-ttu-id="db9d1-151">Выполнение инструкции DROP hello hello новой базе данных и повторите попытку позже.</span><span class="sxs-lookup"><span data-stu-id="db9d1-151">Execute hello DROP statement on hello new database, and try again later.</span></span>
* <span data-ttu-id="db9d1-152">Если hello копирование завершилось успешно, hello **state_desc** столбца представления sys.databases hello для новой базы данных hello установлено слишком**ONLINE**.</span><span class="sxs-lookup"><span data-stu-id="db9d1-152">If hello copying succeeds, hello **state_desc** column of hello sys.databases view for hello new database is set too**ONLINE**.</span></span> <span data-ttu-id="db9d1-153">копирование Hello завершена, и новая база данных hello является обычной базой данных, которые могут быть изменены независимо от базы данных-источника hello.</span><span class="sxs-lookup"><span data-stu-id="db9d1-153">hello copying is complete, and hello new database is a regular database that can be changed independent of hello source database.</span></span>

> [!NOTE]
> <span data-ttu-id="db9d1-154">Если вы решите toocancel hello копирование его во время выполнения, выполните hello [DROP DATABASE](https://msdn.microsoft.com/library/ms178613.aspx) инструкции hello новой базе данных.</span><span class="sxs-lookup"><span data-stu-id="db9d1-154">If you decide toocancel hello copying while it is in progress, execute hello [DROP DATABASE](https://msdn.microsoft.com/library/ms178613.aspx) statement on hello new database.</span></span> <span data-ttu-id="db9d1-155">Кроме того при выполнении инструкции DROP DATABASE hello hello базы данных-источника также отменяет hello, процесс копирования.</span><span class="sxs-lookup"><span data-stu-id="db9d1-155">Alternatively, executing hello DROP DATABASE statement on hello source database also cancels hello copying process.</span></span>
> 

## <a name="resolve-logins"></a><span data-ttu-id="db9d1-156">Разрешение имен для входа</span><span class="sxs-lookup"><span data-stu-id="db9d1-156">Resolve logins</span></span>

<span data-ttu-id="db9d1-157">После hello новая база данных находится в оперативном режиме на конечном сервере hello, используйте hello [ALTER USER](https://msdn.microsoft.com/library/ms176060.aspx) инструкции tooremap hello пользователям hello создания базы данных toologins на конечном сервере hello.</span><span class="sxs-lookup"><span data-stu-id="db9d1-157">After hello new database is online on hello destination server, use hello [ALTER USER](https://msdn.microsoft.com/library/ms176060.aspx) statement tooremap hello users from hello new database toologins on hello destination server.</span></span> <span data-ttu-id="db9d1-158">tooresolve связь с учетной записью, пользователям [Диагностика потерянных пользователей](https://msdn.microsoft.com/library/ms175475.aspx).</span><span class="sxs-lookup"><span data-stu-id="db9d1-158">tooresolve orphaned users, see [Troubleshoot Orphaned Users](https://msdn.microsoft.com/library/ms175475.aspx).</span></span> <span data-ttu-id="db9d1-159">См. также [как toomanage Azure SQL базы данных безопасности после аварийного восстановления](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="db9d1-159">See also [How toomanage Azure SQL database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>

<span data-ttu-id="db9d1-160">Все пользователи в новую базу данных hello сохранять hello разрешения, которыми они обладали hello базы данных-источника.</span><span class="sxs-lookup"><span data-stu-id="db9d1-160">All users in hello new database retain hello permissions that they had in hello source database.</span></span> <span data-ttu-id="db9d1-161">Hello пользователя, запустившего hello копию базы данных, становится владельцем базы данных hello hello новой базы данных и назначается новый идентификатор безопасности (SID).</span><span class="sxs-lookup"><span data-stu-id="db9d1-161">hello user who initiated hello database copy becomes hello database owner of hello new database and is assigned a new security identifier (SID).</span></span> <span data-ttu-id="db9d1-162">После успешного завершения копирования hello, перед другими пользователями, сопоставляются только hello входа, инициировавший копирование, hello hello владелец базы данных, можно выполнить toohello новой базы данных.</span><span class="sxs-lookup"><span data-stu-id="db9d1-162">After hello copying succeeds and before other users are remapped, only hello login that initiated hello copying, hello database owner, can log in toohello new database.</span></span>

<span data-ttu-id="db9d1-163">toolearn об управлении пользователями и именами входа, при копировании базы данных tooa другого логического сервера, в разделе [как toomanage Azure SQL базы данных безопасности после аварийного восстановления](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="db9d1-163">toolearn about managing users and logins when you copy a database tooa different logical server, see [How toomanage Azure SQL database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="db9d1-164">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="db9d1-164">Next steps</span></span>

* <span data-ttu-id="db9d1-165">Сведения об именах входа см. в разделе [Управление именами входа](sql-database-manage-logins.md) и [как toomanage Azure SQL базы данных безопасности после аварийного восстановления](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="db9d1-165">For information about logins, see [Manage logins](sql-database-manage-logins.md) and [How toomanage Azure SQL database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>
* <span data-ttu-id="db9d1-166">tooexport базы данных, в разделе [экспорта базы данных hello tooa BACPAC](sql-database-export.md).</span><span class="sxs-lookup"><span data-stu-id="db9d1-166">tooexport a database, see [Export hello database tooa BACPAC](sql-database-export.md).</span></span>
