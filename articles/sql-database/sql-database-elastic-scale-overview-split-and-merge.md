---
title: "aaaMoving данные между базами данных горизонтально масштабируемого облака | Документы Microsoft"
description: "Объясняет, как toomanipulate сегментов и перемещения данных с помощью резидентной службы с помощью эластичных баз данных API-интерфейсы."
services: sql-database
documentationcenter: 
manager: jhubbard
author: ddove
ms.assetid: 204fd902-0397-4185-985a-dea3ed7c7d9f
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/24/2016
ms.author: ddove
ms.openlocfilehash: 629dee06e22609e9b61edf93ba5c38d997132d8c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="moving-data-between-scaled-out-cloud-databases"></a><span data-ttu-id="bede6-103">Перемещение данных между масштабируемыми облачными базами данных</span><span class="sxs-lookup"><span data-stu-id="bede6-103">Moving data between scaled-out cloud databases</span></span>
<span data-ttu-id="bede6-104">Если являетесь программное обеспечение, как разработчик службы и внезапно приложение проходит масштабную запросу, необходимо tooaccommodate hello роста.</span><span class="sxs-lookup"><span data-stu-id="bede6-104">If you are a Software as a Service developer, and suddenly your app undergoes tremendous demand, you need tooaccommodate hello growth.</span></span> <span data-ttu-id="bede6-105">В результате добавляются новые базы данных (сегменты).</span><span class="sxs-lookup"><span data-stu-id="bede6-105">So you add more databases (shards).</span></span> <span data-ttu-id="bede6-106">Способ распространения данных hello toohello новых баз данных без нарушения целостности данных hello</span><span class="sxs-lookup"><span data-stu-id="bede6-106">How do you redistribute hello data toohello new databases without disrupting hello data integrity?</span></span> <span data-ttu-id="bede6-107">Используйте hello **средством слияния разбиение** toomove данные из ограниченного баз данных toohello новых баз данных.</span><span class="sxs-lookup"><span data-stu-id="bede6-107">Use hello **split-merge tool** toomove data from constrained databases toohello new databases.</span></span>  

<span data-ttu-id="bede6-108">Средство Hello разделения слияния запускается как служба Azure web.</span><span class="sxs-lookup"><span data-stu-id="bede6-108">hello split-merge tool runs as an Azure web service.</span></span> <span data-ttu-id="bede6-109">Администратор или разработчик использует средство hello toomove подсегментов (данные из сегмента) между разными базами данных (сегментов).</span><span class="sxs-lookup"><span data-stu-id="bede6-109">An administrator or developer uses hello tool toomove shardlets (data from a shard) between different databases (shards).</span></span> <span data-ttu-id="bede6-110">Средство Hello использует сегментов карты toomaintain hello метаданных базы данных службы управления и обеспечить согласованное сопоставления.</span><span class="sxs-lookup"><span data-stu-id="bede6-110">hello tool uses shard map management toomaintain hello service metadata database, and ensure consistent mappings.</span></span>

![Обзор][1]

## <a name="download"></a><span data-ttu-id="bede6-112">Скачивание</span><span class="sxs-lookup"><span data-stu-id="bede6-112">Download</span></span>
[<span data-ttu-id="bede6-113">Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge</span><span class="sxs-lookup"><span data-stu-id="bede6-113">Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge</span></span>](http://www.nuget.org/packages/Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge/)

## <a name="documentation"></a><span data-ttu-id="bede6-114">Документация</span><span class="sxs-lookup"><span data-stu-id="bede6-114">Documentation</span></span>
1. [<span data-ttu-id="bede6-115">Учебник по инструменту разбиения и объединения эластичной базы данных</span><span class="sxs-lookup"><span data-stu-id="bede6-115">Elastic database Split-Merge tool tutorial</span></span>](sql-database-elastic-scale-configure-deploy-split-and-merge.md)
2. [<span data-ttu-id="bede6-116">Настройка безопасности служб разделения и объединения</span><span class="sxs-lookup"><span data-stu-id="bede6-116">Split-Merge security configuration</span></span>](sql-database-elastic-scale-split-merge-security-configuration.md)
3. [<span data-ttu-id="bede6-117">Вопросы безопасности служб разделения и объединения</span><span class="sxs-lookup"><span data-stu-id="bede6-117">Split-merge security considerations</span></span>](sql-database-elastic-scale-split-merge-security-configuration.md)
4. [<span data-ttu-id="bede6-118">Управление размещением сегментов</span><span class="sxs-lookup"><span data-stu-id="bede6-118">Shard map management</span></span>](sql-database-elastic-scale-shard-map-management.md)
5. [<span data-ttu-id="bede6-119">Миграция существующих баз данных tooscale масштабированием</span><span class="sxs-lookup"><span data-stu-id="bede6-119">Migrate existing databases tooscale-out</span></span>](sql-database-elastic-convert-to-use-elastic-tools.md)
6. [<span data-ttu-id="bede6-120">Инструменты эластичных баз данных</span><span class="sxs-lookup"><span data-stu-id="bede6-120">Elastic database tools</span></span>](sql-database-elastic-scale-introduction.md)
7. [<span data-ttu-id="bede6-121">Глоссарий по средствам работы с эластичными базами данных</span><span class="sxs-lookup"><span data-stu-id="bede6-121">Elastic Database tools glossary</span></span>](sql-database-elastic-scale-glossary.md)

## <a name="why-use-hello-split-merge-tool"></a><span data-ttu-id="bede6-122">Зачем использовать средство hello разделения слияния?</span><span class="sxs-lookup"><span data-stu-id="bede6-122">Why use hello split-merge tool?</span></span>
<span data-ttu-id="bede6-123">**Гибкость**</span><span class="sxs-lookup"><span data-stu-id="bede6-123">**Flexibility**</span></span>

<span data-ttu-id="bede6-124">Приложения должны toostretch гибкое превышает порог hello одной базы данных, база данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="bede6-124">Applications need toostretch flexibly beyond hello limits of a single Azure SQL DB database.</span></span> <span data-ttu-id="bede6-125">Используйте данные toomove средство hello как необходимые toonew баз данных, сохраняя целостность.</span><span class="sxs-lookup"><span data-stu-id="bede6-125">Use hello tool toomove data as needed toonew databases while retaining integrity.</span></span>

<span data-ttu-id="bede6-126">**Разбиение toogrow**</span><span class="sxs-lookup"><span data-stu-id="bede6-126">**Split toogrow**</span></span> 

<span data-ttu-id="bede6-127">Требуется tooincrease общую емкость toohandle взрывоподобный рост.</span><span class="sxs-lookup"><span data-stu-id="bede6-127">You need tooincrease overall capacity toohandle explosive growth.</span></span> <span data-ttu-id="bede6-128">toodo таким образом, создать дополнительный объем данных сегментирования hello и распространение по постепенно нескольким базам данных, пока не будут выполнены потребностей в емкости.</span><span class="sxs-lookup"><span data-stu-id="bede6-128">toodo so, create additional capacity by sharding hello data and by distributing it across incrementally more databases until capacity needs are fulfilled.</span></span> <span data-ttu-id="bede6-129">Это отличный пример компонента «разделить» hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-129">This is a prime example of hello ‘split’ feature.</span></span> 

<span data-ttu-id="bede6-130">**Объединение tooshrink**</span><span class="sxs-lookup"><span data-stu-id="bede6-130">**Merge tooshrink**</span></span>

<span data-ttu-id="bede6-131">Из-за toohello сезонных характер бизнеса требуется сжать емкости.</span><span class="sxs-lookup"><span data-stu-id="bede6-131">Capacity needs shrink due toohello seasonal nature of a business.</span></span> <span data-ttu-id="bede6-132">Hello средство позволяет масштабировать единиц масштабирования toofewer при замедляет бизнеса.</span><span class="sxs-lookup"><span data-stu-id="bede6-132">hello tool lets you scale down toofewer scale units when business slows.</span></span> <span data-ttu-id="bede6-133">функция «слияние» Hello в hello гибкого масштабирования разделения слияния службы описывает это требование.</span><span class="sxs-lookup"><span data-stu-id="bede6-133">hello ‘merge’ feature in hello Elastic Scale split-merge Service covers this requirement.</span></span> 

<span data-ttu-id="bede6-134">**Управление хот-спотами путем перемещения шардлетов**</span><span class="sxs-lookup"><span data-stu-id="bede6-134">**Manage hotspots by moving shardlets**</span></span>

<span data-ttu-id="bede6-135">С несколькими клиентами на базу данных hello распределение подсегментов tooshards может вызвать toocapacity узких мест на некоторых сегментов.</span><span class="sxs-lookup"><span data-stu-id="bede6-135">With multiple tenants per database, hello allocation of shardlets tooshards can lead toocapacity bottlenecks on some shards.</span></span> <span data-ttu-id="bede6-136">Это требуется, повторное выделение ячеек или перемещение подсегментов занят toonew или меньше загруженные сегментов.</span><span class="sxs-lookup"><span data-stu-id="bede6-136">This requires re-allocating shardlets or moving busy shardlets toonew or less utilized shards.</span></span> 

## <a name="concepts--key-features"></a><span data-ttu-id="bede6-137">Концепции и основные функции</span><span class="sxs-lookup"><span data-stu-id="bede6-137">Concepts & key features</span></span>
<span data-ttu-id="bede6-138">**Службы, размещаемые на стороне клиента**</span><span class="sxs-lookup"><span data-stu-id="bede6-138">**Customer-hosted services**</span></span>

<span data-ttu-id="bede6-139">Hello разделения слияния доставляется в виде службы, размещенных в веб-клиента.</span><span class="sxs-lookup"><span data-stu-id="bede6-139">hello split-merge is delivered as a customer-hosted service.</span></span> <span data-ttu-id="bede6-140">Необходимо развернуть и разместить службу hello в вашей подписке Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="bede6-140">You must deploy and host hello service in your Microsoft Azure subscription.</span></span> <span data-ttu-id="bede6-141">Hello пакета, который можно скачать из NuGet содержит toocomplete шаблона конфигурации данными hello для нужд конкретного развертывания.</span><span class="sxs-lookup"><span data-stu-id="bede6-141">hello package you download from NuGet contains a configuration template toocomplete with hello information for your specific deployment.</span></span> <span data-ttu-id="bede6-142">В разделе hello [разделения слияния учебника](sql-database-elastic-scale-configure-deploy-split-and-merge.md) подробные сведения.</span><span class="sxs-lookup"><span data-stu-id="bede6-142">See hello [split-merge tutorial](sql-database-elastic-scale-configure-deploy-split-and-merge.md) for details.</span></span> <span data-ttu-id="bede6-143">Поскольку hello служба работает в вашей подписке Azure, можно управлять и выбрать подходящие hello службы.</span><span class="sxs-lookup"><span data-stu-id="bede6-143">Since hello service runs in your Azure subscription, you can control and configure most security aspects of hello service.</span></span> <span data-ttu-id="bede6-144">шаблон по умолчанию Hello включает tooconfigure hello параметры SSL, проверка подлинности на основе сертификата клиента, шифрование для сохраненных учетных данных, защищая DoS и ограничения IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="bede6-144">hello default template includes hello options tooconfigure SSL, certificate-based client authentication, encryption for stored credentials, DoS guarding and IP restrictions.</span></span> <span data-ttu-id="bede6-145">Дополнительные сведения о hello можно найти аспектах безопасности в следующий документ hello [конфигурация безопасности разделения слияния](sql-database-elastic-scale-split-merge-security-configuration.md).</span><span class="sxs-lookup"><span data-stu-id="bede6-145">You can find more information on hello security aspects in hello following document [split-merge security configuration](sql-database-elastic-scale-split-merge-security-configuration.md).</span></span>

<span data-ttu-id="bede6-146">по умолчанию Hello развертывания выполняется служба с один рабочий процесс и одной веб-роли.</span><span class="sxs-lookup"><span data-stu-id="bede6-146">hello default deployed service runs with one worker and one web role.</span></span> <span data-ttu-id="bede6-147">Каждый использует размер A1 VM hello в облачных службах Azure.</span><span class="sxs-lookup"><span data-stu-id="bede6-147">Each uses hello A1 VM size in Azure Cloud Services.</span></span> <span data-ttu-id="bede6-148">Эти параметры нельзя изменить при развертывании пакета hello, можно изменить их после успешного развертывания в hello прогона облачной службы (hello портал Azure).</span><span class="sxs-lookup"><span data-stu-id="bede6-148">While you cannot modify these settings when deploying hello package, you could change them after a successful deployment in hello running cloud service, (through hello Azure portal).</span></span> <span data-ttu-id="bede6-149">Обратите внимание, что рабочая роль hello не должен быть настроен для более чем одного экземпляра по техническим причинам.</span><span class="sxs-lookup"><span data-stu-id="bede6-149">Note that hello worker role must not be configured for more than a single instance for technical reasons.</span></span> 

<span data-ttu-id="bede6-150">**Интеграция сопоставлений сегментов**</span><span class="sxs-lookup"><span data-stu-id="bede6-150">**Shard map integration**</span></span>

<span data-ttu-id="bede6-151">Служба разделения слияния Hello взаимодействует с карты сегментов hello приложения hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-151">hello split-merge service interacts with hello shard map of hello application.</span></span> <span data-ttu-id="bede6-152">При использовании toosplit служба разделения слияния hello или диапазоны слияния или toomove подсегментов между сегментами, hello службы автоматически обновляет сопоставления сегментов hello вверх toodate.</span><span class="sxs-lookup"><span data-stu-id="bede6-152">When using hello split-merge service toosplit or merge ranges or toomove shardlets between shards, hello service automatically keeps hello shard map up toodate.</span></span> <span data-ttu-id="bede6-153">toodo таким образом, служба hello подключается toohello сегментов карты диспетчера базы данных приложения hello и хранит диапазоны и сопоставления в ходе разбиения или слияния или перемещения запросов.</span><span class="sxs-lookup"><span data-stu-id="bede6-153">toodo so, hello service connects toohello shard map manager database of hello application and maintains ranges and mappings as split/merge/move requests progress.</span></span> <span data-ttu-id="bede6-154">Это обеспечивает карта сегментов, hello всегда представляется актуальное представление при выполняются операции слияния разбиения.</span><span class="sxs-lookup"><span data-stu-id="bede6-154">This ensures that hello shard map always presents an up-to-date view when split-merge operations are going on.</span></span> <span data-ttu-id="bede6-155">Разделить, слияния и Подсегмент операции перемещения реализуются путем перемещения пакета подсегментов с hello источника сегментов toohello целевой сегментов.</span><span class="sxs-lookup"><span data-stu-id="bede6-155">Split, merge and shardlet movement operations are implemented by moving a batch of shardlets from hello source shard toohello target shard.</span></span> <span data-ttu-id="bede6-156">Во время hello Подсегмент перемещения операции hello Подсегменты субъекта toohello текущий пакет отмечаются как вне сети в карте сегментов hello и недоступны для зависящих от данных маршрутизации подключений с помощью hello **OpenConnectionForKey** API.</span><span class="sxs-lookup"><span data-stu-id="bede6-156">During hello shardlet movement operation hello shardlets subject toohello current batch are marked as offline in hello shard map and are unavailable for data-dependent routing connections using hello **OpenConnectionForKey** API.</span></span> 

<span data-ttu-id="bede6-157">**Согласованные подключения к шардлетам**</span><span class="sxs-lookup"><span data-stu-id="bede6-157">**Consistent shardlet connections**</span></span>

<span data-ttu-id="bede6-158">При запуске перемещения данных для нового пакета Подсегменты любой предоставленный карта сегментов зависимости от данных маршрутизации подключений toohello сегментов хранение hello Подсегмент являются завершенного и последующие от карты сегментов hello toohello API-интерфейсы, эти Подсегменты блокируются во время Перемещение данных Hello идет несогласованности tooavoid заказа.</span><span class="sxs-lookup"><span data-stu-id="bede6-158">When data movement starts for a new batch of shardlets, any shard-map provided data-dependent routing connections toohello shard storing hello shardlet are killed and subsequent connections from hello shard map APIs toohello these shardlets are blocked while hello data movement is in progress in order tooavoid inconsistencies.</span></span> <span data-ttu-id="bede6-159">Подсегменты tooother подключений на hello же сегментов также получить завершен, но будет успешным снова немедленно при повторной попытке.</span><span class="sxs-lookup"><span data-stu-id="bede6-159">Connections tooother shardlets on hello same shard will also get killed, but will succeed again immediately on retry.</span></span> <span data-ttu-id="bede6-160">После перемещения пакета hello hello подсегментов, помечаются online для сегментов целевой hello и hello источник данных удаляется из сегментов источника hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-160">Once hello batch is moved, hello shardlets are marked online again for hello target shard and hello source data is removed from hello source shard.</span></span> <span data-ttu-id="bede6-161">Служба Hello проходит через эти шаги для каждого пакета, пока будут перемещены все подсегментов.</span><span class="sxs-lookup"><span data-stu-id="bede6-161">hello service goes through these steps for every batch until all shardlets have been moved.</span></span> <span data-ttu-id="bede6-162">Это приведет к tooseveral операций прерывания подключения ходе hello hello завершения операции split, merge и перемещение.</span><span class="sxs-lookup"><span data-stu-id="bede6-162">This will lead tooseveral connection kill operations during hello course of hello complete split/merge/move operation.</span></span>  

<span data-ttu-id="bede6-163">**Управление доступностью шардлетов**</span><span class="sxs-lookup"><span data-stu-id="bede6-163">**Managing shardlet availability**</span></span>

<span data-ttu-id="bede6-164">Ограничение соединения hello уничтожении toohello текущий пакет подсегментов, как указано выше ограничивает область hello пакета tooone недоступности подсегментов одновременно.</span><span class="sxs-lookup"><span data-stu-id="bede6-164">Limiting hello connection killing toohello current batch of shardlets as discussed above restricts hello scope of unavailability tooone batch of shardlets at a time.</span></span> <span data-ttu-id="bede6-165">Это предпочтительнее подход где завершения сегментов hello останется вне сети для всех подсегментов ходе hello операции разбиения или слияния.</span><span class="sxs-lookup"><span data-stu-id="bede6-165">This is preferred over an approach where hello complete shard would remain offline for all its shardlets during hello course of a split or merge operation.</span></span> <span data-ttu-id="bede6-166">Hello размер пакета, определяется как hello число уникальных Подсегменты toomove одновременно, — это параметр конфигурации.</span><span class="sxs-lookup"><span data-stu-id="bede6-166">hello size of a batch, defined as hello number of distinct shardlets toomove at a time, is a configuration parameter.</span></span> <span data-ttu-id="bede6-167">Его можно определить для каждой операции разбиения и слияния, в зависимости от потребностей приложения hello доступности и производительности.</span><span class="sxs-lookup"><span data-stu-id="bede6-167">It can be defined for each split and merge operation depending on hello application’s availability and performance needs.</span></span> <span data-ttu-id="bede6-168">Обратите внимание, что диапазон hello, заблокирован в карте сегментов hello может быть больше, чем указанный размер пакета hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-168">Note that hello range that is being locked in hello shard map may be larger than hello batch size specified.</span></span> <span data-ttu-id="bede6-169">Это так, как служба hello принимает размер диапазона hello, таким образом, что hello фактическому числу значений ключа сегментирования в данных hello примерно соответствует размеру пакета hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-169">This is because hello service picks hello range size such that hello actual number of sharding key values in hello data approximately matches hello batch size.</span></span> <span data-ttu-id="bede6-170">Это важные tooremember в частности для сегментирования разреженное ключей.</span><span class="sxs-lookup"><span data-stu-id="bede6-170">This is important tooremember in particular for sparsely populated sharding keys.</span></span> 

<span data-ttu-id="bede6-171">**Хранилище метаданных**</span><span class="sxs-lookup"><span data-stu-id="bede6-171">**Metadata storage**</span></span>

<span data-ttu-id="bede6-172">Служба разделения слияния Hello использует toomaintain базы данных, ее состояние и tookeep заносит в журнал во время обработки запроса.</span><span class="sxs-lookup"><span data-stu-id="bede6-172">hello split-merge service uses a database toomaintain its status and tookeep logs during request processing.</span></span> <span data-ttu-id="bede6-173">Hello пользователь создает эту базу данных в своих подписках и предоставляет hello строку подключения для него в файл конфигурации hello для развертывания службы hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-173">hello user creates this database in their subscription and provides hello connection string for it in hello configuration file for hello service deployment.</span></span> <span data-ttu-id="bede6-174">Администраторы организации hello пользователя можно также подключиться toothis ход выполнения запроса tooreview базы данных и tooinvestigate подробные сведения о потенциальных сбоев.</span><span class="sxs-lookup"><span data-stu-id="bede6-174">Administrators from hello user’s organization can also connect toothis database tooreview request progress and tooinvestigate detailed information regarding potential failures.</span></span>

<span data-ttu-id="bede6-175">**Сведения о сегментировании**</span><span class="sxs-lookup"><span data-stu-id="bede6-175">**Sharding-awareness**</span></span>

<span data-ttu-id="bede6-176">Служба разделения слияния Hello различает (1) сегментированной таблицы, таблицы ссылок (2) и (3) в обычных таблицах.</span><span class="sxs-lookup"><span data-stu-id="bede6-176">hello split-merge service differentiates between (1) sharded tables, (2) reference tables, and (3) normal tables.</span></span> <span data-ttu-id="bede6-177">семантика Hello операции split, merge и перемещение зависят от типа hello hello таблица, используемая и определяется следующим образом:</span><span class="sxs-lookup"><span data-stu-id="bede6-177">hello semantics of a split/merge/move operation depend on hello type of hello table used and are defined as follows:</span></span> 

* <span data-ttu-id="bede6-178">**Сегментированными таблицами**: Split, merge и операциями перемещения перемещение подсегментов из источника tootarget сегментов.</span><span class="sxs-lookup"><span data-stu-id="bede6-178">**Sharded tables**: Split, merge, and move operations move shardlets from source tootarget shard.</span></span> <span data-ttu-id="bede6-179">После успешного завершения hello в целом запроса этих Подсегменты больше не присутствует в источнике hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-179">After successful completion of hello overall request, those shardlets are no longer present on hello source.</span></span> <span data-ttu-id="bede6-180">Обратите внимание, что hello целевых таблиц должны tooexist на сегментов целевой hello не должен содержать данные в предыдущих tooprocessing hello целевой диапазон hello операции.</span><span class="sxs-lookup"><span data-stu-id="bede6-180">Note that hello target tables need tooexist on hello target shard and must not contain data in hello target range prior tooprocessing of hello operation.</span></span> 
* <span data-ttu-id="bede6-181">**Ссылаться на таблицы**: ссылочные таблицы, разбиение hello, слияния и переместить операции копирования данных hello из сегментов целевой toohello источника hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-181">**Reference tables**: For reference tables, hello split, merge and move operations copy hello data from hello source toohello target shard.</span></span> <span data-ttu-id="bede6-182">Обратите внимание, что изменения не на в случае hello сегментов целевой для данной таблицы уже существует в этой таблице на целевом сервере hello любую строку.</span><span class="sxs-lookup"><span data-stu-id="bede6-182">Note, however, that no changes occur on hello target shard for a given table if any row is already present in this table on hello target.</span></span> <span data-ttu-id="bede6-183">Таблица Hello имеет toobe пустым для любой ссылки таблицы копирования операции tooget обработки.</span><span class="sxs-lookup"><span data-stu-id="bede6-183">hello table has toobe empty for any reference table copy operation tooget processed.</span></span>
* <span data-ttu-id="bede6-184">**Другие таблицы**: hello источника или назначения hello операции разбиения и слияния могут присутствовать другие таблицы.</span><span class="sxs-lookup"><span data-stu-id="bede6-184">**Other Tables**: Other tables can be present on either hello source or hello target of a split and merge operation.</span></span> <span data-ttu-id="bede6-185">Служба разделения слияния Hello не учитывает эти таблицы для операций копирования или перемещения данных.</span><span class="sxs-lookup"><span data-stu-id="bede6-185">hello split-merge service disregards these tables for any data movement or copy operations.</span></span> <span data-ttu-id="bede6-186">Учтите, что они могут помешать этим операциям в случае наличия ограничений.</span><span class="sxs-lookup"><span data-stu-id="bede6-186">Note, however, that they can interfere with these operations in case of constraints.</span></span>

<span data-ttu-id="bede6-187">сведения о Hello на ссылку или сегментированными таблицами предоставляются hello **SchemaInfo** API-интерфейсов на карте сегментов hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-187">hello information on reference vs. sharded tables is provided by hello **SchemaInfo** APIs on hello shard map.</span></span> <span data-ttu-id="bede6-188">Привет, следующий пример иллюстрирует использование hello этих API-интерфейсов на smm объект диспетчера карты сегментов заданного:</span><span class="sxs-lookup"><span data-stu-id="bede6-188">hello following example illustrates hello use of these APIs on a given shard map manager object smm:</span></span> 

    // Create hello schema annotations 
    SchemaInfo schemaInfo = new SchemaInfo(); 

    // Reference tables 
    schemaInfo.Add(new ReferenceTableInfo("dbo", "region")); 
    schemaInfo.Add(new ReferenceTableInfo("dbo", "nation")); 

    // Sharded tables 
    schemaInfo.Add(new ShardedTableInfo("dbo", "customer", "C_CUSTKEY")); 
    schemaInfo.Add(new ShardedTableInfo("dbo", "orders", "O_CUSTKEY")); 

    // Publish 
    smm.GetSchemaInfoCollection().Add(Configuration.ShardMapName, schemaInfo); 

<span data-ttu-id="bede6-189">Hello таблиц «область» и «Страна» определяются как ссылочные таблицы и будет скопирована с помощью операций split, merge и перемещение.</span><span class="sxs-lookup"><span data-stu-id="bede6-189">hello tables ‘region’ and ‘nation’ are defined as reference tables and will be copied with split/merge/move operations.</span></span> <span data-ttu-id="bede6-190">"клиент" и "заказы", в свою очередь, определяются как сегментированные таблицы.</span><span class="sxs-lookup"><span data-stu-id="bede6-190">‘customer’ and ‘orders’ in turn are defined as sharded tables.</span></span> <span data-ttu-id="bede6-191">C_CUSTKEY и O_CUSTKEY выступать в качестве ключа сегментирования hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-191">C_CUSTKEY and O_CUSTKEY serve as hello sharding key.</span></span> 

<span data-ttu-id="bede6-192">**Ссылочная целостность**</span><span class="sxs-lookup"><span data-stu-id="bede6-192">**Referential Integrity**</span></span>

<span data-ttu-id="bede6-193">Служба разделения слияния Hello анализирует зависимости между таблицами и использует операции hello toostage связей по внешнему ключу первичный ключ для перемещения ссылочных таблиц и ячеек.</span><span class="sxs-lookup"><span data-stu-id="bede6-193">hello split-merge service analyzes dependencies between tables and uses foreign key-primary key relationships toostage hello operations for moving reference tables and shardlets.</span></span> <span data-ttu-id="bede6-194">В общем случае в первую очередь копируются ссылочные таблицы в порядке зависимости, затем копируются шардлеты в порядке их зависимостей в каждом пакете.</span><span class="sxs-lookup"><span data-stu-id="bede6-194">In general, reference tables are copied first in dependency order, then shardlets are copied in order of their dependencies within each batch.</span></span> <span data-ttu-id="bede6-195">Это необходимо, чтобы ограничения FK-PK сегментов целевой hello соблюдаются при поступлении новых данных hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-195">This is necessary so that FK-PK constraints on hello target shard are honored as hello new data arrives.</span></span> 

<span data-ttu-id="bede6-196">**Согласованность сопоставления сегментов и завершение операций**</span><span class="sxs-lookup"><span data-stu-id="bede6-196">**Shard Map Consistency and Eventual Completion**</span></span>

<span data-ttu-id="bede6-197">В присутствии hello сбоев служба разделения слияния hello возобновляется после любого сбоя операции и предназначен toocomplete любого в выполняемых запросов.</span><span class="sxs-lookup"><span data-stu-id="bede6-197">In hello presence of failures, hello split-merge service resumes operations after any outage and aims toocomplete any in progress requests.</span></span> <span data-ttu-id="bede6-198">Тем не менее могут возникнуть неустранимые ситуации, например, при утере или компрометации после восстановления hello целевой сегментов.</span><span class="sxs-lookup"><span data-stu-id="bede6-198">However, there may be unrecoverable situations, e.g., when hello target shard is lost or compromised beyond repair.</span></span> <span data-ttu-id="bede6-199">В таком случае некоторые подсегментов, который должен переместить toobe может продолжаться tooreside на исходном сегменте hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-199">Under those circumstances, some shardlets that were supposed toobe moved may continue tooreside on hello source shard.</span></span> <span data-ttu-id="bede6-200">Служба Hello гарантирует, что Подсегмент сопоставления обновляются только после hello необходимые данные были успешно скопированного toohello целевой.</span><span class="sxs-lookup"><span data-stu-id="bede6-200">hello service ensures that shardlet mappings are only updated after hello necessary data has been successfully copied toohello target.</span></span> <span data-ttu-id="bede6-201">Подсегменты удаляется только на исходном hello после все, что их данные были скопированы целевой toohello и соответствующие сопоставления hello успешно обновлены.</span><span class="sxs-lookup"><span data-stu-id="bede6-201">Shardlets are only deleted on hello source once all their data has been copied toohello target and hello corresponding mappings have been updated successfully.</span></span> <span data-ttu-id="bede6-202">операции удаления Hello происходит в фоновом режиме hello, а диапазон hello уже online на hello целевой сегментов.</span><span class="sxs-lookup"><span data-stu-id="bede6-202">hello deletion operation happens in hello background while hello range is already online on hello target shard.</span></span> <span data-ttu-id="bede6-203">Служба разделения слияния Hello всегда обеспечивает правильность hello сопоставления, которые хранятся в карте сегментов hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-203">hello split-merge service always ensures correctness of hello mappings stored in hello shard map.</span></span>

## <a name="hello-split-merge-user-interface"></a><span data-ttu-id="bede6-204">Hello разделения слияния пользовательского интерфейса</span><span class="sxs-lookup"><span data-stu-id="bede6-204">hello split-merge user interface</span></span>
<span data-ttu-id="bede6-205">пакет службы разделения слияния Hello включает рабочей роли и веб-роли.</span><span class="sxs-lookup"><span data-stu-id="bede6-205">hello split-merge service package includes a worker role and a web role.</span></span> <span data-ttu-id="bede6-206">Hello веб-роль — запросы разделения слияния используется toosubmit интерактивной.</span><span class="sxs-lookup"><span data-stu-id="bede6-206">hello web role is used toosubmit split-merge requests in an interactive way.</span></span> <span data-ttu-id="bede6-207">Существуют следующие основные компоненты пользовательского интерфейса hello Hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-207">hello main components of hello user interface are as follows:</span></span>

* <span data-ttu-id="bede6-208">Тип операции: hello тип операции — переключатель, который управляет hello тип операции, выполняемой службой hello для данного запроса.</span><span class="sxs-lookup"><span data-stu-id="bede6-208">Operation Type: hello operation type is a radio button that controls hello kind of operation performed by hello service for this request.</span></span> <span data-ttu-id="bede6-209">Можно выбрать между разбиение hello, слияния и сценарии перемещения.</span><span class="sxs-lookup"><span data-stu-id="bede6-209">You can choose between hello split, merge and move scenarios.</span></span> <span data-ttu-id="bede6-210">Кроме того, запрошенную ранее операцию можно отменить.</span><span class="sxs-lookup"><span data-stu-id="bede6-210">You can also cancel a previously submitted operation.</span></span> <span data-ttu-id="bede6-211">Можно использовать запросы на разбиение или объединение, а также перемещать запросы сопоставлений сегментов по диапазону.</span><span class="sxs-lookup"><span data-stu-id="bede6-211">You can use split, merge and move requests for range shard maps.</span></span> <span data-ttu-id="bede6-212">Сопоставления сегментов по списку поддерживают только операции перемещения.</span><span class="sxs-lookup"><span data-stu-id="bede6-212">List shard maps only support move operations.</span></span>
* <span data-ttu-id="bede6-213">Карта сегментов: hello следующей части запроса параметры обложки сведения карта сегментов hello и hello размещения на карте сегментов базы данных.</span><span class="sxs-lookup"><span data-stu-id="bede6-213">Shard Map: hello next section of request parameters cover information about hello shard map and hello database hosting your shard map.</span></span> <span data-ttu-id="bede6-214">В частности нужно tooprovide hello имя сервера базы данных SQL Azure hello и размещения hello shardmap базы данных, учетные данные tooconnect toohello сегменте сопоставить базу данных и наконец hello имя карты сегментов hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-214">In particular, you need tooprovide hello name of hello Azure SQL Database server and database hosting hello shardmap, credentials tooconnect toohello shard map database, and finally hello name of hello shard map.</span></span> <span data-ttu-id="bede6-215">В настоящее время операция hello принимает только один набор учетных данных.</span><span class="sxs-lookup"><span data-stu-id="bede6-215">Currently, hello operation only accepts a single set of credentials.</span></span> <span data-ttu-id="bede6-216">Эти учетные данные требуются достаточные разрешения toohave tooperform изменяет toohello карта сегментов, а также toohello данные пользователей на сегменты hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-216">These credentials need toohave sufficient permissions tooperform changes toohello shard map as well as toohello user data on hello shards.</span></span>
* <span data-ttu-id="bede6-217">Диапазон источника (операции разбиения и объединения). Операции разбиения и объединения обрабатывают диапазон, используя его нижний и верхний ключ.</span><span class="sxs-lookup"><span data-stu-id="bede6-217">Source Range (split and merge): A split and merge operation processes a range using its low and high key.</span></span> <span data-ttu-id="bede6-218">toospecify операции с неограниченными верхнее значение ключа, проверьте флажок «max верхний ключ» hello и hello высокой ключа поле остается пустым.</span><span class="sxs-lookup"><span data-stu-id="bede6-218">toospecify an operation with an unbounded high key value, check hello “High key is max” check box and leave hello high key field empty.</span></span> <span data-ttu-id="bede6-219">Hello диапазон значений ключа, можно указать сделать не соответствует tooprecisely необходимость сопоставления и его границ на карте сегментов.</span><span class="sxs-lookup"><span data-stu-id="bede6-219">hello range key values that you specify do not need tooprecisely match a mapping and its boundaries in your shard map.</span></span> <span data-ttu-id="bede6-220">Если вообще не указать все границы диапазона hello службы будет автоматически определять hello ближайший диапазона для вас.</span><span class="sxs-lookup"><span data-stu-id="bede6-220">If you do not specify any range boundaries at all hello service will infer hello closest range for you automatically.</span></span> <span data-ttu-id="bede6-221">Можно использовать hello GetMappings.ps1 PowerShell скрипт tooretrieve hello текущего сопоставления на карте данного сегмента.</span><span class="sxs-lookup"><span data-stu-id="bede6-221">You can use hello GetMappings.ps1 PowerShell script tooretrieve hello current mappings in a given shard map.</span></span>
* <span data-ttu-id="bede6-222">Разбиения в работе источника (разделен): для операции split диапазон hello точки toosplit hello источника.</span><span class="sxs-lookup"><span data-stu-id="bede6-222">Split Source Behavior (split): For split operations, define hello point toosplit hello source range.</span></span> <span data-ttu-id="bede6-223">Это делается, предоставляя место hello, разделенные toooccur ключа сегментирования hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-223">You do this by providing hello sharding key where you want hello split toooccur.</span></span> <span data-ttu-id="bede6-224">Используйте hello переключатель укажите следует toomove верхней части hello (включая hello разбиение ключ) или потребность в нижней части hello toomove hello диапазон (исключая hello разбиения ключа).</span><span class="sxs-lookup"><span data-stu-id="bede6-224">Use hello radio button specify whether you want hello lower part of hello range (excluding hello split key) toomove, or whether you want hello upper part toomove (including hello split key).</span></span>
* <span data-ttu-id="bede6-225">Источник подсегмента (перемещения): переместить операции отличаются от разбиения или слияния операций, они не требуют источника диапазона toodescribe hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-225">Source Shardlet (move): Move operations are different from split or merge operations as they do not require a range toodescribe hello source.</span></span> <span data-ttu-id="bede6-226">Источник для перемещения просто определяется значение ключа сегментирования hello планировать toomove.</span><span class="sxs-lookup"><span data-stu-id="bede6-226">A source for move is simply identified by hello sharding key value that you plan toomove.</span></span>
* <span data-ttu-id="bede6-227">Целевой сегментов (разделен): после ввода сведений hello в исходном hello операцию разбиения необходимо toodefine место toobe hello данные копируются tooby обеспечивает hello базу данных SQL Azure сервера и базы данных для целевого объекта hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-227">Target Shard (split): Once you have provided hello information on hello source of your split operation, you need toodefine where you want hello data toobe copied tooby providing hello Azure SQL Db server and database name for hello target.</span></span>
* <span data-ttu-id="bede6-228">Целевой диапазон (объединения): операций слияния перемещение подсегментов tooan существующего сегмента.</span><span class="sxs-lookup"><span data-stu-id="bede6-228">Target Range (merge): Merge operations move shardlets tooan existing shard.</span></span> <span data-ttu-id="bede6-229">Определите hello существующего сегмента, предоставляя границы диапазона hello hello существующий диапазон toomerge с.</span><span class="sxs-lookup"><span data-stu-id="bede6-229">You identify hello existing shard by providing hello range boundaries of hello existing range that you want toomerge with.</span></span>
* <span data-ttu-id="bede6-230">Размер пакета: hello пакета размеров элементов управления hello число ячеек, который переходит в автономный режим во время перемещения данных hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-230">Batch Size: hello batch size controls hello number of shardlets that will go offline at a time during hello data movement.</span></span> <span data-ttu-id="bede6-231">Это целочисленное значение, где можно использовать меньшие значения при конфиденциальных toolong периоды простоя для подсегментов.</span><span class="sxs-lookup"><span data-stu-id="bede6-231">This is an integer value where you can use smaller values when you are sensitive toolong periods of downtime for shardlets.</span></span> <span data-ttu-id="bede6-232">Большие значения приведет к увеличению времени hello Подсегмент, но вне сети может повысить производительность.</span><span class="sxs-lookup"><span data-stu-id="bede6-232">Larger values will increase hello time that a given shardlet is offline but may improve performance.</span></span>
* <span data-ttu-id="bede6-233">Код операции (Отмена): Если выполняемая операция больше не нужны, можно отменить hello операцию, указав его идентификатор операции в этом поле.</span><span class="sxs-lookup"><span data-stu-id="bede6-233">Operation Id (Cancel): If you have an ongoing operation that is no longer needed, you can cancel hello operation by providing its operation ID in this field.</span></span> <span data-ttu-id="bede6-234">Идентификатор операции hello можно получить из таблицы состояния hello запроса (см. раздел 8.1) или из выходных данных hello в веб-браузере hello, осуществляющими отправку запроса hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-234">You can retrieve hello operation ID from hello request status table (see Section 8.1) or from hello output in hello web browser where you submitted hello request.</span></span>

## <a name="requirements-and-limitations"></a><span data-ttu-id="bede6-235">Требования и ограничения</span><span class="sxs-lookup"><span data-stu-id="bede6-235">Requirements and Limitations</span></span>
<span data-ttu-id="bede6-236">Текущая реализация службы разделения слияния hello Hello — тема toohello следующие требования и ограничения:</span><span class="sxs-lookup"><span data-stu-id="bede6-236">hello current implementation of hello split-merge service is subject toohello following requirements and limitations:</span></span> 

* <span data-ttu-id="bede6-237">сегменты Hello требуется tooexist и быть зарегистрирован в карте сегментов hello перед выполнением операции слияния разбиение на этих сегментов.</span><span class="sxs-lookup"><span data-stu-id="bede6-237">hello shards need tooexist and be registered in hello shard map before a split-merge operation on these shards can be performed.</span></span> 
* <span data-ttu-id="bede6-238">Служба Hello не создает таблиц или других объектов базы данных автоматически как часть его операций.</span><span class="sxs-lookup"><span data-stu-id="bede6-238">hello service does not create tables or any other database objects automatically as part of its operations.</span></span> <span data-ttu-id="bede6-239">Это означает, что hello схему для всех сегментированных таблиц и ссылаться на таблицы должны tooexist hello целевой сегментов предыдущих tooany split, merge и перемещение операции.</span><span class="sxs-lookup"><span data-stu-id="bede6-239">This means that hello schema for all sharded tables and reference tables need tooexist on hello target shard prior tooany split/merge/move operation.</span></span> <span data-ttu-id="bede6-240">В частности, необходимые toobe пустым в диапазоне hello которых toobe добавлен с помощью операции split, merge и перемещение новых подсегментов являются Сегментированные таблицы.</span><span class="sxs-lookup"><span data-stu-id="bede6-240">Sharded tables in particular are required toobe empty in hello range where new shardlets are toobe added by a split/merge/move operation.</span></span> <span data-ttu-id="bede6-241">В противном случае hello операция завершится ошибкой проверки согласованности начальной hello hello целевой сегментов.</span><span class="sxs-lookup"><span data-stu-id="bede6-241">Otherwise, hello operation will fail hello initial consistency check on hello target shard.</span></span> <span data-ttu-id="bede6-242">Также Обратите внимание, что ссылочные данные будет копироваться только в том случае, если hello ссылочная таблица является пустым и нет, не согласованы гарантирует учета tooother одновременную запись операции на hello ссылочные таблицы.</span><span class="sxs-lookup"><span data-stu-id="bede6-242">Also note that reference data is only copied if hello reference table is empty and that there are no consistency guarantees with regard tooother concurrent write operations on hello reference tables.</span></span> <span data-ttu-id="bede6-243">Эта рекомендация: при выполнении операции разбиения или слияния, никакие другие операции записи изменения toohello ссылочные таблицы.</span><span class="sxs-lookup"><span data-stu-id="bede6-243">We recommend this: when running split/merge operations, no other write operations make changes toohello reference tables.</span></span>
* <span data-ttu-id="bede6-244">Служба Hello использует идентификатор строки, уникальный индекс или ключ, который включает в себя hello сегментирования ключа tooimprove производительность и надежность для больших подсегментов.</span><span class="sxs-lookup"><span data-stu-id="bede6-244">hello service relies on row identity established by a unique index or key that includes hello sharding key tooimprove performance and reliability for large shardlets.</span></span> <span data-ttu-id="bede6-245">Это позволяет hello службы toomove данные с даже высокой степенью детализации, чем просто hello значение ключа сегментирования.</span><span class="sxs-lookup"><span data-stu-id="bede6-245">This allows hello service toomove data at an even finer granularity than just hello sharding key value.</span></span> <span data-ttu-id="bede6-246">Это помогает tooreduce hello максимальный объем места в журнале и блокировок, которые требуются во время операции hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-246">This helps tooreduce hello maximum amount of log space and locks that are required during hello operation.</span></span> <span data-ttu-id="bede6-247">Рекомендуется создать уникальный индекс или первичный ключ, включая hello ключа сегментирования для данной таблицы, если требуется, чтобы toouse этой таблицы разбиения или слияния или перемещения запросов.</span><span class="sxs-lookup"><span data-stu-id="bede6-247">Consider creating a unique index or a primary key including hello sharding key on a given table if you want toouse that table with split/merge/move requests.</span></span> <span data-ttu-id="bede6-248">Из соображений производительности ключ сегментирования hello должен быть hello начальный столбец в hello ключ или индекс hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-248">For performance reasons, hello sharding key should be hello leading column in hello key or hello index.</span></span>
* <span data-ttu-id="bede6-249">Ходе hello обработки запросов некоторые данные ячеек могут присутствовать на hello исходного и целевого сегментов hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-249">During hello course of request processing, some shardlet data may be present both on hello source and hello target shard.</span></span> <span data-ttu-id="bede6-250">Это необходимые tooprotect от сбоев во время перемещения строк сегментов hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-250">This is necessary tooprotect against failures during hello shardlet movement.</span></span> <span data-ttu-id="bede6-251">Hello интеграцию разделения слияния с карты сегментов hello гарантирует, что подключений через hello данных зависимых маршрутизации API-интерфейсов с помощью hello **OpenConnectionForKey** методом на карте сегментов hello не видите все несогласованные промежуточных состояний.</span><span class="sxs-lookup"><span data-stu-id="bede6-251">hello integration of split-merge with hello shard map ensures that connections through hello data dependent routing APIs using hello **OpenConnectionForKey** method on hello shard map do not see any inconsistent intermediate states.</span></span> <span data-ttu-id="bede6-252">Тем не менее, при подключении источника toohello или hello предназначены сегментов без использования hello **OpenConnectionForKey** метод, несогласованные промежуточных состояний может отображаться в split, merge и перемещение запросы выполняются.</span><span class="sxs-lookup"><span data-stu-id="bede6-252">However, when connecting toohello source or hello target shards without using hello **OpenConnectionForKey** method, inconsistent intermediate states might be visible when split/merge/move requests are going on.</span></span> <span data-ttu-id="bede6-253">Эти подключения могут отображаться или часть повторяющиеся результаты в зависимости от времени hello или Базовое соединение hello hello сегментов.</span><span class="sxs-lookup"><span data-stu-id="bede6-253">These connections may show partial or duplicate results depending on hello timing or hello shard underlying hello connection.</span></span> <span data-ttu-id="bede6-254">В настоящее время это ограничение включает hello соединения с несколькими Shard гибкого масштабирования-запросы.</span><span class="sxs-lookup"><span data-stu-id="bede6-254">This limitation currently includes hello connections made by Elastic Scale Multi-Shard-Queries.</span></span>
* <span data-ttu-id="bede6-255">Hello базы данных метаданных для службы разделения слияния hello не должен быть общим между ролями.</span><span class="sxs-lookup"><span data-stu-id="bede6-255">hello metadata database for hello split-merge service must not be shared between different roles.</span></span> <span data-ttu-id="bede6-256">Например роль hello разделения слияния службой, работающей в промежуточной потребностей toopoint tooa различные метаданные базы данных от hello рабочей роли.</span><span class="sxs-lookup"><span data-stu-id="bede6-256">For example, a role of hello split-merge service running in staging needs toopoint tooa different metadata database than hello production role.</span></span>

## <a name="billing"></a><span data-ttu-id="bede6-257">Выставление счетов</span><span class="sxs-lookup"><span data-stu-id="bede6-257">Billing</span></span>
<span data-ttu-id="bede6-258">Hello разделения слияния служба выполняется как облачной службы в вашей подписке Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="bede6-258">hello split-merge service runs as a cloud service in your Microsoft Azure subscription.</span></span> <span data-ttu-id="bede6-259">Поэтому tooyour экземпляр службы hello взимается плата за для облачных служб.</span><span class="sxs-lookup"><span data-stu-id="bede6-259">Therefore charges for cloud services apply tooyour instance of hello service.</span></span> <span data-ttu-id="bede6-260">Если вы нечасто выполняете операции разбиения, объединения и перемещения, рекомендуем удалить облачную службу разбиения и объединения.</span><span class="sxs-lookup"><span data-stu-id="bede6-260">Unless you frequently perform split/merge/move operations, we recommend you delete your split-merge cloud service.</span></span> <span data-ttu-id="bede6-261">Это поможет сократить расходы на действующие или развернутые экземпляры облачной службы.</span><span class="sxs-lookup"><span data-stu-id="bede6-261">That saves costs for running or deployed cloud service instances.</span></span> <span data-ttu-id="bede6-262">Можно повторно развернуть и начать легко выполнить настройку, при необходимости tooperform разбиение и объединение операций.</span><span class="sxs-lookup"><span data-stu-id="bede6-262">You can re-deploy and start your readily runnable configuration whenever you need tooperform split or merge operations.</span></span> 

## <a name="monitoring"></a><span data-ttu-id="bede6-263">Мониторинг</span><span class="sxs-lookup"><span data-stu-id="bede6-263">Monitoring</span></span>
### <a name="status-tables"></a><span data-ttu-id="bede6-264">Таблицы состояния</span><span class="sxs-lookup"><span data-stu-id="bede6-264">Status tables</span></span>
<span data-ttu-id="bede6-265">Hello разделения слияния служба предоставляет hello **RequestStatus** таблицы в базе данных хранилища метаданных hello для наблюдения за выполненной и текущих запросов.</span><span class="sxs-lookup"><span data-stu-id="bede6-265">hello split-merge Service provides hello **RequestStatus** table in hello metadata store database for monitoring of completed and ongoing requests.</span></span> <span data-ttu-id="bede6-266">Ниже приведены Hello строку для каждого запроса разделения слияния, которое было отправлено toothis экземпляр службы разделения слияния hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-266">hello table lists a row for each split-merge request that has been submitted toothis instance of hello split-merge service.</span></span> <span data-ttu-id="bede6-267">Он предоставляет следующую информацию для каждого запроса hello:</span><span class="sxs-lookup"><span data-stu-id="bede6-267">It gives hello following information for each request:</span></span>

* <span data-ttu-id="bede6-268">**Отметка времени**: hello время и Дата начала запроса hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-268">**Timestamp**: hello time and date when hello request was started.</span></span>
* <span data-ttu-id="bede6-269">**ИД операции**: GUID, однозначно определяющий запрос hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-269">**OperationId**: A GUID that uniquely identifies hello request.</span></span> <span data-ttu-id="bede6-270">Этот запрос также может быть используется toocancel hello операции во время его по-прежнему.</span><span class="sxs-lookup"><span data-stu-id="bede6-270">This request can also be used toocancel hello operation while it is still ongoing.</span></span>
* <span data-ttu-id="bede6-271">**Состояние**: hello текущее состояние запроса hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-271">**Status**: hello current state of hello request.</span></span> <span data-ttu-id="bede6-272">Для текущих запросов на ней также указаны hello текущую фазу, в какие hello является запрос.</span><span class="sxs-lookup"><span data-stu-id="bede6-272">For ongoing requests, it also lists hello current phase in which hello request is.</span></span>
* <span data-ttu-id="bede6-273">**CancelRequest**: флаг, указывающий, отменено ли запрос hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-273">**CancelRequest**: A flag that indicates whether hello request has been cancelled.</span></span>
* <span data-ttu-id="bede6-274">**Ход выполнения**: для подсчета процент завершения для операции hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-274">**Progress**: A percentage estimate of completion for hello operation.</span></span> <span data-ttu-id="bede6-275">Значение 50 указывает на то, что операция hello примерно на 50% завершено.</span><span class="sxs-lookup"><span data-stu-id="bede6-275">A value of 50 indicates that hello operation is approximately 50% complete.</span></span>
* <span data-ttu-id="bede6-276">**Details**: более подробный отчет о ходе выполнения в формате XML.</span><span class="sxs-lookup"><span data-stu-id="bede6-276">**Details**: An XML value that provides a more detailed progress report.</span></span> <span data-ttu-id="bede6-277">наборы строк копируются из исходного tootarget Hello отчет о ходе выполнения периодически обновляется.</span><span class="sxs-lookup"><span data-stu-id="bede6-277">hello progress report is periodically updated as sets of rows are copied from source tootarget.</span></span> <span data-ttu-id="bede6-278">В случае ошибки или исключения этот столбец также включает более подробные сведения о сбоях hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-278">In case of failures or exceptions, this column also includes more detailed information about hello failure.</span></span>

### <a name="azure-diagnostics"></a><span data-ttu-id="bede6-279">Диагностика Azure</span><span class="sxs-lookup"><span data-stu-id="bede6-279">Azure Diagnostics</span></span>
<span data-ttu-id="bede6-280">Служба разделения слияния Hello использует диагностику Azure, в зависимости от пакета Azure SDK 2.5 наблюдения и диагностики.</span><span class="sxs-lookup"><span data-stu-id="bede6-280">hello split-merge service uses Azure Diagnostics based on Azure SDK 2.5 for monitoring and diagnostics.</span></span> <span data-ttu-id="bede6-281">Управлять конфигурация диагностики hello, как описано здесь: [включение диагностики в облачных службах Azure и виртуальные машины](../cloud-services/cloud-services-dotnet-diagnostics.md).</span><span class="sxs-lookup"><span data-stu-id="bede6-281">You control hello diagnostics configuration as explained here: [Enabling Diagnostics in Azure Cloud Services and Virtual Machines](../cloud-services/cloud-services-dotnet-diagnostics.md).</span></span> <span data-ttu-id="bede6-282">Hello пакет загрузки включает в себя две конфигурации диагностики — один для hello веб-роли и один для hello рабочей роли.</span><span class="sxs-lookup"><span data-stu-id="bede6-282">hello download package includes two diagnostics configurations - one for hello web role and one for hello worker role.</span></span> <span data-ttu-id="bede6-283">Эти конфигурации диагностики для службы hello следовать указаниям hello из [Основы облачных служб в Microsoft Azure](https://code.msdn.microsoft.com/windowsazure/Cloud-Service-Fundamentals-4ca72649).</span><span class="sxs-lookup"><span data-stu-id="bede6-283">These diagnostics configurations for hello service follow hello guidance from [Cloud Service Fundamentals in Microsoft Azure](https://code.msdn.microsoft.com/windowsazure/Cloud-Service-Fundamentals-4ca72649).</span></span> <span data-ttu-id="bede6-284">Он включает в себя определения hello toolog счетчики производительности, журналы IIS, журналы событий Windows и журналы событий приложений разделения слияния.</span><span class="sxs-lookup"><span data-stu-id="bede6-284">It includes hello definitions toolog Performance Counters, IIS logs, Windows Event Logs, and split-merge application event logs.</span></span> 

## <a name="deploy-diagnostics"></a><span data-ttu-id="bede6-285">Развертывание диагностики</span><span class="sxs-lookup"><span data-stu-id="bede6-285">Deploy Diagnostics</span></span>
<span data-ttu-id="bede6-286">Здравствуйте, tooenable наблюдения и диагностики с помощью конфигурации диагностики для hello и рабочие роли, предоставляемые выполнения hello следующих команд Azure PowerShell с помощью пакета NuGet hello:</span><span class="sxs-lookup"><span data-stu-id="bede6-286">tooenable monitoring and diagnostics using hello diagnostic configuration for hello web and worker roles provided by hello NuGet package, run hello following commands using Azure PowerShell:</span></span> 

    $storage_name = "<YourAzureStorageAccount>" 

    $key = "<YourAzureStorageAccountKey" 

    $storageContext = New-AzureStorageContext -StorageAccountName $storage_name -StorageAccountKey $key  


    $config_path = "<YourFilePath>\SplitMergeWebContent.diagnostics.xml" 

    $service_name = "<YourCloudServiceName>" 

    Set-AzureServiceDiagnosticsExtension -StorageContext $storageContext -DiagnosticsConfigurationPath $config_path -ServiceName $service_name -Slot Production -Role "SplitMergeWeb" 


    $config_path = "<YourFilePath>\SplitMergeWorkerContent.diagnostics.xml" 

    $service_name = "<YourCloudServiceName>" 

    Set-AzureServiceDiagnosticsExtension -StorageContext $storageContext -DiagnosticsConfigurationPath $config_path -ServiceName $service_name -Slot Production -Role "SplitMergeWorker" 

<span data-ttu-id="bede6-287">Дополнительные сведения о том, как можно найти tooconfigure здесь параметры диагностики и развертывания: [включение диагностики в облачных службах Azure и виртуальные машины](../cloud-services/cloud-services-dotnet-diagnostics.md).</span><span class="sxs-lookup"><span data-stu-id="bede6-287">You can find more information on how tooconfigure and deploy diagnostics settings here: [Enabling Diagnostics in Azure Cloud Services and Virtual Machines](../cloud-services/cloud-services-dotnet-diagnostics.md).</span></span> 

## <a name="retrieve-diagnostics"></a><span data-ttu-id="bede6-288">Получение диагностики</span><span class="sxs-lookup"><span data-stu-id="bede6-288">Retrieve diagnostics</span></span>
<span data-ttu-id="bede6-289">Можно легко получить диагностики hello обозревателя серверов Visual Studio в Azure — часть дерева обозревателя сервера hello hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-289">You can easily access your diagnostics from hello Visual Studio Server Explorer in hello Azure part of hello Server Explorer tree.</span></span> <span data-ttu-id="bede6-290">Откройте экземпляр Visual Studio и выберите представление и обозреватель серверов в меню hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-290">Open a Visual Studio instance, and in hello menu bar click View, and Server Explorer.</span></span> <span data-ttu-id="bede6-291">Щелкните tooyour tooconnect значок Azure hello подписки Azure.</span><span class="sxs-lookup"><span data-stu-id="bede6-291">Click hello Azure icon tooconnect tooyour Azure subscription.</span></span> <span data-ttu-id="bede6-292">Затем перейдите tooAzure "->" хранилище "->" <your storage account> "->" таблицы -> WADLogsTable.</span><span class="sxs-lookup"><span data-stu-id="bede6-292">Then navigate tooAzure -> Storage -> <your storage account> -> Tables -> WADLogsTable.</span></span> <span data-ttu-id="bede6-293">Дополнительные сведения см. в статье с [обзором ресурсов хранилища с помощью обозревателя сервера](http://msdn.microsoft.com/library/azure/ff683677.aspx).</span><span class="sxs-lookup"><span data-stu-id="bede6-293">For more information, see [Browsing Storage Resources with Server Explorer](http://msdn.microsoft.com/library/azure/ff683677.aspx).</span></span> 

![WADLogsTable][2]

<span data-ttu-id="bede6-295">Hello WADLogsTable выделены на приведенном выше рисунке hello содержит hello подробные события из журнала приложений службы разделения слияния hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-295">hello WADLogsTable highlighted in hello figure above contains hello detailed events from hello split-merge service’s application log.</span></span> <span data-ttu-id="bede6-296">Обратите внимание, конфигурация по умолчанию hello hello загрузить пакет, предназначенные для развертывания в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="bede6-296">Note that hello default configuration of hello downloaded package is geared towards a production deployment.</span></span> <span data-ttu-id="bede6-297">Поэтому интервал приветствия, по которому журналов и счетчиков извлекаются из экземпляров службы hello — большой (5 минут).</span><span class="sxs-lookup"><span data-stu-id="bede6-297">Therefore hello interval at which logs and counters are pulled from hello service instances is large (5 minutes).</span></span> <span data-ttu-id="bede6-298">Для тестирования и разработки должен нижней интервал приветствия путем настройки параметров диагностики hello hello web или hello рабочей роли tooyour.</span><span class="sxs-lookup"><span data-stu-id="bede6-298">For test and development, lower hello interval by adjusting hello diagnostics settings of hello web or hello worker role tooyour needs.</span></span> <span data-ttu-id="bede6-299">Щелкните правой кнопкой мыши в роли hello в hello обозревателя серверов Visual Studio (см. выше), а затем настроить hello период передачи в диалоговом окне приветствия для параметров конфигурации диагностики hello:</span><span class="sxs-lookup"><span data-stu-id="bede6-299">Right-click on hello role in hello Visual Studio Server Explorer (see above) and then adjust hello Transfer Period in hello dialog for hello Diagnostics configuration settings:</span></span> 

![Конфигурация][3]

## <a name="performance"></a><span data-ttu-id="bede6-301">Производительность</span><span class="sxs-lookup"><span data-stu-id="bede6-301">Performance</span></span>
<span data-ttu-id="bede6-302">Как правило более высокую производительность является toobe, ожидаемых в более поздней версии, hello дополнительные уровни обслуживания высокопроизводительных в базе данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="bede6-302">In general, better performance is toobe expected from hello higher, more performant service tiers in Azure SQL Database.</span></span> <span data-ttu-id="bede6-303">Выше распределения операций ввода-ВЫВОДА, ЦП и памяти для более высокими уровнями служб hello способствовать hello массового копирования и удаления, которые служба разделения слияния использует hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-303">Higher IO, CPU and memory allocations for hello higher service tiers benefit hello bulk copy and delete operations that hello split-merge service uses.</span></span> <span data-ttu-id="bede6-304">По этой причине увеличивайте уровень служб hello только для этих баз данных определено, ограниченный период времени.</span><span class="sxs-lookup"><span data-stu-id="bede6-304">For that reason, increase hello service tier just for those databases for a defined, limited period of time.</span></span>

<span data-ttu-id="bede6-305">Служба Hello также выполняет проверку запросов как часть его нормальной работы.</span><span class="sxs-lookup"><span data-stu-id="bede6-305">hello service also performs validation queries as part of its normal operations.</span></span> <span data-ttu-id="bede6-306">Эти запросы проверки наличия непредвиденные данные в целевой диапазон hello и убедитесь, что любая операция split, merge и перемещение начинается от согласованное состояние.</span><span class="sxs-lookup"><span data-stu-id="bede6-306">These validation queries check for unexpected presence of data in hello target range and ensure that any split/merge/move operation starts from a consistent state.</span></span> <span data-ttu-id="bede6-307">Эти запросы все работающие диапазонов ключей сегментирования, определяемый hello область операции hello и размер пакета hello предоставляется как часть определения запроса hello.</span><span class="sxs-lookup"><span data-stu-id="bede6-307">These queries all work over sharding key ranges defined by hello scope of hello operation and hello batch size provided as part of hello request definition.</span></span> <span data-ttu-id="bede6-308">Эти запросы выполнения лучше всего индекса, присутствует с ключом сегментирования hello, что hello начальный столбец.</span><span class="sxs-lookup"><span data-stu-id="bede6-308">These queries perform best when an index is present that has hello sharding key as hello leading column.</span></span> 

<span data-ttu-id="bede6-309">Кроме того свойство уникальности hello ключом сегментирования, что начальный столбец hello позволит toouse службы hello оптимизированный подход, который ограничивает потребление ресурсов с точки зрения места в журнале и памяти.</span><span class="sxs-lookup"><span data-stu-id="bede6-309">In addition, a uniqueness property with hello sharding key as hello leading column will allow hello service toouse an optimized approach that limits resource consumption in terms of log space and memory.</span></span> <span data-ttu-id="bede6-310">Это свойство уникальности является обязательным toomove размеры большие объемы данных (обычно превышает 1 ГБ).</span><span class="sxs-lookup"><span data-stu-id="bede6-310">This uniqueness property is required toomove large data sizes (typically above 1GB).</span></span> 

## <a name="how-tooupgrade"></a><span data-ttu-id="bede6-311">Как tooupgrade</span><span class="sxs-lookup"><span data-stu-id="bede6-311">How tooupgrade</span></span>
1. <span data-ttu-id="bede6-312">Следуйте указаниям hello [развертывание службы разделения слияния](sql-database-elastic-scale-configure-deploy-split-and-merge.md).</span><span class="sxs-lookup"><span data-stu-id="bede6-312">Follow hello steps in [Deploy a split-merge service](sql-database-elastic-scale-configure-deploy-split-and-merge.md).</span></span>
2. <span data-ttu-id="bede6-313">Изменение файла конфигурации облачной службы для развертывания разделения слияния tooreflect hello новые параметры.</span><span class="sxs-lookup"><span data-stu-id="bede6-313">Change your cloud service configuration file for your split-merge deployment tooreflect hello new configuration parameters.</span></span> <span data-ttu-id="bede6-314">Новый обязательный параметр — hello сведения о сертификате hello, используемый для шифрования.</span><span class="sxs-lookup"><span data-stu-id="bede6-314">A new required parameter is hello information about hello certificate used for encryption.</span></span> <span data-ttu-id="bede6-315">Простой способ toodo это toocompare hello новый шаблон файл конфигурации из загрузки hello к существующей конфигурации.</span><span class="sxs-lookup"><span data-stu-id="bede6-315">An easy way toodo this is toocompare hello new configuration template file from hello download against your existing configuration.</span></span> <span data-ttu-id="bede6-316">Убедитесь, что добавление hello параметры «DataEncryptionPrimaryCertificateThumbprint» и «DataEncryptionPrimary» для веб-hello и hello рабочей роли.</span><span class="sxs-lookup"><span data-stu-id="bede6-316">Make sure you add hello settings for “DataEncryptionPrimaryCertificateThumbprint” and “DataEncryptionPrimary” for both hello web and hello worker role.</span></span>
3. <span data-ttu-id="bede6-317">Перед развертыванием обновления tooAzure hello, убедитесь, что все операции, запущенных в настоящее время разделения слияния завершено.</span><span class="sxs-lookup"><span data-stu-id="bede6-317">Before deploying hello update tooAzure, ensure that all currently running split-merge operations have finished.</span></span> <span data-ttu-id="bede6-318">Это легко можно сделать с помощью запроса hello RequestStatus PendingWorkflows таблиц и hello метаданные слияния разбиения базы данных для текущих запросов.</span><span class="sxs-lookup"><span data-stu-id="bede6-318">You can easily do this by querying hello RequestStatus and PendingWorkflows tables in hello split-merge metadata database for ongoing requests.</span></span>
4. <span data-ttu-id="bede6-319">Обновите существующие развертывания облачной службы для разделения слияния в вашей подписке Azure с новым пакетом hello и файле конфигурации обновленной службы.</span><span class="sxs-lookup"><span data-stu-id="bede6-319">Update your existing cloud service deployment for split-merge in your Azure subscription with hello new package and your updated service configuration file.</span></span>

<span data-ttu-id="bede6-320">Для разделения слияния tooupgrade необязательно tooprovision новую базу данных метаданных.</span><span class="sxs-lookup"><span data-stu-id="bede6-320">You do not need tooprovision a new metadata database for split-merge tooupgrade.</span></span> <span data-ttu-id="bede6-321">Новая версия Hello будет автоматически выполнено обновление существующих метаданных базы данных toohello новой версии.</span><span class="sxs-lookup"><span data-stu-id="bede6-321">hello new version will automatically upgrade your existing metadata database toohello new version.</span></span> 

## <a name="best-practices--troubleshooting"></a><span data-ttu-id="bede6-322">Рекомендации и устранение неполадок</span><span class="sxs-lookup"><span data-stu-id="bede6-322">Best practices & troubleshooting</span></span>
* <span data-ttu-id="bede6-323">Определите тестового клиента и следовать наиболее важные операции split, merge и перемещение с тестовым клиентом hello между несколькими сегментами.</span><span class="sxs-lookup"><span data-stu-id="bede6-323">Define a test tenant and exercise your most important split/merge/move operations with hello test tenant across several shards.</span></span> <span data-ttu-id="bede6-324">Убедитесь, правильно определен все метаданные в карте сегментов и операций hello нарушают ограничения или внешние ключи.</span><span class="sxs-lookup"><span data-stu-id="bede6-324">Ensure that all metadata is defined correctly in your shard map and that hello operations do not violate constraints or foreign keys.</span></span>
* <span data-ttu-id="bede6-325">Размер данных клиента теста hello Keep выше hello максимальный размер данных большого клиента tooensure размер данных не возникает проблем, связанных с.</span><span class="sxs-lookup"><span data-stu-id="bede6-325">Keep hello test tenant data size above hello maximum data size of your largest tenant tooensure you are not encountering data size related issues.</span></span> <span data-ttu-id="bede6-326">Это помогает оценить верхнюю границу на hello время toomove вокруг одного клиента.</span><span class="sxs-lookup"><span data-stu-id="bede6-326">This helps you assess an upper bound on hello time it takes toomove a single tenant around.</span></span> 
* <span data-ttu-id="bede6-327">Убедитесь, что схема допускает удаления.</span><span class="sxs-lookup"><span data-stu-id="bede6-327">Make sure that your schema allows deletions.</span></span> <span data-ttu-id="bede6-328">Служба разделения слияния Hello требует hello возможность tooremove данные из источника сегментов hello после hello данные были успешно скопированного toohello цели.</span><span class="sxs-lookup"><span data-stu-id="bede6-328">hello split-merge service requires hello ability tooremove data from hello source shard once hello data has been successfully copied toohello target.</span></span> <span data-ttu-id="bede6-329">Например **удаление триггеров** можно предотвратить удаление данных hello в источнике hello hello службы и может привести к toofail операций.</span><span class="sxs-lookup"><span data-stu-id="bede6-329">For example, **delete triggers** can prevent hello service from deleting hello data on hello source and may cause operations toofail.</span></span>
* <span data-ttu-id="bede6-330">ключ сегментирования Hello должен быть hello начальный столбец в первичный ключ или уникальный индекс определения.</span><span class="sxs-lookup"><span data-stu-id="bede6-330">hello sharding key should be hello leading column in your primary key or unique index definition.</span></span> <span data-ttu-id="bede6-331">Это гарантирует hello Наилучшая производительность для hello разбиения или слияния запросы проверки операций и для hello фактические данные перемещение и удаление которых всегда влияют на диапазонов ключей сегментирования.</span><span class="sxs-lookup"><span data-stu-id="bede6-331">That ensures hello best performance for hello split or merge validation queries, and for hello actual data movement and deletion operations which always operate on sharding key ranges.</span></span>
* <span data-ttu-id="bede6-332">Совместное размещение службы разделения слияния в центре области и данных обработки hello, где находятся базы данных.</span><span class="sxs-lookup"><span data-stu-id="bede6-332">Collocate your split-merge service in hello region and data center where your databases reside.</span></span> 

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Anchors-->
<!--Image references-->
[1]:./media/sql-database-elastic-scale-overview-split-and-merge/split-merge-overview.png
[2]:./media/sql-database-elastic-scale-overview-split-and-merge/diagnostics.png
[3]:./media/sql-database-elastic-scale-overview-split-and-merge/diagnostics-config.png

