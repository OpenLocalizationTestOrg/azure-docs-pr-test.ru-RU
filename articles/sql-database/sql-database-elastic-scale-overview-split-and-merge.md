---
title: "aaaMoving данные между базами данных горизонтально масштабируемого облака | Документы Microsoft"
description: "Объясняет, как toomanipulate сегментов и перемещения данных с помощью резидентной службы с помощью эластичных баз данных API-интерфейсы."
services: sql-database
documentationcenter: 
manager: jhubbard
author: ddove
ms.assetid: 204fd902-0397-4185-985a-dea3ed7c7d9f
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/24/2016
ms.author: ddove
ms.openlocfilehash: 629dee06e22609e9b61edf93ba5c38d997132d8c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="moving-data-between-scaled-out-cloud-databases"></a>Перемещение данных между масштабируемыми облачными базами данных
Если являетесь программное обеспечение, как разработчик службы и внезапно приложение проходит масштабную запросу, необходимо tooaccommodate hello роста. В результате добавляются новые базы данных (сегменты). Способ распространения данных hello toohello новых баз данных без нарушения целостности данных hello Используйте hello **средством слияния разбиение** toomove данные из ограниченного баз данных toohello новых баз данных.  

Средство Hello разделения слияния запускается как служба Azure web. Администратор или разработчик использует средство hello toomove подсегментов (данные из сегмента) между разными базами данных (сегментов). Средство Hello использует сегментов карты toomaintain hello метаданных базы данных службы управления и обеспечить согласованное сопоставления.

![Обзор][1]

## <a name="download"></a>Скачивание
[Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge](http://www.nuget.org/packages/Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge/)

## <a name="documentation"></a>Документация
1. [Учебник по инструменту разбиения и объединения эластичной базы данных](sql-database-elastic-scale-configure-deploy-split-and-merge.md)
2. [Настройка безопасности служб разделения и объединения](sql-database-elastic-scale-split-merge-security-configuration.md)
3. [Вопросы безопасности служб разделения и объединения](sql-database-elastic-scale-split-merge-security-configuration.md)
4. [Управление размещением сегментов](sql-database-elastic-scale-shard-map-management.md)
5. [Миграция существующих баз данных tooscale масштабированием](sql-database-elastic-convert-to-use-elastic-tools.md)
6. [Инструменты эластичных баз данных](sql-database-elastic-scale-introduction.md)
7. [Глоссарий по средствам работы с эластичными базами данных](sql-database-elastic-scale-glossary.md)

## <a name="why-use-hello-split-merge-tool"></a>Зачем использовать средство hello разделения слияния?
**Гибкость**

Приложения должны toostretch гибкое превышает порог hello одной базы данных, база данных SQL Azure. Используйте данные toomove средство hello как необходимые toonew баз данных, сохраняя целостность.

**Разбиение toogrow** 

Требуется tooincrease общую емкость toohandle взрывоподобный рост. toodo таким образом, создать дополнительный объем данных сегментирования hello и распространение по постепенно нескольким базам данных, пока не будут выполнены потребностей в емкости. Это отличный пример компонента «разделить» hello. 

**Объединение tooshrink**

Из-за toohello сезонных характер бизнеса требуется сжать емкости. Hello средство позволяет масштабировать единиц масштабирования toofewer при замедляет бизнеса. функция «слияние» Hello в hello гибкого масштабирования разделения слияния службы описывает это требование. 

**Управление хот-спотами путем перемещения шардлетов**

С несколькими клиентами на базу данных hello распределение подсегментов tooshards может вызвать toocapacity узких мест на некоторых сегментов. Это требуется, повторное выделение ячеек или перемещение подсегментов занят toonew или меньше загруженные сегментов. 

## <a name="concepts--key-features"></a>Концепции и основные функции
**Службы, размещаемые на стороне клиента**

Hello разделения слияния доставляется в виде службы, размещенных в веб-клиента. Необходимо развернуть и разместить службу hello в вашей подписке Microsoft Azure. Hello пакета, который можно скачать из NuGet содержит toocomplete шаблона конфигурации данными hello для нужд конкретного развертывания. В разделе hello [разделения слияния учебника](sql-database-elastic-scale-configure-deploy-split-and-merge.md) подробные сведения. Поскольку hello служба работает в вашей подписке Azure, можно управлять и выбрать подходящие hello службы. шаблон по умолчанию Hello включает tooconfigure hello параметры SSL, проверка подлинности на основе сертификата клиента, шифрование для сохраненных учетных данных, защищая DoS и ограничения IP-адресов. Дополнительные сведения о hello можно найти аспектах безопасности в следующий документ hello [конфигурация безопасности разделения слияния](sql-database-elastic-scale-split-merge-security-configuration.md).

по умолчанию Hello развертывания выполняется служба с один рабочий процесс и одной веб-роли. Каждый использует размер A1 VM hello в облачных службах Azure. Эти параметры нельзя изменить при развертывании пакета hello, можно изменить их после успешного развертывания в hello прогона облачной службы (hello портал Azure). Обратите внимание, что рабочая роль hello не должен быть настроен для более чем одного экземпляра по техническим причинам. 

**Интеграция сопоставлений сегментов**

Служба разделения слияния Hello взаимодействует с карты сегментов hello приложения hello. При использовании toosplit служба разделения слияния hello или диапазоны слияния или toomove подсегментов между сегментами, hello службы автоматически обновляет сопоставления сегментов hello вверх toodate. toodo таким образом, служба hello подключается toohello сегментов карты диспетчера базы данных приложения hello и хранит диапазоны и сопоставления в ходе разбиения или слияния или перемещения запросов. Это обеспечивает карта сегментов, hello всегда представляется актуальное представление при выполняются операции слияния разбиения. Разделить, слияния и Подсегмент операции перемещения реализуются путем перемещения пакета подсегментов с hello источника сегментов toohello целевой сегментов. Во время hello Подсегмент перемещения операции hello Подсегменты субъекта toohello текущий пакет отмечаются как вне сети в карте сегментов hello и недоступны для зависящих от данных маршрутизации подключений с помощью hello **OpenConnectionForKey** API. 

**Согласованные подключения к шардлетам**

При запуске перемещения данных для нового пакета Подсегменты любой предоставленный карта сегментов зависимости от данных маршрутизации подключений toohello сегментов хранение hello Подсегмент являются завершенного и последующие от карты сегментов hello toohello API-интерфейсы, эти Подсегменты блокируются во время Перемещение данных Hello идет несогласованности tooavoid заказа. Подсегменты tooother подключений на hello же сегментов также получить завершен, но будет успешным снова немедленно при повторной попытке. После перемещения пакета hello hello подсегментов, помечаются online для сегментов целевой hello и hello источник данных удаляется из сегментов источника hello. Служба Hello проходит через эти шаги для каждого пакета, пока будут перемещены все подсегментов. Это приведет к tooseveral операций прерывания подключения ходе hello hello завершения операции split, merge и перемещение.  

**Управление доступностью шардлетов**

Ограничение соединения hello уничтожении toohello текущий пакет подсегментов, как указано выше ограничивает область hello пакета tooone недоступности подсегментов одновременно. Это предпочтительнее подход где завершения сегментов hello останется вне сети для всех подсегментов ходе hello операции разбиения или слияния. Hello размер пакета, определяется как hello число уникальных Подсегменты toomove одновременно, — это параметр конфигурации. Его можно определить для каждой операции разбиения и слияния, в зависимости от потребностей приложения hello доступности и производительности. Обратите внимание, что диапазон hello, заблокирован в карте сегментов hello может быть больше, чем указанный размер пакета hello. Это так, как служба hello принимает размер диапазона hello, таким образом, что hello фактическому числу значений ключа сегментирования в данных hello примерно соответствует размеру пакета hello. Это важные tooremember в частности для сегментирования разреженное ключей. 

**Хранилище метаданных**

Служба разделения слияния Hello использует toomaintain базы данных, ее состояние и tookeep заносит в журнал во время обработки запроса. Hello пользователь создает эту базу данных в своих подписках и предоставляет hello строку подключения для него в файл конфигурации hello для развертывания службы hello. Администраторы организации hello пользователя можно также подключиться toothis ход выполнения запроса tooreview базы данных и tooinvestigate подробные сведения о потенциальных сбоев.

**Сведения о сегментировании**

Служба разделения слияния Hello различает (1) сегментированной таблицы, таблицы ссылок (2) и (3) в обычных таблицах. семантика Hello операции split, merge и перемещение зависят от типа hello hello таблица, используемая и определяется следующим образом: 

* **Сегментированными таблицами**: Split, merge и операциями перемещения перемещение подсегментов из источника tootarget сегментов. После успешного завершения hello в целом запроса этих Подсегменты больше не присутствует в источнике hello. Обратите внимание, что hello целевых таблиц должны tooexist на сегментов целевой hello не должен содержать данные в предыдущих tooprocessing hello целевой диапазон hello операции. 
* **Ссылаться на таблицы**: ссылочные таблицы, разбиение hello, слияния и переместить операции копирования данных hello из сегментов целевой toohello источника hello. Обратите внимание, что изменения не на в случае hello сегментов целевой для данной таблицы уже существует в этой таблице на целевом сервере hello любую строку. Таблица Hello имеет toobe пустым для любой ссылки таблицы копирования операции tooget обработки.
* **Другие таблицы**: hello источника или назначения hello операции разбиения и слияния могут присутствовать другие таблицы. Служба разделения слияния Hello не учитывает эти таблицы для операций копирования или перемещения данных. Учтите, что они могут помешать этим операциям в случае наличия ограничений.

сведения о Hello на ссылку или сегментированными таблицами предоставляются hello **SchemaInfo** API-интерфейсов на карте сегментов hello. Привет, следующий пример иллюстрирует использование hello этих API-интерфейсов на smm объект диспетчера карты сегментов заданного: 

    // Create hello schema annotations 
    SchemaInfo schemaInfo = new SchemaInfo(); 

    // Reference tables 
    schemaInfo.Add(new ReferenceTableInfo("dbo", "region")); 
    schemaInfo.Add(new ReferenceTableInfo("dbo", "nation")); 

    // Sharded tables 
    schemaInfo.Add(new ShardedTableInfo("dbo", "customer", "C_CUSTKEY")); 
    schemaInfo.Add(new ShardedTableInfo("dbo", "orders", "O_CUSTKEY")); 

    // Publish 
    smm.GetSchemaInfoCollection().Add(Configuration.ShardMapName, schemaInfo); 

Hello таблиц «область» и «Страна» определяются как ссылочные таблицы и будет скопирована с помощью операций split, merge и перемещение. "клиент" и "заказы", в свою очередь, определяются как сегментированные таблицы. C_CUSTKEY и O_CUSTKEY выступать в качестве ключа сегментирования hello. 

**Ссылочная целостность**

Служба разделения слияния Hello анализирует зависимости между таблицами и использует операции hello toostage связей по внешнему ключу первичный ключ для перемещения ссылочных таблиц и ячеек. В общем случае в первую очередь копируются ссылочные таблицы в порядке зависимости, затем копируются шардлеты в порядке их зависимостей в каждом пакете. Это необходимо, чтобы ограничения FK-PK сегментов целевой hello соблюдаются при поступлении новых данных hello. 

**Согласованность сопоставления сегментов и завершение операций**

В присутствии hello сбоев служба разделения слияния hello возобновляется после любого сбоя операции и предназначен toocomplete любого в выполняемых запросов. Тем не менее могут возникнуть неустранимые ситуации, например, при утере или компрометации после восстановления hello целевой сегментов. В таком случае некоторые подсегментов, который должен переместить toobe может продолжаться tooreside на исходном сегменте hello. Служба Hello гарантирует, что Подсегмент сопоставления обновляются только после hello необходимые данные были успешно скопированного toohello целевой. Подсегменты удаляется только на исходном hello после все, что их данные были скопированы целевой toohello и соответствующие сопоставления hello успешно обновлены. операции удаления Hello происходит в фоновом режиме hello, а диапазон hello уже online на hello целевой сегментов. Служба разделения слияния Hello всегда обеспечивает правильность hello сопоставления, которые хранятся в карте сегментов hello.

## <a name="hello-split-merge-user-interface"></a>Hello разделения слияния пользовательского интерфейса
пакет службы разделения слияния Hello включает рабочей роли и веб-роли. Hello веб-роль — запросы разделения слияния используется toosubmit интерактивной. Существуют следующие основные компоненты пользовательского интерфейса hello Hello.

* Тип операции: hello тип операции — переключатель, который управляет hello тип операции, выполняемой службой hello для данного запроса. Можно выбрать между разбиение hello, слияния и сценарии перемещения. Кроме того, запрошенную ранее операцию можно отменить. Можно использовать запросы на разбиение или объединение, а также перемещать запросы сопоставлений сегментов по диапазону. Сопоставления сегментов по списку поддерживают только операции перемещения.
* Карта сегментов: hello следующей части запроса параметры обложки сведения карта сегментов hello и hello размещения на карте сегментов базы данных. В частности нужно tooprovide hello имя сервера базы данных SQL Azure hello и размещения hello shardmap базы данных, учетные данные tooconnect toohello сегменте сопоставить базу данных и наконец hello имя карты сегментов hello. В настоящее время операция hello принимает только один набор учетных данных. Эти учетные данные требуются достаточные разрешения toohave tooperform изменяет toohello карта сегментов, а также toohello данные пользователей на сегменты hello.
* Диапазон источника (операции разбиения и объединения). Операции разбиения и объединения обрабатывают диапазон, используя его нижний и верхний ключ. toospecify операции с неограниченными верхнее значение ключа, проверьте флажок «max верхний ключ» hello и hello высокой ключа поле остается пустым. Hello диапазон значений ключа, можно указать сделать не соответствует tooprecisely необходимость сопоставления и его границ на карте сегментов. Если вообще не указать все границы диапазона hello службы будет автоматически определять hello ближайший диапазона для вас. Можно использовать hello GetMappings.ps1 PowerShell скрипт tooretrieve hello текущего сопоставления на карте данного сегмента.
* Разбиения в работе источника (разделен): для операции split диапазон hello точки toosplit hello источника. Это делается, предоставляя место hello, разделенные toooccur ключа сегментирования hello. Используйте hello переключатель укажите следует toomove верхней части hello (включая hello разбиение ключ) или потребность в нижней части hello toomove hello диапазон (исключая hello разбиения ключа).
* Источник подсегмента (перемещения): переместить операции отличаются от разбиения или слияния операций, они не требуют источника диапазона toodescribe hello. Источник для перемещения просто определяется значение ключа сегментирования hello планировать toomove.
* Целевой сегментов (разделен): после ввода сведений hello в исходном hello операцию разбиения необходимо toodefine место toobe hello данные копируются tooby обеспечивает hello базу данных SQL Azure сервера и базы данных для целевого объекта hello.
* Целевой диапазон (объединения): операций слияния перемещение подсегментов tooan существующего сегмента. Определите hello существующего сегмента, предоставляя границы диапазона hello hello существующий диапазон toomerge с.
* Размер пакета: hello пакета размеров элементов управления hello число ячеек, который переходит в автономный режим во время перемещения данных hello. Это целочисленное значение, где можно использовать меньшие значения при конфиденциальных toolong периоды простоя для подсегментов. Большие значения приведет к увеличению времени hello Подсегмент, но вне сети может повысить производительность.
* Код операции (Отмена): Если выполняемая операция больше не нужны, можно отменить hello операцию, указав его идентификатор операции в этом поле. Идентификатор операции hello можно получить из таблицы состояния hello запроса (см. раздел 8.1) или из выходных данных hello в веб-браузере hello, осуществляющими отправку запроса hello.

## <a name="requirements-and-limitations"></a>Требования и ограничения
Текущая реализация службы разделения слияния hello Hello — тема toohello следующие требования и ограничения: 

* сегменты Hello требуется tooexist и быть зарегистрирован в карте сегментов hello перед выполнением операции слияния разбиение на этих сегментов. 
* Служба Hello не создает таблиц или других объектов базы данных автоматически как часть его операций. Это означает, что hello схему для всех сегментированных таблиц и ссылаться на таблицы должны tooexist hello целевой сегментов предыдущих tooany split, merge и перемещение операции. В частности, необходимые toobe пустым в диапазоне hello которых toobe добавлен с помощью операции split, merge и перемещение новых подсегментов являются Сегментированные таблицы. В противном случае hello операция завершится ошибкой проверки согласованности начальной hello hello целевой сегментов. Также Обратите внимание, что ссылочные данные будет копироваться только в том случае, если hello ссылочная таблица является пустым и нет, не согласованы гарантирует учета tooother одновременную запись операции на hello ссылочные таблицы. Эта рекомендация: при выполнении операции разбиения или слияния, никакие другие операции записи изменения toohello ссылочные таблицы.
* Служба Hello использует идентификатор строки, уникальный индекс или ключ, который включает в себя hello сегментирования ключа tooimprove производительность и надежность для больших подсегментов. Это позволяет hello службы toomove данные с даже высокой степенью детализации, чем просто hello значение ключа сегментирования. Это помогает tooreduce hello максимальный объем места в журнале и блокировок, которые требуются во время операции hello. Рекомендуется создать уникальный индекс или первичный ключ, включая hello ключа сегментирования для данной таблицы, если требуется, чтобы toouse этой таблицы разбиения или слияния или перемещения запросов. Из соображений производительности ключ сегментирования hello должен быть hello начальный столбец в hello ключ или индекс hello.
* Ходе hello обработки запросов некоторые данные ячеек могут присутствовать на hello исходного и целевого сегментов hello. Это необходимые tooprotect от сбоев во время перемещения строк сегментов hello. Hello интеграцию разделения слияния с карты сегментов hello гарантирует, что подключений через hello данных зависимых маршрутизации API-интерфейсов с помощью hello **OpenConnectionForKey** методом на карте сегментов hello не видите все несогласованные промежуточных состояний. Тем не менее, при подключении источника toohello или hello предназначены сегментов без использования hello **OpenConnectionForKey** метод, несогласованные промежуточных состояний может отображаться в split, merge и перемещение запросы выполняются. Эти подключения могут отображаться или часть повторяющиеся результаты в зависимости от времени hello или Базовое соединение hello hello сегментов. В настоящее время это ограничение включает hello соединения с несколькими Shard гибкого масштабирования-запросы.
* Hello базы данных метаданных для службы разделения слияния hello не должен быть общим между ролями. Например роль hello разделения слияния службой, работающей в промежуточной потребностей toopoint tooa различные метаданные базы данных от hello рабочей роли.

## <a name="billing"></a>Выставление счетов
Hello разделения слияния служба выполняется как облачной службы в вашей подписке Microsoft Azure. Поэтому tooyour экземпляр службы hello взимается плата за для облачных служб. Если вы нечасто выполняете операции разбиения, объединения и перемещения, рекомендуем удалить облачную службу разбиения и объединения. Это поможет сократить расходы на действующие или развернутые экземпляры облачной службы. Можно повторно развернуть и начать легко выполнить настройку, при необходимости tooperform разбиение и объединение операций. 

## <a name="monitoring"></a>Мониторинг
### <a name="status-tables"></a>Таблицы состояния
Hello разделения слияния служба предоставляет hello **RequestStatus** таблицы в базе данных хранилища метаданных hello для наблюдения за выполненной и текущих запросов. Ниже приведены Hello строку для каждого запроса разделения слияния, которое было отправлено toothis экземпляр службы разделения слияния hello. Он предоставляет следующую информацию для каждого запроса hello:

* **Отметка времени**: hello время и Дата начала запроса hello.
* **ИД операции**: GUID, однозначно определяющий запрос hello. Этот запрос также может быть используется toocancel hello операции во время его по-прежнему.
* **Состояние**: hello текущее состояние запроса hello. Для текущих запросов на ней также указаны hello текущую фазу, в какие hello является запрос.
* **CancelRequest**: флаг, указывающий, отменено ли запрос hello.
* **Ход выполнения**: для подсчета процент завершения для операции hello. Значение 50 указывает на то, что операция hello примерно на 50% завершено.
* **Details**: более подробный отчет о ходе выполнения в формате XML. наборы строк копируются из исходного tootarget Hello отчет о ходе выполнения периодически обновляется. В случае ошибки или исключения этот столбец также включает более подробные сведения о сбоях hello.

### <a name="azure-diagnostics"></a>Диагностика Azure
Служба разделения слияния Hello использует диагностику Azure, в зависимости от пакета Azure SDK 2.5 наблюдения и диагностики. Управлять конфигурация диагностики hello, как описано здесь: [включение диагностики в облачных службах Azure и виртуальные машины](../cloud-services/cloud-services-dotnet-diagnostics.md). Hello пакет загрузки включает в себя две конфигурации диагностики — один для hello веб-роли и один для hello рабочей роли. Эти конфигурации диагностики для службы hello следовать указаниям hello из [Основы облачных служб в Microsoft Azure](https://code.msdn.microsoft.com/windowsazure/Cloud-Service-Fundamentals-4ca72649). Он включает в себя определения hello toolog счетчики производительности, журналы IIS, журналы событий Windows и журналы событий приложений разделения слияния. 

## <a name="deploy-diagnostics"></a>Развертывание диагностики
Здравствуйте, tooenable наблюдения и диагностики с помощью конфигурации диагностики для hello и рабочие роли, предоставляемые выполнения hello следующих команд Azure PowerShell с помощью пакета NuGet hello: 

    $storage_name = "<YourAzureStorageAccount>" 

    $key = "<YourAzureStorageAccountKey" 

    $storageContext = New-AzureStorageContext -StorageAccountName $storage_name -StorageAccountKey $key  


    $config_path = "<YourFilePath>\SplitMergeWebContent.diagnostics.xml" 

    $service_name = "<YourCloudServiceName>" 

    Set-AzureServiceDiagnosticsExtension -StorageContext $storageContext -DiagnosticsConfigurationPath $config_path -ServiceName $service_name -Slot Production -Role "SplitMergeWeb" 


    $config_path = "<YourFilePath>\SplitMergeWorkerContent.diagnostics.xml" 

    $service_name = "<YourCloudServiceName>" 

    Set-AzureServiceDiagnosticsExtension -StorageContext $storageContext -DiagnosticsConfigurationPath $config_path -ServiceName $service_name -Slot Production -Role "SplitMergeWorker" 

Дополнительные сведения о том, как можно найти tooconfigure здесь параметры диагностики и развертывания: [включение диагностики в облачных службах Azure и виртуальные машины](../cloud-services/cloud-services-dotnet-diagnostics.md). 

## <a name="retrieve-diagnostics"></a>Получение диагностики
Можно легко получить диагностики hello обозревателя серверов Visual Studio в Azure — часть дерева обозревателя сервера hello hello. Откройте экземпляр Visual Studio и выберите представление и обозреватель серверов в меню hello. Щелкните tooyour tooconnect значок Azure hello подписки Azure. Затем перейдите tooAzure "->" хранилище "->" <your storage account> "->" таблицы -> WADLogsTable. Дополнительные сведения см. в статье с [обзором ресурсов хранилища с помощью обозревателя сервера](http://msdn.microsoft.com/library/azure/ff683677.aspx). 

![WADLogsTable][2]

Hello WADLogsTable выделены на приведенном выше рисунке hello содержит hello подробные события из журнала приложений службы разделения слияния hello. Обратите внимание, конфигурация по умолчанию hello hello загрузить пакет, предназначенные для развертывания в рабочей среде. Поэтому интервал приветствия, по которому журналов и счетчиков извлекаются из экземпляров службы hello — большой (5 минут). Для тестирования и разработки должен нижней интервал приветствия путем настройки параметров диагностики hello hello web или hello рабочей роли tooyour. Щелкните правой кнопкой мыши в роли hello в hello обозревателя серверов Visual Studio (см. выше), а затем настроить hello период передачи в диалоговом окне приветствия для параметров конфигурации диагностики hello: 

![Конфигурация][3]

## <a name="performance"></a>Производительность
Как правило более высокую производительность является toobe, ожидаемых в более поздней версии, hello дополнительные уровни обслуживания высокопроизводительных в базе данных SQL Azure. Выше распределения операций ввода-ВЫВОДА, ЦП и памяти для более высокими уровнями служб hello способствовать hello массового копирования и удаления, которые служба разделения слияния использует hello. По этой причине увеличивайте уровень служб hello только для этих баз данных определено, ограниченный период времени.

Служба Hello также выполняет проверку запросов как часть его нормальной работы. Эти запросы проверки наличия непредвиденные данные в целевой диапазон hello и убедитесь, что любая операция split, merge и перемещение начинается от согласованное состояние. Эти запросы все работающие диапазонов ключей сегментирования, определяемый hello область операции hello и размер пакета hello предоставляется как часть определения запроса hello. Эти запросы выполнения лучше всего индекса, присутствует с ключом сегментирования hello, что hello начальный столбец. 

Кроме того свойство уникальности hello ключом сегментирования, что начальный столбец hello позволит toouse службы hello оптимизированный подход, который ограничивает потребление ресурсов с точки зрения места в журнале и памяти. Это свойство уникальности является обязательным toomove размеры большие объемы данных (обычно превышает 1 ГБ). 

## <a name="how-tooupgrade"></a>Как tooupgrade
1. Следуйте указаниям hello [развертывание службы разделения слияния](sql-database-elastic-scale-configure-deploy-split-and-merge.md).
2. Изменение файла конфигурации облачной службы для развертывания разделения слияния tooreflect hello новые параметры. Новый обязательный параметр — hello сведения о сертификате hello, используемый для шифрования. Простой способ toodo это toocompare hello новый шаблон файл конфигурации из загрузки hello к существующей конфигурации. Убедитесь, что добавление hello параметры «DataEncryptionPrimaryCertificateThumbprint» и «DataEncryptionPrimary» для веб-hello и hello рабочей роли.
3. Перед развертыванием обновления tooAzure hello, убедитесь, что все операции, запущенных в настоящее время разделения слияния завершено. Это легко можно сделать с помощью запроса hello RequestStatus PendingWorkflows таблиц и hello метаданные слияния разбиения базы данных для текущих запросов.
4. Обновите существующие развертывания облачной службы для разделения слияния в вашей подписке Azure с новым пакетом hello и файле конфигурации обновленной службы.

Для разделения слияния tooupgrade необязательно tooprovision новую базу данных метаданных. Новая версия Hello будет автоматически выполнено обновление существующих метаданных базы данных toohello новой версии. 

## <a name="best-practices--troubleshooting"></a>Рекомендации и устранение неполадок
* Определите тестового клиента и следовать наиболее важные операции split, merge и перемещение с тестовым клиентом hello между несколькими сегментами. Убедитесь, правильно определен все метаданные в карте сегментов и операций hello нарушают ограничения или внешние ключи.
* Размер данных клиента теста hello Keep выше hello максимальный размер данных большого клиента tooensure размер данных не возникает проблем, связанных с. Это помогает оценить верхнюю границу на hello время toomove вокруг одного клиента. 
* Убедитесь, что схема допускает удаления. Служба разделения слияния Hello требует hello возможность tooremove данные из источника сегментов hello после hello данные были успешно скопированного toohello цели. Например **удаление триггеров** можно предотвратить удаление данных hello в источнике hello hello службы и может привести к toofail операций.
* ключ сегментирования Hello должен быть hello начальный столбец в первичный ключ или уникальный индекс определения. Это гарантирует hello Наилучшая производительность для hello разбиения или слияния запросы проверки операций и для hello фактические данные перемещение и удаление которых всегда влияют на диапазонов ключей сегментирования.
* Совместное размещение службы разделения слияния в центре области и данных обработки hello, где находятся базы данных. 

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Anchors-->
<!--Image references-->
[1]:./media/sql-database-elastic-scale-overview-split-and-merge/split-merge-overview.png
[2]:./media/sql-database-elastic-scale-overview-split-and-merge/diagnostics.png
[3]:./media/sql-database-elastic-scale-overview-split-and-merge/diagnostics-config.png

