---
title: "обновление приложения aaaRolling - базы данных SQL Azure | Документы Microsoft"
description: "Узнайте, как обновления документации toosupport toouse георепликации для базы данных SQL Azure облачные приложения."
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 58f42859-1e37-463c-a3d8-a3ca2e867148
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 07/16/2016
ms.author: sashan
ms.openlocfilehash: 18c56300916d129bff141624cc5c416b500408d4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="managing-rolling-upgrades-of-cloud-applications-using-sql-database-active-geo-replication"></a><span data-ttu-id="cfecc-103">Управление последовательными обновлениями для облачных приложений с помощью активной георепликации базы данных SQL</span><span class="sxs-lookup"><span data-stu-id="cfecc-103">Managing rolling upgrades of cloud applications using SQL Database active geo-replication</span></span>
> [!NOTE]
> <span data-ttu-id="cfecc-104">[Активная георепликация](sql-database-geo-replication-overview.md) теперь доступна для всех баз данных и всех уровней.</span><span class="sxs-lookup"><span data-stu-id="cfecc-104">[Active geo-replication](sql-database-geo-replication-overview.md) is now available for all databases in all tiers.</span></span>
> 

<span data-ttu-id="cfecc-105">Узнайте, как toouse [георепликации](sql-database-geo-replication-overview.md) в базе данных SQL tooenable последовательных обновлений облачного приложения.</span><span class="sxs-lookup"><span data-stu-id="cfecc-105">Learn how toouse [geo-replication](sql-database-geo-replication-overview.md) in SQL Database tooenable rolling upgrades of your cloud application.</span></span> <span data-ttu-id="cfecc-106">Так как обновление представляет собой нарушающую работу операцию, оно должно учитываться при планировании и проектировании непрерывности бизнес-процессов.</span><span class="sxs-lookup"><span data-stu-id="cfecc-106">Because upgrade is a disruptive operation, it should be part of your business continuity planning and design.</span></span> <span data-ttu-id="cfecc-107">В этой статье мы рассмотрим два метода оркестрация hello процесса обновления и рассматриваются преимущества hello и преимущества и недостатки каждого варианта.</span><span class="sxs-lookup"><span data-stu-id="cfecc-107">In this article we look at two different methods of orchestrating hello upgrade process, and discuss hello benefits and trade-offs of each option.</span></span> <span data-ttu-id="cfecc-108">Для целей hello данной статьи мы будем использовать простое приложение, которое состоит из веб-сайта подключенных tooa одну базу данных в качестве уровня данных.</span><span class="sxs-lookup"><span data-stu-id="cfecc-108">For hello purposes of this article we will use a simple application that consists of a web site connected tooa single database as its data tier.</span></span> <span data-ttu-id="cfecc-109">Наша цель — tooupgrade версии 1 tooversion приложения hello 2 без любой значительное влияние на взаимодействие с пользователем hello.</span><span class="sxs-lookup"><span data-stu-id="cfecc-109">Our goal is tooupgrade version 1 of hello application tooversion 2 without any significant impact on hello end-user experience.</span></span> 

<span data-ttu-id="cfecc-110">При оценке hello параметры обновления необходимо учитывать следующие факторы hello.</span><span class="sxs-lookup"><span data-stu-id="cfecc-110">When evaluating hello upgrade options you should consider hello following factors:</span></span>

* <span data-ttu-id="cfecc-111">Влияние на доступность приложения во время обновления.</span><span class="sxs-lookup"><span data-stu-id="cfecc-111">Impact on application availability during upgrades.</span></span> <span data-ttu-id="cfecc-112">Как долго функции приложения hello может ограничены или сниженной активности.</span><span class="sxs-lookup"><span data-stu-id="cfecc-112">How long hello application function may be limited or degraded.</span></span>
* <span data-ttu-id="cfecc-113">Возможность tooroll обратно в случае сбоя обновления.</span><span class="sxs-lookup"><span data-stu-id="cfecc-113">Ability tooroll back in case of an upgrade failure.</span></span>
* <span data-ttu-id="cfecc-114">Уязвимость приложения hello, если несвязанные авария происходит во время обновления hello.</span><span class="sxs-lookup"><span data-stu-id="cfecc-114">Vulnerability of hello application if an unrelated catastrophic failure occurs during hello upgrade.</span></span>
* <span data-ttu-id="cfecc-115">Общие денежные затраты.</span><span class="sxs-lookup"><span data-stu-id="cfecc-115">Total dollar cost.</span></span>  <span data-ttu-id="cfecc-116">Сюда входят дополнительная избыточность и добавочные затраты hello временные компоненты, используемые процессом обновления hello.</span><span class="sxs-lookup"><span data-stu-id="cfecc-116">This includes additional redundancy and incremental costs of hello temporary components  used by hello upgrade process.</span></span> 

## <a name="upgrading-applications-that-rely-on-database-backups-for-disaster-recovery"></a><span data-ttu-id="cfecc-117">Обновление приложений, полагающихся на резервные копии базы данных в случае аварийного восстановления</span><span class="sxs-lookup"><span data-stu-id="cfecc-117">Upgrading applications that rely on database backups for disaster recovery</span></span>
<span data-ttu-id="cfecc-118">Если приложение зависит от резервных копий баз данных автоматически и использует географическое восстановление для аварийного восстановления, это обычно развернутой tooa один регион Azure.</span><span class="sxs-lookup"><span data-stu-id="cfecc-118">If your application relies on automatic database backups and uses geo-restore for disaster recovery, it is usually deployed tooa single Azure region.</span></span> <span data-ttu-id="cfecc-119">В этом случае процесс обновления hello включает в себя создание резервной копии развертывания всех компонентов приложения, участвующие в обновлении hello.</span><span class="sxs-lookup"><span data-stu-id="cfecc-119">In this case hello upgrade process involves creating a backup deployment of all application components involved in hello upgrade.</span></span> <span data-ttu-id="cfecc-120">toominimize hello перерывов в работе пользователей будет использовать диспетчер трафика Azure (WATM) с профилем hello отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="cfecc-120">toominimize hello end-user disruption you will leverage Azure Traffic Manager (WATM) with hello failover profile.</span></span>  <span data-ttu-id="cfecc-121">Hello, следующая схема иллюстрирует процесс обновления предыдущих toohello операционной среде hello.</span><span class="sxs-lookup"><span data-stu-id="cfecc-121">hello following diagram illustrates hello operational environment prior toohello upgrade process.</span></span> <span data-ttu-id="cfecc-122">Здравствуйте, конечная точка <i>contoso 1.azurewebsites.net</i> представляет производственный слот приложения hello, которое требуется обновить toobe.</span><span class="sxs-lookup"><span data-stu-id="cfecc-122">hello endpoint <i>contoso-1.azurewebsites.net</i> represents a production slot of hello application that needs toobe upgraded.</span></span> <span data-ttu-id="cfecc-123">tooroll возможности hello tooenable обратно Здравствуйте обновление, необходимо создать слот рабочей области с полностью синхронизированной копии приложения hello.</span><span class="sxs-lookup"><span data-stu-id="cfecc-123">tooenable hello ability tooroll back hello upgrade, you need create a stage slot with a fully synchronized copy of hello application.</span></span> <span data-ttu-id="cfecc-124">Hello следующие шаги, необходимые tooprepare hello приложения для обновления hello:</span><span class="sxs-lookup"><span data-stu-id="cfecc-124">hello following steps are required tooprepare hello application for hello upgrade:</span></span>

1. <span data-ttu-id="cfecc-125">Создайте слот рабочей области для обновления hello.</span><span class="sxs-lookup"><span data-stu-id="cfecc-125">Create a stage slot for hello upgrade.</span></span> <span data-ttu-id="cfecc-126">toodo, создание базы данных-получателя (1) и развертывание идентичные веб-сайта в hello же регионе Azure.</span><span class="sxs-lookup"><span data-stu-id="cfecc-126">toodo that create a secondary database (1) and deploy an identical web site in hello same Azure region.</span></span> <span data-ttu-id="cfecc-127">Мониторинга получателей toosee hello, если hello заполнения процесс завершается.</span><span class="sxs-lookup"><span data-stu-id="cfecc-127">Monitor hello secondary toosee if hello seeding process is completed.</span></span>
2. <span data-ttu-id="cfecc-128">Создайте профиль отработки отказа в WATM, используя <i>contoso-1.azurewebsites.net</i> в качестве работающей конечной точки и <i>contoso-2.azurewebsites.net</i> в качестве отключенной.</span><span class="sxs-lookup"><span data-stu-id="cfecc-128">Create a failover profile in WATM with <i>contoso-1.azurewebsites.net</i> as online endpoint and <i>contoso-2.azurewebsites.net</i> as offline.</span></span> 

> [!NOTE]
> <span data-ttu-id="cfecc-129">Действия по подготовке hello Примечание не повлияет на приложение hello в производственный слот hello и он может работать в режиме полного доступа.</span><span class="sxs-lookup"><span data-stu-id="cfecc-129">Note hello preparation steps will not impact hello application in hello production slot and it can function in full access mode.</span></span>
>  

![Настройка георепликации базы данных SQL.](media/sql-database-manage-application-rolling-upgrade/Option1-1.png)

<span data-ttu-id="cfecc-132">После завершения действия по подготовке hello приложения hello готова для hello фактического обновления.</span><span class="sxs-lookup"><span data-stu-id="cfecc-132">Once hello preparation steps are completed hello application is ready for hello actual upgrade.</span></span> <span data-ttu-id="cfecc-133">Следующая схема Hello приведены шаги hello в процессе обновления hello.</span><span class="sxs-lookup"><span data-stu-id="cfecc-133">hello following diagram illustrates hello steps involved in hello upgrade process.</span></span> 

1. <span data-ttu-id="cfecc-134">Задать hello базы данных-источника в hello производственный слот tooread режиме (3).</span><span class="sxs-lookup"><span data-stu-id="cfecc-134">Set hello primary database in hello production slot tooread-only mode (3).</span></span> <span data-ttu-id="cfecc-135">Это гарантирует, что hello экземпляр производственного приложения hello (V1) останется только для чтения во время обновления hello, предотвращая hello расхождение данных между hello V1 и V2 экземпляров баз данных.</span><span class="sxs-lookup"><span data-stu-id="cfecc-135">This will guarantee that hello production instance of hello application (V1) will remain read-only during hello upgrade thus preventing hello data divergence between hello V1 and V2 database instances.</span></span>  
2. <span data-ttu-id="cfecc-136">Отключите hello баз данных-получателей с помощью режима запланированное уничтожение hello (4).</span><span class="sxs-lookup"><span data-stu-id="cfecc-136">Disconnect hello secondary database using hello planned termination mode (4).</span></span> <span data-ttu-id="cfecc-137">Она создаст полностью синхронизированных независимая копия базы данных-источника hello.</span><span class="sxs-lookup"><span data-stu-id="cfecc-137">It will create a fully synchronized independent copy of hello primary database.</span></span> <span data-ttu-id="cfecc-138">Эта база данных будет обновлена.</span><span class="sxs-lookup"><span data-stu-id="cfecc-138">This database will be upgraded.</span></span>
3. <span data-ttu-id="cfecc-139">Включение режима записи tooread hello базы данных-источника и запустите сценарий обновления hello в слоте этап hello (5).</span><span class="sxs-lookup"><span data-stu-id="cfecc-139">Turn hello primary database tooread-write mode and run hello upgrade script in hello stage slot  (5).</span></span>     

![Настройка георепликации базы данных SQL](media/sql-database-manage-application-rolling-upgrade/Option1-2.png)

<span data-ttu-id="cfecc-142">При успешном завершении обновления hello вы находитесь hello готов tooswitch hello конечным пользователям toohello промежуточное хранение копии приложения.</span><span class="sxs-lookup"><span data-stu-id="cfecc-142">If hello upgrade completed successfully you are now ready tooswitch hello end users toohello staged copy hello application.</span></span> <span data-ttu-id="cfecc-143">Теперь оно станет hello производственный слот приложения hello.</span><span class="sxs-lookup"><span data-stu-id="cfecc-143">It will now become hello production slot of hello application.</span></span>  <span data-ttu-id="cfecc-144">Это включает в себя несколько дополнительных действий, как показано на hello следующие схемы.</span><span class="sxs-lookup"><span data-stu-id="cfecc-144">This involves a few more steps as illustrated on hello following diagram.</span></span>

1. <span data-ttu-id="cfecc-145">Переключение hello работающую конечную точку в профиль WATM hello слишком<i>contoso 2.azurewebsites.net</i>, какая версия toohello V2 точек hello веб-сайта (6).</span><span class="sxs-lookup"><span data-stu-id="cfecc-145">Switch hello online endpoint in hello WATM profile too<i>contoso-2.azurewebsites.net</i>, which points toohello V2 version of hello web site (6).</span></span> <span data-ttu-id="cfecc-146">Превращается hello производственный слот с hello приложения V2 и трафика конечных пользователей hello направленной tooit.</span><span class="sxs-lookup"><span data-stu-id="cfecc-146">It now becomes hello production slot with hello V2 application and hello end-user traffic is directed tooit.</span></span>  
2. <span data-ttu-id="cfecc-147">Если компоненты приложения hello V1 больше не нужна, можно безопасно удалите их (7).</span><span class="sxs-lookup"><span data-stu-id="cfecc-147">If you no longer need hello V1 application components so you can safely remove them (7).</span></span>   

![Настройка георепликации базы данных SQL](media/sql-database-manage-application-rolling-upgrade/Option1-3.png)

<span data-ttu-id="cfecc-150">Если hello процесс обновления завершается неудачно, например из-за ошибки tooan в сценарий обновления hello, слот этап hello считается скомпрометирован.</span><span class="sxs-lookup"><span data-stu-id="cfecc-150">If hello upgrade process is unsuccessful, for example due tooan error in hello upgrade script, hello stage slot should be considered compromised.</span></span> <span data-ttu-id="cfecc-151">tooroll резервное hello toohello до обновления состояния приложения вы просто восстановить приложение hello в hello производственный слот toofull доступа.</span><span class="sxs-lookup"><span data-stu-id="cfecc-151">tooroll back hello application toohello pre-upgrade state you simply revert hello application in hello production slot toofull access.</span></span> <span data-ttu-id="cfecc-152">Hello шаги показаны на следующей схеме hello.</span><span class="sxs-lookup"><span data-stu-id="cfecc-152">hello steps involved are shown on hello next diagram.</span></span>    

1. <span data-ttu-id="cfecc-153">Режим hello базы данных копирования записи tooread (8).</span><span class="sxs-lookup"><span data-stu-id="cfecc-153">Set hello database copy tooread-write mode (8).</span></span> <span data-ttu-id="cfecc-154">Это позволит восстановить hello полный V1 функционально в производственный слот hello.</span><span class="sxs-lookup"><span data-stu-id="cfecc-154">This will restore hello full V1 functionally in hello production slot.</span></span>
2. <span data-ttu-id="cfecc-155">Выполнить анализ основных причин hello и удалите компоненты скомпрометированы hello в слоте этап hello (9).</span><span class="sxs-lookup"><span data-stu-id="cfecc-155">Perform hello root cause analysis and remove hello compromised components in hello stage slot (9).</span></span> 

<span data-ttu-id="cfecc-156">На этом этапе приложение hello осуществляется в полном объеме и может повторяться hello этапы обновления.</span><span class="sxs-lookup"><span data-stu-id="cfecc-156">At this point hello application is fully functional and hello upgrade steps can be repeated.</span></span>

> [!NOTE]
> <span data-ttu-id="cfecc-157">Hello отката не требует изменений в профиль WATM, он уже точки слишком<i>contoso 1.azurewebsites.net</i> как hello активной конечной точки.</span><span class="sxs-lookup"><span data-stu-id="cfecc-157">hello rollback does not require changes in WATM profile as it already points too<i>contoso-1.azurewebsites.net</i> as hello active endpoint.</span></span>
> 
> 

![Настройка георепликации базы данных SQL](media/sql-database-manage-application-rolling-upgrade/Option1-4.png)

<span data-ttu-id="cfecc-160">ключ Hello **преимущества** этого параметра является можно обновить приложения в одном регионе с помощью набора простых шагов.</span><span class="sxs-lookup"><span data-stu-id="cfecc-160">hello key **advantage** of this option is that you can upgrade an application in a single region using a set of simple steps.</span></span> <span data-ttu-id="cfecc-161">стоимость в долларах Hello обновления hello, сравнительно мало.</span><span class="sxs-lookup"><span data-stu-id="cfecc-161">hello dollar cost of hello upgrade is relatively low.</span></span> <span data-ttu-id="cfecc-162">основной Hello **компромисс** —, при возникновении сбоя во время hello обновления hello toohello восстановления до обновления состояния для этого потребуется повторное развертывание приложения hello в другом регионе и восстановлении базы данных hello из резервное копирование с использованием геовосстановления.</span><span class="sxs-lookup"><span data-stu-id="cfecc-162">hello main **tradeoff** is that if a catastrophic failure occurs during hello upgrade hello recovery toohello pre-upgrade state will involve re-deployment of hello application in a different region and restoring hello database from backup using geo-restore.</span></span> <span data-ttu-id="cfecc-163">Этот процесс приведет к значительному простою.</span><span class="sxs-lookup"><span data-stu-id="cfecc-163">This process will result in significant downtime.</span></span>   

## <a name="upgrading-applications-that-rely-on-database-geo-replication-for-disaster-recovery"></a><span data-ttu-id="cfecc-164">Обновление приложений, полагающихся на геовосстановление базы данных в случае аварийного восстановления</span><span class="sxs-lookup"><span data-stu-id="cfecc-164">Upgrading applications that rely on database geo-replication for disaster recovery</span></span>
<span data-ttu-id="cfecc-165">Если приложение использует географическую репликацию для обеспечения непрерывности бизнеса, это развернутой tooat как минимум два разных регионах активное развертывание в основном регионе и резервный развертывания в регионе резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="cfecc-165">If your application leverages geo-replication for business continuity, it is deployed  tooat least two different regions with an active deployment in Primary region and a standby deployment in Backup region.</span></span> <span data-ttu-id="cfecc-166">В дополнение к этому toohello коэффициенты упоминалось ранее, hello процесса обновления необходимо гарантировать, что:</span><span class="sxs-lookup"><span data-stu-id="cfecc-166">In addition toohello factors mentioned earlier, hello upgrade process must guarantee that:</span></span>

* <span data-ttu-id="cfecc-167">приложение Hello остается защищенным от критическим сбоям постоянно во время обновления hello</span><span class="sxs-lookup"><span data-stu-id="cfecc-167">hello application remains protected from catastrophic failures at all times during hello upgrade process</span></span>
* <span data-ttu-id="cfecc-168">обновления компонентов географически избыточная Hello приложения hello параллельно с компонентами active hello</span><span class="sxs-lookup"><span data-stu-id="cfecc-168">hello geo-redundant components of hello application are upgraded in parallel with hello active components</span></span>

<span data-ttu-id="cfecc-169">tooachieve этих целей, будет использовать диспетчер трафика Azure (WATM) с помощью отработки отказа hello профиль с одно активное и три резервных конечных точек.</span><span class="sxs-lookup"><span data-stu-id="cfecc-169">tooachieve these goals you will leverage Azure Traffic Manager (WATM) using hello failover profile with one active and three backup endpoints.</span></span>  <span data-ttu-id="cfecc-170">Hello, следующая схема иллюстрирует процесс обновления предыдущих toohello операционной среде hello.</span><span class="sxs-lookup"><span data-stu-id="cfecc-170">hello following diagram illustrates hello operational environment prior toohello upgrade process.</span></span> <span data-ttu-id="cfecc-171">Здравствуйте, веб-сайтов <i>contoso 1.azurewebsites.net</i> и <i>contoso dr.azurewebsites.net</i> представляют производственный слот приложения hello с полной географическую избыточность.</span><span class="sxs-lookup"><span data-stu-id="cfecc-171">hello web sites <i>contoso-1.azurewebsites.net</i> and <i>contoso-dr.azurewebsites.net</i> represent a production slot of hello application with full geographic redundancy.</span></span> <span data-ttu-id="cfecc-172">tooroll возможности hello tooenable обратно Здравствуйте обновление, необходимо создать слот рабочей области с полностью синхронизированной копии приложения hello.</span><span class="sxs-lookup"><span data-stu-id="cfecc-172">tooenable hello ability tooroll back hello upgrade, you need create a stage slot with a fully synchronized copy of hello application.</span></span> <span data-ttu-id="cfecc-173">Поскольку потребуются tooensure, приложение hello быстро можно восстановить на случай сбоя во время обновления hello слот hello рабочей области должен toobe географически избыточная также.</span><span class="sxs-lookup"><span data-stu-id="cfecc-173">Because you need tooensure that hello application can quickly recover in case a catastrophic failure occurs during hello upgrade process, hello stage slot needs toobe geo-redundant as well.</span></span> <span data-ttu-id="cfecc-174">Hello следующие шаги, необходимые tooprepare hello приложения для обновления hello:</span><span class="sxs-lookup"><span data-stu-id="cfecc-174">hello following steps are required tooprepare hello application for hello upgrade:</span></span>

1. <span data-ttu-id="cfecc-175">Создайте слот рабочей области для обновления hello.</span><span class="sxs-lookup"><span data-stu-id="cfecc-175">Create a stage slot for hello upgrade.</span></span> <span data-ttu-id="cfecc-176">toodo, создание базы данных-получателя (1) и развертывание идентичную копию hello веб-сайта в hello же регионе Azure.</span><span class="sxs-lookup"><span data-stu-id="cfecc-176">toodo that create a secondary database (1) and deploy an identical copy of hello web site in hello same Azure region.</span></span> <span data-ttu-id="cfecc-177">Мониторинга получателей toosee hello, если hello заполнения процесс завершается.</span><span class="sxs-lookup"><span data-stu-id="cfecc-177">Monitor hello secondary toosee if hello seeding process is completed.</span></span>
2. <span data-ttu-id="cfecc-178">Создание географически избыточной базы данных-получателя в слоте этап hello, копируя geo hello баз данных-получателей toohello резервного копирования области (называется «связанные георепликации»).</span><span class="sxs-lookup"><span data-stu-id="cfecc-178">Create a geo-redundant secondary database in hello stage slot by geo-replicating hello secondary database toohello backup region (this is called "chained geo-replication").</span></span> <span data-ttu-id="cfecc-179">Мониторинг резервного копирования вторичной toosee hello hello заполнения процесса в случае завершенного (3).</span><span class="sxs-lookup"><span data-stu-id="cfecc-179">Monitor hello backup secondary toosee if hello seeding process is completed (3).</span></span>
3. <span data-ttu-id="cfecc-180">Создайте резервной копии hello веб-сайта в области резервного копирования hello и связать его toohello географически избыточная получателя (4).</span><span class="sxs-lookup"><span data-stu-id="cfecc-180">Create a standby copy of hello web site in hello backup region and link it toohello geo-redundant secondary (4).</span></span>  
4. <span data-ttu-id="cfecc-181">Добавить дополнительные конечные точки hello <i>contoso 2.azurewebsites.net</i> и <i>contoso 3.azurewebsites.net</i> toohello профиля отработки отказа в WATM как автономные конечные точки (5).</span><span class="sxs-lookup"><span data-stu-id="cfecc-181">Add hello additional endpoints <i>contoso-2.azurewebsites.net</i> and <i>contoso-3.azurewebsites.net</i> toohello failover profile in WATM as offline endpoints (5).</span></span> 

> [!NOTE]
> <span data-ttu-id="cfecc-182">Действия по подготовке hello Примечание не повлияет на приложение hello в производственный слот hello и он может работать в режиме полного доступа.</span><span class="sxs-lookup"><span data-stu-id="cfecc-182">Note hello preparation steps will not impact hello application in hello production slot and it can function in full access mode.</span></span>
> 
> 

![Настройка георепликации базы данных SQL](media/sql-database-manage-application-rolling-upgrade/Option2-1.png)

<span data-ttu-id="cfecc-185">После завершения действия по подготовке hello слот этап hello готовое к обновлению hello.</span><span class="sxs-lookup"><span data-stu-id="cfecc-185">Once hello preparation steps are completed, hello stage slot is ready for hello upgrade.</span></span> <span data-ttu-id="cfecc-186">Привет, следующая схема иллюстрирует hello этапы обновления.</span><span class="sxs-lookup"><span data-stu-id="cfecc-186">hello following diagram illustrates hello upgrade steps.</span></span>

1. <span data-ttu-id="cfecc-187">Задать hello базы данных-источника в hello производственный слот tooread режиме (6).</span><span class="sxs-lookup"><span data-stu-id="cfecc-187">Set hello primary database in hello production slot tooread-only mode (6).</span></span> <span data-ttu-id="cfecc-188">Это гарантирует, что hello экземпляр производственного приложения hello (V1) останется только для чтения во время обновления hello, предотвращая hello расхождение данных между hello V1 и V2 экземпляров баз данных.</span><span class="sxs-lookup"><span data-stu-id="cfecc-188">This will guarantee that hello production instance of hello application (V1) will remain read-only during hello upgrade thus preventing hello data divergence between hello V1 and V2 database instances.</span></span>  
2. <span data-ttu-id="cfecc-189">Отключение базы данных-получателя hello hello же региона с помощью hello запланированное уничтожение режим (7).</span><span class="sxs-lookup"><span data-stu-id="cfecc-189">Disconnect hello secondary database in hello same region using hello planned termination mode (7).</span></span> <span data-ttu-id="cfecc-190">Она создаст полностью синхронизированных независимая копия hello базы данных-источника, который автоматически станет основной после прекращения hello.</span><span class="sxs-lookup"><span data-stu-id="cfecc-190">It will create a fully synchronized independent copy of hello primary database, which will automatically become a primary after hello termination.</span></span> <span data-ttu-id="cfecc-191">Эта база данных будет обновлена.</span><span class="sxs-lookup"><span data-stu-id="cfecc-191">This database will be upgraded.</span></span>
3. <span data-ttu-id="cfecc-192">Включить hello базы данных-источника в режиме записи tooread слот этап hello и запустите сценарий обновления hello (8).</span><span class="sxs-lookup"><span data-stu-id="cfecc-192">Turn hello primary database in hello stage slot tooread-write mode and run hello upgrade script (8).</span></span>    

![Настройка георепликации базы данных SQL](media/sql-database-manage-application-rolling-upgrade/Option2-2.png)

<span data-ttu-id="cfecc-195">Если hello обновление успешно завершено теперь не готов tooswitch конечным пользователям hello toohello V2 версии приложения hello.</span><span class="sxs-lookup"><span data-stu-id="cfecc-195">If hello upgrade completed successfully you are now ready tooswitch hello end users toohello V2 version of hello application.</span></span> <span data-ttu-id="cfecc-196">Следующая схема Hello приведены шаги hello.</span><span class="sxs-lookup"><span data-stu-id="cfecc-196">hello following diagram illustrates hello steps involved.</span></span>

1. <span data-ttu-id="cfecc-197">Переключение hello активную конечную точку в профиль WATM hello слишком<i>contoso 2.azurewebsites.net</i>, которой теперь указывает версию toohello V2 hello веб-сайта (9).</span><span class="sxs-lookup"><span data-stu-id="cfecc-197">Switch hello active endpoint in hello WATM profile too<i>contoso-2.azurewebsites.net</i>, which now points toohello V2 version of hello web site (9).</span></span> <span data-ttu-id="cfecc-198">Она превращается в слоте продукции с hello приложения V2 и конечным пользователем трафика направленной tooit.</span><span class="sxs-lookup"><span data-stu-id="cfecc-198">It now becomes a production slot with hello V2 application and end-user traffic is directed tooit.</span></span> 
2. <span data-ttu-id="cfecc-199">Если приложение hello V1 больше не нужна, можно безопасно удалите (10 и 11).</span><span class="sxs-lookup"><span data-stu-id="cfecc-199">If you no longer need hello V1 application so you can safely remove it (10 and 11).</span></span>  

![Настройка георепликации базы данных SQL](media/sql-database-manage-application-rolling-upgrade/Option2-3.png)

<span data-ttu-id="cfecc-202">Если hello процесс обновления завершается неудачно, например из-за ошибки tooan в сценарий обновления hello, слот этап hello считается скомпрометирован.</span><span class="sxs-lookup"><span data-stu-id="cfecc-202">If hello upgrade process is unsuccessful, for example due tooan error in hello upgrade script, hello stage slot should be considered compromised.</span></span> <span data-ttu-id="cfecc-203">tooroll резервное hello toohello до обновления состояния приложения можно просто восстановить приложение hello toousing в производственный слот hello с полным доступом.</span><span class="sxs-lookup"><span data-stu-id="cfecc-203">tooroll back hello application toohello pre-upgrade state you simply revert toousing hello application in hello production slot with full access.</span></span> <span data-ttu-id="cfecc-204">Hello шаги показаны на следующей схеме hello.</span><span class="sxs-lookup"><span data-stu-id="cfecc-204">hello steps involved are shown on hello next diagram.</span></span>    

1. <span data-ttu-id="cfecc-205">Набор hello копии базы данных-источника в рабочем слоте hello tooread записи режиме (12).</span><span class="sxs-lookup"><span data-stu-id="cfecc-205">Set hello primary database copy in hello production slot tooread-write mode (12).</span></span> <span data-ttu-id="cfecc-206">Это позволит восстановить hello полный V1 функционально в производственный слот hello.</span><span class="sxs-lookup"><span data-stu-id="cfecc-206">This will restore hello full V1 functionally in hello production slot.</span></span>
2. <span data-ttu-id="cfecc-207">Выполнить анализ основных причин hello и удалите компоненты скомпрометированы hello в слоте этап hello (13 и 14).</span><span class="sxs-lookup"><span data-stu-id="cfecc-207">Perform hello root cause analysis and remove hello compromised components in hello stage slot (13 and 14).</span></span> 

<span data-ttu-id="cfecc-208">На этом этапе приложение hello осуществляется в полном объеме и может повторяться hello этапы обновления.</span><span class="sxs-lookup"><span data-stu-id="cfecc-208">At this point hello application is fully functional and hello upgrade steps can be repeated.</span></span>

> [!NOTE]
> <span data-ttu-id="cfecc-209">Hello отката не требует изменений в профиль WATM, он уже точки слишком <i>contoso 1.azurewebsites.net</i> как hello активной конечной точки.</span><span class="sxs-lookup"><span data-stu-id="cfecc-209">hello rollback does not require changes in WATM profile as it already points too <i>contoso-1.azurewebsites.net</i> as hello active endpoint.</span></span>
> 
> 

![Настройка георепликации базы данных SQL](media/sql-database-manage-application-rolling-upgrade/Option2-4.png)

<span data-ttu-id="cfecc-212">ключ Hello **преимущества** этого параметра — без ущерба для вашего непрерывность бизнес-процессов во время обновления hello можно обновить приложения hello и ее географически избыточной копии в параллельном режиме.</span><span class="sxs-lookup"><span data-stu-id="cfecc-212">hello key **advantage** of this option is that you can upgrade both hello application and its geo-redundant copy in parallel without compromising your business continuity during hello upgrade.</span></span> <span data-ttu-id="cfecc-213">основной Hello **компромисс** — оно требует двойной избыточности каждого компонента приложения и поэтому влечет за собой выше стоимость в долларах.</span><span class="sxs-lookup"><span data-stu-id="cfecc-213">hello main **tradeoff** is that it requires double redundancy of each application component and therefore incurs higher dollar cost.</span></span> <span data-ttu-id="cfecc-214">Кроме того, этот вариант подразумевает более сложный рабочий процесс.</span><span class="sxs-lookup"><span data-stu-id="cfecc-214">It also involves a more complicated workflow.</span></span> 

## <a name="summary"></a><span data-ttu-id="cfecc-215">Сводка</span><span class="sxs-lookup"><span data-stu-id="cfecc-215">Summary</span></span>
<span data-ttu-id="cfecc-216">методы Hello два обновления, описанные в статье hello отличаются по сложности и hello доллара затрат, но они оба сосредоточиться на минимизация hello время, когда конечный пользователь hello ограниченный tooread операций.</span><span class="sxs-lookup"><span data-stu-id="cfecc-216">hello two upgrade methods described in hello article differ in complexity and hello dollar cost but they both focus on minimizing hello time when hello end user is limited tooread-only operations.</span></span> <span data-ttu-id="cfecc-217">Это время определяется непосредственно hello длительность hello скрипта обновления.</span><span class="sxs-lookup"><span data-stu-id="cfecc-217">That time is directly defined by hello duration of hello upgrade script.</span></span> <span data-ttu-id="cfecc-218">Он не зависит от размера базы данных hello, уровня службы hello, вы выбрали, Настройка веб-сайтов hello и другие факторы, которые невозможно легко управлять.</span><span class="sxs-lookup"><span data-stu-id="cfecc-218">It does not depend on hello database size, hello service tier you chose, hello web site configuration and other factors that you cannot easily control.</span></span> <span data-ttu-id="cfecc-219">Это потому, что все действия по подготовке hello связаны с этапы обновления hello и может выполняться без ущерба для производственного приложения hello.</span><span class="sxs-lookup"><span data-stu-id="cfecc-219">This is because all hello preparation steps are decoupled from hello upgrade steps and can be done without impacting hello production application.</span></span> <span data-ttu-id="cfecc-220">эффективность Hello hello сценария обновления является ключевым фактором hello, определяющую hello взаимодействие с пользователем во время обновления.</span><span class="sxs-lookup"><span data-stu-id="cfecc-220">hello efficiency of hello upgrade script is hello key factor that determines hello end-user experience during upgrades.</span></span> <span data-ttu-id="cfecc-221">Поэтому hello его можно увеличить рекомендуется сосредоточиться на создании скрипта обновления hello максимально эффективные усилий.</span><span class="sxs-lookup"><span data-stu-id="cfecc-221">So hello best way you can improve it is by focusing your efforts on making hello upgrade script as efficient as possible.</span></span>  

## <a name="next-steps"></a><span data-ttu-id="cfecc-222">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="cfecc-222">Next steps</span></span>
* <span data-ttu-id="cfecc-223">Сведения об обеспечении непрерывности бизнес-процессов и возможные сценарии описаны в [обзоре непрерывности бизнес-процессов](sql-database-business-continuity.md).</span><span class="sxs-lookup"><span data-stu-id="cfecc-223">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md).</span></span>
* <span data-ttu-id="cfecc-224">toolearn о резервных копиях автоматических базы данных SQL Azure, в разделе [базы данных SQL автоматическое резервное копирование](sql-database-automated-backups.md).</span><span class="sxs-lookup"><span data-stu-id="cfecc-224">toolearn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md).</span></span>
* <span data-ttu-id="cfecc-225">toolearn об использовании автоматического создания резервных копий для восстановления, в разделе [восстановить базу данных из автоматических архивов](sql-database-recovery-using-backups.md).</span><span class="sxs-lookup"><span data-stu-id="cfecc-225">toolearn about using automated backups for recovery, see [restore a database from automated backups](sql-database-recovery-using-backups.md).</span></span>
* <span data-ttu-id="cfecc-226">toolearn о быстрее параметры восстановления, в разделе [активной георепликации](sql-database-geo-replication-overview.md).</span><span class="sxs-lookup"><span data-stu-id="cfecc-226">toolearn about faster recovery options, see [active geo-replication](sql-database-geo-replication-overview.md).</span></span>


