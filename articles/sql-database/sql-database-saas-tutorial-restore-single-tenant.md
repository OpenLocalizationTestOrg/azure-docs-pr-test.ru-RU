---
title: "aaaRestore базе данных Azure SQL в приложении несколькими клиентами | Документы Microsoft"
description: "Узнайте, как toorestore один клиенты SQL базы данных после случайного удаления данных"
keywords: "руководство по базе данных sql"
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/10/2017
ms.author: billgib;sstein
ms.openlocfilehash: 8507ecec2424c135f1859b88ebf2bb4e17538a58
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="restore-a-wingtip-saas-tenants-sql-database"></a>Восстановление базы данных SQL клиентов SaaS Wingtip

приложение Wingtip SaaS Hello строится с помощью модели базы данных каждого клиента, где каждый клиент имеет собственную базу данных. Одно из преимуществ hello этой модели — что он является простой toorestore данных одного клиента в изоляции без ущерба для других клиентов.

В этом руководстве рассматривается два шаблона восстановления данных:

> [!div class="checklist"]

> * восстановление базы данных в параллельную базу данных (параллельное восстановление);
> * восстановить базу данных "на месте".


|||
|:--|:--|
| **Восстановление предыдущей точки tooa клиента времени в параллельных базу данных** | Этот шаблон может использоваться клиентом hello для проверки, аудита, соответствия, т. д., исходное hello база данных остается в сети и без изменений. |
| **Восстановление клиента "на месте"** | Этот шаблон является типовыми toorecover точку предыдущего tooa клиента времени после клиента случайно удалил данные. Hello исходной базы данных в автономный и заменены hello восстановленной базы данных. |
|||

toocomplete завершения этого учебника, убедитесь, что hello следующие предварительные требования:

* приложение Wingtip SaaS Hello развертывается. toodeploy менее чем за пять минут. в разделе [развертывание и просмотр приложения Wingtip SaaS hello](sql-database-saas-tutorial.md)
* Установите Azure PowerShell. Дополнительные сведения см. в статье [Начало работы с Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps).

## <a name="introduction-toohello-saas-tenant-restore-pattern"></a>Введение toohello SaaS клиента восстановления шаблон

Для клиента hello восстановление шаблон, есть два простых подхода для восстановления данных отдельного клиента. Так как базы данных клиента изолированы, восстановление одного клиента не влияет на данные других клиентов.

В первом шаблоне hello данные восстанавливаются в новую базу данных. Hello клиента предоставляется доступ к базе данных toothis вместе с их рабочими данными. Этот шаблон позволяет admin tooreview hello восстановления данных клиента и использовать его tooselectively перезаписать текущие значения данных. Он работает toohello SaaS приложения конструктора toodetermine как сложных hello параметры должны быть восстановления данных. Не может tooreview данных в состояние hello, в котором она находилась в в определенный момент времени может быть все, что является обязательным в некоторых сценариях. Если база данных hello использует [георепликации](sql-database-geo-replication-overview.md), мы рекомендуем копирование hello необходимых данных из копии восстановить hello в исходной базе данных hello. При замене hello исходной базы данных с базой данных восстановления hello, требуется tooreconfigure и повторная синхронизация географической репликации.

В hello второй шаблон, который имеет этот клиент hello произошла потеря или повреждение данных, восстанавливается рабочей базы данных клиента hello tooa предыдущий момент времени. Во время восстановления hello в месте шаблон клиента hello переводится в автономный режим на короткое время во время hello базы данных восстановлена и переведена в режим в сети. Hello исходная база данных удаляется, но по-прежнему могут быть восстановлены из при необходимости назад tooan toogo даже более раннего момента времени. Разновидность этот шаблон может переименовать hello базы данных, а не удаляйте его, несмотря на то, что переименование базы данных hello предлагает никаких дополнительных преимуществ с точки зрения безопасности данных.

## <a name="get-hello-wingtip-application-scripts"></a>Получение скриптов приложения Wingtip hello

Hello Wingtip SaaS скриптов и исходный код приложения были доступны в hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) в репозитории github. [Действия скриптов Wingtip SaaS hello toodownload](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).

## <a name="simulate-a-tenant-accidentally-deleting-data"></a>Моделирование случайного удаления данных клиента

toodemonstrate эти сценарии восстановления необходимо слишком*случайно* удалить некоторые данные в одной из баз данных клиента hello. При удалении любой записи нарушения ссылочной целостности быть заблокирован hello следующий шаг настраивает toonot Демонстрация hello! Он также добавляет некоторые данные покупку билета, можно использовать позже в hello *Wingtip SaaS Analytics учебники*.

Выполнить скрипт генератор билет hello и создать дополнительные данные. Генератор билет Hello намеренно не приобрели билетов для каждого события последнего клиентов.

1. Открыть... \\Модулей обучения\\программы\\*Демонстрация TicketGenerator.ps1* в hello *интегрированной среды Сценариев PowerShell*
1. Нажмите клавишу **F5** toorun hello скрипта и создания клиентов и билета данные о продажах.


### <a name="open-hello-events-app-tooreview-hello-current-events"></a>Откройте hello события приложения tooreview hello текущих событий

1. Откройте hello *концентратора событий* (http://events.wtp.&lt; пользователь&gt;. trafficmanager.net) и нажмите кнопку **Hall совместно Contoso**:

   ![Концентратор событий](media/sql-database-saas-tutorial-restore-single-tenant/events-hub.png)

1. Прокрутите список событий hello и запишите hello последнего события в списке hello:

   ![Последнее событие](media/sql-database-saas-tutorial-restore-single-tenant/last-event.png)


### <a name="run-hello-demo-scenario-tooaccidentally-delete-hello-last-event"></a>Запустите hello демонстрационный сценарий tooaccidentally delete hello последнего события

1. Открыть... \\Модулей обучения\\непрерывности и аварийного восстановления\\RestoreTenant\\*Демонстрация RestoreTenant.ps1* в hello *интегрированной среды Сценариев PowerShell*, и набор hello следующие значения:
   * **$DemoScenario** = **1**, задайте слишком**1** -удалить события без продаж билета.
1. Нажмите клавишу **F5** toorun hello скрипта и удаление последнего события hello. Вы увидите подтверждение сообщения аналогичные toohello следующее:

   ```Console
   Deleting unsold events from Contoso Concert Hall ...
   Deleted event 'Seriously Strauss' from Contoso Concert Hall venue.
   ```

1. Откроется страница событий Contoso Hello. Прокрутите вниз и убедитесь, что событие hello удаляется. Если по-прежнему в списке hello событие hello, щелкните "Обновить" и убедитесь, что он удаляется.

   ![Последнее событие](media/sql-database-saas-tutorial-restore-single-tenant/last-event-deleted.png)


## <a name="restore-a-tenant-database-in-parallel-with-hello-production-database"></a>Восстановление базы данных клиента параллельно с hello рабочей базы данных

В этом упражнении производится восстановление hello базы данных Contoso совместно Hall tooa на момент времени перед hello событие было удалено. После удаления события hello в предыдущих шагах hello необходимо toorecover и просматривать данные удалены hello. Не требуется toorestore рабочей базы данных с записью hello удалены, но необходимо toorecover hello старой базы данных tooaccess hello старые данные по другим причинам бизнеса.

 Hello *восстановления TenantInParallel.ps1* сценарий создает параллельных клиента базы данных и параллельной записи каталога оба с именем *ContosoConcertHall\_старый*. Этот шаблон лучше всего подходит для восстановления после незначительной потери данных или сценариев восстановления данных с обеспечением соответствия требованиям и аудита. Это рекомендованный подход, при использовании hello [георепликации](sql-database-geo-replication-overview.md).

1. Полный hello [имитировать пользователя случайное удаление данных](#simulate-a-tenant-accidentally-deleting-data) раздела.
1. Открыть... \\Модулей обучения\\непрерывности и аварийного восстановления\\RestoreTenant\\_Демонстрация RestoreTenant.ps1_ в hello *интегрированной среды Сценариев PowerShell*.
1. Задать **$DemoScenario** = **2**, установите это слишком**2** слишком*восстановления клиента в параллельном режиме*.
1. Нажмите клавишу **F5** toorun hello скрипта.

Hello скрипта восстанавливает hello клиента (база данных tooa параллельных) tooa точки времени до удаления события hello в предыдущем разделе hello. Она создает вторую базу данных, удаляет все существующие метаданные каталога, который существует в этой базе данных, а также добавляет каталог toohello hello базы данных в списке hello *ContosoConcertHall\_старый* входа.

скрипт демонстрации Hello открывает страницу события hello в браузере. Примечание с URL-адреса hello: ```http://events.wtp.&lt;user&gt;.trafficmanager.net/contosoconcerthall_old``` , это является передача данных из базы данных восстановлена hello где *_old* добавляется имя toohello.

Прокрутки hello событий, перечисленных в браузере tooconfirm hello, hello событий, удаленные в предыдущем разделе hello был восстановлен.

Обратите внимание этому предоставление клиенту hello восстановить как маловероятно, что toobe, как можно будет обеспечить данных toorestored доступа клиента, но служит tooeasily иллюстрируют шаблон hello восстановления дополнительных клиента, используя свой собственный билеты toobrowse событий приложения.

На самом деле вы, вероятно, только сохраните эту восстановленную базу данных на определенный период. Можно удалить запись клиента hello восстановлена после завершения, вызывающему Привет *RestoredTenant.ps1 удаление* сценария.

1. Задать **$DemoScenario** слишком**4** tooselect hello *клиента восстановить удаление* сценария.
1. **Выполните этот сценарий**, **нажав клавишу** **F5**.
1. Hello *ContosoConcertHall\_старый* запись удаляется, из каталога hello. Продолжить и закрыть страницу приветствия события для этого клиента в браузере.


## <a name="restore-a-tenant-in-place-replacing-hello-existing-tenant-database"></a>Восстановление клиент в месте, заменив hello существующей базы данных клиента

В этом упражнении восстанавливает hello Hall совместно Contoso клиента tooa точки предшествующей hello событие было удалено. Hello *TenantInPlace восстановления* скрипт восстанавливает hello текущего клиента базы данных tooa новой базы данных указывает tooa предыдущий момент времени, и удаляет hello исходной базы данных. Такая модель восстановления больше подходит для восстановление после повреждения данных серьезной, как может быть значительной потере данных, hello клиента будет иметь tooaccommodate.

1. Откройте файл **Demo-RestoreTenant.ps1** в интегрированной среде сценариев PowerShell.
1. Задать **$DemoScenario** слишком**5** tooselect hello *восстановления клиента в месте сценарии*.
1. Выполните этот сценарий, нажав клавишу **F5**.

Hello скрипта восстанавливает базу данных tooa hello клиента точки пять минут, прежде чем hello событие было удалено. Это делается путем первого занимает hello Contoso совместно Hall клиента в автономном режиме, поэтому более нет обновляет данные toohello. Затем создается путем восстановления из точки восстановления hello и с именем параллельных базы данных с меткой времени, имя базы данных tooensure hello не конфликтует с именем существующей базы данных клиента hello. Затем удаляется hello старой базы данных клиента и hello Восстановленная база данных будет переименовано toohello исходное имя базы данных. Наконец Contoso совместно Hall переводится в режим online tooallow доступа приложения hello toohello восстановления базы данных.

Успешно восстановлены tooa hello базы данных на момент времени, прежде чем hello событие было удалено. Здравствуйте, открывается страница события, поэтому подтверждение восстановила приветствия последнего события.


## <a name="next-steps"></a>Дальнейшие действия

Из этого руководства вы узнали, как выполнять такие задачи:

> [!div class="checklist"]

> * восстановить базу данных в параллельную базу данных (параллельное восстановление);
> * восстановить базу данных "на месте".

[Manage schema for multiple tenants in the WTP SaaS application](sql-database-saas-tutorial-schema-management.md) (Управление схемой нескольких клиентов в SaaS-приложении WTP)

## <a name="additional-resources"></a>Дополнительные ресурсы

* Дополнительные [учебники, которые созданы на основе Wingtip SaaS приложения hello](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)
* [Обзор обеспечения непрерывности бизнес-процессов с помощью базы данных SQL Azure](sql-database-business-continuity.md)
* [Подробнее о резервном копировании базы данных SQL](sql-database-automated-backups.md)
