---
title: "aaaDistributed транзакций между базами данных облака"
description: "Общие сведения о транзакциях эластичной базы данных в базе данных SQL Azure"
services: sql-database
documentationcenter: 
author: torsteng
manager: jhubbard
editor: torsteng
ms.assetid: e14df7a3-7788-4cfb-bcd1-7ad6433ef1f9
ms.service: sql-database
ms.custom: scale out apps
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: sql-database
ms.date: 05/27/2016
ms.author: torsteng
ms.openlocfilehash: 9a18f2749108d337bf115b3dc21dd0c7828dd9c2
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="distributed-transactions-across-cloud-databases"></a><span data-ttu-id="dd7ac-103">Распределенные транзакции по облачным базам данных</span><span class="sxs-lookup"><span data-stu-id="dd7ac-103">Distributed transactions across cloud databases</span></span>
<span data-ttu-id="dd7ac-104">Транзакции эластичной базы данных для базы данных SQL Azure (база данных SQL) позволяют toorun транзакций, которые охватывают несколько баз данных в базу данных SQL.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-104">Elastic database transactions for Azure SQL Database (SQL DB) allow you toorun transactions that span several databases in SQL DB.</span></span> <span data-ttu-id="dd7ac-105">Транзакции эластичной базы данных для базы данных SQL доступны для приложений .NET с помощью ADO .NET и интегрировать hello знакомый программный интерфейс с помощью hello [System.Transaction](https://msdn.microsoft.com/library/system.transactions.aspx) классы.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-105">Elastic database transactions for SQL DB are available for .NET applications using ADO .NET and integrate with hello familiar programming experience using hello [System.Transaction](https://msdn.microsoft.com/library/system.transactions.aspx) classes.</span></span> <span data-ttu-id="dd7ac-106">Библиотека tooget hello, в разделе [.NET Framework 4.6.1 (веб-установщик)](https://www.microsoft.com/download/details.aspx?id=49981).</span><span class="sxs-lookup"><span data-stu-id="dd7ac-106">tooget hello library, see [.NET Framework 4.6.1 (Web Installer)](https://www.microsoft.com/download/details.aspx?id=49981).</span></span>

<span data-ttu-id="dd7ac-107">При локальном выполнении такого сценария, как правило, требуется использовать координатор распределенных транзакций Майкрософт (MSDTC).</span><span class="sxs-lookup"><span data-stu-id="dd7ac-107">On premises, such a scenario usually required running Microsoft Distributed Transaction Coordinator (MSDTC).</span></span> <span data-ttu-id="dd7ac-108">Поскольку MSDTC не доступен для приложения платформа как служба в Azure, hello возможность toocoordinate распределенных транзакций теперь напрямую интегрирован в баз данных SQL Server.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-108">Since MSDTC is not available for Platform-as-a-Service application in Azure, hello ability toocoordinate distributed transactions has now been directly integrated into SQL DB.</span></span> <span data-ttu-id="dd7ac-109">Приложения могут подключаться tooany базы данных SQL toolaunch распределенных транзакций и одной из баз данных hello прозрачно координирует hello распределенных транзакций, как показано в hello следующий рисунок.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-109">Applications can connect tooany SQL Database toolaunch distributed transactions, and one of hello databases will transparently coordinate hello distributed transaction, as shown in hello following figure.</span></span> 

  ![<span data-ttu-id="dd7ac-110">Осуществление распределенных транзакций в базе данных SQL Azure с использованием транзакций эластичной базы данных</span><span class="sxs-lookup"><span data-stu-id="dd7ac-110">Distributed transactions with Azure SQL Database using elastic database transactions</span></span> ][1]

## <a name="common-scenarios"></a><span data-ttu-id="dd7ac-111">Распространенные сценарии</span><span class="sxs-lookup"><span data-stu-id="dd7ac-111">Common scenarios</span></span>
<span data-ttu-id="dd7ac-112">Транзакции эластичной базы данных для баз данных SQL Server включите toodata atomic изменения toomake приложений, хранятся в нескольких базах данных SQL.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-112">Elastic database transactions for SQL DB enable applications toomake atomic changes toodata stored in several different SQL Databases.</span></span> <span data-ttu-id="dd7ac-113">Предварительный просмотр Hello основное внимание уделяется опыт разработки на стороне клиента в C# и .NET.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-113">hello preview focuses on client-side development experiences in C# and .NET.</span></span> <span data-ttu-id="dd7ac-114">В будущем планируется предоставить возможность такой работы на сервере с использованием T-SQL.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-114">A server-side experience using T-SQL is planned for a later time.</span></span>  
<span data-ttu-id="dd7ac-115">Целевые объекты транзакций эластичных баз данных hello следующие сценарии:</span><span class="sxs-lookup"><span data-stu-id="dd7ac-115">Elastic database transactions targets hello following scenarios:</span></span>

* <span data-ttu-id="dd7ac-116">Приложения в Azure, использующие несколько баз данных. Этот сценарий предусматривает вертикальное секционирование данных между несколькими базами данных в базе данных SQL. В результате разные виды данных находятся в разных базах данных.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-116">Multi-database applications in Azure: With this scenario, data is vertically partitioned across several databases in SQL DB such that different kinds of data reside on different databases.</span></span> <span data-ttu-id="dd7ac-117">Некоторые операции требуют изменения toodata, который находится в двух или нескольких баз данных.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-117">Some operations require changes toodata which is kept in two or more databases.</span></span> <span data-ttu-id="dd7ac-118">Hello приложение использует изменения hello toocoordinate транзакций эластичных баз данных между базами данных и обеспечения атомарности.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-118">hello application uses elastic database transactions toocoordinate hello changes across databases and ensure atomicity.</span></span>
* <span data-ttu-id="dd7ac-119">Сегментированной базы данных приложения в Azure: В этом случае уровень данных hello использует hello [клиентской библиотеке эластичной базы данных](sql-database-elastic-database-client-library.md) или toohorizontally самостоятельное сегментирование секционирования данных hello многих базах данных в базу данных SQL.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-119">Sharded database applications in Azure: With this scenario, hello data tier uses hello [Elastic Database client library](sql-database-elastic-database-client-library.md) or self-sharding toohorizontally partition hello data across many databases in SQL DB.</span></span> <span data-ttu-id="dd7ac-120">Один вариант использования Показательным при hello необходимость tooperform atomic изменения для сегментированной многопользовательского приложения изменения span клиентов.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-120">One prominent use case is hello need tooperform atomic changes for a sharded multi-tenant application when changes span tenants.</span></span> <span data-ttu-id="dd7ac-121">Для экземпляра представить перенаправление от одного клиента tooanother, находящихся на разных базах данных.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-121">Think for instance of a transfer from one tenant tooanother, both residing on different databases.</span></span> <span data-ttu-id="dd7ac-122">Второй случай — потребностей в емкости tooaccommodate детальной сегментирования для больших клиента, который в свою очередь, обычно означает, что некоторые toostretch потребностей атомарных операций между несколькими базами данных, используемый для hello же клиента.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-122">A second case is fine-grained sharding tooaccommodate capacity needs for a large tenant which in turn typically implies that some atomic operations needs toostretch across several databases used for hello same tenant.</span></span> <span data-ttu-id="dd7ac-123">Третий вариант — atomic tooreference те данные, которые реплицируются в базах данных.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-123">A third case is atomic updates tooreference data that are replicated across databases.</span></span> <span data-ttu-id="dd7ac-124">Atomic, с поддержкой транзакций, операции подобным образом можно координируемой теперь между несколькими базами данных с помощью предварительного просмотра hello.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-124">Atomic, transacted, operations along these lines can now be coordinated across several databases using hello preview.</span></span>
  <span data-ttu-id="dd7ac-125">Транзакции, эластичной базы данных используют атомарность транзакции tooensure двухфазной фиксации между базами данных.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-125">Elastic database transactions use two-phase commit tooensure transaction atomicity across databases.</span></span> <span data-ttu-id="dd7ac-126">Этот вариант прекрасно подходит для тех случаев, когда в одной транзакции одновременно участвует менее 100 баз данных.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-126">It is a good fit for transactions that involve less than 100 databases at a time within a single transaction.</span></span> <span data-ttu-id="dd7ac-127">Эти ограничения не применяются, но один следует ожидать производительности и показатели успеха для toosuffer транзакций эластичных баз данных, при превышении этих ограничений.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-127">These limits are not enforced, but one should expect performance and success rates for elastic database transactions toosuffer when exceeding these limits.</span></span>

## <a name="installation-and-migration"></a><span data-ttu-id="dd7ac-128">Установка и миграция</span><span class="sxs-lookup"><span data-stu-id="dd7ac-128">Installation and migration</span></span>
<span data-ttu-id="dd7ac-129">возможности Hello транзакций эластичных баз данных в базы данных SQL доступны через обновления библиотек .NET toohello System.Data.dll и System.Transactions.dll.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-129">hello capabilities for elastic database transactions in SQL DB are provided through updates toohello .NET libraries System.Data.dll and System.Transactions.dll.</span></span> <span data-ttu-id="dd7ac-130">Hello DLL-библиотеки убедитесь, что двухфазной фиксации используется при необходимости tooensure атомарность.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-130">hello DLLs ensure that two-phase commit is used where necessary tooensure atomicity.</span></span> <span data-ttu-id="dd7ac-131">Установка toostart разработки приложений с помощью транзакций эластичных баз данных, [.NET Framework 4.6.1](https://www.microsoft.com/download/details.aspx?id=49981) или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-131">toostart developing applications using elastic database transactions, install [.NET Framework 4.6.1](https://www.microsoft.com/download/details.aspx?id=49981) or a later version.</span></span> <span data-ttu-id="dd7ac-132">При работе в более ранней версии платформы hello .NET framework транзакции завершится ошибкой toopromote tooa распределенных транзакций и будет вызвано исключение.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-132">When running on an earlier version of hello .NET framework, transactions will fail toopromote tooa distributed transaction and an exception will be raised.</span></span>

<span data-ttu-id="dd7ac-133">После установки можно использовать hello распределенных транзакций API-интерфейсы System.Transactions с tooSQL подключения базы данных.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-133">After installation, you can use hello distributed transaction APIs in System.Transactions with connections tooSQL DB.</span></span> <span data-ttu-id="dd7ac-134">При наличии существующих приложений MSDTC с помощью этих API, просто перестроения существующие приложения .NET 4.6 После установки hello 4.6.1 Framework.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-134">If you have existing MSDTC applications using these APIs, simply rebuild your existing applications for .NET 4.6 after installing hello 4.6.1 Framework.</span></span> <span data-ttu-id="dd7ac-135">Если проекты платформы .NET 4.6, они будут автоматически использовать DLL-библиотеками hello обновлены hello новая версия .NET Framework и вызовы API распределенной транзакции в сочетании с tooSQL подключения базы данных теперь будут выполнены.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-135">If your projects target .NET 4.6, they will automatically use hello updated DLLs from hello new Framework version and distributed transaction API calls in combination with connections tooSQL DB will now succeed.</span></span>

<span data-ttu-id="dd7ac-136">Учтите, что для выполнения транзакций эластичной базы данных не требуется установка MSDTC.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-136">Remember that elastic database transactions do not require installing MSDTC.</span></span> <span data-ttu-id="dd7ac-137">Вместо этого управление такими транзакциями осуществляется непосредственно в базе данных SQL.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-137">Instead, elastic database transactions are directly managed by and within SQL DB.</span></span> <span data-ttu-id="dd7ac-138">Это значительно упрощает облачных сценариев, поскольку развертывание MSDTC не необходимые toouse распределенных транзакций с баз данных SQL Server.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-138">This significantly simplifies cloud scenarios since a deployment of MSDTC is not necessary toouse distributed transactions with SQL DB.</span></span> <span data-ttu-id="dd7ac-139">Раздел 4 более подробно объясняется, как транзакции toodeploy эластичной базы данных и hello требуется .NET framework вместе с вашей tooAzure облачных приложений.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-139">Section 4 explains in more detail how toodeploy elastic database transactions and hello required .NET framework together with your cloud applications tooAzure.</span></span>

## <a name="development-experience"></a><span data-ttu-id="dd7ac-140">Разработка</span><span class="sxs-lookup"><span data-stu-id="dd7ac-140">Development experience</span></span>
### <a name="multi-database-applications"></a><span data-ttu-id="dd7ac-141">Приложения, использующие несколько баз данных</span><span class="sxs-lookup"><span data-stu-id="dd7ac-141">Multi-database applications</span></span>
<span data-ttu-id="dd7ac-142">Hello следующий образец кода использует знакомый интерфейс программирования hello с .NET System.Transactions.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-142">hello following sample code uses hello familiar programming experience with .NET System.Transactions.</span></span> <span data-ttu-id="dd7ac-143">класс TransactionScope Hello устанавливает внешнюю транзакцию в .NET.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-143">hello TransactionScope class establishes an ambient transaction in .NET.</span></span> <span data-ttu-id="dd7ac-144">(«Внешней транзакции» является один, которая находится в текущем потоке hello.) Все соединения, открытые в hello TransactionScope участвовать в транзакции hello.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-144">(An “ambient transaction” is one that lives in hello current thread.) All connections opened within hello TransactionScope participate in hello transaction.</span></span> <span data-ttu-id="dd7ac-145">Если участвует в разных базах данных, hello транзакция автоматически с повышенными привилегиями tooa распределенных транзакций.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-145">If different databases participate, hello transaction is automatically elevated tooa distributed transaction.</span></span> <span data-ttu-id="dd7ac-146">Hello результат транзакции hello задается с помощью tooindicate toocomplete область hello фиксации.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-146">hello outcome of hello transaction is controlled by setting hello scope toocomplete tooindicate a commit.</span></span>

    using (var scope = new TransactionScope())
    {
        using (var conn1 = new SqlConnection(connStrDb1))
        {
            conn1.Open();
            SqlCommand cmd1 = conn1.CreateCommand();
            cmd1.CommandText = string.Format("insert into T1 values(1)");
            cmd1.ExecuteNonQuery();
        }

        using (var conn2 = new SqlConnection(connStrDb2))
        {
            conn2.Open();
            var cmd2 = conn2.CreateCommand();
            cmd2.CommandText = string.Format("insert into T2 values(2)");
            cmd2.ExecuteNonQuery();
        }

        scope.Complete();
    }

### <a name="sharded-database-applications"></a><span data-ttu-id="dd7ac-147">Приложения, использующие сегментированные базы данных</span><span class="sxs-lookup"><span data-stu-id="dd7ac-147">Sharded database applications</span></span>
<span data-ttu-id="dd7ac-148">Транзакции эластичной базы данных для базы данных SQL поддерживает координацию распределенных транзакций, где для горизонтальным масштабированием данных используется метод OpenConnectionForKey hello hello эластичной базы данных клиентских библиотек tooopen подключений уровня.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-148">Elastic database transactions for SQL DB also support coordinating distributed transactions where you use hello OpenConnectionForKey method of hello elastic database client library tooopen connections for a scaled out data tier.</span></span> <span data-ttu-id="dd7ac-149">Рассмотрите возможность которых требуется согласованность транзакций tooguarantee для изменения через несколько значений ключа сегментирования различных случаях.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-149">Consider cases where you need tooguarantee transactional consistency for changes across several different sharding key values.</span></span> <span data-ttu-id="dd7ac-150">Размещение значений ключа сегментирования различных hello сегментов toohello подключения являются посредника с помощью OpenConnectionForKey.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-150">Connections toohello shards hosting hello different sharding key values are brokered using OpenConnectionForKey.</span></span> <span data-ttu-id="dd7ac-151">В общем случае hello hello соединения может быть сегментов toodifferent таким образом, что обеспечение гарантии транзакций требует распределенной транзакции.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-151">In hello general case, hello connections can be toodifferent shards such that ensuring transactional guarantees requires a distributed transaction.</span></span> <span data-ttu-id="dd7ac-152">Этот подход показан следующий образец кода Hello.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-152">hello following code sample illustrates this approach.</span></span> <span data-ttu-id="dd7ac-153">Предположения, что переменная с именем shardmap является используется toorepresent из клиентской библиотеки hello эластичной базы данных по карте сегментов:</span><span class="sxs-lookup"><span data-stu-id="dd7ac-153">It assumes that a variable called shardmap is used toorepresent a shard map from hello elastic database client library:</span></span>

    using (var scope = new TransactionScope())
    {
        using (var conn1 = shardmap.OpenConnectionForKey(tenantId1, credentialsStr))
        {
            conn1.Open();
            SqlCommand cmd1 = conn1.CreateCommand();
            cmd1.CommandText = string.Format("insert into T1 values(1)");
            cmd1.ExecuteNonQuery();
        }

        using (var conn2 = shardmap.OpenConnectionForKey(tenantId2, credentialsStr))
        {
            conn2.Open();
            var cmd2 = conn2.CreateCommand();
            cmd2.CommandText = string.Format("insert into T1 values(2)");
            cmd2.ExecuteNonQuery();
        }

        scope.Complete();
    }


## <a name="net-installation-for-azure-cloud-services"></a><span data-ttu-id="dd7ac-154">Установка .NET для облачных служб Azure</span><span class="sxs-lookup"><span data-stu-id="dd7ac-154">.NET installation for Azure Cloud Services</span></span>
<span data-ttu-id="dd7ac-155">Azure предоставляет несколько предложений toohost приложений .NET.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-155">Azure provides several offerings toohost .NET applications.</span></span> <span data-ttu-id="dd7ac-156">Сравнение разных предложений hello доступна в [службе приложений Azure, облачных служб и виртуальных машин сравнения](../app-service-web/choose-web-site-cloud-service-vm.md).</span><span class="sxs-lookup"><span data-stu-id="dd7ac-156">A comparison of hello different offerings is available in [Azure App Service, Cloud Services, and Virtual Machines comparison](../app-service-web/choose-web-site-cloud-service-vm.md).</span></span> <span data-ttu-id="dd7ac-157">Если hello гостевой ОС предложения hello меньше, чем .NET 4.6.1, необходимые для эластичного транзакций, необходимо tooupgrade hello гостевой ОС too4.6.1.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-157">If hello guest OS of hello offering is smaller than .NET 4.6.1 required for elastic transactions, you need tooupgrade hello guest OS too4.6.1.</span></span> 

<span data-ttu-id="dd7ac-158">Для службы приложений Azure обновляет toohello гостевой ОС в настоящее время не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-158">For Azure App Services, upgrades toohello guest OS are currently not supported.</span></span> <span data-ttu-id="dd7ac-159">Для виртуальных машин в Azure, просто войдите hello виртуальной Машины и запустите установщик hello для hello последнюю версию .NET framework.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-159">For Azure Virtual Machines, simply log into hello VM and run hello installer for hello latest .NET framework.</span></span> <span data-ttu-id="dd7ac-160">Для облачных служб Azure необходимо tooinclude установки более новой версии .NET hello в задачах запуска hello развертывания.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-160">For Azure Cloud Services, you need tooinclude hello installation of a newer .NET version into hello startup tasks of your deployment.</span></span> <span data-ttu-id="dd7ac-161">Основные понятия Hello и шаги описаны в [установить .NET на роли облачной службы](../cloud-services/cloud-services-dotnet-install-dotnet.md).</span><span class="sxs-lookup"><span data-stu-id="dd7ac-161">hello concepts and steps are documented in [Install .NET on a Cloud Service Role](../cloud-services/cloud-services-dotnet-install-dotnet.md).</span></span>  

<span data-ttu-id="dd7ac-162">Обратите внимание, что hello установщика для .NET 4.6.1 может потребоваться несколько временного хранилища во время начальной загрузки процесса в облачных службах Azure, чем hello установщик .NET 4.6 hello.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-162">Note that hello installer for .NET 4.6.1 may require more temporary storage during hello bootstrapping process on Azure cloud services than hello installer for .NET 4.6.</span></span> <span data-ttu-id="dd7ac-163">tooensure успешной установки требуется tooincrease временное хранилище для облачной службы Azure в файле ServiceDefinition.csdef в разделе LocalResources hello и параметры среды hello задачей запуска, как показано в следующих hello Пример:</span><span class="sxs-lookup"><span data-stu-id="dd7ac-163">tooensure a successful installation, you need tooincrease temporary storage for your Azure cloud service in your ServiceDefinition.csdef file in hello LocalResources section and hello environment settings of your startup task, as shown in hello following sample:</span></span>

    <LocalResources>
    ...
        <LocalStorage name="TEMP" sizeInMB="5000" cleanOnRoleRecycle="false" />
        <LocalStorage name="TMP" sizeInMB="5000" cleanOnRoleRecycle="false" />
    </LocalResources>
    <Startup>
        <Task commandLine="install.cmd" executionContext="elevated" taskType="simple">
            <Environment>
        ...
                <Variable name="TEMP">
                    <RoleInstanceValue xpath="/RoleEnvironment/CurrentInstance/LocalResources/LocalResource[@name='TEMP']/@path" />
                </Variable>
                <Variable name="TMP">
                    <RoleInstanceValue xpath="/RoleEnvironment/CurrentInstance/LocalResources/LocalResource[@name='TMP']/@path" />
                </Variable>
            </Environment>
        </Task>
    </Startup>

## <a name="transactions-across-multiple-servers"></a><span data-ttu-id="dd7ac-164">Транзакции между несколькими серверами</span><span class="sxs-lookup"><span data-stu-id="dd7ac-164">Transactions across multiple servers</span></span>
<span data-ttu-id="dd7ac-165">Транзакции эластичной базы данных поддерживаются для разных логических серверов в базе данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-165">Elastic database transactions are supported across different logical servers in Azure SQL Database.</span></span> <span data-ttu-id="dd7ac-166">Если транзакции пересекает границы логического сервера, серверах-участниках hello сначала необходимо toobe, введенные в отношении взаимного обмена данными.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-166">When transactions cross logical server boundaries, hello participating servers first need toobe entered into a mutual communication relationship.</span></span> <span data-ttu-id="dd7ac-167">После установления связи связи hello любой базы данных, в каком-либо hello два сервера может участвовать в эластичный операций с базами данных из hello другой сервер.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-167">Once hello communication relationship has been established, any database in any of hello two servers can participate in elastic transactions with databases from hello other server.</span></span> <span data-ttu-id="dd7ac-168">С транзакциями, объединение более двух логических серверов связь связи должен toobe на месте для любой пары логических серверов.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-168">With transactions spanning more than two logical servers, a communication relationship needs toobe in place for any pair of logical servers.</span></span>

<span data-ttu-id="dd7ac-169">Используйте hello следующие связи связи между серверами toomanage командлеты PowerShell для транзакций эластичных баз данных:</span><span class="sxs-lookup"><span data-stu-id="dd7ac-169">Use hello following PowerShell cmdlets toomanage cross-server communication relationships for elastic database transactions:</span></span>

* <span data-ttu-id="dd7ac-170">**Новый AzureRmSqlServerCommunicationLink**: используйте этот командлет toocreate отношение связь между двумя логическими серверами в базу данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-170">**New-AzureRmSqlServerCommunicationLink**: Use this cmdlet toocreate a new communication relationship between two logical servers in Azure SQL DB.</span></span> <span data-ttu-id="dd7ac-171">связь Hello симметричный что означает, что на обоих серверах могут инициировать транзакции с hello другой сервер.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-171">hello relationship is symmetric which means both servers can initiate transactions with hello other server.</span></span>
* <span data-ttu-id="dd7ac-172">**Get-AzureRmSqlServerCommunicationLink**: используйте этот командлет tooretrieve существующие связи отношений и их свойства.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-172">**Get-AzureRmSqlServerCommunicationLink**: Use this cmdlet tooretrieve existing communication relationships and their properties.</span></span>
* <span data-ttu-id="dd7ac-173">**Удаление AzureRmSqlServerCommunicationLink**: используйте этот командлет tooremove существующую связь связи.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-173">**Remove-AzureRmSqlServerCommunicationLink**: Use this cmdlet tooremove an existing communication relationship.</span></span> 

## <a name="monitoring-transaction-status"></a><span data-ttu-id="dd7ac-174">Мониторинг состояния транзакций</span><span class="sxs-lookup"><span data-stu-id="dd7ac-174">Monitoring transaction status</span></span>
<span data-ttu-id="dd7ac-175">Используйте динамические административные представления (DMV) в БД SQL toomonitor состояние и ход выполнения транзакций Текущих эластичной базы данных.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-175">Use Dynamic Management Views (DMVs) in SQL DB toomonitor status and progress of your ongoing elastic database transactions.</span></span> <span data-ttu-id="dd7ac-176">Все динамические административные представления, связанные tootransactions важны для распределенных транзакций в базу данных SQL.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-176">All DMVs related tootransactions are relevant for distributed transactions in SQL DB.</span></span> <span data-ttu-id="dd7ac-177">Список можно найти hello соответствующих динамических административных представлений здесь: [транзакции динамические административные представления и функции (Transact-SQL)](https://msdn.microsoft.com/library/ms178621.aspx).</span><span class="sxs-lookup"><span data-stu-id="dd7ac-177">You can find hello corresponding list of DMVs here: [Transaction Related Dynamic Management Views and Functions (Transact-SQL)](https://msdn.microsoft.com/library/ms178621.aspx).</span></span>

<span data-ttu-id="dd7ac-178">Особенно полезны следующие динамические административные представления.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-178">These DMVs are particularly useful:</span></span>

* <span data-ttu-id="dd7ac-179">**sys.dm\_tran\_active\_transactions** — позволяет просматривать список активных транзакций и их состояние.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-179">**sys.dm\_tran\_active\_transactions**: Lists currently active transactions and their status.</span></span> <span data-ttu-id="dd7ac-180">Hello UOW (единица работы) столбца можно определить hello другим дочерним транзакции, которые принадлежат toohello же распределенной транзакции.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-180">hello UOW (Unit Of Work) column can identify hello different child transactions that belong toohello same distributed transaction.</span></span> <span data-ttu-id="dd7ac-181">Все транзакции в рамках одной распределенной транзакции выполнения hello hello UOW совпадают.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-181">All transactions within hello same distributed transaction carry hello same UOW value.</span></span> <span data-ttu-id="dd7ac-182">В разделе hello [документации к динамическим административным Представлениям](https://msdn.microsoft.com/library/ms174302.aspx) Дополнительные сведения.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-182">See hello [DMV documentation](https://msdn.microsoft.com/library/ms174302.aspx) for more details.</span></span>
* <span data-ttu-id="dd7ac-183">**sys.DM\_tran\_базы данных\_транзакции**: Дополнительные сведения о транзакции, например размещения hello транзакции в журнале hello.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-183">**sys.dm\_tran\_database\_transactions**: Provides additional information about transactions, such as placement of hello transaction in hello log.</span></span> <span data-ttu-id="dd7ac-184">В разделе hello [документации к динамическим административным Представлениям](https://msdn.microsoft.com/library/ms186957.aspx) Дополнительные сведения.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-184">See hello [DMV documentation](https://msdn.microsoft.com/library/ms186957.aspx) for more details.</span></span>
* <span data-ttu-id="dd7ac-185">**sys.DM\_tran\_блокировки**: содержит сведения о hello блокировки, удерживаемые в настоящее время текущей транзакции.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-185">**sys.dm\_tran\_locks**: Provides information about hello locks that are currently held by ongoing transactions.</span></span> <span data-ttu-id="dd7ac-186">В разделе hello [документации к динамическим административным Представлениям](https://msdn.microsoft.com/library/ms190345.aspx) Дополнительные сведения.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-186">See hello [DMV documentation](https://msdn.microsoft.com/library/ms190345.aspx) for more details.</span></span>

## <a name="limitations"></a><span data-ttu-id="dd7ac-187">Ограничения</span><span class="sxs-lookup"><span data-stu-id="dd7ac-187">Limitations</span></span>
<span data-ttu-id="dd7ac-188">Привет, в настоящее время следующие ограничения применяются tooelastic транзакций базы данных в базу данных SQL.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-188">hello following limitations currently apply tooelastic database transactions in SQL DB:</span></span>

* <span data-ttu-id="dd7ac-189">Поддерживаются только транзакции, выполняемые между базами данных в базе данных SQL.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-189">Only transactions across databases in SQL DB are supported.</span></span> <span data-ttu-id="dd7ac-190">В них не могут участвовать поставщики ресурсов и базы данных [X или Open XA](https://en.wikipedia.org/wiki/X/Open_XA) , которые не принадлежат к базе данных SQL.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-190">Other [X/Open XA](https://en.wikipedia.org/wiki/X/Open_XA) resource providers and databases outside of SQL DB cannot participate in elastic database transactions.</span></span> <span data-ttu-id="dd7ac-191">Это означает, что транзакции эластичной базы данных не распространяются на локальные базы данных SQL Server и SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-191">That means that elastic database transactions cannot stretch across on premises SQL Server and Azure SQL Databases.</span></span> <span data-ttu-id="dd7ac-192">Для распределенных транзакций на локальном компьютере по-прежнему toouse MSDTC.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-192">For distributed transactions on premises, continue toouse MSDTC.</span></span> 
* <span data-ttu-id="dd7ac-193">Поддерживаются только транзакции, которые осуществляются с помощью приложения .NET и которые координирует клиент.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-193">Only client-coordinated transactions from a .NET application are supported.</span></span> <span data-ttu-id="dd7ac-194">Сейчас выполнение запросов T-SQL на серверах (например, BEGIN DISTRIBUTED TRANSACTION) не поддерживается, но в будущем мы планируем добавить эту возможность.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-194">Server-side support for T-SQL such as BEGIN DISTRIBUTED TRANSACTION is planned, but not yet available.</span></span> 
* <span data-ttu-id="dd7ac-195">Транзакции между службами WCF не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="dd7ac-195">Transactions across WCF services are not supported.</span></span> <span data-ttu-id="dd7ac-196">Например, если у вас есть метод службы WCF, выполняющий транзакцию,</span><span class="sxs-lookup"><span data-stu-id="dd7ac-196">For example, you have a WCF service method that executes a transaction.</span></span> <span data-ttu-id="dd7ac-197">Заключения вызова hello в области транзакции не удастся как [System.ServiceModel.ProtocolException](https://msdn.microsoft.com/library/system.servicemodel.protocolexception).</span><span class="sxs-lookup"><span data-stu-id="dd7ac-197">Enclosing hello call within a transaction scope will fail as a [System.ServiceModel.ProtocolException](https://msdn.microsoft.com/library/system.servicemodel.protocolexception).</span></span>

## <a name="next-steps"></a><span data-ttu-id="dd7ac-198">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="dd7ac-198">Next steps</span></span>
<span data-ttu-id="dd7ac-199">Ответить на вопросы, пожалуйста направляться на hello toous [форум базы данных SQL](http://social.msdn.microsoft.com/forums/azure/home?forum=ssdsgetstarted) и для запросов, компонент, добавьте их toohello [форуме обратной связи в базе данных SQL](https://feedback.azure.com/forums/217321-sql-database/).</span><span class="sxs-lookup"><span data-stu-id="dd7ac-199">For questions, please reach out toous on hello [SQL Database forum](http://social.msdn.microsoft.com/forums/azure/home?forum=ssdsgetstarted) and for feature requests, please add them toohello [SQL Database feedback forum](https://feedback.azure.com/forums/217321-sql-database/).</span></span>

<!--Image references-->
[1]: ./media/sql-database-elastic-transactions-overview/distributed-transactions.png



