---
title: "шаблоны aaaDesign приложения SaaS с несколькими клиентами, а база данных SQL Azure | Документы Microsoft"
description: "В этой статье обсуждаются требования hello и Общие шаблоны архитектуры данных приложений базы данных нескольких клиентов, работающих в облачной среде требуется tooconsider и hello различные компромиссы, связанными с этими шаблонами. Здесь также объясняется, как База данных SQL Azure с пулами эластичных БД и инструментами эластичных баз данных позволяет выполнить эти требования без компромиссов."
keywords: 
services: sql-database
documentationcenter: 
author: srinia
manager: jhubbard
editor: 
ms.assetid: 1dd20c6b-ddbb-40ef-ad34-609d398d008a
ms.service: sql-database
ms.custom: scale out apps
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: sqldb-design
ms.date: 02/01/2017
ms.author: srinia
ms.openlocfilehash: a4b58935b08cb78792e65a675d680de708b709fc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="design-patterns-for-multi-tenant-saas-applications-and-azure-sql-database"></a>Шаблоны разработки для мультитенантных приложений SaaS и база данных SQL Azure
В этой статье вы узнаете о hello требования и Общие шаблоны архитектуры данных нескольких клиентов по как услуга (SaaS) приложения базы данных, которые выполняются в облачной среде. Здесь также описываются факторы hello требуется tooconsider и hello компромиссы шаблонов другую структуру. Пулы эластичных БД и инструменты эластичных баз данных в Базе данных SQL Azure помогают обеспечить соответствие конкретным требованиям без ущерба для других целей.

Иногда разработчики делают варианты, которые работают с долгосрочной интересам при разработке модели аренды для hello уровни данных из приложения с несколькими клиентами. Изначально по крайней мере, разработчик может воспринимать удобство разработки и снизить затраты поставщика облачной службы как более важной, чем клиента изоляции или hello масштабируемости приложения. Этот выбор может привести toocustomer удовлетворенность проблемы и дорогостоящей коррекцию курса позже.

Многопользовательское приложение — это приложение, размещенных в облачной среде и предоставляющий hello же набор служб toohundreds или тысяч клиентов, которые не используют и не отображаются данные друг друга. Примером является приложение SaaS, которое обеспечивает tootenants службы в среде, размещаемых в облаке.

## <a name="multi-tenant-applications"></a>Мультитенантные приложения
В мультитенантных приложениях данные и рабочую нагрузку можно легко секционировать. Можно разделить данных и рабочей нагрузки, например, по границам клиента, так как большинство запросов выполняются в ограничивающее hello клиента. Это свойство является присущих hello данных и рабочей нагрузки hello и он предпочитает шаблонов приложения hello, описанных в этой статье.

Разработчики используют этот тип приложения по всему спектру hello облачных приложений, включая:

* Облачных приложений партнеров базы данных, которые перенесен toohello как приложений SaaS
* SaaS приложений для облака hello из hello основание,
* приложения, напрямую предоставляемые потребителям;
* корпоративные приложения для сотрудников.

Приложения SaaS, которые предназначены hello облака, так и с корнями как участника базы данных приложения обычно приложения с несколькими клиентами. Эти приложения SaaS доставлять приложении специализированное программное обеспечение службы tootheir клиентов. Клиентов можно получить доступ к службе приложения hello и связанные данные, хранимые как часть приложения hello полные права. Но tootake преимуществами hello SaaS, клиенты должны отказа от контролировать свои собственные данные. Они доверяют tookeep поставщика службы SaaS hello свои данные, безопасно и изолированы от данных других клиентов. Примерами такого мультитенантного приложения SaaS являются MYOB, SnelStart и Salesforce.com. Каждый из этих приложений могут быть секционированы по границ клиента и поддержки hello приложения шаблонов проектирования, которые мы обсудим в этой статье.

Приложения, которые предоставляют службы напрямую toocustomers или tooemployees в пределах организации (который часто ссылается tooas пользователей, а не клиентов), другой категории на спектра многопользовательского приложения hello. Пользователям подписываться toohello службы и не владеет hello данные, которые поставщик услуг hello собирает и хранит. У поставщиков служб есть менее строгие требования к tookeep изолированными друг от друга за пределами законодательство, касающееся конфиденциальности органами данных заказчиков. Примерами такого мультитенантного приложения для клиентов выступают поставщики мультимедийного содержимого, например Netflix, Spotify и Xbox LIVE. К другим примерам приложений с простым секционированием можно отнести веб-приложения для клиентов или приложения "Интернета вещей", где каждый клиент или каждое устройство может служить в качестве секции. При этом границы секций могут отделять разных пользователей или устройства.

Не все приложения можно легко секционировать по одному свойству, например клиент, потребитель, пользователь или устройство. В сложном приложении планирования ресурсов, например, содержатся продукты, заказы и клиенты. Как правило, у них сложная схема с тысячами тесно взаимосвязанных таблиц.

Стратегия не одну секцию можно применять tooall таблиц и работайте с рабочей нагрузки приложения. В этой статье рассматриваются мультитенантные приложения, данные и рабочие нагрузки которых легко секционировать.

## <a name="multi-tenant-application-design-trade-offs"></a>Компромиссы при разработке мультитенантного приложения
шаблон разработки Hello, разработчик многопользовательского приложения обычно выбирает основан на рассмотрение hello следующие факторы:

* **Изоляция клиентов**. Hello разработчику нужен tooensure, что клиента не содержит данные, клиенты tooother нежелательного доступа. требование изоляции Hello расширяет tooother свойства, такие как обеспечивает защиту от шумный соседей, которой может toorestore данных клиента и реализации настроек конкретного клиента.
* **Стоимость облачных ресурсов**. Стоимость конкурентное toobe необходимых приложению SaaS. Многопользовательского приложения разработчик может выберите toooptimize более низкую стоимость hello при использовании облачных ресурсов, таких как хранилище и вычислительные затраты.
* **Простота разработки и выполнения операций**. Многопользовательского приложения разработчику tooincorporate изоляции защиты, обслуживать и для отслеживания работоспособности hello их приложения и схемы базы данных и устранение неполадок клиента. Сложности в разработке приложений и операции непосредственно преобразует tooincreased затрат и решить проблемы с удовлетворенность клиента.
* **Масштабируемость**. Hello tooincrementally возможность добавить дополнительные клиенты и емкости для клиентов, которым требуется это императивного tooa Успешная операция SaaS.

Каждый из этих факторов имеет tooanother преимущества и недостатки по сравнению. облако наименьшую стоимость Hello предложения не могут предложить hello наиболее удобным процесс разработки. Очень важно для разработчика toomake проинформировать вариантов об этих параметрах и их преимущества и недостатки во время разработки приложения hello.

Шаблон разработки популярных является toopack нескольких клиентов в одну или несколько баз данных. Hello преимущества этого подхода являются более низких затратах, поскольку вы платите за несколько баз данных и hello относительной простоты работы с ограниченным числом баз данных. Но со временем разработчик мультитенантного приложения SaaS увидит, что у этого варианта есть существенные недостатки, касающиеся изоляции и масштабируемости клиентов. Если изоляции клиентов становится важным, дополнительных усилий данные требуется tooprotect клиента в общем хранилище от несанкционированного доступа или шумный соседей. Из-за этих дополнительных усилий процесс разработки может значительно усложниться, а затраты на поддержку изоляции — повыситься. Аналогичным образом Если требуется добавление клиентов, этот шаблон проектирования обычно требует данных клиента tooredistribute опыт на уровне базы данных tooproperly шкалы hello данных приложения.  

Часто изоляции клиентов является главным требованием в мультитенантных приложений SaaS, обслуживающие toobusinesses и организаций. Разработчиков привлекают явные преимущества простоты и стоимости, и они игнорируют изоляцию клиентов и масштабируемость. Этот недостаток может доказать сложный и дорогостоящий процесс при расширении hello службы, требования к изоляции клиента становятся более важные и управляемых на уровне приложения hello. Тем не менее в приложения с несколькими клиентами, предоставляющие toocustomers прямым, обращенные службы, изоляции клиентов может быть более низкий приоритет, чем оптимизация для стоимости ресурсов облака.

## <a name="multi-tenant-data-models"></a>Мультитенантные модели данных
Общие рекомендации по разработке для размещения данных клиента можно представить в виде трех отдельных моделей, показанных на рис. 1.

![модели данных мультитенантного приложения](./media/sql-database-design-patterns-multi-tenancy-saas-applications/sql-database-multi-tenant-data-models.png)

Рис. 1. Общие рекомендации по разработке для моделей данных мультитенантных приложений

* **База данных для каждого клиента**. У каждого клиента есть своя база данных. Все данные конкретного клиента является ограниченной toohello клиента базы данных и изолировать от других клиентов и их данных.
* **Сегментированная общая база данных**. Несколько клиентов совместно используют одну из нескольких баз данных. Набор определенных клиентов назначается tooeach базы данных с помощью стратегии секционирования, таких как хэш, диапазон или список секционирование. Эта стратегия распределения данных часто является ссылка tooas сегментирования.
* **Отдельная общая база данных**. Отдельная большая база данных содержит данные для всех клиентов, которые различаются по столбцу идентификатора клиента.

> [!NOTE]
> Разработчик приложения может выбрать tooplace разных клиентов в различные схемы баз данных, а затем использовать hello схемы имя toodisambiguate hello разных клиентов. Не рекомендуется этот подход, так как он обычно требует использования hello динамического SQL, и не может быть эффективным кэширование планов. В hello оставшейся части этой статьи внимание на hello общий подход таблицы для этой категории многопользовательского приложения.
> 
> 

## <a name="popular-multi-tenant-data-models"></a>Популярные модели данных мультитенантного приложения
Это важные tooevaluate hello различных типов моделей данных нескольких клиентов с точки зрения проектирования приложения hello преимущества и недостатки, которые мы определили уже. Эти факторы позволят характеризующих hello три наиболее распространенные несколькими клиентами моделями описанных ранее и их использование базы данных, как показано на рис. 2.

* **Изоляция**. Hello степень изоляции между клиентами может быть мерой сколько изоляции клиентов, при этом модель данных.
* **Стоимость облачных ресурсов**. Hello объем ресурсов, между клиентами для управления доступом можно оптимизировать стоимости ресурсов облака. Ресурс может определяться как hello вычислений и затраты на хранение.
* **Стоимость разработки и выполнения операций**. Hello простота разработки приложений, развертывание и управляемости снижает общую стоимость операции SaaS.  

На рисунке 2 оси hello Y отображает hello уровень изоляции клиентов. ось Hello X отображает hello уровень общего доступа к ресурсу. серый Hello диагональной стрелки в середине hello указывает направление hello DevOps затрат, контроля над tooincrease или уменьшаются.

![Популярные шаблоны разработки мультитенантного приложения](./media/sql-database-design-patterns-multi-tenancy-saas-applications/sql-database-popular-application-patterns.png)

Рис. 2. Популярные мультитенантные модели данных

Hello правый нижний квадрант, на рисунке 2 показано модели приложения, одна потенциально большого объема, общей базы данных и hello общие таблицы (или отдельный файл схемы) подход. Это хорошо подходит для совместного использования, поскольку все клиенты используют hello же базы данных ресурсов (ЦП, памяти, ввода вывода) в одной базе данных ресурсов. Но изоляция клиентов ограничена. Может потребоваться клиентам tooprotect tootake дополнительные шаги друг от друга на уровне приложения hello. Следующие дополнительные действия может значительно повысить стоимость разработки и управления ими приложения hello DevOps hello. Масштабируемость ограничивается hello масштаб hello оборудования, на котором размещена база данных hello.

Hello левый нижний квадрант на рисунке 2 показано сегментированных нескольких клиентов между несколькими базами данных (как правило, различные аппаратные единицы масштабирования). Каждая база данных содержит подмножество клиентов, помогает решить проблему масштабируемость hello других шаблонов. Если требуется дополнительная емкость для нескольких клиентов, клиенты hello легко можно поместить на выделенный единиц масштабирования оборудования toonew новых баз данных. Тем не менее уменьшается объем hello общий доступ к ресурсам. Только для клиентов обмена hello же единиц масштабирования и общего доступа к ресурсам. Такой подход обеспечивает немного улучшения tootenant изоляции, так как многие клиенты выровнены по-прежнему не выполняется автоматически защищены от других действий. Сложность приложения остается высокой.

левый верхний квадрант Hello на рисунке 2 — третий способ hello. При этом данные каждого клиента помещаются в отдельную базу данных. Для такого подхода характерны высокий уровень изоляции клиентов и ограничение объема общих ресурсов, так как в каждой базе данных есть собственные выделенные ресурсы. Этот подход эффективен при наличии у всех клиентов прогнозируемых рабочих нагрузок. Если рабочие нагрузки клиентов становятся менее предсказуемым, поставщик hello не удается оптимизировать совместное использование ресурсов. А для приложений SaaS характерна непредсказуемость. либо, Hello поставщика необходимо чрезмерно подготовить toomeet требования или ресурсах более низкого. В обоих случаях это приведет к увеличению затрат или неудовлетворенности клиентов. Более высокую степень совместного использования разных клиентах ресурсов становится более экономичное решение hello желательно toomake. Возрастающее число hello баз данных также повышает toodeploy DevOps затрат и обслуживания приложения hello. Несмотря на эти вопросы этот метод обеспечивает hello лучший и самый простой изоляции для клиентов.

Эти факторы влияют также hello шаблон конструирования, который клиент выбирает:

* **Владение данными клиента**. Приложение, в котором клиенты сохраняют владения свои собственные данные, повышает вероятность hello шаблон из одной базы данных каждого клиента.
* **Масштабирование**. Для приложения, предназначенного для множества клиентов, лучше всего применить подход с совместным использованием базы данных, например сегментирование. В этом случае по-прежнему остаются жесткие требования к изоляции.
* **Стоимость и бизнес-модель.** Если доход на клиента приложения мал (менее одного доллара), то требования к изоляции отходят на второй план. В этом случае разумно использовать общую базу данных. Если доход для клиента составляет несколько долларов или более, целесообразно использовать базу данных для каждого клиента. Благодаря этому можно снизить затраты на разработку.

Имея hello разработки компромиссы показано на рисунке 2, идеальная модель нескольких клиентов должен tooincorporate хорошо клиента изоляции свойства оптимальной ресурсов между клиентами. Эта модель помещается на категории hello, описанные в правый верхний квадрант hello рис. 2.

## <a name="multi-tenancy-support-in-azure-sql-database"></a>Поддержка мультитенантности в базе данных SQL Azure
База данных SQL Azure поддерживает все шаблоны мультитенантных приложений, указанных на рис. 2. Эластичные пулы также поддерживает модели приложения, объединяет ценным ресурсом для управления доступом и подход преимущества изоляции hello hello базы данных каждого клиента (см. раздел hello правый верхний квадрант на рис. 3). Эластичной базы данных средства и возможности в базе данных SQL помогают уменьшить стоимость toodevelop hello и работать приложение, которое имеет несколько баз данных (показаны в области hello затененные на рис. 3). Эти средства могут помочь вам построения и управления ими приложения, использующие шаблоны hello нескольких баз данных.

![Шаблоны в Базе данных SQL Azure](./media/sql-database-design-patterns-multi-tenancy-saas-applications/sql-database-patterns-sqldb.png)

Рис. 3. Шаблоны мультитенантного приложения в базе данных SQL Azure

## <a name="database-per-tenant-model-with-elastic-pools-and-tools"></a>Модель, предусматривающая использование одной базы данных для каждого клиента, с пулами и инструментами эластичных БД
Эластичные пулы в базе данных SQL совместить изоляции клиентов с ресурсов между клиента баз данных toobetter hello базы данных каждого клиента подход, основанный. База данных SQL является решением уровня данных для поставщиков SaaS, которые создают мультитенантные приложения. необходимость Hello ресурсов между клиентами переходит hello приложения toohello базы данных службы слоя. Hello сложность управления и запросов в масштабе нескольких базах данных упрощено благодаря эластичной заданий, эластичной запроса, эластичной транзакции и клиентская библиотека hello эластичной базы данных.

| Требования к приложению | Возможности Базы данных SQL |
| --- | --- |
| Изоляция клиентов и совместное использование ресурсов |[Эластичные пулы](sql-database-elastic-pool.md): выделите пул ресурсов баз данных SQL и общий доступ к ресурсам hello в различных базах данных. Кроме того, отдельные базы данных можно нарисовать столько же ресурсов из пула hello как пикового спроса емкости необходимые tooaccommodate из-за toochanges в рабочих нагрузок клиентов. Hello эластичный пул может масштабироваться вверх или вниз при необходимости. Эластичные пулы также предоставляют простота администрирования и мониторинга и устранения неполадок на уровне пула hello. |
| Простота разработки и выполнения операций в базах данных |[Пулы эластичных БД](sql-database-elastic-pool.md) (см. выше). |
| | [Эластичные запросы](sql-database-elastic-query-horizontal-partitioning.md)позволяют выполнять запросы к базам данных для формирования отчетов или выполнения анализа между клиентами. |
| | [Эластичный задания](sql-database-elastic-jobs-overview.md): пакет и надежно развертывать операций обслуживания базы данных или баз данных toomultiple изменения схемы базы данных. |
| | [Эластичный транзакции](sql-database-elastic-transactions-overview.md): процесс изменений tooseveral баз данных в виде атомарной и изолированных приложений. Эластичные транзакции необходимы, если приложение требует абсолютно гарантированного выполнения операций с несколькими базами данных. |
| | [Клиентская библиотека эластичной базы данных](sql-database-elastic-database-client-library.md): управление распределения данных и карты клиентов toodatabases. |

## <a name="shared-models"></a>Общие модели
Как описано выше, для большинства поставщиков SaaS подходы с использованием общей модели могут создавать проблемы с изоляцией клиентов, а также вызывать трудности при разработке и обслуживании приложений. Тем не менее многопользовательских приложений, предоставляющих услуги напрямую клиента tooconsumers, требования к изоляции не может быть как важные как снижают стоимость. Возможно, это может toopack клиентов в один или несколько баз данных с высокой плотности tooreduce затраты. Модели с общими базами данных, в которых используется одна или несколько сегментированных баз данных, повышают эффективность совместного использования ресурсов и уменьшают совокупную стоимость. База данных SQL Azure предоставляет некоторые возможности, которые помогают клиентам построения изоляции для повышения уровня безопасности и управление в масштабе hello уровне данных.

| Требования к приложению | Возможности Базы данных SQL |
| --- | --- |
| Возможности обеспечения защиты путем изоляции |[Безопасность на уровне строк](https://msdn.microsoft.com/library/dn765131.aspx) |
| [Схема базы данных](https://msdn.microsoft.com/library/dd207005.aspx) | |
| Простота разработки и выполнения операций в базах данных |[Запросы к эластичным БД](sql-database-elastic-query-horizontal-partitioning.md) |
| | [Задания обработки эластичных БД](sql-database-elastic-jobs-overview.md) |
| | [Эластичные транзакции](sql-database-elastic-transactions-overview.md) |
| | [Клиентская библиотека эластичной базы данных](sql-database-elastic-database-client-library.md) |
| | [Разделение и объединение эластичной базы данных](sql-database-elastic-scale-overview-split-and-merge.md) |

## <a name="summary"></a>Сводка
Требования к изоляции клиентов важны для большинства мультитенантных приложений SaaS. Привет лучший вариант tooprovide изоляции сильно полагается сторону подход hello базы данных каждого клиента. Hello другие два способа требует вложений в слои сложных приложений, требующих изоляции tooprovide квалифицированный разработки персонала, что значительно увеличивает затраты и риски. Если требования к изоляции не учитываются раннем этапе разработки службы hello, модернизации их может быть еще более дорогостоящие в первых двух моделях hello. Hello главных недостатка, связанные с моделью hello базы данных каждого клиента, связанные tooincreased затраты ресурсов облака из-за tooreduced общего доступа, обслуживание и управление много баз данных. Зачастую разработчикам приложений SaaS очень сложно идти на эти компромиссы.

Несмотря на то, что преимущества и недостатки может быть основных барьер большинство поставщиков облачных услуг базы данных, база данных SQL Azure устраняет барьеры hello эластичного пула и возможности эластичной базы данных. Разработчики SaaS можно объединять hello изоляции характеристики модели базы данных каждого клиента и оптимизировать ресурса общего доступа и hello Улучшена управляемость много баз данных с помощью эластичных пулов и связанные средства.

Для поставщиков мультитенантных приложений, которые не предъявляют требования к изоляции клиентов и могут плотно разместить клиентов в базе данных, могут быть полезны общие модели данных. Они позволят повысить эффективность совместного использования ресурсов и уменьшить общую стоимость. Используя средства эластичных баз данных, библиотеки сегментирования и функции обеспечения безопасности базы данных SQL Azure, поставщики SaaS могут создавать такие приложения и управлять ими.

## <a name="next-steps"></a>Дальнейшие действия
[Начало работы с инструментами эластичной базы данных](sql-database-elastic-scale-get-started.md) с пример приложения, демонстрирующий hello клиентской библиотеки.

Создайте [настраиваемую панель мониторинга пула эластичных БД для SaaS](https://github.com/Microsoft/sql-server-samples/tree/master/samples/manage/azure-sql-db-elastic-pools-custom-dashboard) с помощью примера приложения, использующего пулы эластичных БД для экономичного и масштабируемого решения базы данных.

Используйте инструменты для баз данных SQL Azure hello слишком[миграции существующих баз данных tooscale out](sql-database-elastic-convert-to-use-elastic-tools.md).

эластичный пул с помощью toocreate hello Azure портала, см. в разделе [создать эластичный пул](sql-database-elastic-pool-manage-portal.md).  

Узнайте, каким образом слишком[мониторинг и управление ими в пуле эластичных](sql-database-elastic-pool-manage-portal.md).

## <a name="additional-resources"></a>Дополнительные ресурсы

* [Развертывание и изучение мультитенантного приложения SaaS, использующего базу данных SQL Azure](sql-database-saas-tutorial.md)
* [Что такое пул эластичных БД Azure?](sql-database-elastic-pool.md)
* [Общие сведения о возможностях эластичных баз данных](sql-database-elastic-scale-introduction.md)
* [Мультитенантные приложения со средствами эластичных баз данных и безопасностью на уровне строк](sql-database-elastic-tools-multi-tenant-row-level-security.md)
* [Authenticate using Azure AD and OpenID Connect](../guidance/guidance-multitenant-identity-authenticate.md) (Проверка подлинности с помощью Azure AD и OpenID Connect)
* [Сведения о приложении Tailspin Surveys](../guidance/guidance-multitenant-identity-tailspin.md)


## <a name="questions-and-feature-requests"></a>Вопросы и запросы на функции

По вопросам, поиск нас в hello [форум базы данных SQL](http://social.msdn.microsoft.com/forums/azure/home?forum=ssdsgetstarted). Добавить запрос функции в hello [форуме обратной связи в базе данных SQL](https://feedback.azure.com/forums/217321-sql-database/).

