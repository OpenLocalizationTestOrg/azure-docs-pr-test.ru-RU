---
title: "Хранение резервных копий базы данных SQL Azure до 10 лет | Документы Майкрософт"
description: "Узнайте, как база данных SQL Azure поддерживает хранение резервных копий в течение 10 лет."
keywords: 
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: 
ms.assetid: 66fdb8b8-5903-4d3a-802e-af08d204566e
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: On Demand
ms.date: 12/22/2016
ms.author: sashan
ms.openlocfilehash: e44c92c3f37b3f1e3397d1c8cdb8c8f6d0f9942e
ms.sourcegitcommit: e5355615d11d69fc8d3101ca97067b3ebb3a45ef
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/31/2017
---
# <a name="store-azure-sql-database-backups-for-up-to-10-years"></a>Хранение резервных копий базы данных SQL Azure до 10 лет
В соответствии с нормативными требованиями, стандартами соответствия или бизнес-задачами многие приложения должны хранить резервные копии баз данных более 7–35 дней, то есть дольше, чем при [автоматическом резервном копировании](sql-database-automated-backups.md) базы данных SQL Azure. Функция долгосрочного хранения резервных копий позволяет хранить резервные копии базы данных SQL Azure в хранилище служб восстановления Azure до 10 лет. В каждом хранилище можно разместить до 1000 баз данных. Вы можете выбрать любую резервную копию из хранилища и восстановить ее как новую базу данных.

> [!IMPORTANT]
> Долгосрочное хранение резервных копий в настоящее время находится на этапе предварительной версии и доступно в следующих регионах: восточная Австралия, юго-восточная Австралия, южная Бразилия, центральная часть США, Восточная Азия, восточная часть США, восточная часть США 2, центральная Индия, южная Индия, восточная Япония, западная Япония, северо-центральный регион США, Северная Европа, юго-центральный регион США, Юго-Восточная Азия, Западная Европа и западная часть США.
>

> [!NOTE]
> В каждом хранилище в течение 24 часов можно включить до 200 баз данных. Мы рекомендуем использовать отдельное хранилище для каждого сервера, чтобы эти ограничения вам не мешали. 
> 

## <a name="how-sql-database-long-term-backup-retention-works"></a>Принципы работы долгосрочного хранения резервных копий базы данных SQL

Благодаря долгосрочному хранению резервных копий можно привязать сервер базы данных SQL Azure к хранилищу служб восстановления Azure. 

* Это хранилище должно быть создано в той же подписке Azure, что и сервер для базы данных SQL, в том же географическом регионе и в той же группе ресурсов. 
* Затем вы сможете настроить политику хранения для любой базы данных. Если эта политика настроена, полная резервная копия базы данных еженедельно копируется в хранилище служб восстановления и хранится там в течение указанного срока (до 10 лет). 
* Вы сможете восстановить любую из этих резервных копий базы данных, развернув ее в новую базу данных на любом сервере в вашей подписке. Служба хранилища Azure копирует для этой цели существующую резервную копию, и этот процесс никак не влияет на производительность существующей базы данных.

> [!TIP]
> Практическое руководство см. в статье [Настройка долгосрочного хранения резервных копий для базы данных SQL Azure и восстановление из резервной копии](sql-database-long-term-backup-retention-configure.md).

## <a name="enable-long-term-backup-retention"></a>Включение долгосрочного хранения резервных копий

Чтобы настроить долгосрочное хранение резервной копии для базы данных, выполните следующие действия.

1. Создайте хранилище служб восстановления Azure в том же регионе, той же подписке и той же группе ресурсов, где был создан сервер базы данных SQL. 
2. Зарегистрируйте сервер в хранилище.
3. Создайте политику защиты служб восстановления Azure.
4. Примените политику защиты к базе данных, для которой вам требуется долгосрочное хранение резервных копий.

Для настройки, управления и восстановления базы данных с помощью долгосрочного хранения создаваемых автоматически резервных копий в хранилище служб восстановления Azure можно использовать один из вариантов.

* С помощью портала Azure: выберите **Долгосрочное хранение резервных копий**, выберите базу данных и нажмите кнопку **Настроить**. 

   ![Выбор базы данных для настройки долгосрочного хранения резервных копий](./media/sql-database-get-started-backup-recovery/select-database-for-long-term-backup-retention.png)

* С помощью PowerShell: см. статью [Настройка долгосрочного хранения резервных копий для базы данных SQL Azure и восстановление из резервной копии](sql-database-long-term-backup-retention-configure.md).

## <a name="restore-a-database-thats-stored-with-the-long-term-backup-retention-feature"></a>Восстановление базы данных, сохраненной с помощью функции долгосрочного хранения резервных копий

Для восстановления из резервной копии долгосрочного хранения сделайте следующее.

1. Получите список содержимого хранилища, в котором хранится резервная копия.
2. Получите список содержимого контейнера, который сопоставлен с нужным логическим сервером.
3. Получите список содержимого источника данных в хранилище, которое сопоставлено с нужной базой данных.
4. Получите список точек восстановления, доступных для восстановления.
5. Выполните восстановление базы данных из подходящей точки восстановления на целевой сервер в вашей подписке.

Для настройки, управления и восстановления базы данных с помощью долгосрочного хранения создаваемых автоматически резервных копий в хранилище служб восстановления Azure можно использовать один из вариантов.

* С помощью портала Azure: см. статью [Управление долгосрочным хранением резервных копий с помощью портала Azure](sql-database-long-term-backup-retention-configure.md). 

* С помощью PowerShell: см. статью [Управление долгосрочным хранением резервных копий с помощью PowerShell](sql-database-long-term-backup-retention-configure.md).

## <a name="get-pricing-for-long-term-backup-retention"></a>Получение расценок для настройки долгосрочного хранения резервных копий

Плата за долгосрочное хранение резервных копий базы данных SQL взимается в соответствии с [ценами на службу архивации Azure](https://azure.microsoft.com/pricing/details/backup/).

С момента регистрации сервера базы данных SQL в хранилище с вас будет взиматься плата за общий объем хранилища, используемый для хранения еженедельных резервных копий.

## <a name="view-available-backups-that-are-stored-in-long-term-backup-retention"></a>Просмотр доступных резервных копий, хранимых в службе долгосрочного хранения

Для настройки, управления и восстановления базы данных с помощью долгосрочного хранения создаваемых автоматически резервных копий в хранилище служб восстановления можно использовать один из вариантов.

* С помощью портала Azure: см. статью [Управление долгосрочным хранением резервных копий с помощью портала Azure](sql-database-long-term-backup-retention-configure.md). 

* С помощью PowerShell: см. статью [Управление долгосрочным хранением резервных копий с помощью PowerShell](sql-database-long-term-backup-retention-configure.md).

## <a name="disable-long-term-retention"></a>Отключение долгосрочного хранения

Служба восстановления автоматически очищает резервные копии в соответствии с настроенной политикой хранения. 

Чтобы резервные копии определенной базы данных больше не отправлялись в хранилище, удалите политику хранения для этой базы данных.
  
```
Set-AzureRmSqlDatabaseBackupLongTermRetentionPolicy -ResourceGroupName 'RG1' -ServerName 'Server1' -DatabaseName 'DB1' -State 'Disabled' -ResourceId $policy.Id
```

> [!NOTE]
> Резервные копии, которые уже находятся в хранилище, не затрагиваются. Они будут автоматически удалены службой восстановления по истечении указанного срока хранения.

## <a name="long-term-backup-retention-faq"></a>Часто задаваемые вопросы о долгосрочном хранении резервных копий

**Можно ли вручную удалить из хранилища определенные резервные копии?**

В настоящее время нет. Хранилище автоматически удаляет резервные копии по истечении периода хранения.

**Можно ли зарегистрировать сервер в нескольких хранилищах для хранения резервных копий?**

Пока нет. Сейчас можно сохранять резервные копии только в одном хранилище.

**Можно ли использовать хранилище и сервер из разных подписок?**

Нет. Сейчас хранилище и сервер должны находиться в одной подписке и в одной группе ресурсов.

**Можно ли использовать хранилище, созданное не в том регионе, где расположен мой сервер?**

Нет, хранилище и сервер должны находиться в одном регионе, чтобы сократить время копирования и избежать расходов на трафик.

**Сколько баз данных можно хранить в одном хранилище?**

Сейчас поддерживается не более 1000 баз данных на одно хранилище. 

**Сколько хранилищ можно создать в одной подписке?**

В одной подписке можно создать до 25 хранилищ.

**Сколько баз данных можно настроить для одного хранилища в день?**

Для одного хранилища можно настроить не более 200 баз данных в день.

**Работает ли долгосрочное хранение резервных копий с эластичными пулами?**

Да. Политику хранения можно настроить для любой базы данных в пуле.

**Можно ли выбрать время создания резервной копии?**

Нет, расписанием архивации управляет база данных SQL. Это нужно для того, чтобы минимизировать влияние на производительность баз данных.

**Для нашей базы данных включено прозрачное шифрование данных. Можно ли использовать для нее хранилище?** 

Да, прозрачное шифрование данных поддерживается. Вы сможете восстановить базу данных из хранилища, даже если исходной базы данных уже не существует.

**Что произойдет с резервными копиями в хранилище, если моя подписка будет приостановлена?** 

Если подписка приостановлена, мы храним все имеющиеся базы данных и резервные копии. Однако новые резервные копии не сохраняются в хранилище. Когда вы повторно активируете подписку, служба возобновит сохранение резервных копий в хранилище. Хранилище станет доступным для операций восстановления с использованием тех резервных копий, которые были созданы до приостановки подписки. 

**Можно ли получить доступ к файлам резервных копий базы данных SQL, чтобы скачать или восстановить их в экземпляр SQL Server?**

В настоящее время это невозможно.

**Можно ли создать несколько расписаний (ежедневно, еженедельно, ежемесячно, ежегодно) в рамках политики хранения SQL?**

Нет, несколько расписаний пока доступны только для резервных копий виртуальных машин.

**Мы настроили долгосрочное хранение резервных копий для базы данных, которая является базой данных-получателем с активной георепликацией. Поддерживается ли такая конфигурация?**

Поскольку резервное копирование на репликах не выполняется, долгосрочное хранение резервных копий в базах данных-получателях пока не поддерживается. Тем не менее пользователям важно настроить долгосрочное хранение резервных копий в базе данных-получателе с активной георепликацией по следующим причинам:
* Если при отработке отказа база данных становится базой данных-источником, создается полная резервная копия, которая будет отправлена в хранилище.
* Настройка долгосрочного хранения резервных копий в базе данных-получателе не требует дополнительной оплаты.

## <a name="next-steps"></a>Дальнейшие действия
Поскольку резервные копии базы данных защищают данные от случайного повреждения или удаления, они являются важной частью любой стратегии непрерывности бизнес-процессов и аварийного восстановления. Дополнительные сведения о других решениях для базы данных SQL, обеспечивающих непрерывность бизнес-процессов, см. в статье [Обзор обеспечения непрерывности бизнес-процессов с помощью базы данных SQL Azure](sql-database-business-continuity.md).
