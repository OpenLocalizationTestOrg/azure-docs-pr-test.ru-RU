---
title: "База данных SQL Azure с помощью службы высокой доступности aaaDesign | Документы Microsoft"
description: "Сведения о разработке приложений для высокодоступных служб с помощью базы данных SQL Azure."
keywords: "аварийное восстановление облака, решения для аварийного восстановления, резервное копирование данных приложения, георепликация, планирование непрерывности бизнес-процессов"
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: e8a346ac-dd08-41e7-9685-46cebca04582
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 04/21/2017
ms.author: sashan
ms.openlocfilehash: 815f754ba7014cd8a1108a2d84c2a8f71d7030a5
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="designing-highly-available-services-using-azure-sql-database"></a>Разработка службы высокой доступности с помощью базы данных SQL Azure

При построении и развертывании высокой доступности службы в базе данных SQL Azure, используйте [перехода на другой ресурс группы и активной георепликации](sql-database-geo-replication-overview.md) tooprovide устойчивости tooregional сбоев и простоев катастрофический и включить быстрое восстановление toohello баз данных-получателей. В этой статье основное внимание уделяется распространенных шаблонов приложения и рассматриваются преимущества hello и преимущества и недостатки каждого варианта, в зависимости от требований к развертыванию приложения hello, hello соглашения об уровне обслуживания в качестве цели, задержка трафика и затраты. Сведения об использовании активной георепликации с пулами эластичных баз данных см. в статье [Стратегии аварийного восстановления для приложений с использованием пула эластичных баз данных SQL](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).

## <a name="design-pattern-1-active-passive-deployment-for-cloud-disaster-recovery-with-a-co-located-database"></a>Модель разработки 1: активное — пассивное развертывание для аварийного восстановления облака с совмещенной базой данных
Этот вариант лучше всего подходит для приложений с hello следующие характеристики:

* Активный экземпляр находится в одном регионе Azure.
* Надежный зависимость от toodata доступа чтения и записи (RW)
* Межрегиональные подключение между веб-приложение hello и hello базы данных является недопустимым из-за toolatency и трафик стоимость    

В этом случае топологии развертывания приложения hello оптимизирован для обработки региональной аварии, при всех компонентов приложения затронуто toofailover как единое целое. Обеспечить географическую избыточность логику приложения hello и hello базы данных, реплицированных tooanother области, но не используются для рабочей нагрузки приложения hello в нормальных условиях hello. приложение Hello в дополнительный регион hello должно быть настроенный toouse SQL соединения строки toohello базы данных-получателя. Диспетчер трафика настроить toouse [метода маршрутизации отработки отказа](../traffic-manager/traffic-manager-configure-failover-routing-method.md).  

> [!NOTE]
> [Диспетчер трафика Azure](../traffic-manager/traffic-manager-overview.md) используется в этой статье только для иллюстрации. Можно использовать любое решение балансировки нагрузки, поддерживающее метод маршрутизации с отработкой отказа.    
>

Здравствуй, следующая схема показывает этой конфигурации до сбоя.

![Настройка георепликации базы данных SQL Аварийное восстановление облака.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-1.png)

После сбоя в основном регионе hello hello служба базы данных SQL обнаруживает базы данных-источника, hello недоступен и запустит отработки отказа toohello базы данных-получателя на основе параметров hello hello политики автоматического перехода на другой ресурс. В зависимости от ОБСЛУЖИВАНИЯ приложений можно tooconfigure период между hello обнаружение сбоя hello и отработки отказа hello сам. Настройка периода отсрочки снижает риск hello случаях toohello потери данных разрушительного сбоя hello и доступности в регионе hello не может быть быстро восстановлена. Если конечная точка hello перехода на другой ресурс инициируется диспетчера трафика hello перед hello перехода на другой ресурс группы триггеры hello отработки отказа базы данных hello, веб-приложение hello не базы данных может tooreconnect toohello. приложение Hello tooreconnect попытка завершается успешно, сразу после завершения отработки отказа базы данных hello. 

> [!NOTE]
> tooachieve полностью координация отработки отказа приложения hello и hello баз данных, следует разработать собственный метод мониторинга и вручную произвести отработку отказа конечных точек приложения hello web и hello баз данных.
>

После завершения отработки отказа hello приложения hello конечных точек и hello базы данных, приложение hello снова начнет обработку запросов пользователей hello в регионе hello B и останется совмещена с hello базы данных, поскольку база данных-источник hello теперь находится в область б. Этот сценарий поясняет следующая схема hello. На всех схемах сплошными линиями показаны активные подключения, пунктирными — приостановленные подключения, а знаки "стоп" означают триггеры действий.

![Георепликации: База данных toosecondary переход на другой ресурс. Резервное копирование данных приложения.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-2.png)

В случае сбоя в дополнительном регионе hello hello связь репликации между основным hello и hello баз данных-получателей приостановлена, но hello перехода на другой ресурс не выполняется, так как база данных-источник hello не влияет на. доступность приложения Hello не изменяется таким образом, но приложение hello работает без поддержки и таким образом рискует занести в случае обе области ошибкой в течение промежутка времени.

> [!NOTE]
> Для аварийного восстановления рекомендуется hello конфигурации с областями tootwo ограниченный развертывания приложения. Это, поскольку большинство из hello географических регионов Azure имеют только две области. Эта конфигурация не позволяет защитить ваши приложения от одновременного разрушительного сбоя в обоих регионах.  В маловероятной ситуации такого сбоя можно восстановить базы данных в третьем регионе с помощью [операции геовосстановления](sql-database-disaster-recovery.md#recover-using-geo-restore).
>

После сбоя hello, уменьшается, база данных-получатель hello автоматически повторно синхронизируется с первичной hello. Во время синхронизации производительность hello основной удалось так в зависимости от hello объем данных, которые должны синхронизировать toobe немного. Hello следующая диаграмма иллюстрирует сбоя в дополнительном регионе hello.

![Синхронизация базы данных-получателя с базой данных-источником. Аварийное восстановление облака.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-3.png)

ключ Hello **преимущества** этого шаблона разработки являются:

* Hello одного веб-приложения — tooboth развернутой области без какой-либо настройки региона и отработка отказа toohello tooreact дополнительная логика. 
* Переход на другой ресурс, как веб-приложения hello не влияет на производительность приложения Hello и hello базы данных всегда находятся в одном месте.

основной Hello **компромисс** —, избыточных приложение hello экземпляра в дополнительный регион hello используется только для аварийного восстановления.

## <a name="design-pattern-2-active-active-deployment-for-application-load-balancing"></a>Модель разработки 2: активное — активное развертывание для балансировки нагрузки приложения
Данный вариант восстановления после сбоев облачных наилучшим образом подходит для приложений с hello следующие характеристики:

* Высокая доля базы данных считывает toowrites
* Для конечного пользователя hello более важным, чем задержка записи hello задержки чтения с базы данных 
* Логика только для чтения может быть отделена от логики чтения и записи с помощью другой строки подключения.
* Только для чтения логика зависит от данных, полностью синхронизируются с последними обновлениями hello  

Если приложения обладают следующими характеристиками, балансировку нагрузки подключений hello конечных пользователей на нескольких экземпляров приложения в разных регионах может существенно повысить эффективность работы конечных пользователей hello. Двух областей hello должен быть установлен как hello пары аварийного восстановления и отработки отказа группой hello должно включать hello баз данных в этих областях. tooimplement балансировки нагрузки каждой области должны иметь активный экземпляр приложения hello с hello чтения и записи (RW) логику подключен toohello чтения и записи прослушивателя конечной точкой hello перехода на другой ресурс группы. Он будет гарантирует, что что hello отработка отказа будет автоматически инициироваться Если база данных-источник hello подвержено влиянию сбоя. Hello только для чтения логику (только для чтения) в веб-приложение hello следует подключаться напрямую toohello базы данных в этом регионе. Диспетчер трафика следует настроить toouse [производительности маршрутизации](../traffic-manager/traffic-manager-configure-performance-routing-method.md) с [мониторинг конечной точки](../traffic-manager/traffic-manager-monitoring.md) включена для каждого экземпляра приложения.

Как и в модели 1, следует рассмотреть возможность развертывания схожего приложения мониторинга. Но в отличие от шаблона #1 мониторинг приложения hello не будет отвечать за запуск отработки отказа hello конечной точке.

> [!NOTE]
> Хотя этот шаблон использует несколько баз данных-получателей, дополнительным в регион B hello будет использоваться для отработки отказа и должно быть частью группы отказоустойчивого hello.
>

Диспетчер трафика должны быть настроены для производительности маршрутизации toodirect hello пользователя подключений toohello приложения экземпляра ближайший toohello географического расположения пользователя. Привет, следующая схема иллюстрирует этой конфигурации до сбоя.

![Без простоя: приложение маршрутизации toonearest производительности. Георепликация](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-1.png)

При обнаружении сбоя базы данных в области hello A hello отработки отказа группой будет автоматически инициировать отработку отказа hello базы данных-источника в toohello региона A получателей в регионе б. Он также автоматически обновит hello чтения и записи прослушиватель конечной точки tooregion B, соединений чтения и записи в веб-приложение hello не повлияет. Диспетчер трафика Hello исключит автономного hello конечной точке из таблицы маршрутизации hello, но будут маршрутизации hello конечным пользователем трафика toohello оставшиеся online экземпляры. Hello строки подключения SQL только для чтения не повлияет на так, как они всегда точки базы данных toohello hello одного региона. 

Привет, следующая схема иллюстрирует hello новую конфигурацию после отработки отказа hello.

![Настройка после отработки отказа. Аварийное восстановление облака.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-2.png)

В случае сбоя в одной из областей получателей hello диспетчера трафика hello автоматически удалит автономного hello конечной точки в этом регионе из таблицы маршрутизации hello. Hello репликации канала toohello базы данных-получателя в этом регионе будут приостановлены. Так, как остальные регионы hello получить дополнительный пользовательский трафик в этом сценарии, производительность приложения hello будут затронуты при сбое hello. После сбоя hello, уменьшается, hello базы данных-получателя в области, затронутые hello немедленно синхронизируется с первичной hello. Во время hello производительность синхронизации основной hello удалось так в зависимости от hello объем данных, которые должны синхронизировать toobe немного. Привет, следующая схема иллюстрирует сбоя в регионе б.

![Сбой в дополнительном регионе. Аварийное восстановление облака: георепликация](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-3.png)

ключ Hello **преимущества** этой конструкции шаблон является Масштабирование рабочей нагрузки приложения hello через несколько баз данных-получателей tooachieve hello оптимальной для конечных пользователей производительности. Hello **компромиссы** этого параметра являются:

* Соединений чтения и записи между экземплярами приложений hello и базы данных имеют различные затрат и задержек
* Влияет на производительность приложения во время сбоя hello

> [!NOTE]
> Аналогичный подход можно использовать toooffload специализированные рабочих нагрузок, например для создания отчетов, заданий, средства бизнес-аналитики или резервные копии. Как правило, эти потребляют значительные ресурсы базы данных таким образом, рекомендуется, следует назначить один из hello баз данных-получателей для них с производительности hello toohello уровня соответствия предполагаемой рабочей нагрузки.
>

## <a name="design-pattern-3-active-passive-deployment-for-data-preservation"></a>Модель разработки 3: активное — пассивное развертывание для сохранения данных
Этот вариант лучше всего подходит для приложений с hello следующие характеристики:

* Любая потеря данных представляет собой большой риск для бизнеса. Hello отработки отказа базы данных может использоваться только в крайнем случае разрушительного сбоя hello.
* приложение Hello поддерживает только для чтения и чтения и записи операций и может работать в режиме «только для чтения» в течение заданного времени.

В этом шаблоне приложения hello переключает режим только для tooread запуск происходят ошибки времени ожидания соединения для чтения записи hello. Hello веб-приложения является tooboth развернутой области с конечной точкой соединения toohello прослушивателя чтения и записи и конечная точка прослушивателя только для чтения toohello другое подключение. Hello диспетчера трафика следует настроить toouse [перехода на другой ресурс маршрутизации](../traffic-manager/traffic-manager-configure-failover-routing-method.md) с [мониторинг конечной точки](../traffic-manager/traffic-manager-monitoring.md) включена для конечной точки приложения hello в каждом регионе.

Привет, следующая схема иллюстрирует этой конфигурации до сбоя.

![Активное — пассивное развертывание перед отработкой отказа. Аварийное восстановление облака.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-1.png)

Когда hello диспетчера трафика обнаруживает tooregion сбой подключения к A, происходит автоматическое переключение пользовательский экземпляр приложения toohello трафика в регионе б. С этим шаблоном необходимо установить hello льготный период с потерей tooa достаточно большое значение данных, например 24 часа. Гарантирует, что потери данных является избежать дублирования устраняется hello простоя в течение этого времени. При активации hello веб-приложения в регионе hello B hello операций чтения и записи будет начинаться сбоем. На этом этапе необходимо отключить toohello режиме только для чтения. В этот режим hello запросы будут автоматически перенаправленное toohello баз данных-получателей. В случае, когда hello hello Разрушительный сбой отключения не следует устранить в течение льготного периода hello и отработки отказа группой hello запускается hello перехода на другой ресурс. После этого hello скоро станет доступен прослушивателя чтения и записи и hello вызовов tooit прекращают произошел сбой. Это продемонстрировано hello следующие схемы.

![Сбой: приложение в режиме только для чтения. Аварийное восстановление облака.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-2.png)

При hello сбоя в основном регионе hello, уменьшается в течение льготного периода hello, диспетчер трафика определяет hello восстановления подключения в основном регионе hello и переключается пользовательский экземпляр приложения задней toohello трафика в регионе, а. Этот экземпляр приложения возобновляет работу и будет работать в режиме чтения и записи, с помощью базы данных-источника hello в региона A.

В случае сбоя в регионе hello B hello диспетчера трафика обнаруживает сбой hello из конечной точки приложения hello в регион B и tooregion hello прослушивателя только для чтения для перехода на другой ресурс группы hello коммутаторы A. Отключение не влияет на взаимодействие с пользователем hello, но во время сбоя hello будет предоставляться hello базы данных-источника. Это продемонстрировано hello следующие схемы.

![Сбой: база данных-получатель Аварийное восстановление облака.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-3.png)

После сбоя hello, уменьшается, hello баз данных-получателей немедленно синхронизируется с первичной hello и hello прослушивателя только для чтения коммутируемых задней toohello базы данных-получателя в регионе б. Во время синхронизации производительность hello основной удалось так в зависимости от hello объем данных, которые должны синхронизировать toobe немного.

Эта модель разработки имеет несколько **преимуществ**:

* Она позволяет избежать потери данных во время hello временные сбои.
* Время простоя зависит от только как быстро диспетчера трафика обнаруживает сбой подключения к hello, который можно настроить.

Hello **компромисс** является:

* Приложение должно иметь toooperate доступ в режиме только для чтения.

> [!NOTE]
> В случае сбоя постоянные службы, в области hello вручную активируйте отработки отказа базы данных и принять hello потери данных. Hello приложения будут работать в дополнительный регион hello с базой данных toohello доступ для чтения и записи.
>

## <a name="business-continuity-planning-choose-an-application-design-for-cloud-disaster-recovery"></a>Планирование непрерывности бизнеса-процессов: выбор проекта приложения для аварийного восстановления облака
Стратегия аварийного восстановления определенного облака можно объединить или расширить эти шаблоны проектирования toobest hello соответствует требованиям приложения.  Как упоминалось ранее, Выбор стратегии hello основан на hello соглашения об уровне ОБСЛУЖИВАНИЯ требуется toooffer tooyour клиентов и hello топологии развертывания приложения. toohelp принимать решения о, hello в следующей таблице сравниваются варианты hello с учетом hello точки данных потери или восстановления точка (RPO) и предполагаемое время восстановления (ERT).

| Модель | RPO | ERT |
|:--- |:--- |:--- |
| Активное — пассивное развертывание для аварийного восстановления с доступом к совмещенной базе данных |Доступ для чтения и записи < 5 секунд |Время обнаружения сбоя и срок жизни DNS |
| Активное — активное развертывание для балансировки нагрузки приложения |Доступ для чтения и записи < 5 секунд |Время обнаружения сбоя и срок жизни DNS |
| Активное — пассивное развертывание для сохранения данных |Доступ только для чтения < 5 с | Доступ только для чтения = 0 |
||Доступ только для чтения = 0 | Доступ только для чтения = время обнаружения сбоя + льготный период с потерей данных |
|||

## <a name="next-steps"></a>Дальнейшие действия
* toolearn о резервных копиях автоматических базы данных SQL Azure, в разделе [базы данных SQL автоматическое резервное копирование](sql-database-automated-backups.md)
* Сведения об обеспечении непрерывности бизнес-процессов и возможные сценарии описаны в [обзоре непрерывности бизнес-процессов](sql-database-business-continuity.md)
* toolearn об использовании автоматического создания резервных копий для восстановления, в разделе [восстановление базы данных из резервных копий, инициируемых службой hello](sql-database-recovery-using-backups.md)
* toolearn о быстрее параметры восстановления, в разделе [активной георепликации](sql-database-geo-replication-overview.md)  
* в разделе toolearn об использовании автоматического резервного копирования для архивации, [копирование базы данных](sql-database-copy.md)
* Сведения об использовании активной георепликации с пулами эластичных баз данных см. в статье [Стратегии аварийного восстановления для приложений с использованием пула эластичных баз данных SQL](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).
