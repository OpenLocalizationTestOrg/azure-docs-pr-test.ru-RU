---
title: "База данных SQL Azure с помощью службы высокой доступности aaaDesign | Документы Microsoft"
description: "Сведения о разработке приложений для высокодоступных служб с помощью базы данных SQL Azure."
keywords: "аварийное восстановление облака, решения для аварийного восстановления, резервное копирование данных приложения, георепликация, планирование непрерывности бизнес-процессов"
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: e8a346ac-dd08-41e7-9685-46cebca04582
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 04/21/2017
ms.author: sashan
ms.openlocfilehash: 815f754ba7014cd8a1108a2d84c2a8f71d7030a5
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="designing-highly-available-services-using-azure-sql-database"></a><span data-ttu-id="7faa3-104">Разработка службы высокой доступности с помощью базы данных SQL Azure</span><span class="sxs-lookup"><span data-stu-id="7faa3-104">Designing highly available services using Azure SQL Database</span></span>

<span data-ttu-id="7faa3-105">При построении и развертывании высокой доступности службы в базе данных SQL Azure, используйте [перехода на другой ресурс группы и активной георепликации](sql-database-geo-replication-overview.md) tooprovide устойчивости tooregional сбоев и простоев катастрофический и включить быстрое восстановление toohello баз данных-получателей.</span><span class="sxs-lookup"><span data-stu-id="7faa3-105">When building and deploying highly available services on Azure SQL Database, you use [failover groups and active geo-replication](sql-database-geo-replication-overview.md) tooprovide resilience tooregional failures and catastrophic outages and enable fast recovery toohello secondary databases.</span></span> <span data-ttu-id="7faa3-106">В этой статье основное внимание уделяется распространенных шаблонов приложения и рассматриваются преимущества hello и преимущества и недостатки каждого варианта, в зависимости от требований к развертыванию приложения hello, hello соглашения об уровне обслуживания в качестве цели, задержка трафика и затраты.</span><span class="sxs-lookup"><span data-stu-id="7faa3-106">This article focuses on common application patterns and discusses hello benefits and trade-offs of each option depending on hello application deployment requirements, hello service level agreement you are targeting, traffic latency, and costs.</span></span> <span data-ttu-id="7faa3-107">Сведения об использовании активной георепликации с пулами эластичных баз данных см. в статье [Стратегии аварийного восстановления для приложений с использованием пула эластичных баз данных SQL](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="7faa3-107">For information about active geo-replication with Elastic Pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>

## <a name="design-pattern-1-active-passive-deployment-for-cloud-disaster-recovery-with-a-co-located-database"></a><span data-ttu-id="7faa3-108">Модель разработки 1: активное — пассивное развертывание для аварийного восстановления облака с совмещенной базой данных</span><span class="sxs-lookup"><span data-stu-id="7faa3-108">Design pattern 1: Active-passive deployment for cloud disaster recovery with a co-located database</span></span>
<span data-ttu-id="7faa3-109">Этот вариант лучше всего подходит для приложений с hello следующие характеристики:</span><span class="sxs-lookup"><span data-stu-id="7faa3-109">This option is best suited for applications with hello following characteristics:</span></span>

* <span data-ttu-id="7faa3-110">Активный экземпляр находится в одном регионе Azure.</span><span class="sxs-lookup"><span data-stu-id="7faa3-110">Active instance in a single Azure region</span></span>
* <span data-ttu-id="7faa3-111">Надежный зависимость от toodata доступа чтения и записи (RW)</span><span class="sxs-lookup"><span data-stu-id="7faa3-111">Strong dependency on read-write (RW) access toodata</span></span>
* <span data-ttu-id="7faa3-112">Межрегиональные подключение между веб-приложение hello и hello базы данных является недопустимым из-за toolatency и трафик стоимость</span><span class="sxs-lookup"><span data-stu-id="7faa3-112">Cross-region connectivity between hello web application and hello database is not acceptable due toolatency and traffic cost</span></span>    

<span data-ttu-id="7faa3-113">В этом случае топологии развертывания приложения hello оптимизирован для обработки региональной аварии, при всех компонентов приложения затронуто toofailover как единое целое.</span><span class="sxs-lookup"><span data-stu-id="7faa3-113">In this case, hello application deployment topology is optimized for handling regional disasters when all application components are impacted and need toofailover as a unit.</span></span> <span data-ttu-id="7faa3-114">Обеспечить географическую избыточность логику приложения hello и hello базы данных, реплицированных tooanother области, но не используются для рабочей нагрузки приложения hello в нормальных условиях hello.</span><span class="sxs-lookup"><span data-stu-id="7faa3-114">For geographic redundancy, hello application logic and hello database are replicated tooanother region but they are not used for hello application workload under hello normal conditions.</span></span> <span data-ttu-id="7faa3-115">приложение Hello в дополнительный регион hello должно быть настроенный toouse SQL соединения строки toohello базы данных-получателя.</span><span class="sxs-lookup"><span data-stu-id="7faa3-115">hello application in hello secondary region should be configured toouse a SQL connection string toohello secondary database.</span></span> <span data-ttu-id="7faa3-116">Диспетчер трафика настроить toouse [метода маршрутизации отработки отказа](../traffic-manager/traffic-manager-configure-failover-routing-method.md).</span><span class="sxs-lookup"><span data-stu-id="7faa3-116">Traffic manager is set up toouse [failover routing method](../traffic-manager/traffic-manager-configure-failover-routing-method.md).</span></span>  

> [!NOTE]
> <span data-ttu-id="7faa3-117">[Диспетчер трафика Azure](../traffic-manager/traffic-manager-overview.md) используется в этой статье только для иллюстрации.</span><span class="sxs-lookup"><span data-stu-id="7faa3-117">[Azure traffic manager](../traffic-manager/traffic-manager-overview.md) is used throughout this article for illustration purposes only.</span></span> <span data-ttu-id="7faa3-118">Можно использовать любое решение балансировки нагрузки, поддерживающее метод маршрутизации с отработкой отказа.</span><span class="sxs-lookup"><span data-stu-id="7faa3-118">You can use any load-balancing solution that supports failover routing method.</span></span>    
>

<span data-ttu-id="7faa3-119">Здравствуй, следующая схема показывает этой конфигурации до сбоя.</span><span class="sxs-lookup"><span data-stu-id="7faa3-119">hello following diagram shows this configuration before an outage.</span></span>

![Настройка георепликации базы данных SQL](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-1.png)

<span data-ttu-id="7faa3-122">После сбоя в основном регионе hello hello служба базы данных SQL обнаруживает базы данных-источника, hello недоступен и запустит отработки отказа toohello базы данных-получателя на основе параметров hello hello политики автоматического перехода на другой ресурс.</span><span class="sxs-lookup"><span data-stu-id="7faa3-122">After an outage in hello primary region, hello SQL Database service detects that hello primary database is not accessible and trigger a failover toohello secondary database based on hello parameters of hello automatic failover policy.</span></span> <span data-ttu-id="7faa3-123">В зависимости от ОБСЛУЖИВАНИЯ приложений можно tooconfigure период между hello обнаружение сбоя hello и отработки отказа hello сам.</span><span class="sxs-lookup"><span data-stu-id="7faa3-123">Depending on your application SLA, you can decide tooconfigure a grace period between hello detection of hello outage and hello failover itself.</span></span> <span data-ttu-id="7faa3-124">Настройка периода отсрочки снижает риск hello случаях toohello потери данных разрушительного сбоя hello и доступности в регионе hello не может быть быстро восстановлена.</span><span class="sxs-lookup"><span data-stu-id="7faa3-124">Configuring a grace period reduces hello risk of data loss toohello cases where hello outage is catastrophic and availability in hello region cannot be quickly restored.</span></span> <span data-ttu-id="7faa3-125">Если конечная точка hello перехода на другой ресурс инициируется диспетчера трафика hello перед hello перехода на другой ресурс группы триггеры hello отработки отказа базы данных hello, веб-приложение hello не базы данных может tooreconnect toohello.</span><span class="sxs-lookup"><span data-stu-id="7faa3-125">If hello endpoint failover is initiated by hello traffic manager before hello failover group triggers hello failover of hello database, hello web application is not able tooreconnect toohello database.</span></span> <span data-ttu-id="7faa3-126">приложение Hello tooreconnect попытка завершается успешно, сразу после завершения отработки отказа базы данных hello.</span><span class="sxs-lookup"><span data-stu-id="7faa3-126">hello application’s attempt tooreconnect automatically succeeds as soon as hello database failover completes.</span></span> 

> [!NOTE]
> <span data-ttu-id="7faa3-127">tooachieve полностью координация отработки отказа приложения hello и hello баз данных, следует разработать собственный метод мониторинга и вручную произвести отработку отказа конечных точек приложения hello web и hello баз данных.</span><span class="sxs-lookup"><span data-stu-id="7faa3-127">tooachieve fully coordinated failover of hello application and hello databases, you should devise your own monitoring method and use manual failover of hello web application endpoints and hello databases.</span></span>
>

<span data-ttu-id="7faa3-128">После завершения отработки отказа hello приложения hello конечных точек и hello базы данных, приложение hello снова начнет обработку запросов пользователей hello в регионе hello B и останется совмещена с hello базы данных, поскольку база данных-источник hello теперь находится в область б. Этот сценарий поясняет следующая схема hello.</span><span class="sxs-lookup"><span data-stu-id="7faa3-128">After hello failover of both hello application’s endpoints and hello database completes, hello application will re-start processing hello user requests in hello region B and will remain co-located with hello database because hello primary database is now in region B. This scenario is illustrated in hello following diagram.</span></span> <span data-ttu-id="7faa3-129">На всех схемах сплошными линиями показаны активные подключения, пунктирными — приостановленные подключения, а знаки "стоп" означают триггеры действий.</span><span class="sxs-lookup"><span data-stu-id="7faa3-129">In all diagrams, solid lines indicate active connections, dotted lines indicate suspended connections, and stop signs indicate action triggers.</span></span>

![Георепликации: База данных toosecondary переход на другой ресурс.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-2.png)

<span data-ttu-id="7faa3-132">В случае сбоя в дополнительном регионе hello hello связь репликации между основным hello и hello баз данных-получателей приостановлена, но hello перехода на другой ресурс не выполняется, так как база данных-источник hello не влияет на.</span><span class="sxs-lookup"><span data-stu-id="7faa3-132">If an outage happens in hello secondary region, hello replication link between hello primary and hello secondary database is suspended but hello failover is not triggered because hello primary database is not impacted.</span></span> <span data-ttu-id="7faa3-133">доступность приложения Hello не изменяется таким образом, но приложение hello работает без поддержки и таким образом рискует занести в случае обе области ошибкой в течение промежутка времени.</span><span class="sxs-lookup"><span data-stu-id="7faa3-133">hello application's availability is not changed in this case, but hello application operates exposed and therefore at higher risk in case both regions fail in succession.</span></span>

> [!NOTE]
> <span data-ttu-id="7faa3-134">Для аварийного восстановления рекомендуется hello конфигурации с областями tootwo ограниченный развертывания приложения.</span><span class="sxs-lookup"><span data-stu-id="7faa3-134">For disaster recovery we recommend hello configuration with application deployment limited tootwo regions.</span></span> <span data-ttu-id="7faa3-135">Это, поскольку большинство из hello географических регионов Azure имеют только две области.</span><span class="sxs-lookup"><span data-stu-id="7faa3-135">This is because most of hello Azure geographies have only two regions.</span></span> <span data-ttu-id="7faa3-136">Эта конфигурация не позволяет защитить ваши приложения от одновременного разрушительного сбоя в обоих регионах.</span><span class="sxs-lookup"><span data-stu-id="7faa3-136">This configuration will not protect your application from a simultaneous catastrophic failure of both regions.</span></span>  <span data-ttu-id="7faa3-137">В маловероятной ситуации такого сбоя можно восстановить базы данных в третьем регионе с помощью [операции геовосстановления](sql-database-disaster-recovery.md#recover-using-geo-restore).</span><span class="sxs-lookup"><span data-stu-id="7faa3-137">In an unlikely event of such a failure, you can recover your databases in a third region using [geo-restore operation](sql-database-disaster-recovery.md#recover-using-geo-restore).</span></span>
>

<span data-ttu-id="7faa3-138">После сбоя hello, уменьшается, база данных-получатель hello автоматически повторно синхронизируется с первичной hello.</span><span class="sxs-lookup"><span data-stu-id="7faa3-138">Once hello outage is mitigated, hello secondary database will automatically re-synchronize with hello primary.</span></span> <span data-ttu-id="7faa3-139">Во время синхронизации производительность hello основной удалось так в зависимости от hello объем данных, которые должны синхронизировать toobe немного.</span><span class="sxs-lookup"><span data-stu-id="7faa3-139">During synchronization, performance of hello primary could be slightly impacted depending on hello amount of data that needs toobe synchronized.</span></span> <span data-ttu-id="7faa3-140">Hello следующая диаграмма иллюстрирует сбоя в дополнительном регионе hello.</span><span class="sxs-lookup"><span data-stu-id="7faa3-140">hello following diagram illustrates an outage in hello secondary region.</span></span>

![Синхронизация базы данных-получателя с базой данных-источником.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-3.png)

<span data-ttu-id="7faa3-143">ключ Hello **преимущества** этого шаблона разработки являются:</span><span class="sxs-lookup"><span data-stu-id="7faa3-143">hello key **advantages** of this design pattern are:</span></span>

* <span data-ttu-id="7faa3-144">Hello одного веб-приложения — tooboth развернутой области без какой-либо настройки региона и отработка отказа toohello tooreact дополнительная логика.</span><span class="sxs-lookup"><span data-stu-id="7faa3-144">hello same web application is deployed tooboth regions without any region-specific configuration and no additional logic tooreact toohello failover.</span></span> 
* <span data-ttu-id="7faa3-145">Переход на другой ресурс, как веб-приложения hello не влияет на производительность приложения Hello и hello базы данных всегда находятся в одном месте.</span><span class="sxs-lookup"><span data-stu-id="7faa3-145">hello application's performance is not impacted by failover as hello web application and hello database are always co-located.</span></span>

<span data-ttu-id="7faa3-146">основной Hello **компромисс** —, избыточных приложение hello экземпляра в дополнительный регион hello используется только для аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="7faa3-146">hello main **tradeoff** is that hello redundant application instance in hello secondary region is only used for disaster recovery.</span></span>

## <a name="design-pattern-2-active-active-deployment-for-application-load-balancing"></a><span data-ttu-id="7faa3-147">Модель разработки 2: активное — активное развертывание для балансировки нагрузки приложения</span><span class="sxs-lookup"><span data-stu-id="7faa3-147">Design pattern 2: Active-active deployment for application load balancing</span></span>
<span data-ttu-id="7faa3-148">Данный вариант восстановления после сбоев облачных наилучшим образом подходит для приложений с hello следующие характеристики:</span><span class="sxs-lookup"><span data-stu-id="7faa3-148">This cloud disaster recovery option is best suited for applications with hello following characteristics:</span></span>

* <span data-ttu-id="7faa3-149">Высокая доля базы данных считывает toowrites</span><span class="sxs-lookup"><span data-stu-id="7faa3-149">High ratio of database reads toowrites</span></span>
* <span data-ttu-id="7faa3-150">Для конечного пользователя hello более важным, чем задержка записи hello задержки чтения с базы данных</span><span class="sxs-lookup"><span data-stu-id="7faa3-150">Database read latency is more critical for hello end-user experience than hello write latency</span></span> 
* <span data-ttu-id="7faa3-151">Логика только для чтения может быть отделена от логики чтения и записи с помощью другой строки подключения.</span><span class="sxs-lookup"><span data-stu-id="7faa3-151">Read-only logic can be separated from read-write logic by using a different connection string</span></span>
* <span data-ttu-id="7faa3-152">Только для чтения логика зависит от данных, полностью синхронизируются с последними обновлениями hello</span><span class="sxs-lookup"><span data-stu-id="7faa3-152">Read-only logic does not depend on data being fully synchronized with hello latest updates</span></span>  

<span data-ttu-id="7faa3-153">Если приложения обладают следующими характеристиками, балансировку нагрузки подключений hello конечных пользователей на нескольких экземпляров приложения в разных регионах может существенно повысить эффективность работы конечных пользователей hello.</span><span class="sxs-lookup"><span data-stu-id="7faa3-153">If your applications have these characteristics, load balancing hello end-user connections across multiple application instances in different regions can substantially improve hello overall end-user experience.</span></span> <span data-ttu-id="7faa3-154">Двух областей hello должен быть установлен как hello пары аварийного восстановления и отработки отказа группой hello должно включать hello баз данных в этих областях.</span><span class="sxs-lookup"><span data-stu-id="7faa3-154">Two of hello regions should be selected as hello DR pair and hello failover group should include hello databases in these regions.</span></span> <span data-ttu-id="7faa3-155">tooimplement балансировки нагрузки каждой области должны иметь активный экземпляр приложения hello с hello чтения и записи (RW) логику подключен toohello чтения и записи прослушивателя конечной точкой hello перехода на другой ресурс группы.</span><span class="sxs-lookup"><span data-stu-id="7faa3-155">tooimplement load-balancing, each region should have an active instance of hello application with hello read-write (RW) logic connected toohello read-write listener endpoint of hello failover group.</span></span> <span data-ttu-id="7faa3-156">Он будет гарантирует, что что hello отработка отказа будет автоматически инициироваться Если база данных-источник hello подвержено влиянию сбоя.</span><span class="sxs-lookup"><span data-stu-id="7faa3-156">It will guarantee that hello failover will be automatically initiated if hello primary database is impacted by an outage.</span></span> <span data-ttu-id="7faa3-157">Hello только для чтения логику (только для чтения) в веб-приложение hello следует подключаться напрямую toohello базы данных в этом регионе.</span><span class="sxs-lookup"><span data-stu-id="7faa3-157">hello read-only logic (RO) in hello web application should connect directly toohello database in that region.</span></span> <span data-ttu-id="7faa3-158">Диспетчер трафика следует настроить toouse [производительности маршрутизации](../traffic-manager/traffic-manager-configure-performance-routing-method.md) с [мониторинг конечной точки](../traffic-manager/traffic-manager-monitoring.md) включена для каждого экземпляра приложения.</span><span class="sxs-lookup"><span data-stu-id="7faa3-158">Traffic manager should be set up toouse [performance routing](../traffic-manager/traffic-manager-configure-performance-routing-method.md) with [end-point monitoring](../traffic-manager/traffic-manager-monitoring.md) enabled for each application instance.</span></span>

<span data-ttu-id="7faa3-159">Как и в модели 1, следует рассмотреть возможность развертывания схожего приложения мониторинга.</span><span class="sxs-lookup"><span data-stu-id="7faa3-159">As in pattern #1, you should consider deploying a similar monitoring application.</span></span> <span data-ttu-id="7faa3-160">Но в отличие от шаблона #1 мониторинг приложения hello не будет отвечать за запуск отработки отказа hello конечной точке.</span><span class="sxs-lookup"><span data-stu-id="7faa3-160">But unlike pattern #1, hello monitoring application will not be responsible for triggering hello end-point failover.</span></span>

> [!NOTE]
> <span data-ttu-id="7faa3-161">Хотя этот шаблон использует несколько баз данных-получателей, дополнительным в регион B hello будет использоваться для отработки отказа и должно быть частью группы отказоустойчивого hello.</span><span class="sxs-lookup"><span data-stu-id="7faa3-161">While this pattern uses more than one secondary database, only hello secondary in Region B  would be used for failover and should be part of hello failover group.</span></span>
>

<span data-ttu-id="7faa3-162">Диспетчер трафика должны быть настроены для производительности маршрутизации toodirect hello пользователя подключений toohello приложения экземпляра ближайший toohello географического расположения пользователя.</span><span class="sxs-lookup"><span data-stu-id="7faa3-162">Traffic manager should be configured for performance routing toodirect hello user connections toohello application instance closest toohello user's geographic location.</span></span> <span data-ttu-id="7faa3-163">Привет, следующая схема иллюстрирует этой конфигурации до сбоя.</span><span class="sxs-lookup"><span data-stu-id="7faa3-163">hello following diagram illustrates this configuration before an outage.</span></span>

![Без простоя: приложение маршрутизации toonearest производительности.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-1.png)

<span data-ttu-id="7faa3-166">При обнаружении сбоя базы данных в области hello A hello отработки отказа группой будет автоматически инициировать отработку отказа hello базы данных-источника в toohello региона A получателей в регионе б. Он также автоматически обновит hello чтения и записи прослушиватель конечной точки tooregion B, соединений чтения и записи в веб-приложение hello не повлияет.</span><span class="sxs-lookup"><span data-stu-id="7faa3-166">If a database outage is detected in hello region A, hello failover group will automatically initiate failover of hello primary database in region A toohello secondary in region B. It will also automatically update hello read-write listener endpoint tooregion B so read-write connections in hello web application will not be impacted.</span></span> <span data-ttu-id="7faa3-167">Диспетчер трафика Hello исключит автономного hello конечной точке из таблицы маршрутизации hello, но будут маршрутизации hello конечным пользователем трафика toohello оставшиеся online экземпляры.</span><span class="sxs-lookup"><span data-stu-id="7faa3-167">hello traffic manager will exclude hello offline end-point from hello routing table but will continue routing hello end-user traffic toohello remaining online instances.</span></span> <span data-ttu-id="7faa3-168">Hello строки подключения SQL только для чтения не повлияет на так, как они всегда точки базы данных toohello hello одного региона.</span><span class="sxs-lookup"><span data-stu-id="7faa3-168">hello read-only SQL connection strings will not be impacted as they always point toohello database in hello same region.</span></span> 

<span data-ttu-id="7faa3-169">Привет, следующая схема иллюстрирует hello новую конфигурацию после отработки отказа hello.</span><span class="sxs-lookup"><span data-stu-id="7faa3-169">hello following diagram illustrates hello new configuration after hello failover.</span></span>

![Настройка после отработки отказа.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-2.png)

<span data-ttu-id="7faa3-172">В случае сбоя в одной из областей получателей hello диспетчера трафика hello автоматически удалит автономного hello конечной точки в этом регионе из таблицы маршрутизации hello.</span><span class="sxs-lookup"><span data-stu-id="7faa3-172">In case of an outage in one of hello secondary regions, hello traffic manager will automatically remove hello offline end-point in that region from hello routing table.</span></span> <span data-ttu-id="7faa3-173">Hello репликации канала toohello базы данных-получателя в этом регионе будут приостановлены.</span><span class="sxs-lookup"><span data-stu-id="7faa3-173">hello replication channel toohello secondary database in that region will be suspended.</span></span> <span data-ttu-id="7faa3-174">Так, как остальные регионы hello получить дополнительный пользовательский трафик в этом сценарии, производительность приложения hello будут затронуты при сбое hello.</span><span class="sxs-lookup"><span data-stu-id="7faa3-174">Because hello remaining regions get additional user traffic in this scenario, hello application's performance will be impacted during hello outage.</span></span> <span data-ttu-id="7faa3-175">После сбоя hello, уменьшается, hello базы данных-получателя в области, затронутые hello немедленно синхронизируется с первичной hello.</span><span class="sxs-lookup"><span data-stu-id="7faa3-175">Once hello outage is mitigated, hello secondary database in hello impacted region will be immediately synchronized with hello primary.</span></span> <span data-ttu-id="7faa3-176">Во время hello производительность синхронизации основной hello удалось так в зависимости от hello объем данных, которые должны синхронизировать toobe немного.</span><span class="sxs-lookup"><span data-stu-id="7faa3-176">During hello synchronization performance of hello primary could be slightly impacted depending on hello amount of data that needs toobe synchronized.</span></span> <span data-ttu-id="7faa3-177">Привет, следующая схема иллюстрирует сбоя в регионе б.</span><span class="sxs-lookup"><span data-stu-id="7faa3-177">hello following diagram illustrates an outage in region B.</span></span>

![Сбой в дополнительном регионе.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-3.png)

<span data-ttu-id="7faa3-180">ключ Hello **преимущества** этой конструкции шаблон является Масштабирование рабочей нагрузки приложения hello через несколько баз данных-получателей tooachieve hello оптимальной для конечных пользователей производительности.</span><span class="sxs-lookup"><span data-stu-id="7faa3-180">hello key **advantage** of this design pattern is that you can scale hello application workload across multiple secondaries tooachieve hello optimal end-user performance.</span></span> <span data-ttu-id="7faa3-181">Hello **компромиссы** этого параметра являются:</span><span class="sxs-lookup"><span data-stu-id="7faa3-181">hello **tradeoffs** of this option are:</span></span>

* <span data-ttu-id="7faa3-182">Соединений чтения и записи между экземплярами приложений hello и базы данных имеют различные затрат и задержек</span><span class="sxs-lookup"><span data-stu-id="7faa3-182">Read-write connections between hello application instances and database have varying latency and cost</span></span>
* <span data-ttu-id="7faa3-183">Влияет на производительность приложения во время сбоя hello</span><span class="sxs-lookup"><span data-stu-id="7faa3-183">Application performance is impacted during hello outage</span></span>

> [!NOTE]
> <span data-ttu-id="7faa3-184">Аналогичный подход можно использовать toooffload специализированные рабочих нагрузок, например для создания отчетов, заданий, средства бизнес-аналитики или резервные копии.</span><span class="sxs-lookup"><span data-stu-id="7faa3-184">A similar approach can be used toooffload specialized workloads such as reporting jobs, business intelligence tools, or backups.</span></span> <span data-ttu-id="7faa3-185">Как правило, эти потребляют значительные ресурсы базы данных таким образом, рекомендуется, следует назначить один из hello баз данных-получателей для них с производительности hello toohello уровня соответствия предполагаемой рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="7faa3-185">Typically, these workloads consume significant database resources therefore it is recommended that you designate one of hello secondary databases for them with hello performance level matched toohello anticipated workload.</span></span>
>

## <a name="design-pattern-3-active-passive-deployment-for-data-preservation"></a><span data-ttu-id="7faa3-186">Модель разработки 3: активное — пассивное развертывание для сохранения данных</span><span class="sxs-lookup"><span data-stu-id="7faa3-186">Design pattern 3: Active-passive deployment for data preservation</span></span>
<span data-ttu-id="7faa3-187">Этот вариант лучше всего подходит для приложений с hello следующие характеристики:</span><span class="sxs-lookup"><span data-stu-id="7faa3-187">This option is best suited for applications with hello following characteristics:</span></span>

* <span data-ttu-id="7faa3-188">Любая потеря данных представляет собой большой риск для бизнеса.</span><span class="sxs-lookup"><span data-stu-id="7faa3-188">Any data loss is high business risk.</span></span> <span data-ttu-id="7faa3-189">Hello отработки отказа базы данных может использоваться только в крайнем случае разрушительного сбоя hello.</span><span class="sxs-lookup"><span data-stu-id="7faa3-189">hello database failover can only be used as a last resort if hello outage is catastrophic.</span></span>
* <span data-ttu-id="7faa3-190">приложение Hello поддерживает только для чтения и чтения и записи операций и может работать в режиме «только для чтения» в течение заданного времени.</span><span class="sxs-lookup"><span data-stu-id="7faa3-190">hello application supports read-only and read-write modes of operations and can operate in "read-only mode" for a period of time.</span></span>

<span data-ttu-id="7faa3-191">В этом шаблоне приложения hello переключает режим только для tooread запуск происходят ошибки времени ожидания соединения для чтения записи hello.</span><span class="sxs-lookup"><span data-stu-id="7faa3-191">In this pattern, hello application switches tooread-only mode when hello read-write connections start getting time-out errors.</span></span> <span data-ttu-id="7faa3-192">Hello веб-приложения является tooboth развернутой области с конечной точкой соединения toohello прослушивателя чтения и записи и конечная точка прослушивателя только для чтения toohello другое подключение.</span><span class="sxs-lookup"><span data-stu-id="7faa3-192">hello Web Application is deployed tooboth regions and include a connection toohello read-write listener endpoint and different connection toohello read-only listener endpoint.</span></span> <span data-ttu-id="7faa3-193">Hello диспетчера трафика следует настроить toouse [перехода на другой ресурс маршрутизации](../traffic-manager/traffic-manager-configure-failover-routing-method.md) с [мониторинг конечной точки](../traffic-manager/traffic-manager-monitoring.md) включена для конечной точки приложения hello в каждом регионе.</span><span class="sxs-lookup"><span data-stu-id="7faa3-193">hello Traffic manager should be set up toouse [failover routing](../traffic-manager/traffic-manager-configure-failover-routing-method.md) with [end-point monitoring](../traffic-manager/traffic-manager-monitoring.md) enabled for hello application endpoint in each region.</span></span>

<span data-ttu-id="7faa3-194">Привет, следующая схема иллюстрирует этой конфигурации до сбоя.</span><span class="sxs-lookup"><span data-stu-id="7faa3-194">hello following diagram illustrates this configuration before an outage.</span></span>

![Активное — пассивное развертывание перед отработкой отказа.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-1.png)

<span data-ttu-id="7faa3-197">Когда hello диспетчера трафика обнаруживает tooregion сбой подключения к A, происходит автоматическое переключение пользовательский экземпляр приложения toohello трафика в регионе б. С этим шаблоном необходимо установить hello льготный период с потерей tooa достаточно большое значение данных, например 24 часа.</span><span class="sxs-lookup"><span data-stu-id="7faa3-197">When hello traffic manager detects a connectivity failure tooregion A, it automatically switches user traffic toohello application instance in region B. With this pattern, it is important that you set hello grace period with data loss tooa sufficiently high value, e.g. 24 hours.</span></span> <span data-ttu-id="7faa3-198">Гарантирует, что потери данных является избежать дублирования устраняется hello простоя в течение этого времени.</span><span class="sxs-lookup"><span data-stu-id="7faa3-198">It will ensure that data loss is prevented if hello outage is mitigated within that time.</span></span> <span data-ttu-id="7faa3-199">При активации hello веб-приложения в регионе hello B hello операций чтения и записи будет начинаться сбоем.</span><span class="sxs-lookup"><span data-stu-id="7faa3-199">When hello Web application in hello region B is activated hello read-write operations will start failing.</span></span> <span data-ttu-id="7faa3-200">На этом этапе необходимо отключить toohello режиме только для чтения.</span><span class="sxs-lookup"><span data-stu-id="7faa3-200">At that point, it should switch toohello read-only mode.</span></span> <span data-ttu-id="7faa3-201">В этот режим hello запросы будут автоматически перенаправленное toohello баз данных-получателей.</span><span class="sxs-lookup"><span data-stu-id="7faa3-201">In this mode hello requests will be automatically routed toohello secondary database.</span></span> <span data-ttu-id="7faa3-202">В случае, когда hello hello Разрушительный сбой отключения не следует устранить в течение льготного периода hello и отработки отказа группой hello запускается hello перехода на другой ресурс.</span><span class="sxs-lookup"><span data-stu-id="7faa3-202">In hello case of a catastrophic failure hello outage will not be mitigated within hello grace period and hello failover group will trigger hello failover.</span></span> <span data-ttu-id="7faa3-203">После этого hello скоро станет доступен прослушивателя чтения и записи и hello вызовов tooit прекращают произошел сбой.</span><span class="sxs-lookup"><span data-stu-id="7faa3-203">After that hello read-write listener will become available and hello calls tooit will stop failing.</span></span> <span data-ttu-id="7faa3-204">Это продемонстрировано hello следующие схемы.</span><span class="sxs-lookup"><span data-stu-id="7faa3-204">This is illustrated by hello following diagram.</span></span>

![Сбой: приложение в режиме только для чтения.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-2.png)

<span data-ttu-id="7faa3-207">При hello сбоя в основном регионе hello, уменьшается в течение льготного периода hello, диспетчер трафика определяет hello восстановления подключения в основном регионе hello и переключается пользовательский экземпляр приложения задней toohello трафика в регионе, а. Этот экземпляр приложения возобновляет работу и будет работать в режиме чтения и записи, с помощью базы данных-источника hello в региона A.</span><span class="sxs-lookup"><span data-stu-id="7faa3-207">If hello outage in hello primary region is mitigated within hello grace period, traffic manager detects hello restoration of connectivity in hello primary region and switches user traffic back toohello application instance in region A. That application instance resumes and operates in read-write mode using hello primary database in region A.</span></span>

<span data-ttu-id="7faa3-208">В случае сбоя в регионе hello B hello диспетчера трафика обнаруживает сбой hello из конечной точки приложения hello в регион B и tooregion hello прослушивателя только для чтения для перехода на другой ресурс группы hello коммутаторы A. Отключение не влияет на взаимодействие с пользователем hello, но во время сбоя hello будет предоставляться hello базы данных-источника.</span><span class="sxs-lookup"><span data-stu-id="7faa3-208">In case of an outage in hello region B, hello traffic manager detects hello failure of hello application end-point in region B and hello failover group switches hello read-only listener tooregion A. This outage does not impact hello end-user experience but hello primary database will be exposed during hello outage.</span></span> <span data-ttu-id="7faa3-209">Это продемонстрировано hello следующие схемы.</span><span class="sxs-lookup"><span data-stu-id="7faa3-209">This is illustrated by hello following diagram.</span></span>

![Сбой: база данных-получатель](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-3.png)

<span data-ttu-id="7faa3-212">После сбоя hello, уменьшается, hello баз данных-получателей немедленно синхронизируется с первичной hello и hello прослушивателя только для чтения коммутируемых задней toohello базы данных-получателя в регионе б. Во время синхронизации производительность hello основной удалось так в зависимости от hello объем данных, которые должны синхронизировать toobe немного.</span><span class="sxs-lookup"><span data-stu-id="7faa3-212">Once hello outage is mitigated, hello secondary database is immediately synchronized with hello primary and hello read-only listener is switched back toohello secondary database in region B. During synchronization performance of hello primary could be slightly impacted depending on hello amount of data that needs toobe synchronized.</span></span>

<span data-ttu-id="7faa3-213">Эта модель разработки имеет несколько **преимуществ**:</span><span class="sxs-lookup"><span data-stu-id="7faa3-213">This design pattern has several **advantages**:</span></span>

* <span data-ttu-id="7faa3-214">Она позволяет избежать потери данных во время hello временные сбои.</span><span class="sxs-lookup"><span data-stu-id="7faa3-214">It avoids data loss during hello temporary outages.</span></span>
* <span data-ttu-id="7faa3-215">Время простоя зависит от только как быстро диспетчера трафика обнаруживает сбой подключения к hello, который можно настроить.</span><span class="sxs-lookup"><span data-stu-id="7faa3-215">Downtime depends only on how quickly traffic manager detects hello connectivity failure, which is configurable.</span></span>

<span data-ttu-id="7faa3-216">Hello **компромисс** является:</span><span class="sxs-lookup"><span data-stu-id="7faa3-216">hello **tradeoff** is:</span></span>

* <span data-ttu-id="7faa3-217">Приложение должно иметь toooperate доступ в режиме только для чтения.</span><span class="sxs-lookup"><span data-stu-id="7faa3-217">Application must be able toooperate in read-only mode.</span></span>

> [!NOTE]
> <span data-ttu-id="7faa3-218">В случае сбоя постоянные службы, в области hello вручную активируйте отработки отказа базы данных и принять hello потери данных.</span><span class="sxs-lookup"><span data-stu-id="7faa3-218">In case of a permanent service outage in hello region, you manually activate database failover and accept hello data loss.</span></span> <span data-ttu-id="7faa3-219">Hello приложения будут работать в дополнительный регион hello с базой данных toohello доступ для чтения и записи.</span><span class="sxs-lookup"><span data-stu-id="7faa3-219">hello application will be functional in hello secondary region with read-write access toohello database.</span></span>
>

## <a name="business-continuity-planning-choose-an-application-design-for-cloud-disaster-recovery"></a><span data-ttu-id="7faa3-220">Планирование непрерывности бизнеса-процессов: выбор проекта приложения для аварийного восстановления облака</span><span class="sxs-lookup"><span data-stu-id="7faa3-220">Business continuity planning: Choose an application design for cloud disaster recovery</span></span>
<span data-ttu-id="7faa3-221">Стратегия аварийного восстановления определенного облака можно объединить или расширить эти шаблоны проектирования toobest hello соответствует требованиям приложения.</span><span class="sxs-lookup"><span data-stu-id="7faa3-221">Your specific cloud disaster recovery strategy can combine or extend these design patterns toobest meet hello needs of your application.</span></span>  <span data-ttu-id="7faa3-222">Как упоминалось ранее, Выбор стратегии hello основан на hello соглашения об уровне ОБСЛУЖИВАНИЯ требуется toooffer tooyour клиентов и hello топологии развертывания приложения.</span><span class="sxs-lookup"><span data-stu-id="7faa3-222">As mentioned earlier, hello strategy you choose is based on hello SLA you want toooffer tooyour customers and hello application deployment topology.</span></span> <span data-ttu-id="7faa3-223">toohelp принимать решения о, hello в следующей таблице сравниваются варианты hello с учетом hello точки данных потери или восстановления точка (RPO) и предполагаемое время восстановления (ERT).</span><span class="sxs-lookup"><span data-stu-id="7faa3-223">toohelp guide your decision, hello following table compares hello choices based on hello estimated data loss or recovery point objective (RPO) and estimated recovery time (ERT).</span></span>

| <span data-ttu-id="7faa3-224">Модель</span><span class="sxs-lookup"><span data-stu-id="7faa3-224">Pattern</span></span> | <span data-ttu-id="7faa3-225">RPO</span><span class="sxs-lookup"><span data-stu-id="7faa3-225">RPO</span></span> | <span data-ttu-id="7faa3-226">ERT</span><span class="sxs-lookup"><span data-stu-id="7faa3-226">ERT</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="7faa3-227">Активное — пассивное развертывание для аварийного восстановления с доступом к совмещенной базе данных</span><span class="sxs-lookup"><span data-stu-id="7faa3-227">Active-passive deployment for disaster recovery with co-located database access</span></span> |<span data-ttu-id="7faa3-228">Доступ для чтения и записи < 5 секунд</span><span class="sxs-lookup"><span data-stu-id="7faa3-228">Read-write access < 5 sec</span></span> |<span data-ttu-id="7faa3-229">Время обнаружения сбоя и срок жизни DNS</span><span class="sxs-lookup"><span data-stu-id="7faa3-229">Failure detection time + DNS TTL</span></span> |
| <span data-ttu-id="7faa3-230">Активное — активное развертывание для балансировки нагрузки приложения</span><span class="sxs-lookup"><span data-stu-id="7faa3-230">Active-active deployment for application load balancing</span></span> |<span data-ttu-id="7faa3-231">Доступ для чтения и записи < 5 секунд</span><span class="sxs-lookup"><span data-stu-id="7faa3-231">Read-write access < 5 sec</span></span> |<span data-ttu-id="7faa3-232">Время обнаружения сбоя и срок жизни DNS</span><span class="sxs-lookup"><span data-stu-id="7faa3-232">Failure detection time + DNS TTL</span></span> |
| <span data-ttu-id="7faa3-233">Активное — пассивное развертывание для сохранения данных</span><span class="sxs-lookup"><span data-stu-id="7faa3-233">Active-passive deployment for data preservation</span></span> |<span data-ttu-id="7faa3-234">Доступ только для чтения < 5 с</span><span class="sxs-lookup"><span data-stu-id="7faa3-234">Read-only access < 5 sec</span></span> | <span data-ttu-id="7faa3-235">Доступ только для чтения = 0</span><span class="sxs-lookup"><span data-stu-id="7faa3-235">Read-only access = 0</span></span> |
||<span data-ttu-id="7faa3-236">Доступ только для чтения = 0</span><span class="sxs-lookup"><span data-stu-id="7faa3-236">Read-write access = zero</span></span> | <span data-ttu-id="7faa3-237">Доступ только для чтения = время обнаружения сбоя + льготный период с потерей данных</span><span class="sxs-lookup"><span data-stu-id="7faa3-237">Read-write access = Failure detection time + grace period with data loss</span></span> |
|||

## <a name="next-steps"></a><span data-ttu-id="7faa3-238">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="7faa3-238">Next steps</span></span>
* <span data-ttu-id="7faa3-239">toolearn о резервных копиях автоматических базы данных SQL Azure, в разделе [базы данных SQL автоматическое резервное копирование](sql-database-automated-backups.md)</span><span class="sxs-lookup"><span data-stu-id="7faa3-239">toolearn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md)</span></span>
* <span data-ttu-id="7faa3-240">Сведения об обеспечении непрерывности бизнес-процессов и возможные сценарии описаны в [обзоре непрерывности бизнес-процессов](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="7faa3-240">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="7faa3-241">toolearn об использовании автоматического создания резервных копий для восстановления, в разделе [восстановление базы данных из резервных копий, инициируемых службой hello](sql-database-recovery-using-backups.md)</span><span class="sxs-lookup"><span data-stu-id="7faa3-241">toolearn about using automated backups for recovery, see [restore a database from hello service-initiated backups](sql-database-recovery-using-backups.md)</span></span>
* <span data-ttu-id="7faa3-242">toolearn о быстрее параметры восстановления, в разделе [активной георепликации](sql-database-geo-replication-overview.md)</span><span class="sxs-lookup"><span data-stu-id="7faa3-242">toolearn about faster recovery options, see [active geo-replication](sql-database-geo-replication-overview.md)</span></span>  
* <span data-ttu-id="7faa3-243">в разделе toolearn об использовании автоматического резервного копирования для архивации, [копирование базы данных](sql-database-copy.md)</span><span class="sxs-lookup"><span data-stu-id="7faa3-243">toolearn about using automated backups for archiving, see [database copy](sql-database-copy.md)</span></span>
* <span data-ttu-id="7faa3-244">Сведения об использовании активной георепликации с пулами эластичных баз данных см. в статье [Стратегии аварийного восстановления для приложений с использованием пула эластичных баз данных SQL](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="7faa3-244">For information about active geo-replication with Elastic Pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
