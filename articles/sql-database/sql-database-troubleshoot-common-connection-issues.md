---
title: "Устранение распространенных неполадок подключения к базе данных SQL Azure"
description: "Порядок обнаружения и устранения распространенных ошибок подключения в базе данных SQL Azure."
services: sql-database
documentationcenter: 
author: dalechen
manager: cshepard
editor: 
ms.assetid: ac463d1c-aec8-443d-b66e-fa5eadcccfa8
ms.service: sql-database
ms.custom: monitor & tune
ms.workload: On Demand
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: troubleshooting
ms.date: 11/03/2017
ms.author: daleche
ms.openlocfilehash: 1d756aa023ae143608acc988ddd0ae8acee1a113
ms.sourcegitcommit: e266df9f97d04acfc4a843770fadfd8edf4fa2b7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2017
---
# <a name="troubleshoot-connection-issues-to-azure-sql-database"></a>Устранение неполадок подключения к базе данных SQL Azure
При сбоях подключения к базе данных SQL Azure отображаются [сообщения об ошибке](sql-database-develop-error-messages.md). Эта статья представляет собой объединенный раздел, который поможет в устранении неполадок подключения к базе данных SQL Azure. В ней описываются [распространенные причины](#cause) проблем подключения, рекомендуется [инструмент устранения неполадок](#try-the-troubleshooter-for-azure-sql-database-connectivity-issues), который поможет выявить проблему, и приводятся пошаговые инструкции по устранению [временных ошибок](#troubleshoot-transient-errors) и [постоянных или повторяющихся ошибок](#troubleshoot-persistent-errors). 

Если у вас возникли проблемы с подключением, попробуйте устранить неполадки с помощью описанных в этой статье методов.
[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

## <a name="cause"></a>Причина:
Проблемы подключения могут быть вызваны любой из следующих причин.

* В процессе разработки приложения не были соблюдены рекомендации и указания по разработке.  Чтобы начать, см. статью [Общие сведения о разработке базы данных SQL](sql-database-develop-overview.md).
* Перенастройка базы данных SQL Azure.
* Параметры брандмауэра
* Время ожидания подключения.
* Неправильные сведения для входа.
* Достигнуто максимальное ограничение для некоторых ресурсов базы данных SQL Azure.

В общих чертах проблемы подключения к базе данных SQL Azure можно классифицировать следующим образом:

* [временные ошибки (кратковременные или возникающие периодически);](#troubleshoot-transient-errors)
* [постоянные или регулярно возникающие ошибки.](#troubleshoot-persistent-errors)

## <a name="try-the-troubleshooter-for-azure-sql-database-connectivity-issues"></a>Применение средства устранения неполадок для диагностики проблем подключения к базе данных SQL Azure
При возникновении определенной ошибки подключения попробуйте [этот инструмент](https://support.microsoft.com/help/10085/troubleshooting-connectivity-issues-with-microsoft-azure-sql-database), который поможет быстро выявить и устранить проблему.

## <a name="troubleshoot-transient-errors"></a>Устранение временных ошибок

Когда приложение подключается к базе данных SQL Azure, появляется следующее сообщение об ошибке:

```
Error code 40613: "Database <x> on server <y> is not currently available. Please retry the connection later. If the problem persists, contact customer support, and provide them the session tracing ID of <z>"
```

> [!NOTE]
> Это сообщение об ошибке обычно временное (кратковременное).
> 
> 

Эта ошибка возникает, когда база данных Azure перемещается (или перенастраивается) и приложение потеряло подключение к базе данных SQL. События перенастройки базы данных SQL обычно происходят в запланированном случае (например, при обновлении программного обеспечения) или в незапланированном случае (например, при сбое процесса или балансировке нагрузки). Большей частью события перенастройки кратковременные и должны завершаться в течение 60 секунд максимум. Тем не менее завершение этих событий иногда может занимать больше времени, например когда большая транзакция приводит к длительному восстановлению.

### <a name="steps-to-resolve-transient-connectivity-issues"></a>Порядок устранения временных проблем подключения

1. Проверьте [панель мониторинга служб Microsoft Azure](https://azure.microsoft.com/status) на наличие каких-либо известных сбоев, произошедших в то время, когда приложение сообщало об ошибках.
2. Приложения, подключающиеся к облачной службе, такой как база данных SQL Azure, должны ожидать периодические события перенастройки и реализовывать логику повторов для обработки этих ошибок, а не отображать их как ошибки приложения для пользователей. Дополнительные сведения и общие стратегии повторов см. в разделе [Временные ошибки (временные сбои)](sql-database-connectivity-issues.md) и в статье [Общие сведения о разработке базы данных SQL](sql-database-develop-overview.md). Затем ознакомьтесь с примерами кода в [библиотеке подключений для базы данных SQL и SQL Server](sql-database-libraries.md).
3. Если база данных близка к исчерпанию доступных ресурсов, может возникать временная проблема подключения. См. статью [Советы по настройке производительности базы данных SQL](sql-database-troubleshoot-performance.md).
4. Если проблемы подключения остаются или интервал, во время которого приложение обнаруживает ошибку, превышает 60 секунд, а также если в определенный день такая ошибка возникает многократно, зарегистрируйте запрос на поддержку Azure, нажав **Получить поддержку** на сайте [Поддержка Azure](https://azure.microsoft.com/support/options) .

## <a name="troubleshoot-persistent-errors"></a>Устранение постоянных ошибок
Если при подключении к базе данных SQL Azure в приложении постоянно возникают сбои, обычно причины бывают следующими:

* Конфигурация брандмауэра. База данных SQL Azure или брандмауэр на стороне клиента блокирует подключения к базе данных SQL Azure.
* Перенастройка сети на стороне клиента, например новый IP-адрес или прокси-сервер.
* Ошибка пользователя, например неправильно введенные параметры подключения, такие как имя сервера в строке подключения.

### <a name="steps-to-resolve-persistent-connectivity-issues"></a>Порядок устранения постоянных проблем подключения
1. Настройте [правила брандмауэра](sql-database-configure-firewall-settings.md) , разрешив предоставление IP-адреса клиенту. Для временных целей тестирования настройте правило брандмауэра, используя 0.0.0.0 как начало диапазона IP-адресов и 255.255.255.255 как завершение диапазона IP-адресов. Откроется сервер для всех IP-адресов. Если это позволяет устранить проблемы с подключением, удалите это правило и создайте правило брандмауэра для надлежащим образом ограниченных IP-адресов или диапазона адресов. 
2. На всех брандмауэрах между клиентом и Интернетом откройте порт 1433 для входящих соединений. См инструкции по настройке [брандмауэра Windows для разрешения доступа к SQL Server](https://msdn.microsoft.com/library/cc646023.aspx) и [портов и протоколов, необходимых для гибридной идентификации](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-ports). Вы узнаете о дополнительных указателях, относящихся к дополнительным портам, которые необходимо открыть для аутентификации в Azure Active Directory.
3. Проверьте строку подключения и другие параметры подключения. Ознакомьтесь с разделом "Строка подключения" в [статье о проблемах подключения](sql-database-connectivity-issues.md#connections-to-sql-database).
4. Проверьте работоспособность службы на панели мониторинга. Если вы считаете, что имеет место региональный сбой, выполните инструкции по восстановлению в новый регион из раздела [Восстановление после сбоя](sql-database-disaster-recovery.md) .

## <a name="next-steps"></a>Дальнейшие действия
* [Устранение проблем производительности базы данных SQL Azure](sql-database-troubleshoot-performance.md)
* [Поиск документации по Microsoft Azure](http://azure.microsoft.com/search/documentation/)
* [Просмотр последних обновлений для службы базы данных SQL Azure](http://azure.microsoft.com/updates/?service=sql-database)

## <a name="additional-resources"></a>Дополнительные ресурсы
* [Общие сведения о разработке базы данных SQL](sql-database-develop-overview.md)
* [Общие рекомендации по повторным попыткам](../best-practices-retry-general.md)
* [Библиотеки подключений для Базы данных SQL и SQL Server](sql-database-libraries.md)

