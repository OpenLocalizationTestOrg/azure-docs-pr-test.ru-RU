---
title: "Управление масштабируемыми облачными базами данных | Документация Майкрософт"
description: "Описание службы заданий обработки эластичных баз данных"
metakeywords: azure sql database elastic databases
services: sql-database
documentationcenter: 
manager: jhubbard
author: ddove
ms.assetid: 6fa47cf2-1162-4534-a206-6e2d95b78580
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/24/2016
ms.author: ddove
ms.openlocfilehash: 8e84562115a866c0df5e0dee6c7f66c036a74737
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="managing-scaled-out-cloud-databases"></a><span data-ttu-id="be43a-103">Управление масштабируемыми облачными базами данных</span><span class="sxs-lookup"><span data-stu-id="be43a-103">Managing scaled-out cloud databases</span></span>
<span data-ttu-id="be43a-104">Для управления масштабируемыми сегментированными базами данных можно воспользоваться функцией **заданий обработки для эластичных баз данных** (предварительная версия). Она позволяет надежно выполнить скрипт Transact-SQL (T-SQL) для группы баз данных, включая:</span><span class="sxs-lookup"><span data-stu-id="be43a-104">To manage scaled-out sharded databases, the **Elastic Database jobs** feature (preview) enables you to reliably execute a Transact-SQL (T-SQL) script across a group of databases, including:</span></span>

* <span data-ttu-id="be43a-105">пользовательское семейство баз данных (см. ниже);</span><span class="sxs-lookup"><span data-stu-id="be43a-105">a custom-defined collection of databases (explained below)</span></span>
* <span data-ttu-id="be43a-106">все базы данных в [эластичном пуле](sql-database-elastic-pool.md);</span><span class="sxs-lookup"><span data-stu-id="be43a-106">all databases in an [elastic pool](sql-database-elastic-pool.md)</span></span>
* <span data-ttu-id="be43a-107">набор сегментов (созданный с помощью [клиентской библиотеки эластичной базы данных](sql-database-elastic-database-client-library.md)).</span><span class="sxs-lookup"><span data-stu-id="be43a-107">a shard set (created using [Elastic Database client library](sql-database-elastic-database-client-library.md)).</span></span> 

## <a name="documentation"></a><span data-ttu-id="be43a-108">Документация</span><span class="sxs-lookup"><span data-stu-id="be43a-108">Documentation</span></span>
* <span data-ttu-id="be43a-109">[Установка компонентов заданий для обработки эластичных баз данных](sql-database-elastic-jobs-service-installation.md).</span><span class="sxs-lookup"><span data-stu-id="be43a-109">[Install the Elastic Database job components](sql-database-elastic-jobs-service-installation.md).</span></span> 
* <span data-ttu-id="be43a-110">[Приступая к работе с инструментами эластичных баз данных](sql-database-elastic-jobs-getting-started.md).</span><span class="sxs-lookup"><span data-stu-id="be43a-110">[Get started with Elastic Database jobs](sql-database-elastic-jobs-getting-started.md).</span></span>
* <span data-ttu-id="be43a-111">[Создание и управление заданиями с помощью PowerShell](sql-database-elastic-jobs-powershell.md).</span><span class="sxs-lookup"><span data-stu-id="be43a-111">[Create and manage jobs using PowerShell](sql-database-elastic-jobs-powershell.md).</span></span>
* [<span data-ttu-id="be43a-112">Создание развернутых баз данных SQL Azure и управление ими</span><span class="sxs-lookup"><span data-stu-id="be43a-112">Create and manage scaled out Azure SQL Databases</span></span>](sql-database-elastic-jobs-getting-started.md)

<span data-ttu-id="be43a-113">Сейчас служба **заданий обработки эластичных баз данных** — это размещаемая на стороне клиента облачная служба Azure, которая дает возможность выполнять ситуативные и запланированные административные задачи, именуемые **заданиями**.</span><span class="sxs-lookup"><span data-stu-id="be43a-113">**Elastic Database jobs** is currently a customer-hosted Azure Cloud Service that enables the execution of ad-hoc and scheduled administrative tasks, which are called **jobs**.</span></span> <span data-ttu-id="be43a-114">С помощью заданий вы можете легко и уверенно управлять большими группами баз данных SQL Azure, выполняя административные операции с помощью сценариев Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="be43a-114">With jobs, you can easily and reliably manage large groups of Azure SQL Databases by running Transact-SQL scripts to perform administrative operations.</span></span> 

![Служба заданий обработки эластичных баз данных][1]

## <a name="why-use-jobs"></a><span data-ttu-id="be43a-116">Зачем использовать задания?</span><span class="sxs-lookup"><span data-stu-id="be43a-116">Why use jobs?</span></span>
<span data-ttu-id="be43a-117">**Управление**</span><span class="sxs-lookup"><span data-stu-id="be43a-117">**Manage**</span></span>

<span data-ttu-id="be43a-118">Удобство управления изменениями схемы, учетными данными, обновлением эталонных данных, сбором сведений о производительности и клиентских данных телеметрии.</span><span class="sxs-lookup"><span data-stu-id="be43a-118">Easily do schema changes, credentials management, reference data updates, performance data collection or tenant (customer) telemetry collection.</span></span>

<span data-ttu-id="be43a-119">**Отчеты**</span><span class="sxs-lookup"><span data-stu-id="be43a-119">**Reports**</span></span>

<span data-ttu-id="be43a-120">Сбор данных из семейства баз данных SQL Azure в одну целевую таблицу.</span><span class="sxs-lookup"><span data-stu-id="be43a-120">Aggregate data from a collection of Azure SQL Databases into a single destination table.</span></span>

<span data-ttu-id="be43a-121">**Уменьшение нагрузки**</span><span class="sxs-lookup"><span data-stu-id="be43a-121">**Reduce overhead**</span></span>

<span data-ttu-id="be43a-122">Как правило, чтобы выполнять инструкции Transact-SQL или другие административные задачи, к каждой базе данных необходимо подключаться отдельно.</span><span class="sxs-lookup"><span data-stu-id="be43a-122">Normally, you must connect to each database independently in order to run Transact-SQL statements or perform other administrative tasks.</span></span> <span data-ttu-id="be43a-123">тогда как задание автоматически входит в каждую базу данных в целевой группе.</span><span class="sxs-lookup"><span data-stu-id="be43a-123">A job handles the task of logging in to each database in the target group.</span></span> <span data-ttu-id="be43a-124">Вы также определяете, поддерживаете и сохраняете сценарии Transact-SQL, которые могут выполняться в группе баз данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="be43a-124">You also define, maintain and persist Transact-SQL scripts to be executed across a group of Azure SQL Databases.</span></span>

<span data-ttu-id="be43a-125">**Учет**</span><span class="sxs-lookup"><span data-stu-id="be43a-125">**Accounting**</span></span>

<span data-ttu-id="be43a-126">Задания запускают сценарий и записывают состояние выполнения для каждой базы данных.</span><span class="sxs-lookup"><span data-stu-id="be43a-126">Jobs run the script and log the status of execution for each database.</span></span> <span data-ttu-id="be43a-127">При сбое действие автоматически выполняется повторно.</span><span class="sxs-lookup"><span data-stu-id="be43a-127">You also get automatic retry when failures occur.</span></span>

<span data-ttu-id="be43a-128">**Гибкость**</span><span class="sxs-lookup"><span data-stu-id="be43a-128">**Flexibility**</span></span>

<span data-ttu-id="be43a-129">Определение пользовательских групп для баз данных SQL Azure и определение расписаний для запуска задания.</span><span class="sxs-lookup"><span data-stu-id="be43a-129">Define custom groups of Azure SQL Databases, and define schedules for running a job.</span></span>

> [!NOTE]
> <span data-ttu-id="be43a-130">На портале Azure доступен сокращенный набор функций. Эти функции предназначены для работы с пулами эластичных баз данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="be43a-130">In the Azure portal, only a reduced set of functions limited to SQL Azure elastic pools is available.</span></span> <span data-ttu-id="be43a-131">Чтобы получить полный набор доступных на данный момент возможностей, используйте API-интерфейсы PowerShell.</span><span class="sxs-lookup"><span data-stu-id="be43a-131">Use the PowerShell APIs to access the full set of current functionality.</span></span>
> 
> 

## <a name="applications"></a><span data-ttu-id="be43a-132">Приложения</span><span class="sxs-lookup"><span data-stu-id="be43a-132">Applications</span></span>
* <span data-ttu-id="be43a-133">Выполнение административных задач, таких как развертывание новой схемы.</span><span class="sxs-lookup"><span data-stu-id="be43a-133">Perform administrative tasks, such as deploying a new schema.</span></span>
* <span data-ttu-id="be43a-134">Обновление эталонных данных (например, сведений о продукте, которые являются общими для всех баз данных).</span><span class="sxs-lookup"><span data-stu-id="be43a-134">Update reference data-product information common across all databases.</span></span> <span data-ttu-id="be43a-135">Планируйте автоматические обновления на нерабочие часы в будни.</span><span class="sxs-lookup"><span data-stu-id="be43a-135">Or schedules automatic updates every weekday, after hours.</span></span>
* <span data-ttu-id="be43a-136">Перестроение индексов для повышения скорости обработки запросов.</span><span class="sxs-lookup"><span data-stu-id="be43a-136">Rebuild indexes to improve query performance.</span></span> <span data-ttu-id="be43a-137">Вы можете настроить регулярное перестроение в семействе баз данных, например во время низкой нагрузки.</span><span class="sxs-lookup"><span data-stu-id="be43a-137">The rebuilding can be configured to execute across a collection of databases on a recurring basis, such as during off-peak hours.</span></span>
* <span data-ttu-id="be43a-138">Собирайте результаты запросов из набора баз данных в центральную таблицу на постоянной основе.</span><span class="sxs-lookup"><span data-stu-id="be43a-138">Collect query results from a set of databases into a central table on an on-going basis.</span></span> <span data-ttu-id="be43a-139">Запросы производительности могут выполняться непрерывно и вызывать дополнительные задачи.</span><span class="sxs-lookup"><span data-stu-id="be43a-139">Performance queries can be continually executed and configured to trigger additional tasks to be executed.</span></span>
* <span data-ttu-id="be43a-140">Выполняйте запросы обработки данных с повышенным временем выполнения для большого набора баз данных, например коллекции телеметрии клиентов.</span><span class="sxs-lookup"><span data-stu-id="be43a-140">Execute longer running data processing queries across a large set of databases, for example the collection of customer telemetry.</span></span> <span data-ttu-id="be43a-141">Результаты собираются в одну целевую таблицу для дальнейшего анализа.</span><span class="sxs-lookup"><span data-stu-id="be43a-141">Results are collected into a single destination table for further analysis.</span></span>

## <a name="elastic-database-jobs-end-to-end"></a><span data-ttu-id="be43a-142">Работа с заданиями обработки эластичных баз данных</span><span class="sxs-lookup"><span data-stu-id="be43a-142">Elastic Database jobs: end-to-end</span></span>
1. <span data-ttu-id="be43a-143">Установите компоненты службы **заданий обработки эластичных баз данных**.</span><span class="sxs-lookup"><span data-stu-id="be43a-143">Install the **Elastic Database jobs** components.</span></span> <span data-ttu-id="be43a-144">Дополнительные сведения см. в статье [Обзор установки заданий обработки эластичных баз данных](sql-database-elastic-jobs-service-installation.md).</span><span class="sxs-lookup"><span data-stu-id="be43a-144">For more information, see [Installing Elastic Database jobs](sql-database-elastic-jobs-service-installation.md).</span></span> <span data-ttu-id="be43a-145">Если во время установки произошла ошибка, [удалите установленные компоненты](sql-database-elastic-jobs-uninstall.md).</span><span class="sxs-lookup"><span data-stu-id="be43a-145">If the installation fails, see [how to uninstall](sql-database-elastic-jobs-uninstall.md).</span></span>
2. <span data-ttu-id="be43a-146">Используйте API-интерфейсы PowerShell, чтобы получить дополнительные возможности, например создание пользовательских семейств баз данных, добавление расписаний и/или сбор наборов результатов.</span><span class="sxs-lookup"><span data-stu-id="be43a-146">Use the PowerShell APIs to access more functionality, for example creating custom-defined database collections, adding schedules and/or gathering results sets.</span></span> <span data-ttu-id="be43a-147">Используйте портал для простой установки, создания и мониторинга заданий, которые выполняются только в **эластичном пуле**.</span><span class="sxs-lookup"><span data-stu-id="be43a-147">Use the portal for simple installation and creation/monitoring of jobs limited to execution against a **elastic pool**.</span></span> 
3. <span data-ttu-id="be43a-148">Создайте зашифрованные учетные данные для выполнения заданий и [добавьте пользователя (или роль) в каждую базу данных в группе](sql-database-security-overview.md).</span><span class="sxs-lookup"><span data-stu-id="be43a-148">Create encrypted credentials for job execution and [add the user (or role) to each database in the group](sql-database-security-overview.md).</span></span>
4. <span data-ttu-id="be43a-149">Создайте сложный сценарий T-SQL, который можно запускать для каждой базы данных в группе.</span><span class="sxs-lookup"><span data-stu-id="be43a-149">Create an idempotent T-SQL script that can be run against every database in the group.</span></span> 
5. <span data-ttu-id="be43a-150">Чтобы создать задания с помощью портала Azure, выполните действия, описанные в статье [Создание заданий обработки эластичных баз данных SQL и управление ими с помощью портала (предварительная версия)](sql-database-elastic-jobs-create-and-manage.md).</span><span class="sxs-lookup"><span data-stu-id="be43a-150">Follow these steps to create jobs using the Azure portal: [Creating and managing Elastic Database jobs](sql-database-elastic-jobs-create-and-manage.md).</span></span> 
6. <span data-ttu-id="be43a-151">Вы также можете воспользоваться сценариями PowerShell. См. статью [Создание заданий обработки эластичных баз данных для базы данных SQL и управление ими с помощью PowerShell (предварительная версия)](sql-database-elastic-jobs-powershell.md).</span><span class="sxs-lookup"><span data-stu-id="be43a-151">Or use PowerShell scripts: [Create and manage a SQL Database elastic database jobs using PowerShell (preview)](sql-database-elastic-jobs-powershell.md).</span></span>

## <a name="idempotent-scripts"></a><span data-ttu-id="be43a-152">Идемпотентные сценарии</span><span class="sxs-lookup"><span data-stu-id="be43a-152">Idempotent scripts</span></span>
<span data-ttu-id="be43a-153">Сценарии должны быть [идемпотентными](https://en.wikipedia.org/wiki/Idempotence).</span><span class="sxs-lookup"><span data-stu-id="be43a-153">The scripts must be [idempotent](https://en.wikipedia.org/wiki/Idempotence).</span></span> <span data-ttu-id="be43a-154">Проще говоря, «идемпотентный» означает, что, если сценарий выполнился успешно и запустился снова, его результат останется неизменным.</span><span class="sxs-lookup"><span data-stu-id="be43a-154">In simple terms, "idempotent" means that if the script succeeds, and it is run again, the same result occurs.</span></span> <span data-ttu-id="be43a-155">Сценарий может завершиться ошибкой из-за временных проблем в сети.</span><span class="sxs-lookup"><span data-stu-id="be43a-155">A script may fail due to transient network issues.</span></span> <span data-ttu-id="be43a-156">В этом случае задание будет автоматически пытаться выполнить сценарий указанное количество раз, после чего попытки будут прекращены.</span><span class="sxs-lookup"><span data-stu-id="be43a-156">In that case, the job will automatically retry running the script a preset number of times before desisting.</span></span> <span data-ttu-id="be43a-157">Идемпотентный сценарий дает неизменный результат даже после двух успешных запусков.</span><span class="sxs-lookup"><span data-stu-id="be43a-157">An idempotent script has the same result even if has been successfully run twice.</span></span> 

<span data-ttu-id="be43a-158">Прежде чем создавать объект, рекомендуется сначала проверить, не существует ли он уже.</span><span class="sxs-lookup"><span data-stu-id="be43a-158">A simple tactic is to test for the existence of an object before creating it.</span></span>  

    IF NOT EXIST (some_object)
    -- Create the object 
    -- If it exists, drop the object before recreating it.

<span data-ttu-id="be43a-159">Аналогичным образом сценарий должен успешно завершаться, выполняя логическую проверку на существование различных условий и их обработку.</span><span class="sxs-lookup"><span data-stu-id="be43a-159">Similarly, a script must be able to execute successfully by logically testing for and countering any conditions it finds.</span></span>

## <a name="failures-and-logs"></a><span data-ttu-id="be43a-160">Сбои и журналы</span><span class="sxs-lookup"><span data-stu-id="be43a-160">Failures and logs</span></span>
<span data-ttu-id="be43a-161">Если после нескольких попыток сценарий завершается сбоем, задание записывает в журнал ошибку и продолжает работу.</span><span class="sxs-lookup"><span data-stu-id="be43a-161">If a script fails after multiple attempts, the job logs the error and continues.</span></span> <span data-ttu-id="be43a-162">После завершения задания (т. е. после его выполнения во всех базах данных в группе) вы можете просмотреть список неудачных попыток.</span><span class="sxs-lookup"><span data-stu-id="be43a-162">After a job ends (meaning a run against all databases in the group), you can check its list of failed attempts.</span></span> <span data-ttu-id="be43a-163">Сведения в журналах можно использовать для отладки неисправных сценариев.</span><span class="sxs-lookup"><span data-stu-id="be43a-163">The logs provide details to debug faulty scripts.</span></span> 

## <a name="group-types-and-creation"></a><span data-ttu-id="be43a-164">Типы групп и их создание</span><span class="sxs-lookup"><span data-stu-id="be43a-164">Group types and creation</span></span>
<span data-ttu-id="be43a-165">Группы бывают двух типов:</span><span class="sxs-lookup"><span data-stu-id="be43a-165">There are two kinds of groups:</span></span> 

1. <span data-ttu-id="be43a-166">наборы сегментов;</span><span class="sxs-lookup"><span data-stu-id="be43a-166">Shard sets</span></span>
2. <span data-ttu-id="be43a-167">настраиваемые группы.</span><span class="sxs-lookup"><span data-stu-id="be43a-167">Custom groups</span></span>

<span data-ttu-id="be43a-168">Группы наборов сегментов создаются с помощью [инструментов для эластичных баз данных](sql-database-elastic-scale-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="be43a-168">Shard set groups are created using the [Elastic Database tools](sql-database-elastic-scale-introduction.md).</span></span> <span data-ttu-id="be43a-169">В таких группах базы данных добавляются и удаляются автоматически.</span><span class="sxs-lookup"><span data-stu-id="be43a-169">When you create a shard set group, databases are added or removed from the group automatically.</span></span> <span data-ttu-id="be43a-170">Например, при добавлении сегмента в карту сегментов он будет автоматически добавлен в группу.</span><span class="sxs-lookup"><span data-stu-id="be43a-170">For example, a new shard will be automatically in the group when you add it to the shard map.</span></span> <span data-ttu-id="be43a-171">Затем можно будет запустить задание для группы.</span><span class="sxs-lookup"><span data-stu-id="be43a-171">A job can then be run against the group.</span></span>

<span data-ttu-id="be43a-172">Настраиваемые группы определяются строго.</span><span class="sxs-lookup"><span data-stu-id="be43a-172">Custom groups, on the other hand, are rigidly defined.</span></span> <span data-ttu-id="be43a-173">В таких группах базы данных нужно добавлять и удалять явно.</span><span class="sxs-lookup"><span data-stu-id="be43a-173">You must explicitly add or remove databases from custom groups.</span></span> <span data-ttu-id="be43a-174">Если в группе удалить какую-то базу данных, задание попытается выполнить в ней сценарий, что в конечном итоге приведет к ошибке.</span><span class="sxs-lookup"><span data-stu-id="be43a-174">If a database in the group is dropped, the job will attempt to run the script against the database resulting in an eventual failure.</span></span> <span data-ttu-id="be43a-175">На портале Azure сейчас можно создавать только настраиваемые группы.</span><span class="sxs-lookup"><span data-stu-id="be43a-175">Groups created using the Azure portal currently are custom groups.</span></span> 

## <a name="components-and-pricing"></a><span data-ttu-id="be43a-176">Компоненты и цены</span><span class="sxs-lookup"><span data-stu-id="be43a-176">Components and pricing</span></span>
<span data-ttu-id="be43a-177">Ниже перечислены компоненты, которые вместе формируют облачную службу Azure, позволяющую в любой момент выполнять административные задания.</span><span class="sxs-lookup"><span data-stu-id="be43a-177">The following components work together to create an Azure Cloud service that enables ad-hoc execution of administrative jobs.</span></span> <span data-ttu-id="be43a-178">Во время установки компоненты устанавливаются и настраиваются автоматически в вашей подписке.</span><span class="sxs-lookup"><span data-stu-id="be43a-178">The components are installed and configured automatically during setup, in your subscription.</span></span> <span data-ttu-id="be43a-179">Эти службы можно легко идентифицировать — все они имеют одно и тоже автоматически сгенерированное уникальное имя,</span><span class="sxs-lookup"><span data-stu-id="be43a-179">You can identify the services as they all have the same auto-generated name.</span></span> <span data-ttu-id="be43a-180">которое состоит из префикса edj и 21 произвольного символа.</span><span class="sxs-lookup"><span data-stu-id="be43a-180">The name is unique, and consists of the prefix "edj" followed by 21 randomly generated characters.</span></span>

* <span data-ttu-id="be43a-181">**Облачная служба Azure.** Служба заданий эластичной базы данных (предварительная версия) поставляется как облачная служба Azure, размещаемая клиентом для выполнения требуемых задачи.</span><span class="sxs-lookup"><span data-stu-id="be43a-181">**Azure Cloud Service**: elastic database jobs (preview) is delivered as a customer-hosted Azure Cloud service to perform execution of the requested tasks.</span></span> <span data-ttu-id="be43a-182">На портале служба развертывается и размещается в вашей подписке Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="be43a-182">From the portal, the service is deployed and hosted in your Microsoft Azure subscription.</span></span> <span data-ttu-id="be43a-183">По умолчанию развернутая служба выполняется как минимум с двумя рабочими ролями, что обеспечивает высокую доступность службы.</span><span class="sxs-lookup"><span data-stu-id="be43a-183">The default deployed service runs with the minimum of two worker roles for high availability.</span></span> <span data-ttu-id="be43a-184">Каждая роль стандартного размера (ElasticDatabaseJobWorker) работает на экземпляре A0.</span><span class="sxs-lookup"><span data-stu-id="be43a-184">The default size of each worker role (ElasticDatabaseJobWorker) runs on an A0 instance.</span></span> <span data-ttu-id="be43a-185">Сведения о ценах на облачные службы см. [здесь](https://azure.microsoft.com/pricing/details/cloud-services/).</span><span class="sxs-lookup"><span data-stu-id="be43a-185">For pricing, see [Cloud services pricing](https://azure.microsoft.com/pricing/details/cloud-services/).</span></span> 
* <span data-ttu-id="be43a-186">**База данных SQL Azure.** Эта база данных также называется **управляющей базой данных**. Используется для хранения всех метаданных заданий.</span><span class="sxs-lookup"><span data-stu-id="be43a-186">**Azure SQL Database**: The service uses an Azure SQL Database known as the **control database** to store all of the job metadata.</span></span> <span data-ttu-id="be43a-187">По умолчанию используется уровень служб S0.</span><span class="sxs-lookup"><span data-stu-id="be43a-187">The default service tier is a S0.</span></span> <span data-ttu-id="be43a-188">Сведения о ценах на базы данных SQL см. [здесь](https://azure.microsoft.com/pricing/details/sql-database/).</span><span class="sxs-lookup"><span data-stu-id="be43a-188">For pricing, see [SQL Database Pricing](https://azure.microsoft.com/pricing/details/sql-database/).</span></span>
* <span data-ttu-id="be43a-189">**Служебная шина Azure.** Используется для координации работы в облачной службе Azure.</span><span class="sxs-lookup"><span data-stu-id="be43a-189">**Azure Service Bus**: An Azure Service Bus is for coordination of the work within the Azure Cloud Service.</span></span> <span data-ttu-id="be43a-190">Сведения о ценах на служебную шину см. [здесь](https://azure.microsoft.com/pricing/details/service-bus/).</span><span class="sxs-lookup"><span data-stu-id="be43a-190">See [Service Bus Pricing](https://azure.microsoft.com/pricing/details/service-bus/).</span></span>
* <span data-ttu-id="be43a-191">**Служба хранилища Azure.** Для хранения диагностических сведений используется учетная запись хранения Azure. Эти данные могут понадобиться в случае, если для решения проблемы потребуется дальнейшая отладка (см. статью [Включение системы диагностики в облачных службах Azure](../cloud-services/cloud-services-dotnet-diagnostics.md)).</span><span class="sxs-lookup"><span data-stu-id="be43a-191">**Azure Storage**: An Azure Storage account is used to store diagnostic output logging in the event that an issue requires further debugging (see [Enabling Diagnostics in Azure Cloud Services and Virtual Machines](../cloud-services/cloud-services-dotnet-diagnostics.md)).</span></span> <span data-ttu-id="be43a-192">Сведения о ценах на хранилище Azure см. [здесь](https://azure.microsoft.com/pricing/details/storage/).</span><span class="sxs-lookup"><span data-stu-id="be43a-192">For pricing, see [Azure Storage Pricing](https://azure.microsoft.com/pricing/details/storage/).</span></span>

## <a name="how-elastic-database-jobs-work"></a><span data-ttu-id="be43a-193">Как работают задания обработки эластичных баз данных</span><span class="sxs-lookup"><span data-stu-id="be43a-193">How Elastic Database jobs work</span></span>
1. <span data-ttu-id="be43a-194">Базе данных SQL Azure назначается **управляющая база данных** , в которой хранятся все метаданные и сведения о состоянии.</span><span class="sxs-lookup"><span data-stu-id="be43a-194">An Azure SQL Database is designated a **control database** which stores all meta-data and state data.</span></span>
2. <span data-ttu-id="be43a-195">**Служба заданий** обращается к управляющей базе данных для запуска и отслеживания выполняемых заданий.</span><span class="sxs-lookup"><span data-stu-id="be43a-195">The control database is accessed by the **job service** to launch and track jobs to execute.</span></span>
3. <span data-ttu-id="be43a-196">С управляющей базой данных связываются две роли:</span><span class="sxs-lookup"><span data-stu-id="be43a-196">Two different roles communicate with the control database:</span></span> 
   * <span data-ttu-id="be43a-197">Контроллер: определяет, каким заданиям для выполнения требуются задачи, и повторно запускает невыполненные задания, создавая новые задачи.</span><span class="sxs-lookup"><span data-stu-id="be43a-197">Controller: Determines which jobs require tasks to perform the requested job, and retries failed jobs by creating new job tasks.</span></span>
   * <span data-ttu-id="be43a-198">Выполнение задач: выполняет задачи.</span><span class="sxs-lookup"><span data-stu-id="be43a-198">Job Task Execution: Carries out the job tasks.</span></span>

### <a name="job-task-types"></a><span data-ttu-id="be43a-199">Типы задач</span><span class="sxs-lookup"><span data-stu-id="be43a-199">Job task types</span></span>
<span data-ttu-id="be43a-200">Существует несколько типов задач, которые выполняют задания:</span><span class="sxs-lookup"><span data-stu-id="be43a-200">There are multiple types of job tasks that carry out execution of jobs:</span></span>

* <span data-ttu-id="be43a-201">ShardMapRefresh: отправляет карте сегментов запрос, чтобы определить все базы данных, используемые как сегменты</span><span class="sxs-lookup"><span data-stu-id="be43a-201">ShardMapRefresh: Queries the shard map to determine all the databases used as shards</span></span>
* <span data-ttu-id="be43a-202">ScriptSplit: разбивает сценарий на группы между инструкциями GO</span><span class="sxs-lookup"><span data-stu-id="be43a-202">ScriptSplit: Splits the script across ‘GO’ statements into batches</span></span>
* <span data-ttu-id="be43a-203">ExpandJob: создает дочерние задачи для каждой базы данных из задачи, которая направлена на группу баз данных</span><span class="sxs-lookup"><span data-stu-id="be43a-203">ExpandJob: Creates child jobs for each database from a job that targets a group of databases</span></span>
* <span data-ttu-id="be43a-204">ScriptExecution: выполняет сценарий для определенной базы данных с использованием заданных учетных данных</span><span class="sxs-lookup"><span data-stu-id="be43a-204">ScriptExecution: Executes a script against a particular database using defined credentials</span></span>
* <span data-ttu-id="be43a-205">Dacpac: применяет DACPAC к определенной базе данных с использованием определенных учетных данных</span><span class="sxs-lookup"><span data-stu-id="be43a-205">Dacpac: Applies a DACPAC to a particular database using particular credentials</span></span>

## <a name="end-to-end-job-execution-work-flow"></a><span data-ttu-id="be43a-206">Полный рабочий процесс выполнения заданий</span><span class="sxs-lookup"><span data-stu-id="be43a-206">End-to-end job execution work-flow</span></span>
1. <span data-ttu-id="be43a-207">С помощью портала или API PowerShell задание добавляется в **управляющую базу данных**.</span><span class="sxs-lookup"><span data-stu-id="be43a-207">Using either the Portal or the PowerShell API, a job is inserted into the  **control database**.</span></span> <span data-ttu-id="be43a-208">Задание требует выполнения сценарий Transact-SQL для группы баз данных с использованием определенных учетных данных.</span><span class="sxs-lookup"><span data-stu-id="be43a-208">The job requests execution of a Transact-SQL script against a group of databases using specific credentials.</span></span>
2. <span data-ttu-id="be43a-209">Контроллер определяет новое задание.</span><span class="sxs-lookup"><span data-stu-id="be43a-209">The controller identifies the new job.</span></span> <span data-ttu-id="be43a-210">Создаются и выполняются задачи для разделения сценария и обновления баз данных группы.</span><span class="sxs-lookup"><span data-stu-id="be43a-210">Job tasks are created and executed to split the script and to refresh the group’s databases.</span></span> <span data-ttu-id="be43a-211">Напоследок создается и выполняется новое задание для расширения задания и создания дочерних заданий, каждое из которых выполняет сценарий Transact-SQL для отдельной базы данных в группе.</span><span class="sxs-lookup"><span data-stu-id="be43a-211">Lastly, a new job is created and executed to expand the job and create new child jobs where each child job is specified to execute the Transact-SQL script against an individual database in the group.</span></span>
3. <span data-ttu-id="be43a-212">Контроллер определяет созданные дочерние задания.</span><span class="sxs-lookup"><span data-stu-id="be43a-212">The controller identifies the created child jobs.</span></span> <span data-ttu-id="be43a-213">Для каждого задания контроллер создает и запускает задачу для выполнения сценария в базе данных.</span><span class="sxs-lookup"><span data-stu-id="be43a-213">For each job, the controller creates and triggers a job task to execute the script against a database.</span></span> 
4. <span data-ttu-id="be43a-214">После завершения задач контроллер задает состояние завершения заданий.</span><span class="sxs-lookup"><span data-stu-id="be43a-214">After all job tasks have completed, the controller updates the jobs to a completed state.</span></span> 
   <span data-ttu-id="be43a-215">Во время выполнения задания в любой момент можно использовать API PowerShell для просмотра текущего состояния его выполнения.</span><span class="sxs-lookup"><span data-stu-id="be43a-215">At any point during job execution, the PowerShell API can be used to view the current state of job execution.</span></span> <span data-ttu-id="be43a-216">Время, возвращаемое API-интерфейсами PowerShell, представлено в формате UTC.</span><span class="sxs-lookup"><span data-stu-id="be43a-216">All times returned by the PowerShell APIs are represented in UTC.</span></span> <span data-ttu-id="be43a-217">При желании можно отправить запрос на отмену, чтобы остановить задание.</span><span class="sxs-lookup"><span data-stu-id="be43a-217">If desired, a cancellation request can be initiated to stop a job.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="be43a-218">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="be43a-218">Next steps</span></span>
<span data-ttu-id="be43a-219">[Установите компоненты](sql-database-elastic-jobs-service-installation.md), а затем [создайте и добавьте учетные данные для входа в каждую базу данных в группе](sql-database-manage-logins.md).</span><span class="sxs-lookup"><span data-stu-id="be43a-219">[Install the components](sql-database-elastic-jobs-service-installation.md), then [create and add a log in to each database in the group of databases](sql-database-manage-logins.md).</span></span> <span data-ttu-id="be43a-220">Дополнительные сведения о создании заданий и управлении ими с помощью заданий обработки эластичных БД см. в [этой статье](sql-database-elastic-jobs-create-and-manage.md).</span><span class="sxs-lookup"><span data-stu-id="be43a-220">To further understand job creation and management, see [creating and managing elastic database jobs](sql-database-elastic-jobs-create-and-manage.md).</span></span> <span data-ttu-id="be43a-221">См. также статью [Начало работы с заданиями обработки эластичных баз данных](sql-database-elastic-jobs-getting-started.md).</span><span class="sxs-lookup"><span data-stu-id="be43a-221">See also [Getting started with Elastic Database jobs](sql-database-elastic-jobs-getting-started.md).</span></span>

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Image references-->
[1]: ./media/sql-database-elastic-jobs-overview/elastic-jobs.png
<!--anchors-->


