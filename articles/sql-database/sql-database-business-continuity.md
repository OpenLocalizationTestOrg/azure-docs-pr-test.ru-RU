---
title: "непрерывность бизнеса aaaCloud — при восстановлении базы данных — база данных SQL | Документы Microsoft"
description: "Узнайте, как базы данных SQL Azure поддерживают непрерывное выполнение облачных бизнес-процессов и восстановление баз данных, а также помогают обеспечить выполнение важных облачных приложений."
keywords: "непрерывность бизнес-процессов, непрерывность облачных бизнес-процессов, аварийное восстановление базы данных, восстановление базы данных"
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: 
ms.assetid: 18e5d3f1-bfe5-4089-b6fd-76988ab29822
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 05/15/2017
ms.author: sashan
ms.openlocfilehash: c9a6ff86fbbc04ce839a4fca79594b573b71644c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="overview-of-business-continuity-with-azure-sql-database"></a><span data-ttu-id="a9317-104">Обзор обеспечения непрерывности бизнес-процессов с помощью базы данных SQL Azure</span><span class="sxs-lookup"><span data-stu-id="a9317-104">Overview of business continuity with Azure SQL Database</span></span>

<span data-ttu-id="a9317-105">В этом обзоре описываются возможности hello, предоставляемые для непрерывности и аварийного восстановления базы данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="a9317-105">This overview describes hello capabilities that Azure SQL Database provides for business continuity and disaster recovery.</span></span> <span data-ttu-id="a9317-106">Дополнительные сведения о возможностях, рекомендации и руководства по восстановлению после аварийного события, которые могут привести к потере данных или привести к вашей базы данных и приложения toobecome недоступна.</span><span class="sxs-lookup"><span data-stu-id="a9317-106">Learn about options, recommendations, and tutorials for recovering from disruptive events that could cause data loss or cause your database and application toobecome unavailable.</span></span> <span data-ttu-id="a9317-107">Какие toodo сведения, если ошибка пользователя или приложения влияет на целостность данных, региона Azure имеет сбоя или приложение требует обслуживания.</span><span class="sxs-lookup"><span data-stu-id="a9317-107">Learn what toodo when a user or application error affects data integrity, an Azure region has an outage, or your application requires maintenance.</span></span>

## <a name="sql-database-features-that-you-can-use-tooprovide-business-continuity"></a><span data-ttu-id="a9317-108">Функции базы данных SQL, которые можно использовать tooprovide непрерывность бизнеса</span><span class="sxs-lookup"><span data-stu-id="a9317-108">SQL Database features that you can use tooprovide business continuity</span></span>

<span data-ttu-id="a9317-109">База данных SQL предоставляет несколько функций обеспечения непрерывности бизнес-процессов, включая автоматизированную архивацию и необязательную репликацию баз данных.</span><span class="sxs-lookup"><span data-stu-id="a9317-109">SQL Database provides several business continuity features, including automated backups and optional database replication.</span></span> <span data-ttu-id="a9317-110">У каждой из них разные параметры оценки времени восстановления (ERT) и возможной потери данных последних транзакций.</span><span class="sxs-lookup"><span data-stu-id="a9317-110">Each has different characteristics for estimated recovery time (ERT) and potential data loss for recent transactions.</span></span> <span data-ttu-id="a9317-111">Поняв, на что влияют эти параметры, вы сможете выбрать те, которые вам подходят, и, в большинстве случаев, использовать их вместе в различных сценариях.</span><span class="sxs-lookup"><span data-stu-id="a9317-111">Once you understand these options, you can choose among them - and, in most scenarios, use them together for different scenarios.</span></span> <span data-ttu-id="a9317-112">При разработке плана обеспечения непрерывности бизнес-процессов, вам необходимо toounderstand hello максимально допустимого времени перед приложения hello полностью восстанавливается после аварийного события hello — это на время восстановления (RTO).</span><span class="sxs-lookup"><span data-stu-id="a9317-112">As you develop your business continuity plan, you need toounderstand hello maximum acceptable time before hello application fully recovers after hello disruptive event - this is your recovery time objective (RTO).</span></span> <span data-ttu-id="a9317-113">Необходимо также toounderstand hello максимальный объем последние приложения hello обновлений (интервал времени) данные можно переносить без утраты при восстановлении после аварийного события hello — это ваш точка восстановления (RPO).</span><span class="sxs-lookup"><span data-stu-id="a9317-113">You also need toounderstand hello maximum amount of recent data updates (time interval) hello application can tolerate losing when recovering after hello disruptive event - this is your recovery point objective (RPO).</span></span>

<span data-ttu-id="a9317-114">Следующая таблица сравнивает Hello hello ERT и RPO для hello три наиболее распространенных сценариев.</span><span class="sxs-lookup"><span data-stu-id="a9317-114">hello following table compares hello ERT and RPO for hello three most common scenarios.</span></span>

| <span data-ttu-id="a9317-115">Функция</span><span class="sxs-lookup"><span data-stu-id="a9317-115">Capability</span></span> | <span data-ttu-id="a9317-116">Уровень Basic</span><span class="sxs-lookup"><span data-stu-id="a9317-116">Basic tier</span></span> | <span data-ttu-id="a9317-117">Уровень Standard</span><span class="sxs-lookup"><span data-stu-id="a9317-117">Standard tier</span></span> | <span data-ttu-id="a9317-118">Уровень Premium</span><span class="sxs-lookup"><span data-stu-id="a9317-118">Premium tier</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="a9317-119">Восстановление до точки во времени из резервной копии</span><span class="sxs-lookup"><span data-stu-id="a9317-119">Point in Time Restore from backup</span></span> |<span data-ttu-id="a9317-120">Все точки восстановления в течение 7 дней</span><span class="sxs-lookup"><span data-stu-id="a9317-120">Any restore point within 7 days</span></span> |<span data-ttu-id="a9317-121">Все точки восстановления в течение 35 дней</span><span class="sxs-lookup"><span data-stu-id="a9317-121">Any restore point within 35 days</span></span> |<span data-ttu-id="a9317-122">Все точки восстановления в течение 35 дней</span><span class="sxs-lookup"><span data-stu-id="a9317-122">Any restore point within 35 days</span></span> |
| <span data-ttu-id="a9317-123">Геовосстановление из геореплицированных резервных копий</span><span class="sxs-lookup"><span data-stu-id="a9317-123">Geo-restore from geo-replicated backups</span></span> |<span data-ttu-id="a9317-124">ERT < 12 ч, RPO < 1 ч</span><span class="sxs-lookup"><span data-stu-id="a9317-124">ERT < 12h, RPO < 1h</span></span> |<span data-ttu-id="a9317-125">ERT < 12 ч, RPO < 1 ч</span><span class="sxs-lookup"><span data-stu-id="a9317-125">ERT < 12h, RPO < 1h</span></span> |<span data-ttu-id="a9317-126">ERT < 12 ч, RPO < 1 ч</span><span class="sxs-lookup"><span data-stu-id="a9317-126">ERT < 12h, RPO < 1h</span></span> |
| <span data-ttu-id="a9317-127">Восстановление из хранилища службы архивации Azure</span><span class="sxs-lookup"><span data-stu-id="a9317-127">Restore from Azure Backup Vault</span></span> |<span data-ttu-id="a9317-128">ERT < 12 ч, RPO < 1 нед.</span><span class="sxs-lookup"><span data-stu-id="a9317-128">ERT < 12h, RPO < 1 wk</span></span> |<span data-ttu-id="a9317-129">ERT < 12 ч, RPO < 1 нед.</span><span class="sxs-lookup"><span data-stu-id="a9317-129">ERT < 12h, RPO < 1 wk</span></span> |<span data-ttu-id="a9317-130">ERT < 12 ч, RPO < 1 нед.</span><span class="sxs-lookup"><span data-stu-id="a9317-130">ERT < 12h, RPO < 1 wk</span></span> |
| <span data-ttu-id="a9317-131">Активная георепликация</span><span class="sxs-lookup"><span data-stu-id="a9317-131">Active geo-replication</span></span> |<span data-ttu-id="a9317-132">ERT < 30 с, RPO < 5 с</span><span class="sxs-lookup"><span data-stu-id="a9317-132">ERT < 30s, RPO < 5s</span></span> |<span data-ttu-id="a9317-133">ERT < 30 с, RPO < 5 с</span><span class="sxs-lookup"><span data-stu-id="a9317-133">ERT < 30s, RPO < 5s</span></span> |<span data-ttu-id="a9317-134">ERT < 30 с, RPO < 5 с</span><span class="sxs-lookup"><span data-stu-id="a9317-134">ERT < 30s, RPO < 5s</span></span> |

### <a name="use-database-backups-toorecover-a-database"></a><span data-ttu-id="a9317-135">Используйте резервные копии базы данных toorecover базы данных</span><span class="sxs-lookup"><span data-stu-id="a9317-135">Use database backups toorecover a database</span></span>

<span data-ttu-id="a9317-136">База данных SQL автоматически выполняет сочетание полные резервные копии раз в неделю, разностные резервные копии каждый час и журнала транзакций резервное копирование каждые пять — через десять минут tooprotect бизнеса от потери данных.</span><span class="sxs-lookup"><span data-stu-id="a9317-136">SQL Database automatically performs a combination of full database backups weekly, differential database backups hourly, and transaction log backups every five - ten minutes tooprotect your business from data loss.</span></span> <span data-ttu-id="a9317-137">Эти резервные копии хранятся в географически избыточное хранилище для 35 дней для баз данных в уровней служб Standard и Premium hello и 7 дней для баз данных в уровень обслуживания Basic hello.</span><span class="sxs-lookup"><span data-stu-id="a9317-137">These backups are stored in geo-redundant storage for 35 days for databases in hello Standard and Premium service tiers and 7 days for databases in hello Basic service tier.</span></span> <span data-ttu-id="a9317-138">Чтобы узнать больше, ознакомьтесь со сведениями об [уровнях служб](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="a9317-138">For more information, see [service tiers](sql-database-service-tiers.md).</span></span> <span data-ttu-id="a9317-139">Если hello срок хранения для службы на уровне не соответствует требованиям организации, можно увеличить срок хранения hello, [изменение уровня служб hello](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="a9317-139">If hello retention period for your service tier does not meet your business requirements, you can increase hello retention period by [changing hello service tier](sql-database-service-tiers.md).</span></span> <span data-ttu-id="a9317-140">Hello полной и разностной резервной копии, также реплицированных tooa [парной ЦОД](../best-practices-availability-paired-regions.md) для защиты от сбоя центра обработки данных.</span><span class="sxs-lookup"><span data-stu-id="a9317-140">hello full and differential database backups are also replicated tooa [paired data center](../best-practices-availability-paired-regions.md) for protection against a data center outage.</span></span> <span data-ttu-id="a9317-141">Дополнительные сведения см. в статье [Подробнее о резервном копировании базы данных SQL](sql-database-automated-backups.md).</span><span class="sxs-lookup"><span data-stu-id="a9317-141">For more information, see [automatic database backups](sql-database-automated-backups.md).</span></span>

<span data-ttu-id="a9317-142">Если встроенные срок hello не достаточно для вашего приложения, его можно расширить, настроив политику долгосрочного хранения базы данных.</span><span class="sxs-lookup"><span data-stu-id="a9317-142">If hello built-in retention period is not sufficient for your application, you can extend it by configuring a database long-term retention policy.</span></span> <span data-ttu-id="a9317-143">Дополнительные сведения см. в статье [Хранение резервных копий базы данных SQL Azure до 10 лет](sql-database-long-term-retention.md).</span><span class="sxs-lookup"><span data-stu-id="a9317-143">For more information, see [long-term retention](sql-database-long-term-retention.md).</span></span>

<span data-ttu-id="a9317-144">Можно использовать toorecover резервные копии этих баз данных автоматически базы данных из различных событий нарушают работу, как внутри вашего центра обработки данных и tooanother data center.</span><span class="sxs-lookup"><span data-stu-id="a9317-144">You can use these automatic database backups toorecover a database from various disruptive events, both within your data center and tooanother data center.</span></span> <span data-ttu-id="a9317-145">Использование резервных копий баз данных автоматически, hello предполагаемое время восстановления определяется несколькими факторами, включая общее число баз данных, восстановление hello же hello области в hello же времени, hello размер базы данных, размера журнала транзакций hello и пропускной способности сети.</span><span class="sxs-lookup"><span data-stu-id="a9317-145">Using automatic database backups, hello estimated time of recovery depends on several factors including hello total number of databases recovering in hello same region at hello same time, hello database size, hello transaction log size, and network bandwidth.</span></span> <span data-ttu-id="a9317-146">время восстановления Hello обычно является менее чем на 12 часов.</span><span class="sxs-lookup"><span data-stu-id="a9317-146">hello recovery time is usually less than 12 hours.</span></span> <span data-ttu-id="a9317-147">При восстановлении tooanother области данных, hello потеря данных — ограниченный too1 час по hello географически избыточное хранилище с почасовой разностные резервные копии.</span><span class="sxs-lookup"><span data-stu-id="a9317-147">When recovering tooanother data region, hello potential data loss is limited too1 hour by hello geo-redundant storage of hourly differential database backups.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a9317-148">с помощью toorecover автоматическое резервное копирование, должен быть членом роли участника SQL Server hello или hello владельца подписки — см. [RBAC: встроенные роли](../active-directory/role-based-access-built-in-roles.md).</span><span class="sxs-lookup"><span data-stu-id="a9317-148">toorecover using automated backups, you must be a member of hello SQL Server Contributor role or hello subscription owner - see [RBAC: Built-in roles](../active-directory/role-based-access-built-in-roles.md).</span></span> <span data-ttu-id="a9317-149">Можно восстановить с помощью hello портал Azure, PowerShell или API-интерфейса REST hello.</span><span class="sxs-lookup"><span data-stu-id="a9317-149">You can recover using hello Azure portal, PowerShell, or hello REST API.</span></span> <span data-ttu-id="a9317-150">Использовать для этого Transact-SQL невозможно.</span><span class="sxs-lookup"><span data-stu-id="a9317-150">You cannot use Transact-SQL.</span></span>
>

<span data-ttu-id="a9317-151">Используйте автоматически создаваемые резервные копии для обеспечения непрерывности бизнес-процессов и восстановления, если ваше приложение:</span><span class="sxs-lookup"><span data-stu-id="a9317-151">Use automated backups as your business continuity and recovery mechanism if your application:</span></span>

* <span data-ttu-id="a9317-152">не является критически важным;</span><span class="sxs-lookup"><span data-stu-id="a9317-152">Is not considered mission critical.</span></span>
* <span data-ttu-id="a9317-153">на него не распространяется действие соглашений об уровне обслуживания, то есть перерыв в работе на 24 часа и более не повлечет финансовой ответственности;</span><span class="sxs-lookup"><span data-stu-id="a9317-153">Doesn't have a binding SLA - a downtime of 24 hours or longer does not result in financial liability.</span></span>
* <span data-ttu-id="a9317-154">Низкая скорость изменения данных (низкий транзакций в час) и потери копии tooan часы изменения — допустимая потеря данных.</span><span class="sxs-lookup"><span data-stu-id="a9317-154">Has a low rate of data change (low transactions per hour) and losing up tooan hour of change is an acceptable data loss.</span></span>
* <span data-ttu-id="a9317-155">имеет ограниченный бюджет.</span><span class="sxs-lookup"><span data-stu-id="a9317-155">Is cost sensitive.</span></span>

<span data-ttu-id="a9317-156">Если вам требуется более быстрое восстановление, используйте [активную георепликацию](sql-database-geo-replication-overview.md) (рассматривается далее).</span><span class="sxs-lookup"><span data-stu-id="a9317-156">If you need faster recovery, use [active geo-replication](sql-database-geo-replication-overview.md) (discussed next).</span></span> <span data-ttu-id="a9317-157">Данные могут toorecover toobe из более ранней, чем 35 дней периода, используйте [долгосрочного хранения резервной копии](sql-database-long-term-retention.md).</span><span class="sxs-lookup"><span data-stu-id="a9317-157">If you need toobe able toorecover data from a period older than 35 days, use [long-term backup retention](sql-database-long-term-retention.md).</span></span> 

### <a name="use-active-geo-replication-and-auto-failover-groups-in-preview-tooreduce-recovery-time-and-limit-data-loss-associated-with-a-recovery"></a><span data-ttu-id="a9317-158">Использование активной георепликации и автоматического перехода на другой ресурс групп (в-Предварительная версия) tooreduce восстановления времени и ограничение потерю данных во время операции восстановления</span><span class="sxs-lookup"><span data-stu-id="a9317-158">Use active geo-replication and auto-failover groups (in-preview) tooreduce recovery time and limit data loss associated with a recovery</span></span>

<span data-ttu-id="a9317-159">В дополнение к этому toousing резервные копии баз данных для базы данных восстановления в случае прерывания бизнеса, можно использовать [активной георепликации](sql-database-geo-replication-overview.md) tooconfigure toohave базы данных копирование toofour для чтения базы данных-получатели в регионах hello из вашей Выбор.</span><span class="sxs-lookup"><span data-stu-id="a9317-159">In addition toousing database backups for database recovery if a business disruption occurs, you can use [active geo-replication](sql-database-geo-replication-overview.md) tooconfigure a database toohave up toofour readable secondary databases in hello regions of your choice.</span></span> <span data-ttu-id="a9317-160">Эти базы данных-получатели синхронизируется с hello базы данных-источника с помощью асинхронной репликации.</span><span class="sxs-lookup"><span data-stu-id="a9317-160">These secondary databases are kept synchronized with hello primary database using an asynchronous replication mechanism.</span></span> <span data-ttu-id="a9317-161">Этот компонент является используется tooprotect к прерыванию бизнеса в случае сбоя центра обработки данных или во время обновления приложения.</span><span class="sxs-lookup"><span data-stu-id="a9317-161">This feature is used tooprotect against business disruption if a data center outage occurs or during an application upgrade.</span></span> <span data-ttu-id="a9317-162">Активная георепликация также можно повысить производительность запросов используется tooprovide для пользователей toogeographically распределенные запросы только для чтения.</span><span class="sxs-lookup"><span data-stu-id="a9317-162">Active geo-replication can also be used tooprovide better query performance for read-only queries toogeographically dispersed users.</span></span>

<span data-ttu-id="a9317-163">Автоматическое tooenable и прозрачной отработки отказа, следует разделить географической репликации баз данных в группы с помощью hello [автоматического перехода на другой ресурс группы](sql-database-geo-replication-overview.md) функции базы данных SQL (в предварительного просмотра).</span><span class="sxs-lookup"><span data-stu-id="a9317-163">tooenable automated and transparent failover you should organize your geo-replicated databases into groups using hello [auto-failover group](sql-database-geo-replication-overview.md) feature of SQL Database (in-preview).</span></span>

<span data-ttu-id="a9317-164">Если база данных-источник hello неожиданном или требуется tootake его в автономный режим для действий по обслуживанию, можно быстро повысить уровень основного получателя toobecome hello (также называемые отработки отказа) и настроить первичный toohello повышается tooconnect приложений.</span><span class="sxs-lookup"><span data-stu-id="a9317-164">If hello primary database goes offline unexpectedly or you need tootake it offline for maintenance activities, you can quickly promote a secondary toobecome hello primary (also called a failover) and configure applications tooconnect toohello promoted primary.</span></span> <span data-ttu-id="a9317-165">Если приложение подключается toohello баз данных, с помощью прослушивателя группы hello отработки отказа, не требуется настройка строк подключения SQL hello toochange после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="a9317-165">If your application is connecting toohello databases using hello failover group listener, you don’t need toochange hello SQL connection string configuration after failover.</span></span> <span data-ttu-id="a9317-166">При плановой отработке отказа потеря данных отсутствует.</span><span class="sxs-lookup"><span data-stu-id="a9317-166">With a planned failover, there is no data loss.</span></span> <span data-ttu-id="a9317-167">С незапланированной отработки отказа могут возникнуть некоторые небольшой объем потери данных для операций с самую последнюю из-за характера toohello асинхронной репликации.</span><span class="sxs-lookup"><span data-stu-id="a9317-167">With an unplanned failover, there may be some small amount of data loss for very recent transactions due toohello nature of asynchronous replication.</span></span> <span data-ttu-id="a9317-168">Использование групп для автоматического перехода на другой ресурс (в предварительного просмотра), вы можете настроить hello отработки отказа политики toominimize hello возможной потери данных.</span><span class="sxs-lookup"><span data-stu-id="a9317-168">Using auto-failover groups (in-preview), you can customize hello failover policy toominimize hello potential data loss.</span></span> <span data-ttu-id="a9317-169">После отработки отказа можно выполнить восстановление размещения более поздней версии — соответствующим tooa плана или когда центра обработки данных hello в оперативный.</span><span class="sxs-lookup"><span data-stu-id="a9317-169">After a failover, you can later failback - either according tooa plan or when hello data center comes back online.</span></span> <span data-ttu-id="a9317-170">Во всех случаях пользователей короткое время простоя и требуется tooreconnect.</span><span class="sxs-lookup"><span data-stu-id="a9317-170">In all cases, users experience a small amount of downtime and need tooreconnect.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a9317-171">toouse активной георепликации и автоматического перехода на другой ресурс группы (в предварительного просмотра), должен либо быть hello владельца подписки или иметь разрешения системного администратора SQL Server.</span><span class="sxs-lookup"><span data-stu-id="a9317-171">toouse active geo-replication and auto-failover groups (in-preview), you must either be hello subscription owner or have administrative permissions in SQL Server.</span></span> <span data-ttu-id="a9317-172">Можно настроить и отработки отказа с помощью hello портал Azure PowerShell или hello API REST с помощью разрешений подписки Azure или с помощью Transact-SQL с разрешениями SQL Server.</span><span class="sxs-lookup"><span data-stu-id="a9317-172">You can configure and fail over using hello Azure portal, PowerShell, or hello REST API using Azure subscription permissions or using Transact-SQL with SQL Server permissions.</span></span>
> 

<span data-ttu-id="a9317-173">Используйте активную георепликацию и группы автоматической отработки отказа (в предварительной версии), если ваше приложение удовлетворяет какому-либо из следующих требований:</span><span class="sxs-lookup"><span data-stu-id="a9317-173">Use active geo-replication and auto-failover groups (in preview) if your application meets any of these criteria:</span></span>

* <span data-ttu-id="a9317-174">оно является критически важным;</span><span class="sxs-lookup"><span data-stu-id="a9317-174">Is mission critical.</span></span>
* <span data-ttu-id="a9317-175">регулируется соглашением об уровне обслуживания (SLA), которое не допускает более 24 часов простоя;</span><span class="sxs-lookup"><span data-stu-id="a9317-175">Has a service level agreement (SLA) that does not allow for 24 hours or more of downtime.</span></span>
* <span data-ttu-id="a9317-176">его простой может повлечь финансовую ответственность;</span><span class="sxs-lookup"><span data-stu-id="a9317-176">Downtime may result in financial liability.</span></span>
* <span data-ttu-id="a9317-177">имеет высокую частоту изменения данных, и потеря данных за час не допускается;</span><span class="sxs-lookup"><span data-stu-id="a9317-177">Has a high rate of data change is high and losing an hour of data is not acceptable.</span></span>
* <span data-ttu-id="a9317-178">Дополнительные затраты Hello активной георепликации меньше, чем hello потенциальных финансовых ответственности и связанные потери бизнес.</span><span class="sxs-lookup"><span data-stu-id="a9317-178">hello additional cost of active geo-replication is lower than hello potential financial liability and associated loss of business.</span></span>

>
> [!VIDEO https://channel9.msdn.com/Blogs/Azure/Azure-SQL-Database-protecting-important-DBs-from-regional-disasters-is-easy/player]
>

## <a name="recover-a-database-after-a-user-or-application-error"></a><span data-ttu-id="a9317-179">Восстановление базы данных после ошибки пользователя или приложения</span><span class="sxs-lookup"><span data-stu-id="a9317-179">Recover a database after a user or application error</span></span>
<span data-ttu-id="a9317-180">*Никто не совершенен!</span><span class="sxs-lookup"><span data-stu-id="a9317-180">*No one is perfect!</span></span> <span data-ttu-id="a9317-181">Пользователь может случайно удалить данные, важную таблицу или даже всю базу данных.</span><span class="sxs-lookup"><span data-stu-id="a9317-181">A user might accidentally delete some data, inadvertently drop an important table, or even drop an entire database.</span></span> <span data-ttu-id="a9317-182">Или приложения может случайно перезаписан хорошие данные с недопустимых данных из-за ошибку tooan приложения.</span><span class="sxs-lookup"><span data-stu-id="a9317-182">Or, an application might accidentally overwrite good data with bad data due tooan application defect.</span></span>

<span data-ttu-id="a9317-183">Ниже приведены возможные варианты восстановления в данном случае.</span><span class="sxs-lookup"><span data-stu-id="a9317-183">In this scenario, these are your recovery options.</span></span>

### <a name="perform-a-point-in-time-restore"></a><span data-ttu-id="a9317-184">Восстановление до точки во времени</span><span class="sxs-lookup"><span data-stu-id="a9317-184">Perform a point-in-time restore</span></span>
<span data-ttu-id="a9317-185">Hello автоматических резервных копий toorecover копию вашей базы данных, tooa известная хорошая точка в времени, можно использовать при условии, что время находится в пределах срока хранения hello базы данных.</span><span class="sxs-lookup"><span data-stu-id="a9317-185">You can use hello automated backups toorecover a copy of your database tooa known good point in time, provided that time is within hello database retention period.</span></span> <span data-ttu-id="a9317-186">После восстановления базы данных hello можно заменить hello исходная база данных восстановлена hello базой данных или скопировать hello необходимые данные из hello восстановления данных в исходной базе данных hello.</span><span class="sxs-lookup"><span data-stu-id="a9317-186">After hello database is restored, you can either replace hello original database with hello restored database or copy hello needed data from hello restored data into hello original database.</span></span> <span data-ttu-id="a9317-187">Если hello база данных использует активную георепликацию, мы рекомендуем копирование hello необходимых данных из копии восстановить hello в исходной базе данных hello.</span><span class="sxs-lookup"><span data-stu-id="a9317-187">If hello database uses active geo-replication, we recommend copying hello required data from hello restored copy into hello original database.</span></span> <span data-ttu-id="a9317-188">При замене hello исходной базы данных с базой данных восстановления hello, требуется tooreconfigure и повторная синхронизация активной георепликации, (что может занять некоторое время, для больших баз данных).</span><span class="sxs-lookup"><span data-stu-id="a9317-188">If you replace hello original database with hello restored database, you need tooreconfigure and resynchronize active geo-replication (which can take quite some time for a large database).</span></span>

<span data-ttu-id="a9317-189">Дополнительные сведения и подробные инструкции по восстановлению базы данных tooa на момент времени с помощью hello портал Azure или с помощью PowerShell, см. раздел [восстановления на момент](sql-database-recovery-using-backups.md#point-in-time-restore).</span><span class="sxs-lookup"><span data-stu-id="a9317-189">For more information and for detailed steps for restoring a database tooa point in time using hello Azure portal or using PowerShell, see [point-in-time restore](sql-database-recovery-using-backups.md#point-in-time-restore).</span></span> <span data-ttu-id="a9317-190">Для восстановления невозможно использовать Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="a9317-190">You cannot recover using Transact-SQL.</span></span>

### <a name="restore-a-deleted-database"></a><span data-ttu-id="a9317-191">Восстановление удаленной базы данных.</span><span class="sxs-lookup"><span data-stu-id="a9317-191">Restore a deleted database</span></span>
<span data-ttu-id="a9317-192">Если hello база данных будет удалена, но hello логический сервер не был удален, вы сможете восстановить точки toohello базы данных hello удалены, в которой он был удален.</span><span class="sxs-lookup"><span data-stu-id="a9317-192">If hello database is deleted but hello logical server has not been deleted, you can restore hello deleted database toohello point at which it was deleted.</span></span> <span data-ttu-id="a9317-193">Это восстанавливает toohello резервного копирования базы данных одном логическом сервере SQL, из которого он был удален.</span><span class="sxs-lookup"><span data-stu-id="a9317-193">This restores a database backup toohello same logical SQL server from which it was deleted.</span></span> <span data-ttu-id="a9317-194">Можно восстановить его с помощью hello исходное имя или укажите новое имя или hello восстановления базы данных.</span><span class="sxs-lookup"><span data-stu-id="a9317-194">You can restore it using hello original name or provide a new name or hello restored database.</span></span>

<span data-ttu-id="a9317-195">Дополнительные сведения и подробные шаги для восстановления удаленной базы данных с помощью hello портала Azure или с помощью PowerShell, см. [Восстановление удаленной базы данных](sql-database-recovery-using-backups.md#deleted-database-restore).</span><span class="sxs-lookup"><span data-stu-id="a9317-195">For more information and for detailed steps for restoring a deleted database using hello Azure portal or using PowerShell, see [restore a deleted database](sql-database-recovery-using-backups.md#deleted-database-restore).</span></span> <span data-ttu-id="a9317-196">Для восстановления невозможно использовать Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="a9317-196">You cannot restore using Transact-SQL.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a9317-197">Если удаляется hello логического сервера, невозможно восстановить удаленную базу данных.</span><span class="sxs-lookup"><span data-stu-id="a9317-197">If hello logical server is deleted, you cannot recover a deleted database.</span></span>
>
>

### <a name="restore-from-azure-backup-vault"></a><span data-ttu-id="a9317-198">Восстановление из хранилища службы архивации Azure</span><span class="sxs-lookup"><span data-stu-id="a9317-198">Restore from Azure Backup Vault</span></span>
<span data-ttu-id="a9317-199">Если база данных настроена для долгосрочного хранения hello потери данных за пределами hello текущий срок хранения для автоматического создания резервных копий, можно восстановить из еженедельного резервного копирования в новую базу данных tooa резервное хранилище Azure.</span><span class="sxs-lookup"><span data-stu-id="a9317-199">If hello data loss occurred outside hello current retention period for automated backups and your database is configured for long-term retention, you can restore from a weekly backup in Azure Backup Vault tooa new database.</span></span> <span data-ttu-id="a9317-200">На этом этапе можно заменить hello исходная база данных базой данных восстановления hello или копирования hello необходимые данные из базы данных восстановлена hello в исходной базе данных hello.</span><span class="sxs-lookup"><span data-stu-id="a9317-200">At this point, you can either replace hello original database with hello restored database or copy hello needed data from hello restored database into hello original database.</span></span> <span data-ttu-id="a9317-201">Если вам требуется tooretrieve старая версия обновления базы данных предыдущей tooa главному приложению, удовлетворения запроса из аудиторы или юридическое заказа, можно создать базу данных с помощью полной резервной копии, сохраненные в hello резервное хранилище Azure.</span><span class="sxs-lookup"><span data-stu-id="a9317-201">If you need tooretrieve an old version of your database prior tooa major application upgrade, satisfy a request from auditors or a legal order, you can create a database using a full backup saved in hello Azure Backup Vault.</span></span>  <span data-ttu-id="a9317-202">Дополнительные сведения см. в статье [Storing Azure SQL Database Backups for up to 10 years](sql-database-long-term-retention.md) (Хранение резервных копий баз данных SQL Azure до 10 лет).</span><span class="sxs-lookup"><span data-stu-id="a9317-202">For more information, see [Long-term retention](sql-database-long-term-retention.md).</span></span>

## <a name="recover-a-database-tooanother-region-from-an-azure-regional-data-center-outage"></a><span data-ttu-id="a9317-203">Восстановление после отключения центра обработки данных Azure региональных tooanother области базы данных</span><span class="sxs-lookup"><span data-stu-id="a9317-203">Recover a database tooanother region from an Azure regional data center outage</span></span>
<!-- Explain this scenario -->

<span data-ttu-id="a9317-204">В редких случаях возможен сбой центра обработки данных Azure.</span><span class="sxs-lookup"><span data-stu-id="a9317-204">Although rare, an Azure data center can have an outage.</span></span> <span data-ttu-id="a9317-205">Такой сбой вызывает нарушение работы компании, которое может длиться от считанных минут до нескольких часов.</span><span class="sxs-lookup"><span data-stu-id="a9317-205">When an outage occurs, it causes a business disruption that might only last a few minutes or might last for hours.</span></span>

* <span data-ttu-id="a9317-206">Один из вариантов — toowait для вашей базы данных toocome обратно в оперативный режим, при наведении hello отключения центра обработки данных.</span><span class="sxs-lookup"><span data-stu-id="a9317-206">One option is toowait for your database toocome back online when hello data center outage is over.</span></span> <span data-ttu-id="a9317-207">Это работает для приложений, которые допускают toohave hello базу данных.</span><span class="sxs-lookup"><span data-stu-id="a9317-207">This works for applications that can afford toohave hello database offline.</span></span> <span data-ttu-id="a9317-208">Например проект разработки или бесплатной пробной версии не требуется toowork на постоянно.</span><span class="sxs-lookup"><span data-stu-id="a9317-208">For example, a development project or free trial you don't need toowork on constantly.</span></span> <span data-ttu-id="a9317-209">После сбоя центра обработки данных вы не знаете hello сбоя может длительности, поэтому этот параметр используется, только если базы данных не требуется некоторое время.</span><span class="sxs-lookup"><span data-stu-id="a9317-209">When a data center has an outage, you do not know how long hello outage might last, so this option only works if you don't need your database for a while.</span></span>
* <span data-ttu-id="a9317-210">Другой вариант — tooeither fail над областью данных tooanother, если вы используете активной георепликации или hello восстановления базы данных с помощью геоизбыточных баз данных резервных копий (геовосстановление).</span><span class="sxs-lookup"><span data-stu-id="a9317-210">Another option is tooeither fail over tooanother data region if you are using active geo-replication or hello recover a database using geo-redundant database backups (geo-restore).</span></span> <span data-ttu-id="a9317-211">Отработка отказа занимает несколько секунд, тогда как на восстановление базы данных из резервных копий требуются часы.</span><span class="sxs-lookup"><span data-stu-id="a9317-211">Failover takes only a few seconds while database recovery from backups takes hours.</span></span>

<span data-ttu-id="a9317-212">При выполнении действия, как долго вы toorecover и сколько при этом потери данных зависит как определяют toouse этих функций обеспечения непрерывности бизнеса в приложении.</span><span class="sxs-lookup"><span data-stu-id="a9317-212">When you take action, how long it takes you toorecover, and how much data loss you incur depends upon how you decide toouse these business continuity features in your application.</span></span> <span data-ttu-id="a9317-213">На самом деле вы можете toouse сочетание резервные копии баз данных и активной георепликации в зависимости от требований приложения.</span><span class="sxs-lookup"><span data-stu-id="a9317-213">Indeed, you may choose toouse a combination of database backups and active geo-replication depending upon your application requirements.</span></span> <span data-ttu-id="a9317-214">Вопросы разработки приложений для автономных баз данных и пулов эластичных БД, использующих эти возможности обеспечения непрерывности бизнес-процессов, рассматриваются в статьях [Создание приложения для аварийного восстановления облака с использованием активной георепликации в базе данных SQL](sql-database-designing-cloud-solutions-for-disaster-recovery.md) и [Стратегии аварийного восстановления для приложений с использованием пула эластичных баз данных SQL](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="a9317-214">For a discussion of application design considerations for stand-alone databases and for elastic pools using these business continuity features, see [Design an application for cloud disaster recovery](sql-database-designing-cloud-solutions-for-disaster-recovery.md) and [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>

<span data-ttu-id="a9317-215">Hello следующих разделах содержатся общие сведения о toorecover hello действия, с помощью резервных копий базы данных или активной георепликации.</span><span class="sxs-lookup"><span data-stu-id="a9317-215">hello following sections provide an overview of hello steps toorecover using either database backups or active geo-replication.</span></span> <span data-ttu-id="a9317-216">Подробное описание действий, включая планирование требований, действия по восстановлению post и сведения о как toosimulate tooperform сбоя аварийного восстановления детализации см. в разделе [восстановление после сбоя базы данных SQL](sql-database-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="a9317-216">For detailed steps including planning requirements, post recovery steps, and information about how toosimulate an outage tooperform a disaster recovery drill, see [Recover a SQL Database from an outage](sql-database-disaster-recovery.md).</span></span>

### <a name="prepare-for-an-outage"></a><span data-ttu-id="a9317-217">Подготовка к сбою</span><span class="sxs-lookup"><span data-stu-id="a9317-217">Prepare for an outage</span></span>
<span data-ttu-id="a9317-218">Независимо от того, hello функция обеспечения непрерывности бизнеса, используемая необходимо выполнить следующее:</span><span class="sxs-lookup"><span data-stu-id="a9317-218">Regardless of hello business continuity feature you use, you must:</span></span>

* <span data-ttu-id="a9317-219">Определите и подготовьте целевой сервер hello, включая правила брандмауэра уровня сервера, имена входа и разрешения на уровне базы данных master.</span><span class="sxs-lookup"><span data-stu-id="a9317-219">Identify and prepare hello target server, including server-level firewall rules, logins, and master database level permissions.</span></span>
* <span data-ttu-id="a9317-220">Определить, каким образом tooredirect клиентов и клиентских приложений toohello новый сервер</span><span class="sxs-lookup"><span data-stu-id="a9317-220">Determine how tooredirect clients and client applications toohello new server</span></span>
* <span data-ttu-id="a9317-221">Задокументируйте прочие зависимости, такие как параметры аудита и оповещения.</span><span class="sxs-lookup"><span data-stu-id="a9317-221">Document other dependencies, such as auditing settings and alerts</span></span>

<span data-ttu-id="a9317-222">Без соответствующей подготовки возобновление работы приложений после отработки отказа или восстановления базы данных занимает больше времени и, вероятно, также требует устранения неполадок во время стрессовой нагрузки, а это весьма неудачное сочетание.</span><span class="sxs-lookup"><span data-stu-id="a9317-222">If you do not prepare properly, bringing your applications online after a failover or a database recovery takes additional time and likely also require troubleshooting at a time of stress - a bad combination.</span></span>

### <a name="fail-over-tooa-geo-replicated-secondary-database"></a><span data-ttu-id="a9317-223">При сбое tooa географическая репликация базы данных-получателя</span><span class="sxs-lookup"><span data-stu-id="a9317-223">Fail over tooa geo-replicated secondary database</span></span>
<span data-ttu-id="a9317-224">При использовании активной георепликации и групп автоматической отработки отказа (в предварительной версии) в качестве механизма восстановления можно настроить политику автоматической отработки отказа или использовать [ручную отработку отказа](sql-database-disaster-recovery.md#fail-over-to-geo-replicated-secondary-database).</span><span class="sxs-lookup"><span data-stu-id="a9317-224">If you are using active geo-replication and auto-failover groups (in-preview) as your recovery mechanism, you can configure an automatic failover policy or use [manual failover](sql-database-disaster-recovery.md#fail-over-to-geo-replicated-secondary-database).</span></span> <span data-ttu-id="a9317-225">После инициализации вторичной toobecome причины перехода на другой ресурс hello hello hello новый первичный и готов toorecord новых транзакций и реагировать tooqueries - с минимальной потерей данных для еще не реплицированные данные hello.</span><span class="sxs-lookup"><span data-stu-id="a9317-225">Once initiated, hello failover causes hello secondary toobecome hello new primary and ready toorecord new transactions and respond tooqueries - with minimal data loss for hello data not yet replicated.</span></span> <span data-ttu-id="a9317-226">Сведения о разработке hello процесс отработки отказа см. в разделе [создания приложения для восстановления после сбоев облачных](sql-database-designing-cloud-solutions-for-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="a9317-226">For information on designing hello failover process, see [Design an application for cloud disaster recovery](sql-database-designing-cloud-solutions-for-disaster-recovery.md).</span></span>

> [!NOTE]
> <span data-ttu-id="a9317-227">При hello центра обработки данных в оперативный hello в источниках старого автоматически toohello новой первичной реплике повторно подключиться и стать баз данных-получателей.</span><span class="sxs-lookup"><span data-stu-id="a9317-227">When hello data center comes back online hello old primaries automatically reconnect toohello new primary and become secondary databases.</span></span> <span data-ttu-id="a9317-228">При необходимости toorelocate hello основной серверной toohello исходной области, можно запустить плановую отработку отказа вручную (восстановление).</span><span class="sxs-lookup"><span data-stu-id="a9317-228">If you need toorelocate hello primary back toohello original region, you can initiate a planned failover manually (failback).</span></span> 
> 

### <a name="perform-a-geo-restore"></a><span data-ttu-id="a9317-229">Процедура геовосстановления</span><span class="sxs-lookup"><span data-stu-id="a9317-229">Perform a geo-restore</span></span>
<span data-ttu-id="a9317-230">При использовании автоматически создаваемых резервных копий и репликации в геоизбыточное хранилище в качестве механизма восстановления можно [начать восстановление базы данных с помощью геовосстановления](sql-database-disaster-recovery.md#recover-using-geo-restore).</span><span class="sxs-lookup"><span data-stu-id="a9317-230">If you are using automated backups with geo-redundant storage replication as your recovery mechanism, [initiate a database recovery using geo-restore](sql-database-disaster-recovery.md#recover-using-geo-restore).</span></span> <span data-ttu-id="a9317-231">Восстановление обычно занимает место в течение 12 часов - потери данных вверх tooone час определяется при hello последнего почасовой разностной резервной копии, сделанной и реплицированные.</span><span class="sxs-lookup"><span data-stu-id="a9317-231">Recovery usually takes place within 12 hours - with data loss of up tooone hour determined by when hello last hourly differential backup with taken and replicated.</span></span> <span data-ttu-id="a9317-232">До завершения восстановления hello, hello или базы данных не удается toorecord всех транзакций отвечает tooany запросы.</span><span class="sxs-lookup"><span data-stu-id="a9317-232">Until hello recovery completes, hello database is unable toorecord any transactions or respond tooany queries.</span></span> <span data-ttu-id="a9317-233">При этом восстанавливается база данных toohello последней доступной точки времени, восстановление точки получателя geo tooany hello времени не поддерживается в настоящее время.</span><span class="sxs-lookup"><span data-stu-id="a9317-233">While this restores a database toohello last available point in time, restoring hello geo-secondary tooany point in time is not currently supported.</span></span>

> [!NOTE]
> <span data-ttu-id="a9317-234">Если центр обработки данных hello в оперативный до перехода приложения через toohello восстановленной базы данных, можно отменить hello восстановления.</span><span class="sxs-lookup"><span data-stu-id="a9317-234">If hello data center comes back online before you switch your application over toohello recovered database, you can cancel hello recovery.</span></span>  
>
>

### <a name="perform-post-failover--recovery-tasks"></a><span data-ttu-id="a9317-235">Выполнение задач после восстановления размещения и восстановления</span><span class="sxs-lookup"><span data-stu-id="a9317-235">Perform post failover / recovery tasks</span></span>
<span data-ttu-id="a9317-236">После восстановления из любого из этих механизмов восстановления необходимо выполнить hello следующие дополнительные задачи, прежде чем пользователи и приложения создайте резервную копию и под управлением:</span><span class="sxs-lookup"><span data-stu-id="a9317-236">After recovery from either recovery mechanism, you must perform hello following additional tasks before your users and applications are back up and running:</span></span>

* <span data-ttu-id="a9317-237">Перенаправить клиентов и клиентских приложений toohello нового сервера и восстановленной базе данных</span><span class="sxs-lookup"><span data-stu-id="a9317-237">Redirect clients and client applications toohello new server and restored database</span></span>
* <span data-ttu-id="a9317-238">Убедитесь в наличии для пользователей tooconnect правила брандмауэра на уровне сервера соответствующие (или используйте [брандмауэров уровня базы данных](sql-database-firewall-configure.md#creating-and-managing-firewall-rules))</span><span class="sxs-lookup"><span data-stu-id="a9317-238">Ensure appropriate server-level firewall rules are in place for users tooconnect (or use [database-level firewalls](sql-database-firewall-configure.md#creating-and-managing-firewall-rules))</span></span>
* <span data-ttu-id="a9317-239">Убедитесь, что заданы соответствующие имена для входа и разрешения уровня базы данных master (или используйте [автономных пользователей](https://msdn.microsoft.com/library/ff929188.aspx)).</span><span class="sxs-lookup"><span data-stu-id="a9317-239">Ensure appropriate logins and master database level permissions are in place (or use [contained users](https://msdn.microsoft.com/library/ff929188.aspx))</span></span>
* <span data-ttu-id="a9317-240">Настройте аудит соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="a9317-240">Configure auditing, as appropriate</span></span>
* <span data-ttu-id="a9317-241">Настройте оповещения соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="a9317-241">Configure alerts, as appropriate</span></span>

## <a name="upgrade-an-application-with-minimal-downtime"></a><span data-ttu-id="a9317-242">Обновление приложения с минимальным простоем</span><span class="sxs-lookup"><span data-stu-id="a9317-242">Upgrade an application with minimal downtime</span></span>
<span data-ttu-id="a9317-243">Иногда приложение нужно перевести в автономный режим для планового обслуживания, например, чтобы обновить его.</span><span class="sxs-lookup"><span data-stu-id="a9317-243">Sometimes an application must be taken offline because of planned maintenance such as an application upgrade.</span></span> <span data-ttu-id="a9317-244">[Управление обновлениями приложений](sql-database-manage-application-rolling-upgrade.md) описывает принцип tooenable активной георепликации toouse обновления время простоя toominimize облачные приложения во время обновления и предоставить путь восстановления, если что-то пойдет не так.</span><span class="sxs-lookup"><span data-stu-id="a9317-244">[Manage application upgrades](sql-database-manage-application-rolling-upgrade.md) describes how toouse active geo-replication tooenable rolling upgrades of your cloud application toominimize downtime during upgrades and provide a recovery path if something goes wrong.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="a9317-245">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="a9317-245">Next steps</span></span>
<span data-ttu-id="a9317-246">Вопросы разработки приложений для автономных баз данных и пулов эластичных БД рассматриваются в статьях [Создание приложения для аварийного восстановления облака с использованием активной георепликации в базе данных SQL](sql-database-designing-cloud-solutions-for-disaster-recovery.md) и [Стратегии аварийного восстановления для приложений с использованием пула эластичных баз данных SQL](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="a9317-246">For a discussion of application design considerations for stand-alone databases and for elastic pools, see [Design an application for cloud disaster recovery](sql-database-designing-cloud-solutions-for-disaster-recovery.md) and [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
