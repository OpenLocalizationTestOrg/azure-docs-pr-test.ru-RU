---
title: "Непрерывность облачных бизнес-процессов — восстановление базы данных — база данных SQL | Документация Майкрософт"
description: "Узнайте, как базы данных SQL Azure поддерживают непрерывное выполнение облачных бизнес-процессов и восстановление баз данных, а также помогают обеспечить выполнение важных облачных приложений."
keywords: "непрерывность бизнес-процессов, непрерывность облачных бизнес-процессов, аварийное восстановление базы данных, восстановление базы данных"
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: 
ms.assetid: 18e5d3f1-bfe5-4089-b6fd-76988ab29822
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 05/15/2017
ms.author: sashan
ms.openlocfilehash: cc93ee34a37a4a8688fa2eca338126c13b9940c0
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="overview-of-business-continuity-with-azure-sql-database"></a><span data-ttu-id="47609-104">Обзор обеспечения непрерывности бизнес-процессов с помощью базы данных SQL Azure</span><span class="sxs-lookup"><span data-stu-id="47609-104">Overview of business continuity with Azure SQL Database</span></span>

<span data-ttu-id="47609-105">В этом обзоре описываются возможности базы данных SQL Azure по обеспечению непрерывности бизнес-процессов и аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="47609-105">This overview describes the capabilities that Azure SQL Database provides for business continuity and disaster recovery.</span></span> <span data-ttu-id="47609-106">Вы узнаете о параметрах, рекомендациях и руководствах по восстановлению после аварийных событий, которые могут приводить к потере данных или недоступности базы данных и приложений.</span><span class="sxs-lookup"><span data-stu-id="47609-106">Learn about options, recommendations, and tutorials for recovering from disruptive events that could cause data loss or cause your database and application to become unavailable.</span></span> <span data-ttu-id="47609-107">Здесь также содержатся сведения о том, как действовать в ситуациях, когда ошибка пользователя или приложения нарушает целостность данных, происходит сбой региона Azure или приложение требует обслуживания.</span><span class="sxs-lookup"><span data-stu-id="47609-107">Learn what to do when a user or application error affects data integrity, an Azure region has an outage, or your application requires maintenance.</span></span>

## <a name="sql-database-features-that-you-can-use-to-provide-business-continuity"></a><span data-ttu-id="47609-108">Функции базы данных SQL, которые можно использовать для обеспечения непрерывности бизнес-процессов</span><span class="sxs-lookup"><span data-stu-id="47609-108">SQL Database features that you can use to provide business continuity</span></span>

<span data-ttu-id="47609-109">База данных SQL предоставляет несколько функций обеспечения непрерывности бизнес-процессов, включая автоматизированную архивацию и необязательную репликацию баз данных.</span><span class="sxs-lookup"><span data-stu-id="47609-109">SQL Database provides several business continuity features, including automated backups and optional database replication.</span></span> <span data-ttu-id="47609-110">У каждой из них разные параметры оценки времени восстановления (ERT) и возможной потери данных последних транзакций.</span><span class="sxs-lookup"><span data-stu-id="47609-110">Each has different characteristics for estimated recovery time (ERT) and potential data loss for recent transactions.</span></span> <span data-ttu-id="47609-111">Поняв, на что влияют эти параметры, вы сможете выбрать те, которые вам подходят, и, в большинстве случаев, использовать их вместе в различных сценариях.</span><span class="sxs-lookup"><span data-stu-id="47609-111">Once you understand these options, you can choose among them - and, in most scenarios, use them together for different scenarios.</span></span> <span data-ttu-id="47609-112">При разработке плана обеспечения непрерывности бизнес-процессов нужно понимать, какое максимальное время до полного восстановления приложения после аварийного события допустимо. Это ваше целевое время восстановления (RTO).</span><span class="sxs-lookup"><span data-stu-id="47609-112">As you develop your business continuity plan, you need to understand the maximum acceptable time before the application fully recovers after the disruptive event - this is your recovery time objective (RTO).</span></span> <span data-ttu-id="47609-113">Необходимо также понимать, какой максимальный объем потери последних обновлений данных (т. е. за какой интервал времени) в приложении допустим при восстановлении после аварийного события. Это ваша целевая точка восстановления (RPO).</span><span class="sxs-lookup"><span data-stu-id="47609-113">You also need to understand the maximum amount of recent data updates (time interval) the application can tolerate losing when recovering after the disruptive event - this is your recovery point objective (RPO).</span></span>

<span data-ttu-id="47609-114">В приведенной ниже таблице сравниваются ERT и RPO трех наиболее распространенных сценариев.</span><span class="sxs-lookup"><span data-stu-id="47609-114">The following table compares the ERT and RPO for the three most common scenarios.</span></span>

| <span data-ttu-id="47609-115">Функция</span><span class="sxs-lookup"><span data-stu-id="47609-115">Capability</span></span> | <span data-ttu-id="47609-116">Уровень Basic</span><span class="sxs-lookup"><span data-stu-id="47609-116">Basic tier</span></span> | <span data-ttu-id="47609-117">Уровень Standard</span><span class="sxs-lookup"><span data-stu-id="47609-117">Standard tier</span></span> | <span data-ttu-id="47609-118">Уровень Premium</span><span class="sxs-lookup"><span data-stu-id="47609-118">Premium tier</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="47609-119">Восстановление до точки во времени из резервной копии</span><span class="sxs-lookup"><span data-stu-id="47609-119">Point in Time Restore from backup</span></span> |<span data-ttu-id="47609-120">Все точки восстановления в течение 7 дней</span><span class="sxs-lookup"><span data-stu-id="47609-120">Any restore point within 7 days</span></span> |<span data-ttu-id="47609-121">Все точки восстановления в течение 35 дней</span><span class="sxs-lookup"><span data-stu-id="47609-121">Any restore point within 35 days</span></span> |<span data-ttu-id="47609-122">Все точки восстановления в течение 35 дней</span><span class="sxs-lookup"><span data-stu-id="47609-122">Any restore point within 35 days</span></span> |
| <span data-ttu-id="47609-123">Геовосстановление из геореплицированных резервных копий</span><span class="sxs-lookup"><span data-stu-id="47609-123">Geo-restore from geo-replicated backups</span></span> |<span data-ttu-id="47609-124">ERT < 12 ч, RPO < 1 ч</span><span class="sxs-lookup"><span data-stu-id="47609-124">ERT < 12h, RPO < 1h</span></span> |<span data-ttu-id="47609-125">ERT < 12 ч, RPO < 1 ч</span><span class="sxs-lookup"><span data-stu-id="47609-125">ERT < 12h, RPO < 1h</span></span> |<span data-ttu-id="47609-126">ERT < 12 ч, RPO < 1 ч</span><span class="sxs-lookup"><span data-stu-id="47609-126">ERT < 12h, RPO < 1h</span></span> |
| <span data-ttu-id="47609-127">Восстановление из хранилища службы архивации Azure</span><span class="sxs-lookup"><span data-stu-id="47609-127">Restore from Azure Backup Vault</span></span> |<span data-ttu-id="47609-128">ERT < 12 ч, RPO < 1 нед.</span><span class="sxs-lookup"><span data-stu-id="47609-128">ERT < 12h, RPO < 1 wk</span></span> |<span data-ttu-id="47609-129">ERT < 12 ч, RPO < 1 нед.</span><span class="sxs-lookup"><span data-stu-id="47609-129">ERT < 12h, RPO < 1 wk</span></span> |<span data-ttu-id="47609-130">ERT < 12 ч, RPO < 1 нед.</span><span class="sxs-lookup"><span data-stu-id="47609-130">ERT < 12h, RPO < 1 wk</span></span> |
| <span data-ttu-id="47609-131">Активная георепликация</span><span class="sxs-lookup"><span data-stu-id="47609-131">Active geo-replication</span></span> |<span data-ttu-id="47609-132">ERT < 30 с, RPO < 5 с</span><span class="sxs-lookup"><span data-stu-id="47609-132">ERT < 30s, RPO < 5s</span></span> |<span data-ttu-id="47609-133">ERT < 30 с, RPO < 5 с</span><span class="sxs-lookup"><span data-stu-id="47609-133">ERT < 30s, RPO < 5s</span></span> |<span data-ttu-id="47609-134">ERT < 30 с, RPO < 5 с</span><span class="sxs-lookup"><span data-stu-id="47609-134">ERT < 30s, RPO < 5s</span></span> |

### <a name="use-database-backups-to-recover-a-database"></a><span data-ttu-id="47609-135">Использование резервных копий для восстановления базы данных</span><span class="sxs-lookup"><span data-stu-id="47609-135">Use database backups to recover a database</span></span>

<span data-ttu-id="47609-136">База данных SQL автоматически создает полные резервные копии (раз в неделю) и разностные резервные копии базы данных (раз в час), а также резервные копии журнала транзакций (раз в пять-десять минут) для защиты вашей компании от потери данных.</span><span class="sxs-lookup"><span data-stu-id="47609-136">SQL Database automatically performs a combination of full database backups weekly, differential database backups hourly, and transaction log backups every five - ten minutes to protect your business from data loss.</span></span> <span data-ttu-id="47609-137">Эти резервные копии хранятся в геоизбыточном хранилище в течение 35 дней (для баз данных с уровнем служб "Стандартный" и "Премиум") или 7 дней (для баз данных с уровнем служб "Базовый").</span><span class="sxs-lookup"><span data-stu-id="47609-137">These backups are stored in geo-redundant storage for 35 days for databases in the Standard and Premium service tiers and 7 days for databases in the Basic service tier.</span></span> <span data-ttu-id="47609-138">Чтобы узнать больше, ознакомьтесь со сведениями об [уровнях служб](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="47609-138">For more information, see [service tiers](sql-database-service-tiers.md).</span></span> <span data-ttu-id="47609-139">Если срок хранения для уровня служб не отвечает вашим потребностям, можно увеличить срок хранения, [изменив уровень служб](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="47609-139">If the retention period for your service tier does not meet your business requirements, you can increase the retention period by [changing the service tier](sql-database-service-tiers.md).</span></span> <span data-ttu-id="47609-140">Полные и разностные резервные копии баз данных также реплицируются в [сопряженный центр обработки данных](../best-practices-availability-paired-regions.md) для защиты от сбоя центра обработки данных.</span><span class="sxs-lookup"><span data-stu-id="47609-140">The full and differential database backups are also replicated to a [paired data center](../best-practices-availability-paired-regions.md) for protection against a data center outage.</span></span> <span data-ttu-id="47609-141">Дополнительные сведения см. в статье [Подробнее о резервном копировании базы данных SQL](sql-database-automated-backups.md).</span><span class="sxs-lookup"><span data-stu-id="47609-141">For more information, see [automatic database backups](sql-database-automated-backups.md).</span></span>

<span data-ttu-id="47609-142">Если для вашего приложения недостаточно встроенного срока хранения, его можно расширить, настроив долгосрочную политику хранения базы данных.</span><span class="sxs-lookup"><span data-stu-id="47609-142">If the built-in retention period is not sufficient for your application, you can extend it by configuring a database long-term retention policy.</span></span> <span data-ttu-id="47609-143">Дополнительные сведения см. в статье [Хранение резервных копий базы данных SQL Azure до 10 лет](sql-database-long-term-retention.md).</span><span class="sxs-lookup"><span data-stu-id="47609-143">For more information, see [long-term retention](sql-database-long-term-retention.md).</span></span>

<span data-ttu-id="47609-144">Эти создаваемые автоматически резервные копии можно использовать для восстановления базы данных после различных аварийных событий как в своем, так и в другом центре обработки данных.</span><span class="sxs-lookup"><span data-stu-id="47609-144">You can use these automatic database backups to recover a database from various disruptive events, both within your data center and to another data center.</span></span> <span data-ttu-id="47609-145">При использовании создаваемых автоматически резервных копий базы данных предполагаемое время восстановления будет зависеть от нескольких факторов, включая общее количество баз данных, восстанавливаемых в том же регионе и в то же время, размера базы данных, размера журнала транзакций и пропускной способности сети.</span><span class="sxs-lookup"><span data-stu-id="47609-145">Using automatic database backups, the estimated time of recovery depends on several factors including the total number of databases recovering in the same region at the same time, the database size, the transaction log size, and network bandwidth.</span></span> <span data-ttu-id="47609-146">Обычно время восстановления составляет менее 12 часов.</span><span class="sxs-lookup"><span data-stu-id="47609-146">The recovery time is usually less than 12 hours.</span></span> <span data-ttu-id="47609-147">При восстановлении в другой регион данных потенциальные потери данных ограничены 1 часом благодаря геоизбыточному хранилищу ежечасных разностных резервных копий базы данных.</span><span class="sxs-lookup"><span data-stu-id="47609-147">When recovering to another data region, the potential data loss is limited to 1 hour by the geo-redundant storage of hourly differential database backups.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="47609-148">Чтобы использовать восстановление с помощью автоматически создаваемых резервных копий, нужно быть участником роли "Участник SQL Server" или владельцем подписки. Ознакомьтесь со статьей [RBAC: встроенные роли](../active-directory/role-based-access-built-in-roles.md).</span><span class="sxs-lookup"><span data-stu-id="47609-148">To recover using automated backups, you must be a member of the SQL Server Contributor role or the subscription owner - see [RBAC: Built-in roles](../active-directory/role-based-access-built-in-roles.md).</span></span> <span data-ttu-id="47609-149">Выполнить восстановление можно с помощью портала Azure, PowerShell или REST API.</span><span class="sxs-lookup"><span data-stu-id="47609-149">You can recover using the Azure portal, PowerShell, or the REST API.</span></span> <span data-ttu-id="47609-150">Использовать для этого Transact-SQL невозможно.</span><span class="sxs-lookup"><span data-stu-id="47609-150">You cannot use Transact-SQL.</span></span>
>

<span data-ttu-id="47609-151">Используйте автоматически создаваемые резервные копии для обеспечения непрерывности бизнес-процессов и восстановления, если ваше приложение:</span><span class="sxs-lookup"><span data-stu-id="47609-151">Use automated backups as your business continuity and recovery mechanism if your application:</span></span>

* <span data-ttu-id="47609-152">не является критически важным;</span><span class="sxs-lookup"><span data-stu-id="47609-152">Is not considered mission critical.</span></span>
* <span data-ttu-id="47609-153">на него не распространяется действие соглашений об уровне обслуживания, то есть перерыв в работе на 24 часа и более не повлечет финансовой ответственности;</span><span class="sxs-lookup"><span data-stu-id="47609-153">Doesn't have a binding SLA - a downtime of 24 hours or longer does not result in financial liability.</span></span>
* <span data-ttu-id="47609-154">имеет низкую частоту изменения данных (количество транзакций в час), и потеря до часа изменений данных считается допустимой;</span><span class="sxs-lookup"><span data-stu-id="47609-154">Has a low rate of data change (low transactions per hour) and losing up to an hour of change is an acceptable data loss.</span></span>
* <span data-ttu-id="47609-155">имеет ограниченный бюджет.</span><span class="sxs-lookup"><span data-stu-id="47609-155">Is cost sensitive.</span></span>

<span data-ttu-id="47609-156">Если вам требуется более быстрое восстановление, используйте [активную георепликацию](sql-database-geo-replication-overview.md) (рассматривается далее).</span><span class="sxs-lookup"><span data-stu-id="47609-156">If you need faster recovery, use [active geo-replication](sql-database-geo-replication-overview.md) (discussed next).</span></span> <span data-ttu-id="47609-157">Если вам требуется восстановить данные за период больше 35 дней, используйте [долгосрочное хранение резервных копий](sql-database-long-term-retention.md).</span><span class="sxs-lookup"><span data-stu-id="47609-157">If you need to be able to recover data from a period older than 35 days, use [long-term backup retention](sql-database-long-term-retention.md).</span></span> 

### <a name="use-active-geo-replication-and-auto-failover-groups-in-preview-to-reduce-recovery-time-and-limit-data-loss-associated-with-a-recovery"></a><span data-ttu-id="47609-158">Использование активной георепликации и групп с автоматической отработкой отказа (в предварительной версии) для сокращения времени восстановления и ограничения потери данных</span><span class="sxs-lookup"><span data-stu-id="47609-158">Use active geo-replication and auto-failover groups (in-preview) to reduce recovery time and limit data loss associated with a recovery</span></span>

<span data-ttu-id="47609-159">Помимо резервных копий базы данных, для восстановления баз данных при нарушении работы компании можно использовать [активную георепликацию](sql-database-geo-replication-overview.md). Это позволит настроить для базы данных до четырех доступных для чтения баз данных-получателей в выбранных вами регионах.</span><span class="sxs-lookup"><span data-stu-id="47609-159">In addition to using database backups for database recovery if a business disruption occurs, you can use [active geo-replication](sql-database-geo-replication-overview.md) to configure a database to have up to four readable secondary databases in the regions of your choice.</span></span> <span data-ttu-id="47609-160">Эти базы данных-получатели синхронизируются с базой данных-источником с помощью механизма асинхронной репликации.</span><span class="sxs-lookup"><span data-stu-id="47609-160">These secondary databases are kept synchronized with the primary database using an asynchronous replication mechanism.</span></span> <span data-ttu-id="47609-161">Эта функция используется, чтобы предотвратить нарушение работы компании при сбое центра обработки данных или во время обновления приложения.</span><span class="sxs-lookup"><span data-stu-id="47609-161">This feature is used to protect against business disruption if a data center outage occurs or during an application upgrade.</span></span> <span data-ttu-id="47609-162">Активную георепликацию можно также использовать, чтобы обеспечить географически распределенным пользователям повышенную производительность запросов только для чтения.</span><span class="sxs-lookup"><span data-stu-id="47609-162">Active geo-replication can also be used to provide better query performance for read-only queries to geographically dispersed users.</span></span>

<span data-ttu-id="47609-163">Для включения автоматической и прозрачной отработки отказа вам следует распределить геореплицируемые базы данных по группам с помощью функции [автоматической отработки отказа](sql-database-geo-replication-overview.md) базы данных SQL (в предварительной версии).</span><span class="sxs-lookup"><span data-stu-id="47609-163">To enable automated and transparent failover you should organize your geo-replicated databases into groups using the [auto-failover group](sql-database-geo-replication-overview.md) feature of SQL Database (in-preview).</span></span>

<span data-ttu-id="47609-164">Если база данных-источник неожиданно отключается от сети или ее необходимо перевести в автономный режим для обслуживания, то можно быстро повысить уровень базы данных-получателя до базы данных-источника (это также называется отработкой отказа) и настроить подключение приложений к этой базе данных.</span><span class="sxs-lookup"><span data-stu-id="47609-164">If the primary database goes offline unexpectedly or you need to take it offline for maintenance activities, you can quickly promote a secondary to become the primary (also called a failover) and configure applications to connect to the promoted primary.</span></span> <span data-ttu-id="47609-165">При подключении приложения к базам данных с помощью прослушивателя группы отработки отказа вам не придется изменять конфигурацию строки подключения SQL после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="47609-165">If your application is connecting to the databases using the failover group listener, you don’t need to change the SQL connection string configuration after failover.</span></span> <span data-ttu-id="47609-166">При плановой отработке отказа потеря данных отсутствует.</span><span class="sxs-lookup"><span data-stu-id="47609-166">With a planned failover, there is no data loss.</span></span> <span data-ttu-id="47609-167">В случае внеплановой отработки отказа небольшой объем данных самых последних транзакций может быть потерян ввиду характера асинхронной репликации.</span><span class="sxs-lookup"><span data-stu-id="47609-167">With an unplanned failover, there may be some small amount of data loss for very recent transactions due to the nature of asynchronous replication.</span></span> <span data-ttu-id="47609-168">С помощью групп автоматической отработки отказа (в предварительной версии) можно настроить политику отработки отказа, чтобы свести к минимуму возможные потери данных.</span><span class="sxs-lookup"><span data-stu-id="47609-168">Using auto-failover groups (in-preview), you can customize the failover policy to minimize the potential data loss.</span></span> <span data-ttu-id="47609-169">После отработки отказа вы сможете восстановить размещение — согласно плану или когда центр обработки данных возобновит работу.</span><span class="sxs-lookup"><span data-stu-id="47609-169">After a failover, you can later failback - either according to a plan or when the data center comes back online.</span></span> <span data-ttu-id="47609-170">Во всех случаях пользователи заметят небольшой простой и должны будут подключиться повторно.</span><span class="sxs-lookup"><span data-stu-id="47609-170">In all cases, users experience a small amount of downtime and need to reconnect.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="47609-171">Для использования активной георепликации и групп автоматической отработки отказа (в предварительной версии) необходимо быть владельцем подписки или иметь разрешения администратора SQL Server.</span><span class="sxs-lookup"><span data-stu-id="47609-171">To use active geo-replication and auto-failover groups (in-preview), you must either be the subscription owner or have administrative permissions in SQL Server.</span></span> <span data-ttu-id="47609-172">Для настройки и отработки отказа можно использовать портал Azure, PowerShell или REST API, имея разрешения для подписки Azure, или Transact-SQL, имея разрешения для SQL Server.</span><span class="sxs-lookup"><span data-stu-id="47609-172">You can configure and fail over using the Azure portal, PowerShell, or the REST API using Azure subscription permissions or using Transact-SQL with SQL Server permissions.</span></span>
> 

<span data-ttu-id="47609-173">Используйте активную георепликацию и группы автоматической отработки отказа (в предварительной версии), если ваше приложение удовлетворяет какому-либо из следующих требований:</span><span class="sxs-lookup"><span data-stu-id="47609-173">Use active geo-replication and auto-failover groups (in preview) if your application meets any of these criteria:</span></span>

* <span data-ttu-id="47609-174">оно является критически важным;</span><span class="sxs-lookup"><span data-stu-id="47609-174">Is mission critical.</span></span>
* <span data-ttu-id="47609-175">регулируется соглашением об уровне обслуживания (SLA), которое не допускает более 24 часов простоя;</span><span class="sxs-lookup"><span data-stu-id="47609-175">Has a service level agreement (SLA) that does not allow for 24 hours or more of downtime.</span></span>
* <span data-ttu-id="47609-176">его простой может повлечь финансовую ответственность;</span><span class="sxs-lookup"><span data-stu-id="47609-176">Downtime may result in financial liability.</span></span>
* <span data-ttu-id="47609-177">имеет высокую частоту изменения данных, и потеря данных за час не допускается;</span><span class="sxs-lookup"><span data-stu-id="47609-177">Has a high rate of data change is high and losing an hour of data is not acceptable.</span></span>
* <span data-ttu-id="47609-178">дополнительные затраты на активную георепликацию ниже, чем потенциальная финансовая ответственность и связанная с ней утрата деловых возможностей.</span><span class="sxs-lookup"><span data-stu-id="47609-178">The additional cost of active geo-replication is lower than the potential financial liability and associated loss of business.</span></span>

>
> [!VIDEO https://channel9.msdn.com/Blogs/Azure/Azure-SQL-Database-protecting-important-DBs-from-regional-disasters-is-easy/player]
>

## <a name="recover-a-database-after-a-user-or-application-error"></a><span data-ttu-id="47609-179">Восстановление базы данных после ошибки пользователя или приложения</span><span class="sxs-lookup"><span data-stu-id="47609-179">Recover a database after a user or application error</span></span>
<span data-ttu-id="47609-180">*Никто не совершенен!</span><span class="sxs-lookup"><span data-stu-id="47609-180">*No one is perfect!</span></span> <span data-ttu-id="47609-181">Пользователь может случайно удалить данные, важную таблицу или даже всю базу данных.</span><span class="sxs-lookup"><span data-stu-id="47609-181">A user might accidentally delete some data, inadvertently drop an important table, or even drop an entire database.</span></span> <span data-ttu-id="47609-182">Или приложение может случайно перезаписать важные данные неверной информацией из-за внутреннего дефекта.</span><span class="sxs-lookup"><span data-stu-id="47609-182">Or, an application might accidentally overwrite good data with bad data due to an application defect.</span></span>

<span data-ttu-id="47609-183">Ниже приведены возможные варианты восстановления в данном случае.</span><span class="sxs-lookup"><span data-stu-id="47609-183">In this scenario, these are your recovery options.</span></span>

### <a name="perform-a-point-in-time-restore"></a><span data-ttu-id="47609-184">Восстановление до точки во времени</span><span class="sxs-lookup"><span data-stu-id="47609-184">Perform a point-in-time restore</span></span>
<span data-ttu-id="47609-185">Можно использовать автоматически создаваемые резервные копии для восстановления копии базы данных до известной удачной точки во времени, если она не выходит за пределы срока хранения базы данных.</span><span class="sxs-lookup"><span data-stu-id="47609-185">You can use the automated backups to recover a copy of your database to a known good point in time, provided that time is within the database retention period.</span></span> <span data-ttu-id="47609-186">После восстановления базы данных можно заменить ей исходную базу данных или скопировать необходимые данные из восстановленного набора данных в исходную базу данных.</span><span class="sxs-lookup"><span data-stu-id="47609-186">After the database is restored, you can either replace the original database with the restored database or copy the needed data from the restored data into the original database.</span></span> <span data-ttu-id="47609-187">Если база данных использует активную георепликацию, то рекомендуется копировать необходимые данные из восстановленной копии в исходную базу данных.</span><span class="sxs-lookup"><span data-stu-id="47609-187">If the database uses active geo-replication, we recommend copying the required data from the restored copy into the original database.</span></span> <span data-ttu-id="47609-188">Если заменить исходную базу данных восстановленной, необходимо будет перенастроить и повторно синхронизировать активную георепликацию, что может занять довольно много времени в случае большой базы данных.</span><span class="sxs-lookup"><span data-stu-id="47609-188">If you replace the original database with the restored database, you need to reconfigure and resynchronize active geo-replication (which can take quite some time for a large database).</span></span>

<span data-ttu-id="47609-189">Чтобы узнать больше о восстановлении базы данных до точки во времени с помощью портала Azure или PowerShell и получить соответствующие указания, ознакомьтесь с [восстановлением до точки во времени](sql-database-recovery-using-backups.md#point-in-time-restore).</span><span class="sxs-lookup"><span data-stu-id="47609-189">For more information and for detailed steps for restoring a database to a point in time using the Azure portal or using PowerShell, see [point-in-time restore](sql-database-recovery-using-backups.md#point-in-time-restore).</span></span> <span data-ttu-id="47609-190">Для восстановления невозможно использовать Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="47609-190">You cannot recover using Transact-SQL.</span></span>

### <a name="restore-a-deleted-database"></a><span data-ttu-id="47609-191">Восстановление удаленной базы данных.</span><span class="sxs-lookup"><span data-stu-id="47609-191">Restore a deleted database</span></span>
<span data-ttu-id="47609-192">Если база данных была удалена, но логический сервер — нет, то удаленную базу данных можно восстановить до точки ее удаления.</span><span class="sxs-lookup"><span data-stu-id="47609-192">If the database is deleted but the logical server has not been deleted, you can restore the deleted database to the point at which it was deleted.</span></span> <span data-ttu-id="47609-193">При этом резервная копия базы данных восстанавливается на том же логическом сервере SQL, c которого она была удалена.</span><span class="sxs-lookup"><span data-stu-id="47609-193">This restores a database backup to the same logical SQL server from which it was deleted.</span></span> <span data-ttu-id="47609-194">Ее можно восстановить с исходным именем или новым именем, указанным для восстановленной базы данных.</span><span class="sxs-lookup"><span data-stu-id="47609-194">You can restore it using the original name or provide a new name or the restored database.</span></span>

<span data-ttu-id="47609-195">Чтобы узнать больше о восстановлении удаленной базы данных с помощью портала Azure или PowerShell и получить соответствующие указания, ознакомьтесь с [восстановлением удаленной базы данных](sql-database-recovery-using-backups.md#deleted-database-restore).</span><span class="sxs-lookup"><span data-stu-id="47609-195">For more information and for detailed steps for restoring a deleted database using the Azure portal or using PowerShell, see [restore a deleted database](sql-database-recovery-using-backups.md#deleted-database-restore).</span></span> <span data-ttu-id="47609-196">Для восстановления невозможно использовать Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="47609-196">You cannot restore using Transact-SQL.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="47609-197">Если логический сервер был удален, то восстановить удаленную базу данных будет невозможно.</span><span class="sxs-lookup"><span data-stu-id="47609-197">If the logical server is deleted, you cannot recover a deleted database.</span></span>
>
>

### <a name="restore-from-azure-backup-vault"></a><span data-ttu-id="47609-198">Восстановление из хранилища службы архивации Azure</span><span class="sxs-lookup"><span data-stu-id="47609-198">Restore from Azure Backup Vault</span></span>
<span data-ttu-id="47609-199">Если потеря данных произошла после истечения текущего срока хранения для автоматического создания резервных копий, а для вашей базы данных настроено длительное хранение, данные можно восстановить из еженедельной резервной копии в хранилище службы архивации Azure в новую базу данных.</span><span class="sxs-lookup"><span data-stu-id="47609-199">If the data loss occurred outside the current retention period for automated backups and your database is configured for long-term retention, you can restore from a weekly backup in Azure Backup Vault to a new database.</span></span> <span data-ttu-id="47609-200">На данном этапе можно заменить исходную базу данных восстановленной или скопировать необходимые данные из восстановленной базы данных в исходную.</span><span class="sxs-lookup"><span data-stu-id="47609-200">At this point, you can either replace the original database with the restored database or copy the needed data from the restored database into the original database.</span></span> <span data-ttu-id="47609-201">Если необходимо получить старую версию базы данных перед обновлением основного приложения, выполнить запрос от аудиторов или юридический запрос, можно создать базу данных с использованием полной резервной копии, сохраненной в хранилище службы архивации Azure.</span><span class="sxs-lookup"><span data-stu-id="47609-201">If you need to retrieve an old version of your database prior to a major application upgrade, satisfy a request from auditors or a legal order, you can create a database using a full backup saved in the Azure Backup Vault.</span></span>  <span data-ttu-id="47609-202">Дополнительные сведения см. в статье [Storing Azure SQL Database Backups for up to 10 years](sql-database-long-term-retention.md) (Хранение резервных копий баз данных SQL Azure до 10 лет).</span><span class="sxs-lookup"><span data-stu-id="47609-202">For more information, see [Long-term retention](sql-database-long-term-retention.md).</span></span>

## <a name="recover-a-database-to-another-region-from-an-azure-regional-data-center-outage"></a><span data-ttu-id="47609-203">Восстановление базы данных в другой регион после регионального сбоя центра обработки данных Azure</span><span class="sxs-lookup"><span data-stu-id="47609-203">Recover a database to another region from an Azure regional data center outage</span></span>
<!-- Explain this scenario -->

<span data-ttu-id="47609-204">В редких случаях возможен сбой центра обработки данных Azure.</span><span class="sxs-lookup"><span data-stu-id="47609-204">Although rare, an Azure data center can have an outage.</span></span> <span data-ttu-id="47609-205">Такой сбой вызывает нарушение работы компании, которое может длиться от считанных минут до нескольких часов.</span><span class="sxs-lookup"><span data-stu-id="47609-205">When an outage occurs, it causes a business disruption that might only last a few minutes or might last for hours.</span></span>

* <span data-ttu-id="47609-206">Один из вариантов — дождаться возобновления работы базы данных после того, как сбой центра обработки данных будет устранен.</span><span class="sxs-lookup"><span data-stu-id="47609-206">One option is to wait for your database to come back online when the data center outage is over.</span></span> <span data-ttu-id="47609-207">Это подходит для приложений, которые допускают отключение базы данных от сети.</span><span class="sxs-lookup"><span data-stu-id="47609-207">This works for applications that can afford to have the database offline.</span></span> <span data-ttu-id="47609-208">Например, вам не нужно непрерывно работать с проектом по разработке или бесплатной пробной версией.</span><span class="sxs-lookup"><span data-stu-id="47609-208">For example, a development project or free trial you don't need to work on constantly.</span></span> <span data-ttu-id="47609-209">После того как произошел сбой центра обработки данных, неизвестно, как долго будет длиться простой. Поэтому этот вариант используется, только если база данных некоторое время не нужна.</span><span class="sxs-lookup"><span data-stu-id="47609-209">When a data center has an outage, you do not know how long the outage might last, so this option only works if you don't need your database for a while.</span></span>
* <span data-ttu-id="47609-210">Другой вариант — либо отработка отказа в другой регион данных, если используется активная георепликация, либо восстановление базы данных с помощью геоизбыточных резервных копий базы данных (геовосстановление).</span><span class="sxs-lookup"><span data-stu-id="47609-210">Another option is to either fail over to another data region if you are using active geo-replication or the recover a database using geo-redundant database backups (geo-restore).</span></span> <span data-ttu-id="47609-211">Отработка отказа занимает несколько секунд, тогда как на восстановление базы данных из резервных копий требуются часы.</span><span class="sxs-lookup"><span data-stu-id="47609-211">Failover takes only a few seconds while database recovery from backups takes hours.</span></span>

<span data-ttu-id="47609-212">Сколько времени займет восстановление и каковы будут потери данных зависит от того, как вы решите использовать в приложении возможности обеспечения непрерывности бизнес-процессов.</span><span class="sxs-lookup"><span data-stu-id="47609-212">When you take action, how long it takes you to recover, and how much data loss you incur depends upon how you decide to use these business continuity features in your application.</span></span> <span data-ttu-id="47609-213">Разумеется, вы можете использовать сочетание резервных копий базы данных и активной георепликации, в зависимости от требований приложения.</span><span class="sxs-lookup"><span data-stu-id="47609-213">Indeed, you may choose to use a combination of database backups and active geo-replication depending upon your application requirements.</span></span> <span data-ttu-id="47609-214">Вопросы разработки приложений для автономных баз данных и пулов эластичных БД, использующих эти возможности обеспечения непрерывности бизнес-процессов, рассматриваются в статьях [Создание приложения для аварийного восстановления облака с использованием активной георепликации в базе данных SQL](sql-database-designing-cloud-solutions-for-disaster-recovery.md) и [Стратегии аварийного восстановления для приложений с использованием пула эластичных баз данных SQL](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="47609-214">For a discussion of application design considerations for stand-alone databases and for elastic pools using these business continuity features, see [Design an application for cloud disaster recovery](sql-database-designing-cloud-solutions-for-disaster-recovery.md) and [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>

<span data-ttu-id="47609-215">В следующих разделах описываются инструкции по восстановлению с использованием резервных копий базы данных или активной георепликации.</span><span class="sxs-lookup"><span data-stu-id="47609-215">The following sections provide an overview of the steps to recover using either database backups or active geo-replication.</span></span> <span data-ttu-id="47609-216">Подробные инструкции, включающие в себя планирование требований, действия после восстановления и сведения о том, как имитировать сбой для отработки аварийного восстановления, см. в статье [Восстановление базы данных SQL Azure или переход на базу данных-получатель при отказе](sql-database-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="47609-216">For detailed steps including planning requirements, post recovery steps, and information about how to simulate an outage to perform a disaster recovery drill, see [Recover a SQL Database from an outage](sql-database-disaster-recovery.md).</span></span>

### <a name="prepare-for-an-outage"></a><span data-ttu-id="47609-217">Подготовка к сбою</span><span class="sxs-lookup"><span data-stu-id="47609-217">Prepare for an outage</span></span>
<span data-ttu-id="47609-218">Независимо от выбранной функции обеспечения непрерывности бизнес-процессов необходимо выполнить следующее.</span><span class="sxs-lookup"><span data-stu-id="47609-218">Regardless of the business continuity feature you use, you must:</span></span>

* <span data-ttu-id="47609-219">Определите и подготовьте целевой сервер, включая правила брандмауэра уровня сервера, имена для входа и разрешения уровня базы данных master.</span><span class="sxs-lookup"><span data-stu-id="47609-219">Identify and prepare the target server, including server-level firewall rules, logins, and master database level permissions.</span></span>
* <span data-ttu-id="47609-220">Определите, как клиенты и клиентские приложения будут перенаправляться на новый сервер.</span><span class="sxs-lookup"><span data-stu-id="47609-220">Determine how to redirect clients and client applications to the new server</span></span>
* <span data-ttu-id="47609-221">Задокументируйте прочие зависимости, такие как параметры аудита и оповещения.</span><span class="sxs-lookup"><span data-stu-id="47609-221">Document other dependencies, such as auditing settings and alerts</span></span>

<span data-ttu-id="47609-222">Без соответствующей подготовки возобновление работы приложений после отработки отказа или восстановления базы данных занимает больше времени и, вероятно, также требует устранения неполадок во время стрессовой нагрузки, а это весьма неудачное сочетание.</span><span class="sxs-lookup"><span data-stu-id="47609-222">If you do not prepare properly, bringing your applications online after a failover or a database recovery takes additional time and likely also require troubleshooting at a time of stress - a bad combination.</span></span>

### <a name="fail-over-to-a-geo-replicated-secondary-database"></a><span data-ttu-id="47609-223">Отработка отказа в геореплицируемую базу данных-получатель</span><span class="sxs-lookup"><span data-stu-id="47609-223">Fail over to a geo-replicated secondary database</span></span>
<span data-ttu-id="47609-224">При использовании активной георепликации и групп автоматической отработки отказа (в предварительной версии) в качестве механизма восстановления можно настроить политику автоматической отработки отказа или использовать [ручную отработку отказа](sql-database-disaster-recovery.md#fail-over-to-geo-replicated-secondary-database).</span><span class="sxs-lookup"><span data-stu-id="47609-224">If you are using active geo-replication and auto-failover groups (in-preview) as your recovery mechanism, you can configure an automatic failover policy or use [manual failover](sql-database-disaster-recovery.md#fail-over-to-geo-replicated-secondary-database).</span></span> <span data-ttu-id="47609-225">После запуска отработка отказа приводит к повышению базы данных-получателя до новой базы данных-источника и делает ее доступной для записи новых транзакций и реагирования на запросы. При этом происходят минимальные потери данных, которые еще не реплицированы.</span><span class="sxs-lookup"><span data-stu-id="47609-225">Once initiated, the failover causes the secondary to become the new primary and ready to record new transactions and respond to queries - with minimal data loss for the data not yet replicated.</span></span> <span data-ttu-id="47609-226">Сведения о разработке процесса отработки отказа см. в статье [Проектирование приложения для облачного аварийного восстановления с использованием активной георепликации в базе данных SQL](sql-database-designing-cloud-solutions-for-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="47609-226">For information on designing the failover process, see [Design an application for cloud disaster recovery](sql-database-designing-cloud-solutions-for-disaster-recovery.md).</span></span>

> [!NOTE]
> <span data-ttu-id="47609-227">После возобновления работы центра обработки данных старые базы данных-источники автоматически переподключаются к новым базам данных-источникам и становятся базами данных-получателями.</span><span class="sxs-lookup"><span data-stu-id="47609-227">When the data center comes back online the old primaries automatically reconnect to the new primary and become secondary databases.</span></span> <span data-ttu-id="47609-228">Если базу данных-источник необходимо повторно переместить в исходный регион, вы можете вручную запустить плановую отработку отказа (восстановление размещения).</span><span class="sxs-lookup"><span data-stu-id="47609-228">If you need to relocate the primary back to the original region, you can initiate a planned failover manually (failback).</span></span> 
> 

### <a name="perform-a-geo-restore"></a><span data-ttu-id="47609-229">Процедура геовосстановления</span><span class="sxs-lookup"><span data-stu-id="47609-229">Perform a geo-restore</span></span>
<span data-ttu-id="47609-230">При использовании автоматически создаваемых резервных копий и репликации в геоизбыточное хранилище в качестве механизма восстановления можно [начать восстановление базы данных с помощью геовосстановления](sql-database-disaster-recovery.md#recover-using-geo-restore).</span><span class="sxs-lookup"><span data-stu-id="47609-230">If you are using automated backups with geo-redundant storage replication as your recovery mechanism, [initiate a database recovery using geo-restore](sql-database-disaster-recovery.md#recover-using-geo-restore).</span></span> <span data-ttu-id="47609-231">Обычно восстановление будет выполнено в пределах 12 часов с потерей данных за период до 1 часа, что зависит от времени создания и репликации последней ежечасной разностной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="47609-231">Recovery usually takes place within 12 hours - with data loss of up to one hour determined by when the last hourly differential backup with taken and replicated.</span></span> <span data-ttu-id="47609-232">До завершения восстановления база данных не может записывать какие-либо транзакции или отвечать на запросы.</span><span class="sxs-lookup"><span data-stu-id="47609-232">Until the recovery completes, the database is unable to record any transactions or respond to any queries.</span></span> <span data-ttu-id="47609-233">Хотя база данных будет восстановлена до последней доступной точки во времени, восстановление геореплицируемых данных до любой точки во времени сейчас не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="47609-233">While this restores a database to the last available point in time, restoring the geo-secondary to any point in time is not currently supported.</span></span>

> [!NOTE]
> <span data-ttu-id="47609-234">Если работа центра обработки данных возобновится до переключения приложения на восстановленную базу данных, то можно будет отменить восстановление.</span><span class="sxs-lookup"><span data-stu-id="47609-234">If the data center comes back online before you switch your application over to the recovered database, you can cancel the recovery.</span></span>  
>
>

### <a name="perform-post-failover--recovery-tasks"></a><span data-ttu-id="47609-235">Выполнение задач после восстановления размещения и восстановления</span><span class="sxs-lookup"><span data-stu-id="47609-235">Perform post failover / recovery tasks</span></span>
<span data-ttu-id="47609-236">После восстановления посредством любого из механизмов восстановления необходимо выполнить следующие дополнительные задачи, прежде чем данные пользователей и приложений будут заархивированы, а они смогут возобновить работу.</span><span class="sxs-lookup"><span data-stu-id="47609-236">After recovery from either recovery mechanism, you must perform the following additional tasks before your users and applications are back up and running:</span></span>

* <span data-ttu-id="47609-237">Перенаправьте клиенты и клиентские приложения на новый сервер и восстановленную базу данных.</span><span class="sxs-lookup"><span data-stu-id="47609-237">Redirect clients and client applications to the new server and restored database</span></span>
* <span data-ttu-id="47609-238">Убедитесь, что заданы соответствующие правила брандмауэра уровня сервера, позволяющие пользователям подключаться (или используйте [брандмауэры уровня базы данных](sql-database-firewall-configure.md#creating-and-managing-firewall-rules)).</span><span class="sxs-lookup"><span data-stu-id="47609-238">Ensure appropriate server-level firewall rules are in place for users to connect (or use [database-level firewalls](sql-database-firewall-configure.md#creating-and-managing-firewall-rules))</span></span>
* <span data-ttu-id="47609-239">Убедитесь, что заданы соответствующие имена для входа и разрешения уровня базы данных master (или используйте [автономных пользователей](https://msdn.microsoft.com/library/ff929188.aspx)).</span><span class="sxs-lookup"><span data-stu-id="47609-239">Ensure appropriate logins and master database level permissions are in place (or use [contained users](https://msdn.microsoft.com/library/ff929188.aspx))</span></span>
* <span data-ttu-id="47609-240">Настройте аудит соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="47609-240">Configure auditing, as appropriate</span></span>
* <span data-ttu-id="47609-241">Настройте оповещения соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="47609-241">Configure alerts, as appropriate</span></span>

## <a name="upgrade-an-application-with-minimal-downtime"></a><span data-ttu-id="47609-242">Обновление приложения с минимальным простоем</span><span class="sxs-lookup"><span data-stu-id="47609-242">Upgrade an application with minimal downtime</span></span>
<span data-ttu-id="47609-243">Иногда приложение нужно перевести в автономный режим для планового обслуживания, например, чтобы обновить его.</span><span class="sxs-lookup"><span data-stu-id="47609-243">Sometimes an application must be taken offline because of planned maintenance such as an application upgrade.</span></span> <span data-ttu-id="47609-244">В статье [Управление последовательными обновлениями для облачных приложений с помощью активной георепликации базы данных SQL](sql-database-manage-application-rolling-upgrade.md) описывается, как с помощью активной георепликации обеспечить последовательное обновление облачного приложения, чтобы свести к минимуму простой при обновлениях и обеспечить путь восстановления, если случится сбой.</span><span class="sxs-lookup"><span data-stu-id="47609-244">[Manage application upgrades](sql-database-manage-application-rolling-upgrade.md) describes how to use active geo-replication to enable rolling upgrades of your cloud application to minimize downtime during upgrades and provide a recovery path if something goes wrong.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="47609-245">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="47609-245">Next steps</span></span>
<span data-ttu-id="47609-246">Вопросы разработки приложений для автономных баз данных и пулов эластичных БД рассматриваются в статьях [Создание приложения для аварийного восстановления облака с использованием активной георепликации в базе данных SQL](sql-database-designing-cloud-solutions-for-disaster-recovery.md) и [Стратегии аварийного восстановления для приложений с использованием пула эластичных баз данных SQL](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="47609-246">For a discussion of application design considerations for stand-alone databases and for elastic pools, see [Design an application for cloud disaster recovery](sql-database-designing-cloud-solutions-for-disaster-recovery.md) and [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
