---
title: "непрерывность бизнеса aaaCloud — при восстановлении базы данных — база данных SQL | Документы Microsoft"
description: "Узнайте, как базы данных SQL Azure поддерживают непрерывное выполнение облачных бизнес-процессов и восстановление баз данных, а также помогают обеспечить выполнение важных облачных приложений."
keywords: "непрерывность бизнес-процессов, непрерывность облачных бизнес-процессов, аварийное восстановление базы данных, восстановление базы данных"
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: 
ms.assetid: 18e5d3f1-bfe5-4089-b6fd-76988ab29822
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 05/15/2017
ms.author: sashan
ms.openlocfilehash: c9a6ff86fbbc04ce839a4fca79594b573b71644c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="overview-of-business-continuity-with-azure-sql-database"></a>Обзор обеспечения непрерывности бизнес-процессов с помощью базы данных SQL Azure

В этом обзоре описываются возможности hello, предоставляемые для непрерывности и аварийного восстановления базы данных SQL Azure. Дополнительные сведения о возможностях, рекомендации и руководства по восстановлению после аварийного события, которые могут привести к потере данных или привести к вашей базы данных и приложения toobecome недоступна. Какие toodo сведения, если ошибка пользователя или приложения влияет на целостность данных, региона Azure имеет сбоя или приложение требует обслуживания.

## <a name="sql-database-features-that-you-can-use-tooprovide-business-continuity"></a>Функции базы данных SQL, которые можно использовать tooprovide непрерывность бизнеса

База данных SQL предоставляет несколько функций обеспечения непрерывности бизнес-процессов, включая автоматизированную архивацию и необязательную репликацию баз данных. У каждой из них разные параметры оценки времени восстановления (ERT) и возможной потери данных последних транзакций. Поняв, на что влияют эти параметры, вы сможете выбрать те, которые вам подходят, и, в большинстве случаев, использовать их вместе в различных сценариях. При разработке плана обеспечения непрерывности бизнес-процессов, вам необходимо toounderstand hello максимально допустимого времени перед приложения hello полностью восстанавливается после аварийного события hello — это на время восстановления (RTO). Необходимо также toounderstand hello максимальный объем последние приложения hello обновлений (интервал времени) данные можно переносить без утраты при восстановлении после аварийного события hello — это ваш точка восстановления (RPO).

Следующая таблица сравнивает Hello hello ERT и RPO для hello три наиболее распространенных сценариев.

| Функция | Уровень Basic | Уровень Standard | Уровень Premium |
| --- | --- | --- | --- |
| Восстановление до точки во времени из резервной копии |Все точки восстановления в течение 7 дней |Все точки восстановления в течение 35 дней |Все точки восстановления в течение 35 дней |
| Геовосстановление из геореплицированных резервных копий |ERT < 12 ч, RPO < 1 ч |ERT < 12 ч, RPO < 1 ч |ERT < 12 ч, RPO < 1 ч |
| Восстановление из хранилища службы архивации Azure |ERT < 12 ч, RPO < 1 нед. |ERT < 12 ч, RPO < 1 нед. |ERT < 12 ч, RPO < 1 нед. |
| Активная георепликация |ERT < 30 с, RPO < 5 с |ERT < 30 с, RPO < 5 с |ERT < 30 с, RPO < 5 с |

### <a name="use-database-backups-toorecover-a-database"></a>Используйте резервные копии базы данных toorecover базы данных

База данных SQL автоматически выполняет сочетание полные резервные копии раз в неделю, разностные резервные копии каждый час и журнала транзакций резервное копирование каждые пять — через десять минут tooprotect бизнеса от потери данных. Эти резервные копии хранятся в географически избыточное хранилище для 35 дней для баз данных в уровней служб Standard и Premium hello и 7 дней для баз данных в уровень обслуживания Basic hello. Чтобы узнать больше, ознакомьтесь со сведениями об [уровнях служб](sql-database-service-tiers.md). Если hello срок хранения для службы на уровне не соответствует требованиям организации, можно увеличить срок хранения hello, [изменение уровня служб hello](sql-database-service-tiers.md). Hello полной и разностной резервной копии, также реплицированных tooa [парной ЦОД](../best-practices-availability-paired-regions.md) для защиты от сбоя центра обработки данных. Дополнительные сведения см. в статье [Подробнее о резервном копировании базы данных SQL](sql-database-automated-backups.md).

Если встроенные срок hello не достаточно для вашего приложения, его можно расширить, настроив политику долгосрочного хранения базы данных. Дополнительные сведения см. в статье [Хранение резервных копий базы данных SQL Azure до 10 лет](sql-database-long-term-retention.md).

Можно использовать toorecover резервные копии этих баз данных автоматически базы данных из различных событий нарушают работу, как внутри вашего центра обработки данных и tooanother data center. Использование резервных копий баз данных автоматически, hello предполагаемое время восстановления определяется несколькими факторами, включая общее число баз данных, восстановление hello же hello области в hello же времени, hello размер базы данных, размера журнала транзакций hello и пропускной способности сети. время восстановления Hello обычно является менее чем на 12 часов. При восстановлении tooanother области данных, hello потеря данных — ограниченный too1 час по hello географически избыточное хранилище с почасовой разностные резервные копии.

> [!IMPORTANT]
> с помощью toorecover автоматическое резервное копирование, должен быть членом роли участника SQL Server hello или hello владельца подписки — см. [RBAC: встроенные роли](../active-directory/role-based-access-built-in-roles.md). Можно восстановить с помощью hello портал Azure, PowerShell или API-интерфейса REST hello. Использовать для этого Transact-SQL невозможно.
>

Используйте автоматически создаваемые резервные копии для обеспечения непрерывности бизнес-процессов и восстановления, если ваше приложение:

* не является критически важным;
* на него не распространяется действие соглашений об уровне обслуживания, то есть перерыв в работе на 24 часа и более не повлечет финансовой ответственности;
* Низкая скорость изменения данных (низкий транзакций в час) и потери копии tooan часы изменения — допустимая потеря данных.
* имеет ограниченный бюджет.

Если вам требуется более быстрое восстановление, используйте [активную георепликацию](sql-database-geo-replication-overview.md) (рассматривается далее). Данные могут toorecover toobe из более ранней, чем 35 дней периода, используйте [долгосрочного хранения резервной копии](sql-database-long-term-retention.md). 

### <a name="use-active-geo-replication-and-auto-failover-groups-in-preview-tooreduce-recovery-time-and-limit-data-loss-associated-with-a-recovery"></a>Использование активной георепликации и автоматического перехода на другой ресурс групп (в-Предварительная версия) tooreduce восстановления времени и ограничение потерю данных во время операции восстановления

В дополнение к этому toousing резервные копии баз данных для базы данных восстановления в случае прерывания бизнеса, можно использовать [активной георепликации](sql-database-geo-replication-overview.md) tooconfigure toohave базы данных копирование toofour для чтения базы данных-получатели в регионах hello из вашей Выбор. Эти базы данных-получатели синхронизируется с hello базы данных-источника с помощью асинхронной репликации. Этот компонент является используется tooprotect к прерыванию бизнеса в случае сбоя центра обработки данных или во время обновления приложения. Активная георепликация также можно повысить производительность запросов используется tooprovide для пользователей toogeographically распределенные запросы только для чтения.

Автоматическое tooenable и прозрачной отработки отказа, следует разделить географической репликации баз данных в группы с помощью hello [автоматического перехода на другой ресурс группы](sql-database-geo-replication-overview.md) функции базы данных SQL (в предварительного просмотра).

Если база данных-источник hello неожиданном или требуется tootake его в автономный режим для действий по обслуживанию, можно быстро повысить уровень основного получателя toobecome hello (также называемые отработки отказа) и настроить первичный toohello повышается tooconnect приложений. Если приложение подключается toohello баз данных, с помощью прослушивателя группы hello отработки отказа, не требуется настройка строк подключения SQL hello toochange после отработки отказа. При плановой отработке отказа потеря данных отсутствует. С незапланированной отработки отказа могут возникнуть некоторые небольшой объем потери данных для операций с самую последнюю из-за характера toohello асинхронной репликации. Использование групп для автоматического перехода на другой ресурс (в предварительного просмотра), вы можете настроить hello отработки отказа политики toominimize hello возможной потери данных. После отработки отказа можно выполнить восстановление размещения более поздней версии — соответствующим tooa плана или когда центра обработки данных hello в оперативный. Во всех случаях пользователей короткое время простоя и требуется tooreconnect.

> [!IMPORTANT]
> toouse активной георепликации и автоматического перехода на другой ресурс группы (в предварительного просмотра), должен либо быть hello владельца подписки или иметь разрешения системного администратора SQL Server. Можно настроить и отработки отказа с помощью hello портал Azure PowerShell или hello API REST с помощью разрешений подписки Azure или с помощью Transact-SQL с разрешениями SQL Server.
> 

Используйте активную георепликацию и группы автоматической отработки отказа (в предварительной версии), если ваше приложение удовлетворяет какому-либо из следующих требований:

* оно является критически важным;
* регулируется соглашением об уровне обслуживания (SLA), которое не допускает более 24 часов простоя;
* его простой может повлечь финансовую ответственность;
* имеет высокую частоту изменения данных, и потеря данных за час не допускается;
* Дополнительные затраты Hello активной георепликации меньше, чем hello потенциальных финансовых ответственности и связанные потери бизнес.

>
> [!VIDEO https://channel9.msdn.com/Blogs/Azure/Azure-SQL-Database-protecting-important-DBs-from-regional-disasters-is-easy/player]
>

## <a name="recover-a-database-after-a-user-or-application-error"></a>Восстановление базы данных после ошибки пользователя или приложения
*Никто не совершенен! Пользователь может случайно удалить данные, важную таблицу или даже всю базу данных. Или приложения может случайно перезаписан хорошие данные с недопустимых данных из-за ошибку tooan приложения.

Ниже приведены возможные варианты восстановления в данном случае.

### <a name="perform-a-point-in-time-restore"></a>Восстановление до точки во времени
Hello автоматических резервных копий toorecover копию вашей базы данных, tooa известная хорошая точка в времени, можно использовать при условии, что время находится в пределах срока хранения hello базы данных. После восстановления базы данных hello можно заменить hello исходная база данных восстановлена hello базой данных или скопировать hello необходимые данные из hello восстановления данных в исходной базе данных hello. Если hello база данных использует активную георепликацию, мы рекомендуем копирование hello необходимых данных из копии восстановить hello в исходной базе данных hello. При замене hello исходной базы данных с базой данных восстановления hello, требуется tooreconfigure и повторная синхронизация активной георепликации, (что может занять некоторое время, для больших баз данных).

Дополнительные сведения и подробные инструкции по восстановлению базы данных tooa на момент времени с помощью hello портал Azure или с помощью PowerShell, см. раздел [восстановления на момент](sql-database-recovery-using-backups.md#point-in-time-restore). Для восстановления невозможно использовать Transact-SQL.

### <a name="restore-a-deleted-database"></a>Восстановление удаленной базы данных.
Если hello база данных будет удалена, но hello логический сервер не был удален, вы сможете восстановить точки toohello базы данных hello удалены, в которой он был удален. Это восстанавливает toohello резервного копирования базы данных одном логическом сервере SQL, из которого он был удален. Можно восстановить его с помощью hello исходное имя или укажите новое имя или hello восстановления базы данных.

Дополнительные сведения и подробные шаги для восстановления удаленной базы данных с помощью hello портала Azure или с помощью PowerShell, см. [Восстановление удаленной базы данных](sql-database-recovery-using-backups.md#deleted-database-restore). Для восстановления невозможно использовать Transact-SQL.

> [!IMPORTANT]
> Если удаляется hello логического сервера, невозможно восстановить удаленную базу данных.
>
>

### <a name="restore-from-azure-backup-vault"></a>Восстановление из хранилища службы архивации Azure
Если база данных настроена для долгосрочного хранения hello потери данных за пределами hello текущий срок хранения для автоматического создания резервных копий, можно восстановить из еженедельного резервного копирования в новую базу данных tooa резервное хранилище Azure. На этом этапе можно заменить hello исходная база данных базой данных восстановления hello или копирования hello необходимые данные из базы данных восстановлена hello в исходной базе данных hello. Если вам требуется tooretrieve старая версия обновления базы данных предыдущей tooa главному приложению, удовлетворения запроса из аудиторы или юридическое заказа, можно создать базу данных с помощью полной резервной копии, сохраненные в hello резервное хранилище Azure.  Дополнительные сведения см. в статье [Storing Azure SQL Database Backups for up to 10 years](sql-database-long-term-retention.md) (Хранение резервных копий баз данных SQL Azure до 10 лет).

## <a name="recover-a-database-tooanother-region-from-an-azure-regional-data-center-outage"></a>Восстановление после отключения центра обработки данных Azure региональных tooanother области базы данных
<!-- Explain this scenario -->

В редких случаях возможен сбой центра обработки данных Azure. Такой сбой вызывает нарушение работы компании, которое может длиться от считанных минут до нескольких часов.

* Один из вариантов — toowait для вашей базы данных toocome обратно в оперативный режим, при наведении hello отключения центра обработки данных. Это работает для приложений, которые допускают toohave hello базу данных. Например проект разработки или бесплатной пробной версии не требуется toowork на постоянно. После сбоя центра обработки данных вы не знаете hello сбоя может длительности, поэтому этот параметр используется, только если базы данных не требуется некоторое время.
* Другой вариант — tooeither fail над областью данных tooanother, если вы используете активной георепликации или hello восстановления базы данных с помощью геоизбыточных баз данных резервных копий (геовосстановление). Отработка отказа занимает несколько секунд, тогда как на восстановление базы данных из резервных копий требуются часы.

При выполнении действия, как долго вы toorecover и сколько при этом потери данных зависит как определяют toouse этих функций обеспечения непрерывности бизнеса в приложении. На самом деле вы можете toouse сочетание резервные копии баз данных и активной георепликации в зависимости от требований приложения. Вопросы разработки приложений для автономных баз данных и пулов эластичных БД, использующих эти возможности обеспечения непрерывности бизнес-процессов, рассматриваются в статьях [Создание приложения для аварийного восстановления облака с использованием активной георепликации в базе данных SQL](sql-database-designing-cloud-solutions-for-disaster-recovery.md) и [Стратегии аварийного восстановления для приложений с использованием пула эластичных баз данных SQL](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).

Hello следующих разделах содержатся общие сведения о toorecover hello действия, с помощью резервных копий базы данных или активной георепликации. Подробное описание действий, включая планирование требований, действия по восстановлению post и сведения о как toosimulate tooperform сбоя аварийного восстановления детализации см. в разделе [восстановление после сбоя базы данных SQL](sql-database-disaster-recovery.md).

### <a name="prepare-for-an-outage"></a>Подготовка к сбою
Независимо от того, hello функция обеспечения непрерывности бизнеса, используемая необходимо выполнить следующее:

* Определите и подготовьте целевой сервер hello, включая правила брандмауэра уровня сервера, имена входа и разрешения на уровне базы данных master.
* Определить, каким образом tooredirect клиентов и клиентских приложений toohello новый сервер
* Задокументируйте прочие зависимости, такие как параметры аудита и оповещения.

Без соответствующей подготовки возобновление работы приложений после отработки отказа или восстановления базы данных занимает больше времени и, вероятно, также требует устранения неполадок во время стрессовой нагрузки, а это весьма неудачное сочетание.

### <a name="fail-over-tooa-geo-replicated-secondary-database"></a>При сбое tooa географическая репликация базы данных-получателя
При использовании активной георепликации и групп автоматической отработки отказа (в предварительной версии) в качестве механизма восстановления можно настроить политику автоматической отработки отказа или использовать [ручную отработку отказа](sql-database-disaster-recovery.md#fail-over-to-geo-replicated-secondary-database). После инициализации вторичной toobecome причины перехода на другой ресурс hello hello hello новый первичный и готов toorecord новых транзакций и реагировать tooqueries - с минимальной потерей данных для еще не реплицированные данные hello. Сведения о разработке hello процесс отработки отказа см. в разделе [создания приложения для восстановления после сбоев облачных](sql-database-designing-cloud-solutions-for-disaster-recovery.md).

> [!NOTE]
> При hello центра обработки данных в оперативный hello в источниках старого автоматически toohello новой первичной реплике повторно подключиться и стать баз данных-получателей. При необходимости toorelocate hello основной серверной toohello исходной области, можно запустить плановую отработку отказа вручную (восстановление). 
> 

### <a name="perform-a-geo-restore"></a>Процедура геовосстановления
При использовании автоматически создаваемых резервных копий и репликации в геоизбыточное хранилище в качестве механизма восстановления можно [начать восстановление базы данных с помощью геовосстановления](sql-database-disaster-recovery.md#recover-using-geo-restore). Восстановление обычно занимает место в течение 12 часов - потери данных вверх tooone час определяется при hello последнего почасовой разностной резервной копии, сделанной и реплицированные. До завершения восстановления hello, hello или базы данных не удается toorecord всех транзакций отвечает tooany запросы. При этом восстанавливается база данных toohello последней доступной точки времени, восстановление точки получателя geo tooany hello времени не поддерживается в настоящее время.

> [!NOTE]
> Если центр обработки данных hello в оперативный до перехода приложения через toohello восстановленной базы данных, можно отменить hello восстановления.  
>
>

### <a name="perform-post-failover--recovery-tasks"></a>Выполнение задач после восстановления размещения и восстановления
После восстановления из любого из этих механизмов восстановления необходимо выполнить hello следующие дополнительные задачи, прежде чем пользователи и приложения создайте резервную копию и под управлением:

* Перенаправить клиентов и клиентских приложений toohello нового сервера и восстановленной базе данных
* Убедитесь в наличии для пользователей tooconnect правила брандмауэра на уровне сервера соответствующие (или используйте [брандмауэров уровня базы данных](sql-database-firewall-configure.md#creating-and-managing-firewall-rules))
* Убедитесь, что заданы соответствующие имена для входа и разрешения уровня базы данных master (или используйте [автономных пользователей](https://msdn.microsoft.com/library/ff929188.aspx)).
* Настройте аудит соответствующим образом.
* Настройте оповещения соответствующим образом.

## <a name="upgrade-an-application-with-minimal-downtime"></a>Обновление приложения с минимальным простоем
Иногда приложение нужно перевести в автономный режим для планового обслуживания, например, чтобы обновить его. [Управление обновлениями приложений](sql-database-manage-application-rolling-upgrade.md) описывает принцип tooenable активной георепликации toouse обновления время простоя toominimize облачные приложения во время обновления и предоставить путь восстановления, если что-то пойдет не так. 

## <a name="next-steps"></a>Дальнейшие действия
Вопросы разработки приложений для автономных баз данных и пулов эластичных БД рассматриваются в статьях [Создание приложения для аварийного восстановления облака с использованием активной георепликации в базе данных SQL](sql-database-designing-cloud-solutions-for-disaster-recovery.md) и [Стратегии аварийного восстановления для приложений с использованием пула эластичных баз данных SQL](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).
