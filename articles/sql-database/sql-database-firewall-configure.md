---
title: "правила брандмауэра базы данных SQL aaaAzure | Документы Microsoft"
description: "Узнайте, как tooconfigure SQL базы данных брандмауэра с доступом toomanage правила брандмауэра уровня сервера и уровня базы данных."
keywords: "брандмауэр базы данных"
services: sql-database
documentationcenter: 
author: BYHAM
manager: jhubbard
editor: cgronlun
tags: 
ms.assetid: ac57f84c-35c3-4975-9903-241c8059011e
ms.service: sql-database
ms.custom: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-management
ms.date: 04/10/2017
ms.author: rickbyh
ms.openlocfilehash: 6a8cdf629d0d0e55421a5e9f9b894a21371be568
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="azure-sql-database-server-level-and-database-level-firewall-rules"></a>Правила брандмауэра уровня сервера и уровня базы данных SQL Azure 

База данных SQL Microsoft Azure предоставляет службу реляционных баз данных для Azure и других интернет-приложений. toohelp защитить свои данные, брандмауэр не все сервера базы данных access tooyour, пока вы не укажете компьютеры, на которых есть разрешение. Hello брандмауэр предоставляет доступ toodatabases основании hello, рассчитанные на IP-адреса каждого запроса.

## <a name="overview"></a>Обзор

Изначально все Azure SQL server Transact-SQL доступа tooyour заблокирован брандмауэром hello. toobegin с помощью сервера Azure SQL, необходимо указать одно или несколько правил брандмауэра уровня сервера, позволяющих доступ к tooyour Azure SQL server. Используйте toospecify правила брандмауэра hello, какой IP-адрес в диапазоне от Интернета разрешены hello и ли приложения Azure может попытаться выполнить tooconnect tooyour Azure SQL server.

tooselectively toojust доступа grant одной из баз данных hello в сервер Azure SQL, необходимо создать правило уровня базы данных для базы данных, необходимых hello. Укажите диапазон IP-адресов для правила брандмауэра базы данных hello, который выходит за пределы hello IP-адреса диапазона, указанного в правиле брандмауэра уровня сервера hello и убедитесь, что IP-адрес hello hello клиента находится в диапазоне hello, указанные в правиле уровня базы данных hello.

Здравствуйте, попытки соединения из Интернета и Azure должны сначала пройти через брандмауэр hello прежде чем достигнут сервера Azure SQL или база данных SQL, как показано в hello, следующая схема:

   ![Схема, описывающая конфигурацию брандмауэра.][1]

* **Правила брандмауэра на уровне сервера:** эти правила позволяют клиентам tooaccess всего сервера Azure SQL, то есть все базы данных hello в hello на одном логическом сервере. Эти правила хранятся в hello **master** базы данных. Правила брандмауэра уровня сервера можно настроить с помощью портала hello, или с помощью инструкций Transact-SQL. правила брандмауэра уровня сервера toocreate с помощью портала Azure hello или PowerShell, необходимо быть hello владельца подписки или подписки участником. toocreate правил брандмауэра уровня сервера с помощью Transact-SQL, необходимо подключить toohello экземпляр базы данных SQL, как имя входа субъекта серверного уровня hello или Здравствуйте, администратор Azure Active Directory (это означает, что необходимо создать правило брандмауэра уровня сервера пользователь с разрешениями уровня Azure).
* **Правила брандмауэра уровня базы данных:** эти правила позволяют клиентам tooaccess определенным (защищенным) баз данных в пределах hello таким же логическом сервере. Можно создать эти правила для каждой базы данных (включая hello **master** database0) и они хранятся в отдельных hello баз данных. Правила брандмауэра уровня базы данных можно настроить только с помощью инструкций Transact-SQL и только после настройки hello первый брандмауэра на уровне сервера. Если указать диапазон IP-адресов в правиле брандмауэра уровня базы данных hello, находится вне hello диапазона, указанного в правиле брандмауэра уровня сервера hello, только тех клиентов, которые имеют IP-адреса в диапазоне уровня базы данных hello можно доступа к базе данных hello. Для базы данных можно задать не более 128 правил брандмауэра уровня базы данных. Правила брандмауэра уровня базы данных для базы данных master и пользовательской базы данных можно создать и контролировать только с помощью Transact-SQL. Дополнительные сведения о настройке правил брандмауэра уровня базы данных см. пример hello позже в этом статьи и в разделе [sp_set_database_firewall_rule (базы данных SQL Azure)](https://msdn.microsoft.com/library/dn270010.aspx).

**Рекомендация:** Корпорация Майкрософт рекомендует использовать правила брандмауэра уровня базы данных каждый раз, когда возможно tooenhance безопасности и toomake более переносимой базы данных. Использовать правила брандмауэра уровня сервера для администраторов и при наличии много баз данных, которые имеют hello же требований к доступу и не требуется времени toospend конфигурации по отдельности каждой базы данных.

> [!Note]
> Сведения о переносимой базы данных в контексте hello непрерывности бизнеса см. в разделе [требования проверки подлинности для аварийного восстановления](sql-database-geo-replication-security-config.md).
>

### <a name="connecting-from-hello-internet"></a>Подключение из Интернета hello

Когда компьютер пытается tooconnect tooyour базы данных сервера из hello Интернета, брандмауэр hello сначала проверяет hello, рассчитанные на IP-адреса запроса hello с правилами брандмауэра уровня базы данных hello, для базы данных hello, запрашивающего подключение hello:

* Если в одном из диапазонов hello, указанных в правилах брандмауэра уровня базы данных hello hello IP-адреса запроса hello, hello предоставляется возможность подключения toohello базы данных SQL, содержащего правило hello.
* Если IP-адреса hello hello запроса не в одном из диапазонов hello, указанным в правиле брандмауэра уровня базы данных hello, проверяются правила брандмауэра уровня сервера hello. Если в одном из диапазонов hello, указанных в правилах брандмауэра уровня сервера hello hello IP-адреса запроса hello, предоставляется возможность подключения hello. Tooall баз данных SQL применяются правила брандмауэра уровня сервера на сервере Azure SQL hello.  
* Если IP-адреса hello hello запроса находится за пределами hello диапазонов, указанных в hello уровня базы данных или правила брандмауэра уровня сервера, происходит сбой запроса подключения hello.

> [!NOTE]
> tooaccess базы данных SQL Azure с локального компьютера, убедитесь, что hello брандмауэр сети и локального компьютера разрешает исходящие соединения через TCP-порт 1433.
> 

### <a name="connecting-from-azure"></a>Подключение из Azure
необходимо включить tooallow приложений с Azure tooconnect tooyour Azure SQL server, соединения с Azure. Когда приложение из Azure пытается tooconnect tooyour базы данных сервера, hello брандмауэр проверяет, что разрешены соединения с Azure. Параметр брандмауэра с начальный и конечный адреса равно too0.0.0.0 указывает, что эти соединения разрешены. Если попытка соединения hello не разрешена, hello запроса не достигает сервера базы данных SQL Azure hello.

> [!IMPORTANT]
> Этот параметр настраивает брандмауэр tooallow hello все подключения от Azure подключений, включая из подписок hello других клиентов. Если при выборе этого параметра убедитесь, что имя входа и разрешения пользователя ограничить доступ tooonly авторизованных пользователей.
> 

## <a name="creating-and-managing-firewall-rules"></a>Создание правил брандмауэра и управление ими
Hello первый параметр брандмауэра уровня сервера можно создать, используя hello [портал Azure](https://portal.azure.com/) или программным путем, используя [Azure PowerShell](https://msdn.microsoft.com/library/azure/dn546724.aspx), [Azure CLI](/cli/azure/sql/server/firewall-rule#create), или hello [API-интерфейса REST](https://msdn.microsoft.com/library/azure/dn505712.aspx). Последующие правила брандмауэра уровня сервера можно создавать и контролировать с помощью этих методов и Transact-SQL. 

> [!IMPORTANT]
> Правила брандмауэра уровня базы данных можно создавать только с помощью Transact-SQL. То же самое касается и управления ими. 
>

tooimprove производительности на уровне базы данных hello временно кэшируется правила брандмауэра на уровне сервера. кэш hello toorefresh, в разделе [DBCC FLUSHAUTHCACHE](https://msdn.microsoft.com/library/mt627793.aspx). 

> [!TIP]
> Можно использовать [аудита базы данных SQL](sql-database-auditing.md) tooaudit брандмауэра уровня сервера и уровня базы данных изменений.
>

### <a name="azure-portal"></a>Портал Azure

tooset правила брандмауэра уровня сервера в hello портал Azure, вы можете перейти страница обзора toohello страницы Общие сведения о базе данных или hello Azure SQL для логического сервера базы данных Azure.

> [!TIP]
> См. в разделе [Создание базы данных с использованием hello портал Azure](sql-database-get-started-portal.md).
>

**На странице обзора базы данных**

1. tooset правила брандмауэра уровня сервера на основе страница обзора hello базы данных, нажмите кнопку **установить брандмауэр сервера** на hello инструментов, как показано в hello после изображения: hello **параметры брандмауэра** страница hello SQL Откроется сервер базы данных.

      ![правило брандмауэра для сервера](./media/sql-database-get-started-portal/server-firewall-rule.png) 

2. Нажмите кнопку **добавить IP-адрес клиента** на hello инструментов tooadd hello IP-адрес компьютера hello используют в настоящее время и нажмите кнопку **Сохранить**. Для текущего IP-адреса будет создано правило брандмауэра уровня сервера.

      ![Настройка правила брандмауэра для сервера](./media/sql-database-get-started-portal/server-firewall-rule-set.png) 

**На странице обзора сервера**

Hello страница общих сведений для server открывается, показывающая вы полностью hello доменное имя сервера (таких как **mynewserver20170403.database.windows.net**) и предоставляет параметры для дальнейшей настройки.

1. Щелкните tooset правило уровня сервера на странице Общие сведения о сервере **брандмауэра** в левом меню hello в списке параметров, как показано в hello после изображения: 

     ![Общие сведения о логическом сервере](./media/sql-database-migrate-your-sql-server-database/logical-server-overview.png)

2. Нажмите кнопку **добавить IP-адрес клиента** на hello инструментов tooadd hello IP-адрес компьютера hello используют в настоящее время и нажмите кнопку **Сохранить**. Для текущего IP-адреса будет создано правило брандмауэра уровня сервера.

     ![Настройка правила брандмауэра для сервера](./media/sql-database-migrate-your-sql-server-database/server-firewall-rule-set.png)

### <a name="transact-sql"></a>Transact-SQL
| Представление каталога или хранимая процедура | Уровень | Описание |
| --- | --- | --- |
| [sys.firewall_rules](https://msdn.microsoft.com/library/dn269980.aspx) |сервер; |Отображает текущие правила брандмауэра уровня сервера hello |
| [sp_set_firewall_rule](https://msdn.microsoft.com/library/dn270017.aspx) |сервер; |Создает или обновляет правила брандмауэра уровня сервера |
| [sp_delete_firewall_rule](https://msdn.microsoft.com/library/dn270024.aspx) |сервер; |Удаляет правила брандмауэра уровня сервера |
| [sys.database_firewall_rules](https://msdn.microsoft.com/library/dn269982.aspx) |База данных |Отображает текущие правила брандмауэра уровня базы данных hello |
| [sp_set_database_firewall_rule](https://msdn.microsoft.com/library/dn270010.aspx) |База данных |Создает или обновляет правила брандмауэра уровня базы данных hello |
| [sp_delete_database_firewall_rule](https://msdn.microsoft.com/library/dn270030.aspx) |Базы данных |Удаляет правила брандмауэра на уровне базы данных |


Hello следующие примеры просматривать существующие правила hello, включить диапазон IP-адресов на сервере hello Contoso и удаляет правило брандмауэра:
   
```sql
SELECT * FROM sys.firewall_rules ORDER BY name;
```
  
Добавьте правило брандмауэра.
   
```sql
EXECUTE sp_set_firewall_rule @name = N'ContosoFirewallRule',
   @start_ip_address = '192.168.1.1', @end_ip_address = '192.168.1.10'
```

toodelete правило брандмауэра уровня сервера, выполните hello sp_delete_firewall_rule хранимой процедуры. Hello следующий пример удаляет hello правило с именем ContosoFirewallRule:
   
```sql
EXECUTE sp_delete_firewall_rule @name = N'ContosoFirewallRule'
```   

### <a name="azure-powershell"></a>Azure PowerShell
| Командлет | Уровень | Описание |
| --- | --- | --- |
| [Get-AzureSqlDatabaseServerFirewallRule](https://msdn.microsoft.com/library/azure/dn546731.aspx) |сервер; |Возвращает текущие правила брандмауэра уровня сервера hello |
| [New-AzureSqlDatabaseServerFirewallRule](https://msdn.microsoft.com/library/azure/dn546724.aspx) |сервер; |Создает новое правило брандмауэра уровня сервера |
| [Set-AzureSqlDatabaseServerFirewallRule](https://msdn.microsoft.com/library/azure/dn546739.aspx) |сервер; |Обновляет свойства hello существующего правила брандмауэра на уровне сервера |
| [Remove-AzureSqlDatabaseServerFirewallRule](https://msdn.microsoft.com/library/azure/dn546727.aspx) |сервер; |Удаляет правила брандмауэра уровня сервера |


Следующий пример Hello задает правила брандмауэра уровня сервера, с помощью PowerShell:

```powershell
New-AzureRmSqlServerFirewallRule -ResourceGroupName "myResourceGroup" `
    -ServerName $servername `
    -FirewallRuleName "AllowSome" -StartIpAddress "0.0.0.0" -EndIpAddress "0.0.0.0"
```

> [!TIP]
> Примеры PowerShell в контексте hello быстрого запуска см. в разделе [создать база данных — PowerShell](sql-database-get-started-powershell.md) и [создать одну базу данных и настроить правила брандмауэра с помощью PowerShell](scripts/sql-database-create-and-configure-database-powershell.md)
>

### <a name="azure-cli"></a>Инфраструктура CLI Azure
| Командлет | Уровень | Описание |
| --- | --- | --- |
| [az sql server firewall create](/cli/azure/sql/server/firewall-rule#create) | Создает брандмауэра правило tooallow доступа tooall баз данных SQL на сервере hello из hello ввести диапазон IP-адресов.|
| [az sql server firewall delete](/cli/azure/sql/server/firewall-rule#delete)| Удаляет правило брандмауэра.|
| [az sql server firewall list](/cli/azure/sql/server/firewall-rule#list)| Список правил брандмауэра hello.|
| [az sql server firewall rule show](/cli/azure/sql/server/firewall-rule#show)| Отображает подробные сведения hello правила брандмауэра.|
| [ax sql server firewall rule update](/cli/azure/sql/server/firewall-rule#update)| Обновляет правило брандмауэра.

Следующий пример Hello задает правила брандмауэра уровня сервера, с помощью hello Azure CLI: 

```azurecli-interactive
az sql server firewall-rule create --resource-group myResourceGroup --server $servername \
    -n AllowYourIp --start-ip-address 0.0.0.0 --end-ip-address 0.0.0.0
```

> [!TIP]
> Пример Azure CLI в контексте hello краткого руководства см. в разделе [создать DDB - Azure CLI](sql-database-get-started-cli.md) и [создать одну базу данных и настроить правило брандмауэра с помощью hello Azure CLI](scripts/sql-database-create-and-configure-database-cli.md)
>

### <a name="rest-api"></a>Интерфейс REST API
| API | Уровень | Описание |
| --- | --- | --- |
| [Вывод списка правил брандмауэра](https://msdn.microsoft.com/library/azure/dn505715.aspx) |сервер; |Отображает текущие правила брандмауэра уровня сервера hello |
| [Создание правила брандмауэра](https://msdn.microsoft.com/library/azure/dn505712.aspx) |сервер; |Создает или обновляет правила брандмауэра уровня сервера |
| [Задание правила брандмауэра](https://msdn.microsoft.com/library/azure/dn505707.aspx) |сервер; |Обновляет свойства hello существующего правила брандмауэра на уровне сервера |
| [Удаление правила брандмауэра](https://msdn.microsoft.com/library/azure/dn505706.aspx) |сервер; |Удаляет правила брандмауэра уровня сервера |

## <a name="server-level-firewall-rule-versus-a-database-level-firewall-rule"></a>Сравнение правила брандмауэра уровня сервера и правила брандмауэра уровня базы данных
В. Необходимо ли полностью изолировать пользователей одной базы данных от пользователей другой базы данных ?   
  Если да, то предоставьте доступ с помощью правил брандмауэра уровня базы данных. Это позволяет избежать использования правил брандмауэра на уровне сервера, которые разрешают доступ через брандмауэр hello баз данных tooall, уменьшить глубину hello защиты.   
 
В. Пользователей по IP-адресу hello требуется доступ к базам данных tooall?   
  Используйте правила брандмауэра уровня сервера tooreduce номера hello раз, необходимо настроить правила брандмауэра.   

В. Hello пользователя или группы, Настройка правил брандмауэра hello только у доступ через hello портал Azure, PowerShell или hello API-интерфейса REST?   
  Необходимо использовать правила брандмауэра уровня сервера. Правила брандмауэра уровня базы данных можно настроить только с помощью Transact-SQL.  

В. Hello пользователя или группы, Настройка правил брандмауэра hello запрещено от необходимости высокого уровня разрешений на уровне базы данных hello?   
  Используйте правила брандмауэра уровня сервера. Настройка правил брандмауэра уровня базы данных, с помощью Transact-SQL, требуется по крайней мере `CONTROL DATABASE` разрешение на уровне базы данных hello.  

В. — Hello пользователя или рабочей группы, аудит правил брандмауэра hello, или настройка дает возможность централизованно управлять правилами брандмауэра для многих (например, 100) баз данных?   
  Это зависит от ваших потребностей и среды. Правила брандмауэра уровня сервера может быть проще tooconfigure, но сценариев можно настроить правила для hello уровня базы данных. И даже при использовании правил брандмауэра уровня сервера, может потребоваться правила брандмауэра базы данных hello tooaudit, toosee при пользователей с `CONTROL` разрешения для базы данных hello создания правил брандмауэра уровня базы данных.   

В. Можно ли одновременно использовать правила брандмауэра уровня сервера и уровня базы данных?   
  Да. Некоторым пользователям, например администраторам, требуются правила брандмауэра уровня сервера. А другим пользователям, например пользователям приложения базы данных, необходимы правила брандмауэра уровня базы данных.   

## <a name="troubleshooting-hello-database-firewall"></a>Устранение неполадок брандмауэра hello базы данных
Примите во внимание при toohello доступ службы баз данных SQL Microsoft Azure работать не так, как предполагается, что следующие точки hello.

* **Конфигурация локального брандмауэра:** перед компьютер может получить доступ к базе данных SQL Azure, может потребоваться toocreate исключение брандмауэра на компьютере для TCP-порт 1433. При создании соединения внутри границ облако Azure hello возможно tooopen дополнительные порты. Дополнительные сведения см. в разделе hello **базы данных SQL: за пределами vs внутри** раздел [порты за пределами 1433 для ADO.NET 4.5 и базы данных SQL](sql-database-develop-direct-route-ports-adonet-v12.md).
* **Преобразование сетевых адресов (NAT):** tooNAT заказа, используемый tooAzure tooconnect ваш компьютер, база данных SQL может отличаться от hello IP-адреса, показанного в настройках конфигурации IP компьютера hello IP-адрес. tooview hello IP-адрес, на компьютере с помощью tooconnect tooAzure, войдите в портал toohello и перейдите toohello **Настройка** вкладку на приветствия сервера, на котором размещены базы данных. В разделе hello **разрешенные IP-адреса** статьи, hello **текущий IP-адрес клиента** отображается. Нажмите кнопку **добавить** toohello **разрешенные IP-адреса** tooallow сервер hello tooaccess этого компьютера.
* **Список разрешенных toohello изменения не вступили в силу еще:** может быть как больше пяти минут задержки для изменения toohello базы данных SQL Azure брандмауэра конфигурации tootake эффект.
* **Hello входа не имеет прав или неправильный пароль был использован:** Если имя входа не имеет разрешений на сервере базы данных SQL Azure hello или неверен пароль hello, сервер базы данных SQL Azure toohello подключения hello запрещен. Только создания параметра брандмауэра предоставляет клиентам возможность tooattempt подключении tooyour серверу; Каждый клиент должен предоставить необходимые учетные записи hello. Дополнительные сведения о подготовке имен входа см. в разделе "Управление базами данных, именами входа и пользователями в базе данных SQL Azure".
* **Динамический IP-адрес:** при наличии подключения к Интернету с динамическим IP-адресов и испытываете проблемы с прохождением через брандмауэр hello, может воспользоваться hello следующие решения:
  
  * Попросите поставщика услуг Интернета (ISP) для hello диапазон IP-адресов, назначенных tooyour клиентских компьютеров, сервер базы данных SQL Azure hello доступа, а затем добавьте hello диапазон IP-адресов в качестве правила брандмауэра.
  * Получить статический IP-адреса для клиентских компьютеров, а затем задать hello IP-адреса в правила брандмауэра.

## <a name="next-steps"></a>Дальнейшие действия

- Чтобы быстро приступить к созданию правила брандмауэра уровня сервера и уровня базы данных, ознакомьтесь со статьей [Создание базы данных SQL Azure на портале Azure](sql-database-get-started-portal.md).
- Для подключения базы данных Azure SQL tooan с открытым исходным кодом или сторонние приложения обратитесь к статье [tooSQL базы данных примеров кода краткое клиента](https://msdn.microsoft.com/library/azure/ee336282.aspx).
- Сведения о дополнительных портов, может потребоваться tooopen см hello **базы данных SQL: за пределами vs внутри** раздел [порты за пределами 1433 для ADO.NET 4.5 и базы данных SQL](sql-database-develop-direct-route-ports-adonet-v12.md)
- Общие сведения о методах защиты в базе данных SQL Azure см. в [этой статье](sql-database-security-overview.md).

<!--Image references-->
[1]: ./media/sql-database-firewall-configure/sqldb-firewall-1.png
