---
title: "руководство по настройке производительности базы данных SQL aaaAzure | Документы Microsoft"
description: "Эта статья поможет определить, какие toochoose уровня службы для приложения. Также рекомендуется tootune способов hello tooget вашего приложения наиболее из базы данных SQL Azure."
services: sql-database
documentationcenter: na
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: dd8d95fa-24b2-4233-b3f1-8e8952a7a22b
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-management
ms.date: 02/09/2017
ms.author: carlrab
ms.openlocfilehash: 2699f755391e94ab488ac1e6acedd30f8aec4488
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="tuning-performance-in-azure-sql-database"></a>Настройка производительности в Базе данных SQL Azure

База данных SQL Azure предоставляет [рекомендации](sql-database-advisor.md) , можно использовать tooimprove производительность базы данных или базы данных SQL Azure можно позволить [автоматически адаптируются приложения tooyour](sql-database-automatic-tuning.md) и применения изменений который улучшит производительность рабочей нагрузки.

В вашем нет применимых рекомендаций и у вас по-прежнему есть проблемы с производительностью, можно использовать следующие методы tooimprove производительность hello.
1. Увеличьте [уровней служб](sql-database-service-tiers.md) и предоставить дополнительные tooyour ресурсы базы данных.
2. Настройте приложение и примените некоторые рекомендации, которые могут увеличить производительность. 
3. Настройте базу данных hello, изменив индексов и запросов toomore эффективно работать с данными.

Это вручную методы, поскольку его нужно toodecide, что [уровней служб](sql-database-service-tiers.md) выбирается или нужно будет toorewrite приложения или код базы данных, а развертыванием hello изменения.

## <a name="increasing-performance-tier-of-your-database"></a>Повышение уровня производительности базы данных

Вы можете выбрать один из четырех [уровней служб](sql-database-service-tiers.md) базы данных SQL Azure: "Базовый", "Стандартный", "Премиум" или "Premium RS". Производительность измеряется в единицах пропускной способности базы данных, [DTU](sql-database-what-is-a-dtu.md). Каждая служба изолирует строго hello ресурсы базы данных SQL можно использовать что гарантирует прогнозируемую производительность для этого уровня службы. В этой статье предлагаются рекомендации, которые помогут вам выбрать hello уровня службы для приложения. Обсуждаются способы, можно настроить hello tooget вашего приложения наиболее из базы данных SQL Azure.

> [!NOTE]
> В статье приведены рекомендации по производительности отдельных баз данных в Базе данных SQL Azure. Руководство по производительности в разделе пулы связанных tooelastic [цены и производительности рекомендации по пулам эластичных БД](sql-database-elastic-pool-guidance.md). Отметить, что можно применить многие из рекомендаций в этой статье toodatabases в пуле эластичных hello и получить аналогичные производительность.
> 

* **Основные**: hello предсказуемость базовой службы уровня предложения высокую производительность для каждой базы данных, час за час. При достаточном количестве ресурсов в базе данных уровня "Базовый" в небольших базах данных без большого количества параллельных запросов поддерживается отличная производительность. Ниже приведены типичные случаи использования уровня служб "Базовый".
  * **Вы только начали работать с базой данных SQL Azure.** Для приложений на первых этапах разработки часто не требуется высокий уровень производительности. Базы данных уровня "Базовый" — идеальная среда для разработки и тестирования баз данных по низкой цене.
  * **У вас есть база данных с одним пользователем.** Для приложений, связывающих одного пользователя с базой данных, обычно не применяются строгие требования к параллелизму и производительности. Эти приложения являются кандидатами на уровень обслуживания Basic hello.
* **Стандартная**: hello уровень обслуживания Standard предлагает улучшенную предсказуемость производительности и обеспечивает хорошую производительность для баз данных, имеющих несколько одновременных запросов, например для рабочих групп и веб-приложений. Выбрав этот уровень, вы можете определить размер приложения на основе поминутной предсказуемой производительности.
  * **База данных содержит большое количество параллельных запросов.** Для приложений, обслуживающих несколько пользователей одновременно, обычно требуется более высокий уровень производительности. Например рабочей или веб-приложений, которые имеют низкий toomedium операции ввода-ВЫВОДА трафика требования, поддерживающих несколько параллельных запросов являются хорошими кандидатами для уровня Standard hello.
* **Premium**: hello уровень обслуживания Premium обеспечивает прогнозируемую производительность, второй по во-вторых, для каждой базы данных Premium. При выборе уровня Premium hello можно размер приложения на основе пиковой загрузки hello для этой базы данных. план Hello удаляет случаи, в которых отклонения производительности, выполняться дольше, чем ожидалось, в операциях, чувствительных к задержке tootake небольших запросов. Эта модель может значительно упростить hello разработки продукта проверки циклы и для приложений, требующих строгого инструкций toomake о имеют Пиковая нагрузка, изменяемая производительность и задержка выполнения запросов. Большинство вариантов использования уровня служб "Премиум" имеют одну или несколько из этих характеристик:
  * **Высокая пиковая нагрузка.** Приложение, которое требует значительных ЦП, памяти или ввода вывода (I/O) toocomplete его операций требуется уровень выделенной, высокой производительности. Например известные tooconsume операции с базой данных несколько ядер ЦП на длительное время является кандидатом для уровня служб Premium hello.
  * **Множество параллельных запросов.** Некоторые приложения баз данных обслуживают множество параллельных запросов, например веб-сайты с большим объемом трафика. Basic и Standard уровней обслуживания ограничить hello число одновременных запросов для базы данных. Приложения, которым требуется больше подключений, должны toochoose соответствующий размер toohandle hello максимальное число запросов.
  * **Минимальная задержка.** Некоторые приложения должны tooguarantee ответа от базы данных hello минимальное время. Если выполнение определенной хранимой процедуры вызывается как часть широкого взаимодействия с клиентом, может потребоваться toohave требование возврата из этого вызова не более 20 мс 99 процентов времени hello. Этот тип преимущества приложений уровня служб Premium hello доступен toomake том, что требуется, hello вычислительной мощности.
* **Premium RS**: hello уровня Premium RS предназначен для рабочих нагрузок с интенсивным операции ввода-ВЫВОДА, которые не требуют hello наибольший гарантии доступности. Примеры включают тестирование высокой производительности рабочих нагрузок или аналитической рабочей нагрузки, где база данных hello не hello систему записи.

уровень обслуживания Hello, необходимое для базы данных SQL зависит от hello пиковой нагрузки для каждого измерения ресурсов. Некоторые приложения могут использовать небольшой объем одного ресурса и значительный — других.

### <a name="service-tier-capabilities-and-limits"></a>Возможности и ограничения уровней служб

На каждом уровне службы значение hello уровень производительности, поэтому вы toopay гибкость hello только для необходимому объему hello. Вы можете [регулировать объем ресурсов](sql-database-service-tiers.md), увеличивая или уменьшая его по мере изменения рабочей нагрузки. Например если рабочая нагрузка базы данных во время покупок перед праздниками для учебного hello велико, можно увеличить продолжительность июля по сентябрь hello уровень производительности для базы данных hello. Его можно уменьшить после снижения пиковой нагрузки. Можно свести к минимуму вы платите оптимизировав вашей сезонности toohello облачной среде вашего бизнеса. Кроме того, такая модель подходит для поддержки жизненного цикла программных продуктов. Команда тестирования может увеличивать мощность на время тестирования и снижать ее после его завершения. При использовании модели запроса мощности оплачивается только используемая мощность, а не выделенные редко используемые ресурсы.

### <a name="why-service-tiers"></a>Зачем нужны уровни служб?
Несмотря на то, что рабочие нагрузки базы данных могут отличаться, hello уровней обслуживания предназначен tooprovide предсказуемость производительности на различных уровнях производительности. Благодаря этим уровням клиенты с высокими требованиями к ресурсам базы данных могут работать в более изолированной вычислительной среде.

## <a name="tune-your-application"></a>Настройка приложения
В традиционном локальном SQL Server hello процесс изначального планирования загрузки часто отделен от hello процесса запуска приложения в рабочей среде. Сначала приобретаются лицензии на оборудование и продукт, а затем настраивается производительность. При использовании базы данных SQL Azure, это разумно toointerweave hello процесс его настройки и запуска приложения. С моделью hello оплата только за емкости по запросу вы можете настроить toouse hello минимальное ресурсами приложения теперь требуется вместо избыточную подготовку согласно прогнозам будущего роста для приложений, которые часто неверны. Некоторые клиенты могут выбрать не tootune приложения и вместо этого toooverprovision аппаратных ресурсов. Этот подход может служить хорошей идеей, если вы не хотите toochange ключевое приложение на период высокой нагрузки. Однако настройка приложения позволяет минимизировать потребление ресурсов и снизить ежемесячные расходы при использовании уровней обслуживания hello в базе данных SQL Azure.

### <a name="application-characteristics"></a>Характеристики приложения
Несмотря на то, что уровни служб базы данных SQL Azure, разработанных tooimprove стабильной производительности и приложения, некоторые рекомендации могут помочь настройки приложения toobetter использовать преимущества hello ресурсов на уровне производительности. Несмотря на то, что многие приложения имеют значительный прирост производительности путем простого переключения tooa высокий уровень производительности или служба уровня, некоторые дополнительные настройки toobenefit более высокого уровня обслуживания приложений необходимо. Для повышения производительности приложений со следующими характеристиками необходима дополнительная настройка:

* **Приложения с низкой производительностью из-за "нестабильной" работы.**В эту категорию входят приложения, которые совершают избыточные операции доступа к данным, несмотря на их чувствительность к сетевым задержкам. «Многословных» приложения выполнять операции доступа излишнего данных, которые будут конфиденциальных toonetwork задержки. Может потребоваться toomodify такого рода приложений tooreduce hello число базы данных SQL toohello операций доступа к данных. Например можно повысить производительность приложения с помощью методик, как пакетная обработка нерегламентированных запросов или при перемещении hello запрашивает toostored процедуры. в разделе [Пакетные запросы](#batch-queries).
* **Базы данных с интенсивной рабочей нагрузкой, которые не могут работать на одном сервере.**Базы данных, которым требуется больше ресурсов, чем предоставляет уровень производительности "Премиум", можно оптимизировать за счет масштабирования рабочей нагрузки. Базы данных, которые превышают hello ресурсы hello высокий уровень производительности Premium может улучшить за счет масштабирования рабочей нагрузки hello. Дополнительные сведения см. в разделах [Сегментирование баз данных](#cross-database-sharding) и [Функциональное секционирование](#functional-partitioning).
* **Приложения с неоптимальными запросами.**Приложениям, особенно тем, которые находятся на уровне доступа к данным и используют неоптимальные запросы, может не подойти более высокий уровень производительности. Приложения, особенно тех hello уровне доступа к данным, которые используют неоптимальные запросы не могут выиграть от более высокий уровень производительности. Больше пользы таким приложениям приносят стандартные методы оптимизации производительности запросов. Дополнительные сведения см. Дополнительные сведения см. в разделах [Отсутствующие индексы](#identifying-and-adding-missing-indexes) и [Настройка запросов и указания на них](#query-tuning-and-hinting).
* **Приложения с неоптимальной схемой доступа к данным.**Если в приложениях есть проблемы параллельного доступа к данным, например при одновременном доступе возникает блокировка, то более высокий уровень производительности, скорее всего, не улучшит их работу. Попробуйте снизить количество циклических запросов к Базе данных SQL Azure за счет кэширования данных на стороне клиента с помощью службы кэша Azure или других технологий кэширования. Рассмотрите возможность уменьшения циклов приема-передачи с hello базы данных SQL Azure путем кэширования данных на стороне клиента hello с hello Azure Caching service или другой технологии кэширования. раздел [Кэширование на уровне приложения](#application-tier-caching).

## <a name="tune-your-database"></a>Настройка базы данных
В этом разделе мы рассмотрим некоторые методы можно использовать tootune базы данных SQL Azure toogain hello наилучшей производительности приложения и запустите его на низком уровне производительности hello. Некоторые из этих методик соответствует традиционных SQL Server, советы и рекомендации по настройке, а остальные — tooAzure определенной базы данных SQL. В некоторых случаях можно проверить hello потребляет ресурсы для мелодии toofurther toofind области базы данных и расширяют традиционные toowork методы SQL Server в базе данных SQL Azure.

### <a name="identify-performance-issues-using-azure-portal"></a>Выявление проблем производительности с помощью портала Azure
Hello следующие средства в hello портал Azure может помочь анализа и устранения проблем производительности с базой данных SQL:

* [Анализ производительности запросов](sql-database-query-performance.md)
* [Помощник по работе с базами данных SQL](sql-database-advisor.md)

Hello портал Azure содержит дополнительные сведения об этих средств и каким образом toouse их. tooefficiently диагностики и исправления ошибок, рекомендуется сначала попробовать средства hello в hello портал Azure. Мы рекомендуем использовать hello по ручной настройке подходов, которые рассматриваются далее для отсутствующих индексов и настройка запросов, в особых случаях.

Дополнительные сведения о выявлении проблем в Базе данных SQL Azure приведены в статье о [мониторинге производительности](sql-database-single-database-monitor.md).

### <a name="identifying-and-adding-missing-indexes"></a>Определение и добавление недостающих индексов
Распространенная проблема производительности баз данных OLTP связана toohello физической структуры базы данных. Часто схемы базы данных создаются и поставляются без проверки масштабируемости по нагрузке или объему данных. К сожалению производительность hello план запроса будет приемлемые для малого масштаба, но существенно снижаться в производственных данных тома. Hello наиболее распространенным источником этой проблемы является отсутствие hello соответствующих индексов toosatisfy фильтры и другие ограничения в запросе. Часто при этом сканируется вся таблица, в то время как поиска по индексу было бы достаточно.

В этом примере hello план запроса использует проверку, если было бы достаточно простого поиска.

    DROP TABLE dbo.missingindex;
    CREATE TABLE dbo.missingindex (col1 INT IDENTITY PRIMARY KEY, col2 INT);
    DECLARE @a int = 0;
    SET NOCOUNT ON;
    BEGIN TRANSACTION
    WHILE @a < 20000
    BEGIN
        INSERT INTO dbo.missingindex(col2) VALUES (@a);
        SET @a += 1;
    END
    COMMIT TRANSACTION;
    GO
    SELECT m1.col1
    FROM dbo.missingindex m1 INNER JOIN dbo.missingindex m2 ON(m1.col1=m2.col1)
    WHERE m1.col2 = 4;

![План запроса c отсутствующими индексами](./media/sql-database-performance-guidance/query_plan_missing_indexes.png)

База данных SQL Azure может помочь выявить условия, при которых индекс становится необходимым. Динамические административные представления, которые встроены в базе данных SQL Azure просмотрите компиляций запросов, в которых индекс мог бы значительно снизить toorun hello Предполагаемая стоимость запроса. Во время выполнения запроса отслеживает базы данных SQL, как часто выполняется каждый план запроса и отслеживает hello расчетные разрыв между выполнением плана запроса и hello hello представить один где использовался индекс. Можно использовать эти динамические административные представления tooquickly прогноз, какие изменения tooyour физической структуры базы данных может повысить общую нагрузку для базы данных и его реальными рабочими нагрузками.

Можно использовать этот потенциал tooevaluate запросов отсутствующих индексов.

    SELECT CONVERT (varchar, getdate(), 126) AS runtime,
        mig.index_group_handle, mid.index_handle,
        CONVERT (decimal (28,1), migs.avg_total_user_cost * migs.avg_user_impact *
                (migs.user_seeks + migs.user_scans)) AS improvement_measure,
        'CREATE INDEX missing_index_' + CONVERT (varchar, mig.index_group_handle) + '_' +
                  CONVERT (varchar, mid.index_handle) + ' ON ' + mid.statement + '
                  (' + ISNULL (mid.equality_columns,'')
                  + CASE WHEN mid.equality_columns IS NOT NULL
                              AND mid.inequality_columns IS NOT NULL
                         THEN ',' ELSE '' END + ISNULL (mid.inequality_columns, '')
                  + ')'
                  + ISNULL (' INCLUDE (' + mid.included_columns + ')', '') AS create_index_statement,
        migs.*,
        mid.database_id,
        mid.[object_id]
    FROM sys.dm_db_missing_index_groups AS mig
    INNER JOIN sys.dm_db_missing_index_group_stats AS migs
        ON migs.group_handle = mig.index_group_handle
    INNER JOIN sys.dm_db_missing_index_details AS mid
        ON mig.index_handle = mid.index_handle
    ORDER BY migs.avg_total_user_cost * migs.avg_user_impact * (migs.user_seeks + migs.user_scans) DESC

В этом примере запрос hello привело к созданию этого предложения:

    CREATE INDEX missing_index_5006_5005 ON [dbo].[missingindex] ([col2])  

После его создания этой же самой инструкции SELECT выбирает другой план, который использует поиск вместо сканирования, а затем выполняет план hello более эффективно:

![План запроса c исправленными индексами](./media/sql-database-performance-guidance/query_plan_corrected_indexes.png)

Важно понимать Hello является, пропускную способность общего hello, товарного системы более ограничен, отличный от выделенного сервера. Нет расширенной минимизировать ненужные операции ввода-вывода tootake максимально использовать системы hello в hello DTU каждого уровня производительности hello уровней обслуживания базы данных SQL Azure. Варианты соответствующие физической базы данных можно значительно сократить задержку hello для отдельных запросов, повысить пропускную способность hello одновременных запросов, которые обрабатываются на единицу масштабирования и свести к минимуму необходимые toosatisfy hello hello стоимость запроса. Дополнительные сведения о hello отсутствует индекс динамических административных представлений см. в разделе [sys.dm_db_missing_index_details](https://msdn.microsoft.com/library/ms345434.aspx).

### <a name="query-tuning-and-hinting"></a>Настройка запросов и указания на них
оптимизатор запросов Hello в базе данных SQL Azure — примерно toohello традиционный оптимизатор запросов SQL Server. Большинство hello рекомендации по настройке запросов и основные сведения о hello рассуждения ограничения оптимизатора запросов hello также действуют tooAzure базы данных SQL. Если вам необходимо настроить запросы в базе данных SQL Azure, может появиться дополнительное преимущество hello снизить требования статистических ресурсов. Приложения могут выполняться может toorun по более низкой цене, чем эквивалентный ненастроенные, поскольку он выполняется на более низком уровне производительности.

Например, обычно используется для SQL Server и которая также применяется tooAzure базы данных SQL, как оптимизатор» прослушивает» параметры запроса hello. Во время компиляции оптимизатор запросов hello вычисляет текущее значение параметра toodetermine hello ли оно может создавать более оптимального плана запроса. Несмотря на то, что такая стратегия можно позволить tooa план запроса, который значительно быстрее, чем план, созданный без параметра известных значений, в настоящее время он работает imperfectly как в SQL Server и базы данных SQL Azure. Иногда параметры hello не вносятся и иногда hello параметры вносятся, но созданный план hello не является оптимальным для полного набора значений параметров в рабочей нагрузке hello. Майкрософт включает указания запросов (директивы), можно указать, следует ли и переопределить поведение по умолчанию hello пробное сохранение параметров. Часто при использовании подсказки, можно устранить проблемы, в которых hello по умолчанию SQL Server или база данных SQL Azure не идеально подходит для определенной рабочей нагрузки.

Hello следующем примере показано, как обработчик запросов hello можно создать план, который не является оптимальным для производительности и требований к ресурсам. В этом примере также показано, что при использовании указания запроса можно сократить время выполнения запроса и снизить требования к ресурсам для Базы данных SQL.

    DROP TABLE psptest1;
    CREATE TABLE psptest1(col1 int primary key identity, col2 int, col3 binary(200));

    DECLARE @a int = 0;
    SET NOCOUNT ON;
    BEGIN TRANSACTION
    WHILE @a < 20000
    BEGIN
        INSERT INTO psptest1(col2) values (1);
        INSERT INTO psptest1(col2) values (@a);
        SET @a += 1;
    END
    COMMIT TRANSACTION
    CREATE INDEX i1 on psptest1(col2);
    GO

    CREATE PROCEDURE psp1 (@param1 int)
    AS
    BEGIN
        INSERT INTO t1 SELECT * FROM psptest1
        WHERE col2 = @param1
        ORDER BY col2;
    END
    GO

    CREATE PROCEDURE psp2 (@param2 int)
    AS
    BEGIN
        INSERT INTO t1 SELECT * FROM psptest1 WHERE col2 = @param2
        ORDER BY col2
        OPTION (OPTIMIZE FOR (@param2 UNKNOWN))
    END
    GO

    CREATE TABLE t1 (col1 int primary key, col2 int, col3 binary(200));
    GO

Hello установочный код создает таблицу, которая неравномерным распределения данных. Оптимальный запросов Hello отличается план на основании какой параметр выбран. К сожалению поведение кэширования плана hello не всегда повторно компилирует hello запрос, основанный на hello наиболее подходящего значения. Таким образом существует возможность toobe неоптимальный план кэшируется и используется в много значений, даже в том случае, если другой план в среднем может быть предпочтительнее плана. План запроса hello создает две хранимые процедуры, которые идентичны, за исключением того, что один из них имеет специальное указание запроса.

**Пример, часть 1.**

    -- Prime Procedure Cache with scan plan
    EXEC psp1 @param1=1;
    TRUNCATE TABLE t1;

    -- Iterate multiple times tooshow hello performance difference
    DECLARE @i int = 0;
    WHILE @i < 1000
    BEGIN
        EXEC psp1 @param1=2;
        TRUNCATE TABLE t1;
        SET @i += 1;
    END

**Пример, часть 2.**

(Рекомендуется отложить менее 10 минут, прежде чем часть 2 из пример hello hello результаты должны быть уникальными в hello, возникающие в данные телеметрии).

    EXEC psp2 @param2=1;
    TRUNCATE TABLE t1;

    DECLARE @i int = 0;
    WHILE @i < 1000
    BEGIN
        EXEC psp2 @param2=2;
        TRUNCATE TABLE t1;
        SET @i += 1;
    END

Каждая часть примера пытается toorun параметризованную вставку 1000 раз (toogenerate достаточно toouse нагрузки качестве проверочного набора данных). При выполнении хранимой процедуры, обработчик запросов hello проверяет значение параметра hello, которое передается процедуре toohello во время первой компиляции («пробное сохранение параметров»). Процессор Hello кэширует hello результирующий план и использует его в дальнейшем, даже если значение параметра hello отличается. оптимальный план Hello не может использоваться во всех случаях. Иногда требуется tooguide hello оптимизатор toopick план, который лучше подходит для случая среднее hello, а не конкретного случая hello из при первой компиляции запросов hello. В этом примере изначальный план hello приводит к возникновению ошибки план «проверка», который считывает все строки toofind значение, которое отвечает параметр hello:

![Настройка запроса с использованием плана сканирования](./media/sql-database-performance-guidance/query_tuning_1.png)

Так как мы выполним процедуру hello, используя hello значение 1, результирующий план hello было оптимальным для hello значение 1, но было оптимальным для всех значений в таблице hello. скорее всего, результат Hello не, что вам потребуется, если были toopick случайным образом, каждый план потому, что план hello медленнее и использует больше ресурсов.

При выполнении теста hello с `SET STATISTICS IO` значение слишком`ON`, hello логического сканирования в этом примере выполняется работа фоновом hello. Можно просмотреть 1,148 операций чтения, план hello (который является неэффективным, если регистр среднее hello tooreturn только одну строку):

![Настройка запроса с использованием логического сканирования](./media/sql-database-performance-guidance/query_tuning_2.png)

во второй части примера hello для Hello использует toouse оптимизатор hello tootell указание запроса определенное значение во время компиляции hello. В этом случае он заставляет hello запроса процессора tooignore hello значение, которое передается как параметр hello и вместо этого tooassume `UNKNOWN`. Это относится tooa значение, которое имеет hello среднюю частоту в таблице hello (без учета наклон). результирующий план Hello — план на основе поиска, который выполняется быстрее и использует меньше ресурсов, в среднем, чем план hello в части 1 этого примера:

![Настройка запроса с помощью указания запроса](./media/sql-database-performance-guidance/query_tuning_3.png)

Можно увидеть эффект hello в hello **sys.resource_stats** таблицы (отсутствует задержка по времени hello выполнении теста hello и когда hello данных заполняет таблицу hello). Для этого примера, часть 1, выполняется в процессе временного окна 22:25:00 hello и часть 2 выполняются в 22:35:00. Hello использовала больше ресурсов в течение этого периода времени, чем hello позже у одного (из-за повышения эффективности).

    SELECT TOP 1000 *
    FROM sys.resource_stats
    WHERE database_name = 'resource1'
    ORDER BY start_time DESC

![Пример результатов настройки запроса](./media/sql-database-performance-guidance/query_tuning_4.png)

> [!NOTE]
> Хотя hello тома в этом примере намеренно мал, эффект hello неоптимальных параметров могут быть существенными, особенно для больших баз данных. Разница Hello, в некоторых случаях может быть между секунд для быстрого случаях до нескольких часов, для случаев, медленно.
> 
> 

Можно проверить **sys.resource_stats** toodetermine ли hello для теста использует больше или меньше ресурсов, чем еще один тест. При сравнении данных разделения времени hello тестов, чтобы они не hello окне 5 минут в hello **sys.resource_stats** представления. Hello цель упражнения hello — toominimize hello общий объем ресурсов, используемых и не toominimize hello пиковых нагрузок ресурсы. Обычно оптимизация части кода с целью уменьшения задержки выполнения также приводит к сокращению использования ресурсов. Убедитесь, что hello внесенные tooan приложения необходимы, и что hello изменения не влияют на отрицательно hello качества для тех, кто может использоваться в приложении hello подсказки в запросе.

Если рабочая нагрузка содержит ряд повторяющихся запросов, часто он делает toocapture смысле и проверить оптимальность hello выбранные плана тем, что hello минимальный размер единицы необходимые toohost hello базы данных resource. После проверки, время от времени повторную проверку планов hello toohelp вы убедитесь, что они не ухудшилась. Дополнительные сведения об указаниях запроса (Transact-SQL) см. [в этой статье](https://msdn.microsoft.com/library/ms181714.aspx).

### <a name="cross-database-sharding"></a>Сегментирование баз данных
Так как база данных SQL Azure работает на неспециализированном оборудовании, ограничения емкости hello для одной базы данных ниже, чем для традиционной локальной установки SQL Server. Некоторые клиенты использовать сегментирование методы toospread базы данных операции над несколькими базами данных при операции hello не позволяют поместить hello пределы одной базы данных в базе данных SQL Azure. Большинство клиентов, использующих сегментирование в Базе данных SQL Azure, разбивают данные одного измерения на несколько баз данных. Для этого подхода необходимо toounderstand, что OLTP-приложений часто выполняют транзакции, которые применяются tooonly одной строки или tooa небольшой группе строк в схеме hello.

> [!NOTE]
> База данных SQL теперь предоставляет библиотеки tooassist с сегментированием. Дополнительные сведения см. в статье [Обзор клиентской библиотеки для эластичных баз данных](sql-database-elastic-database-client-library.md).
> 
> 

Например, если база данных содержит имя клиента, порядок и сведения о заказе (например hello стандартном примере базы данных Northwind, поставляемую с SQL Server), можно разделить эти данные на несколько баз данных с помощью группирования заказчику hello заказа и сведения о заказе, связанные с сведения. Вы может гарантирует, что данные этого клиента hello остаются в одной базе данных. приложение Hello должно разбивать заказчиков по базам данных, эффективно распределять hello нагрузки между несколькими базами данных. Сегментирование клиентов не только помогают избежать hello предельный размер базы данных, но база данных SQL Azure может также обрабатывать рабочие нагрузки, которые значительно больше, чем предельные hello hello разные уровни производительности, при условии, что каждая отдельная база данных помещается в его DTU.

Несмотря на то что сегментирование баз данных не снижает производительности hello статистических ресурсов для решения, очень эффективен при поддержке очень крупных решений, которые распределены по нескольким базам данных. Каждой базы данных можно выполнить в разных производительности уровня toosupport очень больших «действующие» базы данных с высокими требованиями к ресурсам.

### <a name="functional-partitioning"></a>Функциональное секционирование
Пользователи SQL Server часто объединяют несколько функций в отдельной базе данных. Например при наличии в приложении логику toomanage запасами склада, что база данных может содержать логику, связанную с запасами, отслеживанием заказов на покупку, хранимые процедуры и индексируется и материализованные представления, управлять отчетами конец месяца. Этот метод позволяет упростить hello tooadminister базы данных для операций, таких как резервное копирование, но также требует вы toosize hello оборудования toohandle hello пиковой нагрузки на все функции приложения.

При использовании масштабируемой архитектуры в базе данных SQL Azure это различные функции toosplit смысл приложения в разных базах данных. При использовании этого метода приложения масштабируются независимо друг от друга. И, как приложения повышения (hello нагрузку на hello роста базы данных) hello администратор может выбрать уровни производительности независимо для каждой функции приложения hello. В этой архитектуре предельном hello приложения может быть больше, чем может обработать одного сервера, так как hello нагрузки распределены между несколькими компьютерами.

### <a name="batch-queries"></a>Пакетные запросы
Для приложений, доступ к данным с помощью большого объема часто нерегламентированные запросы к, достаточно много времени ответа уходит на сетевого взаимодействия между уровнями приложения hello и hello базы данных SQL Azure. Даже в том случае, если оба hello приложения и базы данных SQL Azure находятся в hello в одном центре обработки данных, hello сетевая задержка между двумя hello может вырасти большим числом операций доступа к данным. round сети hello tooreduce поездок hello данных операций доступа, рассмотрите возможность использования hello параметр tooeither пакета hello нерегламентированных запросов или toocompile их как хранимые процедуры. При пакетных hello нерегламентированных запросов, можно отправить несколько запросов как один большой пакет в tooAzure одного обработки базы данных SQL. При компиляции нерегламентированные запросы в хранимой процедуре, вы сможете достигнуть же результат, как если бы их пакетных приветствия. С помощью хранимой процедуры также дает hello расширить возможности hello кэширования hello планов запросов в базе данных SQL Azure, чтобы можно было использовать hello снова хранимой процедуры.

Некоторые приложения требуют большого количества операций записи.  Иногда можно уменьшить, учитывая как записывает toobatch hello общую нагрузку операций ввода-вывода в базе данных. Часто для этого нужно просто использовать явные транзакции вместо автоматических в хранимых процедурах и пакетах нерегламентированных запросов. Оценку различных подходов см. в статье [Как повысить производительность приложений базы данных SQL с помощью пакетной обработки](https://msdn.microsoft.com/library/windowsazure/dn132615.aspx). Попробуйте ввести собственные рабочей нагрузки toofind hello оптимальной модели пакетной обработки. Гарантирует, быть убедиться, что toounderstand, модель может иметь несколько различных согласованность транзакций. Выявление hello оптимальной рабочей нагрузки минимизирует использование ресурсов требуется найти правильное сочетание hello согласованность и производительность компромиссы.

### <a name="application-tier-caching"></a>Кэширование на уровне приложения
Некоторые приложения базы данных содержат рабочие нагрузки, выполняющие много операций чтения. Кэширование слои могут снизить нагрузку на hello в базе данных hello и потенциально может снизить hello производительности уровня требуется toosupport базы данных с помощью базы данных SQL Azure. С [кэш Azure Redis](https://azure.microsoft.com/services/cache/), при наличии чтения тяжелой рабочей нагрузкой, можно считывать данные hello один раз (или, возможно, один раз в компьютеров уровня приложений, в зависимости от того, как он настроен) и затем сохранять данные вне базы данных SQL. Это способ tooreduce нагрузку на базу данных (ЦП и чтения ввода-вывода), но отсутствует влияние на согласованность транзакций, так как считываемые из кэша hello hello данные могут быть синхронизированы с данными hello hello базы данных. Для многих приложений определенный уровень несогласованности приемлем, однако это подходит не для всех рабочих нагрузок. Мы советуем внимательно изучить требования к приложению, прежде чем использовать стратегию кэширования на уровне приложения.

## <a name="next-steps"></a>Дальнейшие действия
* Дополнительные сведения об уровнях служб см. в статье [Параметры базы данных SQL и производительность](sql-database-service-tiers.md).
* Дополнительные сведения о пулах эластичных баз данных Azure см. в статье [Что такое пул эластичных БД Azure?](sql-database-elastic-pool.md)
* Сведения о производительности и эластичных пулов см. в разделе [при tooconsider пуле эластичных БД](sql-database-elastic-pool-guidance.md)

