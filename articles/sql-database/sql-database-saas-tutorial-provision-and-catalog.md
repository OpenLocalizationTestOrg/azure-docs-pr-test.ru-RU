---
title: "aaaProvision новых клиентов в приложении несколькими клиентами, который использует базу данных SQL Azure | Документы Microsoft"
description: "Узнайте, как tooprovision и каталога новых клиентов в hello приложению Wingtip SaaS"
keywords: "руководство по базе данных sql"
services: sql-database
documentationcenter: 
author: stevestein
manager: craigg
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/11/2017
ms.author: sstein
ms.openlocfilehash: eb26f523305650c2124e36707d187dfcdad06fcc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="provision-new-tenants-and-register-them-in-hello-catalog"></a>Подготовка новых клиентов и зарегистрировать их в каталоге hello

В этом учебнике вы узнаете о подготовки hello и шаблоны SaaS каталога и их реализации в приложение Wingtip SaaS hello. Создать и инициализировать новые базы данных клиента и зарегистрировать их в каталоге приложения hello клиента. Hello каталога является база данных, который поддерживает сопоставление hello приложения SaaS hello многих клиентов и их данных. каталог Hello играет важную роль, направление запросов приложения toohello нужную базу данных.  

Из этого руководства вы узнаете, как выполнять такие задачи:

> [!div class="checklist"]

> * Подготовка и пошаговая реализация отдельного нового клиента.
> * Подготовка пакета дополнительных клиентов.


toocomplete завершения этого учебника, убедитесь, что hello следующие предварительные требования:

* приложение Wingtip SaaS Hello развертывается. toodeploy менее чем за пять минут. в разделе [развертывание и просмотр приложения Wingtip SaaS hello](sql-database-saas-tutorial.md)
* Установите Azure PowerShell. Дополнительные сведения см. в статье [Начало работы с Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps).

## <a name="introduction-toohello-saas-catalog-pattern"></a>Введение toohello шаблон каталога SaaS

В приложении SaaS несколькими клиентами резервной базы данных это важные tooknow, в котором хранятся сведения для каждого клиента. В шаблоне каталога SaaS hello база данных каталога находится используется toohold hello сопоставление между каждого клиента и места хранения своих данных. Hello Wingtip SaaS приложением одного клиента на архитектуры базы данных, но базовый шаблон hello хранения сопоставления клиента в базу данных в каталоге применяется ли многопользовательский или однопользовательской базы данных используется.

Каждый клиент назначается ключ, идентифицирующий их в каталоге hello и которого toohello расположение hello соответствующей базы данных сопоставлен. В приложении Wingtip SaaS hello hello ключа формируется на основе хэш-имя клиента hello. Это позволяет hello клиента часть имени toobe URL-адрес приложения hello используется tooconstruct hello ключа. Можно использовать и другие схемы ключа клиента.  

каталог Hello позволяет hello имя или расположение toobe hello базы данных, измененные с минимальным влиянием на приложение hello.  В мультитенантной модели базы данных это также обеспечивает перемещение клиента между базами данных.  Hello каталога также могут использоваться tooindicate ли клиент или база данных находится в автономном режиме для обслуживания или других действий. Это изучена в hello [восстановления одного клиента учебника](sql-database-saas-tutorial-restore-single-tenant.md).

Кроме того hello каталога, для которого действует базы данных управления для приложения SaaS, могут храниться дополнительные метаданные клиента или базы данных, таких как hello уровня или выпуск базы данных, версию схемы, план обслуживания или соглашений об уровне обслуживания предлагаемых tootenants и другие сведения включает управление приложениями, службу поддержки или devops процессов.  

Помимо hello приложения SaaS hello каталога можно включить инструменты для баз данных.  В образце hello Wingtip SaaS hello каталога является запрос клиента между используется tooenable, рассмотренных в hello [нерегламентированных analytics учебника](sql-database-saas-tutorial-adhoc-analytics.md). Управление заданиями между базами данных, рассмотренных в hello [управление схемой](sql-database-saas-tutorial-schema-management.md) и [клиента analytics](sql-database-saas-tutorial-tenant-analytics.md) учебники. 

В приложении Wingtip SaaS hello каталога hello реализуется с помощью возможности управления сегментами hello hello [библиотеки клиента эластичной базы данных (EDCL)](sql-database-elastic-database-client-library.md). Hello EDCL позволяет toocreate приложения, управлять и использовать сопоставление сегментов резервной базы данных. Карта сегментов содержит список сегментов (базы данных) и сопоставление hello ключи (клиентов) и базы данных.  Функции EDCL может использоваться из приложения или скрипты PowerShell во время подготовки toocreate hello записей в карте сегментов hello клиента и из приложений tooefficiently подключиться toohello нужную базу данных. EDCL кэширует подключения сведения toominimize hello трафика toohello каталога базы данных и ускорит приложения hello.  

> [!IMPORTANT]
> Сопоставление данных Hello доступен в базе данных каталога hello, но *не изменить его*! Изменяйте данные сопоставления только с помощью интерфейсов API EDCL. Прямые манипуляции hello сопоставление данных риск повреждения hello каталога и не поддерживается.


## <a name="introduction-toohello-saas-provisioning-pattern"></a>Шаблон подготовки SaaS toohello введение

Когда в приложении SaaS подключается новый клиент, использующей модель базы данных с одним клиентом, базу данных клиента необходимо подготовить.  Она должны создаваться в соответствующее место hello и уровня обслуживания, инициализируется соответствующие схемы и ссылочных данных, а затем регистрируются в каталоге hello под ключ hello соответствующего клиента.  

Различные подходы можно используется toodatabase подготовки, может включать в себя выполнение сценариев SQL, развертывание bacpac или копирования «золотого» шаблона базы данных.  

Подготовка подход используется Hello должен comprehended в общей стратегии управления схемы, которой необходимо убедиться в инициализации новых баз данных с hello последнюю схему.  Это изучена в hello [схемы управления учебника](sql-database-saas-tutorial-schema-management.md).  

Hello Wingtip SaaS приложение подготавливает новых клиентов путем копирования эталонные базы данных с именем basetenantdb, развернуты на сервере каталога hello.  Подготовка может быть интегрирован в приложение hello как часть интерфейса регистрации, и/или поддерживается с помощью скриптов. В этом руководстве рассматривается подготовка с помощью PowerShell. Hello подготовки сценариев скопируйте toocreate basetenantdb hello новой базы данных клиента в пуле эластичных затем инициализируйте его с параметром info конкретного клиента и его регистрации в карта сегментов hello каталога.  В пример приложения hello, баз данных, получают имена на основе имени клиента hello, но не является критической частью шаблона hello – использование hello hello каталога позволяет любой базы данных имя toobe назначенный toohello. + 


## <a name="get-hello-wingtip-application-scripts"></a>Получение скриптов приложения Wingtip hello

Hello Wingtip SaaS скриптов и исходный код приложения были доступны в hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) в репозитории github. [Действия скриптов Wingtip SaaS hello toodownload](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).


## <a name="provision-and-catalog-detailed-walkthrough"></a>Подробное пошаговое руководство по подготовке и каталогизации

toounderstand как hello Wingtip приложение реализует подготовки нового клиента, добавьте точку останова и пошагового выполнения рабочего процесса hello во время подготовки клиента:

1. Открыть... \\Модулей обучения\\ProvisionAndCatalog\\_ProvisionAndCatalog.ps1 Демонстрация_ и набор hello следующие параметры:
   * **$TenantName** = hello имя новой области hello (например, *Bushwillow синего*).
   * **$VenueType** = один из типов предварительно определенных проведения hello: *синего*, classicalmusic, танец, jazz, judo, motorracing, многоцелевых, opera, rockmusic, футбольной.
   * **$DemoScenario** = **1**, задайте слишком**1** слишком*подготовить одного клиента*.

1. Добавьте точку останова в любом поместив курсор на строку 48, hello строки с текстом: *клиента New "*и нажмите клавишу **F9**.

   ![точка останова](media/sql-database-saas-tutorial-provision-and-catalog/breakpoint.png)

1. toorun hello сценарий, нажмите клавишу **F5**.

1. После выполнения скрипта hello останавливается в точке останова hello, нажмите клавишу **F11** toostep в код hello.

   ![точка останова](media/sql-database-saas-tutorial-provision-and-catalog/debug.png)



Трассировка выполнения hello сценария с помощью hello **отладки** параметры меню - **F10** и **F11** toostep за или в вызове функции hello. Дополнительные сведения об отладке сценариев PowerShell см. в разделе [Отладка сценариев в интегрированной среде сценариев Windows PowerShell](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise).


следующие Hello не tooexplicitly выполните действия, но объяснение hello рабочего процесса при прохождении при отладке сценария hello:

1. **Импорт hello SubscriptionManagement.psm1** модуль, который содержит функции для входа в tooAzure и выбрав hello подписки Azure, вы работаете.
1. **Импорт hello CatalogAndDatabaseManagement.psm1** модуль, который обеспечивает каталога и клиента уровня абстракции hello [управления сегментами](sql-database-elastic-scale-shard-map-management.md) функции. Это важные модуля, который включает большую часть шаблона каталога hello и следует знать.
1. **Получение сведений о конфигурации.** Шаг с заходом в Get-конфигурации (с F11) и посмотрите, как указывается Конфигурация приложения hello. Имена ресурсов и другие значения для конкретного приложения определяются здесь, но не изменяйте эти значения до вы знакомы со сценариями hello.
1. **Получить объект каталога hello**. Шаг с заходом Get-каталога, для которого составляет и возвращает объект каталога, который используется в сценарии высокого уровня hello.  При этом используются функции управления сегментами, импортируемые из **AzureShardManagement.psm1**. объект каталога Hello состоит из следующих hello.
   * $catalogServerFullyQualifiedName создается с помощью стандартных корень hello, а также имя пользователя: _каталога -\<пользователя\>. database.windows.net_.
   * $catalogDatabaseName извлекается из конфигурации hello: *tenantcatalog*.
   * Инициализация объекта $shardMapManager из базы данных каталога hello.
   * Объект $shardMap инициализируется из hello *tenantcatalog* карта сегментов в базе данных каталога hello.
   Объект каталога композицию и возвращается и используются в сценариях высокого уровня hello.
1. **Вычислить новый ключ клиента hello**. Хэш-функции — ключ клиента используется toocreate hello hello имя клиента.
1. **Проверьте, существует ли ключ клиента hello**. Hello каталога проверяется, что доступен ключ tooensure hello.
1. **Создать TenantDatabase поддерживал Hello базы данных клиента.** Используйте **F11** toostep в и увидеть, как базы данных hello подготовленных с помощью [шаблона Azure Resource Manager](../azure-resource-manager/resource-manager-template-walkthrough.md).

Имя базы данных Hello создается на основе hello клиента имя toomake снимите его какого сегмента принадлежит toowhich клиента. (Легко использоваться других стратегий именования базы данных.) + Шаблона диспетчера ресурсов — используется toocreate базы данных клиента путем копирования эталонные базы данных (baseTenantDB) на сервере каталога hello. Альтернативный подход может быть toocreate пустую базу данных, а затем инициализировать его путем импорта bacpac или tooexecute в сценарий инициализации из известное местоположение.  

Hello шаблона диспетчера ресурсов находится в папке Modules\Common\ ...\Learning hello: *tenantdatabasecopytemplate.json*

После создания базы данных клиента hello, именно дальнейших **инициализирован с именем hello проведения (клиента) и типом проведения hello**. Также здесь можно выполнить другие действия по инициализации.

Hello **клиента база данных регистрируется в каталоге hello** с *TenantDatabaseToCatalog добавить* использование ключа клиента hello. Используйте **F11** toostep в детали hello:

* База данных каталога Hello добавляется карта сегментов toohello (hello список известных баз данных).
* создается сопоставление своего сегмента toohello значение ключа hello ссылки Hello.
* Дополнительные метаданные (hello проведения имя) hello клиента добавляется toohello таблицу клиентов в каталоге hello.  таблица клиентов Hello не является частью схемы ShardManagement hello и не устанавливается по hello EDCL.  В этой таблице показано, как база данных каталога hello можно расширить toosupport дополнительных данных приложения.   


После завершения подготовки, выполнение возвращается toohello исходного *Демонстрация ProvisionAndCatalog* сценарий, который открывает hello **события** страницы для нового клиента hello в браузере hello:

   ![events](media/sql-database-saas-tutorial-provision-and-catalog/new-tenant.png)


## <a name="provision-a-batch-of-tenants"></a>Подготовка пакета клиентов

В этом упражнении подготавливается пакет из 17 клиентов. Рекомендуется подготовить пакет клиентов перед запуском других учебников Wingtip SaaS, то есть только несколько toowork баз данных с.

1. Открыть... \\Модулей обучения\\ProvisionAndCatalog\\*Демонстрация ProvisionAndCatalog.ps1* в hello *интегрированной среды Сценариев PowerShell* и измените hello *$ DemoScenario* too3 параметр:
   * **$DemoScenario** = **3**, измените слишком**3** слишком*подготовить пакет клиентов*.
1. Нажмите клавишу **F5** и запустите сценарий hello.

сценарий Hello развертывает пакет Дополнительные клиенты. Она использует [шаблона Azure Resource Manager](../azure-resource-manager/resource-manager-template-walkthrough.md) , управляет hello пакета, а затем подготовки всех связанных шаблонов tooa базы данных. Такое использование шаблонов позволяет процесс скрипта подготовки hello toobroker диспетчера ресурсов Azure. Шаблоны подготовить баз данных в параллельном режиме, где его можно и обрабатывает повторных попыток в случае необходимости hello в целом процесс оптимизации. Здравствуйте, скрипт является идемпотентной таким образом случае его сбоя или останавливает по любой причине, запустите его еще раз.

### <a name="verify-hello-batch-of-tenants-successfully-deployed"></a>Проверка пакета hello успешного развертывания клиентов

* Откройте hello *tenants1* сервера путем просмотра списка серверов в hello tooyour [портал Azure](https://portal.azure.com), нажмите кнопку **баз данных SQL**и проверьте пакет hello 17 дополнительные базы данных сейчас в списке hello:

   ![список баз данных](media/sql-database-saas-tutorial-provision-and-catalog/database-list.png)



## <a name="other-provisioning-patterns"></a>Другие шаблоны подготовки

Далее представлены другие шаблоны подготовки, которые не рассматриваются в этом руководстве.

**Предварительная подготовка баз данных.** Hello предварительной подготовки шаблон использует hello факт баз данных в эластичном пуле не добавляйте дополнительных затрат. Выставление счетов осуществляется для эластичного пула hello, не hello баз данных и простоя базы данных использовать ресурсы отсутствуют. Предварительная подготовка баз данных в пуле и их выделение при необходимости может значительно сократить время адаптации клиента. Hello число предварительно подготовить базы данных может быть скорректирована, поскольку необходимые tookeep буфера, подходящий для hello ожидать подготовки скорость.

**Автоматическая подготовка.** В шаблоне автоматическую подготовку hello выделенная служба подготовки — tooprovision используемых серверов, пулы и баз данных автоматически при необходимости — включая предварительной подготовки базы данных в пулах эластичных БД, при необходимости. И если отменяется по заказу, удалении базы данных пробелы в пулах эластичных БД может заполняться hello подготовки службы в случае необходимости. Такие службы могут быть простыми или сложными. Они могут, например, управлять подготовкой в нескольких географических регионах и автоматически настраивать георепликацию, если эта стратегия используется для аварийного восстановления. С шаблоном автоматическую подготовку hello клиентского приложения или сценария отправляет подготовки запроса очереди toobe tooa обрабатываемых hello подготовки службы и затем будет запрашивать hello службы toodetermine завершения. При использовании предварительной подготовки запросов должен обрабатываться быстро со службой hello управление подготовки заменяющей базы данных, выполняться в фоновом режиме hello.



## <a name="next-steps"></a>Дальнейшие действия

Из этого руководства вы узнали, как выполнять такие задачи:

> [!div class="checklist"]

> * Подготовка нового клиента.
> * Подготовка пакета дополнительных клиентов.
> * Шаг с заходом сведения hello подготовки клиентов и их регистрации в каталог hello

Повторите hello [учебника мониторинга производительности](sql-database-saas-tutorial-performance-monitoring.md).

## <a name="additional-resources"></a>Дополнительные ресурсы

* Дополнительные [учебники, которые созданы на основе Wingtip SaaS приложения hello](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)
* [Клиентская библиотека эластичной базы данных](https://docs.microsoft.com/azure/sql-database/sql-database-elastic-database-client-library)
* [Описание tooDebug скриптов в интегрированной среде Сценариев Windows PowerShell](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise)
