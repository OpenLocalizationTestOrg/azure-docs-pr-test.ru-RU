---
title: "aaaProvision новых клиентов в приложении несколькими клиентами, который использует базу данных SQL Azure | Документы Microsoft"
description: "Узнайте, как tooprovision и каталога новых клиентов в hello приложению Wingtip SaaS"
keywords: "руководство по базе данных sql"
services: sql-database
documentationcenter: 
author: stevestein
manager: craigg
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/11/2017
ms.author: sstein
ms.openlocfilehash: eb26f523305650c2124e36707d187dfcdad06fcc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="provision-new-tenants-and-register-them-in-hello-catalog"></a><span data-ttu-id="34aec-104">Подготовка новых клиентов и зарегистрировать их в каталоге hello</span><span class="sxs-lookup"><span data-stu-id="34aec-104">Provision new tenants and register them in hello catalog</span></span>

<span data-ttu-id="34aec-105">В этом учебнике вы узнаете о подготовки hello и шаблоны SaaS каталога и их реализации в приложение Wingtip SaaS hello.</span><span class="sxs-lookup"><span data-stu-id="34aec-105">In this tutorial, you learn about hello provision and catalog SaaS patterns, and how they are implemented in hello Wingtip SaaS application.</span></span> <span data-ttu-id="34aec-106">Создать и инициализировать новые базы данных клиента и зарегистрировать их в каталоге приложения hello клиента.</span><span class="sxs-lookup"><span data-stu-id="34aec-106">You create and initialize new tenant databases, and register them in hello application’s tenant catalog.</span></span> <span data-ttu-id="34aec-107">Hello каталога является база данных, который поддерживает сопоставление hello приложения SaaS hello многих клиентов и их данных.</span><span class="sxs-lookup"><span data-stu-id="34aec-107">hello catalog is a database that maintains hello mapping between hello SaaS application's many tenants and their data.</span></span> <span data-ttu-id="34aec-108">каталог Hello играет важную роль, направление запросов приложения toohello нужную базу данных.</span><span class="sxs-lookup"><span data-stu-id="34aec-108">hello catalog plays an important role directing application requests toohello correct database.</span></span>  

<span data-ttu-id="34aec-109">Из этого руководства вы узнаете, как выполнять такие задачи:</span><span class="sxs-lookup"><span data-stu-id="34aec-109">In this tutorial, you learn how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="34aec-110">Подготовка и пошаговая реализация отдельного нового клиента.</span><span class="sxs-lookup"><span data-stu-id="34aec-110">Provision a single new tenant, including stepping through how this is implemented</span></span>
> * <span data-ttu-id="34aec-111">Подготовка пакета дополнительных клиентов.</span><span class="sxs-lookup"><span data-stu-id="34aec-111">Provision a batch of additional tenants</span></span>


<span data-ttu-id="34aec-112">toocomplete завершения этого учебника, убедитесь, что hello следующие предварительные требования:</span><span class="sxs-lookup"><span data-stu-id="34aec-112">toocomplete this tutorial, make sure hello following prerequisites are completed:</span></span>

* <span data-ttu-id="34aec-113">приложение Wingtip SaaS Hello развертывается.</span><span class="sxs-lookup"><span data-stu-id="34aec-113">hello Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="34aec-114">toodeploy менее чем за пять минут. в разделе [развертывание и просмотр приложения Wingtip SaaS hello](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="34aec-114">toodeploy in less than five minutes, see [Deploy and explore hello Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="34aec-115">Установите Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="34aec-115">Azure PowerShell is installed.</span></span> <span data-ttu-id="34aec-116">Дополнительные сведения см. в статье [Начало работы с Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps).</span><span class="sxs-lookup"><span data-stu-id="34aec-116">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>

## <a name="introduction-toohello-saas-catalog-pattern"></a><span data-ttu-id="34aec-117">Введение toohello шаблон каталога SaaS</span><span class="sxs-lookup"><span data-stu-id="34aec-117">Introduction toohello SaaS Catalog pattern</span></span>

<span data-ttu-id="34aec-118">В приложении SaaS несколькими клиентами резервной базы данных это важные tooknow, в котором хранятся сведения для каждого клиента.</span><span class="sxs-lookup"><span data-stu-id="34aec-118">In a database-backed multi-tenant SaaS application, it's important tooknow where information for each tenant is stored.</span></span> <span data-ttu-id="34aec-119">В шаблоне каталога SaaS hello база данных каталога находится используется toohold hello сопоставление между каждого клиента и места хранения своих данных.</span><span class="sxs-lookup"><span data-stu-id="34aec-119">In hello SaaS catalog pattern, a catalog database is used toohold hello mapping between each tenant and where their data is stored.</span></span> <span data-ttu-id="34aec-120">Hello Wingtip SaaS приложением одного клиента на архитектуры базы данных, но базовый шаблон hello хранения сопоставления клиента в базу данных в каталоге применяется ли многопользовательский или однопользовательской базы данных используется.</span><span class="sxs-lookup"><span data-stu-id="34aec-120">hello Wingtip SaaS app uses a single-tenant per database architecture, but hello basic pattern of storing tenant-to-database mapping in a catalog applies whether a multi-tenant or single-tenant database is used.</span></span>

<span data-ttu-id="34aec-121">Каждый клиент назначается ключ, идентифицирующий их в каталоге hello и которого toohello расположение hello соответствующей базы данных сопоставлен.</span><span class="sxs-lookup"><span data-stu-id="34aec-121">Each tenant is assigned a key that identifies them in hello catalog and which is mapped toohello location of hello appropriate database.</span></span> <span data-ttu-id="34aec-122">В приложении Wingtip SaaS hello hello ключа формируется на основе хэш-имя клиента hello.</span><span class="sxs-lookup"><span data-stu-id="34aec-122">In hello Wingtip SaaS app, hello key is formed from a hash of hello tenant’s name.</span></span> <span data-ttu-id="34aec-123">Это позволяет hello клиента часть имени toobe URL-адрес приложения hello используется tooconstruct hello ключа.</span><span class="sxs-lookup"><span data-stu-id="34aec-123">This allows hello tenant name portion of hello application URL toobe used tooconstruct hello key.</span></span> <span data-ttu-id="34aec-124">Можно использовать и другие схемы ключа клиента.</span><span class="sxs-lookup"><span data-stu-id="34aec-124">Other tenant key schemes could be used.</span></span>  

<span data-ttu-id="34aec-125">каталог Hello позволяет hello имя или расположение toobe hello базы данных, измененные с минимальным влиянием на приложение hello.</span><span class="sxs-lookup"><span data-stu-id="34aec-125">hello catalog allows hello name or location of hello database toobe changed with minimal impact on hello application.</span></span>  <span data-ttu-id="34aec-126">В мультитенантной модели базы данных это также обеспечивает перемещение клиента между базами данных.</span><span class="sxs-lookup"><span data-stu-id="34aec-126">In a multi-tenant database model, this also accommodates ‘moving’ a tenant between databases.</span></span>  <span data-ttu-id="34aec-127">Hello каталога также могут использоваться tooindicate ли клиент или база данных находится в автономном режиме для обслуживания или других действий.</span><span class="sxs-lookup"><span data-stu-id="34aec-127">hello catalog can also be used tooindicate whether a tenant or database is offline for maintenance or other actions.</span></span> <span data-ttu-id="34aec-128">Это изучена в hello [восстановления одного клиента учебника](sql-database-saas-tutorial-restore-single-tenant.md).</span><span class="sxs-lookup"><span data-stu-id="34aec-128">This is explored in hello [restore single tenant tutorial](sql-database-saas-tutorial-restore-single-tenant.md).</span></span>

<span data-ttu-id="34aec-129">Кроме того hello каталога, для которого действует базы данных управления для приложения SaaS, могут храниться дополнительные метаданные клиента или базы данных, таких как hello уровня или выпуск базы данных, версию схемы, план обслуживания или соглашений об уровне обслуживания предлагаемых tootenants и другие сведения включает управление приложениями, службу поддержки или devops процессов.</span><span class="sxs-lookup"><span data-stu-id="34aec-129">In addition, hello catalog, which is in effect a management database for a SaaS application, can store additional tenant or database metadata, such as hello tier or edition of a database, schema version, service plan, or SLAs offered tootenants, and other info that enables application management, customer support, or devops processes.</span></span>  

<span data-ttu-id="34aec-130">Помимо hello приложения SaaS hello каталога можно включить инструменты для баз данных.</span><span class="sxs-lookup"><span data-stu-id="34aec-130">Beyond hello SaaS application, hello catalog can enable database tools.</span></span>  <span data-ttu-id="34aec-131">В образце hello Wingtip SaaS hello каталога является запрос клиента между используется tooenable, рассмотренных в hello [нерегламентированных analytics учебника](sql-database-saas-tutorial-adhoc-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="34aec-131">In hello Wingtip SaaS sample, hello catalog is used tooenable cross-tenant query, explored in hello [ad hoc analytics tutorial](sql-database-saas-tutorial-adhoc-analytics.md).</span></span> <span data-ttu-id="34aec-132">Управление заданиями между базами данных, рассмотренных в hello [управление схемой](sql-database-saas-tutorial-schema-management.md) и [клиента analytics](sql-database-saas-tutorial-tenant-analytics.md) учебники.</span><span class="sxs-lookup"><span data-stu-id="34aec-132">Cross-database job management is explored in hello [schema management](sql-database-saas-tutorial-schema-management.md) and [tenant analytics](sql-database-saas-tutorial-tenant-analytics.md) tutorials.</span></span> 

<span data-ttu-id="34aec-133">В приложении Wingtip SaaS hello каталога hello реализуется с помощью возможности управления сегментами hello hello [библиотеки клиента эластичной базы данных (EDCL)](sql-database-elastic-database-client-library.md).</span><span class="sxs-lookup"><span data-stu-id="34aec-133">In hello Wingtip SaaS app, hello catalog is implemented using hello Shard Management features of hello [Elastic Database Client Library (EDCL)](sql-database-elastic-database-client-library.md).</span></span> <span data-ttu-id="34aec-134">Hello EDCL позволяет toocreate приложения, управлять и использовать сопоставление сегментов резервной базы данных.</span><span class="sxs-lookup"><span data-stu-id="34aec-134">hello EDCL enables an application toocreate, manage, and use a database-backed shard map.</span></span> <span data-ttu-id="34aec-135">Карта сегментов содержит список сегментов (базы данных) и сопоставление hello ключи (клиентов) и базы данных.</span><span class="sxs-lookup"><span data-stu-id="34aec-135">A shard map contains a list of shards (databases) and hello mapping between keys (tenants) and databases.</span></span>  <span data-ttu-id="34aec-136">Функции EDCL может использоваться из приложения или скрипты PowerShell во время подготовки toocreate hello записей в карте сегментов hello клиента и из приложений tooefficiently подключиться toohello нужную базу данных.</span><span class="sxs-lookup"><span data-stu-id="34aec-136">EDCL functions can be used from applications or PowerShell scripts during tenant provisioning toocreate hello entries in hello shard map, and from applications tooefficiently connect toohello correct database.</span></span> <span data-ttu-id="34aec-137">EDCL кэширует подключения сведения toominimize hello трафика toohello каталога базы данных и ускорит приложения hello.</span><span class="sxs-lookup"><span data-stu-id="34aec-137">EDCL caches connection information toominimize hello traffic toohello catalog database and speed up hello application.</span></span>  

> [!IMPORTANT]
> <span data-ttu-id="34aec-138">Сопоставление данных Hello доступен в базе данных каталога hello, но *не изменить его*!</span><span class="sxs-lookup"><span data-stu-id="34aec-138">hello mapping data is accessible in hello catalog database, but *don't edit it*!</span></span> <span data-ttu-id="34aec-139">Изменяйте данные сопоставления только с помощью интерфейсов API EDCL.</span><span class="sxs-lookup"><span data-stu-id="34aec-139">Edit mapping data using Elastic Database Client Library APIs only.</span></span> <span data-ttu-id="34aec-140">Прямые манипуляции hello сопоставление данных риск повреждения hello каталога и не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="34aec-140">Directly manipulating hello mapping data risks corrupting hello catalog and is not supported.</span></span>


## <a name="introduction-toohello-saas-provisioning-pattern"></a><span data-ttu-id="34aec-141">Шаблон подготовки SaaS toohello введение</span><span class="sxs-lookup"><span data-stu-id="34aec-141">Introduction toohello SaaS Provisioning pattern</span></span>

<span data-ttu-id="34aec-142">Когда в приложении SaaS подключается новый клиент, использующей модель базы данных с одним клиентом, базу данных клиента необходимо подготовить.</span><span class="sxs-lookup"><span data-stu-id="34aec-142">When onboarding a new tenant in a SaaS application that uses a single-tenant database model a new tenant database must be provisioned.</span></span>  <span data-ttu-id="34aec-143">Она должны создаваться в соответствующее место hello и уровня обслуживания, инициализируется соответствующие схемы и ссылочных данных, а затем регистрируются в каталоге hello под ключ hello соответствующего клиента.</span><span class="sxs-lookup"><span data-stu-id="34aec-143">It must be created in hello appropriate location and service tier, initialized with appropriate schema and reference data, and then registered in hello catalog under hello appropriate tenant key.</span></span>  

<span data-ttu-id="34aec-144">Различные подходы можно используется toodatabase подготовки, может включать в себя выполнение сценариев SQL, развертывание bacpac или копирования «золотого» шаблона базы данных.</span><span class="sxs-lookup"><span data-stu-id="34aec-144">Different approaches can be used toodatabase provisioning, which could include executing SQL scripts, deploying a bacpac, or copying a 'golden' template database.</span></span>  

<span data-ttu-id="34aec-145">Подготовка подход используется Hello должен comprehended в общей стратегии управления схемы, которой необходимо убедиться в инициализации новых баз данных с hello последнюю схему.</span><span class="sxs-lookup"><span data-stu-id="34aec-145">hello provisioning approach you use must be comprehended in your overall schema management strategy, which must ensure that new databases are provisioned with hello latest schema.</span></span>  <span data-ttu-id="34aec-146">Это изучена в hello [схемы управления учебника](sql-database-saas-tutorial-schema-management.md).</span><span class="sxs-lookup"><span data-stu-id="34aec-146">This is explored in hello [schema management tutorial](sql-database-saas-tutorial-schema-management.md).</span></span>  

<span data-ttu-id="34aec-147">Hello Wingtip SaaS приложение подготавливает новых клиентов путем копирования эталонные базы данных с именем basetenantdb, развернуты на сервере каталога hello.</span><span class="sxs-lookup"><span data-stu-id="34aec-147">hello Wingtip SaaS app provisions new tenants by copying a golden database named basetenantdb, deployed on hello catalog server.</span></span>  <span data-ttu-id="34aec-148">Подготовка может быть интегрирован в приложение hello как часть интерфейса регистрации, и/или поддерживается с помощью скриптов.</span><span class="sxs-lookup"><span data-stu-id="34aec-148">Provisioning could be integrated into hello application as part of a sign-up experience, and/or supported offline using scripts.</span></span> <span data-ttu-id="34aec-149">В этом руководстве рассматривается подготовка с помощью PowerShell.</span><span class="sxs-lookup"><span data-stu-id="34aec-149">This tutorial will explore provisioning using PowerShell.</span></span> <span data-ttu-id="34aec-150">Hello подготовки сценариев скопируйте toocreate basetenantdb hello новой базы данных клиента в пуле эластичных затем инициализируйте его с параметром info конкретного клиента и его регистрации в карта сегментов hello каталога.</span><span class="sxs-lookup"><span data-stu-id="34aec-150">hello provisioning scripts copy hello basetenantdb toocreate a new tenant database in an elastic pool, then initialize it with tenant-specific info and register it in hello catalog shard map.</span></span>  <span data-ttu-id="34aec-151">В пример приложения hello, баз данных, получают имена на основе имени клиента hello, но не является критической частью шаблона hello – использование hello hello каталога позволяет любой базы данных имя toobe назначенный toohello. +</span><span class="sxs-lookup"><span data-stu-id="34aec-151">In hello sample app, databases are given names based on hello tenant name, but this is not a critical part of hello pattern – hello use of hello catalog allows any name toobe assigned toohello database.+</span></span> 


## <a name="get-hello-wingtip-application-scripts"></a><span data-ttu-id="34aec-152">Получение скриптов приложения Wingtip hello</span><span class="sxs-lookup"><span data-stu-id="34aec-152">Get hello Wingtip application scripts</span></span>

<span data-ttu-id="34aec-153">Hello Wingtip SaaS скриптов и исходный код приложения были доступны в hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) в репозитории github.</span><span class="sxs-lookup"><span data-stu-id="34aec-153">hello Wingtip SaaS scripts and application source code are available in hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="34aec-154">[Действия скриптов Wingtip SaaS hello toodownload](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="34aec-154">[Steps toodownload hello Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>


## <a name="provision-and-catalog-detailed-walkthrough"></a><span data-ttu-id="34aec-155">Подробное пошаговое руководство по подготовке и каталогизации</span><span class="sxs-lookup"><span data-stu-id="34aec-155">Provision and catalog detailed walkthrough</span></span>

<span data-ttu-id="34aec-156">toounderstand как hello Wingtip приложение реализует подготовки нового клиента, добавьте точку останова и пошагового выполнения рабочего процесса hello во время подготовки клиента:</span><span class="sxs-lookup"><span data-stu-id="34aec-156">toounderstand how hello Wingtip application implements new tenant provisioning, add a breakpoint and step through hello workflow while provisioning a tenant:</span></span>

1. <span data-ttu-id="34aec-157">Открыть... \\Модулей обучения\\ProvisionAndCatalog\\_ProvisionAndCatalog.ps1 Демонстрация_ и набор hello следующие параметры:</span><span class="sxs-lookup"><span data-stu-id="34aec-157">Open ...\\Learning Modules\\ProvisionAndCatalog\\_Demo-ProvisionAndCatalog.ps1_ and set hello following parameters:</span></span>
   * <span data-ttu-id="34aec-158">**$TenantName** = hello имя новой области hello (например, *Bushwillow синего*).</span><span class="sxs-lookup"><span data-stu-id="34aec-158">**$TenantName** = hello name of hello new venue (for example, *Bushwillow Blues*).</span></span>
   * <span data-ttu-id="34aec-159">**$VenueType** = один из типов предварительно определенных проведения hello: *синего*, classicalmusic, танец, jazz, judo, motorracing, многоцелевых, opera, rockmusic, футбольной.</span><span class="sxs-lookup"><span data-stu-id="34aec-159">**$VenueType** = one of hello pre-defined venue types: *blues*, classicalmusic, dance, jazz, judo, motorracing, multipurpose, opera, rockmusic, soccer.</span></span>
   * <span data-ttu-id="34aec-160">**$DemoScenario** = **1**, задайте слишком**1** слишком*подготовить одного клиента*.</span><span class="sxs-lookup"><span data-stu-id="34aec-160">**$DemoScenario** = **1**, Set too**1** too*Provision a single tenant*.</span></span>

1. <span data-ttu-id="34aec-161">Добавьте точку останова в любом поместив курсор на строку 48, hello строки с текстом: *клиента New "*и нажмите клавишу **F9**.</span><span class="sxs-lookup"><span data-stu-id="34aec-161">Add a breakpoint by putting your cursor anywhere on line 48, hello line that says: *New-Tenant \`*, and press **F9**.</span></span>

   ![точка останова](media/sql-database-saas-tutorial-provision-and-catalog/breakpoint.png)

1. <span data-ttu-id="34aec-163">toorun hello сценарий, нажмите клавишу **F5**.</span><span class="sxs-lookup"><span data-stu-id="34aec-163">toorun hello script press **F5**.</span></span>

1. <span data-ttu-id="34aec-164">После выполнения скрипта hello останавливается в точке останова hello, нажмите клавишу **F11** toostep в код hello.</span><span class="sxs-lookup"><span data-stu-id="34aec-164">After hello script execution stops at hello breakpoint, press **F11** toostep into hello code.</span></span>

   ![точка останова](media/sql-database-saas-tutorial-provision-and-catalog/debug.png)



<span data-ttu-id="34aec-166">Трассировка выполнения hello сценария с помощью hello **отладки** параметры меню - **F10** и **F11** toostep за или в вызове функции hello.</span><span class="sxs-lookup"><span data-stu-id="34aec-166">Trace hello script's execution using hello **Debug** menu options - **F10** and **F11** toostep over or into hello called functions.</span></span> <span data-ttu-id="34aec-167">Дополнительные сведения об отладке сценариев PowerShell см. в разделе [Отладка сценариев в интегрированной среде сценариев Windows PowerShell](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise).</span><span class="sxs-lookup"><span data-stu-id="34aec-167">For more information about debugging PowerShell scripts, see [Tips on working with and debugging PowerShell scripts](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise).</span></span>


<span data-ttu-id="34aec-168">следующие Hello не tooexplicitly выполните действия, но объяснение hello рабочего процесса при прохождении при отладке сценария hello:</span><span class="sxs-lookup"><span data-stu-id="34aec-168">hello following are not steps tooexplicitly follow, but an explanation of hello workflow you step through while debugging hello script:</span></span>

1. <span data-ttu-id="34aec-169">**Импорт hello SubscriptionManagement.psm1** модуль, который содержит функции для входа в tooAzure и выбрав hello подписки Azure, вы работаете.</span><span class="sxs-lookup"><span data-stu-id="34aec-169">**Import hello SubscriptionManagement.psm1** module that contains functions for signing in tooAzure and selecting hello Azure subscription you are working with.</span></span>
1. <span data-ttu-id="34aec-170">**Импорт hello CatalogAndDatabaseManagement.psm1** модуль, который обеспечивает каталога и клиента уровня абстракции hello [управления сегментами](sql-database-elastic-scale-shard-map-management.md) функции.</span><span class="sxs-lookup"><span data-stu-id="34aec-170">**Import hello CatalogAndDatabaseManagement.psm1** module that provides a catalog and tenant-level abstraction over hello [Shard Management](sql-database-elastic-scale-shard-map-management.md) functions.</span></span> <span data-ttu-id="34aec-171">Это важные модуля, который включает большую часть шаблона каталога hello и следует знать.</span><span class="sxs-lookup"><span data-stu-id="34aec-171">This is an important module that encapsulates much of hello catalog pattern and is worth exploring.</span></span>
1. <span data-ttu-id="34aec-172">**Получение сведений о конфигурации.**</span><span class="sxs-lookup"><span data-stu-id="34aec-172">**Get configuration details**.</span></span> <span data-ttu-id="34aec-173">Шаг с заходом в Get-конфигурации (с F11) и посмотрите, как указывается Конфигурация приложения hello.</span><span class="sxs-lookup"><span data-stu-id="34aec-173">Step into Get-Configuration (with F11) and see how hello app config is specified.</span></span> <span data-ttu-id="34aec-174">Имена ресурсов и другие значения для конкретного приложения определяются здесь, но не изменяйте эти значения до вы знакомы со сценариями hello.</span><span class="sxs-lookup"><span data-stu-id="34aec-174">Resource names and other app-specific values are defined here, but do not change any of these values until you are familiar with hello scripts.</span></span>
1. <span data-ttu-id="34aec-175">**Получить объект каталога hello**.</span><span class="sxs-lookup"><span data-stu-id="34aec-175">**Get hello catalog object**.</span></span> <span data-ttu-id="34aec-176">Шаг с заходом Get-каталога, для которого составляет и возвращает объект каталога, который используется в сценарии высокого уровня hello.</span><span class="sxs-lookup"><span data-stu-id="34aec-176">Step into Get-Catalog which composes and returns a catalog object that is used in hello higher-level script.</span></span>  <span data-ttu-id="34aec-177">При этом используются функции управления сегментами, импортируемые из **AzureShardManagement.psm1**.</span><span class="sxs-lookup"><span data-stu-id="34aec-177">This function uses Shard Management functions that are imported from **AzureShardManagement.psm1**.</span></span> <span data-ttu-id="34aec-178">объект каталога Hello состоит из следующих hello.</span><span class="sxs-lookup"><span data-stu-id="34aec-178">hello catalog object is composed of hello following:</span></span>
   * <span data-ttu-id="34aec-179">$catalogServerFullyQualifiedName создается с помощью стандартных корень hello, а также имя пользователя: _каталога -\<пользователя\>. database.windows.net_.</span><span class="sxs-lookup"><span data-stu-id="34aec-179">$catalogServerFullyQualifiedName is constructed using hello standard stem plus your User name: _catalog-\<user\>.database.windows.net_.</span></span>
   * <span data-ttu-id="34aec-180">$catalogDatabaseName извлекается из конфигурации hello: *tenantcatalog*.</span><span class="sxs-lookup"><span data-stu-id="34aec-180">$catalogDatabaseName is retrieved from hello config: *tenantcatalog*.</span></span>
   * <span data-ttu-id="34aec-181">Инициализация объекта $shardMapManager из базы данных каталога hello.</span><span class="sxs-lookup"><span data-stu-id="34aec-181">$shardMapManager object is initialized from hello catalog database.</span></span>
   * <span data-ttu-id="34aec-182">Объект $shardMap инициализируется из hello *tenantcatalog* карта сегментов в базе данных каталога hello.</span><span class="sxs-lookup"><span data-stu-id="34aec-182">$shardMap object is initialized from hello *tenantcatalog* shard map in hello catalog database.</span></span>
   <span data-ttu-id="34aec-183">Объект каталога композицию и возвращается и используются в сценариях высокого уровня hello.</span><span class="sxs-lookup"><span data-stu-id="34aec-183">A catalog object is composed and returned, and used in hello higher-level script.</span></span>
1. <span data-ttu-id="34aec-184">**Вычислить новый ключ клиента hello**.</span><span class="sxs-lookup"><span data-stu-id="34aec-184">**Calculate hello new tenant key**.</span></span> <span data-ttu-id="34aec-185">Хэш-функции — ключ клиента используется toocreate hello hello имя клиента.</span><span class="sxs-lookup"><span data-stu-id="34aec-185">A hash function is used toocreate hello tenant key from hello tenant name.</span></span>
1. <span data-ttu-id="34aec-186">**Проверьте, существует ли ключ клиента hello**.</span><span class="sxs-lookup"><span data-stu-id="34aec-186">**Check if hello tenant key already exists**.</span></span> <span data-ttu-id="34aec-187">Hello каталога проверяется, что доступен ключ tooensure hello.</span><span class="sxs-lookup"><span data-stu-id="34aec-187">hello catalog is checked tooensure hello key is available.</span></span>
1. <span data-ttu-id="34aec-188">**Создать TenantDatabase поддерживал Hello базы данных клиента.**</span><span class="sxs-lookup"><span data-stu-id="34aec-188">**hello tenant database is provisioned with New-TenantDatabase.**</span></span> <span data-ttu-id="34aec-189">Используйте **F11** toostep в и увидеть, как базы данных hello подготовленных с помощью [шаблона Azure Resource Manager](../azure-resource-manager/resource-manager-template-walkthrough.md).</span><span class="sxs-lookup"><span data-stu-id="34aec-189">Use **F11** toostep in and see how hello database is provisioned using an [Azure Resource Manager template](../azure-resource-manager/resource-manager-template-walkthrough.md).</span></span>

<span data-ttu-id="34aec-190">Имя базы данных Hello создается на основе hello клиента имя toomake снимите его какого сегмента принадлежит toowhich клиента.</span><span class="sxs-lookup"><span data-stu-id="34aec-190">hello database name is constructed from hello tenant name toomake it clear which shard belongs toowhich tenant.</span></span> <span data-ttu-id="34aec-191">(Легко использоваться других стратегий именования базы данных.) + Шаблона диспетчера ресурсов — используется toocreate базы данных клиента путем копирования эталонные базы данных (baseTenantDB) на сервере каталога hello.</span><span class="sxs-lookup"><span data-stu-id="34aec-191">(Other strategies for database naming could easily be used.)+ A Resource Manager template is used toocreate a tenant database by copying a golden database (baseTenantDB) on hello catalog server.</span></span> <span data-ttu-id="34aec-192">Альтернативный подход может быть toocreate пустую базу данных, а затем инициализировать его путем импорта bacpac или tooexecute в сценарий инициализации из известное местоположение.</span><span class="sxs-lookup"><span data-stu-id="34aec-192">An alternative approach could be toocreate an empty database and then initialize it by importing a bacpac, or tooexecute an initialization script from a well-known location.</span></span>  

<span data-ttu-id="34aec-193">Hello шаблона диспетчера ресурсов находится в папке Modules\Common\ ...\Learning hello: *tenantdatabasecopytemplate.json*</span><span class="sxs-lookup"><span data-stu-id="34aec-193">hello Resource Manager template is in hello …\Learning Modules\Common\ folder: *tenantdatabasecopytemplate.json*</span></span>

<span data-ttu-id="34aec-194">После создания базы данных клиента hello, именно дальнейших **инициализирован с именем hello проведения (клиента) и типом проведения hello**.</span><span class="sxs-lookup"><span data-stu-id="34aec-194">After hello tenant database is created, it is then further **initialized with hello venue (tenant) name and hello venue type**.</span></span> <span data-ttu-id="34aec-195">Также здесь можно выполнить другие действия по инициализации.</span><span class="sxs-lookup"><span data-stu-id="34aec-195">Other initialization could also be done here.</span></span>

<span data-ttu-id="34aec-196">Hello **клиента база данных регистрируется в каталоге hello** с *TenantDatabaseToCatalog добавить* использование ключа клиента hello.</span><span class="sxs-lookup"><span data-stu-id="34aec-196">hello **tenant database is registered in hello catalog** with *Add-TenantDatabaseToCatalog* using hello tenant key.</span></span> <span data-ttu-id="34aec-197">Используйте **F11** toostep в детали hello:</span><span class="sxs-lookup"><span data-stu-id="34aec-197">Use **F11** toostep into hello details:</span></span>

* <span data-ttu-id="34aec-198">База данных каталога Hello добавляется карта сегментов toohello (hello список известных баз данных).</span><span class="sxs-lookup"><span data-stu-id="34aec-198">hello catalog database is added toohello shard map (hello list of known databases).</span></span>
* <span data-ttu-id="34aec-199">создается сопоставление своего сегмента toohello значение ключа hello ссылки Hello.</span><span class="sxs-lookup"><span data-stu-id="34aec-199">hello mapping that links hello key value toohello shard is created.</span></span>
* <span data-ttu-id="34aec-200">Дополнительные метаданные (hello проведения имя) hello клиента добавляется toohello таблицу клиентов в каталоге hello.</span><span class="sxs-lookup"><span data-stu-id="34aec-200">Additional meta data (hello venue's name) about hello tenant is added toohello Tenants table in hello catalog.</span></span>  <span data-ttu-id="34aec-201">таблица клиентов Hello не является частью схемы ShardManagement hello и не устанавливается по hello EDCL.</span><span class="sxs-lookup"><span data-stu-id="34aec-201">hello Tenants table is not part of hello ShardManagement schema and is not installed by hello EDCL.</span></span>  <span data-ttu-id="34aec-202">В этой таблице показано, как база данных каталога hello можно расширить toosupport дополнительных данных приложения.</span><span class="sxs-lookup"><span data-stu-id="34aec-202">This table illustrates how hello Catalog database can be extended toosupport additional application-specific data.</span></span>   


<span data-ttu-id="34aec-203">После завершения подготовки, выполнение возвращается toohello исходного *Демонстрация ProvisionAndCatalog* сценарий, который открывает hello **события** страницы для нового клиента hello в браузере hello:</span><span class="sxs-lookup"><span data-stu-id="34aec-203">After provisioning completes, execution returns toohello original *Demo-ProvisionAndCatalog* script, which opens hello **Events** page for hello new tenant in hello browser:</span></span>

   ![events](media/sql-database-saas-tutorial-provision-and-catalog/new-tenant.png)


## <a name="provision-a-batch-of-tenants"></a><span data-ttu-id="34aec-205">Подготовка пакета клиентов</span><span class="sxs-lookup"><span data-stu-id="34aec-205">Provision a batch of tenants</span></span>

<span data-ttu-id="34aec-206">В этом упражнении подготавливается пакет из 17 клиентов.</span><span class="sxs-lookup"><span data-stu-id="34aec-206">This exercise provisions a batch of 17 tenants.</span></span> <span data-ttu-id="34aec-207">Рекомендуется подготовить пакет клиентов перед запуском других учебников Wingtip SaaS, то есть только несколько toowork баз данных с.</span><span class="sxs-lookup"><span data-stu-id="34aec-207">It’s recommended you provision this batch of tenants before starting other Wingtip SaaS tutorials, so there's more than just a few databases toowork with.</span></span>

1. <span data-ttu-id="34aec-208">Открыть... \\Модулей обучения\\ProvisionAndCatalog\\*Демонстрация ProvisionAndCatalog.ps1* в hello *интегрированной среды Сценариев PowerShell* и измените hello *$ DemoScenario* too3 параметр:</span><span class="sxs-lookup"><span data-stu-id="34aec-208">Open ...\\Learning Modules\\ProvisionAndCatalog\\*Demo-ProvisionAndCatalog.ps1* in hello *PowerShell ISE* and change hello *$DemoScenario* parameter too3:</span></span>
   * <span data-ttu-id="34aec-209">**$DemoScenario** = **3**, измените слишком**3** слишком*подготовить пакет клиентов*.</span><span class="sxs-lookup"><span data-stu-id="34aec-209">**$DemoScenario** = **3**, change too**3** too*Provision a batch of tenants*.</span></span>
1. <span data-ttu-id="34aec-210">Нажмите клавишу **F5** и запустите сценарий hello.</span><span class="sxs-lookup"><span data-stu-id="34aec-210">Press **F5** and run hello script.</span></span>

<span data-ttu-id="34aec-211">сценарий Hello развертывает пакет Дополнительные клиенты.</span><span class="sxs-lookup"><span data-stu-id="34aec-211">hello script deploys a batch of additional tenants.</span></span> <span data-ttu-id="34aec-212">Она использует [шаблона Azure Resource Manager](../azure-resource-manager/resource-manager-template-walkthrough.md) , управляет hello пакета, а затем подготовки всех связанных шаблонов tooa базы данных.</span><span class="sxs-lookup"><span data-stu-id="34aec-212">It uses an [Azure Resource Manager template](../azure-resource-manager/resource-manager-template-walkthrough.md) that controls hello batch and then delegates provisioning of each database tooa linked template.</span></span> <span data-ttu-id="34aec-213">Такое использование шаблонов позволяет процесс скрипта подготовки hello toobroker диспетчера ресурсов Azure.</span><span class="sxs-lookup"><span data-stu-id="34aec-213">Using templates in this way allows Azure Resource Manager toobroker hello provisioning process for your script.</span></span> <span data-ttu-id="34aec-214">Шаблоны подготовить баз данных в параллельном режиме, где его можно и обрабатывает повторных попыток в случае необходимости hello в целом процесс оптимизации.</span><span class="sxs-lookup"><span data-stu-id="34aec-214">Templates provision databases in parallel where it can, and handles retries if needed, optimizing hello overall process.</span></span> <span data-ttu-id="34aec-215">Здравствуйте, скрипт является идемпотентной таким образом случае его сбоя или останавливает по любой причине, запустите его еще раз.</span><span class="sxs-lookup"><span data-stu-id="34aec-215">hello script is idempotent so if it fails or stops for any reason, run it again.</span></span>

### <a name="verify-hello-batch-of-tenants-successfully-deployed"></a><span data-ttu-id="34aec-216">Проверка пакета hello успешного развертывания клиентов</span><span class="sxs-lookup"><span data-stu-id="34aec-216">Verify hello batch of tenants successfully deployed</span></span>

* <span data-ttu-id="34aec-217">Откройте hello *tenants1* сервера путем просмотра списка серверов в hello tooyour [портал Azure](https://portal.azure.com), нажмите кнопку **баз данных SQL**и проверьте пакет hello 17 дополнительные базы данных сейчас в списке hello:</span><span class="sxs-lookup"><span data-stu-id="34aec-217">Open hello *tenants1* server by browsing tooyour list of servers in hello [Azure portal](https://portal.azure.com), click **SQL databases**, and verify hello batch of 17 additional databases are now in hello list:</span></span>

   ![список баз данных](media/sql-database-saas-tutorial-provision-and-catalog/database-list.png)



## <a name="other-provisioning-patterns"></a><span data-ttu-id="34aec-219">Другие шаблоны подготовки</span><span class="sxs-lookup"><span data-stu-id="34aec-219">Other provisioning patterns</span></span>

<span data-ttu-id="34aec-220">Далее представлены другие шаблоны подготовки, которые не рассматриваются в этом руководстве.</span><span class="sxs-lookup"><span data-stu-id="34aec-220">Other provisioning patterns not included in this tutorial include:</span></span>

<span data-ttu-id="34aec-221">**Предварительная подготовка баз данных.**</span><span class="sxs-lookup"><span data-stu-id="34aec-221">**Pre-provisioning databases.**</span></span> <span data-ttu-id="34aec-222">Hello предварительной подготовки шаблон использует hello факт баз данных в эластичном пуле не добавляйте дополнительных затрат.</span><span class="sxs-lookup"><span data-stu-id="34aec-222">hello pre-provisioning pattern exploits hello fact that databases in an elastic pool do not add extra cost.</span></span> <span data-ttu-id="34aec-223">Выставление счетов осуществляется для эластичного пула hello, не hello баз данных и простоя базы данных использовать ресурсы отсутствуют.</span><span class="sxs-lookup"><span data-stu-id="34aec-223">Billing is for hello elastic pool, not hello databases, and idle databases consume no resources.</span></span> <span data-ttu-id="34aec-224">Предварительная подготовка баз данных в пуле и их выделение при необходимости может значительно сократить время адаптации клиента.</span><span class="sxs-lookup"><span data-stu-id="34aec-224">By pre-provisioning databases in a pool and allocating them when needed, tenant onboarding time can be reduced significantly.</span></span> <span data-ttu-id="34aec-225">Hello число предварительно подготовить базы данных может быть скорректирована, поскольку необходимые tookeep буфера, подходящий для hello ожидать подготовки скорость.</span><span class="sxs-lookup"><span data-stu-id="34aec-225">hello number of databases pre-provisioned could be adjusted as needed tookeep a buffer suitable for hello anticipated provisioning rate.</span></span>

<span data-ttu-id="34aec-226">**Автоматическая подготовка.**</span><span class="sxs-lookup"><span data-stu-id="34aec-226">**Auto-provisioning.**</span></span> <span data-ttu-id="34aec-227">В шаблоне автоматическую подготовку hello выделенная служба подготовки — tooprovision используемых серверов, пулы и баз данных автоматически при необходимости — включая предварительной подготовки базы данных в пулах эластичных БД, при необходимости.</span><span class="sxs-lookup"><span data-stu-id="34aec-227">In hello auto-provisioning pattern, a dedicated provisioning service is used tooprovision servers, pools, and databases automatically as needed – including pre-provisioning databases in elastic pools if desired.</span></span> <span data-ttu-id="34aec-228">И если отменяется по заказу, удалении базы данных пробелы в пулах эластичных БД может заполняться hello подготовки службы в случае необходимости.</span><span class="sxs-lookup"><span data-stu-id="34aec-228">And if databases are de-commissioned and deleted, gaps in elastic pools can be filled by hello provisioning service as desired.</span></span> <span data-ttu-id="34aec-229">Такие службы могут быть простыми или сложными. Они могут, например, управлять подготовкой в нескольких географических регионах и автоматически настраивать георепликацию, если эта стратегия используется для аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="34aec-229">Such a service could be simple or complex – for example, handling provisioning across multiple geographies, and could set up geo-replication automatically if that strategy is being used for disaster recovery.</span></span> <span data-ttu-id="34aec-230">С шаблоном автоматическую подготовку hello клиентского приложения или сценария отправляет подготовки запроса очереди toobe tooa обрабатываемых hello подготовки службы и затем будет запрашивать hello службы toodetermine завершения.</span><span class="sxs-lookup"><span data-stu-id="34aec-230">With hello auto-provisioning pattern, a client application or script would submit a provisioning request tooa queue toobe processed by hello provisioning service, and would then poll hello service toodetermine completion.</span></span> <span data-ttu-id="34aec-231">При использовании предварительной подготовки запросов должен обрабатываться быстро со службой hello управление подготовки заменяющей базы данных, выполняться в фоновом режиме hello.</span><span class="sxs-lookup"><span data-stu-id="34aec-231">If pre-provisioning is used, requests would be handled quickly with hello service managing provisioning of a replacement database running in hello background.</span></span>



## <a name="next-steps"></a><span data-ttu-id="34aec-232">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="34aec-232">Next steps</span></span>

<span data-ttu-id="34aec-233">Из этого руководства вы узнали, как выполнять такие задачи:</span><span class="sxs-lookup"><span data-stu-id="34aec-233">In this tutorial you learned how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="34aec-234">Подготовка нового клиента.</span><span class="sxs-lookup"><span data-stu-id="34aec-234">Provision a single new tenant</span></span>
> * <span data-ttu-id="34aec-235">Подготовка пакета дополнительных клиентов.</span><span class="sxs-lookup"><span data-stu-id="34aec-235">Provision a batch of additional tenants</span></span>
> * <span data-ttu-id="34aec-236">Шаг с заходом сведения hello подготовки клиентов и их регистрации в каталог hello</span><span class="sxs-lookup"><span data-stu-id="34aec-236">Step into hello details of provisioning tenants, and registering them into hello catalog</span></span>

<span data-ttu-id="34aec-237">Повторите hello [учебника мониторинга производительности](sql-database-saas-tutorial-performance-monitoring.md).</span><span class="sxs-lookup"><span data-stu-id="34aec-237">Try hello [Performance monitoring tutorial](sql-database-saas-tutorial-performance-monitoring.md).</span></span>

## <a name="additional-resources"></a><span data-ttu-id="34aec-238">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="34aec-238">Additional Resources</span></span>

* <span data-ttu-id="34aec-239">Дополнительные [учебники, которые созданы на основе Wingtip SaaS приложения hello](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="34aec-239">Additional [tutorials that build upon hello Wingtip SaaS application](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="34aec-240">Клиентская библиотека эластичной базы данных</span><span class="sxs-lookup"><span data-stu-id="34aec-240">Elastic database client library</span></span>](https://docs.microsoft.com/azure/sql-database/sql-database-elastic-database-client-library)
* [<span data-ttu-id="34aec-241">Описание tooDebug скриптов в интегрированной среде Сценариев Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="34aec-241">How tooDebug Scripts in Windows PowerShell ISE</span></span>](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise)
