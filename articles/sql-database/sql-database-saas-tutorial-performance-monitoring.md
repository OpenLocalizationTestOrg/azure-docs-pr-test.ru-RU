---
title: "производительность aaaMonitor много баз данных Azure SQL в приложении SaaS несколькими клиентами | Документы Microsoft"
description: "Мониторинг и управление производительностью баз данных и пулов в приложение hello SaaS Wingtip базы данных SQL Azure"
keywords: "руководство по базе данных sql"
services: sql-database
documentationcenter: 
author: stevestein
manager: craigg
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/26/2017
ms.author: sstein
ms.openlocfilehash: f0d7ba456c485b7de249a56abac3cf4be3857285
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="monitor-performance-of-hello-wingtip-saas-application"></a>Мониторинг производительности приложений Wingtip SaaS hello

В этом руководстве рассматриваются несколько ключевых сценариев управления производительностью, используемых в приложениях SaaS. Применение действия toosimulate генератор нагрузки во всех базах данных клиента, встроенную функцию мониторинга hello и предупреждений функции базы данных SQL и пулов эластичных демонстрируются.

приложение Wingtip SaaS Hello использует модель данных одного клиента, где каждый проведения (клиент) имеет собственную базу данных. Как и многие приложения SaaS hello запланированного шаблон рабочей нагрузки клиента непредсказуемыми и случайные. так как пользователи могут покупать билеты в любое время. tootake преимущество такого шаблона использование обычной базой данных, владелец базы данных развертываются в пулы эластичных баз данных. Эластичные пулы оптимизировать затраты hello решения, совместное использование ресурсов на несколько баз данных. С этим типом шаблона важные toomonitor база данных и пул ресурсов использования tooensure, загружающий достаточно сбалансировать пулы. Необходимо также tooensure, что отдельные базы данных имеют достаточно ресурсов и пулы не предназначаются их [eDTU](sql-database-what-is-a-dtu.md) ограничения. Рассматриваются способы toomonitor этого учебника и управления базами данных и пулов и как tootake корректирующих действий в ответ toovariations в рабочей нагрузке.

Из этого руководства вы узнаете, как выполнить следующие задачи:

> [!div class="checklist"]

> * Имитировать использование на hello базами данных клиента, выполнив предоставленный нагрузки генератор
> * Монитор hello клиента базы данных, как они могут реагировать toohello увеличение нагрузки
> * Вертикальное масштабирование hello эластичного пула в загрузки увеличения базы данных toohello ответа
> * Подготовка второго действия эластичного пула tooload баланс базы данных


toocomplete завершения этого учебника, убедитесь, что hello следующие предварительные требования:

* приложение Wingtip SaaS Hello развертывается. toodeploy менее чем за пять минут. в разделе [развертывание и просмотр приложения Wingtip SaaS hello](sql-database-saas-tutorial.md)
* Установите Azure PowerShell. Дополнительные сведения см. в статье [Начало работы с Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps).

## <a name="introduction-toosaas-performance-management-patterns"></a>Шаблоны управления введение tooSaaS производительности

Управление производительностью базы данных состоит из компиляции и анализ данных о производительности и затем отклик toothis данных путем настройки параметров toomaintain приемлемое время отклика для вашего приложения. При размещении нескольких клиентов, пулы эластичных баз данных являются tooprovide экономичное решение ресурсы и управлять ими для группы баз данных с непредсказуемыми рабочих нагрузок. Используя определенные шаблоны рабочей нагрузки, средства можно сэкономить при наличии всего лишь двух баз данных уровня S3.

![Схема](./media/sql-database-saas-tutorial-performance-monitoring/app-diagram.png)

Пулы и баз данных hello в пулы, должны быть отслеживаемых tooensure, они остаются в допустимых пределах производительности. Настройка hello пула конфигурации toomeet hello потребностей hello статистические рабочей нагрузки всех баз данных, убедитесь, что подходит для hello Edtu пула hello общей рабочей нагрузке. Настройте hello каждой базы данных min и -database max eDTU значения tooappropriate значения требований конкретного приложения.

### <a name="performance-management-strategies"></a>Стратегии управления производительностью

* tooavoid с toomanually мониторинг производительности, является наиболее эффективным слишком**настроить оповещения, которые активированы при баз данных или пулы ни из стандартных диапазонах**.
* Здравствуйте toorespond tooshort термин колебания уровень производительность aggregate hello пула, **уровень eDTU пула могут масштабироваться вверх или вниз**. При этом колебания на основе регулярно или с предсказуемой **масштабирование hello пула может быть запланированных toooccur автоматически**. Например,если рабочая нагрузка незначительная (ночью или на выходных), масштаб можно уменьшить.
* колебания термин toolonger toorespond или изменения hello число баз данных, **отдельных баз данных могут быть перемещены в другие пулы**.
* Термин tooshort toorespond увеличивается в *отдельных* загрузки базы данных **отдельных баз данных может быть удален из пула и назначить уровень производительности**. После загрузки hello уменьшается, hello базы данных, может быть возвращен toohello пула. Если это известна заранее, баз данных могут быть перемещены вытеснением базы данных hello tooensure всегда имеет hello ресурсы, которые необходимы и tooavoid влияние на другие базы данных в пуле hello. Если это требование является прогнозируемым, например помещение, возникают срочный билет продаж для популярных события, это поведение управления может быть интегрирован в приложение hello.

Hello [портал Azure](https://portal.azure.com) предоставляет встроенные мониторинг и предупреждения в больше всего ресурсов. Для базы данных SQL средства мониторинга и создания оповещений доступны в базах данных и пулах. Этот встроенный мониторинга и оповещений конкретного ресурса, это удобный toouse для небольшого количества ресурсов, но не очень удобен при работе с много ресурсов.

Для сценариев с большим количеством операций при работе с большим числом ресурсов можно использовать [Log Analytics (OMS)](sql-database-saas-tutorial-log-analytics.md). Это отдельная служба Azure, которая предоставляет аналитические сведения на основе журналов диагностики и данных телеметрии, собранных в рабочей области Log Analytics. Служба аналитики журналов можно собирать данные телеметрии из многих служб и используется tooquery и устанавливать предупреждения.

## <a name="get-hello-wingtip-application-source-code-and-scripts"></a>Получить исходный код приложения Wingtip hello и сценариев

Hello Wingtip SaaS скриптов и исходный код приложения были доступны в hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) в репозитории github. [Действия скриптов Wingtip SaaS hello toodownload](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).

## <a name="provision-additional-tenants"></a>Подготовка дополнительных клиентов

Пулы могут быть экономичное с базами данных двух S3, hello несколько баз данных в более экономически hello пула hello становится hello усреднение эффект. Чтобы полностью продемонстрировать принципы работы мониторинга производительности и управления ею, для работы с этим руководством необходимо развернуть по крайней мере 20 баз данных.

Если уже подготовлена пакета клиентов из предыдущего учебника, пропустите toohello [имитировать использования для всех баз данных клиента](#simulate-usage-on-all-tenant-databases) раздела.

1. Открыть... \\Модулей обучения\\управления и наблюдения за производительностью\\*Демонстрация PerformanceMonitoringAndManagement.ps1* в hello *интегрированной среды Сценариев PowerShell*. Не закрывайте этот скрипт, так как он еще понадобится в рамках этого руководства.
1. Чтобы выбрать скрипт **подготовки пакета клиентов**, задайте параметр **$DemoScenario** = **1**.
1. Нажмите клавишу **F5** toorun hello скрипта.

сценарий Hello развернет 17 клиентов менее чем за пять минут.

Hello *New TenantBatch* скрипт использует вложенные или связанный набор [диспетчера ресурсов](../azure-resource-manager/index.md) шаблонов, создайте пакет клиентов, которые по умолчанию копирует базу данных hello **basetenantdb** на hello каталога сервера toocreate hello новой базы данных клиента, затем регистрирует их в каталог hello и наконец инициализирует их с типом hello клиента имя и место проведения. Это согласуется с hello, как приложение hello подготавливает новый клиент. Любые изменения, внесенные слишком*basetenantdb* , примененные tooany новых клиентов, подготовлены соответственно. Hello в разделе [учебника схема управления](sql-database-saas-tutorial-schema-management.md) toosee слишком изменение схемы toomake*существующие* клиента баз данных (включая hello *basetenantdb* базы данных).

## <a name="simulate-usage-on-all-tenant-databases"></a>Моделирование использования ресурсов во всех базах данных клиентов

Hello *PerformanceMonitoringAndManagement.ps1 Демонстрация* предоставляется скрипт, имитирует относительно рабочей нагрузки для всех баз данных клиента. Hello нагрузка создается с помощью одного из сценариев hello доступных нагрузки:

| Демонстрация | Сценарий |
|:--|:--|
| 2 | Создание нагрузки с обычной интенсивностью (около 40 DTU). |
| 3 | Создание нагрузки с более длительными и частыми пиками на базу данных.|
| 4. | Создание нагрузки с интенсивным использованием единиц DTU при пиках на базу данных (около 80 DTU).|
| 5 | Создание нормальной нагрузки с высокой нагрузкой на отдельный клиент (около 95 DTU).|
| 6 | Создание неравномерной нагрузки между несколькими пулами.|

Генератор нагрузки Hello применяется *искусственного* базы данных клиента tooevery нагрузки только для ЦП. Генератор Hello запускает задание для каждой базы данных клиента, который вызывает хранимую процедуру периодически, приводит к возникновению ошибки загрузки hello. во всех базах данных, имитация клиента непредсказуемые действия имеют разные Hello нагрузки уровней (Edtu), продолжительность и интервалов.

1. Открыть... \\Модулей обучения\\управления и наблюдения за производительностью\\*Демонстрация PerformanceMonitoringAndManagement.ps1* в hello *интегрированной среды Сценариев PowerShell*. Не закрывайте этот скрипт, так как он еще понадобится в рамках этого руководства.
1. Чтобы выполнить скрипт *создания нагрузки с обычной интенсивностью*, задайте параметр **$DemoScenario** = **2**.
1. Нажмите клавишу **F5** tooapply tooall нагрузки баз данных клиента.

Wingtip приложению SaaS, который hello реальной нагрузки на приложение SaaS обычно случайные и непредсказуемым. toosimulate это hello нагрузки генератор формирует случайное нагрузки распределены по всем клиентам. Tooemerge шаблон нагрузки hello, выполните 3-5 минут, прежде чем toomonitor hello нагрузки в следующих разделах hello генератор нагрузки hello необходимы несколько минут.

> [!IMPORTANT]
> Генератор нагрузки Hello выполняется как ряд заданий в локальном сеансе PowerShell. Сохранить hello *PerformanceMonitoringAndManagement.ps1 Демонстрация* откройте вкладку! Если закрыть вкладку hello, или спящий компьютер, генератор нагрузки hello останавливается. Генератор нагрузки Hello остается в *вызова задания* состояние, где он создает нагрузку на любой новых клиентов, которые подготавливаются к работе после запуска генератора hello. Используйте *Ctrl-C* toostop вызов новые задания и скрипт hello выхода. Генератор нагрузки Hello по-прежнему toorun, но только для существующих клиентов.

## <a name="monitor-resource-usage-using-hello-azure-portal"></a>Наблюдение за использованием ресурсов, с помощью портала Azure hello

Использование ресурсов toomonitor hello, загрузить результаты из hello применения, откройте hello портала toohello пул, содержащий hello базами данных клиента:

1. Откройте hello [портал Azure](https://portal.azure.com) и обзор toohello *tenants1 -&lt;пользователя&gt;*  сервера.
1. Прокрутите вниз и найдите эластичные пулы. Затем щелкните **Pool1**. Этот пул содержит все базы данных клиента hello, созданных ранее.

Наблюдать за hello **мониторинг эластичного пула** и **эластичной базы данных мониторинга** диаграммы.

Hello использование пула ресурсов является использование hello статистические базы данных для всех баз данных в пуле hello. Диаграмма базы данных Hello показывает hello пять наиболее баз данных:

![](./media/sql-database-saas-tutorial-performance-monitoring/pool1.png)

Из-за дополнительных баз данных в пуле hello за пределами Здравствуйте пяти top, использование пула hello показаны действия, которые не отражены в верхней диаграмме пять баз данных hello. Чтобы просмотреть дополнительные сведения, щелкните **Использование ресурсов базы данных**:

![](./media/sql-database-saas-tutorial-performance-monitoring/database-utilization.png)


## <a name="set-performance-alerts-on-hello-pool"></a>Настройка оповещений о производительности в пуле hello

Создать оповещение для hello пула, который активирует \>75% использования следующим образом:

1. Откройте *Pool1* (на hello *tenants1 -\<пользователя\>*  сервера) в hello [портал Azure](https://portal.azure.com).
1. Щелкните **Правила оповещения**, а затем выберите **+ Добавить оповещение**:

   ![Добавление оповещения](media/sql-database-saas-tutorial-performance-monitoring/add-alert.png)

1. Укажите имя, например **High DTU**.
1. Набор hello следующие значения:
   * **"Метрика": eDTU percentage** (Процент eDTU);
   * **"Условие": "Больше"**;
   * **"Пороговое значение": 75**;
   * **Период = через hello последних 30 минут**.
1. Добавьте адрес электронной почты toohello *email(s) дополнительного администратора* и нажмите кнопку **ОК**.

   ![настройка оповещения](media/sql-database-saas-tutorial-performance-monitoring/alert-rule.png)


## <a name="scale-up-a-busy-pool"></a>Увеличение масштаба загруженного пула

Уровень суммарную нагрузку hello увеличивается на точке toohello пула он двухъядерной пула hello и достигает 100% объем использования eDTU, затем отдельной базы данных снижается производительность, потенциально снижению времени отклика запросов для всех баз данных в пуле hello.

**Краткосрочные**, рассмотрите возможность удаления базы данных из пула hello, или вертикальное масштабирование hello пула tooprovide дополнительные ресурсы (их перемещение пулов tooother или из изолированного уровня пула hello tooa).

**Более**, возможно, следует оптимизировать запросы или индекса производительности базы данных об использовании tooimprove. В зависимости от hello tooperformance чувствительности приложения выдает его лучший подход tooscale пула копирование достигает 100% объем использования eDTU. Использовать предупреждения toowarn вы заранее.

Можно имитировать занят пула, увеличение нагрузки hello, созданных генератором hello. Приводит к tooburst hello баз данных более часто, а также для hello и увеличение более суммарную нагрузку на пул hello без изменения требований hello hello отдельных баз данных. Вертикальное масштабирование пула hello легко сделать на портале hello или из PowerShell. В этом упражнении используется портал hello.

1. Задать *$DemoScenario* = **3**, _нагрузки формирования увеличениям больше времени и более частыми каждой базы данных_ tooincrease интенсивность hello hello суммарную нагрузку на пул Hello без изменения hello пиковой нагрузки, необходимую для каждой базы данных.
1. Нажмите клавишу **F5** tooapply tooall нагрузки баз данных клиента.

1. Go слишком**Pool1** в hello портал Azure.

Монитор hello увеличить объем использования eDTU пула на верхней диаграмме hello. Hello новый выше нагрузки tookick в несколько минут, но вы увидите быстро начать использование max toohit пула hello и как hello нагрузки steadies в новый шаблон hello, быстро перегрузки пула hello.

1. Щелкните tooscale пула hello, **настроить пул** вверху hello hello **Pool1** страницы.
1. Настройка hello **eDTU пула** задание слишком**100**. Изменение eDTU пула hello не изменяет параметры hello каждой базы данных (которые по-прежнему 50 eDTU max каждой базы данных). Вы увидите hello каждой базы данных параметры hello правой части hello **настроить пул** страницы.
1. Нажмите кнопку **Сохранить** toosubmit hello запроса tooscale hello пула.

Возврат слишком**Pool1** > **Обзор** tooview hello диаграммы мониторинга. Отслеживать влияние hello предоставления hello пул с большим объемом ресурсов (несмотря на то, что несколько баз данных и случайного нагрузки не всегда легко toosee окончательно пока не будет работать некоторое время). При просмотре диаграммы содержат hello в виду, что 100% на верхнем hello теперь диаграммы представляет количество 100 Edtu, пока на hello ниже 100% диаграммы по-прежнему 50 edtu, которое как hello каждой базы данных max по-прежнему 50 edtu, которое.

Базы данных оставаться в сети полностью доступны на протяжении всего процесса hello. В hello последний момент как каждая база данных готова toobe включено с новой eDTU пула hello, все активные подключения не работают. Код приложения всегда должны быть написаны подключения tooretry удалены и поэтому может восстанавливаться база данных toohello в пуле масштабированных hello.

## <a name="load-balance-between-pools"></a>Распределение нагрузки между пулами

Как альтернативный tooscaling пула hello, создания второго пула и переместить базы данных в нее toobalance hello загрузить между hello два пула. Этот новый пул hello должен быть создан в toodo сначала hello сервере hello.

1. В hello [портал Azure](https://portal.azure.com)откройте hello **tenants1 -&lt;пользователя&gt;**  сервера.
1. Нажмите кнопку **+ новый пул** toocreate пула на текущем сервере hello.
1. На hello **пул эластичных баз данных** шаблона:

    1. Задать **имя** слишком*Pool2*.
    1. Оставьте hello ценовой категории как **стандартный пул**.
    1. Щелкните **Настроить пул**.
    1. Задать **eDTU пула** слишком*50 eDTU*.
    1. Нажмите кнопку **добавления баз данных** toosee список баз данных на сервере hello, который может быть добавлен слишком*Pool2*.
    1. Выберите новый пул этих toohello любой toomove 10 баз данных и нажмите кнопку **выберите**. Если работы генератор нагрузки hello, hello службы уже знает, что профиль производительности требует пула большего размера, чем размер 50 eDTU по умолчанию hello и рекомендует начиная с 100 стандарта eDTU.

    ![рекомендация](media/sql-database-saas-tutorial-performance-monitoring/configure-pool.png)

    1. В этом учебнике, оставьте 50 edtu, которое по умолчанию hello и нажмите кнопку **выберите** еще раз.
    1. Выберите **ОК** toocreate hello новый пул и toomove hello выбранных баз данных в него.

Создание пула hello и перемещение баз данных hello занимает несколько минут. При перемещении баз данных остаются полностью доступны до hello самый последний момент, после чего все открытые соединения закрываются. Пока у вас есть определенную логику повторных попыток, клиенты, подключится toohello базы данных в новый пул hello.

Обзор слишком**Pool2** (на hello *tenants1* сервера) tooopen hello пула и отслеживать его производительность. Если вы не видите его, дождитесь подготовки нового пула toocomplete hello.

Использование ресурсов в пуле *Pool1* снизилось, а нагрузка равномерно распределена между ним и пулом *Pool2*.

## <a name="manage-performance-of-a-single-database"></a>Управление производительностью отдельной базы данных

Если в одной базы данных в пуле длительной высокой нагрузки, в зависимости от конфигурации пула hello, он toodominate hello ресурсов в пуле hello, как правило и повлиять на другие базы данных. Если действие hello, скорее всего, toocontinue некоторое время hello базы данных можно временно перевести из пула hello. Это позволяет toohave hello hello базы данных дополнительные ресурсы требуются и изолирует из hello других баз данных.

В этом упражнении имитирует эффект hello Hall совместно Contoso возникла высокая нагрузка при билеты перейти на продажи для популярных совместно.

1. Привет открыть... \\ *PerformanceMonitoringAndManagement.ps1 Демонстрация* сценария.
1. Чтобы выполнить скрипт **создания нормальной нагрузки с высокой нагрузкой на отдельный клиент (около 95 DTU), задайте для параметра $DemoScenario значение 5**.
1. Задайте параметр **$SingleTenantDatabaseName = contosoconcerthall**.
1. Выполнение скрипта с помощью hello **F5**.


1. В hello [портал Azure](https://portal.azure.com) откройте **Pool1**.
1. Проверять hello **мониторинг эластичного пула** диаграммы и найдите hello увеличить объем использования eDTU пула. Одну-две минуты большую нагрузку hello следует начинать tookick в после следует сразу видеть, что пул hello достигает 100% использованию.
1. Проверять hello **эластичной базы данных мониторинга** экрана, показывающий баз данных предоставляет новые hello в hello последний час. Hello *contosoconcerthall* базы данных вскоре будут отображаться как один из наиболее hello пяти баз данных.
1. **Щелкните hello эластичной базы данных мониторинга** **диаграммы** открывается hello **использования ресурсов базы данных** страницы, где вы можете отслеживать hello базах данных. Это позволяет изолировать hello отображением hello *contosoconcerthall* базы данных.
1. Hello списке баз данных, нажмите кнопку **contosoconcerthall**.
1. Нажмите кнопку **ценовую категорию (масштаб Dtu)** tooopen hello **настройки производительности** страницы, где можно задать уровень автономного производительности для базы данных hello.
1. Щелкните hello **Стандартная** параметры масштабирования hello tooopen hello стандартном уровне.
1. Слайд hello **ползунок DTU** tooright tooselect **100** Dtu. Обратите внимание, это соответствует цели обслуживания toohello, **S3**.
1. Нажмите кнопку **применить** toomove hello базы данных за пределы пула hello и сделать его *Standard S3* базы данных.
1. После масштабирования завершите, монитор hello влияние на базу данных contosoconcerthall hello и Pool1 на hello эластичный пул и базы данных колонок.

После интенсивности hello высокой нагрузки на базу данных contosoconcerthall hello незамедлительно верните его tooreduce пула toohello его стоимости. Если неясно, при, произойдет, можно задать предупреждения для базы данных hello, будет вызываться, когда его использование DTU падает ниже hello каждой базы данных в пуле hello max. Перемещение базы данных в пул описано в упражнении 5.

## <a name="other-performance-management-patterns"></a>Другие шаблоны управления производительностью

**Масштабирование упреждающие** в hello упражнении выше где изучена как tooscale изолированную базу данных, точно будете знать, какие базы данных toolook для. Если управление hello Hall совместно Contoso проинформировать Wingtips hello предстоящих продажи билетов, hello базы данных могли быть перемещены за пределы пула hello вытеснением. В противном случае он скорее всего потребовалась бы предупреждения на пул hello или toospot hello базы данных что происходило. Не стоит toolearn об этом из hello других клиентов в пул hello, обнаруживших от низкой производительности. И если hello клиента может предсказать, как долго они потребуются дополнительные ресурсы, можно установить базу данных Azure Automation runbook toomove hello вне пула hello, а затем снова в по заданному расписанию.

**Масштабирование клиента самообслуживания** так, как масштабирование осуществляется легко вызвать через API-Интерфейс управления hello, можно легко встраивать возможности hello tooscale базы данных клиента в приложение стороне клиента и предложить его как компонент службы SaaS. Например, пусть клиентов self-administer масштабирование вверх и вниз, может быть напрямую связывать выставления счетов tootheir!

**Масштабирование пула вверх и вниз на моделях использования toomatch расписания**

При использования агрегатных клиента соответствует прогнозируемого использования шаблонов, можно использовать службы автоматизации Azure tooscale пул вверх и вниз по расписанию. Например, после 18:00 масштаб пула можно уменьшить, а в рабочие дни в 06:00 обратно увеличить.



## <a name="next-steps"></a>Дальнейшие действия

Из этого руководства вы узнаете, как выполнить следующие задачи:

> [!div class="checklist"]
> * Имитировать использование на hello базами данных клиента, выполнив предоставленный нагрузки генератор
> * Монитор hello клиента базы данных, как они могут реагировать toohello увеличение нагрузки
> * Вертикальное масштабирование hello эластичного пула в загрузки увеличения базы данных toohello ответа
> * Подготовка второго эластичного пула tooload баланс hello базы данных действия

[Restore a single tenant database](sql-database-saas-tutorial-restore-single-tenant.md) (Восстановление базы данных отдельного клиента)


## <a name="additional-resources"></a>Дополнительные ресурсы

* Дополнительные [учебники, которые созданы на основе hello Wingtip SaaS развертывания приложения](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)
* [Когда следует использовать эластичный пул?](sql-database-elastic-pool.md)
* [Служба автоматизации Azure](../automation/automation-intro.md)
* [Настройка и использование Log Analytics (OMS) с примером приложения SaaS WTP](sql-database-saas-tutorial-log-analytics.md)
