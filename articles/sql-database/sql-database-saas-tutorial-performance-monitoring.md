---
title: "производительность aaaMonitor много баз данных Azure SQL в приложении SaaS несколькими клиентами | Документы Microsoft"
description: "Мониторинг и управление производительностью баз данных и пулов в приложение hello SaaS Wingtip базы данных SQL Azure"
keywords: "руководство по базе данных sql"
services: sql-database
documentationcenter: 
author: stevestein
manager: craigg
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/26/2017
ms.author: sstein
ms.openlocfilehash: f0d7ba456c485b7de249a56abac3cf4be3857285
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="monitor-performance-of-hello-wingtip-saas-application"></a><span data-ttu-id="b81e5-104">Мониторинг производительности приложений Wingtip SaaS hello</span><span class="sxs-lookup"><span data-stu-id="b81e5-104">Monitor performance of hello Wingtip SaaS application</span></span>

<span data-ttu-id="b81e5-105">В этом руководстве рассматриваются несколько ключевых сценариев управления производительностью, используемых в приложениях SaaS.</span><span class="sxs-lookup"><span data-stu-id="b81e5-105">In this tutorial, several key performance management scenarios used in SaaS applications are explored.</span></span> <span data-ttu-id="b81e5-106">Применение действия toosimulate генератор нагрузки во всех базах данных клиента, встроенную функцию мониторинга hello и предупреждений функции базы данных SQL и пулов эластичных демонстрируются.</span><span class="sxs-lookup"><span data-stu-id="b81e5-106">Using a load generator toosimulate activity across all tenant databases, hello built-in monitoring and alerting features of SQL Database and elastic pools are demonstrated.</span></span>

<span data-ttu-id="b81e5-107">приложение Wingtip SaaS Hello использует модель данных одного клиента, где каждый проведения (клиент) имеет собственную базу данных.</span><span class="sxs-lookup"><span data-stu-id="b81e5-107">hello Wingtip SaaS app uses a single-tenant data model, where each venue (tenant) has their own database.</span></span> <span data-ttu-id="b81e5-108">Как и многие приложения SaaS hello запланированного шаблон рабочей нагрузки клиента непредсказуемыми и случайные.</span><span class="sxs-lookup"><span data-stu-id="b81e5-108">Like many SaaS applications, hello anticipated tenant workload pattern is unpredictable and sporadic.</span></span> <span data-ttu-id="b81e5-109">так как пользователи могут покупать билеты в любое время.</span><span class="sxs-lookup"><span data-stu-id="b81e5-109">In other words, ticket sales may occur at any time.</span></span> <span data-ttu-id="b81e5-110">tootake преимущество такого шаблона использование обычной базой данных, владелец базы данных развертываются в пулы эластичных баз данных.</span><span class="sxs-lookup"><span data-stu-id="b81e5-110">tootake advantage of this typical database usage pattern, tenant databases are deployed into elastic database pools.</span></span> <span data-ttu-id="b81e5-111">Эластичные пулы оптимизировать затраты hello решения, совместное использование ресурсов на несколько баз данных.</span><span class="sxs-lookup"><span data-stu-id="b81e5-111">Elastic pools optimize hello cost of a solution by sharing resources across many databases.</span></span> <span data-ttu-id="b81e5-112">С этим типом шаблона важные toomonitor база данных и пул ресурсов использования tooensure, загружающий достаточно сбалансировать пулы.</span><span class="sxs-lookup"><span data-stu-id="b81e5-112">With this type of pattern, it's important toomonitor database and pool resource usage tooensure that loads are reasonably balanced across pools.</span></span> <span data-ttu-id="b81e5-113">Необходимо также tooensure, что отдельные базы данных имеют достаточно ресурсов и пулы не предназначаются их [eDTU](sql-database-what-is-a-dtu.md) ограничения.</span><span class="sxs-lookup"><span data-stu-id="b81e5-113">You also need tooensure that individual databases have adequate resources, and that pools are not hitting their [eDTU](sql-database-what-is-a-dtu.md) limits.</span></span> <span data-ttu-id="b81e5-114">Рассматриваются способы toomonitor этого учебника и управления базами данных и пулов и как tootake корректирующих действий в ответ toovariations в рабочей нагрузке.</span><span class="sxs-lookup"><span data-stu-id="b81e5-114">This tutorial explores ways toomonitor and manage databases and pools, and how tootake corrective action in response toovariations in workload.</span></span>

<span data-ttu-id="b81e5-115">Из этого руководства вы узнаете, как выполнить следующие задачи:</span><span class="sxs-lookup"><span data-stu-id="b81e5-115">In this tutorial you learn how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="b81e5-116">Имитировать использование на hello базами данных клиента, выполнив предоставленный нагрузки генератор</span><span class="sxs-lookup"><span data-stu-id="b81e5-116">Simulate usage on hello tenant databases by running a provided load generator</span></span>
> * <span data-ttu-id="b81e5-117">Монитор hello клиента базы данных, как они могут реагировать toohello увеличение нагрузки</span><span class="sxs-lookup"><span data-stu-id="b81e5-117">Monitor hello tenant databases as they respond toohello increase in load</span></span>
> * <span data-ttu-id="b81e5-118">Вертикальное масштабирование hello эластичного пула в загрузки увеличения базы данных toohello ответа</span><span class="sxs-lookup"><span data-stu-id="b81e5-118">Scale up hello Elastic pool in response toohello increased database load</span></span>
> * <span data-ttu-id="b81e5-119">Подготовка второго действия эластичного пула tooload баланс базы данных</span><span class="sxs-lookup"><span data-stu-id="b81e5-119">Provision a second Elastic pool tooload balance database activity</span></span>


<span data-ttu-id="b81e5-120">toocomplete завершения этого учебника, убедитесь, что hello следующие предварительные требования:</span><span class="sxs-lookup"><span data-stu-id="b81e5-120">toocomplete this tutorial, make sure hello following prerequisites are completed:</span></span>

* <span data-ttu-id="b81e5-121">приложение Wingtip SaaS Hello развертывается.</span><span class="sxs-lookup"><span data-stu-id="b81e5-121">hello Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="b81e5-122">toodeploy менее чем за пять минут. в разделе [развертывание и просмотр приложения Wingtip SaaS hello](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="b81e5-122">toodeploy in less than five minutes, see [Deploy and explore hello Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="b81e5-123">Установите Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b81e5-123">Azure PowerShell is installed.</span></span> <span data-ttu-id="b81e5-124">Дополнительные сведения см. в статье [Начало работы с Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps).</span><span class="sxs-lookup"><span data-stu-id="b81e5-124">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>

## <a name="introduction-toosaas-performance-management-patterns"></a><span data-ttu-id="b81e5-125">Шаблоны управления введение tooSaaS производительности</span><span class="sxs-lookup"><span data-stu-id="b81e5-125">Introduction tooSaaS performance management patterns</span></span>

<span data-ttu-id="b81e5-126">Управление производительностью базы данных состоит из компиляции и анализ данных о производительности и затем отклик toothis данных путем настройки параметров toomaintain приемлемое время отклика для вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="b81e5-126">Managing database performance consists of compiling and analyzing performance data, and then reacting toothis data by adjusting parameters toomaintain an acceptable response time for your application.</span></span> <span data-ttu-id="b81e5-127">При размещении нескольких клиентов, пулы эластичных баз данных являются tooprovide экономичное решение ресурсы и управлять ими для группы баз данных с непредсказуемыми рабочих нагрузок.</span><span class="sxs-lookup"><span data-stu-id="b81e5-127">When hosting multiple tenants, Elastic database pools are a cost-effective way tooprovide and manage resources for a group of databases with unpredictable workloads.</span></span> <span data-ttu-id="b81e5-128">Используя определенные шаблоны рабочей нагрузки, средства можно сэкономить при наличии всего лишь двух баз данных уровня S3.</span><span class="sxs-lookup"><span data-stu-id="b81e5-128">With certain workload patterns, as few as two S3 databases can benefit from being managed in a pool.</span></span>

![Схема](./media/sql-database-saas-tutorial-performance-monitoring/app-diagram.png)

<span data-ttu-id="b81e5-130">Пулы и баз данных hello в пулы, должны быть отслеживаемых tooensure, они остаются в допустимых пределах производительности.</span><span class="sxs-lookup"><span data-stu-id="b81e5-130">Pools, and hello databases in pools, should be monitored tooensure they stay within acceptable ranges of performance.</span></span> <span data-ttu-id="b81e5-131">Настройка hello пула конфигурации toomeet hello потребностей hello статистические рабочей нагрузки всех баз данных, убедитесь, что подходит для hello Edtu пула hello общей рабочей нагрузке.</span><span class="sxs-lookup"><span data-stu-id="b81e5-131">Tune hello pool configuration toomeet hello needs of hello aggregate workload of all databases, ensuring that hello pool eDTUs are appropriate for hello overall workload.</span></span> <span data-ttu-id="b81e5-132">Настройте hello каждой базы данных min и -database max eDTU значения tooappropriate значения требований конкретного приложения.</span><span class="sxs-lookup"><span data-stu-id="b81e5-132">Adjust hello per-database min and per-database max eDTU values tooappropriate values for your specific application requirements.</span></span>

### <a name="performance-management-strategies"></a><span data-ttu-id="b81e5-133">Стратегии управления производительностью</span><span class="sxs-lookup"><span data-stu-id="b81e5-133">Performance management strategies</span></span>

* <span data-ttu-id="b81e5-134">tooavoid с toomanually мониторинг производительности, является наиболее эффективным слишком**настроить оповещения, которые активированы при баз данных или пулы ни из стандартных диапазонах**.</span><span class="sxs-lookup"><span data-stu-id="b81e5-134">tooavoid having toomanually monitor performance, it’s most effective too**set alerts that trigger when databases or pools stray out of normal ranges**.</span></span>
* <span data-ttu-id="b81e5-135">Здравствуйте toorespond tooshort термин колебания уровень производительность aggregate hello пула, **уровень eDTU пула могут масштабироваться вверх или вниз**.</span><span class="sxs-lookup"><span data-stu-id="b81e5-135">toorespond tooshort-term fluctuations in hello aggregate performance level of a pool, hello **pool eDTU level can be scaled up or down**.</span></span> <span data-ttu-id="b81e5-136">При этом колебания на основе регулярно или с предсказуемой **масштабирование hello пула может быть запланированных toooccur автоматически**.</span><span class="sxs-lookup"><span data-stu-id="b81e5-136">If this fluctuation occurs on a regular or predictable basis, **scaling hello pool can be scheduled toooccur automatically**.</span></span> <span data-ttu-id="b81e5-137">Например,если рабочая нагрузка незначительная (ночью или на выходных), масштаб можно уменьшить.</span><span class="sxs-lookup"><span data-stu-id="b81e5-137">For example, scale down when you know your workload is light, maybe overnight, or during weekends.</span></span>
* <span data-ttu-id="b81e5-138">колебания термин toolonger toorespond или изменения hello число баз данных, **отдельных баз данных могут быть перемещены в другие пулы**.</span><span class="sxs-lookup"><span data-stu-id="b81e5-138">toorespond toolonger-term fluctuations, or changes in hello number of databases, **individual databases can be moved into other pools**.</span></span>
* <span data-ttu-id="b81e5-139">Термин tooshort toorespond увеличивается в *отдельных* загрузки базы данных **отдельных баз данных может быть удален из пула и назначить уровень производительности**.</span><span class="sxs-lookup"><span data-stu-id="b81e5-139">toorespond tooshort term increases in *individual* database load **individual databases can be taken out of a pool and assigned an individual performance level**.</span></span> <span data-ttu-id="b81e5-140">После загрузки hello уменьшается, hello базы данных, может быть возвращен toohello пула.</span><span class="sxs-lookup"><span data-stu-id="b81e5-140">Once hello load is reduced, hello database can then be returned toohello pool.</span></span> <span data-ttu-id="b81e5-141">Если это известна заранее, баз данных могут быть перемещены вытеснением базы данных hello tooensure всегда имеет hello ресурсы, которые необходимы и tooavoid влияние на другие базы данных в пуле hello.</span><span class="sxs-lookup"><span data-stu-id="b81e5-141">When this is known in advance, databases can be moved pre-emptively tooensure hello database always has hello resources it needs, and tooavoid impact on other databases in hello pool.</span></span> <span data-ttu-id="b81e5-142">Если это требование является прогнозируемым, например помещение, возникают срочный билет продаж для популярных события, это поведение управления может быть интегрирован в приложение hello.</span><span class="sxs-lookup"><span data-stu-id="b81e5-142">If this requirement is predictable, such as a venue experiencing a rush of ticket sales for a popular event, then this management behavior can be integrated into hello application.</span></span>

<span data-ttu-id="b81e5-143">Hello [портал Azure](https://portal.azure.com) предоставляет встроенные мониторинг и предупреждения в больше всего ресурсов.</span><span class="sxs-lookup"><span data-stu-id="b81e5-143">hello [Azure portal](https://portal.azure.com) provides built-in monitoring and alerting on most resources.</span></span> <span data-ttu-id="b81e5-144">Для базы данных SQL средства мониторинга и создания оповещений доступны в базах данных и пулах.</span><span class="sxs-lookup"><span data-stu-id="b81e5-144">For SQL Database, monitoring and alerting is available on databases and pools.</span></span> <span data-ttu-id="b81e5-145">Этот встроенный мониторинга и оповещений конкретного ресурса, это удобный toouse для небольшого количества ресурсов, но не очень удобен при работе с много ресурсов.</span><span class="sxs-lookup"><span data-stu-id="b81e5-145">This built-in monitoring and alerting is resource-specific, so it's convenient toouse for small numbers of resources, but is not very convenient when working with many resources.</span></span>

<span data-ttu-id="b81e5-146">Для сценариев с большим количеством операций при работе с большим числом ресурсов можно использовать [Log Analytics (OMS)](sql-database-saas-tutorial-log-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="b81e5-146">For high-volume scenarios where you're working with many reources, [Log Analytics (OMS)](sql-database-saas-tutorial-log-analytics.md) can be used.</span></span> <span data-ttu-id="b81e5-147">Это отдельная служба Azure, которая предоставляет аналитические сведения на основе журналов диагностики и данных телеметрии, собранных в рабочей области Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="b81e5-147">This is a separate Azure service that provides analytics over emitted diagnostic logs and telemetry gathered in a log analytics workspace.</span></span> <span data-ttu-id="b81e5-148">Служба аналитики журналов можно собирать данные телеметрии из многих служб и используется tooquery и устанавливать предупреждения.</span><span class="sxs-lookup"><span data-stu-id="b81e5-148">Log Analytics can collect telemetry from many services and be used tooquery and set alerts.</span></span>

## <a name="get-hello-wingtip-application-source-code-and-scripts"></a><span data-ttu-id="b81e5-149">Получить исходный код приложения Wingtip hello и сценариев</span><span class="sxs-lookup"><span data-stu-id="b81e5-149">Get hello Wingtip application source code and scripts</span></span>

<span data-ttu-id="b81e5-150">Hello Wingtip SaaS скриптов и исходный код приложения были доступны в hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) в репозитории github.</span><span class="sxs-lookup"><span data-stu-id="b81e5-150">hello Wingtip SaaS scripts and application source code are available in hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="b81e5-151">[Действия скриптов Wingtip SaaS hello toodownload](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="b81e5-151">[Steps toodownload hello Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>

## <a name="provision-additional-tenants"></a><span data-ttu-id="b81e5-152">Подготовка дополнительных клиентов</span><span class="sxs-lookup"><span data-stu-id="b81e5-152">Provision additional tenants</span></span>

<span data-ttu-id="b81e5-153">Пулы могут быть экономичное с базами данных двух S3, hello несколько баз данных в более экономически hello пула hello становится hello усреднение эффект.</span><span class="sxs-lookup"><span data-stu-id="b81e5-153">While pools can be cost-effective with just two S3 databases, hello more databases that are in hello pool hello more cost-effective hello averaging effect becomes.</span></span> <span data-ttu-id="b81e5-154">Чтобы полностью продемонстрировать принципы работы мониторинга производительности и управления ею, для работы с этим руководством необходимо развернуть по крайней мере 20 баз данных.</span><span class="sxs-lookup"><span data-stu-id="b81e5-154">For a good understanding of how performance monitoring and management works at scale, this tutorial requires you have at least 20 databases deployed.</span></span>

<span data-ttu-id="b81e5-155">Если уже подготовлена пакета клиентов из предыдущего учебника, пропустите toohello [имитировать использования для всех баз данных клиента](#simulate-usage-on-all-tenant-databases) раздела.</span><span class="sxs-lookup"><span data-stu-id="b81e5-155">If you already provisioned a batch of tenants in a prior tutorial, skip toohello [Simulate usage on all tenant databases](#simulate-usage-on-all-tenant-databases) section.</span></span>

1. <span data-ttu-id="b81e5-156">Открыть... \\Модулей обучения\\управления и наблюдения за производительностью\\*Демонстрация PerformanceMonitoringAndManagement.ps1* в hello *интегрированной среды Сценариев PowerShell*.</span><span class="sxs-lookup"><span data-stu-id="b81e5-156">Open …\\Learning Modules\\Performance Monitoring and Management\\*Demo-PerformanceMonitoringAndManagement.ps1* in hello *PowerShell ISE*.</span></span> <span data-ttu-id="b81e5-157">Не закрывайте этот скрипт, так как он еще понадобится в рамках этого руководства.</span><span class="sxs-lookup"><span data-stu-id="b81e5-157">Keep this script open as you'll run several scenarios during this tutorial.</span></span>
1. <span data-ttu-id="b81e5-158">Чтобы выбрать скрипт **подготовки пакета клиентов**, задайте параметр **$DemoScenario** = **1**.</span><span class="sxs-lookup"><span data-stu-id="b81e5-158">Set **$DemoScenario** = **1**, **Provision a batch of tenants**</span></span>
1. <span data-ttu-id="b81e5-159">Нажмите клавишу **F5** toorun hello скрипта.</span><span class="sxs-lookup"><span data-stu-id="b81e5-159">Press **F5** toorun hello script.</span></span>

<span data-ttu-id="b81e5-160">сценарий Hello развернет 17 клиентов менее чем за пять минут.</span><span class="sxs-lookup"><span data-stu-id="b81e5-160">hello script will deploy 17 tenants in less than five minutes.</span></span>

<span data-ttu-id="b81e5-161">Hello *New TenantBatch* скрипт использует вложенные или связанный набор [диспетчера ресурсов](../azure-resource-manager/index.md) шаблонов, создайте пакет клиентов, которые по умолчанию копирует базу данных hello **basetenantdb** на hello каталога сервера toocreate hello новой базы данных клиента, затем регистрирует их в каталог hello и наконец инициализирует их с типом hello клиента имя и место проведения.</span><span class="sxs-lookup"><span data-stu-id="b81e5-161">hello *New-TenantBatch* script uses a nested or linked set of [Resource Manager](../azure-resource-manager/index.md) templates that create a batch of tenants, which by default copies hello database **basetenantdb** on hello catalog server toocreate hello new tenant databases, then registers these in hello catalog, and finally initializes them with hello tenant name and venue type.</span></span> <span data-ttu-id="b81e5-162">Это согласуется с hello, как приложение hello подготавливает новый клиент.</span><span class="sxs-lookup"><span data-stu-id="b81e5-162">This is consistent with hello way hello app provisions a new tenant.</span></span> <span data-ttu-id="b81e5-163">Любые изменения, внесенные слишком*basetenantdb* , примененные tooany новых клиентов, подготовлены соответственно.</span><span class="sxs-lookup"><span data-stu-id="b81e5-163">Any changes made too*basetenantdb* are applied tooany new tenants provisioned thereafter.</span></span> <span data-ttu-id="b81e5-164">Hello в разделе [учебника схема управления](sql-database-saas-tutorial-schema-management.md) toosee слишком изменение схемы toomake*существующие* клиента баз данных (включая hello *basetenantdb* базы данных).</span><span class="sxs-lookup"><span data-stu-id="b81e5-164">See hello [Schema Management tutorial](sql-database-saas-tutorial-schema-management.md) toosee how toomake schema changes too*existing* tenant databases (including hello *basetenantdb* database).</span></span>

## <a name="simulate-usage-on-all-tenant-databases"></a><span data-ttu-id="b81e5-165">Моделирование использования ресурсов во всех базах данных клиентов</span><span class="sxs-lookup"><span data-stu-id="b81e5-165">Simulate usage on all tenant databases</span></span>

<span data-ttu-id="b81e5-166">Hello *PerformanceMonitoringAndManagement.ps1 Демонстрация* предоставляется скрипт, имитирует относительно рабочей нагрузки для всех баз данных клиента.</span><span class="sxs-lookup"><span data-stu-id="b81e5-166">hello *Demo-PerformanceMonitoringAndManagement.ps1* script is provided that simulates a workload running against all tenant databases.</span></span> <span data-ttu-id="b81e5-167">Hello нагрузка создается с помощью одного из сценариев hello доступных нагрузки:</span><span class="sxs-lookup"><span data-stu-id="b81e5-167">hello load is generated using one of hello available load scenarios:</span></span>

| <span data-ttu-id="b81e5-168">Демонстрация</span><span class="sxs-lookup"><span data-stu-id="b81e5-168">Demo</span></span> | <span data-ttu-id="b81e5-169">Сценарий</span><span class="sxs-lookup"><span data-stu-id="b81e5-169">Scenario</span></span> |
|:--|:--|
| <span data-ttu-id="b81e5-170">2</span><span class="sxs-lookup"><span data-stu-id="b81e5-170">2</span></span> | <span data-ttu-id="b81e5-171">Создание нагрузки с обычной интенсивностью (около 40 DTU).</span><span class="sxs-lookup"><span data-stu-id="b81e5-171">Generate normal intensity load (approx. 40 DTU)</span></span> |
| <span data-ttu-id="b81e5-172">3</span><span class="sxs-lookup"><span data-stu-id="b81e5-172">3</span></span> | <span data-ttu-id="b81e5-173">Создание нагрузки с более длительными и частыми пиками на базу данных.</span><span class="sxs-lookup"><span data-stu-id="b81e5-173">Generate load with longer and more frequent bursts per database</span></span>|
| <span data-ttu-id="b81e5-174">4.</span><span class="sxs-lookup"><span data-stu-id="b81e5-174">4</span></span> | <span data-ttu-id="b81e5-175">Создание нагрузки с интенсивным использованием единиц DTU при пиках на базу данных (около 80 DTU).</span><span class="sxs-lookup"><span data-stu-id="b81e5-175">Generate load with higher DTU bursts per database (approx. 80 DTU)</span></span>|
| <span data-ttu-id="b81e5-176">5</span><span class="sxs-lookup"><span data-stu-id="b81e5-176">5</span></span> | <span data-ttu-id="b81e5-177">Создание нормальной нагрузки с высокой нагрузкой на отдельный клиент (около 95 DTU).</span><span class="sxs-lookup"><span data-stu-id="b81e5-177">Generate a normal load plus a high load on a single tenant (approx. 95 DTU)</span></span>|
| <span data-ttu-id="b81e5-178">6</span><span class="sxs-lookup"><span data-stu-id="b81e5-178">6</span></span> | <span data-ttu-id="b81e5-179">Создание неравномерной нагрузки между несколькими пулами.</span><span class="sxs-lookup"><span data-stu-id="b81e5-179">Generate unbalanced load across multiple pools</span></span>|

<span data-ttu-id="b81e5-180">Генератор нагрузки Hello применяется *искусственного* базы данных клиента tooevery нагрузки только для ЦП.</span><span class="sxs-lookup"><span data-stu-id="b81e5-180">hello load generator applies a *synthetic* CPU-only load tooevery tenant database.</span></span> <span data-ttu-id="b81e5-181">Генератор Hello запускает задание для каждой базы данных клиента, который вызывает хранимую процедуру периодически, приводит к возникновению ошибки загрузки hello.</span><span class="sxs-lookup"><span data-stu-id="b81e5-181">hello generator starts a job for each tenant database, which calls a stored procedure periodically that generates hello load.</span></span> <span data-ttu-id="b81e5-182">во всех базах данных, имитация клиента непредсказуемые действия имеют разные Hello нагрузки уровней (Edtu), продолжительность и интервалов.</span><span class="sxs-lookup"><span data-stu-id="b81e5-182">hello load levels (in eDTUs), duration, and intervals are varied across all databases, simulating unpredictable tenant activity.</span></span>

1. <span data-ttu-id="b81e5-183">Открыть... \\Модулей обучения\\управления и наблюдения за производительностью\\*Демонстрация PerformanceMonitoringAndManagement.ps1* в hello *интегрированной среды Сценариев PowerShell*.</span><span class="sxs-lookup"><span data-stu-id="b81e5-183">Open …\\Learning Modules\\Performance Monitoring and Management\\*Demo-PerformanceMonitoringAndManagement.ps1* in hello *PowerShell ISE*.</span></span> <span data-ttu-id="b81e5-184">Не закрывайте этот скрипт, так как он еще понадобится в рамках этого руководства.</span><span class="sxs-lookup"><span data-stu-id="b81e5-184">Keep this script open as you'll run several scenarios during this tutorial.</span></span>
1. <span data-ttu-id="b81e5-185">Чтобы выполнить скрипт *создания нагрузки с обычной интенсивностью*, задайте параметр **$DemoScenario** = **2**.</span><span class="sxs-lookup"><span data-stu-id="b81e5-185">Set **$DemoScenario** = **2**, *Generate normal intensity load*.</span></span>
1. <span data-ttu-id="b81e5-186">Нажмите клавишу **F5** tooapply tooall нагрузки баз данных клиента.</span><span class="sxs-lookup"><span data-stu-id="b81e5-186">Press **F5** tooapply a load tooall your tenant databases.</span></span>

<span data-ttu-id="b81e5-187">Wingtip приложению SaaS, который hello реальной нагрузки на приложение SaaS обычно случайные и непредсказуемым.</span><span class="sxs-lookup"><span data-stu-id="b81e5-187">Wingtip is a SaaS app, and hello real-world load on a SaaS app is typically sporadic and unpredictable.</span></span> <span data-ttu-id="b81e5-188">toosimulate это hello нагрузки генератор формирует случайное нагрузки распределены по всем клиентам.</span><span class="sxs-lookup"><span data-stu-id="b81e5-188">toosimulate this, hello load generator produces a randomized load distributed across all tenants.</span></span> <span data-ttu-id="b81e5-189">Tooemerge шаблон нагрузки hello, выполните 3-5 минут, прежде чем toomonitor hello нагрузки в следующих разделах hello генератор нагрузки hello необходимы несколько минут.</span><span class="sxs-lookup"><span data-stu-id="b81e5-189">Several minutes are needed for hello load pattern tooemerge, so run hello load generator for 3-5 minutes before attempting toomonitor hello load in hello following sections.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b81e5-190">Генератор нагрузки Hello выполняется как ряд заданий в локальном сеансе PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b81e5-190">hello load generator is running as a series of jobs in your local PowerShell session.</span></span> <span data-ttu-id="b81e5-191">Сохранить hello *PerformanceMonitoringAndManagement.ps1 Демонстрация* откройте вкладку!</span><span class="sxs-lookup"><span data-stu-id="b81e5-191">Keep hello *Demo-PerformanceMonitoringAndManagement.ps1* tab open!</span></span> <span data-ttu-id="b81e5-192">Если закрыть вкладку hello, или спящий компьютер, генератор нагрузки hello останавливается.</span><span class="sxs-lookup"><span data-stu-id="b81e5-192">If you close hello tab, or suspend your machine, hello load generator stops.</span></span> <span data-ttu-id="b81e5-193">Генератор нагрузки Hello остается в *вызова задания* состояние, где он создает нагрузку на любой новых клиентов, которые подготавливаются к работе после запуска генератора hello.</span><span class="sxs-lookup"><span data-stu-id="b81e5-193">hello load generator remains in a *job-invoking* state where it generates load on any new tenants that are provisioned after hello generator is started.</span></span> <span data-ttu-id="b81e5-194">Используйте *Ctrl-C* toostop вызов новые задания и скрипт hello выхода.</span><span class="sxs-lookup"><span data-stu-id="b81e5-194">Use *Ctrl-C* toostop invoking new jobs and exit hello script.</span></span> <span data-ttu-id="b81e5-195">Генератор нагрузки Hello по-прежнему toorun, но только для существующих клиентов.</span><span class="sxs-lookup"><span data-stu-id="b81e5-195">hello load generator will continue toorun, but only on existing tenants.</span></span>

## <a name="monitor-resource-usage-using-hello-azure-portal"></a><span data-ttu-id="b81e5-196">Наблюдение за использованием ресурсов, с помощью портала Azure hello</span><span class="sxs-lookup"><span data-stu-id="b81e5-196">Monitor resource usage using hello Azure portal</span></span>

<span data-ttu-id="b81e5-197">Использование ресурсов toomonitor hello, загрузить результаты из hello применения, откройте hello портала toohello пул, содержащий hello базами данных клиента:</span><span class="sxs-lookup"><span data-stu-id="b81e5-197">toomonitor hello resource usage that results from hello load being applied, open hello portal toohello pool containing hello tenant databases:</span></span>

1. <span data-ttu-id="b81e5-198">Откройте hello [портал Azure](https://portal.azure.com) и обзор toohello *tenants1 -&lt;пользователя&gt;*  сервера.</span><span class="sxs-lookup"><span data-stu-id="b81e5-198">Open hello [Azure portal](https://portal.azure.com) and browse toohello *tenants1-&lt;USER&gt;* server.</span></span>
1. <span data-ttu-id="b81e5-199">Прокрутите вниз и найдите эластичные пулы. Затем щелкните **Pool1**.</span><span class="sxs-lookup"><span data-stu-id="b81e5-199">Scroll down and locate elastic pools and click **Pool1**.</span></span> <span data-ttu-id="b81e5-200">Этот пул содержит все базы данных клиента hello, созданных ранее.</span><span class="sxs-lookup"><span data-stu-id="b81e5-200">This pool contains all hello tenant databases created so far.</span></span>

<span data-ttu-id="b81e5-201">Наблюдать за hello **мониторинг эластичного пула** и **эластичной базы данных мониторинга** диаграммы.</span><span class="sxs-lookup"><span data-stu-id="b81e5-201">Observe hello **Elastic pool monitoring** and **Elastic database monitoring** charts.</span></span>

<span data-ttu-id="b81e5-202">Hello использование пула ресурсов является использование hello статистические базы данных для всех баз данных в пуле hello.</span><span class="sxs-lookup"><span data-stu-id="b81e5-202">hello pool's resource utilization is hello aggregate database utilization for all databases in hello pool.</span></span> <span data-ttu-id="b81e5-203">Диаграмма базы данных Hello показывает hello пять наиболее баз данных:</span><span class="sxs-lookup"><span data-stu-id="b81e5-203">hello database chart shows hello five hottest databases:</span></span>

![](./media/sql-database-saas-tutorial-performance-monitoring/pool1.png)

<span data-ttu-id="b81e5-204">Из-за дополнительных баз данных в пуле hello за пределами Здравствуйте пяти top, использование пула hello показаны действия, которые не отражены в верхней диаграмме пять баз данных hello.</span><span class="sxs-lookup"><span data-stu-id="b81e5-204">Because there are additional databases in hello pool beyond hello top five, hello pool utilization shows activity that is not reflected in hello top five databases chart.</span></span> <span data-ttu-id="b81e5-205">Чтобы просмотреть дополнительные сведения, щелкните **Использование ресурсов базы данных**:</span><span class="sxs-lookup"><span data-stu-id="b81e5-205">For additional details, click **Database Resource Utilization**:</span></span>

![](./media/sql-database-saas-tutorial-performance-monitoring/database-utilization.png)


## <a name="set-performance-alerts-on-hello-pool"></a><span data-ttu-id="b81e5-206">Настройка оповещений о производительности в пуле hello</span><span class="sxs-lookup"><span data-stu-id="b81e5-206">Set performance alerts on hello pool</span></span>

<span data-ttu-id="b81e5-207">Создать оповещение для hello пула, который активирует \>75% использования следующим образом:</span><span class="sxs-lookup"><span data-stu-id="b81e5-207">Set an alert on hello pool that triggers on \>75% utilization as follows:</span></span>

1. <span data-ttu-id="b81e5-208">Откройте *Pool1* (на hello *tenants1 -\<пользователя\>*  сервера) в hello [портал Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="b81e5-208">Open *Pool1* (on hello *tenants1-\<user\>* server) in hello [Azure portal](https://portal.azure.com).</span></span>
1. <span data-ttu-id="b81e5-209">Щелкните **Правила оповещения**, а затем выберите **+ Добавить оповещение**:</span><span class="sxs-lookup"><span data-stu-id="b81e5-209">Click **Alert Rules**, and then click **+ Add alert**:</span></span>

   ![Добавление оповещения](media/sql-database-saas-tutorial-performance-monitoring/add-alert.png)

1. <span data-ttu-id="b81e5-211">Укажите имя, например **High DTU**.</span><span class="sxs-lookup"><span data-stu-id="b81e5-211">Provide a name, such as **High DTU**,</span></span>
1. <span data-ttu-id="b81e5-212">Набор hello следующие значения:</span><span class="sxs-lookup"><span data-stu-id="b81e5-212">Set hello following values:</span></span>
   * <span data-ttu-id="b81e5-213">**"Метрика": eDTU percentage** (Процент eDTU);</span><span class="sxs-lookup"><span data-stu-id="b81e5-213">**Metric = eDTU percentage**</span></span>
   * <span data-ttu-id="b81e5-214">**"Условие": "Больше"**;</span><span class="sxs-lookup"><span data-stu-id="b81e5-214">**Condition = greater than**.</span></span>
   * <span data-ttu-id="b81e5-215">**"Пороговое значение": 75**;</span><span class="sxs-lookup"><span data-stu-id="b81e5-215">**Threshold = 75**.</span></span>
   * <span data-ttu-id="b81e5-216">**Период = через hello последних 30 минут**.</span><span class="sxs-lookup"><span data-stu-id="b81e5-216">**Period = Over hello last 30 minutes**.</span></span>
1. <span data-ttu-id="b81e5-217">Добавьте адрес электронной почты toohello *email(s) дополнительного администратора* и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="b81e5-217">Add an email address toohello *Additional administrator email(s)* box and click **OK**.</span></span>

   ![настройка оповещения](media/sql-database-saas-tutorial-performance-monitoring/alert-rule.png)


## <a name="scale-up-a-busy-pool"></a><span data-ttu-id="b81e5-219">Увеличение масштаба загруженного пула</span><span class="sxs-lookup"><span data-stu-id="b81e5-219">Scale up a busy pool</span></span>

<span data-ttu-id="b81e5-220">Уровень суммарную нагрузку hello увеличивается на точке toohello пула он двухъядерной пула hello и достигает 100% объем использования eDTU, затем отдельной базы данных снижается производительность, потенциально снижению времени отклика запросов для всех баз данных в пуле hello.</span><span class="sxs-lookup"><span data-stu-id="b81e5-220">If hello aggregate load level increases on a pool toohello point that it maxes out hello pool and reaches 100% eDTU usage, then individual database performance is affected, potentially slowing query response times for all databases in hello pool.</span></span>

<span data-ttu-id="b81e5-221">**Краткосрочные**, рассмотрите возможность удаления базы данных из пула hello, или вертикальное масштабирование hello пула tooprovide дополнительные ресурсы (их перемещение пулов tooother или из изолированного уровня пула hello tooa).</span><span class="sxs-lookup"><span data-stu-id="b81e5-221">**Short term**, consider scaling up hello pool tooprovide additional resources, or removing databases from hello pool (moving them tooother pools, or out of hello pool tooa stand-alone service tier).</span></span>

<span data-ttu-id="b81e5-222">**Более**, возможно, следует оптимизировать запросы или индекса производительности базы данных об использовании tooimprove.</span><span class="sxs-lookup"><span data-stu-id="b81e5-222">**Longer term**, consider optimizing queries or index usage tooimprove database performance.</span></span> <span data-ttu-id="b81e5-223">В зависимости от hello tooperformance чувствительности приложения выдает его лучший подход tooscale пула копирование достигает 100% объем использования eDTU.</span><span class="sxs-lookup"><span data-stu-id="b81e5-223">Depending on hello application's sensitivity tooperformance issues its best practice tooscale a pool up before it reaches 100% eDTU usage.</span></span> <span data-ttu-id="b81e5-224">Использовать предупреждения toowarn вы заранее.</span><span class="sxs-lookup"><span data-stu-id="b81e5-224">Use an alert toowarn you in advance.</span></span>

<span data-ttu-id="b81e5-225">Можно имитировать занят пула, увеличение нагрузки hello, созданных генератором hello.</span><span class="sxs-lookup"><span data-stu-id="b81e5-225">You can simulate a busy pool by increasing hello load produced by hello generator.</span></span> <span data-ttu-id="b81e5-226">Приводит к tooburst hello баз данных более часто, а также для hello и увеличение более суммарную нагрузку на пул hello без изменения требований hello hello отдельных баз данных.</span><span class="sxs-lookup"><span data-stu-id="b81e5-226">Causing hello databases tooburst more frequently, and for longer, increasing hello aggregate load on hello pool without changing hello requirements of hello individual databases.</span></span> <span data-ttu-id="b81e5-227">Вертикальное масштабирование пула hello легко сделать на портале hello или из PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b81e5-227">Scaling up hello pool is easily done in hello portal or from PowerShell.</span></span> <span data-ttu-id="b81e5-228">В этом упражнении используется портал hello.</span><span class="sxs-lookup"><span data-stu-id="b81e5-228">This exercise uses hello portal.</span></span>

1. <span data-ttu-id="b81e5-229">Задать *$DemoScenario* = **3**, _нагрузки формирования увеличениям больше времени и более частыми каждой базы данных_ tooincrease интенсивность hello hello суммарную нагрузку на пул Hello без изменения hello пиковой нагрузки, необходимую для каждой базы данных.</span><span class="sxs-lookup"><span data-stu-id="b81e5-229">Set *$DemoScenario* = **3**, _Generate load with longer and more frequent bursts per database_ tooincrease hello intensity of hello aggregate load on hello pool without changing hello peak load required by each database.</span></span>
1. <span data-ttu-id="b81e5-230">Нажмите клавишу **F5** tooapply tooall нагрузки баз данных клиента.</span><span class="sxs-lookup"><span data-stu-id="b81e5-230">Press **F5** tooapply a load tooall your tenant databases.</span></span>

1. <span data-ttu-id="b81e5-231">Go слишком**Pool1** в hello портал Azure.</span><span class="sxs-lookup"><span data-stu-id="b81e5-231">Go too**Pool1** in hello Azure portal.</span></span>

<span data-ttu-id="b81e5-232">Монитор hello увеличить объем использования eDTU пула на верхней диаграмме hello.</span><span class="sxs-lookup"><span data-stu-id="b81e5-232">Monitor hello increased pool eDTU usage on hello upper chart.</span></span> <span data-ttu-id="b81e5-233">Hello новый выше нагрузки tookick в несколько минут, но вы увидите быстро начать использование max toohit пула hello и как hello нагрузки steadies в новый шаблон hello, быстро перегрузки пула hello.</span><span class="sxs-lookup"><span data-stu-id="b81e5-233">It takes a few minutes for hello new higher load tookick in, but you should quickly see hello pool start toohit max utilization, and as hello load steadies into hello new pattern, it rapidly overloads hello pool.</span></span>

1. <span data-ttu-id="b81e5-234">Щелкните tooscale пула hello, **настроить пул** вверху hello hello **Pool1** страницы.</span><span class="sxs-lookup"><span data-stu-id="b81e5-234">tooscale up hello pool, click **Configure pool** at hello top of hello **Pool1** page.</span></span>
1. <span data-ttu-id="b81e5-235">Настройка hello **eDTU пула** задание слишком**100**.</span><span class="sxs-lookup"><span data-stu-id="b81e5-235">Adjust hello **Pool eDTU** setting too**100**.</span></span> <span data-ttu-id="b81e5-236">Изменение eDTU пула hello не изменяет параметры hello каждой базы данных (которые по-прежнему 50 eDTU max каждой базы данных).</span><span class="sxs-lookup"><span data-stu-id="b81e5-236">Changing hello pool eDTU does not change hello per-database settings (which is still 50 eDTU max per database).</span></span> <span data-ttu-id="b81e5-237">Вы увидите hello каждой базы данных параметры hello правой части hello **настроить пул** страницы.</span><span class="sxs-lookup"><span data-stu-id="b81e5-237">You can see hello per-database settings on hello right side of hello **Configure pool** page.</span></span>
1. <span data-ttu-id="b81e5-238">Нажмите кнопку **Сохранить** toosubmit hello запроса tooscale hello пула.</span><span class="sxs-lookup"><span data-stu-id="b81e5-238">Click **Save** toosubmit hello request tooscale hello pool.</span></span>

<span data-ttu-id="b81e5-239">Возврат слишком**Pool1** > **Обзор** tooview hello диаграммы мониторинга.</span><span class="sxs-lookup"><span data-stu-id="b81e5-239">Go back too**Pool1** > **Overview** tooview hello monitoring charts.</span></span> <span data-ttu-id="b81e5-240">Отслеживать влияние hello предоставления hello пул с большим объемом ресурсов (несмотря на то, что несколько баз данных и случайного нагрузки не всегда легко toosee окончательно пока не будет работать некоторое время).</span><span class="sxs-lookup"><span data-stu-id="b81e5-240">Monitor hello effect of providing hello pool with more resources (although with few databases and a randomized load it’s not always easy toosee conclusively until you run for some time).</span></span> <span data-ttu-id="b81e5-241">При просмотре диаграммы содержат hello в виду, что 100% на верхнем hello теперь диаграммы представляет количество 100 Edtu, пока на hello ниже 100% диаграммы по-прежнему 50 edtu, которое как hello каждой базы данных max по-прежнему 50 edtu, которое.</span><span class="sxs-lookup"><span data-stu-id="b81e5-241">While you are looking at hello charts bear in mind that 100% on hello upper chart now represents 100 eDTUs, while on hello lower chart 100% is still 50 eDTUs as hello per-database max is still 50 eDTUs.</span></span>

<span data-ttu-id="b81e5-242">Базы данных оставаться в сети полностью доступны на протяжении всего процесса hello.</span><span class="sxs-lookup"><span data-stu-id="b81e5-242">Databases remain online and fully available throughout hello process.</span></span> <span data-ttu-id="b81e5-243">В hello последний момент как каждая база данных готова toobe включено с новой eDTU пула hello, все активные подключения не работают.</span><span class="sxs-lookup"><span data-stu-id="b81e5-243">At hello last moment as each database is ready toobe enabled with hello new pool eDTU, any active connections are broken.</span></span> <span data-ttu-id="b81e5-244">Код приложения всегда должны быть написаны подключения tooretry удалены и поэтому может восстанавливаться база данных toohello в пуле масштабированных hello.</span><span class="sxs-lookup"><span data-stu-id="b81e5-244">Application code should always be written tooretry dropped connections, and so will reconnect toohello database in hello scaled-up pool.</span></span>

## <a name="load-balance-between-pools"></a><span data-ttu-id="b81e5-245">Распределение нагрузки между пулами</span><span class="sxs-lookup"><span data-stu-id="b81e5-245">Load balance between pools</span></span>

<span data-ttu-id="b81e5-246">Как альтернативный tooscaling пула hello, создания второго пула и переместить базы данных в нее toobalance hello загрузить между hello два пула.</span><span class="sxs-lookup"><span data-stu-id="b81e5-246">As an alternative tooscaling up hello pool, create a second pool and move databases into it toobalance hello load between hello two pools.</span></span> <span data-ttu-id="b81e5-247">Этот новый пул hello должен быть создан в toodo сначала hello сервере hello.</span><span class="sxs-lookup"><span data-stu-id="b81e5-247">toodo this hello new pool must be created on hello same server as hello first.</span></span>

1. <span data-ttu-id="b81e5-248">В hello [портал Azure](https://portal.azure.com)откройте hello **tenants1 -&lt;пользователя&gt;**  сервера.</span><span class="sxs-lookup"><span data-stu-id="b81e5-248">In hello [Azure portal](https://portal.azure.com), open hello **tenants1-&lt;USER&gt;** server.</span></span>
1. <span data-ttu-id="b81e5-249">Нажмите кнопку **+ новый пул** toocreate пула на текущем сервере hello.</span><span class="sxs-lookup"><span data-stu-id="b81e5-249">Click **+ New pool** toocreate a pool on hello current server.</span></span>
1. <span data-ttu-id="b81e5-250">На hello **пул эластичных баз данных** шаблона:</span><span class="sxs-lookup"><span data-stu-id="b81e5-250">On hello **Elastic database pool** template:</span></span>

    1. <span data-ttu-id="b81e5-251">Задать **имя** слишком*Pool2*.</span><span class="sxs-lookup"><span data-stu-id="b81e5-251">Set **Name** too*Pool2*.</span></span>
    1. <span data-ttu-id="b81e5-252">Оставьте hello ценовой категории как **стандартный пул**.</span><span class="sxs-lookup"><span data-stu-id="b81e5-252">Leave hello pricing tier as **Standard Pool**.</span></span>
    1. <span data-ttu-id="b81e5-253">Щелкните **Настроить пул**.</span><span class="sxs-lookup"><span data-stu-id="b81e5-253">Click **Configure pool**,</span></span>
    1. <span data-ttu-id="b81e5-254">Задать **eDTU пула** слишком*50 eDTU*.</span><span class="sxs-lookup"><span data-stu-id="b81e5-254">Set **Pool eDTU** too*50 eDTU*.</span></span>
    1. <span data-ttu-id="b81e5-255">Нажмите кнопку **добавления баз данных** toosee список баз данных на сервере hello, который может быть добавлен слишком*Pool2*.</span><span class="sxs-lookup"><span data-stu-id="b81e5-255">Click **Add databases** toosee a list of databases on hello server that can be added too*Pool2*.</span></span>
    1. <span data-ttu-id="b81e5-256">Выберите новый пул этих toohello любой toomove 10 баз данных и нажмите кнопку **выберите**.</span><span class="sxs-lookup"><span data-stu-id="b81e5-256">Select any 10 databases toomove these toohello new pool, and then click **Select**.</span></span> <span data-ttu-id="b81e5-257">Если работы генератор нагрузки hello, hello службы уже знает, что профиль производительности требует пула большего размера, чем размер 50 eDTU по умолчанию hello и рекомендует начиная с 100 стандарта eDTU.</span><span class="sxs-lookup"><span data-stu-id="b81e5-257">If you've been running hello load generator, hello service already knows that your performance profile requires a larger pool than hello default 50 eDTU size and recommends starting with a 100 eDTU setting.</span></span>

    ![рекомендация](media/sql-database-saas-tutorial-performance-monitoring/configure-pool.png)

    1. <span data-ttu-id="b81e5-259">В этом учебнике, оставьте 50 edtu, которое по умолчанию hello и нажмите кнопку **выберите** еще раз.</span><span class="sxs-lookup"><span data-stu-id="b81e5-259">For this tutorial, leave hello default at 50 eDTUs, and click **Select** again.</span></span>
    1. <span data-ttu-id="b81e5-260">Выберите **ОК** toocreate hello новый пул и toomove hello выбранных баз данных в него.</span><span class="sxs-lookup"><span data-stu-id="b81e5-260">Select **OK** toocreate hello new pool and toomove hello selected databases into it.</span></span>

<span data-ttu-id="b81e5-261">Создание пула hello и перемещение баз данных hello занимает несколько минут.</span><span class="sxs-lookup"><span data-stu-id="b81e5-261">Creating hello pool and moving hello databases takes a few minutes.</span></span> <span data-ttu-id="b81e5-262">При перемещении баз данных остаются полностью доступны до hello самый последний момент, после чего все открытые соединения закрываются.</span><span class="sxs-lookup"><span data-stu-id="b81e5-262">As databases are moved they remain online and fully accessible until hello very last moment, at which point any open connections are closed.</span></span> <span data-ttu-id="b81e5-263">Пока у вас есть определенную логику повторных попыток, клиенты, подключится toohello базы данных в новый пул hello.</span><span class="sxs-lookup"><span data-stu-id="b81e5-263">As long as you have some retry logic, clients will then connect toohello database in hello new pool.</span></span>

<span data-ttu-id="b81e5-264">Обзор слишком**Pool2** (на hello *tenants1* сервера) tooopen hello пула и отслеживать его производительность.</span><span class="sxs-lookup"><span data-stu-id="b81e5-264">Browse too**Pool2** (on hello *tenants1* server) tooopen hello pool and monitor its performance.</span></span> <span data-ttu-id="b81e5-265">Если вы не видите его, дождитесь подготовки нового пула toocomplete hello.</span><span class="sxs-lookup"><span data-stu-id="b81e5-265">If you don't see it, wait for provisioning of hello new pool toocomplete.</span></span>

<span data-ttu-id="b81e5-266">Использование ресурсов в пуле *Pool1* снизилось, а нагрузка равномерно распределена между ним и пулом *Pool2*.</span><span class="sxs-lookup"><span data-stu-id="b81e5-266">You now see that resource usage on *Pool1* has dropped and that *Pool2* is now similarly loaded.</span></span>

## <a name="manage-performance-of-a-single-database"></a><span data-ttu-id="b81e5-267">Управление производительностью отдельной базы данных</span><span class="sxs-lookup"><span data-stu-id="b81e5-267">Manage performance of a single database</span></span>

<span data-ttu-id="b81e5-268">Если в одной базы данных в пуле длительной высокой нагрузки, в зависимости от конфигурации пула hello, он toodominate hello ресурсов в пуле hello, как правило и повлиять на другие базы данных.</span><span class="sxs-lookup"><span data-stu-id="b81e5-268">If a single database in a pool experiences a sustained high load, depending on hello pool configuration, it may tend toodominate hello resources in hello pool and impact other databases.</span></span> <span data-ttu-id="b81e5-269">Если действие hello, скорее всего, toocontinue некоторое время hello базы данных можно временно перевести из пула hello.</span><span class="sxs-lookup"><span data-stu-id="b81e5-269">If hello activity is likely toocontinue for some time, hello database can be temporarily moved out of hello pool.</span></span> <span data-ttu-id="b81e5-270">Это позволяет toohave hello hello базы данных дополнительные ресурсы требуются и изолирует из hello других баз данных.</span><span class="sxs-lookup"><span data-stu-id="b81e5-270">This allows hello database toohave hello extra resources it needs, and isolates it from hello other databases.</span></span>

<span data-ttu-id="b81e5-271">В этом упражнении имитирует эффект hello Hall совместно Contoso возникла высокая нагрузка при билеты перейти на продажи для популярных совместно.</span><span class="sxs-lookup"><span data-stu-id="b81e5-271">This exercise simulates hello effect of Contoso Concert Hall experiencing a high load when tickets go on sale for a popular concert.</span></span>

1. <span data-ttu-id="b81e5-272">Привет открыть... \\ *PerformanceMonitoringAndManagement.ps1 Демонстрация* сценария.</span><span class="sxs-lookup"><span data-stu-id="b81e5-272">Open hello …\\*Demo-PerformanceMonitoringAndManagement.ps1* script.</span></span>
1. <span data-ttu-id="b81e5-273">Чтобы выполнить скрипт **создания нормальной нагрузки с высокой нагрузкой на отдельный клиент (около 95 DTU), задайте для параметра $DemoScenario значение 5**.</span><span class="sxs-lookup"><span data-stu-id="b81e5-273">Set **$DemoScenario = 5, Generate a normal load plus a high load on a single tenant (approx. 95 DTU).**</span></span>
1. <span data-ttu-id="b81e5-274">Задайте параметр **$SingleTenantDatabaseName = contosoconcerthall**.</span><span class="sxs-lookup"><span data-stu-id="b81e5-274">Set **$SingleTenantDatabaseName = contosoconcerthall**</span></span>
1. <span data-ttu-id="b81e5-275">Выполнение скрипта с помощью hello **F5**.</span><span class="sxs-lookup"><span data-stu-id="b81e5-275">Execute hello script using **F5**.</span></span>


1. <span data-ttu-id="b81e5-276">В hello [портал Azure](https://portal.azure.com) откройте **Pool1**.</span><span class="sxs-lookup"><span data-stu-id="b81e5-276">In hello [Azure portal](https://portal.azure.com) open **Pool1**.</span></span>
1. <span data-ttu-id="b81e5-277">Проверять hello **мониторинг эластичного пула** диаграммы и найдите hello увеличить объем использования eDTU пула.</span><span class="sxs-lookup"><span data-stu-id="b81e5-277">Inspect hello **Elastic pool monitoring** chart and look for hello increased pool eDTU usage.</span></span> <span data-ttu-id="b81e5-278">Одну-две минуты большую нагрузку hello следует начинать tookick в после следует сразу видеть, что пул hello достигает 100% использованию.</span><span class="sxs-lookup"><span data-stu-id="b81e5-278">After a minute or two, hello higher load should start tookick in, and you should quickly see that hello pool hits 100% utilization.</span></span>
1. <span data-ttu-id="b81e5-279">Проверять hello **эластичной базы данных мониторинга** экрана, показывающий баз данных предоставляет новые hello в hello последний час.</span><span class="sxs-lookup"><span data-stu-id="b81e5-279">Inspect hello **Elastic database monitoring** display which shows hello hottest databases in hello past hour.</span></span> <span data-ttu-id="b81e5-280">Hello *contosoconcerthall* базы данных вскоре будут отображаться как один из наиболее hello пяти баз данных.</span><span class="sxs-lookup"><span data-stu-id="b81e5-280">hello *contosoconcerthall* database should soon appear as one of hello five hottest databases.</span></span>
1. <span data-ttu-id="b81e5-281">**Щелкните hello эластичной базы данных мониторинга** **диаграммы** открывается hello **использования ресурсов базы данных** страницы, где вы можете отслеживать hello базах данных.</span><span class="sxs-lookup"><span data-stu-id="b81e5-281">**Click on hello Elastic database monitoring** **chart** and it opens hello **Database Resource Utilization** page where you can monitor any of hello databases.</span></span> <span data-ttu-id="b81e5-282">Это позволяет изолировать hello отображением hello *contosoconcerthall* базы данных.</span><span class="sxs-lookup"><span data-stu-id="b81e5-282">This lets you isolate hello display for hello *contosoconcerthall* database.</span></span>
1. <span data-ttu-id="b81e5-283">Hello списке баз данных, нажмите кнопку **contosoconcerthall**.</span><span class="sxs-lookup"><span data-stu-id="b81e5-283">From hello list of databases, click **contosoconcerthall**.</span></span>
1. <span data-ttu-id="b81e5-284">Нажмите кнопку **ценовую категорию (масштаб Dtu)** tooopen hello **настройки производительности** страницы, где можно задать уровень автономного производительности для базы данных hello.</span><span class="sxs-lookup"><span data-stu-id="b81e5-284">Click **Pricing Tier (scale DTUs)** tooopen hello **Configure performance** page where you can set a stand-alone performance level for hello database.</span></span>
1. <span data-ttu-id="b81e5-285">Щелкните hello **Стандартная** параметры масштабирования hello tooopen hello стандартном уровне.</span><span class="sxs-lookup"><span data-stu-id="b81e5-285">Click on hello **Standard** tab tooopen hello scale options in hello Standard tier.</span></span>
1. <span data-ttu-id="b81e5-286">Слайд hello **ползунок DTU** tooright tooselect **100** Dtu.</span><span class="sxs-lookup"><span data-stu-id="b81e5-286">Slide hello **DTU slider** tooright tooselect **100** DTUs.</span></span> <span data-ttu-id="b81e5-287">Обратите внимание, это соответствует цели обслуживания toohello, **S3**.</span><span class="sxs-lookup"><span data-stu-id="b81e5-287">Note this corresponds toohello service objective, **S3**.</span></span>
1. <span data-ttu-id="b81e5-288">Нажмите кнопку **применить** toomove hello базы данных за пределы пула hello и сделать его *Standard S3* базы данных.</span><span class="sxs-lookup"><span data-stu-id="b81e5-288">Click **Apply** toomove hello database out of hello pool and make it a *Standard S3* database.</span></span>
1. <span data-ttu-id="b81e5-289">После масштабирования завершите, монитор hello влияние на базу данных contosoconcerthall hello и Pool1 на hello эластичный пул и базы данных колонок.</span><span class="sxs-lookup"><span data-stu-id="b81e5-289">Once scaling is complete, monitor hello effect on hello contosoconcerthall database and Pool1 on hello elastic pool and database blades.</span></span>

<span data-ttu-id="b81e5-290">После интенсивности hello высокой нагрузки на базу данных contosoconcerthall hello незамедлительно верните его tooreduce пула toohello его стоимости.</span><span class="sxs-lookup"><span data-stu-id="b81e5-290">Once hello high load on hello contosoconcerthall database subsides you should promptly return it toohello pool tooreduce its cost.</span></span> <span data-ttu-id="b81e5-291">Если неясно, при, произойдет, можно задать предупреждения для базы данных hello, будет вызываться, когда его использование DTU падает ниже hello каждой базы данных в пуле hello max.</span><span class="sxs-lookup"><span data-stu-id="b81e5-291">If it’s unclear when that will happen you could set an alert on hello database that will trigger when its DTU usage drops below hello per-database max on hello pool.</span></span> <span data-ttu-id="b81e5-292">Перемещение базы данных в пул описано в упражнении 5.</span><span class="sxs-lookup"><span data-stu-id="b81e5-292">Moving a database into a pool is described in exercise 5.</span></span>

## <a name="other-performance-management-patterns"></a><span data-ttu-id="b81e5-293">Другие шаблоны управления производительностью</span><span class="sxs-lookup"><span data-stu-id="b81e5-293">Other Performance Management Patterns</span></span>

<span data-ttu-id="b81e5-294">**Масштабирование упреждающие** в hello упражнении выше где изучена как tooscale изолированную базу данных, точно будете знать, какие базы данных toolook для.</span><span class="sxs-lookup"><span data-stu-id="b81e5-294">**Pre-emptive scaling** In hello exercise above where you explored how tooscale an isolated database, you knew which database toolook for.</span></span> <span data-ttu-id="b81e5-295">Если управление hello Hall совместно Contoso проинформировать Wingtips hello предстоящих продажи билетов, hello базы данных могли быть перемещены за пределы пула hello вытеснением.</span><span class="sxs-lookup"><span data-stu-id="b81e5-295">If hello management of Contoso Concert Hall had informed Wingtips of hello impending ticket sale, hello database could have been moved out of hello pool pre-emptively.</span></span> <span data-ttu-id="b81e5-296">В противном случае он скорее всего потребовалась бы предупреждения на пул hello или toospot hello базы данных что происходило.</span><span class="sxs-lookup"><span data-stu-id="b81e5-296">Otherwise, it would likely have required an alert on hello pool or hello database toospot what was happening.</span></span> <span data-ttu-id="b81e5-297">Не стоит toolearn об этом из hello других клиентов в пул hello, обнаруживших от низкой производительности.</span><span class="sxs-lookup"><span data-stu-id="b81e5-297">You wouldn’t want toolearn about this from hello other tenants in hello pool complaining of degraded performance.</span></span> <span data-ttu-id="b81e5-298">И если hello клиента может предсказать, как долго они потребуются дополнительные ресурсы, можно установить базу данных Azure Automation runbook toomove hello вне пула hello, а затем снова в по заданному расписанию.</span><span class="sxs-lookup"><span data-stu-id="b81e5-298">And if hello tenant can predict how long they will need additional resources you can set up an Azure Automation runbook toomove hello database out of hello pool and then back in again on a defined schedule.</span></span>

<span data-ttu-id="b81e5-299">**Масштабирование клиента самообслуживания** так, как масштабирование осуществляется легко вызвать через API-Интерфейс управления hello, можно легко встраивать возможности hello tooscale базы данных клиента в приложение стороне клиента и предложить его как компонент службы SaaS.</span><span class="sxs-lookup"><span data-stu-id="b81e5-299">**Tenant self-service scaling** Because scaling is a task easily called via hello management API, you can easily build hello ability tooscale tenant databases into your tenant-facing application, and offer it as a feature of your SaaS service.</span></span> <span data-ttu-id="b81e5-300">Например, пусть клиентов self-administer масштабирование вверх и вниз, может быть напрямую связывать выставления счетов tootheir!</span><span class="sxs-lookup"><span data-stu-id="b81e5-300">For example, let tenants self-administer scaling up and down, perhaps linked directly tootheir billing!</span></span>

<span data-ttu-id="b81e5-301">**Масштабирование пула вверх и вниз на моделях использования toomatch расписания**</span><span class="sxs-lookup"><span data-stu-id="b81e5-301">**Scaling a pool up and down on a schedule toomatch usage patterns**</span></span>

<span data-ttu-id="b81e5-302">При использования агрегатных клиента соответствует прогнозируемого использования шаблонов, можно использовать службы автоматизации Azure tooscale пул вверх и вниз по расписанию.</span><span class="sxs-lookup"><span data-stu-id="b81e5-302">Where aggregate tenant usage follows predictable usage patterns, you can use Azure Automation tooscale a pool up and down on a schedule.</span></span> <span data-ttu-id="b81e5-303">Например, после 18:00 масштаб пула можно уменьшить, а в рабочие дни в 06:00 обратно увеличить.</span><span class="sxs-lookup"><span data-stu-id="b81e5-303">For example, scale a pool down after 6pm and up again before 6am on weekdays when you know there is a drop in resource requirements.</span></span>



## <a name="next-steps"></a><span data-ttu-id="b81e5-304">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="b81e5-304">Next steps</span></span>

<span data-ttu-id="b81e5-305">Из этого руководства вы узнаете, как выполнить следующие задачи:</span><span class="sxs-lookup"><span data-stu-id="b81e5-305">In this tutorial you learn how to:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="b81e5-306">Имитировать использование на hello базами данных клиента, выполнив предоставленный нагрузки генератор</span><span class="sxs-lookup"><span data-stu-id="b81e5-306">Simulate usage on hello tenant databases by running a provided load generator</span></span>
> * <span data-ttu-id="b81e5-307">Монитор hello клиента базы данных, как они могут реагировать toohello увеличение нагрузки</span><span class="sxs-lookup"><span data-stu-id="b81e5-307">Monitor hello tenant databases as they respond toohello increase in load</span></span>
> * <span data-ttu-id="b81e5-308">Вертикальное масштабирование hello эластичного пула в загрузки увеличения базы данных toohello ответа</span><span class="sxs-lookup"><span data-stu-id="b81e5-308">Scale up hello Elastic pool in response toohello increased database load</span></span>
> * <span data-ttu-id="b81e5-309">Подготовка второго эластичного пула tooload баланс hello базы данных действия</span><span class="sxs-lookup"><span data-stu-id="b81e5-309">Provision a second Elastic pool tooload balance hello database activity</span></span>

<span data-ttu-id="b81e5-310">[Restore a single tenant database](sql-database-saas-tutorial-restore-single-tenant.md) (Восстановление базы данных отдельного клиента)</span><span class="sxs-lookup"><span data-stu-id="b81e5-310">[Restore a single tenant tutorial](sql-database-saas-tutorial-restore-single-tenant.md)</span></span>


## <a name="additional-resources"></a><span data-ttu-id="b81e5-311">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="b81e5-311">Additional resources</span></span>

* <span data-ttu-id="b81e5-312">Дополнительные [учебники, которые созданы на основе hello Wingtip SaaS развертывания приложения](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="b81e5-312">Additional [tutorials that build upon hello Wingtip SaaS application deployment](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="b81e5-313">Когда следует использовать эластичный пул?</span><span class="sxs-lookup"><span data-stu-id="b81e5-313">SQL Elastic pools</span></span>](sql-database-elastic-pool.md)
* [<span data-ttu-id="b81e5-314">Служба автоматизации Azure</span><span class="sxs-lookup"><span data-stu-id="b81e5-314">Azure automation</span></span>](../automation/automation-intro.md)
* <span data-ttu-id="b81e5-315">[Настройка и использование Log Analytics (OMS) с примером приложения SaaS WTP](sql-database-saas-tutorial-log-analytics.md)</span><span class="sxs-lookup"><span data-stu-id="b81e5-315">[Log Analytics](sql-database-saas-tutorial-log-analytics.md) - Setting up and using Log Analytics tutorial</span></span>
