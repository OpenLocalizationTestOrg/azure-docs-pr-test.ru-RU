---
title: "TSQL. Выполнение отработки отказа для базы данных SQL Azure | Документация Майкрософт"
description: "Запуск плановой или незапланированной отработки отказа для базы данных SQL Azure с помощью Transact-SQL"
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: 5eb2d256-025d-4f5a-99d4-17f702b37f14
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: 418953e044ba84ce758063d56a371af45d5cdfe1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="initiate-a-planned-or-unplanned-failover-for-azure-sql-database-with-transact-sql"></a>Запуск плановой или незапланированной отработки отказа для базы данных SQL Azure с помощью Transact-SQL

В этой статье показано, как tooa tooinitiate отработки отказа SQL базы данных-получателя с помощью Transact-SQL. tooconfigure георепликации, в разделе [Настройка географической репликации для базы данных SQL Azure](sql-database-geo-replication-transact-sql.md).

tooinitiate перехода на другой ресурс требуется hello следующее:

* Имя входа, которое является DBManager на основной hello
* У db_ownership hello локальной базы данных, что вы будете репликации
* Быть DBManager на серверы toowhich hello партнера вы настроите географической репликации
* последняя версия SQL Server Management Studio (SSMS).

> [!IMPORTANT]
> Рекомендуется всегда использовать hello последнюю версию среды Management Studio tooremain синхронизированы с tooMicrosoft обновления Azure и базы данных SQL. [Обновите среду SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).
>  

## <a name="initiate-a-planned-failover-promoting-a-secondary-database-toobecome-hello-new-primary"></a>Повышение уровня новой основной базы данных-получателя toobecome hello запланированная отработка отказа
Можно использовать hello **инструкции ALTER DATABASE** toopromote инструкции новой основной базы данных-получателя toobecome hello база данных, в запланированной перебора, при понижении роли существующего первичного toobecome hello получателя. Эта инструкция выполняется на hello базы данных master логического сервера базы данных SQL Azure hello в какой hello находится географическая репликация базы данных-получателя, выдвинут на роль. Эта возможность предназначена для плановой отработки отказа, например, во время Детализирует hello аварийного восстановления и требуется, чтобы доступные базы данных-источника, hello.

Команда Hello выполняет hello, следуя рабочего процесса:

1. Временно режима toosynchronous коммутаторы репликации, вызывая все ожидающие обработки транзакции toobe сброшены toohello получателя, а также блокирует все новые транзакции;
2. Коммутаторы hello ролей hello двух баз данных в связи георепликации hello.  

Эта последовательность гарантирует, что приветствия синхронизацию двух баз данных перед переключение ролей hello и поэтому произойдет без потери данных. Отсутствует короткий период, в течение которого обеих баз данных недоступны (в порядке hello 0 секунд too25) во время переключения ролей hello. Если база данных-источник hello имеет несколько баз данных-получателей, команда hello будет автоматически reconfigure hello других баз данных-получателей tooconnect toohello новом сервере-источнике.  вся операция Hello занимает меньше минуты toocomplete в обычных условиях. Дополнительные сведения см. в статьях [ALTER DATABASE (база данных SQL Azure)](https://msdn.microsoft.com/library/mt574871.aspx) и [Уровни служб базы данных SQL для отдельных баз данных и пулов эластичных баз данных](sql-database-service-tiers.md).

Используйте следующие шаги tooinitiate плановой отработки отказа hello.

1. В среде Management Studio подключитесь логический сервер базы данных SQL Azure toohello в которой находится географическая репликация базы данных-получателя.
2. Откройте папку баз данных hello, разверните узел hello **системных баз данных** папку, щелкните правой кнопкой мыши **master**и нажмите кнопку **новый запрос**.
3. Используйте следующие hello **инструкции ALTER DATABASE** инструкции tooswitch hello баз данных-получателей toohello первичной роли.
   
        ALTER DATABASE <MyDB> FAILOVER;
4. Нажмите кнопку **Execute** toorun hello запроса.

> [!NOTE]
> В редких случаях это возможно, операция hello не удается завершить и может отображаться постоянный. В этом случае hello пользователь может выполнить команду перехода на другой ресурс принудительное hello и принять потери данных.
> 
> 

## <a name="initiate-an-unplanned-failover-from-hello-primary-database-toohello-secondary-database"></a>Запуск внеплановой отработки отказа из hello базы данных-источника toohello базы данных-получателя
Можно использовать hello **инструкции ALTER DATABASE** toopromote инструкции новой основной базы данных-получателя toobecome hello базы данных незапланированных способом, принудительное понижение уровня hello hello существующего первичного toobecome дополнительного одновременно при hello База данных-источник недоступен. Эта инструкция выполняется на hello базы данных master логического сервера базы данных SQL Azure hello в какой hello находится географическая репликация базы данных-получателя, выдвинут на роль.

Эта функциональность предназначен для аварийного восстановления, когда важна доступность восстановления hello базы данных и потеря некоторых данных допустима. При вызове принудительной отработки отказа hello указана база данных-получатель немедленно становится hello базы данных-источника и начинается принятие транзакций записи. Сразу hello исходной базы данных-источника может tooreconnect с этой базой данных-источником, добавочное резервное копирование берется hello исходной базы данных-источника и преобразовании hello старой базы данных-источника в базы данных-получателя для hello новой базы данных-источника; Следовательно это просто синхронизации реплики hello новой первичной.

Тем не менее так как в время восстановления на момент не поддерживается hello баз данных-получателей, если пользователь hello зафиксированных данных toorecover toohello старой базы данных-источника, не было реплицируются toohello новой базы данных-источника до возникновения hello Принудительный переход на другой ресурс, Hello пользователю будет необходимо toorecover поддержки tooengage это потеряны данные.

Если база данных-источник hello имеет несколько баз данных-получателей, команда hello будет автоматически reconfigure hello других баз данных-получателей tooconnect toohello новом сервере-источнике.

Используйте следующие шаги tooinitiate незапланированной отработки отказа hello.

1. В среде Management Studio подключитесь логический сервер базы данных SQL Azure toohello в которой находится географическая репликация базы данных-получателя.
2. Откройте папку баз данных hello, разверните узел hello **системных баз данных** папку, щелкните правой кнопкой мыши **master**и нажмите кнопку **новый запрос**.
3. Используйте следующие hello **инструкции ALTER DATABASE** инструкции tooswitch hello баз данных-получателей toohello первичной роли.
   
        ALTER DATABASE <MyDB>   FORCE_FAILOVER_ALLOW_DATA_LOSS;
4. Нажмите кнопку **Execute** toorun hello запроса.

> [!NOTE]
> Если hello команды при первичной и вторичной находятся в оперативном режиме, может стать старая первичная hello hello новом сервере-получателе немедленно, без синхронизации данных. В случае основной hello возможна Фиксация транзакции при hello команды потери данных.
> 
> 

## <a name="next-steps"></a>Дальнейшие действия
* После отработки отказа убедитесь, что hello требования проверки подлинности для сервера и базы данных можно настроить на новом сервере-источнике hello. Дополнительные сведения см. в разделе [Безопасность базы данных SQL после аварийного восстановления](sql-database-geo-replication-security-config.md).
* toolearn восстановление по журналу после сбоя с помощью активной георепликации, включая шаги для восстановления до и после восстановления и выполнения аварийного восстановления, в разделе [аварийного восстановления](sql-database-disaster-recovery.md)
* Прочитайте запись блога Александра Носова об активной георепликации: [Spotlight on new capabilities of Azure SQL Database geo-replication](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/) (Полезные сведения о новых возможностях георепликации базы данных SQL).
* Сведения о разработке облачных приложений toouse активной георепликации см. в разделе [разработке облачных приложений для обеспечения непрерывности бизнеса, с помощью георепликации](sql-database-designing-cloud-solutions-for-disaster-recovery.md)
* Сведения об использовании активной георепликации с эластичными пулами см. в статье [Стратегии аварийного восстановления для приложений с использованием пула эластичных баз данных SQL](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).
* Общие сведения об обеспечении непрерывности бизнес-процессов можно узнать в статье [Обзор обеспечения непрерывности бизнес-процессов с помощью базы данных SQL Azure](sql-database-business-continuity.md).

