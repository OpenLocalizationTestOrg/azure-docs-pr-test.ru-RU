---
title: "aaaOperating хранилище запросов в базе данных SQL Azure"
description: "Узнайте, как toooperate hello хранилище запросов в базе данных SQL Azure"
keywords: 
services: sql-database
documentationcenter: 
author: bonova
manager: jhubbard
editor: 
ms.assetid: 0cccf6bd-1327-44f7-a6f9-8eff0c210463
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: sqldb-performance
ms.workload: data-management
ms.date: 11/08/2016
ms.author: bonova
ms.openlocfilehash: ab741e49685bf6df3bceab219aaf57ea51cdb25d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="operating-hello-query-store-in-azure-sql-database"></a><span data-ttu-id="17818-103">Hello работы хранилища запросов в базе данных SQL Azure</span><span class="sxs-lookup"><span data-stu-id="17818-103">Operating hello Query Store in Azure SQL Database</span></span>
<span data-ttu-id="17818-104">Хранилище запросов в Azure является полностью управляемой службой базы данных, которая непрерывно собирает и предоставляет подробные статистические сведения обо всех запросах.</span><span class="sxs-lookup"><span data-stu-id="17818-104">Query Store in Azure is a fully managed database feature that continuously collects and presents detailed historic information about all queries.</span></span> <span data-ttu-id="17818-105">О хранилище запросов можно представить как аналогичные самолет tooan бортовому регистратору данных, значительно упрощает производительность запросов, устранение неполадок для облачных и локальных клиентов.</span><span class="sxs-lookup"><span data-stu-id="17818-105">You can think about Query Store as similar tooan airplane's flight data recorder that significantly simplifies query performance troubleshooting both for cloud and on-premises customers.</span></span> <span data-ttu-id="17818-106">В этой статье объясняются некоторые аспекты управления хранилищем запросов в Azure.</span><span class="sxs-lookup"><span data-stu-id="17818-106">This article explains specific aspects of operating Query Store in Azure.</span></span> <span data-ttu-id="17818-107">С помощью предварительно собранных данных о запросах можно быстро диагностировать и устранять проблемы с производительностью, что позволяет уделять больше времени основным рабочим задачам.</span><span class="sxs-lookup"><span data-stu-id="17818-107">Using this pre-collected query data, you can quickly diagnose and resolve performance problems and thus spend more time focusing on their business.</span></span> 

<span data-ttu-id="17818-108">Хранилище запросов [глобально доступно](https://azure.microsoft.com/updates/general-availability-azure-sql-database-query-store/) в базе данных SQL Azure с ноября 2015 г.</span><span class="sxs-lookup"><span data-stu-id="17818-108">Query Store has been [globally available](https://azure.microsoft.com/updates/general-availability-azure-sql-database-query-store/) in Azure SQL Database since November, 2015.</span></span> <span data-ttu-id="17818-109">Хранилище запросов — основа hello для анализа производительности и настройки компонентов, таких как [помощник по настройке ядра базы данных SQL и панели мониторинга производительности](https://azure.microsoft.com/updates/sqldatabaseadvisorga/).</span><span class="sxs-lookup"><span data-stu-id="17818-109">Query Store is hello foundation for performance analysis and tuning features, such as [SQL Database Advisor and Performance Dashboard](https://azure.microsoft.com/updates/sqldatabaseadvisorga/).</span></span> <span data-ttu-id="17818-110">На момент публикации в этой статье hello хранилище запросов работает в более чем 200 000 пользовательских баз данных в Azure, сбор данных, связанных с запросами, для нескольких месяцев, без прерывания.</span><span class="sxs-lookup"><span data-stu-id="17818-110">At hello moment of publishing this article, Query Store is running in more than 200,000 user databases in Azure, collecting query-related information for several months, without interruption.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="17818-111">Корпорация Майкрософт обладает hello процесс активации хранилище запросов для всех баз данных Azure SQL (существующие и новые).</span><span class="sxs-lookup"><span data-stu-id="17818-111">Microsoft is in hello process of activating Query Store for all Azure SQL databases (existing and new).</span></span> 
> 
> 

## <a name="optimal-query-store-configuration"></a><span data-ttu-id="17818-112">Оптимальная конфигурация хранилища запросов</span><span class="sxs-lookup"><span data-stu-id="17818-112">Optimal Query Store Configuration</span></span>
<span data-ttu-id="17818-113">В этом разделе описываются значения по умолчанию для обеспечения оптимальной, спроектированный tooensure надежной работы хранилища запросов hello и зависимые компоненты, такие как [помощник по настройке ядра базы данных SQL и панели мониторинга производительности](https://azure.microsoft.com/updates/sqldatabaseadvisorga/).</span><span class="sxs-lookup"><span data-stu-id="17818-113">This section describes optimal configuration defaults that are designed tooensure reliable operation of hello Query Store and dependent features, such as [SQL Database Advisor and Performance Dashboard](https://azure.microsoft.com/updates/sqldatabaseadvisorga/).</span></span> <span data-ttu-id="17818-114">По умолчанию конфигурация оптимизирована для постоянного сбора данных, т. е. для минимальной продолжительности состояний "Отключено" и "Только для чтения".</span><span class="sxs-lookup"><span data-stu-id="17818-114">Default configuration is optimized for continuous data collection, that is minimal time spent in OFF/READ_ONLY states.</span></span>

| <span data-ttu-id="17818-115">Конфигурация</span><span class="sxs-lookup"><span data-stu-id="17818-115">Configuration</span></span> | <span data-ttu-id="17818-116">Description (Описание)</span><span class="sxs-lookup"><span data-stu-id="17818-116">Description</span></span> | <span data-ttu-id="17818-117">значение по умолчанию</span><span class="sxs-lookup"><span data-stu-id="17818-117">Default</span></span> | <span data-ttu-id="17818-118">Комментарий</span><span class="sxs-lookup"><span data-stu-id="17818-118">Comment</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="17818-119">MAX_STORAGE_SIZE_MB</span><span class="sxs-lookup"><span data-stu-id="17818-119">MAX_STORAGE_SIZE_MB</span></span> |<span data-ttu-id="17818-120">Указывает hello предельный объем пространства данных hello, который может занимать хранилище запросов в базу данных клиентов z</span><span class="sxs-lookup"><span data-stu-id="17818-120">Specifies hello limit for hello data space that Query Store can take inside z customer database</span></span> |<span data-ttu-id="17818-121">100</span><span class="sxs-lookup"><span data-stu-id="17818-121">100</span></span> |<span data-ttu-id="17818-122">Принудительно для новых баз данных</span><span class="sxs-lookup"><span data-stu-id="17818-122">Enforced for new databases</span></span> |
| <span data-ttu-id="17818-123">INTERVAL_LENGTH_MINUTES</span><span class="sxs-lookup"><span data-stu-id="17818-123">INTERVAL_LENGTH_MINUTES</span></span> |<span data-ttu-id="17818-124">Определяет время, в течение которого объединяются и сохраняются собранные статистические данные среды выполнения по планам запросов.</span><span class="sxs-lookup"><span data-stu-id="17818-124">Defines size of time window during which collected runtime statistics for query plans are aggregated and persisted.</span></span> <span data-ttu-id="17818-125">Для каждого активного плана запроса в течение периода, заданного в этом параметре, будет сохраняться только одна строка.</span><span class="sxs-lookup"><span data-stu-id="17818-125">Every active query plan has at most one row for a period of time defined with this configuration</span></span> |<span data-ttu-id="17818-126">60</span><span class="sxs-lookup"><span data-stu-id="17818-126">60</span></span> |<span data-ttu-id="17818-127">Принудительно для новых баз данных</span><span class="sxs-lookup"><span data-stu-id="17818-127">Enforced for new databases</span></span> |
| <span data-ttu-id="17818-128">STALE_QUERY_THRESHOLD_DAYS</span><span class="sxs-lookup"><span data-stu-id="17818-128">STALE_QUERY_THRESHOLD_DAYS</span></span> |<span data-ttu-id="17818-129">Политика очистки на основе времени, которая управляет hello сроком хранения статистики среды выполнения и неактивных запросов</span><span class="sxs-lookup"><span data-stu-id="17818-129">Time-based cleanup policy that controls hello retention period of persisted runtime statistics and inactive queries</span></span> |<span data-ttu-id="17818-130">30</span><span class="sxs-lookup"><span data-stu-id="17818-130">30</span></span> |<span data-ttu-id="17818-131">Принудительно для новых баз данных и баз данных с предыдущим значением по умолчанию (367)</span><span class="sxs-lookup"><span data-stu-id="17818-131">Enforced for new databases and databases with previous default (367)</span></span> |
| <span data-ttu-id="17818-132">SIZE_BASED_CLEANUP_MODE</span><span class="sxs-lookup"><span data-stu-id="17818-132">SIZE_BASED_CLEANUP_MODE</span></span> |<span data-ttu-id="17818-133">Указывает, является ли автоматическая очистка имеет место при исчерпании размер хранилища запросов данные hello</span><span class="sxs-lookup"><span data-stu-id="17818-133">Specifies whether automatic data cleanup takes place when Query Store data size approaches hello limit</span></span> |<span data-ttu-id="17818-134">AUTO (АВТОМАТИЧЕСКИ)</span><span class="sxs-lookup"><span data-stu-id="17818-134">AUTO</span></span> |<span data-ttu-id="17818-135">Принудительно для всех баз данных</span><span class="sxs-lookup"><span data-stu-id="17818-135">Enforced for all databases</span></span> |
| <span data-ttu-id="17818-136">QUERY_CAPTURE_MODE</span><span class="sxs-lookup"><span data-stu-id="17818-136">QUERY_CAPTURE_MODE</span></span> |<span data-ttu-id="17818-137">Указывает, следует ли отслеживать все запросы или только определенное подмножество.</span><span class="sxs-lookup"><span data-stu-id="17818-137">Specifies whether all queries or only a subset of queries are tracked</span></span> |<span data-ttu-id="17818-138">AUTO (АВТОМАТИЧЕСКИ)</span><span class="sxs-lookup"><span data-stu-id="17818-138">AUTO</span></span> |<span data-ttu-id="17818-139">Принудительно для всех баз данных</span><span class="sxs-lookup"><span data-stu-id="17818-139">Enforced for all databases</span></span> |
| <span data-ttu-id="17818-140">FLUSH_INTERVAL_SECONDS</span><span class="sxs-lookup"><span data-stu-id="17818-140">FLUSH_INTERVAL_SECONDS</span></span> |<span data-ttu-id="17818-141">Указывает максимальный период, в течение которого записанный среды выполнения статистику в памяти, перед сбросом toodisk</span><span class="sxs-lookup"><span data-stu-id="17818-141">Specifies maximum period during which captured runtime statistics are kept in memory, before flushing toodisk</span></span> |<span data-ttu-id="17818-142">900</span><span class="sxs-lookup"><span data-stu-id="17818-142">900</span></span> |<span data-ttu-id="17818-143">Принудительно для новых баз данных</span><span class="sxs-lookup"><span data-stu-id="17818-143">Enforced for new databases</span></span> |
|  | | | |

> [!IMPORTANT]
> <span data-ttu-id="17818-144">Эти значения по умолчанию будут автоматически применяться hello заключительном этапе активации хранилище запросов во всех базах данных Azure SQL (см. выше важное примечание).</span><span class="sxs-lookup"><span data-stu-id="17818-144">These defaults are automatically applied in hello final stage of Query Store activation in all Azure SQL databases (see preceding important note).</span></span> <span data-ttu-id="17818-145">После этой точки зрения копии базы данных SQL Azure не будут изменены значения конфигурации, установленные клиентами, если только они негативно сказаться на основную рабочую нагрузку или надежных операций hello хранилища запросов.</span><span class="sxs-lookup"><span data-stu-id="17818-145">After this light up, Azure SQL Database won’t be changing configuration values set by customers, unless they negatively impact primary workload or reliable operations of hello Query Store.</span></span>
> 
> 

<span data-ttu-id="17818-146">Toostay с помощью настраиваемых параметров, используйте [инструкции ALTER DATABASE с помощью параметров хранилища запросов](https://msdn.microsoft.com/library/bb522682.aspx) toorevert конфигурации toohello предыдущее состояние.</span><span class="sxs-lookup"><span data-stu-id="17818-146">If you want toostay with your custom settings, use [ALTER DATABASE with Query Store options](https://msdn.microsoft.com/library/bb522682.aspx) toorevert configuration toohello previous state.</span></span> <span data-ttu-id="17818-147">Извлечение [Best Practices with hello хранилище запросов](https://msdn.microsoft.com/library/mt604821.aspx) в порядке toolearn как верхний выбрать оптимальную конфигурацию параметров.</span><span class="sxs-lookup"><span data-stu-id="17818-147">Check out [Best Practices with hello Query Store](https://msdn.microsoft.com/library/mt604821.aspx) in order toolearn how top chose optimal configuration parameters.</span></span>

## <a name="next-steps"></a><span data-ttu-id="17818-148">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="17818-148">Next steps</span></span>
[<span data-ttu-id="17818-149">Анализ производительности базы данных SQL</span><span class="sxs-lookup"><span data-stu-id="17818-149">SQL Database Performance Insight</span></span>](sql-database-performance.md)

## <a name="additional-resources"></a><span data-ttu-id="17818-150">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="17818-150">Additional resources</span></span>
<span data-ttu-id="17818-151">Дополнительные сведения о получение для изменения hello в следующих статьях:</span><span class="sxs-lookup"><span data-stu-id="17818-151">For more information check out hello following articles:</span></span>

* [<span data-ttu-id="17818-152">Query Store: A flight data recorder for your database (Хранилище запросов: "бортовой самописец" для вашей базы данных)</span><span class="sxs-lookup"><span data-stu-id="17818-152">A flight data recorder for your database</span></span>](https://azure.microsoft.com/blog/query-store-a-flight-data-recorder-for-your-database) 
* [<span data-ttu-id="17818-153">Мониторинг производительности с помощью хранилища запросов hello</span><span class="sxs-lookup"><span data-stu-id="17818-153">Monitoring Performance By Using hello Query Store</span></span>](https://msdn.microsoft.com/library/dn817826.aspx)
* [<span data-ttu-id="17818-154">Query Store Usage Scenarios (Сценарии использования хранилища запросов)</span><span class="sxs-lookup"><span data-stu-id="17818-154">Query Store Usage Scenarios</span></span>](https://msdn.microsoft.com/library/mt614796.aspx)
* [<span data-ttu-id="17818-155">Мониторинг производительности с помощью хранилища запросов hello</span><span class="sxs-lookup"><span data-stu-id="17818-155">Monitoring Performance By Using hello Query Store</span></span>](https://msdn.microsoft.com/library/dn817826.aspx) 

