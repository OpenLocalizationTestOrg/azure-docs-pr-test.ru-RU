---
title: "aaaAzure SQL имена входа и пользователи | Документы Microsoft"
description: "Дополнительные сведения об управлении безопасности базы данных SQL, в частности как toomanage базы данных защиты доступа и входа с применением hello учетная запись участника уровня сервера."
keywords: "безопасность баз данных SQL, управление безопасностью баз данных, защита входа в систему, безопасность баз данных, доступ к базе данных"
services: sql-database
documentationcenter: 
author: BYHAM
manager: jhubbard
editor: 
tags: 
ms.assetid: 0a65a93f-d5dc-424b-a774-7ed62d996f8c
ms.service: sql-database
ms.custom: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-management
ms.date: 01/23/2017
ms.author: rickbyh
ms.openlocfilehash: dff889b9fed09146a10008c0d11ca9e71d91df5e
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="controlling-and-granting-database-access"></a>Предоставление доступа к базе данных и управление им

При настройке правил брандмауэра пользователи могут подключаться tooa базы данных SQL, как одной из учетных записей администратора hello, hello владелец базы данных или пользователя базы данных в базе данных hello.  

>  [!NOTE]  
>  Этот раздел относится tooAzure SQL server и tooboth базы данных SQL и хранилищем данных SQL баз данных, создаваемых на сервере Azure SQL hello. Для простоты базы данных SQL используется при ссылке tooboth базы данных SQL и хранилищем данных SQL. 
>

> [!TIP]
> Ознакомьтесь с руководством [Защита базы данных SQL Azure](sql-database-security-tutorial.md).
>


## <a name="unrestricted-administrative-accounts"></a>Административные учетные записи с неограниченным доступом
В качестве администратора выступают две учетные записи (**администратор сервера** и **администратор Active Directory**). Откройте эти учетные записи администратора SQL server, tooidentify hello портал Azure и перейдите в свойства toohello вашего сервера SQL Server.

![Администраторы SQL Server](./media/sql-database-manage-logins/sql-admins.png)

- **Администратор сервера**   
При создании сервера Azure SQL Server необходимо назначить **имя для входа администратора сервера**. SQL server создает эту учетную запись как имя входа в базе данных master hello. Эта учетная запись подключается с использованием проверки подлинности SQL Server (с предоставлением имени пользователя и пароля). Может существовать только одна такая учетная запись.   
- **Администратор Azure Active Directory**   
Одной отдельной учетной записи или учетной записи группы безопасности Azure Active Directory также можно предоставить права администратора. Это необязательный tooconfigure администратор Azure AD, но администратор Azure AD должен быть настроен, если требуется, чтобы toouse Azure AD учетных записей tooconnect tooSQL базы данных. Дополнительные сведения о настройке доступа Azure Active Directory см. в разделе [tooSQL подключение базы данных или SQL данные хранилища с использованием Azure Active Directory проверки подлинности](sql-database-aad-authentication.md) и [SSMS поддержка многофакторной проверки Подлинности Azure AD с помощью SQL База данных и хранилище данных SQL](sql-database-ssms-mfa-authentication.md).
 

Hello **администратор сервера** и **администрирования Azure AD** учетных записей имеет следующие характеристики hello:
- Это hello только учетные записи, которые могут автоматически подключаться tooany базы данных SQL на сервере hello. (tooconnect tooa пользовательской базы данных, другие учетные записи должны быть владельцем hello hello базы данных или учетная запись пользователя в базе данных пользователей hello.)
- Эти учетные записи введите пользовательских баз данных в качестве hello `dbo` пользователя и они имеют все разрешения hello в hello пользовательских баз данных. (hello владельца пользователя базы данных также вводит hello базы данных как hello `dbo` пользователя.) 
- Эти учетные записи не вводите hello `master` базу данных в качестве hello `dbo` пользователей и их ограниченные разрешения в базе данных master. 
- Эти учетные записи не являются членами hello standard SQL Server `sysadmin` фиксированной серверной роли, которая недоступна в базе данных SQL.  
- Эти учетные записи могут создавать, изменять и удалять базы данных, имена для входа, пользователей в базе данных master и правила брандмауэра на уровне сервера.
- Эти учетные записи можно добавлять и удалять члены toohello `dbmanager` и `loginmanager` ролей.
- Эти учетные записи можно просматривать hello `sys.sql_logins` системной таблицы.

### <a name="configuring-hello-firewall"></a>Настройка брандмауэра hello
При настройке брандмауэра на уровне сервера hello для отдельных IP-адрес или диапазон hello **администратор SQL server** и hello **администратора Azure Active Directory** допускается подключение toohello базы данных master, а также все hello пользовательские базы данных. Hello начальной брандмауэра уровня сервера можно настроить с помощью hello [портал Azure](sql-database-get-started-portal.md), с использованием [PowerShell](sql-database-get-started-powershell.md) или с помощью hello [API-интерфейса REST](https://msdn.microsoft.com/library/azure/dn505712.aspx). После подключения также можно настроить дополнительные правила брандмауэра уровня сервера с помощью инструкции [Transact-SQL](sql-database-configure-firewall-settings.md).

### <a name="administrator-access-path"></a>Путь доступа администратора
При правильной настройке брандмауэра на уровне сервера hello hello **администратор SQL server** и hello **администратора Azure Active Directory** можно подключиться с помощью клиентских средств, таких как SQL Server Management Studio или SQL Server Data Tools. Только последняя версия средств hello предоставляют все функции hello и возможности. Hello следующей схеме показано это типичная конфигурация для hello две учетные записи администратора.

![Путь доступа администратора](./media/sql-database-manage-logins/1sql-db-administrator-access.png)

При использовании открытого порта в брандмауэре hello уровня сервера, администраторы могут выполнять подключения tooany базы данных SQL.

### <a name="connecting-tooa-database-by-using-sql-server-management-studio"></a>Соединения tooa базы данных с помощью SQL Server Management Studio
Руководство по созданию сервера, базы данных, правилах брандмауэра уровня сервера и с помощью SQL Server Management Studio tooquery базы данных, в разделе [начало работы с серверами баз данных SQL Azure, баз данных и правила брандмауэра с помощью портала Azure hello и SQL Server Management Studio](sql-database-get-started-portal.md).

> [!IMPORTANT]
> Рекомендуется всегда использовать hello последнюю версию среды Management Studio tooremain синхронизированы с tooMicrosoft обновления Azure и базы данных SQL. [Обновите среду SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).


## <a name="additional-server-level-administrative-roles"></a>Дополнительные административные роли на уровне сервера
В дополнение к этому toohello роли уровня сервера администрирования отмечалось ранее, база данных SQL предоставляет два ограниченные административные роли в базы данных master для hello toowhich учетных записей пользователей можно добавить, предоставление разрешений tooeither создания базы данных или управление имена входа.

### <a name="database-creators"></a>Создатели баз данных
Одной из этих ролей администратора — hello **dbmanager** роли. Участники этой роли могут создавать базы данных. toouse этой роли можно создать пользователя в hello `master` базы данных, а затем добавьте пользователя toohello hello **dbmanager** роли базы данных. toocreate базы данных, hello пользователь должен быть в учетной записи на основе имени входа SQL Server в базе данных master hello или содержится пользователем базы данных на основании пользователя Azure Active Directory.

1. С помощью учетной записи администратора, подключение toohello базы данных master.
2. Необязательный шаг: создайте имя входа проверки подлинности SQL Server, с помощью hello [CREATE LOGIN](https://msdn.microsoft.com/library/ms189751.aspx) инструкции. Пример инструкции:
   
   ```
   CREATE LOGIN Mary WITH PASSWORD = '<strong_password>';
   ```
   
   > [!NOTE]
   > Создавая имя для входа или пользователя автономной базы данных, используйте надежный пароль. Дополнительные сведения см. в статье [Надежные пароли](https://msdn.microsoft.com/library/ms161962.aspx).
    
   производительность tooimprove имена входа (участников уровня сервера), временно кэшируются на уровне базы данных hello. кэш проверки подлинности toorefresh hello, в разделе [DBCC FLUSHAUTHCACHE](https://msdn.microsoft.com/library/mt627793.aspx).

3. В базе данных master hello, создайте пользователя с помощью hello [CREATE USER](https://msdn.microsoft.com/library/ms173463.aspx) инструкции. Hello пользователя может быть Azure Active Directory содержатся проверки подлинности пользователя базы данных (Если вы настроили среды для проверки подлинности Azure AD), или содержащиеся проверки подлинности пользователя базы данных SQL Server или пользователем проверки подлинности SQL Server на основании SQL Имя входа проверки подлинности сервера (созданного на предыдущем шаге hello). Примеры инструкций:
   
   ```
   CREATE USER [mike@contoso.com] FROM EXTERNAL PROVIDER;
   CREATE USER Tran WITH PASSWORD = '<strong_password>';
   CREATE USER Mary FROM LOGIN Mary; 
   ```

4. Добавить нового пользователя hello, toohello **dbmanager** роли базы данных с помощью hello [ALTER ROLE](https://msdn.microsoft.com/library/ms189775.aspx) инструкции. Примеры инструкций:
   
   ```
   ALTER ROLE dbmanager ADD MEMBER Mary; 
   ALTER ROLE dbmanager ADD MEMBER [mike@contoso.com];
   ```
   
   > [!NOTE]
   > Hello dbmanager является роль базы данных в базе данных master, поэтому можно добавлять только роли dbmanager toohello пользователя базы данных. Не удается добавить роль уровня toodatabase входа уровня сервера.
    
5. При необходимости настройте брандмауэр правило tooallow hello нового пользователя tooconnect. (существующее правило брандмауэра может быть назначено hello нового пользователя.)

Теперь пользователь hello можно подключиться к базе данных master toohello и может создать новые базы данных. Учетная запись Hello, создание базы данных hello становится владельцем hello hello базы данных.

### <a name="login-managers"></a>Диспетчеры входа
Hello другие административные роли — роль диспетчера входа hello. Члены этой роли могут создавать новых имен входа в базе данных master hello. При желании можно выполнить hello же шаги (Создание имени входа и пользователя и добавление toohello пользователя **loginmanager** роль) tooenable пользователь toocreate новых имен входа в базе данных master hello. Обычно имена входа являются необязательными, как корпорация Майкрософт рекомендует использовать пользователей автономной базы данных, которые проходят проверку подлинности на hello уровня базы данных вместо использования на основе имен входа пользователей. Дополнительные сведения см. в статье [Пользователи автономной базы данных — создание переносимой базы данных](https://msdn.microsoft.com/library/ff929188.aspx).

## <a name="non-administrator-users"></a>Пользователи без прав администратора
Как правило учетные записи без прав администратора не требуется доступ к toohello базы данных master. Создавать пользователей автономной базы данных на уровне базы данных hello, с помощью hello [CREATE USER (Transact-SQL)](https://msdn.microsoft.com/library/ms173463.aspx) инструкции. Hello пользователя может быть Azure Active Directory содержатся проверки подлинности пользователя базы данных (Если вы настроили среды для проверки подлинности Azure AD), или содержащиеся проверки подлинности пользователя базы данных SQL Server или пользователем проверки подлинности SQL Server на основании SQL Имя входа проверки подлинности сервера (созданного на предыдущем шаге hello). Дополнительные сведения см. в статье [Пользователи автономной базы данных — создание переносимой базы данных](https://msdn.microsoft.com/library/ff929188.aspx). 

Пользователи toocreate подключения toohello базы данных и выполните toohello аналогичные инструкции, следующие примеры:

```
CREATE USER Mary FROM LOGIN Mary; 
CREATE USER [mike@contoso.com] FROM EXTERNAL PROVIDER;
```

Первоначально только одного из администраторов hello или владелец hello hello базы данных можно создать пользователей. tooauthorize дополнительных пользователей toocreate новых пользователей, предоставление hello, выбранным пользователем `ALTER ANY USER` разрешение с помощью инструкции, такие как:

```
GRANT ALTER ANY USER tooMary;
```

Полный доступ дополнительным пользователям toogive hello базы данных, сделать их членом hello **db_owner** предопределенной роли базы данных с помощью hello `ALTER ROLE` инструкции.

> [!NOTE]
> Hello наиболее распространенные причины toocreate базы данных пользователей на основе имен входа, — при наличии пользователей проверки подлинности SQL Server, которые требуется доступ к базам данных toomultiple. Пользователи, на основе имен входа должны быть равноценных toohello входа и только один пароль, который ведется для этого имени входа. Пользователи автономной базы данных в отдельных базах данных являются отдельными сущностями с собственным паролем. Это может запутать пользователей автономной базы данных, если их пароли не одинаковы.

### <a name="configuring-hello-database-level-firewall"></a>Настройка параметров брандмауэра уровня базы данных hello
Пользователи без прав администратора рекомендуется достаточно доступа по базам данных hello брандмауэра toohello, которые в них используются. Вместо авторизации их IP-адреса с помощью уровня сервера hello брандмауэра и предоставление им tooall базы данных access, использовать hello [sp_set_database_firewall_rule](https://msdn.microsoft.com/library/dn270010.aspx) брандмауэра уровня базы данных инструкции tooconfigure hello. Hello брандмауэра уровня базы данных нельзя настроить с помощью портала hello.

### <a name="non-administrator-access-path"></a>Путь доступа пользователя без прав администратора
При правильной настройке брандмауэра на уровне базы данных hello hello базы данных позволяет пользователям подключаться с помощью клиентских средств, таких как SQL Server Management Studio или SQL Server Data Tools. Только последняя версия средств hello предоставляют все функции hello и возможности. Привет, следующая диаграмма показывает путь обычно доступ без прав администратора.

![Путь доступа пользователя без прав администратора](./media/sql-database-manage-logins/2sql-db-nonadmin-access.png)

## <a name="groups-and-roles"></a>Группы и роли
Эффективный доступ управления использует разрешения, назначенные toogroups и ролям, а не отдельным пользователям. 

- При использовании проверки подлинности Azure Active Directory поместите пользователей Azure Active Directory в соответствующую группу. Создайте пользователя автономной базы данных для группы hello. Установите один или несколько пользователей базы данных в [роли базы данных](https://msdn.microsoft.com/library/ms189121) , а затем назначьте [разрешений](https://msdn.microsoft.com/library/ms191291.aspx) toohello роли базы данных.

- При использовании проверки подлинности SQL Server, создайте пользователей автономной базы данных в базе данных hello. Установите один или несколько пользователей базы данных в [роли базы данных](https://msdn.microsoft.com/library/ms189121) , а затем назначьте [разрешений](https://msdn.microsoft.com/library/ms191291.aspx) toohello роли базы данных.

Hello роли базы данных может быть hello встроенные роли, например **db_owner**, **db_ddladmin**, **db_datawriter**, **db_datareader**, **db_denydatawriter**, и **db_denydatareader**. **db_owner** является tooonly часто используемые toogrant полные разрешения нескольким пользователям. Hello других предопределенных ролей базы данных полезны для быстрого получения простой базы данных в разработке, но не рекомендуется для большинства рабочих баз данных. Например, hello **db_datareader** предопределенной роли базы данных предоставляет доступ на чтение таблицы tooevery hello базы данных, которой обычно является более является обязательным. Это гораздо лучше hello toouse [CREATE ROLE](https://msdn.microsoft.com/library/ms187936.aspx) toocreate инструкции собственных определяемых пользователем ролей базы данных и тщательно предоставляйте hello каждой роли как минимум разрешения, необходимые для hello бизнес-задачи. Если пользователь является членом нескольких ролей, статистической обработки разрешения hello их все.

## <a name="permissions"></a>Разрешения
Существует более 100 разрешений, которые можно по отдельности предоставлять или отменять в базе данных SQL. Многие эти разрешения являются частью других разрешений. Например, hello `UPDATE` разрешения на схему включает hello `UPDATE` разрешения для каждой таблицы в этой схеме. Как и большинство систем разрешение hello отклонение разрешения отменяет grant. Из-за характера вложенные hello и hello количество разрешений может потребоваться тщательного изучения toodesign tooproperly разрешения системы защиты базы данных. Начать с hello список разрешений на [разрешения (компонент Database Engine)](https://msdn.microsoft.com/library/ms191291.aspx) и просмотрите hello [графический плакат размер](http://go.microsoft.com/fwlink/?LinkId=229142) hello разрешений.


### <a name="considerations-and-restrictions"></a>Рекомендации и ограничения
При управлении именами входа и пользователей в базе данных SQL, рассмотрим следующие hello.

* Должен быть подключенным toohello **master** базы данных при выполнении hello `CREATE/ALTER/DROP DATABASE` инструкции.   
* Здравствуйте, toohello соответствующего пользователя базы данных **администратор сервера** входа не может быть изменена или удалена. 
* Английский (США) — язык по умолчанию hello hello **администратор сервера** входа.
* Здравствуйте, только администраторы (**администратор сервера** входа или администратор Azure AD) и члены hello hello **dbmanager** роли базы данных в hello **master** база данных имеет разрешение tooexecute hello `CREATE DATABASE` и `DROP DATABASE` инструкции.
* Должен быть toohello подключенной базы данных master, при выполнении hello `CREATE/ALTER/DROP LOGIN` инструкции. В то же время использовать имена входа не рекомендуется. Вместо них используйте пользователей автономной базы данных.
* tooconnect tooa пользовательской базы данных, необходимо указать имя hello hello базы данных в строке подключения hello.
* Только hello уровня сервера основного имени входа и hello члены hello **loginmanager** роли базы данных в hello **master** базы данных имеют разрешение hello tooexecute `CREATE LOGIN`, `ALTER LOGIN`, и `DROP LOGIN` инструкции.
* При выполнении hello `CREATE/ALTER/DROP LOGIN` и `CREATE/ALTER/DROP DATABASE` инструкций в приложении ADO.NET использование параметризованных команд не допускается. Дополнительные сведения можно найти в статье [Команды и параметры](https://msdn.microsoft.com/library/ms254953.aspx).
* При выполнении hello `CREATE/ALTER/DROP DATABASE` и `CREATE/ALTER/DROP LOGIN` инструкций, каждая из этих инструкций необходимо hello только инструкцией в пакете Transact-SQL. В противном случае возникает ошибка. Например hello, следующий запрос Transact-SQL проверяет, существует ли база данных hello. Если он существует, `DROP DATABASE` вызова инструкции базы данных tooremove hello. Поскольку hello `DROP DATABASE` инструкции не hello единственной инструкцией в пакете hello, hello следующей инструкции Transact-SQL приведет к ошибке.

  ```
  IF EXISTS (SELECT [name]
           FROM   [sys].[databases]
           WHERE  [name] = N'database_name')
  DROP DATABASE [database_name];
  GO
  ```

* При выполнении hello `CREATE USER` инструкции с hello `FOR/FROM LOGIN` , она должна быть hello только инструкцией в пакете Transact-SQL.
* При выполнении hello `ALTER USER` инструкции с hello `WITH LOGIN` , она должна быть hello только инструкцией в пакете Transact-SQL.
* слишком`CREATE/ALTER/DROP` hello, пользователь должен `ALTER ANY USER` разрешение hello базе данных.
* При hello владельца роли базы данных tooadd или удалить другой tooor пользователя базы данных, роли базы данных, может появиться следующая ошибка hello: **пользователя или роль «Имя» не существует в этой базе данных.** Эта ошибка возникает, так как пользователь hello не является владельцем toohello видимым. tooresolve эту проблему, предоставьте hello роль владельца hello `VIEW DEFINITION` разрешение на доступ пользователя hello. 


## <a name="next-steps"></a>Дальнейшие действия

- toolearn Дополнительные сведения о правилах брандмауэра. в разделе [брандмауэр базы данных SQL Azure](sql-database-firewall-configure.md).
- Обзор всех функций безопасности hello базы данных SQL см. в разделе [Обзор безопасности SQL](sql-database-security-overview.md).
- Ознакомьтесь с руководством [Защита базы данных SQL Azure](sql-database-security-tutorial.md).
- Сведения о представлениях и хранимых процедурах см. в статье [Создание представлений и хранимых процедур](https://msdn.microsoft.com/library/ms365311.aspx).
- Сведения о предоставлении tooa объектов базы данных см. в разделе [tooa предоставление доступа к объекту базы данных](https://msdn.microsoft.com/library/ms365327.aspx)
