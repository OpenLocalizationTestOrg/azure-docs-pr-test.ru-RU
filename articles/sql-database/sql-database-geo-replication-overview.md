---
title: "Группы отработки отказа и активная георепликация в базе данных SQL Azure | Документация Майкрософт"
description: "Группы автоматической отработки отказа и активная георепликация позволяют настроить 4 реплики базы данных в любом центре обработки данных Azure, а также автоматическую отработку отказа в случае сбоя."
services: sql-database
documentationcenter: na
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 2a29f657-82fb-4283-9a83-e14a144bfd93
ms.service: sql-database
ms.custom: business continuity
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: NA
ms.date: 07/10/2017
ms.author: sashan
ms.openlocfilehash: 9a2171f59c6192115dc1820e7f033fd783c9e077
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="overview-failover-groups-and-active-geo-replication"></a><span data-ttu-id="8f5c0-103">Обзор. Группы отработки отказа и активная георепликация</span><span class="sxs-lookup"><span data-stu-id="8f5c0-103">Overview: Failover groups and active geo-replication</span></span>
<span data-ttu-id="8f5c0-104">Активная георепликация позволяет настроить до четырех доступных для чтения баз данных-получателей в одном или в разных расположениях (регионах) центров обработки данных.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-104">Active geo-replication enables you to configure up to four readable secondary databases in the same or different data center locations (regions).</span></span> <span data-ttu-id="8f5c0-105">Базы данных-получатели доступны для выполнения запросов и отработки отказа при сбое центра обработки данных или невозможности подключения к базе данных-источнику.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-105">Secondary databases are available for querying and for failover in the case of a data center outage or the inability to connect to the primary database.</span></span> <span data-ttu-id="8f5c0-106">Отработка отказа должна инициироваться вручную приложением пользователя.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-106">The failover must be initiated manually by the application of the user.</span></span> <span data-ttu-id="8f5c0-107">После отработки отказа у новой базы данных-источника будет другая конечная точка подключения.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-107">After failover, the new primary has a different connection end-point.</span></span> 

> [!NOTE]
> <span data-ttu-id="8f5c0-108">Активная георепликация доступна для всех баз данных и всех уровней обслуживания во всех регионах.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-108">Active geo-replication is available for all databases in all service tiers in all regions.</span></span>
>  

<span data-ttu-id="8f5c0-109">Группы автоматической отработки отказа (в предварительной версии) базы данных SQL Azure являются функцией базы данных SQL. Они предназначены для автоматического управления связями георепликации, подключением и отработкой отказа в нужном масштабе.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-109">Azure SQL Database auto-failover groups (in-preview) is a SQL Database feature designed to automatically manage geo-replication relationship, connectivity, and failover at scale.</span></span> <span data-ttu-id="8f5c0-110">Благодаря им клиенты получают возможность автоматического восстановления нескольких связанных баз данных в дополнительном регионе после катастрофических региональных сбоев или других незапланированных событий, которые приводят к полной или частичной потере доступности службы базы данных SQL в основном регионе.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-110">With it, the customers gain the ability to automatically recover multiple related databases in the secondary region after catastrophic regional failures or other unplanned events that result in full or partial loss of the SQL Database service’s availability in the primary region.</span></span> <span data-ttu-id="8f5c0-111">Кроме того, клиенты могут использовать доступные для чтения базы данных-получатели для разгрузки рабочих нагрузок, доступных только для чтения.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-111">Additionally, they can use the readable secondary databases to offload read-only workloads.</span></span>  <span data-ttu-id="8f5c0-112">Так как группы автоматической отработки отказа включают несколько баз данных, их необходимо настроить на основном сервере.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-112">Because auto-failover groups involve multiple databases they must be configured on the primary server.</span></span> <span data-ttu-id="8f5c0-113">Основной сервер и сервер-получатель должны находиться в одной подписке.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-113">Both primary and secondary servers must be in the same subscription.</span></span> <span data-ttu-id="8f5c0-114">Группы автоматической отработки отказа поддерживают репликацию всех баз данных в группе только на один сервер-получатель в другом регионе.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-114">Auto-failover groups support replication of all databases in the group to only one secondary server in a different region.</span></span> <span data-ttu-id="8f5c0-115">Активная георепликация без групп автоматической отработки отказа поддерживает до 4 серверов-получателей в любом регионе.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-115">Active geo-replication, without auto-failover groups, allows up to 4 secondaries in any region.</span></span>

<span data-ttu-id="8f5c0-116">Если при использовании активной георепликации по какой-либо причине произойдет сбой вашей базы данных-источника (или вам просто потребуется перевести ее в автономный режим), вы можете выполнить отработку отказа в любую из баз данных-получателей.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-116">If you are using active geo-replication and for any reason your primary database fails, or simply needs to be taken offline, you can initiate failover to any of your secondary databases.</span></span> <span data-ttu-id="8f5c0-117">При активации отработки отказа в одной из баз данных-получателей все прочие получатели автоматически связываются с новой базой данных-источником.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-117">When failover is activated to one of the secondary databases, all other secondaries are automatically linked to the new primary.</span></span> <span data-ttu-id="8f5c0-118">Если вы используете группы автоматической отработки отказа (в предварительной версии) для управления восстановлением базы данных, любой сбой, который влияет на одну или несколько баз данных в группе, приведет к автоматической отработке отказа.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-118">If you are using auto-failover groups (in-preview) to manage database recovery and any outage that impacts one or several of the databases in the group results in automatic failover.</span></span> <span data-ttu-id="8f5c0-119">Вы можете настроить политику автоматической отработки отказа, которая лучше всего подойдет вашему приложению, или же вы можете отказаться от этой настройки и использовать активацию вручную.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-119">You can configure the auto-failover policy that best meets your application needs, or you can opt out and use manual activation.</span></span> <span data-ttu-id="8f5c0-120">Кроме того, группы автоматической отработки отказа (в предварительной версии) предоставляют конечные точки прослушивателя только для чтения и для чтения-записи, которые во время отработки отказа не изменяются.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-120">In addition, auto-failover groups (in-preview) provide read-write and read-only listener end-points that remain unchanged during failovers.</span></span> <span data-ttu-id="8f5c0-121">Независимо от того, используете ли вы активацию вручную или автоматическую активацию отработки отказа, отработка отказа переключит все базы данных-получатели в группе в базу данных-источник.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-121">Whether you use manual or automatic failover activation, failover switches all secondary databases in the group to primary.</span></span> <span data-ttu-id="8f5c0-122">После завершения отработки отказа базы данных запись DNS автоматически обновляется, чтобы перенаправить конечные точки в новый регион.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-122">After the database failover is completed, the DNS record is automatically updated to redirect the end-points to the new region.</span></span>

<span data-ttu-id="8f5c0-123">Вы можете управлять репликацией и отработкой отказа отдельной базы данных или набора баз данных на сервере или в эластичном пуле с помощью активной георепликации.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-123">You can manage replication and failover of an individual database or a set of databases on a server or in an elastic pool using active geo-replication.</span></span> <span data-ttu-id="8f5c0-124">Это можно сделать с помощью [портала Azure](sql-database-geo-replication-portal.md), [PowerShell](sql-database-geo-replication-powershell.md), [Transact-SQL](sql-database-geo-replication-transact-sql.md) или [REST API](https://msdn.microsoft.com/library/azure/mt163685.aspx).</span><span class="sxs-lookup"><span data-stu-id="8f5c0-124">You can do that using the [Azure portal](sql-database-geo-replication-portal.md), [PowerShell](sql-database-geo-replication-powershell.md), [Transact-SQL](sql-database-geo-replication-transact-sql.md), or the [REST API](https://msdn.microsoft.com/library/azure/mt163685.aspx).</span></span> <span data-ttu-id="8f5c0-125">После отработки отказа убедитесь, что для новой базы данных-источника настроены требования аутентификации ваших сервера и базы данных.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-125">After failover, ensure the authentication requirements for your server and database are configured on the new primary.</span></span> <span data-ttu-id="8f5c0-126">Дополнительные сведения см. в разделе [Безопасность базы данных SQL после аварийного восстановления](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="8f5c0-126">For details, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span> <span data-ttu-id="8f5c0-127">Это применимо к активной георепликации и группам автоматической отработки отказа (в предварительной версии).</span><span class="sxs-lookup"><span data-stu-id="8f5c0-127">This applies both to active geo-replication and auto-failover groups (in-preview).</span></span>

<span data-ttu-id="8f5c0-128">Активная георепликация использует технологию SQL Server [AlwaysOn](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server) для асинхронной репликации зафиксированных транзакций в базе данных-источнике в базы данных-получатели с помощью изоляции фиксации моментального снимка при чтении (RCSI).</span><span class="sxs-lookup"><span data-stu-id="8f5c0-128">Active geo-replication leverages the [Always On](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server) technology of SQL Server to asynchronously replicate committed transactions on the primary database to a secondary database using read committed snapshot isolation (RCSI).</span></span> <span data-ttu-id="8f5c0-129">Группы автоматической отработки отказа обеспечивают групповую семантику на основе активной георепликации, однако используется тот же механизм асинхронной репликации.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-129">Auto-failover groups provide the group semantics on top of active geo-replication but the same asynchronous replication mechanism is used.</span></span> <span data-ttu-id="8f5c0-130">Хотя в любой момент база данных-получатель может немного отстать от базы данных-источника, в базе данных-получателе никогда не будет частично выполненных транзакций.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-130">While at any given point, the secondary database might be slightly behind the primary database, the secondary data is guaranteed to never have partial transactions.</span></span> <span data-ttu-id="8f5c0-131">Избыточность в различных регионах позволяет быстро восстанавливать приложения после необратимой потери всего центра обработки данных или его частей, вызванной стихийным бедствием, неисправимыми человеческими ошибками или вредоносными действиями.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-131">Cross-region redundancy enables applications to quickly recover from a permanent loss of an entire datacenter or parts of a datacenter caused by natural disasters, catastrophic human errors, or malicious acts.</span></span> <span data-ttu-id="8f5c0-132">Конкретные сведения о RPO можно найти в [обзоре непрерывности бизнес-процессов](sql-database-business-continuity.md).</span><span class="sxs-lookup"><span data-stu-id="8f5c0-132">The specific RPO data can be found at [Overview of Business Continuity](sql-database-business-continuity.md).</span></span>

<span data-ttu-id="8f5c0-133">На следующем рисунке показан пример активной георепликации, настроенной с помощью базы данных-источника в северо-центральном регионе США и базы данных-получателя в юго-центральном регионе США.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-133">The following figure shows an example of active geo-replication configured with a primary in the North Central US region and secondary in the South Central US region.</span></span>

![Отношение георепликации](./media/sql-database-active-geo-replication/geo-replication-relationship.png)

<span data-ttu-id="8f5c0-135">Так как базы данных-получатели доступны для чтения, они могут использоваться для разгрузки рабочих нагрузок только для чтения, например заданий для составления отчетов.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-135">Because the secondary databases are readable, they can be used to offload read-only workloads such as reporting jobs.</span></span> <span data-ttu-id="8f5c0-136">Если вы используете активную георепликацию, вы можете создать базу данных-получатель в том же регионе, в котором расположена база данных-источник, однако устойчивость приложения к катастрофическим сбоям останется на прежнем уровне.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-136">If you are using active geo-replication, it is possible to create the secondary database in the same region with the primary, but it does not increase the application's resilience to catastrophic failures.</span></span> <span data-ttu-id="8f5c0-137">Если вы используете группы автоматической отработки отказа (в предварительной версии), база данных-получатель всегда будет создаваться в другом регионе.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-137">If you are using auto-failover groups (in-preview), your secondary database is always created in a different region.</span></span>

<span data-ttu-id="8f5c0-138">Активная георепликация может использоваться не только для аварийного восстановления, но и в следующих сценариях:</span><span class="sxs-lookup"><span data-stu-id="8f5c0-138">In addition to disaster recovery active geo-replication can be used in the following scenarios:</span></span>

* <span data-ttu-id="8f5c0-139">**Перенос баз данных**: с помощью активной георепликации можно перенести базу данных с одного сервера на другой с минимальным временем простоя.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-139">**Database migration**: You can use active geo-replication to migrate a database from one server to another online with minimum downtime.</span></span>
* <span data-ttu-id="8f5c0-140">**Обновления приложения**: при обновлении приложения вы можете создать дополнительную базу данных-получатель как резервную копию на случай сбоя.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-140">**Application upgrades**: You can create an extra secondary as a fail back copy during application upgrades.</span></span>

<span data-ttu-id="8f5c0-141">Добавление избыточности баз данных между центрами обработки данных — только часть решения для достижения настоящей непрерывности бизнес-процессов.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-141">To achieve real business continuity, adding database redundancy between datacenters is only part of the solution.</span></span> <span data-ttu-id="8f5c0-142">Для комплексного восстановления приложения (службы) после катастрофического сбоя необходимо восстановить все компоненты, из которых состоит служба и все зависимые службы.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-142">Recovering an application (service) end-to-end after a catastrophic failure requires recovery of all components that constitute the service and any dependent services.</span></span> <span data-ttu-id="8f5c0-143">К примерам этих компонентов относятся клиентское программное обеспечение (например, браузер с пользовательским кодом JavaScript), интерфейсные веб-серверы, хранилище и DNS.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-143">Examples of these components include the client software (for example, a browser with a custom JavaScript), web front ends, storage, and DNS.</span></span> <span data-ttu-id="8f5c0-144">Очень важно, чтобы все компоненты были устойчивы к одинаковым сбоям и становились доступными в соответствии с целевым временем восстановления (RTO) вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-144">It is critical that all components are resilient to the same failures and become available within the recovery time objective (RTO) of your application.</span></span> <span data-ttu-id="8f5c0-145">Следовательно, необходимо определить все зависимые службы и получить сведения о гарантиях и возможностях, которые они предоставляют.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-145">Therefore, you need to identify all dependent services and understand the guarantees and capabilities they provide.</span></span> <span data-ttu-id="8f5c0-146">Затем необходимо выполнить соответствующие действия, чтобы обеспечить работу службы во время отработки отказа служб, от которых она зависит.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-146">Then, you must take adequate steps to ensure that your service functions during the failover of the services on which it depends.</span></span> <span data-ttu-id="8f5c0-147">Дополнительные сведения о проектировании решений для аварийного восстановления см. в статье о [разработке облачных решений для аварийного восстановления с помощью активной георепликации](sql-database-designing-cloud-solutions-for-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="8f5c0-147">For more information about designing solutions for disaster recovery, see [Designing Cloud Solutions for Disaster Recovery Using active geo-replication](sql-database-designing-cloud-solutions-for-disaster-recovery.md).</span></span>

## <a name="active-geo-replication-capabilities"></a><span data-ttu-id="8f5c0-148">Возможности активной георепликации</span><span class="sxs-lookup"><span data-stu-id="8f5c0-148">Active geo-replication capabilities</span></span>
<span data-ttu-id="8f5c0-149">Функция активной георепликации предоставляет следующие возможности:</span><span class="sxs-lookup"><span data-stu-id="8f5c0-149">The active geo-replication feature provides the following essential capabilities:</span></span>
* <span data-ttu-id="8f5c0-150">**Автоматическая асинхронная репликация**: базу данных-получатель можно создать, только добавив ее к существующей базе данных.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-150">**Automatic Asynchronous Replication**: You can only create a secondary database by adding to an existing database.</span></span> <span data-ttu-id="8f5c0-151">Базу данных-получатель можно создать на любом сервере базы данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-151">The secondary can be created in any Azure SQL Database server.</span></span> <span data-ttu-id="8f5c0-152">После создания база данных-получатель заполняется данными, которые копируются из базы данных-источника.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-152">Once created, the secondary database is populated with the data copied from the primary database.</span></span> <span data-ttu-id="8f5c0-153">Этот процесс называется заполнением.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-153">This process is known as seeding.</span></span> <span data-ttu-id="8f5c0-154">После создания и начального заполнения базы данных-получателя обновления базы данных-источника асинхронно и автоматически реплицируются в базу данных-получателя.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-154">After secondary database has been created and seeded, updates to the primary database are asynchronously replicated to the secondary database automatically.</span></span> <span data-ttu-id="8f5c0-155">Асинхронная репликация означает, что транзакции фиксируются в базе данных-источнике перед их репликацией в базу данных-получатель.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-155">Asynchronous replication means that transactions are committed on the primary database before they are replicated to the secondary database.</span></span> 
* <span data-ttu-id="8f5c0-156">**Базы данных-получатели, доступные для чтения**: приложение может получить доступ к базе данных-получателю только для чтения с использованием тех же или других субъектов безопасности, которые применяются для доступа к базе данных-источнику.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-156">**Readable secondary databases**: An application can access a secondary database for read-only operations using the same or different security principals used for accessing the primary database.</span></span> <span data-ttu-id="8f5c0-157">База данных-получатель работает в режиме изоляции моментальных снимков, чтобы гарантировать, что репликация обновлений базы данных-источника (воспроизведение журнала) не будет задерживаться из-за запросов, выполняемых на базе данных-получателе.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-157">The secondary databases operate in snapshot isolation mode to ensure replication of the updates of the primary (log replay) is not delayed by queries executed on the secondary.</span></span>

   > [!NOTE]
   > <span data-ttu-id="8f5c0-158">Воспроизведение журнала на базе данных-получателе откладывается, если существуют обновления схемы, которые были получены из базы данных-источника, для которых необходимо выполнить блокировку схемы базы данных-получателя.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-158">The log replay is delayed on the secondary database if there are schema updates that it is receiving from the Primary that require a schema lock on the secondary database.</span></span> 
   > 

* <span data-ttu-id="8f5c0-159">**Несколько баз данных-получателей для чтения.** Две или более базы данных-получателей повышают избыточность и уровень защиты для базы данных-источника и приложения.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-159">**Multiple readable secondaries**: Two or more secondary databases increase redundancy and level of protection for the primary database and application.</span></span> <span data-ttu-id="8f5c0-160">Если существует несколько баз данных-получателей, то приложение остается защищенным даже при сбое одной из баз данных-получателей.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-160">If multiple secondary databases exist, the application remains protected even if one of the secondary databases fails.</span></span> <span data-ttu-id="8f5c0-161">Если же имеется только одна база данных-получатель и на ней происходит сбой, приложение подвергается более высокому риску, пока не будет создана новая база данных-получатель.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-161">If there is only one secondary database, and it fails, the application is exposed to higher risk until a new secondary database is created.</span></span>

   > [!NOTE]
   > <span data-ttu-id="8f5c0-162">Если вы используете активную георепликацию, чтобы создать глобально распределенное приложение, и вам необходимо предоставить к данным доступ только для чтения более чем в 4 регионах, вы можете создать базу данных-получатель первой базы данных-получателя (цепочка).</span><span class="sxs-lookup"><span data-stu-id="8f5c0-162">If you are using active geo-replication to build a globally distributed application and need to provide read-only access to data in more than 4 regions, you can create secondary of a secondary (a process known as chaining).</span></span> <span data-ttu-id="8f5c0-163">Это гарантирует виртуально неограниченное масштабирование репликации базы данных.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-163">This way you can achieve virtually unlimited scale of database replication.</span></span> <span data-ttu-id="8f5c0-164">Кроме того, эта цепочка снижает нагрузку репликации в базе данных-источнике.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-164">In addition, chaining reduces the overhead of replication from the primary database.</span></span> <span data-ttu-id="8f5c0-165">Недостатком является увеличенная задержка репликации в конечных базах данных-получателях.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-165">The trade-off is the increased replication lag on the leaf-most secondary databases.</span></span> <span data-ttu-id="8f5c0-166">.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-166">.</span></span> 
   >

* <span data-ttu-id="8f5c0-167">**Поддержка баз данных эластичного пула.** Активную георепликацию можно настроить для любой базы данных в любом эластичном пуле.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-167">**Support of elastic pool databases**: Active geo-replication can be configured for any database in any elastic pool.</span></span> <span data-ttu-id="8f5c0-168">База данных-получатель может находиться в другом пуле эластичных баз данных.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-168">The secondary database can be in another elastic pool.</span></span> <span data-ttu-id="8f5c0-169">Для обычных баз данных база данных-получатель может представлять собой пул эластичных баз данных и наоборот, при условии, что уровни служб совпадают.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-169">For regular databases, the secondary can be an elastic pool and vice versa as long as the service tiers are the same.</span></span> 
* <span data-ttu-id="8f5c0-170">**Настраиваемый уровень производительности для базы данных-получателя**. Базу данных-получатель можно создать с более низким уровнем производительности, чем у базы данных-источника.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-170">**Configurable performance level of the secondary database**: A secondary database can be created with lower performance level than the primary.</span></span> <span data-ttu-id="8f5c0-171">База данных-источник и база данных-получатель должны иметь один и тот же уровень обслуживания.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-171">Both primary and secondary databases are required to have the same service tier.</span></span> <span data-ttu-id="8f5c0-172">Эта конфигурация не рекомендуется для приложений с высокой интенсивностью записи в базы данных, так как увеличение задержки репликации повышает риск потери значительного объема данных после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-172">This option is not recommended for applications with high database write activity because the increased replication lag increases the risk of substantial data loss after a failover.</span></span> <span data-ttu-id="8f5c0-173">Кроме того, после отработки отказа производительность приложения будет снижена, пока новая база данных-источник не будет обновлена до более высокого уровня производительности.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-173">In addition, after failover the application’s performance is impacted until the new primary is upgraded to a higher performance level.</span></span> <span data-ttu-id="8f5c0-174">Диаграмма журнала операций ввода-вывода в процентах на портале Azure — это удобный способ оценить минимальный уровень производительности базы данных-получателя, необходимый для того, чтобы выдержать нагрузку репликации.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-174">The log IO percentage chart on Azure portal provides a good way to estimate the minimal performance level of the secondary that is required to sustain the replication load.</span></span> <span data-ttu-id="8f5c0-175">Например, если уровень базы данных-источника — P6 (1000 DTU) и процент операций ввода-вывода для нее равен 50 %, то уровень базы-данных получателя должен быть не менее P4 (500 DTU).</span><span class="sxs-lookup"><span data-stu-id="8f5c0-175">For example, if your Primary database is P6 (1000 DTU) and its log IO percent is 50% the secondary needs to be at least P4 (500 DTU).</span></span> <span data-ttu-id="8f5c0-176">Данные журнала операций ввода-вывода также можно получить с помощью представления базы данных [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) или [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span><span class="sxs-lookup"><span data-stu-id="8f5c0-176">You can also retrieve the log IO data using [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) or [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) database views.</span></span>  <span data-ttu-id="8f5c0-177">Дополнительные сведения об уровнях производительности базы данных SQL см. в разделе [Параметры базы данных SQL и производительность](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="8f5c0-177">For more information on the SQL Database performance levels, see [SQL Database options and performance](sql-database-service-tiers.md).</span></span> 
* <span data-ttu-id="8f5c0-178">**Управляемые пользователем отработка отказа и восстановление размещения**: приложение или пользователь может в любой момент явным образом использовать базу данных-получатель в качестве базы данных-источника.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-178">**User-controlled failover and failback**: A secondary database can explicitly be switched to the primary role at any time by the application or the user.</span></span> <span data-ttu-id="8f5c0-179">Во время настоящего сбоя следует использовать параметр "unplanned", при котором база данных-получатель будет немедленно повышена до базы данных-источника.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-179">During a real outage the “unplanned” option should be used, which immediately promotes a secondary to be the primary.</span></span> <span data-ttu-id="8f5c0-180">Когда работоспособность вышедшей из строя базы данных-источника будет восстановлена и она снова станет доступной, система автоматически пометит ее как базу данных-получатель и синхронизирует с новой базой данных-источником.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-180">When the failed primary recovers and is available again, the system automatically marks the recovered primary as a secondary and bring it up-to-date with the new primary.</span></span> <span data-ttu-id="8f5c0-181">Из-за асинхронного характера репликации во время внеплановой отработки отказа может быть потерян небольшой объем данных, если сбой базы данных-источника произойдет до того, как будет выполнена репликация самых последних изменений в базу данных-получатель.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-181">Due to the asynchronous nature of replication, a small amount of data can be lost during unplanned failovers if a primary fails before it replicates the most recent changes to the secondary.</span></span> <span data-ttu-id="8f5c0-182">При сбое базы данных-источника с несколькими базами данных-получателями система автоматически перенастраивает отношения репликации и связывает оставшиеся базы данных-получатели с новой развернутой базой данных-источником без вмешательства пользователя.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-182">When a primary with multiple secondaries fails over, the system automatically reconfigures the replication relationships and links the remaining secondaries to the newly promoted primary without requiring any user intervention.</span></span> <span data-ttu-id="8f5c0-183">После устранения сбоя, который вызвал отработку отказа, желательно вернуть приложение в основной регион.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-183">After the outage that caused the failover is mitigated, it may be desirable to return the application to the primary region.</span></span> <span data-ttu-id="8f5c0-184">Для этого необходимо вызвать команду отработки отказа с параметром "planned".</span><span class="sxs-lookup"><span data-stu-id="8f5c0-184">To do that, the failover command should be invoked with the “planned” option.</span></span> 
* <span data-ttu-id="8f5c0-185">**Синхронизация учетных данных и правил брандмауэра**. Мы рекомендуем использовать [правила брандмауэра базы данных](sql-database-firewall-configure.md) для геореплицируемых баз данных. Таким образом, эти правила можно реплицировать в базу данных, чтобы все базы данных-получатели использовали те же правила брандмауэра, что и база данных-источник.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-185">**Keeping credentials and firewall rules in sync**: We recommend using [database firewall rules](sql-database-firewall-configure.md) for geo-replicated databases so these rules can be replicated with the database to ensure all secondary databases have the same firewall rules as the primary.</span></span> <span data-ttu-id="8f5c0-186">Такой подход избавляет клиентов от необходимости вручную настраивать и обслуживать правила брандмауэра на серверах, на которых размещаются как базы данных-источники, так и базы данных-получатели.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-186">This approach eliminates the need for customers to manually configure and maintain firewall rules on servers hosting both the primary and secondary databases.</span></span> <span data-ttu-id="8f5c0-187">Аналогично, в случае получения доступа к данным с помощью [пользователей автономной базы данных](sql-database-manage-logins.md) базы данных-источники и базы данных-получатели всегда используют одни и те же учетные данные. Поэтому при отработке отказа можно избежать нарушений в работе из-за несоответствия имен для входа или паролей.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-187">Similarly, using [contained database users](sql-database-manage-logins.md) for data access ensures both primary and secondary databases always have the same user credentials so during a failover, there is no disruptions due to mismatches with logins and passwords.</span></span> <span data-ttu-id="8f5c0-188">Благодаря добавлению [Azure Active Directory](../active-directory/active-directory-whatis.md) клиенты могут управлять доступом пользователей к базам данных-источникам и базам данных-получателям, и им не нужно управлять учетными данными для баз данных.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-188">With the addition of [Azure Active Directory](../active-directory/active-directory-whatis.md), customers can manage user access to both primary and secondary databases and eliminating the need for managing credentials in databases altogether.</span></span>

## <a name="auto-failover-group-capabilities"></a><span data-ttu-id="8f5c0-189">Возможности группы автоматической отработки отказа</span><span class="sxs-lookup"><span data-stu-id="8f5c0-189">Auto-failover group capabilities</span></span>

<span data-ttu-id="8f5c0-190">Группы автоматической отработки отказа обеспечивают расширенную абстракцию активной георепликации за счет поддержки репликации на уровне группы и автоматической отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-190">Auto-failover groups feature provides a powerful abstraction of active geo-replication by supporting group level replication and automatic failover.</span></span> <span data-ttu-id="8f5c0-191">Кроме того, отпадает необходимость в изменении строки подключения SQL после отработки отказа благодаря предоставлению дополнительных конечных точек прослушивателя.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-191">In addition, it removes the necessity to change the SQL connection string after failover by providing the additional listener end-points.</span></span> 

* <span data-ttu-id="8f5c0-192">**Группа отработки отказа.** Вы можете создать одну или несколько групп отработки отказа между двумя серверами в различных регионах (для основного сервера и сервера-получателя).</span><span class="sxs-lookup"><span data-stu-id="8f5c0-192">**Failover group**: One or many failover groups can be created between two servers in different regions (primary and secondary servers).</span></span> <span data-ttu-id="8f5c0-193">Каждая группа может содержать одну или несколько баз данных, которые восстанавливаются единым блоком в случае, когда все или часть баз данных-источников становятся недоступными из-за сбоя в основном регионе.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-193">Each group can include one or several databases that are recovered as a unit in case all or some primary databases become unavailable due to an outage in the primary region.</span></span>  
* <span data-ttu-id="8f5c0-194">**Основной сервер.** Сервер, на котором размещаются базы данных-источники в группе отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-194">**Primary server**: A server that hosts the primary databases in the failover group.</span></span>
* <span data-ttu-id="8f5c0-195">**Сервер-получатель.** Сервер, на котором размещаются базы данных-получатели в группе отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-195">**Secondary server**: A server that hosts the secondary databases in the failover group.</span></span> <span data-ttu-id="8f5c0-196">Сервер-получатель не может находиться в том же регионе, что и основной сервер.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-196">The secondary server cannot be in the same region as the primary server.</span></span>
* <span data-ttu-id="8f5c0-197">**Добавление баз данных в группу отработки отказа.** Вы можете разместить несколько баз данных на сервере или в эластичном пуле в одну группу отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-197">**Adding databases to failover group**: You can put several databases within a server or within an elastic pool into the same failover group.</span></span> <span data-ttu-id="8f5c0-198">Если вы добавите автономную базу данных в группу, она автоматически создаст базу данных-получатель, используя тот же выпуск и уровень производительности.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-198">If you add a standalone database to the group, it automatically creates a secondary database using the same edition and performance level.</span></span> <span data-ttu-id="8f5c0-199">Если база данных-источник расположена в эластичном пуле, в нем автоматически создается база данных-получатель с тем же именем.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-199">If the primary database is in an elastic pool, the secondary is automatically created in the elastic pool with the same name.</span></span> <span data-ttu-id="8f5c0-200">Если вы добавите базу данных, у которой уже есть база данных-получатель на сервере-получателе, эта георепликация наследуется группой.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-200">If you add a database that already has a secondary database in the secondary server, that geo-replication is inherited by the group.</span></span>

   > [!NOTE]
   > <span data-ttu-id="8f5c0-201">Если вы добавите базу данных, у которой уже есть база данных-получатель на сервере, который не является частью группы отработки отказа, на этом сервере-получателе будет создана новая база данных-получатель.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-201">When adding a database that already has a secondary database in a server that is not part of the failover group, a new secondary is created in the secondary server.</span></span> 
   >

* <span data-ttu-id="8f5c0-202">**Прослушиватель чтения и записи для группы отработки отказа.** Это запись DNS CNAME в формате **&lt;имя_группы_отработки_отказа&gt;.database.windows.net**, которая указывает на текущий URL-адрес основного сервера.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-202">**Failover group read-write listener**: A DNS CNAME record formed as **&lt;failover-group-name&gt;.database.windows.net** that points to the current primary server URL.</span></span> <span data-ttu-id="8f5c0-203">Она позволяет приложениям SQL для чтения и записи прозрачно повторно подключиться к базе данных-источнику, когда эта база данных изменяется после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-203">It allows the read-write SQL applications to transparently reconnect to the primary database when the primary changes after failover.</span></span> 
* <span data-ttu-id="8f5c0-204">**Прослушиватель только для чтения для группы отработки отказа.** Это запись DNS CNAME в формате **&lt;имя_группы_отработки_отказа&gt;.secondary.database.windows.net**, которая указывает на URL-адрес сервера-получателя.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-204">**Failover group read-only listener**: A DNS CNAME record formed as **&lt;failover-group-name&gt;.secondary.database.windows.net** that points to the secondary server’s URL.</span></span> <span data-ttu-id="8f5c0-205">Она позволяет приложениям SQL только для чтения прозрачно подключиться к базе данных-получателю с помощью специальных правил балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-205">It allows the read-only SQL applications to transparently connect to the secondary database using the specified load-balancing rules.</span></span> <span data-ttu-id="8f5c0-206">При необходимости вы можете указать, хотите ли вы, чтобы трафик только для чтения автоматически перенаправлялся к основному серверу, если сервер-получатель недоступен.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-206">Optionally you can specify if you want the read-only traffic to be automatically re-directed to the primary server when the secondary server is not available.</span></span>
* <span data-ttu-id="8f5c0-207">**Политика автоматической отработки отказа.** По умолчанию группа отработки отказа настроена с помощью политики автоматической отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-207">**Automatic failover policy**: By default, the failover group is configured with an automatic failover policy.</span></span> <span data-ttu-id="8f5c0-208">Система запускает отработку отказа сразу же после обнаружения сбоя.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-208">The system triggers failover as soon as the failure is detected.</span></span> <span data-ttu-id="8f5c0-209">Если вы хотите управлять рабочим процессом отработки отказа из приложения, вы можете отключить автоматическую отработку отказа.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-209">If you want to control the failover workflow from the application, you can turn off automatic failover.</span></span> 
* <span data-ttu-id="8f5c0-210">**Отработка отказа вручную.** Вы можете запустить отработку отказа вручную в любое время, независимо от настройки автоматической отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-210">**Manual failover**: You can initiate failover manually at any time regardless of the automatic failover configuration.</span></span> <span data-ttu-id="8f5c0-211">Если политика автоматической отработки отказа не настроена, для восстановления баз данных в группе отработки отказа требуется отработка отказа вручную.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-211">If automatic failover policy is not configured manual failover is required to recover databases in the failover group.</span></span> <span data-ttu-id="8f5c0-212">Вы можете запустить принудительную отработку отказа или адаптированную (с полной синхронизацией данных).</span><span class="sxs-lookup"><span data-stu-id="8f5c0-212">You can initiate forced or friendly failover (with full data synchronization).</span></span> <span data-ttu-id="8f5c0-213">Адаптированная отработка отказа может использоваться для перемещения активного сервера в основной регион.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-213">The latter could be used to relocate the active server to the primary region.</span></span> <span data-ttu-id="8f5c0-214">После завершения отработки отказа записи DNS автоматически обновляются для установления подключения к нужному серверу.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-214">When failover is completed the DNS records are automatically updated to ensure connectivity to the correct server.</span></span>
* <span data-ttu-id="8f5c0-215">**Льготный период с потерей данных.** Так как база данных-источник и база данных-получатель синхронизированы с помощью асинхронной репликации, отработка отказа может привести к потере данных.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-215">**Grace period with data loss**: Because the primary and secondary databases are synchronized using asynchronous replication the failover may result in data loss.</span></span> <span data-ttu-id="8f5c0-216">Вы можете настроить политику автоматической отработки отказа, чтобы представить устойчивость приложения к потере данных.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-216">You can customize the automatic failover policy to reflect your application’s tolerance to data loss.</span></span> <span data-ttu-id="8f5c0-217">Настраивая параметр **GracePeriodWithDataLossHours**, вы можете управлять продолжительностью периода ожидания системы перед последующим запуском отработки отказа, которая, вероятнее всего, приведет к потере данных.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-217">By configuring **GracePeriodWithDataLossHours**, you can control how long the system waits before initiating the failover that is likely to result data loss.</span></span> 

   > [!NOTE]
   > <span data-ttu-id="8f5c0-218">Когда система обнаружит, что базы данных в группе все еще работают (например, когда сбой повлиял только на уровень управления службы), она немедленно запустит отработку отказа с полной синхронизацией данных (адаптированную отработку отказа), несмотря на значение, заданное для параметра **GracePeriodWithDataLossHours**.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-218">When system detects that the databases in the group are still online (for example, the outage only impacted the service control plane), it immediately activates the failover with full data synchronization (friendly failover) regardless of the value set by **GracePeriodWithDataLossHours**.</span></span> <span data-ttu-id="8f5c0-219">Это поведение гарантирует, что во время восстановления не произойдет потеря данных.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-219">This behavior ensures that there is no data loss during the recovery.</span></span> <span data-ttu-id="8f5c0-220">Этот льготный период актуален, только если адаптированная отработка отказа недоступна.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-220">The grace period takes effect only when a friendly failover is not possible.</span></span> <span data-ttu-id="8f5c0-221">Если же сбой удалось устранить до истечения срока действия льготного периода, отработка отказа не будет активирована.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-221">If the outage is mitigated before the grace period expires, the failover is not activated.</span></span>
   >

* <span data-ttu-id="8f5c0-222">**Несколько групп отработки отказа.** Вы можете настроить несколько групп отработки отказа для одной пары серверов, чтобы управлять масштабом отработок отказа.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-222">**Multiple failover groups**: You can configure multiple failover groups for the same pair of servers to control the scale of failovers.</span></span> <span data-ttu-id="8f5c0-223">Каждая группа выполняет отработку отказа независимо от других групп.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-223">Each group fails over independently.</span></span> <span data-ttu-id="8f5c0-224">Если ваше мультитенантное приложение использует эластичные пулы, вы можете воспользоваться этой возможностью, чтобы объединить базу данных-источник и базу данных-получатель в каждом пуле.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-224">If your multi-tenant application uses elastic pools, you can use this capability to mix primary and secondary databases in each pool.</span></span> <span data-ttu-id="8f5c0-225">Таким образом вы сможете снизить последствия сбоя для половины клиентов.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-225">This way you can reduce the impact of an outage to only half of the tenants.</span></span>

## <a name="best-practices-of-building-highly-available-service"></a><span data-ttu-id="8f5c0-226">Рекомендации по созданию службы высокой доступности</span><span class="sxs-lookup"><span data-stu-id="8f5c0-226">Best practices of building highly available service</span></span>

<span data-ttu-id="8f5c0-227">Для создания службы высокой доступности, которая использует базу данных SQL Azure, клиентам следует придерживаться следующих рекомендаций:</span><span class="sxs-lookup"><span data-stu-id="8f5c0-227">To build a highly available service that uses Azure SQL database the customers should follow these guidelines:</span></span>
- <span data-ttu-id="8f5c0-228">**Использование группы отработки отказа.** Вы можете создать одну или несколько групп отработки отказа между двумя серверами (источником и получателем) в разных регионах.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-228">**Use failover group**: One or many failover groups can be created between two servers in different regions (primary and secondary servers).</span></span> <span data-ttu-id="8f5c0-229">Каждая группа может содержать одну или несколько баз данных, которые восстанавливаются единым блоком в случае, когда все или часть баз данных-источников становятся недоступными из-за сбоя в основном регионе.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-229">Each group can include one or several databases that are recovered as a unit in case all or some primary databases become unavailable due to an outage in the primary region.</span></span> <span data-ttu-id="8f5c0-230">Группа отработки отказа создает базу данных-получатель в дополнительном географическом регионе с таким же целевым уровнем служб, который указан для базы данных-источника.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-230">The failover group creates geo-secondary database with the same service objective as the primary.</span></span> <span data-ttu-id="8f5c0-231">При добавлении существующей связи георепликации к группе отработки отказа убедитесь, что база данных-получатель геореплицируемых данных настроена с тем же целевым уровнем служб, что и база данных-источник.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-231">If you add an existing geo-replication relationship to the failover group make sure the geo-secondary is configured with the same service level objective as the primary.</span></span>
- <span data-ttu-id="8f5c0-232">**Использование прослушивателя чтения и записи для рабочей нагрузки OLTP.** При выполнении операций OLTP в качестве URL-адреса сервера будет использоваться значение **&lt;имя_группы_отработки_отказа&gt;.database.windows.net**, чтобы все подключения автоматически перенаправлялись на сервер-источник.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-232">**Use read-write listener for OLTP workload**: When performing OLTP operations use **&lt;failover-group-name&gt;.database.windows.net** as the server URL and the connections will be automatically directed to the primary.</span></span> <span data-ttu-id="8f5c0-233">Этот URL-адрес не будет изменяться после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-233">This URL will not change after the failover.</span></span>  
<span data-ttu-id="8f5c0-234">Обратите внимание, что отработка отказа включает обновление DNS-записи, поэтому клиентские подключения будут перенаправляться на новый сервер-источник только после обновления кэша DNS на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-234">Note the failover involves updating the DNS record so the client connections will be redirected to the new primary only after the client DNS cache is refreshed.</span></span>
- <span data-ttu-id="8f5c0-235">**Использование прослушивателя только для чтения для рабочей нагрузки только для чтения.** Если вы используете логически изолированную рабочую нагрузку в режиме только для чтения, устойчивую к некоторым задержкам в обновлении данных, в приложении можно использовать базу данных-получатель.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-235">**Use read-only listener for read-only workload**: If you have a logically isolated read-only workload that is tolerant to certain staleness of data, you can use the secondary database in the application.</span></span> <span data-ttu-id="8f5c0-236">Для сеансов с доступом только для чтения в качестве URL-адреса сервера используется значение **&lt;имя_группы_отработки_отказа&gt;.secondary.database.windows.net**, чтобы подключение автоматически перенаправлялось на сервер-получатель.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-236">For read-only sessions use **&lt;failover-group-name&gt;.secondary.database.windows.net** as the server URL and the connection will be automatically directed to the secondary.</span></span> <span data-ttu-id="8f5c0-237">Кроме того, мы рекомендуем указать режим только для чтения прямо в строке подключения, добавив аргумент **ApplicationIntent=ReadOnly**.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-237">It is also recommended that you indicate in connection string read intent by using **ApplicationIntent=ReadOnly**.</span></span> 
- <span data-ttu-id="8f5c0-238">**Будьте готовы к снижению производительности.** Решение отработки отказа SQL не зависит от остальной части приложения или других используемых служб.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-238">**Be prepared for perf degradation**: SQL failover decision is independent from the rest of the application or other services used.</span></span> <span data-ttu-id="8f5c0-239">Приложение может смешаться с некоторыми компонентами в одном регионе и с некоторыми в другом.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-239">The application may be “mixed” with some components in one region and some in another.</span></span> <span data-ttu-id="8f5c0-240">Чтобы избежать снижения производительности, обеспечьте избыточное развертывание приложения в регионе аварийного восстановления и следуйте рекомендациям в этой статье.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-240">To avoid the degradation, ensure the redundant application deployment in the DR region and follow the guidelines in this article.</span></span>  
<span data-ttu-id="8f5c0-241">Обратите внимание, что приложение в регионе аварийного восстановления не требует использования другой строки подключения.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-241">Note the application in the DR region does not have to use a different connection string.</span></span>  
- <span data-ttu-id="8f5c0-242">**Подготовка к потере данных.** Если обнаруживается сбой и у нас нет оснований полагать, что произошла потеря данных, SQL автоматически активирует отработку отказа с чтением и записью.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-242">**Prepare for data loss**: If an outage is detected, SQL automatically triggers read-write failover if there is zero data loss to the best of our knowledge.</span></span> <span data-ttu-id="8f5c0-243">В противном случае он ожидает в течение периода, указанного в **GracePeriodWithDataLossHours**.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-243">Otherwise, it waits for the period you specified by **GracePeriodWithDataLossHours**.</span></span> <span data-ttu-id="8f5c0-244">Если вы указали параметр **GracePeriodWithDataLossHours**, будьте готовы к потере данных.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-244">If you specified **GracePeriodWithDataLossHours**, be prepared for data loss.</span></span> <span data-ttu-id="8f5c0-245">Во время сбоев Azure, как правило, повышает доступность.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-245">In general, during outages, Azure favors availability.</span></span> <span data-ttu-id="8f5c0-246">Если вы не можете позволить себе потерю данных, установите для параметра **GracePeriodWithDataLossHours** достаточно большое количество времени, например 24 часа.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-246">If you cannot afford data loss, make sure to set **GracePeriodWithDataLossHours** to a sufficiently large number, such as 24 hours.</span></span> 


## <a name="upgrading-or-downgrading-a-primary-database"></a><span data-ttu-id="8f5c0-247">Повышение или понижение уровня производительности базы данных-источника</span><span class="sxs-lookup"><span data-stu-id="8f5c0-247">Upgrading or downgrading a primary database</span></span>
<span data-ttu-id="8f5c0-248">Вы можете повышать или понижать уровень производительности базы данных-источника (в рамках одного уровня служб) без отключения каких-либо баз данных-получателей.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-248">You can upgrade or downgrade a primary database to a different performance level (within the same service tier) without disconnecting any secondary databases.</span></span> <span data-ttu-id="8f5c0-249">При повышении рекомендуется сначала повысить уровень производительности базы данных-получателя, а затем — уровень базы данных-источника.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-249">When upgrading, we recommend that you upgrade the secondary database first, and then upgrade the primary.</span></span> <span data-ttu-id="8f5c0-250">При понижении следует действовать в обратном порядке: сначала нужно понизить уровень производительности базы данных-источника, а после этого — базы данных-получателя.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-250">When downgrading, reverse the order: downgrade the primary first, and then downgrade the secondary.</span></span> <span data-ttu-id="8f5c0-251">Когда вы повышаете или понижаете базу данных до следующего уровня службы, особенно важно выполнять рекомендацию выше.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-251">When you upgrade or downgrade the database to a different service tier this recommendation is enforced.</span></span> 

> [!NOTE]
> <span data-ttu-id="8f5c0-252">Если вы создали базу данных-получатель как часть конфигурации группы отработки отказа, понижение ее уровня не рекомендуется.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-252">If you created secondary database as part of the failover group configuration it is not recommended to downgrade the secondary database.</span></span> <span data-ttu-id="8f5c0-253">Это необходимо, чтобы обеспечить достаточную емкость уровня данных для обработки регулярных рабочих нагрузок после активации отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-253">This is to ensure your data tier has sufficient capacity to process your regular workload after failover is activated.</span></span> 
>

## <a name="preventing-the-loss-of-critical-data"></a><span data-ttu-id="8f5c0-254">Предотвращение потери важных данных</span><span class="sxs-lookup"><span data-stu-id="8f5c0-254">Preventing the loss of critical data</span></span>
<span data-ttu-id="8f5c0-255">Из-за высокой задержки глобальных сетей непрерывная копия использует механизм асинхронной репликации.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-255">Due to the high latency of wide area networks, continuous copy uses an asynchronous replication mechanism.</span></span> <span data-ttu-id="8f5c0-256">Ввиду асинхронной репликации потеря данных в случае сбоя неизбежна.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-256">Asynchronous replication makes some data loss unavoidable if a failure occurs.</span></span> <span data-ttu-id="8f5c0-257">Тем не менее для некоторых приложений терять данные недопустимо.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-257">However, some applications may require no data loss.</span></span> <span data-ttu-id="8f5c0-258">Чтобы защитить эти критические обновления, разработчик приложения сразу же после фиксации транзакции может вызывать системную процедуру [sp_wait_for_database_copy_sync](https://msdn.microsoft.com/library/dn467644.aspx).</span><span class="sxs-lookup"><span data-stu-id="8f5c0-258">To protect these critical updates, an application developer can call the [sp_wait_for_database_copy_sync](https://msdn.microsoft.com/library/dn467644.aspx) system procedure immediately after committing the transaction.</span></span> <span data-ttu-id="8f5c0-259">Вызов **sp_wait_for_database_copy_sync** блокирует вызывающий поток до передачи последней зафиксированной транзакции в базе данных-получателе.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-259">Calling **sp_wait_for_database_copy_sync** blocks the calling thread until the last committed transaction has been transmitted to the secondary database.</span></span> <span data-ttu-id="8f5c0-260">Но вызов не дожидается воспроизведения и фиксации переданных транзакций в базе данных-получателе.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-260">However, it does not wait for the transmitted transactions to be replayed and committed on the secondary.</span></span> <span data-ttu-id="8f5c0-261">**sp_wait_for_database_copy_sync** ограничена конкретной связью непрерывной копии.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-261">**sp_wait_for_database_copy_sync** is scoped to a specific continuous copy link.</span></span> <span data-ttu-id="8f5c0-262">Эту процедуру может вызвать любой пользователь с правами подключения к базе данных-источнику.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-262">Any user with the connection rights to the primary database can call this procedure.</span></span>

> [!NOTE]
> <span data-ttu-id="8f5c0-263">Процедура **sp_wait_for_database_copy_sync** предотвратит потерю данных после отработки отказа, но не гарантирует полную синхронизацию для доступа на чтение.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-263">**sp_wait_for_database_copy_sync** will prevent data loss after failover, but it will not guarantee full synchronization for read access.</span></span> <span data-ttu-id="8f5c0-264">Вызов процедуры **sp_wait_for_database_copy_sync** может привести к значительной задержке, которая будет зависеть от размера журнала транзакций во время вызова.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-264">The delay caused by a **sp_wait_for_database_copy_sync** procedure call can be significant and depends on the size of the transaction log at the time of the call.</span></span> 
> 

## <a name="programmatically-managing-failover-groups-and-active-geo-replication"></a><span data-ttu-id="8f5c0-265">Программное управление группами отработки отказа и активной георепликацией</span><span class="sxs-lookup"><span data-stu-id="8f5c0-265">Programmatically managing failover groups and active geo-replication</span></span>
<span data-ttu-id="8f5c0-266">Как уже говорилось ранее, группами автоматической отработки отказа (в предварительной версии) и активной георепликацией можно также управлять программно с помощью Azure PowerShell и REST API.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-266">As discussed previously, auto-failover groups (in-preview) and active geo-replication can also be managed programmatically using Azure PowerShell and the REST API.</span></span> <span data-ttu-id="8f5c0-267">В приведенных ниже таблицах описан доступный для этого набор команд.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-267">The following tables describe the set of commands available.</span></span>

<span data-ttu-id="8f5c0-268">**API Azure Resource Manager и безопасность на основе ролей.** Активная георепликация включает в себя набор API-интерфейсов Azure Resource Manager для управления, в том числе [REST API базы данных SQL Azure](https://docs.microsoft.com/rest/api/sql/) и [командлеты Azure PowerShell](https://docs.microsoft.com/powershell/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="8f5c0-268">**Azure Resource Manager API and role-based security**: Active geo-replication includes a set of Azure Resource Manager APIs for management, including the [Azure SQL Database REST API](https://docs.microsoft.com/rest/api/sql/) and [Azure PowerShell cmdlets](https://docs.microsoft.com/powershell/azure/overview).</span></span> <span data-ttu-id="8f5c0-269">Эти интерфейсы API требуют использования групп ресурсов и поддерживают безопасность на основе ролей (RBAC).</span><span class="sxs-lookup"><span data-stu-id="8f5c0-269">These APIs require the use of resource groups and support role-based security (RBAC).</span></span> <span data-ttu-id="8f5c0-270">Дополнительные сведения о том, как реализовать контроль доступа на основе ролей, см. в статье [Использование управления доступом на основе ролей для контроля доступа к ресурсам в подписке Azure](../active-directory/role-based-access-control-what-is.md).</span><span class="sxs-lookup"><span data-stu-id="8f5c0-270">For more information on how to implement access roles, see [Azure Role-Based Access Control](../active-directory/role-based-access-control-what-is.md).</span></span>

> [!NOTE]
> <span data-ttu-id="8f5c0-271">Многие новые функции активной георепликации поддерживаются только в [REST API SQL Azure](../azure-resource-manager/resource-group-overview.md) и [командлетах PowerShell базы данных SQL Azure](https://msdn.microsoft.com/library/azure/mt163571.aspx) на основе [Azure Resource Manager](https://msdn.microsoft.com/library/azure/mt574084.aspx).</span><span class="sxs-lookup"><span data-stu-id="8f5c0-271">Many new features of active geo-replication are only supported using [Azure Resource Manager](../azure-resource-manager/resource-group-overview.md) based [Azure SQL REST API](https://msdn.microsoft.com/library/azure/mt163571.aspx) and [Azure SQL Database PowerShell cmdlets](https://msdn.microsoft.com/library/azure/mt574084.aspx).</span></span> <span data-ttu-id="8f5c0-272">[Классический REST API](https://msdn.microsoft.com/library/azure/dn505719.aspx) и [командлеты базы данных SQL Azure (классическая модель)](https://msdn.microsoft.com/library/azure/dn546723.aspx) поддерживаются для обратной совместимости, поэтому рекомендуется использовать интерфейсы API на основе Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-272">The [(classic) REST API](https://msdn.microsoft.com/library/azure/dn505719.aspx) and [Azure SQL Database (classic) cmdlets](https://msdn.microsoft.com/library/azure/dn546723.aspx) are supported for backward compatibility so using the Azure Resource Manager-based APIs are recommended.</span></span> 
> 

## <a name="manage-sql-database-failover-using-using-transact-sql"></a><span data-ttu-id="8f5c0-273">Управление SQL базы данных отработки отказа с помощью с помощью Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="8f5c0-273">Manage SQL database failover using using Transact-SQL</span></span>

| <span data-ttu-id="8f5c0-274">Команда</span><span class="sxs-lookup"><span data-stu-id="8f5c0-274">Command</span></span> | <span data-ttu-id="8f5c0-275">Описание</span><span class="sxs-lookup"><span data-stu-id="8f5c0-275">Description</span></span> |
| --- | --- |
| [<span data-ttu-id="8f5c0-276">ALTER DATABASE (база данных SQL Azure)</span><span class="sxs-lookup"><span data-stu-id="8f5c0-276">ALTER DATABASE (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/mt574871.aspx) |<span data-ttu-id="8f5c0-277">Используйте аргумент ADD SECONDARY ON SERVER, чтобы создать базу данных-получатель для существующей базы данных и начать репликацию данных.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-277">Use ADD SECONDARY ON SERVER argument to create a secondary database for an existing database and starts data replication</span></span> |
| [<span data-ttu-id="8f5c0-278">ALTER DATABASE (база данных SQL Azure)</span><span class="sxs-lookup"><span data-stu-id="8f5c0-278">ALTER DATABASE (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/mt574871.aspx) |<span data-ttu-id="8f5c0-279">Используйте аргумент FAILOVER или FORCE_FAILOVER_ALLOW_DATA_LOSS, чтобы задать базу данных-получатель в качестве базы данных-источника для запуска отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-279">Use FAILOVER or FORCE_FAILOVER_ALLOW_DATA_LOSS to switch a secondary database to be primary to initiate failover</span></span> |
| [<span data-ttu-id="8f5c0-280">ALTER DATABASE (база данных SQL Azure)</span><span class="sxs-lookup"><span data-stu-id="8f5c0-280">ALTER DATABASE (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/mt574871.aspx) |<span data-ttu-id="8f5c0-281">Используйте аргумент REMOVE SECONDARY ON SERVER, чтобы завершить репликацию данных между базой данных SQL и указанной базой данных-получателем.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-281">Use REMOVE SECONDARY ON SERVER to terminate a data replication between a SQL Database and the specified secondary database.</span></span> |
| [<span data-ttu-id="8f5c0-282">sys.geo_replication_links (база данных SQL Azure)</span><span class="sxs-lookup"><span data-stu-id="8f5c0-282">sys.geo_replication_links (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/mt575501.aspx) |<span data-ttu-id="8f5c0-283">Возвращает сведения о всех существующих связях репликации для каждой базы данных на логическом сервере Базы данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-283">Returns information about all existing replication links for each database on the Azure SQL Database logical server.</span></span> |
| [<span data-ttu-id="8f5c0-284">sys.dm_geo_replication_link_status (база данных SQL Azure)</span><span class="sxs-lookup"><span data-stu-id="8f5c0-284">sys.dm_geo_replication_link_status (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/mt575504.aspx) |<span data-ttu-id="8f5c0-285">Получает время последней репликации, задержку при последней репликации и другие сведения о связи репликации для заданной базы данных SQL.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-285">Gets the last replication time, last replication lag, and other information about the replication link for a given SQL database.</span></span> |
| [<span data-ttu-id="8f5c0-286">sys.dm_operation_status (база данных SQL Azure)</span><span class="sxs-lookup"><span data-stu-id="8f5c0-286">sys.dm_operation_status (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/dn270022.aspx) |<span data-ttu-id="8f5c0-287">Показывает состояние всех операций с базой данных, включая состояние связей репликации.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-287">Shows the status for all database operations including the status of the replication links.</span></span> |
| [<span data-ttu-id="8f5c0-288">sp_wait_for_database_copy_sync (база данных SQL Azure)</span><span class="sxs-lookup"><span data-stu-id="8f5c0-288">sp_wait_for_database_copy_sync (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/dn467644.aspx) |<span data-ttu-id="8f5c0-289">Указывает приложению ждать, пока все зафиксированные транзакции не будут реплицированы и подтверждены активной базой данных-получателем.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-289">causes the application to wait until all committed transactions are replicated and acknowledged by the active secondary database.</span></span> |
|  | |

## <a name="manage-sql-database-failover-using-using-powershell"></a><span data-ttu-id="8f5c0-290">Управление SQL базы данных отработки отказа с помощью с помощью PowerShell</span><span class="sxs-lookup"><span data-stu-id="8f5c0-290">Manage SQL database failover using using PowerShell</span></span>

| <span data-ttu-id="8f5c0-291">Командлет</span><span class="sxs-lookup"><span data-stu-id="8f5c0-291">Cmdlet</span></span> | <span data-ttu-id="8f5c0-292">Описание</span><span class="sxs-lookup"><span data-stu-id="8f5c0-292">Description</span></span> |
| --- | --- |
| [<span data-ttu-id="8f5c0-293">Get-AzureRmSqlDatabase</span><span class="sxs-lookup"><span data-stu-id="8f5c0-293">Get-AzureRmSqlDatabase</span></span>](/powershell/module/azurerm.sql/get-azurermsqldatabase) |<span data-ttu-id="8f5c0-294">Получает одну или несколько баз данных.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-294">Gets one or more databases.</span></span> |
| [<span data-ttu-id="8f5c0-295">New-AzureRmSqlDatabaseSecondary</span><span class="sxs-lookup"><span data-stu-id="8f5c0-295">New-AzureRmSqlDatabaseSecondary</span></span>](/powershell/module/azurerm.sql/new-azurermsqldatabasesecondary) |<span data-ttu-id="8f5c0-296">Создает базу данных-получатель для существующей базы данных и начинает репликацию данных.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-296">Creates a secondary database for an existing database and starts data replication.</span></span> |
| [<span data-ttu-id="8f5c0-297">Set-AzureRmSqlDatabaseSecondary</span><span class="sxs-lookup"><span data-stu-id="8f5c0-297">Set-AzureRmSqlDatabaseSecondary</span></span>](/powershell/module/azurerm.sql/set-azurermsqldatabasesecondary) |<span data-ttu-id="8f5c0-298">Преобразует базу данных-получатель в базу данных-источник для запуска отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-298">Switches a secondary database to be primary to initiate failover.</span></span> |
| [<span data-ttu-id="8f5c0-299">Remove-AzureRmSqlDatabaseSecondary</span><span class="sxs-lookup"><span data-stu-id="8f5c0-299">Remove-AzureRmSqlDatabaseSecondary</span></span>](/powershell/module/azurerm.sql/remove-azurermsqldatabasesecondary) |<span data-ttu-id="8f5c0-300">Завершает репликацию данных между базой данных SQL и указанной базой данных-получателем.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-300">Terminates data replication between a SQL Database and the specified secondary database.</span></span> |
| [<span data-ttu-id="8f5c0-301">Get-AzureRmSqlDatabaseReplicationLink</span><span class="sxs-lookup"><span data-stu-id="8f5c0-301">Get-AzureRmSqlDatabaseReplicationLink</span></span>](/powershell/module/azurerm.sql/get-azurermsqldatabasereplicationlink) |<span data-ttu-id="8f5c0-302">Получает связи георепликации между базой данных SQL Azure и группой ресурсов или SQL Server.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-302">Gets the geo-replication links between an Azure SQL Database and a resource group or SQL Server.</span></span> |
| [<span data-ttu-id="8f5c0-303">New-AzureRmSqlDatabaseFailoverGroup</span><span class="sxs-lookup"><span data-stu-id="8f5c0-303">New-AzureRmSqlDatabaseFailoverGroup</span></span>](/powershell/module/azurerm.sql/set-azurermsqldatabasefailovergroup) |   <span data-ttu-id="8f5c0-304">Создает группу отработки отказа и регистрирует ее на основном сервере и сервере-получателе.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-304">This command creates a failover group and registers it on both primary and secondary servers</span></span>|
| [<span data-ttu-id="8f5c0-305">Remove-AzureRmSqlDatabaseFailoverGroup</span><span class="sxs-lookup"><span data-stu-id="8f5c0-305">Remove-AzureRmSqlDatabaseFailoverGroup</span></span>](/powershell/module/azurerm.sql/remove-azurermsqldatabasefailovergroup) | <span data-ttu-id="8f5c0-306">Удаляет группу отработки отказа с сервера, а также удаляет все входящие в нее базы данных-получатели.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-306">Removes the failover group from the server and deletes all secondary databases included the group</span></span> |
| [<span data-ttu-id="8f5c0-307">Get-AzureRmSqlDatabaseFailoverGroup</span><span class="sxs-lookup"><span data-stu-id="8f5c0-307">Get-AzureRmSqlDatabaseFailoverGroup</span></span>](/powershell/module/azurerm.sql/get-azurermsqldatabasefailovergroup) | <span data-ttu-id="8f5c0-308">Возвращает конфигурацию группы отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-308">Retrieves the failover group configuration</span></span> |
| [<span data-ttu-id="8f5c0-309">Set-AzureRmSqlDatabaseFailoverGroup</span><span class="sxs-lookup"><span data-stu-id="8f5c0-309">Set-AzureRmSqlDatabaseFailoverGroup</span></span>](/powershell/module/azurerm.sql/set-azurermsqldatabasefailovergroup) |   <span data-ttu-id="8f5c0-310">Изменяет конфигурацию группы отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-310">Modifies the configuration of the failover group</span></span> |
| [<span data-ttu-id="8f5c0-311">Switch-AzureRMSqlDatabaseFailoverGroup</span><span class="sxs-lookup"><span data-stu-id="8f5c0-311">Switch-AzureRMSqlDatabaseFailoverGroup</span></span>](/powershell/module/azurerm.sql/switch-azurermsqldatabasefailovergroup) | <span data-ttu-id="8f5c0-312">Запускает отработку отказа группы отработки отказа на сервер-получатель.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-312">Triggers failover of the failover group to the secondary server</span></span> |
|  | |

> [!IMPORTANT]
> <span data-ttu-id="8f5c0-313">Дополнительные сведения о примерах сценариев см. в статьях [Настройка активной георепликации для отдельной базы данных SQL Azure с помощью PowerShell](scripts/sql-database-setup-geodr-and-failover-database-powershell.md), [Настройка активной георепликации для базы данных SQL Azure в составе пула с помощью PowerShell](scripts/sql-database-setup-geodr-and-failover-pool-powershell.md), а также [Use PowerShell to configure an active geo-replication failover group for a single Azure SQL database](scripts/sql-database-setup-geodr-failover-database-failover-group-powershell.md) (Использование PowerShell для настройки группы отработки отказа активной георепликации для отдельной базы данных SQL Azure (предварительная версия)).</span><span class="sxs-lookup"><span data-stu-id="8f5c0-313">For sample scripts, see [Configure and failover a single database using active geo-replication](scripts/sql-database-setup-geodr-and-failover-database-powershell.md), [Configure and failover a pooled database using active geo-replication](scripts/sql-database-setup-geodr-and-failover-pool-powershell.md), and  [Configure and failover a failover group for a single database (preview)](scripts/sql-database-setup-geodr-failover-database-failover-group-powershell.md.</span></span>
>

## <a name="manage-sql-database-failover-using-the-rest-api"></a><span data-ttu-id="8f5c0-314">Управление отработкой отказа базы данных SQL с помощью REST API</span><span class="sxs-lookup"><span data-stu-id="8f5c0-314">Manage SQL database failover using the REST API</span></span>
| <span data-ttu-id="8f5c0-315">API</span><span class="sxs-lookup"><span data-stu-id="8f5c0-315">API</span></span> | <span data-ttu-id="8f5c0-316">Описание</span><span class="sxs-lookup"><span data-stu-id="8f5c0-316">Description</span></span> |
| --- | --- |
| [<span data-ttu-id="8f5c0-317">Создание или обновление базы данных (createMode=Restore)</span><span class="sxs-lookup"><span data-stu-id="8f5c0-317">Create or Update Database (createMode=Restore)</span></span>](/rest/api/sql/Databases/CreateOrUpdate) |<span data-ttu-id="8f5c0-318">Создает, обновляет или восстанавливает базу данных-источник или базу данных-получатель.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-318">Creates, updates, or restores a primary or a secondary database.</span></span> |
| [<span data-ttu-id="8f5c0-319">Получение, создание или обновление состояния базы данных</span><span class="sxs-lookup"><span data-stu-id="8f5c0-319">Get Create or Update Database Status</span></span>](/rest/api/sql/Databases/CreateOrUpdate) |<span data-ttu-id="8f5c0-320">Возвращает состояние во время операции создания.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-320">Returns the status during a create operation.</span></span> |
| [<span data-ttu-id="8f5c0-321">Задание базы данных-получателя в качестве базы данных-источника (плановая отработка отказа)</span><span class="sxs-lookup"><span data-stu-id="8f5c0-321">Set Secondary Database as Primary (Planned Failover)</span></span>](https://docs.microsoft.com/rest/api/sql/replicationlinkss#ReplicationLinks_Failover) |<span data-ttu-id="8f5c0-322">Задает базу данных-источник реплики. Для этого выполняется отработка отказа из текущей базы данных-источника реплики.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-322">Sets which replica database is primary by failing over from the current primary replica database.</span></span> |
| [<span data-ttu-id="8f5c0-323">Задание базы данных-получателя в качестве базы данных-источника (внеплановая отработка отказа)</span><span class="sxs-lookup"><span data-stu-id="8f5c0-323">Set Secondary Database as Primary (Unplanned Failover)</span></span>](https://docs.microsoft.com/rest/api/sql/replicationlinks#ReplicationLinks_FailoverAllowDataLoss) |<span data-ttu-id="8f5c0-324">Задает базу данных-источник реплики. Для этого выполняется отработка отказа из текущей базы данных-источника реплики.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-324">Sets which replica database is primary by failing over from the current primary replica database.</span></span> <span data-ttu-id="8f5c0-325">Эта операция может привести к потере данных.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-325">This operation might result in data loss.</span></span> |
| [<span data-ttu-id="8f5c0-326">Получение связи репликации</span><span class="sxs-lookup"><span data-stu-id="8f5c0-326">Get Replication Link</span></span>](/rest/api/sql/replicationlinks/get) |<span data-ttu-id="8f5c0-327">Получает определенную связь репликации для заданной базы данных SQL, участвующей в партнерстве георепликации.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-327">Gets a specific replication link for a given SQL database in a geo-replication partnership.</span></span> <span data-ttu-id="8f5c0-328">Извлекает сведения, отображаемые в представлении каталога sys.geo_replication_links.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-328">It retrieves the information visible in the sys.geo_replication_links catalog view.</span></span> |
| <span data-ttu-id="8f5c0-329">[Replication Links - List By Database](/rest/api/sql/replicationlinks/listbydatabase) (Ссылки для репликации: вывод списка по базе данных)</span><span class="sxs-lookup"><span data-stu-id="8f5c0-329">[Replication Links - List By Database](/rest/api/sql/replicationlinks/listbydatabase)</span></span> | <span data-ttu-id="8f5c0-330">Получает все связи репликации для заданной базы данных SQL, участвующей в партнерстве георепликации.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-330">Gets all replication links for a given SQL database in a geo-replication partnership.</span></span> <span data-ttu-id="8f5c0-331">Извлекает сведения, отображаемые в представлении каталога sys.geo_replication_links.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-331">It retrieves the information visible in the sys.geo_replication_links catalog view.</span></span> |
| [<span data-ttu-id="8f5c0-332">Удаление связей репликации</span><span class="sxs-lookup"><span data-stu-id="8f5c0-332">Delete Replication Link</span></span>](/rest/api/sql/databases/delete) | <span data-ttu-id="8f5c0-333">Удаляет связь репликации базы данных.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-333">Deletes a database replication link.</span></span> <span data-ttu-id="8f5c0-334">Невозможно выполнить во время отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-334">Cannot be done during failover.</span></span> |
| <span data-ttu-id="8f5c0-335">[Создание или обновление групп отработки отказа]/rest/api/sql/failovergroups/createorupdate)</span><span class="sxs-lookup"><span data-stu-id="8f5c0-335">[Create or Update Failover Group]/rest/api/sql/failovergroups/createorupdate)</span></span> | <span data-ttu-id="8f5c0-336">Создает или обновляет группу отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-336">Creates or updates a failover group</span></span> |
| [<span data-ttu-id="8f5c0-337">Удаление группы отработки отказа</span><span class="sxs-lookup"><span data-stu-id="8f5c0-337">Delete Failover Group</span></span>](/rest/api/sql/failovergroups/delete) | <span data-ttu-id="8f5c0-338">Удаляет группу отработки отказа с сервера.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-338">Removes the failover group from the server</span></span> |
| [<span data-ttu-id="8f5c0-339">Плановая отработка отказа</span><span class="sxs-lookup"><span data-stu-id="8f5c0-339">Failover (Planned)</span></span>](/rest/api/sql/failovergroups/failover) | <span data-ttu-id="8f5c0-340">Выполняет отработку отказа из текущего основного сервера на этот сервер.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-340">Fails over from the current primary server to this server.</span></span> |
| [<span data-ttu-id="8f5c0-341">Принудительная отработка отказа (возможна потеря данных)</span><span class="sxs-lookup"><span data-stu-id="8f5c0-341">Force Failover Allow Data Loss</span></span>](/rest/api/sql/failovergroups/forcefailoverallowdataloss) |<span data-ttu-id="8f5c0-342">Выполняет отработку отказа из текущего основного сервера на этот сервер.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-342">ails over from the current primary server to this server.</span></span> <span data-ttu-id="8f5c0-343">Эта операция может привести к потере данных.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-343">This operation might result in data loss.</span></span> |
| [<span data-ttu-id="8f5c0-344">Получение группы отработки отказа</span><span class="sxs-lookup"><span data-stu-id="8f5c0-344">Get Failover Group</span></span>](/rest/api/sql/failovergroups/get) | <span data-ttu-id="8f5c0-345">Получает группу отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-345">Gets a failover group.</span></span> |
| [<span data-ttu-id="8f5c0-346">Вывод списка групп отработки отказа с фильтрацией по серверу</span><span class="sxs-lookup"><span data-stu-id="8f5c0-346">List Failover Groups By Server</span></span>](/rest/api/sql/failovergroups/listbyserver) | <span data-ttu-id="8f5c0-347">Перечисляет группы отработки отказа на сервере.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-347">Lists the failover groups in a server.</span></span> |
| [<span data-ttu-id="8f5c0-348">Обновление группы отработки отказа</span><span class="sxs-lookup"><span data-stu-id="8f5c0-348">Update Failover Group</span></span>](/rest/api/sql/failovergroups/update) | <span data-ttu-id="8f5c0-349">Обновляет группу отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="8f5c0-349">Updates a failover group.</span></span> |
|  | |

## <a name="next-steps"></a><span data-ttu-id="8f5c0-350">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="8f5c0-350">Next steps</span></span>
* <span data-ttu-id="8f5c0-351">Ознакомьтесь с примерами скриптов в следующих статьях:</span><span class="sxs-lookup"><span data-stu-id="8f5c0-351">For sample scripts, see:</span></span>
   - [<span data-ttu-id="8f5c0-352">Настройка активной георепликации для отдельной базы данных SQL Azure с помощью PowerShell</span><span class="sxs-lookup"><span data-stu-id="8f5c0-352">Configure and failover a single database using active geo-replication</span></span>](scripts/sql-database-setup-geodr-and-failover-database-powershell.md)
   - [<span data-ttu-id="8f5c0-353">Настройка активной георепликации для базы данных SQL Azure в составе пула с помощью PowerShell</span><span class="sxs-lookup"><span data-stu-id="8f5c0-353">Configure and failover a pooled database using active geo-replication</span></span>](scripts/sql-database-setup-geodr-and-failover-pool-powershell.md)
   - <span data-ttu-id="8f5c0-354">[Use PowerShell to configure an active geo-replication failover group for a single Azure SQL database](scripts/sql-database-setup-geodr-failover-database-failover-group-powershell.md) (Использование PowerShell для настройки группы отработки отказа активной георепликации для отдельной базы данных SQL Azure (предварительная версия)).</span><span class="sxs-lookup"><span data-stu-id="8f5c0-354">[Configure and failover a failover group for a single database (preview)](scripts/sql-database-setup-geodr-failover-database-failover-group-powershell.md)</span></span>
* <span data-ttu-id="8f5c0-355">Сведения об обеспечении непрерывности бизнес-процессов и возможные сценарии описаны в [обзоре непрерывности бизнес-процессов](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="8f5c0-355">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="8f5c0-356">Чтобы узнать об автоматически создаваемых резервных копиях базы данных SQL Azure, ознакомьтесь со статьей [Общие сведения об автоматическом резервном копировании базы данных SQL](sql-database-automated-backups.md).</span><span class="sxs-lookup"><span data-stu-id="8f5c0-356">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md).</span></span>
* <span data-ttu-id="8f5c0-357">Чтобы узнать об использовании автоматически создаваемых резервных копий для восстановления, ознакомьтесь с [восстановлением базы данных из резервных копий, инициируемых службой](sql-database-recovery-using-backups.md).</span><span class="sxs-lookup"><span data-stu-id="8f5c0-357">To learn about using automated backups for recovery, see [Restore a database from the service-initiated backups](sql-database-recovery-using-backups.md).</span></span>
* <span data-ttu-id="8f5c0-358">Дополнительные сведения о требованиях к проверке подлинности для новых сервера-источника и базы данных-источника см. в статье [Безопасность базы данных SQL после аварийного восстановления](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="8f5c0-358">To learn about authentication requirements for a new primary server and database, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>

