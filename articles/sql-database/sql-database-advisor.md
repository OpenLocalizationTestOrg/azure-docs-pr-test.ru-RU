---
title: "рекомендации aaaPerformance - базы данных SQL Azure | Документы Microsoft"
description: "Hello базы данных SQL Azure предоставляет рекомендации для баз данных SQL, можно повысить производительность текущего запроса."
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: monicar
ms.assetid: 1db441ff-58f5-45da-8d38-b54dc2aa6145
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-management
ms.date: 07/05/2017
ms.author: sstein
ms.openlocfilehash: 77db338a0a395aec78c9e02849ae5ba4f2d01680
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="performance-recommendations"></a><span data-ttu-id="c6a86-103">Рекомендации по производительности</span><span class="sxs-lookup"><span data-stu-id="c6a86-103">Performance recommendations</span></span>

<span data-ttu-id="c6a86-104">База данных SQL Azure узнает и адаптирует вместе с приложением и предоставляет настраиваемый рекомендации, позволяя toomaximize hello производительности баз данных SQL.</span><span class="sxs-lookup"><span data-stu-id="c6a86-104">Azure SQL Database learns and adapts with your application and provides customized recommendations enabling you toomaximize hello performance of your SQL databases.</span></span> <span data-ttu-id="c6a86-105">Производительность постоянно оценивается путем анализа журнала использования базы данных SQL.</span><span class="sxs-lookup"><span data-stu-id="c6a86-105">Your performance is continuously assessed by analyzing your SQL Database usage history.</span></span> <span data-ttu-id="c6a86-106">рекомендации Hello, основаны на шаблоне уникальный рабочей нагрузки базы данных и повысить его производительность.</span><span class="sxs-lookup"><span data-stu-id="c6a86-106">hello recommendations that are provided are based on a database unique workload pattern and help improve its performance.</span></span>

> [!NOTE]
> <span data-ttu-id="c6a86-107">Для применения рекомендаций мы советуем включить автоматическую настройку базы данных.</span><span class="sxs-lookup"><span data-stu-id="c6a86-107">Recommended way of using recommendations is by enabling ‘Automatic tuning’ on your database.</span></span> <span data-ttu-id="c6a86-108">Дополнительные сведения см. в разделе [Автоматическая настройка](sql-database-automatic-tuning.md).</span><span class="sxs-lookup"><span data-stu-id="c6a86-108">For details, see [Automatic tuning](sql-database-automatic-tuning.md).</span></span>
>

## <a name="create-index-recommendations"></a><span data-ttu-id="c6a86-109">Рекомендации по созданию индексов</span><span class="sxs-lookup"><span data-stu-id="c6a86-109">Create index recommendations</span></span>
<span data-ttu-id="c6a86-110">База данных SQL Azure постоянно отслеживает при выполнении запросов hello и идентифицирует hello индексы, которые может улучшить производительность hello.</span><span class="sxs-lookup"><span data-stu-id="c6a86-110">Azure SQL Database continuously monitors hello queries being executed and identifies hello indexes that could improve hello performance.</span></span> <span data-ttu-id="c6a86-111">После того, как система удостоверится в отсутствии определенного индекса, создается новая рекомендация **Создание индекса**.</span><span class="sxs-lookup"><span data-stu-id="c6a86-111">Once enough confidence is built that a certain index is missing, a new **Create index** recommendation will be created.</span></span> <span data-ttu-id="c6a86-112">В результате Azure достоверности сборки базы данных SQL путем оценки индекса hello прирост производительности до времени.</span><span class="sxs-lookup"><span data-stu-id="c6a86-112">Azure SQL Database builds confidence by estimating performance gain hello index would bring through time.</span></span> <span data-ttu-id="c6a86-113">В зависимости от hello Предполагаемый рост производительности рекомендации, классифицируются как высокий, средний или низкий.</span><span class="sxs-lookup"><span data-stu-id="c6a86-113">Depending on hello estimated performance gain, recommendations are categorized as High, Medium,  or Low.</span></span> 

<span data-ttu-id="c6a86-114">Индексы, созданные с помощью рекомендаций, всегда помечаются флагом auto_created.</span><span class="sxs-lookup"><span data-stu-id="c6a86-114">Indexes created using recommendations are always flagged as auto_created indexes.</span></span> <span data-ttu-id="c6a86-115">Узнать, какие индексы имеют флаг auto_created, можно, просмотрев представление sys.indexes.</span><span class="sxs-lookup"><span data-stu-id="c6a86-115">You can see which indexes are auto_created by looking at sys.indexes view.</span></span> <span data-ttu-id="c6a86-116">Автоматически созданные индексы не блокируют команды ALTER и RENAME.</span><span class="sxs-lookup"><span data-stu-id="c6a86-116">Auto created indexes don’t block ALTER/RENAME commands.</span></span> <span data-ttu-id="c6a86-117">При попытке toodrop hello столбец, который был автоматически создан индекс по нему hello команда передает и hello автоматически создать индекс удаляется также командой hello.</span><span class="sxs-lookup"><span data-stu-id="c6a86-117">If you try toodrop hello column that has an auto created index over it, hello command passes and hello auto created index is dropped with hello command as well.</span></span> <span data-ttu-id="c6a86-118">Обычные индексы заблокирует команду ALTER или ПЕРЕИМЕНУЙТЕ hello на индексированные столбцы.</span><span class="sxs-lookup"><span data-stu-id="c6a86-118">Regular indexes would block hello ALTER/RENAME command on columns that are indexed.</span></span>

<span data-ttu-id="c6a86-119">После создания hello рекомендация индекс применяется, база данных SQL Azure будет сравнить производительность запросов hello с hello базового уровня производительности.</span><span class="sxs-lookup"><span data-stu-id="c6a86-119">Once hello create index recommendation is applied, Azure SQL Database will compare performance of hello queries with hello baseline performance.</span></span> <span data-ttu-id="c6a86-120">Если новый индекс, обозначенных улучшения производительности hello, рекомендация будет отмечен как успешно, и влияние отчет будет доступен.</span><span class="sxs-lookup"><span data-stu-id="c6a86-120">If new index brought improvements in hello performance, recommendation will be flagged as successful and impact report will be available.</span></span> <span data-ttu-id="c6a86-121">В случае, если индекс hello не дают преимущества hello, он будет автоматически использоваться.</span><span class="sxs-lookup"><span data-stu-id="c6a86-121">In case hello index didn’t bring hello benefits, it will be automatically reverted.</span></span> <span data-ttu-id="c6a86-122">Таким образом база данных SQL Azure гарантирует, что используя рекомендации только улучшит производительность hello базы данных.</span><span class="sxs-lookup"><span data-stu-id="c6a86-122">This way Azure SQL Database ensures that using recommendations will only improve hello database performance.</span></span>

<span data-ttu-id="c6a86-123">Любой **создать индекс** рекомендация имеет пассивный политику, которая не позволит Применение рекомендаций hello, если использование DTU hello базы данных или пула было превышает 80% в последние 20 минут или если hello хранилища превышает 90% использования.</span><span class="sxs-lookup"><span data-stu-id="c6a86-123">Any **Create index** recommendation has a back off policy that won’t allow applying hello recommendation if hello database or pool DTU usage was above 80% in last 20 minutes or if hello storage is above 90% of usage.</span></span> <span data-ttu-id="c6a86-124">В этом случае будет отложена hello рекомендации.</span><span class="sxs-lookup"><span data-stu-id="c6a86-124">In this case, hello recommendation will be postponed.</span></span>

## <a name="drop-index-recommendations"></a><span data-ttu-id="c6a86-125">Рекомендации по удалению индексов</span><span class="sxs-lookup"><span data-stu-id="c6a86-125">Drop index recommendations</span></span>
<span data-ttu-id="c6a86-126">В дополнение к этому toodetecting отсутствующий индекс базы данных SQL Azure постоянно анализирует производительность hello существующие индексы.</span><span class="sxs-lookup"><span data-stu-id="c6a86-126">In addition toodetecting a missing index, Azure SQL Database continuously analyzes hello performance of existing indexes.</span></span> <span data-ttu-id="c6a86-127">Если индекс не используется, база данных SQL Azure порекомендует удалить его.</span><span class="sxs-lookup"><span data-stu-id="c6a86-127">If index is not used, Azure SQL Database will recommend dropping it.</span></span> <span data-ttu-id="c6a86-128">Удаление индекса рекомендуется в двух случаях:</span><span class="sxs-lookup"><span data-stu-id="c6a86-128">Dropping an index is recommended in two cases:</span></span>
* <span data-ttu-id="c6a86-129">индекс является дубликатом другого индекса (созданного на основе того же столбца, схемы секций и фильтров);</span><span class="sxs-lookup"><span data-stu-id="c6a86-129">Index is a duplicate of another index (same indexed and included column, partition schema, and filters)</span></span>
* <span data-ttu-id="c6a86-130">индекс не используется в течение длительного времени (93 дня).</span><span class="sxs-lookup"><span data-stu-id="c6a86-130">Index is unused for a prolonged period (93 days)</span></span>

<span data-ttu-id="c6a86-131">Удаление рекомендованных индексов также проходят проверку hello после реализации.</span><span class="sxs-lookup"><span data-stu-id="c6a86-131">Drop index recommendations also go through hello verification after implementation.</span></span> <span data-ttu-id="c6a86-132">Повысить эффективность выполнения hello hello влияние отчета будут доступны.</span><span class="sxs-lookup"><span data-stu-id="c6a86-132">If hello performance is improved hello impact report will be available.</span></span> <span data-ttu-id="c6a86-133">Если будет обнаружено снижение производительности, применение рекомендации будет отменено.</span><span class="sxs-lookup"><span data-stu-id="c6a86-133">In case performance degradation is detected, recommendation will be reverted.</span></span>


## <a name="parameterize-queries-recommendations"></a><span data-ttu-id="c6a86-134">Рекомендации по параметризации запросов</span><span class="sxs-lookup"><span data-stu-id="c6a86-134">Parameterize queries recommendations</span></span>
<span data-ttu-id="c6a86-135">**Параметризация запросов везде** рекомендации отображаются, когда имеется один или несколько запросов, которые постоянно перекомпиляции, но в конечном итоге Здравствуйте, одинаковый план выполнения запроса.</span><span class="sxs-lookup"><span data-stu-id="c6a86-135">**Parameterize queries** recommendations appear when you have one or more queries that are constantly being recompiled but end up with hello same query execution plan.</span></span> <span data-ttu-id="c6a86-136">Это условие открывает tooapply возможность принудительной параметризации, что позволит планов запросов toobe кэшируются и повторно использовать в будущих повышение производительности и уменьшение потребления ресурсов hello.</span><span class="sxs-lookup"><span data-stu-id="c6a86-136">This condition opens up an opportunity tooapply forced parameterization, which will allow query plans toobe cached and reused in hello future improving performance and reducing resource usage.</span></span> 

<span data-ttu-id="c6a86-137">Каждый запрос, изначально выдан для SQL Server должен toogenerate toobe компиляции плана выполнения.</span><span class="sxs-lookup"><span data-stu-id="c6a86-137">Every query issued against SQL Server initially needs toobe compiled toogenerate an execution plan.</span></span> <span data-ttu-id="c6a86-138">Каждый создаваемый план добавляется в кэш планов toohello и последующее выполнение hello того же запроса может повторного использования плана из кэша hello, устраняя необходимость дополнительных компиляции hello.</span><span class="sxs-lookup"><span data-stu-id="c6a86-138">Each generated plan is added toohello plan cache and subsequent executions of hello same query can reuse this plan from hello cache, eliminating hello need for additional compilation.</span></span> 

<span data-ttu-id="c6a86-139">Приложения, отправляющие запросы, которые включают значения без параметров, может привести tooa снижение производительности, где для каждого такого запроса с различными значениями параметров плана выполнения hello компилируется повторно.</span><span class="sxs-lookup"><span data-stu-id="c6a86-139">Applications that send queries, which include non-parameterized values, can lead tooa performance overhead, where for every such query with different parameter values hello execution plan is compiled again.</span></span> <span data-ttu-id="c6a86-140">В многих случаях hello же запросы с другой параметр, который значения вызывают hello же планов выполнения, но эти планы отдельно по-прежнему будут добавлены toohello кэша планов.</span><span class="sxs-lookup"><span data-stu-id="c6a86-140">In many cases hello same queries with different parameter values generate hello same execution plans, but these plans are still separately added toohello plan cache.</span></span> <span data-ttu-id="c6a86-141">Рекомпиляции планы выполнения использовать ресурсы базы данных, увеличьте hello длительность времени и переполнения hello план запроса, вызывая кэша планов toobe извлекается из кэша hello.</span><span class="sxs-lookup"><span data-stu-id="c6a86-141">Recompiling execution plans use database resources, increase hello query duration time and overflow hello plan cache causing plans toobe evicted from hello cache.</span></span> <span data-ttu-id="c6a86-142">Это поведение SQL Server можно изменить, задав hello принудительно параметра parameterization для базы данных hello.</span><span class="sxs-lookup"><span data-stu-id="c6a86-142">This behavior of SQL Server can be altered by setting hello forced parameterization option on hello database.</span></span> 

<span data-ttu-id="c6a86-143">toohelp оценить влияние этой рекомендации hello, вам предоставляются с сравнение текущего ЦП hello использования и hello предполагаемое использование ЦП (как если бы была применена hello рекомендации).</span><span class="sxs-lookup"><span data-stu-id="c6a86-143">toohelp you estimate hello impact of this recommendation, you are provided with a comparison between hello actual CPU usage and hello projected CPU usage (as if hello recommendation was applied).</span></span> <span data-ttu-id="c6a86-144">Кроме экономии tooCPU вашей длительность запроса снижает hello времени, затраченного на компиляцию.</span><span class="sxs-lookup"><span data-stu-id="c6a86-144">In addition tooCPU savings, your query duration decreases for hello time spent in compilation.</span></span> <span data-ttu-id="c6a86-145">Также будет гораздо меньше нагрузку на кэш планов, позволяя большую часть hello toostay в кэше планов и повторно использовать.</span><span class="sxs-lookup"><span data-stu-id="c6a86-145">There will also be much less overhead on plan cache, allowing majority of hello plans toostay in cache and be reused.</span></span> <span data-ttu-id="c6a86-146">Можно применить эту рекомендацию быстро и легко, щелкнув hello **применить** команды.</span><span class="sxs-lookup"><span data-stu-id="c6a86-146">You can apply this recommendation quickly and easily by clicking on hello **Apply** command.</span></span> 

<span data-ttu-id="c6a86-147">После применения этой рекомендации, она будет включена Принудительная параметризация, в течение минут на базу данных и запуске hello, наблюдение за процессом, который длится примерно за 24 часа.</span><span class="sxs-lookup"><span data-stu-id="c6a86-147">Once you apply this recommendation, it will enable forced parameterization within minutes on your database and it starts hello monitoring process which approximately lasts for 24 hours.</span></span> <span data-ttu-id="c6a86-148">По истечении этого периода будет быть отчет о проверке hello может toosee, показывающий 24 часа, после использования ЦП базы данных и после применения рекомендации hello.</span><span class="sxs-lookup"><span data-stu-id="c6a86-148">After this period, you will be able toosee hello validation report that shows CPU usage of your database 24 hours before and after hello recommendation has been applied.</span></span> <span data-ttu-id="c6a86-149">Помощник по настройке ядра базы данных SQL имеет защитным механизмом, который автоматически возвращается hello применить рекомендации, в случае, если обнаружена со снижением производительности.</span><span class="sxs-lookup"><span data-stu-id="c6a86-149">SQL Database Advisor has a safety mechanism that automatically reverts hello applied recommendation in case a performance regression has been detected.</span></span>

## <a name="fix-schema-issues-recommendations"></a><span data-ttu-id="c6a86-150">Рекомендации по устранению ошибок схемы</span><span class="sxs-lookup"><span data-stu-id="c6a86-150">Fix schema issues recommendations</span></span>
<span data-ttu-id="c6a86-151">**Устранение проблемы схемы** рекомендации отображаются, когда hello служба базы данных SQL обнаруживает аномалий в hello номер ошибки SQL связанные со схемой происходит на базе данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="c6a86-151">**Fix schema issues** recommendations appear when hello SQL Database service notices an anomaly in hello number of schema-related SQL errors happening on your Azure SQL Database.</span></span> <span data-ttu-id="c6a86-152">Эта рекомендация обычно появляется, когда в базе данных возникает несколько связанных со схемой ошибок (недопустимое имя столбца, недопустимое имя объекта и т. д.) в течение часа.</span><span class="sxs-lookup"><span data-stu-id="c6a86-152">This recommendation typically appears when your database encounters multiple schema-related errors (invalid column name, invalid object name, etc.) within an hour.</span></span>

<span data-ttu-id="c6a86-153">«Проблемы схемы» — это класс синтаксических ошибок в SQL Server, которые происходят после определения hello hello SQL-запроса и hello hello схемы базы данных не согласована.</span><span class="sxs-lookup"><span data-stu-id="c6a86-153">“Schema issues” are a class of syntax errors in SQL Server that happen when hello definition of hello SQL query and hello definition of hello database schema are not aligned.</span></span> <span data-ttu-id="c6a86-154">Например, один из столбцов hello ожидаемый hello запроса могут отсутствовать в целевой таблице hello, или наоборот.</span><span class="sxs-lookup"><span data-stu-id="c6a86-154">For example, one of hello columns expected by hello query may be missing in hello target table, or vice versa.</span></span> 

<span data-ttu-id="c6a86-155">Рекомендация «Исправить проблему схемы» появляется, когда служба базы данных SQL Azure обнаруживает аномалий в hello номер ошибки SQL связанные со схемой происходит на базе данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="c6a86-155">“Fix schema issue” recommendation appears when Azure SQL Database service notices an anomaly in hello number of schema-related SQL errors happening on your Azure SQL Database.</span></span> <span data-ttu-id="c6a86-156">следующие таблицы показано hello ошибки, проблемы, связанные tooschema Hello:</span><span class="sxs-lookup"><span data-stu-id="c6a86-156">hello following table shows hello errors that are related tooschema issues:</span></span>

| <span data-ttu-id="c6a86-157">Код ошибки SQL</span><span class="sxs-lookup"><span data-stu-id="c6a86-157">SQL Error Code</span></span> | <span data-ttu-id="c6a86-158">Сообщение</span><span class="sxs-lookup"><span data-stu-id="c6a86-158">Message</span></span> |
| --- | --- |
| <span data-ttu-id="c6a86-159">201</span><span class="sxs-lookup"><span data-stu-id="c6a86-159">201</span></span> |<span data-ttu-id="c6a86-160">Процедура или функция "*" ожидает параметр "*", который не был указан.</span><span class="sxs-lookup"><span data-stu-id="c6a86-160">Procedure or function '*' expects parameter '*', which was not supplied.</span></span> |
| <span data-ttu-id="c6a86-161">207</span><span class="sxs-lookup"><span data-stu-id="c6a86-161">207</span></span> |<span data-ttu-id="c6a86-162">Недопустимое имя столбца "*".</span><span class="sxs-lookup"><span data-stu-id="c6a86-162">Invalid column name '*'.</span></span> |
| <span data-ttu-id="c6a86-163">208</span><span class="sxs-lookup"><span data-stu-id="c6a86-163">208</span></span> |<span data-ttu-id="c6a86-164">Недопустимое имя объекта "*".</span><span class="sxs-lookup"><span data-stu-id="c6a86-164">Invalid object name '*'.</span></span> |
| <span data-ttu-id="c6a86-165">213</span><span class="sxs-lookup"><span data-stu-id="c6a86-165">213</span></span> |<span data-ttu-id="c6a86-166">Имя столбца или число предоставленных значений не соответствует определению таблицы.</span><span class="sxs-lookup"><span data-stu-id="c6a86-166">Column name or number of supplied values does not match table definition.</span></span> |
| <span data-ttu-id="c6a86-167">2812</span><span class="sxs-lookup"><span data-stu-id="c6a86-167">2812</span></span> |<span data-ttu-id="c6a86-168">Не удалось найти хранимую процедуру "*".</span><span class="sxs-lookup"><span data-stu-id="c6a86-168">Could not find stored procedure '*'.</span></span> |
| <span data-ttu-id="c6a86-169">8144</span><span class="sxs-lookup"><span data-stu-id="c6a86-169">8144</span></span> |<span data-ttu-id="c6a86-170">Для процедуры или функции * указано слишком много аргументов.</span><span class="sxs-lookup"><span data-stu-id="c6a86-170">Procedure or function * has too many arguments specified.</span></span> |

## <a name="next-steps"></a><span data-ttu-id="c6a86-171">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="c6a86-171">Next steps</span></span>
<span data-ttu-id="c6a86-172">Отслеживание рекомендаций и продолжить tooapply их toorefine производительности.</span><span class="sxs-lookup"><span data-stu-id="c6a86-172">Monitor your recommendations and continue tooapply them toorefine performance.</span></span> <span data-ttu-id="c6a86-173">Рабочие нагрузки базы данных являются динамическими и меняются непрерывно.</span><span class="sxs-lookup"><span data-stu-id="c6a86-173">Database workloads are dynamic and change continuously.</span></span> <span data-ttu-id="c6a86-174">Помощник по настройке ядра базы данных SQL по-прежнему toomonitor и предоставляет рекомендации, которые потенциально могут увеличить производительность вашей базы данных.</span><span class="sxs-lookup"><span data-stu-id="c6a86-174">SQL Database advisor continues toomonitor and provide recommendations that can potentially improve your database's performance.</span></span> 

* <span data-ttu-id="c6a86-175">В разделе [рекомендации по повышению производительности в hello портал Azure](sql-database-advisor-portal.md) шагами как toouse рекомендации по повышению производительности в hello портал Azure.</span><span class="sxs-lookup"><span data-stu-id="c6a86-175">See [Performance recommendations in hello Azure portal](sql-database-advisor-portal.md) for steps on how toouse performance recommendations in hello Azure portal.</span></span>
* <span data-ttu-id="c6a86-176">В разделе [подробных сведений о производительности запросов](sql-database-query-performance.md) toolearn о и представление hello нерегламентированными запросы воздействие на производительность.</span><span class="sxs-lookup"><span data-stu-id="c6a86-176">See [Query Performance Insights](sql-database-query-performance.md) toolearn about and view hello performance impact of your top queries.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="c6a86-177">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="c6a86-177">Additional resources</span></span>
* [<span data-ttu-id="c6a86-178">Хранилище запросов</span><span class="sxs-lookup"><span data-stu-id="c6a86-178">Query Store</span></span>](https://msdn.microsoft.com/library/dn817826.aspx)
* [<span data-ttu-id="c6a86-179">CREATE INDEX</span><span class="sxs-lookup"><span data-stu-id="c6a86-179">CREATE INDEX</span></span>](https://msdn.microsoft.com/library/ms188783.aspx)
* [<span data-ttu-id="c6a86-180">Контроль доступа на основе ролей</span><span class="sxs-lookup"><span data-stu-id="c6a86-180">Role-based access control</span></span>](../active-directory/role-based-access-control-what-is.md)

