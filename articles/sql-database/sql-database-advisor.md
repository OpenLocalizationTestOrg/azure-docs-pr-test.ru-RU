---
title: "Рекомендации по производительности базы данных SQL Azure | Документация Майкрософт"
description: "База данных SQL Azure предоставляет рекомендации для баз данных SQL, которые могут повысить текущую производительность запросов."
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: monicar
ms.assetid: 1db441ff-58f5-45da-8d38-b54dc2aa6145
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-management
ms.date: 07/05/2017
ms.author: sstein
ms.openlocfilehash: 357a25a665894c86ddb0f93beeb4dd59d8837489
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="performance-recommendations"></a><span data-ttu-id="01fd7-103">Рекомендации по производительности</span><span class="sxs-lookup"><span data-stu-id="01fd7-103">Performance recommendations</span></span>

<span data-ttu-id="01fd7-104">База данных SQL Azure изучает работу приложения, адаптируется к нему и предоставляет настраиваемые рекомендации, что позволяет добиться максимальной производительности баз данных SQL.</span><span class="sxs-lookup"><span data-stu-id="01fd7-104">Azure SQL Database learns and adapts with your application and provides customized recommendations enabling you to maximize the performance of your SQL databases.</span></span> <span data-ttu-id="01fd7-105">Производительность постоянно оценивается путем анализа журнала использования базы данных SQL.</span><span class="sxs-lookup"><span data-stu-id="01fd7-105">Your performance is continuously assessed by analyzing your SQL Database usage history.</span></span> <span data-ttu-id="01fd7-106">Предоставляемые рекомендации основаны на уникальном шаблоне рабочей нагрузки базы данных и помогают повысить ее производительность.</span><span class="sxs-lookup"><span data-stu-id="01fd7-106">The recommendations that are provided are based on a database unique workload pattern and help improve its performance.</span></span>

> [!NOTE]
> <span data-ttu-id="01fd7-107">Для применения рекомендаций мы советуем включить автоматическую настройку базы данных.</span><span class="sxs-lookup"><span data-stu-id="01fd7-107">Recommended way of using recommendations is by enabling ‘Automatic tuning’ on your database.</span></span> <span data-ttu-id="01fd7-108">Дополнительные сведения см. в разделе [Автоматическая настройка](sql-database-automatic-tuning.md).</span><span class="sxs-lookup"><span data-stu-id="01fd7-108">For details, see [Automatic tuning](sql-database-automatic-tuning.md).</span></span>
>

## <a name="create-index-recommendations"></a><span data-ttu-id="01fd7-109">Рекомендации по созданию индексов</span><span class="sxs-lookup"><span data-stu-id="01fd7-109">Create index recommendations</span></span>
<span data-ttu-id="01fd7-110">База данных SQL Azure непрерывно отслеживает выполняемые запросы и определяет индексы, которые могут повысить производительность.</span><span class="sxs-lookup"><span data-stu-id="01fd7-110">Azure SQL Database continuously monitors the queries being executed and identifies the indexes that could improve the performance.</span></span> <span data-ttu-id="01fd7-111">После того, как система удостоверится в отсутствии определенного индекса, создается новая рекомендация **Создание индекса**.</span><span class="sxs-lookup"><span data-stu-id="01fd7-111">Once enough confidence is built that a certain index is missing, a new **Create index** recommendation will be created.</span></span> <span data-ttu-id="01fd7-112">База данных SQL Azure определяет это, оценивая рост производительности, который со временем обеспечит индекс.</span><span class="sxs-lookup"><span data-stu-id="01fd7-112">Azure SQL Database builds confidence by estimating performance gain the index would bring through time.</span></span> <span data-ttu-id="01fd7-113">В зависимости от предполагаемого роста производительности рекомендации классифицируются как "Высокий", "Средний" и "Низкий".</span><span class="sxs-lookup"><span data-stu-id="01fd7-113">Depending on the estimated performance gain, recommendations are categorized as High, Medium,  or Low.</span></span> 

<span data-ttu-id="01fd7-114">Индексы, созданные с помощью рекомендаций, всегда помечаются флагом auto_created.</span><span class="sxs-lookup"><span data-stu-id="01fd7-114">Indexes created using recommendations are always flagged as auto_created indexes.</span></span> <span data-ttu-id="01fd7-115">Узнать, какие индексы имеют флаг auto_created, можно, просмотрев представление sys.indexes.</span><span class="sxs-lookup"><span data-stu-id="01fd7-115">You can see which indexes are auto_created by looking at sys.indexes view.</span></span> <span data-ttu-id="01fd7-116">Автоматически созданные индексы не блокируют команды ALTER и RENAME.</span><span class="sxs-lookup"><span data-stu-id="01fd7-116">Auto created indexes don’t block ALTER/RENAME commands.</span></span> <span data-ttu-id="01fd7-117">Если вы попытаетесь удалить столбец, по которому был автоматически создан индекс, команда будет выполнена, а автоматически созданный индекс будет также удален этой командой.</span><span class="sxs-lookup"><span data-stu-id="01fd7-117">If you try to drop the column that has an auto created index over it, the command passes and the auto created index is dropped with the command as well.</span></span> <span data-ttu-id="01fd7-118">Обычные индексы блокируют команду ALTER или RENAME, выполняемую для индексированных столбцов.</span><span class="sxs-lookup"><span data-stu-id="01fd7-118">Regular indexes would block the ALTER/RENAME command on columns that are indexed.</span></span>

<span data-ttu-id="01fd7-119">После применения рекомендации по созданию индекса база данных SQL Azure будет сравнить производительность запросов с базовой производительностью.</span><span class="sxs-lookup"><span data-stu-id="01fd7-119">Once the create index recommendation is applied, Azure SQL Database will compare performance of the queries with the baseline performance.</span></span> <span data-ttu-id="01fd7-120">Если новый индекс повышает производительности, то рекомендация будет помечена как успешная и будет доступен отчет о ее результатах.</span><span class="sxs-lookup"><span data-stu-id="01fd7-120">If new index brought improvements in the performance, recommendation will be flagged as successful and impact report will be available.</span></span> <span data-ttu-id="01fd7-121">В случае, если индекс не дает никаких преимуществ, его создание будет автоматически отменено.</span><span class="sxs-lookup"><span data-stu-id="01fd7-121">In case the index didn’t bring the benefits, it will be automatically reverted.</span></span> <span data-ttu-id="01fd7-122">Таким образом база данных SQL Azure гарантирует, что рекомендации будут только повышать производительность базы данных.</span><span class="sxs-lookup"><span data-stu-id="01fd7-122">This way Azure SQL Database ensures that using recommendations will only improve the database performance.</span></span>

<span data-ttu-id="01fd7-123">У любой рекомендации **Создание индекса** есть политика отхода, которая не позволит применить рекомендацию, если использование DTU базы данных или пула превышало 80 % в течение последних 20 минут или использование хранилища превышает 90 %.</span><span class="sxs-lookup"><span data-stu-id="01fd7-123">Any **Create index** recommendation has a back off policy that won’t allow applying the recommendation if the database or pool DTU usage was above 80% in last 20 minutes or if the storage is above 90% of usage.</span></span> <span data-ttu-id="01fd7-124">В этом случае рекомендация будет отложена.</span><span class="sxs-lookup"><span data-stu-id="01fd7-124">In this case, the recommendation will be postponed.</span></span>

## <a name="drop-index-recommendations"></a><span data-ttu-id="01fd7-125">Рекомендации по удалению индексов</span><span class="sxs-lookup"><span data-stu-id="01fd7-125">Drop index recommendations</span></span>
<span data-ttu-id="01fd7-126">Помимо обнаружения недостающего индекса база данных SQL Azure постоянно анализирует производительность существующих индексов.</span><span class="sxs-lookup"><span data-stu-id="01fd7-126">In addition to detecting a missing index, Azure SQL Database continuously analyzes the performance of existing indexes.</span></span> <span data-ttu-id="01fd7-127">Если индекс не используется, база данных SQL Azure порекомендует удалить его.</span><span class="sxs-lookup"><span data-stu-id="01fd7-127">If index is not used, Azure SQL Database will recommend dropping it.</span></span> <span data-ttu-id="01fd7-128">Удаление индекса рекомендуется в двух случаях:</span><span class="sxs-lookup"><span data-stu-id="01fd7-128">Dropping an index is recommended in two cases:</span></span>
* <span data-ttu-id="01fd7-129">индекс является дубликатом другого индекса (созданного на основе того же столбца, схемы секций и фильтров);</span><span class="sxs-lookup"><span data-stu-id="01fd7-129">Index is a duplicate of another index (same indexed and included column, partition schema, and filters)</span></span>
* <span data-ttu-id="01fd7-130">индекс не используется в течение длительного времени (93 дня).</span><span class="sxs-lookup"><span data-stu-id="01fd7-130">Index is unused for a prolonged period (93 days)</span></span>

<span data-ttu-id="01fd7-131">Рекомендации по удалению индексов также проходят проверку после применения.</span><span class="sxs-lookup"><span data-stu-id="01fd7-131">Drop index recommendations also go through the verification after implementation.</span></span> <span data-ttu-id="01fd7-132">Если производительность повысилась, вам будет доступен отчет о результатах.</span><span class="sxs-lookup"><span data-stu-id="01fd7-132">If the performance is improved the impact report will be available.</span></span> <span data-ttu-id="01fd7-133">Если будет обнаружено снижение производительности, применение рекомендации будет отменено.</span><span class="sxs-lookup"><span data-stu-id="01fd7-133">In case performance degradation is detected, recommendation will be reverted.</span></span>


## <a name="parameterize-queries-recommendations"></a><span data-ttu-id="01fd7-134">Рекомендации по параметризации запросов</span><span class="sxs-lookup"><span data-stu-id="01fd7-134">Parameterize queries recommendations</span></span>
<span data-ttu-id="01fd7-135">Рекомендации по **параметризации запросов** появляются при наличии одного или нескольких запросов, которые постоянно перекомпилируются, но в результате для них создается одинаковый план выполнения запроса.</span><span class="sxs-lookup"><span data-stu-id="01fd7-135">**Parameterize queries** recommendations appear when you have one or more queries that are constantly being recompiled but end up with the same query execution plan.</span></span> <span data-ttu-id="01fd7-136">Это условие дает возможность применить принудительную параметризацию, которая позволит кэшировать планы запросов и повторно использовать их в будущем, повышая производительность и снижая использование ресурсов.</span><span class="sxs-lookup"><span data-stu-id="01fd7-136">This condition opens up an opportunity to apply forced parameterization, which will allow query plans to be cached and reused in the future improving performance and reducing resource usage.</span></span> 

<span data-ttu-id="01fd7-137">Каждый запрос, отправленный в SQL Server, сначала должен быть скомпилирован для формирования плана выполнения.</span><span class="sxs-lookup"><span data-stu-id="01fd7-137">Every query issued against SQL Server initially needs to be compiled to generate an execution plan.</span></span> <span data-ttu-id="01fd7-138">Каждый создаваемый план добавляется в кэш планов и может быть использован повторно при последующем выполнении этого запроса, устраняя необходимость в дополнительной компиляции.</span><span class="sxs-lookup"><span data-stu-id="01fd7-138">Each generated plan is added to the plan cache and subsequent executions of the same query can reuse this plan from the cache, eliminating the need for additional compilation.</span></span> 

<span data-ttu-id="01fd7-139">Приложения, отправляющие запросы, которые содержат непараметризованные значения, могут привести к снижению производительности, так как для каждого такого запроса с различными значениями параметров план выполнения компилируется заново.</span><span class="sxs-lookup"><span data-stu-id="01fd7-139">Applications that send queries, which include non-parameterized values, can lead to a performance overhead, where for every such query with different parameter values the execution plan is compiled again.</span></span> <span data-ttu-id="01fd7-140">Во многих случаях для одинаковых запросов с отличными значениями параметров создаются одинаковые планы выполнения, но эти планы по-прежнему добавляются в кэш планов по отдельности.</span><span class="sxs-lookup"><span data-stu-id="01fd7-140">In many cases the same queries with different parameter values generate the same execution plans, but these plans are still separately added to the plan cache.</span></span> <span data-ttu-id="01fd7-141">Планы выполнения повторных операций компиляции используют ресурсы базы данных, увеличивают длительность запроса и переполняют кэш планов, что приводит к исключению планов из него.</span><span class="sxs-lookup"><span data-stu-id="01fd7-141">Recompiling execution plans use database resources, increase the query duration time and overflow the plan cache causing plans to be evicted from the cache.</span></span> <span data-ttu-id="01fd7-142">Такое поведение SQL Server можно изменить, задав параметр принудительной параметризации для базы данных.</span><span class="sxs-lookup"><span data-stu-id="01fd7-142">This behavior of SQL Server can be altered by setting the forced parameterization option on the database.</span></span> 

<span data-ttu-id="01fd7-143">Чтобы было проще оценить влияние этой рекомендации, вам будет предоставлено сравнение фактического и предполагаемого потребления ресурсов ЦП (после применения рекомендации).</span><span class="sxs-lookup"><span data-stu-id="01fd7-143">To help you estimate the impact of this recommendation, you are provided with a comparison between the actual CPU usage and the projected CPU usage (as if the recommendation was applied).</span></span> <span data-ttu-id="01fd7-144">Помимо экономии ресурсов ЦП, снизится длительность обработки запроса за счет времени, затрачиваемого на компиляцию.</span><span class="sxs-lookup"><span data-stu-id="01fd7-144">In addition to CPU savings, your query duration decreases for the time spent in compilation.</span></span> <span data-ttu-id="01fd7-145">Кроме того, уменьшится дополнительная нагрузка на кэш планов, что позволит хранить в кэше большинство планов и повторно их использовать.</span><span class="sxs-lookup"><span data-stu-id="01fd7-145">There will also be much less overhead on plan cache, allowing majority of the plans to stay in cache and be reused.</span></span> <span data-ttu-id="01fd7-146">Вы можете быстро и легко применить эту рекомендацию, щелкнув команду **Применить**.</span><span class="sxs-lookup"><span data-stu-id="01fd7-146">You can apply this recommendation quickly and easily by clicking on the **Apply** command.</span></span> 

<span data-ttu-id="01fd7-147">Через несколько минут после применения этой рекомендации для вашей базы будет принудительно включена параметризация и запущен мониторинг, который длится примерно 24 часа.</span><span class="sxs-lookup"><span data-stu-id="01fd7-147">Once you apply this recommendation, it will enable forced parameterization within minutes on your database and it starts the monitoring process which approximately lasts for 24 hours.</span></span> <span data-ttu-id="01fd7-148">По истечении этого периода вы сможете просмотреть отчет о проверке, содержащий информацию об использовании ресурсов ЦП для базы данных за 24 часа до и через 24 часа после применения рекомендации.</span><span class="sxs-lookup"><span data-stu-id="01fd7-148">After this period, you will be able to see the validation report that shows CPU usage of your database 24 hours before and after the recommendation has been applied.</span></span> <span data-ttu-id="01fd7-149">Помощник по базам данных SQL имеет механизм безопасности, который автоматически отменит примененную рекомендацию в случае, если будет обнаружено снижение производительности.</span><span class="sxs-lookup"><span data-stu-id="01fd7-149">SQL Database Advisor has a safety mechanism that automatically reverts the applied recommendation in case a performance regression has been detected.</span></span>

## <a name="fix-schema-issues-recommendations"></a><span data-ttu-id="01fd7-150">Рекомендации по устранению ошибок схемы</span><span class="sxs-lookup"><span data-stu-id="01fd7-150">Fix schema issues recommendations</span></span>
<span data-ttu-id="01fd7-151">Рекомендации по **устранению ошибок схемы** появляются, когда служба базы данных SQL обнаруживает аномальное количество относящихся к схеме ошибок SQL, которые возникают в вашей базе данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="01fd7-151">**Fix schema issues** recommendations appear when the SQL Database service notices an anomaly in the number of schema-related SQL errors happening on your Azure SQL Database.</span></span> <span data-ttu-id="01fd7-152">Эта рекомендация обычно появляется, когда в базе данных возникает несколько связанных со схемой ошибок (недопустимое имя столбца, недопустимое имя объекта и т. д.) в течение часа.</span><span class="sxs-lookup"><span data-stu-id="01fd7-152">This recommendation typically appears when your database encounters multiple schema-related errors (invalid column name, invalid object name, etc.) within an hour.</span></span>

<span data-ttu-id="01fd7-153">"Ошибки схемы" относятся к классу синтаксических ошибок в SQL Server, которые происходят, когда определение запроса SQL и определение схемы базы данных не согласованы.</span><span class="sxs-lookup"><span data-stu-id="01fd7-153">“Schema issues” are a class of syntax errors in SQL Server that happen when the definition of the SQL query and the definition of the database schema are not aligned.</span></span> <span data-ttu-id="01fd7-154">Например, один из столбцов, ожидаемых запросом, может отсутствовать в целевой таблице или наоборот.</span><span class="sxs-lookup"><span data-stu-id="01fd7-154">For example, one of the columns expected by the query may be missing in the target table, or vice versa.</span></span> 

<span data-ttu-id="01fd7-155">Рекомендация по устранению ошибок схемы появляется, когда служба базы данных SQL обнаруживает аномальное количество относящихся к схеме ошибок SQL, которые возникают в базе данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="01fd7-155">“Fix schema issue” recommendation appears when Azure SQL Database service notices an anomaly in the number of schema-related SQL errors happening on your Azure SQL Database.</span></span> <span data-ttu-id="01fd7-156">В следующей таблице показаны ошибки, которые относятся к схеме.</span><span class="sxs-lookup"><span data-stu-id="01fd7-156">The following table shows the errors that are related to schema issues:</span></span>

| <span data-ttu-id="01fd7-157">Код ошибки SQL</span><span class="sxs-lookup"><span data-stu-id="01fd7-157">SQL Error Code</span></span> | <span data-ttu-id="01fd7-158">Сообщение</span><span class="sxs-lookup"><span data-stu-id="01fd7-158">Message</span></span> |
| --- | --- |
| <span data-ttu-id="01fd7-159">201</span><span class="sxs-lookup"><span data-stu-id="01fd7-159">201</span></span> |<span data-ttu-id="01fd7-160">Процедура или функция "*" ожидает параметр "*", который не был указан.</span><span class="sxs-lookup"><span data-stu-id="01fd7-160">Procedure or function '*' expects parameter '*', which was not supplied.</span></span> |
| <span data-ttu-id="01fd7-161">207</span><span class="sxs-lookup"><span data-stu-id="01fd7-161">207</span></span> |<span data-ttu-id="01fd7-162">Недопустимое имя столбца "*".</span><span class="sxs-lookup"><span data-stu-id="01fd7-162">Invalid column name '*'.</span></span> |
| <span data-ttu-id="01fd7-163">208</span><span class="sxs-lookup"><span data-stu-id="01fd7-163">208</span></span> |<span data-ttu-id="01fd7-164">Недопустимое имя объекта "*".</span><span class="sxs-lookup"><span data-stu-id="01fd7-164">Invalid object name '*'.</span></span> |
| <span data-ttu-id="01fd7-165">213</span><span class="sxs-lookup"><span data-stu-id="01fd7-165">213</span></span> |<span data-ttu-id="01fd7-166">Имя столбца или число предоставленных значений не соответствует определению таблицы.</span><span class="sxs-lookup"><span data-stu-id="01fd7-166">Column name or number of supplied values does not match table definition.</span></span> |
| <span data-ttu-id="01fd7-167">2812</span><span class="sxs-lookup"><span data-stu-id="01fd7-167">2812</span></span> |<span data-ttu-id="01fd7-168">Не удалось найти хранимую процедуру "*".</span><span class="sxs-lookup"><span data-stu-id="01fd7-168">Could not find stored procedure '*'.</span></span> |
| <span data-ttu-id="01fd7-169">8144</span><span class="sxs-lookup"><span data-stu-id="01fd7-169">8144</span></span> |<span data-ttu-id="01fd7-170">Для процедуры или функции * указано слишком много аргументов.</span><span class="sxs-lookup"><span data-stu-id="01fd7-170">Procedure or function * has too many arguments specified.</span></span> |

## <a name="next-steps"></a><span data-ttu-id="01fd7-171">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="01fd7-171">Next steps</span></span>
<span data-ttu-id="01fd7-172">Отслеживайте рекомендации и продолжайте применять их для повышения производительности.</span><span class="sxs-lookup"><span data-stu-id="01fd7-172">Monitor your recommendations and continue to apply them to refine performance.</span></span> <span data-ttu-id="01fd7-173">Рабочие нагрузки базы данных являются динамическими и меняются непрерывно.</span><span class="sxs-lookup"><span data-stu-id="01fd7-173">Database workloads are dynamic and change continuously.</span></span> <span data-ttu-id="01fd7-174">Помощник по работе с базами данных SQL продолжает отслеживать работу и давать рекомендации, которые могут повысить производительность базы данных.</span><span class="sxs-lookup"><span data-stu-id="01fd7-174">SQL Database advisor continues to monitor and provide recommendations that can potentially improve your database's performance.</span></span> 

* <span data-ttu-id="01fd7-175">В разделе [Использование помощника по базам данных SQL на портале Azure](sql-database-advisor-portal.md) приведены пошаговые инструкции по использованию рекомендаций по производительности на портале Azure.</span><span class="sxs-lookup"><span data-stu-id="01fd7-175">See [Performance recommendations in the Azure portal](sql-database-advisor-portal.md) for steps on how to use performance recommendations in the Azure portal.</span></span>
* <span data-ttu-id="01fd7-176">См. статью [Анализ производительности запросов базы данных Azure SQL](sql-database-query-performance.md), чтобы узнать о том, как просмотреть влияние на производительность основных запросов.</span><span class="sxs-lookup"><span data-stu-id="01fd7-176">See [Query Performance Insights](sql-database-query-performance.md) to learn about and view the performance impact of your top queries.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="01fd7-177">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="01fd7-177">Additional resources</span></span>
* [<span data-ttu-id="01fd7-178">Хранилище запросов</span><span class="sxs-lookup"><span data-stu-id="01fd7-178">Query Store</span></span>](https://msdn.microsoft.com/library/dn817826.aspx)
* [<span data-ttu-id="01fd7-179">CREATE INDEX</span><span class="sxs-lookup"><span data-stu-id="01fd7-179">CREATE INDEX</span></span>](https://msdn.microsoft.com/library/ms188783.aspx)
* [<span data-ttu-id="01fd7-180">Контроль доступа на основе ролей</span><span class="sxs-lookup"><span data-stu-id="01fd7-180">Role-based access control</span></span>](../active-directory/role-based-access-control-what-is.md)

