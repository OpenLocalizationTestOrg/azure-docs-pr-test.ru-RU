---
title: "aaaManage схемы базы данных SQL Azure в приложении несколькими клиентами | Документы Microsoft"
description: "Управление схемой для нескольких клиентов в мультитенантном приложении, использующем базу данных SQL Azure"
keywords: "руководство по базе данных sql"
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/28/2017
ms.author: billgib; sstein
ms.openlocfilehash: ea946e556808dabd60dd39cb8173d0512d4bddec
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="manage-schema-for-multiple-tenants-in-hello-wingtip-saas-application"></a>Управление схемой для нескольких клиентов в приложение Wingtip SaaS hello

Hello [первом учебнике Wingtip SaaS](sql-database-saas-tutorial.md) показано, как приложение hello можно подготовить базы данных клиента и зарегистрировать его в каталоге hello. Как и любое приложение приветствия приложению Wingtip SaaS будет меняться со временем и в некоторых случаях потребуется базы данных toohello изменения. Изменения могут включать новые или измененные схему, новые или измененные ссылочных данных и сопоставление базы данных обслуживания задачи tooensure оптимальной производительности приложения. В приложениях SaaS эти изменения должны toobe, развернутого в виде согласованных на потенциально больших флот баз данных клиента. Эти изменения toobe в будущем клиента базы данных, они должны toobe включены в процесс подготовки hello.

Этот учебник рассматриваются два сценария - развертывания обновлений ссылку данных для всех клиентов и retuning индекса для hello таблицы содержат данные ссылок hello. Hello [эластичной задания](sql-database-elastic-jobs-overview.md) компонент является используется tooexecute эти операции для всех клиентов и hello *золотой* базы данных клиента, используемый в качестве шаблона для новых баз данных.

Из этого руководства вы узнаете, как выполнить следующие задачи:

> [!div class="checklist"]

> * Создание учетной записи заданий.
> * Выполнение запроса к нескольким клиентам.
> * Обновление данных во всех клиентских базах данных.
> * Создание индекса для таблицы во всех базах данных клиента.


toocomplete этого учебника, убедитесь, что hello следующие необходимые условия выполнены:

* приложение Wingtip SaaS Hello развертывается. toodeploy менее чем за пять минут. в разделе [развертывание и просмотр приложения Wingtip SaaS hello](sql-database-saas-tutorial.md)
* Установите Azure PowerShell. Дополнительные сведения см. в статье [Начало работы с Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps).
* будет установлена последняя версия Hello объекта SQL Server Management Studio (SSMS). [Download SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms) (Скачивание SQL Server Management Studio (SSMS))

*В этом учебнике используется компоненты hello служба базы данных SQL, которые находятся в ограниченной предварительной версии (заданий эластичных баз данных). Если вы хотите toodo этого учебника, укажите идентификатор своей подписки tooSaaSFeedback@microsoft.com с темой = предварительной версией гибкого заданий. После получения подтверждения, что подписки была включена, [загрузить и установить новые командлеты заданий предварительного выпуска hello](https://github.com/jaredmoo/azure-powershell/releases). Это ограниченная предварительная версия, поэтому вы можете задать вопросы и получить поддержку, написав по адресу SaaSFeedback@microsoft.com.*


## <a name="introduction-toosaas-schema-management-patterns"></a>Введение tooSaaS управление схемой шаблонов

Hello каждой базы данных для одного клиента SaaS шаблона преимущества во многом от изоляции данных hello, полученный, но в hello одновременно возникают hello дополнительную сложность, обслуживание и управление много баз данных. [Эластичный задания](sql-database-elastic-jobs-overview.md) облегчает Администрирование и управление hello уровня данных SQL. Задания позволяют toosecurely и надежно и выполнения задач (сценарии T-SQL) независимо от взаимодействия с пользователем или входные данные, для группы баз данных. Этот метод можно использовать toodeploy схемы и общих изменений в ссылочных данных распределяются по всем клиентам в приложении. Эластичный задания могут быть также используется toomaintain *золотой* использует копию базы данных hello toocreate новых клиентов, гарантируя тем самым, он всегда hello последнюю схему и ссылочных данных.

![экран](media/sql-database-saas-tutorial-schema-management/schema-management.png)


## <a name="elastic-jobs-limited-preview"></a>Ограниченная предварительная версия заданий обработки эластичных БД

Существует новая версия заданий обработки эластичных БД, которая является интегрированным компонентом баз данных SQL и не требует дополнительных служб или компонентов. Сейчас новая версия заданий обработки эластичных БД находится на этапе ограниченной предварительной версии. В настоящее время это ограниченная Предварительная версия поддерживает учетные записи задания toocreate PowerShell и toocreate T-SQL и управления заданиями.

> [!NOTE]
> *В этом учебнике используется компоненты hello служба базы данных SQL, которые находятся в ограниченной предварительной версии (заданий эластичных баз данных). Если вы хотите toodo этого учебника, укажите идентификатор своей подписки tooSaaSFeedback@microsoft.com с темой = предварительной версией гибкого заданий. После получения подтверждения, что подписки была включена, [загрузить и установить новые командлеты заданий предварительного выпуска hello](https://github.com/jaredmoo/azure-powershell/releases). Это ограниченная предварительная версия, поэтому вы можете задать вопросы и получить поддержку, написав по адресу SaaSFeedback@microsoft.com.*

## <a name="get-hello-wingtip-application-scripts"></a>Получение скриптов приложения Wingtip hello

Hello Wingtip SaaS скриптов и исходный код приложения были доступны в hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) в репозитории github. [Действия скриптов Wingtip SaaS hello toodownload](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).

## <a name="create-a-job-account-database-and-new-job-account"></a>Создание базы данных учетных записей заданий и учетной записи задания

Этот учебник требуется использовать PowerShell toocreate hello Задание учетной записи базы данных и задание учетной записи. Как в базе данных MSDB и агента SQL Server использует эластичной заданий Azure SQL базы данных, toostore определения заданий, состояние задания и журнал. После создания учетной записи hello задания можно создавать и отслеживать задания немедленно.

1. Открыть... \\Модулей обучения\\управление схемой\\*Демонстрация SchemaManagement.ps1* в hello **интегрированной среды Сценариев PowerShell**.
1. Нажмите клавишу **F5** toorun hello скрипта.

Hello *Демонстрация SchemaManagement.ps1* hello вызовов сценария *развернуть SchemaManagement.ps1* скрипт toocreate *S2* базы данных с именем **jobaccount** на сервере каталога hello. Затем он создает задание учетной записи hello, передача базы данных jobaccount hello как вызов создания toohello задания параметров учетной записи.

## <a name="create-a-job-toodeploy-new-reference-data-tooall-tenants"></a>Создать задание toodeploy новых ссылку данных tooall клиентов

Каждая база данных клиента включает набор проведения типы, определяющие тип события, которые размещаются на место проведения hello. В этом упражнении вы развертывать обновления tooall hello клиента баз данных tooadd два дополнительных проведения типов: *мотоцикла трассировки* и *сообщество бассейне*. Эти типы проведения соответствуют toohello фонового изображения, отображаемые в приложении события hello клиента.

Нажмите кнопку раскрывающегося меню типа проведения hello и проверить, что только 10 проведения тип доступны и в частности, «Мотоцикла трассировки» и «Бассейне сообщество» не включаются в список hello.

Теперь давайте создадим hello задания tooupdate *VenueTypes* во всех базах данных клиента hello и добавить новые типы проведения hello.

toocreate новое задание, мы используем набор заданий системные хранимые процедуры, созданные в базе данных jobaccount hello при создании учетной записи задания hello.

1. Откройте SSMS и подключите сервер каталога toohello: каталог -\<пользователя\>. database.windows.net сервера
1. Также подключения сервера клиента toohello: tenants1 -\<пользователя\>. database.windows.net
1. Обзор toohello *contosoconcerthall* базы данных на hello *tenants1* сервера и запрос hello *VenueTypes* tooconfirm таблицы, *мотоцикла трассировки*  и *сообщество бассейне* **не** в списке результатов hello.
1. Привет открыть файл... \\Модулях обучения\\управление схемой\\DeployReferenceData.sql
1. Измените инструкцию hello: ЗАДАТЬ @wtpUser = &lt;пользователя&gt; и замените значение hello пользователя, используемое при развертывании приложения Wingtip hello
1. Убедитесь, база данных jobaccount подключенных toohello и нажмите клавишу **F5** для выполнения сценария hello

* **SP\_добавить\_целевой\_группы** создает имя целевой группы hello DemoServerGroup, теперь мы должны tooadd целевые элементы.
* **SP\_добавить\_целевой\_группы\_член** добавляет *сервера* целевой тип члена, который рассматривается всех баз данных в пределах сервера (Обратите внимание, это hello tenants1-&lt; Пользователь&gt; сервер, содержащий базы данных клиента hello) во время задания выполнения должны быть включены в задание hello hello второй состоит в добавлении *базы данных* целевой тип члена, в частности Здравствуйте, «золотого» базы данных ( basetenantdb), находящийся в каталоге -&lt;пользователя&gt; server и наконец другой *базы данных* целевой группы член типа tooinclude hello adhocanalytics базы данных, используемый в этом руководстве.
* **sp\_add\_job** — создает задание с названием "Развертывание справочных данных".
* **SP\_добавить\_шага задания** создает шаг задания hello, содержащий T-SQL текст tooupdate hello ссылку таблицы команд, VenueTypes
* Оставшиеся представления Hello в скрипте hello отображают существование hello hello объектов и монитор выполнения задания. Используйте эти значения состояния hello tooreview запросы в hello **жизненного цикла** toodetermine столбца по завершении задания hello успешно для всех баз данных клиента и hello два дополнительных баз данных, содержащих hello ссылочной таблицы.

1. В SSMS, найдите toohello *contosoconcerthall* базы данных на hello *tenants1* сервера и запрос hello *VenueTypes* tooconfirm таблицы, *мотоцикла Трассировки* и *сообщество бассейне* **,** теперь в списке результатов hello.


## <a name="create-a-job-toomanage-hello-reference-table-index"></a>Создание индекса таблицы toomanage hello задания ссылка

Аналогичные toohello предыдущее упражнение, в этом упражнении создается индекс hello toorebuild задания на первичный ключ таблицы ссылок hello, операция управления обычной базой данных администратор может выполняться после загрузки больших объемов данных в таблицу.

Создание задания с помощью hello же заданий «система» хранимых процедур.

1. Откройте SSMS и подключите каталог toohello -&lt;пользователя&gt;. database.windows.net сервера
1. Привет открыть файл... \\Модулях обучения\\управление схемой\\OnlineReindex.sql
1. Щелкните правой кнопкой мыши, выберите соединение и подключения toohello каталога -&lt;пользователя&gt;. database.windows.net сервер, если еще не подключены
1. Убедитесь, базы данных jobaccount подключенных toohello и нажмите клавишу F5 toorun hello сценария

* sp\_add\_job создает новое задание "Online Reindex PK\_\_VenueTyp\_\_265E44FD7FD4C885".
* SP\_добавить\_шага задания создает шаг задания hello, содержащий индекс hello tooupdate текст команды T-SQL




## <a name="next-steps"></a>Дальнейшие действия

Из этого руководства вы узнали, как выполнять такие задачи:

> [!div class="checklist"]

> * Создание учетной записи задания tooquery нескольких клиентов
> * Обновление данных во всех клиентских базах данных.
> * Создание индекса для таблицы во всех базах данных клиента.

[Ad-hoc analytics tutorial](sql-database-saas-tutorial-adhoc-analytics.md) (Руководство по аналитике Ad-hoc)


## <a name="additional-resources"></a>Дополнительные ресурсы

* [Дополнительные учебники, которые созданы на основе hello Wingtip SaaS развертывания приложения](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)
* [Управление масштабируемыми облачными базами данных](sql-database-elastic-jobs-overview.md)
* [Создание развернутых баз данных SQL Azure и управление ими с помощью заданий обработки эластичных БД (предварительная версия)](sql-database-elastic-jobs-create-and-manage.md)
