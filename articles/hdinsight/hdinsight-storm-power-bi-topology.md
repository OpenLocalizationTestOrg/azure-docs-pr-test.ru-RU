---
title: "Использование Apache Storm с Power BI — Azure HDInsight | Документация Майкрософт"
description: "Создавайте отчеты Power BI на основе данных, собранных из топологии C#, запущенной в кластере Apache Storm в HDInsight."
services: hdinsight
documentationcenter: 
author: Blackmist
manager: jhubbard
editor: cgronlun
tags: azure-portal
ms.assetid: 36fe3b9c-5232-4464-8d75-95403b6da7a1
ms.service: hdinsight
ms.custom: hdinsightactive
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 05/31/2017
ms.author: larryfr
ms.openlocfilehash: 36487c0c34e5a4bb955bbc15c8c96b9e838aeb44
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="use-power-bi-to-visualize-data-from-an-apache-storm-topology"></a>Использование средств Power BI для визуализации данных из топологии Apache Storm

Power BI позволяет визуально представлять данные в виде отчетов. В этом документе приводится пример использования Apache Storm в HDInsight для создания данных для Power BI.

> [!NOTE]
> Для выполнения действий, описанных в этом документе, используется среда разработки Windows на основе Visual Studio. Скомпилированный проект можно передать в кластер HDInsight под управлением Linux. Топологии SCP.NET поддерживаются только теми кластерами под управлением Linux, которые созданы после 28 октября 2016 г.
>
> Чтобы использовать топологию C# с кластером под управлением Linux, обновите пакет NuGet Microsoft.SCP.Net.SDK, использующийся в проекте, до версии 0.10.0.6 или выше. Версия пакета также должна соответствовать основной версии Storm, установленной на HDInsight. Например, для Storm в HDInsight версии 3.3 и 3.4 используйте Storm версии 0.10.x, а HDInsight 3.5 использует Storm 1.0.x.
>
> Для топологии C# на кластерах под управлением Linux используется .NET 4.5. В кластере HDInsight они запускаются с помощью Mono. Большинство возможностей будут работать. Тем не менее вам следует просмотреть документ о [совместимости Mono](http://www.mono-project.com/docs/about-mono/compatibility/), чтобы определить потенциальные проблемы с совместимостью.
>
> Java-версию этого проекта, работающую с кластером HDInsight под управлением Linux или Windows, можно найти в статье [Обработка событий из службы концентраторов событий Azure с помощью Storm в HDInsight (Java)](hdinsight-storm-develop-java-event-hub-topology.md).

## <a name="prerequisites"></a>Предварительные требования

* Пользователь Azure Active Directory с доступом к [Power BI](https://powerbi.com).
* Кластер HDInsight. Дополнительные сведения см. в статье [Начало работы с Storm в HDInsight](hdinsight-apache-storm-tutorial-get-started-linux.md).

  > [!IMPORTANT]
  > Linux — единственная операционная система, используемая для работы с HDInsight 3.4 или более поздней версии. Дополнительные сведения см. в разделе [Приближается дата прекращения сопровождения HDI версии 3.3](hdinsight-component-versioning.md#hdinsight-windows-retirement).

* Одна из следующих версий Visual Studio:

  * Visual Studio 2012 с [обновлением 4](http://www.microsoft.com/download/details.aspx?id=39305)
  * Visual Studio 2013 с [обновлением 4](http://www.microsoft.com/download/details.aspx?id=44921) или [Visual Studio 2013 Community](http://go.microsoft.com/fwlink/?linkid=517284&clcid=0x409);
  * [Visual Studio 2015](https://www.visualstudio.com/downloads/download-visual-studio-vs.aspx)
  * Visual Studio 2017 (любой выпуск)

* Средства HDInsight для Visual Studio: сведения об установке см. в статье [Начало работы со средствами HDInsight для Visual Studio](hdinsight-hadoop-visual-studio-tools-get-started.md).

## <a name="how-it-works"></a>Принцип работы

В нашем примере используется топология C# Storm, которая случайным образом формирует данные журнала Internet Information Services (IIS). Эти данные затем записываются в базу данных SQL, на основе которой создаются отчеты в Power BI.

Ниже приведены файлы, которые реализуют основные функции для этого примера.

* **SqlAzureBolt.cs**: записывает в базу данных SQL сведения, созданные в топологии Storm.
* **IISLogsTable.sql**: содержит инструкции Transact-SQL, которые используются для создания базы данных, в которой хранятся сведения.

> [!WARNING]
> Перед запуском топологии в кластере HDInsight создайте таблицу в базе данных SQL.

## <a name="download-the-example"></a>Скачивание примера

Скачайте [пример Power BI с HDInsight C# Storm](https://github.com/Azure-Samples/hdinsight-dotnet-storm-powerbi). Для этого скопируйте или клонируйте его с помощью [git](http://git-scm.com/)либо используйте ссылку **Скачать** , чтобы скачать ZIP-файл архива.

## <a name="create-a-database"></a>Создание базы данных

1. Чтобы создать базу данных, следуйте инструкциям из [руководства по базе данных SQL](../sql-database/sql-database-get-started.md).

2. Подключитесь к базе данных, выполнив соответствующие инструкции из документа [Подключение к базе данных SQL с помощью Visual Studio](../sql-database/sql-database-connect-query.md).

3. В обозревателе объектов щелкните правой кнопкой мыши базу данных и выберите команду **Создать запрос**. Вставьте в окно запроса содержимое из файла **IISLogsTable.sql** , входящего в состав скачанного проекта, а затем нажмите клавиши Ctrl+Shift+E, чтобы выполнить этот запрос. Должно появиться сообщение о том, что выполнение команд успешно завершено.

## <a name="configure-the-sample"></a>Настройка примера

1. На [портале Azure](https://portal.azure.com)выберите свою базу данных SQL. В разделе **Основные компоненты** колонки базы данных SQL выберите **Показать строки подключения к базе данных**. В появившемся списке скопируйте сведения об **ADO.NET (проверка подлинности SQL)** .

2. Откройте пример в Visual Studio. В **обозревателе решений** откройте файл **App.config** и найдите в нем следующий элемент.

        <add key="SqlAzureConnectionString" value="##TOBEFILLED##" />

    Замените значение **##TOBEFILLED##** строкой подключения к базе данных, которую вы скопировали на предыдущем шаге. Замените строки **{your\_username}** и **{your\_password}** именем пользователя и паролем для базы данных, соответственно.

3. Сохраните и закройте файлы.

## <a name="deploy-the-sample"></a>Развертывание примера

1. В **обозревателе решений** щелкните правой кнопкой мыши проект **StormToSQL** и выберите **Submit to Storm on HDInsight** (Отправить в Storm в HDInsight). Выберите кластер HDInsight в раскрывающемся меню **Кластер Storm** .

   > [!NOTE]
   > Имена серверов могут появиться в раскрывающемся меню **Кластер Storm** только через несколько секунд.
   >
   > При появлении запроса введите учетные данные входа для своей подписки Azure. Если у вас несколько подписок, воспользуйтесь той, что содержит ваш кластер Storm в HDInsight.

2. После отправки топологии отобразится __средство просмотра топологий__. Чтобы просмотреть сведения об этой топологии, выберите в списке строку SqlAzureWriterTopology.

    ![Список топологий с выбранной топологией](./media/hdinsight-storm-power-bi-topology/topologyview.png)

    Это представление можно использовать для просмотра сведений о топологии. Также вы можете дважды щелкнуть запись (например, SqlAzureBolt), чтобы получить сведения о конкретном компоненте в топологии.

3. После нескольких минут выполнения топологии вернитесь в окно запроса SQL, в котором вы создавали базу данных. Замените имеющиеся инструкции следующим запросом:

        select * from iislogs;

    Нажмите клавиши CTRL+SHIFT+E, чтобы выполнить запрос. Результаты выполнения должны выглядеть следующим образом:

        1    2016-05-27 17:57:14.797    255.255.255.255    /bar    GET    200
        2    2016-05-27 17:57:14.843    127.0.0.1    /spam/eggs    POST    500
        3    2016-05-27 17:57:14.850    123.123.123.123    /eggs    DELETE    200
        4    2016-05-27 17:57:14.853    127.0.0.1    /foo    POST    404
        5    2016-05-27 17:57:14.853    10.9.8.7    /bar    GET    200
        6    2016-05-27 17:57:14.857    192.168.1.1    /spam    DELETE    200

    Это данные, которые записаны из топологии Storm.

## <a name="create-a-report"></a>Создание отчета

1. Подключитесь к [соединителю базы данных SQL Azure](https://app.powerbi.com/getdata/bigdata/azure-sql-database-with-live-connect) для Power BI. 

2. В элементе **Базы данных** выберите **Получить**.

3. Выберите **База данных SQL Azure** и щелкните **Подключиться**.

    > [!NOTE]
    > Может появиться предложение скачать Power BI Desktop для продолжения работы. В таком случае выполните следующие действия для подключения:
    >
    > 1. Откройте Power BI Desktop и выберите __Получение данных__.
    > 2. Выберите __Azure__, а затем __База данных SQL Azure__.

4. Введите сведения для подключения к базе данных SQL Azure. Эти сведения можно получить на [портале Azure](https://portal.azure.com), выбрав нужную базу данных SQL.

   > [!NOTE]
   > Вы также можете задать интервал обновления и настраиваемые фильтры с помощью элемента **Включить дополнительные параметры** в диалоговом окне подключения.

5. Когда подключение будет установлено, вы увидите новый набор данных с таким же именем, как у базы данных, к которой вы подключились. Выберите этот набор данных, чтобы приступить к созданию отчета.

6. В области **Поля** разверните элемент **IISLOGS**. Чтобы создать отчет, перечисляющий ресурсы URI, установите флажок **URISTEM**.

    ![Создание отчета](./media/hdinsight-storm-power-bi-topology/createreport.png)

7. Затем перетащите в отчет элемент **METHOD**. Обновленный отчет будет содержать не только ресурсы URI, но и соответствующие методы HTTP, которые использовались в HTTP-запросах.

    ![Добавление данных о методе](./media/hdinsight-storm-power-bi-topology/uristemandmethod.png)

8. В колонке **Визуализация** выберите значок **Поля**, а затем щелкните стрелку вниз рядом с элементом **METHOD** в разделе **Значения**. Чтобы отобразить счетчик доступа к конкретному URI, выберите **Счетчик**.

    ![Изменение числа методов](./media/hdinsight-storm-power-bi-topology/count.png)

9. Затем выберите вариант **Гистограмма с накоплением** , чтобы изменить способ отображения информации.

    ![Изменение диаграммы с накоплением](./media/hdinsight-storm-power-bi-topology/stackedcolumn.png)

10. Чтобы сохранить отчет, нажмите кнопку **Сохранить** и введите имя отчета.

## <a name="stop-the-topology"></a>Остановка топологии

Топология будет продолжать работу, пока вы не остановите ее или не удалите кластер Storm в HDInsight. Чтобы остановить топологию, выполните следующие действия.

1. В Visual Studio вернитесь в средство просмотра топологии и выберите топологию.

2. Нажмите кнопку **Завершить** , чтобы остановить топологию.

    ![Кнопка "Завершить" в сводке топологии](./media/hdinsight-storm-power-bi-topology/killtopology.png)

## <a name="delete-your-cluster"></a>Удаление кластера

[!INCLUDE [delete-cluster-warning](../../includes/hdinsight-delete-cluster-warning.md)]

## <a name="next-steps"></a>Дальнейшие действия

Из этого документа вы узнали, как отправлять данные из топологии Storm в базу данных SQL и визуализировать их с помощью Power BI. Дополнительные сведения об использовании Storm в HDInsight для работы с другими технологиями Azure, см. в следующем документе:

* [Примеры топологий для Storm в HDInsight](hdinsight-storm-example-topology.md)
