---
title: "Разработка действий с помощью HDInsight — Azure aaaScript | Документы Microsoft"
description: "Узнайте, как toocustomize Hadoop кластеры с действие сценария. Действие сценария можно дополнительное программное обеспечение используется tooinstall конфигурации Hadoop кластера или toochange hello приложений, установленных на кластер под управлением."
services: hdinsight
documentationcenter: 
tags: azure-portal
author: mumian
manager: jhubbard
editor: cgronlun
ms.assetid: 836d68a8-8b21-4d69-8b61-281a7fe67f21
ms.service: hdinsight
ms.workload: big-data
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/25/2017
ms.author: jgao
ROBOTS: NOINDEX
ms.openlocfilehash: 4fc3a389df8a003f7129ab00b4cd9bc7ad81a419
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="develop-script-action-scripts-for-hdinsight-windows-based-clusters"></a><span data-ttu-id="016b7-104">Разработка скриптов c действиями сценария для кластеров HDInsight под управлением Windows</span><span class="sxs-lookup"><span data-stu-id="016b7-104">Develop Script Action scripts for HDInsight Windows-based clusters</span></span>
<span data-ttu-id="016b7-105">Узнайте, как сценарии toowrite действия скрипта для HDInsight.</span><span class="sxs-lookup"><span data-stu-id="016b7-105">Learn how toowrite Script Action scripts for HDInsight.</span></span> <span data-ttu-id="016b7-106">Дополнительную информацию о скриптах с действиями сценария см. в статье [Настройка кластеров HDInsight под управлением Windows с помощью действия сценария](hdinsight-hadoop-customize-cluster.md).</span><span class="sxs-lookup"><span data-stu-id="016b7-106">For information on using Script Action scripts, see [Customize HDInsight clusters using Script Action](hdinsight-hadoop-customize-cluster.md).</span></span> <span data-ttu-id="016b7-107">Hello же статьи, написанные для кластеров HDInsight под управлением Linux. в разделе [сценариев разработки действий сценария для HDInsight](hdinsight-hadoop-script-actions-linux.md).</span><span class="sxs-lookup"><span data-stu-id="016b7-107">For hello same article written for Linux-based HDInsight clusters, see [Develop Script Action scripts for HDInsight](hdinsight-hadoop-script-actions-linux.md).</span></span>



> [!IMPORTANT]
> <span data-ttu-id="016b7-108">Hello шагов в работают только этот документ для кластеров HDInsight под управлением Windows.</span><span class="sxs-lookup"><span data-stu-id="016b7-108">hello steps in this document only work for Windows-based HDInsight clusters.</span></span> <span data-ttu-id="016b7-109">Для версий ниже HDInsight 3.4 кластер HDInsight доступен только в Windows.</span><span class="sxs-lookup"><span data-stu-id="016b7-109">HDInsight is only available on Windows for versions lower than HDInsight 3.4.</span></span> <span data-ttu-id="016b7-110">Linux — hello только операционную систему, используемую в HDInsight версии 3.4 или более поздней.</span><span class="sxs-lookup"><span data-stu-id="016b7-110">Linux is hello only operating system used on HDInsight version 3.4 or greater.</span></span> <span data-ttu-id="016b7-111">Дополнительные сведения см. в разделе [Приближается дата прекращения сопровождения HDI версии 3.3](hdinsight-component-versioning.md#hdinsight-windows-retirement).</span><span class="sxs-lookup"><span data-stu-id="016b7-111">For more information, see [HDInsight retirement on Windows](hdinsight-component-versioning.md#hdinsight-windows-retirement).</span></span> <span data-ttu-id="016b7-112">Сведения об использовании действий скриптов в кластерах на платформе Linux см. в статье, посвященной [разработке действий скриптов с помощью HDInsight в Linux](hdinsight-hadoop-script-actions-linux.md).</span><span class="sxs-lookup"><span data-stu-id="016b7-112">For information on using script actions with Linux-based clusters, see [Script action development with HDInsight (Linux)](hdinsight-hadoop-script-actions-linux.md).</span></span>
>
>



<span data-ttu-id="016b7-113">Действие сценария можно дополнительное программное обеспечение используется tooinstall конфигурации Hadoop кластера или toochange hello приложений, установленных на кластер под управлением.</span><span class="sxs-lookup"><span data-stu-id="016b7-113">Script Action can be used tooinstall additional software running on a Hadoop cluster or toochange hello configuration of applications installed on a cluster.</span></span> <span data-ttu-id="016b7-114">Действия сценариев, сценарии, которые выполняются на узлах кластера hello при развертывании кластеров HDInsight и они выполняются после узлов в кластере hello завершить конфигурацию HDInsight.</span><span class="sxs-lookup"><span data-stu-id="016b7-114">Script actions are scripts that run on hello cluster nodes when HDInsight clusters are deployed, and they are executed once nodes in hello cluster complete HDInsight configuration.</span></span> <span data-ttu-id="016b7-115">Действие сценария выполняется с правами учетной записи системного администратора и предоставляет права на полный доступ toohello узлов кластера.</span><span class="sxs-lookup"><span data-stu-id="016b7-115">A script action is executed under system admin account privileges and provides full access rights toohello cluster nodes.</span></span> <span data-ttu-id="016b7-116">Могут быть предоставлены каждого кластера со списком toobe действия сценариев выполняются в порядке hello, в котором они указаны.</span><span class="sxs-lookup"><span data-stu-id="016b7-116">Each cluster can be provided with a list of script actions toobe executed in hello order in which they are specified.</span></span>

> [!NOTE]
> <span data-ttu-id="016b7-117">При появлении hello следующие сообщение об ошибке:</span><span class="sxs-lookup"><span data-stu-id="016b7-117">If you experience hello following error message:</span></span>
>
> <span data-ttu-id="016b7-118">System.Management.Automation.CommandNotFoundException; ExceptionMessage: hello термин «Сохранить HDIFile» не распознан как имя командлета, функции, файла скрипта или действующей программы hello.</span><span class="sxs-lookup"><span data-stu-id="016b7-118">System.Management.Automation.CommandNotFoundException; ExceptionMessage : hello term 'Save-HDIFile' is not recognized as hello name of a cmdlet, function, script file, or operable program.</span></span> <span data-ttu-id="016b7-119">Проверьте правильность hello имени hello, или если был указан путь, убедитесь, что задан правильный путь, hello и повторите попытку.</span><span class="sxs-lookup"><span data-stu-id="016b7-119">Check hello spelling of hello name, or if a path was included, verify that hello path is correct and try again.</span></span>
> <span data-ttu-id="016b7-120">Это, поскольку не были включены hello вспомогательные методы.</span><span class="sxs-lookup"><span data-stu-id="016b7-120">It is because you didn't include hello helper methods.</span></span>  <span data-ttu-id="016b7-121">См. раздел [Вспомогательные методы для пользовательских скриптов](hdinsight-hadoop-script-actions.md#helper-methods-for-custom-scripts).</span><span class="sxs-lookup"><span data-stu-id="016b7-121">See [Helper methods for custom scripts](hdinsight-hadoop-script-actions.md#helper-methods-for-custom-scripts).</span></span>
>
>

## <a name="sample-scripts"></a><span data-ttu-id="016b7-122">Примеры сценариев</span><span class="sxs-lookup"><span data-stu-id="016b7-122">Sample scripts</span></span>
<span data-ttu-id="016b7-123">Для создания кластеров HDInsight в операционной системе Windows, hello действие сценария является скрипт Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="016b7-123">For creating HDInsight clusters on Windows operating system, hello Script Action is Azure PowerShell script.</span></span> <span data-ttu-id="016b7-124">Hello следующий сценарий — пример по настройке файлов конфигурации hello сайта:</span><span class="sxs-lookup"><span data-stu-id="016b7-124">hello following script is a sample for configuring hello site configuration files:</span></span>

[!INCLUDE [upgrade-powershell](../../includes/hdinsight-use-latest-powershell.md)]

    param (
        [parameter(Mandatory)][string] $ConfigFileName,
        [parameter(Mandatory)][string] $Name,
        [parameter(Mandatory)][string] $Value,
        [parameter()][string] $Description
    )

    if (!$Description) {
        $Description = ""
    }

    $hdiConfigFiles = @{
        "hive-site.xml" = "$env:HIVE_HOME\conf\hive-site.xml";
        "core-site.xml" = "$env:HADOOP_HOME\etc\hadoop\core-site.xml";
        "hdfs-site.xml" = "$env:HADOOP_HOME\etc\hadoop\hdfs-site.xml";
        "mapred-site.xml" = "$env:HADOOP_HOME\etc\hadoop\mapred-site.xml";
        "yarn-site.xml" = "$env:HADOOP_HOME\etc\hadoop\yarn-site.xml"
    }

    if (!($hdiConfigFiles[$ConfigFileName])) {
        Write-HDILog "Unable tooconfigure $ConfigFileName because it is not part of hello HDI configuration files."
        return
    }

    [xml]$configFile = Get-Content $hdiConfigFiles[$ConfigFileName]

    $existingproperty = $configFile.configuration.property | where {$_.Name -eq $Name}

    if ($existingproperty) {
        $existingproperty.Value = $Value
        $existingproperty.Description = $Description
    } else {
        $newproperty = @($configFile.configuration.property)[0].Clone()
        $newproperty.Name = $Name
        $newproperty.Value = $Value
        $newproperty.Description = $Description
        $configFile.configuration.AppendChild($newproperty)
    }

    $configFile.Save($hdiConfigFiles[$ConfigFileName])

    Write-HDILog "$configFileName has been configured."

<span data-ttu-id="016b7-125">сценарий Hello принимает четыре параметра, имя файла конфигурации hello hello свойство toomodify hello значение tooset, а также описание.</span><span class="sxs-lookup"><span data-stu-id="016b7-125">hello script takes four parameters, hello configuration file name, hello property you want toomodify, hello value you want tooset, and a description.</span></span> <span data-ttu-id="016b7-126">Например:</span><span class="sxs-lookup"><span data-stu-id="016b7-126">For example:</span></span>

    hive-site.xml hive.metastore.client.socket.timeout 90

<span data-ttu-id="016b7-127">Эти параметры задает too90 значение hive.metastore.client.socket.timeout hello hello hive-site.xml файла.</span><span class="sxs-lookup"><span data-stu-id="016b7-127">These parameters sets hello hive.metastore.client.socket.timeout value too90 in hello hive-site.xml file.</span></span>  <span data-ttu-id="016b7-128">значение по умолчанию Hello составляет 60 секунд.</span><span class="sxs-lookup"><span data-stu-id="016b7-128">hello default value is 60 seconds.</span></span>

<span data-ttu-id="016b7-129">Этот пример сценария также доступен по ссылке [https://hditutorialdata.blob.core.windows.net/customizecluster/editSiteConfig.ps1](https://hditutorialdata.blob.core.windows.net/customizecluster/editSiteConfig.ps1).</span><span class="sxs-lookup"><span data-stu-id="016b7-129">This sample script can also be found at [https://hditutorialdata.blob.core.windows.net/customizecluster/editSiteConfig.ps1](https://hditutorialdata.blob.core.windows.net/customizecluster/editSiteConfig.ps1).</span></span>

<span data-ttu-id="016b7-130">HDInsight содержится несколько скриптов tooinstall дополнительные компоненты в кластерах HDInsight:</span><span class="sxs-lookup"><span data-stu-id="016b7-130">HDInsight provides several scripts tooinstall additional components on HDInsight clusters:</span></span>

| <span data-ttu-id="016b7-131">Имя</span><span class="sxs-lookup"><span data-stu-id="016b7-131">Name</span></span> | <span data-ttu-id="016b7-132">Скрипт</span><span class="sxs-lookup"><span data-stu-id="016b7-132">Script</span></span> |
| --- | --- |
| <span data-ttu-id="016b7-133">**Установка Spark**</span><span class="sxs-lookup"><span data-stu-id="016b7-133">**Install Spark**</span></span> |<span data-ttu-id="016b7-134">https://hdiconfigactions.blob.core.windows.net/sparkconfigactionv03/spark-installer-v03.ps1.</span><span class="sxs-lookup"><span data-stu-id="016b7-134">https://hdiconfigactions.blob.core.windows.net/sparkconfigactionv03/spark-installer-v03.ps1.</span></span> <span data-ttu-id="016b7-135">Ознакомьтесь со статьей [Установка и использование Spark в кластерах HDInsight Hadoop с помощью действия сценария][hdinsight-install-spark].</span><span class="sxs-lookup"><span data-stu-id="016b7-135">See [Install and use Spark on HDInsight clusters][hdinsight-install-spark].</span></span> |
| <span data-ttu-id="016b7-136">**Установка R**</span><span class="sxs-lookup"><span data-stu-id="016b7-136">**Install R**</span></span> |<span data-ttu-id="016b7-137">https://hdiconfigactions.blob.core.windows.net/rconfigactionv02/r-installer-v02.ps1.</span><span class="sxs-lookup"><span data-stu-id="016b7-137">https://hdiconfigactions.blob.core.windows.net/rconfigactionv02/r-installer-v02.ps1.</span></span> <span data-ttu-id="016b7-138">Ознакомьтесь со статьей [Установка и использование R на кластерах HDInsight Hadoop][hdinsight-r-scripts].</span><span class="sxs-lookup"><span data-stu-id="016b7-138">See [Install and use R on HDInsight clusters][hdinsight-r-scripts].</span></span> |
| <span data-ttu-id="016b7-139">**Установка Solr**</span><span class="sxs-lookup"><span data-stu-id="016b7-139">**Install Solr**</span></span> |<span data-ttu-id="016b7-140">https://hdiconfigactions.blob.core.windows.net/solrconfigactionv01/solr-installer-v01.ps1.</span><span class="sxs-lookup"><span data-stu-id="016b7-140">https://hdiconfigactions.blob.core.windows.net/solrconfigactionv01/solr-installer-v01.ps1.</span></span> <span data-ttu-id="016b7-141">Ознакомьтесь со статьей [Установка и использование Solr в кластерах HDInsight](hdinsight-hadoop-solr-install.md).</span><span class="sxs-lookup"><span data-stu-id="016b7-141">See [Install and use Solr on HDInsight clusters](hdinsight-hadoop-solr-install.md).</span></span> |
| <span data-ttu-id="016b7-142">- **Установка Giraph**</span><span class="sxs-lookup"><span data-stu-id="016b7-142">- **Install Giraph**</span></span> |<span data-ttu-id="016b7-143">https://hdiconfigactions.blob.core.windows.net/giraphconfigactionv01/giraph-installer-v01.ps1.</span><span class="sxs-lookup"><span data-stu-id="016b7-143">https://hdiconfigactions.blob.core.windows.net/giraphconfigactionv01/giraph-installer-v01.ps1.</span></span> <span data-ttu-id="016b7-144">Ознакомьтесь со статьей [Установка и использование Giraph в кластерах HDInsight](hdinsight-hadoop-giraph-install.md).</span><span class="sxs-lookup"><span data-stu-id="016b7-144">See [Install and use Giraph on HDInsight clusters](hdinsight-hadoop-giraph-install.md).</span></span> |

<span data-ttu-id="016b7-145">Действие сценария могут быть восстановлены из hello портал Azure, Azure PowerShell или с помощью hello HDInsight .NET SDK.</span><span class="sxs-lookup"><span data-stu-id="016b7-145">Script Action can be deployed from hello Azure portal, Azure PowerShell or by using hello HDInsight .NET SDK.</span></span>  <span data-ttu-id="016b7-146">Дополнительные сведения см. в статье [Настройка кластеров HDInsight под управлением Windows с помощью действия сценария][hdinsight-cluster-customize].</span><span class="sxs-lookup"><span data-stu-id="016b7-146">For more information, see [Customize HDInsight clusters using Script Action][hdinsight-cluster-customize].</span></span>

> [!NOTE]
> <span data-ttu-id="016b7-147">Примеры сценариев Hello работать только с кластера HDInsight версии 3.1 или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="016b7-147">hello sample scripts work only with HDInsight cluster version 3.1 or above.</span></span> <span data-ttu-id="016b7-148">Дополнительную информацию о версиях кластера HDInsight см. в статье [Что представляют собой различные компоненты Hadoop, доступные в HDInsight](hdinsight-component-versioning.md).</span><span class="sxs-lookup"><span data-stu-id="016b7-148">For more information on HDInsight cluster versions, see [HDInsight cluster versions](hdinsight-component-versioning.md).</span></span>
>
>

## <a name="helper-methods-for-custom-scripts"></a><span data-ttu-id="016b7-149">Вспомогательные методы для пользовательских скриптов</span><span class="sxs-lookup"><span data-stu-id="016b7-149">Helper methods for custom scripts</span></span>
<span data-ttu-id="016b7-150">Вспомогательные методы действий скриптов представляют собой служебные программы, которые можно использовать при создании пользовательских скриптов.</span><span class="sxs-lookup"><span data-stu-id="016b7-150">Script Action helper methods are utilities that you can use while writing custom scripts.</span></span> <span data-ttu-id="016b7-151">Эти методы определяются в [https://hdiconfigactions.blob.core.windows.net/configactionmodulev05/HDInsightUtilities-v05.psm1](https://hdiconfigactions.blob.core.windows.net/configactionmodulev05/HDInsightUtilities-v05.psm1)и могут быть включены в сценарии, используя следующий образец hello:</span><span class="sxs-lookup"><span data-stu-id="016b7-151">These methods are defined in [https://hdiconfigactions.blob.core.windows.net/configactionmodulev05/HDInsightUtilities-v05.psm1](https://hdiconfigactions.blob.core.windows.net/configactionmodulev05/HDInsightUtilities-v05.psm1), and can be included in your scripts using hello following sample:</span></span>

    # Download config action module from a well-known directory.
    $CONFIGACTIONURI = "https://hdiconfigactions.blob.core.windows.net/configactionmodulev05/HDInsightUtilities-v05.psm1";
    $CONFIGACTIONMODULE = "C:\apps\dist\HDInsightUtilities.psm1";
    $webclient = New-Object System.Net.WebClient;
    $webclient.DownloadFile($CONFIGACTIONURI, $CONFIGACTIONMODULE);

    # (TIP) Import config action helper method module toomake writing config action easy.
    if (Test-Path ($CONFIGACTIONMODULE))
    {
        Import-Module $CONFIGACTIONMODULE;
    }
    else
    {
        Write-Output "Failed tooload HDInsightUtilities module, exiting ...";
        exit;
    }

<span data-ttu-id="016b7-152">Ниже приведены hello вспомогательные методы, предоставляемые этим сценарием.</span><span class="sxs-lookup"><span data-stu-id="016b7-152">Here are hello helper methods that are provided by this script:</span></span>

| <span data-ttu-id="016b7-153">Вспомогательный метод</span><span class="sxs-lookup"><span data-stu-id="016b7-153">Helper method</span></span> | <span data-ttu-id="016b7-154">Описание</span><span class="sxs-lookup"><span data-stu-id="016b7-154">Description</span></span> |
| --- | --- |
| <span data-ttu-id="016b7-155">**Save-HDIFile**</span><span class="sxs-lookup"><span data-stu-id="016b7-155">**Save-HDIFile**</span></span> |<span data-ttu-id="016b7-156">Загрузка файла с hello определенное место tooa универсальный код ресурса (URI) на локальном диске hello, связанного с кластером назначенного toohello узла виртуальной Машины Azure hello.</span><span class="sxs-lookup"><span data-stu-id="016b7-156">Download a file from hello specified Uniform Resource Identifier (URI) tooa location on hello local disk that is associated with hello Azure VM node assigned toohello cluster.</span></span> |
| <span data-ttu-id="016b7-157">**Expand-HDIZippedFile**</span><span class="sxs-lookup"><span data-stu-id="016b7-157">**Expand-HDIZippedFile**</span></span> |<span data-ttu-id="016b7-158">Распаковывает ZIP-файл.</span><span class="sxs-lookup"><span data-stu-id="016b7-158">Unzip a zipped file.</span></span> |
| <span data-ttu-id="016b7-159">**Invoke-HDICmdScript**</span><span class="sxs-lookup"><span data-stu-id="016b7-159">**Invoke-HDICmdScript**</span></span> |<span data-ttu-id="016b7-160">Запускает сценарий из cmd.exe.</span><span class="sxs-lookup"><span data-stu-id="016b7-160">Run a script from cmd.exe.</span></span> |
| <span data-ttu-id="016b7-161">**Write-HDILog**</span><span class="sxs-lookup"><span data-stu-id="016b7-161">**Write-HDILog**</span></span> |<span data-ttu-id="016b7-162">Записывать выходные данные из hello пользовательского скрипта для действия сценария.</span><span class="sxs-lookup"><span data-stu-id="016b7-162">Write output from hello custom script used for a script action.</span></span> |
| <span data-ttu-id="016b7-163">**Get-Services**</span><span class="sxs-lookup"><span data-stu-id="016b7-163">**Get-Services**</span></span> |<span data-ttu-id="016b7-164">Получите список служб, запущенных на компьютере hello, где hello скрипт будет выполнен.</span><span class="sxs-lookup"><span data-stu-id="016b7-164">Get a list of services running on hello machine where hello script executes.</span></span> |
| <span data-ttu-id="016b7-165">**Get-Service**</span><span class="sxs-lookup"><span data-stu-id="016b7-165">**Get-Service**</span></span> |<span data-ttu-id="016b7-166">Hello определенным именем службы в качестве входного, получить подробные сведения для конкретной службы (имя службы, обработки кода, состояние, т. д.) на компьютере hello, где выполняется сценарий hello.</span><span class="sxs-lookup"><span data-stu-id="016b7-166">With hello specific service name as input, get detailed information for a specific service (service name, process ID, state, etc.) on hello machine where hello script executes.</span></span> |
| <span data-ttu-id="016b7-167">**Get-HDIServices**</span><span class="sxs-lookup"><span data-stu-id="016b7-167">**Get-HDIServices**</span></span> |<span data-ttu-id="016b7-168">Получите список служб HDInsight, запущенного на компьютере hello, где выполняется сценарий hello.</span><span class="sxs-lookup"><span data-stu-id="016b7-168">Get a list of HDInsight services running on hello computer where hello script executes.</span></span> |
| <span data-ttu-id="016b7-169">**Get-HDIService**</span><span class="sxs-lookup"><span data-stu-id="016b7-169">**Get-HDIService**</span></span> |<span data-ttu-id="016b7-170">Именем hello конкретных HDInsight службы как входные данные, получить подробные сведения для конкретной службы (имя службы, обработки кода, состояние, т. д.) на компьютере hello, где выполняется сценарий hello.</span><span class="sxs-lookup"><span data-stu-id="016b7-170">With hello specific HDInsight service name as input, get detailed information for a specific service (service name, process ID, state, etc.) on hello machine where hello script executes.</span></span> |
| <span data-ttu-id="016b7-171">**Get-ServicesRunning**</span><span class="sxs-lookup"><span data-stu-id="016b7-171">**Get-ServicesRunning**</span></span> |<span data-ttu-id="016b7-172">Получите список служб, запущенных на компьютере hello где hello скрипт будет выполнен.</span><span class="sxs-lookup"><span data-stu-id="016b7-172">Get a list of services that are running on hello computer where hello script executes.</span></span> |
| <span data-ttu-id="016b7-173">**Get-ServiceRunning**</span><span class="sxs-lookup"><span data-stu-id="016b7-173">**Get-ServiceRunning**</span></span> |<span data-ttu-id="016b7-174">Проверьте, если определенной службы (по имени) выполняется на компьютере hello где hello скрипт будет выполнен.</span><span class="sxs-lookup"><span data-stu-id="016b7-174">Check if a specific service (by name) is running on hello computer where hello script executes.</span></span> |
| <span data-ttu-id="016b7-175">**Get-HDIServicesRunning**</span><span class="sxs-lookup"><span data-stu-id="016b7-175">**Get-HDIServicesRunning**</span></span> |<span data-ttu-id="016b7-176">Получите список служб HDInsight, запущенного на компьютере hello, где выполняется сценарий hello.</span><span class="sxs-lookup"><span data-stu-id="016b7-176">Get a list of HDInsight services running on hello computer where hello script executes.</span></span> |
| <span data-ttu-id="016b7-177">**Get-HDIServiceRunning**</span><span class="sxs-lookup"><span data-stu-id="016b7-177">**Get-HDIServiceRunning**</span></span> |<span data-ttu-id="016b7-178">Проверьте, если определенной службы HDInsight (по имени) выполняется на компьютере hello где hello скрипт будет выполнен.</span><span class="sxs-lookup"><span data-stu-id="016b7-178">Check if a specific HDInsight service (by name) is running on hello computer where hello script executes.</span></span> |
| <span data-ttu-id="016b7-179">**Get-HDIHadoopVersion**</span><span class="sxs-lookup"><span data-stu-id="016b7-179">**Get-HDIHadoopVersion**</span></span> |<span data-ttu-id="016b7-180">Получите версию hello Hadoop на компьютере hello, где выполняется сценарий hello.</span><span class="sxs-lookup"><span data-stu-id="016b7-180">Get hello version of Hadoop installed on hello computer where hello script executes.</span></span> |
| <span data-ttu-id="016b7-181">**Test-IsHDIHeadNode**</span><span class="sxs-lookup"><span data-stu-id="016b7-181">**Test-IsHDIHeadNode**</span></span> |<span data-ttu-id="016b7-182">Проверьте, является ли hello компьютера, где выполняется сценарий hello головного узла.</span><span class="sxs-lookup"><span data-stu-id="016b7-182">Check if hello computer where hello script executes is a head node.</span></span> |
| <span data-ttu-id="016b7-183">**Test-IsActiveHDIHeadNode**</span><span class="sxs-lookup"><span data-stu-id="016b7-183">**Test-IsActiveHDIHeadNode**</span></span> |<span data-ttu-id="016b7-184">Проверьте, является ли hello компьютера, где выполняется сценарий hello активного головного узла.</span><span class="sxs-lookup"><span data-stu-id="016b7-184">Check if hello computer where hello script executes is an active head node.</span></span> |
| <span data-ttu-id="016b7-185">**Test-IsHDIDataNode**</span><span class="sxs-lookup"><span data-stu-id="016b7-185">**Test-IsHDIDataNode**</span></span> |<span data-ttu-id="016b7-186">Проверьте, является ли hello компьютера, где выполняется сценарий hello узел данных.</span><span class="sxs-lookup"><span data-stu-id="016b7-186">Check if hello computer where hello script executes is a data node.</span></span> |
| <span data-ttu-id="016b7-187">**Edit-HDIConfigFile**</span><span class="sxs-lookup"><span data-stu-id="016b7-187">**Edit-HDIConfigFile**</span></span> |<span data-ttu-id="016b7-188">Измените файлы конфигурации hello hive-site.xml, core-site.xml, hdfs-site.xml, mapred-site.xml или yarn-site.xml.</span><span class="sxs-lookup"><span data-stu-id="016b7-188">Edit hello config files hive-site.xml, core-site.xml, hdfs-site.xml, mapred-site.xml, or yarn-site.xml.</span></span> |

## <a name="best-practices-for-script-development"></a><span data-ttu-id="016b7-189">Рекомендации по разработке скриптов</span><span class="sxs-lookup"><span data-stu-id="016b7-189">Best practices for script development</span></span>
<span data-ttu-id="016b7-190">При разработке пользовательского скрипта для кластера HDInsight, существует несколько лучшие методики tookeep помнить:</span><span class="sxs-lookup"><span data-stu-id="016b7-190">When you develop a custom script for an HDInsight cluster, there are several best practices tookeep in mind:</span></span>

* <span data-ttu-id="016b7-191">Проверка версии Hadoop hello</span><span class="sxs-lookup"><span data-stu-id="016b7-191">Check for hello Hadoop version</span></span>

    <span data-ttu-id="016b7-192">Только в HDInsight версии 3.1 (Hadoop 2.4) и выше поддерживается использование пользовательских компонентов tooinstall действие сценария в кластере.</span><span class="sxs-lookup"><span data-stu-id="016b7-192">Only HDInsight version 3.1 (Hadoop 2.4) and above support using Script Action tooinstall custom components on a cluster.</span></span> <span data-ttu-id="016b7-193">В пользовательском скрипте, необходимо использовать hello **Get HDIHadoopVersion** версии вспомогательный метод toocheck hello Hadoop, перед тем как продолжить выполнение других задач в скрипте hello.</span><span class="sxs-lookup"><span data-stu-id="016b7-193">In your custom script, you must use hello **Get-HDIHadoopVersion** helper method toocheck hello Hadoop version before proceeding with performing other tasks in hello script.</span></span>
* <span data-ttu-id="016b7-194">Обеспечить стабильность связывает tooscript ресурсы</span><span class="sxs-lookup"><span data-stu-id="016b7-194">Provide stable links tooscript resources</span></span>

    <span data-ttu-id="016b7-195">Пользователям следует убедиться, все сценарии hello и другие артефакты, использовать в настройке hello кластера остаются доступными во время существования hello hello кластера и что hello версии этих файлов не изменяет время hello.</span><span class="sxs-lookup"><span data-stu-id="016b7-195">Users should make sure that all hello scripts and other artifacts used in hello customization of a cluster remain available throughout hello lifetime of hello cluster and that hello versions of these files do not change for hello duration.</span></span> <span data-ttu-id="016b7-196">Эти ресурсы необходимы, если требуется повторное создание образа hello узлов в кластере hello.</span><span class="sxs-lookup"><span data-stu-id="016b7-196">These resources are required if hello reimaging of nodes in hello cluster is required.</span></span> <span data-ttu-id="016b7-197">Рекомендуется Hello является toodownload и архивировать все данные в учетной записи хранения, hello пользовательских элементов управления.</span><span class="sxs-lookup"><span data-stu-id="016b7-197">hello best practice is toodownload and archive everything in a Storage account that hello user controls.</span></span> <span data-ttu-id="016b7-198">Это может быть учетная запись хранения по умолчанию hello или любой hello дополнительных учетных записей хранения, указанного во время развертывания для кластера, настроенного для hello.</span><span class="sxs-lookup"><span data-stu-id="016b7-198">This can be hello default Storage account or any of hello additional Storage accounts specified at hello time of deployment for a customized cluster.</span></span>
    <span data-ttu-id="016b7-199">В hello Spark и R настроена образцы кластера предоставляемых в документации hello, например, мы внесли локальную копию hello ресурсы этой учетной записи хранения: https://hdiconfigactions.blob.core.windows.net/.</span><span class="sxs-lookup"><span data-stu-id="016b7-199">In hello Spark and R customized cluster samples provided in hello documentation, for example, we have made a local copy of hello resources in this Storage account: https://hdiconfigactions.blob.core.windows.net/.</span></span>
* <span data-ttu-id="016b7-200">Убедитесь, что скрипт настройки кластера hello идемпотентными</span><span class="sxs-lookup"><span data-stu-id="016b7-200">Ensure that hello cluster customization script is idempotent</span></span>

    <span data-ttu-id="016b7-201">Следует ожидать, что за время существования кластера hello повторном создании hello узлы кластера HDInsight.</span><span class="sxs-lookup"><span data-stu-id="016b7-201">You must expect that hello nodes of an HDInsight cluster is reimaged during hello cluster lifetime.</span></span> <span data-ttu-id="016b7-202">скрипт настройки кластера Hello выполняется при каждом повторном создании кластера.</span><span class="sxs-lookup"><span data-stu-id="016b7-202">hello cluster customization script is run whenever a cluster is reimaged.</span></span> <span data-ttu-id="016b7-203">Этот сценарий должны быть идемпотентными спроектированный toobe в смысле hello, при осуществлении, скрипт hello следует убедиться, что данный кластер hello возвращается toohello же настроить состояние, которое было сразу после hello скрипт был выполнен для hello первый раз, когда изначально был кластер hello создать.</span><span class="sxs-lookup"><span data-stu-id="016b7-203">This script must be designed toobe idempotent in hello sense that upon reimaging, hello script should ensure that hello cluster is returned toohello same customized state that it was in just after hello script ran for hello first time when hello cluster was initially created.</span></span> <span data-ttu-id="016b7-204">Например пользовательский сценарий установки приложения в D:\AppLocation на своего первого запуска, то при каждом последующем запуске при осуществлении, скрипт hello следует проверить, существует ли приложение hello в hello местоположение D:\AppLocation перед продолжением работы с другими в шагах hello скрипта.</span><span class="sxs-lookup"><span data-stu-id="016b7-204">For example, if a custom script installed an application at D:\AppLocation on its first run, then on each subsequent run, upon reimaging, hello script should check whether hello application exists at hello D:\AppLocation location before proceeding with other steps in hello script.</span></span>
* <span data-ttu-id="016b7-205">Установка пользовательских компонентов в оптимальное расположение hello</span><span class="sxs-lookup"><span data-stu-id="016b7-205">Install custom components in hello optimal location</span></span>

    <span data-ttu-id="016b7-206">При повторном создании кластера узлов диск ресурсов C:\ hello и системного диска D:\ может быть переформатированы, приведет к потере hello данных и приложений, которые были установлены на этих дисках.</span><span class="sxs-lookup"><span data-stu-id="016b7-206">When cluster nodes are reimaged, hello C:\ resource drive and D:\ system drive can be reformatted, resulting in hello loss of data and applications that had been installed on those drives.</span></span> <span data-ttu-id="016b7-207">Это также может произойти, если узел виртуальной машины (VM) Azure, являющийся частью кластера hello выходит из строя и заменяется на новый узел.</span><span class="sxs-lookup"><span data-stu-id="016b7-207">This could also happen if an Azure virtual machine (VM) node that is part of hello cluster goes down and is replaced by a new node.</span></span> <span data-ttu-id="016b7-208">Компоненты можно установить на диск D:\ hello или в месте C:\apps hello в кластере hello.</span><span class="sxs-lookup"><span data-stu-id="016b7-208">You can install components on hello D:\ drive or in hello C:\apps location on hello cluster.</span></span> <span data-ttu-id="016b7-209">Все расположения на диске C:\ hello зарезервированы.</span><span class="sxs-lookup"><span data-stu-id="016b7-209">All other locations on hello C:\ drive are reserved.</span></span> <span data-ttu-id="016b7-210">Укажите hello места, где приложений или библиотек toobe, установленные в скрипт настройки кластера hello.</span><span class="sxs-lookup"><span data-stu-id="016b7-210">Specify hello location where applications or libraries are toobe installed in hello cluster customization script.</span></span>
* <span data-ttu-id="016b7-211">Обеспечить высокий уровень доступности кластера архитектура hello</span><span class="sxs-lookup"><span data-stu-id="016b7-211">Ensure high availability of hello cluster architecture</span></span>

    <span data-ttu-id="016b7-212">HDInsight имеет активный / пассивный архитектуру для обеспечения высокой доступности, в какие один головной узел находится в активном режиме (где запущены службы HDInsight hello) и другие hello головной узел находится в режиме ожидания (в которой HDInsight не запущены службы).</span><span class="sxs-lookup"><span data-stu-id="016b7-212">HDInsight has an active-passive architecture for high availability, in which one head node is in active mode (where hello HDInsight services are running) and hello other head node is in standby mode (in which HDInsight services are not running).</span></span> <span data-ttu-id="016b7-213">Hello узлов переключить активных и пассивных Если прерываются службы HDInsight.</span><span class="sxs-lookup"><span data-stu-id="016b7-213">hello nodes switch active and passive modes if HDInsight services are interrupted.</span></span> <span data-ttu-id="016b7-214">Если действие сценария используется tooinstall на оба головного узла высокий уровень доступности служб, обратите внимание, что этот механизм отработки отказа HDInsight hello не может tooautomatically сбой по эти службы, устанавливаемые пользователем.</span><span class="sxs-lookup"><span data-stu-id="016b7-214">If a script action is used tooinstall services on both head nodes for high availability, note that hello HDInsight failover mechanism is not able tooautomatically fail over these user-installed services.</span></span> <span data-ttu-id="016b7-215">Таким образом пользователь установил службы на HDInsight головного узла, ожидаемый toobe высокой доступности необходимо иметь собственный механизм отработки отказа в режиме "активный пассивный" или находиться в режиме активный активный.</span><span class="sxs-lookup"><span data-stu-id="016b7-215">So user-installed services on HDInsight head nodes that are expected toobe highly available must either have their own failover mechanism if in active-passive mode or be in active-active mode.</span></span>

    <span data-ttu-id="016b7-216">Действие HDInsight сценария команды выполняются на оба головного узла роли hello головной узел указан как значение в hello *ClusterRoleCollection* параметра.</span><span class="sxs-lookup"><span data-stu-id="016b7-216">An HDInsight Script Action command runs on both head nodes when hello head-node role is specified as a value in hello *ClusterRoleCollection* parameter.</span></span> <span data-ttu-id="016b7-217">Поэтому при разработке пользовательского скрипта убедитесь, что в скрипте учтены эти особенности установки.</span><span class="sxs-lookup"><span data-stu-id="016b7-217">So when you design a custom script, make sure that your script is aware of this setup.</span></span> <span data-ttu-id="016b7-218">Не следует запускать возникают проблемы, где hello и теми же службами установлена и запущена на обоих hello головного узла, и они в конечном итоге конкурируют друг с другом.</span><span class="sxs-lookup"><span data-stu-id="016b7-218">You should not run into problems where hello same services are installed and started on both of hello head nodes and they end up competing with each other.</span></span> <span data-ttu-id="016b7-219">Также следует помнить, что данные теряются при осуществлении, поэтому программное обеспечение, установленное с помощью сценария действия имеет toobe устойчивым toosuch событий.</span><span class="sxs-lookup"><span data-stu-id="016b7-219">Also, be aware that data is lost during reimaging, so software installed via Script Action has toobe resilient toosuch events.</span></span> <span data-ttu-id="016b7-220">Приложения должны быть спроектированный toowork с высокой доступности данных, который распределяется на множество узлов.</span><span class="sxs-lookup"><span data-stu-id="016b7-220">Applications should be designed toowork with highly available data that is distributed across many nodes.</span></span> <span data-ttu-id="016b7-221">Обратите внимание, что как 1/5 hello узлов в кластере можно повторно создать образ на hello то же время.</span><span class="sxs-lookup"><span data-stu-id="016b7-221">Note that as many as 1/5 of hello nodes in a cluster can be reimaged at hello same time.</span></span>
* <span data-ttu-id="016b7-222">Настройка хранилища больших двоичных объектов Azure toouse пользовательские компоненты hello</span><span class="sxs-lookup"><span data-stu-id="016b7-222">Configure hello custom components toouse Azure Blob storage</span></span>

    <span data-ttu-id="016b7-223">Возможно, Hello пользовательских компонентов, установленных на узлах кластера hello toouse конфигурации по умолчанию хранилище системы распределенных файла Hadoop (HDFS).</span><span class="sxs-lookup"><span data-stu-id="016b7-223">hello custom components that you install on hello cluster nodes might have a default configuration toouse Hadoop Distributed File System (HDFS) storage.</span></span> <span data-ttu-id="016b7-224">Вместо этого следует изменить toouse hello конфигурации хранилища больших двоичных объектов Azure.</span><span class="sxs-lookup"><span data-stu-id="016b7-224">You should change hello configuration toouse Azure Blob storage instead.</span></span> <span data-ttu-id="016b7-225">На повторное создание образа кластера возвращает в формате файловой системы HDFS hello и будут потеряны все данные, хранящиеся в ней.</span><span class="sxs-lookup"><span data-stu-id="016b7-225">On a cluster reimage, hello HDFS file system gets formatted and you would lose any data that is stored there.</span></span> <span data-ttu-id="016b7-226">В случае использования хранилища BLOB-объектов Azure эти данные сохраняются.</span><span class="sxs-lookup"><span data-stu-id="016b7-226">Using Azure Blob storage instead ensures that your data is retained.</span></span>

## <a name="common-usage-patterns"></a><span data-ttu-id="016b7-227">Общие варианты использования</span><span class="sxs-lookup"><span data-stu-id="016b7-227">Common usage patterns</span></span>
<span data-ttu-id="016b7-228">В этом разделе приводятся рекомендации по реализации некоторых hello распространенных шаблонов использования, вы можете столкнуться при написании пользовательского скрипта.</span><span class="sxs-lookup"><span data-stu-id="016b7-228">This section provides guidance on implementing some of hello common usage patterns that you might run into while writing your own custom script.</span></span>

### <a name="configure-environment-variables"></a><span data-ttu-id="016b7-229">Настройка переменных среды</span><span class="sxs-lookup"><span data-stu-id="016b7-229">Configure environment variables</span></span>
<span data-ttu-id="016b7-230">Часто в действие разработки сценариев, вы считаете, что необходимые переменные среды tooset hello.</span><span class="sxs-lookup"><span data-stu-id="016b7-230">Often in script action development, you feel hello need tooset environment variables.</span></span> <span data-ttu-id="016b7-231">Например наиболее вероятный сценарий при загрузить двоичный файл внешнего узла, установите его на кластере hello и добавить к расположению hello там, где это переменной среды «PATH» установленных tooyour.</span><span class="sxs-lookup"><span data-stu-id="016b7-231">For instance, a most likely scenario is when you download a binary from an external site, install it on hello cluster, and add hello location of where it is installed tooyour ‘PATH’ environment variable.</span></span> <span data-ttu-id="016b7-232">Hello, следующий фрагмент кода показывает, как переменные среды tooset в hello пользовательского скрипта.</span><span class="sxs-lookup"><span data-stu-id="016b7-232">hello following snippet shows you how tooset environment variables in hello custom script.</span></span>

    Write-HDILog "Starting environment variable setting at: $(Get-Date)";
    [Environment]::SetEnvironmentVariable('MDS_RUNNER_CUSTOM_CLUSTER', 'true', 'Machine');

<span data-ttu-id="016b7-233">Эта инструкция задает переменную среды hello **MDS_RUNNER_CUSTOM_CLUSTER** toohello значение «true», а также задает hello области этой переменной toobe компьютера.</span><span class="sxs-lookup"><span data-stu-id="016b7-233">This statement sets hello environment variable **MDS_RUNNER_CUSTOM_CLUSTER** toohello value 'true' and also sets hello scope of this variable toobe machine-wide.</span></span> <span data-ttu-id="016b7-234">В некоторых случаях важно, переменные среды задаются в соответствующей области hello — компьютера или пользователя.</span><span class="sxs-lookup"><span data-stu-id="016b7-234">At times it is important that environment variables are set at hello appropriate scope – machine or user.</span></span> <span data-ttu-id="016b7-235">Дополнительные сведения о настройке переменных среды см. [здесь][1].</span><span class="sxs-lookup"><span data-stu-id="016b7-235">Refer [here][1] for more information on setting environment variables.</span></span>

### <a name="access-toolocations-where-hello-custom-scripts-are-stored"></a><span data-ttu-id="016b7-236">Доступ к toolocations, где хранятся пользовательские сценарии hello</span><span class="sxs-lookup"><span data-stu-id="016b7-236">Access toolocations where hello custom scripts are stored</span></span>
<span data-ttu-id="016b7-237">Скрипты, используемые toocustomize tooeither потребностей кластера находиться в учетной записи хранения по умолчанию hello для кластера hello или в открытый контейнер только для чтения в любой другой учетной записи хранилища.</span><span class="sxs-lookup"><span data-stu-id="016b7-237">Scripts used toocustomize a cluster needs tooeither be in hello default storage account for hello cluster or in a public read-only container on any other storage account.</span></span> <span data-ttu-id="016b7-238">Если сценарий получает доступ к ресурсам, расположенным в другом месте их необходимы toobe в общедоступном (по крайней мере открытый только для чтения).</span><span class="sxs-lookup"><span data-stu-id="016b7-238">If your script accesses resources located elsewhere these need toobe in a publicly accessible (at least public read-only).</span></span> <span data-ttu-id="016b7-239">Для экземпляра может tooaccess файл и сохраните его при помощи команды hello SaveFile HDI.</span><span class="sxs-lookup"><span data-stu-id="016b7-239">For instance you might want tooaccess a file and save it using hello SaveFile-HDI command.</span></span>

    Save-HDIFile -SrcUri 'https://somestorageaccount.blob.core.windows.net/somecontainer/some-file.jar' -DestFile 'C:\apps\dist\hadoop-2.4.0.2.1.9.0-2196\share\hadoop\mapreduce\some-file.jar'

<span data-ttu-id="016b7-240">В этом примере необходимо убедиться, что этот контейнер hello «somecontainer» в учетной записи хранения «somestorageaccount» является общедоступным.</span><span class="sxs-lookup"><span data-stu-id="016b7-240">In this example, you must ensure that hello container 'somecontainer' in storage account 'somestorageaccount' is publicly accessible.</span></span> <span data-ttu-id="016b7-241">В противном случае hello сценарий создает исключение «Не найдено» и сбой.</span><span class="sxs-lookup"><span data-stu-id="016b7-241">Otherwise, hello script throws a ‘Not Found’ exception and fail.</span></span>

### <a name="pass-parameters-toohello-add-azurermhdinsightscriptaction-cmdlet"></a><span data-ttu-id="016b7-242">Передайте в командлет Add-AzureRmHDInsightScriptAction toohello параметров</span><span class="sxs-lookup"><span data-stu-id="016b7-242">Pass parameters toohello Add-AzureRmHDInsightScriptAction cmdlet</span></span>
<span data-ttu-id="016b7-243">toopass командлета toohello AzureRmHDInsightScriptAction добавить несколько параметров, необходимо tooformat hello строковое значение toocontain все параметры для скрипта hello.</span><span class="sxs-lookup"><span data-stu-id="016b7-243">toopass multiple parameters toohello Add-AzureRmHDInsightScriptAction cmdlet, you need tooformat hello string value toocontain all parameters for hello script.</span></span> <span data-ttu-id="016b7-244">Например:</span><span class="sxs-lookup"><span data-stu-id="016b7-244">For example:</span></span>

    "-CertifcateUri wasb:///abc.pfx -CertificatePassword 123456 -InstallFolderName MyFolder"

<span data-ttu-id="016b7-245">или</span><span class="sxs-lookup"><span data-stu-id="016b7-245">or</span></span>

    $parameters = '-Parameters "{0};{1};{2}"' -f $CertificateName,$certUriWithSasToken,$CertificatePassword


### <a name="throw-exception-for-failed-cluster-deployment"></a><span data-ttu-id="016b7-246">Вызов исключения при сбое развертывания кластера</span><span class="sxs-lookup"><span data-stu-id="016b7-246">Throw exception for failed cluster deployment</span></span>
<span data-ttu-id="016b7-247">Если вы хотите tooget точно уведомление факта hello настройки кластера не выполнена должным образом, а является важным toothrow исключение и сбой создания кластера hello.</span><span class="sxs-lookup"><span data-stu-id="016b7-247">If you want tooget accurately notified of hello fact that cluster customization did not succeed as expected, it is important toothrow an exception and fail hello cluster creation.</span></span> <span data-ttu-id="016b7-248">Для экземпляра может потребоваться tooprocess файл, если он существует и обрабатывать такие ошибки hello, где hello файл не существует.</span><span class="sxs-lookup"><span data-stu-id="016b7-248">For instance, you might want tooprocess a file if it exists and handle hello error case where hello file does not exist.</span></span> <span data-ttu-id="016b7-249">Благодаря что завершал скрипт hello и состояние hello hello кластера правильно известно.</span><span class="sxs-lookup"><span data-stu-id="016b7-249">This would ensure that hello script exits gracefully and hello state of hello cluster is correctly known.</span></span> <span data-ttu-id="016b7-250">Hello следующий фрагмент кода приведен пример того, как tooachieve это:</span><span class="sxs-lookup"><span data-stu-id="016b7-250">hello following snippet gives an example of how tooachieve this:</span></span>

    If(Test-Path($SomePath)) {
        #Process file in some way
    } else {
        # File does not exist; handle error case
        # Print error message
    exit
    }

<span data-ttu-id="016b7-251">В этом фрагменте кода если hello файл не существовал, он приведет tooa состоянии, которое hello скрипт фактически завершал после печати hello сообщение hello кластера достигает рабочее состояние, при условии, что он «успешно» завершения процесса настройки кластера.</span><span class="sxs-lookup"><span data-stu-id="016b7-251">In this snippet, if hello file did not exist, it would lead tooa state where hello script actually exits gracefully after printing hello error message, and hello cluster reaches running state assuming it "successfully" completed cluster customization process.</span></span> <span data-ttu-id="016b7-252">Если вы хотите toobe точно уведомление факта hello настройки кластера по сути не выполнена должным образом из-за отсутствующего файла, он является более подходящим toothrow исключение и не шаг настройки кластера hello.</span><span class="sxs-lookup"><span data-stu-id="016b7-252">If you want toobe accurately notified of hello fact that cluster customization essentially did not succeed as expected because of a missing file, it is more appropriate toothrow an exception and fail hello cluster customization step.</span></span> <span data-ttu-id="016b7-253">tooachieve это необходимо использовать вместо этого следующий фрагмент кода hello.</span><span class="sxs-lookup"><span data-stu-id="016b7-253">tooachieve this you must use hello following sample code snippet instead.</span></span>

    If(Test-Path($SomePath)) {
        #Process file in some way
    } else {
        # File does not exist; handle error case
        # Print error message
    throw
    }


## <a name="checklist-for-deploying-a-script-action"></a><span data-ttu-id="016b7-254">Контрольный список для развертывания действия сценария</span><span class="sxs-lookup"><span data-stu-id="016b7-254">Checklist for deploying a script action</span></span>
<span data-ttu-id="016b7-255">Ниже приведены шаги hello, который мы воспользовались при подготовке toodeploy эти скрипты.</span><span class="sxs-lookup"><span data-stu-id="016b7-255">Here are hello steps we took when preparing toodeploy these scripts:</span></span>

1. <span data-ttu-id="016b7-256">Поместите файлы hello, содержащие пользовательские скрипты hello в месте, доступном из узлов кластера hello во время развертывания.</span><span class="sxs-lookup"><span data-stu-id="016b7-256">Put hello files that contain hello custom scripts in a place that is accessible by hello cluster nodes during deployment.</span></span> <span data-ttu-id="016b7-257">Это может быть любым по умолчанию hello или дополнительные учетные записи хранения, указанного во время hello развертывания кластера или любой другой контейнер хранилища общего доступа.</span><span class="sxs-lookup"><span data-stu-id="016b7-257">This can be any of hello default or additional Storage accounts specified at hello time of cluster deployment, or any other publicly accessible storage container.</span></span>
2. <span data-ttu-id="016b7-258">Добавьте проверку в сценарии toomake убедиться, что они выполняются идемпотентной, так, чтобы hello сценарий может выполняться несколько раз для hello того же узла.</span><span class="sxs-lookup"><span data-stu-id="016b7-258">Add checks into scripts toomake sure that they execute idempotently, so that hello script can be executed multiple times on hello same node.</span></span>
3. <span data-ttu-id="016b7-259">Используйте hello **Write-Output** tooSTDOUT tooprint командлет Azure PowerShell, а также STDERR.</span><span class="sxs-lookup"><span data-stu-id="016b7-259">Use hello **Write-Output** Azure PowerShell cmdlet tooprint tooSTDOUT as well as STDERR.</span></span> <span data-ttu-id="016b7-260">Не используйте **Write-Host**.</span><span class="sxs-lookup"><span data-stu-id="016b7-260">Do not use **Write-Host**.</span></span>
4. <span data-ttu-id="016b7-261">Использовать папку временного файла, например $env: TEMP, tookeep hello загруженный файл, используемый в сценарии hello и затем удалить их после выполнения скриптов.</span><span class="sxs-lookup"><span data-stu-id="016b7-261">Use a temporary file folder, such as $env:TEMP, tookeep hello downloaded file used by hello scripts and then clean them up after scripts have executed.</span></span>
5. <span data-ttu-id="016b7-262">Устанавливайте пользовательское программное обеспечения только на диске D:\ или в папке C:\apps.</span><span class="sxs-lookup"><span data-stu-id="016b7-262">Install custom software only at D:\ or C:\apps.</span></span> <span data-ttu-id="016b7-263">Не следует использовать другие расположения на диске c: hello, как они зарезервированы.</span><span class="sxs-lookup"><span data-stu-id="016b7-263">Other locations on hello C: drive should not be used as they are reserved.</span></span> <span data-ttu-id="016b7-264">Обратите внимание, что установки файлов на диске C: hello вне папки C:\apps hello может привести к сбою установки во время reimages hello узла.</span><span class="sxs-lookup"><span data-stu-id="016b7-264">Note that installing files on hello C: drive outside of hello C:\apps folder may result in setup failures during reimages of hello node.</span></span>
6. <span data-ttu-id="016b7-265">В событии hello измененные настройки на уровне операционной системы или файлы конфигурации службы Hadoop вы можете toorestart службы HDInsight, чтобы они не может взять все параметры уровня ОС, например hello переменные среды, заданные в скриптах hello.</span><span class="sxs-lookup"><span data-stu-id="016b7-265">In hello event that OS-level settings or Hadoop service configuration files were changed, you may want toorestart HDInsight services so that they can pick up any OS-level settings, such as hello environment variables set in hello scripts.</span></span>

## <a name="debug-custom-scripts"></a><span data-ttu-id="016b7-266">Отладка пользовательских сценариев</span><span class="sxs-lookup"><span data-stu-id="016b7-266">Debug custom scripts</span></span>
<span data-ttu-id="016b7-267">журналы ошибок сценария Hello хранятся вместе с другие выходные данные в учетной записи хранения hello по умолчанию, указанное для hello кластера при его создании.</span><span class="sxs-lookup"><span data-stu-id="016b7-267">hello script error logs are stored, along with other output, in hello default Storage account that you specified for hello cluster at its creation.</span></span> <span data-ttu-id="016b7-268">Hello журналы хранятся в таблице с именем hello *u < \cluster-name-fragment >< \time-stamp > setuplog*.</span><span class="sxs-lookup"><span data-stu-id="016b7-268">hello logs are stored in a table with hello name *u<\cluster-name-fragment><\time-stamp>setuplog*.</span></span> <span data-ttu-id="016b7-269">Это статистическое журналы, которые имеют записи из всех узлов hello (головного узла и узлов рабочих ролей), на какие hello скрипт выполняется в кластере hello.</span><span class="sxs-lookup"><span data-stu-id="016b7-269">These are aggregated logs that have records from all of hello nodes (head node and worker nodes) on which hello script runs in hello cluster.</span></span>
<span data-ttu-id="016b7-270">Легко toocheck hello журналов — toouse, средства HDInsight для Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="016b7-270">An easy way toocheck hello logs is toouse HDInsight Tools for Visual Studio.</span></span> <span data-ttu-id="016b7-271">Установка средства hello описана в разделе [приступить к работе со средствами Visual Studio Hadoop для HDInsight](hdinsight-hadoop-visual-studio-tools-get-started.md#install-data-lake-tools-for-visual-studio)</span><span class="sxs-lookup"><span data-stu-id="016b7-271">For installing hello tools, see [Get started using Visual Studio Hadoop tools for HDInsight](hdinsight-hadoop-visual-studio-tools-get-started.md#install-data-lake-tools-for-visual-studio)</span></span>

<span data-ttu-id="016b7-272">**toocheck hello журнала с помощью Visual Studio**</span><span class="sxs-lookup"><span data-stu-id="016b7-272">**toocheck hello log using Visual Studio**</span></span>

1. <span data-ttu-id="016b7-273">Откройте Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="016b7-273">Open Visual Studio.</span></span>
2. <span data-ttu-id="016b7-274">Последовательно щелкните **Представление** и **Обозреватель сервера**.</span><span class="sxs-lookup"><span data-stu-id="016b7-274">Click **View**, and then click **Server Explorer**.</span></span>
3. <span data-ttu-id="016b7-275">Щелкните правой кнопкой мыши «Azure», щелкните "Подключить" слишком**подписки Microsoft Azure**, а затем введите учетные данные.</span><span class="sxs-lookup"><span data-stu-id="016b7-275">Right-click "Azure", click Connect too**Microsoft Azure Subscriptions**, and then enter your credentials.</span></span>
4. <span data-ttu-id="016b7-276">Разверните **хранения**разверните hello учетной записи хранилища Azure используется в качестве файловой системы по умолчанию hello, разверните **таблиц**, а затем дважды щелкните имя таблицы hello.</span><span class="sxs-lookup"><span data-stu-id="016b7-276">Expand **Storage**, expand hello Azure storage account used as hello default file system, expand **Tables**, and then double-click hello table name.</span></span>

<span data-ttu-id="016b7-277">Можно также удаленный в toosee узлы кластера hello STDOUT и STDERR для пользовательских сценариев.</span><span class="sxs-lookup"><span data-stu-id="016b7-277">You can also remote into hello cluster nodes toosee both STDOUT and STDERR for custom scripts.</span></span> <span data-ttu-id="016b7-278">Hello журналы на каждом узле конкретный единственный узел toothat и записываются в **C:\HDInsightLogs\DeploymentAgent.log**.</span><span class="sxs-lookup"><span data-stu-id="016b7-278">hello logs on each node are specific only toothat node and are logged into **C:\HDInsightLogs\DeploymentAgent.log**.</span></span> <span data-ttu-id="016b7-279">Эти файлы журналов записываются все выходные данные пользовательского скрипта hello.</span><span class="sxs-lookup"><span data-stu-id="016b7-279">These log files record all outputs from hello custom script.</span></span> <span data-ttu-id="016b7-280">Фрагмент журнала для действия сценария Spark выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="016b7-280">An example log snippet for a Spark script action looks like this:</span></span>

    Microsoft.Hadoop.Deployment.Engine.CustomPowershellScriptCommand; Details : BEGIN: Invoking powershell script https://configactions.blob.core.windows.net/sparkconfigactions/spark-installer.ps1.;
    Version : 2.1.0.0;
    ActivityId : 739e61f5-aa22-4254-aafc-9faf56fc2692;
    AzureVMName : HEADNODE0;
    IsException : False;
    ExceptionType : ;
    ExceptionMessage : ;
    InnerExceptionType : ;
    InnerExceptionMessage : ;
    Exception : ;
    ...

    Starting Spark installation at: 09/04/2014 21:46:02 Done with Spark installation at: 09/04/2014 21:46:38;

    Version : 2.1.0.0;
    ActivityId : 739e61f5-aa22-4254-aafc-9faf56fc2692;
    AzureVMName : HEADNODE0;
    IsException : False;
    ExceptionType : ;
    ExceptionMessage : ;
    InnerExceptionType : ;
    InnerExceptionMessage : ;
    Exception : ;
    ...

    Microsoft.Hadoop.Deployment.Engine.CustomPowershellScriptCommand;
    Details : END: Invoking powershell script https://configactions.blob.core.windows.net/sparkconfigactions/spark-installer.ps1.;
    Version : 2.1.0.0;
    ActivityId : 739e61f5-aa22-4254-aafc-9faf56fc2692;
    AzureVMName : HEADNODE0;
    IsException : False;
    ExceptionType : ;
    ExceptionMessage : ;
    InnerExceptionType : ;
    InnerExceptionMessage : ;
    Exception : ;


<span data-ttu-id="016b7-281">В этом журнале было ясно, что действие сценария Spark hello был выполнен на Виртуальную машину с именем HEADNODE0 hello и что не были исключения во время выполнения hello.</span><span class="sxs-lookup"><span data-stu-id="016b7-281">In this log, it is clear that hello Spark script action has been executed on hello VM named HEADNODE0 and that no exceptions were thrown during hello execution.</span></span>

<span data-ttu-id="016b7-282">В событии hello, происходит сбой при выполнении hello выходные данные, описывающие его также содержится в этом файле журнала.</span><span class="sxs-lookup"><span data-stu-id="016b7-282">In hello event that an execution failure occurs, hello output describing it is also contained in this log file.</span></span> <span data-ttu-id="016b7-283">Hello сведения, представленные в этих журналах могут помочь при отладке скрипта, которые могут возникнуть.</span><span class="sxs-lookup"><span data-stu-id="016b7-283">hello information provided in these logs should be helpful in debugging script problems that may arise.</span></span>

## <a name="see-also"></a><span data-ttu-id="016b7-284">См. также</span><span class="sxs-lookup"><span data-stu-id="016b7-284">See also</span></span>
* <span data-ttu-id="016b7-285">[Настройка кластеров HDInsight под управлением Windows с помощью действия сценария][hdinsight-cluster-customize]</span><span class="sxs-lookup"><span data-stu-id="016b7-285">[Customize HDInsight clusters using Script Action][hdinsight-cluster-customize]</span></span>
* <span data-ttu-id="016b7-286">[Установка и использование Spark в кластерах HDInsight Hadoop с помощью действия сценария][hdinsight-install-spark]</span><span class="sxs-lookup"><span data-stu-id="016b7-286">[Install and use Spark on HDInsight clusters][hdinsight-install-spark]</span></span>
* <span data-ttu-id="016b7-287">[Установка и использование R на кластерах HDInsight Hadoop][hdinsight-r-scripts]</span><span class="sxs-lookup"><span data-stu-id="016b7-287">[Install and use R on HDInsight clusters][hdinsight-r-scripts]</span></span>
* <span data-ttu-id="016b7-288">[Установка и использование Solr в кластерах HDInsight](hdinsight-hadoop-solr-install.md).</span><span class="sxs-lookup"><span data-stu-id="016b7-288">[Install and use Solr on HDInsight clusters](hdinsight-hadoop-solr-install.md).</span></span>
* <span data-ttu-id="016b7-289">[Установка и использование Giraph в кластерах HDInsight](hdinsight-hadoop-giraph-install.md).</span><span class="sxs-lookup"><span data-stu-id="016b7-289">[Install and use Giraph on HDInsight clusters](hdinsight-hadoop-giraph-install.md).</span></span>

[hdinsight-provision]: hdinsight-provision-clusters.md
[hdinsight-cluster-customize]: hdinsight-hadoop-customize-cluster.md
[hdinsight-install-spark]: hdinsight-hadoop-spark-install.md
[hdinsight-r-scripts]: hdinsight-hadoop-r-scripts.md
[powershell-install-configure]: install-configure-powershell.md

<!--Reference links in article-->
[1]: https://msdn.microsoft.com/library/96xafkes(v=vs.110).aspx
