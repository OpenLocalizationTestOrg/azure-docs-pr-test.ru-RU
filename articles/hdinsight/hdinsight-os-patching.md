---
title: "Настройка расписания установки обновления путем частичной замены ОС для кластеров HDInsight на базе Linux — Azure | Документы Майкрософт"
description: "Узнайте, как настроить расписание обновления путем частичной замены ОС для кластеров HDInsight."
services: hdinsight
documentationcenter: 
author: bprakash
manager: asadk
editor: bprakash
ms.assetid: 
ms.service: hdinsight
ms.custom: hdinsightactive
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 03/21/2017
ms.author: bhanupr
ms.openlocfilehash: af3c5a19ae8e2e606e4b0506f9f6dddb41192e40
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="os-patching-for-hdinsight"></a><span data-ttu-id="65419-103">Обновление путем частичной замены ОС для кластеров HDInsight</span><span class="sxs-lookup"><span data-stu-id="65419-103">OS patching for HDInsight</span></span> 
<span data-ttu-id="65419-104">Являясь управляемой службой Hadoop, HDInsight отвечает за обновление путем частичной замены ОС базовых виртуальных машин, используемых в кластерах HDInsight.</span><span class="sxs-lookup"><span data-stu-id="65419-104">As a managed Hadoop service, HDInsight takes care of patching the OS of the underlying VMs used by HDInsight clusters.</span></span> <span data-ttu-id="65419-105">Начиная с 1 апреля 2016 года изменена политика обновления путем частичной замены гостевой ОС для кластеров HDInsight под управлением Linux (версии 3.4 или более поздней версии).</span><span class="sxs-lookup"><span data-stu-id="65419-105">As of August 1, 2016, we have changed the guest OS patching policy for Linux-based HDInsight clusters (version 3.4 or greater).</span></span> <span data-ttu-id="65419-106">Цель этой новой политики — значительно сократить число перезагрузок, выполняемых в процессе исправления.</span><span class="sxs-lookup"><span data-stu-id="65419-106">The goal of the new policy is to significantly reduce the number of reboots due to patching.</span></span> <span data-ttu-id="65419-107">Согласно новой политике исправления виртуальных машин в кластерах Linux будут по-прежнему выполняться каждый понедельник или четверг, начиная с 12:00 (UTC), поочередно обслуживая узлы в каждом данном кластере.</span><span class="sxs-lookup"><span data-stu-id="65419-107">The new policy will continue to patch virtual machines (VMs) on Linux clusters every Monday or Thursday starting at 12AM UTC in a staggered fashion across nodes in any given cluster.</span></span> <span data-ttu-id="65419-108">Однако перезагрузка каждой данной виртуальной машины по причине исправлений в гостевой ОС будет выполняться не чаще одного раза в 30 дней.</span><span class="sxs-lookup"><span data-stu-id="65419-108">However, any given VM will only reboot at most once every 30 days due to guest OS patching.</span></span> <span data-ttu-id="65419-109">Кроме того, первая перезагрузка только что созданного кластера будет выполняться не ранее, чем через 30 дней от даты создания кластера.</span><span class="sxs-lookup"><span data-stu-id="65419-109">In addition, the first reboot for a newly created cluster will not happen sooner than 30 days from the cluster creation date.</span></span> <span data-ttu-id="65419-110">Исправления начнут действовать после перезагрузки виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="65419-110">Patches will be effective once the VMs are rebooted.</span></span>

## <a name="how-to-configure-the-os-patching-schedule-for-linux-based-hdinsight-clusters"></a><span data-ttu-id="65419-111">Как настроить расписание обновления путем частичной замены ОС для кластеров HDInsight под управлением Linux</span><span class="sxs-lookup"><span data-stu-id="65419-111">How to configure the OS patching schedule for Linux-based HDInsight clusters</span></span>
<span data-ttu-id="65419-112">Виртуальные машины в кластере HDInsight нужно время от времени перезагружать для установки важных исправлений системы безопасности.</span><span class="sxs-lookup"><span data-stu-id="65419-112">The virtual machines in an HDInsight cluster need to be rebooted occasionally so that important security patches can be installed.</span></span> <span data-ttu-id="65419-113">Начиная с 1 августа 2016 года новые кластеры HDInsight под управлением Linux (версии 3.4 или более поздней версии) перезагружаются согласно приведенному ниже расписанию.</span><span class="sxs-lookup"><span data-stu-id="65419-113">As of August 1, 2016, new Linux-based HDInsight clusters (version 3.4 or greater,) are rebooted using the following schedule:</span></span>

1. <span data-ttu-id="65419-114">Виртуальная машина в кластере может быть перезагружена для установки исправлений не чаще, чем один раз на протяжении 30 дней.</span><span class="sxs-lookup"><span data-stu-id="65419-114">A virtual machine in the cluster can only reboot for patches at most, once within a 30-day period.</span></span>
2. <span data-ttu-id="65419-115">Перезагрузка происходит после 12:00 (UTC).</span><span class="sxs-lookup"><span data-stu-id="65419-115">The reboot occurs starting at 12AM UTC.</span></span>
3. <span data-ttu-id="65419-116">Процесс перезагрузки виртуальных машин в кластере выполняется в шахматном порядке, поэтому кластер остается доступен.</span><span class="sxs-lookup"><span data-stu-id="65419-116">The reboot process is staggered across virtual machines in the cluster, so the cluster is still available during the reboot process.</span></span>
4. <span data-ttu-id="65419-117">Первая перезагрузка только что созданного кластера будет выполняться не ранее, чем через 30 дней после даты создания кластера.</span><span class="sxs-lookup"><span data-stu-id="65419-117">The first reboot for a newly created cluster will not happen sooner than 30 days after the cluster creation date.</span></span>

<span data-ttu-id="65419-118">С помощью действия сценария, описанного в этой статье, можно изменить расписание обновления путем частичной замены ОС следующим образом.</span><span class="sxs-lookup"><span data-stu-id="65419-118">Using the script action described in this article, you can modify the OS patching schedule as follows:</span></span>
1. <span data-ttu-id="65419-119">Можно включить или отключить автоматическую перезагрузку.</span><span class="sxs-lookup"><span data-stu-id="65419-119">Enable or disable automatic reboots</span></span>
2. <span data-ttu-id="65419-120">Можно задать частоту перезагрузки (в днях между перезагрузками).</span><span class="sxs-lookup"><span data-stu-id="65419-120">Set the frequency of reboots (days between reboots)</span></span>
3. <span data-ttu-id="65419-121">Можно задать день недели, когда происходит перезагрузка.</span><span class="sxs-lookup"><span data-stu-id="65419-121">Set the day of the week when a reboot occurs</span></span>

> [!NOTE]
> <span data-ttu-id="65419-122">Это действие сценария будет работать только с кластерами HDInsight под управлением Linux, созданными после 1 августа 2016 года.</span><span class="sxs-lookup"><span data-stu-id="65419-122">This script action will only work with Linux-based HDInsight clusters created after August 1st, 2016.</span></span> <span data-ttu-id="65419-123">Исправления начнут действовать только после перезагрузки виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="65419-123">Patches will be effective only when VMs are rebooted.</span></span> 
>

## <a name="how-to-use-the-script"></a><span data-ttu-id="65419-124">Как использовать сценарий</span><span class="sxs-lookup"><span data-stu-id="65419-124">How to use the script</span></span> 

<span data-ttu-id="65419-125">Для использования этого сценария требуется следующая информация.</span><span class="sxs-lookup"><span data-stu-id="65419-125">When using this script requires the following information:</span></span>
1. <span data-ttu-id="65419-126">Расположение сценария: https://hdiconfigactions.blob.core.windows.net/linuxospatchingrebootconfigv01/os-patching-reboot-config.sh.</span><span class="sxs-lookup"><span data-stu-id="65419-126">The script location: https://hdiconfigactions.blob.core.windows.net/linuxospatchingrebootconfigv01/os-patching-reboot-config.sh.</span></span>
    <span data-ttu-id="65419-127">HDInsight использует этот универсальный код ресурса (URI), чтобы найти и запустить сценарий на всех виртуальных машинах в кластере.</span><span class="sxs-lookup"><span data-stu-id="65419-127">HDInsight uses this URI to find and run the script on all the virtual machines in the cluster.</span></span>
  
2. <span data-ttu-id="65419-128">Типы узлов кластера, к которым применяется сценарий: головной узел, рабочий узел, узел zookeeper.</span><span class="sxs-lookup"><span data-stu-id="65419-128">The cluster node types that the script is applied to: headnode, workernode, zookeeper.</span></span> <span data-ttu-id="65419-129">Этот сценарий должен применяться к узлам всех типов в кластере.</span><span class="sxs-lookup"><span data-stu-id="65419-129">This script must be applied to all node types in the cluster.</span></span> <span data-ttu-id="65419-130">Если не применить его к какому-либо типу узла, то виртуальные машины этого типа узла продолжат использовать прежнее расписание обновления путем частичной замены ОС.</span><span class="sxs-lookup"><span data-stu-id="65419-130">If it is not applied to a node type, then the virtual machines for that node type will continue to use the previous patching schedule.</span></span>


3.  <span data-ttu-id="65419-131">Параметры. Этот сценарий принимает три числовых параметра.</span><span class="sxs-lookup"><span data-stu-id="65419-131">Parameter: This script accepts three numeric parameters:</span></span>

    | <span data-ttu-id="65419-132">Параметр</span><span class="sxs-lookup"><span data-stu-id="65419-132">Parameter</span></span> | <span data-ttu-id="65419-133">Определение</span><span class="sxs-lookup"><span data-stu-id="65419-133">Definition</span></span> |
    | --- | --- |
    | <span data-ttu-id="65419-134">Включение или отключение автоматических перезагрузок.</span><span class="sxs-lookup"><span data-stu-id="65419-134">Enable/disable automatic reboots</span></span> |<span data-ttu-id="65419-135">0 или 1.</span><span class="sxs-lookup"><span data-stu-id="65419-135">0 or 1.</span></span> <span data-ttu-id="65419-136">Значение 0 отключает автоматические перезагрузки, а значение 1 — включает.</span><span class="sxs-lookup"><span data-stu-id="65419-136">A value of 0 disables automatic reboots while 1 enables automatic reboots.</span></span> |
    | <span data-ttu-id="65419-137">Frequency</span><span class="sxs-lookup"><span data-stu-id="65419-137">Frequency</span></span> |<span data-ttu-id="65419-138">7–90 (включительно).</span><span class="sxs-lookup"><span data-stu-id="65419-138">7 to 90 (inclusive).</span></span> <span data-ttu-id="65419-139">Число дней до перезагрузки виртуальных машин для установки исправлений, которые требуют перезагрузки.</span><span class="sxs-lookup"><span data-stu-id="65419-139">The number of days to wait before rebooting the virtual machines for patches that require a reboot.</span></span> |
    | <span data-ttu-id="65419-140">День недели</span><span class="sxs-lookup"><span data-stu-id="65419-140">Day of week</span></span> |<span data-ttu-id="65419-141">1–7 (включительно).</span><span class="sxs-lookup"><span data-stu-id="65419-141">1 to 7 (inclusive).</span></span> <span data-ttu-id="65419-142">Значение 1 указывает, что перезагрузка должна выполняться в понедельник, а 7 — в воскресенью. Например, использование параметров 1 60 2 приведет к автоматической перезагрузке каждые 60 дней (максимум) во вторник.</span><span class="sxs-lookup"><span data-stu-id="65419-142">A value of 1 indicates the reboot should occur on a Monday, and 7 indicates a Sunday.For example, using parameters of 1 60 2 results in automatic reboots every 60 days (at most) on Tuesday.</span></span> |
    | <span data-ttu-id="65419-143">Сохраняемость</span><span class="sxs-lookup"><span data-stu-id="65419-143">Persistence</span></span> |<span data-ttu-id="65419-144">В случае применения действия сценария к существующему кластеру можно пометить сценарий как сохраняемый.</span><span class="sxs-lookup"><span data-stu-id="65419-144">When applying a script action to an existing cluster, you can mark the script as persisted.</span></span> <span data-ttu-id="65419-145">Сохраняемые сценарии применяются при добавлении новых рабочих узлов в кластер при операциях масштабирования.</span><span class="sxs-lookup"><span data-stu-id="65419-145">Persisted scripts are applied when new workernodes are added to the cluster through scaling operations.</span></span> |

> [!NOTE]
> <span data-ttu-id="65419-146">Этот сценарий необходимо пометить как сохраняемый, если он применяется к существующему кластеру.</span><span class="sxs-lookup"><span data-stu-id="65419-146">You must mark this script as persisted when applying to an existing cluster.</span></span> <span data-ttu-id="65419-147">В противном случае все новые узлы, созданные операциями масштабирования, будут использовать расписание обновления путем частичной замены ОС по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="65419-147">Otherwise, any new nodes created through scaling      operations will use the default patching schedule.</span></span>
<span data-ttu-id="65419-148">Если применить сценарий при создании кластера, он сохраняется автоматически.</span><span class="sxs-lookup"><span data-stu-id="65419-148">If you apply the script as part of the cluster creation process, it is persisted automatically.</span></span>
>

## <a name="next-steps"></a><span data-ttu-id="65419-149">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="65419-149">Next steps</span></span>

<span data-ttu-id="65419-150">Конкретные инструкции по использованию действия сценария см. в следующих разделах статьи [Настройка кластеров HDInsight под управлением Linux с помощью действия сценария](hdinsight-hadoop-customize-cluster-linux.md):</span><span class="sxs-lookup"><span data-stu-id="65419-150">For specific steps on using the script action, see the following sections in the [Customize Linuz-based HDInsight clusters using script action](hdinsight-hadoop-customize-cluster-linux.md):</span></span>

* [<span data-ttu-id="65419-151">Использование действия скрипта при создании кластера</span><span class="sxs-lookup"><span data-stu-id="65419-151">Use a script action during cluster creation</span></span>](hdinsight-hadoop-customize-cluster-linux.md#use-a-script-action-during-cluster-creation)
* [<span data-ttu-id="65419-152">Применение действия скрипта в работающем кластере</span><span class="sxs-lookup"><span data-stu-id="65419-152">Apply a script action to a running cluster</span></span>](hdinsight-hadoop-customize-cluster-linux.md#apply-a-script-action-to-a-running-cluster)
