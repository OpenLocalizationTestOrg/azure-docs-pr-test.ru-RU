---
title: "Высокая доступность для Hadoop в Azure HDInsight | Документация Майкрософт"
description: "Узнайте, как использование дополнительного головного узла позволяет повысить надежность и доступность кластеров HDInsight. Узнайте, как это влияет на службы Hadoop, такие как Ambari и Hive, и научитесь подключаться к каждому отдельному головному узлу с помощью SSH."
services: hdinsight
editor: cgronlun
manager: jhubbard
author: Blackmist
documentationcenter: 
tags: azure-portal
keywords: "Высокая доступность Hadoop"
ms.assetid: 99c9f59c-cf6b-4529-99d1-bf060435e8d4
ms.service: hdinsight
ms.custom: hdinsightactive,hdiseo17may2017
ms.workload: big-data
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 01/08/2018
ms.author: larryfr
ms.openlocfilehash: 0822502bcd3e2b0d20f718a158d6db489a650bde
ms.sourcegitcommit: f1c1789f2f2502d683afaf5a2f46cc548c0dea50
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/18/2018
---
# <a name="availability-and-reliability-of-hadoop-clusters-in-hdinsight"></a>Доступность и надежность кластеров Hadoop в HDInsight

В кластерах HDInsight предусмотрены два головных узла, повышающие доступность и надежность выполняемых служб и заданий Hadoop.

Платформа Hadoop обеспечивает высокий уровень доступности и надежности, реплицируя службы и данные на нескольких узлах в кластере. Однако стандартные дистрибутивы Hadoop обычно имеют один головной узел. Любой сбой такого узла может вызвать прекращение работы кластера. HDInsight предоставляет два головных узла для повышения доступности и надежности Hadoop.

> [!IMPORTANT]
> Linux — это единственная операционная система, используемая для работы с HDInsight 3.4 или более поздних версий. Дополнительные сведения см. в разделе [Приближается дата прекращения сопровождения HDI версии 3.3](hdinsight-component-versioning.md#hdinsight-windows-retirement).

## <a name="availability-and-reliability-of-nodes"></a>Доступность и надежность узлов

Узлы в кластере HDInsight реализуются с помощью виртуальных машин Azure. В следующих разделах рассматриваются отдельные типы узлов, которые используются с HDInsight. 

> [!NOTE]
> Не все типы узлов используются для определенного типа кластера. Например, тип кластера Hadoop не содержит узлы Nimbus. Дополнительные сведения об узлах, используемых типами кластеров HDInsight, см. в разделе "Типы кластеров" статьи [Создание кластеров Hadoop в HDInsight](hdinsight-hadoop-provision-linux-clusters.md#cluster-types).

### <a name="head-nodes"></a>Головные узлы

Для обеспечения высокого уровня доступности службы Hadoop HDInsight предоставляет два головных узла. Оба головных узла активны и работают в кластере HDInsight одновременно. Некоторые службы, например HDFS или YARN, в любой момент времени активны только на одном головном узле. Другие службы, например HiveServer2 или Hive MetaStore, активны одновременно на обоих головных узлах.

Головные узлы (и другие узлы в HDInsight) содержат в своем имени числовое значение. Например, `hn0-CLUSTERNAME` или `hn4-CLUSTERNAME`.

> [!IMPORTANT]
> Не воспринимайте это числовое значение как обозначение приоритета узла (первичный или вторичный). Единственная функция этого значения — обеспечение уникальности имен для каждого узла.

### <a name="nimbus-nodes"></a>Узлы Nimbus

Узлы Nimbus доступны с кластерами Storm. Узлы Nimbus предоставляют Hadoop JobTracker похожие функциональные возможности путем распределения и мониторинга обработки на рабочих узлах. HDInsight предоставляет два узла Nimbus для кластеров Storm.

### <a name="zookeeper-nodes"></a>Узлы Zookeeper

Узлы [ZooKeeper](http://zookeeper.apache.org/) используются для выбора лидера главных служб на головных узлах, а также для уведомления служб, узлов данных (рабочих узлов) и шлюзов о том, на каком головном узле активна главная служба. По умолчанию в кластере HDInsight предусмотрено три узла ZooKeeper.

### <a name="worker-nodes"></a>Рабочие узлы

Рабочие узлы выполняют анализ данных при отправке задания в кластер. Если происходит сбой рабочего узла, выполняемая задача отправляется на другой рабочий узел. По умолчанию HDInsight создает четыре рабочих узла. Вы можете изменить это количество по своему усмотрению как во время создания кластера, так и позднее.

### <a name="edge-node"></a>Граничный узел

Граничный узел не принимает активного участия в анализе данных в пределах кластера. Разработчики или специалисты по обработке и анализу данных используют его при работе с Hadoop. Граничный узел находится в той же виртуальной сети Azure, что и другие узлы в кластере, и может получать непосредственный доступ ко всем остальным узлам. Его можно использовать без опасения отнять ресурсы у критически важных служб или заданий анализа Hadoop.

В настоящее время R Server в HDInsight является единственным типом кластера, который по умолчанию предоставляет граничный узел. В R Server в HDInsight граничный узел используется для локального тестирования кода R на узле перед его отправкой в кластер для распределенной обработки.

Сведения об использовании граничного узла с типами кластеров, отличными от R Server, см. в статье [Использование пустых граничных узлов в HDInsight](hdinsight-apps-use-edge-node.md).

## <a name="accessing-the-nodes"></a>Доступ к узлам

Доступ к кластеру из Интернета предоставляется через общедоступный шлюз. Этот режим доступа позволяет подключаться только к головным узлам и граничному узлу (если он существует). Наличие нескольких головных узлов никак не влияет на доступ к службам, работающим на головных узлах. Общедоступный шлюз просто направляет запросы к тому головному узлу, на котором размещается запрашиваемая служба. Например, если служба Ambari размещена на вторичном головном узле, шлюз будет направлять на этот узел все входящие запросы к службе Ambari.

Доступ через общедоступный шлюз ограничен портами 443 (HTTPS), 22 и 23.

* Порт __443__ используется для доступа к Ambari и другим пользовательским веб-интерфейсам или интерфейсам REST API, размещенным на головных узлах.

* Порт __22__ используется для доступа к первичному головному узлу или граничному узлу по протоколу SSH.

* Порт __23__ используется для доступа ко вторичному головному узлу по протоколу SSH. Например, `ssh username@mycluster-ssh.azurehdinsight.net` подключается к основному головному узлу кластера с именем **mycluster**.

Дополнительные сведения об использовании SSH см. в статье [Подключение к HDInsight (Hadoop) с помощью SSH](hdinsight-hadoop-linux-use-ssh-unix.md).

### <a name="internal-fully-qualified-domain-names-fqdn"></a>Внутренние полные доменные имена (FQDN)

Каждый узел в кластере HDInsight имеет внутренний IP-адрес и полное доменное имя, доступ к которым возможен только из этого кластера. При доступе к службам в кластере с помощью внутреннего FQDN или IP-адреса следует использовать Ambari для проверки IP-адреса или FQDN, которые будут использоваться для доступа к службе.

Например, служба Oozie может выполняться только на одном головном узле, и при использовании команды `oozie` в сеансе SSH требуется URL-адрес службы. Этот адрес можно получить из Ambari с помощью следующей команды:

    curl -u admin:PASSWORD "https://CLUSTERNAME.azurehdinsight.net/api/v1/clusters/CLUSTERNAME/configurations?type=oozie-site&tag=TOPOLOGY_RESOLVED" | grep oozie.base.url

Команда возвращает примерно следующее значение, содержащее внутренний URL-адрес для использования с командой `oozie`:

    "oozie.base.url": "http://hn0-CLUSTERNAME-randomcharacters.cx.internal.cloudapp.net:11000/oozie"

Дополнительные сведения о работе с REST API службы Ambari см. в статье [Управление кластерами HDInsight с помощью REST API Ambari](hdinsight-hadoop-manage-ambari-rest-api.md).

### <a name="accessing-other-node-types"></a>Доступ к узлам других типов

К узлам, которые недоступны напрямую через Интернет, можно подключаться следующими способами.

* **SSH.** После подключения к головному узлу с помощью SSH можно затем использовать SSH с головного узла для подключения к другим узлам в кластере. Дополнительные сведения см. в статье [Подключение к HDInsight (Hadoop) с помощью SSH](hdinsight-hadoop-linux-use-ssh-unix.md).

* **Туннель SSH.** Если вам нужен доступ к веб-службе, размещенной на узле, к которому нет доступа из Интернета, следует использовать туннель SSH. Дополнительные сведения см. в статье [Использование туннелирования SSH для доступа к веб-интерфейсу Ambari, JobHistory, NameNode, Oozie и другим веб-интерфейсам](hdinsight-linux-ambari-ssh-tunnel.md).

* **Виртуальная сеть Azure.** Если кластер HDInsight входит в состав виртуальной сети Azure, любой ресурс в той же виртуальной сети может напрямую получать доступ ко всем узлам в кластере. Дополнительные сведения см. в статье [Расширение возможностей HDInsight с помощью виртуальной сети Azure](hdinsight-extend-hadoop-virtual-network.md).

## <a name="how-to-check-on-a-service-status"></a>Проверка состояния службы

Состояние служб, работающих на головных узлах, можно проверить с помощью веб-интерфейса Ambari или REST API Ambari.

### <a name="ambari-web-ui"></a>Веб-интерфейс Ambari

Веб-интерфейс Ambari можно просмотреть по ссылке https://CLUSTERNAME.azurehdinsight.net. Замените **CLUSTERNAME** именем кластера. При появлении запроса введите учетные данные пользователя HTTP для кластера. По умолчанию используются имя пользователя HTTP **admin** и пароль, который вы ввели при создании кластера.

Открыв страницу Ambari, слева вы увидите список установленных служб.

![Установленные службы](./media/hdinsight-high-availability-linux/services.png)

Существует ряд значков, которые могут отображаться рядом со службой и указывать ее состояние. Все оповещения, связанные с той или иной службой, можно просмотреть, щелкнув ссылку **Оповещения** в верхней части страницы. Чтобы просмотреть дополнительные сведения о службе, выберите ее.

На странице службы содержатся сведения о состоянии и конфигурации каждой службы, но не указывается, на каком головном узле она работает. Чтобы просмотреть эти сведения, щелкните ссылку **Узлы** в верхней части страницы. На странице отобразятся все узлы кластера, включая головные узлы.

![список узлов](./media/hdinsight-high-availability-linux/hosts.png)

Выберите ссылку на один из головных узлов, чтобы отобразить работающие на нем службы и компоненты.

![Состояние компонента](./media/hdinsight-high-availability-linux/nodeservices.png)

Подробные сведения об использовании Ambari см. в статье [Управление кластерами HDInsight с помощью веб-интерфейса Ambari](hdinsight-hadoop-manage-ambari.md).

### <a name="ambari-rest-api"></a>Ambari REST API

Ambari REST API доступен в Интернете. Открытый шлюз HDInsight обрабатывает запросы маршрутизации к головному узлу, на котором в настоящее время размещается REST API.

Чтобы проверить состояние службы с помощью интерфейса Ambari REST API, можно воспользоваться следующей командой:

    curl -u admin:PASSWORD https://CLUSTERNAME.azurehdinsight.net/api/v1/clusters/CLUSTERNAME/services/SERVICENAME?fields=ServiceInfo/state

* Замените **PASSWORD** паролем учетной записи пользователя (администратора) HTTP.
* Замените **CLUSTERNAME** именем кластера.
* Замените **SERVICENAME** именем службы, состояние которой вы хотите проверить.

Например, чтобы проверить состояние службы **HDFS** в кластере с именем **mycluster** и паролем **password**, нужно выполнить следующую команду.

    curl -u admin:password https://mycluster.azurehdinsight.net/api/v1/clusters/mycluster/services/HDFS?fields=ServiceInfo/state

В ответ вы получите примерно такой код JSON:

    {
      "href" : "http://hn0-CLUSTERNAME.randomcharacters.cx.internal.cloudapp.net:8080/api/v1/clusters/mycluster/services/HDFS?fields=ServiceInfo/state",
      "ServiceInfo" : {
        "cluster_name" : "mycluster",
        "service_name" : "HDFS",
        "state" : "STARTED"
      }
    }

URL-адрес указывает, что сейчас служба работает на узле с именем **hn0-CLUSTERNAME**.

Состояние указывает, что служба в настоящий момент запущена ( **STARTED**).

Если вам неизвестно, какие службы установлены в кластере, их список можно получить с помощью следующей команды:

    curl -u admin:PASSWORD https://CLUSTERNAME.azurehdinsight.net/api/v1/clusters/CLUSTERNAME/services

Дополнительные сведения о работе с REST API службы Ambari см. в статье [Управление кластерами HDInsight с помощью REST API Ambari](hdinsight-hadoop-manage-ambari-rest-api.md).

#### <a name="service-components"></a>Компоненты служб

Иногда службы содержат компоненты, состояние которых может потребоваться проверить по отдельности. Например, служба HDFS содержит компонент NameNode. Чтобы просмотреть сведения о компоненте, используйте следующую команду:

    curl -u admin:PASSWORD https://CLUSTERNAME.azurehdinsight.net/api/v1/clusters/CLUSTERNAME/services/SERVICE/components/component

Если вам неизвестно, какие компоненты содержатся в службе, их список можно получить с помощью следующей команды:

    curl -u admin:PASSWORD https://CLUSTERNAME.azurehdinsight.net/api/v1/clusters/CLUSTERNAME/services/SERVICE/components/component

## <a name="how-to-access-log-files-on-the-head-nodes"></a>Доступ к файлам журнала на головных узлах

### <a name="ssh"></a>SSH

Если подключение к головному узлу установлено через SSH, файлы журнала можно найти в папке **/var/log**. Например, в папке **/var/log/hadoop-yarn/yarn** содержатся журналы для YARN.

Каждый головной узел может иметь уникальные записи журнала, поэтому следует проверить журналы на обоих узлах.

### <a name="sftp"></a>SFTP

Кроме того, к головному узлу можно подключаться с помощью протокола передачи файлов SSH или безопасного протокола передачи файлов (SFTP) и напрямую загружать файлы журналов.

Как и при использовании клиента SSH, при подключении к кластеру необходимо указать имя учетной записи пользователя SSH и адрес SSH кластера. Например, `sftp username@mycluster-ssh.azurehdinsight.net`. Предоставьте пароль для учетной записи, когда отобразится соответствующий запрос, или передайте открытый ключ через параметр `-i`.

После подключения отобразится строка `sftp>` . С помощью этой строки можно переходить в другие каталоги, отправлять и скачивать файлы. Например, следующие команды изменяют каталоги на каталог **/var/log/hadoop/hdfs** , а затем загружают все файлы в каталоге.

    cd /var/log/hadoop/hdfs
    get *

Для просмотра списка доступных команд введите `help` в строке `sftp>`.

> [!NOTE]
> Некоторые графические интерфейсы позволяют визуализировать файловую систему при подключении по протоколу SFTP. Например, [MobaXTerm](http://mobaxterm.mobatek.net/) позволяет просматривать файловую систему с помощью интерфейса, похожего на проводник Windows.

### <a name="ambari"></a>Ambari

> [!NOTE]
> Чтобы получить доступ к файлам журнала с помощью Ambari, используйте туннель SSH. К веб-интерфейсам для отдельных служб не предоставляется открытый доступ через Интернет. Дополнительные сведения об использовании туннеля SSH см. в документе [Использование туннелирования SSH для доступа к веб-интерфейсу Ambari, JobHistory, NameNode, Oozie и другим веб-интерфейсам](hdinsight-linux-ambari-ssh-tunnel.md).

Через веб-Интерфейс Ambari выберите службу, для которой вы хотите просмотреть журналы (например, YARN). Затем в разделе **Быстрые ссылки** выберите головной узел, для которого нужно просмотреть журналы.

![Использование быстрых ссылок для просмотра журналов](./media/hdinsight-high-availability-linux/viewlogs.png)

## <a name="how-to-configure-the-node-size"></a>Настройка размера узла

Размер узла можно выбрать только во время создания кластера. Список различных размеров виртуальных машин, доступных для HDInsight, можно найти на [странице цен на HDInsight](https://azure.microsoft.com/pricing/details/hdinsight/).

При создании кластера можно указать размер узлов. Далее приведены сведения о том, как указать размер узла с помощью [портала Azure][preview-portal], [Azure PowerShell][azure-powershell] и [Azure CLI][azure-cli].

* **Портал Azure.** При создании кластера можно задать размер для узлов этого кластера:

    ![Изображение мастера создания кластера с выбором размера узла](./media/hdinsight-high-availability-linux/headnodesize.png)

* **Azure CLI.** При использовании команды `azure hdinsight cluster create` можно задать размер головного, рабочего узла и узла ZooKeeper с помощью параметров `--headNodeSize`, `--workerNodeSize` и `--zookeeperNodeSize`.

* **Azure PowerShell.** При использовании командлета `New-AzureRmHDInsightCluster` можно задать размер головного и рабочего узлов и узла ZooKeeper с помощью параметров `-HeadNodeVMSize`, `-WorkerNodeSize` и `-ZookeeperNodeSize`.

## <a name="next-steps"></a>Дополнительная информация

Чтобы получить дополнительные сведения о вопросах, упомянутых в этой статье, используйте следующие ресурсы.

* [Справочник по REST Ambari](https://github.com/apache/ambari/blob/trunk/ambari-server/docs/api/v1/index.md)
* [Установка и настройка CLI Azure](../cli-install-nodejs.md)
* [Установка и настройка Azure PowerShell](/powershell/azure/overview)
* [Управление кластерами HDInsight с помощью Ambari](hdinsight-hadoop-manage-ambari.md)
* [«Подготовка кластеров HDInsight на основе Linux»](hdinsight-hadoop-provision-linux-clusters.md)

[preview-portal]: https://portal.azure.com/
[azure-powershell]: /powershell/azureps-cmdlets-docs
[azure-cli]: ../cli-install-nodejs.md
