---
title: "объединить aaaDomain архитектура Azure HDInsight | Документы Microsoft"
description: "Узнайте, как tooplan домену HDInsight."
services: hdinsight
documentationcenter: 
author: saurinsh
manager: jhubbard
editor: cgronlun
tags: azure-portal
ms.assetid: 7dc6847d-10d4-4b5c-9c83-cc513cf91965
ms.service: hdinsight
ms.custom: hdinsightactive
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 02/03/2017
ms.author: saurinsh
ms.openlocfilehash: 1c3ecedf3739b4f8fa54160225be9c1d6e2ca6cc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="plan-azure-domain-joined-hadoop-clusters-in-hdinsight"></a><span data-ttu-id="8a42c-103">Планирование архитектуры присоединенных к домену кластеров Hadoop в Azure HDInsight</span><span class="sxs-lookup"><span data-stu-id="8a42c-103">Plan Azure domain-joined Hadoop clusters in HDInsight</span></span>

<span data-ttu-id="8a42c-104">Hello традиционных Hadoop — это кластер одного пользователя.</span><span class="sxs-lookup"><span data-stu-id="8a42c-104">hello traditional Hadoop is a single-user cluster.</span></span> <span data-ttu-id="8a42c-105">Он подходит для большинства организаций с небольшими отделами по работе с приложениями, создающими объемные рабочие нагрузки данных.</span><span class="sxs-lookup"><span data-stu-id="8a42c-105">It is suitable for most companies that have smaller application teams building large data workloads.</span></span> <span data-ttu-id="8a42c-106">В связи с ростом популярности кластера Hadoop многие организации переходят на модель, когда ИТ-специалисты управляют кластерами и несколько отделов по работе с приложениями совместно используют кластеры.</span><span class="sxs-lookup"><span data-stu-id="8a42c-106">As Hadoop gains popularity, many enterprises are moving toward a model in which clusters are managed by IT teams and multiple application teams share clusters.</span></span> <span data-ttu-id="8a42c-107">Таким образом функции, связанные с многопользовательской кластеров, среди hello наиболее запрошенного функций Azure HDInsight.</span><span class="sxs-lookup"><span data-stu-id="8a42c-107">Thus, functionalities involving multiuser clusters are among hello most requested functionalities in Azure HDInsight.</span></span>

<span data-ttu-id="8a42c-108">Вместо построения свой собственный сетевой проверки подлинности и авторизации, HDInsight использует наиболее популярные поставщика удостоверений hello--Active Directory (AD).</span><span class="sxs-lookup"><span data-stu-id="8a42c-108">Instead of building its own multiuser authentication and authorization, HDInsight relies on hello most popular identity provider--Active Directory (AD).</span></span> <span data-ttu-id="8a42c-109">функции Hello мощные безопасности в AD может быть многопользовательской авторизации используется toomanage в HDInsight.</span><span class="sxs-lookup"><span data-stu-id="8a42c-109">hello powerful security functionality in AD can be used toomanage multiuser authorization in HDInsight.</span></span> <span data-ttu-id="8a42c-110">Интегрируя HDInsight в AD, могут взаимодействовать с кластерами hello, используя свои учетные данные AD.</span><span class="sxs-lookup"><span data-stu-id="8a42c-110">By integrating HDInsight with AD, you can communicate with hello clusters by using your AD credentials.</span></span> <span data-ttu-id="8a42c-111">HDInsight сопоставляет пользователя tooa локального Hadoop пользователь AD, поэтому все hello служб, выполняющихся на HDInsight (Ambari, Hive thrift Spark server круг, сервера и другие) работают незаметно для пользователя с проверкой подлинности hello.</span><span class="sxs-lookup"><span data-stu-id="8a42c-111">HDInsight maps an AD user tooa local Hadoop user, so all hello services running on HDInsight (Ambari, Hive server, Ranger, Spark thrift server, and others) work seamlessly for hello authenticated user.</span></span>

## <a name="integrate-hdinsight-with-ad-and-ad-on-iaas-vm"></a><span data-ttu-id="8a42c-112">Интеграция HDInsight с AD и AD на виртуальных машинах IaaS</span><span class="sxs-lookup"><span data-stu-id="8a42c-112">Integrate HDInsight with AD and AD on IaaS VM</span></span>

<span data-ttu-id="8a42c-113">Интегрируя HDInsight с помощью Azure AD или AD на виртуальной Машине Iaas, узлы кластера HDInsight hello являются домена tooa, присоединенных к домену.</span><span class="sxs-lookup"><span data-stu-id="8a42c-113">By integrating HDInsight with Azure AD or AD on Iaas VM, hello HDInsight cluster nodes are domain-joined tooa domain.</span></span> <span data-ttu-id="8a42c-114">HDInsight создает субъекты-службы для hello службам Hadoop, работающих в кластере hello и помещает их в заданном подразделении (OU) в Azure AD или AD на виртуальной Машине IaaS.</span><span class="sxs-lookup"><span data-stu-id="8a42c-114">HDInsight creates service principals for hello Hadoop services running on hello cluster and places them within a specified organizational unit (OU) in Azure AD or AD on IaaS VM.</span></span> <span data-ttu-id="8a42c-115">HDInsight также создает обратного сопоставления DNS в домене hello для hello IP-адреса узлов hello, которые присоединены к домену toohello домена.</span><span class="sxs-lookup"><span data-stu-id="8a42c-115">HDInsight also creates reverse DNS mappings in hello domain for hello IP addresses of hello nodes that are joined toohello domain.</span></span>

<span data-ttu-id="8a42c-116">Чтобы получить эту конфигурацию, нужно использовать несколько архитектур.</span><span class="sxs-lookup"><span data-stu-id="8a42c-116">You can achieve this setup by using multiple architectures.</span></span> <span data-ttu-id="8a42c-117">Можно выбрать один из следующих архитектур hello.</span><span class="sxs-lookup"><span data-stu-id="8a42c-117">You can choose from hello following architectures.</span></span>

<span data-ttu-id="8a42c-118">**Интеграция HDInsight с Active Directory, выполняемой в Azure IaaS**</span><span class="sxs-lookup"><span data-stu-id="8a42c-118">**HDInsight integrated with AD running on Azure IaaS**</span></span>

<span data-ttu-id="8a42c-119">Это простейший архитектура hello для интеграции с Active Directory HDInsight.</span><span class="sxs-lookup"><span data-stu-id="8a42c-119">This is hello simplest architecture for integrating HDInsight with Active Directory.</span></span> <span data-ttu-id="8a42c-120">контроллер домена AD Hello выполняется на один (или несколько) виртуальных машин (ВМ в Azure).</span><span class="sxs-lookup"><span data-stu-id="8a42c-120">hello AD domain controller runs on one (or multiple) virtual machines (VMs) in Azure.</span></span> <span data-ttu-id="8a42c-121">Обычно эти виртуальные машины находятся в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="8a42c-121">These VMs are usually in a virtual network.</span></span> <span data-ttu-id="8a42c-122">Настройте другую виртуальную сеть для кластера HDInsight hello.</span><span class="sxs-lookup"><span data-stu-id="8a42c-122">You set up another virtual network for hello HDInsight cluster.</span></span> <span data-ttu-id="8a42c-123">Для HDInsight toohave tooActive прямой видимости каталога, необходимо toopeer эти виртуальные сети с помощью [пиринг VNet-VNet](../virtual-network/virtual-network-create-peering.md).</span><span class="sxs-lookup"><span data-stu-id="8a42c-123">For HDInsight toohave a line of sight tooActive Directory, you need toopeer these virtual networks by using [VNet-to-VNet peering](../virtual-network/virtual-network-create-peering.md).</span></span> <span data-ttu-id="8a42c-124">При создании hello Active Directory в ARM, то можно создать hello Active Directory и HDInsight в hello одной виртуальной сети и не требуется toodo пиринга.</span><span class="sxs-lookup"><span data-stu-id="8a42c-124">If you create hello Active Directory in ARM, then you can create hello Active Directory and HDInsight in hello same VNet and you don't need toodo peering.</span></span> 

![Топология присоединенного к домену кластера HDInsight](./media/hdinsight-domain-joined-architecture/hdinsight-domain-joined-architecture_1.png)

> [!NOTE]
> <span data-ttu-id="8a42c-126">В этой архитектуре хранилища Озера данных Azure нельзя использовать с кластером HDInsight hello.</span><span class="sxs-lookup"><span data-stu-id="8a42c-126">In this architecture, you cannot use Azure Data Lake Store with hello HDInsight cluster.</span></span>


<span data-ttu-id="8a42c-127">Предварительные требования для Active Directory:</span><span class="sxs-lookup"><span data-stu-id="8a42c-127">Prerequisites for Active Directory:</span></span>

* <span data-ttu-id="8a42c-128">[Подразделение](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md) должны создаваться, в которой можно разместить hello виртуальных машин кластера HDInsight и Здравствуйте, участники службы, используемой кластером hello.</span><span class="sxs-lookup"><span data-stu-id="8a42c-128">An [organizational unit](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md) must be created, within which you place hello HDInsight cluster VMs and hello service principals used by hello cluster.</span></span>
* <span data-ttu-id="8a42c-129">Для взаимодействия с AD необходимо настроить [протоколы LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md).</span><span class="sxs-lookup"><span data-stu-id="8a42c-129">[Lightweight Directory Access Protocols](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) (LDAPs) must be set up for communicating with AD.</span></span> <span data-ttu-id="8a42c-130">tooset сертификат, используемый Hello копирование LDAPS должно быть реальный сертификат (самозаверяющий сертификат).</span><span class="sxs-lookup"><span data-stu-id="8a42c-130">hello certificate used tooset up LDAPS must be a real certificate (not a self-signed certificate).</span></span>
* <span data-ttu-id="8a42c-131">Зоны обратного просмотра DNS должны создаваться в домене hello для hello диапазон IP-адресов подсети HDInsight hello (например, 10.2.0.0/24 на предыдущем рисунке hello).</span><span class="sxs-lookup"><span data-stu-id="8a42c-131">Reverse DNS zones must be created on hello domain for hello IP address range of hello HDInsight subnet (for example, 10.2.0.0/24 in hello previous picture).</span></span>
* <span data-ttu-id="8a42c-132">Потребуется учетная запись службы или учетная запись пользователя.</span><span class="sxs-lookup"><span data-stu-id="8a42c-132">A service account or a user account is needed.</span></span> <span data-ttu-id="8a42c-133">Используйте этот кластер HDInsight hello toocreate учетной записи.</span><span class="sxs-lookup"><span data-stu-id="8a42c-133">Use this account toocreate hello HDInsight cluster.</span></span> <span data-ttu-id="8a42c-134">Эта учетная запись должна иметь hello следующие разрешения:</span><span class="sxs-lookup"><span data-stu-id="8a42c-134">This account must have hello following permissions:</span></span>

    - <span data-ttu-id="8a42c-135">Разрешения toocreate service principal-объекты и объекты машины внутри подразделения hello</span><span class="sxs-lookup"><span data-stu-id="8a42c-135">Permissions toocreate service principal objects and machine objects within hello organizational unit</span></span>
    - <span data-ttu-id="8a42c-136">Правила обратного DNS прокси-сервера для разрешения toocreate</span><span class="sxs-lookup"><span data-stu-id="8a42c-136">Permissions toocreate reverse DNS proxy rules</span></span>
    - <span data-ttu-id="8a42c-137">Домен Active Directory toohello машины toojoin разрешения</span><span class="sxs-lookup"><span data-stu-id="8a42c-137">Permissions toojoin machines toohello Active Directory domain</span></span>

<span data-ttu-id="8a42c-138">**Интеграция HDInsight с облачной службой Azure AD**</span><span class="sxs-lookup"><span data-stu-id="8a42c-138">**HDInsight integrated with cloud-only Azure AD**</span></span>

<span data-ttu-id="8a42c-139">Чтобы интегрировать HDInsight с облачной службой Azure AD, необходимо настроить контроллер домена.</span><span class="sxs-lookup"><span data-stu-id="8a42c-139">For cloud-only Azure AD, configure a domain controller so that HDInsight can be integrated with Azure AD.</span></span> <span data-ttu-id="8a42c-140">Его можно настроить с помощью [доменных служб Azure Active Directory](../active-directory-domain-services/active-directory-ds-overview.md).</span><span class="sxs-lookup"><span data-stu-id="8a42c-140">This is achieved by using [Azure Active Directory Domain Services](../active-directory-domain-services/active-directory-ds-overview.md) (Azure AD DS).</span></span> <span data-ttu-id="8a42c-141">Azure AD DS создает машины контроллера домена в облаке hello и предоставляет IP-адресов для них.</span><span class="sxs-lookup"><span data-stu-id="8a42c-141">Azure AD DS creates domain controller machines on hello cloud and provides IP addresses for them.</span></span> <span data-ttu-id="8a42c-142">Чтобы обеспечить высокий уровень доступности, они создают два контроллера домена.</span><span class="sxs-lookup"><span data-stu-id="8a42c-142">It creates two domain controllers for high availability.</span></span>

<span data-ttu-id="8a42c-143">В настоящее время доменные службы Azure AD доступны только в классических виртуальных сетях.</span><span class="sxs-lookup"><span data-stu-id="8a42c-143">Currently, Azure AD DS exists only in classic virtual networks.</span></span> <span data-ttu-id="8a42c-144">Он доступен только с помощью hello классический портал Azure.</span><span class="sxs-lookup"><span data-stu-id="8a42c-144">It is only accessible by using hello Azure classic portal.</span></span> <span data-ttu-id="8a42c-145">Hello HDInsight виртуальная сеть отсутствует в hello портал Azure, которая должна toobe по рангу со hello классической виртуальной сети с помощью пиринг VNet-VNet.</span><span class="sxs-lookup"><span data-stu-id="8a42c-145">hello HDInsight virtual network exists in hello Azure portal, which needs toobe peered with hello classic virtual network by using VNet-to-VNet peering.</span></span>

> [!NOTE]
> <span data-ttu-id="8a42c-146">Пиринг между классической виртуальной сети и виртуальной сети необходимы обе виртуальные сети в диспетчер ресурсов Azure hello в одном регионе и в разделе hello же подписки Azure.</span><span class="sxs-lookup"><span data-stu-id="8a42c-146">Peering between a classic virtual network and an Azure Resource Manager virtual network requires that both virtual networks are in hello same region and under hello same Azure subscription.</span></span>

![Топология присоединенного к домену кластера HDInsight](./media/hdinsight-domain-joined-architecture/hdinsight-domain-joined-architecture_2.png)

<span data-ttu-id="8a42c-148">Необходимые условия для Azure AD:</span><span class="sxs-lookup"><span data-stu-id="8a42c-148">Prerequisites for Azure AD:</span></span>

* <span data-ttu-id="8a42c-149">[Подразделение](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md) должны создаваться в течение которого поместите hello виртуальных машин кластера HDInsight и Здравствуйте, участники службы, используемой кластером hello.</span><span class="sxs-lookup"><span data-stu-id="8a42c-149">An [organizational unit](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md) must be created within which you place hello HDInsight cluster VMs and hello service principals used by hello cluster.</span></span>
* <span data-ttu-id="8a42c-150">При настройке доменных служб Azure AD вам необходимо настроить [протокол LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md).</span><span class="sxs-lookup"><span data-stu-id="8a42c-150">[LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) must be set up when you configure Azure AD DS.</span></span> <span data-ttu-id="8a42c-151">tooset сертификат, используемый Hello копирование LDAPS должно быть реальный сертификат (самозаверяющий сертификат).</span><span class="sxs-lookup"><span data-stu-id="8a42c-151">hello certificate used tooset up LDAPS must be a real certificate (not a self-signed certificate).</span></span>
* <span data-ttu-id="8a42c-152">Зоны обратного просмотра DNS должны создаваться в домене hello для hello диапазон IP-адресов подсети HDInsight hello (например, 10.2.0.0/24 на предыдущем рисунке hello).</span><span class="sxs-lookup"><span data-stu-id="8a42c-152">Reverse DNS zones must be created on hello domain for hello IP address range of hello HDInsight subnet (for example, 10.2.0.0/24 in hello previous picture).</span></span>
* <span data-ttu-id="8a42c-153">[Хэши паролей](../active-directory-domain-services/active-directory-ds-getting-started-password-sync.md) должны быть синхронизированы с Azure AD tooAzure AD DS.</span><span class="sxs-lookup"><span data-stu-id="8a42c-153">[Password hashes](../active-directory-domain-services/active-directory-ds-getting-started-password-sync.md) must be synced from Azure AD tooAzure AD DS.</span></span>
* <span data-ttu-id="8a42c-154">Потребуется учетная запись службы или учетная запись пользователя.</span><span class="sxs-lookup"><span data-stu-id="8a42c-154">A service account or a user account is needed.</span></span> <span data-ttu-id="8a42c-155">Используйте этот кластер HDInsight hello toocreate учетной записи.</span><span class="sxs-lookup"><span data-stu-id="8a42c-155">Use this account toocreate hello HDInsight cluster.</span></span> <span data-ttu-id="8a42c-156">Эта учетная запись должна иметь hello следующие разрешения:</span><span class="sxs-lookup"><span data-stu-id="8a42c-156">This account must have hello following permissions:</span></span>

    - <span data-ttu-id="8a42c-157">Разрешения toocreate service principal-объекты и объекты машины внутри подразделения hello</span><span class="sxs-lookup"><span data-stu-id="8a42c-157">Permissions toocreate service principal objects and machine objects within hello organizational unit</span></span>
    - <span data-ttu-id="8a42c-158">Правила обратного DNS прокси-сервера для разрешения toocreate</span><span class="sxs-lookup"><span data-stu-id="8a42c-158">Permissions toocreate reverse DNS proxy rules</span></span>
    - <span data-ttu-id="8a42c-159">Машины toohello Azure AD разрешения toojoin домена</span><span class="sxs-lookup"><span data-stu-id="8a42c-159">Permissions toojoin machines toohello Azure AD domain</span></span>

## <a name="next-steps"></a><span data-ttu-id="8a42c-160">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="8a42c-160">Next steps</span></span>
* <span data-ttu-id="8a42c-161">tooconfigure кластера HDInsight присоединенных к домену, в разделе [настроить домену кластеров HDInsight](hdinsight-domain-joined-configure.md).</span><span class="sxs-lookup"><span data-stu-id="8a42c-161">tooconfigure a domain-joined HDInsight cluster, see [Configure domain-joined HDInsight clusters](hdinsight-domain-joined-configure.md).</span></span>
* <span data-ttu-id="8a42c-162">toomanage домену кластеров HDInsight, в разделе [управление кластерами HDInsight на присоединенных к домену](hdinsight-domain-joined-manage.md).</span><span class="sxs-lookup"><span data-stu-id="8a42c-162">toomanage domain-joined HDInsight clusters, see [Manage domain-joined HDInsight clusters](hdinsight-domain-joined-manage.md).</span></span>
* <span data-ttu-id="8a42c-163">политики tooconfigure Hive и выполнения запросов Hive, см. [Hive настроить политики для присоединенных к домену кластеров HDInsight](hdinsight-domain-joined-run-hive.md).</span><span class="sxs-lookup"><span data-stu-id="8a42c-163">tooconfigure Hive policies and run Hive queries, see [Configure Hive policies for domain-joined HDInsight clusters](hdinsight-domain-joined-run-hive.md).</span></span>
* <span data-ttu-id="8a42c-164">toorun запросов Hive с помощью SSH на присоединенных к домену кластеров HDInsight. в разделе [использование SSH с HDInsight](hdinsight-hadoop-linux-use-ssh-unix.md).</span><span class="sxs-lookup"><span data-stu-id="8a42c-164">toorun Hive queries by using SSH on domain-joined HDInsight clusters, see [Use SSH with HDInsight](hdinsight-hadoop-linux-use-ssh-unix.md).</span></span>
