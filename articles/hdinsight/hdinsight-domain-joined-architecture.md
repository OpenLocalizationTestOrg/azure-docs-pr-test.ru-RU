---
title: "Архитектура присоединенного к домену кластера Azure HDInsight | Документация Майкрософт"
description: "Сведения о планировании архитектуры присоединенного к домену кластера HDInsight."
services: hdinsight
documentationcenter: 
author: saurinsh
manager: jhubbard
editor: cgronlun
tags: azure-portal
ms.assetid: 7dc6847d-10d4-4b5c-9c83-cc513cf91965
ms.service: hdinsight
ms.custom: hdinsightactive
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 02/03/2017
ms.author: saurinsh
ms.openlocfilehash: 7e34f47f09466a40993b4cc797ff1cad2bdaeafe
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="plan-azure-domain-joined-hadoop-clusters-in-hdinsight"></a><span data-ttu-id="cfe9a-103">Планирование архитектуры присоединенных к домену кластеров Hadoop в Azure HDInsight</span><span class="sxs-lookup"><span data-stu-id="cfe9a-103">Plan Azure domain-joined Hadoop clusters in HDInsight</span></span>

<span data-ttu-id="cfe9a-104">Стандартный кластер Hadoop — это однопользовательский кластер.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-104">The traditional Hadoop is a single-user cluster.</span></span> <span data-ttu-id="cfe9a-105">Он подходит для большинства организаций с небольшими отделами по работе с приложениями, создающими объемные рабочие нагрузки данных.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-105">It is suitable for most companies that have smaller application teams building large data workloads.</span></span> <span data-ttu-id="cfe9a-106">В связи с ростом популярности кластера Hadoop многие организации переходят на модель, когда ИТ-специалисты управляют кластерами и несколько отделов по работе с приложениями совместно используют кластеры.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-106">As Hadoop gains popularity, many enterprises are moving toward a model in which clusters are managed by IT teams and multiple application teams share clusters.</span></span> <span data-ttu-id="cfe9a-107">Таким образом, возможности работы с многопользовательскими кластерами стали одними из самых запрашиваемых в Azure HDInsight.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-107">Thus, functionalities involving multiuser clusters are among the most requested functionalities in Azure HDInsight.</span></span>

<span data-ttu-id="cfe9a-108">Вместо создания собственной многопользовательской проверки подлинности и авторизации HDInsight полагается на самого популярного поставщика удостоверений — Active Directory (AD).</span><span class="sxs-lookup"><span data-stu-id="cfe9a-108">Instead of building its own multiuser authentication and authorization, HDInsight relies on the most popular identity provider--Active Directory (AD).</span></span> <span data-ttu-id="cfe9a-109">Расширенные возможности безопасности в AD можно использовать для управления многопользовательской проверкой подлинности в HDInsight.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-109">The powerful security functionality in AD can be used to manage multiuser authorization in HDInsight.</span></span> <span data-ttu-id="cfe9a-110">Интегрировав HDInsight с AD, вы сможете взаимодействовать с кластерами, используя свои учетные данные AD.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-110">By integrating HDInsight with AD, you can communicate with the clusters by using your AD credentials.</span></span> <span data-ttu-id="cfe9a-111">HDInsight сопоставляет пользователя AD с локальным пользователем Hadoop. За счет этого все пользовательские службы, запущенные в HDInsight (Ambari, сервер Hive, Ranger, сервер Thrift Spark и т. д.), работают эффективнее.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-111">HDInsight maps an AD user to a local Hadoop user, so all the services running on HDInsight (Ambari, Hive server, Ranger, Spark thrift server, and others) work seamlessly for the authenticated user.</span></span>

## <a name="integrate-hdinsight-with-ad-and-ad-on-iaas-vm"></a><span data-ttu-id="cfe9a-112">Интеграция HDInsight с AD и AD на виртуальных машинах IaaS</span><span class="sxs-lookup"><span data-stu-id="cfe9a-112">Integrate HDInsight with AD and AD on IaaS VM</span></span>

<span data-ttu-id="cfe9a-113">Если выполнить интеграцию HDInsight с Azure AD или AD на виртуальной машине IaaS, узлы кластера HDInsight присоединяются к домену.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-113">By integrating HDInsight with Azure AD or AD on Iaas VM, the HDInsight cluster nodes are domain-joined to a domain.</span></span> <span data-ttu-id="cfe9a-114">HDInsight создает субъекты-службы для служб Hadoop, запущенных в кластере, и помещает их в определенное подразделение в Azure AD или AD на виртуальной машине IaaS.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-114">HDInsight creates service principals for the Hadoop services running on the cluster and places them within a specified organizational unit (OU) in Azure AD or AD on IaaS VM.</span></span> <span data-ttu-id="cfe9a-115">Кроме того, он создает в домене обратные сопоставления DNS для IP-адресов узлов, присоединенных к домену.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-115">HDInsight also creates reverse DNS mappings in the domain for the IP addresses of the nodes that are joined to the domain.</span></span>

<span data-ttu-id="cfe9a-116">Чтобы получить эту конфигурацию, нужно использовать несколько архитектур.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-116">You can achieve this setup by using multiple architectures.</span></span> <span data-ttu-id="cfe9a-117">Вы можете выбрать один из следующих вариантов.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-117">You can choose from the following architectures.</span></span>

<span data-ttu-id="cfe9a-118">**Интеграция HDInsight с Active Directory, выполняемой в Azure IaaS**</span><span class="sxs-lookup"><span data-stu-id="cfe9a-118">**HDInsight integrated with AD running on Azure IaaS**</span></span>

<span data-ttu-id="cfe9a-119">Это самый простой вариант архитектуры для интеграции HDInsight с Active Directory.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-119">This is the simplest architecture for integrating HDInsight with Active Directory.</span></span> <span data-ttu-id="cfe9a-120">Контроллер домена AD запущен на одной (или нескольких) виртуальных машинах в Azure.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-120">The AD domain controller runs on one (or multiple) virtual machines (VMs) in Azure.</span></span> <span data-ttu-id="cfe9a-121">Обычно эти виртуальные машины находятся в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-121">These VMs are usually in a virtual network.</span></span> <span data-ttu-id="cfe9a-122">Для кластера HDInsight необходимо настроить еще одну виртуальную сеть.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-122">You set up another virtual network for the HDInsight cluster.</span></span> <span data-ttu-id="cfe9a-123">Чтобы обеспечить взаимодействие между HDInsight и Active Directory, между этими виртуальными сетями потребуется настроить пиринговую связь, как описано в [этой статье](../virtual-network/virtual-network-create-peering.md).</span><span class="sxs-lookup"><span data-stu-id="cfe9a-123">For HDInsight to have a line of sight to Active Directory, you need to peer these virtual networks by using [VNet-to-VNet peering](../virtual-network/virtual-network-create-peering.md).</span></span> <span data-ttu-id="cfe9a-124">Если вы создаете Active Directory в ARM, то Active Directory и HDInsight можно создать в той же виртуальной сети без использования пиринговой связи.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-124">If you create the Active Directory in ARM, then you can create the Active Directory and HDInsight in the same VNet and you don't need to do peering.</span></span> 

![Топология присоединенного к домену кластера HDInsight](./media/hdinsight-domain-joined-architecture/hdinsight-domain-joined-architecture_1.png)

> [!NOTE]
> <span data-ttu-id="cfe9a-126">В этой архитектуре вы не можете использовать Azure Data Lake Store с кластером HDInsight.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-126">In this architecture, you cannot use Azure Data Lake Store with the HDInsight cluster.</span></span>


<span data-ttu-id="cfe9a-127">Предварительные требования для Active Directory:</span><span class="sxs-lookup"><span data-stu-id="cfe9a-127">Prerequisites for Active Directory:</span></span>

* <span data-ttu-id="cfe9a-128">Необходимо создать [подразделение](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md), в котором будут размещены виртуальные машины кластера HDInsight и используемые в кластере субъекты-службы.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-128">An [organizational unit](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md) must be created, within which you place the HDInsight cluster VMs and the service principals used by the cluster.</span></span>
* <span data-ttu-id="cfe9a-129">Для взаимодействия с AD необходимо настроить [протоколы LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md).</span><span class="sxs-lookup"><span data-stu-id="cfe9a-129">[Lightweight Directory Access Protocols](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) (LDAPs) must be set up for communicating with AD.</span></span> <span data-ttu-id="cfe9a-130">Сертификат, используемый для настройки протокола LDAPS, должен быть реальным (а не самозаверяющим).</span><span class="sxs-lookup"><span data-stu-id="cfe9a-130">The certificate used to set up LDAPS must be a real certificate (not a self-signed certificate).</span></span>
* <span data-ttu-id="cfe9a-131">В домене необходимо создать обратные зоны DNS для диапазона IP-адресов из подсети HDInsight (например, 10.2.0.0/24 на предыдущем рисунке).</span><span class="sxs-lookup"><span data-stu-id="cfe9a-131">Reverse DNS zones must be created on the domain for the IP address range of the HDInsight subnet (for example, 10.2.0.0/24 in the previous picture).</span></span>
* <span data-ttu-id="cfe9a-132">Потребуется учетная запись службы или учетная запись пользователя.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-132">A service account or a user account is needed.</span></span> <span data-ttu-id="cfe9a-133">Используйте эту учетную запись для создания кластера HDInsight.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-133">Use this account to create the HDInsight cluster.</span></span> <span data-ttu-id="cfe9a-134">Эта учетная запись должна иметь следующие разрешения:</span><span class="sxs-lookup"><span data-stu-id="cfe9a-134">This account must have the following permissions:</span></span>

    - <span data-ttu-id="cfe9a-135">разрешения на создание объектов субъекта-службы и объектов компьютеров в рамках подразделения;</span><span class="sxs-lookup"><span data-stu-id="cfe9a-135">Permissions to create service principal objects and machine objects within the organizational unit</span></span>
    - <span data-ttu-id="cfe9a-136">разрешения на создание правил прокси-сервера для обратных зон DNS;</span><span class="sxs-lookup"><span data-stu-id="cfe9a-136">Permissions to create reverse DNS proxy rules</span></span>
    - <span data-ttu-id="cfe9a-137">разрешения на присоединение компьютеров к домену Active Directory.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-137">Permissions to join machines to the Active Directory domain</span></span>

<span data-ttu-id="cfe9a-138">**Интеграция HDInsight с облачной службой Azure AD**</span><span class="sxs-lookup"><span data-stu-id="cfe9a-138">**HDInsight integrated with cloud-only Azure AD**</span></span>

<span data-ttu-id="cfe9a-139">Чтобы интегрировать HDInsight с облачной службой Azure AD, необходимо настроить контроллер домена.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-139">For cloud-only Azure AD, configure a domain controller so that HDInsight can be integrated with Azure AD.</span></span> <span data-ttu-id="cfe9a-140">Его можно настроить с помощью [доменных служб Azure Active Directory](../active-directory-domain-services/active-directory-ds-overview.md).</span><span class="sxs-lookup"><span data-stu-id="cfe9a-140">This is achieved by using [Azure Active Directory Domain Services](../active-directory-domain-services/active-directory-ds-overview.md) (Azure AD DS).</span></span> <span data-ttu-id="cfe9a-141">Доменные службы Azure AD создают в облаке компьютеры контроллера домена и предоставляют их IP-адреса.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-141">Azure AD DS creates domain controller machines on the cloud and provides IP addresses for them.</span></span> <span data-ttu-id="cfe9a-142">Чтобы обеспечить высокий уровень доступности, они создают два контроллера домена.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-142">It creates two domain controllers for high availability.</span></span>

<span data-ttu-id="cfe9a-143">В настоящее время доменные службы Azure AD доступны только в классических виртуальных сетях.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-143">Currently, Azure AD DS exists only in classic virtual networks.</span></span> <span data-ttu-id="cfe9a-144">Доступ к ним можно получить только с помощью классического портала Azure.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-144">It is only accessible by using the Azure classic portal.</span></span> <span data-ttu-id="cfe9a-145">Между существующей на портале Azure виртуальной сетью HDInsight и классической виртуальной сетью необходимо настроить пиринговую связь.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-145">The HDInsight virtual network exists in the Azure portal, which needs to be peered with the classic virtual network by using VNet-to-VNet peering.</span></span>

> [!NOTE]
> <span data-ttu-id="cfe9a-146">Создать пиринг между классической виртуальной сетью и виртуальной сетью Azure Resource Manager возможно, только если они находятся в одном регионе и относятся к одной подписке Azure.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-146">Peering between a classic virtual network and an Azure Resource Manager virtual network requires that both virtual networks are in the same region and under the same Azure subscription.</span></span>

![Топология присоединенного к домену кластера HDInsight](./media/hdinsight-domain-joined-architecture/hdinsight-domain-joined-architecture_2.png)

<span data-ttu-id="cfe9a-148">Необходимые условия для Azure AD:</span><span class="sxs-lookup"><span data-stu-id="cfe9a-148">Prerequisites for Azure AD:</span></span>

* <span data-ttu-id="cfe9a-149">Необходимо создать [подразделение](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md), в котором будут размещены виртуальные машины кластера HDInsight и используемые в кластере субъекты-службы.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-149">An [organizational unit](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md) must be created within which you place the HDInsight cluster VMs and the service principals used by the cluster.</span></span>
* <span data-ttu-id="cfe9a-150">При настройке доменных служб Azure AD вам необходимо настроить [протокол LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md).</span><span class="sxs-lookup"><span data-stu-id="cfe9a-150">[LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) must be set up when you configure Azure AD DS.</span></span> <span data-ttu-id="cfe9a-151">Сертификат, используемый для настройки протокола LDAPS, должен быть реальным (а не самозаверяющим).</span><span class="sxs-lookup"><span data-stu-id="cfe9a-151">The certificate used to set up LDAPS must be a real certificate (not a self-signed certificate).</span></span>
* <span data-ttu-id="cfe9a-152">В домене необходимо создать обратные зоны DNS для диапазона IP-адресов из подсети HDInsight (например, 10.2.0.0/24 на предыдущем рисунке).</span><span class="sxs-lookup"><span data-stu-id="cfe9a-152">Reverse DNS zones must be created on the domain for the IP address range of the HDInsight subnet (for example, 10.2.0.0/24 in the previous picture).</span></span>
* <span data-ttu-id="cfe9a-153">Необходимо синхронизировать [хэши паролей](../active-directory-domain-services/active-directory-ds-getting-started-password-sync.md) из Azure AD в доменные службы Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-153">[Password hashes](../active-directory-domain-services/active-directory-ds-getting-started-password-sync.md) must be synced from Azure AD to Azure AD DS.</span></span>
* <span data-ttu-id="cfe9a-154">Потребуется учетная запись службы или учетная запись пользователя.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-154">A service account or a user account is needed.</span></span> <span data-ttu-id="cfe9a-155">Используйте эту учетную запись для создания кластера HDInsight.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-155">Use this account to create the HDInsight cluster.</span></span> <span data-ttu-id="cfe9a-156">Эта учетная запись должна иметь следующие разрешения:</span><span class="sxs-lookup"><span data-stu-id="cfe9a-156">This account must have the following permissions:</span></span>

    - <span data-ttu-id="cfe9a-157">разрешения на создание объектов субъекта-службы и объектов компьютеров в рамках подразделения;</span><span class="sxs-lookup"><span data-stu-id="cfe9a-157">Permissions to create service principal objects and machine objects within the organizational unit</span></span>
    - <span data-ttu-id="cfe9a-158">разрешения на создание правил прокси-сервера для обратных зон DNS;</span><span class="sxs-lookup"><span data-stu-id="cfe9a-158">Permissions to create reverse DNS proxy rules</span></span>
    - <span data-ttu-id="cfe9a-159">разрешения на присоединение компьютеров к домену Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cfe9a-159">Permissions to join machines to the Azure AD domain</span></span>

## <a name="next-steps"></a><span data-ttu-id="cfe9a-160">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="cfe9a-160">Next steps</span></span>
* <span data-ttu-id="cfe9a-161">Сведения о настройке присоединенного к домену кластера HDInsight см. в [этой статье](hdinsight-domain-joined-configure.md).</span><span class="sxs-lookup"><span data-stu-id="cfe9a-161">To configure a domain-joined HDInsight cluster, see [Configure domain-joined HDInsight clusters](hdinsight-domain-joined-configure.md).</span></span>
* <span data-ttu-id="cfe9a-162">Сведения об управлении присоединенными к домену кластерами HDInsight см. в [этой статье](hdinsight-domain-joined-manage.md).</span><span class="sxs-lookup"><span data-stu-id="cfe9a-162">To manage domain-joined HDInsight clusters, see [Manage domain-joined HDInsight clusters](hdinsight-domain-joined-manage.md).</span></span>
* <span data-ttu-id="cfe9a-163">Сведения о настройке политик Hive и выполнении запросов Hive см. в статье [Настройка политик Hive в присоединенном к домену кластере HDInsight (предварительная версия)](hdinsight-domain-joined-run-hive.md).</span><span class="sxs-lookup"><span data-stu-id="cfe9a-163">To configure Hive policies and run Hive queries, see [Configure Hive policies for domain-joined HDInsight clusters](hdinsight-domain-joined-run-hive.md).</span></span>
* <span data-ttu-id="cfe9a-164">Сведения о выполнении запросов Hive с помощью SSH в присоединенных к домену кластерах HDInsight см. в статье [Подключение к HDInsight (Hadoop) с помощью SSH](hdinsight-hadoop-linux-use-ssh-unix.md).</span><span class="sxs-lookup"><span data-stu-id="cfe9a-164">To run Hive queries by using SSH on domain-joined HDInsight clusters, see [Use SSH with HDInsight](hdinsight-hadoop-linux-use-ssh-unix.md).</span></span>
