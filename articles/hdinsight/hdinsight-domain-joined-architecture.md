---
title: "Архитектура присоединенного к домену кластера Azure HDInsight | Документация Майкрософт"
description: "Сведения о планировании архитектуры присоединенного к домену кластера HDInsight."
services: hdinsight
documentationcenter: 
author: saurinsh
manager: jhubbard
editor: cgronlun
tags: azure-portal
ms.assetid: 7dc6847d-10d4-4b5c-9c83-cc513cf91965
ms.service: hdinsight
ms.custom: hdinsightactive
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 02/03/2017
ms.author: saurinsh
ms.openlocfilehash: 7e34f47f09466a40993b4cc797ff1cad2bdaeafe
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="plan-azure-domain-joined-hadoop-clusters-in-hdinsight"></a>Планирование архитектуры присоединенных к домену кластеров Hadoop в Azure HDInsight

Стандартный кластер Hadoop — это однопользовательский кластер. Он подходит для большинства организаций с небольшими отделами по работе с приложениями, создающими объемные рабочие нагрузки данных. В связи с ростом популярности кластера Hadoop многие организации переходят на модель, когда ИТ-специалисты управляют кластерами и несколько отделов по работе с приложениями совместно используют кластеры. Таким образом, возможности работы с многопользовательскими кластерами стали одними из самых запрашиваемых в Azure HDInsight.

Вместо создания собственной многопользовательской проверки подлинности и авторизации HDInsight полагается на самого популярного поставщика удостоверений — Active Directory (AD). Расширенные возможности безопасности в AD можно использовать для управления многопользовательской проверкой подлинности в HDInsight. Интегрировав HDInsight с AD, вы сможете взаимодействовать с кластерами, используя свои учетные данные AD. HDInsight сопоставляет пользователя AD с локальным пользователем Hadoop. За счет этого все пользовательские службы, запущенные в HDInsight (Ambari, сервер Hive, Ranger, сервер Thrift Spark и т. д.), работают эффективнее.

## <a name="integrate-hdinsight-with-ad-and-ad-on-iaas-vm"></a>Интеграция HDInsight с AD и AD на виртуальных машинах IaaS

Если выполнить интеграцию HDInsight с Azure AD или AD на виртуальной машине IaaS, узлы кластера HDInsight присоединяются к домену. HDInsight создает субъекты-службы для служб Hadoop, запущенных в кластере, и помещает их в определенное подразделение в Azure AD или AD на виртуальной машине IaaS. Кроме того, он создает в домене обратные сопоставления DNS для IP-адресов узлов, присоединенных к домену.

Чтобы получить эту конфигурацию, нужно использовать несколько архитектур. Вы можете выбрать один из следующих вариантов.

**Интеграция HDInsight с Active Directory, выполняемой в Azure IaaS**

Это самый простой вариант архитектуры для интеграции HDInsight с Active Directory. Контроллер домена AD запущен на одной (или нескольких) виртуальных машинах в Azure. Обычно эти виртуальные машины находятся в виртуальной сети. Для кластера HDInsight необходимо настроить еще одну виртуальную сеть. Чтобы обеспечить взаимодействие между HDInsight и Active Directory, между этими виртуальными сетями потребуется настроить пиринговую связь, как описано в [этой статье](../virtual-network/virtual-network-create-peering.md). Если вы создаете Active Directory в ARM, то Active Directory и HDInsight можно создать в той же виртуальной сети без использования пиринговой связи. 

![Топология присоединенного к домену кластера HDInsight](./media/hdinsight-domain-joined-architecture/hdinsight-domain-joined-architecture_1.png)

> [!NOTE]
> В этой архитектуре вы не можете использовать Azure Data Lake Store с кластером HDInsight.


Предварительные требования для Active Directory:

* Необходимо создать [подразделение](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md), в котором будут размещены виртуальные машины кластера HDInsight и используемые в кластере субъекты-службы.
* Для взаимодействия с AD необходимо настроить [протоколы LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md). Сертификат, используемый для настройки протокола LDAPS, должен быть реальным (а не самозаверяющим).
* В домене необходимо создать обратные зоны DNS для диапазона IP-адресов из подсети HDInsight (например, 10.2.0.0/24 на предыдущем рисунке).
* Потребуется учетная запись службы или учетная запись пользователя. Используйте эту учетную запись для создания кластера HDInsight. Эта учетная запись должна иметь следующие разрешения:

    - разрешения на создание объектов субъекта-службы и объектов компьютеров в рамках подразделения;
    - разрешения на создание правил прокси-сервера для обратных зон DNS;
    - разрешения на присоединение компьютеров к домену Active Directory.

**Интеграция HDInsight с облачной службой Azure AD**

Чтобы интегрировать HDInsight с облачной службой Azure AD, необходимо настроить контроллер домена. Его можно настроить с помощью [доменных служб Azure Active Directory](../active-directory-domain-services/active-directory-ds-overview.md). Доменные службы Azure AD создают в облаке компьютеры контроллера домена и предоставляют их IP-адреса. Чтобы обеспечить высокий уровень доступности, они создают два контроллера домена.

В настоящее время доменные службы Azure AD доступны только в классических виртуальных сетях. Доступ к ним можно получить только с помощью классического портала Azure. Между существующей на портале Azure виртуальной сетью HDInsight и классической виртуальной сетью необходимо настроить пиринговую связь.

> [!NOTE]
> Создать пиринг между классической виртуальной сетью и виртуальной сетью Azure Resource Manager возможно, только если они находятся в одном регионе и относятся к одной подписке Azure.

![Топология присоединенного к домену кластера HDInsight](./media/hdinsight-domain-joined-architecture/hdinsight-domain-joined-architecture_2.png)

Необходимые условия для Azure AD:

* Необходимо создать [подразделение](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md), в котором будут размещены виртуальные машины кластера HDInsight и используемые в кластере субъекты-службы.
* При настройке доменных служб Azure AD вам необходимо настроить [протокол LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md). Сертификат, используемый для настройки протокола LDAPS, должен быть реальным (а не самозаверяющим).
* В домене необходимо создать обратные зоны DNS для диапазона IP-адресов из подсети HDInsight (например, 10.2.0.0/24 на предыдущем рисунке).
* Необходимо синхронизировать [хэши паролей](../active-directory-domain-services/active-directory-ds-getting-started-password-sync.md) из Azure AD в доменные службы Azure AD.
* Потребуется учетная запись службы или учетная запись пользователя. Используйте эту учетную запись для создания кластера HDInsight. Эта учетная запись должна иметь следующие разрешения:

    - разрешения на создание объектов субъекта-службы и объектов компьютеров в рамках подразделения;
    - разрешения на создание правил прокси-сервера для обратных зон DNS;
    - разрешения на присоединение компьютеров к домену Azure AD.

## <a name="next-steps"></a>Дальнейшие действия
* Сведения о настройке присоединенного к домену кластера HDInsight см. в [этой статье](hdinsight-domain-joined-configure.md).
* Сведения об управлении присоединенными к домену кластерами HDInsight см. в [этой статье](hdinsight-domain-joined-manage.md).
* Сведения о настройке политик Hive и выполнении запросов Hive см. в статье [Настройка политик Hive в присоединенном к домену кластере HDInsight (предварительная версия)](hdinsight-domain-joined-run-hive.md).
* Сведения о выполнении запросов Hive с помощью SSH в присоединенных к домену кластерах HDInsight см. в статье [Подключение к HDInsight (Hadoop) с помощью SSH](hdinsight-hadoop-linux-use-ssh-unix.md).
