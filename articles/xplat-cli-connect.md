---
title: "Вход в Azure из интерфейса командной строки | Документация Майкрософт"
description: "Подключение к подписке Azure из интерфейса командной строки Azure (Azure CLI) на компьютерах Mac, Linux и Windows"
editor: tysonn
manager: timlt
documentationcenter: 
author: squillace
services: virtual-machines-linux,virtual-network,storage,azure-resource-manager
tags: azure-resource-manager,azure-service-management
ms.assetid: ed856527-d75e-4e16-93fb-253dafad209d
ms.service: multiple
ms.workload: multiple
ms.tgt_pltfrm: vm-multiple
ms.devlang: na
ms.topic: article
ms.date: 10/04/2016
ms.author: rasquill
"\"/": 
ms.openlocfilehash: 31efab60690b54faf7992251fcd01e307c4464f2
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="log-in-to-azure-from-the-azure-cli"></a>Войдите в Azure из командной строки Azure
Интерфейс командной строки Azure представляет собой набор межплатформенных команд с открытым кодом для работы с ресурсами Azure. В этой статье описываются различные способы предоставления учетных данных для подключения к подписке Azure из интерфейса командной строки.

* Выполните команду `azure login` для проверки подлинности с помощью Azure Active Directory. Этот метод предоставляет доступ к командам в обоих [режимах команд](#cli-command-modes). При выполнении команды без дополнительных параметров `azure login` предложит выполнить вход интерактивно с помощью веб-портала. Для получения сведений о дополнительных параметрах команды `azure login` обратитесь к сценариям, представленным в этой статье, или введите `azure login --help`.
* Если необходимы только команды для режима управления службами Azure (не рекомендуется для наиболее развертываний), можно скачать и установить файл параметров публикации на компьютере.

Если вы еще не установили интерфейс командной строки Azure, см. раздел [Установка интерфейса командной строки Azure](cli-install-nodejs.md). Если у вас нет подписки Azure, то всего за несколько минут можно создать [бесплатную учетную запись](http://azure.microsoft.com/free/).

Основные сведения о различных удостоверениях учетной записи и подписках Azure см. в разделе [Как подписки Azure связаны с Azure Active Directory](active-directory/active-directory-how-subscriptions-associated-directory.md).

## <a name="scenario-1-azure-login-with-interactive-login"></a>Сценарий 1. Интерактивный вход в Azure
Для определенных учетных записей в интерфейсе командной строки требуется запустить `azure login`, а затем продолжить процесс входа в систему в веб-портал в браузере. Этот процесс называется *интерактивным входом в систему*. Наиболее частая причина в том, что у вас есть рабочая или учебная учетная запись (также называемая *учетной записью организации*), для которой включено требование многофакторной проверки подлинности. Также используйте интерактивный вход в систему с учетной записью Майкрософт в том случае, если вы хотите использовать режим команд Resource Manager.

Для интерактивного входа в систему просто наберите `azure login` без параметров, как показано в следующем примере:

```
azure login
```                                                                                             

Результаты должны быть примерно следующими.

```         
info:    Executing command login
info:    To sign in, use a web browser to open the page http://aka.ms/devicelogin. Enter the code XXXXXXXXX to authenticate.
```
Скопируйте код в выходных данных команды и откройте в браузере адрес http://aka.ms/devicelogin или другую страницу, если она указана. (Браузер можно открыть на том же компьютере или на другом компьютере или устройстве.) Введите код, и вам будет предложено ввести имя пользователя и пароль для удостоверения, которое нужно использовать. По завершении этого процесса командная оболочка завершит процедуру входа в систему. Это будет иметь следующий вид:

    info:    Added subscription Visual Studio Ultimate with MSDN
    info:    Added subscription Azure Free Trial
    info:    Setting subscription "Visual Studio Ultimate with MSDN" as default
    +
    info:    login command OK

> [!NOTE]
> При интерактивном входе в систему проверка подлинности и авторизация выполняются с помощью Azure Active Directory. При входе с удостоверением учетной записи Майкрософт осуществляется вход в домен Azure Active Directory по умолчанию. (Если вы зарегистрировались для получения бесплатной учетной записи Azure, в Azure Active Directory создается домен по умолчанию для вашей учетной записи.)
>
>

## <a name="scenario-2-azure-login-with-a-username-and-password"></a>Сценарий 2. Вход в Azure с именем пользователя и паролем
Если вам нужна рабочая или учебная учетная запись, не требующая многофакторной проверки подлинности, используйте для аутентификации команду `azure login` , указав параметр имени пользователя (`-u`). Вам будет предложено ввести пароль в командной строке пароль (или при необходимости пароль можно передать как дополнительный параметр команды `azure login`). В следующем примере передается имя пользователя учетной записи организации:

    azure login -u myUserName@contoso.onmicrosoft.com

Затем вам будет предложено ввести пароль.

    info:    Executing command login
    Password: *********

После этого вход в систему будет завершен.

    info:    Added subscription Visual Studio Ultimate with MSDN
    +
    info:    login command OK

Если учетные данные используются для входа в систему впервые, вам предложат указать, нужно ли кэшировать маркер проверки подлинности. Аналогичный запрос появляется также в том случае, если ранее вы использовали команду `azure logout` (описана далее в этой статье). Чтобы пропустить этот запрос в сценариях автоматизации, добавьте к команде `azure login` параметр `-q`.

## <a name="scenario-3-azure-login-with-a-service-principal"></a>Сценарий 3. Вход в Azure с субъектом-службой
Если вы создали субъект-службу для приложения Active Directory, и у субъекта-службы есть разрешения для использования вашей подписки, можно выполнить команду `azure login` для проверки подлинности субъекта-службы. В зависимости от сценария учетные данные субъекта-службы можно передавать в качестве явных параметров команды `azure login`. Например следующая команда передает имя субъекта-службы и идентификатор клиента Active Directory:

    azure login -u https://www.contoso.org/example --service-principal --tenant myTenantID

Затем вам будет предложено ввести пароль. Учетные данные также можно указать в командной строке или в коде приложения или воспользоваться сертификатом для проверки подлинности субъекта-службы в неинтерактивном режиме в сценариях автоматизации. Дополнительные сведения и примеры см. в статье [Проверка подлинности субъекта-службы в Azure Resource Manager](resource-group-authenticate-service-principal-cli.md).

## <a name="scenario-4-use-a-publish-settings-file"></a>Сценарий 4. Использование файла параметров публикации
Если вам требуются только команды интерфейса командной строки режима управления службами Azure (например, для развертывания виртуальных машин Azure с помощью классической модели), то для подключения можно использовать файл параметров публикации. В этом методе на локальном компьютере устанавливается сертификат, который позволяет выполнять задачи управления до тех пор, пока подписка и сертификат действительны.

* **Чтобы скачать файл параметров публикации** для своей учетной записи, переключите интерфейс командной строки в режим управления службами, набрав `azure config mode asm`. Затем выполните следующую команду.

        azure account download

После этого откроется браузер по умолчанию и появится запрос на вход в [классический портал Azure](https://manage.windowsazure.com). После входа в систему загрузится файл `.publishsettings` . Запишите место сохранения этого файла.

> [!NOTE]
> Если ваша учетная запись связана с несколькими клиентами Azure Active Directory, может появиться запрос на выбор службы Active Directory, для которой следует загрузить файл параметров публикации.
>
>

После выбора на странице загрузки или на классическом портале Azure соответствующая служба Active Directory становится службой каталогов по умолчанию, которая будет использоваться на классическом портале и странице загрузки. После определения службы каталогов по умолчанию в верхней части страницы загрузки появится текст "**щелкните здесь, чтобы вернуться на страницу выбора**". Используйте предоставленную ссылку, чтобы вернуться на страницу выбора.

* Чтобы **импортировать файл параметров публикации**, выполните следующую команду:

        azure account import <path to your .publishsettings file>

> [!IMPORTANT]
> После импорта параметров публикации файл `.publishsettings` необходимо удалить. Он больше не требуется интерфейсу Azure CLI и создает угрозу безопасности, поскольку может быть использован для получения доступа к подписке.
>
>

## <a name="cli-command-modes"></a>Режимы команд CLI
Azure CLI предоставляет два режима команд для работы с ресурсами Azure, включающих разные наборы команд:

* **Режим Resource Manager** — для работы с ресурсами Azure в модели развертывания с помощью Resource Manager. Чтобы установить этот режим, выполните командлет `azure config mode arm`.
* **Режим управления службами** — для работы с ресурсами Azure в классической модели развертывания. Чтобы установить этот режим, выполните командлет `azure config mode asm`.

При первой установке текущего выпуска интерфейс командной строки находится в режиме Resource Manager.

> [!NOTE]
> Режим Resource Manager и режим управления службами являются взаимоисключающими. То есть ресурсами, созданными в одном из режимов, нельзя управлять из другого режима.
>
>

## <a name="multiple-subscriptions"></a>Несколько подписок
Если у вас есть несколько подписок Azure, то при подключении к Azure вы получаете доступ ко всем подпискам, связанным с вашими учетными данными. При этом одна подписка выбирается по умолчанию и используется для выполнения операций в Azure CLI. Для просмотра подписок, включая текущую подписку по умолчанию, выполните команду `azure account list`. Эта команда возвращает сведения следующего вида:

    info:    Executing command account list
    data:    Name              Id                                    Current
    data:    ----------------  ------------------------------------  -------
    data:    Azure-sub-1       ####################################  true
    data:    Azure-sub-2       ####################################  false

В приведенном выше списке в столбце **Текущая** указана текущая подписка по умолчанию — Azure-sub-1. Для изменения подписки по умолчанию используйте команду `azure account set` , указав соответствующую подписку. Например:

    azure account set Azure-sub-2

Это приведет к изменению подписки по умолчанию на Azure-sub-2.

> [!NOTE]
> Изменение подписки по умолчанию вступает в силу немедленно и является глобальным изменением. При выполнении новых команд в том же или в другом экземпляре командной строки будет использоваться новая подписка по умолчанию.
>
>

Если вы хотите при работе с Azure CLI использовать подписку, которая не выбрана по умолчанию, но не хотите менять текущие настройки, вы можете использовать параметр `--subscription` , указав имя подписки, которую следует использовать для данной операции.

Подключившись к подписке Azure, можно приступать к использованию команд Azure CLI для работы с ресурсами Azure.

## <a name="storage-of-cli-settings"></a>Хранение параметров CLI
Если для входа в систему используется команда `azure login` или импорт параметров публикации, то профиль интерфейса командной строки и журналы сохраняются в каталог `.azure`, который находится в каталоге `user`. Каталог `user` защищен операционной системой. Тем не менее рекомендуется принять дополнительные меры для шифрования каталога `user`. Это можно сделать одним из следующих способов:

* В ОС Windows измените свойства каталога или используйте BitLocker.
* В ОС Mac включите FileVault для этого каталога.
* В ОС Ubuntu используйте функцию каталога Encrypted Home. Другие дистрибутивы Linux включают аналогичные функции.

## <a name="logging-out"></a>Выход из системы
Чтобы выйти из системы, введите следующую команду:

    azure logout -u <username>

Если для проверки подлинности подписок, связанных с учетной записью, используется только Active Directory, при выходе из системы данные о подписке удаляются из локального профиля. Однако если вы также импортировали файл параметров публикации для подписок, то при выходе из системы из локального профиля удаляются только данные, относящиеся к Active Directory.

## <a name="next-steps"></a>Дальнейшие действия
* Инструкции по работе с командами интерфейса командной строки Azure см. в статьях [Интерфейс командной строки Azure в режиме Resource Manager](virtual-machines/azure-cli-arm-commands.md) и [Интерфейс командной строки Azure в режиме управления службами](https://docs.microsoft.com/cli/azure/get-started-with-az-cli2).
* Для того чтобы получить дополнительные сведения об интерфейсе командной строки Azure, скачать исходный код, сообщить о проблемах или принять участие в проекте, зайдите в [репозиторий GitHub для интерфейса командной строки Azure](https://github.com/azure/azure-xplat-cli).
* Если у вас возникли проблемы с использованием Azure CLI или Azure, посетите [форумы Azure](https://social.msdn.microsoft.com/Forums/en-US/home?forum=azurescripting).
