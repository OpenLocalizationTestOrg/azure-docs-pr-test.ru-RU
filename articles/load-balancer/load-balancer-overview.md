---
title: "Обзор балансировки нагрузки aaaAzure | Документы Microsoft"
description: "Обзор функций балансировщика нагрузки Azure, его архитектуры и реализации. Узнайте, как работает hello балансировки нагрузки и использовать его в облаке hello."
services: load-balancer
documentationcenter: na
author: kumudd
manager: timlt
editor: 
ms.assetid: 0f313dc0-f007-4cee-b2b9-f542357925a3
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/24/2016
ms.author: kumud
ms.openlocfilehash: 2376a02f7cbbbed6a90f216419c0c3d30f594272
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="azure-load-balancer-overview"></a>Обзор балансировщика нагрузки Azure

Подсистема балансировки нагрузки Azure обеспечивает высокий уровень доступности и сетевой производительности tooyour приложений. Это балансировщик нагрузки уровня 4 (TCP, UDP), распределяющий входящий трафик между работоспособными экземплярами служб, определенных в наборе балансировки нагрузки.

Вот какие функции можно настроить в службе Azure Load Balancer:

* Балансировку нагрузки входящего Интернет трафика toovirtual машин. Такая конфигурация называется [балансировкой нагрузки для Интернета](load-balancer-internet-overview.md).
* Балансировка нагрузки трафика между виртуальными машинами в виртуальной сети, между виртуальными машинами в облачных службах или между локальными компьютерами и виртуальными машинами в распределенной виртуальной сети. Такая конфигурация называется [внутренней балансировкой нагрузки](load-balancer-internal-overview.md).
* Пересылка внешнего трафика tooa отдельную виртуальную машину.

Все ресурсы в облаке hello должны открытый toobe адрес IP, доступная через Интернет hello. Hello облачной инфраструктуры в Azure использует немаршрутизируемый IP-адреса для его ресурсов. Azure использует преобразование сетевых адресов (NAT) с помощью открытого IP адресов toocommunicate toohello Интернета.

## <a name="azure-deployment-models"></a>Модели развертывания Azure

Это важные toounderstand hello различия между hello Azure классические и диспетчер ресурсов [модели развертывания](../azure-resource-manager/resource-manager-deployment-model.md). В каждой модели Azure Load Balancer настраивается по-разному.

### <a name="azure-classic-deployment-model"></a>классическая модель развертывания Azure

Виртуальные машины, развернутые в пределах границ облачной службы может быть сгруппированных toouse подсистемы балансировки нагрузки. В этой модели общедоступный IP-адрес и полное доменное имя, (FQDN) назначаются tooa облачной службы. Подсистема балансировки нагрузки Hello порт перевода и распределяет hello сетевого трафика с помощью hello общедоступный IP-адрес для hello облачной службы.

Трафик с балансировкой нагрузки определяется конечными точками. Конечные точки порта преобразования имеют однозначное соответствие между hello назначенный public hello общедоступного IP-адреса и hello локальный порт назначенный toohello службы на конкретной виртуальной машины. Конечные точки балансировки нагрузки содержат один ко многим связь между hello общедоступный IP-адрес и hello локальные порты, назначенные toohello служб на виртуальных машинах hello в облачной службе hello.

![Подсистема балансировки нагрузки Azure в hello классической модели развертывания](./media/load-balancer-overview/asm-lb.png)

Рис. 1. Подсистема балансировки нагрузки Azure в hello классической модели развертывания

метки домена Hello hello общедоступный IP-адрес, который hello использует подсистемы балансировки нагрузки для данной модели развертывания \<имя облачной службы\>. cloudapp.net. Hello следующей схеме показаны hello подсистемы балансировки нагрузки Azure в этой модели.

### <a name="azure-resource-manager-deployment-model"></a>Модель развертывания диспетчера ресурсов Azure

В модели развертывания диспетчера ресурсов hello нет toocreate нет необходимости в облачной службе. Подсистема балансировки нагрузки Hello создается tooexplicitly маршрутизацию трафика между несколькими виртуальными машинами.

Общедоступный IP-адрес является отдельным ресурсом с меткой домена (DNS-именем). Hello общедоступный IP-адрес связан с ресурсом подсистемы балансировки нагрузки hello. Правила подсистемы балансировки нагрузки и правила для входящих подключений NAT служит hello общедоступный IP-адрес hello Интернет конечной точки для ресурсов hello, получающие балансировки нагрузки сетевого трафика.

Частный или общедоступный IP-адрес назначается toohello сетевой интерфейс ресурсов присоединенного tooa виртуальной машины. После добавления пула IP-адресов подсистемы балансировки нагрузки tooa внутренней сетевой интерфейс hello балансировки нагрузки — может toosend балансировки нагрузки сетевого трафика на основе правил, балансировки нагрузки hello, создаются.

Hello рисунке ниже показано hello подсистемы балансировки нагрузки Azure в этой модели.

![Балансировщик нагрузки Azure в диспетчере ресурсов](./media/load-balancer-overview/arm-lb.png)

Рис. 2. Azure Load Balancer в диспетчере Resource Manager

Hello балансировки нагрузки можно управлять через диспетчер ресурсов на основе шаблонов, API-интерфейсы и средства. toolearn более о диспетчере ресурсов, в разделе hello [Обзор диспетчера ресурсов](../azure-resource-manager/resource-group-overview.md).

## <a name="load-balancer-features"></a>Функции подсистемы балансировки нагрузки

* Распространение на основе хэша

    Балансировщик нагрузки Azure использует алгоритм распределения на основе хэша. По умолчанию использует хэш 5-фрагментному, состоящие из исходный IP-адрес, порт источника, конечный IP-адрес, конечный порт и протокол тип toomap трафика tooavailable серверов. Он позволяет закреплять IP-адреса только *в рамках* сеанса транспорта. Пакетов в hello сеанс TCP или UDP будут направляться toohello же экземпляра за конечной точкой с балансировкой нагрузки hello. Когда hello клиента закрытия и открытия соединения hello или начинает новый сеанс из hello же исходный IP-адрес, hello изменений исходного порта. Это может привести к hello трафика toogo tooa другой конечной точке в другом центре обработки данных.

    Дополнительные сведения см. в статье [Режим распределения для балансировщика нагрузки (сходство исходного IP-адреса)](load-balancer-distribution-mode.md). Hello следующий рисунок показывает hello хэша распространения:

    ![Распространение на основе хэша](./media/load-balancer-overview/load-balancer-distribution.png)

    Рис. 3. Распределение на основе хэша

* Перенаправление портов

    Балансировщик нагрузки Azure позволяет контролировать процесс управления входящей связью. Это взаимодействие включает в себя трафик с узлов Интернета, виртуальных машин в других облачных службах или из виртуальных сетей. Этот контроль представлен конечной точкой (также известной как входная конечная точка).

    Конечная точка ввода прослушивает открытый порт и перенаправляет трафик tooan внутренний порт. Можно сопоставить hello же порты для внутренней или внешней конечной точки или использовать другой порт для них. Например может быть tooport toolisten сервер, настроенный web 81, а сопоставление hello общедоступная конечная точка является порт 80. Создание общедоступной конечной точки Hello триггеры hello создание экземпляра подсистемы балансировки нагрузки.

    Если создана с помощью hello портал Azure, hello портал автоматически создает конечные точки toohello виртуальную машину для hello удаленного рабочего стола (RDP) и трафика удаленного сеанса Windows PowerShell. Можно использовать эти конечные точки tooremotely администрирования hello виртуальной машины через Интернет hello.

* Автоматическая перенастройка

    Балансировщик нагрузки Azure мгновенно перенастраивает сам себя при горизонтальном и вертикальном масштабировании экземпляров. Например перенастройки происходит при увеличении hello число экземпляров для рабочих и веб-ролей в облачной службе или при добавлении дополнительных виртуальных машин в hello же балансировкой нагрузки задать.

* Мониторинг службы

    Подсистема балансировки нагрузки Azure могли проверять работоспособность hello hello различных экземпляров сервера. При toorespond происходит сбой проверки, hello балансировки нагрузки останавливает отправку новых подключений toohello неисправных экземпляров. Существующие подключения не затрагиваются.

    Существует три типа проверки:

    + **Зонд гостевого агента (для платформы как службы виртуальные машины только):** hello балансировки нагрузки использует hello агент гостевой виртуальной машине hello. Hello гостевой агент прослушивает и отвечает только тогда, когда hello ответ HTTP 200 OK экземпляр находится в состоянии готовности hello (т. е. hello экземпляр не находится в состоянии, как заняты, повторный запуск или остановка). При сбое агента hello toorespond с HTTP 200 OK метки подсистемы балансировки нагрузки hello hello экземпляра не отвечает и отправке трафика toothat экземпляр останавливается. Подсистема балансировки нагрузки Hello продолжается tooping hello экземпляра. Если hello агент даст ответ HTTP 200, hello балансировки нагрузки будет отправлять трафик toothat экземпляра еще раз. При использовании веб-роли код веб-сайта обычно выполняется в w3wp.exe, который не отслеживается hello фабрики Azure или гостевого агента. Это означает, что ошибки в w3wp.exe (например, ответы HTTP 500) не будет обнаруженную toohello гостевого агента, а hello балансировки нагрузки не будет tootake этот экземпляр из ротации.
    + **Пользовательский зонд HTTP:** зондирования переопределяет пробы (гостевого агента) по умолчанию hello. Его можно использовать toocreate собственную пользовательскую логику toodetermine hello работоспособности экземпляра роли hello. Hello балансировки нагрузки будет регулярно выполнять тестирование конечной точки (каждые 15 секунд, по умолчанию). экземпляр Hello считается toobe в поворота, если он отвечает TCP ACK или HTTP 200 в течение периода ожидания hello (31 секунды по умолчанию). Это полезно для реализации собственных экземпляров tooremove логики из ротации подсистемы балансировки нагрузки hello. Например можно настроить экземпляр hello tooreturn состояние отличный от 200, если экземпляр hello превышает 90% загрузки ЦП. Для веб-ролей, использующих w3wp.exe, можно также получить автоматический мониторинг веб-сайта, так как ошибки в коде веб-сайт возвращать зонда toohello состояние отличный от 200.
    + **Пользовательский зонд TCP:** эта проверка зависит от успешного TCP-порт пробы tooa определенные сеанса установление.

    Дополнительные сведения см. в разделе hello [схема LoadBalancerProbe](https://msdn.microsoft.com/library/azure/jj151530.aspx).

* Исходящее преобразование сетевых адресов (SNAT)

    Все toohello исходящий трафик, проходит Интернет, полученному от вашей службы источника NAT (SNAT) с помощью hello же виртуальный IP-адрес как hello входящего трафика. SNAT предоставляет такие важные преимущества:

    + Он позволяет легко обновления и восстановления после сбоев служб, так как hello виртуального IP-адреса могут быть динамически сопоставлены tooanother экземпляр службы hello.
    + Это упрощает управление списком управления доступом (ACL). С точки зрения виртуальных IP-адресов списки управления доступом не меняются при масштабировании или повторном развертывании служб.

    конфигурация подсистемы балансировки нагрузки Hello поддерживает полный цилиндр NAT для протокола UDP. Полный цилиндр NAT — это тип NAT, где порт hello позволяет входящих подключений от любого внешнего узла (в ответ tooan исходящего запроса).

    Для каждого нового исходящего подключения инициирующего виртуальной машины исходящий порт также выделяется подсистемой балансировки нагрузки hello. внешний узел Hello видит трафика с помощью виртуального порта на выделенный IP-адресов VIP. Для сценариев, требующих большое число исходящих подключений, рекомендуется toouse [общедоступный IP-адрес на уровне экземпляра](../virtual-network/virtual-networks-instance-level-public-ip.md) адресов таким образом, что виртуальные машины hello выделенный исходящий IP-адрес для SNAT. Это снижает риск hello нехватку портов.

    Дополнительные сведения по этой теме см. в разделе [Общие сведения об исходящих подключениях в Azure](load-balancer-outbound-connections.md).

### <a name="support-for-multiple-load-balanced-ip-addresses-for-virtual-machines"></a>Поддержка нескольких IP-адресов с балансировкой нагрузки для виртуальных машин
Можно назначить несколько балансировкой нагрузки открытый набор IP-адресов tooa виртуальных машин. Эта возможность позволяет размещать несколько веб-сайтов SSL и/или несколько прослушивателей группы доступности AlwaysOn SQL Server на hello же набор виртуальных машин. Дополнительные сведения см. в статье [Несколько виртуальных IP-адресов для облачной службы](load-balancer-multivip.md).

[!INCLUDE [load-balancer-compare-tm-ag-lb-include.md](../../includes/load-balancer-compare-tm-ag-lb-include.md)]

## <a name="limitations"></a>Ограничения

Внутренние пулы Load Balancer могут содержать виртуальные машины с любым номером SKU, за исключением уровня "Базовый".

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о [подсистеме балансировки нагрузки, подключенной к Интернету](load-balancer-internet-overview.md)

- Дополнительные сведения о [внутренней подсистеме балансировки нагрузки](load-balancer-internal-overview.md)

- Создание [подсистемы балансировки нагрузки, подключенной к Интернету](load-balancer-get-started-internet-portal.md)

- Дополнительные сведения о некоторых hello другой ключ [сетевые возможности](../networking/networking-overview.md) из Azure

