---
title: "Обзор Azure Load Balancer | Документация Майкрософт"
description: "Обзор функций балансировщика нагрузки Azure, его архитектуры и реализации. Узнайте, как работает балансировщик нагрузки, и применяйте его в облаке."
services: load-balancer
documentationcenter: na
author: kumudd
manager: timlt
editor: 
ms.assetid: 0f313dc0-f007-4cee-b2b9-f542357925a3
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/24/2016
ms.author: kumud
ms.openlocfilehash: 617da1cf41db08d319d6fe9fa7bc96b794a0001e
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="azure-load-balancer-overview"></a><span data-ttu-id="adc43-104">Обзор балансировщика нагрузки Azure</span><span class="sxs-lookup"><span data-stu-id="adc43-104">Azure Load Balancer overview</span></span>

<span data-ttu-id="adc43-105">Балансировщик нагрузки Azure обеспечивает высокую доступность и производительность сети для приложений.</span><span class="sxs-lookup"><span data-stu-id="adc43-105">Azure Load Balancer delivers high availability and network performance to your applications.</span></span> <span data-ttu-id="adc43-106">Это балансировщик нагрузки уровня 4 (TCP, UDP), распределяющий входящий трафик между работоспособными экземплярами служб, определенных в наборе балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="adc43-106">It is a Layer 4 (TCP, UDP) load balancer that distributes incoming traffic among healthy instances of services defined in a load-balanced set.</span></span>

<span data-ttu-id="adc43-107">Вот какие функции можно настроить в службе Azure Load Balancer:</span><span class="sxs-lookup"><span data-stu-id="adc43-107">Azure Load Balancer can be configured to:</span></span>

* <span data-ttu-id="adc43-108">балансировка нагрузки входящего интернет-трафика виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="adc43-108">Load balance incoming Internet traffic to virtual machines.</span></span> <span data-ttu-id="adc43-109">Такая конфигурация называется [балансировкой нагрузки для Интернета](load-balancer-internet-overview.md).</span><span class="sxs-lookup"><span data-stu-id="adc43-109">This configuration is known as [Internet-facing load balancing](load-balancer-internet-overview.md).</span></span>
* <span data-ttu-id="adc43-110">Балансировка нагрузки трафика между виртуальными машинами в виртуальной сети, между виртуальными машинами в облачных службах или между локальными компьютерами и виртуальными машинами в распределенной виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="adc43-110">Load balance traffic between virtual machines in a virtual network, between virtual machines in cloud services, or between on-premises computers and virtual machines in a cross-premises virtual network.</span></span> <span data-ttu-id="adc43-111">Такая конфигурация называется [внутренней балансировкой нагрузки](load-balancer-internal-overview.md).</span><span class="sxs-lookup"><span data-stu-id="adc43-111">This configuration is known as [internal load balancing](load-balancer-internal-overview.md).</span></span>
* <span data-ttu-id="adc43-112">Перенаправление внешнего трафика к определенному экземпляру виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="adc43-112">Forward external traffic to a specific virtual machine.</span></span>

<span data-ttu-id="adc43-113">Чтобы все ресурсы облака были доступны через Интернет, им необходимы общедоступные IP-адреса.</span><span class="sxs-lookup"><span data-stu-id="adc43-113">All resources in the cloud need a public IP address to be reachable from the Internet.</span></span> <span data-ttu-id="adc43-114">В облачной инфраструктуре Azure в ресурсах используются немаршрутизируемые IP-адреса.</span><span class="sxs-lookup"><span data-stu-id="adc43-114">The cloud infrastructure in Azure uses non-routable IP addresses for its resources.</span></span> <span data-ttu-id="adc43-115">Azure использует преобразование сетевых адресов (NAT) с общедоступными IP-адресами для обмена данными с Интернетом.</span><span class="sxs-lookup"><span data-stu-id="adc43-115">Azure uses network address translation (NAT) with public IP addresses to communicate to the Internet.</span></span>

## <a name="azure-deployment-models"></a><span data-ttu-id="adc43-116">Модели развертывания Azure</span><span class="sxs-lookup"><span data-stu-id="adc43-116">Azure deployment models</span></span>

<span data-ttu-id="adc43-117">Важно понимать различия между классической [моделью развертывания](../azure-resource-manager/resource-manager-deployment-model.md)Azure и моделью развертывания с помощью Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="adc43-117">It's important to understand the differences between the Azure classic and Resource Manager [deployment models](../azure-resource-manager/resource-manager-deployment-model.md).</span></span> <span data-ttu-id="adc43-118">В каждой модели Azure Load Balancer настраивается по-разному.</span><span class="sxs-lookup"><span data-stu-id="adc43-118">Azure Load Balancer is configured differently in each model.</span></span>

### <a name="azure-classic-deployment-model"></a><span data-ttu-id="adc43-119">классическая модель развертывания Azure</span><span class="sxs-lookup"><span data-stu-id="adc43-119">Azure classic deployment model</span></span>

<span data-ttu-id="adc43-120">Виртуальные машины, развернутые в пределах границ облачной службы, можно сгруппировать для использования балансировщика нагрузки.</span><span class="sxs-lookup"><span data-stu-id="adc43-120">Virtual machines deployed within a cloud service boundary can be grouped to use a load balancer.</span></span> <span data-ttu-id="adc43-121">В этой модели облачной службе назначаются общедоступный IP-адрес и полное доменное имя.</span><span class="sxs-lookup"><span data-stu-id="adc43-121">In this model a public IP address and a Fully Qualified Domain Name, (FQDN) are assigned to a cloud service.</span></span> <span data-ttu-id="adc43-122">Подсистема балансировки нагрузки преобразует порты и балансирует нагрузку сетевого трафика, используя общедоступный IP-адрес для облачной службы.</span><span class="sxs-lookup"><span data-stu-id="adc43-122">The load balancer does port translation and load balances the network traffic by using the public IP address for the cloud service.</span></span>

<span data-ttu-id="adc43-123">Трафик с балансировкой нагрузки определяется конечными точками.</span><span class="sxs-lookup"><span data-stu-id="adc43-123">Load-balanced traffic is defined by endpoints.</span></span> <span data-ttu-id="adc43-124">Конечные точки преобразования портов связывают (связь "один к одному") общедоступный порт общедоступного IP-адреса и локальный порт, назначенный службе на определенной виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="adc43-124">Port translation endpoints have a one-to-one relationship between the public-assigned port of the public IP address and the local port assigned to the service on a specific virtual machine.</span></span> <span data-ttu-id="adc43-125">Конечные точки балансировки нагрузки связывают (связь "один ко многим") общедоступный IP-адрес и локальные порты, назначенные службам на виртуальных машинах в облачной службе.</span><span class="sxs-lookup"><span data-stu-id="adc43-125">Load balancing endpoints have a one-to-many relationship between the public IP address and the local ports assigned to the services on the virtual machines in the cloud service.</span></span>

![Балансировщик нагрузки Azure в классической модели развертывания](./media/load-balancer-overview/asm-lb.png)

<span data-ttu-id="adc43-127">Рис. 1. Azure Load Balancer в классической модели развертывания</span><span class="sxs-lookup"><span data-stu-id="adc43-127">Figure 1 - Azure Load Balancer in the classic deployment model</span></span>

<span data-ttu-id="adc43-128">Меткой домена для общедоступного IP-адреса, который подсистема балансировки нагрузки будет использовать в этой модели развертывания, будет \<имя_облачной_службы\>.cloudapp.net.</span><span class="sxs-lookup"><span data-stu-id="adc43-128">The domain label for the public IP address that the load balancer uses for this deployment model is \<cloud service name\>.cloudapp.net.</span></span> <span data-ttu-id="adc43-129">На представленной ниже схеме показан Azure Load Balancer в этой модели.</span><span class="sxs-lookup"><span data-stu-id="adc43-129">The following graphic shows the Azure Load Balancer in this model.</span></span>

### <a name="azure-resource-manager-deployment-model"></a><span data-ttu-id="adc43-130">Модель развертывания диспетчера ресурсов Azure</span><span class="sxs-lookup"><span data-stu-id="adc43-130">Azure Resource Manager deployment model</span></span>

<span data-ttu-id="adc43-131">В модели развертывания с помощью Resource Manager нет необходимости создавать облачную службу.</span><span class="sxs-lookup"><span data-stu-id="adc43-131">In the Resource Manager deployment model there is no need to create a Cloud service.</span></span> <span data-ttu-id="adc43-132">Можно явно создать подсистему балансировки нагрузки для маршрутизации трафика между несколькими виртуальными машинами.</span><span class="sxs-lookup"><span data-stu-id="adc43-132">The load balancer is created to explicitly route traffic among multiple virtual machines.</span></span>

<span data-ttu-id="adc43-133">Общедоступный IP-адрес является отдельным ресурсом с меткой домена (DNS-именем).</span><span class="sxs-lookup"><span data-stu-id="adc43-133">A public IP address is an individual resource that has a domain label (DNS name).</span></span> <span data-ttu-id="adc43-134">Общедоступный IP-адрес связывается с ресурсом подсистемы балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="adc43-134">The public IP address is associated with the load balancer resource.</span></span> <span data-ttu-id="adc43-135">Правила балансировщика нагрузки и правила для входящих подключений NAT используют общедоступный IP-адрес в качестве конечной точки Интернета для ресурсов, получающих сетевой трафик с балансировкой нагрузки.</span><span class="sxs-lookup"><span data-stu-id="adc43-135">Load balancer rules and inbound NAT rules use the public IP address as the Internet endpoint for the resources that are receiving load-balanced network traffic.</span></span>

<span data-ttu-id="adc43-136">Частный или общедоступный IP-адрес назначается ресурсу сетевого интерфейса, подключаемому к виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="adc43-136">A private or public IP address is assigned to the network interface resource attached to a virtual machine.</span></span> <span data-ttu-id="adc43-137">После добавления сетевого интерфейса в пул внутренних IP-адресов балансировщика нагрузки балансировщик нагрузки начинает отправлять сетевой трафик с балансировкой нагрузки на основе созданных правил балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="adc43-137">Once a network interface is added to a load balancer's back-end IP address pool, the load balancer is able to send load-balanced network traffic based on the load-balanced rules that are created.</span></span>

<span data-ttu-id="adc43-138">На представленной ниже схеме показан Azure Load Balancer в этой модели.</span><span class="sxs-lookup"><span data-stu-id="adc43-138">The following graphic shows the Azure Load Balancer in this model:</span></span>

![Балансировщик нагрузки Azure в диспетчере ресурсов](./media/load-balancer-overview/arm-lb.png)

<span data-ttu-id="adc43-140">Рис. 2. Azure Load Balancer в диспетчере Resource Manager</span><span class="sxs-lookup"><span data-stu-id="adc43-140">Figure 2 - Azure Load Balancer in Resource Manager</span></span>

<span data-ttu-id="adc43-141">Подсистемой балансировки нагрузки можно управлять с помощью интерфейсов API, шаблонов и инструментов на основе Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="adc43-141">The load balancer can be managed through Resource Manager-based templates, APIs, and tools.</span></span> <span data-ttu-id="adc43-142">Дополнительные сведения о Resource Manager см. в статье [Общие сведения о диспетчере ресурсов Azure](../azure-resource-manager/resource-group-overview.md).</span><span class="sxs-lookup"><span data-stu-id="adc43-142">To learn more about Resource Manager, see the [Resource Manager overview](../azure-resource-manager/resource-group-overview.md).</span></span>

## <a name="load-balancer-features"></a><span data-ttu-id="adc43-143">Функции подсистемы балансировки нагрузки</span><span class="sxs-lookup"><span data-stu-id="adc43-143">Load Balancer features</span></span>

* <span data-ttu-id="adc43-144">Распространение на основе хэша</span><span class="sxs-lookup"><span data-stu-id="adc43-144">Hash-based distribution</span></span>

    <span data-ttu-id="adc43-145">Балансировщик нагрузки Azure использует алгоритм распределения на основе хэша.</span><span class="sxs-lookup"><span data-stu-id="adc43-145">Azure Load Balancer uses a hash-based distribution algorithm.</span></span> <span data-ttu-id="adc43-146">По умолчанию для сопоставления трафика с доступными серверами используется хэш с пятью кортежами (исходный IP-адрес, порт источника, IP-адрес назначения, порт назначения и тип протокола).</span><span class="sxs-lookup"><span data-stu-id="adc43-146">By default, it uses a 5-tuple hash composed of source IP, source port, destination IP, destination port, and protocol type to map traffic to available servers.</span></span> <span data-ttu-id="adc43-147">Он позволяет закреплять IP-адреса только *в рамках* сеанса транспорта.</span><span class="sxs-lookup"><span data-stu-id="adc43-147">It provides stickiness only *within* a transport session.</span></span> <span data-ttu-id="adc43-148">Пакеты в одном сеансе TCP или UDP будут направляться на один экземпляр в конечной точке с балансировкой нагрузки.</span><span class="sxs-lookup"><span data-stu-id="adc43-148">Packets in the same TCP or UDP session will be directed to the same instance behind the load-balanced endpoint.</span></span> <span data-ttu-id="adc43-149">Когда клиент закрывает и снова открывает подключение или начинает новый сеанс с того же исходного IP-адреса, порт источника изменяется.</span><span class="sxs-lookup"><span data-stu-id="adc43-149">When the client closes and reopens the connection or starts a new session from the same source IP, the source port changes.</span></span> <span data-ttu-id="adc43-150">Это может привести к перенаправлению трафика к другой конечной точке, расположенной в другом центре обработки данных.</span><span class="sxs-lookup"><span data-stu-id="adc43-150">This may cause the traffic to go to a different endpoint in a different datacenter.</span></span>

    <span data-ttu-id="adc43-151">Дополнительные сведения см. в статье [Режим распределения для балансировщика нагрузки (сходство исходного IP-адреса)](load-balancer-distribution-mode.md).</span><span class="sxs-lookup"><span data-stu-id="adc43-151">For more details, see [Load balancer distribution mode](load-balancer-distribution-mode.md).</span></span> <span data-ttu-id="adc43-152">На представленной ниже схеме показано распределение на основе хэша.</span><span class="sxs-lookup"><span data-stu-id="adc43-152">The following graphic shows the hash-based distribution:</span></span>

    ![Распространение на основе хэша](./media/load-balancer-overview/load-balancer-distribution.png)

    <span data-ttu-id="adc43-154">Рис. 3. Распределение на основе хэша</span><span class="sxs-lookup"><span data-stu-id="adc43-154">Figure 3 - Hash based distribution</span></span>

* <span data-ttu-id="adc43-155">Перенаправление портов</span><span class="sxs-lookup"><span data-stu-id="adc43-155">Port forwarding</span></span>

    <span data-ttu-id="adc43-156">Балансировщик нагрузки Azure позволяет контролировать процесс управления входящей связью.</span><span class="sxs-lookup"><span data-stu-id="adc43-156">Azure Load Balancer gives you control over how inbound communication is managed.</span></span> <span data-ttu-id="adc43-157">Это взаимодействие включает в себя трафик с узлов Интернета, виртуальных машин в других облачных службах или из виртуальных сетей.</span><span class="sxs-lookup"><span data-stu-id="adc43-157">This communication includes traffic initiated from Internet hosts, virtual machines in other cloud services, or virtual networks.</span></span> <span data-ttu-id="adc43-158">Этот контроль представлен конечной точкой (также известной как входная конечная точка).</span><span class="sxs-lookup"><span data-stu-id="adc43-158">This control is represented by an endpoint (also called an input endpoint).</span></span>

    <span data-ttu-id="adc43-159">Входная конечная точка прослушивает общедоступный порт и перенаправляет трафик на внутренний порт.</span><span class="sxs-lookup"><span data-stu-id="adc43-159">An input endpoint listens on a public port and forwards traffic to an internal port.</span></span> <span data-ttu-id="adc43-160">Вы можете сопоставлять одни и те же порты для внутренних или внешних конечных точек или использовать для них другой порт.</span><span class="sxs-lookup"><span data-stu-id="adc43-160">You can map the same ports for an internal or external endpoint or use a different port for them.</span></span> <span data-ttu-id="adc43-161">Например, можно настроить веб-сервер так, чтобы он прослушивал порт 81, а порт 80 использовался для сопоставления общедоступных конечных точек.</span><span class="sxs-lookup"><span data-stu-id="adc43-161">For example, you can have a web server configured to listen to port 81 while the public endpoint mapping is port 80.</span></span> <span data-ttu-id="adc43-162">При создании общедоступной конечной точки создается экземпляр балансировщика нагрузки.</span><span class="sxs-lookup"><span data-stu-id="adc43-162">The creation of a public endpoint triggers the creation of a load balancer instance.</span></span>

    <span data-ttu-id="adc43-163">Если для создания используется портал Azure, то он автоматически создает конечные точки для виртуальной машины для протокола удаленного рабочего стола (RDP) и трафика удаленного сеанса Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="adc43-163">When created using the Azure portal, the portal automatically creates endpoints to the virtual machine for the Remote Desktop Protocol (RDP) and remote Windows PowerShell session traffic.</span></span> <span data-ttu-id="adc43-164">Эти конечные точки позволяют удаленно управлять виртуальной машиной через Интернет.</span><span class="sxs-lookup"><span data-stu-id="adc43-164">You can use these endpoints to remotely administer the virtual machine over the Internet.</span></span>

* <span data-ttu-id="adc43-165">Автоматическая перенастройка</span><span class="sxs-lookup"><span data-stu-id="adc43-165">Automatic reconfiguration</span></span>

    <span data-ttu-id="adc43-166">Балансировщик нагрузки Azure мгновенно перенастраивает сам себя при горизонтальном и вертикальном масштабировании экземпляров.</span><span class="sxs-lookup"><span data-stu-id="adc43-166">Azure Load Balancer instantly reconfigures itself when you scale instances up or down.</span></span> <span data-ttu-id="adc43-167">Например, такая перенастройка может произойти при увеличении количества экземпляров для веб-роли и рабочей роли в облачной службе или при добавлении дополнительных виртуальных машин в тот же набор балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="adc43-167">For example, this reconfiguration happens when you increase the instance count for web/worker roles in a cloud service or when you add additional virtual machines into the same load-balanced set.</span></span>

* <span data-ttu-id="adc43-168">Мониторинг службы</span><span class="sxs-lookup"><span data-stu-id="adc43-168">Service monitoring</span></span>

    <span data-ttu-id="adc43-169">Azure Load Balancer может проверять работоспособность различных экземпляров сервера.</span><span class="sxs-lookup"><span data-stu-id="adc43-169">Azure Load Balancer can probe the health of the various server instances.</span></span> <span data-ttu-id="adc43-170">Если проверка не отвечает, балансировщик нагрузки Azure прекращает отправлять новое подключение неработоспособным экземплярам.</span><span class="sxs-lookup"><span data-stu-id="adc43-170">When a probe fails to respond, the load balancer stops sending new connections to the unhealthy instances.</span></span> <span data-ttu-id="adc43-171">Существующие подключения не затрагиваются.</span><span class="sxs-lookup"><span data-stu-id="adc43-171">Existing connections are not impacted.</span></span>

    <span data-ttu-id="adc43-172">Существует три типа проверки:</span><span class="sxs-lookup"><span data-stu-id="adc43-172">Three types of probes are supported:</span></span>

    + <span data-ttu-id="adc43-173">**Проверка гостевого агента (только на виртуальных машинах PaaS).** Подсистема балансировки нагрузки использует гостевой агент внутри виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="adc43-173">**Guest agent probe (on Platform as a Service Virtual Machines only):** The load balancer utilizes the guest agent inside the virtual machine.</span></span> <span data-ttu-id="adc43-174">Гостевой агент выполняет прослушивание и возвращает ответ "HTTP 200 (OK)" только в том случае, если экземпляр находится в состоянии готовности (т. е. экземпляр не в состоянии "Занят", "Перезапуск" или "Остановка").</span><span class="sxs-lookup"><span data-stu-id="adc43-174">The guest agent listens and responds with an HTTP 200 OK response only when the instance is in the ready state (i.e. the instance is not in a state like busy, recycling, or stopping).</span></span> <span data-ttu-id="adc43-175">Если агент не отправляет ответ "HTTP 200 (OK)", то балансировщик нагрузки отмечает экземпляр как неработоспособный и перестает отправлять ему трафик.</span><span class="sxs-lookup"><span data-stu-id="adc43-175">If the agent fails to respond with an HTTP 200 OK, the load balancer marks the instance as unresponsive and stops sending traffic to that instance.</span></span> <span data-ttu-id="adc43-176">Балансировщик нагрузки продолжит проверять связь с этим экземпляром.</span><span class="sxs-lookup"><span data-stu-id="adc43-176">The load balancer continues to ping the instance.</span></span> <span data-ttu-id="adc43-177">Если гостевой агент дает ответ HTTP 200, балансировщик нагрузки снова направит трафик к этому экземпляру.</span><span class="sxs-lookup"><span data-stu-id="adc43-177">If the guest agent responds with an HTTP 200, the load balancer will send traffic to that instance again.</span></span> <span data-ttu-id="adc43-178">При использовании веб-роли код веб-сайта обычно выполняется в процессе w3wp.exe, который не отслеживается структурой Azure или гостевым агентом.</span><span class="sxs-lookup"><span data-stu-id="adc43-178">When you're using a web role, your website code typically runs in w3wp.exe, which is not monitored by the Azure fabric or guest agent.</span></span> <span data-ttu-id="adc43-179">Это означает, что ошибки в процессе w3wp.exe (например, ответы HTTP 500) не будут передаваться на гостевой агент и балансировщик нагрузки не будет знать, что экземпляр перестает использоваться.</span><span class="sxs-lookup"><span data-stu-id="adc43-179">This means that failures in w3wp.exe (e.g. HTTP 500 responses) will not be reported to the guest agent, and the load balancer will not know to take that instance out of rotation.</span></span>
    + <span data-ttu-id="adc43-180">**Пользовательская проверка HTTP.** Эта проверка переопределяет проверку (гостевого агента) по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="adc43-180">**HTTP custom probe:** This probe overrides the default (guest agent) probe.</span></span> <span data-ttu-id="adc43-181">Ее можно использовать для создания собственной настраиваемой логики для определения работоспособности экземпляра роли.</span><span class="sxs-lookup"><span data-stu-id="adc43-181">You can use it to create your own custom logic to determine the health of the role instance.</span></span> <span data-ttu-id="adc43-182">Балансировщик нагрузки будет регулярно проверять конечную точку (по умолчанию, каждые 15 секунд).</span><span class="sxs-lookup"><span data-stu-id="adc43-182">The load balancer will regularly probe your endpoint (every 15 seconds, by default).</span></span> <span data-ttu-id="adc43-183">Экземпляр считается работоспособным и находящимся в ротации, если он возвращает ответ TCP ACK или HTTP 200 за определенное время ожидания (по умолчанию 31 секунда).</span><span class="sxs-lookup"><span data-stu-id="adc43-183">The instance is considered to be in rotation if it responds with a TCP ACK or HTTP 200 within the timeout period (default of 31 seconds).</span></span> <span data-ttu-id="adc43-184">Это удобно для реализации собственной логики удаления экземпляров из ротации балансировщика нагрузки.</span><span class="sxs-lookup"><span data-stu-id="adc43-184">This is useful for implementing your own logic to remove instances from the load balancer's rotation.</span></span> <span data-ttu-id="adc43-185">Например, можно настроить экземпляр для возвращения состояния, отличного от 200, если загрузка ЦП экземпляра превышает 90 %.</span><span class="sxs-lookup"><span data-stu-id="adc43-185">For example, you can configure the instance to return a non-200 status if the instance is above 90% CPU.</span></span> <span data-ttu-id="adc43-186">Для веб-ролей, использующих w3wp.exe, вы также получаете автоматический мониторинг веб-сайта, так как ошибки в коде веб-сайта при проверке вернут состояние, отличное от 200.</span><span class="sxs-lookup"><span data-stu-id="adc43-186">For web roles that use w3wp.exe, you also get automatic monitoring of your website, since failures in your website code return a non-200 status to the probe.</span></span>
    + <span data-ttu-id="adc43-187">**Пользовательская проверка TCP.** Проверка зависит от успешности установки сеанса TCP к определенному порту зонда.</span><span class="sxs-lookup"><span data-stu-id="adc43-187">**TCP custom probe:** This probe relies on successful TCP session establishment to a defined probe port.</span></span>

    <span data-ttu-id="adc43-188">Дополнительные сведения см. в статье [LoadBalancerProbe Schema](https://msdn.microsoft.com/library/azure/jj151530.aspx) (Схема LoadBalancerProbe).</span><span class="sxs-lookup"><span data-stu-id="adc43-188">For more information, see the [LoadBalancerProbe schema](https://msdn.microsoft.com/library/azure/jj151530.aspx).</span></span>

* <span data-ttu-id="adc43-189">Исходящее преобразование сетевых адресов (SNAT)</span><span class="sxs-lookup"><span data-stu-id="adc43-189">Source NAT</span></span>

    <span data-ttu-id="adc43-190">Весь исходящий трафик из вашей службы в Интернет подвергается исходному преобразованию сетевых адресов (SNAT), при этом используется тот же виртуальный IP-адрес, что и для входящего трафика.</span><span class="sxs-lookup"><span data-stu-id="adc43-190">All outbound traffic to the Internet that originates from your service undergoes source NAT (SNAT) by using the same VIP address as the incoming traffic.</span></span> <span data-ttu-id="adc43-191">SNAT предоставляет такие важные преимущества:</span><span class="sxs-lookup"><span data-stu-id="adc43-191">SNAT provides important benefits:</span></span>

    + <span data-ttu-id="adc43-192">упрощение обновления и аварийного восстановления служб, так как виртуальный IP-адрес можно динамически сопоставить с другим экземпляром службы;</span><span class="sxs-lookup"><span data-stu-id="adc43-192">It enables easy upgrade and disaster recovery of services, since the VIP can be dynamically mapped to another instance of the service.</span></span>
    + <span data-ttu-id="adc43-193">Это упрощает управление списком управления доступом (ACL).</span><span class="sxs-lookup"><span data-stu-id="adc43-193">It makes access control list (ACL) management easier.</span></span> <span data-ttu-id="adc43-194">С точки зрения виртуальных IP-адресов списки управления доступом не меняются при масштабировании или повторном развертывании служб.</span><span class="sxs-lookup"><span data-stu-id="adc43-194">ACLs expressed in terms of VIPs do not change as services scale up, down, or get redeployed.</span></span>

    <span data-ttu-id="adc43-195">Конфигурация подсистемы балансировки нагрузки Azure поддерживает полный конусный NAT для протокола UDP.</span><span class="sxs-lookup"><span data-stu-id="adc43-195">The load balancer configuration supports full cone NAT for UDP.</span></span> <span data-ttu-id="adc43-196">Полный конусный NAT — это тип NAT, где порт разрешает входящие подключения от любого внешнего узла (в ответ на исходящий запрос).</span><span class="sxs-lookup"><span data-stu-id="adc43-196">Full cone NAT is a type of NAT where the port allows inbound connections from any external host (in response to an outbound request).</span></span>

    <span data-ttu-id="adc43-197">Для каждого нового исходящего подключения, инициированного виртуальной машиной, подсистема балансировки нагрузки выделяет также исходящий порт.</span><span class="sxs-lookup"><span data-stu-id="adc43-197">For each new outbound connection that a virtual machine initiates, an outbound port is also allocated by the load balancer.</span></span> <span data-ttu-id="adc43-198">Внешний узел видит трафик портов с выделенным виртуальным IP-адресом.</span><span class="sxs-lookup"><span data-stu-id="adc43-198">The external host sees traffic with a virtual IP (VIP)-allocated port.</span></span> <span data-ttu-id="adc43-199">Для сценариев, требующих большое количество исходящих подключений, рекомендуется использовать [общедоступные IP-адреса уровня экземпляра](../virtual-network/virtual-networks-instance-level-public-ip.md) , чтобы у виртуальных машин были выделенные исходящие IP-адреса для SNAT.</span><span class="sxs-lookup"><span data-stu-id="adc43-199">For scenarios that require a large number of outbound connections, it is recommended to use [instance-level public IP](../virtual-network/virtual-networks-instance-level-public-ip.md) addresses so that the VMs have a dedicated outbound IP address for SNAT.</span></span> <span data-ttu-id="adc43-200">Это позволит снизить риск нехватки портов.</span><span class="sxs-lookup"><span data-stu-id="adc43-200">This reduces the risk of port exhaustion.</span></span>

    <span data-ttu-id="adc43-201">Дополнительные сведения по этой теме см. в разделе [Общие сведения об исходящих подключениях в Azure](load-balancer-outbound-connections.md).</span><span class="sxs-lookup"><span data-stu-id="adc43-201">Please see [outbound connections](load-balancer-outbound-connections.md) article for more details on this topic.</span></span>

### <a name="support-for-multiple-load-balanced-ip-addresses-for-virtual-machines"></a><span data-ttu-id="adc43-202">Поддержка нескольких IP-адресов с балансировкой нагрузки для виртуальных машин</span><span class="sxs-lookup"><span data-stu-id="adc43-202">Support for multiple load-balanced IP addresses for virtual machines</span></span>
<span data-ttu-id="adc43-203">Вы можете назначить несколько общедоступных IP-адресов с балансировкой нагрузки набору виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="adc43-203">You can assign more than one load-balanced public IP address to a set of virtual machines.</span></span> <span data-ttu-id="adc43-204">Благодаря этому можно разместить несколько веб-сайтов SSL и/или несколько прослушивателей групп доступности AlwaysОn SQL Server в одном и том же наборе виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="adc43-204">With this ability, you can host multiple SSL websites and/or multiple SQL Server AlwaysOn Availability Group listeners on the same set of virtual machines.</span></span> <span data-ttu-id="adc43-205">Дополнительные сведения см. в статье [Несколько виртуальных IP-адресов для облачной службы](load-balancer-multivip.md).</span><span class="sxs-lookup"><span data-stu-id="adc43-205">For more information, see [Multiple VIPs per cloud service](load-balancer-multivip.md).</span></span>

[!INCLUDE [load-balancer-compare-tm-ag-lb-include.md](../../includes/load-balancer-compare-tm-ag-lb-include.md)]

## <a name="limitations"></a><span data-ttu-id="adc43-206">Ограничения</span><span class="sxs-lookup"><span data-stu-id="adc43-206">Limitations</span></span>

<span data-ttu-id="adc43-207">Внутренние пулы Load Balancer могут содержать виртуальные машины с любым номером SKU, за исключением уровня "Базовый".</span><span class="sxs-lookup"><span data-stu-id="adc43-207">Load Balancer backend pools can contain any VM SKU except Basic tier.</span></span>

## <a name="next-steps"></a><span data-ttu-id="adc43-208">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="adc43-208">Next steps</span></span>

- <span data-ttu-id="adc43-209">Дополнительные сведения о [подсистеме балансировки нагрузки, подключенной к Интернету](load-balancer-internet-overview.md)</span><span class="sxs-lookup"><span data-stu-id="adc43-209">Learn more about [Internet-facing load balancer](load-balancer-internet-overview.md)</span></span>

- <span data-ttu-id="adc43-210">Дополнительные сведения о [внутренней подсистеме балансировки нагрузки](load-balancer-internal-overview.md)</span><span class="sxs-lookup"><span data-stu-id="adc43-210">Learn more about [Internal load balancer overview](load-balancer-internal-overview.md)</span></span>

- <span data-ttu-id="adc43-211">Создание [подсистемы балансировки нагрузки, подключенной к Интернету](load-balancer-get-started-internet-portal.md)</span><span class="sxs-lookup"><span data-stu-id="adc43-211">Create an [Internet-facing load balancer](load-balancer-get-started-internet-portal.md)</span></span>

- <span data-ttu-id="adc43-212">Дополнительные сведения о некоторых других ключевых [сетевых возможностях](../networking/networking-overview.md) Azure</span><span class="sxs-lookup"><span data-stu-id="adc43-212">Learn about some of the other key [networking capabilities](../networking/networking-overview.md) of Azure</span></span>

