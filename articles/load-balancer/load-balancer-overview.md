---
title: "Обзор Azure Load Balancer | Документация Майкрософт"
description: "Обзор функций балансировщика нагрузки Azure, его архитектуры и реализации. Узнайте, как работает балансировщик нагрузки, и применяйте его в облаке."
services: load-balancer
documentationcenter: na
author: kumudd
manager: timlt
editor: 
ms.assetid: 0f313dc0-f007-4cee-b2b9-f542357925a3
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/25/2017
ms.author: kumud
ms.openlocfilehash: ecf1fc38d2b9fd54fe5b00db616224a0848179fe
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="azure-load-balancer-overview"></a>Обзор балансировщика нагрузки Azure

Балансировщик нагрузки Azure обеспечивает высокую доступность и производительность сети для приложений. Это балансировщик нагрузки уровня 4 (TCP, UDP), распределяющий входящий трафик между работоспособными экземплярами служб, определенных в наборе балансировки нагрузки.

[!INCLUDE [load-balancer-basic-sku-include.md](../../includes/load-balancer-basic-sku-include.md)]

Вот какие функции можно настроить в службе Azure Load Balancer:

* балансировка нагрузки входящего интернет-трафика виртуальных машин. Такая конфигурация называется [балансировкой нагрузки для Интернета](load-balancer-internet-overview.md).
* Балансировка нагрузки трафика между виртуальными машинами в виртуальной сети, между виртуальными машинами в облачных службах или между локальными компьютерами и виртуальными машинами в распределенной виртуальной сети. Такая конфигурация называется [внутренней балансировкой нагрузки](load-balancer-internal-overview.md).
* Перенаправление внешнего трафика к определенному экземпляру виртуальной машины.

Чтобы все ресурсы облака были доступны через Интернет, им необходимы общедоступные IP-адреса. В облачной инфраструктуре Azure в ресурсах используются немаршрутизируемые IP-адреса. Azure использует преобразование сетевых адресов (NAT) с общедоступными IP-адресами для обмена данными с Интернетом.

## <a name="load-balancer-features"></a>Функции подсистемы балансировки нагрузки

* Распространение на основе хэша

    Балансировщик нагрузки Azure использует алгоритм распределения на основе хэша. По умолчанию для сопоставления трафика с доступными серверами используется хэш с пятью кортежами (исходный IP-адрес, порт источника, IP-адрес назначения, порт назначения и тип протокола). Он позволяет закреплять IP-адреса только *в рамках* сеанса транспорта. Пакеты в одном сеансе TCP или UDP будут направляться на один экземпляр в конечной точке с балансировкой нагрузки. Когда клиент закрывает и снова открывает подключение или начинает новый сеанс с того же исходного IP-адреса, порт источника изменяется. Это может привести к перенаправлению трафика к другой конечной точке, расположенной в другом центре обработки данных.

    Дополнительные сведения см. в статье [Режим распределения для балансировщика нагрузки (сходство исходного IP-адреса)](load-balancer-distribution-mode.md). На представленной ниже схеме показано распределение на основе хэша.

    ![Распространение на основе хэша](./media/load-balancer-overview/load-balancer-distribution.png)

    Рис. Распределение на основе хэша

* Перенаправление портов

    Балансировщик нагрузки Azure позволяет контролировать процесс управления входящей связью. Это взаимодействие включает в себя трафик с узлов Интернета, виртуальных машин в других облачных службах или из виртуальных сетей. Этот контроль представлен конечной точкой (также известной как входная конечная точка).

    Входная конечная точка прослушивает общедоступный порт и перенаправляет трафик на внутренний порт. Вы можете сопоставлять одни и те же порты для внутренних или внешних конечных точек или использовать для них другой порт. Например, можно настроить веб-сервер так, чтобы он прослушивал порт 81, а порт 80 использовался для сопоставления общедоступных конечных точек. При создании общедоступной конечной точки создается экземпляр балансировщика нагрузки.

    Если для создания используется портал Azure, то он автоматически создает конечные точки для виртуальной машины для протокола удаленного рабочего стола (RDP) и трафика удаленного сеанса Windows PowerShell. Эти конечные точки позволяют удаленно управлять виртуальной машиной через Интернет.

* Автоматическая перенастройка

    Балансировщик нагрузки Azure мгновенно перенастраивает сам себя при горизонтальном и вертикальном масштабировании экземпляров. Например, такая перенастройка может произойти при увеличении количества экземпляров для веб-роли и рабочей роли в облачной службе или при добавлении дополнительных виртуальных машин в тот же набор балансировки нагрузки.

* Мониторинг службы

    Azure Load Balancer может проверять работоспособность различных экземпляров сервера. Если проверка не отвечает, балансировщик нагрузки Azure прекращает отправлять новое подключение неработоспособным экземплярам. Существующие подключения не затрагиваются.

    Существует три типа проверки:

    + **Проверка гостевого агента (только на виртуальных машинах PaaS).** Подсистема балансировки нагрузки использует гостевой агент внутри виртуальной машины. Гостевой агент выполняет прослушивание и возвращает ответ "HTTP 200 (OK)" только в том случае, если экземпляр находится в состоянии готовности (т. е. экземпляр не в состоянии "Занят", "Перезапуск" или "Остановка"). Если агент не отправляет ответ "HTTP 200 (OK)", то балансировщик нагрузки отмечает экземпляр как неработоспособный и перестает отправлять ему трафик. Балансировщик нагрузки продолжит проверять связь с этим экземпляром. Если гостевой агент дает ответ HTTP 200, балансировщик нагрузки снова направит трафик к этому экземпляру. При использовании веб-роли код веб-сайта обычно выполняется в процессе w3wp.exe, который не отслеживается структурой Azure или гостевым агентом. Это означает, что ошибки в процессе w3wp.exe (например, ответы HTTP 500) не будут передаваться на гостевой агент и балансировщик нагрузки не будет знать, что экземпляр перестает использоваться.
    + **Пользовательская проверка HTTP.** Эта проверка переопределяет проверку (гостевого агента) по умолчанию. Ее можно использовать для создания собственной настраиваемой логики для определения работоспособности экземпляра роли. Балансировщик нагрузки будет регулярно проверять конечную точку (по умолчанию, каждые 15 секунд). Экземпляр считается работоспособным и находящимся в ротации, если он возвращает ответ TCP ACK или HTTP 200 за определенное время ожидания (по умолчанию 31 секунда). Это удобно для реализации собственной логики удаления экземпляров из ротации балансировщика нагрузки. Например, можно настроить экземпляр для возвращения состояния, отличного от 200, если загрузка ЦП экземпляра превышает 90 %. Для веб-ролей, использующих w3wp.exe, вы также получаете автоматический мониторинг веб-сайта, так как ошибки в коде веб-сайта при проверке вернут состояние, отличное от 200.
    + **Пользовательская проверка TCP.** Проверка зависит от успешности установки сеанса TCP к определенному порту зонда.

    Дополнительные сведения см. в статье [LoadBalancerProbe Schema](https://msdn.microsoft.com/library/azure/jj151530.aspx) (Схема LoadBalancerProbe).

* Исходящее преобразование сетевых адресов (SNAT)

    Весь исходящий трафик из вашей службы в Интернет подвергается исходному преобразованию сетевых адресов (SNAT), при этом используется тот же виртуальный IP-адрес, что и для входящего трафика. SNAT предоставляет такие важные преимущества:

    + упрощение обновления и аварийного восстановления служб, так как виртуальный IP-адрес можно динамически сопоставить с другим экземпляром службы;
    + Это упрощает управление списком управления доступом (ACL). С точки зрения виртуальных IP-адресов списки управления доступом не меняются при масштабировании или повторном развертывании служб.

    Конфигурация подсистемы балансировки нагрузки Azure поддерживает полный конусный NAT для протокола UDP. Полный конусный NAT — это тип NAT, где порт разрешает входящие подключения от любого внешнего узла (в ответ на исходящий запрос).

    Для каждого нового исходящего подключения, инициированного виртуальной машиной, подсистема балансировки нагрузки выделяет также исходящий порт. Внешний узел видит трафик портов с выделенным виртуальным IP-адресом. Для сценариев, требующих большое количество исходящих подключений, рекомендуется использовать [общедоступные IP-адреса уровня экземпляра](../virtual-network/virtual-networks-instance-level-public-ip.md) , чтобы у виртуальных машин были выделенные исходящие IP-адреса для SNAT. Это позволит снизить риск нехватки портов.

    Дополнительные сведения по этой теме см. в разделе [Общие сведения об исходящих подключениях в Azure](load-balancer-outbound-connections.md).

### <a name="support-for-multiple-load-balanced-ip-addresses-for-virtual-machines"></a>Поддержка нескольких IP-адресов с балансировкой нагрузки для виртуальных машин
Вы можете назначить несколько общедоступных IP-адресов с балансировкой нагрузки набору виртуальных машин. Благодаря этому можно разместить несколько веб-сайтов SSL и/или несколько прослушивателей групп доступности AlwaysОn SQL Server в одном и том же наборе виртуальных машин. Дополнительные сведения см. в статье [Несколько виртуальных IP-адресов для облачной службы](load-balancer-multivip.md).

[!INCLUDE [load-balancer-compare-tm-ag-lb-include.md](../../includes/load-balancer-compare-tm-ag-lb-include.md)]

## <a name="limitations"></a>Ограничения

Внутренние пулы Load Balancer могут содержать виртуальные машины с любым номером SKU, за исключением уровня "Базовый".

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о [подсистеме балансировки нагрузки, подключенной к Интернету](load-balancer-internet-overview.md)

- Дополнительные сведения о [внутренней подсистеме балансировки нагрузки](load-balancer-internal-overview.md)

- Создание [подсистемы балансировки нагрузки, подключенной к Интернету](load-balancer-get-started-internet-portal.md)

- Дополнительные сведения о некоторых других ключевых [сетевых возможностях](../networking/networking-overview.md) Azure

