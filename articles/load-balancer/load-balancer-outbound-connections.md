---
title: "aaaUnderstanding исходящих подключений в Azure | Документы Microsoft"
description: "В этой статье объясняется, как Azure позволяет toocommunicate виртуальных машин с общедоступным службам Интернета."
services: load-balancer
documentationcenter: na
author: kumudd
manager: timlt
editor: 
ms.assetid: 5f666f2a-3a63-405a-abcd-b2e34d40e001
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 5/31/2017
ms.author: kumud
ms.openlocfilehash: ffe59971b934a16c9f6f78e3b15869a0072320d5
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="understanding-outbound-connections-in-azure"></a>Общие сведения об исходящих подключениях в Azure

Виртуальные машины в Azure могут взаимодействовать с конечными точками за пределами Azure в пространстве общедоступных IP-адресов. Когда виртуальная машина начнет назначение tooa исходящего потока в общедоступных IP-адресов, Azure сопоставляет hello ВМ закрытый tooa открытый IP-адрес и позволяет hello tooreach возвращаемый трафик виртуальной Машины.

Azure предоставляет три различных метода tooachieve исходящие подключения. Каждый из них имеет свои возможности и ограничения. Внимательно просмотрите каждый метод toochoose, какой из них вашим потребностям.

| Сценарий | Метод | Примечание. |
| --- | --- | --- |
| Автономная виртуальная машина (без подсистемы балансировки нагрузки, без общедоступного IP-адреса уровня экземпляра) |SNAT по умолчанию |Azure сопоставляет общедоступный IP-адрес для SNAT |
| Виртуальная машина с балансировкой нагрузки (без общедоступного IP-адреса уровня экземпляра) |С помощью подсистемы балансировки нагрузки hello SNAT |Azure использует общедоступный IP-адрес hello балансировки нагрузки для SNAT |
| Виртуальная машина с общедоступным IP-адресом уровня экземпляра (с подсистемой балансировки нагрузки или без нее) |SNAT не используется |Azure использует hello общедоступный IP-адрес назначен toohello виртуальной Машины |

Если ВМ toocommunicate с конечными точками за пределами Azure в общедоступных IP-адресов не требуется, можно использовать группы безопасности сети (NSG) tooblock доступ. Использование групп безопасности сети подробно рассматривается в разделе [Запрет подключения к общедоступным сетям](#preventing-public-connectivity).

## <a name="standalone-vm-with-no-instance-level-public-ip-address"></a>Автономная виртуальная машина без общедоступного IP-адреса уровня экземпляра

В этом сценарии hello виртуальной Машины не является частью пула подсистемы балансировки нагрузки Azure и не имеет открытый IP экземпляр уровень (ILPIP), адрес tooit. Создавая исходящего потока, hello виртуальной Машины Azure преобразует hello закрытый исходный IP-адрес hello исходящего потока tooa открытый IP-адрес источника. Hello общедоступный IP-адрес для этого исходящего потока не является настраиваемым и ограничение не подпадают hello подписки открытый IP ресурсов. Azure использует преобразование адресов сети источника (SNAT) tooperform эту функцию. Временные порты hello общедоступный IP-адрес, используется toodistinguish отдельные потоки с hello виртуальной Машины. При создании потоков SNAT динамически выделяет временные порты. В этом контексте hello временных портов, используемых для SNAT используются порты SNAT tooas ссылка.

Порты SNAT представляют собой ограниченный ресурс, который может быть исчерпан. Это важные toounderstand, как они используются. Один порт SNAT потребляется отдельного потока tooa единственный конечный IP-адреса. Для нескольких потоков toohello же IP-адрес назначения, каждый поток принимает один порт SNAT. Это гарантирует выполнение потоков hello уникальный Если исходит от hello же открытый IP адрес toohello же IP-адрес назначения. Несколько потоков, каждый tooa другой конечный IP-адрес использовать один порт SNAT каждого назначения. Hello конечный IP-адрес, чтобы сделать потоки hello уникальным.

Можно использовать [аналитики журналов для подсистемы балансировки нагрузки](load-balancer-monitor-log.md) и [toomonitor предупреждения журналы событий для SNAT порт нехватки системных сообщений](load-balancer-monitor-log.md#alert-event-log). Если ресурс портов SNAT исчерпан, исходящие потоки прекращаются, пока существующие потоки не освободят порты SNAT. В подсистеме балансировки нагрузки используется время ожидания в режиме простоя длительностью 4 минуты для освобождения портов SNAT.

## <a name="load-balanced-vm-with-no-instance-level-public-ip-address"></a>Виртуальная машина с балансировкой нагрузки без общедоступного IP-адреса уровня экземпляра

В этом сценарии hello виртуальная машина является частью пула подсистемы балансировки нагрузки Azure.  Hello виртуальная машина не имеет общий IP-адрес, назначенный tooit. Hello балансировки нагрузки ресурсов должны быть настроены правила toolink hello открытый IP клиентский с hello внутренний пул.  Если не выполнить эту настройку, поведение hello не как описано в разделе hello выше для [автономная виртуальная машина с не экземпляр уровень общедоступный IP-адрес](load-balancer-outbound-connections.md#standalone-vm-with-no-instance-level-public-ip-address).

Когда hello ВМ с балансировкой нагрузки создает исходящего потока, Azure преобразует hello закрытый исходный IP-адрес hello исходящего потока toohello общедоступный IP-адрес hello общедоступный интерфейсный подсистемы балансировки нагрузки. Azure использует преобразование адресов сети источника (SNAT) tooperform эту функцию. Временные порты общедоступный IP-адрес подсистемы балансировки нагрузки hello, используется toodistinguish отдельные потоки с hello виртуальной Машины. При создании исходящих потоков SNAT динамически выделяет временные порты. В этом контексте hello временных портов, используемых для SNAT используются порты SNAT tooas ссылка.

Порты SNAT представляют собой ограниченный ресурс, который может быть исчерпан. Это важные toounderstand, как они используются. Один порт SNAT потребляется отдельного потока tooa единственный конечный IP-адреса. Для нескольких потоков toohello же IP-адрес назначения, каждый поток принимает один порт SNAT. Это гарантирует выполнение потоков hello уникальный Если исходит от hello же открытый IP адрес toohello же IP-адрес назначения. Несколько потоков, каждый tooa другой конечный IP-адрес использовать один порт SNAT каждого назначения. Hello конечный IP-адрес, чтобы сделать потоки hello уникальным.

Можно использовать [аналитики журналов для подсистемы балансировки нагрузки](load-balancer-monitor-log.md) и [toomonitor предупреждения журналы событий для SNAT порт нехватки системных сообщений](load-balancer-monitor-log.md#alert-event-log). Если ресурс портов SNAT исчерпан, исходящие потоки прекращаются, пока существующие потоки не освободят порты SNAT. В подсистеме балансировки нагрузки используется время ожидания в режиме простоя длительностью 4 минуты для освобождения портов SNAT.

## <a name="vm-with-an-instance-level-public-ip-address-with-or-without-load-balancer"></a>Виртуальная машина с общедоступным IP-адресом уровня экземпляра (с подсистемой балансировки нагрузки или без нее)

В этом сценарии hello ВМ есть экземпляр уровень открытый IP (ILPIP) назначенный tooit. Является ли виртуальная машина hello балансировкой нагрузки или не не проверяются. При использовании адреса ILPIP преобразование SNAT не используется. Hello виртуальная машина использует hello ILPIP для всех исходящих потоков. Если приложение инициирует несколько исходящих потоков и возникновении нехватки SNAT, следует рассмотреть, назначение tooavoid ILPIP SNAT ограничения.

## <a name="discovering-hello-public-ip-used-by-a-given-vm"></a>Обнаружение hello открытый IP-адрес используется для данной виртуальной Машины

Существует множество способов toodetermine hello открытый IP-адрес источника исходящее подключение. OpenDNS предоставляет службу, которая может отображать hello общедоступный IP-адрес виртуальной машины. Использование команды nslookup hello, можно отправить запрос DNS для hello имя myip.opendns.com toohello OpenDNS распознавателя. Служба Hello возвращает hello исходный IP-адрес, используемые toosend hello запроса. При выполнении hello в следующем запросе из ВМ hello ответ — hello общедоступный IP-адрес используется для этой виртуальной Машины.

    nslookup myip.opendns.com resolver1.opendns.com

## <a name="preventing-public-connectivity"></a>Запрет подключения к общедоступным сетям

Иногда бывает нежелательно toobe виртуальных Машин допускается toocreate исходящего потока или может быть toomanage требование, какие назначения можно получить с помощью исходящих потоков. В этом случае используется [группы безопасности сети (NSG)](../virtual-network/virtual-networks-nsg.md) toomanage hello назначения, hello может достигать виртуальных Машин. При применении NSG tooa балансировки нагрузки виртуальной Машины, вы должны toohello внимания toopay [по умолчанию теги](../virtual-network/virtual-networks-nsg.md#default-tags) и [по умолчанию правила](../virtual-network/virtual-networks-nsg.md#default-rules).

Убедитесь, что hello виртуальной Машины можно получать запросы проверки работоспособности подсистемы балансировки нагрузки Azure. Если NSG блоки запросы состояния работоспособности выборки из hello AZURE_LOADBALANCER тег по умолчанию, происходит сбой проверки работоспособности вашей виртуальной Машины и снижении hello виртуальной Машины. Подсистема балансировки нагрузки перестает отправлять новые toothat потоков виртуальной Машины.

## <a name="limitations"></a>Ограничения

Если [несколько (общедоступных) IP-адресов связано с подсистемой балансировки нагрузки](load-balancer-multivip-overview.md), то любой из этих общедоступных IP-адресов может использоваться для исходящих потоков.

Azure использует алгоритм toodetermine hello количество доступных портов SNAT зависимости от размера пула hello hello.  Этот алгоритм на данный момент нельзя настраивать.

Очень важно, что toorememember, количество доступных портов SNAT hello не преобразует toonumber соединений непосредственно. См. в разделе выше особенности на когда и как SNAT порты назначаются и как toomanage exhaustible ресурс.
