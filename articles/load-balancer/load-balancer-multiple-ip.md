---
title: "Балансировка нагрузки в конфигурациях с несколькими IP-адресами в Azure | Документация Майкрософт"
description: "Балансировка нагрузки между основной и дополнительной IP-конфигурациями."
services: load-balancer
documentationcenter: na
author: kumudd
manager: timlt
editor: na
ms.assetid: 244907cd-b275-4494-aaf7-dcfc4d93edfe
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/22/2017
ms.author: kumud
ms.openlocfilehash: cf1e68c7b37b2506de007bdf24eea63a27187a33
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="load-balancing-on-multiple-ip-configurations-using-the-azure-portal"></a>Балансировка нагрузки в конфигурациях с несколькими IP-адресами с помощью портала Azure

> [!div class="op_single_selector"]
> * [Портал](load-balancer-multiple-ip.md)
> * [PowerShell](load-balancer-multiple-ip-powershell.md)
> * [ИНТЕРФЕЙС КОМАНДНОЙ СТРОКИ](load-balancer-multiple-ip-cli.md)

В этой статье описывается использование Azure Load Balancer с несколькими IP-адресами и дополнительным сетевым интерфейсом (сетевой картой). В этом сценарии используются две виртуальные машины под управлением Windows, оснащенные основной и дополнительной сетевыми картами. У каждой из дополнительных сетевых карт есть по две IP-конфигурации. На каждой виртуальной машине размещены веб-сайты contoso.com и fabrikam.com. Каждый веб-сайт привязан к одной из IP-конфигураций дополнительной сетевой карты. Мы используем Azure Load Balancer, чтобы предоставить два интерфейсных IP-адреса, по одному для каждого веб-сайта. Это позволит направлять трафик в соответствующую IP-конфигурацию для веб-сайта. В данном сценарии используется одинаковый номер порта для обоих внешних интерфейсов, как и для обоих IP-адресов внутренних пулов.

![Схема балансировки нагрузки для сценария](./media/load-balancer-multiple-ip/lb-multi-ip.PNG)

##<a name="prerequisites"></a>Предварительные требования
В этом примере предполагается, что у вас есть группа ресурсов с именем *contosofabrikam* и следующей конфигурацией.
 -  Виртуальная сеть с именем *myVNet*, куда в рамках группы доступности *myAvailset* входят две виртуальные машины с именами *VM1* и *VM2*. 
 - Каждая виртуальная машина оснащена основной и дополнительной сетевыми картами. Основные сетевые карты с именами *VM1NIC1* и *VM2NIC1* и дополнительные с именами *VM1NIC2* и *VM2NIC2* соответственно. См. дополнительные сведения о [создании виртуальных машин с несколькими сетевыми картами с помощью PowerShell](../virtual-network/virtual-network-deploy-multinic-arm-ps.md).

## <a name="steps-to-load-balance-on-multiple-ip-configurations"></a>Инструкции по балансировке нагрузки в конфигурациях с несколькими IP-адресами

Сделайте следующее, чтобы реализовать сценарий, описанный в этой статье.

### <a name="step-1-configure-the-secondary-nics-for-each-vm"></a>Шаг 1. Настройка дополнительных сетевых карт для каждой виртуальной машины

Каждой дополнительной сетевой карте каждой виртуальной машины в виртуальной сети назначьте IP-конфигурацию следующим образом.  

1. В браузере перейдите на портал Azure по адресу http://portal.azure.com и войдите, используя учетную запись Azure.
2. В верхней левой части экрана щелкните значок группы ресурсов, а затем выберите группу ресурсов, в которую входят виртуальные машины (например, *contosofabrikam*). Отобразится колонка **Группа ресурсов**, в которой перечислены все ресурсы и сетевые интерфейсы, связанные с виртуальными машинами.
3. Каждой дополнительной сетевой карте каждой виртуальной машины назначьте IP-конфигурацию следующим образом.
    1. Выберите сетевой интерфейс, которому необходимо назначить IP-конфигурацию.
    2. Откроется колонка для выбранной сетевой карты. В ней щелкните **IP-конфигурации**. Затем в верхней части колонки нажмите кнопку **Добавить**.
    3. В колонке **Добавление IP-конфигураций** назначьте сетевой карте вторую IP-конфигурацию следующим образом. 
        1. Введите имя второй IP-конфигурации (например, для VM1 и VM2 имя IP-конфигураций будет *VM1NIC2 ipconfig2* и *VM2NIC2 ipconfig2* соответственно).
        2. В разделе **Частный IP-адрес** для параметра **Выделение** выберите значение **Статическое**.
        3. Нажмите кнопку **ОК**.
        4. Назначив дополнительной сетевой карте вторую IP-конфигурацию, вы увидите ее в соответствующей колонке **IP-конфигурации**.

### <a name="step-2-create-a-load-balancer"></a>Шаг 2. Создание подсистемы балансировки нагрузки

Создайте подсистему балансировки нагрузки следующим образом.

1. В браузере перейдите на портал Azure по адресу http://portal.azure.com и войдите, используя учетную запись Azure.
2. В верхней левой части экрана щелкните **Создать** > **Сеть** > **Подсистема балансировки нагрузки**. Далее щелкните **Создать**.
3. В колонке **Создание подсистемы балансировки нагрузки** введите имя для балансировщика нагрузки. В нашем примере это *mylb*.
4. В разделе "Общедоступный IP-адрес" создайте общедоступный IP-адрес с именем **PublicIP1**.
5. В разделе "Группа ресурсов" выберите существующую группу ресурсов, связанную с вашими виртуальными машинами (например, *contosofabrikam*). Затем укажите соответствующее расположение и нажмите кнопку **ОК**. После этого балансировщик нагрузки начнет выполнение развертывания, для завершения которого может потребоваться несколько минут.
6. После развертывания подсистема балансировки нагрузки отобразится как ресурс в группе ресурсов.

### <a name="step-3-configure-the-frontend-ip-pool"></a>Шаг 3. Настройка пула внешних IP-адресов

Настройте пул внешних IP-адресов для каждого веб-сайта (contoso и fabrikam) следующим образом.

1. На портале щелкните **Другие службы**, в поле фильтра введите **общедоступный IP-адрес** и выберите **Общедоступные IP-адреса**. Затем в верхней части колонки нажмите кнопку **Добавить**.
2. Настройте два общедоступных IP-адреса (*PublicIP1* и *PublicIP2*) для обоих веб-сайтов (contoso и fabrikam) следующим образом.
    1. Введите имя внешнего IP-адреса.
    2. В разделе **Группа ресурсов** выберите существующую группу ресурсов, связанную с вашими виртуальными машинами (например, *contosofabrikam*).
    3. Выберите то же **расположение**, что и для виртуальных машин.
    4. Нажмите кнопку **ОК**.
    5. Создав два общедоступных IP-адреса, вы увидите их в колонке **Общедоступный IP-адрес**.
3. На портале щелкните **Другие службы**, в поле фильтра введите **подсистема балансировки нагрузки** и выберите **Подсистема балансировки нагрузки**.  
4. Выберите подсистему балансировки нагрузки (*mylb*), которую необходимо связать с пулом внешних IP-адресов.
5. В разделе **Параметры** выберите **Интерфейсные пулы**. Затем в верхней части колонки нажмите кнопку **Добавить**.
6. Введите имя внешнего IP-адреса (*farbikamfe* или **contosofe*).
7. Щелкните **IP-адрес** и в колонке **Выбор общедоступного IP-адреса** выберите IP-адреса для интерфейсных компонентов (*PublicIP1* или *PublicIP2*).
8. Повторите шаги 3–7 из этого раздела, чтобы создать второй внешний IP-адрес.
9. Настроив пул внешних IP-адресов, вы увидите их в колонке **Пул внешних IP-адресов** для подсистемы балансировки нагрузки. 
    
### <a name="step-4-configure-the-backend-pool"></a>Шаг 4. Настройка внутреннего пула   
Настройте пулы внутренних адресов подсистемы балансировки нагрузки для каждого веб-сайта (contoso и fabrikam) следующим образом.
        
1. На портале щелкните **Другие службы**, в поле фильтра введите "подсистема балансировки нагрузки" и выберите **Подсистема балансировки нагрузки**.  
2. Выберите подсистему балансировки нагрузки (*mylb*), которую необходимо связать с внутренними пулами.
3. В разделе **Параметры** выберите **Внутренние пулы**. Введите имя внутреннего пула (например, *contosopool* или *fabrikampool*). Затем в верхней части открывшейся колонки нажмите кнопку **Добавить** . 
4. Для параметра **Связано с** выберите значение **Группа доступности**.
5. Для параметра **Группа доступности** выберите значение **myAvailset**.
6. Назначьте виртуальным машинам IP-конфигурации целевых сетей следующим образом (см. рис. 2).  
    1. В качестве **целевой виртуальной машины** выберите виртуальную машину, которую необходимо связать с внутренним пулом (например, VM1 или VM2).
    2. В качестве **сетевой IP-конфигурации** выберите конфигурацию IP-адреса дополнительной сетевой карты для этой виртуальной машины (например, VM1NIC2-ipconfig2 или VM2NIC2-ipconfig2).
    ![Схема балансировки нагрузки для сценария](./media/load-balancer-multiple-ip/lb-backendpool.PNG)
            
        **Рис. 2**. Связывание подсистемы балансировки нагрузки с внутренними пулами  
7. Нажмите кнопку **ОК**.
8. Настроив конфигурацию внутреннего пула, вы увидите оба пула внутренних адресов в колонке **Пул внутренних IP-адресов** для подсистемы балансировки нагрузки.

### <a name="step-5-configure-a-health-probe-for-your-load-balancer"></a>Шаг 5. Настройка пробы работоспособности для подсистемы балансировки нагрузки
Настройте пробы работоспособности для подсистемы балансировки нагрузки следующим образом.
    1. На портале щелкните "Другие службы", в поле фильтра введите "подсистема балансировки нагрузки" и выберите **Подсистема балансировки нагрузки**.  
    2. Выберите подсистему балансировки нагрузки, которую необходимо связать с внутренними пулами.
    3. В разделе **Параметры** выберите **Проверка работоспособности**. Затем в верхней части колонки нажмите кнопку **Добавить**.
    4. Введите имя проверки работоспособности (например, HTTP) и нажмите кнопку **ОК**.

### <a name="step-6-configure-load-balancing-rules"></a>Шаг 6. Настройка правил балансировки нагрузки
Настройте правила балансировки нагрузки (*HTTPc* и *HTTPf*) для каждого веб-сайта следующим образом.
    
1. В разделе **Параметры** выберите **Проверка работоспособности**. Затем в верхней части колонки нажмите кнопку **Добавить**.
2. Выберите **имя** правила балансировки нагрузки (например, *HTTPc* для contoso, или *HTTPf* для fabrikam).
3. Выберите внешний IP-адрес (например *Contosofe* или *Fabrikamfe*)
4. Для **порта** и **порта сервера**, оставьте значение по умолчанию — **80**.
5. Для параметра **Плавающий IP-адрес (прямой ответ от сервера)** выберите значение **Включено**.
6. Нажмите кнопку **ОК**.
7. Повторите шаги 1–6 из этого раздела, чтобы создать второе правило балансировки нагрузки.
8. Настроив правила балансировки нагрузки (*HTTPc* и *HTTPf*), вы увидите их в колонке **Правила балансировки нагрузки** для подсистемы балансировки нагрузки.

### <a name="step-7-configure-dns-records"></a>Шаг 7. Настройка записей DNS
Наконец, вам нужно настроить записи ресурсов DNS, чтобы они указывали на соответствующие внешние IP-адреса подсистемы балансировки нагрузки. Домены можно разместить в Azure DNS. Дополнительные сведения об использовании Azure DNS с подсистемой балансировки нагрузки см. в разделе [Использование Azure DNS с другими службами Azure](../dns/dns-for-azure-services.md).

## <a name="next-steps"></a>Дальнейшие действия
- Узнайте больше о том, как объединять службы балансировки нагрузки, в статье [Использование служб балансировки нагрузки в Azure](../traffic-manager/traffic-manager-load-balancing-azure.md).
- Узнайте, как в Azure можно использовать журналы разных типов для управления подсистемой балансировки нагрузки и устранения неполадок в ее работе, ознакомившись со статьей [Служба анализа журналов для балансировщика нагрузки Azure](../load-balancer/load-balancer-monitor-log.md).
