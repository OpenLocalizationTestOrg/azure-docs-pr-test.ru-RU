---
title: "aaaMultiple VIP-адресов для балансировки нагрузки Azure | Документы Microsoft"
description: "Обзор функции нескольких виртуальных IP-адресов для Azure Load Balancer"
services: load-balancer
documentationcenter: na
author: chkuhtz
manager: narayan
editor: 
ms.assetid: 748e50cd-3087-4c2e-a9e1-ac0ecce4f869
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/11/2016
ms.author: chkuhtz
ms.openlocfilehash: e186e1248e7d187e7efd0668dc3244465ce3e156
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="multiple-vips-for-azure-load-balancer"></a>Несколько виртуальных IP-адресов для Azure Load Balancer

Подсистема балансировки нагрузки Azure позволяет сбалансировать службы tooload на несколько портов и несколько IP-адресов. Можно использовать открытых и внутренних нагрузки балансировки определения tooload баланс потоков между несколькими виртуальными машинами.

В этой статье описывается основы hello этой возможности, важные понятия и ограничений. Если предполагается tooexpose services только на один IP-адрес можно найти упрощены инструкции для [открытый](load-balancer-get-started-internet-portal.md) или [внутренней](load-balancer-get-started-ilb-arm-portal.md) конфигураций подсистемы балансировки нагрузки. Добавление нескольких виртуальных IP-адресов является добавочное tooa отдельную конфигурацию для виртуальных IP-адресов. Используя основные понятия hello в этой статье, можно развернуть Упрощенная конфигурация в любое время.

При определении Azure Load Balancer интерфейсная и внутренняя конфигурации связываются правилами. Hello ссылается hello правило проверки работоспособности — используется toodetermine как новые потоки отправляются узел tooa hello внутренний пул. Интерфейсный Hello определяется по виртуальных IP-адресов, который является кортеж, состоящий из IP-адрес (public или internal), транспортного протокола (UDP или TCP) и номер порта. DIP-адрес — IP-адрес в Azure виртуальный сетевой Адаптер подключен tooa виртуальной Машины в hello внутренний пул.

Hello в следующей таблице содержатся некоторые примеры конфигурации внешнего интерфейса.

| Виртуальный IP-адрес | IP-адрес | protocol | порт |
| --- | --- | --- | --- |
| 1 |65.52.0.1 |TCP |80 |
| 2 |65.52.0.1 |TCP |*8080* |
| 3 |65.52.0.1 |*UDP* |80 |
| 4 |*65.52.0.2* |TCP |80 |

Hello в таблице показаны четыре разных серверах переднего плана. Внешние интерфейсы 1, 2 и 3 — это один виртуальный IP-адрес с несколькими правилами. Hello же IP-адрес используется, но hello порта или протокол отличается для каждого внешнего интерфейса. Серверы переднего плана #1 и #4 являются примерами несколько виртуальных IP-адресов, когда hello того же порта и протокола внешнего интерфейса используются повторно через несколько виртуальных IP-адресов.

Подсистема балансировки нагрузки Azure обеспечивает гибкость при определении правила подсистемы балансировки нагрузки hello. Правило объявляет, как адрес и порт на сервере переднего плана hello сопоставленных toohello конечный адрес и порт hello серверную часть. Ли повторно использовать порты серверной части через правила зависит от типа hello hello правила. Каждый тип правил имеет определенные требования, которые могут повлиять на конфигурацию узла и конструкцию пробы. Существует два типа правил:

1. повторно использовать правило по умолчанию Hello с не внутренний порт
2. правило Hello плавающий IP-адрес, когда используются повторно внутреннего портами

Подсистема балансировки нагрузки Azure позволяет toomix, как правило, типы на hello же конфигурации подсистемы балансировки нагрузки. Подсистема балансировки нагрузки Hello их можно использовать одновременно для данной виртуальной Машины или любое их сочетание, до тех пор, пока подчиняться ограничения hello hello правила. Выбрать тип правил зависит от требований hello из вашего приложения и hello сложности поддержки этой конфигурации. Следует оценить, какие типы правил лучше подходят для конкретного сценария.

Мы исследуем эти дополнительные сценарии, начав с поведением по умолчанию hello.

## <a name="rule-type-1-no-backend-port-reuse"></a>Тип правил 1: внутренние порты повторно не используются

![Иллюстрация нескольких виртуальных IP-адресов](./media/load-balancer-multivip-overview/load-balancer-multivip.png)

В этом случае переднего плана hello виртуальных IP-адресов настроены следующим образом:

| Виртуальный IP-адрес | IP-адрес | protocol | порт |
| --- | --- | --- | --- |
| ![Виртуальный IP-адрес](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) 1 |65.52.0.1 |TCP |80 |
| ![Виртуальный IP-адрес](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) 2 |*65.52.0.2* |TCP |80 |

Hello DIP является назначением hello hello входящего потока. В пуле внутренних hello Каждая виртуальная машина предоставляет службу hello требуемого на уникальный порт на DIP. С сервера переднего плана hello через определение правил связана эта служба.

Мы определим два правила:

| правило; | Сопоставить внешний интерфейс | toobackend пула |
| --- | --- | --- |
| 1 |![Виртуальный IP-адрес](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) VIP1:80 |![серверная часть](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) DIP1:80, ![серверная часть](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) DIP2:80 |
| 2 |![Виртуальный IP-адрес](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) VIP2:80 |![серверная часть](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) DIP1:81, ![серверная часть](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) DIP2:81 |

Hello завершения сопоставления в подсистеме балансировки нагрузки Azure — теперь следующим образом:

| правило; | Виртуальный IP-адрес (VIP) | protocol | порт | Место назначения | порт |
| --- | --- | --- | --- | --- | --- |
| ![правило;](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) 1 |65.52.0.1 |TCP |80 |Выделенный IP-адрес (DIP) |80 |
| ![правило;](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) 2 |65.52.0.2 |TCP |80 |Выделенный IP-адрес (DIP) |81 |

Каждое правило должно создавать поток с уникальным сочетанием конечного IP-адреса и конечного порта. С различными hello порт назначения потока hello несколько правил можно доставлять потоки toohello же DIP другие порты.

Зонды работоспособности всегда являются направленной toohello DIP виртуальной машины. Необходимо убедиться, вы, ваш пробы отражает hello работоспособности hello виртуальной Машины.

## <a name="rule-type-2-backend-port-reuse-by-using-floating-ip"></a>Тип правил 2: внутренние порты используются повторно с помощью плавающего IP-адреса

Подсистема балансировки нагрузки Azure обеспечивает гибкость hello tooreuse hello интерфейсный порт между несколькими виртуальными IP-адресами независимо от того, используется тип правила hello. Кроме того некоторые сценарии приложений предпочитаемые или требуют же порт используется несколько экземпляров приложения на виртуальной Машине в hello внутренний пул toobe hello. К распространенным примерам повторного использования портов относятся виртуальные сетевые устройства, кластеризация для обеспечения высокой доступности и размещение нескольких конечных точек TLS без повторного шифрования.

Если требуется tooreuse hello внутренний порт, через несколько правил, необходимо включить плавающий IP-адрес в определение правила hello.

Плавающий IP-адрес — это часть метода, известного как прямой ответ от сервера (DSR). DSR состоит из двух частей: топологии потока и схемы сопоставления IP-адресов. На уровне платформы Azure Load Balancer всегда работает в топологии потока DSR независимо от того, активирован ли плавающий IP-адрес. Это означает, что hello исходящих частью потока всегда правильно перезаписанного tooflow непосредственно задней toohello источника.

С типом правила по умолчанию hello Azure предоставляет традиционной схемы сопоставления IP-адресов для удобства использования с балансировкой нагрузки. Включение плавающий IP-адрес изменяется hello tooallow схема сопоставления IP-адреса для обеспечения дополнительной гибкости, как описано ниже.

Эта конфигурация представлена следующая диаграмма Hello:

![Иллюстрация нескольких виртуальных IP-адресов](./media/load-balancer-multivip-overview/load-balancer-multivip-dsr.png)

В этом сценарии каждой виртуальной Машины в hello внутренний пул имеет три сетевых интерфейсов:

* DIP: виртуального сетевого Адаптера связанные с hello виртуальной Машины (IP-конфигурации Сетевых ресурсов Azure)
* VIP1: интерфейс замыкания на себя в гостевой ОС, настроенной с IP-адресом VIP1.
* VIP2: интерфейс замыкания на себя в гостевой ОС, настроенной с IP-адресом VIP2.

> [!IMPORTANT]
> Настройка Hello логических интерфейсов hello выполняется внутри hello гостевой ОС. Эта настройка не выполняется и не управляется Azure. Без такой настройки правил hello не будет работать. Использовать hello DIP для виртуальной Машины hello зонд определения работоспособности вместо hello логических виртуальных IP-адресов. Таким образом службы необходимо предоставить проверки ответов на порту DIP, который отражает состояние hello hello службы, предлагаемой на hello логических виртуальных IP-адресов.

Предположим, что hello же конфигурацию внешнего интерфейса, как в предыдущем сценарии hello:

| Виртуальный IP-адрес | IP-адрес | protocol | порт |
| --- | --- | --- | --- |
| ![Виртуальный IP-адрес](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) 1 |65.52.0.1 |TCP |80 |
| ![Виртуальный IP-адрес](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) 2 |*65.52.0.2* |TCP |80 |

Мы определим два правила:

| правило; | Сопоставить внешний интерфейс | toobackend пула |
| --- | --- | --- |
| 1 |![правило;](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) VIP1:80 |![серверная часть](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) VIP1:80 (на виртуальной машине 1 и виртуальной машине 2) |
| 2 |![правило;](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) VIP2:80 |![серверная часть](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) VIP2:80 (на виртуальной машине 1 и виртуальной машине 2) |

Привет, в следующей таблице показано сопоставление завершения hello в hello подсистемы балансировки нагрузки.

| правило; | Виртуальный IP-адрес (VIP) | protocol | порт | Место назначения | порт |
| --- | --- | --- | --- | --- | --- |
| ![Виртуальный IP-адрес](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) 1 |65.52.0.1 |TCP |80 |совпадает с виртуальным IP-адресом (65.52.0.1) |совпадает с виртуальным IP-адресом (80) |
| ![Виртуальный IP-адрес](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) 2 |65.52.0.2 |TCP |80 |совпадает с виртуальным IP-адресом (65.52.0.2) |совпадает с виртуальным IP-адресом (80) |

Назначение Hello hello входящего потока является адрес hello виртуальных IP-адресов через интерфейс замыкания на себя hello hello виртуальной Машины. Каждое правило должно создавать поток с уникальным сочетанием конечного IP-адреса и конечного порта. Различные hello конечный IP-адрес потока hello повторное использование портов можно использовать на hello одной виртуальной Машины. Служба балансировки нагрузки без поддержки toohello становится, привязав его IP-адрес и порт hello соответствующих замыкания на себя интерфейса toohello виртуальный IP-адрес.

Обратите внимание, что в этом примере не изменяет порт назначения hello. Несмотря на то, что это сценарий плавающий IP-адрес подсистемы балансировки нагрузки Azure также поддерживает определение правила toorewrite hello внутренний конечный порт и toomake отличный от hello интерфейсный порт назначения.

Hello тип правила плавающий IP-адрес — hello foundation из нескольких шаблонов конфигурации подсистемы балансировки нагрузки. Одним из примеров, доступных в настоящее время является hello [SQL AlwaysOn с помощью нескольких прослушивателей](../virtual-machines/windows/sql/virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md) конфигурации. В будущем мы опишем больше сценариев.

## <a name="limitations"></a>Ограничения

* Конфигурации с несколькими виртуальными IP-адресами поддерживаются только при использовании виртуальных машин IaaS.
* С правилом hello плавающий IP-адрес приложение должно использовать hello DIP-адрес для исходящих потоков. Если приложение связывает toohello виртуальный IP-адрес, настроенный в интерфейсе hello замыкания на себя в hello гостевой ОС, затем SNAT не доступные toorewrite hello исходящего потока и потока hello выходит из строя.
* Общедоступные IP-адреса оказывают влияние на выставление счетов. Дополнительные сведения см. в статье [Цены на IP-адреса](https://azure.microsoft.com/pricing/details/ip-addresses/).
* Действуют ограничения подписки. Дополнительные сведения см. в разделе [Ограничения определенных служб](../azure-subscription-service-limits.md#networking-limits).
