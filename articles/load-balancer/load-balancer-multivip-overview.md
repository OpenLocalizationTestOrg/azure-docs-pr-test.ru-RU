---
title: "aaaMultiple VIP-адресов для балансировки нагрузки Azure | Документы Microsoft"
description: "Обзор функции нескольких виртуальных IP-адресов для Azure Load Balancer"
services: load-balancer
documentationcenter: na
author: chkuhtz
manager: narayan
editor: 
ms.assetid: 748e50cd-3087-4c2e-a9e1-ac0ecce4f869
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/11/2016
ms.author: chkuhtz
ms.openlocfilehash: e186e1248e7d187e7efd0668dc3244465ce3e156
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="multiple-vips-for-azure-load-balancer"></a><span data-ttu-id="dff6c-103">Несколько виртуальных IP-адресов для Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="dff6c-103">Multiple VIPs for Azure Load Balancer</span></span>

<span data-ttu-id="dff6c-104">Подсистема балансировки нагрузки Azure позволяет сбалансировать службы tooload на несколько портов и несколько IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="dff6c-104">Azure Load Balancer allows you tooload balance services on multiple ports, multiple IP addresses, or both.</span></span> <span data-ttu-id="dff6c-105">Можно использовать открытых и внутренних нагрузки балансировки определения tooload баланс потоков между несколькими виртуальными машинами.</span><span class="sxs-lookup"><span data-stu-id="dff6c-105">You can use public and internal load balancer definitions tooload balance flows across a set of VMs.</span></span>

<span data-ttu-id="dff6c-106">В этой статье описывается основы hello этой возможности, важные понятия и ограничений.</span><span class="sxs-lookup"><span data-stu-id="dff6c-106">This article describes hello fundamentals of this ability, important concepts, and constraints.</span></span> <span data-ttu-id="dff6c-107">Если предполагается tooexpose services только на один IP-адрес можно найти упрощены инструкции для [открытый](load-balancer-get-started-internet-portal.md) или [внутренней](load-balancer-get-started-ilb-arm-portal.md) конфигураций подсистемы балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="dff6c-107">If you only intend tooexpose services on one IP address, you can find simplified instructions for [public](load-balancer-get-started-internet-portal.md) or [internal](load-balancer-get-started-ilb-arm-portal.md) load balancer configurations.</span></span> <span data-ttu-id="dff6c-108">Добавление нескольких виртуальных IP-адресов является добавочное tooa отдельную конфигурацию для виртуальных IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="dff6c-108">Adding Multiple VIPs is incremental tooa single VIP configuration.</span></span> <span data-ttu-id="dff6c-109">Используя основные понятия hello в этой статье, можно развернуть Упрощенная конфигурация в любое время.</span><span class="sxs-lookup"><span data-stu-id="dff6c-109">Using hello concepts in this article, you can expand a simplified configuration at any time.</span></span>

<span data-ttu-id="dff6c-110">При определении Azure Load Balancer интерфейсная и внутренняя конфигурации связываются правилами.</span><span class="sxs-lookup"><span data-stu-id="dff6c-110">When you define an Azure Load Balancer, a frontend and a backend configuration are connected with rules.</span></span> <span data-ttu-id="dff6c-111">Hello ссылается hello правило проверки работоспособности — используется toodetermine как новые потоки отправляются узел tooa hello внутренний пул.</span><span class="sxs-lookup"><span data-stu-id="dff6c-111">hello health probe referenced by hello rule is used toodetermine how new flows are sent tooa node in hello backend pool.</span></span> <span data-ttu-id="dff6c-112">Интерфейсный Hello определяется по виртуальных IP-адресов, который является кортеж, состоящий из IP-адрес (public или internal), транспортного протокола (UDP или TCP) и номер порта.</span><span class="sxs-lookup"><span data-stu-id="dff6c-112">hello frontend is defined by a Virtual IP (VIP), which is a 3-tuple comprised of an IP address (public or internal), a transport protocol (UDP or TCP), and a port number.</span></span> <span data-ttu-id="dff6c-113">DIP-адрес — IP-адрес в Azure виртуальный сетевой Адаптер подключен tooa виртуальной Машины в hello внутренний пул.</span><span class="sxs-lookup"><span data-stu-id="dff6c-113">A DIP is an IP address on an Azure virtual NIC attached tooa VM in hello backend pool.</span></span>

<span data-ttu-id="dff6c-114">Hello в следующей таблице содержатся некоторые примеры конфигурации внешнего интерфейса.</span><span class="sxs-lookup"><span data-stu-id="dff6c-114">hello following table contains some example frontend configurations:</span></span>

| <span data-ttu-id="dff6c-115">Виртуальный IP-адрес</span><span class="sxs-lookup"><span data-stu-id="dff6c-115">VIP</span></span> | <span data-ttu-id="dff6c-116">IP-адрес</span><span class="sxs-lookup"><span data-stu-id="dff6c-116">IP address</span></span> | <span data-ttu-id="dff6c-117">protocol</span><span class="sxs-lookup"><span data-stu-id="dff6c-117">protocol</span></span> | <span data-ttu-id="dff6c-118">порт</span><span class="sxs-lookup"><span data-stu-id="dff6c-118">port</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="dff6c-119">1</span><span class="sxs-lookup"><span data-stu-id="dff6c-119">1</span></span> |<span data-ttu-id="dff6c-120">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="dff6c-120">65.52.0.1</span></span> |<span data-ttu-id="dff6c-121">TCP</span><span class="sxs-lookup"><span data-stu-id="dff6c-121">TCP</span></span> |<span data-ttu-id="dff6c-122">80</span><span class="sxs-lookup"><span data-stu-id="dff6c-122">80</span></span> |
| <span data-ttu-id="dff6c-123">2</span><span class="sxs-lookup"><span data-stu-id="dff6c-123">2</span></span> |<span data-ttu-id="dff6c-124">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="dff6c-124">65.52.0.1</span></span> |<span data-ttu-id="dff6c-125">TCP</span><span class="sxs-lookup"><span data-stu-id="dff6c-125">TCP</span></span> |<span data-ttu-id="dff6c-126">*8080*</span><span class="sxs-lookup"><span data-stu-id="dff6c-126">*8080*</span></span> |
| <span data-ttu-id="dff6c-127">3</span><span class="sxs-lookup"><span data-stu-id="dff6c-127">3</span></span> |<span data-ttu-id="dff6c-128">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="dff6c-128">65.52.0.1</span></span> |<span data-ttu-id="dff6c-129">*UDP*</span><span class="sxs-lookup"><span data-stu-id="dff6c-129">*UDP*</span></span> |<span data-ttu-id="dff6c-130">80</span><span class="sxs-lookup"><span data-stu-id="dff6c-130">80</span></span> |
| <span data-ttu-id="dff6c-131">4</span><span class="sxs-lookup"><span data-stu-id="dff6c-131">4</span></span> |<span data-ttu-id="dff6c-132">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="dff6c-132">*65.52.0.2*</span></span> |<span data-ttu-id="dff6c-133">TCP</span><span class="sxs-lookup"><span data-stu-id="dff6c-133">TCP</span></span> |<span data-ttu-id="dff6c-134">80</span><span class="sxs-lookup"><span data-stu-id="dff6c-134">80</span></span> |

<span data-ttu-id="dff6c-135">Hello в таблице показаны четыре разных серверах переднего плана.</span><span class="sxs-lookup"><span data-stu-id="dff6c-135">hello table shows four different frontends.</span></span> <span data-ttu-id="dff6c-136">Внешние интерфейсы 1, 2 и 3 — это один виртуальный IP-адрес с несколькими правилами.</span><span class="sxs-lookup"><span data-stu-id="dff6c-136">Frontends #1, #2 and #3 are a single VIP with multiple rules.</span></span> <span data-ttu-id="dff6c-137">Hello же IP-адрес используется, но hello порта или протокол отличается для каждого внешнего интерфейса.</span><span class="sxs-lookup"><span data-stu-id="dff6c-137">hello same IP address is used but hello port or protocol is different for each frontend.</span></span> <span data-ttu-id="dff6c-138">Серверы переднего плана #1 и #4 являются примерами несколько виртуальных IP-адресов, когда hello того же порта и протокола внешнего интерфейса используются повторно через несколько виртуальных IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="dff6c-138">Frontends #1 and #4 are an example of Multiple VIPs, where hello same frontend protocol and port are reused across multiple VIPs.</span></span>

<span data-ttu-id="dff6c-139">Подсистема балансировки нагрузки Azure обеспечивает гибкость при определении правила подсистемы балансировки нагрузки hello.</span><span class="sxs-lookup"><span data-stu-id="dff6c-139">Azure Load Balancer provides flexibility in defining hello load balancing rules.</span></span> <span data-ttu-id="dff6c-140">Правило объявляет, как адрес и порт на сервере переднего плана hello сопоставленных toohello конечный адрес и порт hello серверную часть.</span><span class="sxs-lookup"><span data-stu-id="dff6c-140">A rule declares how an address and port on hello frontend is mapped toohello destination address and port on hello backend.</span></span> <span data-ttu-id="dff6c-141">Ли повторно использовать порты серверной части через правила зависит от типа hello hello правила.</span><span class="sxs-lookup"><span data-stu-id="dff6c-141">Whether or not backend ports are reused across rules depends on hello type of hello rule.</span></span> <span data-ttu-id="dff6c-142">Каждый тип правил имеет определенные требования, которые могут повлиять на конфигурацию узла и конструкцию пробы.</span><span class="sxs-lookup"><span data-stu-id="dff6c-142">Each type of rule has specific requirements that can affect host configuration and probe design.</span></span> <span data-ttu-id="dff6c-143">Существует два типа правил:</span><span class="sxs-lookup"><span data-stu-id="dff6c-143">There are two types of rules:</span></span>

1. <span data-ttu-id="dff6c-144">повторно использовать правило по умолчанию Hello с не внутренний порт</span><span class="sxs-lookup"><span data-stu-id="dff6c-144">hello default rule with no backend port reuse</span></span>
2. <span data-ttu-id="dff6c-145">правило Hello плавающий IP-адрес, когда используются повторно внутреннего портами</span><span class="sxs-lookup"><span data-stu-id="dff6c-145">hello Floating IP rule where backend ports are reused</span></span>

<span data-ttu-id="dff6c-146">Подсистема балансировки нагрузки Azure позволяет toomix, как правило, типы на hello же конфигурации подсистемы балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="dff6c-146">Azure Load Balancer allows you toomix both rule types on hello same load balancer configuration.</span></span> <span data-ttu-id="dff6c-147">Подсистема балансировки нагрузки Hello их можно использовать одновременно для данной виртуальной Машины или любое их сочетание, до тех пор, пока подчиняться ограничения hello hello правила.</span><span class="sxs-lookup"><span data-stu-id="dff6c-147">hello load balancer can use them simultaneously for a given VM, or any combination, as long as you abide by hello constraints of hello rule.</span></span> <span data-ttu-id="dff6c-148">Выбрать тип правил зависит от требований hello из вашего приложения и hello сложности поддержки этой конфигурации.</span><span class="sxs-lookup"><span data-stu-id="dff6c-148">Which rule type you choose depends on hello requirements of your application and hello complexity of supporting that configuration.</span></span> <span data-ttu-id="dff6c-149">Следует оценить, какие типы правил лучше подходят для конкретного сценария.</span><span class="sxs-lookup"><span data-stu-id="dff6c-149">You should evaluate which rule types are best for your scenario.</span></span>

<span data-ttu-id="dff6c-150">Мы исследуем эти дополнительные сценарии, начав с поведением по умолчанию hello.</span><span class="sxs-lookup"><span data-stu-id="dff6c-150">We explore these scenarios further by starting with hello default behavior.</span></span>

## <a name="rule-type-1-no-backend-port-reuse"></a><span data-ttu-id="dff6c-151">Тип правил 1: внутренние порты повторно не используются</span><span class="sxs-lookup"><span data-stu-id="dff6c-151">Rule type #1: No backend port reuse</span></span>

![Иллюстрация нескольких виртуальных IP-адресов](./media/load-balancer-multivip-overview/load-balancer-multivip.png)

<span data-ttu-id="dff6c-153">В этом случае переднего плана hello виртуальных IP-адресов настроены следующим образом:</span><span class="sxs-lookup"><span data-stu-id="dff6c-153">In this scenario, hello frontend VIPs are configured as follows:</span></span>

| <span data-ttu-id="dff6c-154">Виртуальный IP-адрес</span><span class="sxs-lookup"><span data-stu-id="dff6c-154">VIP</span></span> | <span data-ttu-id="dff6c-155">IP-адрес</span><span class="sxs-lookup"><span data-stu-id="dff6c-155">IP address</span></span> | <span data-ttu-id="dff6c-156">protocol</span><span class="sxs-lookup"><span data-stu-id="dff6c-156">protocol</span></span> | <span data-ttu-id="dff6c-157">порт</span><span class="sxs-lookup"><span data-stu-id="dff6c-157">port</span></span> |
| --- | --- | --- | --- |
| ![Виртуальный IP-адрес](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="dff6c-159">1</span><span class="sxs-lookup"><span data-stu-id="dff6c-159">1</span></span> |<span data-ttu-id="dff6c-160">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="dff6c-160">65.52.0.1</span></span> |<span data-ttu-id="dff6c-161">TCP</span><span class="sxs-lookup"><span data-stu-id="dff6c-161">TCP</span></span> |<span data-ttu-id="dff6c-162">80</span><span class="sxs-lookup"><span data-stu-id="dff6c-162">80</span></span> |
| ![Виртуальный IP-адрес](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="dff6c-164">2</span><span class="sxs-lookup"><span data-stu-id="dff6c-164">2</span></span> |<span data-ttu-id="dff6c-165">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="dff6c-165">*65.52.0.2*</span></span> |<span data-ttu-id="dff6c-166">TCP</span><span class="sxs-lookup"><span data-stu-id="dff6c-166">TCP</span></span> |<span data-ttu-id="dff6c-167">80</span><span class="sxs-lookup"><span data-stu-id="dff6c-167">80</span></span> |

<span data-ttu-id="dff6c-168">Hello DIP является назначением hello hello входящего потока.</span><span class="sxs-lookup"><span data-stu-id="dff6c-168">hello DIP is hello destination of hello inbound flow.</span></span> <span data-ttu-id="dff6c-169">В пуле внутренних hello Каждая виртуальная машина предоставляет службу hello требуемого на уникальный порт на DIP.</span><span class="sxs-lookup"><span data-stu-id="dff6c-169">In hello backend pool, each VM exposes hello desired service on a unique port on a DIP.</span></span> <span data-ttu-id="dff6c-170">С сервера переднего плана hello через определение правил связана эта служба.</span><span class="sxs-lookup"><span data-stu-id="dff6c-170">This service is associated with hello frontend through a rule definition.</span></span>

<span data-ttu-id="dff6c-171">Мы определим два правила:</span><span class="sxs-lookup"><span data-stu-id="dff6c-171">We define two rules:</span></span>

| <span data-ttu-id="dff6c-172">правило;</span><span class="sxs-lookup"><span data-stu-id="dff6c-172">Rule</span></span> | <span data-ttu-id="dff6c-173">Сопоставить внешний интерфейс</span><span class="sxs-lookup"><span data-stu-id="dff6c-173">Map frontend</span></span> | <span data-ttu-id="dff6c-174">toobackend пула</span><span class="sxs-lookup"><span data-stu-id="dff6c-174">toobackend pool</span></span> |
| --- | --- | --- |
| <span data-ttu-id="dff6c-175">1</span><span class="sxs-lookup"><span data-stu-id="dff6c-175">1</span></span> |![Виртуальный IP-адрес](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="dff6c-177">VIP1:80</span><span class="sxs-lookup"><span data-stu-id="dff6c-177">VIP1:80</span></span> |![серверная часть](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="dff6c-179">DIP1:80,</span><span class="sxs-lookup"><span data-stu-id="dff6c-179">DIP1:80,</span></span> ![серверная часть](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="dff6c-181">DIP2:80</span><span class="sxs-lookup"><span data-stu-id="dff6c-181">DIP2:80</span></span> |
| <span data-ttu-id="dff6c-182">2</span><span class="sxs-lookup"><span data-stu-id="dff6c-182">2</span></span> |![Виртуальный IP-адрес](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="dff6c-184">VIP2:80</span><span class="sxs-lookup"><span data-stu-id="dff6c-184">VIP2:80</span></span> |![серверная часть](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="dff6c-186">DIP1:81,</span><span class="sxs-lookup"><span data-stu-id="dff6c-186">DIP1:81,</span></span> ![серверная часть](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="dff6c-188">DIP2:81</span><span class="sxs-lookup"><span data-stu-id="dff6c-188">DIP2:81</span></span> |

<span data-ttu-id="dff6c-189">Hello завершения сопоставления в подсистеме балансировки нагрузки Azure — теперь следующим образом:</span><span class="sxs-lookup"><span data-stu-id="dff6c-189">hello complete mapping in Azure Load Balancer is now as follows:</span></span>

| <span data-ttu-id="dff6c-190">правило;</span><span class="sxs-lookup"><span data-stu-id="dff6c-190">Rule</span></span> | <span data-ttu-id="dff6c-191">Виртуальный IP-адрес (VIP)</span><span class="sxs-lookup"><span data-stu-id="dff6c-191">VIP IP address</span></span> | <span data-ttu-id="dff6c-192">protocol</span><span class="sxs-lookup"><span data-stu-id="dff6c-192">protocol</span></span> | <span data-ttu-id="dff6c-193">порт</span><span class="sxs-lookup"><span data-stu-id="dff6c-193">port</span></span> | <span data-ttu-id="dff6c-194">Место назначения</span><span class="sxs-lookup"><span data-stu-id="dff6c-194">Destination</span></span> | <span data-ttu-id="dff6c-195">порт</span><span class="sxs-lookup"><span data-stu-id="dff6c-195">port</span></span> |
| --- | --- | --- | --- | --- | --- |
| ![правило;](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="dff6c-197">1</span><span class="sxs-lookup"><span data-stu-id="dff6c-197">1</span></span> |<span data-ttu-id="dff6c-198">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="dff6c-198">65.52.0.1</span></span> |<span data-ttu-id="dff6c-199">TCP</span><span class="sxs-lookup"><span data-stu-id="dff6c-199">TCP</span></span> |<span data-ttu-id="dff6c-200">80</span><span class="sxs-lookup"><span data-stu-id="dff6c-200">80</span></span> |<span data-ttu-id="dff6c-201">Выделенный IP-адрес (DIP)</span><span class="sxs-lookup"><span data-stu-id="dff6c-201">DIP IP Address</span></span> |<span data-ttu-id="dff6c-202">80</span><span class="sxs-lookup"><span data-stu-id="dff6c-202">80</span></span> |
| ![правило;](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="dff6c-204">2</span><span class="sxs-lookup"><span data-stu-id="dff6c-204">2</span></span> |<span data-ttu-id="dff6c-205">65.52.0.2</span><span class="sxs-lookup"><span data-stu-id="dff6c-205">65.52.0.2</span></span> |<span data-ttu-id="dff6c-206">TCP</span><span class="sxs-lookup"><span data-stu-id="dff6c-206">TCP</span></span> |<span data-ttu-id="dff6c-207">80</span><span class="sxs-lookup"><span data-stu-id="dff6c-207">80</span></span> |<span data-ttu-id="dff6c-208">Выделенный IP-адрес (DIP)</span><span class="sxs-lookup"><span data-stu-id="dff6c-208">DIP IP Address</span></span> |<span data-ttu-id="dff6c-209">81</span><span class="sxs-lookup"><span data-stu-id="dff6c-209">81</span></span> |

<span data-ttu-id="dff6c-210">Каждое правило должно создавать поток с уникальным сочетанием конечного IP-адреса и конечного порта.</span><span class="sxs-lookup"><span data-stu-id="dff6c-210">Each rule must produce a flow with a unique combination of destination IP address and destination port.</span></span> <span data-ttu-id="dff6c-211">С различными hello порт назначения потока hello несколько правил можно доставлять потоки toohello же DIP другие порты.</span><span class="sxs-lookup"><span data-stu-id="dff6c-211">By varying hello destination port of hello flow, multiple rules can deliver flows toohello same DIP on different ports.</span></span>

<span data-ttu-id="dff6c-212">Зонды работоспособности всегда являются направленной toohello DIP виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="dff6c-212">Health probes are always directed toohello DIP of a VM.</span></span> <span data-ttu-id="dff6c-213">Необходимо убедиться, вы, ваш пробы отражает hello работоспособности hello виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="dff6c-213">You must ensure you that your probe reflects hello health of hello VM.</span></span>

## <a name="rule-type-2-backend-port-reuse-by-using-floating-ip"></a><span data-ttu-id="dff6c-214">Тип правил 2: внутренние порты используются повторно с помощью плавающего IP-адреса</span><span class="sxs-lookup"><span data-stu-id="dff6c-214">Rule type #2: backend port reuse by using Floating IP</span></span>

<span data-ttu-id="dff6c-215">Подсистема балансировки нагрузки Azure обеспечивает гибкость hello tooreuse hello интерфейсный порт между несколькими виртуальными IP-адресами независимо от того, используется тип правила hello.</span><span class="sxs-lookup"><span data-stu-id="dff6c-215">Azure Load Balancer provides hello flexibility tooreuse hello frontend port across multiple VIPs regardless of hello rule type used.</span></span> <span data-ttu-id="dff6c-216">Кроме того некоторые сценарии приложений предпочитаемые или требуют же порт используется несколько экземпляров приложения на виртуальной Машине в hello внутренний пул toobe hello.</span><span class="sxs-lookup"><span data-stu-id="dff6c-216">Additionally, some application scenarios prefer or require hello same port toobe used by multiple application instances on a single VM in hello backend pool.</span></span> <span data-ttu-id="dff6c-217">К распространенным примерам повторного использования портов относятся виртуальные сетевые устройства, кластеризация для обеспечения высокой доступности и размещение нескольких конечных точек TLS без повторного шифрования.</span><span class="sxs-lookup"><span data-stu-id="dff6c-217">Common examples of port reuse include clustering for high availability, network virtual appliances, and exposing multiple TLS endpoints without re-encryption.</span></span>

<span data-ttu-id="dff6c-218">Если требуется tooreuse hello внутренний порт, через несколько правил, необходимо включить плавающий IP-адрес в определение правила hello.</span><span class="sxs-lookup"><span data-stu-id="dff6c-218">If you want tooreuse hello backend port across multiple rules, you must enable Floating IP in hello rule definition.</span></span>

<span data-ttu-id="dff6c-219">Плавающий IP-адрес — это часть метода, известного как прямой ответ от сервера (DSR).</span><span class="sxs-lookup"><span data-stu-id="dff6c-219">Floating IP is a portion of what is known as Direct Server Return (DSR).</span></span> <span data-ttu-id="dff6c-220">DSR состоит из двух частей: топологии потока и схемы сопоставления IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="dff6c-220">DSR consists of two parts: a flow topology and an IP address mapping scheme.</span></span> <span data-ttu-id="dff6c-221">На уровне платформы Azure Load Balancer всегда работает в топологии потока DSR независимо от того, активирован ли плавающий IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="dff6c-221">At a platform level, Azure Load Balancer always operates in a DSR flow topology regardless of whether Floating IP is enabled or not.</span></span> <span data-ttu-id="dff6c-222">Это означает, что hello исходящих частью потока всегда правильно перезаписанного tooflow непосредственно задней toohello источника.</span><span class="sxs-lookup"><span data-stu-id="dff6c-222">This means that hello outbound part of a flow is always correctly rewritten tooflow directly back toohello origin.</span></span>

<span data-ttu-id="dff6c-223">С типом правила по умолчанию hello Azure предоставляет традиционной схемы сопоставления IP-адресов для удобства использования с балансировкой нагрузки.</span><span class="sxs-lookup"><span data-stu-id="dff6c-223">With hello default rule type, Azure exposes a traditional load balancing IP address mapping scheme for ease of use.</span></span> <span data-ttu-id="dff6c-224">Включение плавающий IP-адрес изменяется hello tooallow схема сопоставления IP-адреса для обеспечения дополнительной гибкости, как описано ниже.</span><span class="sxs-lookup"><span data-stu-id="dff6c-224">Enabling Floating IP changes hello IP address mapping scheme tooallow for additional flexibility as explained below.</span></span>

<span data-ttu-id="dff6c-225">Эта конфигурация представлена следующая диаграмма Hello:</span><span class="sxs-lookup"><span data-stu-id="dff6c-225">hello following diagram illustrates this configuration:</span></span>

![Иллюстрация нескольких виртуальных IP-адресов](./media/load-balancer-multivip-overview/load-balancer-multivip-dsr.png)

<span data-ttu-id="dff6c-227">В этом сценарии каждой виртуальной Машины в hello внутренний пул имеет три сетевых интерфейсов:</span><span class="sxs-lookup"><span data-stu-id="dff6c-227">For this scenario, every VM in hello backend pool has three network interfaces:</span></span>

* <span data-ttu-id="dff6c-228">DIP: виртуального сетевого Адаптера связанные с hello виртуальной Машины (IP-конфигурации Сетевых ресурсов Azure)</span><span class="sxs-lookup"><span data-stu-id="dff6c-228">DIP: a Virtual NIC associated with hello VM (IP configuration of Azure's NIC resource)</span></span>
* <span data-ttu-id="dff6c-229">VIP1: интерфейс замыкания на себя в гостевой ОС, настроенной с IP-адресом VIP1.</span><span class="sxs-lookup"><span data-stu-id="dff6c-229">VIP1: a loopback interface within guest OS that is configured with IP address of VIP1</span></span>
* <span data-ttu-id="dff6c-230">VIP2: интерфейс замыкания на себя в гостевой ОС, настроенной с IP-адресом VIP2.</span><span class="sxs-lookup"><span data-stu-id="dff6c-230">VIP2: a loopback interface within guest OS that is configured with IP address of VIP2</span></span>

> [!IMPORTANT]
> <span data-ttu-id="dff6c-231">Настройка Hello логических интерфейсов hello выполняется внутри hello гостевой ОС.</span><span class="sxs-lookup"><span data-stu-id="dff6c-231">hello configuration of hello logical interfaces is performed within hello guest OS.</span></span> <span data-ttu-id="dff6c-232">Эта настройка не выполняется и не управляется Azure.</span><span class="sxs-lookup"><span data-stu-id="dff6c-232">This configuration is not performed or managed by Azure.</span></span> <span data-ttu-id="dff6c-233">Без такой настройки правил hello не будет работать.</span><span class="sxs-lookup"><span data-stu-id="dff6c-233">Without this configuration, hello rules will not function.</span></span> <span data-ttu-id="dff6c-234">Использовать hello DIP для виртуальной Машины hello зонд определения работоспособности вместо hello логических виртуальных IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="dff6c-234">Health probe definitions use hello DIP of hello VM rather than hello logical VIP.</span></span> <span data-ttu-id="dff6c-235">Таким образом службы необходимо предоставить проверки ответов на порту DIP, который отражает состояние hello hello службы, предлагаемой на hello логических виртуальных IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="dff6c-235">Therefore, your service must provide probe responses on a DIP port that reflect hello status of hello service offered on hello logical VIP.</span></span>

<span data-ttu-id="dff6c-236">Предположим, что hello же конфигурацию внешнего интерфейса, как в предыдущем сценарии hello:</span><span class="sxs-lookup"><span data-stu-id="dff6c-236">Let's assume hello same frontend configuration as in hello previous scenario:</span></span>

| <span data-ttu-id="dff6c-237">Виртуальный IP-адрес</span><span class="sxs-lookup"><span data-stu-id="dff6c-237">VIP</span></span> | <span data-ttu-id="dff6c-238">IP-адрес</span><span class="sxs-lookup"><span data-stu-id="dff6c-238">IP address</span></span> | <span data-ttu-id="dff6c-239">protocol</span><span class="sxs-lookup"><span data-stu-id="dff6c-239">protocol</span></span> | <span data-ttu-id="dff6c-240">порт</span><span class="sxs-lookup"><span data-stu-id="dff6c-240">port</span></span> |
| --- | --- | --- | --- |
| ![Виртуальный IP-адрес](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="dff6c-242">1</span><span class="sxs-lookup"><span data-stu-id="dff6c-242">1</span></span> |<span data-ttu-id="dff6c-243">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="dff6c-243">65.52.0.1</span></span> |<span data-ttu-id="dff6c-244">TCP</span><span class="sxs-lookup"><span data-stu-id="dff6c-244">TCP</span></span> |<span data-ttu-id="dff6c-245">80</span><span class="sxs-lookup"><span data-stu-id="dff6c-245">80</span></span> |
| ![Виртуальный IP-адрес](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="dff6c-247">2</span><span class="sxs-lookup"><span data-stu-id="dff6c-247">2</span></span> |<span data-ttu-id="dff6c-248">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="dff6c-248">*65.52.0.2*</span></span> |<span data-ttu-id="dff6c-249">TCP</span><span class="sxs-lookup"><span data-stu-id="dff6c-249">TCP</span></span> |<span data-ttu-id="dff6c-250">80</span><span class="sxs-lookup"><span data-stu-id="dff6c-250">80</span></span> |

<span data-ttu-id="dff6c-251">Мы определим два правила:</span><span class="sxs-lookup"><span data-stu-id="dff6c-251">We define two rules:</span></span>

| <span data-ttu-id="dff6c-252">правило;</span><span class="sxs-lookup"><span data-stu-id="dff6c-252">Rule</span></span> | <span data-ttu-id="dff6c-253">Сопоставить внешний интерфейс</span><span class="sxs-lookup"><span data-stu-id="dff6c-253">Map frontend</span></span> | <span data-ttu-id="dff6c-254">toobackend пула</span><span class="sxs-lookup"><span data-stu-id="dff6c-254">toobackend pool</span></span> |
| --- | --- | --- |
| <span data-ttu-id="dff6c-255">1</span><span class="sxs-lookup"><span data-stu-id="dff6c-255">1</span></span> |![правило;](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="dff6c-257">VIP1:80</span><span class="sxs-lookup"><span data-stu-id="dff6c-257">VIP1:80</span></span> |![серверная часть](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="dff6c-259">VIP1:80 (на виртуальной машине 1 и виртуальной машине 2)</span><span class="sxs-lookup"><span data-stu-id="dff6c-259">VIP1:80 (in VM1 and VM2)</span></span> |
| <span data-ttu-id="dff6c-260">2</span><span class="sxs-lookup"><span data-stu-id="dff6c-260">2</span></span> |![правило;](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="dff6c-262">VIP2:80</span><span class="sxs-lookup"><span data-stu-id="dff6c-262">VIP2:80</span></span> |![серверная часть](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="dff6c-264">VIP2:80 (на виртуальной машине 1 и виртуальной машине 2)</span><span class="sxs-lookup"><span data-stu-id="dff6c-264">VIP2:80 (in VM1 and VM2)</span></span> |

<span data-ttu-id="dff6c-265">Привет, в следующей таблице показано сопоставление завершения hello в hello подсистемы балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="dff6c-265">hello following table shows hello complete mapping in hello load balancer:</span></span>

| <span data-ttu-id="dff6c-266">правило;</span><span class="sxs-lookup"><span data-stu-id="dff6c-266">Rule</span></span> | <span data-ttu-id="dff6c-267">Виртуальный IP-адрес (VIP)</span><span class="sxs-lookup"><span data-stu-id="dff6c-267">VIP IP address</span></span> | <span data-ttu-id="dff6c-268">protocol</span><span class="sxs-lookup"><span data-stu-id="dff6c-268">protocol</span></span> | <span data-ttu-id="dff6c-269">порт</span><span class="sxs-lookup"><span data-stu-id="dff6c-269">port</span></span> | <span data-ttu-id="dff6c-270">Место назначения</span><span class="sxs-lookup"><span data-stu-id="dff6c-270">Destination</span></span> | <span data-ttu-id="dff6c-271">порт</span><span class="sxs-lookup"><span data-stu-id="dff6c-271">port</span></span> |
| --- | --- | --- | --- | --- | --- |
| ![Виртуальный IP-адрес](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="dff6c-273">1</span><span class="sxs-lookup"><span data-stu-id="dff6c-273">1</span></span> |<span data-ttu-id="dff6c-274">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="dff6c-274">65.52.0.1</span></span> |<span data-ttu-id="dff6c-275">TCP</span><span class="sxs-lookup"><span data-stu-id="dff6c-275">TCP</span></span> |<span data-ttu-id="dff6c-276">80</span><span class="sxs-lookup"><span data-stu-id="dff6c-276">80</span></span> |<span data-ttu-id="dff6c-277">совпадает с виртуальным IP-адресом (65.52.0.1)</span><span class="sxs-lookup"><span data-stu-id="dff6c-277">same as VIP (65.52.0.1)</span></span> |<span data-ttu-id="dff6c-278">совпадает с виртуальным IP-адресом (80)</span><span class="sxs-lookup"><span data-stu-id="dff6c-278">same as VIP (80)</span></span> |
| ![Виртуальный IP-адрес](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="dff6c-280">2</span><span class="sxs-lookup"><span data-stu-id="dff6c-280">2</span></span> |<span data-ttu-id="dff6c-281">65.52.0.2</span><span class="sxs-lookup"><span data-stu-id="dff6c-281">65.52.0.2</span></span> |<span data-ttu-id="dff6c-282">TCP</span><span class="sxs-lookup"><span data-stu-id="dff6c-282">TCP</span></span> |<span data-ttu-id="dff6c-283">80</span><span class="sxs-lookup"><span data-stu-id="dff6c-283">80</span></span> |<span data-ttu-id="dff6c-284">совпадает с виртуальным IP-адресом (65.52.0.2)</span><span class="sxs-lookup"><span data-stu-id="dff6c-284">same as VIP (65.52.0.2)</span></span> |<span data-ttu-id="dff6c-285">совпадает с виртуальным IP-адресом (80)</span><span class="sxs-lookup"><span data-stu-id="dff6c-285">same as VIP (80)</span></span> |

<span data-ttu-id="dff6c-286">Назначение Hello hello входящего потока является адрес hello виртуальных IP-адресов через интерфейс замыкания на себя hello hello виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="dff6c-286">hello destination of hello inbound flow is hello VIP address on hello loopback interface in hello VM.</span></span> <span data-ttu-id="dff6c-287">Каждое правило должно создавать поток с уникальным сочетанием конечного IP-адреса и конечного порта.</span><span class="sxs-lookup"><span data-stu-id="dff6c-287">Each rule must produce a flow with a unique combination of destination IP address and destination port.</span></span> <span data-ttu-id="dff6c-288">Различные hello конечный IP-адрес потока hello повторное использование портов можно использовать на hello одной виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="dff6c-288">By varying hello destination IP address of hello flow, port reuse is possible on hello same VM.</span></span> <span data-ttu-id="dff6c-289">Служба балансировки нагрузки без поддержки toohello становится, привязав его IP-адрес и порт hello соответствующих замыкания на себя интерфейса toohello виртуальный IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="dff6c-289">Your service is exposed toohello load balancer by binding it toohello VIP’s IP address and port of hello respective loopback interface.</span></span>

<span data-ttu-id="dff6c-290">Обратите внимание, что в этом примере не изменяет порт назначения hello.</span><span class="sxs-lookup"><span data-stu-id="dff6c-290">Notice that this example does not change hello destination port.</span></span> <span data-ttu-id="dff6c-291">Несмотря на то, что это сценарий плавающий IP-адрес подсистемы балансировки нагрузки Azure также поддерживает определение правила toorewrite hello внутренний конечный порт и toomake отличный от hello интерфейсный порт назначения.</span><span class="sxs-lookup"><span data-stu-id="dff6c-291">Even though this is a Floating IP scenario, Azure Load Balancer also supports defining a rule toorewrite hello backend destination port and toomake it different from hello frontend destination port.</span></span>

<span data-ttu-id="dff6c-292">Hello тип правила плавающий IP-адрес — hello foundation из нескольких шаблонов конфигурации подсистемы балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="dff6c-292">hello Floating IP rule type is hello foundation of several load balancer configuration patterns.</span></span> <span data-ttu-id="dff6c-293">Одним из примеров, доступных в настоящее время является hello [SQL AlwaysOn с помощью нескольких прослушивателей](../virtual-machines/windows/sql/virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md) конфигурации.</span><span class="sxs-lookup"><span data-stu-id="dff6c-293">One example that is currently available is hello [SQL AlwaysOn with Multiple Listeners](../virtual-machines/windows/sql/virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md) configuration.</span></span> <span data-ttu-id="dff6c-294">В будущем мы опишем больше сценариев.</span><span class="sxs-lookup"><span data-stu-id="dff6c-294">Over time, we will document more of these scenarios.</span></span>

## <a name="limitations"></a><span data-ttu-id="dff6c-295">Ограничения</span><span class="sxs-lookup"><span data-stu-id="dff6c-295">Limitations</span></span>

* <span data-ttu-id="dff6c-296">Конфигурации с несколькими виртуальными IP-адресами поддерживаются только при использовании виртуальных машин IaaS.</span><span class="sxs-lookup"><span data-stu-id="dff6c-296">Multiple VIP configurations are only supported with IaaS VMs.</span></span>
* <span data-ttu-id="dff6c-297">С правилом hello плавающий IP-адрес приложение должно использовать hello DIP-адрес для исходящих потоков.</span><span class="sxs-lookup"><span data-stu-id="dff6c-297">With hello Floating IP rule, your application must use hello DIP for outbound flows.</span></span> <span data-ttu-id="dff6c-298">Если приложение связывает toohello виртуальный IP-адрес, настроенный в интерфейсе hello замыкания на себя в hello гостевой ОС, затем SNAT не доступные toorewrite hello исходящего потока и потока hello выходит из строя.</span><span class="sxs-lookup"><span data-stu-id="dff6c-298">If your application binds toohello VIP address configured on hello loopback interface in hello guest OS, then SNAT is not available toorewrite hello outbound flow and hello flow fails.</span></span>
* <span data-ttu-id="dff6c-299">Общедоступные IP-адреса оказывают влияние на выставление счетов.</span><span class="sxs-lookup"><span data-stu-id="dff6c-299">Public IP addresses have an effect on billing.</span></span> <span data-ttu-id="dff6c-300">Дополнительные сведения см. в статье [Цены на IP-адреса](https://azure.microsoft.com/pricing/details/ip-addresses/).</span><span class="sxs-lookup"><span data-stu-id="dff6c-300">For more information, see [IP Address pricing](https://azure.microsoft.com/pricing/details/ip-addresses/)</span></span>
* <span data-ttu-id="dff6c-301">Действуют ограничения подписки.</span><span class="sxs-lookup"><span data-stu-id="dff6c-301">Subscription limits apply.</span></span> <span data-ttu-id="dff6c-302">Дополнительные сведения см. в разделе [Ограничения определенных служб](../azure-subscription-service-limits.md#networking-limits).</span><span class="sxs-lookup"><span data-stu-id="dff6c-302">For more information, see [Service limits](../azure-subscription-service-limits.md#networking-limits) for details.</span></span>
