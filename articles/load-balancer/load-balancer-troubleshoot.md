---
title: "Подсистема балансировки нагрузки Azure aaaTroubleshoot | Документы Microsoft"
description: "Устранение известных неполадок Azure Load Balancer"
services: load-balancer
documentationcenter: na
author: RamanDhillon
manager: timlt
editor: 
ms.assetid: 
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 07/10/2017
ms.author: kumud
ms.openlocfilehash: 56b73fcbf0bbf18cedfd113a280cfafa2a3dc9f3
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="troubleshoot-azure-load-balancer"></a>Устранение неполадок Azure Load Balancer

На этой странице представлены сведения об устранении распространенных неполадок Azure Load Balancer. При недоступности hello подключение подсистемы балансировки нагрузки, наиболее распространенные симптомы hello, следующим образом: 
- Виртуальные машины позади подсистемы балансировки нагрузки не отвечать на запросы проверки toohealth hello 
- Виртуальные машины за hello балансировки нагрузки не отвечают toohello трафик через порт настроен hello

## <a name="symptom-vms-behind-hello-load-balancer-are-not-responding-toohealth-probes"></a>Симптом: Виртуальные машины позади подсистемы балансировки нагрузки не отвечать на запросы проверки toohealth hello
Hello tooparticipate серверов базы данных в наборе балансировки нагрузки hello они прошла проверку пробы hello. Дополнительные сведения о пробах работоспособности см. в статье [Проверки балансировщика нагрузки](load-balancer-custom-probe-overview.md). 

внутренний пул подсистемы балансировки нагрузки Hello ВМ не отвечает зонды toohello из-за tooany hello следующих причин: 
- Виртуальная машина внутреннего пула подсистемы балансировки нагрузки неработоспособна. 
- Виртуальная машина не прослушивает порт пробы hello внутреннего пула подсистемы балансировки нагрузки 
- Брандмауэр или группу сетевой безопасности блокирует порт hello на hello внутреннего пула подсистемы балансировки нагрузки виртуальных машин 
- Другие неправильные настройки в подсистеме балансировки нагрузки.

### <a name="cause-1-load-balancer-backend-pool-vm-is-unhealthy"></a>Причина 1: виртуальная машина внутреннего пула подсистемы балансировки нагрузки неработоспособна 

**Проверка и способы устранения**

tooresolve эту проблему, войдите в систему toohello участия виртуальные машины и проверьте, является ли hello состояние виртуальной Машины в работоспособном состоянии и не сможет ответить слишком**PsPing** или **TCPing** из другой виртуальной Машиной в пуле hello. Если hello виртуальной Машины находится в неисправном состоянии, или не удается toorespond toohello проверки, необходимо устранить проблему hello и получить hello виртуальной Машины обратно tooa работоспособное состояние до ее включения в балансировки нагрузки.

### <a name="cause-2-load-balancer-backend-pool-vm-is-not-listening-on-hello-probe-port"></a>Причина 2: Внутренний пул подсистемы балансировки нагрузки виртуальной Машины не прослушивает порт пробы hello
Если hello виртуальная машина находится в работоспособном состоянии, но не отвечает toohello пробы, одна из возможных причин может быть hello порт пробы не открыт на участие ВМ hello, или hello виртуальной Машины не прослушивает этот порт.

**Проверка и способы устранения**

1. Войдите в серверном toohello виртуальной Машины. 
2. Откройте командную строку и выполните следующие команды toovalidate есть приложение прослушивает порт пробы hello hello:   
            netstat -an
3. Если состояние hello порт не указан в качестве **ПРОСЛУШИВАЕТ**, настройте hello соответствующим номерам портов. 
4. Можно также выбрать другой порт, который находится в состоянии **Ожидает вызова**, и соответствующим образом обновить конфигурацию подсистемы балансировки нагрузки.              

###<a name="cause-3-firewall-or-a-network-security-group-is-blocking-hello-port-on-hello-load-balancer-backend-pool-vms"></a>Причина 3: Брандмауэр или группы безопасности сети блокирует порт hello hello пула серверной части подсистемы балансировки нагрузки виртуальных машин  
Если межсетевой экран приветствия на hello ВМ блокирует порт пробы hello или одну или несколько групп безопасности сети, настроенным в подсети hello, или на hello виртуальной Машины, не разрешает порт hello tooreach пробы hello, hello виртуальной Машины — проверки работоспособности не удается toorespond toohello.          

**Проверка и способы устранения**

* Если включен брандмауэр hello, проверьте, если он настроен порт пробы tooallow hello. В противном случае настройте hello брандмауэра tooallow трафика на порт пробы hello и повторите проверку. 
* Из списка hello групп безопасности сети установите флажок, если hello входящего и исходящего трафика на порт пробы hello помех. 
* Кроме того, проверьте, если **Deny All** групп сетевой безопасности правило на сетевой Адаптер из виртуальной Машины hello hello или hello подсети, которая имеет более высокий приоритет, чем правило по умолчанию hello, которое разрешает балансировки Нагрузки проб & трафик (Сетевые группы безопасности должны разрешать IP адрес подсистемы балансировки нагрузки 168.63.129.16). 
* Если любой из этих правил блокируют трафик проверки hello, удалите и повторно настройте hello правила tooallow hello выборки трафика.  
* Проверьте, если hello виртуальной Машины сейчас запущена отвечать на запросы проверки работоспособности toohello. 

### <a name="cause-4-other-misconfigurations-in-load-balancer"></a>Причина 4: другие неправильные настройки в подсистеме балансировки нагрузки
Если все hello выше причин показаться toobe проверяются и обработаны правильно и внутренних hello виртуальной Машины по-прежнему не отвечает toohello проверки работоспособности, а затем вручную проверки подключения и собирать некоторые трассировки toounderstand hello подключения.

**Проверка и способы устранения**

* Используйте **Psping** из какого-либо hello других виртуальных машин в пределах hello порт пробы ответа для виртуальной сети tootest hello (пример: 10.0.0.4:3389.\psping.exe -t) и записать результаты. 
* Используйте **TCPing** из какого-либо hello других виртуальных машин в пределах hello порт пробы ответа для виртуальной сети tootest hello (пример:.\tcping.exe 10.0.0.4 3389) и записать результаты. 
* Если в результате этих проверок связи ответ не получен, то выполните следующие действия:
    - Запустите одновременных Netsh трассировки на hello целевой внутренний пул виртуальных Машин и еще один тест виртуальной Машины из hello же виртуальной сети. Теперь выполнение теста PsPing некоторое время, собрать некоторые трассировки сети, а затем остановите hello теста. 
    - Проанализируйте записи сетевого трафика hello и есть ли оба запроса ping связанные toohello входящих и исходящих пакетов. 
        - Входящие пакеты не наблюдаются на hello внутреннего пула виртуальных Машин, существует ли потенциально Сетевые группы безопасности или блокирующие трафик hello UDR неправильная конфигурация. 
        - Если нет исходящих пакетов наблюдаются на hello внутреннего пула виртуальных Машин, hello виртуальной Машины должен toobe проверка несвязанных проблемы с (eample порт пробы hello блокировки приложения). 
    - Проверьте, если приветственных пакетов проверки выполняется принудительный tooanother назначения (возможно с помощью параметров UDR) до достижения hello подсистемы балансировки нагрузки. Это может привести к серверной hello трафика toonever reach hello виртуальной Машины. 
* Измените тип проверки hello (например, HTTP tooTCP) и настроить соответствующий порт hello в группах безопасности сети списки управления доступом и toovalidate брандмауэра, если hello проблема связана с конфигурацией hello ответа. Дополнительные сведения о настройке проб работоспособности см. в записи блога [Endpoint Load Balancing Heath Probe Configuration Details](https://blogs.msdn.microsoft.com/mast/2016/01/26/endpoint-load-balancing-heath-probe-configuration-details/) (Сведения о настройке проб работоспособности балансировки нагрузки для конечных точек).

## <a name="symptom-vms-behind-load-balancer-are-not-responding-tootraffic-on-hello-configured-data-port"></a>Симптом: Виртуальных машин за подсистемой балансировки нагрузки не отвечают tootraffic на порту данных настроен hello

Если внутреннего пула виртуальных Машин, указана как работоспособное и отвечает toohello проверках работоспособности, но по-прежнему не участвует в hello балансировки нагрузки или не отвечает toohello трафик, возможно, из-за tooany из hello следующих причин: 
* Загрузить балансировки внутреннего пула, который виртуальная машина не прослушивает порт данных hello 
* Сетевая группа безопасности блокирует порт hello на hello внутреннего пула подсистемы балансировки нагрузки виртуальной Машины  
* Доступ к hello балансировки нагрузки из hello одной виртуальной Машины и сетевых Адаптеров 
* Доступ к hello VIP-адрес подсистемы балансировки нагрузки Интернет из hello участия внутреннего пула подсистемы балансировки нагрузки виртуальной Машины 

### <a name="cause-1-load-balancer-backend-pool-vm-is-not-listening-on-hello-data-port"></a>Причина 1: Внутренний пул подсистемы балансировки нагрузки виртуальной Машины не прослушивает порт данных hello 
Если виртуальная машина не отвечает toohello трафик, возможно, так как либо hello целевой порт не открыт на hello участия виртуальной Машины, либо hello виртуальной Машины не прослушивает этот порт. 

**Проверка и способы устранения**

1. Войдите в серверном toohello виртуальной Машины. 
2. Откройте командную строку и выполните следующие команды toovalidate прослушивания по порту данных hello приложения hello:  
            netstat -an 
3. Если не указан порт hello с состоянием «ПРОСЛУШИВАЕТСЯ», настройте hello правильную прослушивающий порт 
4. Если порт hello отмечен как ожидающий, проверьте целевое приложение hello на этом порте все возможные причины этой проблемы. 

### <a name="cause-2-network-security-group-is-blocking-hello-port-on-hello-load-balancer-backend-pool-vm"></a>Причина 2: Группы безопасности сети блокирует порт hello hello внутреннего пула подсистемы балансировки нагрузки виртуальной Машины  

Если один или несколько сетевых групп безопасности, настроенным в подсети hello, или на hello виртуальной Машины, блокирует hello исходный IP-адрес или порт, то hello виртуальной Машины будет невозможно toorespond.

* Список групп безопасности сети hello, настроенных на серверной hello виртуальной Машины. Дополнительные сведения можно найти в разделе 
    -  [Управление группами безопасности сети с помощью портала hello](../virtual-network/virtual-network-manage-nsg-arm-portal.md)
    -  [Управление группами безопасности сети с помощью PowerShell](../virtual-network/virtual-network-manage-nsg-arm-ps.md)
* Из списка hello групп безопасности сети Проверьте, если:
    - Hello входящий и исходящий трафик через порт hello данных имеет помех. 
    - **Deny All** правило группы безопасности сети на hello сетевого Адаптера для подсети виртуальной Машины или hello hello, которая имеет более высокий приоритет этого правила по умолчанию hello и позволяющая зондов подсистемы балансировки нагрузки и трафик (Сетевые группы безопасности должны разрешать IP адрес подсистемы балансировки нагрузки 168.63.129.16, порт пробы) 
* Если ни одному из правил hello блокируют трафик hello, удалить и настроить эти правила tooallow hello трафика.  
* Протестируйте при проверках работоспособности toohello toorespond теперь запущен hello виртуальной Машины.

### <a name="cause-3-accessing-hello-load-balancer-from-hello-same-vm-and-network-interface"></a>Причина 3: Доступ к hello балансировки нагрузки из hello же интерфейс виртуальной Машины и сети 

Если приложение, размещенных в серверном hello виртуальная машина подсистемы балансировки нагрузки пытается tooaccess другое приложение, размещенное в hello один внутренний виртуальной Машины через hello одной сети интерфейсом, он не поддерживается и не удастся. 

**Разрешение** можно устранить эту проблему, через одну из следующих методов hello:
* Настройте для каждого приложения отдельные виртуальные машины внутреннего пула. 
* Настройте приложения hello в двух сетевых Адаптеров виртуальных машин, чтобы каждое приложение используется собственный IP-адреса и сетевого интерфейса. 

### <a name="cause-4-accessing-hello-internal-load-balancer-vip-from-hello-participating-load-balancer-backend-pool-vm"></a>Причина 4: Доступ к hello внутренней VIP подсистемы балансировки нагрузки из hello участия внутреннего пула подсистемы балансировки нагрузки виртуальной Машины

Если ILB виртуальный IP-адрес настроен внутри виртуальной сети, и один из участников серверной hello виртуальных машин пытается tooaccess hello внутренней нагрузки подсистемы балансировки виртуального IP-адреса, которое привело к сбою. Этот сценарий не поддерживается.
**Разрешение** оценки шлюзом приложений или другие учетные записи-посредники (например, nginx или haproxy) toosupport такая сценария. Дополнительные сведения о шлюзе приложений см. в статье [Обзор шлюза приложений](../application-gateway/application-gateway-introduction.md).

## <a name="additional-network-captures"></a>Запись дополнительных сетевых данных
Если вы решите tooopen обращение в службу поддержки, собирать следующую информацию для ускорения разрешения hello. Выберите hello tooperform виртуальной Машины одной базы данных, следующих тестов:
- Используйте Psping, из какого-либо внутреннего hello виртуальных машин в пределах hello порт пробы ответа для виртуальной сети tootest hello (пример: psping 10.0.0.4:3389) и записать результаты. 
- Использовать TCPing из какого-либо внутреннего hello виртуальных машин в пределах hello порт пробы ответа для виртуальной сети tootest hello (пример: psping 10.0.0.4:3389) и записать результаты.
- Если не получен ответ в этих тестах ping, запустите одновременных Netsh trace серверную часть hello виртуальной Машины и hello тестовой виртуальной сети виртуальной Машины во время выполнения PsPing, а затем остановите hello Netsh trace. 
  
## <a name="next-steps"></a>Дальнейшие действия

Если hello описанные выше шаги не решат проблему hello, откройте [обращение в службу поддержки](https://azure.microsoft.com/support/options/).

