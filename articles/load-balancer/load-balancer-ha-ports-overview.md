---
title: "Общие сведения о портах с высоким уровнем доступности в Azure | Документация Майкрософт"
description: "Сведения о распределении нагрузки на портах с высоким уровнем доступности во внутренней подсистеме балансировки нагрузки."
services: load-balancer
documentationcenter: na
author: rdhillon
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 46b152c5-6a27-4bfc-bea3-05de9ce06a57
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/26/2017
ms.author: kumud
ms.openlocfilehash: 46e284d1636988390f3533d93bfd07399f45dc92
ms.sourcegitcommit: 42ee5ea09d9684ed7a71e7974ceb141d525361c9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/09/2017
---
# <a name="high-availability-ports-overview"></a>Общие сведения о портах с высоким уровнем доступности

Azure Load Balancer уровня "Стандартный" помогает одновременно распределять нагрузку потоков TCP и UDP на всех портах при использовании внутренней подсистемы балансировки нагрузки. 

>[!NOTE]
> Компонент "Порты с высоким уровнем доступности" доступен в Load Balancer уровня "Стандартный" в режиме предварительной версии. В период действия предварительной версии этот компонент может не отличаться таким же уровнем доступности и надежности, как компоненты, предоставляемые в общедоступной версии. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/). Чтобы использовать порты с высоким уровнем доступности с ресурсами службы Load Balancer уровня "Стандартный", зарегистрируйтесь для получения предварительной версии этой службы. Чтобы зарегистрироваться для использования Load Balancer уровня "Стандартный", следуйте инструкциям из раздела [Регистрация в предварительной версии](https://aka.ms/lbpreview#preview-sign-up).

Правило балансировки нагрузки портов с высоким уровнем доступности является разновидностью правила балансировки нагрузки, настроенного во внутренней службе Load Balancer уровня "Стандартный". Чтобы упростить использование Load Balancer, укажите единое правило распределения нагрузки для всех потоков TCP и UDP, поступающих на все порты внутренней службы Load Balancer уровня "Стандартный". Решение о распределении нагрузки принимается отдельно для каждого потока. Решение принимается с учетом пяти кортежей: исходного IP-адреса, исходного порта, целевого IP-адреса, целевого порта и протокола.

Порты с высоким уровнем доступности помогают в критически важных сценариях. Например, они обеспечивают высокий уровень доступности и масштабирование для виртуальных сетевых модулей в виртуальных сетях. Они также позволяют распределять нагрузку между большим количеством портов. 

Чтобы настроить компонент портов с высоким уровнем доступности, выберите для серверного и интерфейсного портов значение **0**, а для протокола укажите значение **Все**. После этого внутренний ресурс Load Balancer будет распределять все потоки TCP и UDP независимо от номера порта.

## <a name="why-use-ha-ports"></a>Зачем использовать порты с высоким уровнем доступности

### <a name="nva"></a>Виртуальные сетевые модули

Виртуальные сетевые модули можно использовать для защиты рабочей нагрузки Azure от различных угроз безопасности. Виртуальные сетевые модули, используемые в таких сценариях, должны быть надежными, высокодоступными и масштабируемыми по требованию.

Для этого добавьте экземпляры виртуальных сетевых модулей в серверный пул внутренней службы Azure Load Balancer и настройте правило распределения нагрузки на портах с высоким уровнем доступности.

Порты с высоким уровнем доступности обеспечивают ряд преимуществ для сценариев с виртуальными сетевыми модулями высокой доступности:
- быстрое выполнение отработки отказа в работоспособные экземпляры с выполнением проверок работоспособности для каждого экземпляра;
- более высокая производительность с горизонтальным масштабированием до *n* активных экземпляров;
- сценарии "*N* активных" и "активный — пассивный";
- устранение необходимости в сложных решениях, например в использовании узлов Apache ZooKeeper для мониторинга модулей.

На следующей схеме представлено развертывание виртуальной сети со звездообразным подключением. "Лучи" принудительно туннелируют свой трафик в центральную виртуальную сеть и через виртуальный сетевой модуль перед выходом из доверенного пространства. Виртуальные сетевые модули находятся за внутренней службой Load Balancer уровня "Стандартный" с конфигурацией портов с высоким уровнем доступности. Весь трафик может обрабатываться и перенаправляться соответствующим образом.

![Схема виртуальной сети со звездообразным подключением и сетевыми виртуальными модулями в режиме высокой доступности](./media/load-balancer-ha-ports-overview/nvaha.png)

>[!NOTE]
> Если вы используете виртуальные сетевые модули, узнайте у соответствующего поставщика, как лучше всего использовать порты высокого уровня доступности и какие сценарии поддерживаются.

### <a name="load-balancing-large-numbers-of-ports"></a>Балансировка нагрузки для большого количества портов

Можно также использовать порты с высоким уровнем доступности для приложений, требующих распределения нагрузки между большим количеством портов. Эти сценарии можно упростить при помощи внутренней службы [Load Balancer уровня "Стандартный"](https://aka.ms/lbpreview) с портами с высоким уровнем доступности. Единое правило распределения нагрузки заменяет несколько отдельных правил для каждого порта балансировки нагрузки.

## <a name="region-availability"></a>Регионы доступности

Порты с высоким уровнем доступности доступны в [тех же регионах, что и Load Balancer уровня "Стандартный"](https://aka.ms/lbpreview#region-availability).  

## <a name="preview-sign-up"></a>Регистрация в предварительной версии

Чтобы использовать предварительную версию компонента "Порты с высоким уровнем доступности" в Load Balancer уровня "Стандартный", зарегистрируйте свою подписку для использования Load Balancer уровня ["Стандартный" (предварительная версия)](https://aka.ms/lbpreview#preview-sign-up). Это можно сделать с помощью Azure CLI 2.0 или PowerShell.

>[!NOTE]
>Регистрация занимает не более часа.

## <a name="limitations"></a>Ограничения

Ниже приведены поддерживаемые конфигурации и исключения для портов с высоким уровнем доступности.

- Настройки единого интерфейса IP может иметь один Direct Server Return (DSR - плавающий IP-адрес в Azure) загрузить правило балансировки с портами высокого уровня ДОСТУПНОСТИ, или он может иметь один не DSR правило подсистемы балансировки нагрузки с портами высокого уровня ДОСТУПНОСТИ. Оба правила применить невозможно.
- Отдельная IP-конфигурация сетевого интерфейса может иметь только одно правило подсистемы балансировки нагрузки без прямого ответа от сервера и с портами с высоким уровнем доступности. Для этой IP-конфигурации нельзя настроить другие правила.
- Отдельная IP-конфигурация сетевого интерфейса может иметь одно или несколько правил подсистемы балансировки нагрузки с прямым ответом от сервера и портами с высоким уровнем доступности при условии, что все соответствующие интерфейсные IP-конфигурации являются уникальными.
- Если во всех правилах балансировки нагрузки используются порты с высоким уровнем доступности (только с прямым ответом от сервера), могут параллельно существовать два (или более) правила Load Balancer, указывающих на один серверный пул. Та же ситуация возможна, если все правила не используют порты с высоким уровнем доступности (с прямым ответом от сервера или без). Два правила балансировки нагрузки, которые используют разные типы портов (с высоким уровнем доступности или без), не могут существовать параллельно.
- Порты с высоким уровнем доступности недоступны для IPv6.
- Симметрия потока для сценариев виртуальных сетевых модулей поддерживается только одним сетевым интерфейсом. См. описание и схему [виртуальных сетевых модулей](#nva). 



## <a name="next-steps"></a>Дальнейшие действия

- [Настройка высокодоступных портов для внутреннего балансировщика нагрузки](load-balancer-configure-ha-ports.md)
- [Обзор Azure Load Balancer уровня "Стандартный" (предварительная версия)](https://aka.ms/lbpreview)

