---
title: "Отладка облачной службы или виртуальной машины Azure в Visual Studio | Документация Майкрософт"
description: "Отладка облачной службы или виртуальной машины в Visual Studio"
services: visual-studio-online
documentationcenter: na
author: kraigb
manager: ghogen
editor: 
ms.assetid: 945e06e0-2100-41af-b218-72347367ddab
ms.service: visual-studio-online
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: multiple
ms.workload: na
ms.date: 11/11/2016
ms.author: kraigb
ms.openlocfilehash: 2ea3a9d6b3bdd873c139064b3c400eff5977eda4
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="debugging-an-azure-cloud-service-or-virtual-machine-in-visual-studio"></a><span data-ttu-id="4d430-103">Отладка облачной службы или виртуальной машины Azure в Visual Studio</span><span class="sxs-lookup"><span data-stu-id="4d430-103">Debugging an Azure cloud service or virtual machine in Visual Studio</span></span>
<span data-ttu-id="4d430-104">Visual Studio предоставляет разнообразные варианты отладки облачных служб и виртуальных машин Azure.</span><span class="sxs-lookup"><span data-stu-id="4d430-104">Visual Studio gives you different options for debugging Azure cloud services and virtual machines.</span></span>

## <a name="debug-your-cloud-service-on-your-local-computer"></a><span data-ttu-id="4d430-105">Отладка облачной службы на локальном компьютере</span><span class="sxs-lookup"><span data-stu-id="4d430-105">Debug your cloud service on your local computer</span></span>
<span data-ttu-id="4d430-106">Вы можете сэкономить время и деньги, воспользовавшись эмулятором вычислений Azure для отладки облачной службы на локальном компьютере.</span><span class="sxs-lookup"><span data-stu-id="4d430-106">You can save time and money by using the Azure compute emulator to debug your cloud service on a local machine.</span></span> <span data-ttu-id="4d430-107">Посредством локальной отладки службы перед ее развертыванием можно повысить надежность и производительность службы, не платя за время использования вычислительных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="4d430-107">By debugging a service locally before you deploy it, you can improve reliability and performance without paying for compute time.</span></span> <span data-ttu-id="4d430-108">Однако некоторые ошибки могут возникнуть только при запуске облачной службы непосредственно в среде Azure.</span><span class="sxs-lookup"><span data-stu-id="4d430-108">However, some errors might occur only when you run a cloud service in Azure itself.</span></span> <span data-ttu-id="4d430-109">Эти ошибки можно устранить, если включить удаленную отладку при публикации службы, а затем подключить отладчик к экземпляру роли.</span><span class="sxs-lookup"><span data-stu-id="4d430-109">You can debug these errors if you enable remote debugging when you publish your service and then attach the debugger to a role instance.</span></span>

<span data-ttu-id="4d430-110">Эмулятор имитирует службу вычислений Azure и выполняется в локальной среде, благодаря чему можно осуществить тестирование и отладку облачной службы перед ее развертыванием.</span><span class="sxs-lookup"><span data-stu-id="4d430-110">The emulator simulates the Azure Compute service and runs in your local environment so that you can test and debug your cloud service before you deploy it.</span></span> <span data-ttu-id="4d430-111">Эмулятор обрабатывает жизненный цикл экземпляров ролей и предоставляет доступ к имитируемым ресурсам, таким как локальное хранилище.</span><span class="sxs-lookup"><span data-stu-id="4d430-111">The emulator handles the lifecycle of your role instances and provides access to simulated resources, such as local storage.</span></span> <span data-ttu-id="4d430-112">При отладке или запуске службы в системе Visual Studio она автоматически запускает эмулятор в качестве фонового приложения, а затем выполняет развертывание службы в эмуляторе.</span><span class="sxs-lookup"><span data-stu-id="4d430-112">When you debug or run your service from Visual Studio, it automatically starts the emulator as a background application and then deploys your service to the emulator.</span></span> <span data-ttu-id="4d430-113">Вы можете использовать эмулятор для просмотра службы, запущенной в локальной среде.</span><span class="sxs-lookup"><span data-stu-id="4d430-113">You can use the emulator to view your service when it runs in the local environment.</span></span> <span data-ttu-id="4d430-114">Можно запустить полную версию или экспресс-версию эмулятора.</span><span class="sxs-lookup"><span data-stu-id="4d430-114">You can run the full version or the express version of the emulator.</span></span> <span data-ttu-id="4d430-115">(Начиная с Azure 2.3 экспресс-версия эмулятора используется по умолчанию.) Ознакомьтесь с разделом [Использование эмулятора Emulator Express для запуска и отладки облачной службы в локальной среде](https://msdn.microsoft.com/library/dn339018.aspx).</span><span class="sxs-lookup"><span data-stu-id="4d430-115">(Starting with Azure 2.3, the express version of the emulator is the default.) See [Using Emulator Express to Run and Debug a Cloud Service Locally](https://msdn.microsoft.com/library/dn339018.aspx).</span></span>

### <a name="to-debug-your-cloud-service-on-your-local-computer"></a><span data-ttu-id="4d430-116">Порядок отладки облачной службы на локальном компьютере</span><span class="sxs-lookup"><span data-stu-id="4d430-116">To debug your cloud service on your local computer</span></span>
1. <span data-ttu-id="4d430-117">В строке меню выберите **Отладка** и **Начать отладку**, чтобы запустить проект облачной службы Azure.</span><span class="sxs-lookup"><span data-stu-id="4d430-117">On the menu bar, choose **Debug**, **Start Debugging** to run your Azure cloud service project.</span></span> <span data-ttu-id="4d430-118">Также можно просто нажать клавишу F5.</span><span class="sxs-lookup"><span data-stu-id="4d430-118">As an alternative, you can press F5.</span></span> <span data-ttu-id="4d430-119">Вы увидите сообщение о том, что запускается эмулятор вычислений.</span><span class="sxs-lookup"><span data-stu-id="4d430-119">You’ll see a message that the Compute Emulator is starting.</span></span> <span data-ttu-id="4d430-120">На запуск эмулятора указывает значок в области уведомлений.</span><span class="sxs-lookup"><span data-stu-id="4d430-120">When the emulator starts, the system tray icon confirms it.</span></span>

    ![Эмулятор Azure в области уведомлений](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC783828.png)
2. <span data-ttu-id="4d430-122">Откройте пользовательский интерфейс эмулятора вычислений. Для этого в области уведомлений правой кнопкой мыши щелкните значок Azure и выберите пункт **Show Compute Emulator UI** (Показать пользовательский интерфейс эмулятора вычислений).</span><span class="sxs-lookup"><span data-stu-id="4d430-122">Display the user interface for the compute emulator by opening the shortcut menu for the Azure icon in the notification area, and then select **Show Compute Emulator UI**.</span></span>

    <span data-ttu-id="4d430-123">В левой области пользовательского интерфейса показаны службы, которые сейчас развернуты в эмуляторе вычислений, и экземпляры ролей, которые выполняет каждая служба.</span><span class="sxs-lookup"><span data-stu-id="4d430-123">The left pane of the UI shows the services that are currently deployed to the compute emulator and the role instances that each service is running.</span></span> <span data-ttu-id="4d430-124">Вы можете выбрать службу или роль для отображения жизненного цикла, журналов и диагностических сведений в области справа.</span><span class="sxs-lookup"><span data-stu-id="4d430-124">You can choose the service or roles to display lifecycle, logging, and diagnostic information in the right pane.</span></span> <span data-ttu-id="4d430-125">При установке фокуса на верхнее поле вложенного окна оно развертывается, заполняя правую область.</span><span class="sxs-lookup"><span data-stu-id="4d430-125">If you put the focus in the top margin of an included window, it expands to fill the right pane.</span></span>
3. <span data-ttu-id="4d430-126">Пошагово выполните код приложения, выбирая в меню **Отладка** соответствующие команды и задавая точки останова.</span><span class="sxs-lookup"><span data-stu-id="4d430-126">Step through the application by selecting commands on the **Debug** menu and setting breakpoints in your code.</span></span> <span data-ttu-id="4d430-127">По мере работы с приложением в отладчике в областях будет отображаться текущее состояние приложения.</span><span class="sxs-lookup"><span data-stu-id="4d430-127">As you step through the application in the debugger, the panes are updated with the current status of the application.</span></span> <span data-ttu-id="4d430-128">При остановке отладки развертывание приложения удаляется.</span><span class="sxs-lookup"><span data-stu-id="4d430-128">When you stop debugging, the application deployment is deleted.</span></span> <span data-ttu-id="4d430-129">Если приложение включает в себя веб-роль и было задано свойство Startup action для запуска веб-браузера, то Visual Studio запускает веб-приложение в браузере.</span><span class="sxs-lookup"><span data-stu-id="4d430-129">If your application includes a web role and you've set the Startup action property to start the web browser, Visual Studio starts your web application in the browser.</span></span> <span data-ttu-id="4d430-130">Если вы изменили количество экземпляров роли в конфигурации службы, то необходимо остановить облачную службу и затем перезапустить отладку, чтобы можно было отлаживать эти новые экземпляры роли.</span><span class="sxs-lookup"><span data-stu-id="4d430-130">If you change the number of instances of a role in the service configuration, you must stop your cloud service and then restart debugging so that you can debug these new instances of the role.</span></span>

    <span data-ttu-id="4d430-131">**Примечание**. После остановки выполнения или отладки службы локальный эмулятор вычислений и эмулятор хранения не останавливаются.</span><span class="sxs-lookup"><span data-stu-id="4d430-131">**Note:** When you stop running or debugging your service, the local compute emulator and storage emulator aren't stopped.</span></span> <span data-ttu-id="4d430-132">Необходимо остановить их явным образом в области уведомлений.</span><span class="sxs-lookup"><span data-stu-id="4d430-132">You must stop them explicitly from the notification area.</span></span>

## <a name="debug-a-cloud-service-in-azure"></a><span data-ttu-id="4d430-133">Отладка облачной службы в Azure</span><span class="sxs-lookup"><span data-stu-id="4d430-133">Debug a cloud service in Azure</span></span>
<span data-ttu-id="4d430-134">Чтобы выполнить отладку облачной службы с удаленного компьютера, необходимо включить эту функциональную возможность явным образом при развертывании облачной службы, чтобы необходимые службы (например, msvsmon.exe) были установлены на виртуальных машинах, где выполняются ваши  экземпляры ролей.</span><span class="sxs-lookup"><span data-stu-id="4d430-134">To debug a cloud service from a remote machine, you must enable that functionality explicitly when you deploy your cloud service so that required services (msvsmon.exe, for example) are installed on the virtual machines that run your role instances.</span></span> <span data-ttu-id="4d430-135">Если вы не включили удаленную отладку при публикации службы, необходимо повторно опубликовать эту службу с включенной удаленной отладкой.</span><span class="sxs-lookup"><span data-stu-id="4d430-135">If you didn't enable remote debugging when you published the service, you have to republish the service with remote debugging enabled.</span></span>

<span data-ttu-id="4d430-136">Если вы включили удаленную отладку для облачной службы, это не приводит к снижению производительности и не требует дополнительных затрат.</span><span class="sxs-lookup"><span data-stu-id="4d430-136">If you enable remote debugging for a cloud service, it doesn't exhibit degraded performance or incur additional charges.</span></span> <span data-ttu-id="4d430-137">Не следует использовать удаленную отладку для рабочей службы, поскольку это может негативно сказаться на работе клиентов, использующих эту службу.</span><span class="sxs-lookup"><span data-stu-id="4d430-137">You shouldn't use remote debugging on a production service, because clients who use the service might be adversely affected.</span></span>

> [!NOTE]
> <span data-ttu-id="4d430-138">При публикации облачной службы из Visual Studio для всех ролей в службе, которые используют .NET Framework 4 или .NET Framework 4.5, можно активировать **IntelliTrace**.</span><span class="sxs-lookup"><span data-stu-id="4d430-138">When you publish a cloud service from Visual Studio, you can enable **IntelliTrace** for any roles in that service that target the .NET Framework 4 or the .NET Framework 4.5.</span></span> <span data-ttu-id="4d430-139">С помощью **IntelliTrace** можно изучить события, произошедшие в экземпляре роли в прошлом, и воспроизвести контекст за тот период времени.</span><span class="sxs-lookup"><span data-stu-id="4d430-139">By using **IntelliTrace**, you can examine events that occurred in a role instance in the past and reproduce the context from that time.</span></span> <span data-ttu-id="4d430-140">Ознакомьтесь со статьями [Отладка опубликованной облачной службы с помощью IntelliTrace и Visual Studio](http://go.microsoft.com/fwlink/?LinkID=623016) и [Использование IntelliTrace](https://msdn.microsoft.com/library/dd264915.aspx).</span><span class="sxs-lookup"><span data-stu-id="4d430-140">See [Debugging a published cloud service with IntelliTrace and Visual Studio](http://go.microsoft.com/fwlink/?LinkID=623016) and [Using IntelliTrace](https://msdn.microsoft.com/library/dd264915.aspx).</span></span>
>
>

### <a name="to-enable-remote-debugging-for-a-cloud-service"></a><span data-ttu-id="4d430-141">Порядок включения удаленной отладки для облачной службы</span><span class="sxs-lookup"><span data-stu-id="4d430-141">To enable remote debugging for a cloud service</span></span>
1. <span data-ttu-id="4d430-142">Откройте контекстное меню проекта Azure и выберите пункт **Опубликовать**.</span><span class="sxs-lookup"><span data-stu-id="4d430-142">Open the shortcut menu for the Azure project, and then select **Publish**.</span></span>
2. <span data-ttu-id="4d430-143">Выберите элемент **Промежуточная среда** и конфигурацию **Отладка**.</span><span class="sxs-lookup"><span data-stu-id="4d430-143">Select the **Staging** environment and the **Debug** configuration.</span></span>

    <span data-ttu-id="4d430-144">Это всего лишь рекомендация.</span><span class="sxs-lookup"><span data-stu-id="4d430-144">This is only a guideline.</span></span> <span data-ttu-id="4d430-145">Вы можете запустить тестовую среду в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="4d430-145">You can opt to run your test environments in a Production environment.</span></span> <span data-ttu-id="4d430-146">Однако включение удаленной отладки в рабочей среде может отрицательно сказаться на работе пользователей.</span><span class="sxs-lookup"><span data-stu-id="4d430-146">However, you may adversely affect users if you enable remote debugging on the Production environment.</span></span> <span data-ttu-id="4d430-147">Вы можете выбрать конфигурацию выпуска, однако конфигурация отладки облегчает процесс отладки.</span><span class="sxs-lookup"><span data-stu-id="4d430-147">You can choose the Release configuration, but the Debug configuration makes debugging easier.</span></span>

    ![Выберите конфигурацию отладки](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746717.gif)
3. <span data-ttu-id="4d430-149">Дальше выполните стандартную процедуру, но на вкладке **Дополнительные параметры** установите флажок **Enable Remote Debugger for all roles** (Включить удаленный отладчик для всех ролей).</span><span class="sxs-lookup"><span data-stu-id="4d430-149">Follow the usual steps, but select the **Enable Remote Debugger for all roles** check box on the **Advanced Settings** tab.</span></span>

    ![Конфигурация отладки](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746718.gif)

### <a name="to-attach-the-debugger-to-a-cloud-service-in-azure"></a><span data-ttu-id="4d430-151">Порядок подключения отладчика к облачной службе в Azure</span><span class="sxs-lookup"><span data-stu-id="4d430-151">To attach the debugger to a cloud service in Azure</span></span>
1. <span data-ttu-id="4d430-152">В обозревателе серверов разверните узел своей облачной службы.</span><span class="sxs-lookup"><span data-stu-id="4d430-152">In Server Explorer, expand the node for your cloud service.</span></span>
2. <span data-ttu-id="4d430-153">Откройте контекстное меню роли или экземпляра роли, к которому требуется присоединить отладчик, и выберите **Присоединить отладчик**.</span><span class="sxs-lookup"><span data-stu-id="4d430-153">Open the shortcut menu for the role or role instance to which you want to attach, and then select **Attach Debugger**.</span></span>

    <span data-ttu-id="4d430-154">При отладке роли отладчик Visual Studio подключается к каждому ее экземпляру.</span><span class="sxs-lookup"><span data-stu-id="4d430-154">If you debug a role, the Visual Studio debugger attaches to each instance of that role.</span></span> <span data-ttu-id="4d430-155">Отладчик останавливается в точке останова для первого экземпляра роли, который запускает эту строку кода и удовлетворяет условиям этой точки останова.</span><span class="sxs-lookup"><span data-stu-id="4d430-155">The debugger will break on a breakpoint for the first role instance that runs that line of code and meets any conditions of that breakpoint.</span></span> <span data-ttu-id="4d430-156">При отладке экземпляра отладчик подключается только к данному экземпляру и останавливается на точке останова только в том случае, если данный конкретный экземпляр запускает эту строку кода и удовлетворяет условиям точки останова.</span><span class="sxs-lookup"><span data-stu-id="4d430-156">If you debug an instance, the debugger attaches to only that instance and breaks on a breakpoint only when that specific instance runs that line of code and meets the breakpoint's conditions.</span></span>

    ![Присоединить отладчик](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746719.gif)
3. <span data-ttu-id="4d430-158">После подключения отладчика к экземпляру выполняйте отладку в обычном режиме.</span><span class="sxs-lookup"><span data-stu-id="4d430-158">After the debugger attaches to an instance, debug as usual.</span></span> <span data-ttu-id="4d430-159">Отладчик автоматически подключается к соответствующему хост-процессу для вашей роли.</span><span class="sxs-lookup"><span data-stu-id="4d430-159">The debugger automatically attaches to the appropriate host process for your role.</span></span> <span data-ttu-id="4d430-160">В зависимости от того, что представляет собой эта роль, отладчик подключается к w3wp.exe, WaWorkerHost.exe или WaIISHost.exe.</span><span class="sxs-lookup"><span data-stu-id="4d430-160">Depending on what the role is, the debugger attaches to w3wp.exe, WaWorkerHost.exe, or WaIISHost.exe.</span></span> <span data-ttu-id="4d430-161">Чтобы проверить процесс, к которому подключен отладчик, разверните узел экземпляра в обозревателе серверов.</span><span class="sxs-lookup"><span data-stu-id="4d430-161">To verify the process to which the debugger is attached, expand the instance node in Server Explorer.</span></span> <span data-ttu-id="4d430-162">Дополнительные сведения о процессах Azure см. в статье [Архитектура ролей Azure](http://blogs.msdn.com/b/kwill/archive/2011/05/05/windows-azure-role-architecture.aspx).</span><span class="sxs-lookup"><span data-stu-id="4d430-162">See [Azure Role Architecture](http://blogs.msdn.com/b/kwill/archive/2011/05/05/windows-azure-role-architecture.aspx) for more information about Azure processes.</span></span>

    ![Диалоговое окно "Выбор типа кода"](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC718346.png)
4. <span data-ttu-id="4d430-164">Чтобы определить процессы, к которым подключен отладчик, откройте диалоговое окно "Процессы", выбрав в строке меню "Отладка", "Окна", "Процессы".</span><span class="sxs-lookup"><span data-stu-id="4d430-164">To identify the processes to which the debugger is attached, open the Processes dialog box by, on the menu bar, choosing Debug, Windows, Processes.</span></span> <span data-ttu-id="4d430-165">(Сочетание клавиш: CTRL + ALT + Z) Чтобы отключить определенный процесс, откройте его контекстное меню и выберите пункт **Отсоединить процесс**.</span><span class="sxs-lookup"><span data-stu-id="4d430-165">(Keyboard: Ctrl+Alt+Z)To detach a specific process, open its shortcut menu, and then select **Detach Process**.</span></span> <span data-ttu-id="4d430-166">Или перейдите к узлу экземпляра в обозревателе сервера, найдите процесс, откройте его контекстное меню и выберите пункт **Отсоединить процесс**.</span><span class="sxs-lookup"><span data-stu-id="4d430-166">Or, locate the instance node in Server Explorer, find the process, open its shortcut menu, and then select **Detach Process**.</span></span>

    ![Отладить процессы](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC690787.gif)

> [!WARNING]
> <span data-ttu-id="4d430-168">Во время удаленной отладки избегайте длинных остановок на точках останова.</span><span class="sxs-lookup"><span data-stu-id="4d430-168">Avoid long stops at breakpoints when remote debugging.</span></span> <span data-ttu-id="4d430-169">Azure обрабатывает процесс, остановленный дольше, чем на несколько минут, как не отвечающий на запросы, и прекращает направлять трафик в этот экземпляр.</span><span class="sxs-lookup"><span data-stu-id="4d430-169">Azure treats a process that's stopped for longer than a few minutes as unresponsive and stops sending traffic to that instance.</span></span> <span data-ttu-id="4d430-170">В случае остановки на слишком длительный срок msvsmon.exe отключается от процесса.</span><span class="sxs-lookup"><span data-stu-id="4d430-170">If you stop for too long, msvsmon.exe detaches from the process.</span></span>
>
>

<span data-ttu-id="4d430-171">Чтобы отключить отладчик от всех процессов в экземпляре или роли, откройте контекстное меню роли или экземпляра, для которых выполняется отладка, и выберите пункт **Отсоединить отладчик**.</span><span class="sxs-lookup"><span data-stu-id="4d430-171">To detach the debugger from all processes in your instance or role, open the shortcut menu for the role or instance that you're debugging, and then select **Detach Debugger**.</span></span>

## <a name="limitations-of-remote-debugging-in-azure"></a><span data-ttu-id="4d430-172">Ограничения удаленной отладки в Azure</span><span class="sxs-lookup"><span data-stu-id="4d430-172">Limitations of remote debugging in Azure</span></span>
<span data-ttu-id="4d430-173">Начиная с пакета Azure SDK 2.3 удаленная отладка имеет следующие ограничения.</span><span class="sxs-lookup"><span data-stu-id="4d430-173">From Azure SDK 2.3, remote debugging has the following limitations.</span></span>

* <span data-ttu-id="4d430-174">При включенной удаленной отладке нельзя опубликовать облачную службу, в которой любая роль содержит более 25 экземпляров.</span><span class="sxs-lookup"><span data-stu-id="4d430-174">With remote debugging enabled, you can't publish a cloud service in which any role has more than 25 instances.</span></span>
* <span data-ttu-id="4d430-175">Отладчик использует порты 30400–30424, 31400–31424 и 32400–32424.</span><span class="sxs-lookup"><span data-stu-id="4d430-175">The debugger uses ports 30400 to 30424, 31400 to 31424 and 32400 to 32424.</span></span> <span data-ttu-id="4d430-176">Если вы попытаетесь использовать любой из этих портов, то не сможете опубликовать службу, а в журнале действий для Azure появится одно из следующих сообщений об ошибке:</span><span class="sxs-lookup"><span data-stu-id="4d430-176">If you try to use any of these ports, you won't be able to publish your service, and one of the following error messages will appear in the activity log for Azure:</span></span>

  * <span data-ttu-id="4d430-177">Ошибка проверки CSCFG-файла на основе CSDEF-файла.</span><span class="sxs-lookup"><span data-stu-id="4d430-177">Error validating the .cscfg file against the .csdef file.</span></span>
    <span data-ttu-id="4d430-178">Зарезервированный диапазон портов "диапазон" для конечной точки Microsoft.WindowsAzure.Plugins.RemoteDebugger.Connector роли "роль" перекрывается с уже заданным портом или диапазоном.</span><span class="sxs-lookup"><span data-stu-id="4d430-178">The reserved port range 'range' for endpoint Microsoft.WindowsAzure.Plugins.RemoteDebugger.Connector of role 'role' overlaps with an already defined port or range.</span></span>
  * <span data-ttu-id="4d430-179">Ошибка выделения.</span><span class="sxs-lookup"><span data-stu-id="4d430-179">Allocation failed.</span></span> <span data-ttu-id="4d430-180">Повторите попытку позднее. Попытайтесь уменьшить размер ВМ или число экземпляров роли или попробуйте выполнить развертывание в другом регионе.</span><span class="sxs-lookup"><span data-stu-id="4d430-180">Please retry later, try reducing the VM size or number of role instances, or try deploying to a different region.</span></span>

## <a name="debugging-azure-virtual-machines"></a><span data-ttu-id="4d430-181">Отладка виртуальных машин Azure</span><span class="sxs-lookup"><span data-stu-id="4d430-181">Debugging Azure virtual machines</span></span>
<span data-ttu-id="4d430-182">Вы можете выполнять отладку программ, выполняемых на виртуальных машинах Azure, с помощью обозревателя серверов в Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="4d430-182">You can debug programs that run on Azure virtual machines by using Server Explorer in Visual Studio.</span></span> <span data-ttu-id="4d430-183">При включении удаленной отладки на виртуальной машине Azure среда Azure устанавливает в виртуальной машине расширение удаленной отладки.</span><span class="sxs-lookup"><span data-stu-id="4d430-183">When you enable remote debugging on an Azure virtual machine, Azure installs the remote debugging extension on the virtual machine.</span></span> <span data-ttu-id="4d430-184">После этого вы можете подключиться к процессам на виртуальной машине и выполнить отладку обычным образом.</span><span class="sxs-lookup"><span data-stu-id="4d430-184">Then, you can attach to processes on the virtual machine and debug as you normally would.</span></span>

> [!NOTE]
> <span data-ttu-id="4d430-185">Виртуальные машины, созданные через стек диспетчера ресурсов Azure, можно отлаживать удаленно с помощью Cloud Explorer в Visual Studio 2015.</span><span class="sxs-lookup"><span data-stu-id="4d430-185">Virtual machines created through the Azure resource manager stack can be remotely debugged by using Cloud Explorer in Visual Studio 2015.</span></span> <span data-ttu-id="4d430-186">Дополнительные сведения см. в статье [Управление ресурсами Azure с помощью Cloud Explorer](http://go.microsoft.com/fwlink/?LinkId=623031).</span><span class="sxs-lookup"><span data-stu-id="4d430-186">For more information, see [Managing Azure Resources with Cloud Explorer](http://go.microsoft.com/fwlink/?LinkId=623031).</span></span>
>
>

### <a name="to-debug-an-azure-virtual-machine"></a><span data-ttu-id="4d430-187">Порядок отладки виртуальной машины Azure</span><span class="sxs-lookup"><span data-stu-id="4d430-187">To debug an Azure virtual machine</span></span>
1. <span data-ttu-id="4d430-188">В обозревателе серверов разверните узел "Виртуальные машины" и выберите узел той виртуальной машины, для которой необходимо выполнить отладку.</span><span class="sxs-lookup"><span data-stu-id="4d430-188">In Server Explorer, expand the Virtual Machines node and select the node of the virtual machine that you want to debug.</span></span>
2. <span data-ttu-id="4d430-189">Откройте контекстное меню и выберите пункт **Включить отладку**.</span><span class="sxs-lookup"><span data-stu-id="4d430-189">Open the context menu and select **Enable Debugging**.</span></span> <span data-ttu-id="4d430-190">Когда появится запрос о подтверждении включения отладки на виртуальной машине, нажмите кнопку **Да**.</span><span class="sxs-lookup"><span data-stu-id="4d430-190">When asked if you're sure if you want to enable debugging on the virtual machine, select **Yes**.</span></span>

    <span data-ttu-id="4d430-191">Azure установит расширение для удаленной отладки на виртуальную машину, что позволит выполнять отладку.</span><span class="sxs-lookup"><span data-stu-id="4d430-191">Azure installs the remote debugging extension on the virtual machine to enable debugging.</span></span>

    ![Команда включения отладки в виртуальной машине](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746720.png)

    ![Журнал действий Azure](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746721.png)
3. <span data-ttu-id="4d430-194">По окончании установки расширения для удаленной отладки откройте контекстное меню виртуальной машины и выберите пункт **Присоединить отладчик...**</span><span class="sxs-lookup"><span data-stu-id="4d430-194">After the remote debugging extension finishes installing, open the virtual machine's context menu and select **Attach Debugger...**</span></span>

    <span data-ttu-id="4d430-195">Azure получит список процессов на виртуальной машине и покажет их в окне «Присоединение к процессу».</span><span class="sxs-lookup"><span data-stu-id="4d430-195">Azure gets a list of the processes on the virtual machine and shows them in the Attach to Process dialog box.</span></span>

    ![Команда подключения отладчика](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746722.png)
4. <span data-ttu-id="4d430-197">В диалоговом окне **Присоединение к процессу** нажмите кнопку **Выбрать** и выберите только те типы кода, для которых требуется отладка.</span><span class="sxs-lookup"><span data-stu-id="4d430-197">In the **Attach to Process** dialog box, select **Select** to limit the results list to show only the types of code you want to debug.</span></span> <span data-ttu-id="4d430-198">Вы можете осуществлять отладку 32- или 64-разрядного управляемого и/или машинного кода.</span><span class="sxs-lookup"><span data-stu-id="4d430-198">You can debug 32- or 64-bit managed code, native code, or both.</span></span>

    ![Диалоговое окно "Выбор типа кода"](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC718346.png)
5. <span data-ttu-id="4d430-200">Выберите процессы, которые необходимо отладить на виртуальной машине, и нажмите кнопку **Присоединить**.</span><span class="sxs-lookup"><span data-stu-id="4d430-200">Select the processes you want to debug on the virtual machine and then select **Attach**.</span></span> <span data-ttu-id="4d430-201">Например, можно выбрать процесс w3wp.exe, если требуется выполнить отладку веб-приложения на виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="4d430-201">For example, you might choose the w3wp.exe process if you wanted to debug a web app on the virtual machine.</span></span> <span data-ttu-id="4d430-202">Дополнительные сведения см. в статьях [Отладка одного или нескольких процессов в Visual Studio](https://msdn.microsoft.com/library/jj919165.aspx) и [Архитектура ролей Azure](http://blogs.msdn.com/b/kwill/archive/2011/05/05/windows-azure-role-architecture.aspx).</span><span class="sxs-lookup"><span data-stu-id="4d430-202">See [Debug One or More Processes in Visual Studio](https://msdn.microsoft.com/library/jj919165.aspx) and [Azure Role Architecture](http://blogs.msdn.com/b/kwill/archive/2011/05/05/windows-azure-role-architecture.aspx) for more information.</span></span>

## <a name="create-a-web-project-and-a-virtual-machine-for-debugging"></a><span data-ttu-id="4d430-203">Создание веб-проекта и виртуальной машины для отладки</span><span class="sxs-lookup"><span data-stu-id="4d430-203">Create a web project and a virtual machine for debugging</span></span>
<span data-ttu-id="4d430-204">Перед публикацией проекта Azure может оказаться удобным протестировать его в автономной среде, которая поддерживает сценарии отладки и тестирования и где можно установить программы для тестирования и мониторинга.</span><span class="sxs-lookup"><span data-stu-id="4d430-204">Before publishing your Azure project, you might find it useful to test it in a contained environment that supports debugging and testing scenarios, and where you can install testing and monitoring programs.</span></span> <span data-ttu-id="4d430-205">Одним из способов сделать это является удаленная отладка приложения на виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="4d430-205">One way to do this is to remotely debug your app on a virtual machine.</span></span>

<span data-ttu-id="4d430-206">Проекты Visual Studio ASP.NET позволяют создать удобную виртуальную машину, которую можно использовать для тестирования приложений.</span><span class="sxs-lookup"><span data-stu-id="4d430-206">Visual Studio ASP.NET projects offer an option to create a handy virtual machine that you can use for app testing.</span></span> <span data-ttu-id="4d430-207">Эта виртуальная машина включает в себя часто используемые конечные точки, такие как PowerShell, удаленный рабочий стол и WebDeploy.</span><span class="sxs-lookup"><span data-stu-id="4d430-207">The virtual machine includes commonly-needed endpoints such as PowerShell, remote desktop, and WebDeploy.</span></span>

### <a name="to-create-a-web-project-and-a-virtual-machine-for-debugging"></a><span data-ttu-id="4d430-208">Порядок создания веб-проекта и виртуальной машины для отладки</span><span class="sxs-lookup"><span data-stu-id="4d430-208">To create a web project and a virtual machine for debugging</span></span>
1. <span data-ttu-id="4d430-209">Создайте в Visual Studio новое веб-приложение ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="4d430-209">In Visual Studio, create a new ASP.NET Web Application.</span></span>
2. <span data-ttu-id="4d430-210">В диалоговом окне «Новый проект ASP.NET» в разделе Azure выберите в раскрывающемся списке пункт **Виртуальная машина** .</span><span class="sxs-lookup"><span data-stu-id="4d430-210">In the New ASP.NET Project dialog, in the Azure section, choose **Virtual Machine** in the dropdown list box.</span></span> <span data-ttu-id="4d430-211">Оставьте флажок **Создать удаленные ресурсы** установленным.</span><span class="sxs-lookup"><span data-stu-id="4d430-211">Leave the **Create remote resources** check box selected.</span></span> <span data-ttu-id="4d430-212">Нажмите кнопку **ОК** , чтобы продолжить.</span><span class="sxs-lookup"><span data-stu-id="4d430-212">Select **OK** to proceed.</span></span>

    <span data-ttu-id="4d430-213">Откроется диалоговое окно **Создание виртуальной машины в Azure** .</span><span class="sxs-lookup"><span data-stu-id="4d430-213">The **Create virtual machine on Azure** dialog box appears.</span></span>

    ![Диалоговое окно "Создать веб-проект ASP.NET"](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746723.png)

    <span data-ttu-id="4d430-215">**Примечание**. Если вы еще не выполнили вход, появится запрос на вход в вашу учетную запись Azure.</span><span class="sxs-lookup"><span data-stu-id="4d430-215">**Note:** You'll be asked to sign in to your Azure account if you're not already signed in.</span></span>

1. <span data-ttu-id="4d430-216">Выберите параметры для виртуальной машины, а затем нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="4d430-216">Select the various settings for the virtual machine and then select **OK**.</span></span> <span data-ttu-id="4d430-217">Дополнительные сведения см. в статье [Виртуальные машины](http://go.microsoft.com/fwlink/?LinkId=623033).</span><span class="sxs-lookup"><span data-stu-id="4d430-217">See [Virtual Machines](http://go.microsoft.com/fwlink/?LinkId=623033) for more information.</span></span>

    <span data-ttu-id="4d430-218">Имя, которое вы указали в поле DNS-имени, будет использоваться как имя виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="4d430-218">The name you enter for DNS name will be the name of the virtual machine.</span></span>

    ![Диалоговое окно "Создать виртуальную машину"](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746724.png)

    <span data-ttu-id="4d430-220">Azure создает виртуальную машину, а также подготавливает и настраивает конечные точки, такие как удаленный рабочий стол и веб-развертывание.</span><span class="sxs-lookup"><span data-stu-id="4d430-220">Azure creates the virtual machine and then provisions and configures the endpoints, such as Remote Desktop and Web Deploy</span></span>
2. <span data-ttu-id="4d430-221">После окончательной настройки виртуальной машины выберите ее узел в обозревателе серверов.</span><span class="sxs-lookup"><span data-stu-id="4d430-221">After the virtual machine is fully configured, select the virtual machine’s node in Server Explorer.</span></span>
3. <span data-ttu-id="4d430-222">Откройте контекстное меню и выберите пункт **Включить отладку**.</span><span class="sxs-lookup"><span data-stu-id="4d430-222">Open the context menu and select **Enable Debugging**.</span></span> <span data-ttu-id="4d430-223">Когда появится запрос о подтверждении включения отладки на виртуальной машине, нажмите кнопку **Да**.</span><span class="sxs-lookup"><span data-stu-id="4d430-223">When asked if you're sure if you want to enable debugging on the virtual machine, select **Yes**.</span></span>

    <span data-ttu-id="4d430-224">Azure устанавливает расширение удаленной отладки в виртуальной машине для включения отладки.</span><span class="sxs-lookup"><span data-stu-id="4d430-224">Azure installs the remote debugging extension to the virtual machine to enable debugging.</span></span>

    ![Команда включения отладки в виртуальной машине](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746720.png)

    ![Журнал действий Azure](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746721.png)
4. <span data-ttu-id="4d430-227">Опубликуйте проект в соответствии с инструкциями из статьи [Развертывание веб-проекта с помощью публикации одним щелчком в Visual Studio](https://msdn.microsoft.com/library/dd465337.aspx).</span><span class="sxs-lookup"><span data-stu-id="4d430-227">Publish your project as outlined in [How to: Deploy a Web Project Using One-Click Publish in Visual Studio](https://msdn.microsoft.com/library/dd465337.aspx).</span></span> <span data-ttu-id="4d430-228">Так как вы хотите осуществлять отладку на виртуальной машине, в мастере **Публикация веб-сайта** на странице **Параметры** выберите конфигурацию **Отладка**.</span><span class="sxs-lookup"><span data-stu-id="4d430-228">Because you want to debug on the virtual machine, on the **Settings** page of the **Publish Web** wizard, select **Debug** as the configuration.</span></span> <span data-ttu-id="4d430-229">Это позволяет просматривать символы кода во время отладки.</span><span class="sxs-lookup"><span data-stu-id="4d430-229">This makes sure that code symbols are available while debugging.</span></span>

    ![Параметры публикации](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC718349.png)
5. <span data-ttu-id="4d430-231">В разделе **Параметры публикации файлов** установите флажок **Удалить дополнительные файлы в месте назначения**, если проект был развернут ранее.</span><span class="sxs-lookup"><span data-stu-id="4d430-231">In the **File Publish Options**, select **Remove additional files at destination** if the project was already deployed at an earlier time.</span></span>
6. <span data-ttu-id="4d430-232">Когда проект опубликуется, в обозревателе сервера в контекстном меню виртуальной машины выберите **Присоединить отладчик...**</span><span class="sxs-lookup"><span data-stu-id="4d430-232">After the project publishes, on the virtual machine's context menu in Server Explorer, select **Attach Debugger...**</span></span>

    <span data-ttu-id="4d430-233">Azure получит список процессов на виртуальной машине и покажет их в окне «Присоединение к процессу».</span><span class="sxs-lookup"><span data-stu-id="4d430-233">Azure gets a list of the processes on the virtual machine and shows them in the Attach to Process dialog box.</span></span>

    ![Команда подключения отладчика](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746722.png)
7. <span data-ttu-id="4d430-235">В диалоговом окне **Присоединение к процессу** нажмите кнопку **Выбрать** и выберите только те типы кода, для которых требуется отладка.</span><span class="sxs-lookup"><span data-stu-id="4d430-235">In the **Attach to Process** dialog box, select **Select** to limit the results list to show only the types of code you want to debug.</span></span> <span data-ttu-id="4d430-236">Вы можете осуществлять отладку 32- или 64-разрядного управляемого и/или машинного кода.</span><span class="sxs-lookup"><span data-stu-id="4d430-236">You can debug 32- or 64-bit managed code, native code, or both.</span></span>

    ![Диалоговое окно "Выбор типа кода"](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC718346.png)
8. <span data-ttu-id="4d430-238">Выберите процессы, которые необходимо отладить на виртуальной машине, и нажмите кнопку **Присоединить**.</span><span class="sxs-lookup"><span data-stu-id="4d430-238">Select the processes you want to debug on the virtual machine and then select **Attach**.</span></span> <span data-ttu-id="4d430-239">Например, можно выбрать процесс w3wp.exe, если требуется выполнить отладку веб-приложения на виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="4d430-239">For example, you might choose the w3wp.exe process if you wanted to debug a web app on the virtual machine.</span></span> <span data-ttu-id="4d430-240">Дополнительные сведения см. в статье [Отладка одного или нескольких процессов в Visual Studio](https://msdn.microsoft.com/library/jj919165.aspx).</span><span class="sxs-lookup"><span data-stu-id="4d430-240">See [Debug One or More Processes in Visual Studio](https://msdn.microsoft.com/library/jj919165.aspx) for more information.</span></span>

## <a name="next-steps"></a><span data-ttu-id="4d430-241">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="4d430-241">Next steps</span></span>
* <span data-ttu-id="4d430-242">Используйте **Intellitrace** для сбора данных журнала вызовов и событий с сервера выпуска.</span><span class="sxs-lookup"><span data-stu-id="4d430-242">Use **Intellitrace** to collect a log of calls and events from a release server.</span></span> <span data-ttu-id="4d430-243">Ознакомьтесь со статьей [Отладка опубликованной облачной службы с помощью IntelliTrace и Visual Studio](http://go.microsoft.com/fwlink/?LinkID=623016).</span><span class="sxs-lookup"><span data-stu-id="4d430-243">See [Debugging a Published Cloud Service with IntelliTrace and Visual Studio](http://go.microsoft.com/fwlink/?LinkID=623016).</span></span>
* <span data-ttu-id="4d430-244">Используйте **систему диагностики Azure** для регистрации подробных сведений из кода, выполняющегося в ролях, независимо от того, запущены ли эти роли в среде разработки или в Azure.</span><span class="sxs-lookup"><span data-stu-id="4d430-244">Use **Azure Diagnostics** to log detailed information from code running within roles, whether the roles are running in the development environment or in Azure.</span></span> <span data-ttu-id="4d430-245">Ознакомьтесь со статьей [Включение системы диагностики Azure в облачных службах Azure](http://go.microsoft.com/fwlink/p/?LinkId=400450).</span><span class="sxs-lookup"><span data-stu-id="4d430-245">See [Collecting logging data by using Azure Diagnostics](http://go.microsoft.com/fwlink/p/?LinkId=400450).</span></span>
