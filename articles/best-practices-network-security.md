---
title: "Рекомендации по обеспечению безопасности в сети Azure | Документация Майкрософт"
description: "Сведения о некоторых ключевых функциях, доступных в Azure для создания безопасных сетевых сред"
services: virtual-network
documentationcenter: na
author: tracsman
manager: rossort
editor: 
ms.assetid: d169387a-1243-4867-a602-01d6f2d8a2a1
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 01/03/2017
ms.author: jonor
ms.openlocfilehash: fb5e399d4ab02a7f2805cc280b213bf5b44f6993
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="microsoft-cloud-services-and-network-security"></a><span data-ttu-id="57638-103">Облачные службы Microsoft Cloud и сетевая безопасность</span><span class="sxs-lookup"><span data-stu-id="57638-103">Microsoft cloud services and network security</span></span>
<span data-ttu-id="57638-104">Облачные службы (Майкрософт) позволяют пользоваться масштабируемыми службами и инфраструктурой, возможностями корпоративного класса и множеством вариантов гибридных подключений.</span><span class="sxs-lookup"><span data-stu-id="57638-104">Microsoft cloud services deliver hyper-scale services and infrastructure, enterprise-grade capabilities, and many choices for hybrid connectivity.</span></span> <span data-ttu-id="57638-105">Клиенты могут обращаться к этим службам через Интернет или с помощью службы Azure ExpressRoute, которая позволяет создавать подключения к частной сети.</span><span class="sxs-lookup"><span data-stu-id="57638-105">Customers can choose to access these services either via the Internet or with Azure ExpressRoute, which provides private network connectivity.</span></span> <span data-ttu-id="57638-106">Платформа Microsoft Azure позволяет клиентам легко добавлять в свою инфраструктуру облачные решения и создавать многоуровневую архитектуру.</span><span class="sxs-lookup"><span data-stu-id="57638-106">The Microsoft Azure platform allows customers to seamlessly extend their infrastructure into the cloud and build multi-tier architectures.</span></span> <span data-ttu-id="57638-107">Кроме того, сторонние производители могут получить дополнительные возможности путем предоставления служб безопасности и виртуальных устройств.</span><span class="sxs-lookup"><span data-stu-id="57638-107">Additionally, third parties can enable enhanced capabilities by offering security services and virtual appliances.</span></span> <span data-ttu-id="57638-108">В этом техническом документе мы предлагаем обзор вопросов, касающихся безопасности и архитектуры, которые необходимо учитывать при использовании облачных служб Microsoft Cloud с помощью ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="57638-108">This white paper provides an overview of security and architectural issues that customers should consider when using Microsoft cloud services accessed via ExpressRoute.</span></span> <span data-ttu-id="57638-109">В нем также рассматриваются более безопасные службы в виртуальных сетях Azure.</span><span class="sxs-lookup"><span data-stu-id="57638-109">It also covers creating more secure services in Azure virtual networks.</span></span>

## <a name="fast-start"></a><span data-ttu-id="57638-110">Выбор решения</span><span class="sxs-lookup"><span data-stu-id="57638-110">Fast start</span></span>
<span data-ttu-id="57638-111">Следующая диаграмма поможет вам выбрать конкретный пример из множества методов обеспечения безопасности, доступных на платформе Azure.</span><span class="sxs-lookup"><span data-stu-id="57638-111">The following logic chart can direct you to a specific example of the many security techniques available with the Azure platform.</span></span> <span data-ttu-id="57638-112">Найдите пример, который лучше всего соответствует вашей ситуации, по краткому описанию.</span><span class="sxs-lookup"><span data-stu-id="57638-112">For quick reference, find the example that best fits your case.</span></span> <span data-ttu-id="57638-113">Для получения более подробных сведений продолжите чтение документа.</span><span class="sxs-lookup"><span data-stu-id="57638-113">For expanded explanations, continue reading through the paper.</span></span>
<span data-ttu-id="57638-114">[![0]][0]</span><span class="sxs-lookup"><span data-stu-id="57638-114">[![0]][0]</span></span>

[<span data-ttu-id="57638-115">Пример 1. Создание сети периметра (также называемой промежуточной подсетью) для защиты приложений с помощью групп безопасности сети (NSG).</span><span class="sxs-lookup"><span data-stu-id="57638-115">Example 1: Build a perimeter network (also known as DMZ, demilitarized zone, or screened subnet) to help protect applications with network security groups (NSGs).</span></span>](#example-1-build-a-perimeter-network-to-help-protect-applications-with-nsgs)</br><span data-ttu-id="57638-116">
[Пример 2. Создание сети периметра для защиты приложений с помощью брандмауэра и групп безопасности сети (NSG).](#example-2-build-a-perimeter-network-to-help-protect-applications-with-a-firewall-and-nsgs)</span><span class="sxs-lookup"><span data-stu-id="57638-116">
[Example 2: Build a perimeter network to help protect applications with a firewall and NSGs.](#example-2-build-a-perimeter-network-to-help-protect-applications-with-a-firewall-and-nsgs)</span></span></br><span data-ttu-id="57638-117">
[Пример 3. Создание сети периметра для защиты сетей с помощью брандмауэра, определяемого пользователем маршрута (UDR) и группы безопасности сети (NSG).](#example-3-build-a-perimeter-network-to-help-protect-networks-with-a-firewall-and-udr-and-nsg)</span><span class="sxs-lookup"><span data-stu-id="57638-117">
[Example 3: Build a perimeter network to help protect networks with a firewall, user-defined route (UDR), and NSG.](#example-3-build-a-perimeter-network-to-help-protect-networks-with-a-firewall-and-udr-and-nsg)</span></span></br><span data-ttu-id="57638-118">
[Пример 4. Добавление гибридного подключения типа "сеть — сеть" с виртуальным устройством и виртуальной частной сетью (VPN).](#example-4-add-a-hybrid-connection-with-a-site-to-site-virtual-appliance-vpn)</span><span class="sxs-lookup"><span data-stu-id="57638-118">
[Example 4: Add a hybrid connection with a site-to-site, virtual appliance virtual private network (VPN).](#example-4-add-a-hybrid-connection-with-a-site-to-site-virtual-appliance-vpn)</span></span></br><span data-ttu-id="57638-119">
[Пример 5. Добавление гибридного подключения типа "сеть — сеть" с VPN-шлюзом Azure.](#example-5-add-a-hybrid-connection-with-a-site-to-site-azure-vpn-gateway)</span><span class="sxs-lookup"><span data-stu-id="57638-119">
[Example 5: Add a hybrid connection with a site-to-site, Azure VPN gateway.](#example-5-add-a-hybrid-connection-with-a-site-to-site-azure-vpn-gateway)</span></span></br><span data-ttu-id="57638-120">
[Пример 6. Добавление гибридного подключения с использованием ExpressRoute.](#example-6-add-a-hybrid-connection-with-expressroute)</span><span class="sxs-lookup"><span data-stu-id="57638-120">
[Example 6: Add a hybrid connection with ExpressRoute.](#example-6-add-a-hybrid-connection-with-expressroute)</span></span></br>
<span data-ttu-id="57638-121">Примеры добавления подключений между виртуальными сетями, а также примеры высокой доступности и объединения служб в цепочки будут добавлены в этот документ в течение следующих нескольких месяцев.</span><span class="sxs-lookup"><span data-stu-id="57638-121">Examples for adding connections between virtual networks, high availability, and service chaining will be added to this document over the next few months.</span></span>

## <a name="microsoft-compliance-and-infrastructure-protection"></a><span data-ttu-id="57638-122">Соответствие нормативным требованиям и защита инфраструктуры Майкрософт</span><span class="sxs-lookup"><span data-stu-id="57638-122">Microsoft compliance and infrastructure protection</span></span>
<span data-ttu-id="57638-123">Чтобы помочь организациям соблюдать государственные, региональные и отраслевые требования, регулирующие сбор и использование пользовательских данных, мы предлагаем более 40 сертификатов и аттестатов.</span><span class="sxs-lookup"><span data-stu-id="57638-123">To help organizations comply with national, regional, and industry-specific requirements governing the collection and use of individuals’ data, Microsoft offers over 40 certifications and attestations.</span></span> <span data-ttu-id="57638-124">Это наиболее полный набор, предоставляемый поставщиком облачных служб.</span><span class="sxs-lookup"><span data-stu-id="57638-124">The most comprehensive set of any cloud service provider.</span></span>

<span data-ttu-id="57638-125">Дополнительные сведения см. в разделе о соответствии нормативным требованиям в [центре управления безопасностью Azure][TrustCenter].</span><span class="sxs-lookup"><span data-stu-id="57638-125">For more information, see the compliance information on the [Microsoft Trust Center][TrustCenter].</span></span>

<span data-ttu-id="57638-126">Корпорация Майкрософт использует комплексную защиту облачной инфраструктуры, на базе которой работают глобальные масштабируемые службы.</span><span class="sxs-lookup"><span data-stu-id="57638-126">Microsoft has a comprehensive approach to protect cloud infrastructure needed to run hyper-scale global services.</span></span> <span data-ttu-id="57638-127">В облачную инфраструктуру Microsoft Cloud входят аппаратное и программное обеспечение, сети, административный и эксплуатационный персонал, а также физические центры обработки данных.</span><span class="sxs-lookup"><span data-stu-id="57638-127">Microsoft cloud infrastructure includes hardware, software, networks, and administrative and operations staff, in addition to the physical data centers.</span></span>

<span data-ttu-id="57638-128">![2]</span><span class="sxs-lookup"><span data-stu-id="57638-128">![2]</span></span>

<span data-ttu-id="57638-129">Этот подход гарантирует клиентам надежный фундамент для развертывания служб на платформе Microsoft Cloud.</span><span class="sxs-lookup"><span data-stu-id="57638-129">This approach provides a more secure foundation for customers to deploy their services in the Microsoft cloud.</span></span> <span data-ttu-id="57638-130">На его основе клиентам следует разработать и создать системы безопасности для защиты этих служб.</span><span class="sxs-lookup"><span data-stu-id="57638-130">The next step is for customers to design and create a security architecture to protect these services.</span></span>

## <a name="traditional-security-architectures-and-perimeter-networks"></a><span data-ttu-id="57638-131">Традиционные архитектуры для систем безопасности и сетей периметра</span><span class="sxs-lookup"><span data-stu-id="57638-131">Traditional security architectures and perimeter networks</span></span>
<span data-ttu-id="57638-132">Корпорация Майкрософт вкладывает большие средства в защиту облачной инфраструктуры. Пользователи тоже должны принимать меры для защиты облачных служб и групп ресурсов.</span><span class="sxs-lookup"><span data-stu-id="57638-132">Although Microsoft invests heavily in protecting the cloud infrastructure, customers must also protect their cloud services and resource groups.</span></span> <span data-ttu-id="57638-133">Лучшим подходом к обеспечению безопасности является многоуровневый подход к безопасности.</span><span class="sxs-lookup"><span data-stu-id="57638-133">A multilayered approach to security provides the best defense.</span></span> <span data-ttu-id="57638-134">Зона безопасности сети периметра защищает внутренние сетевые ресурсы от ненадежных сетей.</span><span class="sxs-lookup"><span data-stu-id="57638-134">A perimeter network security zone protects internal network resources from an untrusted network.</span></span> <span data-ttu-id="57638-135">К сети периметра относятся те края или части сети, которые находятся между Интернетом и защищенной корпоративной ИТ-инфраструктурой.</span><span class="sxs-lookup"><span data-stu-id="57638-135">A perimeter network refers to the edges or parts of the network that sit between the Internet and the protected enterprise IT infrastructure.</span></span>

<span data-ttu-id="57638-136">В обычной корпоративной сети базовая инфраструктура хорошо защищена по всему периметру несколькими уровнями устройств безопасности.</span><span class="sxs-lookup"><span data-stu-id="57638-136">In typical enterprise networks, the core infrastructure is heavily fortified at the perimeters, with multiple layers of security devices.</span></span> <span data-ttu-id="57638-137">Граница каждого уровня состоит из устройств и точек реализации политики.</span><span class="sxs-lookup"><span data-stu-id="57638-137">The boundary of each layer consists of devices and policy enforcement points.</span></span> <span data-ttu-id="57638-138">Каждый уровень может включать сочетание следующих сетевых устройств безопасности: брандмауэры, устройства предотвращения атак типа "отказ в обслуживании" (DoS), системы обнаружения или предотвращения вторжений (IDS/IPS) и VPN-устройства.</span><span class="sxs-lookup"><span data-stu-id="57638-138">Each layer can include a combination of the following network security devices: firewalls, Denial of Service (DoS) prevention, Intrusion Detection or Protection Systems (IDS/IPS), and VPN devices.</span></span> <span data-ttu-id="57638-139">Реализация политики выполняется в форме политик брандмауэра, списков управления доступом (ACL) или правил маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="57638-139">Policy enforcement can take the form of firewall policies, access control lists (ACLs), or specific routing.</span></span> <span data-ttu-id="57638-140">Первый уровень защиты сети, напрямую взаимодействующий с входящим трафиком из Интернета, представляет собой определенное сочетание таких механизмов. Его задача — блокировать атаки и вредоносный трафик и пропускать допустимые запросы далее по сети.</span><span class="sxs-lookup"><span data-stu-id="57638-140">The first line of defense in the network, directly accepting incoming traffic from the Internet, is a combination of these mechanisms to block attacks and harmful traffic while allowing legitimate requests further into the network.</span></span> <span data-ttu-id="57638-141">Этот трафик направляется непосредственно к ресурсам в сети периметра.</span><span class="sxs-lookup"><span data-stu-id="57638-141">This traffic routes directly to resources in the perimeter network.</span></span> <span data-ttu-id="57638-142">Этот ресурс может "общаться" с ресурсами, размещенными более глубоко в локальной сети, проходя при этом проверку на следующей границе сети.</span><span class="sxs-lookup"><span data-stu-id="57638-142">That resource may then “talk” to resources deeper in the network, transiting the next boundary for validation first.</span></span> <span data-ttu-id="57638-143">Самый внешний уровень называется сетью периметра, поскольку он напрямую открыт для Интернета. С обеих сторон от сети периметра обычно располагаются какие-либо системы защиты.</span><span class="sxs-lookup"><span data-stu-id="57638-143">The outermost layer is called the perimeter network because this part of the network is exposed to the Internet, usually with some form of protection on both sides.</span></span> <span data-ttu-id="57638-144">На следующем рисунке показан пример одиночной подсети для сети периметра в корпоративной сети, с двумя границами безопасности.</span><span class="sxs-lookup"><span data-stu-id="57638-144">The following figure shows an example of a single subnet perimeter network in a corporate network, with two security boundaries.</span></span>

<span data-ttu-id="57638-145">![3]</span><span class="sxs-lookup"><span data-stu-id="57638-145">![3]</span></span>

<span data-ttu-id="57638-146">Существует много вариантов архитектуры сети периметра.</span><span class="sxs-lookup"><span data-stu-id="57638-146">There are many architectures used to implement a perimeter network.</span></span> <span data-ttu-id="57638-147">Они могут варьироваться от простого балансировщика нагрузки до нескольких подсетей сети периметра с различными механизмами блокировки трафика и защиты более глубоких слоев корпоративной сети на каждой границе.</span><span class="sxs-lookup"><span data-stu-id="57638-147">These architectures can range from a simple load balancer to a multiple-subnet perimeter network with varied mechanisms at each boundary to block traffic and protect the deeper layers of the corporate network.</span></span> <span data-ttu-id="57638-148">Структура сети периметра зависит от конкретных потребностей организации и общих допустимых уровней риска.</span><span class="sxs-lookup"><span data-stu-id="57638-148">How the perimeter network is built depends on the specific needs of the organization and its overall risk tolerance.</span></span>

<span data-ttu-id="57638-149">По мере того как пользователи переносят свои рабочие нагрузки в общедоступные облака, важно поддерживать аналогичные возможности для архитектуры сети периметра в Azure, чтобы соблюдать требования безопасности и соответствия стандартам.</span><span class="sxs-lookup"><span data-stu-id="57638-149">As customers move their workloads to public clouds, it is critical to support similar capabilities for perimeter network architecture in Azure to meet compliance and security requirements.</span></span> <span data-ttu-id="57638-150">В этом документе приведены рекомендации по построению безопасной сетевой среды в Azure.</span><span class="sxs-lookup"><span data-stu-id="57638-150">This document provides guidelines on how customers can build a secure network environment in Azure.</span></span> <span data-ttu-id="57638-151">Основное внимание в нем уделяется сети периметра, но также подробно обсуждаются многие аспекты безопасности сети.</span><span class="sxs-lookup"><span data-stu-id="57638-151">It focuses on the perimeter network, but also includes a comprehensive discussion of many aspects of network security.</span></span> <span data-ttu-id="57638-152">Это обсуждение включает следующие вопросы:</span><span class="sxs-lookup"><span data-stu-id="57638-152">The following questions inform this discussion:</span></span>

* <span data-ttu-id="57638-153">Как построить сеть периметра в Azure?</span><span class="sxs-lookup"><span data-stu-id="57638-153">How can a perimeter network in Azure be built?</span></span>
* <span data-ttu-id="57638-154">Какие функции для создания сети периметра есть в Azure?</span><span class="sxs-lookup"><span data-stu-id="57638-154">What are some of the Azure features available to build the perimeter network?</span></span>
* <span data-ttu-id="57638-155">Как защитить серверную часть рабочей нагрузки?</span><span class="sxs-lookup"><span data-stu-id="57638-155">How can back-end workloads be protected?</span></span>
* <span data-ttu-id="57638-156">Как в Azure контролируется взаимодействие рабочих нагрузок с Интернетом?</span><span class="sxs-lookup"><span data-stu-id="57638-156">How are Internet communications controlled to the workloads in Azure?</span></span>
* <span data-ttu-id="57638-157">Как защитить локальные сети от развертывания в Azure?</span><span class="sxs-lookup"><span data-stu-id="57638-157">How can the on-premises networks be protected from deployments in Azure?</span></span>
* <span data-ttu-id="57638-158">Когда лучше использовать собственные функции безопасности Azure, а когда — устройства или службы сторонних производителей?</span><span class="sxs-lookup"><span data-stu-id="57638-158">When should native Azure security features be used versus third-party appliances or services?</span></span>

<span data-ttu-id="57638-159">На следующей диаграмме показаны различные уровни безопасности, которые Azure предоставляет клиентам.</span><span class="sxs-lookup"><span data-stu-id="57638-159">The following diagram shows various layers of security Azure provides to customers.</span></span> <span data-ttu-id="57638-160">Эти уровни представляют собой как уровни безопасности самой платформы Azure, так и пользовательские функции:</span><span class="sxs-lookup"><span data-stu-id="57638-160">These layers are both native in the Azure platform itself and customer-defined features:</span></span>

<span data-ttu-id="57638-161">![4]</span><span class="sxs-lookup"><span data-stu-id="57638-161">![4]</span></span>

<span data-ttu-id="57638-162">На входе из Интернета действует защита Azure от атак DDoS, которая отслеживает масштабные атаки на систему Azure.</span><span class="sxs-lookup"><span data-stu-id="57638-162">Inbound from the Internet, Azure DDoS helps protect against large-scale attacks against Azure.</span></span> <span data-ttu-id="57638-163">Следующий уровень защиты — определяемые пользователем общедоступные IP-адреса (конечные точки), которые выявляют, какой трафик можно передать через облачную службу в виртуальную сеть.</span><span class="sxs-lookup"><span data-stu-id="57638-163">The next layer is customer-defined public IP addresses (endpoints), which are used to determine which traffic can pass through the cloud service to the virtual network.</span></span> <span data-ttu-id="57638-164">Виртуальная сеть Azure имеет встроенную систему изоляции от всех остальных сетей, и этот трафик может проходить только теми путями и методами, которые настроены пользователем.</span><span class="sxs-lookup"><span data-stu-id="57638-164">Native Azure virtual network isolation ensures complete isolation from all other networks and that traffic only flows through user configured paths and methods.</span></span> <span data-ttu-id="57638-165">Эти пути и методы формируют следующий уровень защиты, на котором с помощью сетевых групп безопасности (NSG), определяемого пользователем маршрута (UDR) и виртуальных сетевых устройств создаются границы безопасности для защиты развернутых приложений в защищаемой сети.</span><span class="sxs-lookup"><span data-stu-id="57638-165">These paths and methods are the next layer, where NSGs, UDR, and network virtual appliances can be used to create security boundaries to protect the application deployments in the protected network.</span></span>

<span data-ttu-id="57638-166">В следующем разделе приводится обзор виртуальных сетей Azure.</span><span class="sxs-lookup"><span data-stu-id="57638-166">The next section provides an overview of Azure virtual networks.</span></span> <span data-ttu-id="57638-167">Эти виртуальные сети создаются пользователями и используются для подключения развернутых рабочих нагрузок.</span><span class="sxs-lookup"><span data-stu-id="57638-167">These virtual networks are created by customers, and are what their deployed workloads are connected to.</span></span> <span data-ttu-id="57638-168">Виртуальные сети являются основой всех функций сетевой безопасности, используемых для создания сети периметра для защиты клиентских развертываний в Azure.</span><span class="sxs-lookup"><span data-stu-id="57638-168">Virtual networks are the basis of all the network security features required to establish a perimeter network to protect customer deployments in Azure.</span></span>

## <a name="overview-of-azure-virtual-networks"></a><span data-ttu-id="57638-169">Общие сведения о виртуальных сетях Azure</span><span class="sxs-lookup"><span data-stu-id="57638-169">Overview of Azure virtual networks</span></span>
<span data-ttu-id="57638-170">Прежде чем интернет-трафик поступит в виртуальные сети Azure, он проходит два встроенных уровня безопасности платформы Azure:</span><span class="sxs-lookup"><span data-stu-id="57638-170">Before Internet traffic can get to the Azure virtual networks, there are two layers of security inherent to the Azure platform:</span></span>

1.    <span data-ttu-id="57638-171">**Защита от атак DDoS.** Защита от атак DDoS — это уровень физической сети Azure, который защищает саму платформу Azure от крупномасштабных атак через Интернет.</span><span class="sxs-lookup"><span data-stu-id="57638-171">**DDoS protection**: DDoS protection is a layer of the Azure physical network that protects the Azure platform itself from large-scale Internet-based attacks.</span></span> <span data-ttu-id="57638-172">Эти атаки используют множество "узлов-ботов", чтобы попытаться вызвать перегрузку интернет-службы.</span><span class="sxs-lookup"><span data-stu-id="57638-172">These attacks use multiple “bot” nodes in an attempt to overwhelm an Internet service.</span></span> <span data-ttu-id="57638-173">Платформа Azure надежно защищена от атак DDoS на всех интерфейсах, принимающих входящий, исходящий и межрегиональный трафик.</span><span class="sxs-lookup"><span data-stu-id="57638-173">Azure has a robust DDoS protection mesh on all inbound, outbound, and cross-Azure region connectivity.</span></span> <span data-ttu-id="57638-174">Защита от атак DDoS не имеет параметров, настраиваемых пользователем, и этот уровень недоступен для клиентов.</span><span class="sxs-lookup"><span data-stu-id="57638-174">This DDoS protection layer has no user configurable attributes and is not accessible to the customer.</span></span> <span data-ttu-id="57638-175">Этот уровень защищает Azure как платформу от DDoS-атак и крупномасштабных атак. Он также отслеживает исходящий и межрегиональный трафик Azure.</span><span class="sxs-lookup"><span data-stu-id="57638-175">The DDoS protection layer protects Azure as a platform from large-scale attacks, it also monitors out-bound traffic and cross-Azure region traffic.</span></span> <span data-ttu-id="57638-176">Используя виртуальные сетевые устройства, клиент может настроить дополнительные уровни устойчивости для защиты от небольших атак, не относящихся к уровню защиты платформы.</span><span class="sxs-lookup"><span data-stu-id="57638-176">Using network virtual appliances on the VNet, additional layers of resilience can be configured by the customer against a smaller scale attack that doesn't trip the platform level protection.</span></span> <span data-ttu-id="57638-177">Пример защиты от DDoS-атак в действии. Если IP-адрес с выходом в Интернет подвергся крупномасштабной атаке DDoS, Azure может определить источники атак и удалить нежелательный трафик, прежде чем он достигнет своего места назначения.</span><span class="sxs-lookup"><span data-stu-id="57638-177">An example of DDoS in action; if an internet facing IP address was attacked by a large-scale DDoS attack, Azure would detect the sources of the attacks and scrub the offending traffic before it reached its intended destination.</span></span> <span data-ttu-id="57638-178">Почти во всех случаях атаки не влияют на конечную точку.</span><span class="sxs-lookup"><span data-stu-id="57638-178">In almost all cases, the attacked endpoint isn't affected by the attack.</span></span> <span data-ttu-id="57638-179">В редких случаях атака распространяется на конечную точку, однако зараженный трафик не передается на другие конечные точки.</span><span class="sxs-lookup"><span data-stu-id="57638-179">In the rare cases that an endpoint is affected, no traffic is affected to other endpoints, only the attacked endpoint.</span></span> <span data-ttu-id="57638-180">Кроме того, такая атака не повлияет на других клиентов и другие службы.</span><span class="sxs-lookup"><span data-stu-id="57638-180">Thus other customers and services would see no impact from that attack.</span></span> <span data-ttu-id="57638-181">Важно отметить, что защита Azure от атак DDoS отслеживает только крупномасштабные атаки.</span><span class="sxs-lookup"><span data-stu-id="57638-181">It's critical to note that Azure DDoS is only looking for large-scale attacks.</span></span> <span data-ttu-id="57638-182">Не исключается и тот случай, что конкретная служба может быть перегружена, прежде чем пороговые значения защиты уровня платформы превысятся.</span><span class="sxs-lookup"><span data-stu-id="57638-182">It is possible that your specific service could be overwhelmed before the platform level protection thresholds are exceeded.</span></span> <span data-ttu-id="57638-183">Например, атака DDoS может перевести веб-сайт на одном сервере A0 IIS в автономный режим, прежде чем уровень защиты Azure от атак DDoS зарегистрирует угрозу.</span><span class="sxs-lookup"><span data-stu-id="57638-183">For example, a web site on a single A0 IIS server, could be taken offline by a DDoS attack before Azure platform level DDoS protection registered a threat.</span></span>

2.  <span data-ttu-id="57638-184">**Общедоступные IP-адреса.** Общедоступные IP-адреса (включенные с помощью конечных точек службы, общедоступных IP-адресов, шлюза приложений и других функций Azure, представляющих общедоступный IP-адрес для маршрутизации через Интернет к ресурсу) позволяют облачным службам и группам ресурсов иметь общедоступные IP-адреса и порты, открытые для доступа через Интернет.</span><span class="sxs-lookup"><span data-stu-id="57638-184">**Public IP Addresses**: Public IP addresses (enabled via service endpoints, Public IP addresses, Application Gateway, and other Azure features that present a public IP address to the internet routed to your resource) allow cloud services or resource groups to have public Internet IP addresses and ports exposed.</span></span> <span data-ttu-id="57638-185">Конечная точка использует преобразование сетевых адресов (NAT) для маршрутизации трафика на внутренний адрес и порт в виртуальной сети Azure.</span><span class="sxs-lookup"><span data-stu-id="57638-185">The endpoint uses Network Address Translation (NAT) to route traffic to the internal address and port on the Azure virtual network.</span></span> <span data-ttu-id="57638-186">Это основной путь передачи внешнего трафика в виртуальную сеть.</span><span class="sxs-lookup"><span data-stu-id="57638-186">This path is the primary way for external traffic to pass into the virtual network.</span></span> <span data-ttu-id="57638-187">Общедоступные IP-адреса можно настроить, чтобы определить, какой трафик следует пропускать в виртуальную сеть, а также как и где его следует пропускать.</span><span class="sxs-lookup"><span data-stu-id="57638-187">The Public IP addresses are configurable to determine which traffic is passed in, and how and where it's translated on to the virtual network.</span></span>

<span data-ttu-id="57638-188">При достижении трафиком виртуальной сети существует множество аспектов, которые вступают в действие.</span><span class="sxs-lookup"><span data-stu-id="57638-188">Once traffic reaches the virtual network, there are many features that come into play.</span></span> <span data-ttu-id="57638-189">Виртуальные сети Azure являются фундаментом, к которому клиенты подключают свои рабочие нагрузки и на котором реализуется базовая безопасность на уровне сети.</span><span class="sxs-lookup"><span data-stu-id="57638-189">Azure virtual networks are the foundation for customers to attach their workloads and where basic network-level security applies.</span></span> <span data-ttu-id="57638-190">Они предоставляют клиенту Azure частную сеть (наложение виртуальной сети) со следующими функциями и характеристиками.</span><span class="sxs-lookup"><span data-stu-id="57638-190">It is a private network (a virtual network overlay) in Azure for customers with the following features and characteristics:</span></span>

* <span data-ttu-id="57638-191">**Изоляция трафика.** Виртуальная сеть на платформе Azure выступает в качестве границы изоляции трафика.</span><span class="sxs-lookup"><span data-stu-id="57638-191">**Traffic isolation**: A virtual network is the traffic isolation boundary on the Azure platform.</span></span> <span data-ttu-id="57638-192">Виртуальные машины в одной виртуальной сети не могут напрямую обращаться к виртуальным машинам в другой виртуальной сети, даже если обе виртуальные сети созданы одним клиентом.</span><span class="sxs-lookup"><span data-stu-id="57638-192">Virtual machines (VMs) in one virtual network cannot communicate directly to VMs in a different virtual network, even if both virtual networks are created by the same customer.</span></span> <span data-ttu-id="57638-193">Это критически важное свойство, которое гарантирует, что виртуальные машины и все коммуникации клиента останутся закрытыми в пределах виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="57638-193">Isolation is a critical property that ensures customer VMs and communication remains private within a virtual network.</span></span>

>[!NOTE]
><span data-ttu-id="57638-194">Изоляция трафика относится только к *входящему* трафику виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="57638-194">Traffic isolation refers only to traffic *inbound* to the virtual network.</span></span> <span data-ttu-id="57638-195">По умолчанию исходящий трафик из виртуальной сети к Интернету разрешен, но его можно предотвратить, настроив группы безопасности сети.</span><span class="sxs-lookup"><span data-stu-id="57638-195">By default outbound traffic from the VNet to the internet is allowed, but can be prevented if desired by NSGs.</span></span>
>
>

* <span data-ttu-id="57638-196">**Многоуровневая топология.** Виртуальные сети позволяют клиентам сформировать многоуровневую топологию путем выделения подсетей и отдельных адресных пространств для различных элементов или "уровней" рабочих нагрузок.</span><span class="sxs-lookup"><span data-stu-id="57638-196">**Multi-tier topology**: Virtual networks allow customers to define multi-tier topology by allocating subnets and designating separate address spaces for different elements or “tiers” of their workloads.</span></span> <span data-ttu-id="57638-197">Эти логические группы и топологии позволяют определить различные политики доступа для разных типов рабочей нагрузки, а также контролировать потоки трафика между уровнями.</span><span class="sxs-lookup"><span data-stu-id="57638-197">These logical groupings and topologies enable customers to define different access policy based on the workload types, and also control traffic flows between the tiers.</span></span>
* <span data-ttu-id="57638-198">**Распределенное подключение.** Клиенты могут установить подключение между виртуальной сетью и несколькими локальными сайтами или другими виртуальными сетями в Azure.</span><span class="sxs-lookup"><span data-stu-id="57638-198">**Cross-premises connectivity**: Customers can establish cross-premises connectivity between a virtual network and multiple on-premises sites or other virtual networks in Azure.</span></span> <span data-ttu-id="57638-199">Чтобы создать подключение, клиенты могут использовать пиринг виртуальных сетей, VPN-шлюзы Azure, виртуальные сетевые устройства сторонних производителей или ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="57638-199">To construct a connection, customers can use VNet Peering, Azure VPN Gateways, third-party network virtual appliances, or ExpressRoute.</span></span> <span data-ttu-id="57638-200">Azure поддерживает VPN типа "сеть — сеть" со стандартными протоколами IPsec/IKE, а также службу частного соединения ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="57638-200">Azure supports site-to-site (S2S) VPNs using standard IPsec/IKE protocols and ExpressRoute private connectivity.</span></span>
* <span data-ttu-id="57638-201">**Сетевая группа безопасности** позволяет клиентам создавать правила (ACL) на разных уровнях детализации: сетевые интерфейсы, отдельные виртуальные машины или виртуальные подсети.</span><span class="sxs-lookup"><span data-stu-id="57638-201">**NSG** allows customers to create rules (ACLs) at the desired level of granularity: network interfaces, individual VMs, or virtual subnets.</span></span> <span data-ttu-id="57638-202">Пользователи могут управлять доступом, разрешая или запрещая взаимодействие рабочих нагрузок друг с другом в пределах виртуальной сети, с клиентских систем в сетях клиента с помощью подключений между сетями, а также напрямую через Интернет.</span><span class="sxs-lookup"><span data-stu-id="57638-202">Customers can control access by permitting or denying communication between the workloads within a virtual network, from systems on customer’s networks via cross-premises connectivity, or direct Internet communication.</span></span>
* <span data-ttu-id="57638-203">**Определяемые пользователем маршруты** (UDR) и **IP-пересылка** позволяют клиентам определять пути взаимодействия между разными уровнями виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="57638-203">**UDR** and **IP Forwarding** allow customers to define the communication paths between different tiers within a virtual network.</span></span> <span data-ttu-id="57638-204">Клиенты могут развернуть брандмауэр, устройство IDS/IPS или другие виртуальные устройства и направить сетевой трафик через эти устройства безопасности, что позволяет применять, контролировать и проверять политики границ безопасности.</span><span class="sxs-lookup"><span data-stu-id="57638-204">Customers can deploy a firewall, IDS/IPS, and other virtual appliances, and route network traffic through these security appliances for security boundary policy enforcement, auditing, and inspection.</span></span>
* <span data-ttu-id="57638-205">**Виртуальные сетевые устройства** в Azure Marketplace. В Azure Marketplace и в коллекции образов виртуальных машин доступны устройства защиты, такие как брандмауэры,подсистемы балансировки нагрузки и службы обнаружения и предотвращения вторжений (IDS/IPS).</span><span class="sxs-lookup"><span data-stu-id="57638-205">**Network virtual appliances** in the Azure Marketplace: Security appliances such as firewalls, load balancers, and IDS/IPS are available in the Azure Marketplace and the VM Image Gallery.</span></span> <span data-ttu-id="57638-206">Клиенты могут развернуть эти устройства в своих виртуальных сетях, в частности на границах безопасности (в том числе в подсетях сети периметра), для получения многоуровневой защищенной сетевой среды.</span><span class="sxs-lookup"><span data-stu-id="57638-206">Customers can deploy these appliances into their virtual networks, and specifically, at their security boundaries (including the perimeter network subnets) to complete a multi-tiered secure network environment.</span></span>

<span data-ttu-id="57638-207">Рассмотрим пример создания архитектуры сети периметра в Azure с использованием этих функций и возможностей.</span><span class="sxs-lookup"><span data-stu-id="57638-207">With these features and capabilities, one example of how a perimeter network architecture could be constructed in Azure is the following diagram:</span></span>

<span data-ttu-id="57638-208">![5]</span><span class="sxs-lookup"><span data-stu-id="57638-208">![5]</span></span>

## <a name="perimeter-network-characteristics-and-requirements"></a><span data-ttu-id="57638-209">Характеристики сети периметра и требования к ней</span><span class="sxs-lookup"><span data-stu-id="57638-209">Perimeter network characteristics and requirements</span></span>
<span data-ttu-id="57638-210">Сеть периметра представляет собой передний край сети (интерфейсная сеть), который напрямую взаимодействует с Интернетом.</span><span class="sxs-lookup"><span data-stu-id="57638-210">The perimeter network is the front end of the network, directly interfacing communication from the Internet.</span></span> <span data-ttu-id="57638-211">Прежде чем попасть на внутренние серверы, входящие пакеты должны пройти через устройства безопасности, такие как брандмауэры, IDS и IPS.</span><span class="sxs-lookup"><span data-stu-id="57638-211">The incoming packets should flow through the security appliances, such as the firewall, IDS, and IPS, before reaching the back-end servers.</span></span> <span data-ttu-id="57638-212">Пакеты, направленные в Интернет рабочими нагрузками, также могут проходить через защитные устройства сети периметра перед выходом из сети. Это удобно для применения политик, выполнения проверок и аудита.</span><span class="sxs-lookup"><span data-stu-id="57638-212">Internet-bound packets from the workloads can also flow through the security appliances in the perimeter network for policy enforcement, inspection, and auditing purposes, before leaving the network.</span></span> <span data-ttu-id="57638-213">Кроме того, сети периметра могут использоваться для размещения VPN-шлюзов, соединяющих виртуальные сети клиента с локальными сетями.</span><span class="sxs-lookup"><span data-stu-id="57638-213">Additionally, the perimeter network can host cross-premises VPN gateways between customer virtual networks and on-premises networks.</span></span>

### <a name="perimeter-network-characteristics"></a><span data-ttu-id="57638-214">Характеристики сети периметра</span><span class="sxs-lookup"><span data-stu-id="57638-214">Perimeter network characteristics</span></span>
<span data-ttu-id="57638-215">Обратившись к предыдущему рисунку, можно выделить некоторые характеристики хорошей сети периметра:</span><span class="sxs-lookup"><span data-stu-id="57638-215">Referencing the previous figure, some of the characteristics of a good perimeter network are as follows:</span></span>

* <span data-ttu-id="57638-216">Выход в Интернет:</span><span class="sxs-lookup"><span data-stu-id="57638-216">Internet-facing:</span></span>
  * <span data-ttu-id="57638-217">Подсеть периметра имеет прямой выход в Интернет и взаимодействует с ним напрямую.</span><span class="sxs-lookup"><span data-stu-id="57638-217">The perimeter network subnet itself is Internet-facing, directly communicating with the Internet.</span></span>
  * <span data-ttu-id="57638-218">Общедоступные IP-адреса, виртуальные IP-адреса и (или) конечные точки службы передают интернет-трафик на интерфейсные сети и устройства.</span><span class="sxs-lookup"><span data-stu-id="57638-218">Public IP addresses, VIPs, and/or service endpoints pass Internet traffic to the front-end network and devices.</span></span>
  * <span data-ttu-id="57638-219">Входящий трафик из Интернета проходит через устройства безопасности, прежде чем попасть на другие ресурсы интерфейсной сети.</span><span class="sxs-lookup"><span data-stu-id="57638-219">Inbound traffic from the Internet passes through security devices before other resources on the front-end network.</span></span>
  * <span data-ttu-id="57638-220">Если включена политика безопасности для исходящих подключений, трафик проходит через устройства безопасности на последнем шаге перед выходом в Интернет.</span><span class="sxs-lookup"><span data-stu-id="57638-220">If outbound security is enabled, traffic passes through security devices, as the final step, before passing to the Internet.</span></span>
* <span data-ttu-id="57638-221">Защищенная сеть:</span><span class="sxs-lookup"><span data-stu-id="57638-221">Protected network:</span></span>
  * <span data-ttu-id="57638-222">Прямого пути из Интернета к базовой инфраструктуре не существует.</span><span class="sxs-lookup"><span data-stu-id="57638-222">There is no direct path from the Internet to the core infrastructure.</span></span>
  * <span data-ttu-id="57638-223">Каналы связи с базовой инфраструктурой обязательно проходят через устройства безопасности, такие как группы безопасности сети, брандмауэры и VPN-устройства.</span><span class="sxs-lookup"><span data-stu-id="57638-223">Channels to the core infrastructure must traverse through security devices such as NSGs, firewalls, or VPN devices.</span></span>
  * <span data-ttu-id="57638-224">Другие устройства не могут выступать в качестве моста между Интернетом и базовой инфраструктурой.</span><span class="sxs-lookup"><span data-stu-id="57638-224">Other devices must not bridge Internet and the core infrastructure.</span></span>
  * <span data-ttu-id="57638-225">Устройства безопасности для обеих границ сети периметра (границы, открытой для Интернета, и границы, обращенной к защищенной сети), например, два брандмауэра, показанные на предыдущем рисунке, на самом деле могут представлять собой одно виртуальное устройство с различными правилами или интерфейсами для каждой границы.</span><span class="sxs-lookup"><span data-stu-id="57638-225">Security devices on both the Internet-facing and the protected network facing boundaries of the perimeter network (for example, the two firewall icons shown in the previous figure) may actually be a single virtual appliance with differentiated rules or interfaces for each boundary.</span></span> <span data-ttu-id="57638-226">Например, одно логически разделенное физическое устройство обрабатывает нагрузку для обеих границ сети периметра.</span><span class="sxs-lookup"><span data-stu-id="57638-226">For example, one physical device, logically separated, handling the load for both boundaries of the perimeter network.</span></span>
* <span data-ttu-id="57638-227">Другие общие рекомендации и ограничения:</span><span class="sxs-lookup"><span data-stu-id="57638-227">Other common practices and constraints:</span></span>
  * <span data-ttu-id="57638-228">В рабочих нагрузках не может храниться критически важная информация.</span><span class="sxs-lookup"><span data-stu-id="57638-228">Workloads must not store business critical information.</span></span>
  * <span data-ttu-id="57638-229">Доступ для просмотра и обновления конфигураций и развертываний сети периметра имеют только авторизованные администраторы.</span><span class="sxs-lookup"><span data-stu-id="57638-229">Access and updates to perimeter network configurations and deployments are limited to only authorized administrators.</span></span>

### <a name="perimeter-network-requirements"></a><span data-ttu-id="57638-230">Требования к сети периметра</span><span class="sxs-lookup"><span data-stu-id="57638-230">Perimeter network requirements</span></span>
<span data-ttu-id="57638-231">Чтобы создать успешную сеть периметра, которая будет обладать описанными выше характеристиками, следуйте рекомендациям к созданию виртуальной сети, приведенным ниже:</span><span class="sxs-lookup"><span data-stu-id="57638-231">To enable these characteristics, follow these guidelines on virtual network requirements to implement a successful perimeter network:</span></span>

* <span data-ttu-id="57638-232">**Архитектура подсети.** Определите виртуальную сеть таким образом, чтобы вся подсеть была выделена для сети периметра и отделена от других подсетей в той же виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="57638-232">**Subnet architecture:** Specify the virtual network such that an entire subnet is dedicated as the perimeter network, separated from other subnets in the same virtual network.</span></span> <span data-ttu-id="57638-233">Это позволит гарантировать, что трафик между сетью периметра и другими уровнями внутренних или частных подсетей будет проходить через брандмауэры или виртуальные устройства IDS и IPS.</span><span class="sxs-lookup"><span data-stu-id="57638-233">This separation ensures the traffic between the perimeter network and other internal or private subnet tiers flows through a firewall or IDS/IPS virtual appliance.</span></span>  <span data-ttu-id="57638-234">Определяемые пользователем маршруты, расположенные на границах подсетей, должны перенаправить трафик в виртуальное устройство.</span><span class="sxs-lookup"><span data-stu-id="57638-234">User-defined routes on the boundary subnets are required to forward this traffic to the virtual appliance.</span></span>
* <span data-ttu-id="57638-235">**Группы безопасности сети (NSG).** Сама подсеть сети периметра должна быть открытой для взаимодействия с Интернетом, но это не означает, что не должны применяться группы безопасности сети.</span><span class="sxs-lookup"><span data-stu-id="57638-235">**NSG:** The perimeter network subnet itself should be open to allow communication with the Internet, but that does not mean customers should be bypassing NSGs.</span></span> <span data-ttu-id="57638-236">Следуйте общим рекомендациям по безопасности для минимизации участков сети, открытых для доступа через Интернет.</span><span class="sxs-lookup"><span data-stu-id="57638-236">Follow common security practices to minimize the network surfaces exposed to the Internet.</span></span> <span data-ttu-id="57638-237">Ограничьте диапазон удаленных адресов, с которых разрешен доступ к развернутым службам, а также диапазон используемых протоколов приложений и открытых портов.</span><span class="sxs-lookup"><span data-stu-id="57638-237">Lock down the remote address ranges allowed to access the deployments or the specific application protocols and ports that are open.</span></span> <span data-ttu-id="57638-238">При этом могут возникнуть обстоятельства, в которых полная блокировка невозможна.</span><span class="sxs-lookup"><span data-stu-id="57638-238">There may be circumstances, however, in which a complete lock-down is not possible.</span></span> <span data-ttu-id="57638-239">Например, если в Azure размещен внешний веб-сайт клиента, сеть периметра должна пропускать входящие веб-запросы от любого общедоступного IP-адреса, но только на порты веб-приложения TCP:80 и (или) TCP:443.</span><span class="sxs-lookup"><span data-stu-id="57638-239">For example, if customers have an external website in Azure, the perimeter network should allow the incoming web requests from any public IP addresses, but should only open the web application ports: TCP on port 80 and/or TCP on port 443.</span></span>
* <span data-ttu-id="57638-240">**Таблица маршрутизации.** Подсеть сети периметра должна иметь возможность взаимодействовать с Интернетом напрямую, но не должна допускать прямой обмен данными с серверной частью или с локальными сетями в обход брандмауэра или устройства безопасности.</span><span class="sxs-lookup"><span data-stu-id="57638-240">**Routing table:** The perimeter network subnet itself should be able to communicate to the Internet directly, but should not allow direct communication to and from the back end or on-premises networks without going through a firewall or security appliance.</span></span>
* <span data-ttu-id="57638-241">**Конфигурация устройств безопасности.** Для маршрутизации и проверки пакетов между сетью периметра и другими защищенными сетями устройства безопасности сети (например, брандмауэры, устройства IDS и IPS) могут настраиваться как многоадресные.</span><span class="sxs-lookup"><span data-stu-id="57638-241">**Security appliance configuration:** To route and inspect packets between the perimeter network and the rest of the protected networks, the security appliances such as firewall, IDS, and IPS devices may be multi-homed.</span></span> <span data-ttu-id="57638-242">То есть они могут иметь отдельные сетевые адаптеры для сети периметра и внутренних подсетей.</span><span class="sxs-lookup"><span data-stu-id="57638-242">They may have separate NICs for the perimeter network and the back-end subnets.</span></span> <span data-ttu-id="57638-243">Сетевые адаптеры в сети периметра взаимодействуют с Интернетом напрямую. В них будут использоваться соответствующие сетевые группы безопасности и таблица маршрутизации сети периметра.</span><span class="sxs-lookup"><span data-stu-id="57638-243">The NICs in the perimeter network communicate directly to and from the Internet, with the corresponding NSGs and the perimeter network routing table.</span></span> <span data-ttu-id="57638-244">Сетевые адаптеры, подключенные к внутренним подсетям, имеют более ограниченные сетевые группы безопасности и таблицы маршрутизации этих внутренних подсетей.</span><span class="sxs-lookup"><span data-stu-id="57638-244">The NICs connecting to the back-end subnets have more restricted NSGs and routing tables of the corresponding back-end subnets.</span></span>
* <span data-ttu-id="57638-245">**Функциональные возможности устройств безопасности сети.** Устройства безопасности, развернутые в сети периметра, обычно выполняют следующие функции.</span><span class="sxs-lookup"><span data-stu-id="57638-245">**Security appliance functionality:** The security appliances deployed in the perimeter network typically perform the following functionality:</span></span>
  * <span data-ttu-id="57638-246">Брандмауэр — применение правил брандмауэра и политик контроля доступа к входящим запросам.</span><span class="sxs-lookup"><span data-stu-id="57638-246">Firewall: Enforcing firewall rules or access control policies for the incoming requests.</span></span>
  * <span data-ttu-id="57638-247">Выявление и предотвращение угроз — обнаружение вредоносных атак из Интернета и их устранение.</span><span class="sxs-lookup"><span data-stu-id="57638-247">Threat detection and prevention: Detecting and mitigating malicious attacks from the Internet.</span></span>
  * <span data-ttu-id="57638-248">Аудит и ведение журнала — ведение подробных журналов аудита и анализа.</span><span class="sxs-lookup"><span data-stu-id="57638-248">Auditing and logging: Maintaining detailed logs for auditing and analysis.</span></span>
  * <span data-ttu-id="57638-249">Обратный прокси — перенаправление входящих запросов на соответствующие тыловые серверы.</span><span class="sxs-lookup"><span data-stu-id="57638-249">Reverse proxy: Redirecting the incoming requests to the corresponding back-end servers.</span></span> <span data-ttu-id="57638-250">Оно включает в себя сопоставление и преобразование адресов назначения на интерфейсных устройствах, обычно брандмауэрах, в адреса тыловых серверов.</span><span class="sxs-lookup"><span data-stu-id="57638-250">This redirection involves mapping and translating the destination addresses on the front-end devices, typically firewalls, to the back-end server addresses.</span></span>
  * <span data-ttu-id="57638-251">Прокси-сервер переадресации — преобразование сетевых адресов и аудит обмена данными между виртуальной сетью и Интернетом.</span><span class="sxs-lookup"><span data-stu-id="57638-251">Forward proxy: Providing NAT and performing auditing for communication initiated from within the virtual network to the Internet.</span></span>
  * <span data-ttu-id="57638-252">Маршрутизатор — перенаправление входящего трафика и трафика между подсетями в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="57638-252">Router: Forwarding incoming and cross-subnet traffic inside the virtual network.</span></span>
  * <span data-ttu-id="57638-253">VPN-устройство — выполнение функций межсетевых VPN-шлюзов для подключений VPN между локальными сетями клиента и виртуальными сетями Azure.</span><span class="sxs-lookup"><span data-stu-id="57638-253">VPN device: Acting as the cross-premises VPN gateways for cross-premises VPN connectivity between customer on-premises networks and Azure virtual networks.</span></span>
  * <span data-ttu-id="57638-254">VPN-сервер — прием подключений VPN-клиентов к виртуальным сетям Azure.</span><span class="sxs-lookup"><span data-stu-id="57638-254">VPN server: Accepting VPN clients connecting to Azure virtual networks.</span></span>

> [!TIP]
> <span data-ttu-id="57638-255">Разделите две следующие группы пользователей: пользователи, которым разрешен доступ к инфраструктуре безопасности сети периметра, и пользователи, имеющие права администраторов по разработке, развертыванию и эксплуатации приложений.</span><span class="sxs-lookup"><span data-stu-id="57638-255">Keep the following two groups separate: the individuals authorized to access the perimeter network security gear and the individuals authorized as application development, deployment, or operations administrators.</span></span> <span data-ttu-id="57638-256">Разделение этих групп обеспечивает распределение обязанностей и не позволит одному человеку обойти одновременно систему безопасности приложений и систему безопасности сети.</span><span class="sxs-lookup"><span data-stu-id="57638-256">Keeping these groups separate allows for a segregation of duties and prevents a single person from bypassing both applications security and network security controls.</span></span>
>
>

### <a name="questions-to-be-asked-when-building-network-boundaries"></a><span data-ttu-id="57638-257">Важные вопросы при создании границ сети</span><span class="sxs-lookup"><span data-stu-id="57638-257">Questions to be asked when building network boundaries</span></span>
<span data-ttu-id="57638-258">В этом разделе термин "сети", если не указано иное, относится к частным виртуальным сетям Azure, созданным администратором подписки.</span><span class="sxs-lookup"><span data-stu-id="57638-258">In this section, unless specifically mentioned, the term "networks" refers to private Azure virtual networks created by a subscription administrator.</span></span> <span data-ttu-id="57638-259">Этот термин не относится к базовым физическим сетям в Azure.</span><span class="sxs-lookup"><span data-stu-id="57638-259">The term doesn't refer to the underlying physical networks within Azure.</span></span>

<span data-ttu-id="57638-260">Кроме того, виртуальные сети Azure часто используются для расширения традиционных локальных сетей.</span><span class="sxs-lookup"><span data-stu-id="57638-260">Also, Azure virtual networks are often used to extend traditional on-premises networks.</span></span> <span data-ttu-id="57638-261">В архитектуры сетей периметра можно интегрировать гибридные сетевые решения "сеть-сеть" или ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="57638-261">It is possible to incorporate either site-to-site or ExpressRoute hybrid networking solutions with perimeter network architectures.</span></span> <span data-ttu-id="57638-262">Это важно учитывать при создании границ безопасности сети.</span><span class="sxs-lookup"><span data-stu-id="57638-262">This hybrid link is an important consideration in building network security boundaries.</span></span>

<span data-ttu-id="57638-263">При построении сети с сетью периметра и несколькими границами безопасности важнейшее значение имеют следующие три вопроса.</span><span class="sxs-lookup"><span data-stu-id="57638-263">The following three questions are critical to answer when you're building a network with a perimeter network and multiple security boundaries.</span></span>

#### <a name="1-how-many-boundaries-are-needed"></a><span data-ttu-id="57638-264">1) Сколько границ необходимо?</span><span class="sxs-lookup"><span data-stu-id="57638-264">1) How many boundaries are needed?</span></span>
<span data-ttu-id="57638-265">Первым делом важно определить, сколько нужно периметров безопасности в каждом конкретном случае.</span><span class="sxs-lookup"><span data-stu-id="57638-265">The first decision point is to decide how many security boundaries are needed in a given scenario:</span></span>

* <span data-ttu-id="57638-266">Одна граница: одна сеть периметра, используемая в качестве интерфейса между виртуальной сетью и Интернетом.</span><span class="sxs-lookup"><span data-stu-id="57638-266">A single boundary: One on the front-end perimeter network, between the virtual network and the Internet.</span></span>
* <span data-ttu-id="57638-267">Две границы: одна между Интернетом и сетью периметра и другая между подсетью сети периметра и внутренними подсетями в виртуальных сетях Azure.</span><span class="sxs-lookup"><span data-stu-id="57638-267">Two boundaries: One on the Internet side of the perimeter network, and another between the perimeter network subnet and the back-end subnets in the Azure virtual networks.</span></span>
* <span data-ttu-id="57638-268">Три границы: одна между Интернетом и сетью периметра, другая между сетью периметра и внутренними подсетями и третья между внутренними подсетями и локальной сетью.</span><span class="sxs-lookup"><span data-stu-id="57638-268">Three boundaries: One on the Internet side of the perimeter network, one between the perimeter network and back-end subnets, and one between the back-end subnets and the on-premises network.</span></span>
* <span data-ttu-id="57638-269">N границ: переменное количество.</span><span class="sxs-lookup"><span data-stu-id="57638-269">N boundaries: A variable number.</span></span> <span data-ttu-id="57638-270">В зависимости от требований безопасности для конкретной сети может применяться любое количество границ безопасности.</span><span class="sxs-lookup"><span data-stu-id="57638-270">Depending on security requirements, there is no limit to the number of security boundaries that can be applied in a given network.</span></span>

<span data-ttu-id="57638-271">Количество и тип периметров зависят от допустимого уровня риска для предприятия и характеристик конкретного сценария.</span><span class="sxs-lookup"><span data-stu-id="57638-271">The number and type of boundaries needed vary based on a company’s risk tolerance and the specific scenario being implemented.</span></span> <span data-ttu-id="57638-272">Часто это решение совместно принимают несколько групп внутри организации. В их число часто входят отдел управления рисками и стандартами, отдел эксплуатации сети и платформы и команда разработчиков приложений.</span><span class="sxs-lookup"><span data-stu-id="57638-272">This decision is often made together with multiple groups within an organization, often including a risk and compliance team, a network and platform team, and an application development team.</span></span> <span data-ttu-id="57638-273">Важно привлечь к принятию этого решения людей с хорошим пониманием требований безопасности, используемых данных и технологий. Это позволит выбрать правильный подход к безопасности для каждого элемента инфраструктуры.</span><span class="sxs-lookup"><span data-stu-id="57638-273">People with knowledge of security, the data involved, and the technologies being used should have a say in this decision to ensure the appropriate security stance for each implementation.</span></span>

> [!TIP]
> <span data-ttu-id="57638-274">Для каждого сценария лучшим решением будет наименьшее количество периметров, соответствующее требованиям безопасности.</span><span class="sxs-lookup"><span data-stu-id="57638-274">Use the smallest number of boundaries that satisfy the security requirements for a given situation.</span></span> <span data-ttu-id="57638-275">Чем больше периметров, тем сложнее будет эксплуатация и отладка системы. Кроме того, управление большим количеством периметров потребует более высоких административных расходов.</span><span class="sxs-lookup"><span data-stu-id="57638-275">With more boundaries, operations and troubleshooting can be more difficult, as well as the management overhead involved with managing the multiple boundary policies over time.</span></span> <span data-ttu-id="57638-276">При этом недостаточное количество периметров повышает риск.</span><span class="sxs-lookup"><span data-stu-id="57638-276">However, insufficient boundaries increase risk.</span></span> <span data-ttu-id="57638-277">Важно найти идеальный баланс.</span><span class="sxs-lookup"><span data-stu-id="57638-277">Finding the balance is critical.</span></span>
>
>

<span data-ttu-id="57638-278">![6]</span><span class="sxs-lookup"><span data-stu-id="57638-278">![6]</span></span>

<span data-ttu-id="57638-279">На предыдущем рисунке показано высокоуровневое представление сети с тремя границами безопасности.</span><span class="sxs-lookup"><span data-stu-id="57638-279">The preceding figure shows a high-level view of a three security boundary network.</span></span> <span data-ttu-id="57638-280">Эти границы расположены между сетью периметра и Интернетом, между частными интерфейсными и внутренними подсетями Azure и между внутренними подсетями Azure и локальной корпоративной сетью.</span><span class="sxs-lookup"><span data-stu-id="57638-280">The boundaries are between the perimeter network and the Internet, the Azure front-end and back-end private subnets, and the Azure back-end subnet and the on-premises corporate network.</span></span>

#### <a name="2-where-are-the-boundaries-located"></a><span data-ttu-id="57638-281">2) Где должны быть расположены границы?</span><span class="sxs-lookup"><span data-stu-id="57638-281">2) Where are the boundaries located?</span></span>
<span data-ttu-id="57638-282">После выбора количества периметров следует решить, где они будут расположены.</span><span class="sxs-lookup"><span data-stu-id="57638-282">Once the number of boundaries are decided, where to implement them is the next decision point.</span></span> <span data-ttu-id="57638-283">Обычно существует три варианта расположения:</span><span class="sxs-lookup"><span data-stu-id="57638-283">There are generally three choices:</span></span>

* <span data-ttu-id="57638-284">С помощью промежуточной интернет-службы (например облачного брандмауэра веб-приложения; этот вариант не рассматривается в данном документе).</span><span class="sxs-lookup"><span data-stu-id="57638-284">Using an Internet-based intermediary service (for example, a cloud-based Web application firewall, which is not discussed in this document)</span></span>
* <span data-ttu-id="57638-285">С помощью встроенных функций или виртуальных сетевых устройств в Azure.</span><span class="sxs-lookup"><span data-stu-id="57638-285">Using native features and/or network virtual appliances in Azure</span></span>
* <span data-ttu-id="57638-286">С помощью физических устройств в локальной сети.</span><span class="sxs-lookup"><span data-stu-id="57638-286">Using physical devices on the on-premises network</span></span>

<span data-ttu-id="57638-287">В сетях Azure возможны два варианта: собственные функции Azure (например балансировщики нагрузки Azure) и виртуальные сетевые устройства из экосистемы партнеров Azure (например брандмауэры Check Point).</span><span class="sxs-lookup"><span data-stu-id="57638-287">On purely Azure networks, the options are native Azure features (for example, Azure Load Balancers) or network virtual appliances from the rich partner ecosystem of Azure (for example, Check Point firewalls).</span></span>

<span data-ttu-id="57638-288">Если необходима граница между Azure и локальной сетью, устройства безопасности могут находиться на любой стороне подключения (или на обеих сразу).</span><span class="sxs-lookup"><span data-stu-id="57638-288">If a boundary is needed between Azure and an on-premises network, the security devices can reside on either side of the connection (or both sides).</span></span> <span data-ttu-id="57638-289">Таким образом, нужно принять решение о месте размещения инфраструктуры безопасности.</span><span class="sxs-lookup"><span data-stu-id="57638-289">Thus a decision must be made on the location to place security gear.</span></span>

<span data-ttu-id="57638-290">На приведенном выше рисунке границы между Интернетом и сетью и между интерфейсными и внутренними сегментами располагаются полностью внутри Azure и поэтому это должны быть собственные функции Azure или виртуальные сетевые устройства.</span><span class="sxs-lookup"><span data-stu-id="57638-290">In the previous figure, the Internet-to-perimeter network and the front-to-back-end boundaries are entirely contained within Azure, and must be either native Azure features or network virtual appliances.</span></span> <span data-ttu-id="57638-291">Устройства безопасности на границе между внутренней подсетью Azure и корпоративной сетью предприятия могут располагаться на стороне Azure или на стороне локальной сети. Возможно размещение устройств на обеих сторонах.</span><span class="sxs-lookup"><span data-stu-id="57638-291">Security devices on the boundary between Azure (back-end subnet) and the corporate network could be either on the Azure side or the on-premises side, or even a combination of devices on both sides.</span></span> <span data-ttu-id="57638-292">Каждое из решений может иметь существенные преимущества и недостатки, которые следует тщательно взвесить.</span><span class="sxs-lookup"><span data-stu-id="57638-292">There can be significant advantages and disadvantages to either option that must be seriously considered.</span></span>

<span data-ttu-id="57638-293">Например, преимущество при использовании существующей физической инфраструктуры безопасности на стороне локальной сети состоит в том, что новой инфраструктуры безопасности создавать не нужно.</span><span class="sxs-lookup"><span data-stu-id="57638-293">For example, using existing physical security gear on the on-premises network side has the advantage that no new gear is needed.</span></span> <span data-ttu-id="57638-294">Достаточно ее перенастроить.</span><span class="sxs-lookup"><span data-stu-id="57638-294">It just needs reconfiguration.</span></span> <span data-ttu-id="57638-295">Недостатком такой схемы является то, что весь трафик должен вернуться обратно из Azure в локальную сеть, чтобы он стал доступным для инфраструктуры безопасности.</span><span class="sxs-lookup"><span data-stu-id="57638-295">The disadvantage, however, is that all traffic must come back from Azure to the on-premises network to be seen by the security gear.</span></span> <span data-ttu-id="57638-296">Необходимость передачи трафика между разными сегментами сети Azure обратно в локальную сеть для применения политик безопасности может привести к значительным задержкам трафика и отрицательно повлиять на производительность приложения и на качество взаимодействия с пользователем.</span><span class="sxs-lookup"><span data-stu-id="57638-296">Thus Azure-to-Azure traffic could incur significant latency, and affect application performance and user experience, if it was forced back to the on-premises network for security policy enforcement.</span></span>

#### <a name="3-how-are-the-boundaries-implemented"></a><span data-ttu-id="57638-297">3) Как будут реализованы границы?</span><span class="sxs-lookup"><span data-stu-id="57638-297">3) How are the boundaries implemented?</span></span>
<span data-ttu-id="57638-298">К каждой границе безопасности могут применяться различные функциональные требования (например: на интернет-границе сети периметра могут потребоваться устройства IDS и правила брандмауэра, а между внутренней подсетью и сетью периметра — только списки управления доступом).</span><span class="sxs-lookup"><span data-stu-id="57638-298">Each security boundary will likely have different capability requirements (for example, IDS and firewall rules on the Internet side of the perimeter network, but only ACLs between the perimeter network and back-end subnet).</span></span> <span data-ttu-id="57638-299">Выбор используемого устройства (или устройств) зависит от конкретного сценария и требований безопасности.</span><span class="sxs-lookup"><span data-stu-id="57638-299">Deciding on which device (or how many devices) to use depends on the scenario and security requirements.</span></span> <span data-ttu-id="57638-300">В примерах 1, 2 и 3 в следующем разделе обсуждаются некоторые варианты, которыми можно воспользоваться.</span><span class="sxs-lookup"><span data-stu-id="57638-300">In the following section, examples 1, 2, and 3 discuss some options that could be used.</span></span> <span data-ttu-id="57638-301">Изучив встроенные функции сети Azure и возможности доступных для Azure устройств экосистемы партнеров, вы найдете множество других вариантов, которые позволят подобрать решение практически для любого сценария.</span><span class="sxs-lookup"><span data-stu-id="57638-301">Reviewing the Azure native network features and the devices available in Azure from the partner ecosystem shows the myriad options available to solve virtually any scenario.</span></span>

<span data-ttu-id="57638-302">Еще одним важным вопросом является метод подключения локальной сети к Azure.</span><span class="sxs-lookup"><span data-stu-id="57638-302">Another key implementation decision point is how to connect the on-premises network with Azure.</span></span> <span data-ttu-id="57638-303">Нужно ли использовать виртуальный шлюз или виртуальное сетевое устройство Azure?</span><span class="sxs-lookup"><span data-stu-id="57638-303">Should you use the Azure virtual gateway or a network virtual appliance?</span></span> <span data-ttu-id="57638-304">Эти варианты подробно описываются в следующем разделе (в примерах 4, 5 и 6).</span><span class="sxs-lookup"><span data-stu-id="57638-304">These options are discussed in greater detail in the following section (examples 4, 5, and 6).</span></span>

<span data-ttu-id="57638-305">Кроме того, может потребоваться трафик между виртуальными сетями в Azure.</span><span class="sxs-lookup"><span data-stu-id="57638-305">Additionally, traffic between virtual networks within Azure may be needed.</span></span> <span data-ttu-id="57638-306">Эти сценарии будут добавлены в будущем.</span><span class="sxs-lookup"><span data-stu-id="57638-306">These scenarios will be added in the future.</span></span>

<span data-ttu-id="57638-307">Когда будут готовы ответы на эти вопросы, обратитесь к разделу [Выбор решения](#fast-start) , чтобы убедиться, какие примеры лучше всего подходят для вашего сценария.</span><span class="sxs-lookup"><span data-stu-id="57638-307">Once you know the answers to the previous questions, the [Fast Start](#fast-start) section can help identify which examples are most appropriate for a given scenario.</span></span>

## <a name="examples-building-security-boundaries-with-azure-virtual-networks"></a><span data-ttu-id="57638-308">Примеры. Создание границ безопасности для виртуальных сетей Azure</span><span class="sxs-lookup"><span data-stu-id="57638-308">Examples: Building security boundaries with Azure virtual networks</span></span>
### <a name="example-1-build-a-perimeter-network-to-help-protect-applications-with-nsgs"></a><span data-ttu-id="57638-309">Пример 1. Создание сети периметра для защиты приложений с помощью групп безопасности сети</span><span class="sxs-lookup"><span data-stu-id="57638-309">Example 1 Build a perimeter network to help protect applications with NSGs</span></span>
<span data-ttu-id="57638-310">[Вернуться к выбору решения](#fast-start) | [Подробные инструкции по сборке для этого примера][Example1]</span><span class="sxs-lookup"><span data-stu-id="57638-310">[Back to Fast start](#fast-start) | [Detailed build instructions for this example][Example1]</span></span>

<span data-ttu-id="57638-311">[![7]][7]</span><span class="sxs-lookup"><span data-stu-id="57638-311">[![7]][7]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="57638-312">Описание среды</span><span class="sxs-lookup"><span data-stu-id="57638-312">Environment description</span></span>
<span data-ttu-id="57638-313">В этом примере используется подписка, которая содержит такие ресурсы:</span><span class="sxs-lookup"><span data-stu-id="57638-313">In this example, there is a subscription that contains the following resources:</span></span>

- <span data-ttu-id="57638-314">одну группу ресурсов.</span><span class="sxs-lookup"><span data-stu-id="57638-314">A single resource group</span></span>
- <span data-ttu-id="57638-315">виртуальную сеть с двумя подсетями (интерфейсной и внутренней);</span><span class="sxs-lookup"><span data-stu-id="57638-315">A virtual network with two subnets: “FrontEnd” and “BackEnd”</span></span>
- <span data-ttu-id="57638-316">одна группа безопасности сети, которая применяется к обеим подсетям;</span><span class="sxs-lookup"><span data-stu-id="57638-316">A Network Security Group that is applied to both subnets</span></span>
- <span data-ttu-id="57638-317">сервер Windows Server, который представляет веб-сервер приложений (IIS01);</span><span class="sxs-lookup"><span data-stu-id="57638-317">A Windows server that represents an application web server (“IIS01”)</span></span>
- <span data-ttu-id="57638-318">два сервера Windows Server, представляющих тыловые серверы приложений (AppVM01, AppVM02);</span><span class="sxs-lookup"><span data-stu-id="57638-318">Two Windows servers that represent application back-end servers (“AppVM01”, “AppVM02”)</span></span>
- <span data-ttu-id="57638-319">сервер Windows Server, который представляет DNS-сервер (DNS01).</span><span class="sxs-lookup"><span data-stu-id="57638-319">A Windows server that represents a DNS server (“DNS01”)</span></span>
- <span data-ttu-id="57638-320">общедоступный IP-адрес, связанный с веб-сервером приложения.</span><span class="sxs-lookup"><span data-stu-id="57638-320">A public IP associated with the application web server</span></span>

<span data-ttu-id="57638-321">Сценарии и шаблон Azure Resource Manager Azure доступны в [подробных инструкциях по сборке][Example1].</span><span class="sxs-lookup"><span data-stu-id="57638-321">For scripts and an Azure Resource Manager template, see the [detailed build instructions][Example1].</span></span>

#### <a name="nsg-description"></a><span data-ttu-id="57638-322">Описание группы безопасности сети</span><span class="sxs-lookup"><span data-stu-id="57638-322">NSG description</span></span>
<span data-ttu-id="57638-323">В этом примере создается группа безопасности сети, после чего в нее загружаются шесть правил.</span><span class="sxs-lookup"><span data-stu-id="57638-323">In this example, an NSG group is built and then loaded with six rules.</span></span>

> [!TIP]
> <span data-ttu-id="57638-324">Сначала необходимо создать более конкретные правила разрешения, а затем более общие правила запрета.</span><span class="sxs-lookup"><span data-stu-id="57638-324">Generally speaking, you should create your specific “Allow” rules first, followed by the more generic “Deny” rules.</span></span> <span data-ttu-id="57638-325">Порядок выполнения правил задается назначенным приоритетом.</span><span class="sxs-lookup"><span data-stu-id="57638-325">The given priority dictates which rules are evaluated first.</span></span> <span data-ttu-id="57638-326">Когда система находит правило, применимое к пакету трафика, остальные правила игнорируются.</span><span class="sxs-lookup"><span data-stu-id="57638-326">Once traffic is found to apply to a specific rule, no further rules are evaluated.</span></span> <span data-ttu-id="57638-327">Правила группы безопасности сети могут применяться во входящем или исходящем направлении (относительно подсети).</span><span class="sxs-lookup"><span data-stu-id="57638-327">NSG rules can apply in either the inbound or outbound direction (from the perspective of the subnet).</span></span>
>
>

<span data-ttu-id="57638-328">Декларативно для входящего трафика определяются следующие правила.</span><span class="sxs-lookup"><span data-stu-id="57638-328">Declaratively, the following rules are being built for inbound traffic:</span></span>

1. <span data-ttu-id="57638-329">Внутренний трафик DNS (порт 53) разрешается.</span><span class="sxs-lookup"><span data-stu-id="57638-329">Internal DNS traffic (port 53) is allowed.</span></span>
2. <span data-ttu-id="57638-330">Трафик RDP (порт 3389) из Интернета к любой виртуальной машине разрешается.</span><span class="sxs-lookup"><span data-stu-id="57638-330">RDP traffic (port 3389) from the Internet to any Virtual Machine is allowed.</span></span>
3. <span data-ttu-id="57638-331">Трафик HTTP (порт 80) из Интернета к веб-серверу (IIS01) разрешается.</span><span class="sxs-lookup"><span data-stu-id="57638-331">HTTP traffic (port 80) from the Internet to web server (IIS01) is allowed.</span></span>
4. <span data-ttu-id="57638-332">Весь трафик (все порты) от сервера IIS01 к серверу AppVM1 разрешается.</span><span class="sxs-lookup"><span data-stu-id="57638-332">Any traffic (all ports) from IIS01 to AppVM1 is allowed.</span></span>
5. <span data-ttu-id="57638-333">Весь трафик (все порты) из Интернета ко всей виртуальной сети (обе подсети) запрещается.</span><span class="sxs-lookup"><span data-stu-id="57638-333">Any traffic (all ports) from the Internet to the entire virtual network (both subnets) is denied.</span></span>
6. <span data-ttu-id="57638-334">Весь трафик (все порты) из подсети FrontEnd в подсеть BackEnd запрещается.</span><span class="sxs-lookup"><span data-stu-id="57638-334">Any traffic (all ports) from the front-end subnet to the back-end subnet is denied.</span></span>

<span data-ttu-id="57638-335">С учетом этих правил, связанных с каждой подсетью, для входящего запроса HTTP из Интернета на веб-сервер должны быть применены оба правила 3 (разрешить) и 5 (запретить).</span><span class="sxs-lookup"><span data-stu-id="57638-335">With these rules bound to each subnet, if an HTTP request was inbound from the Internet to the web server, both rules 3 (allow) and 5 (deny) would apply.</span></span> <span data-ttu-id="57638-336">Но поскольку правило 3 имеет более высокий приоритет, то будет применено только оно, а правило 5 не будет использовано.</span><span class="sxs-lookup"><span data-stu-id="57638-336">But because rule 3 has a higher priority, only it would apply, and rule 5 would not come into play.</span></span> <span data-ttu-id="57638-337">Таким образом, HTTP-запрос сможет достичь веб-сервера.</span><span class="sxs-lookup"><span data-stu-id="57638-337">Thus the HTTP request would be allowed to the web server.</span></span> <span data-ttu-id="57638-338">Если тот же трафик будет направлен к серверу DNS01, то сначала будет применено правило 5 (запретить), поэтому трафик не достигнет сервера.</span><span class="sxs-lookup"><span data-stu-id="57638-338">If that same traffic was trying to reach the DNS01 server, rule 5 (deny) would be the first to apply, and the traffic would not be allowed to pass to the server.</span></span> <span data-ttu-id="57638-339">Правило 6 (запретить) блокирует взаимодействие подсети FrontEnd с подсетью BackEnd (за исключением разрешенного трафика в правилах 1 и 4).</span><span class="sxs-lookup"><span data-stu-id="57638-339">Rule 6 (deny) blocks the front-end subnet from talking to the back-end subnet (except for allowed traffic in rules 1 and 4).</span></span> <span data-ttu-id="57638-340">Этот набор правил обеспечивает защиту внутренней сети при компрометации веб-приложения на сервере.</span><span class="sxs-lookup"><span data-stu-id="57638-340">This rule-set protects the back-end network in case an attacker compromises the web application on the front end.</span></span> <span data-ttu-id="57638-341">Злоумышленник будет иметь ограниченный доступ к "защищенной" внутренней сети (только к ресурсам, доступным на сервере AppVM01).</span><span class="sxs-lookup"><span data-stu-id="57638-341">The attacker would have limited access to the back-end “protected” network (only to resources exposed on the AppVM01 server).</span></span>

<span data-ttu-id="57638-342">Стандартное правило по умолчанию разрешает любой исходящий трафик в Интернет.</span><span class="sxs-lookup"><span data-stu-id="57638-342">There is a default outbound rule that allows traffic out to the Internet.</span></span> <span data-ttu-id="57638-343">В этом примере мы разрешаем исходящий трафик и не меняем никаких исходящих правил.</span><span class="sxs-lookup"><span data-stu-id="57638-343">For this example, we’re allowing outbound traffic and not modifying any outbound rules.</span></span> <span data-ttu-id="57638-344">Для блокировки трафика в обоих направлениях требуется определяемая пользователем маршрутизация (см. пример 3).</span><span class="sxs-lookup"><span data-stu-id="57638-344">To lock down traffic in both directions, user-defined routing is required (see example 3).</span></span>

#### <a name="conclusion"></a><span data-ttu-id="57638-345">Заключение</span><span class="sxs-lookup"><span data-stu-id="57638-345">Conclusion</span></span>
<span data-ttu-id="57638-346">Этот пример — относительно простой и эффективный способ изоляции внутренней подсети от входящего трафика.</span><span class="sxs-lookup"><span data-stu-id="57638-346">This example is a relatively simple and straightforward way of isolating the back-end subnet from inbound traffic.</span></span> <span data-ttu-id="57638-347">Дополнительные сведения см. в [подробных инструкциях по сборке][Example1].</span><span class="sxs-lookup"><span data-stu-id="57638-347">For more information, see the [detailed build instructions][Example1].</span></span> <span data-ttu-id="57638-348">Эти инструкции включают:</span><span class="sxs-lookup"><span data-stu-id="57638-348">These instructions include:</span></span>

* <span data-ttu-id="57638-349">Способы создания этой сети периметра с помощью классических скриптов PowerShell.</span><span class="sxs-lookup"><span data-stu-id="57638-349">How to build this perimeter network with classic PowerShell scripts.</span></span>
* <span data-ttu-id="57638-350">Способы создания этой сети периметра с помощью шаблона Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="57638-350">How to build this perimeter network with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="57638-351">Подробное описание каждой команды NSG.</span><span class="sxs-lookup"><span data-stu-id="57638-351">Detailed descriptions of each NSG command.</span></span>
* <span data-ttu-id="57638-352">Подробные сценарии прохождения трафика с демонстрацией разрешений и запретов на каждом уровне.</span><span class="sxs-lookup"><span data-stu-id="57638-352">Detailed traffic flow scenarios, showing how traffic is allowed or denied in each layer.</span></span>


### <a name="example-2-build-a-perimeter-network-to-help-protect-applications-with-a-firewall-and-nsgs"></a><span data-ttu-id="57638-353">Пример 2. Создание сети периметра для защиты приложений с помощью брандмауэра и групп безопасности сети (NSG)</span><span class="sxs-lookup"><span data-stu-id="57638-353">Example 2 Build a perimeter network to help protect applications with a firewall and NSGs</span></span>
<span data-ttu-id="57638-354">[Вернуться к выбору решения](#fast-start) | [Подробные инструкции по сборке для этого примера][Example2]</span><span class="sxs-lookup"><span data-stu-id="57638-354">[Back to Fast start](#fast-start) | [Detailed build instructions for this example][Example2]</span></span>

<span data-ttu-id="57638-355">[![8]][8]</span><span class="sxs-lookup"><span data-stu-id="57638-355">[![8]][8]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="57638-356">Описание среды</span><span class="sxs-lookup"><span data-stu-id="57638-356">Environment description</span></span>
<span data-ttu-id="57638-357">В этом примере используется подписка, которая содержит такие ресурсы:</span><span class="sxs-lookup"><span data-stu-id="57638-357">In this example, there is a subscription that contains the following resources:</span></span>

* <span data-ttu-id="57638-358">одну группу ресурсов.</span><span class="sxs-lookup"><span data-stu-id="57638-358">A single resource group</span></span>
* <span data-ttu-id="57638-359">виртуальную сеть с двумя подсетями (интерфейсной и внутренней);</span><span class="sxs-lookup"><span data-stu-id="57638-359">A virtual network with two subnets: “FrontEnd” and “BackEnd”</span></span>
* <span data-ttu-id="57638-360">одна группа безопасности сети, которая применяется к обеим подсетям;</span><span class="sxs-lookup"><span data-stu-id="57638-360">A Network Security Group that is applied to both subnets</span></span>
* <span data-ttu-id="57638-361">виртуальное сетевое устройство, в данном случае брандмауэр, подключенный к подсети FrontNet;</span><span class="sxs-lookup"><span data-stu-id="57638-361">A network virtual appliance, in this case a firewall, connected to the front-end subnet</span></span>
* <span data-ttu-id="57638-362">сервер Windows Server, который представляет веб-сервер приложений (IIS01);</span><span class="sxs-lookup"><span data-stu-id="57638-362">A Windows server that represents an application web server (“IIS01”)</span></span>
* <span data-ttu-id="57638-363">два сервера Windows Server, представляющих тыловые серверы приложений (AppVM01, AppVM02);</span><span class="sxs-lookup"><span data-stu-id="57638-363">Two Windows servers that represent application back-end servers (“AppVM01”, “AppVM02”)</span></span>
* <span data-ttu-id="57638-364">сервер Windows Server, который представляет DNS-сервер (DNS01).</span><span class="sxs-lookup"><span data-stu-id="57638-364">A Windows server that represents a DNS server (“DNS01”)</span></span>

<span data-ttu-id="57638-365">Сценарии и шаблон Azure Resource Manager Azure доступны в [подробных инструкциях по сборке][Example2].</span><span class="sxs-lookup"><span data-stu-id="57638-365">For scripts and an Azure Resource Manager template, see the [detailed build instructions][Example2].</span></span>

#### <a name="nsg-description"></a><span data-ttu-id="57638-366">Описание группы безопасности сети</span><span class="sxs-lookup"><span data-stu-id="57638-366">NSG description</span></span>
<span data-ttu-id="57638-367">В этом примере создается группа безопасности сети, после чего в нее загружаются шесть правил.</span><span class="sxs-lookup"><span data-stu-id="57638-367">In this example, an NSG group is built and then loaded with six rules.</span></span>

> [!TIP]
> <span data-ttu-id="57638-368">Сначала необходимо создать более конкретные правила разрешения, а затем более общие правила запрета.</span><span class="sxs-lookup"><span data-stu-id="57638-368">Generally speaking, you should create your specific “Allow” rules first, followed by the more generic “Deny” rules.</span></span> <span data-ttu-id="57638-369">Порядок выполнения правил задается назначенным приоритетом.</span><span class="sxs-lookup"><span data-stu-id="57638-369">The given priority dictates which rules are evaluated first.</span></span> <span data-ttu-id="57638-370">Когда система находит правило, применимое к пакету трафика, остальные правила игнорируются.</span><span class="sxs-lookup"><span data-stu-id="57638-370">Once traffic is found to apply to a specific rule, no further rules are evaluated.</span></span> <span data-ttu-id="57638-371">Правила группы безопасности сети могут применяться во входящем или исходящем направлении (относительно подсети).</span><span class="sxs-lookup"><span data-stu-id="57638-371">NSG rules can apply in either the inbound or outbound direction (from the perspective of the subnet).</span></span>
>
>

<span data-ttu-id="57638-372">Декларативно для входящего трафика определяются следующие правила.</span><span class="sxs-lookup"><span data-stu-id="57638-372">Declaratively, the following rules are being built for inbound traffic:</span></span>

1. <span data-ttu-id="57638-373">Внутренний трафик DNS (порт 53) разрешается.</span><span class="sxs-lookup"><span data-stu-id="57638-373">Internal DNS traffic (port 53) is allowed.</span></span>
2. <span data-ttu-id="57638-374">Трафик RDP (порт 3389) из Интернета к любой виртуальной машине разрешается.</span><span class="sxs-lookup"><span data-stu-id="57638-374">RDP traffic (port 3389) from the Internet to any Virtual Machine is allowed.</span></span>
3. <span data-ttu-id="57638-375">Весь трафик (все порты) из Интернета к серверу сетевого виртуального устройства (брандмауэр) разрешается.</span><span class="sxs-lookup"><span data-stu-id="57638-375">Any Internet traffic (all ports) to the network virtual appliance (firewall) is allowed.</span></span>
4. <span data-ttu-id="57638-376">Весь трафик (все порты) от сервера IIS01 к серверу AppVM1 разрешается.</span><span class="sxs-lookup"><span data-stu-id="57638-376">Any traffic (all ports) from IIS01 to AppVM1 is allowed.</span></span>
5. <span data-ttu-id="57638-377">Весь трафик (все порты) из Интернета ко всей виртуальной сети (обе подсети) запрещается.</span><span class="sxs-lookup"><span data-stu-id="57638-377">Any traffic (all ports) from the Internet to the entire virtual network (both subnets) is denied.</span></span>
6. <span data-ttu-id="57638-378">Весь трафик (все порты) из подсети FrontEnd в подсеть BackEnd запрещается.</span><span class="sxs-lookup"><span data-stu-id="57638-378">Any traffic (all ports) from the front-end subnet to the back-end subnet is denied.</span></span>

<span data-ttu-id="57638-379">С учетом этих правил, связанных с каждой подсетью, для входящего запроса HTTP из Интернета на брандмауэр должны быть применены оба правила 3 (разрешить) и 5 (запретить).</span><span class="sxs-lookup"><span data-stu-id="57638-379">With these rules bound to each subnet, if an HTTP request was inbound from the Internet to the firewall, both rules 3 (allow) and 5 (deny) would apply.</span></span> <span data-ttu-id="57638-380">Но поскольку правило 3 имеет более высокий приоритет, то будет применено только оно, а правило 5 не будет использовано.</span><span class="sxs-lookup"><span data-stu-id="57638-380">But because rule 3 has a higher priority, only it would apply, and rule 5 would not come into play.</span></span> <span data-ttu-id="57638-381">Таким образом, запрос HTTP сможет достичь брандмауэра.</span><span class="sxs-lookup"><span data-stu-id="57638-381">Thus the HTTP request would be allowed to the firewall.</span></span> <span data-ttu-id="57638-382">Если такой же трафик будет направлен к серверу IIS01, расположенному в подсети FrontEnd, будет применено правило 5 (запретить), поэтому трафик не сможет достичь сервера.</span><span class="sxs-lookup"><span data-stu-id="57638-382">If that same traffic was trying to reach the IIS01 server, even though it’s on the front-end subnet, rule 5 (deny) would apply, and the traffic would not be allowed to pass to the server.</span></span> <span data-ttu-id="57638-383">Правило 6 (запретить) блокирует взаимодействие подсети FrontEnd с подсетью BackEnd (за исключением разрешенного трафика в правилах 1 и 4).</span><span class="sxs-lookup"><span data-stu-id="57638-383">Rule 6 (deny) blocks the front-end subnet from talking to the back-end subnet (except for allowed traffic in rules 1 and 4).</span></span> <span data-ttu-id="57638-384">Этот набор правил обеспечивает защиту внутренней сети при компрометации веб-приложения на сервере.</span><span class="sxs-lookup"><span data-stu-id="57638-384">This rule-set protects the back-end network in case an attacker compromises the web application on the front end.</span></span> <span data-ttu-id="57638-385">Злоумышленник будет иметь ограниченный доступ к "защищенной" внутренней сети (только к ресурсам, доступным на сервере AppVM01).</span><span class="sxs-lookup"><span data-stu-id="57638-385">The attacker would have limited access to the back-end “protected” network (only to resources exposed on the AppVM01 server).</span></span>

<span data-ttu-id="57638-386">Стандартное правило по умолчанию разрешает любой исходящий трафик в Интернет.</span><span class="sxs-lookup"><span data-stu-id="57638-386">There is a default outbound rule that allows traffic out to the Internet.</span></span> <span data-ttu-id="57638-387">В этом примере мы разрешаем исходящий трафик и не меняем никаких исходящих правил.</span><span class="sxs-lookup"><span data-stu-id="57638-387">For this example, we’re allowing outbound traffic and not modifying any outbound rules.</span></span> <span data-ttu-id="57638-388">Для блокировки трафика в обоих направлениях требуется определяемая пользователем маршрутизация (см. пример 3).</span><span class="sxs-lookup"><span data-stu-id="57638-388">To lock down traffic in both directions, user-defined routing is required (see example 3).</span></span>

#### <a name="firewall-rule-description"></a><span data-ttu-id="57638-389">Описание правил брандмауэра</span><span class="sxs-lookup"><span data-stu-id="57638-389">Firewall rule description</span></span>
<span data-ttu-id="57638-390">В брандмауэре необходимо создать правила пересылки.</span><span class="sxs-lookup"><span data-stu-id="57638-390">On the firewall, forwarding rules should be created.</span></span> <span data-ttu-id="57638-391">Поскольку в этом примере входящий трафик пересылается только на брандмауэр, а затем на веб-сервер, потребуется только одно правило перенаправления для преобразования сетевых адресов (NAT).</span><span class="sxs-lookup"><span data-stu-id="57638-391">Since this example only routes Internet traffic in-bound to the firewall and then to the web server, only one forwarding network address translation (NAT) rule is needed.</span></span>

<span data-ttu-id="57638-392">Правило пересылки принимает входящий запрос с любого адреса источника, который отправляется на брандмауэр при попытке обращения к HTTP (порт 80) или к HTTPS (порт 443).</span><span class="sxs-lookup"><span data-stu-id="57638-392">The forwarding rule accepts any inbound source address that hits the firewall trying to reach HTTP (port 80 or 443 for HTTPS).</span></span> <span data-ttu-id="57638-393">Этот запрос отправляется из локального интерфейса брандмауэра и перенаправляется на веб-сервер с IP-адресом 10.0.1.5.</span><span class="sxs-lookup"><span data-stu-id="57638-393">It's sent out of the firewall’s local interface and redirected to the web server with the IP Address of 10.0.1.5.</span></span>

#### <a name="conclusion"></a><span data-ttu-id="57638-394">Заключение</span><span class="sxs-lookup"><span data-stu-id="57638-394">Conclusion</span></span>
<span data-ttu-id="57638-395">Этот пример — относительно простой способ защиты приложения с помощью брандмауэра и изоляции внутренней подсети от входящего трафика.</span><span class="sxs-lookup"><span data-stu-id="57638-395">This example is a relatively straightforward way of protecting your application with a firewall and isolating the back-end subnet from inbound traffic.</span></span> <span data-ttu-id="57638-396">Дополнительные сведения см. в [подробных инструкциях по сборке][Example2].</span><span class="sxs-lookup"><span data-stu-id="57638-396">For more information, see the [detailed build instructions][Example2].</span></span> <span data-ttu-id="57638-397">Эти инструкции включают:</span><span class="sxs-lookup"><span data-stu-id="57638-397">These instructions include:</span></span>

* <span data-ttu-id="57638-398">Способы создания этой сети периметра с помощью классических скриптов PowerShell.</span><span class="sxs-lookup"><span data-stu-id="57638-398">How to build this perimeter network with classic PowerShell scripts.</span></span>
* <span data-ttu-id="57638-399">Построение сети для этого примера с помощью шаблона Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="57638-399">How to build this example with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="57638-400">Подробное описание каждой команды группы безопасности сети и каждого правила брандмауэра.</span><span class="sxs-lookup"><span data-stu-id="57638-400">Detailed descriptions of each NSG command and firewall rule.</span></span>
* <span data-ttu-id="57638-401">Подробные сценарии прохождения трафика с демонстрацией разрешений и запретов на каждом уровне.</span><span class="sxs-lookup"><span data-stu-id="57638-401">Detailed traffic flow scenarios, showing how traffic is allowed or denied in each layer.</span></span>

### <a name="example-3-build-a-perimeter-network-to-help-protect-networks-with-a-firewall-and-udr-and-nsg"></a><span data-ttu-id="57638-402">Пример 3. Создание сети периметра для защиты сетей с помощью брандмауэра, определяемого пользователем маршрута (UDR) и группы безопасности сети (NSG).</span><span class="sxs-lookup"><span data-stu-id="57638-402">Example 3 Build a perimeter network to help protect networks with a firewall and UDR and NSG</span></span>
<span data-ttu-id="57638-403">[Вернуться к выбору решения](#fast-start) | [Подробные инструкции по сборке для этого примера][Example3]</span><span class="sxs-lookup"><span data-stu-id="57638-403">[Back to Fast start](#fast-start) | [Detailed build instructions for this example][Example3]</span></span>

<span data-ttu-id="57638-404">[![9]][9]</span><span class="sxs-lookup"><span data-stu-id="57638-404">[![9]][9]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="57638-405">Описание среды</span><span class="sxs-lookup"><span data-stu-id="57638-405">Environment description</span></span>
<span data-ttu-id="57638-406">В этом примере используется подписка, которая содержит такие ресурсы:</span><span class="sxs-lookup"><span data-stu-id="57638-406">In this example, there is a subscription that contains the following resources:</span></span>

* <span data-ttu-id="57638-407">одну группу ресурсов.</span><span class="sxs-lookup"><span data-stu-id="57638-407">A single resource group</span></span>
* <span data-ttu-id="57638-408">виртуальную сеть с тремя подсетями (SecNet, FrontEnd и BackEnd);</span><span class="sxs-lookup"><span data-stu-id="57638-408">A virtual network with three subnets: “SecNet”, “FrontEnd”, and “BackEnd”</span></span>
* <span data-ttu-id="57638-409">виртуальное сетевое устройство, в данном случае брандмауэр, подключенный к подсети SecNet;</span><span class="sxs-lookup"><span data-stu-id="57638-409">A network virtual appliance, in this case a firewall, connected to the SecNet subnet</span></span>
* <span data-ttu-id="57638-410">сервер Windows Server, который представляет веб-сервер приложений (IIS01);</span><span class="sxs-lookup"><span data-stu-id="57638-410">A Windows server that represents an application web server (“IIS01”)</span></span>
* <span data-ttu-id="57638-411">два сервера Windows Server, представляющих тыловые серверы приложений (AppVM01, AppVM02);</span><span class="sxs-lookup"><span data-stu-id="57638-411">Two Windows servers that represent application back-end servers (“AppVM01”, “AppVM02”)</span></span>
* <span data-ttu-id="57638-412">сервер Windows Server, который представляет DNS-сервер (DNS01).</span><span class="sxs-lookup"><span data-stu-id="57638-412">A Windows server that represents a DNS server (“DNS01”)</span></span>

<span data-ttu-id="57638-413">Сценарии и шаблон Azure Resource Manager Azure доступны в [подробных инструкциях по сборке][Example3].</span><span class="sxs-lookup"><span data-stu-id="57638-413">For scripts and an Azure Resource Manager template, see the [detailed build instructions][Example3].</span></span>

#### <a name="udr-description"></a><span data-ttu-id="57638-414">Описание определяемого пользователем маршрута</span><span class="sxs-lookup"><span data-stu-id="57638-414">UDR description</span></span>
<span data-ttu-id="57638-415">По умолчанию следующие системные маршруты определяются так:</span><span class="sxs-lookup"><span data-stu-id="57638-415">By default, the following system routes are defined as:</span></span>

        Effective routes :
         Address Prefix    Next hop type    Next hop IP address Status   Source     
         --------------    -------------    ------------------- ------   ------     
         {10.0.0.0/16}     VNETLocal                            Active   Default    
         {0.0.0.0/0}       Internet                             Active   Default    
         {10.0.0.0/8}      Null                                 Active   Default    
         {100.64.0.0/10}   Null                                 Active   Default    
         {172.16.0.0/12}   Null                                 Active   Default    
         {192.168.0.0/16}  Null                                 Active   Default

<span data-ttu-id="57638-416">Определенным префиксом (или префиксами) адреса для этой сети всегда является VNETLocal (то есть он меняется от одной виртуальной сети к другой в зависимости от того, как определяется каждая конкретная виртуальная сеть).</span><span class="sxs-lookup"><span data-stu-id="57638-416">The VNETLocal is always one or more defined address prefixes that make up the virtual network for that specific network (that is, it changes from virtual network to virtual network, depending on how each specific virtual network is defined).</span></span> <span data-ttu-id="57638-417">Остальные системные маршруты — статические и заданы по умолчанию, как указано в таблице.</span><span class="sxs-lookup"><span data-stu-id="57638-417">The remaining system routes are static and default as indicated in the table.</span></span>

<span data-ttu-id="57638-418">В этом примере создаются две таблицы маршрутизации, одна для подсети FrontEnd и другая для подсети BackEnd.</span><span class="sxs-lookup"><span data-stu-id="57638-418">In this example, two routing tables are created, one each for the front-end and back-end subnets.</span></span> <span data-ttu-id="57638-419">В каждую таблицу загружены статические маршруты для данной подсети.</span><span class="sxs-lookup"><span data-stu-id="57638-419">Each table is loaded with static routes appropriate for the given subnet.</span></span> <span data-ttu-id="57638-420">В данном примере в каждой таблице есть три маршрута, которые направляют весь трафик (0.0.0.0/0) через брандмауэр (следующий прыжок = IP-адрес виртуального устройства):</span><span class="sxs-lookup"><span data-stu-id="57638-420">In this example, each table has three routes that direct all traffic (0.0.0.0/0) through the firewall (Next hop = Virtual Appliance IP address):</span></span>

1. <span data-ttu-id="57638-421">Для трафика локальной подсети значение следующего прыжка не указано, что позволяет трафику локальной подсети обходить брандмауэр.</span><span class="sxs-lookup"><span data-stu-id="57638-421">Local subnet traffic with no Next Hop defined to allow local subnet traffic to bypass the firewall.</span></span>
2. <span data-ttu-id="57638-422">Для трафика виртуальной сети значением следующего прыжка установлен адрес брандмауэра.</span><span class="sxs-lookup"><span data-stu-id="57638-422">Virtual network traffic with a Next Hop defined as firewall.</span></span> <span data-ttu-id="57638-423">Это значение переопределяет правило по умолчанию, которое разрешает прямое прохождение трафика виртуальной локальной сети.</span><span class="sxs-lookup"><span data-stu-id="57638-423">This next hop overrides the default rule that allows local virtual network traffic to route directly.</span></span>
3. <span data-ttu-id="57638-424">Для всего остального трафика (0/0) в качестве значения следующего прыжка задан адрес брандмауэра.</span><span class="sxs-lookup"><span data-stu-id="57638-424">All remaining traffic (0/0) with a Next Hop defined as the firewall.</span></span>

> [!TIP]
> <span data-ttu-id="57638-425">Отсутствие записи локальной подсети в UDR приведет к разрыву подключений локальной подсети.</span><span class="sxs-lookup"><span data-stu-id="57638-425">Not having the local subnet entry in the UDR breaks local subnet communications.</span></span>
>
> * <span data-ttu-id="57638-426">В нашем примере адрес 10.0.1.0/24, указывающий на VNETLocal, является критически важным!</span><span class="sxs-lookup"><span data-stu-id="57638-426">In our example, 10.0.1.0/24 pointing to VNETLocal is critical!</span></span> <span data-ttu-id="57638-427">При его отсутствии пакет, отправляемый с веб-сервера (10.0.1.4) на другой локальный сервер (например, 10.0.1.25), будет вместо этого отправлен на виртуальное сетевое устройство (NVA).</span><span class="sxs-lookup"><span data-stu-id="57638-427">Without it, packet leaving the Web Server (10.0.1.4) destined to another local server (for example) 10.0.1.25 will fail as they will be sent to the NVA.</span></span> <span data-ttu-id="57638-428">NVA отправит его в подсеть, а подсеть снова отправит его на NVA, что приводит к возникновению бесконечного цикла.</span><span class="sxs-lookup"><span data-stu-id="57638-428">The NVA will send it to the subnet, and the subnet will resend it to the NVA in an infinite loop.</span></span>
> * <span data-ttu-id="57638-429">Вероятность зацикливания маршрутизации обычно выше в устройствах с несколькими сетевыми адаптерами, подключенных к отдельным подсетям. Часто это традиционные локальные устройства.</span><span class="sxs-lookup"><span data-stu-id="57638-429">The chances of a routing loop are typically higher on appliances with multiple NICs that are connected to separate subnets, which is often of traditional, on-premises appliances.</span></span>
>
>

<span data-ttu-id="57638-430">После создания таблиц маршрутизации они должны быть привязаны к соответствующим подсетям.</span><span class="sxs-lookup"><span data-stu-id="57638-430">Once the routing tables are created, they must be bound to their subnets.</span></span> <span data-ttu-id="57638-431">После создания и привязки таблица маршрутизации подсети FrontEnd будет выглядеть так:</span><span class="sxs-lookup"><span data-stu-id="57638-431">The front-end subnet routing table, once created and bound to the subnet, would look like this output:</span></span>

        Effective routes :
         Address Prefix    Next hop type    Next hop IP address Status   Source     
         --------------    -------------    ------------------- ------   ------     
         {10.0.1.0/24}     VNETLocal                            Active
         {10.0.0.0/16}     VirtualAppliance 10.0.0.4            Active    
         {0.0.0.0/0}       VirtualAppliance 10.0.0.4            Active

> [!NOTE]
> <span data-ttu-id="57638-432">UDR теперь можно применять к подсети шлюза, к которой подключен канал ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="57638-432">UDR can now be applied to the gateway subnet on which the ExpressRoute circuit is connected.</span></span>
>
> <span data-ttu-id="57638-433">Примеры включения сети периметра с помощью ExpressRoute или подключением типа "сеть-сеть" показаны в примерах 3 и 4.</span><span class="sxs-lookup"><span data-stu-id="57638-433">Examples of how to enable your perimeter network with ExpressRoute or site-to-site networking are shown in examples 3 and 4.</span></span>
>
>

#### <a name="ip-forwarding-description"></a><span data-ttu-id="57638-434">Описание IP-пересылки</span><span class="sxs-lookup"><span data-stu-id="57638-434">IP Forwarding description</span></span>
<span data-ttu-id="57638-435">IP-пересылка всегда используется вместе с определяемым пользователем маршрутом.</span><span class="sxs-lookup"><span data-stu-id="57638-435">IP Forwarding is a companion feature to UDR.</span></span> <span data-ttu-id="57638-436">Это параметр для виртуального устройства, который позволяет принимать не адресованный устройству трафик и пересылать его конечному получателю.</span><span class="sxs-lookup"><span data-stu-id="57638-436">IP Forwarding is a setting on a virtual appliance that allows it to receive traffic not specifically addressed to the appliance, and then forward that traffic to its ultimate destination.</span></span>

<span data-ttu-id="57638-437">Например, при поступлении трафика от AppVM01 с запросом к серверу DNS01 определяемый пользователем маршрут направит такой трафик брандмауэру.</span><span class="sxs-lookup"><span data-stu-id="57638-437">For example, if AppVM01 makes a request to the DNS01 server, UDR would route this traffic to the firewall.</span></span> <span data-ttu-id="57638-438">При включенной IP-пересылке трафик с указанным назначением DNS01 (10.0.2.4) будет принят устройством (10.0.0.4) и затем передан конечному получателю (10.0.2.4).</span><span class="sxs-lookup"><span data-stu-id="57638-438">With IP Forwarding enabled, the traffic for the DNS01 destination (10.0.2.4) is accepted by the appliance (10.0.0.4) and then forwarded to its ultimate destination (10.0.2.4).</span></span> <span data-ttu-id="57638-439">Если IP-пересылка на брандмауэре не разрешена, такой трафик не будет принят устройством, даже если в качестве следующего прыжка в таблице маршрутизации указан брандмауэр.</span><span class="sxs-lookup"><span data-stu-id="57638-439">Without IP Forwarding enabled on the firewall, traffic would not be accepted by the appliance even though the route table has the firewall as the next hop.</span></span> <span data-ttu-id="57638-440">Для использования виртуального устройства важно не забыть включить IP-пересылку и определяемые пользователем маршруты.</span><span class="sxs-lookup"><span data-stu-id="57638-440">To use a virtual appliance, it’s critical to remember to enable IP Forwarding along with UDR.</span></span>

#### <a name="nsg-description"></a><span data-ttu-id="57638-441">Описание группы безопасности сети</span><span class="sxs-lookup"><span data-stu-id="57638-441">NSG description</span></span>
<span data-ttu-id="57638-442">В этом примере создается группа безопасности сети, после чего в нее загружается одно правило.</span><span class="sxs-lookup"><span data-stu-id="57638-442">In this example, an NSG group is built and then loaded with a single rule.</span></span> <span data-ttu-id="57638-443">Затем эта группа привязывается только к подсетям Frontend и Backend (не SecNet).</span><span class="sxs-lookup"><span data-stu-id="57638-443">This group is then bound only to the front-end and back-end subnets (not the SecNet).</span></span> <span data-ttu-id="57638-444">Декларативно создается следующее правило:</span><span class="sxs-lookup"><span data-stu-id="57638-444">Declaratively the following rule is being built:</span></span>

* <span data-ttu-id="57638-445">Весь трафик (все порты) из Интернета ко всей виртуальной сети (все подсети) запрещается.</span><span class="sxs-lookup"><span data-stu-id="57638-445">Any traffic (all ports) from the Internet to the entire virtual network (all subnets) is denied.</span></span>

<span data-ttu-id="57638-446">В этом примере используются группы безопасности сети, но его основной целью является создание дополнительного уровня защиты от неправильной настройки вручную.</span><span class="sxs-lookup"><span data-stu-id="57638-446">Although NSGs are used in this example, its main purpose is as a secondary layer of defense against manual misconfiguration.</span></span> <span data-ttu-id="57638-447">Целью этого примера является блокировка всего входящего трафика из Интернета в подсети FrontEnd и BackEnd.</span><span class="sxs-lookup"><span data-stu-id="57638-447">The goal is to block all inbound traffic from the Internet to either the front-end or back-end subnets.</span></span> <span data-ttu-id="57638-448">Трафик должен проходить только через подсеть SecNet на брандмауэр (и затем при необходимости в подсети FrontEnd и BackEnd).</span><span class="sxs-lookup"><span data-stu-id="57638-448">Traffic should only flow through the SecNet subnet to the firewall (and then, if appropriate, on to the front-end or back-end subnets).</span></span> <span data-ttu-id="57638-449">Кроме того, если установлены правила определяемых пользователем маршрутов, любой трафик, поступивший в подсети FrontEnd и BackEnd, будет направляться на брандмауэр (благодаря наличию определяемых пользователем маршрутов).</span><span class="sxs-lookup"><span data-stu-id="57638-449">Plus, with the UDR rules in place, any traffic that did make it into the front-end or back-end subnets would be directed out to the firewall (thanks to UDR).</span></span> <span data-ttu-id="57638-450">Брандмауэр воспримет это как асимметричный поток и отбросит исходящий трафик.</span><span class="sxs-lookup"><span data-stu-id="57638-450">The firewall would see this traffic as an asymmetric flow and would drop the outbound traffic.</span></span> <span data-ttu-id="57638-451">Таким образом, существует три уровня безопасности для защиты подсетей:</span><span class="sxs-lookup"><span data-stu-id="57638-451">Thus there are three layers of security protecting the subnets:</span></span>

* <span data-ttu-id="57638-452">На сетевых адаптерах подсети FrontEnd или BackEnd нет общедоступных IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="57638-452">No Public IP addresses on any FrontEnd or BackEnd NICs.</span></span>
* <span data-ttu-id="57638-453">Группы безопасности сети отклоняют трафик из Интернета.</span><span class="sxs-lookup"><span data-stu-id="57638-453">NSGs denying traffic from the Internet.</span></span>
* <span data-ttu-id="57638-454">Брандмауэр отбрасывает асимметричный трафик.</span><span class="sxs-lookup"><span data-stu-id="57638-454">The firewall dropping asymmetric traffic.</span></span>

<span data-ttu-id="57638-455">В этом примере есть интересная особенность, касающаяся сетевой группы безопасности. В нем содержится только одно правило, которое запрещает трафик из Интернета ко всей виртуальной сети, включая подсеть безопасности.</span><span class="sxs-lookup"><span data-stu-id="57638-455">One interesting point regarding the NSG in this example is that it contains only one rule, which is to deny Internet traffic to the entire virtual network, including the Security subnet.</span></span> <span data-ttu-id="57638-456">Однако, так как сетевая группа безопасности привязана только к подсетям FrontEnd и BackEnd, это правило не применяется к входящему трафику подсети безопасности.</span><span class="sxs-lookup"><span data-stu-id="57638-456">However, since the NSG is only bound to the front-end and back-end subnets, the rule isn’t processed on traffic inbound to the Security subnet.</span></span> <span data-ttu-id="57638-457">В результате трафик будет проходить в подсеть безопасности.</span><span class="sxs-lookup"><span data-stu-id="57638-457">As a result, traffic flows to the Security subnet.</span></span>

#### <a name="firewall-rules"></a><span data-ttu-id="57638-458">Правила файрволла</span><span class="sxs-lookup"><span data-stu-id="57638-458">Firewall rules</span></span>
<span data-ttu-id="57638-459">В брандмауэре необходимо создать правила пересылки.</span><span class="sxs-lookup"><span data-stu-id="57638-459">On the firewall, forwarding rules should be created.</span></span> <span data-ttu-id="57638-460">Так как брандмауэр блокирует или пересылает весь входящий, исходящий и внутренний трафик виртуальной сети, необходимо задать большое количество правил брандмауэра.</span><span class="sxs-lookup"><span data-stu-id="57638-460">Since the firewall is blocking or forwarding all inbound, outbound, and intra-virtual network traffic, many firewall rules are needed.</span></span> <span data-ttu-id="57638-461">Кроме того, весь входящий трафик будет попадать на общедоступный IP-адрес службы безопасности (на разных портах) для последующей обработки брандмауэром.</span><span class="sxs-lookup"><span data-stu-id="57638-461">Also, all inbound traffic hits the Security Service public IP address (on different ports), to be processed by the firewall.</span></span> <span data-ttu-id="57638-462">Прежде чем настраивать подсети и правила брандмауэра, рекомендуем составить схему логических потоков, чтобы позже не пришлось все переделывать.</span><span class="sxs-lookup"><span data-stu-id="57638-462">A best practice is to diagram the logical flows before setting up the subnets and firewall rules, to avoid rework later.</span></span> <span data-ttu-id="57638-463">Следующий рисунок является логическим представлением правил брандмауэра для этого примера.</span><span class="sxs-lookup"><span data-stu-id="57638-463">The following figure is a logical view of the firewall rules for this example:</span></span>

<span data-ttu-id="57638-464">![10]</span><span class="sxs-lookup"><span data-stu-id="57638-464">![10]</span></span>

> [!NOTE]
> <span data-ttu-id="57638-465">Порты управления будут различными в зависимости от используемого виртуального сетевого устройства.</span><span class="sxs-lookup"><span data-stu-id="57638-465">Based on the Network Virtual Appliance used, the management ports vary.</span></span> <span data-ttu-id="57638-466">В этом примере брандмауэр Barracuda NextGen Firewall использует порты 22, 801 и 807.</span><span class="sxs-lookup"><span data-stu-id="57638-466">In this example, a Barracuda NextGen Firewall is referenced, which uses ports 22, 801, and 807.</span></span> <span data-ttu-id="57638-467">Обратитесь к документации поставщика устройства, чтобы точно знать, какие порты используются для управления устройством.</span><span class="sxs-lookup"><span data-stu-id="57638-467">Consult the appliance vendor documentation to find the exact ports used for management of the device being used.</span></span>
>
>

#### <a name="firewall-rules-description"></a><span data-ttu-id="57638-468">Описание правила брандмауэра</span><span class="sxs-lookup"><span data-stu-id="57638-468">Firewall rules description</span></span>
<span data-ttu-id="57638-469">На приведенной выше логической схеме не отображена подсеть безопасности, так как брандмауэр является единственным ресурсом в этой подсети.</span><span class="sxs-lookup"><span data-stu-id="57638-469">In the preceding logical diagram, the security subnet is not shown because the firewall is the only resource on that subnet.</span></span> <span data-ttu-id="57638-470">Кроме того, вместо фактического пути маршрутизации на схеме показаны правила брандмауэра и логика разрешения или запрета трафика.</span><span class="sxs-lookup"><span data-stu-id="57638-470">The diagram is showing the firewall rules and how they logically allow or deny traffic flows, not the actual routed path.</span></span> <span data-ttu-id="57638-471">Также внешние порты, выбранные для трафика RDP, являются портами более высокого диапазона (8014–8026) и были выделены для совмещения с последними двумя октетами локального IP-адреса, чтобы адреса было удобнее читать (например, адрес локального сервера 10.0.1.4 связан с внешним портом 8014).</span><span class="sxs-lookup"><span data-stu-id="57638-471">Also, the external ports selected for the RDP traffic are higher ranged ports (8014 – 8026) and were selected to loosely align with the last two octets of the local IP address for easier readability (for example, local server address 10.0.1.4 is associated with external port 8014).</span></span> <span data-ttu-id="57638-472">Тем не менее можно использовать любые неконфликтующие порты более высокого диапазона.</span><span class="sxs-lookup"><span data-stu-id="57638-472">Any higher non-conflicting ports, however, could be used.</span></span>

<span data-ttu-id="57638-473">В этом примере нам нужно семь типов правил:</span><span class="sxs-lookup"><span data-stu-id="57638-473">For this example, we need seven types of rules:</span></span>

* <span data-ttu-id="57638-474">Внешние правила (для входящего трафика).</span><span class="sxs-lookup"><span data-stu-id="57638-474">External rules (for inbound traffic):</span></span>
  1. <span data-ttu-id="57638-475">Правило управления брандмауэром. Это правило перенаправления приложения разрешает пересылать трафик на порты управления виртуального сетевого устройства.</span><span class="sxs-lookup"><span data-stu-id="57638-475">Firewall management rule: This App Redirect rule allows traffic to pass to the management ports of the network virtual appliance.</span></span>
  2. <span data-ttu-id="57638-476">Правила RDP (для каждого сервера Windows Server). Эти четыре правила (по одному для каждого сервера) позволяют управлять серверами через RDP.</span><span class="sxs-lookup"><span data-stu-id="57638-476">RDP rules (for each Windows server): These four rules (one for each server) allow management of the individual servers via RDP.</span></span> <span data-ttu-id="57638-477">Четыре правила RDP можно объединить в одно, если виртуальное сетевое устройство поддерживает такую возможность.</span><span class="sxs-lookup"><span data-stu-id="57638-477">The four RDP rules could also be collapsed into one rule, depending on the capabilities of the network virtual appliance being used.</span></span>
  3. <span data-ttu-id="57638-478">Правила трафика приложений. Существует два правила трафика приложений: первое — для веб-трафика подсети FrontEnd, а второе — для трафика подсети BackEnd (например, от веб-сервера к уровню данных).</span><span class="sxs-lookup"><span data-stu-id="57638-478">Application traffic rules: There are two of these rules, the first for the front-end web traffic, and the second for the back-end traffic (for example, web server to data tier).</span></span> <span data-ttu-id="57638-479">Параметры этих правил будут зависеть от архитектуры сети размещения серверов и характеристик потоков трафика (направление потока и используемые порты).</span><span class="sxs-lookup"><span data-stu-id="57638-479">The configuration of these rules depends on the network architecture (where your servers are placed) and traffic flows (which direction the traffic flows, and which ports are used).</span></span>
     * <span data-ttu-id="57638-480">Первое правило позволяет фактическому трафику приложения достичь сервера приложений.</span><span class="sxs-lookup"><span data-stu-id="57638-480">The first rule allows the actual application traffic to reach the application server.</span></span> <span data-ttu-id="57638-481">Если другие правила необходимы для безопасности и управления, то правила трафика приложений позволяют внешним пользователям и службам взаимодействовать с приложениями.</span><span class="sxs-lookup"><span data-stu-id="57638-481">While the other rules allow for security and management, application traffic rules are what allow external users or services to access the applications.</span></span> <span data-ttu-id="57638-482">В этом примере используется один веб-сервер с портом 80.</span><span class="sxs-lookup"><span data-stu-id="57638-482">For this example, there is a single web server on port 80.</span></span> <span data-ttu-id="57638-483">Поэтому на брандмауэре потребуется одно правило приложения, которое принимает входящий трафик на внешний IP-адрес и переправляет его на внутренний IP-адрес веб-серверов.</span><span class="sxs-lookup"><span data-stu-id="57638-483">Thus a single firewall application rule redirects inbound traffic to the external IP, to the web servers internal IP address.</span></span> <span data-ttu-id="57638-484">Затем этот трафик обрабатывается службой NAT (преобразование сетевых адресов) и передается на внутренний сервер.</span><span class="sxs-lookup"><span data-stu-id="57638-484">The redirected traffic session would be translated via NAT to the internal server.</span></span>
     * <span data-ttu-id="57638-485">Второе правило трафика приложения используется для подсети BackEnd. Оно разрешает веб-серверу обращаться к серверу AppVM01 (но не AppVM02) через любой порт.</span><span class="sxs-lookup"><span data-stu-id="57638-485">The second rule is the back-end rule to allow the web server to talk to the AppVM01 server (but not AppVM02) via any port.</span></span>
* <span data-ttu-id="57638-486">Внутренние правила (для трафика внутри виртуальной сети)</span><span class="sxs-lookup"><span data-stu-id="57638-486">Internal rules (for intra-virtual network traffic)</span></span>
  1. <span data-ttu-id="57638-487">Правило для исходящего трафика в Интернет. Это правило разрешает передачу трафика из любой сети в указанные сети.</span><span class="sxs-lookup"><span data-stu-id="57638-487">Outbound to Internet rule: This rule allows traffic from any network to pass to the selected networks.</span></span> <span data-ttu-id="57638-488">Обычно это правило является заданным в брандмауэре по умолчанию и при этом отключенным.</span><span class="sxs-lookup"><span data-stu-id="57638-488">This rule is usually a default rule already on the firewall, but in a disabled state.</span></span> <span data-ttu-id="57638-489">В нашем примере это правило следует активировать.</span><span class="sxs-lookup"><span data-stu-id="57638-489">This rule should be enabled for this example.</span></span>
  2. <span data-ttu-id="57638-490">Правило DNS. Это правило разрешает передавать на DNS-сервер только трафик DNS (порт 53).</span><span class="sxs-lookup"><span data-stu-id="57638-490">DNS rule: This rule allows only DNS (port 53) traffic to pass to the DNS server.</span></span> <span data-ttu-id="57638-491">Для этой среды блокируется большая часть трафика от интерфейсной подсети к серверной части.</span><span class="sxs-lookup"><span data-stu-id="57638-491">For this environment, most traffic from the front end to the back end is blocked.</span></span> <span data-ttu-id="57638-492">В частности, это правило явно разрешает трафик DNS из любой локальной подсети.</span><span class="sxs-lookup"><span data-stu-id="57638-492">This rule specifically allows DNS from any local subnet.</span></span>
  3. <span data-ttu-id="57638-493">Правило трафика между подсетями. Это правило позволяет любому серверу внутренней подсети подключаться к любому серверу в подсети переднего плана (но не наоборот).</span><span class="sxs-lookup"><span data-stu-id="57638-493">Subnet to subnet rule: This rule is to allow any server on the back-end subnet to connect to any server on the front-end subnet (but not the reverse).</span></span>
* <span data-ttu-id="57638-494">Резервное правило (для трафика, который не соответствует указанным выше правилам).</span><span class="sxs-lookup"><span data-stu-id="57638-494">Fail-safe rule (for traffic that doesn’t meet any of the previous):</span></span>
  1. <span data-ttu-id="57638-495">Правило запрета любого трафика. Это правило всегда должно быть последним (по приоритету). Если трафик не соответствует ни одному из предыдущих правил, он будет отклонен этим правилом.</span><span class="sxs-lookup"><span data-stu-id="57638-495">Deny all traffic rule: This deny rule should always be the final rule (in terms of priority), and as such if a traffic flow fails to match any of the preceding rules it is dropped by this rule.</span></span> <span data-ttu-id="57638-496">Это правило по умолчанию обычно уже установлено и активировано.</span><span class="sxs-lookup"><span data-stu-id="57638-496">This rule is a default rule and usually in-place and active.</span></span> <span data-ttu-id="57638-497">Поэтому оно не требует дополнительных действий.</span><span class="sxs-lookup"><span data-stu-id="57638-497">No modifications are usually needed to this rule.</span></span>

> [!TIP]
> <span data-ttu-id="57638-498">Для второго приложения это правило трафика упрощается, разрешая трафик для всех портов.</span><span class="sxs-lookup"><span data-stu-id="57638-498">On the second application traffic rule, to simplify this example, any port is allowed.</span></span> <span data-ttu-id="57638-499">В реальном сценарии следует использовать максимально узкие диапазоны адресов и номеров портов, чтобы снизить возможность потенциальной атаки.</span><span class="sxs-lookup"><span data-stu-id="57638-499">In a real scenario, the most specific port and address ranges should be used to reduce the attack surface of this rule.</span></span>
>
>

<span data-ttu-id="57638-500">После создания приведенных выше правил обязательно проверьте приоритет каждого правила, чтобы разрешения и запреты трафика выполнялись надлежащим образом.</span><span class="sxs-lookup"><span data-stu-id="57638-500">Once the previous rules are created, it’s important to review the priority of each rule to ensure traffic is allowed or denied as desired.</span></span> <span data-ttu-id="57638-501">В нашем примере правила расположены в порядке приоритета.</span><span class="sxs-lookup"><span data-stu-id="57638-501">For this example, the rules are in priority order.</span></span>

#### <a name="conclusion"></a><span data-ttu-id="57638-502">Заключение</span><span class="sxs-lookup"><span data-stu-id="57638-502">Conclusion</span></span>
<span data-ttu-id="57638-503">Это более сложный, но и более полноценный способ защиты и изоляции сети по сравнению с предыдущими примерами.</span><span class="sxs-lookup"><span data-stu-id="57638-503">This example is a more complex but complete way of protecting and isolating the network than the previous examples.</span></span> <span data-ttu-id="57638-504">(Пример 2 защищает только приложение, а пример 1 лишь изолирует подсети.)</span><span class="sxs-lookup"><span data-stu-id="57638-504">(Example 2 protects just the application, and Example 1 just isolates subnets).</span></span> <span data-ttu-id="57638-505">Такая схема позволяет контролировать трафик, идущий в обоих направлениях. Она не только защищает сервер приложений от входящего трафика, но и применяет политику сетевой безопасности для всех серверов в сети.</span><span class="sxs-lookup"><span data-stu-id="57638-505">This design allows for monitoring traffic in both directions, and protects not just the inbound application server but enforces network security policy for all servers on this network.</span></span> <span data-ttu-id="57638-506">Кроме того, если позволяет используемое устройство, может осуществляться полный аудит и контроль трафика.</span><span class="sxs-lookup"><span data-stu-id="57638-506">Also, depending on the appliance used, full traffic auditing and awareness can be achieved.</span></span> <span data-ttu-id="57638-507">Дополнительные сведения см. в [подробных инструкциях по сборке][Example3].</span><span class="sxs-lookup"><span data-stu-id="57638-507">For more information, see the [detailed build instructions][Example3].</span></span> <span data-ttu-id="57638-508">Эти инструкции включают:</span><span class="sxs-lookup"><span data-stu-id="57638-508">These instructions include:</span></span>

* <span data-ttu-id="57638-509">Создание сети периметра для этого примера с помощью классических скриптов PowerShell.</span><span class="sxs-lookup"><span data-stu-id="57638-509">How to build this example perimeter network with classic PowerShell scripts.</span></span>
* <span data-ttu-id="57638-510">Построение сети для этого примера с помощью шаблона Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="57638-510">How to build this example with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="57638-511">Подробное описание каждой команды UDR, NSG и правил брандмауэра.</span><span class="sxs-lookup"><span data-stu-id="57638-511">Detailed descriptions of each UDR, NSG command, and firewall rule.</span></span>
* <span data-ttu-id="57638-512">Подробные сценарии прохождения трафика с демонстрацией разрешений и запретов на каждом уровне.</span><span class="sxs-lookup"><span data-stu-id="57638-512">Detailed traffic flow scenarios, showing how traffic is allowed or denied in each layer.</span></span>

### <a name="example-4-add-a-hybrid-connection-with-a-site-to-site-virtual-appliance-vpn"></a><span data-ttu-id="57638-513">Пример 4. Добавление гибридного подключения типа "сеть — сеть" и виртуального VPN-устройства</span><span class="sxs-lookup"><span data-stu-id="57638-513">Example 4 Add a hybrid connection with a site-to-site, virtual appliance VPN</span></span>
<span data-ttu-id="57638-514">[Вернуться к выбору решения](#fast-start) | Подробные инструкции по сборке ожидаются в ближайшее время</span><span class="sxs-lookup"><span data-stu-id="57638-514">[Back to Fast start](#fast-start) | Detailed build instructions available soon</span></span>

<span data-ttu-id="57638-515">[![11]][11]</span><span class="sxs-lookup"><span data-stu-id="57638-515">[![11]][11]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="57638-516">Описание среды</span><span class="sxs-lookup"><span data-stu-id="57638-516">Environment description</span></span>
<span data-ttu-id="57638-517">Гибридную сеть, использующую виртуальное сетевое устройство (NVA), можно добавить к сети периметра в любом из предыдущих примеров (1, 2 или 3).</span><span class="sxs-lookup"><span data-stu-id="57638-517">Hybrid networking using a network virtual appliance (NVA) can be added to any of the perimeter network types described in examples 1, 2, or 3.</span></span>

<span data-ttu-id="57638-518">Как показано на приведенном выше рисунке, для подключения локальной сети к виртуальной сети Azure через виртуальное сетевое устройство используется VPN-подключение через Интернет (типа "сеть-сеть").</span><span class="sxs-lookup"><span data-stu-id="57638-518">As shown in the previous figure, a VPN connection over the Internet (site-to-site) is used to connect an on-premises network to an Azure virtual network via an NVA.</span></span>

> [!NOTE]
> <span data-ttu-id="57638-519">При использовании ExpressRoute с включенным общедоступным пирингом Azure необходимо создать статический маршрут.</span><span class="sxs-lookup"><span data-stu-id="57638-519">If you use ExpressRoute with the Azure Public Peering option enabled, a static route should be created.</span></span> <span data-ttu-id="57638-520">Он должен выполнять маршрутизацию на IP-адрес VPN виртуального сетевого устройства за пределами корпоративной сети и не использовать подключение ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="57638-520">This static route should route to the NVA VPN IP address out your corporate Internet and not via the ExpressRoute connection.</span></span> <span data-ttu-id="57638-521">Преобразование сетевых адресов (NAT), которое необходимо для общедоступного пиринга Azure в ExpressRoute, может привести к разрыву сеанса VPN.</span><span class="sxs-lookup"><span data-stu-id="57638-521">The NAT required on the ExpressRoute Azure Public Peering option can break the VPN session.</span></span>
>
>

<span data-ttu-id="57638-522">После подключения VPN виртуальное сетевое устройство становится центральным "концентратором" для всех сетей и подсетей.</span><span class="sxs-lookup"><span data-stu-id="57638-522">Once the VPN is in place, the NVA becomes the central hub for all networks and subnets.</span></span> <span data-ttu-id="57638-523">Правила пересылки брандмауэра определяют, какие потоки трафика пропускаются, какие преобразуются с помощью NAT и какие — перенаправляются или отбрасываются (даже для потоков трафика между локальной сетью и Azure).</span><span class="sxs-lookup"><span data-stu-id="57638-523">The firewall forwarding rules determine which traffic flows are allowed, are translated via NAT, are redirected, or are dropped (even for traffic flows between the on-premises network and Azure).</span></span>

<span data-ttu-id="57638-524">Потоки трафика следует тщательно планировать, так как такая схема сети может оптимизировать или ухудшить их в зависимости от конкретного сценария использования.</span><span class="sxs-lookup"><span data-stu-id="57638-524">Traffic flows should be considered carefully, as they can be optimized or degraded by this design pattern, depending on the specific use case.</span></span>

<span data-ttu-id="57638-525">Взяв среду, созданную в примере 3, и добавив к ней гибридное сетевое VPN-подключение типа "сеть-сеть", мы получим следующую схему:</span><span class="sxs-lookup"><span data-stu-id="57638-525">Using the environment built in example 3, and then adding a site-to-site VPN hybrid network connection, produces the following design:</span></span>

<span data-ttu-id="57638-526">[![12]][12]</span><span class="sxs-lookup"><span data-stu-id="57638-526">[![12]][12]</span></span>

<span data-ttu-id="57638-527">Роль VPN-клиента будет играть локальный маршрутизатор или любое другое сетевое устройство, совместимое с виртуальным сетевым устройством для VPN.</span><span class="sxs-lookup"><span data-stu-id="57638-527">The on-premises router, or any other network device that is compatible with your NVA for VPN, would be the VPN client.</span></span> <span data-ttu-id="57638-528">Это физическое устройство будет выполнять запуск и поддержание VPN-подключения с вашим виртуальным сетевым устройством.</span><span class="sxs-lookup"><span data-stu-id="57638-528">This physical device would be responsible for initiating and maintaining the VPN connection with your NVA.</span></span>

<span data-ttu-id="57638-529">С точки зрения виртуального сетевого устройства сеть логически разделена на четыре отдельные "зоны безопасности", а трафик между этими зонами контролируется правилами, установленными на виртуальном сетевом устройстве.</span><span class="sxs-lookup"><span data-stu-id="57638-529">Logically to the NVA, the network looks like four separate “security zones” with the rules on the NVA being the primary director of traffic between these zones:</span></span>

<span data-ttu-id="57638-530">![13]</span><span class="sxs-lookup"><span data-stu-id="57638-530">![13]</span></span>

#### <a name="conclusion"></a><span data-ttu-id="57638-531">Заключение</span><span class="sxs-lookup"><span data-stu-id="57638-531">Conclusion</span></span>
<span data-ttu-id="57638-532">Добавление гибридного сетевого VPN-подключения типа "сеть-сеть" к виртуальной сети Azure позволяет безопасно расширить локальную сеть в Azure.</span><span class="sxs-lookup"><span data-stu-id="57638-532">The addition of a site-to-site VPN hybrid network connection to an Azure virtual network can extend the on-premises network into Azure in a secure manner.</span></span> <span data-ttu-id="57638-533">При использовании VPN-подключения трафик шифруется и передается через Интернет.</span><span class="sxs-lookup"><span data-stu-id="57638-533">In using a VPN connection, your traffic is encrypted and routes via the Internet.</span></span> <span data-ttu-id="57638-534">Виртуальное сетевое устройство в этом примере представляет собой централизованное расположение для применения и управления политикой безопасности.</span><span class="sxs-lookup"><span data-stu-id="57638-534">The NVA in this example provides a central location to enforce and manage the security policy.</span></span> <span data-ttu-id="57638-535">Дополнительные сведения см. в подробных инструкциях по построению (будут добавлены позже).</span><span class="sxs-lookup"><span data-stu-id="57638-535">For more information, see the detailed build instructions (forthcoming).</span></span> <span data-ttu-id="57638-536">Эти инструкции включают:</span><span class="sxs-lookup"><span data-stu-id="57638-536">These instructions include:</span></span>

* <span data-ttu-id="57638-537">Создание сети периметра для этого примера с помощью сценариев PowerShell.</span><span class="sxs-lookup"><span data-stu-id="57638-537">How to build this example perimeter network with PowerShell scripts.</span></span>
* <span data-ttu-id="57638-538">Построение сети для этого примера с помощью шаблона Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="57638-538">How to build this example with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="57638-539">Подробные сценарии потоков трафика, демонстрирующие прохождение трафика через эту схему сети.</span><span class="sxs-lookup"><span data-stu-id="57638-539">Detailed traffic flow scenarios, showing how traffic flows through this design.</span></span>

### <a name="example-5-add-a-hybrid-connection-with-a-site-to-site-azure-vpn-gateway"></a><span data-ttu-id="57638-540">Пример 5. Добавление гибридного подключения типа "сеть — сеть" с VPN-шлюзом Azure</span><span class="sxs-lookup"><span data-stu-id="57638-540">Example 5 Add a hybrid connection with a site-to-site, Azure VPN gateway</span></span>
<span data-ttu-id="57638-541">[Вернуться к выбору решения](#fast-start) | Подробные инструкции по сборке ожидаются в ближайшее время</span><span class="sxs-lookup"><span data-stu-id="57638-541">[Back to Fast start](#fast-start) | Detailed build instructions available soon</span></span>

<span data-ttu-id="57638-542">[![14]][14]</span><span class="sxs-lookup"><span data-stu-id="57638-542">[![14]][14]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="57638-543">Описание среды</span><span class="sxs-lookup"><span data-stu-id="57638-543">Environment description</span></span>
<span data-ttu-id="57638-544">К сети периметра любого типа, описанной в примерах 1 и 2, можно добавить гибридную сеть с VPN-шлюзом Azure.</span><span class="sxs-lookup"><span data-stu-id="57638-544">Hybrid networking using an Azure VPN gateway can be added to either perimeter network type described in examples 1 or 2.</span></span>

<span data-ttu-id="57638-545">Как показано на приведенном выше рисунке, для подключения локальной сети к виртуальной сети Azure через VPN-шлюз Azure используется VPN-подключение через Интернет (типа "сеть-сеть").</span><span class="sxs-lookup"><span data-stu-id="57638-545">As shown in the preceding figure, a VPN connection over the Internet (site-to-site) is used to connect an on-premises network to an Azure virtual network via an Azure VPN gateway.</span></span>

> [!NOTE]
> <span data-ttu-id="57638-546">При использовании ExpressRoute с включенным общедоступным пирингом Azure необходимо создать статический маршрут.</span><span class="sxs-lookup"><span data-stu-id="57638-546">If you use ExpressRoute with the Azure Public Peering option enabled, a static route should be created.</span></span> <span data-ttu-id="57638-547">Он должен выполнять маршрутизацию на IP-адрес VPN виртуального сетевого устройства за пределами корпоративной сети и не использовать глобальную сеть ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="57638-547">This  static route should route to the NVA VPN IP address out your corporate Internet and not via the ExpressRoute WAN.</span></span> <span data-ttu-id="57638-548">Преобразование сетевых адресов (NAT), которое необходимо для общедоступного пиринга Azure в ExpressRoute, может привести к разрыву сеанса VPN.</span><span class="sxs-lookup"><span data-stu-id="57638-548">The NAT required on the ExpressRoute Azure Public Peering option can break the VPN session.</span></span>
>
>

<span data-ttu-id="57638-549">На следующем рисунке показаны две границы сети в этом варианте.</span><span class="sxs-lookup"><span data-stu-id="57638-549">The following figure shows the two network edges in this example.</span></span> <span data-ttu-id="57638-550">На первой границе виртуальное сетевое устройство и группы безопасности сети управляют потоками трафика во внутренних сетях Azure и между Azure и Интернетом.</span><span class="sxs-lookup"><span data-stu-id="57638-550">On the first edge, the NVA and NSGs control traffic flows for intra-Azure networks and between Azure and the Internet.</span></span> <span data-ttu-id="57638-551">Второй границей является VPN-шлюз Azure, который представляет собой отдельную и изолированную границу сети между локальной сетью и Azure.</span><span class="sxs-lookup"><span data-stu-id="57638-551">The second edge is the Azure VPN gateway, which is a separate and isolated network edge between on-premises and Azure.</span></span>

<span data-ttu-id="57638-552">Потоки трафика следует тщательно планировать, так как такая схема сети может оптимизировать или ухудшить их в зависимости от конкретного сценария использования.</span><span class="sxs-lookup"><span data-stu-id="57638-552">Traffic flows should be considered carefully, as they can be optimized or degraded by this design pattern, depending on the specific use case.</span></span>

<span data-ttu-id="57638-553">Взяв среду, созданную в примере 1, и добавив к ней гибридное сетевое VPN-подключение типа "сеть-сеть", мы получим следующую схему.</span><span class="sxs-lookup"><span data-stu-id="57638-553">Using the environment built in example 1, and then adding a site-to-site VPN hybrid network connection, produces the following design:</span></span>

<span data-ttu-id="57638-554">[![15]][15]</span><span class="sxs-lookup"><span data-stu-id="57638-554">[![15]][15]</span></span>

#### <a name="conclusion"></a><span data-ttu-id="57638-555">Заключение</span><span class="sxs-lookup"><span data-stu-id="57638-555">Conclusion</span></span>
<span data-ttu-id="57638-556">Добавление гибридного сетевого VPN-подключения типа "сеть-сеть" к виртуальной сети Azure позволяет безопасно расширить локальную сеть в Azure.</span><span class="sxs-lookup"><span data-stu-id="57638-556">The addition of a site-to-site VPN hybrid network connection to an Azure virtual network can extend the on-premises network into Azure in a secure manner.</span></span> <span data-ttu-id="57638-557">Встроенный VPN-шлюз Azure шифрует весь трафик по протоколу IPSec и передает его через Интернет.</span><span class="sxs-lookup"><span data-stu-id="57638-557">Using the native Azure VPN gateway, your traffic is IPSec encrypted and routes via the Internet.</span></span> <span data-ttu-id="57638-558">Кроме того, VPN-шлюз Azure может оказаться более бюджетным решением (не требует дополнительных затрат на лицензии для виртуальных сетевых устройств сторонних производителей).</span><span class="sxs-lookup"><span data-stu-id="57638-558">Also, using the Azure VPN gateway can provide a lower-cost option (no additional licensing cost as with third-party NVAs).</span></span> <span data-ttu-id="57638-559">Для примера 1, в котором не используются виртуальные сетевые устройства, этот вариант будет самым экономичным.</span><span class="sxs-lookup"><span data-stu-id="57638-559">This option is most economical in example 1, where no NVA is used.</span></span> <span data-ttu-id="57638-560">Дополнительные сведения см. в подробных инструкциях по построению (будут добавлены позже).</span><span class="sxs-lookup"><span data-stu-id="57638-560">For more information, see the detailed build instructions (forthcoming).</span></span> <span data-ttu-id="57638-561">Эти инструкции включают:</span><span class="sxs-lookup"><span data-stu-id="57638-561">These instructions include:</span></span>

* <span data-ttu-id="57638-562">Создание сети периметра для этого примера с помощью сценариев PowerShell.</span><span class="sxs-lookup"><span data-stu-id="57638-562">How to build this example perimeter network with PowerShell scripts.</span></span>
* <span data-ttu-id="57638-563">Построение сети для этого примера с помощью шаблона Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="57638-563">How to build this example with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="57638-564">Подробные сценарии потоков трафика, демонстрирующие прохождение трафика через эту схему сети.</span><span class="sxs-lookup"><span data-stu-id="57638-564">Detailed traffic flow scenarios, showing how traffic flows through this design.</span></span>

### <a name="example-6-add-a-hybrid-connection-with-expressroute"></a><span data-ttu-id="57638-565">Пример 6. Добавление гибридного подключения с использованием ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="57638-565">Example 6 Add a hybrid connection with ExpressRoute</span></span>
<span data-ttu-id="57638-566">[Вернуться к выбору решения](#fast-start) | Подробные инструкции по сборке ожидаются в ближайшее время</span><span class="sxs-lookup"><span data-stu-id="57638-566">[Back to Fast start](#fast-start) | Detailed build instructions available soon</span></span>

<span data-ttu-id="57638-567">[![16]][16]</span><span class="sxs-lookup"><span data-stu-id="57638-567">[![16]][16]</span></span>

#### <a name="environment-description"></a><span data-ttu-id="57638-568">Описание среды</span><span class="sxs-lookup"><span data-stu-id="57638-568">Environment description</span></span>
<span data-ttu-id="57638-569">Гибридную сеть, использующую подключение с частным пирингом ExpressRoute, можно добавить к сети периметра любого типа, описанной в примере 1 или 2.</span><span class="sxs-lookup"><span data-stu-id="57638-569">Hybrid networking using an ExpressRoute private peering connection can be added to either perimeter network type described in examples 1 or 2.</span></span>

<span data-ttu-id="57638-570">Как показано на рисунке выше, частный пиринг ExpressRoute позволяет создавать прямое подключение между локальной сетью и виртуальной сетью Azure.</span><span class="sxs-lookup"><span data-stu-id="57638-570">As shown in the preceding figure, ExpressRoute private peering provides a direct connection between your on-premises network and the Azure virtual network.</span></span> <span data-ttu-id="57638-571">Трафик проходит только через сеть поставщика службы и сеть Microsoft Azure, не выходя в Интернет.</span><span class="sxs-lookup"><span data-stu-id="57638-571">Traffic transits only the service provider network and the Microsoft Azure network, never touching the Internet.</span></span>

> [!TIP]
> <span data-ttu-id="57638-572">При использовании ExpressRoute корпоративный трафик не передается через Интернет.</span><span class="sxs-lookup"><span data-stu-id="57638-572">Using ExpressRoute keeps corporate network traffic off the Internet.</span></span> <span data-ttu-id="57638-573">Это также позволяет использовать соглашения об уровне обслуживания поставщика службы ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="57638-573">It also allows for service level agreements from your ExpressRoute provider.</span></span> <span data-ttu-id="57638-574">При использовании ExpressRoute шлюз Azure может передавать данные со скоростью до 10 Гбит/с, тогда как при использовании VPN типа "сеть — сеть" максимальная пропускная способность шлюза Azure составляет 200 Мбит/с.</span><span class="sxs-lookup"><span data-stu-id="57638-574">The Azure Gateway can pass up to 10 Gbps with ExpressRoute, whereas with site-to-site VPNs, the Azure Gateway maximum throughput is 200 Mbps.</span></span>
>
>

<span data-ttu-id="57638-575">Как показано на следующей схеме, в этом варианте среда имеет две границы сети.</span><span class="sxs-lookup"><span data-stu-id="57638-575">As seen in the following diagram, with this option the environment now has two network edges.</span></span> <span data-ttu-id="57638-576">Виртуальное сетевое устройство и группа безопасности сети управляют потоками трафика для внутренних сетей Azure и между Azure и Интернетом, а шлюз представляет собой отделенную и изолированную границу сети между локальной сетью и Azure.</span><span class="sxs-lookup"><span data-stu-id="57638-576">The NVA and NSG control traffic flows for intra-Azure networks and between Azure and the Internet, while the gateway is a separate and isolated network edge between on-premises and Azure.</span></span>

<span data-ttu-id="57638-577">Потоки трафика следует тщательно планировать, так как такая схема сети может оптимизировать или ухудшить их в зависимости от конкретного сценария использования.</span><span class="sxs-lookup"><span data-stu-id="57638-577">Traffic flows should be considered carefully, as they can be optimized or degraded by this design pattern, depending on the specific use case.</span></span>

<span data-ttu-id="57638-578">Взяв среду, созданную в примере 1, и добавив к ней гибридное сетевое подключение ExpressRoute, мы получим следующую схему.</span><span class="sxs-lookup"><span data-stu-id="57638-578">Using the environment built in example 1, and then adding an ExpressRoute hybrid network connection, produces the following design:</span></span>

<span data-ttu-id="57638-579">[![17]][17]</span><span class="sxs-lookup"><span data-stu-id="57638-579">[![17]][17]</span></span>

#### <a name="conclusion"></a><span data-ttu-id="57638-580">Заключение</span><span class="sxs-lookup"><span data-stu-id="57638-580">Conclusion</span></span>
<span data-ttu-id="57638-581">Добавив сетевое подключение частного пиринга ExpressRoute, вы можете безопасно расширить локальную сеть в Azure. Этот метод снижает задержки и повышает производительность подключения.</span><span class="sxs-lookup"><span data-stu-id="57638-581">The addition of an ExpressRoute Private Peering network connection can extend the on-premises network into Azure in a secure, lower latency, higher performing manner.</span></span> <span data-ttu-id="57638-582">Встроенный VPN-шлюз Azure, как и в нашем примере, также позволяет снизить расходы (так как не потребуется дополнительных затрат на лицензии для виртуальных сетевых устройств сторонних производителей).</span><span class="sxs-lookup"><span data-stu-id="57638-582">Also, using the native Azure Gateway, as in this example, provides a lower-cost option (no additional licensing as with third-party NVAs).</span></span> <span data-ttu-id="57638-583">Дополнительные сведения см. в подробных инструкциях по построению (будут добавлены позже).</span><span class="sxs-lookup"><span data-stu-id="57638-583">For more information, see the detailed build instructions (forthcoming).</span></span> <span data-ttu-id="57638-584">Эти инструкции включают:</span><span class="sxs-lookup"><span data-stu-id="57638-584">These instructions include:</span></span>

* <span data-ttu-id="57638-585">Создание сети периметра для этого примера с помощью сценариев PowerShell.</span><span class="sxs-lookup"><span data-stu-id="57638-585">How to build this example perimeter network with PowerShell scripts.</span></span>
* <span data-ttu-id="57638-586">Построение сети для этого примера с помощью шаблона Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="57638-586">How to build this example with an Azure Resource Manager template.</span></span>
* <span data-ttu-id="57638-587">Подробные сценарии потоков трафика, демонстрирующие прохождение трафика через эту схему сети.</span><span class="sxs-lookup"><span data-stu-id="57638-587">Detailed traffic flow scenarios, showing how traffic flows through this design.</span></span>

## <a name="references"></a><span data-ttu-id="57638-588">Ссылки</span><span class="sxs-lookup"><span data-stu-id="57638-588">References</span></span>
### <a name="helpful-websites-and-documentation"></a><span data-ttu-id="57638-589">Полезные веб-сайты и документация</span><span class="sxs-lookup"><span data-stu-id="57638-589">Helpful websites and documentation</span></span>
* <span data-ttu-id="57638-590">Доступ к Azure с Azure Resource Manager:</span><span class="sxs-lookup"><span data-stu-id="57638-590">Access Azure with Azure Resource Manager:</span></span>
* <span data-ttu-id="57638-591">Доступ к Azure с помощью PowerShell: [https://docs.microsoft.com/powershell/azureps-cmdlets-docs/](/powershell/azure/overview)</span><span class="sxs-lookup"><span data-stu-id="57638-591">Accessing Azure with PowerShell: [https://docs.microsoft.com/powershell/azureps-cmdlets-docs/](/powershell/azure/overview)</span></span>
* <span data-ttu-id="57638-592">Документация по виртуальным сетям: [https://docs.microsoft.com/azure/virtual-network/](https://docs.microsoft.com/azure/virtual-network/)</span><span class="sxs-lookup"><span data-stu-id="57638-592">Virtual networking documentation: [https://docs.microsoft.com/azure/virtual-network/](https://docs.microsoft.com/azure/virtual-network/)</span></span>
* <span data-ttu-id="57638-593">Документация по группам безопасности сети: [https://docs.microsoft.com/azure/virtual-network/virtual-networks-nsg](virtual-network/virtual-networks-nsg.md)</span><span class="sxs-lookup"><span data-stu-id="57638-593">Network security group documentation: [https://docs.microsoft.com/azure/virtual-network/virtual-networks-nsg](virtual-network/virtual-networks-nsg.md)</span></span>
* <span data-ttu-id="57638-594">Документация по определяемым пользователем маршрутам: [https://docs.microsoft.com/azure/virtual-network/virtual-networks-udr-overview](virtual-network/virtual-networks-udr-overview.md)</span><span class="sxs-lookup"><span data-stu-id="57638-594">User-defined routing documentation: [https://docs.microsoft.com/azure/virtual-network/virtual-networks-udr-overview](virtual-network/virtual-networks-udr-overview.md)</span></span>
* <span data-ttu-id="57638-595">Виртуальные шлюзы Azure: [https://docs.microsoft.com/azure/vpn-gateway/](https://docs.microsoft.com/azure/vpn-gateway/)</span><span class="sxs-lookup"><span data-stu-id="57638-595">Azure virtual gateways: [https://docs.microsoft.com/azure/vpn-gateway/](https://docs.microsoft.com/azure/vpn-gateway/)</span></span>
* <span data-ttu-id="57638-596">VPN типа "сеть — сеть": [https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell](vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell.md)</span><span class="sxs-lookup"><span data-stu-id="57638-596">Site-to-Site VPNs: [https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell](vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell.md)</span></span>
* <span data-ttu-id="57638-597">Документация ExpressRoute (обязательно ознакомьтесь с разделами о начале работы и инструкциями): [https://docs.microsoft.com/azure/expressroute/](https://docs.microsoft.com/azure/expressroute/)</span><span class="sxs-lookup"><span data-stu-id="57638-597">ExpressRoute documentation (be sure to check out the “Getting Started” and “How To” sections): [https://docs.microsoft.com/azure/expressroute/](https://docs.microsoft.com/azure/expressroute/)</span></span>

<!--Image References-->
<span data-ttu-id="57638-598">[0]: ./media/best-practices-network-security/flowchart.png "Блок-схема вариантов системы безопасности"</span><span class="sxs-lookup"><span data-stu-id="57638-598">[0]: ./media/best-practices-network-security/flowchart.png "Security Options Flowchart"</span></span>
<span data-ttu-id="57638-599">[2]: ./media/best-practices-network-security/azuresecurityfeatures.png "Функции безопасности Azure"</span><span class="sxs-lookup"><span data-stu-id="57638-599">[2]: ./media/best-practices-network-security/azuresecurityfeatures.png "Azure Security Features"</span></span>
<span data-ttu-id="57638-600">[3]: ./media/best-practices-network-security/dmzcorporate.png "Сеть периметра в корпоративной сети"</span><span class="sxs-lookup"><span data-stu-id="57638-600">[3]: ./media/best-practices-network-security/dmzcorporate.png "A DMZ in a Corporate network"</span></span>
<span data-ttu-id="57638-601">[4]: ./media/best-practices-network-security/azuresecurityarchitecture.png "Архитектура безопасности Azure"</span><span class="sxs-lookup"><span data-stu-id="57638-601">[4]: ./media/best-practices-network-security/azuresecurityarchitecture.png "Azure Security Architecture"</span></span>
<span data-ttu-id="57638-602">[5]: ./media/best-practices-network-security/dmzazure.png "Сеть периметра в виртуальной сети Azure"</span><span class="sxs-lookup"><span data-stu-id="57638-602">[5]: ./media/best-practices-network-security/dmzazure.png "A DMZ in an Azure Virtual Network"</span></span>
<span data-ttu-id="57638-603">[6]: ./media/best-practices-network-security/dmzhybrid.png "Гибридная сеть с тремя границами безопасности"</span><span class="sxs-lookup"><span data-stu-id="57638-603">[6]: ./media/best-practices-network-security/dmzhybrid.png "Hybrid Network with Three Security Boundaries"</span></span>
<span data-ttu-id="57638-604">[7]: ./media/best-practices-network-security/example1design.png "Входящая сеть периметра с группой безопасности сети"</span><span class="sxs-lookup"><span data-stu-id="57638-604">[7]: ./media/best-practices-network-security/example1design.png "Inbound DMZ with NSG"</span></span>
<span data-ttu-id="57638-605">[8]: ./media/best-practices-network-security/example2design.png "Входящая сеть периметра с виртуальным сетевым устройством и группой безопасности сети"</span><span class="sxs-lookup"><span data-stu-id="57638-605">[8]: ./media/best-practices-network-security/example2design.png "Inbound DMZ with NVA and NSG"</span></span>
<span data-ttu-id="57638-606">[9]: ./media/best-practices-network-security/example3design.png "Двунаправленная сеть периметра с виртуальным сетевым устройством, группой безопасности сети и определяемыми пользователем маршрутами"</span><span class="sxs-lookup"><span data-stu-id="57638-606">[9]: ./media/best-practices-network-security/example3design.png "Bi-directional DMZ with NVA, NSG, and UDR"</span></span>
<span data-ttu-id="57638-607">[10]: ./media/best-practices-network-security/example3firewalllogical.png "Логическое представление правил брандмауэра"</span><span class="sxs-lookup"><span data-stu-id="57638-607">[10]: ./media/best-practices-network-security/example3firewalllogical.png "Logical View of the Firewall Rules"</span></span>
<span data-ttu-id="57638-608">[11]: ./media/best-practices-network-security/example3designoptions.png "Сеть периметра с гибридной сетью, подключенной через виртуальное сетевое устройство"</span><span class="sxs-lookup"><span data-stu-id="57638-608">[11]: ./media/best-practices-network-security/example3designoptions.png "DMZ with NVA Connected Hybrid Network"</span></span>
<span data-ttu-id="57638-609">[12]: ./media/best-practices-network-security/example4designs2s.png "Сеть периметра с виртуальным сетевым устройством и VPN-подключением типа "сеть — сеть""</span><span class="sxs-lookup"><span data-stu-id="57638-609">[12]: ./media/best-practices-network-security/example4designs2s.png "DMZ with NVA Connected Using a Site-to-Site VPN"</span></span>
<span data-ttu-id="57638-610">[13]: ./media/best-practices-network-security/example4networklogical.png "Логическая сеть с точки зрения виртуального сетевого устройства"</span><span class="sxs-lookup"><span data-stu-id="57638-610">[13]: ./media/best-practices-network-security/example4networklogical.png "Logical Network from NVA Perspective"</span></span>
<span data-ttu-id="57638-611">[14]: ./media/best-practices-network-security/example5designoptions.png "Сеть периметра с гибридным сетевым подключением типа "сеть — сеть" через шлюз Azure"</span><span class="sxs-lookup"><span data-stu-id="57638-611">[14]: ./media/best-practices-network-security/example5designoptions.png "DMZ with Azure Gateway Connected Site-to-Site Hybrid Network"</span></span>
<span data-ttu-id="57638-612">[15]: ./media/best-practices-network-security/example5designs2s.png "Сеть периметра со шлюзом Azure и VPN-подключением типа "сеть — сеть""</span><span class="sxs-lookup"><span data-stu-id="57638-612">[15]: ./media/best-practices-network-security/example5designs2s.png "DMZ with Azure Gateway Using Site-to-Site VPN"</span></span>
<span data-ttu-id="57638-613">[16]: ./media/best-practices-network-security/example6designoptions.png "Сеть периметра с гибридным сетевым подключением ExpressRoute через шлюз Azure"</span><span class="sxs-lookup"><span data-stu-id="57638-613">[16]: ./media/best-practices-network-security/example6designoptions.png "DMZ with Azure Gateway Connected ExpressRoute Hybrid Network"</span></span>
<span data-ttu-id="57638-614">[17]: ./media/best-practices-network-security/example6designexpressroute.png "Сеть периметра со шлюзом Azure и подключением ExpressRoute"</span><span class="sxs-lookup"><span data-stu-id="57638-614">[17]: ./media/best-practices-network-security/example6designexpressroute.png "DMZ with Azure Gateway Using an ExpressRoute Connection"</span></span>

<!--Link References-->
[TrustCenter]: https://azure.microsoft.com/support/trust-center/compliance/
[Example1]: ./virtual-network/virtual-networks-dmz-nsg.md
[Example2]: ./virtual-network/virtual-networks-dmz-nsg-fw-asm.md
[Example3]: ./virtual-network/virtual-networks-dmz-nsg-fw-udr-asm.md
[Example4]: ./virtual-network/virtual-networks-hybrid-s2s-nva-asm.md
[Example5]: ./virtual-network/virtual-networks-hybrid-s2s-agw-asm.md
[Example6]: ./virtual-network/virtual-networks-hybrid-expressroute-asm.md
[Example7]: ./virtual-network/virtual-networks-vnet2vnet-direct-asm.md
[Example8]: ./virtual-network/virtual-networks-vnet2vnet-transit-asm.md
