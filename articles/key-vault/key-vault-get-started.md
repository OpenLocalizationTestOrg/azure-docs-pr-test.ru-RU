---
title: "Приступая к работе с хранилищем ключей Azure | Документация Майкрософт"
description: "Этот учебник поможет вам начать работу с хранилищем ключей Azure. В нем содержится информация о создании зафиксированного контейнера (хранилища), хранении криптографических ключей и секретов, а также об управлении ими в Azure."
services: key-vault
documentationcenter: 
author: cabailey
manager: mbaldwin
tags: azure-resource-manager
ms.assetid: 36721e1d-38b8-4a15-ba6f-14ed5be4de79
ms.service: key-vault
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: hero-article
ms.date: 07/19/2017
ms.author: cabailey
ms.openlocfilehash: 0299d931c5bf21775b68069afaa106279270226a
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="get-started-with-azure-key-vault"></a><span data-ttu-id="9601c-103">Приступая к работе с хранилищем ключей Azure</span><span class="sxs-lookup"><span data-stu-id="9601c-103">Get started with Azure Key Vault</span></span>
<span data-ttu-id="9601c-104">Хранилище ключей Azure доступно в большинстве регионов.</span><span class="sxs-lookup"><span data-stu-id="9601c-104">Azure Key Vault is available in most regions.</span></span> <span data-ttu-id="9601c-105">Дополнительные сведения см. на странице [цен на хранилище ключей](https://azure.microsoft.com/pricing/details/key-vault/).</span><span class="sxs-lookup"><span data-stu-id="9601c-105">For more information, see the [Key Vault pricing page](https://azure.microsoft.com/pricing/details/key-vault/).</span></span>

## <a name="introduction"></a><span data-ttu-id="9601c-106">Введение</span><span class="sxs-lookup"><span data-stu-id="9601c-106">Introduction</span></span>
<span data-ttu-id="9601c-107">Этот учебник поможет вам начать работу с хранилищем ключей Azure. В нем содержится информация о создании зафиксированного контейнера (хранилища), хранении криптографических ключей и секретов, а также об управлении ими в Azure.</span><span class="sxs-lookup"><span data-stu-id="9601c-107">Use this tutorial to help you get started with Azure Key Vault to create a hardened container (a vault) in Azure, to store and manage cryptographic keys and secrets in Azure.</span></span> <span data-ttu-id="9601c-108">Он представляет собой пошаговое руководство по использованию Windows PowerShell для создания хранилища, содержащего ключ или пароль, который вы сможете использовать с приложением Azure.</span><span class="sxs-lookup"><span data-stu-id="9601c-108">It walks you through the process of using Azure PowerShell to create a vault that contains a key or password that you can then use with an Azure application.</span></span> <span data-ttu-id="9601c-109">В нем также показано, как приложение может использовать этот ключ или пароль.</span><span class="sxs-lookup"><span data-stu-id="9601c-109">It then shows you how an application can use that key or password.</span></span>

<span data-ttu-id="9601c-110">**Предполагаемое время выполнения:** 20 минут</span><span class="sxs-lookup"><span data-stu-id="9601c-110">**Estimated time to complete:** 20 minutes</span></span>

> [!NOTE]
> <span data-ttu-id="9601c-111">В этом учебнике нет указаний по написанию приложения Azure, что предусматривает один из шагов, но показано, как авторизовать приложение для использования ключей или секретов в хранилище ключей.</span><span class="sxs-lookup"><span data-stu-id="9601c-111">This tutorial does not include instructions for how to write the Azure application that one of the steps includes, namely how to authorize an application to use a key or secret in the key vault.</span></span>
>
> <span data-ttu-id="9601c-112">В этом руководстве используется Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="9601c-112">This tutorial uses Azure PowerShell.</span></span> <span data-ttu-id="9601c-113">Инструкции по кроссплатформенному интерфейсу командной строки см. в [этом руководстве](key-vault-manage-with-cli2.md).</span><span class="sxs-lookup"><span data-stu-id="9601c-113">For Cross-Platform Command-Line Interface instructions, see [this equivalent tutorial](key-vault-manage-with-cli2.md).</span></span>
>
>

<span data-ttu-id="9601c-114">Общие сведения о хранилище ключей Azure см. в статье [Что такое хранилище ключей Azure?](key-vault-whatis.md)</span><span class="sxs-lookup"><span data-stu-id="9601c-114">For overview information about Azure Key Vault, see [What is Azure Key Vault?](key-vault-whatis.md)</span></span>

## <a name="prerequisites"></a><span data-ttu-id="9601c-115">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="9601c-115">Prerequisites</span></span>
<span data-ttu-id="9601c-116">Для работы с этим учебником требуется:</span><span class="sxs-lookup"><span data-stu-id="9601c-116">To complete this tutorial, you must have the following:</span></span>

* <span data-ttu-id="9601c-117">подписка на Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="9601c-117">A subscription to Microsoft Azure.</span></span> <span data-ttu-id="9601c-118">Если у вас нет подписки, вы можете зарегистрироваться для использования [бесплатной учетной записи](https://azure.microsoft.com/pricing/free-trial/).</span><span class="sxs-lookup"><span data-stu-id="9601c-118">If you do not have one, you can sign up for a [free account](https://azure.microsoft.com/pricing/free-trial/).</span></span>
* <span data-ttu-id="9601c-119">Azure PowerShell, **начиная с версии 1.1.0**.</span><span class="sxs-lookup"><span data-stu-id="9601c-119">Azure PowerShell, **minimum version of 1.1.0**.</span></span> <span data-ttu-id="9601c-120">Чтобы установить решение Azure PowerShell и связать его с подпиской Azure, см. статью [Установка и настройка Azure PowerShell](/powershell/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="9601c-120">To install Azure PowerShell and associate it with your Azure subscription, see [How to install and configure Azure PowerShell](/powershell/azure/overview).</span></span> <span data-ttu-id="9601c-121">Если средство Azure PowerShell у вас установлено, но вы не знаете его версию, в консоли Azure PowerShell введите `(Get-Module azure -ListAvailable).Version`.</span><span class="sxs-lookup"><span data-stu-id="9601c-121">If you have already installed Azure PowerShell and do not know the version, from the Azure PowerShell console, type `(Get-Module azure -ListAvailable).Version`.</span></span> <span data-ttu-id="9601c-122">Если у вас установлено средство Azure PowerShell версий 0.9.1–0.9.8, вы можете использовать это руководство с некоторыми незначительными поправками.</span><span class="sxs-lookup"><span data-stu-id="9601c-122">When you have Azure PowerShell version 0.9.1 through 0.9.8 installed, you can still use this tutorial with some minor changes.</span></span> <span data-ttu-id="9601c-123">Например, вам нужно использовать команду `Switch-AzureMode AzureResourceManager`; также отличаются некоторые команды хранилища ключей Azure.</span><span class="sxs-lookup"><span data-stu-id="9601c-123">For example, you must use the `Switch-AzureMode AzureResourceManager` command and some of the Azure Key Vault commands have changed.</span></span> <span data-ttu-id="9601c-124">Полный список командлетов хранилища ключей для Azure PowerShell версий 0.9.1–0.9.8 см. в [этой статье](/powershell/module/azurerm.keyvault/#key_vault).</span><span class="sxs-lookup"><span data-stu-id="9601c-124">For a list of the Key Vault cmdlets for versions 0.9.1 through 0.9.8, see [Azure Key Vault Cmdlets](/powershell/module/azurerm.keyvault/#key_vault).</span></span>
* <span data-ttu-id="9601c-125">приложение, для которого вы будете настраивать использование ключа или пароля, созданного по этому учебнику.</span><span class="sxs-lookup"><span data-stu-id="9601c-125">An application that will be configured to use the key or password that you create in this tutorial.</span></span> <span data-ttu-id="9601c-126">Пример приложения доступен в [Центре загрузки Майкрософт](http://www.microsoft.com/en-us/download/details.aspx?id=45343).</span><span class="sxs-lookup"><span data-stu-id="9601c-126">A sample application is available from the [Microsoft Download Center](http://www.microsoft.com/en-us/download/details.aspx?id=45343).</span></span> <span data-ttu-id="9601c-127">Указания см. в сопутствующем файле Readme.</span><span class="sxs-lookup"><span data-stu-id="9601c-127">For instructions, see the accompanying Readme file.</span></span>

<span data-ttu-id="9601c-128">Хотя этот учебник предназначен для начинающих пользователей Azure PowerShell, предполагается, что вы знакомы с такими основными понятиями, как модули, командлеты и сеансы.</span><span class="sxs-lookup"><span data-stu-id="9601c-128">This tutorial is designed for Azure PowerShell beginners, but it assumes that you understand the basic concepts, such as modules, cmdlets, and sessions.</span></span> <span data-ttu-id="9601c-129">Дополнительные сведения см. в статье [Начало работы с Windows PowerShell](https://technet.microsoft.com/library/hh857337.aspx).</span><span class="sxs-lookup"><span data-stu-id="9601c-129">For more information, see [Getting started with Windows PowerShell](https://technet.microsoft.com/library/hh857337.aspx).</span></span>

<span data-ttu-id="9601c-130">Чтобы получить подробную справку для любого командлета, встречающегося в этом учебнике, используйте командлет **Get-Help** .</span><span class="sxs-lookup"><span data-stu-id="9601c-130">To get detailed help for any cmdlet that you see in this tutorial, use the **Get-Help** cmdlet.</span></span>

    Get-Help <cmdlet-name> -Detailed

<span data-ttu-id="9601c-131">Например, чтобы получить справку по командлету **Login-AzureRmAccount** , введите следующее:</span><span class="sxs-lookup"><span data-stu-id="9601c-131">For example, to get help for the **Login-AzureRmAccount** cmdlet, type:</span></span>

    Get-Help Login-AzureRmAccount -Detailed

<span data-ttu-id="9601c-132">Чтобы ознакомиться с диспетчером ресурсов Azure в Azure PowerShell, можно также прочитать следующие учебники:</span><span class="sxs-lookup"><span data-stu-id="9601c-132">You can also read the following tutorials to get familiar with Azure Resource Manager in Azure PowerShell:</span></span>

* [<span data-ttu-id="9601c-133">Установка и настройка Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="9601c-133">How to install and configure Azure PowerShell</span></span>](/powershell/azure/overview)
* [<span data-ttu-id="9601c-134">Использование Azure PowerShell с диспетчером ресурсов</span><span class="sxs-lookup"><span data-stu-id="9601c-134">Using Azure PowerShell with Resource Manager</span></span>](../powershell-azure-resource-manager.md)

## <span data-ttu-id="9601c-135"><a id="connect"></a>Подключение к подпискам</span><span class="sxs-lookup"><span data-stu-id="9601c-135"><a id="connect"></a>Connect to your subscriptions</span></span>
<span data-ttu-id="9601c-136">Запустите сеанс Azure PowerShell и войдите в учетную запись Azure, используя следующую команду:</span><span class="sxs-lookup"><span data-stu-id="9601c-136">Start an Azure PowerShell session and sign in to your Azure account with the following command:</span></span>  

    Login-AzureRmAccount

<span data-ttu-id="9601c-137">Обратите внимание, что при использовании определенного экземпляра Azure, например Azure для государственных организаций, в этой команде нужно указать параметр -Environment.</span><span class="sxs-lookup"><span data-stu-id="9601c-137">Note that if you are using a specific instance of Azure, for example, Azure Government, use the -Environment parameter with this command.</span></span> <span data-ttu-id="9601c-138">Например: `Login-AzureRmAccount –Environment (Get-AzureRmEnvironment –Name AzureUSGovernment)`</span><span class="sxs-lookup"><span data-stu-id="9601c-138">For example: `Login-AzureRmAccount –Environment (Get-AzureRmEnvironment –Name AzureUSGovernment)`</span></span>

<span data-ttu-id="9601c-139">Во всплывающем окне браузера введите имя пользователя и пароль учетной записи Azure.</span><span class="sxs-lookup"><span data-stu-id="9601c-139">In the pop-up browser window, enter your Azure account user name and password.</span></span> <span data-ttu-id="9601c-140">Azure PowerShell получает все подписки, связанные с этой учетной записью, и по умолчанию использует первую из них.</span><span class="sxs-lookup"><span data-stu-id="9601c-140">Azure PowerShell gets all the subscriptions that are associated with this account and by default, uses the first one.</span></span>

<span data-ttu-id="9601c-141">Если у вас есть несколько подписок и нужно указать лишь одну из них, которая будет использоваться для хранилища ключей Azure, введите следующую команду, чтобы увидеть подписки своей учетной записи:</span><span class="sxs-lookup"><span data-stu-id="9601c-141">If you have multiple subscriptions and want to specify a specific one to use for Azure Key Vault, type the following to see the subscriptions for your account:</span></span>

    Get-AzureRmSubscription

<span data-ttu-id="9601c-142">Далее, чтобы указать подписку, которую нужно использовать, введите:</span><span class="sxs-lookup"><span data-stu-id="9601c-142">Then, to specify the subscription to use, type:</span></span>

    Set-AzureRmContext -SubscriptionId <subscription ID>

<span data-ttu-id="9601c-143">Дополнительные сведения о настройке Azure PowerShell см. в статье [Установка и настройка Azure PowerShell](/powershell/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="9601c-143">For more information about configuring Azure PowerShell, see [How to install and configure Azure PowerShell](/powershell/azure/overview).</span></span>

## <span data-ttu-id="9601c-144"><a id="resource"></a>Создание новой группы ресурсов</span><span class="sxs-lookup"><span data-stu-id="9601c-144"><a id="resource"></a>Create a new resource group</span></span>
<span data-ttu-id="9601c-145">При использовании диспетчера ресурсов Azure все связанные ресурсы создаются внутри группы ресурсов.</span><span class="sxs-lookup"><span data-stu-id="9601c-145">When you use Azure Resource Manager, all related resources are created inside a resource group.</span></span> <span data-ttu-id="9601c-146">Для примера мы создадим новую группу ресурсов с именем **ContosoResourceGroup** :</span><span class="sxs-lookup"><span data-stu-id="9601c-146">We will create a new resource group named **ContosoResourceGroup** for this tutorial:</span></span>

    New-AzureRmResourceGroup –Name 'ContosoResourceGroup' –Location 'East Asia'


## <span data-ttu-id="9601c-147"><a id="vault"></a>Создание хранилища ключей</span><span class="sxs-lookup"><span data-stu-id="9601c-147"><a id="vault"></a>Create a key vault</span></span>
<span data-ttu-id="9601c-148">Чтобы создать хранилище ключей, используйте командлет [New-AzureRmKeyVault](/powershell/module/azurerm.keyvault/new-azurermkeyvault).</span><span class="sxs-lookup"><span data-stu-id="9601c-148">Use the [New-AzureRmKeyVault](/powershell/module/azurerm.keyvault/new-azurermkeyvault) cmdlet to create a key vault.</span></span> <span data-ttu-id="9601c-149">Этот командлет предусматривает три обязательных параметра: **имя группы ресурсов**, **имя хранилища ключей** и **географическое расположение**.</span><span class="sxs-lookup"><span data-stu-id="9601c-149">This cmdlet has three mandatory parameters: a **resource group name**, a **key vault name**, and the **geographic location**.</span></span>

<span data-ttu-id="9601c-150">Например, если вы используете хранилище с именем **ContosoKeyVault**, группу ресурсов с именем **ContosoResourceGroup** и расположение **Восточная Азия**, введите следующее.</span><span class="sxs-lookup"><span data-stu-id="9601c-150">For example, if you use the vault name of **ContosoKeyVault**, the resource group name of **ContosoResourceGroup**, and the location of **East Asia**, type:</span></span>

    New-AzureRmKeyVault -VaultName 'ContosoKeyVault' -ResourceGroupName 'ContosoResourceGroup' -Location 'East Asia'

<span data-ttu-id="9601c-151">В выходных данных командлета будут показаны свойства хранилища ключей, которое вы только что создали.</span><span class="sxs-lookup"><span data-stu-id="9601c-151">The output of this cmdlet shows properties of the key vault that you’ve just created.</span></span> <span data-ttu-id="9601c-152">Среди всех свойств есть два самых важных:</span><span class="sxs-lookup"><span data-stu-id="9601c-152">The two most important properties are:</span></span>

* <span data-ttu-id="9601c-153">**Имя хранилища** — в нашем примере это **ContosoKeyVault**.</span><span class="sxs-lookup"><span data-stu-id="9601c-153">**Vault Name**: In the example, this is **ContosoKeyVault**.</span></span> <span data-ttu-id="9601c-154">Вы будете использовать это имя для выполнения других командлетов хранилища ключей;</span><span class="sxs-lookup"><span data-stu-id="9601c-154">You will use this name for other Key Vault cmdlets.</span></span>
* <span data-ttu-id="9601c-155">**URI хранилища** — в нашем примере это https://contosokeyvault.vault.azure.net/.</span><span class="sxs-lookup"><span data-stu-id="9601c-155">**Vault URI**: In the example, this is https://contosokeyvault.vault.azure.net/.</span></span> <span data-ttu-id="9601c-156">Необходимо, чтобы приложения, использующие ваше хранилище через REST API, использовали этот URI.</span><span class="sxs-lookup"><span data-stu-id="9601c-156">Applications that use your vault through its REST API must use this URI.</span></span>

<span data-ttu-id="9601c-157">Теперь ваша учетная запись Azure авторизована, и вы можете выполнять любые операции в этом хранилище ключей.</span><span class="sxs-lookup"><span data-stu-id="9601c-157">Your Azure account is now authorized to perform any operations on this key vault.</span></span> <span data-ttu-id="9601c-158">Пока что это недоступно для других учетных записей.</span><span class="sxs-lookup"><span data-stu-id="9601c-158">As yet, nobody else is.</span></span>

> [!NOTE]
> <span data-ttu-id="9601c-159">Если при попытке создать новое хранилище ключей отображается ошибка **Подписка не зарегистрирована для использования пространства имен Microsoft.KeyVault**, запустите `Register-AzureRmResourceProvider -ProviderNamespace "Microsoft.KeyVault"` и снова выполните команду New-AzureRmKeyVault.</span><span class="sxs-lookup"><span data-stu-id="9601c-159">If you see the error **The subscription is not registered to use namespace 'Microsoft.KeyVault'** when you try to create your new key vault, run `Register-AzureRmResourceProvider -ProviderNamespace "Microsoft.KeyVault"` and then rerun your New-AzureRmKeyVault command.</span></span> <span data-ttu-id="9601c-160">Дополнительные сведения см. в статье [Register-AzureRmResourceProvider](/powershell/module/azurerm.resources/register-azurermresourceprovider).</span><span class="sxs-lookup"><span data-stu-id="9601c-160">For more information, see [Register-AzureRmResourceProvider](/powershell/module/azurerm.resources/register-azurermresourceprovider).</span></span>
>
>

## <span data-ttu-id="9601c-161"><a id="add"></a>Добавление ключа или секрета в хранилище ключей</span><span class="sxs-lookup"><span data-stu-id="9601c-161"><a id="add"></a>Add a key or secret to the key vault</span></span>
<span data-ttu-id="9601c-162">Чтобы создать ключ с программной защитой для собственного использования с помощью хранилища ключей Azure, используйте командлет [Add-AzureKeyVaultKey](/powershell/module/azurerm.keyvault/add-azurekeyvaultkey) и введите следующее.</span><span class="sxs-lookup"><span data-stu-id="9601c-162">If you want Azure Key Vault to create a software-protected key for you, use the [Add-AzureKeyVaultKey](/powershell/module/azurerm.keyvault/add-azurekeyvaultkey) cmdlet, and type the following:</span></span>

    $key = Add-AzureKeyVaultKey -VaultName 'ContosoKeyVault' -Name 'ContosoFirstKey' -Destination 'Software'

<span data-ttu-id="9601c-163">Однако если на диске C:\ в PFX-файле с именем softkey.pfx есть ключ, защищенный с помощью программного обеспечения, который нужно передать в хранилище ключей Azure, введите следующую команду, чтобы задать переменную **securepfxpwd** для пароля **123** PFX-файла.</span><span class="sxs-lookup"><span data-stu-id="9601c-163">However, if you have an existing software-protected key in a .PFX file saved to your C:\ drive in a file named softkey.pfx that you want to upload to Azure Key Vault, type the following to set the variable **securepfxpwd** for a password of **123** for the .PFX file:</span></span>

    $securepfxpwd = ConvertTo-SecureString –String '123' –AsPlainText –Force

<span data-ttu-id="9601c-164">Затем введите следующую команду для импорта ключа из PFX-файла, который защищает его с помощью программного обеспечения в службе хранилища ключей:</span><span class="sxs-lookup"><span data-stu-id="9601c-164">Then type the following to import the key from the .PFX file, which protects the key by software in the Key Vault service:</span></span>

    $key = Add-AzureKeyVaultKey -VaultName 'ContosoKeyVault' -Name 'ContosoFirstKey' -KeyFilePath 'c:\softkey.pfx' -KeyFilePassword $securepfxpwd


<span data-ttu-id="9601c-165">Теперь созданный или переданный в хранилище ключей Azure ключ можно вызвать, используя его URI.</span><span class="sxs-lookup"><span data-stu-id="9601c-165">You can now reference this key that you created or uploaded to Azure Key Vault, by using its URI.</span></span> <span data-ttu-id="9601c-166">Используйте адрес **https://ContosoKeyVault.vault.azure.net/keys/ContosoFirstKey**, чтобы всегда получать текущую версию, и адрес **https://ContosoKeyVault.vault.azure.net/keys/ContosoFirstKey/cgacf4f763ar42ffb0a1gca546aygd87**, чтобы получить конкретную версию.</span><span class="sxs-lookup"><span data-stu-id="9601c-166">Use **https://ContosoKeyVault.vault.azure.net/keys/ContosoFirstKey** to always get the current version, and use **https://ContosoKeyVault.vault.azure.net/keys/ContosoFirstKey/cgacf4f763ar42ffb0a1gca546aygd87** to get this specific version.</span></span>  

<span data-ttu-id="9601c-167">Чтобы отобразить URI для этого ключа, введите:</span><span class="sxs-lookup"><span data-stu-id="9601c-167">To display the URI for this key, type:</span></span>

    $Key.key.kid

<span data-ttu-id="9601c-168">Чтобы добавить в хранилище ключей Azure секрет, который представляет собой пароль с именем SQLPassword и значением Pa$$w0rd, сначала преобразуйте значение Pa$$w0rd в защищенную строку. Для этого введите следующее:</span><span class="sxs-lookup"><span data-stu-id="9601c-168">To add a secret to the vault, which is a password named SQLPassword and has the value of Pa$$w0rd to Azure Key Vault, first convert the value of Pa$$w0rd to a secure string by typing the following:</span></span>

    $secretvalue = ConvertTo-SecureString 'Pa$$w0rd' -AsPlainText -Force

<span data-ttu-id="9601c-169">Затем введите следующее:</span><span class="sxs-lookup"><span data-stu-id="9601c-169">Then, type the following:</span></span>

    $secret = Set-AzureKeyVaultSecret -VaultName 'ContosoKeyVault' -Name 'SQLPassword' -SecretValue $secretvalue

<span data-ttu-id="9601c-170">Теперь пароль, добавленный в хранилище ключей Azure, можно вызвать, используя его URI.</span><span class="sxs-lookup"><span data-stu-id="9601c-170">You can now reference this password that you added to Azure Key Vault, by using its URI.</span></span> <span data-ttu-id="9601c-171">Используйте адрес **https://ContosoVault.vault.azure.net/secrets/SQLPassword**, чтобы всегда получать текущую версию, и адрес **https://ContosoVault.vault.azure.net/secrets/SQLPassword/90018dbb96a84117a0d2847ef8e7189d**, чтобы получить конкретную версию.</span><span class="sxs-lookup"><span data-stu-id="9601c-171">Use **https://ContosoVault.vault.azure.net/secrets/SQLPassword** to always get the current version, and use **https://ContosoVault.vault.azure.net/secrets/SQLPassword/90018dbb96a84117a0d2847ef8e7189d** to get this specific version.</span></span>

<span data-ttu-id="9601c-172">Чтобы отобразить URI для этого секрета, введите:</span><span class="sxs-lookup"><span data-stu-id="9601c-172">To display the URI for this secret, type:</span></span>

    $secret.Id

<span data-ttu-id="9601c-173">Давайте просмотрим только что созданный ключ или секрет.</span><span class="sxs-lookup"><span data-stu-id="9601c-173">Let’s view the key or secret that you just created:</span></span>

* <span data-ttu-id="9601c-174">Чтобы просмотреть свой ключ, введите `Get-AzureKeyVaultKey –VaultName 'ContosoKeyVault'`.</span><span class="sxs-lookup"><span data-stu-id="9601c-174">To view your key, type: `Get-AzureKeyVaultKey –VaultName 'ContosoKeyVault'`</span></span>
* <span data-ttu-id="9601c-175">Чтобы просмотреть свой секрет, введите `Get-AzureKeyVaultSecret –VaultName 'ContosoKeyVault'`.</span><span class="sxs-lookup"><span data-stu-id="9601c-175">To view your secret, type: `Get-AzureKeyVaultSecret –VaultName 'ContosoKeyVault'`</span></span>

<span data-ttu-id="9601c-176">Теперь хранилище ключей и ключ или секрет готовы для использования в приложениях.</span><span class="sxs-lookup"><span data-stu-id="9601c-176">Now, your key vault and key or secret is ready for applications to use.</span></span> <span data-ttu-id="9601c-177">Необходимо авторизовать приложения для их использования.</span><span class="sxs-lookup"><span data-stu-id="9601c-177">You must authorize applications to use them.</span></span>  

## <span data-ttu-id="9601c-178"><a id="register"></a>Регистрация приложения в Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="9601c-178"><a id="register"></a>Register an application with Azure Active Directory</span></span>
<span data-ttu-id="9601c-179">Обычно этот шаг выполняет разработчик на отдельном компьютере.</span><span class="sxs-lookup"><span data-stu-id="9601c-179">This step would usually be done by a developer, on a separate computer.</span></span> <span data-ttu-id="9601c-180">Он не относится к хранилищу ключей Azure, но включен в этот учебник для полноты картины.</span><span class="sxs-lookup"><span data-stu-id="9601c-180">It is not specific to Azure Key Vault, but is included here for completeness.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="9601c-181">Чтобы завершить прохождение этого учебника, учетная запись, хранилище и приложение, которое вы будете регистрировать на этом шаге, должны находиться в одном каталоге Azure.</span><span class="sxs-lookup"><span data-stu-id="9601c-181">To complete the tutorial, your account, the vault, and the application that you will register in this step must all be in the same Azure directory.</span></span>
>
>

<span data-ttu-id="9601c-182">Приложения, которые используют хранилища ключей, должны пройти аутентификацию с использованием токена Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="9601c-182">Applications that use a key vault must authenticate by using a token from Azure Active Directory.</span></span> <span data-ttu-id="9601c-183">Для этого владельцу приложения необходимо сначала зарегистрировать приложение в Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="9601c-183">To do this, the owner of the application must first register the application in their Azure Active Directory.</span></span> <span data-ttu-id="9601c-184">В конце регистрации владелец приложения получает следующие значения.</span><span class="sxs-lookup"><span data-stu-id="9601c-184">At the end of registration, the application owner gets the following values:</span></span>

* <span data-ttu-id="9601c-185">**Идентификатор приложения** (также известный как идентификатор клиента) и **ключ проверки подлинности** (также известный как общий секрет).</span><span class="sxs-lookup"><span data-stu-id="9601c-185">An **Application ID** (also known as a Client ID) and **authentication key** (also known as the shared secret).</span></span> <span data-ttu-id="9601c-186">Для получения маркера приложение должно предоставить Azure Active Directory оба этих значения.</span><span class="sxs-lookup"><span data-stu-id="9601c-186">The application must present both these values to Azure Active Directory, to get a token.</span></span> <span data-ttu-id="9601c-187">Настроенный способ предоставления зависит от приложения.</span><span class="sxs-lookup"><span data-stu-id="9601c-187">How the application is configured to do this depends on the application.</span></span> <span data-ttu-id="9601c-188">В примере приложения, использующего хранилище ключей, владелец задает эти значения в файле app.config.</span><span class="sxs-lookup"><span data-stu-id="9601c-188">For the Key Vault sample application, the application owner sets these values in the app.config file.</span></span>

<span data-ttu-id="9601c-189">Чтобы зарегистрировать приложение в Azure Active Directory:</span><span class="sxs-lookup"><span data-stu-id="9601c-189">To register the application in Azure Active Directory:</span></span>

1. <span data-ttu-id="9601c-190">Войдите на классический портал Azure.</span><span class="sxs-lookup"><span data-stu-id="9601c-190">Sign in to the Azure classic portal.</span></span>
2. <span data-ttu-id="9601c-191">Слева щелкните **Active Directory**, а затем выберите каталог, в котором вам необходимо зарегистрировать приложение.</span><span class="sxs-lookup"><span data-stu-id="9601c-191">On the left, click **Active Directory**, and then select the directory in which you will register your application.</span></span> <br> <br> <span data-ttu-id="9601c-192">**Примечание.** Вам необходимо выбрать каталог, содержащий подписку Azure, которую вы использовали для создания хранилища ключей.</span><span class="sxs-lookup"><span data-stu-id="9601c-192">**Note:** You must select the same directory that contains the Azure subscription with which you created your key vault.</span></span> <span data-ttu-id="9601c-193">Если вам не известно, какой это каталог, щелкните **Параметры**, найдите подписку, использованную для создания хранилища ключей, и запишите имя каталога, отображающегося в последнем столбце.</span><span class="sxs-lookup"><span data-stu-id="9601c-193">If you do not know which directory this is, click **Settings**, identify the subscription with which you created your key vault, and note the name of the directory displayed in the last column.</span></span>
3. <span data-ttu-id="9601c-194">Щелкните **ПРИЛОЖЕНИЯ**.</span><span class="sxs-lookup"><span data-stu-id="9601c-194">Click **APPLICATIONS**.</span></span> <span data-ttu-id="9601c-195">Если в каталоге нет добавленных приложений, на этой странице отображается только ссылка **Добавить приложение** .</span><span class="sxs-lookup"><span data-stu-id="9601c-195">If no apps have been added to your directory, this page shows only the **Add an App** link.</span></span> <span data-ttu-id="9601c-196">Щелкните ссылку или выберите **ДОБАВИТЬ** на панели команд.</span><span class="sxs-lookup"><span data-stu-id="9601c-196">Click the link, or alternatively, you can click **ADD** on the command bar.</span></span>
4. <span data-ttu-id="9601c-197">В мастере **Добавление приложения** на странице **What do you want to do?** (Что необходимо сделать?) щелкните **Добавить приложение, разрабатываемое моей организацией**.</span><span class="sxs-lookup"><span data-stu-id="9601c-197">In the **ADD APPLICATION** wizard, on the **What do you want to do?** page, click **Add an application my organization is developing**.</span></span>
5. <span data-ttu-id="9601c-198">На странице **Расскажите о своем приложении** укажите имя своего приложения, а затем выберите **Веб-приложение и/или веб-API** (по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="9601c-198">On the **Tell us about your application** page, specify a name for your application, and then select **WEB APPLICATION AND/OR WEB API** (the default).</span></span> <span data-ttu-id="9601c-199">Щелкните значок **Далее** .</span><span class="sxs-lookup"><span data-stu-id="9601c-199">Click the **Next** icon.</span></span>
6. <span data-ttu-id="9601c-200">На странице **Свойства приложения** укажите данные в полях **URL-адрес входа** и **URI кода приложения** для своего веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="9601c-200">On the **App properties** page, specify the **SIGN-ON URL** and **APP ID URI** for your web application.</span></span> <span data-ttu-id="9601c-201">Если в вашем приложении нет этих значений, можно придумать их для этого шага (например, можно указать http://test1.contoso.com в обоих полях).</span><span class="sxs-lookup"><span data-stu-id="9601c-201">If your application does not have these values, you can make them up for this step (for example, you could specify http://test1.contoso.com for both boxes).</span></span> <span data-ttu-id="9601c-202">Неважно, существуют ли эти сайты.</span><span class="sxs-lookup"><span data-stu-id="9601c-202">It does not matter if these sites exist.</span></span> <span data-ttu-id="9601c-203">Важно то, что URI кода приложения отличается для каждого приложения в каталоге.</span><span class="sxs-lookup"><span data-stu-id="9601c-203">What is important is that the app ID URI for each application is different for every application in your directory.</span></span> <span data-ttu-id="9601c-204">Каталог использует эту строку для идентификации приложения.</span><span class="sxs-lookup"><span data-stu-id="9601c-204">The directory uses this string to identify your app.</span></span>
7. <span data-ttu-id="9601c-205">Щелкните значок **Готово** , чтобы сохранить изменения в мастере.</span><span class="sxs-lookup"><span data-stu-id="9601c-205">Click the **Complete** icon to save your changes in the wizard.</span></span>
8. <span data-ttu-id="9601c-206">На странице **Быстрый запуск** щелкните **Настроить**.</span><span class="sxs-lookup"><span data-stu-id="9601c-206">On the **Quick Start** page, click **CONFIGURE**.</span></span>
9. <span data-ttu-id="9601c-207">Прокрутите страницу до раздела **Ключи**, выберите длительность и щелкните **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="9601c-207">Scroll to the **keys** section, select the duration, and then click **SAVE**.</span></span> <span data-ttu-id="9601c-208">Страница обновится и отобразится значение ключа.</span><span class="sxs-lookup"><span data-stu-id="9601c-208">The page refreshes and now shows a key value.</span></span> <span data-ttu-id="9601c-209">Необходимо настроить приложение, указав это значение ключа и **идентификатор клиента**</span><span class="sxs-lookup"><span data-stu-id="9601c-209">You must configure your application with this key value and the **CLIENT ID** value.</span></span> <span data-ttu-id="9601c-210">(указания по этой конфигурации зависят от конкретного приложения).</span><span class="sxs-lookup"><span data-stu-id="9601c-210">(Instructions for this configuration are application-specific.)</span></span>
10. <span data-ttu-id="9601c-211">Скопируйте значение идентификатора клиента на этой странице. Вы будете использовать его на следующем шаге, чтобы задать разрешения в своем хранилище.</span><span class="sxs-lookup"><span data-stu-id="9601c-211">Copy the client ID value from this page, which you will use in the next step to set permissions on your vault.</span></span>

## <span data-ttu-id="9601c-212"><a id="authorize"></a>Авторизация приложения для использования ключа или секрета</span><span class="sxs-lookup"><span data-stu-id="9601c-212"><a id="authorize"></a>Authorize the application to use the key or secret</span></span>
<span data-ttu-id="9601c-213">Предоставить приложению доступ к ключу или секрету в хранилище можно с помощью командлета [Set-AzureRmKeyVaultAccessPolicy](/powershell/module/azurerm.keyvault/set-azurermkeyvaultaccesspolicy).</span><span class="sxs-lookup"><span data-stu-id="9601c-213">To authorize the application to access the key or secret in the vault, use the [Set-AzureRmKeyVaultAccessPolicy](/powershell/module/azurerm.keyvault/set-azurermkeyvaultaccesspolicy) cmdlet.</span></span>

<span data-ttu-id="9601c-214">Например, если имя хранилища — **ContosoKeyVault** , идентификатор клиента приложения — 8f8c4bbd-485b-45fd-98f7-ec6300b7b4ed и вам нужно авторизовать это приложение для расшифровки и подписи с использованием ключей в вашем хранилище, выполните следующую команду:</span><span class="sxs-lookup"><span data-stu-id="9601c-214">For example, if your vault name is **ContosoKeyVault** and the application you want to authorize has a client ID of 8f8c4bbd-485b-45fd-98f7-ec6300b7b4ed, and you want to authorize the application to decrypt and sign with keys in your vault, run the following:</span></span>

    Set-AzureRmKeyVaultAccessPolicy -VaultName 'ContosoKeyVault' -ServicePrincipalName 8f8c4bbd-485b-45fd-98f7-ec6300b7b4ed -PermissionsToKeys decrypt,sign

<span data-ttu-id="9601c-215">Если этому же приложению необходимо разрешить читать секретные данные в хранилище, выполните следующую команду:</span><span class="sxs-lookup"><span data-stu-id="9601c-215">If you want to authorize that same application to read secrets in your vault, run the following:</span></span>

    Set-AzureRmKeyVaultAccessPolicy -VaultName 'ContosoKeyVault' -ServicePrincipalName 8f8c4bbd-485b-45fd-98f7-ec6300b7b4ed -PermissionsToSecrets Get

## <span data-ttu-id="9601c-216"><a id="HSM"></a>Использование аппаратного модуля безопасности</span><span class="sxs-lookup"><span data-stu-id="9601c-216"><a id="HSM"></a>If you want to use a hardware security module (HSM)</span></span>
<span data-ttu-id="9601c-217">Чтобы обеспечить более высокий уровень защиты, можно импортировать ключи или создать их в аппаратных модулях безопасности (ключи никогда не покидают их пределов).</span><span class="sxs-lookup"><span data-stu-id="9601c-217">For added assurance, you can import or generate keys in hardware security modules (HSMs) that never leave the HSM boundary.</span></span> <span data-ttu-id="9601c-218">В качестве аппаратных модулей безопасности используются модули FIPS 140-2 с проверкой уровня 2.</span><span class="sxs-lookup"><span data-stu-id="9601c-218">The HSMs are FIPS 140-2 Level 2 validated.</span></span> <span data-ttu-id="9601c-219">Если это требование вас не касается, пропустите этот подраздел и перейдите к подразделу [Удаление хранилища ключей, а также связанных ключей и секретов](#delete).</span><span class="sxs-lookup"><span data-stu-id="9601c-219">If this requirement doesn't apply to you, skip this section and go to [Delete the key vault and associated keys and secrets](#delete).</span></span>

<span data-ttu-id="9601c-220">Чтобы создать ключи, защищенные аппаратным модулем, используйте [хранилище ключей Azure уровня "Премиум", которое поддерживает ключи, защищенные аппаратным модулем](https://azure.microsoft.com/pricing/free-trial/).</span><span class="sxs-lookup"><span data-stu-id="9601c-220">To create these HSM-protected keys, you must use the [Azure Key Vault Premium service tier to support HSM-protected keys](https://azure.microsoft.com/pricing/free-trial/).</span></span> <span data-ttu-id="9601c-221">Обратите внимание, эта функция недоступна для Китая.</span><span class="sxs-lookup"><span data-stu-id="9601c-221">In addition, note that this functionality is not available for Azure China.</span></span>

<span data-ttu-id="9601c-222">При создании хранилища ключей добавьте параметр **-SKU**:</span><span class="sxs-lookup"><span data-stu-id="9601c-222">When you create the key vault, add the **-SKU** parameter:</span></span>

    New-AzureRmKeyVault -VaultName 'ContosoKeyVaultHSM' -ResourceGroupName 'ContosoResourceGroup' -Location 'East Asia' -SKU 'Premium'



<span data-ttu-id="9601c-223">В это хранилище ключей можно добавлять ключи с программной защитой (как показано выше) и ключи, защищенные аппаратным модулем безопасности.</span><span class="sxs-lookup"><span data-stu-id="9601c-223">You can add software-protected keys (as shown earlier) and HSM-protected keys to this key vault.</span></span> <span data-ttu-id="9601c-224">Чтобы создать ключ, защищенный аппаратным модулем безопасности, задайте значение «HSM» для параметра **-Destination** :</span><span class="sxs-lookup"><span data-stu-id="9601c-224">To create an HSM-protected key, set the **-Destination** parameter to 'HSM':</span></span>

    $key = Add-AzureKeyVaultKey -VaultName 'ContosoKeyVaultHSM' -Name 'ContosoFirstHSMKey' -Destination 'HSM'

<span data-ttu-id="9601c-225">Вы можете использовать следующую команду для импорта ключа из PFX-файла на своем компьютере.</span><span class="sxs-lookup"><span data-stu-id="9601c-225">You can use the following command to import a key from a .PFX file on your computer.</span></span> <span data-ttu-id="9601c-226">Эта команда импортирует ключ в аппаратные модули безопасности в службе хранилища ключей:</span><span class="sxs-lookup"><span data-stu-id="9601c-226">This command imports the key into HSMs in the Key Vault service:</span></span>

    $key = Add-AzureKeyVaultKey -VaultName 'ContosoKeyVaultHSM' -Name 'ContosoFirstHSMKey' -KeyFilePath 'c:\softkey.pfx' -KeyFilePassword $securepfxpwd -Destination 'HSM'


<span data-ttu-id="9601c-227">Следующая команда импортирует пакет собственного ключа клиента (BYOK).</span><span class="sxs-lookup"><span data-stu-id="9601c-227">The next command imports a “bring your own key" (BYOK) package.</span></span> <span data-ttu-id="9601c-228">Этот сценарий дает возможность создать ключ в локальном аппаратном модуле безопасности и передать его в аппаратные модули безопасности в службе хранилища ключей так, чтобы ключ не покидал их пределы:</span><span class="sxs-lookup"><span data-stu-id="9601c-228">This scenario lets you generate your key in your local HSM, and transfer it to HSMs in the Key Vault service, without the key leaving the HSM boundary:</span></span>

    $key = Add-AzureKeyVaultKey -VaultName 'ContosoKeyVaultHSM' -Name 'ContosoFirstHSMKey' -KeyFilePath 'c:\ITByok.byok' -Destination 'HSM'

<span data-ttu-id="9601c-229">Более подробные инструкции по созданию пакета BYOK см. в статье [Создание ключей, защищенных аппаратным модулем безопасности, и их передача в хранилище ключей Azure](key-vault-hsm-protected-keys.md).</span><span class="sxs-lookup"><span data-stu-id="9601c-229">For more detailed instructions about how to generate this BYOK package, see [How to generate and transfer HSM-protected keys for Azure Key Vault](key-vault-hsm-protected-keys.md).</span></span>

## <span data-ttu-id="9601c-230"><a id="delete"></a>Удаление хранилища ключей, а также связанных ключей и секретов</span><span class="sxs-lookup"><span data-stu-id="9601c-230"><a id="delete"></a>Delete the key vault and associated keys and secrets</span></span>
<span data-ttu-id="9601c-231">Если хранилище ключей (а также содержащийся в нем ключ или секрет) больше не нужно, его можно удалить с помощью командлета [Remove-AzureRmKeyVault](/powershell/module/azurerm.keyvault/remove-azurermkeyvault).</span><span class="sxs-lookup"><span data-stu-id="9601c-231">If you no longer need the key vault and the key or secret that it contains, you can delete the key vault by using the [Remove-AzureRmKeyVault](/powershell/module/azurerm.keyvault/remove-azurermkeyvault) cmdlet:</span></span>

    Remove-AzureRmKeyVault -VaultName 'ContosoKeyVault'

<span data-ttu-id="9601c-232">Как вариант, можно удалить всю группу ресурсов Azure, которая включает в себя хранилище ключей и другие ресурсы, которые вы добавили в эту группу:</span><span class="sxs-lookup"><span data-stu-id="9601c-232">Or, you can delete an entire Azure resource group, which includes the key vault and any other resources that you included in that group:</span></span>

    Remove-AzureRmResourceGroup -ResourceGroupName 'ContosoResourceGroup'


## <span data-ttu-id="9601c-233"><a id="other"></a>Другие командлеты Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="9601c-233"><a id="other"></a>Other Azure PowerShell Cmdlets</span></span>
<span data-ttu-id="9601c-234">Другие команды, которые могут быть полезны при управлении хранилищем ключей Azure.</span><span class="sxs-lookup"><span data-stu-id="9601c-234">Other commands that you might find useful for managing Azure Key Vault:</span></span>

* <span data-ttu-id="9601c-235">`$Keys = Get-AzureKeyVaultKey -VaultName 'ContosoKeyVault'` — эта команда отображает все ключи и выбранные свойства в виде таблицы;</span><span class="sxs-lookup"><span data-stu-id="9601c-235">`$Keys = Get-AzureKeyVaultKey -VaultName 'ContosoKeyVault'`: This command gets a tabular display of all keys and selected properties.</span></span>
* <span data-ttu-id="9601c-236">`$Keys[0]` — эта команда отображает полный список свойств для указанного ключа;</span><span class="sxs-lookup"><span data-stu-id="9601c-236">`$Keys[0]`: This command displays a full list of properties for the specified key</span></span>
* <span data-ttu-id="9601c-237">`Get-AzureKeyVaultSecret` — эта команда перечисляет все имена секретов и выбранные свойства в виде таблицы;</span><span class="sxs-lookup"><span data-stu-id="9601c-237">`Get-AzureKeyVaultSecret`: This command lists a tabular display of all secret names and selected properties.</span></span>
* <span data-ttu-id="9601c-238">`Remove-AzureKeyVaultKey -VaultName 'ContosoKeyVault' -Name 'ContosoFirstKey'` — пример того, как удалить конкретный ключ;</span><span class="sxs-lookup"><span data-stu-id="9601c-238">`Remove-AzureKeyVaultKey -VaultName 'ContosoKeyVault' -Name 'ContosoFirstKey'`: Example how to remove a specific key.</span></span>
* <span data-ttu-id="9601c-239">`Remove-AzureKeyVaultSecret -VaultName 'ContosoKeyVault' -Name 'SQLPassword'` — пример того, как удалить конкретный секрет.</span><span class="sxs-lookup"><span data-stu-id="9601c-239">`Remove-AzureKeyVaultSecret -VaultName 'ContosoKeyVault' -Name 'SQLPassword'`: Example how to remove a specific secret.</span></span>

## <span data-ttu-id="9601c-240"><a id="next"></a>Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="9601c-240"><a id="next"></a>Next steps</span></span>
<span data-ttu-id="9601c-241">Подробное руководство по использованию хранилища ключей Azure в веб-приложении см. в [этой статье](key-vault-use-from-web-application.md).</span><span class="sxs-lookup"><span data-stu-id="9601c-241">For a follow-up tutorial that uses Azure Key Vault in a web application, see [Use Azure Key Vault from a Web Application](key-vault-use-from-web-application.md).</span></span>

<span data-ttu-id="9601c-242">Сведения об использовании хранилища ключей см. в статье [Ведение журнала хранилища ключей Azure](key-vault-logging.md).</span><span class="sxs-lookup"><span data-stu-id="9601c-242">To see how your key vault is being used, see [Azure Key Vault Logging](key-vault-logging.md).</span></span>

<span data-ttu-id="9601c-243">Полный список актуальных командлетов Azure PowerShell для хранилища ключей Azure см. в [этой статье](/powershell/module/azurerm.keyvault/#key_vault).</span><span class="sxs-lookup"><span data-stu-id="9601c-243">For a list of the latest Azure PowerShell cmdlets for Azure Key Vault, see [Azure Key Vault Cmdlets](/powershell/module/azurerm.keyvault/#key_vault).</span></span>

<span data-ttu-id="9601c-244">Справочные материалы по программированию см. в статье [Руководство разработчика хранилища ключей Azure](key-vault-developers-guide.md).</span><span class="sxs-lookup"><span data-stu-id="9601c-244">For programming references, see [the Azure Key Vault developer's guide](key-vault-developers-guide.md).</span></span>
