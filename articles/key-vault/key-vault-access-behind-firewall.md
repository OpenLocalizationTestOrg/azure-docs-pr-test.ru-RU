---
title: "aaaAccess хранилище ключей брандмауэром | Документы Microsoft"
description: "Узнайте, как tooaccess Azure ключ хранилища из приложения за брандмауэром"
services: key-vault
documentationcenter: 
author: amitbapat
manager: mbaldwin
tags: azure-resource-manager
ms.assetid: 50d21774-2ee1-4212-8995-570c9de603c5
ms.service: key-vault
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: hero-article
ms.date: 01/07/2017
ms.author: ambapat
ms.openlocfilehash: ab4bb0c27a41fef878a20dace6cab203df04e579
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="access-azure-key-vault-behind-a-firewall"></a><span data-ttu-id="3d014-103">Доступ к хранилищу ключей Azure из-за брандмауэра</span><span class="sxs-lookup"><span data-stu-id="3d014-103">Access Azure Key Vault behind a firewall</span></span>
### <a name="q-my-key-vault-client-application-needs-toobe-behind-a-firewall-what-ports-hosts-or-ip-addresses-should-i-open-tooenable-access-tooa-key-vault"></a><span data-ttu-id="3d014-104">Вопрос. у моего хранилища ключей клиентскому приложению требуется toobe за брандмауэром.</span><span class="sxs-lookup"><span data-stu-id="3d014-104">Q: My key vault client application needs toobe behind a firewall.</span></span> <span data-ttu-id="3d014-105">Какие порты, узлов или IP-адреса необходимо открыть хранилище ключей tooa доступа tooenable?</span><span class="sxs-lookup"><span data-stu-id="3d014-105">What ports, hosts, or IP addresses should I open tooenable access tooa key vault?</span></span>
<span data-ttu-id="3d014-106">tooaccess хранилища ключей хранилища ключей клиентское приложение имеет tooaccess несколько конечных точек для различных функций:</span><span class="sxs-lookup"><span data-stu-id="3d014-106">tooaccess a key vault, your key vault client application has tooaccess multiple endpoints for various functionalities:</span></span>

* <span data-ttu-id="3d014-107">Проверка подлинности с помощью Azure Active Directory (Azure AD).</span><span class="sxs-lookup"><span data-stu-id="3d014-107">Authentication via Azure Active Directory (Azure AD).</span></span>
* <span data-ttu-id="3d014-108">Управление хранилищем ключей Azure.</span><span class="sxs-lookup"><span data-stu-id="3d014-108">Management of Azure Key Vault.</span></span> <span data-ttu-id="3d014-109">Это включает в себя создание, чтение, обновление, удаление и настройку политик доступа с помощью Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="3d014-109">This includes creating, reading, updating, deleting, and setting access policies through Azure Resource Manager.</span></span>
* <span data-ttu-id="3d014-110">Доступа и управления объектами (ключи и секретные коды) хранится в хранилище ключей сам, проходящий через hello конечной точки зависящие от ключа хранилища (например, [https://yourvaultname.vault.azure.net](https://yourvaultname.vault.azure.net)).</span><span class="sxs-lookup"><span data-stu-id="3d014-110">Accessing and managing objects (keys and secrets) stored in Key Vault itself, going through hello Key Vault-specific endpoint (for example, [https://yourvaultname.vault.azure.net](https://yourvaultname.vault.azure.net)).</span></span>  

<span data-ttu-id="3d014-111">Требования отличаются в зависимости от конфигурации и среды.</span><span class="sxs-lookup"><span data-stu-id="3d014-111">Depending on your configuration and environment, there are some variations.</span></span>   

## <a name="ports"></a><span data-ttu-id="3d014-112">порты;</span><span class="sxs-lookup"><span data-stu-id="3d014-112">Ports</span></span>
<span data-ttu-id="3d014-113">Все трафика tooa хранилища ключей для всех трех функций (проверки подлинности, управления и данных плоскости доступ) переходит по протоколу HTTPS: порт 443.</span><span class="sxs-lookup"><span data-stu-id="3d014-113">All traffic tooa key vault for all three functions (authentication, management, and data plane access) goes over HTTPS: port 443.</span></span> <span data-ttu-id="3d014-114">Однако для списка отзыва сертификатов время от времени трафик будет поступать через HTTP (порт 80).</span><span class="sxs-lookup"><span data-stu-id="3d014-114">However, there will occasionally be HTTP (port 80) traffic for CRL.</span></span> <span data-ttu-id="3d014-115">Клиентам, поддерживающим протокол OCSP, не следует обращаться к списку отзыва сертификатов. Иногда они могут перейти по ссылке [http://cdp1.public-trust.com/CRL/Omniroot2025.crl](http://cdp1.public-trust.com/CRL/Omniroot2025.crl).</span><span class="sxs-lookup"><span data-stu-id="3d014-115">Clients that support OCSP shouldn't reach CRL, but may occasionally reach [http://cdp1.public-trust.com/CRL/Omniroot2025.crl](http://cdp1.public-trust.com/CRL/Omniroot2025.crl).</span></span>  

## <a name="authentication"></a><span data-ttu-id="3d014-116">Аутентификация</span><span class="sxs-lookup"><span data-stu-id="3d014-116">Authentication</span></span>
<span data-ttu-id="3d014-117">Хранилище ключей клиентские приложения потребуется tooaccess конечные точки Azure Active Directory для проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="3d014-117">Key vault client applications will need tooaccess Azure Active Directory endpoints for authentication.</span></span> <span data-ttu-id="3d014-118">Hello конечная точка, используемая зависит hello конфигурации клиента Azure AD, типа hello участника (участника-пользователя или субъекта-службы) и hello тип учетной записи — например, учетную запись Майкрософт или рабочей или учебной учетной записи.</span><span class="sxs-lookup"><span data-stu-id="3d014-118">hello endpoint used depends on hello Azure AD tenant configuration, hello type of principal (user principal or service principal), and hello type of account--for example, a Microsoft account or a work or school account.</span></span>  

| <span data-ttu-id="3d014-119">Тип субъекта</span><span class="sxs-lookup"><span data-stu-id="3d014-119">Principal type</span></span> | <span data-ttu-id="3d014-120">Конечная точка и порт</span><span class="sxs-lookup"><span data-stu-id="3d014-120">Endpoint:port</span></span> |
| --- | --- |
| <span data-ttu-id="3d014-121">Пользователь, использующий учетную запись Майкрософт</span><span class="sxs-lookup"><span data-stu-id="3d014-121">User using Microsoft account</span></span><br> <span data-ttu-id="3d014-122">(например, user@hotmail.com)</span><span class="sxs-lookup"><span data-stu-id="3d014-122">(for example, user@hotmail.com)</span></span> |<span data-ttu-id="3d014-123">**Глобально:**</span><span class="sxs-lookup"><span data-stu-id="3d014-123">**Global:**</span></span><br> <span data-ttu-id="3d014-124">login.microsoftonline.com:443</span><span class="sxs-lookup"><span data-stu-id="3d014-124">login.microsoftonline.com:443</span></span><br><br> <span data-ttu-id="3d014-125">**Azure для Китая:**</span><span class="sxs-lookup"><span data-stu-id="3d014-125">**Azure China:**</span></span><br> <span data-ttu-id="3d014-126">login.chinacloudapi.cn:443</span><span class="sxs-lookup"><span data-stu-id="3d014-126">login.chinacloudapi.cn:443</span></span><br><br><span data-ttu-id="3d014-127">**Azure для правительства США:**</span><span class="sxs-lookup"><span data-stu-id="3d014-127">**Azure US Government:**</span></span><br> <span data-ttu-id="3d014-128">login-us.microsoftonline.com:443</span><span class="sxs-lookup"><span data-stu-id="3d014-128">login-us.microsoftonline.com:443</span></span><br><br><span data-ttu-id="3d014-129">**Azure для Германии:**</span><span class="sxs-lookup"><span data-stu-id="3d014-129">**Azure Germany:**</span></span><br> <span data-ttu-id="3d014-130">login.microsoftonline.de:443</span><span class="sxs-lookup"><span data-stu-id="3d014-130">login.microsoftonline.de:443</span></span><br><br> <span data-ttu-id="3d014-131">и</span><span class="sxs-lookup"><span data-stu-id="3d014-131">and</span></span> <br><span data-ttu-id="3d014-132">login.live.com:443</span><span class="sxs-lookup"><span data-stu-id="3d014-132">login.live.com:443</span></span> |
| <span data-ttu-id="3d014-133">Пользователя или участника службы с помощью рабочей или учебной учетной записи в Azure AD (например, user@contoso.com)</span><span class="sxs-lookup"><span data-stu-id="3d014-133">User or service principal using a work or school account with Azure AD (for example, user@contoso.com)</span></span> |<span data-ttu-id="3d014-134">**Глобально:**</span><span class="sxs-lookup"><span data-stu-id="3d014-134">**Global:**</span></span><br> <span data-ttu-id="3d014-135">login.microsoftonline.com:443</span><span class="sxs-lookup"><span data-stu-id="3d014-135">login.microsoftonline.com:443</span></span><br><br> <span data-ttu-id="3d014-136">**Azure для Китая:**</span><span class="sxs-lookup"><span data-stu-id="3d014-136">**Azure China:**</span></span><br> <span data-ttu-id="3d014-137">login.chinacloudapi.cn:443</span><span class="sxs-lookup"><span data-stu-id="3d014-137">login.chinacloudapi.cn:443</span></span><br><br><span data-ttu-id="3d014-138">**Azure для правительства США:**</span><span class="sxs-lookup"><span data-stu-id="3d014-138">**Azure US Government:**</span></span><br> <span data-ttu-id="3d014-139">login-us.microsoftonline.com:443</span><span class="sxs-lookup"><span data-stu-id="3d014-139">login-us.microsoftonline.com:443</span></span><br><br><span data-ttu-id="3d014-140">**Azure для Германии:**</span><span class="sxs-lookup"><span data-stu-id="3d014-140">**Azure Germany:**</span></span><br> <span data-ttu-id="3d014-141">login.microsoftonline.de:443</span><span class="sxs-lookup"><span data-stu-id="3d014-141">login.microsoftonline.de:443</span></span> |
| <span data-ttu-id="3d014-142">Пользователя или участника службы с помощью рабочей или рабочую учетную запись, а также служб федерации Active Directory (AD FS) или других федеративной конечной точки (например, user@contoso.com)</span><span class="sxs-lookup"><span data-stu-id="3d014-142">User or service principal using a work or school account, plus Active Directory Federation Services (AD FS) or other federated endpoint (for example, user@contoso.com)</span></span> |<span data-ttu-id="3d014-143">Все конечные точки для рабочей или учебной учетной записи, а также службы федерации Active Directory или другие федеративные конечные точки</span><span class="sxs-lookup"><span data-stu-id="3d014-143">All endpoints for a work or school account, plus AD FS or other federated endpoints</span></span> |

<span data-ttu-id="3d014-144">Есть и другие возможные сложные сценарии.</span><span class="sxs-lookup"><span data-stu-id="3d014-144">There are other possible complex scenarios.</span></span> <span data-ttu-id="3d014-145">См. слишком[Active Directory аутентификации Azure](/documentation/articles/active-directory-authentication-scenarios/), [интеграция приложений с Azure Active Directory](/documentation/articles/active-directory-integrating-applications/), и [протоколы проверки подлинности Active Directory](https://msdn.microsoft.com/library/azure/dn151124.aspx) Для получения дополнительных сведений.</span><span class="sxs-lookup"><span data-stu-id="3d014-145">Refer too[Azure Active Directory Authentication Flow](/documentation/articles/active-directory-authentication-scenarios/), [Integrating Applications with Azure Active Directory](/documentation/articles/active-directory-integrating-applications/), and [Active Directory Authentication Protocols](https://msdn.microsoft.com/library/azure/dn151124.aspx) for additional information.</span></span>  

## <a name="key-vault-management"></a><span data-ttu-id="3d014-146">Управление хранилищем ключей</span><span class="sxs-lookup"><span data-stu-id="3d014-146">Key Vault management</span></span>
<span data-ttu-id="3d014-147">Для управления хранилищем ключей (CRUD и настройка политики доступа) клиентское приложение hello хранилища ключей должен tooaccess конечную точку диспетчера ресурсов Azure.</span><span class="sxs-lookup"><span data-stu-id="3d014-147">For Key Vault management (CRUD and setting access policy), hello key vault client application needs tooaccess an Azure Resource Manager endpoint.</span></span>  

| <span data-ttu-id="3d014-148">Тип операции</span><span class="sxs-lookup"><span data-stu-id="3d014-148">Type of operation</span></span> | <span data-ttu-id="3d014-149">Конечная точка и порт</span><span class="sxs-lookup"><span data-stu-id="3d014-149">Endpoint:port</span></span> |
| --- | --- |
| <span data-ttu-id="3d014-150">Операции уровня управления хранилищем ключей</span><span class="sxs-lookup"><span data-stu-id="3d014-150">Key Vault control plane operations</span></span><br> <span data-ttu-id="3d014-151">с использованием Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="3d014-151">via Azure Resource Manager</span></span> |<span data-ttu-id="3d014-152">**Глобально:**</span><span class="sxs-lookup"><span data-stu-id="3d014-152">**Global:**</span></span><br> <span data-ttu-id="3d014-153">management.azure.com:443</span><span class="sxs-lookup"><span data-stu-id="3d014-153">management.azure.com:443</span></span><br><br> <span data-ttu-id="3d014-154">**Azure для Китая:**</span><span class="sxs-lookup"><span data-stu-id="3d014-154">**Azure China:**</span></span><br> <span data-ttu-id="3d014-155">management.chinacloudapi.cn:443</span><span class="sxs-lookup"><span data-stu-id="3d014-155">management.chinacloudapi.cn:443</span></span><br><br> <span data-ttu-id="3d014-156">**Azure для правительства США:**</span><span class="sxs-lookup"><span data-stu-id="3d014-156">**Azure US Government:**</span></span><br> <span data-ttu-id="3d014-157">management.usgovcloudapi.net:443</span><span class="sxs-lookup"><span data-stu-id="3d014-157">management.usgovcloudapi.net:443</span></span><br><br> <span data-ttu-id="3d014-158">**Azure для Германии:**</span><span class="sxs-lookup"><span data-stu-id="3d014-158">**Azure Germany:**</span></span><br> <span data-ttu-id="3d014-159">management.microsoftazure.de:443</span><span class="sxs-lookup"><span data-stu-id="3d014-159">management.microsoftazure.de:443</span></span> |
| <span data-ttu-id="3d014-160">API Graph Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="3d014-160">Azure Active Directory Graph API</span></span> |<span data-ttu-id="3d014-161">**Глобально:**</span><span class="sxs-lookup"><span data-stu-id="3d014-161">**Global:**</span></span><br> <span data-ttu-id="3d014-162">graph.windows.net:443</span><span class="sxs-lookup"><span data-stu-id="3d014-162">graph.windows.net:443</span></span><br><br> <span data-ttu-id="3d014-163">**Azure для Китая:**</span><span class="sxs-lookup"><span data-stu-id="3d014-163">**Azure China:**</span></span><br> <span data-ttu-id="3d014-164">graph.chinacloudapi.cn:443</span><span class="sxs-lookup"><span data-stu-id="3d014-164">graph.chinacloudapi.cn:443</span></span><br><br> <span data-ttu-id="3d014-165">**Azure для правительства США:**</span><span class="sxs-lookup"><span data-stu-id="3d014-165">**Azure US Government:**</span></span><br> <span data-ttu-id="3d014-166">graph.windows.net:443</span><span class="sxs-lookup"><span data-stu-id="3d014-166">graph.windows.net:443</span></span><br><br> <span data-ttu-id="3d014-167">**Azure для Германии:**</span><span class="sxs-lookup"><span data-stu-id="3d014-167">**Azure Germany:**</span></span><br> <span data-ttu-id="3d014-168">graph.cloudapi.de:443</span><span class="sxs-lookup"><span data-stu-id="3d014-168">graph.cloudapi.de:443</span></span> |

## <a name="key-vault-operations"></a><span data-ttu-id="3d014-169">Операции с хранилищем ключей</span><span class="sxs-lookup"><span data-stu-id="3d014-169">Key Vault operations</span></span>
<span data-ttu-id="3d014-170">Для всех объектов (ключи и секретные коды) Управление хранилищем ключей и криптографических операций hello хранилища ключей клиент должен tooaccess hello хранилища ключей, конечной точки.</span><span class="sxs-lookup"><span data-stu-id="3d014-170">For all key vault object (keys and secrets) management and cryptographic operations, hello key vault client needs tooaccess hello key vault endpoint.</span></span> <span data-ttu-id="3d014-171">DNS-суффикс конечной точки Hello зависит от расположения hello хранилища ключей.</span><span class="sxs-lookup"><span data-stu-id="3d014-171">hello endpoint DNS suffix varies depending on hello location of your key vault.</span></span> <span data-ttu-id="3d014-172">Конечная точка хранилища ключей Hello имеет формат hello *имя хранилища*. *область —-dns суффикс*, как описано в следующей таблице hello.</span><span class="sxs-lookup"><span data-stu-id="3d014-172">hello key vault endpoint is of hello format *vault-name*.*region-specific-dns-suffix*, as described in hello following table.</span></span>  

| <span data-ttu-id="3d014-173">Тип операции</span><span class="sxs-lookup"><span data-stu-id="3d014-173">Type of operation</span></span> | <span data-ttu-id="3d014-174">Конечная точка и порт</span><span class="sxs-lookup"><span data-stu-id="3d014-174">Endpoint:port</span></span> |
| --- | --- |
| <span data-ttu-id="3d014-175">Операции, в том числе криптографические операции для ключей; создание, чтение, обновление и удаление ключей и секретов; задание или получение тегов и других атрибутов для объектов хранилища ключей (ключи и секреты)</span><span class="sxs-lookup"><span data-stu-id="3d014-175">Operations including cryptographic operations on keys; creating, reading, updating, and deleting keys and secrets; setting or getting tags and other attributes on key vault objects (keys or secrets)</span></span> |<span data-ttu-id="3d014-176">**Глобально:**</span><span class="sxs-lookup"><span data-stu-id="3d014-176">**Global:**</span></span><br> <span data-ttu-id="3d014-177">&lt;vault-name&gt;.vault.azure.net:443</span><span class="sxs-lookup"><span data-stu-id="3d014-177">&lt;vault-name&gt;.vault.azure.net:443</span></span><br><br> <span data-ttu-id="3d014-178">**Azure для Китая:**</span><span class="sxs-lookup"><span data-stu-id="3d014-178">**Azure China:**</span></span><br> <span data-ttu-id="3d014-179">&lt;vault-name&gt;.vault.azure.cn:443</span><span class="sxs-lookup"><span data-stu-id="3d014-179">&lt;vault-name&gt;.vault.azure.cn:443</span></span><br><br> <span data-ttu-id="3d014-180">**Azure для правительства США:**</span><span class="sxs-lookup"><span data-stu-id="3d014-180">**Azure US Government:**</span></span><br> <span data-ttu-id="3d014-181">&lt;vault-name&gt;.vault.usgovcloudapi.net:443</span><span class="sxs-lookup"><span data-stu-id="3d014-181">&lt;vault-name&gt;.vault.usgovcloudapi.net:443</span></span><br><br> <span data-ttu-id="3d014-182">**Azure для Германии:**</span><span class="sxs-lookup"><span data-stu-id="3d014-182">**Azure Germany:**</span></span><br> <span data-ttu-id="3d014-183">&lt;vault-name&gt;.vault.microsoftazure.de:443</span><span class="sxs-lookup"><span data-stu-id="3d014-183">&lt;vault-name&gt;.vault.microsoftazure.de:443</span></span> |

## <a name="ip-address-ranges"></a><span data-ttu-id="3d014-184">Диапазоны IP-адресов</span><span class="sxs-lookup"><span data-stu-id="3d014-184">IP address ranges</span></span>
<span data-ttu-id="3d014-185">Hello службы хранилища ключей использует другие ресурсы Azure, например PaaS инфраструктуры.</span><span class="sxs-lookup"><span data-stu-id="3d014-185">hello Key Vault service uses other Azure resources like PaaS infrastructure.</span></span> <span data-ttu-id="3d014-186">Поэтому нет возможности tooprovide определенного диапазона IP-адресов, хранилище ключей, будут иметь конечные точки службы в определенный момент времени.</span><span class="sxs-lookup"><span data-stu-id="3d014-186">So it's not possible tooprovide a specific range of IP addresses that Key Vault service endpoints will have at any particular time.</span></span> <span data-ttu-id="3d014-187">Если брандмауэр поддерживает только диапазоны IP-адресов, см. toohello [диапазоны IP-адресов Microsoft Azure Datacenter](https://www.microsoft.com/download/details.aspx?id=41653) документа.</span><span class="sxs-lookup"><span data-stu-id="3d014-187">If your firewall supports only IP address ranges, refer toohello [Microsoft Azure Datacenter IP Ranges](https://www.microsoft.com/download/details.aspx?id=41653) document.</span></span> <span data-ttu-id="3d014-188">Для проверки подлинности и удостоверение (Azure Active Directory), приложение должно быть toohello может tooconnect конечные точки, описанной в [проверка подлинности и удостоверение адреса](https://support.office.com/article/Office-365-URLs-and-IP-address-ranges-8548a211-3fe7-47cb-abb1-355ea5aa88a2).</span><span class="sxs-lookup"><span data-stu-id="3d014-188">For authentication and identity (Azure Active Directory), your application must be able tooconnect toohello endpoints described in [Authentication and identity addresses](https://support.office.com/article/Office-365-URLs-and-IP-address-ranges-8548a211-3fe7-47cb-abb1-355ea5aa88a2).</span></span>

## <a name="next-steps"></a><span data-ttu-id="3d014-189">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="3d014-189">Next steps</span></span>
<span data-ttu-id="3d014-190">Если у вас есть вопросы о хранилище ключей, посетите hello [форумы хранилище ключей Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=AzureKeyVault).</span><span class="sxs-lookup"><span data-stu-id="3d014-190">If you have questions about Key Vault, visit hello [Azure Key Vault Forums](https://social.msdn.microsoft.com/forums/azure/home?forum=AzureKeyVault).</span></span>

