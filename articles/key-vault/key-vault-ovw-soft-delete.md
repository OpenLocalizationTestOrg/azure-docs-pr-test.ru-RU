---
ms.assetid: 
title: "Обратимое удаление в Azure Key Vault | Документация Майкрософт"
ms.service: key-vault
author: BrucePerlerMS
ms.author: bruceper
manager: mbaldwin
ms.date: 07/10/2017
ms.openlocfilehash: c873b153ef9c7d5f55672a5918c9dc4fb7256701
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="azure-key-vault-soft-delete-overview"></a><span data-ttu-id="39e85-102">Общие сведения об обратимом удалении в Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="39e85-102">Azure Key Vault soft-delete overview</span></span>

<span data-ttu-id="39e85-103">Функция обратимого удаления в Key Vault позволяет восстанавливать удаленные хранилища и объекты хранилищ.</span><span class="sxs-lookup"><span data-stu-id="39e85-103">Key Vault's soft delete feature allows recovery of the deleted vaults and vault objects, known as soft-delete.</span></span> <span data-ttu-id="39e85-104">В частности, рассматриваются следующие сценарии:</span><span class="sxs-lookup"><span data-stu-id="39e85-104">Specifically, we address the following scenarios:</span></span>

- <span data-ttu-id="39e85-105">Поддержка восстанавливаемого удаления хранилища ключей</span><span class="sxs-lookup"><span data-stu-id="39e85-105">Support for recoverable deletion of a key vault</span></span>
- <span data-ttu-id="39e85-106">Поддержка восстанавливаемого удаления объектов Key Vault (например,</span><span class="sxs-lookup"><span data-stu-id="39e85-106">Support for recoverable deletion of key vault objects (ex.</span></span> <span data-ttu-id="39e85-107">ключей, секретов, сертификатов).</span><span class="sxs-lookup"><span data-stu-id="39e85-107">keys, secrets, certificates)</span></span>

## <a name="supporting-interfaces"></a><span data-ttu-id="39e85-108">Поддержка интерфейсов</span><span class="sxs-lookup"><span data-stu-id="39e85-108">Supporting interfaces</span></span>

<span data-ttu-id="39e85-109">Функция обратимого удаления изначально доступна через интерфейсы REST, .NET или C# и PowerShell.</span><span class="sxs-lookup"><span data-stu-id="39e85-109">The soft-delete feature is initially available through the REST, .NET/C# and PowerShell interfaces.</span></span> <span data-ttu-id="39e85-110">Дополнительные сведения см. в [документации по Key Vault](https://docs.microsoft.com/azure/key-vault/).</span><span class="sxs-lookup"><span data-stu-id="39e85-110">Refer to the references for these for more details, [Key Vault Reference](https://docs.microsoft.com/azure/key-vault/).</span></span>

## <a name="scenarios"></a><span data-ttu-id="39e85-111">Сценарии</span><span class="sxs-lookup"><span data-stu-id="39e85-111">Scenarios</span></span>

<span data-ttu-id="39e85-112">Azure Key Vault — это отслеживаемые ресурсы, управляемые Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="39e85-112">Azure Key Vaults are tracked resources, managed by Azure Resource Manager.</span></span> <span data-ttu-id="39e85-113">Azure Resource Manager также задает четко определенное поведение для удаления, которое требует, чтобы после успешной операции удаления этот ресурс больше не был доступен.</span><span class="sxs-lookup"><span data-stu-id="39e85-113">Azure Resource Manager also specifies a well-defined behavior for deletion, which requires that a successful DELETE operation must result in that resource not being accessible anymore.</span></span> <span data-ttu-id="39e85-114">Функция обратимого восстановления восстанавливает удаленный объект независимо от того, было ли удаление случайным или преднамеренным.</span><span class="sxs-lookup"><span data-stu-id="39e85-114">The soft-delete feature addresses the recovery of the deleted object, whether the deletion was accidental or intentional.</span></span>

1. <span data-ttu-id="39e85-115">В типичном сценарии пользователь может случайно удалить Key Vault или его объект. Если они будут доступны для восстановления в течение предопределенного периода, пользователь сможет отменить удаление и восстановить свои данные.</span><span class="sxs-lookup"><span data-stu-id="39e85-115">In the typical scenario, a user may have inadvertently deleted a key vault or a key vault object; if that key vault or key vault object were to be recoverable for a predetermined period, the user may undo the deletion and recover their data.</span></span>

2. <span data-ttu-id="39e85-116">В другом сценарии несанкционированный пользователь может попытаться удалить Key Vault или его объект, например ключ в хранилище, чтобы нарушить работу компании.</span><span class="sxs-lookup"><span data-stu-id="39e85-116">In a different scenario, a rogue user may attempt to delete a key vault or a key vault object, such as a key inside a vault, to cause a business disruption.</span></span> <span data-ttu-id="39e85-117">Разделение удаления Key Vault или его объектов и удаления базовых данных может использоваться как мера предосторожности, к примеру, для ограничения разрешений на удаление данных другой доверенной ролью.</span><span class="sxs-lookup"><span data-stu-id="39e85-117">Separating the deletion of the key vault or key vault object from the actual deletion of the underlying data can be used as a safety measure by, for instance, restricting permissions on data deletion to a different, trusted role.</span></span> <span data-ttu-id="39e85-118">По существу, при таком подходе требуется кворум для операции, так как в противном случае может произойти немедленная потеря данных.</span><span class="sxs-lookup"><span data-stu-id="39e85-118">This approach effectively requires quorum for an operation which might otherwise result in an immediate data loss.</span></span>

### <a name="soft-delete-behavior"></a><span data-ttu-id="39e85-119">Поведение обратимого удаления</span><span class="sxs-lookup"><span data-stu-id="39e85-119">Soft-delete behavior</span></span>

<span data-ttu-id="39e85-120">При использовании этой функции операция DELETE для хранилища ключей или его объекта является обратимым удалением. Это позволяет в течение определенного периода сохранять ресурсы, которые при этом как будто удалены.</span><span class="sxs-lookup"><span data-stu-id="39e85-120">With this feature, the DELETE operation on a key vault or key vault object is a soft-delete, effectively holding the resources for a given retention period, while giving the appearance that the object is deleted.</span></span> <span data-ttu-id="39e85-121">Затем эта служба предоставляет механизм восстановления удаленного объекта, отменяющий удаление.</span><span class="sxs-lookup"><span data-stu-id="39e85-121">The service further provides a mechanism for recovering the deleted object, essentially undoing the deletion.</span></span> 

<span data-ttu-id="39e85-122">Обратимое удаление — это дополнительная функция Key Vault, которая **не включена по умолчанию** в этом выпуске.</span><span class="sxs-lookup"><span data-stu-id="39e85-122">Soft-delete is an optional Key Vault behavior and is **not enabled by default** in this release.</span></span> <span data-ttu-id="39e85-123">Дополнительные сведения о включении обратимого удаления для вашего Key Vault см. в [документации по Key Vault](https://docs.microsoft.com/azure/key-vault/).</span><span class="sxs-lookup"><span data-stu-id="39e85-123">For details on enabling soft-delete for your key vault, see the specific guidance in the reference for the interface of your choice, [Key Vault Reference](https://docs.microsoft.com/azure/key-vault/).</span></span>

### <a name="key-vault-recovery"></a><span data-ttu-id="39e85-124">Восстановление Key Vault</span><span class="sxs-lookup"><span data-stu-id="39e85-124">Key vault recovery</span></span>

<span data-ttu-id="39e85-125">Когда хранилище ключей будет удалено, служба создаст прокси-ресурс в рамках подписки, добавив достаточное количество метаданных для восстановления.</span><span class="sxs-lookup"><span data-stu-id="39e85-125">Upon deleting a key vault, the service creates a proxy resource under the subscription, adding sufficient metadata for recovery.</span></span> <span data-ttu-id="39e85-126">Прокси-ресурс — это хранимый объект, доступный в том же месте, что и удаленное Key Vault.</span><span class="sxs-lookup"><span data-stu-id="39e85-126">The proxy resource is a stored object, available in the same location as the deleted key vault.</span></span> 

### <a name="key-vault-object-recovery"></a><span data-ttu-id="39e85-127">Восстановление объектов Key Vault</span><span class="sxs-lookup"><span data-stu-id="39e85-127">Key vault object recovery</span></span>

<span data-ttu-id="39e85-128">После удаления объекта Key Vault, например ключа, служба переведет его в удаленное состояние, делая его недоступным для любой операции извлечения.</span><span class="sxs-lookup"><span data-stu-id="39e85-128">Upon deleting a key vault object, such as a key, the service will place the object in a deleted state, thus making it inaccessible to any retrieval operations.</span></span> <span data-ttu-id="39e85-129">В этом состоянии объект хранилища ключей можно только внести в список, восстановить, а также принудительно или окончательно удалить.</span><span class="sxs-lookup"><span data-stu-id="39e85-129">While in this state, the key vault object can only be listed, recovered, or forcefully/permanently deleted.</span></span> 

<span data-ttu-id="39e85-130">В то же время Key Vault запланирует удаление базовых данных удаленного Key Vault или его объекта, чтобы удалить их по истечении предопределенного интервала хранения.</span><span class="sxs-lookup"><span data-stu-id="39e85-130">At the same time, Key Vault will schedule the deletion of the underlying data corresponding to the deleted key vault or key vault object for execution after a predetermined retention interval.</span></span> <span data-ttu-id="39e85-131">Запись DNS, соответствующая хранилищу, также сохраняется в течение этого интервала.</span><span class="sxs-lookup"><span data-stu-id="39e85-131">The DNS record corresponding to the vault is also retained for the duration of the retention interval.</span></span>

### <a name="soft-delete-retention-period"></a><span data-ttu-id="39e85-132">Период хранения при обратимом удалении</span><span class="sxs-lookup"><span data-stu-id="39e85-132">Soft-delete retention period</span></span>

<span data-ttu-id="39e85-133">Ресурсы обратимого удаления сохраняются в течение заданного периода времени — 90 дней.</span><span class="sxs-lookup"><span data-stu-id="39e85-133">Soft deleted resources are retained for a set period of time, 90 days.</span></span> <span data-ttu-id="39e85-134">В течение интервала хранения применяются следующие условия:</span><span class="sxs-lookup"><span data-stu-id="39e85-134">During the soft-delete retention interval, the following apply:</span></span>

- <span data-ttu-id="39e85-135">Вы можете вести список всех Key Vault и их объектов в состоянии обратимого удаления для вашей подписки, а также просматривать сведения об их удалении и восстановлении.</span><span class="sxs-lookup"><span data-stu-id="39e85-135">You may list all of the key vaults and key vault objects in the soft-delete state for your subscription as well as access deletion and recovery information about them.</span></span>
    - <span data-ttu-id="39e85-136">Только пользователи со специальными разрешениями могут вести список удаленных хранилищ.</span><span class="sxs-lookup"><span data-stu-id="39e85-136">Only users with special permissions can list deleted vaults.</span></span> <span data-ttu-id="39e85-137">Мы советуем нашим пользователям создать настраиваемую роль с этими разрешениями для управления удаленными хранилищами.</span><span class="sxs-lookup"><span data-stu-id="39e85-137">We recommend that our users create a custom role with these special permissions for handling deleted vaults.</span></span>
- <span data-ttu-id="39e85-138">Хранилище ключей с тем же именем не может быть создано в одном и том же месте. Соответственно, объект хранилища ключей не может быть создан в данном хранилище, если оно содержит объект с тем же именем и находится в удаленном состоянии.</span><span class="sxs-lookup"><span data-stu-id="39e85-138">A key vault with the same name cannot be created in the same location; correspondingly, a key vault object cannot be created in a given vault if that key vault contains an object with the same name and which is in a deleted state</span></span> 
- <span data-ttu-id="39e85-139">Только пользователь со специальными привилегиями может восстановить хранилище ключей или его объект, выполнив команду восстановления на соответствующем прокси-ресурсе.</span><span class="sxs-lookup"><span data-stu-id="39e85-139">Only a specifically privileged user may restore a key vault or key vault object by issuing a recover command on the corresponding proxy resource.</span></span>
    - <span data-ttu-id="39e85-140">Пользователь, участник настраиваемой роли, у которого есть привилегии создавать хранилище ключей в группе ресурсов, может восстановить хранилище.</span><span class="sxs-lookup"><span data-stu-id="39e85-140">The user, member of the custom role, who has the privilege to create a key vault under the resource group can restore the vault.</span></span>
- <span data-ttu-id="39e85-141">Только пользователь со специальными привилегиями может принудительно удалить хранилище ключей или его объект, выполнив команду удаления на соответствующем прокси-ресурсе.</span><span class="sxs-lookup"><span data-stu-id="39e85-141">Only a specifically privileged user may forcibly delete a key vault or key vault object by issuing a delete command on the corresponding proxy resource.</span></span>

<span data-ttu-id="39e85-142">Если хранилище ключей или его объект не будут восстановлены, служба выполнит очистку обратимо удаленного хранилища ключей или его объекта вместе с содержимым в конце периода хранения.</span><span class="sxs-lookup"><span data-stu-id="39e85-142">Unless a key vault or key vault object is recovered, at the end of the retention interval the service performs a purge of the soft-deleted key vault or key vault object and its content.</span></span> <span data-ttu-id="39e85-143">Удаление ресурса нельзя запланировать повторно.</span><span class="sxs-lookup"><span data-stu-id="39e85-143">Resource deletion may not be rescheduled.</span></span>

### <a name="permitted-purge"></a><span data-ttu-id="39e85-144">Разрешенная очистка</span><span class="sxs-lookup"><span data-stu-id="39e85-144">Permitted purge</span></span>

<span data-ttu-id="39e85-145">Окончательное удаление и очистку хранилища ключей можно выполнить с помощью операции POST на прокси-ресурсе. Это требует специальных привилегий.</span><span class="sxs-lookup"><span data-stu-id="39e85-145">Permanently deleting, purging, a key vault is possible via a POST operation on the proxy resource and requires special privileges.</span></span> <span data-ttu-id="39e85-146">Как правило, только владелец подписки может очистить хранилище ключей.</span><span class="sxs-lookup"><span data-stu-id="39e85-146">Generally, only the subscription owner will be able to purge a key vault.</span></span> <span data-ttu-id="39e85-147">Операция POST активирует немедленное и необратимое удаление этого хранилища.</span><span class="sxs-lookup"><span data-stu-id="39e85-147">The POST operation triggers the immediate and irrecoverable deletion of that vault.</span></span> 

<span data-ttu-id="39e85-148">Исключением является случай, когда подписка Azure была помечена как *неудаляемая*.</span><span class="sxs-lookup"><span data-stu-id="39e85-148">An exception to this is the case when the Azure subscription has been marked as *undeletable*.</span></span> <span data-ttu-id="39e85-149">В этом случае только служба может выполнить фактическое удаление в рамках запланированной процедуры.</span><span class="sxs-lookup"><span data-stu-id="39e85-149">In this case, only the service may then perform the actual deletion, and does so as a scheduled process.</span></span> 



