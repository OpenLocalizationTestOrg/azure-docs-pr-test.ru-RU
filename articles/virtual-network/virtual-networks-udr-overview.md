---
title: "aaaUser определенные маршруты и IP-пересылки в Azure | Документы Microsoft"
description: "Узнайте, как определяемые пользователем маршруты tooconfigure (UDR) и IP-пересылка tooforward трафика toonetwork виртуальных устройств в Azure."
services: virtual-network
documentationcenter: na
author: jimdial
manager: timlt
editor: tysonn
ms.assetid: c39076c4-11b7-4b46-a904-817503c4b486
ms.service: virtual-network
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/15/2016
ms.author: jdial
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: f1f1d46166d5a7c776f472b7ade1354d943ece10
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="user-defined-routes-and-ip-forwarding"></a><span data-ttu-id="1da32-103">Определяемые пользователем маршруты и IP-пересылка</span><span class="sxs-lookup"><span data-stu-id="1da32-103">User-defined routes and IP forwarding</span></span>

<span data-ttu-id="1da32-104">При добавлении виртуальных машин (ВМ) tooa виртуальной сети (VNet) в Azure, вы заметите hello виртуальные машины, может toocommunicate друг с другом по сети hello автоматически.</span><span class="sxs-lookup"><span data-stu-id="1da32-104">When you add virtual machines (VMs) tooa virtual network (VNet) in Azure, you will notice that hello VMs are able toocommunicate with each other over hello network, automatically.</span></span> <span data-ttu-id="1da32-105">Необязательно toospecify шлюз, даже если hello виртуальные машины находятся в разных подсетях.</span><span class="sxs-lookup"><span data-stu-id="1da32-105">You do not need toospecify a gateway, even though hello VMs are in different subnets.</span></span> <span data-ttu-id="1da32-106">Hello то же верно для обмена данными между toohello ВМ hello общедоступный Интернет и даже tooyour в локальной сети, когда владельцем гибридного подключения из Azure tooyour присутствует центра обработки данных.</span><span class="sxs-lookup"><span data-stu-id="1da32-106">hello same is true for communication from hello VMs toohello public Internet, and even tooyour on-premises network when a hybrid connection from Azure tooyour own datacenter is present.</span></span>

<span data-ttu-id="1da32-107">Этот поток сообщений возможна, так как Azure предлагает ряд toodefine маршруты системы, как IP-трафик проходит.</span><span class="sxs-lookup"><span data-stu-id="1da32-107">This flow of communication is possible because Azure uses a series of system routes toodefine how IP traffic flows.</span></span> <span data-ttu-id="1da32-108">Маршруты системы управления hello поток сообщений в hello следующие сценарии:</span><span class="sxs-lookup"><span data-stu-id="1da32-108">System routes control hello flow of communication in hello following scenarios:</span></span>

* <span data-ttu-id="1da32-109">Изнутри hello одной подсети.</span><span class="sxs-lookup"><span data-stu-id="1da32-109">From within hello same subnet.</span></span>
* <span data-ttu-id="1da32-110">Из tooanother подсети в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="1da32-110">From a subnet tooanother within a VNet.</span></span>
* <span data-ttu-id="1da32-111">Из виртуальных машин toohello Интернета.</span><span class="sxs-lookup"><span data-stu-id="1da32-111">From VMs toohello Internet.</span></span>
* <span data-ttu-id="1da32-112">Из tooanother виртуальная сеть виртуальной сети через VPN-шлюза.</span><span class="sxs-lookup"><span data-stu-id="1da32-112">From a VNet tooanother VNet through a VPN gateway.</span></span>
* <span data-ttu-id="1da32-113">Из виртуальной сети tooanother виртуальной сети через виртуальную сеть Пиринга (привязка службы).</span><span class="sxs-lookup"><span data-stu-id="1da32-113">From a VNet tooanother VNet through VNet Peering (Service Chaining).</span></span>
* <span data-ttu-id="1da32-114">Из локальной сети tooyour виртуальной сети через VPN-шлюза.</span><span class="sxs-lookup"><span data-stu-id="1da32-114">From a VNet tooyour on-premises network through a VPN gateway.</span></span>

<span data-ttu-id="1da32-115">Hello ниже рисунке простая настройка виртуальной сети, две подсети и несколько виртуальных машин, а также hello системы маршруты, позволяющие tooflow трафика IP.</span><span class="sxs-lookup"><span data-stu-id="1da32-115">hello figure below shows a simple setup with a VNet, two subnets, and a few VMs, along with hello system routes that allow IP traffic tooflow.</span></span>

![Системные маршруты в Azure](./media/virtual-networks-udr-overview/Figure1.png)

<span data-ttu-id="1da32-117">Несмотря на то, что использование hello маршруты системы упрощает трафика автоматически для развертывания, существуют случаи, в которых требуется toocontrol hello маршрутизацию пакетов с помощью виртуального устройства.</span><span class="sxs-lookup"><span data-stu-id="1da32-117">Although hello use of system routes facilitates traffic automatically for your deployment, there are cases in which you want toocontrol hello routing of packets through a virtual appliance.</span></span> <span data-ttu-id="1da32-118">Таким образом, создав определяемые пользователем маршруты, указываются hello следующего прыжка для пакетов, вместо передачи tooa конкретной подсети toogo tooyour виртуальное устройство и включение IP пересылки для hello виртуальная машина, работающая как виртуальное устройство hello.</span><span class="sxs-lookup"><span data-stu-id="1da32-118">You can do so by creating user defined routes that specify hello next hop for packets flowing tooa specific subnet toogo tooyour virtual appliance instead, and enabling IP forwarding for hello VM running as hello virtual appliance.</span></span>

<span data-ttu-id="1da32-119">Hello на рисунке ниже показан пример определяемые пользователем маршруты и IP-пересылки пакетов tooforce отправленных tooone подсети из другой toogo виртуального устройства в третьем подсети.</span><span class="sxs-lookup"><span data-stu-id="1da32-119">hello figure below shows an example of user defined routes and IP forwarding tooforce packets sent tooone subnet from another toogo through a virtual appliance on a third subnet.</span></span>

![Системные маршруты в Azure](./media/virtual-networks-udr-overview/Figure2.png)

> [!IMPORTANT]
> <span data-ttu-id="1da32-121">Определяемые пользователем маршруты не применен tootraffic, оставляя подсеть из любой ресурс (например, сетевые интерфейсы вложенных tooVMs) в подсети hello.</span><span class="sxs-lookup"><span data-stu-id="1da32-121">User-defined routes are applied tootraffic leaving a subnet from any resource (such as network interfaces attached tooVMs) in hello subnet.</span></span> <span data-ttu-id="1da32-122">Не удается создать маршруты toospecify как трафик вводит подсеть из Интернета, hello для экземпляра.</span><span class="sxs-lookup"><span data-stu-id="1da32-122">You cannot create routes toospecify how traffic enters a subnet from hello Internet, for instance.</span></span> <span data-ttu-id="1da32-123">устройство Hello, пересылке трафика toocannot находиться в hello происхождения трафика hello одной подсети.</span><span class="sxs-lookup"><span data-stu-id="1da32-123">hello appliance you are forwarding traffic toocannot be in hello same subnet where hello traffic originates.</span></span> <span data-ttu-id="1da32-124">Всегда создавайте отдельную подсеть для устройств.</span><span class="sxs-lookup"><span data-stu-id="1da32-124">Always create a separate subnet for your appliances.</span></span> 
> 
> 

## <a name="route-resource"></a><span data-ttu-id="1da32-125">Маршрутизация ресурсов</span><span class="sxs-lookup"><span data-stu-id="1da32-125">Route resource</span></span>
<span data-ttu-id="1da32-126">Пакеты направляются через сеть TCP/IP, исходя из таблицы маршрутизации, определенные в каждом узле hello физической сети.</span><span class="sxs-lookup"><span data-stu-id="1da32-126">Packets are routed over a TCP/IP network based on a route table defined at each node on hello physical network.</span></span> <span data-ttu-id="1da32-127">Таблицы маршрутов — коллекция отдельных маршрутов используемых toodecide, где tooforward пакетов на основе hello конечный IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="1da32-127">A route table is a collection of individual routes used toodecide where tooforward packets based on hello destination IP address.</span></span> <span data-ttu-id="1da32-128">Маршрут состоит из следующих hello.</span><span class="sxs-lookup"><span data-stu-id="1da32-128">A route consists of hello following:</span></span>

| <span data-ttu-id="1da32-129">Свойство</span><span class="sxs-lookup"><span data-stu-id="1da32-129">Property</span></span> | <span data-ttu-id="1da32-130">Описание</span><span class="sxs-lookup"><span data-stu-id="1da32-130">Description</span></span> | <span data-ttu-id="1da32-131">Ограничения</span><span class="sxs-lookup"><span data-stu-id="1da32-131">Constraints</span></span> | <span data-ttu-id="1da32-132">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="1da32-132">Considerations</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="1da32-133">Префикс адреса</span><span class="sxs-lookup"><span data-stu-id="1da32-133">Address Prefix</span></span> |<span data-ttu-id="1da32-134">применяется Hello целевой CIDR toowhich hello маршрут, например 10.1.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="1da32-134">hello destination CIDR toowhich hello route applies, such as 10.1.0.0/16.</span></span> |<span data-ttu-id="1da32-135">Должен быть допустимый CIDR диапазон, представляющий адресов hello общедоступный Интернет, виртуальная сеть Azure или на локальном центре обработки данных.</span><span class="sxs-lookup"><span data-stu-id="1da32-135">Must be a valid CIDR range representing addresses on hello public Internet, Azure virtual network, or on-premises datacenter.</span></span> |<span data-ttu-id="1da32-136">Убедитесь, что hello **префикс адреса** не содержит адрес hello для hello **адрес следующего прыжка**, в противном случае будет ввести пакеты в цикле, поступающих из следующего прыжка hello источника toohello без попадание Назначение Hello.</span><span class="sxs-lookup"><span data-stu-id="1da32-136">Make sure hello **Address prefix** does not contain hello address for hello **Next hop address**, otherwise your packets will enter in a loop going from hello source toohello next hop without ever reaching hello destination.</span></span> |
| <span data-ttu-id="1da32-137">Тип следующего прыжка</span><span class="sxs-lookup"><span data-stu-id="1da32-137">Next hop type</span></span> |<span data-ttu-id="1da32-138">Тип Hello Azure прыжка hello пакета должны отправляться.</span><span class="sxs-lookup"><span data-stu-id="1da32-138">hello type of Azure hop hello packet should be sent to.</span></span> |<span data-ttu-id="1da32-139">Должен быть hello следующие значения:</span><span class="sxs-lookup"><span data-stu-id="1da32-139">Must be one of hello following values:</span></span> <br/> <span data-ttu-id="1da32-140">**Виртуальная сеть**.</span><span class="sxs-lookup"><span data-stu-id="1da32-140">**Virtual Network**.</span></span> <span data-ttu-id="1da32-141">Представляет hello локальной виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="1da32-141">Represents hello local virtual network.</span></span> <span data-ttu-id="1da32-142">Для экземпляра, если имеются две подсети 10.1.0.0/16 и 10.2.0.0/16 в Здравствуйте одной виртуальной сети, hello маршрута для каждой подсети в таблице маршрутов hello будет иметь значение следующего прыжка *виртуальной сети*.</span><span class="sxs-lookup"><span data-stu-id="1da32-142">For instance, if you have two subnets, 10.1.0.0/16 and 10.2.0.0/16 in hello same virtual network, hello route for each subnet in hello route table will have a next hop value of *Virtual Network*.</span></span> <br/> <span data-ttu-id="1da32-143">**Шлюз виртуальной сети**.</span><span class="sxs-lookup"><span data-stu-id="1da32-143">**Virtual Network Gateway**.</span></span> <span data-ttu-id="1da32-144">Представляет шлюз VPN типа «сеть-сеть» Azure.</span><span class="sxs-lookup"><span data-stu-id="1da32-144">Represents an Azure S2S VPN Gateway.</span></span> <br/> <span data-ttu-id="1da32-145">**Интернет**.</span><span class="sxs-lookup"><span data-stu-id="1da32-145">**Internet**.</span></span> <span data-ttu-id="1da32-146">Представляет шлюз Интернета по умолчанию hello, предоставляемые hello инфраструктуры Azure.</span><span class="sxs-lookup"><span data-stu-id="1da32-146">Represents hello default Internet gateway provided by hello Azure Infrastructure.</span></span> <br/> <span data-ttu-id="1da32-147">**Виртуальное устройство**.</span><span class="sxs-lookup"><span data-stu-id="1da32-147">**Virtual Appliance**.</span></span> <span data-ttu-id="1da32-148">Представляет виртуальное устройство, вы добавили tooyour виртуальной сети Azure.</span><span class="sxs-lookup"><span data-stu-id="1da32-148">Represents a virtual appliance you added tooyour Azure virtual network.</span></span> <br/> <span data-ttu-id="1da32-149">**None**.</span><span class="sxs-lookup"><span data-stu-id="1da32-149">**None**.</span></span> <span data-ttu-id="1da32-150">Представляет «черную дыру».</span><span class="sxs-lookup"><span data-stu-id="1da32-150">Represents a black hole.</span></span> <span data-ttu-id="1da32-151">Пакеты, отправляемые tooa черная дыра вообще не будут перенаправляться.</span><span class="sxs-lookup"><span data-stu-id="1da32-151">Packets forwarded tooa black hole will not be forwarded at all.</span></span> |<span data-ttu-id="1da32-152">Рассмотрите возможность использования **виртуальное устройство** toodirect трафика tooa виртуальной Машины или подсистемы балансировки нагрузки Azure внутренний IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="1da32-152">Consider using **Virtual Appliance** toodirect traffic tooa VM or Azure Load Balancer internal IP address.</span></span>  <span data-ttu-id="1da32-153">Этот тип позволяет задавать hello IP-адреса, как описано ниже.</span><span class="sxs-lookup"><span data-stu-id="1da32-153">This type allows hello specification of an IP address as described below.</span></span> <span data-ttu-id="1da32-154">Рассмотрите возможность использования **нет** toostop пакеты из потоковые tooa в заданный конечный тип.</span><span class="sxs-lookup"><span data-stu-id="1da32-154">Consider using a **None** type toostop packets from flowing tooa given destination.</span></span> |
| <span data-ttu-id="1da32-155">Адрес следующего прыжка</span><span class="sxs-lookup"><span data-stu-id="1da32-155">Next hop address</span></span> |<span data-ttu-id="1da32-156">адрес следующего прыжка Hello содержит hello IP-адрес, который следует переадресовать пакеты.</span><span class="sxs-lookup"><span data-stu-id="1da32-156">hello next hop address contains hello IP address packets should be forwarded to.</span></span> <span data-ttu-id="1da32-157">Значения следующего прыжка разрешены только в маршрутах, где тип следующего прыжка hello *виртуальное устройство*.</span><span class="sxs-lookup"><span data-stu-id="1da32-157">Next hop values are only allowed in routes where hello next hop type is *Virtual Appliance*.</span></span> |<span data-ttu-id="1da32-158">Должен быть IP-адрес, доступная в виртуальной сети, где применяется hello пользователем маршрута, минуя hello **шлюза виртуальной сети**.</span><span class="sxs-lookup"><span data-stu-id="1da32-158">Must be an IP address that is reachable within hello Virtual Network where hello User Defined Route is applied, without going through a **Virtual Network Gateway**.</span></span> <span data-ttu-id="1da32-159">Hello IP-адрес имеет toobe на одной виртуальной сети, где он применяется hello, peered виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="1da32-159">hello IP address has toobe on hello same Virtual Network where it is applied, or on a peered Virtual Network.</span></span> |<span data-ttu-id="1da32-160">Если IP-адрес hello представляет виртуальную Машину, убедитесь, что включен [IP-пересылки](#IP-forwarding) в Azure для hello виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="1da32-160">If hello IP address represents a VM, make sure you enable [IP forwarding](#IP-forwarding) in Azure for hello VM.</span></span> <span data-ttu-id="1da32-161">Hello представляет hello внутренний IP-адрес подсистемы балансировки нагрузки Azure, убедитесь, что у вас есть соответствующие правила для каждого порта с балансировкой нагрузки следует tooload баланс.</span><span class="sxs-lookup"><span data-stu-id="1da32-161">If hello IP address represents hello internal IP address of Azure Load Balancer, make sure you have a matching load balancing rule for each port you wish tooload balance.</span></span>|

<span data-ttu-id="1da32-162">В Azure PowerShell, некоторые значения «NextHopType» hello имеют различные имена:</span><span class="sxs-lookup"><span data-stu-id="1da32-162">In Azure PowerShell some of hello "NextHopType" values have different names:</span></span>

* <span data-ttu-id="1da32-163">"Виртуальная сеть" — VnetLocal,</span><span class="sxs-lookup"><span data-stu-id="1da32-163">Virtual Network is VnetLocal</span></span>
* <span data-ttu-id="1da32-164">"Шлюз виртуальной сети" — VirtualNetworkGateway,</span><span class="sxs-lookup"><span data-stu-id="1da32-164">Virtual Network Gateway is VirtualNetworkGateway</span></span>
* <span data-ttu-id="1da32-165">"Виртуальное устройство" — VirtualAppliance,</span><span class="sxs-lookup"><span data-stu-id="1da32-165">Virtual Appliance is VirtualAppliance</span></span>
* <span data-ttu-id="1da32-166">"Интернет" — Internet,</span><span class="sxs-lookup"><span data-stu-id="1da32-166">Internet is Internet</span></span>
* <span data-ttu-id="1da32-167">None (Нет) — None.</span><span class="sxs-lookup"><span data-stu-id="1da32-167">None is None</span></span>

### <a name="system-routes"></a><span data-ttu-id="1da32-168">Системные маршруты</span><span class="sxs-lookup"><span data-stu-id="1da32-168">System routes</span></span>
<span data-ttu-id="1da32-169">Каждой подсети в виртуальной сети, автоматически связывается с маршрута таблицу, содержащую hello маршрута правилам системы:</span><span class="sxs-lookup"><span data-stu-id="1da32-169">Every subnet created in a virtual network is automatically associated with a route table that contains hello following system route rules:</span></span>

* <span data-ttu-id="1da32-170">**Локальное правило виртуальной сети**: это правило создается автоматически для каждой подсети в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="1da32-170">**Local Vnet Rule**: This rule is automatically created for every subnet in a virtual network.</span></span> <span data-ttu-id="1da32-171">Указывает, что имеется прямая связь между виртуальными машинами hello в hello виртуальной сети и не промежуточного следующего прыжка.</span><span class="sxs-lookup"><span data-stu-id="1da32-171">It specifies that there is a direct link between hello VMs in hello VNet and there is no intermediate next hop.</span></span>
* <span data-ttu-id="1da32-172">**Локальные правила**: это правило применяется tooall трафика, предназначенного toohello локальных адресов и использует VPN-шлюза в качестве следующего прыжка назначения hello.</span><span class="sxs-lookup"><span data-stu-id="1da32-172">**On-premises Rule**: This rule applies tooall traffic destined toohello on-premises address range and uses VPN gateway as hello next hop destination.</span></span>
* <span data-ttu-id="1da32-173">**Правило IIS**: это правило обрабатывает все toohello трафика, предназначенного общедоступный Интернет (0.0.0.0/0 префикс адреса) и использует инфраструктуру hello Интернет-шлюзу как hello следующего прыжка для всех toohello трафика, предназначенного Интернета.</span><span class="sxs-lookup"><span data-stu-id="1da32-173">**Internet Rule**: This rule handles all traffic destined toohello public Internet (address prefix 0.0.0.0/0) and uses hello infrastructure internet gateway as hello next hop for all traffic destined toohello Internet.</span></span>

### <a name="user-defined-routes"></a><span data-ttu-id="1da32-174">Определяемые пользователем маршруты</span><span class="sxs-lookup"><span data-stu-id="1da32-174">User-defined routes</span></span>
<span data-ttu-id="1da32-175">Для большинства сред потребуется только маршруты системы hello уже определен в Azure.</span><span class="sxs-lookup"><span data-stu-id="1da32-175">For most environments you will only need hello system routes already defined by Azure.</span></span> <span data-ttu-id="1da32-176">Тем не менее могут требуется toocreate таблицы маршрутов и добавьте один или несколько маршрутов в определенных случаях, например:</span><span class="sxs-lookup"><span data-stu-id="1da32-176">However, you may need toocreate a route table and add one or more routes in specific cases, such as:</span></span>

* <span data-ttu-id="1da32-177">Принудительное туннелирование toohello Интернета по локальной сети.</span><span class="sxs-lookup"><span data-stu-id="1da32-177">Force tunneling toohello Internet via your on-premises network.</span></span>
* <span data-ttu-id="1da32-178">Использование виртуальных устройств в среде Azure.</span><span class="sxs-lookup"><span data-stu-id="1da32-178">Use of virtual appliances in your Azure environment.</span></span>

<span data-ttu-id="1da32-179">В выше сценариев hello будет иметь toocreate таблицы маршрутов и добавьте tooit определяемых пользователем маршрутов.</span><span class="sxs-lookup"><span data-stu-id="1da32-179">In hello scenarios above, you will have toocreate a route table and add user defined routes tooit.</span></span> <span data-ttu-id="1da32-180">Может иметь несколько таблиц маршрутов и hello же таблица маршрутов может быть связан tooone или другие подсети.</span><span class="sxs-lookup"><span data-stu-id="1da32-180">You can have multiple route tables, and hello same route table can be associated tooone or more subnets.</span></span> <span data-ttu-id="1da32-181">И в каждой подсети можно только таблицы связанного tooa один маршрут.</span><span class="sxs-lookup"><span data-stu-id="1da32-181">And each subnet can only be associated tooa single route table.</span></span> <span data-ttu-id="1da32-182">Все виртуальные машины и облачные службы в подсети использовать hello маршрута связанные таблицы toothat подсеть.</span><span class="sxs-lookup"><span data-stu-id="1da32-182">All VMs and cloud services in a subnet use hello route table associated toothat subnet.</span></span>

<span data-ttu-id="1da32-183">Подсети используют маршруты системы до подсети toohello связанные таблицы маршрутов.</span><span class="sxs-lookup"><span data-stu-id="1da32-183">Subnets rely on system routes until a route table is associated toohello subnet.</span></span> <span data-ttu-id="1da32-184">После того, как эта связь установлена, маршрутизация выполняется по совпадению наиболее длинного префикса (LPM) среди определяемых пользователем маршрутов и системных маршрутов.</span><span class="sxs-lookup"><span data-stu-id="1da32-184">Once an association exists, routing is done based on Longest Prefix Match (LPM) among both user defined routes and system routes.</span></span> <span data-ttu-id="1da32-185">Если имеется несколько маршрутов с hello же LPM соответствует выбираться маршрут в зависимости от ее источника в hello последовательностью:</span><span class="sxs-lookup"><span data-stu-id="1da32-185">If there is more than one route with hello same LPM match then a route is selected based on its origin in hello following order:</span></span>

1. <span data-ttu-id="1da32-186">определяемый пользователем маршрут;</span><span class="sxs-lookup"><span data-stu-id="1da32-186">User defined route</span></span>
2. <span data-ttu-id="1da32-187">маршрут BGP (если используется ExpressRoute);</span><span class="sxs-lookup"><span data-stu-id="1da32-187">BGP route (when ExpressRoute is used)</span></span>
3. <span data-ttu-id="1da32-188">Системные маршруты</span><span class="sxs-lookup"><span data-stu-id="1da32-188">System route</span></span>

<span data-ttu-id="1da32-189">toolearn toocreate пользователем маршруты, в статье [как tooCreate направляет и включить IP-пересылки в Azure](virtual-network-create-udr-arm-template.md).</span><span class="sxs-lookup"><span data-stu-id="1da32-189">toolearn how toocreate user defined routes, see [How tooCreate Routes and Enable IP Forwarding in Azure](virtual-network-create-udr-arm-template.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="1da32-190">Определяемые пользователем маршруты являются только примененных tooAzure виртуальных машин и облачных служб.</span><span class="sxs-lookup"><span data-stu-id="1da32-190">User defined routes are only applied tooAzure VMs and cloud services.</span></span> <span data-ttu-id="1da32-191">Для экземпляра Если требуется tooadd виртуального устройства брандмауэра между локальной сетью и Azure, имеется toocreate определяемых пользователем маршрут для таблиц Azure маршрутизации, пересылающий весь трафик, идущий toohello пространства адресов локальной toohello виртуального устройство.</span><span class="sxs-lookup"><span data-stu-id="1da32-191">For instance, if you want tooadd a firewall virtual appliance between your on-premises network and Azure, you will have toocreate a user defined route for your Azure route tables that forwards all traffic going toohello on-premises address space toohello virtual appliance.</span></span> <span data-ttu-id="1da32-192">Можно также добавить является определяемым пользователем весь трафик из локальной tooAzure tooforward GatewaySubnet toohello маршрута (UDR) через hello виртуального устройства.</span><span class="sxs-lookup"><span data-stu-id="1da32-192">You can also add a user defined route (UDR) toohello GatewaySubnet tooforward all traffic from on-premises tooAzure through hello virtual appliance.</span></span> <span data-ttu-id="1da32-193">Такая возможность появился только недавно.</span><span class="sxs-lookup"><span data-stu-id="1da32-193">This is a recent addition.</span></span>
> 
> 

### <a name="bgp-routes"></a><span data-ttu-id="1da32-194">Маршруты BGP</span><span class="sxs-lookup"><span data-stu-id="1da32-194">BGP routes</span></span>
<span data-ttu-id="1da32-195">При наличии подключения ExpressRoute между локальной сетью и Azure, можно включить BGP toopropagate маршруты из вашей локальной сети tooAzure.</span><span class="sxs-lookup"><span data-stu-id="1da32-195">If you have an ExpressRoute connection between your on-premises network and Azure, you can enable BGP toopropagate routes from your on-premises network tooAzure.</span></span> <span data-ttu-id="1da32-196">Эти маршруты BGP используются в hello так же, как система маршруты и пользователь определенных маршрутов в каждой подсети в Azure.</span><span class="sxs-lookup"><span data-stu-id="1da32-196">These BGP routes are used in hello same way as system routes and user defined routes in each Azure subnet.</span></span> <span data-ttu-id="1da32-197">Дополнительную информацию см. во [введении в ExpressRoute](../expressroute/expressroute-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="1da32-197">For more information see [ExpressRoute Introduction](../expressroute/expressroute-introduction.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="1da32-198">Можно настроить принудительного toouse вашей среды Azure, туннелирования с помощью локальной сети, создав пользовательские маршрут для подсети 0.0.0.0/0, использующий hello VPN-шлюза в качестве следующего прыжка hello.</span><span class="sxs-lookup"><span data-stu-id="1da32-198">You can configure your Azure environment toouse force tunneling through your on-premises network by creating a user defined route for subnet 0.0.0.0/0 that uses hello VPN gateway as hello next hop.</span></span> <span data-ttu-id="1da32-199">Тем не менее, это работает только при использовании шлюза VPN, не ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="1da32-199">However, this only works if you are using a VPN gateway, not ExpressRoute.</span></span> <span data-ttu-id="1da32-200">Для ExpressRoute принудительное туннелирование настраивается с помощью BGP.</span><span class="sxs-lookup"><span data-stu-id="1da32-200">For ExpressRoute, forced tunneling is configured through BGP.</span></span>
> 
> 

## <a name="ip-forwarding"></a><span data-ttu-id="1da32-201">IP-пересылка</span><span class="sxs-lookup"><span data-stu-id="1da32-201">IP forwarding</span></span>
<span data-ttu-id="1da32-202">Как описано выше, в один из основных причин toocreate hello маршрут определенные пользователем — tooforward трафика tooa виртуального устройства.</span><span class="sxs-lookup"><span data-stu-id="1da32-202">As described above, one of hello main reasons toocreate a user defined route is tooforward traffic tooa virtual appliance.</span></span> <span data-ttu-id="1da32-203">Виртуальное устройство — это ничто иное виртуальной Машины, которая запускает приложение, toohandle сетевой трафик определенным образом, например брандмауэром или устройством NAT.</span><span class="sxs-lookup"><span data-stu-id="1da32-203">A virtual appliance is nothing more than a VM that runs an application used toohandle network traffic in some way, such as a firewall or a NAT device.</span></span>

<span data-ttu-id="1da32-204">Это виртуальное устройство виртуальной Машины, необходимо будет tooreceive входящий трафик, не рассматриваются tooitself.</span><span class="sxs-lookup"><span data-stu-id="1da32-204">This virtual appliance VM must be able tooreceive incoming traffic that is not addressed tooitself.</span></span> <span data-ttu-id="1da32-205">tooallow tooreceive трафика виртуальных Машин внимания tooother назначения, необходимо включить IP-пересылку для hello виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="1da32-205">tooallow a VM tooreceive traffic addressed tooother destinations, you must enable IP Forwarding for hello VM.</span></span> <span data-ttu-id="1da32-206">Это политика, не соответствует hello гостевой ОС Azure.</span><span class="sxs-lookup"><span data-stu-id="1da32-206">This is an Azure setting, not a setting in hello guest operating system.</span></span>

## <a name="next-steps"></a><span data-ttu-id="1da32-207">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="1da32-207">Next steps</span></span>
* <span data-ttu-id="1da32-208">Узнайте, каким образом слишком[создайте маршруты в модели развертывания диспетчера ресурсов hello](virtual-network-create-udr-arm-template.md) и связать их toosubnets.</span><span class="sxs-lookup"><span data-stu-id="1da32-208">Learn how too[create routes in hello Resource Manager deployment model](virtual-network-create-udr-arm-template.md) and associate them toosubnets.</span></span> 
* <span data-ttu-id="1da32-209">Узнайте, каким образом слишком[создайте маршруты в hello классической модели развертывания](virtual-network-create-udr-classic-ps.md) и связать их toosubnets.</span><span class="sxs-lookup"><span data-stu-id="1da32-209">Learn how too[create routes in hello classic deployment model](virtual-network-create-udr-classic-ps.md) and associate them toosubnets.</span></span>

