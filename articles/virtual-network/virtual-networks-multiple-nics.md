---
title: "aaaCreate виртуальной Машины (классические) с несколькими сетевыми адаптерами, с помощью PowerShell | Документы Microsoft"
description: "Узнайте, как toocreate и настройка виртуальных машин с несколькими сетевыми адаптерами, с помощью PowerShell."
services: virtual-network, virtual-machines
documentationcenter: na
author: jimdial
manager: carmonm
editor: tysonn
tags: azure-service-management
ms.assetid: a1a3952c-2dcc-4977-bd7a-52d623c1fb07
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 02/02/2016
ms.author: jdial
ms.openlocfilehash: 8ef35bd4cfd7e6a527080f1cfc541275ca86f5e7
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="create-a-vm-classic-with-multiple-nics"></a>Создание виртуальных машин (классическая модель) с несколькими сетевыми интерфейсами
Можно создавать виртуальные машины (ВМ) в Azure и присоединить несколько tooeach сетевых интерфейсов (NIC) виртуальных машин. Это необходимо для целого ряда сетевых устройств (например, в составе решений для доставки приложений и оптимизации работы глобальной сети). Кроме того, поддержка нескольких сетевых интерфейсов обеспечивает изоляцию трафика между ними.

![Несколько сетевых адаптеров на виртуальной машине](./media/virtual-networks-multiple-nics/IC757773.png)

Рисунок отображает Hello виртуальной Машины с тремя сетевыми адаптерами, подключить tooa другой подсети.

> [!IMPORTANT]
> В Azure предлагаются две модели развертывания для создания ресурсов и работы с ними: [модель Resource Manager и классическая модель](../resource-manager-deployment-model.md). В этой статье описан с помощью hello классической модели развертывания. Для большинства новых развертываний мы рекомендуем использовать модель развертывания с помощью Azure Resource Manager.

* С выходом в Интернет виртуального IP-адреса (классического развертывания) поддерживается только на сетевом адаптере hello «default». Имеется только один виртуальный IP-адрес toohello IP-адрес сетевого адаптера. по умолчанию hello
* В настоящее время для виртуальных машин с несколькими сетевыми картами не поддерживаются общедоступные IP-адреса уровня экземпляра (LPIP) (классические развертывания).
* Здравствуйте, порядок сетевых адаптеров hello в внутри hello виртуальной Машины будет произвольным и может изменяться при обновлениях инфраструктуры Azure. Здравствуйте, IP-адресов, но hello соответствующие ethernet MAC адреса остаются одинаковыми hello. Например, предположим, **Eth1** имеет IP-адрес 10.1.0.100 и MAC-адрес 00-0D-3A-B0-39-0D; после обновления инфраструктуры Azure и перезагрузки, он может быть изменен слишком**Eth2**, но hello IP- и MAC связывания будет остаются одинаковыми hello. Если перезагрузка инициирована клиентом, hello порядок сетевого Адаптера останется таким же hello.
* Hello адрес для каждого сетевого Адаптера на каждой виртуальной Машине должен быть расположен в подсети, несколько сетевых адаптеров на одной виртуальной Машине можно каждой назначен Здравствуйте, адреса, которые находятся в одной подсети.
* Hello размер виртуальной Машины определяет hello количество сетевых Адаптеров, которые можно создать для виртуальной Машины. Справочник по hello [Windows Server](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) и [Linux](../virtual-machines/linux/sizes.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) виртуальной Машины размеров toodetermine статей, какое количество сетевых Адаптеров, размер каждой виртуальной Машины. 

## <a name="network-security-groups-nsgs"></a>Группы безопасности сети (NSG)
В развертывании диспетчера ресурсов любая сетевая карта на виртуальной машине может быть связана с группой безопасности сети (NSG), включая сетевые карты на виртуальных машинах с поддержкой нескольких сетевых карт. Если сетевой Адаптер, назначается адрес в одной подсети, в котором hello подсети связан с NSG, затем hello в подсети hello NSG также применяются правила toothat сетевого адаптера. В подсетях tooassociating сложения с Nsg можно также связать сетевой Адаптер с NSG.

Если подсеть связан с NSG, а сетевой Адаптер в этой подсети по отдельности, связанные с NSG, hello связанные правила NSG применяются в **потока порядок** toohello направление hello трафика, передаваемого в соответствии с Hello сетевого Адаптера:

* **Входящий трафик** которого целевым является hello сетевого Адаптера в вопрос сначала проходит через hello подсети, вызывающих срабатывание правил NSG hello подсети, до передачи в hello сетевого Адаптера, а затем вызывающих срабатывание правил NSG hello сетевого Адаптера.
* **Исходящий трафик** , источником которого является hello сетевого Адаптера в вопросе потоков первым обслужен из hello сетевого Адаптера, вызывающих срабатывание правил NSG hello сетевой Адаптер, перед обрабатываемым hello подсети, а затем вызывающих срабатывание правил NSG hello подсети.

Дополнительные сведения о [сетевых групп безопасности](virtual-networks-nsg.md) и как они применяются на основании toosubnets ассоциации, виртуальные машины и сетевых адаптеров...

## <a name="how-tooconfigure-a-multi-nic-vm-in-a-classic-deployment"></a>Как tooConfigure нескольких сетевых Адаптеров виртуальной Машины, в классическом развертывании
Приведенные ниже инструкции Hello служит для создания нескольких виртуальных Машин NIC с тремя сетевыми адаптерами: сетевой Адаптер по умолчанию и два дополнительных сетевых адаптера. действия по настройке Hello создаст виртуальной Машины, который будет настроен в соответствии с toohello службы фрагменте файла конфигурации ниже:

    <VirtualNetworkSite name="MultiNIC-VNet" Location="North Europe">
    <AddressSpace>
      <AddressPrefix>10.1.0.0/16</AddressPrefix>
        </AddressSpace>
        <Subnets>
          <Subnet name="Frontend">
            <AddressPrefix>10.1.0.0/24</AddressPrefix>
          </Subnet>
          <Subnet name="Midtier">
            <AddressPrefix>10.1.1.0/24</AddressPrefix>
          </Subnet>
          <Subnet name="Backend">
            <AddressPrefix>10.1.2.0/23</AddressPrefix>
          </Subnet>
          <Subnet name="GatewaySubnet">
            <AddressPrefix>10.1.200.0/28</AddressPrefix>
          </Subnet>
        </Subnets>
    … Skip over hello remainder section …
    </VirtualNetworkSite>


Необходимо, чтобы следующие необходимые компоненты перед попыткой команды PowerShell toorun hello в примере hello hello.

* Подписка Azure.
* Настроенная виртуальная сеть. Дополнительные сведения о виртуальных сетях см. в [этой статье](virtual-networks-overview.md).
* последнюю версию Azure PowerShell Hello загружаются и устанавливаются. В разделе [как tooinstall и настройка Azure PowerShell](/powershell/azure/overview).

toocreate виртуальной Машины с несколькими сетевыми адаптерами, полный hello следующие шаги путем ввода каждой команды в одном сеансе PowerShell:

1. Выберите образ виртуальной машины в коллекции образов Azure. Обратите внимание на то, что образы часто меняются, а их доступность зависит от региона. Hello изображения, указанного в приведенном ниже примере hello может изменить или может в вашем регионе, поэтому будьте внимательны и toospecify hello образа необходимо.

    ```powershell
    $image = Get-AzureVMImage `
    -ImageName "a699494373c04fc0bc8f2bb1389d6106__Windows-Server-2012-R2-201410.01-en.us-127GB.vhd"
    ```

2. Создайте конфигурацию виртуальной машины.

    ```powershell
    $vm = New-AzureVMConfig -Name "MultiNicVM" -InstanceSize "ExtraLarge" `
    -Image $image.ImageName –AvailabilitySetName "MyAVSet"
    ```

3. Создайте имя входа администратора по умолчанию hello.

    ```powershell
    Add-AzureProvisioningConfig –VM $vm -Windows -AdminUserName "<YourAdminUID>" `
    -Password "<YourAdminPassword>"
    ```

4. Добавьте конфигурацию виртуальной Машины toohello дополнительные сетевые адаптеры.

    ```powershell
    Add-AzureNetworkInterfaceConfig -Name "Ethernet1" `
    -SubnetName "Midtier" -StaticVNetIPAddress "10.1.1.111" -VM $vm
    Add-AzureNetworkInterfaceConfig -Name "Ethernet2" `
    -SubnetName "Backend" -StaticVNetIPAddress "10.1.2.222" -VM $vm
    ```

5. Укажите подсеть hello и IP-адрес для сетевого адаптера. по умолчанию hello

    ```powershell
    Set-AzureSubnet -SubnetNames "Frontend" -VM $vm
    Set-AzureStaticVNetIP -IPAddress "10.1.0.100" -VM $vm
    ```

6. Создайте hello виртуальной Машины в виртуальной сети.

    ```powershell
    New-AzureVM -ServiceName "MultiNIC-CS" –VNetName "MultiNIC-VNet" –VMs $vm
    ```

    > [!NOTE]
    > Hello виртуальную сеть, указанные здесь должен уже существовать (согласно hello необходимые компоненты). пример Hello указывает виртуальную сеть с именем **MultiNIC-VNet**.
    >

## <a name="limitations"></a>Ограничения
Hello следующие ограничения применяются при использовании нескольких сетевых адаптеров:

* Виртуальные машины с несколькими сетевыми интерфейсами должны создаваться в виртуальных сетях Azure. Для виртуальных машин без поддержки виртуальной сети нельзя настроить несколько сетевых интерфейсов.
* Все виртуальные машины в группе доступности набор toouse необходимость несколько сетевых адаптеров или одного сетевого адаптера. В группе доступности нельзя одновременно использовать виртуальные машины с несколькими сетевыми интерфейсами и виртуальные машины с одним сетевым интерфейсом. Те же правила действуют для виртуальных машин в облачной службе. Несколько сетевых Адаптеров виртуальных машин, они не являются обязательными toohave hello одинаковое число сетевых адаптеров, при условии, что каждый из них имеет по крайней мере два.
* Чтобы настроить несколько сетевых интерфейсов для развернутой виртуальной машины с одним сетевым интерфейсом (и наоборот), необходимо удалить, а затем повторно создать эту виртуальную машину.

## <a name="secondary-nics-access-tooother-subnets"></a>Подсети tooother доступа вторичных сетевых адаптеров
По умолчанию вторичных сетевых адаптеров не будет настроен шлюз по умолчанию, из-за toowhich hello трафику на hello вторичных сетевых адаптеров будет ограниченной toobe внутри hello одной подсети. Hello нужные tooenable вторичных сетевых адаптеров tootalk собственные подсеть извне, им нужно будет tooadd запись в hello таблицы tooconfigure hello шлюз маршрутизации как описано ниже.

> [!NOTE]
> Для виртуальных машин, созданных до июля 2015 года, шлюз по умолчанию может быть настроен для всех сетевых карт. шлюз по умолчанию Hello для вторичных сетевых адаптеров не будут удалены только виртуальные машины после перезагрузки. В операционных системах, использующих hello слабого узла модели маршрутизации, например в Linux подключение к Интернету может нарушить работу, если hello входящего и исходящего трафика используют разные сетевые адаптеры.
> 

### <a name="configure-windows-vms"></a>Настройка виртуальных машин Windows
Предположим, что у вас есть виртуальная машина Windows с двумя сетевыми картами со следующими адресами:

* IP-адрес основной сетевой карты: 192.168.1.4;
* IP-адрес дополнительной сетевой карты: 192.168.2.5.

Hello таблицу маршрутизации IPv4 для этой виртуальной Машины будет выглядеть следующим образом:

    IPv4 Route Table
    ===========================================================================
    Active Routes:
    Network Destination        Netmask          Gateway       Interface  Metric
              0.0.0.0          0.0.0.0      192.168.1.1      192.168.1.4      5
            127.0.0.0        255.0.0.0         On-link         127.0.0.1    306
            127.0.0.1  255.255.255.255         On-link         127.0.0.1    306
      127.255.255.255  255.255.255.255         On-link         127.0.0.1    306
        168.63.129.16  255.255.255.255      192.168.1.1      192.168.1.4      6
          192.168.1.0    255.255.255.0         On-link       192.168.1.4    261
          192.168.1.4  255.255.255.255         On-link       192.168.1.4    261
        192.168.1.255  255.255.255.255         On-link       192.168.1.4    261
          192.168.2.0    255.255.255.0         On-link       192.168.2.5    261
          192.168.2.5  255.255.255.255         On-link       192.168.2.5    261
        192.168.2.255  255.255.255.255         On-link       192.168.2.5    261
            224.0.0.0        240.0.0.0         On-link         127.0.0.1    306
            224.0.0.0        240.0.0.0         On-link       192.168.1.4    261
            224.0.0.0        240.0.0.0         On-link       192.168.2.5    261
      255.255.255.255  255.255.255.255         On-link         127.0.0.1    306
      255.255.255.255  255.255.255.255         On-link       192.168.1.4    261
      255.255.255.255  255.255.255.255         On-link       192.168.2.5    261
    ===========================================================================

Обратите внимание, что этот маршрут по умолчанию hello (0.0.0.0) — только доступные toohello первичный сетевой адаптер. Не будет возможности tooaccess ресурсам за пределами hello подсеть для получателей hello сетевого Адаптера, как показано ниже:

    C:\Users\Administrator>ping 192.168.1.7 -S 192.165.2.5

    Pinging 192.168.1.7 from 192.165.2.5 with 32 bytes of data:
    PING: transmit failed. General failure.
    PING: transmit failed. General failure.
    PING: transmit failed. General failure.
    PING: transmit failed. General failure.

tooadd Маршрутизация по умолчанию hello дополнительный сетевой Адаптер, выполните следующие действия hello:

1. Из командной строки выполните команду hello ниже tooidentify hello порядковый номер для hello дополнительный сетевой Адаптер:
   
        C:\Users\Administrator>route print
        ===========================================================================
        Interface List
         29...00 15 17 d9 b1 6d ......Microsoft Virtual Machine Bus Network Adapter #16
         27...00 15 17 d9 b1 41 ......Microsoft Virtual Machine Bus Network Adapter #14
          1...........................Software Loopback Interface 1
         14...00 00 00 00 00 00 00 e0 Teredo Tunneling Pseudo-Interface
         20...00 00 00 00 00 00 00 e0 Microsoft ISATAP Adapter #2
        ===========================================================================
2. Обратите внимание, hello вторую запись в таблице hello, с индексом, 27 (в данном примере).
3. Запустите из командной строки hello, hello **добавить маршрут** команды, как показано ниже. В этом примере вы указываете 192.168.2.1 как шлюз по умолчанию hello для hello дополнительный сетевой Адаптер:
   
        route ADD -p 0.0.0.0 MASK 0.0.0.0 192.168.2.1 METRIC 5000 IF 27
4. подключение tootest вернуться toohello командную строку и повторите tooping из другой подсети hello дополнительный сетевой Адаптер как int показано eh приведенном ниже примере:
   
        C:\Users\Administrator>ping 192.168.1.7 -S 192.165.2.5
   
        Reply from 192.168.1.7: bytes=32 time<1ms TTL=128
        Reply from 192.168.1.7: bytes=32 time<1ms TTL=128
        Reply from 192.168.1.7: bytes=32 time=2ms TTL=128
        Reply from 192.168.1.7: bytes=32 time<1ms TTL=128
5. Можно также проверить ваш hello toocheck таблицы маршрутов добавления маршрута, как показано ниже:
   
        C:\Users\Administrator>route print
   
        ...
   
        IPv4 Route Table
        ===========================================================================
        Active Routes:
        Network Destination        Netmask          Gateway       Interface  Metric
                  0.0.0.0          0.0.0.0      192.168.1.1      192.168.1.4      5
                  0.0.0.0          0.0.0.0      192.168.2.1      192.168.2.5   5005
                127.0.0.0        255.0.0.0         On-link         127.0.0.1    306

### <a name="configure-linux-vms"></a>Настройка виртуальных машин Linux
Для виртуальных машин Linux, поскольку слабого маршрутизации, использует поведение по умолчанию hello рекомендуется, hello вторичных сетевых адаптеров являются ограниченными tootraffic потоков только в пределах hello одной подсети. Однако если некоторые сценарии требуют подключения за пределами подсети hello, пользователи должны включить tooensure маршрутизации на основе политик, Здравствуйте, входящего и исходящего трафика использует hello одного сетевого адаптера.

## <a name="next-steps"></a>Дальнейшие действия
* Развертывание [виртуальных машин с несколькими сетевыми картами в сценарии 2-уровневого приложения в развертывании диспетчера ресурсов](virtual-network-deploy-multinic-arm-template.md).
* Развертывание [виртуальных машин с несколькими сетевыми картами в сценарии 2-уровневого приложения в классическом развертывании](virtual-network-deploy-multinic-classic-ps.md).

