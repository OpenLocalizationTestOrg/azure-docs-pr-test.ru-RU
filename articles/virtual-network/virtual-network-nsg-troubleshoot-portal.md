---
title: "aaaTroubleshoot Сетевые группы безопасности - портала | Документы Microsoft"
description: "Узнайте, как tootroubleshoot сетевых групп безопасности в развертывании диспетчера ресурсов Azure hello модели с помощью портала Azure hello."
services: virtual-network
documentationcenter: na
author: AnithaAdusumilli
manager: narayan
editor: 
tags: azure-resource-manager
ms.assetid: a54feccf-0123-4e49-a743-eb8d0bdd1ebc
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/23/2016
ms.author: anithaa
ms.openlocfilehash: 0d3d2110fe1507f36e3b933de924a0876db2747a
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="troubleshoot-network-security-groups-using-hello-azure-portal"></a>Устранение неполадок сетевых групп безопасности с помощью портала Azure hello
> [!div class="op_single_selector"]
> * [Портал Azure](virtual-network-nsg-troubleshoot-portal.md)
> * [PowerShell](virtual-network-nsg-troubleshoot-powershell.md)
> 
> 

Если вы настроили группы безопасности сети (Nsg) на виртуальной машине (VM) и возникают проблемы с подключением виртуальных Машин, в этой статье Обзор возможностей диагностики для Nsg toohelp дополнительную диагностику.

Группы Nsg позволяют toocontrol hello типов трафика этого потока и из нее виртуальные машины (VM). Nsg может быть применен toosubnets в виртуальной сети Azure (VNet) и сетевых интерфейсов (NIC). Hello действующие правила, применяемые tooa сетевого Адаптера являются агрегата hello правил, которые существуют в hello Nsg применяется tooa сетевого Адаптера и hello подсети, в которой он подключен. Правила в этих NSG иногда конфликтуют друг с другом и влияют на возможность сетевого подключения к виртуальной машине.  

Можно просмотреть все правила hello эффективной защиты от Nsg, применения сетевых адаптеров Виртуальной машины. В этой статье показано, как с помощью этих правил в ВМ неполадок tootroubleshoot hello модели развертывания диспетчера ресурсов Azure. Если вы не знакомы с основными понятиями виртуальной сети и NSG, прочтите hello [виртуальная сеть](virtual-networks-overview.md) и [сетевых групп безопасности](virtual-networks-nsg.md) Обзор статей.

## <a name="using-effective-security-rules-tootroubleshoot-vm-traffic-flow"></a>С помощью поток трафика виртуальных Машин tootroubleshoot действующие правила безопасности
Hello сценарий, который следует за примером может служить распространенная проблема подключения:

Виртуальная машина с именем *VM1* принадлежит к подсети *Subnet1* в виртуальной сети *WestUS-VNet1*. Попытка tooconnect toohello виртуальную Машину с помощью протокола удаленного рабочего СТОЛА через TCP-порт 3389 завершается ошибкой. Nsg применяются на обеих hello Сетевых *VM1 NIC1* и hello подсети *подсети1*. Трафик tooTCP порт 3389 допускается в hello NSG, связанный с сетевым интерфейсом hello *VM1 NIC1*, однако в tooVM1 порт 3389 сбой проверить связь с TCP.

Здравствуйте, хотя в этом примере используется TCP-порт 3389, следующие действия можно используется toodetermine сбоев входящие и исходящие подключения через любой порт.

### <a name="vm"></a>Просмотр действующих правил безопасности виртуальной машины
Выполните следующие шаги tootroubleshoot Nsg для виртуальной Машины hello.

Можно просмотреть полный список правил безопасности hello в сетевом Адаптере из hello самой ВМ. Также можно добавить, изменить и удалить сетевой Адаптер и подсеть правила NSG из колонки hello действующие правила, при наличии разрешения tooperform этих операций.

1. Toohello входа портал Azure по адресу https://portal.azure.com.
2. Нажмите кнопку **дополнительные службы**, нажмите кнопку **виртуальные машины** в появившемся списке hello.
3. Выделите tootroubleshoot виртуальной Машины из списка hello и колонки виртуальной Машины с параметрами.
4. Выберите **Диагностика и решение проблем**, а затем распространенную проблему. В этом примере **toomy виртуальной Машины Windows не удается подключить** выбран. 
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image1.png)
5. Действия отображаются в hello проблему, как показано в следующий рисунок hello: 
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image2.png)
   
    Нажмите кнопку *правил группы безопасности, действующих* в hello список рекомендуемых действий.
6. Hello **получить правила безопасности** откроется колонка, как показано в следующий рисунок hello:
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image3.png)
   
    Обратите внимание, hello в следующих разделах hello изображения:
   
   * **Область:** значение слишком*VM1*, hello виртуальной Машины, выбранного на шаге 3.
   * **Сетевой интерфейс** *VM1-NIC1* . У виртуальной машины может быть несколько сетевых интерфейсов. У каждого из них могут быть уникальные действующие правила безопасности. В ходе устранения неполадок может потребоваться tooview hello эффективной защиты правил для каждого сетевого адаптера.
   * **Связанные Nsg:** Nsg может быть применен tooboth hello сетевых КАРТ и hello подсети hello подключен сетевой Адаптер. На рисунке hello NSG был применен tooboth hello сетевых КАРТ и hello подсети, в которой он подключен. Можно щелкнуть по именам NSG hello toodirectly изменения правил в hello Nsg.
   * **Вкладка VM1 nsg:** hello список правил изображении hello является для hello NSG применяется toohello сетевого адаптера. При создании каждой NSG в Azure создаются несколько правил по умолчанию. Не удается удалить правила по умолчанию hello, но их можно переопределить с помощью правил с более высоким приоритетом. Дополнительные сведения о правила по умолчанию, чтение hello toolearn [NSG Обзор](virtual-networks-nsg.md#default-rules) статьи.
   * **ЦЕЛЕВОЙ столбец:** правила hello есть текст в столбце hello, тогда как другие содержат префиксы адресов. текст Hello — hello имя правила безопасности toohello тегами по умолчанию при его создании. Hello теги — это системные идентификаторы, которые представляют несколько префиксов. Выбрать правило с помощью тега, например *AllowInternetOutBound*, перечислены префиксы hello в hello **префиксы адресов** колонку.
   * **Загрузки:** hello список правил может быть типа long. Можно загрузить CSV-файл hello правил для последующего анализа, нажав кнопку **загрузки** и сохранение файла hello.
   * **AllowRDP** правило для входящего трафика: это правило разрешает toohello подключения протокола удаленного рабочего СТОЛА виртуальной Машины.
7. Нажмите кнопку hello **подсети1 NSG** вкладку tooview hello действующие правила из hello NSG применены toohello подсети, как показано в следующий рисунок hello: 
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image4.png)
   
    Обратите внимание hello *denyRDP* **Входящие** правило. Входящие правила, применяемые в подсети hello, оцениваются раньше правил, применяемых в hello сетевого интерфейса. Поскольку hello запрещающее правило применяется на подсети hello, hello запроса tooconnect tooTCP 3389 завершается ошибкой, поскольку hello разрешающее правило на приветствия Сетевых никогда не вычисляется. 
   
    Hello *denyRDP* правило — hello причина, почему происходит сбой hello RDP-подключение. Его удаление должно устранить проблему hello.
   
   > [!NOTE]
   > Если hello виртуальной Машины, связанные с hello сетевой Адаптер не находится в состоянии выполнения, или Nsg еще не был применен toohello сетевой Адаптер или подсети, правила не будут показаны.
   > 
   > 
8. правила NSG tooedit, нажмите кнопку *подсети1 NSG* в hello **связанные Nsg** раздела.
   При этом откроется hello **подсети1 NSG** колонку. Можно непосредственно редактировать правила hello, щелкнув **безопасности правила для входящих подключений**.
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image7.png)
9. После удаления hello *denyRDP* правило для входящего трафика в hello **подсети1 NSG** и добавление *allowRDP* правило, список действующих правил hello выглядит как следующий рисунок hello:
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image8.png)
   
    Убедитесь, что TCP-порт 3389 открыт путем открытия RDP соединение toohello ВМ или с помощью средства PsPing hello. Дополнительные сведения о PsPing при чтении hello [страницы загрузки PsPing](https://technet.microsoft.com/sysinternals/psping.aspx).

### <a name="nic"></a>Просмотр действующих правил безопасности сетевого интерфейса
Если для конкретного сетевого Адаптера перегружена трафику в вашей виртуальной Машины, можно просмотреть полный список hello действующие правила для hello сетевого Адаптера из контекста интерфейсы сети hello, выполнив следующие шаги hello:

1. Toohello входа портал Azure по адресу https://portal.azure.com.
2. Нажмите кнопку **дополнительные службы**, нажмите кнопку **сетевых интерфейсов** в появившемся списке hello.
3. Выберите сетевой интерфейс. В следующий рисунок hello, сетевой Адаптер с именем *VM1 NIC1* выбран.
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image5.png)
   
    Обратите внимание, что hello **область** имеет значение выбранного toohello сетевого интерфейса. Дополнительные сведения о toolearn hello дополнительная информация, чтение шаге 6 процедуры hello **Nsg Устранение неполадок для виртуальной Машины** этой статьи.
   
   > [!NOTE]
   > Если NSG удаляется из сетевого интерфейса, hello подсети NSG по-прежнему на hello заданного сетевого адаптера. В этом случае hello выходных данных будет показывать только правила из подсети hello NSG. Правила отображаются, если hello сетевого Адаптера является tooa подключенных виртуальных Машин.
   > 
   > 
4. Правила для NSG, связанных с сетевым интерфейсом и подсетью, можно изменить напрямую. toolearn как, считывать, шаге 8 hello **просмотреть правила безопасности для виртуальной машины** этой статьи.

## <a name="nsg"></a>Просмотр действующих правил безопасности NSG
При изменении правила NSG, вы можете tooreview hello влияние правила hello, добавляемый на конкретной виртуальной Машины. Здравствуйте, все сетевые адаптеры, заданного NSG применяется, можно просмотреть полный список правил безопасности hello без необходимости tooswitch контекста с заданным NSG колонке hello. действующие правила tootroubleshoot в NSG, полный hello, следующие шаги:

1. Toohello входа портал Azure по адресу https://portal.azure.com.
2. Нажмите кнопку **дополнительные службы**, нажмите кнопку **сетевых групп безопасности** в появившемся списке hello.
3. Выберите NSG. В следующий рисунок hello была выделена с именем VM1 nsg NSG.
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image6.png)
   
    Обратите внимание, hello в следующих разделах hello предыдущего рисунка:
   
   * **Область:** задать toohello выбран NSG.
   * **Виртуальную машину:** при NSG применяется tooa подсети, это примененных tooall интерфейсы tooall вложенные виртуальные машины подключенных toohello подсети. В этом списке содержатся все виртуальные машины, к которым применяется эта NSG. Все виртуальные Машины, можно выбрать из списка hello.
     
     > [!NOTE]
     > Если NSG применяется tooonly пустой подсети, виртуальные машины не отображаются. Если NSG применяется tooa сетевой Адаптер, который не связан с виртуальной Машиной, эти сетевые адаптеры также не отображаются. 
     > 
     > 
   * **Сетевой интерфейс** — у виртуальной машины может быть несколько сетевых интерфейсов. Можно выбрать сетевой интерфейс вложенного toohello выбранной виртуальной Машины.
   * **AssociatedNSGs:** в любое время, сетевой Адаптер может находиться до tootwo действующие Nsg один применяется toohello сетевого Адаптера и другие подсети toohello hello. Несмотря на то, что область hello выбран VM1 nsg, если hello сетевой Адаптер имеет силу подсети NSG, выходные данные hello будет показывать обе Nsg.
4. Правила для NSG, связанных с сетевым интерфейсом или подсетью, можно изменить напрямую. toolearn как, считывать, шаге 8 hello **просмотреть правила безопасности для виртуальной машины** этой статьи.

Дополнительные сведения о toolearn hello дополнительная информация, чтение шаге 6 процедуры hello **просмотреть правила безопасности для виртуальной машины** этой статьи.

> [!NOTE]
> Подсеть и сетевого Адаптера могут иметь только один toothem NSG применяется, NSG может быть связан toomultiple сетевых адаптеров и несколько подсетей.
> 
> 

## <a name="considerations"></a>Рекомендации
Примите во внимание следующие точки, при устранении неполадок подключения hello.

* Правила NSG по умолчанию будет блокировать входящий доступ из hello Интернета и только разрешения виртуальной сети для входящего трафика. Правила должны быть явно добавлены tooallow входящий доступ из Интернета, при необходимости.
* Если нет правил безопасности NSG вызывает toofail подключения к сети Виртуальной машины, hello возможно, из-за:
  * Программный брандмауэр в операционной системе виртуальной Машины hello
  * Маршруты, настроенные для виртуальных устройств или локального трафика. Интернет-трафик может быть перенаправленный tooon организациями через Принудительное туннелирование. Этот параметр, в зависимости от того, как hello в локальной сети оборудования обрабатывает трафик RDP/SSH-подключения из Интернета hello tooyour виртуальной Машины будут недоступны. Чтение hello [Устранение неполадок маршруты](virtual-network-routes-troubleshoot-powershell.md) статьи toolearn toodiagnose маршрут проблемы, которые могут не задерживают hello поток трафика в и из hello виртуальной Машины. 
* Если одноранговыми виртуальных сетей, по умолчанию, hello VIRTUAL_NETWORK тег автоматически расширяет tooinclude префиксы для одноранговыми виртуальных сетей. Можно просмотреть эти префиксы в hello **ExpandedAddressPrefix** список, tootroubleshoot любые проблемы связанные tooVNet пиринг подключения. 
* Правила безопасности отображаются, только если имеется NSG, связанный с виртуальной Машины hello сетевой Адаптер и или подсети. 
* Если Nsg, не связанные с hello сетевого Адаптера или подсети и имеется открытый IP-адрес, назначенный tooyour виртуальной Машины, все порты будут открыты для входящего и исходящего доступа. Если виртуальная машина hello общедоступный IP-адрес, применение toohello Nsg сетевой Адаптер или подсети настоятельно рекомендуется.

