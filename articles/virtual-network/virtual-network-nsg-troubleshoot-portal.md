---
title: "aaaTroubleshoot Сетевые группы безопасности - портала | Документы Microsoft"
description: "Узнайте, как tootroubleshoot сетевых групп безопасности в развертывании диспетчера ресурсов Azure hello модели с помощью портала Azure hello."
services: virtual-network
documentationcenter: na
author: AnithaAdusumilli
manager: narayan
editor: 
tags: azure-resource-manager
ms.assetid: a54feccf-0123-4e49-a743-eb8d0bdd1ebc
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/23/2016
ms.author: anithaa
ms.openlocfilehash: 0d3d2110fe1507f36e3b933de924a0876db2747a
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="troubleshoot-network-security-groups-using-hello-azure-portal"></a><span data-ttu-id="41e30-103">Устранение неполадок сетевых групп безопасности с помощью портала Azure hello</span><span class="sxs-lookup"><span data-stu-id="41e30-103">Troubleshoot Network Security Groups using hello Azure Portal</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="41e30-104">Портал Azure</span><span class="sxs-lookup"><span data-stu-id="41e30-104">Azure Portal</span></span>](virtual-network-nsg-troubleshoot-portal.md)
> * [<span data-ttu-id="41e30-105">PowerShell</span><span class="sxs-lookup"><span data-stu-id="41e30-105">PowerShell</span></span>](virtual-network-nsg-troubleshoot-powershell.md)
> 
> 

<span data-ttu-id="41e30-106">Если вы настроили группы безопасности сети (Nsg) на виртуальной машине (VM) и возникают проблемы с подключением виртуальных Машин, в этой статье Обзор возможностей диагностики для Nsg toohelp дополнительную диагностику.</span><span class="sxs-lookup"><span data-stu-id="41e30-106">If you configured Network Security Groups (NSGs) on your virtual machine (VM) and are experiencing VM connectivity issues, this article provides an overview of diagnostics capabilities for NSGs toohelp troubleshoot further.</span></span>

<span data-ttu-id="41e30-107">Группы Nsg позволяют toocontrol hello типов трафика этого потока и из нее виртуальные машины (VM).</span><span class="sxs-lookup"><span data-stu-id="41e30-107">NSGs enable you toocontrol hello types of traffic that flow in and out of your virtual machines (VMs).</span></span> <span data-ttu-id="41e30-108">Nsg может быть применен toosubnets в виртуальной сети Azure (VNet) и сетевых интерфейсов (NIC).</span><span class="sxs-lookup"><span data-stu-id="41e30-108">NSGs can be applied toosubnets in an Azure Virtual Network (VNet), network interfaces (NIC), or both.</span></span> <span data-ttu-id="41e30-109">Hello действующие правила, применяемые tooa сетевого Адаптера являются агрегата hello правил, которые существуют в hello Nsg применяется tooa сетевого Адаптера и hello подсети, в которой он подключен.</span><span class="sxs-lookup"><span data-stu-id="41e30-109">hello effective rules applied tooa NIC are an aggregation of hello rules that exist in hello NSGs applied tooa NIC and hello subnet it is connected to.</span></span> <span data-ttu-id="41e30-110">Правила в этих NSG иногда конфликтуют друг с другом и влияют на возможность сетевого подключения к виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="41e30-110">Rules across these NSGs can sometimes conflict with each other and impact a VM's network connectivity.</span></span>  

<span data-ttu-id="41e30-111">Можно просмотреть все правила hello эффективной защиты от Nsg, применения сетевых адаптеров Виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="41e30-111">You can view all hello effective security rules from your NSGs, as applied on your VM's NICs.</span></span> <span data-ttu-id="41e30-112">В этой статье показано, как с помощью этих правил в ВМ неполадок tootroubleshoot hello модели развертывания диспетчера ресурсов Azure.</span><span class="sxs-lookup"><span data-stu-id="41e30-112">This article shows how tootroubleshoot VM connectivity issues using these rules in hello Azure Resource Manager deployment model.</span></span> <span data-ttu-id="41e30-113">Если вы не знакомы с основными понятиями виртуальной сети и NSG, прочтите hello [виртуальная сеть](virtual-networks-overview.md) и [сетевых групп безопасности](virtual-networks-nsg.md) Обзор статей.</span><span class="sxs-lookup"><span data-stu-id="41e30-113">If you're not familiar with VNet and NSG concepts, read hello [Virtual network](virtual-networks-overview.md) and [Network security groups](virtual-networks-nsg.md) overview articles.</span></span>

## <a name="using-effective-security-rules-tootroubleshoot-vm-traffic-flow"></a><span data-ttu-id="41e30-114">С помощью поток трафика виртуальных Машин tootroubleshoot действующие правила безопасности</span><span class="sxs-lookup"><span data-stu-id="41e30-114">Using Effective Security Rules tootroubleshoot VM traffic flow</span></span>
<span data-ttu-id="41e30-115">Hello сценарий, который следует за примером может служить распространенная проблема подключения:</span><span class="sxs-lookup"><span data-stu-id="41e30-115">hello scenario that follows is an example of a common connection problem:</span></span>

<span data-ttu-id="41e30-116">Виртуальная машина с именем *VM1* принадлежит к подсети *Subnet1* в виртуальной сети *WestUS-VNet1*.</span><span class="sxs-lookup"><span data-stu-id="41e30-116">A VM named *VM1* is part of a subnet named *Subnet1* within a VNet named *WestUS-VNet1*.</span></span> <span data-ttu-id="41e30-117">Попытка tooconnect toohello виртуальную Машину с помощью протокола удаленного рабочего СТОЛА через TCP-порт 3389 завершается ошибкой.</span><span class="sxs-lookup"><span data-stu-id="41e30-117">An attempt tooconnect toohello VM using RDP over TCP port 3389 fails.</span></span> <span data-ttu-id="41e30-118">Nsg применяются на обеих hello Сетевых *VM1 NIC1* и hello подсети *подсети1*.</span><span class="sxs-lookup"><span data-stu-id="41e30-118">NSGs are applied at both hello NIC *VM1-NIC1* and hello subnet *Subnet1*.</span></span> <span data-ttu-id="41e30-119">Трафик tooTCP порт 3389 допускается в hello NSG, связанный с сетевым интерфейсом hello *VM1 NIC1*, однако в tooVM1 порт 3389 сбой проверить связь с TCP.</span><span class="sxs-lookup"><span data-stu-id="41e30-119">Traffic tooTCP port 3389 is allowed in hello NSG associated with hello network interface *VM1-NIC1*, however TCP ping tooVM1's port 3389 fails.</span></span>

<span data-ttu-id="41e30-120">Здравствуйте, хотя в этом примере используется TCP-порт 3389, следующие действия можно используется toodetermine сбоев входящие и исходящие подключения через любой порт.</span><span class="sxs-lookup"><span data-stu-id="41e30-120">While this example uses TCP port 3389, hello following steps can be used toodetermine inbound and outbound connection failures over any port.</span></span>

### <span data-ttu-id="41e30-121"><a name="vm"></a>Просмотр действующих правил безопасности виртуальной машины</span><span class="sxs-lookup"><span data-stu-id="41e30-121"><a name="vm"></a>View effective security rules for a virtual machine</span></span>
<span data-ttu-id="41e30-122">Выполните следующие шаги tootroubleshoot Nsg для виртуальной Машины hello.</span><span class="sxs-lookup"><span data-stu-id="41e30-122">Complete hello following steps tootroubleshoot NSGs for a VM:</span></span>

<span data-ttu-id="41e30-123">Можно просмотреть полный список правил безопасности hello в сетевом Адаптере из hello самой ВМ.</span><span class="sxs-lookup"><span data-stu-id="41e30-123">You can view full list of hello effective security rules on a NIC, from hello VM itself.</span></span> <span data-ttu-id="41e30-124">Также можно добавить, изменить и удалить сетевой Адаптер и подсеть правила NSG из колонки hello действующие правила, при наличии разрешения tooperform этих операций.</span><span class="sxs-lookup"><span data-stu-id="41e30-124">You can also add, modify, and delete both NIC and subnet NSG rules from hello effective rules blade, if you have permissions tooperform these operations.</span></span>

1. <span data-ttu-id="41e30-125">Toohello входа портал Azure по адресу https://portal.azure.com.</span><span class="sxs-lookup"><span data-stu-id="41e30-125">Login toohello Azure portal at https://portal.azure.com.</span></span>
2. <span data-ttu-id="41e30-126">Нажмите кнопку **дополнительные службы**, нажмите кнопку **виртуальные машины** в появившемся списке hello.</span><span class="sxs-lookup"><span data-stu-id="41e30-126">Click **More services**, then click **Virtual machines** in hello list that appears.</span></span>
3. <span data-ttu-id="41e30-127">Выделите tootroubleshoot виртуальной Машины из списка hello и колонки виртуальной Машины с параметрами.</span><span class="sxs-lookup"><span data-stu-id="41e30-127">Select a VM tootroubleshoot from hello list that appears and a VM blade with options appears.</span></span>
4. <span data-ttu-id="41e30-128">Выберите **Диагностика и решение проблем**, а затем распространенную проблему.</span><span class="sxs-lookup"><span data-stu-id="41e30-128">Click **Diagnose & solve problems** and then select a common problem.</span></span> <span data-ttu-id="41e30-129">В этом примере **toomy виртуальной Машины Windows не удается подключить** выбран.</span><span class="sxs-lookup"><span data-stu-id="41e30-129">For this example, **I can’t connect toomy Windows VM** is selected.</span></span> 
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image1.png)
5. <span data-ttu-id="41e30-130">Действия отображаются в hello проблему, как показано в следующий рисунок hello:</span><span class="sxs-lookup"><span data-stu-id="41e30-130">Steps appear under hello problem, as shown in hello following picture:</span></span> 
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image2.png)
   
    <span data-ttu-id="41e30-131">Нажмите кнопку *правил группы безопасности, действующих* в hello список рекомендуемых действий.</span><span class="sxs-lookup"><span data-stu-id="41e30-131">Click *effective security group rules* in hello list of recommended steps.</span></span>
6. <span data-ttu-id="41e30-132">Hello **получить правила безопасности** откроется колонка, как показано в следующий рисунок hello:</span><span class="sxs-lookup"><span data-stu-id="41e30-132">hello **Get effective security rules** blade appears, as shown in hello following picture:</span></span>
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image3.png)
   
    <span data-ttu-id="41e30-133">Обратите внимание, hello в следующих разделах hello изображения:</span><span class="sxs-lookup"><span data-stu-id="41e30-133">Notice hello following sections of hello picture:</span></span>
   
   * <span data-ttu-id="41e30-134">**Область:** значение слишком*VM1*, hello виртуальной Машины, выбранного на шаге 3.</span><span class="sxs-lookup"><span data-stu-id="41e30-134">**Scope:** Set too*VM1*, hello VM selected in step 3.</span></span>
   * <span data-ttu-id="41e30-135">**Сетевой интерфейс** *VM1-NIC1* .</span><span class="sxs-lookup"><span data-stu-id="41e30-135">**Network interface:** *VM1-NIC1* is selected.</span></span> <span data-ttu-id="41e30-136">У виртуальной машины может быть несколько сетевых интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="41e30-136">A VM can have multiple network interfaces (NIC).</span></span> <span data-ttu-id="41e30-137">У каждого из них могут быть уникальные действующие правила безопасности.</span><span class="sxs-lookup"><span data-stu-id="41e30-137">Each NIC can have unique effective security rules.</span></span> <span data-ttu-id="41e30-138">В ходе устранения неполадок может потребоваться tooview hello эффективной защиты правил для каждого сетевого адаптера.</span><span class="sxs-lookup"><span data-stu-id="41e30-138">When troubleshooting, you may need tooview hello effective security rules for each NIC.</span></span>
   * <span data-ttu-id="41e30-139">**Связанные Nsg:** Nsg может быть применен tooboth hello сетевых КАРТ и hello подсети hello подключен сетевой Адаптер.</span><span class="sxs-lookup"><span data-stu-id="41e30-139">**Associated NSGs:** NSGs can be applied tooboth hello NIC and hello subnet hello NIC is connected to.</span></span> <span data-ttu-id="41e30-140">На рисунке hello NSG был применен tooboth hello сетевых КАРТ и hello подсети, в которой он подключен.</span><span class="sxs-lookup"><span data-stu-id="41e30-140">In hello picture, an NSG has been applied tooboth hello NIC and hello subnet it's connected to.</span></span> <span data-ttu-id="41e30-141">Можно щелкнуть по именам NSG hello toodirectly изменения правил в hello Nsg.</span><span class="sxs-lookup"><span data-stu-id="41e30-141">You can click on hello NSG names toodirectly modify rules in hello NSGs.</span></span>
   * <span data-ttu-id="41e30-142">**Вкладка VM1 nsg:** hello список правил изображении hello является для hello NSG применяется toohello сетевого адаптера.</span><span class="sxs-lookup"><span data-stu-id="41e30-142">**VM1-nsg tab:** hello list of rules displayed in hello picture is for hello NSG applied toohello NIC.</span></span> <span data-ttu-id="41e30-143">При создании каждой NSG в Azure создаются несколько правил по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="41e30-143">Several default rules are created by Azure whenever an NSG is created.</span></span> <span data-ttu-id="41e30-144">Не удается удалить правила по умолчанию hello, но их можно переопределить с помощью правил с более высоким приоритетом.</span><span class="sxs-lookup"><span data-stu-id="41e30-144">You can't remove hello default rules, but you can override them with rules of higher priority.</span></span> <span data-ttu-id="41e30-145">Дополнительные сведения о правила по умолчанию, чтение hello toolearn [NSG Обзор](virtual-networks-nsg.md#default-rules) статьи.</span><span class="sxs-lookup"><span data-stu-id="41e30-145">toolearn more about default rules, read hello [NSG overview](virtual-networks-nsg.md#default-rules) article.</span></span>
   * <span data-ttu-id="41e30-146">**ЦЕЛЕВОЙ столбец:** правила hello есть текст в столбце hello, тогда как другие содержат префиксы адресов.</span><span class="sxs-lookup"><span data-stu-id="41e30-146">**DESTINATION column:** Some of hello rules have text in hello column, while others have address prefixes.</span></span> <span data-ttu-id="41e30-147">текст Hello — hello имя правила безопасности toohello тегами по умолчанию при его создании.</span><span class="sxs-lookup"><span data-stu-id="41e30-147">hello text is hello name of default tags applied toohello security rule when it was created.</span></span> <span data-ttu-id="41e30-148">Hello теги — это системные идентификаторы, которые представляют несколько префиксов.</span><span class="sxs-lookup"><span data-stu-id="41e30-148">hello tags are system-provided identifiers that represent multiple prefixes.</span></span> <span data-ttu-id="41e30-149">Выбрать правило с помощью тега, например *AllowInternetOutBound*, перечислены префиксы hello в hello **префиксы адресов** колонку.</span><span class="sxs-lookup"><span data-stu-id="41e30-149">Selecting a rule with a tag, such as *AllowInternetOutBound*, lists hello prefixes in hello **Address prefixes** blade.</span></span>
   * <span data-ttu-id="41e30-150">**Загрузки:** hello список правил может быть типа long.</span><span class="sxs-lookup"><span data-stu-id="41e30-150">**Download:** hello list of rules can be long.</span></span> <span data-ttu-id="41e30-151">Можно загрузить CSV-файл hello правил для последующего анализа, нажав кнопку **загрузки** и сохранение файла hello.</span><span class="sxs-lookup"><span data-stu-id="41e30-151">You can download a .csv file of hello rules for offline analysis by clicking **Download** and saving hello file.</span></span>
   * <span data-ttu-id="41e30-152">**AllowRDP** правило для входящего трафика: это правило разрешает toohello подключения протокола удаленного рабочего СТОЛА виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="41e30-152">**AllowRDP** Inbound rule: This rule allows RDP connections toohello VM.</span></span>
7. <span data-ttu-id="41e30-153">Нажмите кнопку hello **подсети1 NSG** вкладку tooview hello действующие правила из hello NSG применены toohello подсети, как показано в следующий рисунок hello:</span><span class="sxs-lookup"><span data-stu-id="41e30-153">Click hello **Subnet1-NSG** tab tooview hello effective rules from hello NSG applied toohello subnet, as shown in hello following picture:</span></span> 
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image4.png)
   
    <span data-ttu-id="41e30-154">Обратите внимание hello *denyRDP* **Входящие** правило.</span><span class="sxs-lookup"><span data-stu-id="41e30-154">Notice hello *denyRDP* **Inbound** rule.</span></span> <span data-ttu-id="41e30-155">Входящие правила, применяемые в подсети hello, оцениваются раньше правил, применяемых в hello сетевого интерфейса.</span><span class="sxs-lookup"><span data-stu-id="41e30-155">Inbound rules applied at hello subnet are evaluated before rules applied at hello network interface.</span></span> <span data-ttu-id="41e30-156">Поскольку hello запрещающее правило применяется на подсети hello, hello запроса tooconnect tooTCP 3389 завершается ошибкой, поскольку hello разрешающее правило на приветствия Сетевых никогда не вычисляется.</span><span class="sxs-lookup"><span data-stu-id="41e30-156">Since hello deny rule is applied at hello subnet, hello request tooconnect tooTCP 3389 fails, because hello allow rule at hello NIC is never evaluated.</span></span> 
   
    <span data-ttu-id="41e30-157">Hello *denyRDP* правило — hello причина, почему происходит сбой hello RDP-подключение.</span><span class="sxs-lookup"><span data-stu-id="41e30-157">hello *denyRDP* rule is hello reason why hello RDP connection is failing.</span></span> <span data-ttu-id="41e30-158">Его удаление должно устранить проблему hello.</span><span class="sxs-lookup"><span data-stu-id="41e30-158">Removing it should resolve hello problem.</span></span>
   
   > [!NOTE]
   > <span data-ttu-id="41e30-159">Если hello виртуальной Машины, связанные с hello сетевой Адаптер не находится в состоянии выполнения, или Nsg еще не был применен toohello сетевой Адаптер или подсети, правила не будут показаны.</span><span class="sxs-lookup"><span data-stu-id="41e30-159">If hello VM associated with hello NIC is not in a running state, or NSGs haven't been applied toohello NIC or subnet, no rules are shown.</span></span>
   > 
   > 
8. <span data-ttu-id="41e30-160">правила NSG tooedit, нажмите кнопку *подсети1 NSG* в hello **связанные Nsg** раздела.</span><span class="sxs-lookup"><span data-stu-id="41e30-160">tooedit NSG rules, click *Subnet1-NSG* in hello **Associated NSGs** section.</span></span>
   <span data-ttu-id="41e30-161">При этом откроется hello **подсети1 NSG** колонку.</span><span class="sxs-lookup"><span data-stu-id="41e30-161">This opens hello **Subnet1-NSG** blade.</span></span> <span data-ttu-id="41e30-162">Можно непосредственно редактировать правила hello, щелкнув **безопасности правила для входящих подключений**.</span><span class="sxs-lookup"><span data-stu-id="41e30-162">You can directly edit hello rules by clicking on **Inbound security rules**.</span></span>
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image7.png)
9. <span data-ttu-id="41e30-163">После удаления hello *denyRDP* правило для входящего трафика в hello **подсети1 NSG** и добавление *allowRDP* правило, список действующих правил hello выглядит как следующий рисунок hello:</span><span class="sxs-lookup"><span data-stu-id="41e30-163">After removing hello *denyRDP* inbound rule in hello **Subnet1-NSG** and adding an *allowRDP* rule, hello effective rules list looks like hello following picture:</span></span>
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image8.png)
   
    <span data-ttu-id="41e30-164">Убедитесь, что TCP-порт 3389 открыт путем открытия RDP соединение toohello ВМ или с помощью средства PsPing hello.</span><span class="sxs-lookup"><span data-stu-id="41e30-164">Confirm that TCP port 3389 is open by opening an RDP connection toohello VM or using hello PsPing tool.</span></span> <span data-ttu-id="41e30-165">Дополнительные сведения о PsPing при чтении hello [страницы загрузки PsPing](https://technet.microsoft.com/sysinternals/psping.aspx).</span><span class="sxs-lookup"><span data-stu-id="41e30-165">You can learn more about PsPing by reading hello [PsPing download page](https://technet.microsoft.com/sysinternals/psping.aspx).</span></span>

### <span data-ttu-id="41e30-166"><a name="nic"></a>Просмотр действующих правил безопасности сетевого интерфейса</span><span class="sxs-lookup"><span data-stu-id="41e30-166"><a name="nic"></a>View effective security rules for a network interface</span></span>
<span data-ttu-id="41e30-167">Если для конкретного сетевого Адаптера перегружена трафику в вашей виртуальной Машины, можно просмотреть полный список hello действующие правила для hello сетевого Адаптера из контекста интерфейсы сети hello, выполнив следующие шаги hello:</span><span class="sxs-lookup"><span data-stu-id="41e30-167">If your VM traffic flow is impacted for a specific NIC, you can view a full list of hello effective rules for hello NIC from hello network interfaces context by completing hello following steps:</span></span>

1. <span data-ttu-id="41e30-168">Toohello входа портал Azure по адресу https://portal.azure.com.</span><span class="sxs-lookup"><span data-stu-id="41e30-168">Login toohello Azure portal at https://portal.azure.com.</span></span>
2. <span data-ttu-id="41e30-169">Нажмите кнопку **дополнительные службы**, нажмите кнопку **сетевых интерфейсов** в появившемся списке hello.</span><span class="sxs-lookup"><span data-stu-id="41e30-169">Click **More services**, then click **Network interfaces** in hello list that appears.</span></span>
3. <span data-ttu-id="41e30-170">Выберите сетевой интерфейс.</span><span class="sxs-lookup"><span data-stu-id="41e30-170">Select a network interface.</span></span> <span data-ttu-id="41e30-171">В следующий рисунок hello, сетевой Адаптер с именем *VM1 NIC1* выбран.</span><span class="sxs-lookup"><span data-stu-id="41e30-171">In hello following picture, a NIC named *VM1-NIC1* is selected.</span></span>
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image5.png)
   
    <span data-ttu-id="41e30-172">Обратите внимание, что hello **область** имеет значение выбранного toohello сетевого интерфейса.</span><span class="sxs-lookup"><span data-stu-id="41e30-172">Notice that hello **Scope** is set toohello network interface selected.</span></span> <span data-ttu-id="41e30-173">Дополнительные сведения о toolearn hello дополнительная информация, чтение шаге 6 процедуры hello **Nsg Устранение неполадок для виртуальной Машины** этой статьи.</span><span class="sxs-lookup"><span data-stu-id="41e30-173">toolearn more about hello additional information shown, read step 6 of hello **Troubleshoot NSGs for a VM** section of this article.</span></span>
   
   > [!NOTE]
   > <span data-ttu-id="41e30-174">Если NSG удаляется из сетевого интерфейса, hello подсети NSG по-прежнему на hello заданного сетевого адаптера.</span><span class="sxs-lookup"><span data-stu-id="41e30-174">If an NSG is removed from a network interface, hello subnet NSG is still effective on hello given NIC.</span></span> <span data-ttu-id="41e30-175">В этом случае hello выходных данных будет показывать только правила из подсети hello NSG.</span><span class="sxs-lookup"><span data-stu-id="41e30-175">In this case, hello output would only show rules from hello subnet NSG.</span></span> <span data-ttu-id="41e30-176">Правила отображаются, если hello сетевого Адаптера является tooa подключенных виртуальных Машин.</span><span class="sxs-lookup"><span data-stu-id="41e30-176">Rules only appear if hello NIC is attached tooa VM.</span></span>
   > 
   > 
4. <span data-ttu-id="41e30-177">Правила для NSG, связанных с сетевым интерфейсом и подсетью, можно изменить напрямую.</span><span class="sxs-lookup"><span data-stu-id="41e30-177">You can directly edit rules for NSGs associated with a NIC and a subnet.</span></span> <span data-ttu-id="41e30-178">toolearn как, считывать, шаге 8 hello **просмотреть правила безопасности для виртуальной машины** этой статьи.</span><span class="sxs-lookup"><span data-stu-id="41e30-178">toolearn how, read step 8 of hello **View effective security rules for a virtual machine** section of this article.</span></span>

## <span data-ttu-id="41e30-179"><a name="nsg"></a>Просмотр действующих правил безопасности NSG</span><span class="sxs-lookup"><span data-stu-id="41e30-179"><a name="nsg"></a>View effective security rules for a network security group (NSG)</span></span>
<span data-ttu-id="41e30-180">При изменении правила NSG, вы можете tooreview hello влияние правила hello, добавляемый на конкретной виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="41e30-180">When modifying NSG rules, you may want tooreview hello impact of hello rules being added on a particular VM.</span></span> <span data-ttu-id="41e30-181">Здравствуйте, все сетевые адаптеры, заданного NSG применяется, можно просмотреть полный список правил безопасности hello без необходимости tooswitch контекста с заданным NSG колонке hello.</span><span class="sxs-lookup"><span data-stu-id="41e30-181">You can view a full list of hello effective security rules for all hello NICs that a given NSG is applied to, without having tooswitch context from hello given NSG blade.</span></span> <span data-ttu-id="41e30-182">действующие правила tootroubleshoot в NSG, полный hello, следующие шаги:</span><span class="sxs-lookup"><span data-stu-id="41e30-182">tootroubleshoot effective rules within an NSG, complete hello following steps:</span></span>

1. <span data-ttu-id="41e30-183">Toohello входа портал Azure по адресу https://portal.azure.com.</span><span class="sxs-lookup"><span data-stu-id="41e30-183">Login toohello Azure portal at https://portal.azure.com.</span></span>
2. <span data-ttu-id="41e30-184">Нажмите кнопку **дополнительные службы**, нажмите кнопку **сетевых групп безопасности** в появившемся списке hello.</span><span class="sxs-lookup"><span data-stu-id="41e30-184">Click **More services**, then click **Network security groups** in hello list that appears.</span></span>
3. <span data-ttu-id="41e30-185">Выберите NSG.</span><span class="sxs-lookup"><span data-stu-id="41e30-185">Select an NSG.</span></span> <span data-ttu-id="41e30-186">В следующий рисунок hello была выделена с именем VM1 nsg NSG.</span><span class="sxs-lookup"><span data-stu-id="41e30-186">In hello following picture, an NSG named VM1-nsg was selected.</span></span>
   
    ![](./media/virtual-network-nsg-troubleshoot-portal/image6.png)
   
    <span data-ttu-id="41e30-187">Обратите внимание, hello в следующих разделах hello предыдущего рисунка:</span><span class="sxs-lookup"><span data-stu-id="41e30-187">Notice hello following sections of hello previous picture:</span></span>
   
   * <span data-ttu-id="41e30-188">**Область:** задать toohello выбран NSG.</span><span class="sxs-lookup"><span data-stu-id="41e30-188">**Scope:** Set toohello NSG selected.</span></span>
   * <span data-ttu-id="41e30-189">**Виртуальную машину:** при NSG применяется tooa подсети, это примененных tooall интерфейсы tooall вложенные виртуальные машины подключенных toohello подсети.</span><span class="sxs-lookup"><span data-stu-id="41e30-189">**Virtual machine:** When an NSG is applied tooa subnet, it's applied tooall network interfaces attached tooall VMs connected toohello subnet.</span></span> <span data-ttu-id="41e30-190">В этом списке содержатся все виртуальные машины, к которым применяется эта NSG.</span><span class="sxs-lookup"><span data-stu-id="41e30-190">This list shows all VMs this NSG is applied to.</span></span> <span data-ttu-id="41e30-191">Все виртуальные Машины, можно выбрать из списка hello.</span><span class="sxs-lookup"><span data-stu-id="41e30-191">You can select any VM from hello list.</span></span>
     
     > [!NOTE]
     > <span data-ttu-id="41e30-192">Если NSG применяется tooonly пустой подсети, виртуальные машины не отображаются.</span><span class="sxs-lookup"><span data-stu-id="41e30-192">If an NSG is applied tooonly an empty subnet, VMs will not be listed.</span></span> <span data-ttu-id="41e30-193">Если NSG применяется tooa сетевой Адаптер, который не связан с виртуальной Машиной, эти сетевые адаптеры также не отображаются.</span><span class="sxs-lookup"><span data-stu-id="41e30-193">If an NSG is applied tooa NIC which is not associated with a VM, those NICs will also not be listed.</span></span> 
     > 
     > 
   * <span data-ttu-id="41e30-194">**Сетевой интерфейс** — у виртуальной машины может быть несколько сетевых интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="41e30-194">**Network Interface:** A VM can have multiple network interfaces.</span></span> <span data-ttu-id="41e30-195">Можно выбрать сетевой интерфейс вложенного toohello выбранной виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="41e30-195">You can select a network interface attached toohello selected VM.</span></span>
   * <span data-ttu-id="41e30-196">**AssociatedNSGs:** в любое время, сетевой Адаптер может находиться до tootwo действующие Nsg один применяется toohello сетевого Адаптера и другие подсети toohello hello.</span><span class="sxs-lookup"><span data-stu-id="41e30-196">**AssociatedNSGs:** At any time, a NIC can have up tootwo effective NSGs, one applied toohello NIC and hello other toohello subnet.</span></span> <span data-ttu-id="41e30-197">Несмотря на то, что область hello выбран VM1 nsg, если hello сетевой Адаптер имеет силу подсети NSG, выходные данные hello будет показывать обе Nsg.</span><span class="sxs-lookup"><span data-stu-id="41e30-197">Although hello scope is selected as VM1-nsg, if hello NIC has an effective subnet NSG, hello output will show both NSGs.</span></span>
4. <span data-ttu-id="41e30-198">Правила для NSG, связанных с сетевым интерфейсом или подсетью, можно изменить напрямую.</span><span class="sxs-lookup"><span data-stu-id="41e30-198">You can directly edit rules for NSGs associated with a NIC or subnet.</span></span> <span data-ttu-id="41e30-199">toolearn как, считывать, шаге 8 hello **просмотреть правила безопасности для виртуальной машины** этой статьи.</span><span class="sxs-lookup"><span data-stu-id="41e30-199">toolearn how, read step 8 of hello **View effective security rules for a virtual machine** section of this article.</span></span>

<span data-ttu-id="41e30-200">Дополнительные сведения о toolearn hello дополнительная информация, чтение шаге 6 процедуры hello **просмотреть правила безопасности для виртуальной машины** этой статьи.</span><span class="sxs-lookup"><span data-stu-id="41e30-200">toolearn more about hello additional information shown, read step 6 of hello **View effective security rules for a virtual machine** section of this article.</span></span>

> [!NOTE]
> <span data-ttu-id="41e30-201">Подсеть и сетевого Адаптера могут иметь только один toothem NSG применяется, NSG может быть связан toomultiple сетевых адаптеров и несколько подсетей.</span><span class="sxs-lookup"><span data-stu-id="41e30-201">Though a subnet and NIC can each have only one NSG applied toothem, an NSG can be associated toomultiple NICs and multiple subnets.</span></span>
> 
> 

## <a name="considerations"></a><span data-ttu-id="41e30-202">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="41e30-202">Considerations</span></span>
<span data-ttu-id="41e30-203">Примите во внимание следующие точки, при устранении неполадок подключения hello.</span><span class="sxs-lookup"><span data-stu-id="41e30-203">Consider hello following points when troubleshooting connectivity problems:</span></span>

* <span data-ttu-id="41e30-204">Правила NSG по умолчанию будет блокировать входящий доступ из hello Интернета и только разрешения виртуальной сети для входящего трафика.</span><span class="sxs-lookup"><span data-stu-id="41e30-204">Default NSG rules will block inbound access from hello internet and only permit VNet inbound traffic.</span></span> <span data-ttu-id="41e30-205">Правила должны быть явно добавлены tooallow входящий доступ из Интернета, при необходимости.</span><span class="sxs-lookup"><span data-stu-id="41e30-205">Rules should be explicitly added tooallow inbound access from Internet, as required.</span></span>
* <span data-ttu-id="41e30-206">Если нет правил безопасности NSG вызывает toofail подключения к сети Виртуальной машины, hello возможно, из-за:</span><span class="sxs-lookup"><span data-stu-id="41e30-206">If there are no NSG security rules causing a VM’s network connectivity toofail, hello problem may be due to:</span></span>
  * <span data-ttu-id="41e30-207">Программный брандмауэр в операционной системе виртуальной Машины hello</span><span class="sxs-lookup"><span data-stu-id="41e30-207">Firewall software running within hello VM's operating system</span></span>
  * <span data-ttu-id="41e30-208">Маршруты, настроенные для виртуальных устройств или локального трафика.</span><span class="sxs-lookup"><span data-stu-id="41e30-208">Routes configured for virtual appliances or on-premises traffic.</span></span> <span data-ttu-id="41e30-209">Интернет-трафик может быть перенаправленный tooon организациями через Принудительное туннелирование.</span><span class="sxs-lookup"><span data-stu-id="41e30-209">Internet traffic can be redirected tooon-premises via forced-tunneling.</span></span> <span data-ttu-id="41e30-210">Этот параметр, в зависимости от того, как hello в локальной сети оборудования обрабатывает трафик RDP/SSH-подключения из Интернета hello tooyour виртуальной Машины будут недоступны.</span><span class="sxs-lookup"><span data-stu-id="41e30-210">An RDP/SSH connection from hello Internet tooyour VM may not work with this setting, depending on how hello on-premises network hardware handles this traffic.</span></span> <span data-ttu-id="41e30-211">Чтение hello [Устранение неполадок маршруты](virtual-network-routes-troubleshoot-powershell.md) статьи toolearn toodiagnose маршрут проблемы, которые могут не задерживают hello поток трафика в и из hello виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="41e30-211">Read hello [Troubleshooting Routes](virtual-network-routes-troubleshoot-powershell.md) article toolearn how toodiagnose route problems that may be impeding hello flow of traffic in and out of hello VM.</span></span> 
* <span data-ttu-id="41e30-212">Если одноранговыми виртуальных сетей, по умолчанию, hello VIRTUAL_NETWORK тег автоматически расширяет tooinclude префиксы для одноранговыми виртуальных сетей.</span><span class="sxs-lookup"><span data-stu-id="41e30-212">If you have peered VNets, by default, hello VIRTUAL_NETWORK tag will automatically expand tooinclude prefixes for peered VNets.</span></span> <span data-ttu-id="41e30-213">Можно просмотреть эти префиксы в hello **ExpandedAddressPrefix** список, tootroubleshoot любые проблемы связанные tooVNet пиринг подключения.</span><span class="sxs-lookup"><span data-stu-id="41e30-213">You can view these prefixes in hello **ExpandedAddressPrefix** list, tootroubleshoot any issues related tooVNet peering connectivity.</span></span> 
* <span data-ttu-id="41e30-214">Правила безопасности отображаются, только если имеется NSG, связанный с виртуальной Машины hello сетевой Адаптер и или подсети.</span><span class="sxs-lookup"><span data-stu-id="41e30-214">Effective security rules are only shown if there is an NSG associated with hello VM’s NIC and or subnet.</span></span> 
* <span data-ttu-id="41e30-215">Если Nsg, не связанные с hello сетевого Адаптера или подсети и имеется открытый IP-адрес, назначенный tooyour виртуальной Машины, все порты будут открыты для входящего и исходящего доступа.</span><span class="sxs-lookup"><span data-stu-id="41e30-215">If there are no NSGs associated with hello NIC or subnet and you have a public IP address assigned tooyour VM, all ports will be open for inbound and outbound access.</span></span> <span data-ttu-id="41e30-216">Если виртуальная машина hello общедоступный IP-адрес, применение toohello Nsg сетевой Адаптер или подсети настоятельно рекомендуется.</span><span class="sxs-lookup"><span data-stu-id="41e30-216">If hello VM has a public IP address, applying NSGs toohello NIC or subnet is strongly recommended.</span></span>

