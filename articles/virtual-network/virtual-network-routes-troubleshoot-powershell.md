---
title: "маршруты aaaTroubleshoot - PowerShell | Документы Microsoft"
description: "Узнайте, как tootroubleshoot маршрутизирует в модели развертывания диспетчера ресурсов Azure hello, с помощью Azure PowerShell."
services: virtual-network
documentationcenter: na
author: AnithaAdusumilli
manager: narayan
editor: 
tags: azure-resource-manager
ms.assetid: bf7dc5e7-9399-460e-8e0d-8992dbed98a6
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/23/2016
ms.author: anithaa
ms.openlocfilehash: 7a07806df5c1d0caee921187e6ad29f6755ab535
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="troubleshoot-routes-using-azure-powershell"></a>Устранение проблем с маршрутами с помощью Azure PowerShell
> [!div class="op_single_selector"]
> * [Портал Azure](virtual-network-routes-troubleshoot-portal.md)
> * [PowerShell](virtual-network-routes-troubleshoot-powershell.md)
> 
> 

При возникновении tooor проблем подключения к сети из вашей виртуальной машины (ВМ) Azure, маршруты может влиять на трафик, поступающий на виртуальную Машину. Это статье представлен обзор возможностей диагностики для маршрутов, toohelp дополнительную диагностику.

Таблицы маршрутов связаны с подсетями и действуют во всех сетевых интерфейсах в подсети. следующие типы маршрутов Hello может быть применен tooeach сетевой интерфейс:

* **Системные маршруты.** По умолчанию каждая подсеть, созданная в виртуальной сети Azure, содержит таблицы системных маршрутов. Они разрешают локальный трафик виртуальной сети, локальный трафик через VPN-шлюзы и интернет-трафик. Кроме того, существуют системные маршруты для пиринговых виртуальных сетей.
* **Маршруты BGP:** распространяются toonetwork интерфейсов с помощью ExpressRoute или VPN-подключения сеть сеть. Дополнительные сведения о маршрутизации BGP, считывая hello [BGP шлюзах VPN со](../vpn-gateway/vpn-gateway-bgp-overview.md) и [Обзор ExpressRoute](../expressroute/expressroute-introduction.md) статей.
* **Определяемые пользователем маршруты (UDR):** Если вы используете виртуальных сетевых устройств или являются принудительного туннелирования трафика tooan локальной сети через VPN сайтами, возможно, определяемых пользователем маршрутов (UDRs), связанных с вашей подсети таблицы маршрутов. Если вы не знакомы с UDRs, прочтите hello [определяемых пользователем маршрутов](virtual-networks-udr-overview.md#user-defined-routes) статьи.

С hello различные маршруты, в которых может быть применен tooa сетевого интерфейса, который может быть трудно toodetermine статистические маршруты, вступают в силу. toohelp устранения неполадок подключения к сети виртуальной Машины, можно просмотреть все hello действующих маршрутов для сетевого интерфейса в модели развертывания диспетчера ресурсов Azure hello.

## <a name="using-effective-routes-tootroubleshoot-vm-traffic-flow"></a>С помощью поток трафика действующих маршрутах tootroubleshoot виртуальной Машины
В этой статье используется hello, выполнив сценарий как пример tooillustrate как tootroubleshoot hello эффективную маршрутов для сетевого интерфейса:

Виртуальная машина (*VM1*) подключен toohello виртуальной сети (*VNet1*, префикс: 10.9.0.0/16) происходит сбой tooconnect tooa VM(VM3) в только что peered виртуальной сети (*VNet3*, префикса 10.10.0.0/16). Существуют не UDRs или BGP направляет примененных tooVM1-NIC1 сетевой интерфейс подключен toohello виртуальной Машины, применяются только маршруты системы.

В этой статье объясняется, как вызвать toodetermine hello сбоя подключения hello, с помощью возможностей действующих маршрутах в модели развертывания, управления ресурсами Azure.
Хотя пример hello использует только маршруты системы, hello же действия можно использовать toodetermine сбоев входящие и исходящие подключения через любой тип маршрута.

> [!NOTE]
> Если ВМ имеет более одного сетевого Адаптера, подключенного, проверьте действующих маршрутах для каждого hello tooand проблем подключения к сети toodiagnose сетевых адаптеров из виртуальной Машины.
> 
> 

### <a name="view-effective-routes-for-a-virtual-machine"></a>Просмотр эффективных маршрутов виртуальной машины
toosee hello статистические маршрутов, примененные tooa ВМ, полный hello, следующие шаги:

### <a name="view-effective-routes-for-a-network-interface"></a>Просмотр эффективных маршрутов сетевого интерфейса
toosee hello статистические маршрутах, которые применяются tooa сетевого интерфейса, полный hello, следующие шаги:

1. Запуск сеанса и имени входа tooAzure Azure PowerShell. Если вы не знакомы с помощью Azure PowerShell, прочтите hello [как tooinstall и настройка Azure PowerShell](/powershell/azure/overview) статьи.
2. Hello следующая команда возвращает все маршруты применения tooa сетевой интерфейс с именем *VM1 NIC1* в группе ресурсов hello *RG1*.
   
       Get-AzureRmEffectiveRouteTable -NetworkInterfaceName VM1-NIC1 -ResourceGroupName RG1
   
   > [!TIP]
   > Если вы не знаете имя hello сетевого интерфейса, введите hello, следующая команда tooretrieve hello имена всех сетевых интерфейсов в group.* ресурсов
   > 
   > 
   
       Get-AzureRmNetworkInterface -ResourceGroupName RG1 | Format-Table Name
   
   Hello следующие выходные данные выглядят аналогично toohello выходные данные для каждой подсети hello маршрута применения toohello, сетевой Адаптер подключен к:
   
       Name :
       State : Active
       AddressPrefix : {10.9.0.0/16}
       NextHopType : VNetLocal
       NextHopIpAddress : {}
   
       Name :
       State : Active
       AddressPrefix : {0.0.0.0/16}
       NextHopType : Internet
       NextHopIpAddress : {}
   
   Обратите внимание, следующие hello в выходных данных hello:
   
   * **Имя**: имя действующего маршрута hello может быть пустым, если не указано явным образом, для определяемых пользователем маршрутов. 
   * **Состояние**: Указывает состояние действующего маршрута hello. Возможные значения: Active (Активный) или Invalid (Недействительный)
   * **AddressPrefixes**: Указывает префикс адреса hello hello действующего маршрута в нотации CIDR. 
   * **nextHopType**: указывает hello следующего прыжка для заданного маршрута hello. Возможные значения: *VirtualAppliance*, *Internet*, *VNetLocal*, *VNetPeering* или *Null*. Значение *Null* для **nextHopType** в UDR может означать недействительный маршрут. Например если **nextHopType** — *VirtualAppliance* и виртуальное устройство hello сети виртуальной Машины не находится в состоянии подготовки и выполнения. Если **nextHopType** — *VPNGateway* и нет шлюза Подготовка и выполнение в hello данной виртуальной сети, маршрут hello могут стать недопустимыми.
   * **NextHopIpAddress**: Указывает IP-адрес следующего прыжка действующего маршрута hello hello hello.
   
   Hello следующая команда возвращает hello маршруты в таблицу tooview проще:
   
       Get-AzureRmEffectiveRouteTable -NetworkInterfaceName VM1-NIC1 -ResourceGroupName RG1 | Format-Table
   
   Hello следующие выходные данные выглядят некоторые hello выходных данных, полученных для описанному выше сценарию hello:
   
       Name State AddressPrefix NextHopType NextHopIpAddress
       ---- ----- ------------- ----------- ----------------
       Active {10.9.0.0/16} VnetLocal {}
       Active {0.0.0.0/0} Internet {}
3. Нет нет в списке маршрута toohello *WestUS VNet3* виртуальной сети (префикс 10.10.0.0/16)** из *WestUS VNet1* (префикса 10.9.0.0/16) в выходных данных hello из предыдущего шага hello. Как показано в следующий рисунок hello hello виртуальную сеть пиринга связь с hello *WestUS VNet3* виртуальной сети находится в hello *Disconnected* состояния.
   
    ![](./media/virtual-network-routes-troubleshoot-portal/image4.png)
   
    Hello двусторонней связи для hello пиринг нарушена, который объясняет, почему VM1 не удалось подключиться tooVM3 в hello *WestUS VNet3* виртуальной сети. Заново настройте двунаправленную пиринговую связь для виртуальных сетей *WestUS-VNet1* и *WestUS-VNet3*. Hello выходные данные, возвращаемые после hello виртуальную сеть пиринга правильно связи выглядит следующим образом:
   
        Name State AddressPrefix NextHopType NextHopIpAddress
        ---- ----- ------------- ----------- ----------------
        Active {10.9.0.0/16} VnetLocal {}
        Active {10.10.0.0/16} VNetPeering {}
        Active {0.0.0.0/0} Internet {}
   
    После определения проблемы hello, можно добавлять, удалять, или изменить маршруты и таблиц маршрутов. Введите hello, следующая команда toosee список команд, используемых toodo hello так:
   
        Get-Help *-AzureRmRouteConfig

## <a name="considerations"></a>Рекомендации
Возвращено несколько вещей tookeep помнить при просмотре списка hello маршрутов:

* Маршрутизация основана на совпадении самого длинного префикса (LPM) среди маршрутов UDR, BGP и системных маршрутов. Если имеется несколько маршрутов с hello же LPM совпадение, то маршрут выбирается в зависимости от ее исходной конфигурации в hello следующий порядок:
  
  * определяемый пользователем маршрут;
  * маршрут BGP;
  * системный (стандартный) маршрут.
    
    С действующих маршрутах вы увидите только действующих маршрутах, которые LPM соответствие всех доступных маршрутов hello. Отображая фактически оценку hello маршруты для данного сетевого Адаптера, это позволяет намного проще tootroubleshoot определенные маршруты, в которых может влиять на подключение из виртуальной Машины.
* Если вы используете UDRs и отправки трафика tooa сети виртуальной машины (оценки уязвимости сети), с *VirtualAppliance* как **nextHopType**, включить IP-пересылки на принимающей трафик hello hello уязвимости сети или пакеты будут удалены. 
* Если включено Принудительное туннелирование, весь исходящий трафик Интернета будет перенаправленное tooon организациями. RDP/SSH из Интернета tooyour виртуальной Машины не может работать с этим параметром, в зависимости от того, каким образом hello в локальной обработки этого трафика. 
  Принудительное туннелирование можно включить:
  * если используется VPN-подключение типа "сеть — сеть" (задайте определяемый пользователем маршрут и укажите для параметра nextHopType значение VPN-шлюза);
  * если маршрут по умолчанию объявляется через BGP.
* Для трафик пиринговой виртуальной сети toowork трафика правильной системе маршрут с **nextHopType** *VNetPeering* должен существовать для hello одноранговыми префикс диапазона виртуальной сети. Если такой маршрут не существует и hello виртуальную сеть пиринга ссылку выглядит правильно:
  * Подождите несколько секунд и повторите попытку, если пиринговая связь установлена недавно. Время от времени занимает больше времени, маршруты toopropagate tooall hello сетевых интерфейсов в подсети.
  * Правила группы безопасности сети (NSG) может влиять на трафик, поступающий hello. Дополнительные сведения см. в разделе hello [Устранение сетевых групп безопасности](virtual-network-nsg-troubleshoot-powershell.md) статьи.

