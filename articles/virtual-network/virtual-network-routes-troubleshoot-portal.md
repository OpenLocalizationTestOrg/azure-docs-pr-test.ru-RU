---
title: "маршруты aaaTroubleshoot - портала | Документы Microsoft"
description: "Узнайте, как tootroubleshoot маршруты в hello Azure Resource Manager развертывания модели с помощью hello портала Azure."
services: virtual-network
documentationcenter: na
author: AnithaAdusumilli
manager: narayan
editor: 
tags: azure-resource-manager
ms.assetid: bdd8b6dc-02fb-4057-bb23-8289caa9de89
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/23/2016
ms.author: anithaa
ms.openlocfilehash: 579bae91ef3200852032b3953d3cc5d26deada86
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="troubleshoot-routes-using-hello-azure-portal"></a>Устранение неполадок маршрутов с помощью портала Azure hello
> [!div class="op_single_selector"]
> * [Портал Azure](virtual-network-routes-troubleshoot-portal.md)
> * [PowerShell](virtual-network-routes-troubleshoot-powershell.md)
>
>

При возникновении tooor проблем подключения к сети из вашей виртуальной машины (ВМ) Azure, маршруты может влиять на трафик, поступающий на виртуальную Машину. Это статье представлен обзор возможностей диагностики для маршрутов, toohelp дополнительную диагностику.

Таблицы маршрутов связаны с подсетями и действуют во всех сетевых интерфейсах в подсети. следующие типы маршрутов Hello может быть применен tooeach сетевой интерфейс:

* **Системные маршруты.** По умолчанию каждая подсеть, созданная в виртуальной сети Azure, содержит таблицы системных маршрутов. Они разрешают локальный трафик виртуальной сети, локальный трафик через VPN-шлюзы и интернет-трафик. Кроме того, существуют системные маршруты для пиринговых виртуальных сетей.
* **Маршруты BGP:** распространяются toonetwork интерфейсов с помощью ExpressRoute или VPN-подключения сеть сеть. Дополнительные сведения о маршрутизации BGP, считывая hello [BGP шлюзах VPN со](../vpn-gateway/vpn-gateway-bgp-overview.md) и [Обзор ExpressRoute](../expressroute/expressroute-introduction.md) статей.
* **Определяемые пользователем маршруты (UDR):** Если вы используете виртуальных сетевых устройств или являются принудительного туннелирования трафика tooan локальной сети через VPN сайтами, возможно, определяемых пользователем маршрутов (UDRs), связанных с вашей подсети таблицы маршрутов. Если вы не знакомы с UDRs, прочтите hello [определяемых пользователем маршрутов](virtual-networks-udr-overview.md#user-defined-routes) статьи.

С hello различные маршруты, в которых может быть применен tooa сетевого интерфейса, который может быть трудно toodetermine статистические маршруты, вступают в силу. toohelp устранения неполадок подключения к сети виртуальной Машины, можно просмотреть все hello действующих маршрутов для сетевого интерфейса в модели развертывания диспетчера ресурсов Azure hello.

## <a name="using-effective-routes-tootroubleshoot-vm-traffic-flow"></a>С помощью поток трафика действующих маршрутах tootroubleshoot виртуальной Машины
В этой статье используется hello, выполнив сценарий как пример tooillustrate как tootroubleshoot hello эффективную маршрутов для сетевого интерфейса:

Виртуальная машина (*VM1*) подключен toohello виртуальной сети (*VNet1*, префикс: 10.9.0.0/16) происходит сбой tooconnect tooa VM(VM3) в только что peered виртуальной сети (*VNet3*, префикса 10.10.0.0/16). Существуют не UDRs или BGP направляет примененных tooVM1-NIC1 сетевой интерфейс подключен toohello виртуальной Машины, применяются только маршруты системы.

В этой статье объясняется, как вызвать toodetermine hello сбоя подключения hello, с помощью возможностей действующих маршрутах в модели развертывания, управления ресурсами Azure.
Хотя пример hello использует только маршруты системы, hello же действия можно использовать toodetermine сбоев входящие и исходящие подключения через любой тип маршрута.

> [!NOTE]
> Если ВМ имеет более одного сетевого Адаптера, подключенного, проверьте действующих маршрутах для каждого hello tooand проблем подключения к сети toodiagnose сетевых адаптеров из виртуальной Машины.
>
>

### <a name="view-effective-routes-for-a-virtual-machine"></a>Просмотр эффективных маршрутов виртуальной машины
toosee hello статистические маршрутов, примененные tooa ВМ, полный hello, следующие шаги:

1. Toohello входа портал Azure по адресу https://portal.azure.com.
2. Нажмите кнопку **дополнительные службы**, нажмите кнопку **виртуальные машины** в появившемся списке hello.
3. Выделите tootroubleshoot виртуальной Машины из списка hello и колонки виртуальной Машины с параметрами.
4. Выберите **Диагностика и решение проблем**, а затем распространенную проблему. В этом примере **toomy виртуальной Машины Windows не удается подключить** выбран.

    ![](./media/virtual-network-routes-troubleshoot-portal/image1.png)
5. Действия отображаются в hello проблему, как показано в следующий рисунок hello:

    ![](./media/virtual-network-routes-troubleshoot-portal/image2.png)

    Нажмите кнопку *действующих маршрутах* в hello список рекомендуемых действий.
6. Hello **действующих маршрутах** откроется колонка, как показано в следующий рисунок hello:

    ![](./media/virtual-network-routes-troubleshoot-portal/image3.png)

    Если ваша виртуальная машина содержит только один сетевой интерфейс, он выбирается по умолчанию. При наличии более одного сетевого Адаптера, выберите сетевой Адаптер hello, для которого требуется действующих маршрутах tooview hello.

   > [!NOTE]
   > Если hello виртуальной Машины, связанные с hello сетевой Адаптер не находится в состоянии выполнения, действующих маршрутах, не будет отображаться. Только hello первые 200 действующих маршрутах отображаются на портале hello. Полный список hello, щелкните **загрузить**. Можно дополнительно выполнить фильтрацию на результатах hello hello загруженный CSV-файл.
   >
   >

    Обратите внимание, следующие hello в выходных данных hello:

   * **Источник**: Указывает тип hello маршрута. Для системных маршрутов задано значение *По умолчанию*, для определяемых пользователем маршрутов — *Пользователь*, а для маршрутов шлюза — *VPNGateway*.
   * **Состояние**: Указывает состояние действующего маршрута hello. Возможные значения: *Active* (Активный) или *Invalid* (Недействительный).
   * **AddressPrefixes**: Указывает префикс адреса hello hello действующего маршрута в нотации CIDR.
   * **nextHopType**: указывает hello следующего прыжка для заданного маршрута hello. Возможные значения: *VirtualAppliance*, *Internet*, *VNetLocal*, *VNetPeering* или *Null*. Значение *Null* для **nextHopType** в UDR может означать недействительный маршрут. Например если **nextHopType** — *VirtualAppliance* и виртуальное устройство hello сети виртуальной Машины не находится в состоянии подготовки и выполнения. Если **nextHopType** — *VPNGateway* и нет шлюза Подготовка и выполнение в hello данной виртуальной сети, маршрут hello могут стать недопустимыми.
7. Нет нет в списке маршрута toohello *WestUS VNET3* (10.10.0.0/16 префикса) виртуальной сети из hello *WestUS VNet1* (префикса 10.9.0.0/16) на рисунке hello в предыдущем шаге hello. В следующий рисунок hello, hello пиринга канал будет находиться в hello *Disconnected* состояния:

    ![](./media/virtual-network-routes-troubleshoot-portal/image4.png)

    Hello двусторонней связи для hello пиринг нарушена, который объясняет, почему VM1 не удалось подключиться tooVM3 в hello *WestUS VNet3* виртуальной сети.
8. Hello следующем рисунке показан hello маршрутов после установления hello двунаправленные пиринга ссылку:

    ![](./media/virtual-network-routes-troubleshoot-portal/image5.png)

Для более устранения неполадок сценариев для принудительного туннелирования и маршрута оценки чтения hello [вопросы](virtual-network-routes-troubleshoot-portal.md#considerations) этой статьи.

### <a name="view-effective-routes-for-a-network-interface"></a>Просмотр эффективных маршрутов сетевого интерфейса
Если сетевой трафик относится к определенному сетевому интерфейсу, список всех эффективных маршрутов можно просмотреть непосредственно в сетевом интерфейсе. toosee hello статистические маршрутах, которые применяются tooa сетевого Адаптера, полный hello, следующие шаги:

1. Toohello входа портал Azure по адресу https://portal.azure.com.
2. Выберите **Другие службы**, а затем выберите **Сетевые интерфейсы**.
3. Hello поиска для имени hello сетевой карты или выберите его из списка hello. В этом примере — **VM1-NIC1** .
4. Выберите **действующих маршрутах** в hello **сетевой интерфейс** колонки, как показано в следующий рисунок hello:

       ![](./media/virtual-network-routes-troubleshoot-portal/image6.png)

    Hello **область** выбранного интерфейса сети toohello значения по умолчанию.

      ![](./media/virtual-network-routes-troubleshoot-portal/image7.png)

### <a name="view-effective-routes-for-a-route-table"></a>Просмотр эффективных маршрутов таблицы маршрутов
При изменении определяемых пользователем маршрутов (UDRs) в таблицу маршрутизации, вы можете tooreview влияние hello hello маршруты, добавляемый на конкретной виртуальной Машины. Таблицу маршрутов можно связать с любым количеством подсетей. Теперь можно просмотреть все действующих маршрутах hello Здравствуйте, все сетевые адаптеры, применяется таблицы заданным маршрутом, без необходимости tooswitch контекста из hello, учитывая колонки таблицы маршрутов.

В нашем примере в таблице маршрутов (*UDRouteTable*) указан определяемый пользователем маршрут (*UDRoute*). Этот маршрут отправляет все Интернет-трафик от *подсети1* в hello *WestUS VNet1* виртуальной сети, через устройство виртуальной сети (уязвимости сети), в *подсети2* из hello одной виртуальной сети. Следующий рисунок hello показано Hello маршрута:

![](./media/virtual-network-routes-troubleshoot-portal/image8.png)

toosee hello статистические маршруты для таблицы маршрутов, полный hello, следующие шаги:

1. Toohello входа портал Azure по адресу https://portal.azure.com.
2. Выберите **Другие службы**, а затем выберите **Таблицы маршрутов**.
3. Hello список поиска для таблицы маршрутов hello toosee статистические маршруты для и выберите его. В этом примере — **UDRouteTable** . Откроется колонка для hello выбранные таблицы маршрутов, как показано в следующий рисунок hello:

    ![](./media/virtual-network-routes-troubleshoot-portal/image9.png)
4. Выберите **действующих маршрутах** в hello **таблицы маршрутов** колонку. Hello **область** имеет значение выбранной таблицы toohello маршрута.
5. Таблицы маршрутизации может быть применен toomultiple подсетей. Выберите hello **подсети** требуется tooreview из списка hello. В этом примере — **Subnet1** .
6. Выберите **Сетевой интерфейс**. Перечисляются все сетевые адаптеры подключенных toohello выбранной подсети. В этом примере — **VM1-NIC1** .

    ![](./media/virtual-network-routes-troubleshoot-portal/image10.png)

   > [!NOTE]
   > Если hello сетевой Адаптер не связан с работающей виртуальной Машины, не отображаются нет действующих маршрутов.
   >
   >

## <a name="considerations"></a>Рекомендации
Возвращено несколько вещей tookeep помнить при просмотре списка hello маршрутов:

* Маршрутизация основана на совпадении самого длинного префикса (LPM) среди маршрутов UDR, BGP и системных маршрутов. Если имеется несколько маршрутов с hello же LPM совпадение, то маршрут выбирается в зависимости от ее исходной конфигурации в hello следующий порядок:

  * определяемый пользователем маршрут;
  * маршрут BGP;
  * системный (стандартный) маршрут.

    С действующих маршрутах вы увидите только действующих маршрутах, которые LPM соответствие всех доступных маршрутов hello. Отображая фактически оценку hello маршруты для данного сетевого Адаптера, это позволяет намного проще tootroubleshoot определенные маршруты, в которых может влиять на подключение из виртуальной Машины.
* Если вы используете UDRs и отправки трафика tooa сети виртуальной машины (оценки уязвимости сети), с *VirtualAppliance* как **nextHopType**, включить IP-пересылки на принимающей трафик hello hello уязвимости сети или пакеты будут удалены.
* Если включено Принудительное туннелирование, весь исходящий трафик Интернета будет перенаправленное tooon организациями. RDP/SSH из Интернета tooyour виртуальной Машины не может работать с этим параметром, в зависимости от того, каким образом hello в локальной обработки этого трафика.
  Принудительное туннелирование можно включить:
  * если используется VPN-подключение типа "сеть — сеть" (задайте определяемый пользователем маршрут и укажите для параметра nextHopType значение VPN-шлюза);
  * если маршрут по умолчанию объявляется через BGP.
* Для трафик пиринговой виртуальной сети toowork трафика правильной системе маршрут с **nextHopType** *VNetPeering* должен существовать для hello одноранговыми префикс диапазона виртуальной сети. Если такой маршрут не существует и hello виртуальную сеть пиринга ссылку выглядит правильно:
  * Подождите несколько секунд и повторите попытку, если пиринговая связь установлена недавно. Время от времени занимает больше времени, маршруты toopropagate tooall hello сетевых интерфейсов в подсети.
  * Правила группы безопасности сети (NSG) может влиять на трафик, поступающий hello. Дополнительные сведения см. в разделе hello [Устранение сетевых групп безопасности](virtual-network-nsg-troubleshoot-portal.md) статьи.
