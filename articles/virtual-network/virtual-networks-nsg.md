---
title: "aaaNetwork групп безопасности в Azure | Документы Microsoft"
description: "Узнайте, как tooisolate и контроля трафика потока внутри виртуальных сетей с помощью брандмауэра распределенных hello в Azure с помощью групп безопасности сети."
services: virtual-network
documentationcenter: na
author: jimdial
manager: timlt
editor: tysonn
ms.assetid: 20e850fc-6456-4b5f-9a3f-a8379b052bc9
ms.service: virtual-network
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 02/11/2016
ms.author: jdial
ms.openlocfilehash: 3528ce833dab17977327c3c9ae0e78316e5e6a05
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="filter-network-traffic-with-network-security-groups"></a><span data-ttu-id="f8cba-103">Фильтрация сетевого трафика с помощью групп безопасности сети</span><span class="sxs-lookup"><span data-stu-id="f8cba-103">Filter network traffic with network security groups</span></span>

<span data-ttu-id="f8cba-104">Группа безопасности сети (NSG) содержит список правил безопасности, которые разрешают или запрещают tooresources сетевого трафика, подключенных tooAzure виртуальных сетей (VNet).</span><span class="sxs-lookup"><span data-stu-id="f8cba-104">A network security group (NSG) contains a list of security rules that allow or deny network traffic tooresources connected tooAzure Virtual Networks (VNet).</span></span> <span data-ttu-id="f8cba-105">Nsg может быть связан toosubnets, отдельные виртуальные машины (классические) или отдельных сетевых интерфейсов (NIC) присоединенного tooVMs (диспетчера ресурсов).</span><span class="sxs-lookup"><span data-stu-id="f8cba-105">NSGs can be associated toosubnets, individual VMs (classic), or individual network interfaces (NIC) attached tooVMs (Resource Manager).</span></span> <span data-ttu-id="f8cba-106">Когда NSG связанные tooa подсети, hello правила применяются tooall ресурсы подключенных toohello подсети.</span><span class="sxs-lookup"><span data-stu-id="f8cba-106">When an NSG is associated tooa subnet, hello rules apply tooall resources connected toohello subnet.</span></span> <span data-ttu-id="f8cba-107">Трафик может быть ограничен дальнейшей связав tooa NSG виртуальной Машины или сетевой адаптер.</span><span class="sxs-lookup"><span data-stu-id="f8cba-107">Traffic can further be restricted by also associating an NSG tooa VM or NIC.</span></span>

> [!NOTE]
> <span data-ttu-id="f8cba-108">В Azure предлагаются две модели развертывания для создания ресурсов и работы с ними: [модель Resource Manager и классическая модель](../resource-manager-deployment-model.md).</span><span class="sxs-lookup"><span data-stu-id="f8cba-108">Azure has two different deployment models for creating and working with resources:  [Resource Manager and classic](../resource-manager-deployment-model.md).</span></span> <span data-ttu-id="f8cba-109">В этой статье описывается использование обеих моделей, но корпорация Майкрософт рекомендует наиболее новые развертывания модели hello диспетчера ресурсов.</span><span class="sxs-lookup"><span data-stu-id="f8cba-109">This article covers using both models, but Microsoft recommends that most new deployments use hello Resource Manager model.</span></span>

## <a name="nsg-resource"></a><span data-ttu-id="f8cba-110">Ресурс NSG</span><span class="sxs-lookup"><span data-stu-id="f8cba-110">NSG resource</span></span>
<span data-ttu-id="f8cba-111">Nsg содержит hello следующие свойства:</span><span class="sxs-lookup"><span data-stu-id="f8cba-111">NSGs contain hello following properties:</span></span>

| <span data-ttu-id="f8cba-112">Свойство</span><span class="sxs-lookup"><span data-stu-id="f8cba-112">Property</span></span> | <span data-ttu-id="f8cba-113">Описание</span><span class="sxs-lookup"><span data-stu-id="f8cba-113">Description</span></span> | <span data-ttu-id="f8cba-114">Ограничения</span><span class="sxs-lookup"><span data-stu-id="f8cba-114">Constraints</span></span> | <span data-ttu-id="f8cba-115">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="f8cba-115">Considerations</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="f8cba-116">Имя</span><span class="sxs-lookup"><span data-stu-id="f8cba-116">Name</span></span> |<span data-ttu-id="f8cba-117">Имя для hello NSG</span><span class="sxs-lookup"><span data-stu-id="f8cba-117">Name for hello NSG</span></span> |<span data-ttu-id="f8cba-118">Должно быть уникальным в пределах области hello.</span><span class="sxs-lookup"><span data-stu-id="f8cba-118">Must be unique within hello region.</span></span><br/><span data-ttu-id="f8cba-119">Может содержать буквы, цифры, символы подчеркивания, точки и дефисы.</span><span class="sxs-lookup"><span data-stu-id="f8cba-119">Can contain letters, numbers, underscores, periods, and hyphens.</span></span><br/><span data-ttu-id="f8cba-120">Первый символ — буква или цифра.</span><span class="sxs-lookup"><span data-stu-id="f8cba-120">Must start with a letter or number.</span></span><br/><span data-ttu-id="f8cba-121">Последний символ — буква, цифра или символ подчеркивания.</span><span class="sxs-lookup"><span data-stu-id="f8cba-121">Must end with a letter, number, or underscore.</span></span><br/><span data-ttu-id="f8cba-122">Максимальная длина: 80 символов.</span><span class="sxs-lookup"><span data-stu-id="f8cba-122">Cannot exceed 80 characters.</span></span> |<span data-ttu-id="f8cba-123">Так как может потребоваться несколько Nsg toocreate, убедитесь, что у вас есть соглашение об именовании, который позволяет легко tooidentify функции hello Nsg.</span><span class="sxs-lookup"><span data-stu-id="f8cba-123">Since you may need toocreate several NSGs, make sure you have a naming convention that makes it easy tooidentify hello function of your NSGs.</span></span> |
| <span data-ttu-id="f8cba-124">Регион</span><span class="sxs-lookup"><span data-stu-id="f8cba-124">Region</span></span> |<span data-ttu-id="f8cba-125">Azure [область](https://azure.microsoft.com/regions) где hello NSG создается.</span><span class="sxs-lookup"><span data-stu-id="f8cba-125">Azure [region](https://azure.microsoft.com/regions) where hello NSG is created.</span></span> |<span data-ttu-id="f8cba-126">Nsg можно только связанные tooresources внутри hello же регионе, что hello NSG.</span><span class="sxs-lookup"><span data-stu-id="f8cba-126">NSGs can only be associated tooresources within hello same region as hello NSG.</span></span> |<span data-ttu-id="f8cba-127">toolearn о Nsg, сколько может иметь по регионам, чтение hello [Azure ограничивает](../azure-subscription-service-limits.md#virtual-networking-limits-classic) статьи.</span><span class="sxs-lookup"><span data-stu-id="f8cba-127">toolearn about how many NSGs you can have per region, read hello [Azure limits](../azure-subscription-service-limits.md#virtual-networking-limits-classic) article.</span></span>|
| <span data-ttu-id="f8cba-128">Группа ресурсов</span><span class="sxs-lookup"><span data-stu-id="f8cba-128">Resource group</span></span> |<span data-ttu-id="f8cba-129">Hello [группы ресурсов](../azure-resource-manager/resource-group-overview.md#resource-groups) NSG существует в hello.</span><span class="sxs-lookup"><span data-stu-id="f8cba-129">hello [resource group](../azure-resource-manager/resource-group-overview.md#resource-groups) hello NSG exists in.</span></span> |<span data-ttu-id="f8cba-130">Несмотря на то, что в группе ресурсов существует NSG, его можно связанных tooresources в любой группе ресурсов, при условии, что ресурс hello — часть hello же регионе Azure, что hello NSG.</span><span class="sxs-lookup"><span data-stu-id="f8cba-130">Although an NSG exists in a resource group, it can be associated tooresources in any resource group, as long as hello resource is part of hello same Azure region as hello NSG.</span></span> |<span data-ttu-id="f8cba-131">Группы ресурсов являются toomanage используется несколько ресурсов вместе, как единицу развертывания.</span><span class="sxs-lookup"><span data-stu-id="f8cba-131">Resource groups are used toomanage multiple resources together, as a deployment unit.</span></span><br/><span data-ttu-id="f8cba-132">Можно рассмотреть возможность группирования hello NSG, с которыми связан для ресурсов.</span><span class="sxs-lookup"><span data-stu-id="f8cba-132">You may consider grouping hello NSG with resources it is associated to.</span></span> |
| <span data-ttu-id="f8cba-133">Правила</span><span class="sxs-lookup"><span data-stu-id="f8cba-133">Rules</span></span> |<span data-ttu-id="f8cba-134">Правила для входящего и исходящего трафика, определяющие разрешенный и запрещенный трафик.</span><span class="sxs-lookup"><span data-stu-id="f8cba-134">Inbound or outbound rules that define what traffic is allowed or denied.</span></span> | |<span data-ttu-id="f8cba-135">В разделе hello [правила NSG](#Nsg-rules) этой статьи.</span><span class="sxs-lookup"><span data-stu-id="f8cba-135">See hello [NSG rules](#Nsg-rules) section of this article.</span></span> |

> [!NOTE]
> <span data-ttu-id="f8cba-136">Списки ACL на основе конечной точки и сетевой безопасности группы не поддерживаются на hello того же экземпляра виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="f8cba-136">Endpoint-based ACLs and network security groups are not supported on hello same VM instance.</span></span> <span data-ttu-id="f8cba-137">Toouse NSG и уже иметь конечную точку ACL на месте, необходимо сначала удалите конечную точку hello ACL.</span><span class="sxs-lookup"><span data-stu-id="f8cba-137">If you want toouse an NSG and have an endpoint ACL already in place, first remove hello endpoint ACL.</span></span> <span data-ttu-id="f8cba-138">как считывать tooremove ACL, toolearn hello [управление списки управления доступом (ACL) для конечных точек с помощью PowerShell](virtual-networks-acl-powershell.md) статьи.</span><span class="sxs-lookup"><span data-stu-id="f8cba-138">toolearn how tooremove an ACL, read hello [Managing Access Control Lists (ACLs) for Endpoints by using PowerShell](virtual-networks-acl-powershell.md) article.</span></span>
> 

### <a name="nsg-rules"></a><span data-ttu-id="f8cba-139">Правила групп безопасности сети (NSG)</span><span class="sxs-lookup"><span data-stu-id="f8cba-139">NSG rules</span></span>
<span data-ttu-id="f8cba-140">Правила NSG содержат hello следующие свойства:</span><span class="sxs-lookup"><span data-stu-id="f8cba-140">NSG rules contain hello following properties:</span></span>

| <span data-ttu-id="f8cba-141">Свойство</span><span class="sxs-lookup"><span data-stu-id="f8cba-141">Property</span></span> | <span data-ttu-id="f8cba-142">Описание</span><span class="sxs-lookup"><span data-stu-id="f8cba-142">Description</span></span> | <span data-ttu-id="f8cba-143">Ограничения</span><span class="sxs-lookup"><span data-stu-id="f8cba-143">Constraints</span></span> | <span data-ttu-id="f8cba-144">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="f8cba-144">Considerations</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="f8cba-145">**Имя**</span><span class="sxs-lookup"><span data-stu-id="f8cba-145">**Name**</span></span> |<span data-ttu-id="f8cba-146">Имя правила hello.</span><span class="sxs-lookup"><span data-stu-id="f8cba-146">Name for hello rule.</span></span> |<span data-ttu-id="f8cba-147">Должно быть уникальным в пределах области hello.</span><span class="sxs-lookup"><span data-stu-id="f8cba-147">Must be unique within hello region.</span></span><br/><span data-ttu-id="f8cba-148">Может содержать буквы, цифры, символы подчеркивания, точки и дефисы.</span><span class="sxs-lookup"><span data-stu-id="f8cba-148">Can contain letters, numbers, underscores, periods, and hyphens.</span></span><br/><span data-ttu-id="f8cba-149">Первый символ — буква или цифра.</span><span class="sxs-lookup"><span data-stu-id="f8cba-149">Must start with a letter or number.</span></span><br/><span data-ttu-id="f8cba-150">Последний символ — буква, цифра или символ подчеркивания.</span><span class="sxs-lookup"><span data-stu-id="f8cba-150">Must end with a letter, number, or underscore.</span></span><br/><span data-ttu-id="f8cba-151">Максимальная длина: 80 символов.</span><span class="sxs-lookup"><span data-stu-id="f8cba-151">Cannot exceed 80 characters.</span></span> |<span data-ttu-id="f8cba-152">Может иметь несколько правил в NSG, поэтому убедитесь, что выполнить соглашение об именовании, который позволяет вам функции hello tooidentify правила.</span><span class="sxs-lookup"><span data-stu-id="f8cba-152">You may have several rules within an NSG, so make sure you follow a naming convention that allows you tooidentify hello function of your rule.</span></span> |
| <span data-ttu-id="f8cba-153">**Протокол**</span><span class="sxs-lookup"><span data-stu-id="f8cba-153">**Protocol**</span></span> |<span data-ttu-id="f8cba-154">Протокол toomatch для правила hello.</span><span class="sxs-lookup"><span data-stu-id="f8cba-154">Protocol toomatch for hello rule.</span></span> |<span data-ttu-id="f8cba-155">TCP, UDP или *</span><span class="sxs-lookup"><span data-stu-id="f8cba-155">TCP, UDP, or *</span></span> |<span data-ttu-id="f8cba-156">С помощью * как протокол ICMP (только трафик востока на запад) включает в себя, как также по UDP и TCP и может привести к уменьшению числа hello правила необходимо.</span><span class="sxs-lookup"><span data-stu-id="f8cba-156">Using * as a protocol includes ICMP (East-West traffic only), as well as UDP and TCP, and may reduce hello number of rules you need.</span></span><br/><span data-ttu-id="f8cba-157">AT hello же времени, с помощью * может быть слишком широкий подход, поэтому рекомендуется использовать * только при необходимости.</span><span class="sxs-lookup"><span data-stu-id="f8cba-157">At hello same time, using * might be too broad an approach, so it's recommended that you use * only when necessary.</span></span> |
| <span data-ttu-id="f8cba-158">**Диапазон исходных портов**</span><span class="sxs-lookup"><span data-stu-id="f8cba-158">**Source port range**</span></span> |<span data-ttu-id="f8cba-159">Toomatch диапазон портов источника для правила hello.</span><span class="sxs-lookup"><span data-stu-id="f8cba-159">Source port range toomatch for hello rule.</span></span> |<span data-ttu-id="f8cba-160">Один номер порта от 1 too65535, диапазон портов (пример: 1-65535), или * (для всех портов).</span><span class="sxs-lookup"><span data-stu-id="f8cba-160">Single port number from 1 too65535, port range (example: 1-65535), or * (for all ports).</span></span> |<span data-ttu-id="f8cba-161">Исходные порты могут быть временными.</span><span class="sxs-lookup"><span data-stu-id="f8cba-161">Source ports could be ephemeral.</span></span> <span data-ttu-id="f8cba-162">Если клиентская программа не использует определенный порт, в большинстве случаев следует использовать "*".</span><span class="sxs-lookup"><span data-stu-id="f8cba-162">Unless your client program is using a specific port, use * in most cases.</span></span><br/><span data-ttu-id="f8cba-163">Попробуйте диапазоны портов toouse настолько, насколько возможно tooavoid hello требуется для нескольких правил.</span><span class="sxs-lookup"><span data-stu-id="f8cba-163">Try toouse port ranges as much as possible tooavoid hello need for multiple rules.</span></span><br/><span data-ttu-id="f8cba-164">Несколько портов или диапазонов портов нельзя группировать, указывая их через запятую.</span><span class="sxs-lookup"><span data-stu-id="f8cba-164">Multiple ports or port ranges cannot be grouped by a comma.</span></span> |
| <span data-ttu-id="f8cba-165">**Диапазон конечных портов**</span><span class="sxs-lookup"><span data-stu-id="f8cba-165">**Destination port range**</span></span> |<span data-ttu-id="f8cba-166">Toomatch диапазон портов назначения для правила hello.</span><span class="sxs-lookup"><span data-stu-id="f8cba-166">Destination port range toomatch for hello rule.</span></span> |<span data-ttu-id="f8cba-167">Один номер порта от 1 too65535, диапазон портов (пример: 1-65535), или \* (для всех портов).</span><span class="sxs-lookup"><span data-stu-id="f8cba-167">Single port number from 1 too65535, port range (example: 1-65535), or \* (for all ports).</span></span> |<span data-ttu-id="f8cba-168">Попробуйте диапазоны портов toouse настолько, насколько возможно tooavoid hello требуется для нескольких правил.</span><span class="sxs-lookup"><span data-stu-id="f8cba-168">Try toouse port ranges as much as possible tooavoid hello need for multiple rules.</span></span><br/><span data-ttu-id="f8cba-169">Несколько портов или диапазонов портов нельзя группировать, указывая их через запятую.</span><span class="sxs-lookup"><span data-stu-id="f8cba-169">Multiple ports or port ranges cannot be grouped by a comma.</span></span> |
| <span data-ttu-id="f8cba-170">**Префикс исходного адреса**</span><span class="sxs-lookup"><span data-stu-id="f8cba-170">**Source address prefix**</span></span> |<span data-ttu-id="f8cba-171">Исходный адрес префикс или тег toomatch для правила hello.</span><span class="sxs-lookup"><span data-stu-id="f8cba-171">Source address prefix or tag toomatch for hello rule.</span></span> |<span data-ttu-id="f8cba-172">Отдельный IP-адрес (например, 10.10.10.10), IP-подсеть (например, 192.168.1.0/24), [тег по умолчанию](#default-tags) или "*" (для всех адресов).</span><span class="sxs-lookup"><span data-stu-id="f8cba-172">Single IP address (example: 10.10.10.10), IP subnet (example: 192.168.1.0/24), [default tag](#default-tags), or * (for all addresses).</span></span> |<span data-ttu-id="f8cba-173">Рассмотрите возможность использования диапазонов, теги по умолчанию и * tooreduce hello количество правил.</span><span class="sxs-lookup"><span data-stu-id="f8cba-173">Consider using ranges, default tags, and * tooreduce hello number of rules.</span></span> |
| <span data-ttu-id="f8cba-174">**Префикс адреса назначения**</span><span class="sxs-lookup"><span data-stu-id="f8cba-174">**Destination address prefix**</span></span> |<span data-ttu-id="f8cba-175">Конечный адрес префикс или тег toomatch для правила hello.</span><span class="sxs-lookup"><span data-stu-id="f8cba-175">Destination address prefix or tag toomatch for hello rule.</span></span> | <span data-ttu-id="f8cba-176">Отдельный IP-адрес (например, 10.10.10.10), IP-подсеть (например, 192.168.1.0/24), [тег по умолчанию](#default-tags) или "*" (для всех адресов).</span><span class="sxs-lookup"><span data-stu-id="f8cba-176">Single IP address (example: 10.10.10.10), IP subnet (example: 192.168.1.0/24), [default tag](#default-tags), or * (for all addresses).</span></span> |<span data-ttu-id="f8cba-177">Рассмотрите возможность использования диапазонов, теги по умолчанию и * tooreduce hello количество правил.</span><span class="sxs-lookup"><span data-stu-id="f8cba-177">Consider using ranges, default tags, and * tooreduce hello number of rules.</span></span> |
| <span data-ttu-id="f8cba-178">**Направление**</span><span class="sxs-lookup"><span data-stu-id="f8cba-178">**Direction**</span></span> |<span data-ttu-id="f8cba-179">Направление трафика toomatch для правила hello.</span><span class="sxs-lookup"><span data-stu-id="f8cba-179">Direction of traffic toomatch for hello rule.</span></span> |<span data-ttu-id="f8cba-180">Входящий или исходящий.</span><span class="sxs-lookup"><span data-stu-id="f8cba-180">Inbound or outbound.</span></span> |<span data-ttu-id="f8cba-181">Правила для входящего и исходящего трафика обрабатываются отдельно, в зависимости от направления.</span><span class="sxs-lookup"><span data-stu-id="f8cba-181">Inbound and outbound rules are processed separately, based on direction.</span></span> |
| <span data-ttu-id="f8cba-182">**Приоритет**</span><span class="sxs-lookup"><span data-stu-id="f8cba-182">**Priority**</span></span> |<span data-ttu-id="f8cba-183">Правила проверяются в порядке приоритета hello.</span><span class="sxs-lookup"><span data-stu-id="f8cba-183">Rules are checked in hello order of priority.</span></span> <span data-ttu-id="f8cba-184">Когда применяется правило, соответствие других правил не проверяется.</span><span class="sxs-lookup"><span data-stu-id="f8cba-184">Once a rule applies, no more rules are tested for matching.</span></span> | <span data-ttu-id="f8cba-185">Значение в диапазоне от 100 до 4096.</span><span class="sxs-lookup"><span data-stu-id="f8cba-185">Number between 100 and 4096.</span></span> | <span data-ttu-id="f8cba-186">Рассмотрите возможность создания правила, переход на 100 для каждого пространства tooleave правила для нового правила приоритеты будущих можно создать в hello.</span><span class="sxs-lookup"><span data-stu-id="f8cba-186">Consider creating rules jumping priorities by 100 for each rule tooleave space for new rules you might create in hello future.</span></span> |
| <span data-ttu-id="f8cba-187">**Access**</span><span class="sxs-lookup"><span data-stu-id="f8cba-187">**Access**</span></span> |<span data-ttu-id="f8cba-188">Тип доступа tooapply ли соответствует правилу hello.</span><span class="sxs-lookup"><span data-stu-id="f8cba-188">Type of access tooapply if hello rule matches.</span></span> | <span data-ttu-id="f8cba-189">Разрешить или запретить доступ.</span><span class="sxs-lookup"><span data-stu-id="f8cba-189">Allow or deny.</span></span> | <span data-ttu-id="f8cba-190">Имейте в виду, что если разрешающее правило для пакета не найден, hello отбрасывается.</span><span class="sxs-lookup"><span data-stu-id="f8cba-190">Keep in mind that if an allow rule is not found for a packet, hello packet is dropped.</span></span> |

<span data-ttu-id="f8cba-191">Группы безопасности сети содержат два набора правил: для входящего и исходящего трафика.</span><span class="sxs-lookup"><span data-stu-id="f8cba-191">NSGs contain two sets of rules: Inbound and outbound.</span></span> <span data-ttu-id="f8cba-192">Hello приоритет для правила должен быть уникальным в пределах каждого набора.</span><span class="sxs-lookup"><span data-stu-id="f8cba-192">hello priority for a rule must be unique within each set.</span></span> 

![Обработка правил NSG](./media/virtual-network-nsg-overview/figure3.png) 

<span data-ttu-id="f8cba-194">Hello предыдущих рисунке показано, как обрабатываются правила NSG.</span><span class="sxs-lookup"><span data-stu-id="f8cba-194">hello previous picture shows how NSG rules are processed.</span></span>

### <a name="default-tags"></a><span data-ttu-id="f8cba-195">Теги по умолчанию</span><span class="sxs-lookup"><span data-stu-id="f8cba-195">Default Tags</span></span>
<span data-ttu-id="f8cba-196">Теги по умолчанию — это системные идентификаторы tooaddress категории IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="f8cba-196">Default tags are system-provided identifiers tooaddress a category of IP addresses.</span></span> <span data-ttu-id="f8cba-197">По умолчанию теги можно использовать в hello **префикс адреса источника** и **префикс адреса назначения** свойств все правила.</span><span class="sxs-lookup"><span data-stu-id="f8cba-197">You can use default tags in hello **source address prefix** and **destination address prefix** properties of any rule.</span></span> <span data-ttu-id="f8cba-198">Существует три доступных тега по умолчанию:</span><span class="sxs-lookup"><span data-stu-id="f8cba-198">There are three default tags you can use:</span></span>

* <span data-ttu-id="f8cba-199">**VirtualNetwork** (диспетчера ресурсов) (**VIRTUAL_NETWORK** для классического): этот тег содержит hello адресное пространство виртуальной сети (CIDR диапазоны, определенные в Azure), все подключается адресных пространств локальной, а Виртуальные сети Azure (локальные сети).</span><span class="sxs-lookup"><span data-stu-id="f8cba-199">**VirtualNetwork** (Resource Manager) (**VIRTUAL_NETWORK** for classic): This tag includes hello virtual network address space (CIDR ranges defined in Azure), all connected on-premises address spaces, and connected Azure VNets (local networks).</span></span>
* <span data-ttu-id="f8cba-200">**AzureLoadBalancer** (для развертываний с помощью Resource Manager) или **AZURE_LOADBALANCER** (для классических развертываний). Этот тег обозначает балансировщик нагрузки инфраструктуры Azure.</span><span class="sxs-lookup"><span data-stu-id="f8cba-200">**AzureLoadBalancer** (Resource Manager) (**AZURE_LOADBALANCER** for classic): This tag denotes Azure’s infrastructure load balancer.</span></span> <span data-ttu-id="f8cba-201">тег Hello преобразует tooan получаются IP центра обработки данных Azure, где зонды работоспособности Azure.</span><span class="sxs-lookup"><span data-stu-id="f8cba-201">hello tag translates tooan Azure datacenter IP where Azure’s health probes originate.</span></span>
* <span data-ttu-id="f8cba-202">**Интернет** (диспетчера ресурсов) (**INTERNET** для классического): этот тег обозначает hello пространство IP-адресов, за пределами виртуальной сети hello и доступно через Интернет.</span><span class="sxs-lookup"><span data-stu-id="f8cba-202">**Internet** (Resource Manager) (**INTERNET** for classic): This tag denotes hello IP address space that is outside hello virtual network and reachable by public Internet.</span></span> <span data-ttu-id="f8cba-203">Hello диапазон включает hello [Azure принадлежит пространство общедоступных IP](https://www.microsoft.com/download/details.aspx?id=41653).</span><span class="sxs-lookup"><span data-stu-id="f8cba-203">hello range includes hello [Azure owned public IP space](https://www.microsoft.com/download/details.aspx?id=41653).</span></span>

### <a name="default-rules"></a><span data-ttu-id="f8cba-204">Правила по умолчанию</span><span class="sxs-lookup"><span data-stu-id="f8cba-204">Default rules</span></span>
<span data-ttu-id="f8cba-205">Все группы NSG содержат набор правил по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="f8cba-205">All NSGs contain a set of default rules.</span></span> <span data-ttu-id="f8cba-206">правила по умолчанию Hello не может быть удалена, но так как они будут назначены hello самый низкий приоритет, они могут быть переопределены созданных вами правил hello.</span><span class="sxs-lookup"><span data-stu-id="f8cba-206">hello default rules cannot be deleted, but because they are assigned hello lowest priority, they can be overridden by hello rules that you create.</span></span> 

<span data-ttu-id="f8cba-207">правила по умолчанию Hello разрешить и запретить трафик следующим образом:</span><span class="sxs-lookup"><span data-stu-id="f8cba-207">hello default rules allow and disallow traffic as follows:</span></span>
- <span data-ttu-id="f8cba-208">**Виртуальная сеть.** Входящий и исходящий трафик виртуальной сети разрешен в обоих направлениях.</span><span class="sxs-lookup"><span data-stu-id="f8cba-208">**Virtual network:** Traffic originating and ending in a virtual network is allowed both in inbound and outbound directions.</span></span>
- <span data-ttu-id="f8cba-209">**Интернет.** Исходящий трафик разрешен, но входящий трафик заблокирован.</span><span class="sxs-lookup"><span data-stu-id="f8cba-209">**Internet:** Outbound traffic is allowed, but inbound traffic is blocked.</span></span>
- <span data-ttu-id="f8cba-210">**Подсистема балансировки нагрузки:** работоспособности hello tooprobe подсистемы балансировки нагрузки Azure разрешить виртуальных машин и экземпляров ролей.</span><span class="sxs-lookup"><span data-stu-id="f8cba-210">**Load balancer:** Allow Azure’s load balancer tooprobe hello health of your VMs and role instances.</span></span> <span data-ttu-id="f8cba-211">Если набор балансировки нагрузки не используется, это правило можно переопределить.</span><span class="sxs-lookup"><span data-stu-id="f8cba-211">If you are not using a load balanced set you can override this rule.</span></span>

<span data-ttu-id="f8cba-212">**Правила по умолчанию для входящего трафика**</span><span class="sxs-lookup"><span data-stu-id="f8cba-212">**Inbound default rules**</span></span>

| <span data-ttu-id="f8cba-213">Имя</span><span class="sxs-lookup"><span data-stu-id="f8cba-213">Name</span></span> | <span data-ttu-id="f8cba-214">Приоритет</span><span class="sxs-lookup"><span data-stu-id="f8cba-214">Priority</span></span> | <span data-ttu-id="f8cba-215">Исходный IP-адрес</span><span class="sxs-lookup"><span data-stu-id="f8cba-215">Source IP</span></span> | <span data-ttu-id="f8cba-216">Исходный порт</span><span class="sxs-lookup"><span data-stu-id="f8cba-216">Source Port</span></span> | <span data-ttu-id="f8cba-217">Конечный IP-адрес</span><span class="sxs-lookup"><span data-stu-id="f8cba-217">Destination IP</span></span> | <span data-ttu-id="f8cba-218">Конечный порт</span><span class="sxs-lookup"><span data-stu-id="f8cba-218">Destination Port</span></span> | <span data-ttu-id="f8cba-219">Протокол</span><span class="sxs-lookup"><span data-stu-id="f8cba-219">Protocol</span></span> | <span data-ttu-id="f8cba-220">Access</span><span class="sxs-lookup"><span data-stu-id="f8cba-220">Access</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="f8cba-221">AllowVNetInBound</span><span class="sxs-lookup"><span data-stu-id="f8cba-221">AllowVNetInBound</span></span> |<span data-ttu-id="f8cba-222">65000</span><span class="sxs-lookup"><span data-stu-id="f8cba-222">65000</span></span> | <span data-ttu-id="f8cba-223">Виртуальная сеть</span><span class="sxs-lookup"><span data-stu-id="f8cba-223">VirtualNetwork</span></span> | * | <span data-ttu-id="f8cba-224">Виртуальная сеть</span><span class="sxs-lookup"><span data-stu-id="f8cba-224">VirtualNetwork</span></span> | * | * | <span data-ttu-id="f8cba-225">РАЗРЕШИТЬ</span><span class="sxs-lookup"><span data-stu-id="f8cba-225">Allow</span></span> |
| <span data-ttu-id="f8cba-226">AllowAzureLoadBalancerInBound</span><span class="sxs-lookup"><span data-stu-id="f8cba-226">AllowAzureLoadBalancerInBound</span></span> | <span data-ttu-id="f8cba-227">65001</span><span class="sxs-lookup"><span data-stu-id="f8cba-227">65001</span></span> | <span data-ttu-id="f8cba-228">AzureLoadBalancer</span><span class="sxs-lookup"><span data-stu-id="f8cba-228">AzureLoadBalancer</span></span> | * | * | * | * | <span data-ttu-id="f8cba-229">РАЗРЕШИТЬ</span><span class="sxs-lookup"><span data-stu-id="f8cba-229">Allow</span></span> |
| <span data-ttu-id="f8cba-230">DenyAllInBound</span><span class="sxs-lookup"><span data-stu-id="f8cba-230">DenyAllInBound</span></span> |<span data-ttu-id="f8cba-231">65500</span><span class="sxs-lookup"><span data-stu-id="f8cba-231">65500</span></span> | * | * | * | * | * | <span data-ttu-id="f8cba-232">ЗАПРЕТИТЬ</span><span class="sxs-lookup"><span data-stu-id="f8cba-232">Deny</span></span> |

<span data-ttu-id="f8cba-233">**Правила по умолчанию для исходящего трафика**</span><span class="sxs-lookup"><span data-stu-id="f8cba-233">**Outbound default rules**</span></span>

| <span data-ttu-id="f8cba-234">Имя</span><span class="sxs-lookup"><span data-stu-id="f8cba-234">Name</span></span> | <span data-ttu-id="f8cba-235">Приоритет</span><span class="sxs-lookup"><span data-stu-id="f8cba-235">Priority</span></span> | <span data-ttu-id="f8cba-236">Исходный IP-адрес</span><span class="sxs-lookup"><span data-stu-id="f8cba-236">Source IP</span></span> | <span data-ttu-id="f8cba-237">Исходный порт</span><span class="sxs-lookup"><span data-stu-id="f8cba-237">Source Port</span></span> | <span data-ttu-id="f8cba-238">Конечный IP-адрес</span><span class="sxs-lookup"><span data-stu-id="f8cba-238">Destination IP</span></span> | <span data-ttu-id="f8cba-239">Конечный порт</span><span class="sxs-lookup"><span data-stu-id="f8cba-239">Destination Port</span></span> | <span data-ttu-id="f8cba-240">Протокол</span><span class="sxs-lookup"><span data-stu-id="f8cba-240">Protocol</span></span> | <span data-ttu-id="f8cba-241">Access</span><span class="sxs-lookup"><span data-stu-id="f8cba-241">Access</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="f8cba-242">AllowVnetOutBound</span><span class="sxs-lookup"><span data-stu-id="f8cba-242">AllowVnetOutBound</span></span> | <span data-ttu-id="f8cba-243">65000</span><span class="sxs-lookup"><span data-stu-id="f8cba-243">65000</span></span> | <span data-ttu-id="f8cba-244">Виртуальная сеть</span><span class="sxs-lookup"><span data-stu-id="f8cba-244">VirtualNetwork</span></span> | * | <span data-ttu-id="f8cba-245">Виртуальная сеть</span><span class="sxs-lookup"><span data-stu-id="f8cba-245">VirtualNetwork</span></span> | * | * | <span data-ttu-id="f8cba-246">РАЗРЕШИТЬ</span><span class="sxs-lookup"><span data-stu-id="f8cba-246">Allow</span></span> |
| <span data-ttu-id="f8cba-247">AllowInternetOutBound</span><span class="sxs-lookup"><span data-stu-id="f8cba-247">AllowInternetOutBound</span></span> | <span data-ttu-id="f8cba-248">65001</span><span class="sxs-lookup"><span data-stu-id="f8cba-248">65001</span></span> | * | * | <span data-ttu-id="f8cba-249">Интернет</span><span class="sxs-lookup"><span data-stu-id="f8cba-249">Internet</span></span> | * | * | <span data-ttu-id="f8cba-250">РАЗРЕШИТЬ</span><span class="sxs-lookup"><span data-stu-id="f8cba-250">Allow</span></span> |
| <span data-ttu-id="f8cba-251">DenyAllOutBound</span><span class="sxs-lookup"><span data-stu-id="f8cba-251">DenyAllOutBound</span></span> | <span data-ttu-id="f8cba-252">65500</span><span class="sxs-lookup"><span data-stu-id="f8cba-252">65500</span></span> | * | * | * | * | * | <span data-ttu-id="f8cba-253">ЗАПРЕТИТЬ</span><span class="sxs-lookup"><span data-stu-id="f8cba-253">Deny</span></span> |

## <a name="associating-nsgs"></a><span data-ttu-id="f8cba-254">Связывание групп NSG</span><span class="sxs-lookup"><span data-stu-id="f8cba-254">Associating NSGs</span></span>
<span data-ttu-id="f8cba-255">Можно связать NSG tooVMs, сетевые адаптеры и подсети, в зависимости от модели развертывания hello, которую вы используете, следующим образом:</span><span class="sxs-lookup"><span data-stu-id="f8cba-255">You can associate an NSG tooVMs, NICs, and subnets, depending on hello deployment model you are using, as follows:</span></span>

* <span data-ttu-id="f8cba-256">**Виртуальная машина (классические):** правила безопасности применяются tooall трафика из hello виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="f8cba-256">**VM (classic only):** Security rules are applied tooall traffic to/from hello VM.</span></span> 
* <span data-ttu-id="f8cba-257">**Сетевой Адаптер (только для диспетчера ресурсов):** правила безопасности применяются tooall трафика из сетевого Адаптера hello hello NSG связана с.</span><span class="sxs-lookup"><span data-stu-id="f8cba-257">**NIC (Resource Manager only):** Security rules are applied tooall traffic to/from hello NIC hello NSG is associated to.</span></span> <span data-ttu-id="f8cba-258">На виртуальной машине multi-NIC, можно применить различные (или же hello) NSG tooeach сетевой Адаптер по отдельности.</span><span class="sxs-lookup"><span data-stu-id="f8cba-258">In a multi-NIC VM, you can apply different (or hello same) NSG tooeach NIC individually.</span></span> 
* <span data-ttu-id="f8cba-259">**Подсеть (диспетчера ресурсов и классический):** правила безопасности применяются tooany трафика из все ресурсы подключены toohello виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="f8cba-259">**Subnet (Resource Manager and classic):** Security rules are applied tooany traffic to/from any resources connected toohello VNet.</span></span>

<span data-ttu-id="f8cba-260">Можно связать другой Nsg tooa виртуальной Машины (или сетевой Адаптер, в зависимости от модели развертывания hello) и hello, сетевой Адаптер или виртуальных Машин подключен к подсети.</span><span class="sxs-lookup"><span data-stu-id="f8cba-260">You can associate different NSGs tooa VM (or NIC, depending on hello deployment model) and hello subnet that a NIC or VM is connected to.</span></span> <span data-ttu-id="f8cba-261">Правила безопасности трафика примененных toohello по приоритету, в каждом NSG в hello следуете заказа:</span><span class="sxs-lookup"><span data-stu-id="f8cba-261">Security rules are applied toohello traffic, by priority, in each NSG, in hello following order:</span></span>

- <span data-ttu-id="f8cba-262">**Входящий трафик**</span><span class="sxs-lookup"><span data-stu-id="f8cba-262">**Inbound traffic**</span></span>

  1. <span data-ttu-id="f8cba-263">**NSG применяется toosubnet:** подсети NSG имеет соответствующий трафик toodeny правило, hello отбрасывается.</span><span class="sxs-lookup"><span data-stu-id="f8cba-263">**NSG applied toosubnet:** If a subnet NSG has a matching rule toodeny traffic, hello packet is dropped.</span></span>

  2. <span data-ttu-id="f8cba-264">**NSG применяется tooNIC** (диспетчера ресурсов) или виртуальной Машины (классические): Если NSG VM\NIC имеет соответствующее правило, запрещает трафика, отброшенных пакетов в hello VM\NIC, даже если подсети NSG содержит правила сопоставления, которое разрешает трафик.</span><span class="sxs-lookup"><span data-stu-id="f8cba-264">**NSG applied tooNIC** (Resource Manager) or VM (classic): If VM\NIC NSG has a matching rule that denies traffic, packets are dropped at hello VM\NIC, even if a subnet NSG has a matching rule that allows traffic.</span></span>

- <span data-ttu-id="f8cba-265">**Исходящий трафик**</span><span class="sxs-lookup"><span data-stu-id="f8cba-265">**Outbound traffic**</span></span>

  1. <span data-ttu-id="f8cba-266">**NSG применяется tooNIC** (диспетчера ресурсов) или виртуальной Машины (классические): Если VM\NIC NSG правило сопоставления, которое запрещает трафик, пакеты будут удалены.</span><span class="sxs-lookup"><span data-stu-id="f8cba-266">**NSG applied tooNIC** (Resource Manager) or VM (classic): If a VM\NIC NSG has a matching rule that denies traffic, packets are dropped.</span></span>

  2. <span data-ttu-id="f8cba-267">**NSG применяется toosubnet:** Если подсети NSG содержит правила сопоставления, который запрещает трафик, пакеты будут удалены, даже если VM\NIC NSG содержит правила сопоставления, которое разрешает трафик.</span><span class="sxs-lookup"><span data-stu-id="f8cba-267">**NSG applied toosubnet:** If a subnet NSG has a matching rule that denies traffic, packets are dropped, even if a VM\NIC NSG has a matching rule that allows traffic.</span></span>

> [!NOTE]
> <span data-ttu-id="f8cba-268">Несмотря на то, что можно связать только одну NSG tooa подсети, виртуальной Машины или сетевого Адаптера; можно связать hello же tooas NSG необходимо много ресурсов.</span><span class="sxs-lookup"><span data-stu-id="f8cba-268">Although you can only associate a single NSG tooa subnet, VM, or NIC; you can associate hello same NSG tooas many resources as you want.</span></span>
>

## <a name="implementation"></a><span data-ttu-id="f8cba-269">Реализация</span><span class="sxs-lookup"><span data-stu-id="f8cba-269">Implementation</span></span>
<span data-ttu-id="f8cba-270">Nsg можно реализовать в hello диспетчера ресурсов или классическом развертывании моделей, с помощью hello следующие средства:</span><span class="sxs-lookup"><span data-stu-id="f8cba-270">You can implement NSGs in hello Resource Manager or classic deployment models using hello following tools:</span></span>

| <span data-ttu-id="f8cba-271">Средство развертывания</span><span class="sxs-lookup"><span data-stu-id="f8cba-271">Deployment tool</span></span> | <span data-ttu-id="f8cba-272">Классический</span><span class="sxs-lookup"><span data-stu-id="f8cba-272">Classic</span></span> | <span data-ttu-id="f8cba-273">Диспетчер ресурсов</span><span class="sxs-lookup"><span data-stu-id="f8cba-273">Resource Manager</span></span> |
| --- | --- | --- |
| <span data-ttu-id="f8cba-274">Портал Azure</span><span class="sxs-lookup"><span data-stu-id="f8cba-274">Azure portal</span></span>   | <span data-ttu-id="f8cba-275">Да</span><span class="sxs-lookup"><span data-stu-id="f8cba-275">Yes</span></span> | [<span data-ttu-id="f8cba-276">Да</span><span class="sxs-lookup"><span data-stu-id="f8cba-276">Yes</span></span>](virtual-networks-create-nsg-arm-pportal.md) |
| <span data-ttu-id="f8cba-277">PowerShell</span><span class="sxs-lookup"><span data-stu-id="f8cba-277">PowerShell</span></span>     | [<span data-ttu-id="f8cba-278">Да</span><span class="sxs-lookup"><span data-stu-id="f8cba-278">Yes</span></span>](virtual-networks-create-nsg-classic-ps.md) | [<span data-ttu-id="f8cba-279">Да</span><span class="sxs-lookup"><span data-stu-id="f8cba-279">Yes</span></span>](virtual-networks-create-nsg-arm-ps.md) |
| <span data-ttu-id="f8cba-280">Azure CLI **1.0**</span><span class="sxs-lookup"><span data-stu-id="f8cba-280">Azure CLI **V1**</span></span>   | [<span data-ttu-id="f8cba-281">Да</span><span class="sxs-lookup"><span data-stu-id="f8cba-281">Yes</span></span>](virtual-networks-create-nsg-classic-cli.md) | [<span data-ttu-id="f8cba-282">Да</span><span class="sxs-lookup"><span data-stu-id="f8cba-282">Yes</span></span>](virtual-networks-create-nsg-cli-nodejs.md) |
| <span data-ttu-id="f8cba-283">Azure CLI **2.0**</span><span class="sxs-lookup"><span data-stu-id="f8cba-283">Azure CLI **V2**</span></span>   | <span data-ttu-id="f8cba-284">Нет</span><span class="sxs-lookup"><span data-stu-id="f8cba-284">No</span></span> | [<span data-ttu-id="f8cba-285">Да</span><span class="sxs-lookup"><span data-stu-id="f8cba-285">Yes</span></span>](virtual-networks-create-nsg-arm-cli.md) |
| <span data-ttu-id="f8cba-286">Шаблон диспетчера ресурсов Azure</span><span class="sxs-lookup"><span data-stu-id="f8cba-286">Azure Resource Manager template</span></span>   | <span data-ttu-id="f8cba-287">Нет</span><span class="sxs-lookup"><span data-stu-id="f8cba-287">No</span></span>  | [<span data-ttu-id="f8cba-288">Да</span><span class="sxs-lookup"><span data-stu-id="f8cba-288">Yes</span></span>](virtual-networks-create-nsg-arm-template.md) |

## <a name="planning"></a><span data-ttu-id="f8cba-289">Планирование</span><span class="sxs-lookup"><span data-stu-id="f8cba-289">Planning</span></span>
<span data-ttu-id="f8cba-290">Перед реализацией Nsg, необходимо tooanswer hello следующие вопросы:</span><span class="sxs-lookup"><span data-stu-id="f8cba-290">Before implementing NSGs, you need tooanswer hello following questions:</span></span>

1. <span data-ttu-id="f8cba-291">Какие типы ресурсов действительно toofilter tooor трафика из?</span><span class="sxs-lookup"><span data-stu-id="f8cba-291">What types of resources do you want toofilter traffic tooor from?</span></span> <span data-ttu-id="f8cba-292">Вы можете подключить такие ресурсы, как сетевые интерфейсы (развернутые с помощью Resource Manager), виртуальные машины (классические), облачные службы, среды службы приложений и Масштабируемые наборы ВМ.</span><span class="sxs-lookup"><span data-stu-id="f8cba-292">You can connect resources such as NICs (Resource Manager), VMs (classic), Cloud Services, Application Service Environments, and VM Scale Sets.</span></span> 
2. <span data-ttu-id="f8cba-293">Ресурсы hello требуется toofilter трафика из подключенных toosubnets в существующие виртуальные сети</span><span class="sxs-lookup"><span data-stu-id="f8cba-293">Are hello resources you want toofilter traffic to/from connected toosubnets in existing VNets?</span></span>

<span data-ttu-id="f8cba-294">Дополнительные сведения о планировании безопасности сети в Azure см. в статье hello [облачных служб и сетевая безопасность](../best-practices-network-security.md) статьи.</span><span class="sxs-lookup"><span data-stu-id="f8cba-294">For more information on planning for network security in Azure, read hello [Cloud services and network security](../best-practices-network-security.md) article.</span></span> 

## <a name="design-considerations"></a><span data-ttu-id="f8cba-295">Рекомендации по проектированию</span><span class="sxs-lookup"><span data-stu-id="f8cba-295">Design considerations</span></span>
<span data-ttu-id="f8cba-296">Как только вы устанавливаете hello ответы toohello вопросы в hello [планирование](#Planning) просмотрите hello в следующих разделах, прежде чем определять Nsg:</span><span class="sxs-lookup"><span data-stu-id="f8cba-296">Once you know hello answers toohello questions in hello [Planning](#Planning) section, review hello following sections before defining your NSGs:</span></span>

### <a name="limits"></a><span data-ttu-id="f8cba-297">Ограничения</span><span class="sxs-lookup"><span data-stu-id="f8cba-297">Limits</span></span>
<span data-ttu-id="f8cba-298">Существуют ограничения числа toohello Nsg, что в подписке и правил для NSG.</span><span class="sxs-lookup"><span data-stu-id="f8cba-298">There are limits toohello number of NSGs you can have in a subscription and number of rules per NSG.</span></span> <span data-ttu-id="f8cba-299">Дополнительные об ограничениях hello, чтение hello toolearn [Azure ограничивает](../azure-subscription-service-limits.md#networking-limits) статьи.</span><span class="sxs-lookup"><span data-stu-id="f8cba-299">toolearn more about hello limits, read hello [Azure limits](../azure-subscription-service-limits.md#networking-limits) article.</span></span>

### <a name="vnet-and-subnet-design"></a><span data-ttu-id="f8cba-300">Разработка виртуальных сетей и подсетей</span><span class="sxs-lookup"><span data-stu-id="f8cba-300">VNet and subnet design</span></span>
<span data-ttu-id="f8cba-301">Поскольку Nsg может быть применен toosubnets, можно свести к минимуму число hello Nsg группировки ресурсов в подсети, а затем применяет toosubnets Nsg.</span><span class="sxs-lookup"><span data-stu-id="f8cba-301">Since NSGs can be applied toosubnets, you can minimize hello number of NSGs by grouping your resources by subnet, and applying NSGs toosubnets.</span></span>  <span data-ttu-id="f8cba-302">Если вы решите toosubnets tooapply Nsg, может оказаться, что существующие виртуальные сети и подсетей, к которым у вас есть не определены с Nsg в виду.</span><span class="sxs-lookup"><span data-stu-id="f8cba-302">If you decide tooapply NSGs toosubnets, you may find that existing VNets and subnets you have were not defined with NSGs in mind.</span></span> <span data-ttu-id="f8cba-303">Может требуется toodefine новых виртуальных сетей и подсетей toosupport проекту NSG и развернуть новые ресурсы tooyour новых подсетей.</span><span class="sxs-lookup"><span data-stu-id="f8cba-303">You may need toodefine new VNets and subnets toosupport your NSG design and deploy your new resources tooyour new subnets.</span></span> <span data-ttu-id="f8cba-304">Затем можно определить toomove стратегии миграции существующих ресурсов toohello новых подсетей.</span><span class="sxs-lookup"><span data-stu-id="f8cba-304">You could then define a migration strategy toomove existing resources toohello new subnets.</span></span> 

### <a name="special-rules"></a><span data-ttu-id="f8cba-305">Специальные правила</span><span class="sxs-lookup"><span data-stu-id="f8cba-305">Special rules</span></span>
<span data-ttu-id="f8cba-306">Блокирование трафика, разрешенный по правилам hello инфраструктуры не удается связаться с основных служб Azure:</span><span class="sxs-lookup"><span data-stu-id="f8cba-306">If you block traffic allowed by hello following rules, your infrastructure can't communicate with essential Azure services:</span></span>

* <span data-ttu-id="f8cba-307">**Виртуальный IP-адрес узла hello:** основные службы инфраструктуры, таких как DHCP, DNS и мониторинг работоспособности, предоставляются через hello виртуализированного узла IP-адреса 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="f8cba-307">**Virtual IP of hello host node:** Basic infrastructure services such as DHCP, DNS, and health monitoring are provided through hello virtualized host IP address 168.63.129.16.</span></span> <span data-ttu-id="f8cba-308">Этот общедоступный IP-адрес принадлежит tooMicrosoft и hello только виртуализованных IP-адрес для этой цели используется во всех регионах.</span><span class="sxs-lookup"><span data-stu-id="f8cba-308">This public IP address belongs tooMicrosoft and is hello only virtualized IP address used in all regions for this purpose.</span></span> <span data-ttu-id="f8cba-309">Этот IP-адрес сопоставляется toohello физический IP-адрес компьютера сервера hello (узла) размещение hello виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="f8cba-309">This IP address maps toohello physical IP address of hello server machine (host node) hosting hello VM.</span></span> <span data-ttu-id="f8cba-310">Hello главный узел выступает как hello DHCP-ретранслятора, рекурсивного сопоставителя DNS hello и hello источника зонда для hello нагрузки зонда работоспособности подсистемы балансировки и hello зонда работоспособности компьютера.</span><span class="sxs-lookup"><span data-stu-id="f8cba-310">hello host node acts as hello DHCP relay, hello DNS recursive resolver, and hello probe source for hello load balancer health probe and hello machine health probe.</span></span> <span data-ttu-id="f8cba-311">Связи toothis IP-адрес не атаки.</span><span class="sxs-lookup"><span data-stu-id="f8cba-311">Communication toothis IP address is not an attack.</span></span>
* <span data-ttu-id="f8cba-312">**Лицензирование (служба управления ключами).** Для используемых на виртуальных машинах образов Windows требуется лицензия.</span><span class="sxs-lookup"><span data-stu-id="f8cba-312">**Licensing (Key Management Service):** Windows images running in VMs must be licensed.</span></span> <span data-ttu-id="f8cba-313">tooensure лицензирования, запрос отправляется серверы узла toohello службы управления ключами, которые обрабатывают такие запросы.</span><span class="sxs-lookup"><span data-stu-id="f8cba-313">tooensure licensing, a request is sent toohello Key Management Service host servers that handle such queries.</span></span> <span data-ttu-id="f8cba-314">Hello запрос исходящих через порт 1688.</span><span class="sxs-lookup"><span data-stu-id="f8cba-314">hello request is made outbound through port 1688.</span></span>

### <a name="icmp-traffic"></a><span data-ttu-id="f8cba-315">ICMP-трафик</span><span class="sxs-lookup"><span data-stu-id="f8cba-315">ICMP traffic</span></span>
<span data-ttu-id="f8cba-316">текущие правила NSG Hello разрешают только протоколы *TCP* или *UDP*.</span><span class="sxs-lookup"><span data-stu-id="f8cba-316">hello current NSG rules only allow for protocols *TCP* or *UDP*.</span></span> <span data-ttu-id="f8cba-317">Для протокола *ICMP* нет отдельного тега.</span><span class="sxs-lookup"><span data-stu-id="f8cba-317">There is not a specific tag for *ICMP*.</span></span> <span data-ttu-id="f8cba-318">Однако ICMP-трафика в виртуальной сети правилом hello AllowVNetInBound по умолчанию, которое позволяет tooand трафик из любой порт и протокол hello виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="f8cba-318">However, ICMP traffic is allowed within a VNet by hello AllowVNetInBound default rule, that allows traffic tooand from any port and protocol within hello VNet.</span></span>

### <a name="subnets"></a><span data-ttu-id="f8cba-319">Подсети</span><span class="sxs-lookup"><span data-stu-id="f8cba-319">Subnets</span></span>
* <span data-ttu-id="f8cba-320">Рассмотрите возможность hello число уровней, необходимые для рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="f8cba-320">Consider hello number of tiers your workload requires.</span></span> <span data-ttu-id="f8cba-321">Каждый уровень могут быть изолированы с помощью подсети с подсетью toohello NSG применяется.</span><span class="sxs-lookup"><span data-stu-id="f8cba-321">Each tier can be isolated by using a subnet, with an NSG applied toohello subnet.</span></span> 
* <span data-ttu-id="f8cba-322">Tooimplement подсети для шлюза VPN или канал ExpressRoute, выполните **не** применить подсети toothat NSG.</span><span class="sxs-lookup"><span data-stu-id="f8cba-322">If you need tooimplement a subnet for a VPN gateway, or ExpressRoute circuit, do **not** apply an NSG toothat subnet.</span></span> <span data-ttu-id="f8cba-323">В противном случае при подключении между виртуальными сетями или между локальными сетями может произойти сбой.</span><span class="sxs-lookup"><span data-stu-id="f8cba-323">If you do so, cross-VNet or cross-premises connectivity may fail.</span></span> 
* <span data-ttu-id="f8cba-324">При необходимости tooimplement устройство виртуальной сети (Уязвимости) подключения подсети собственный tooits Уязвимости hello и создания определяемых пользователем маршрутов (UDR) tooand из hello Уязвимости.</span><span class="sxs-lookup"><span data-stu-id="f8cba-324">If you need tooimplement a network virtual appliance (NVA), connect hello NVA tooits own subnet and create user-defined routes (UDR) tooand from hello NVA.</span></span> <span data-ttu-id="f8cba-325">Вы можете реализовать уровень подсети трафика toofilter NSG и из него этой подсети.</span><span class="sxs-lookup"><span data-stu-id="f8cba-325">You can implement a subnet level NSG toofilter traffic in and out of this subnet.</span></span> <span data-ttu-id="f8cba-326">Дополнительные сведения о UDRs, чтение hello toolearn [определяемых пользователем маршрутов](virtual-networks-udr-overview.md) статьи.</span><span class="sxs-lookup"><span data-stu-id="f8cba-326">toolearn more about UDRs, read hello [User-defined routes](virtual-networks-udr-overview.md) article.</span></span>

### <a name="load-balancers"></a><span data-ttu-id="f8cba-327">Балансировщики нагрузки</span><span class="sxs-lookup"><span data-stu-id="f8cba-327">Load balancers</span></span>
* <span data-ttu-id="f8cba-328">Учитывайте hello нагрузки балансировки и сетевой адрес правила преобразования Сетевых адресов для каждой подсистемы балансировки нагрузки, используемых каждым из рабочих нагрузок.</span><span class="sxs-lookup"><span data-stu-id="f8cba-328">Consider hello load balancing and network address translation (NAT) rules for each load balancer used by each of your workloads.</span></span> <span data-ttu-id="f8cba-329">Правила NAT, пул связанных tooa серверной части, который содержит сетевые адаптеры (диспетчера ресурсов) или экземпляров ролей виртуальных машин и облачных служб (классические).</span><span class="sxs-lookup"><span data-stu-id="f8cba-329">NAT rules are bound tooa back-end pool that contains NICs (Resource Manager) or VMs/Cloud Services role instances (classic).</span></span> <span data-ttu-id="f8cba-330">Рассмотрите возможность создания NSG для каждого пула серверной части, позволяя трафик только сопоставляться с помощью правила hello, реализованные в hello подсистемы балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="f8cba-330">Consider creating an NSG for each back-end pool, allowing only traffic mapped through hello rules implemented in hello load balancers.</span></span> <span data-ttu-id="f8cba-331">Создание NSG для каждого пула серверной части гарантирует трафик, поступающий toohello внутреннем пуле непосредственно (а не через hello балансировки нагрузки), также фильтруется.</span><span class="sxs-lookup"><span data-stu-id="f8cba-331">Creating an NSG for each back-end pool guarantees that traffic coming toohello back-end pool directly (rather than through hello load balancer), is also filtered.</span></span>
* <span data-ttu-id="f8cba-332">В классическом развертываниях создать конечные точки, соответствующие порты на tooports подсистемы балансировки нагрузки на виртуальных машинах или экземпляров ролей.</span><span class="sxs-lookup"><span data-stu-id="f8cba-332">In classic deployments, you create endpoints that map ports on a load balancer tooports on your VMs or role instances.</span></span> <span data-ttu-id="f8cba-333">Можно также создать собственный отдельный общедоступный балансировщик нагрузки в развертывании с помощью Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="f8cba-333">You can also create your own individual public-facing load balancer through Resource Manager.</span></span> <span data-ttu-id="f8cba-334">порт назначения Hello входящий трафик: hello действительный порт hello виртуальной Машины или экземпляра роли, а не порт hello, предоставляемых подсистемой балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="f8cba-334">hello destination port for incoming traffic is hello actual port in hello VM or role instance, not hello port exposed by a load balancer.</span></span> <span data-ttu-id="f8cba-335">Hello исходный порт и адрес для toohello hello подключения виртуальной Машины находится на порте и адресе hello удаленного компьютера в Интернет hello, а не порт hello и адреса, предоставляемые hello подсистемы балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="f8cba-335">hello source port and address for hello connection toohello VM is a port and address on hello remote computer in hello Internet, not hello port and address exposed by hello load balancer.</span></span>
* <span data-ttu-id="f8cba-336">При создании Nsg toofilter трафик, поступающий через внутренний балансировщик нагрузки (ILB) hello исходного порта и адрес диапазона применения принадлежат hello исходному компьютеру hello балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="f8cba-336">When you create NSGs toofilter traffic coming through an internal load balancer (ILB), hello source port and address range applied are  from hello originating computer, not hello load balancer.</span></span> <span data-ttu-id="f8cba-337">диапазон портов и адреса назначения Hello зависят от целевого компьютера hello, hello балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="f8cba-337">hello destination port and address range are those of hello destination computer, not hello load balancer.</span></span>

### <a name="other"></a><span data-ttu-id="f8cba-338">Другие</span><span class="sxs-lookup"><span data-stu-id="f8cba-338">Other</span></span>
* <span data-ttu-id="f8cba-339">На основе конечной точки управления доступом (ACL) и Nsg не поддерживаются на hello того же экземпляра виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="f8cba-339">Endpoint-based access control lists (ACL) and NSGs are not supported on hello same VM instance.</span></span> <span data-ttu-id="f8cba-340">Toouse NSG и уже иметь конечную точку ACL на месте, необходимо сначала удалите конечную точку hello ACL.</span><span class="sxs-lookup"><span data-stu-id="f8cba-340">If you want toouse an NSG and have an endpoint ACL already in place, first remove hello endpoint ACL.</span></span> <span data-ttu-id="f8cba-341">Сведения о том, как tooremove ACL, конечной точки в разделе hello [управление списки ACL конечной точки](virtual-networks-acl-powershell.md) статьи.</span><span class="sxs-lookup"><span data-stu-id="f8cba-341">For information about how tooremove an endpoint ACL, see hello [Manage endpoint ACLs](virtual-networks-acl-powershell.md) article.</span></span>
* <span data-ttu-id="f8cba-342">В диспетчере ресурсов можно использовать NSG связанные tooa сетевой Адаптер для виртуальных машин с tooenable управления нескольких сетевых адаптеров (удаленный доступ) на основе каждого сетевого Адаптера.</span><span class="sxs-lookup"><span data-stu-id="f8cba-342">In Resource Manager, you can use an NSG associated tooa NIC for VMs with multiple NICs tooenable management (remote access) on a per NIC basis.</span></span> <span data-ttu-id="f8cba-343">Сопоставление уникальных Nsg tooeach сетевого Адаптера позволяет разделение типов трафика через сетевые адаптеры.</span><span class="sxs-lookup"><span data-stu-id="f8cba-343">Associating unique NSGs tooeach NIC enables separation of traffic types across NICs.</span></span>
* <span data-ttu-id="f8cba-344">Аналогичные toohello использование подсистемы балансировки нагрузки, при фильтрации трафика от других виртуальных сетей, необходимо использовать диапазон адресов источника hello hello удаленного компьютера, не hello шлюз подключение hello виртуальных сетей.</span><span class="sxs-lookup"><span data-stu-id="f8cba-344">Similar toohello use of load balancers, when filtering traffic from other VNets, you must use hello source address range of hello remote computer, not hello gateway connecting hello VNets.</span></span>
* <span data-ttu-id="f8cba-345">Многие службы Azure не может быть подключенным tooVNets.</span><span class="sxs-lookup"><span data-stu-id="f8cba-345">Many Azure services cannot be connected tooVNets.</span></span> <span data-ttu-id="f8cba-346">Если ресурс Azure не подключенных tooa виртуальной сети, нельзя использовать ресурс toohello NSG toofilter трафика.</span><span class="sxs-lookup"><span data-stu-id="f8cba-346">If an Azure resource is not connected tooa VNet, you cannot use an NSG toofilter traffic toohello resource.</span></span>  <span data-ttu-id="f8cba-347">Ознакомьтесь с документацией hello hello служб используйте toodetermine ли hello служба может быть подключенным tooa виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="f8cba-347">Read hello documentation for hello services you use toodetermine whether hello service can be connected tooa VNet.</span></span>

## <a name="sample-deployment"></a><span data-ttu-id="f8cba-348">Пример развертывания</span><span class="sxs-lookup"><span data-stu-id="f8cba-348">Sample deployment</span></span>
<span data-ttu-id="f8cba-349">приложение hello tooillustrate hello сведения в этой статье рассмотрим распространенный сценарий два уровня приложения, показано в следующий рисунок hello.</span><span class="sxs-lookup"><span data-stu-id="f8cba-349">tooillustrate hello application of hello information in this article, consider a common scenario of a two tier application shown in hello following picture:</span></span>

![Группы NSG](./media/virtual-network-nsg-overview/figure1.png)

<span data-ttu-id="f8cba-351">Здравствуйте, как показано на схеме hello *Web1* и *Web2* виртуальных машин, подключенных toohello *переднего плана* подсети и hello *DB1* и *DB2* виртуальных машин, подключенных toohello *серверной* подсети.</span><span class="sxs-lookup"><span data-stu-id="f8cba-351">As shown in hello diagram, hello *Web1* and *Web2* VMs are connected toohello *FrontEnd* subnet, and hello *DB1* and *DB2* VMs are connected toohello *BackEnd* subnet.</span></span>  <span data-ttu-id="f8cba-352">Оба подсетей являются частью hello *TestVNet* виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="f8cba-352">Both subnets are part of hello *TestVNet* VNet.</span></span> <span data-ttu-id="f8cba-353">Hello компоненты приложения каждого выполняться в Azure виртуальная машина подключена tooa виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="f8cba-353">hello application components each run within an Azure VM connected tooa VNet.</span></span> <span data-ttu-id="f8cba-354">сценарий Hello имеет hello следующие требования:</span><span class="sxs-lookup"><span data-stu-id="f8cba-354">hello scenario has hello following requirements:</span></span>

1. <span data-ttu-id="f8cba-355">Разделение трафика между hello WEB и серверами базы данных.</span><span class="sxs-lookup"><span data-stu-id="f8cba-355">Separation of traffic between hello WEB and DB servers.</span></span>
2. <span data-ttu-id="f8cba-356">Правила перенаправлял трафик от hello нагрузки балансировки tooall веб-серверов на порт 80 балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="f8cba-356">Load balancing rules forward traffic from hello load balancer tooall web servers on port 80.</span></span>
3. <span data-ttu-id="f8cba-357">Загрузить балансировки NAT правила прямого трафика, поступающего в hello балансировки нагрузки на 50001 tooport порт 3389 на hello WEB1 виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="f8cba-357">Load balancer NAT rules forward traffic coming into hello load balancer on port 50001 tooport 3389 on hello WEB1 VM.</span></span>
4. <span data-ttu-id="f8cba-358">Нет доступа к toohello переднего плана и серверный виртуальных машин из hello Интернет, за исключением требований 2 и 3.</span><span class="sxs-lookup"><span data-stu-id="f8cba-358">No access toohello front-end or back-end VMs from hello Internet, except requirements 2 and 3.</span></span>
5. <span data-ttu-id="f8cba-359">Нет исходящие подключения к Интернету с hello базы данных или веб-серверов.</span><span class="sxs-lookup"><span data-stu-id="f8cba-359">No outbound Internet access from hello WEB or DB servers.</span></span>
6. <span data-ttu-id="f8cba-360">Доступ из внешней подсети hello разрешен tooport 3389 любой веб-сервера.</span><span class="sxs-lookup"><span data-stu-id="f8cba-360">Access from hello FrontEnd subnet is allowed tooport 3389 of any web server.</span></span>
7. <span data-ttu-id="f8cba-361">Доступ из внешней подсети hello разрешен tooport 3389 любого сервера базы данных.</span><span class="sxs-lookup"><span data-stu-id="f8cba-361">Access from hello FrontEnd subnet is allowed tooport 3389 of any DB server.</span></span>
8. <span data-ttu-id="f8cba-362">Доступ из внешней подсети hello разрешен tooport 1433 всех серверов базы данных.</span><span class="sxs-lookup"><span data-stu-id="f8cba-362">Access from hello FrontEnd subnet is allowed tooport 1433 of all DB servers.</span></span>
9. <span data-ttu-id="f8cba-363">Разделение трафика управления (порт 3389) и трафика базы данных (1433) на разные сетевые интерфейсы на серверах баз данных.</span><span class="sxs-lookup"><span data-stu-id="f8cba-363">Separation of management traffic (port 3389) and database traffic (1433) on different NICs in DB servers.</span></span>

<span data-ttu-id="f8cba-364">1-6 (за исключением требования 3 и 4) требуются все пропущенные toosubnet пробелы.</span><span class="sxs-lookup"><span data-stu-id="f8cba-364">Requirements 1-6 (except requirements 3 and 4) are all confined toosubnet spaces.</span></span> <span data-ttu-id="f8cba-365">Hello следующие Nsg требованиям hello предыдущего, сводя к минимуму число hello Nsg требуется:</span><span class="sxs-lookup"><span data-stu-id="f8cba-365">hello following NSGs meet hello previous requirements, while minimizing hello number of NSGs required:</span></span>

### <a name="frontend"></a><span data-ttu-id="f8cba-366">FrontEnd</span><span class="sxs-lookup"><span data-stu-id="f8cba-366">FrontEnd</span></span>
<span data-ttu-id="f8cba-367">**Правила для входящего трафика**</span><span class="sxs-lookup"><span data-stu-id="f8cba-367">**Inbound rules**</span></span>

| <span data-ttu-id="f8cba-368">правило;</span><span class="sxs-lookup"><span data-stu-id="f8cba-368">Rule</span></span> | <span data-ttu-id="f8cba-369">Access</span><span class="sxs-lookup"><span data-stu-id="f8cba-369">Access</span></span> | <span data-ttu-id="f8cba-370">Приоритет</span><span class="sxs-lookup"><span data-stu-id="f8cba-370">Priority</span></span> | <span data-ttu-id="f8cba-371">Диапазон адресов источника</span><span class="sxs-lookup"><span data-stu-id="f8cba-371">Source address range</span></span> | <span data-ttu-id="f8cba-372">Исходный порт</span><span class="sxs-lookup"><span data-stu-id="f8cba-372">Source port</span></span> | <span data-ttu-id="f8cba-373">Диапазон адресов назначения</span><span class="sxs-lookup"><span data-stu-id="f8cba-373">Destination address range</span></span> | <span data-ttu-id="f8cba-374">Конечный порт</span><span class="sxs-lookup"><span data-stu-id="f8cba-374">Destination port</span></span> | <span data-ttu-id="f8cba-375">Протокол</span><span class="sxs-lookup"><span data-stu-id="f8cba-375">Protocol</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="f8cba-376">Allow-Inbound-HTTP-Internet</span><span class="sxs-lookup"><span data-stu-id="f8cba-376">Allow-Inbound-HTTP-Internet</span></span> | <span data-ttu-id="f8cba-377">РАЗРЕШИТЬ</span><span class="sxs-lookup"><span data-stu-id="f8cba-377">Allow</span></span> | <span data-ttu-id="f8cba-378">100</span><span class="sxs-lookup"><span data-stu-id="f8cba-378">100</span></span> | <span data-ttu-id="f8cba-379">Интернет</span><span class="sxs-lookup"><span data-stu-id="f8cba-379">Internet</span></span> | * | * | <span data-ttu-id="f8cba-380">80</span><span class="sxs-lookup"><span data-stu-id="f8cba-380">80</span></span> | <span data-ttu-id="f8cba-381">TCP</span><span class="sxs-lookup"><span data-stu-id="f8cba-381">TCP</span></span> |
| <span data-ttu-id="f8cba-382">Allow-Inbound-RDP-Internet</span><span class="sxs-lookup"><span data-stu-id="f8cba-382">Allow-Inbound-RDP-Internet</span></span> | <span data-ttu-id="f8cba-383">РАЗРЕШИТЬ</span><span class="sxs-lookup"><span data-stu-id="f8cba-383">Allow</span></span> | <span data-ttu-id="f8cba-384">200</span><span class="sxs-lookup"><span data-stu-id="f8cba-384">200</span></span> | <span data-ttu-id="f8cba-385">Интернет</span><span class="sxs-lookup"><span data-stu-id="f8cba-385">Internet</span></span> | * | * | <span data-ttu-id="f8cba-386">3389</span><span class="sxs-lookup"><span data-stu-id="f8cba-386">3389</span></span> | <span data-ttu-id="f8cba-387">TCP</span><span class="sxs-lookup"><span data-stu-id="f8cba-387">TCP</span></span> |
| <span data-ttu-id="f8cba-388">Deny-Inbound-All</span><span class="sxs-lookup"><span data-stu-id="f8cba-388">Deny-Inbound-All</span></span> | <span data-ttu-id="f8cba-389">ЗАПРЕТИТЬ</span><span class="sxs-lookup"><span data-stu-id="f8cba-389">Deny</span></span> | <span data-ttu-id="f8cba-390">300</span><span class="sxs-lookup"><span data-stu-id="f8cba-390">300</span></span> | <span data-ttu-id="f8cba-391">Интернет</span><span class="sxs-lookup"><span data-stu-id="f8cba-391">Internet</span></span> | * | * | * | <span data-ttu-id="f8cba-392">TCP</span><span class="sxs-lookup"><span data-stu-id="f8cba-392">TCP</span></span> |

<span data-ttu-id="f8cba-393">**Правила для исходящего трафика**</span><span class="sxs-lookup"><span data-stu-id="f8cba-393">**Outbound rules**</span></span>

| <span data-ttu-id="f8cba-394">правило;</span><span class="sxs-lookup"><span data-stu-id="f8cba-394">Rule</span></span> | <span data-ttu-id="f8cba-395">Access</span><span class="sxs-lookup"><span data-stu-id="f8cba-395">Access</span></span> | <span data-ttu-id="f8cba-396">Приоритет</span><span class="sxs-lookup"><span data-stu-id="f8cba-396">Priority</span></span> | <span data-ttu-id="f8cba-397">Диапазон адресов источника</span><span class="sxs-lookup"><span data-stu-id="f8cba-397">Source address range</span></span> | <span data-ttu-id="f8cba-398">Исходный порт</span><span class="sxs-lookup"><span data-stu-id="f8cba-398">Source port</span></span> | <span data-ttu-id="f8cba-399">Диапазон адресов назначения</span><span class="sxs-lookup"><span data-stu-id="f8cba-399">Destination address range</span></span> | <span data-ttu-id="f8cba-400">Конечный порт</span><span class="sxs-lookup"><span data-stu-id="f8cba-400">Destination port</span></span> | <span data-ttu-id="f8cba-401">Протокол</span><span class="sxs-lookup"><span data-stu-id="f8cba-401">Protocol</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="f8cba-402">Deny-Internet-All</span><span class="sxs-lookup"><span data-stu-id="f8cba-402">Deny-Internet-All</span></span> |<span data-ttu-id="f8cba-403">ЗАПРЕТИТЬ</span><span class="sxs-lookup"><span data-stu-id="f8cba-403">Deny</span></span> |<span data-ttu-id="f8cba-404">100</span><span class="sxs-lookup"><span data-stu-id="f8cba-404">100</span></span> | * | * | <span data-ttu-id="f8cba-405">Интернет</span><span class="sxs-lookup"><span data-stu-id="f8cba-405">Internet</span></span> | * | * |

### <a name="backend"></a><span data-ttu-id="f8cba-406">BackEnd</span><span class="sxs-lookup"><span data-stu-id="f8cba-406">BackEnd</span></span>
<span data-ttu-id="f8cba-407">**Правила для входящего трафика**</span><span class="sxs-lookup"><span data-stu-id="f8cba-407">**Inbound rules**</span></span>

| <span data-ttu-id="f8cba-408">правило;</span><span class="sxs-lookup"><span data-stu-id="f8cba-408">Rule</span></span> | <span data-ttu-id="f8cba-409">Access</span><span class="sxs-lookup"><span data-stu-id="f8cba-409">Access</span></span> | <span data-ttu-id="f8cba-410">Приоритет</span><span class="sxs-lookup"><span data-stu-id="f8cba-410">Priority</span></span> | <span data-ttu-id="f8cba-411">Диапазон адресов источника</span><span class="sxs-lookup"><span data-stu-id="f8cba-411">Source address range</span></span> | <span data-ttu-id="f8cba-412">Исходный порт</span><span class="sxs-lookup"><span data-stu-id="f8cba-412">Source port</span></span> | <span data-ttu-id="f8cba-413">Диапазон адресов назначения</span><span class="sxs-lookup"><span data-stu-id="f8cba-413">Destination address range</span></span> | <span data-ttu-id="f8cba-414">Конечный порт</span><span class="sxs-lookup"><span data-stu-id="f8cba-414">Destination port</span></span> | <span data-ttu-id="f8cba-415">Протокол</span><span class="sxs-lookup"><span data-stu-id="f8cba-415">Protocol</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="f8cba-416">Deny-Internet-All</span><span class="sxs-lookup"><span data-stu-id="f8cba-416">Deny-Internet-All</span></span> | <span data-ttu-id="f8cba-417">ЗАПРЕТИТЬ</span><span class="sxs-lookup"><span data-stu-id="f8cba-417">Deny</span></span> | <span data-ttu-id="f8cba-418">100</span><span class="sxs-lookup"><span data-stu-id="f8cba-418">100</span></span> | <span data-ttu-id="f8cba-419">Интернет</span><span class="sxs-lookup"><span data-stu-id="f8cba-419">Internet</span></span> | * | * | * | * |

<span data-ttu-id="f8cba-420">**Правила для исходящего трафика**</span><span class="sxs-lookup"><span data-stu-id="f8cba-420">**Outbound rules**</span></span>

| <span data-ttu-id="f8cba-421">правило;</span><span class="sxs-lookup"><span data-stu-id="f8cba-421">Rule</span></span> | <span data-ttu-id="f8cba-422">Access</span><span class="sxs-lookup"><span data-stu-id="f8cba-422">Access</span></span> | <span data-ttu-id="f8cba-423">Приоритет</span><span class="sxs-lookup"><span data-stu-id="f8cba-423">Priority</span></span> | <span data-ttu-id="f8cba-424">Диапазон адресов источника</span><span class="sxs-lookup"><span data-stu-id="f8cba-424">Source address range</span></span> | <span data-ttu-id="f8cba-425">Исходный порт</span><span class="sxs-lookup"><span data-stu-id="f8cba-425">Source port</span></span> | <span data-ttu-id="f8cba-426">Диапазон адресов назначения</span><span class="sxs-lookup"><span data-stu-id="f8cba-426">Destination address range</span></span> | <span data-ttu-id="f8cba-427">Конечный порт</span><span class="sxs-lookup"><span data-stu-id="f8cba-427">Destination port</span></span> | <span data-ttu-id="f8cba-428">Протокол</span><span class="sxs-lookup"><span data-stu-id="f8cba-428">Protocol</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="f8cba-429">Deny-Internet-All</span><span class="sxs-lookup"><span data-stu-id="f8cba-429">Deny-Internet-All</span></span> | <span data-ttu-id="f8cba-430">ЗАПРЕТИТЬ</span><span class="sxs-lookup"><span data-stu-id="f8cba-430">Deny</span></span> | <span data-ttu-id="f8cba-431">100</span><span class="sxs-lookup"><span data-stu-id="f8cba-431">100</span></span> | * | * | <span data-ttu-id="f8cba-432">Интернет</span><span class="sxs-lookup"><span data-stu-id="f8cba-432">Internet</span></span> | * | * |

<span data-ttu-id="f8cba-433">Hello следующие Nsg создаются и связанных tooNICs в hello следующих виртуальных машин:</span><span class="sxs-lookup"><span data-stu-id="f8cba-433">hello following NSGs are created and associated tooNICs in hello following VMs:</span></span>

### <a name="web1"></a><span data-ttu-id="f8cba-434">WEB1</span><span class="sxs-lookup"><span data-stu-id="f8cba-434">WEB1</span></span>
<span data-ttu-id="f8cba-435">**Правила для входящего трафика**</span><span class="sxs-lookup"><span data-stu-id="f8cba-435">**Inbound rules**</span></span>

| <span data-ttu-id="f8cba-436">правило;</span><span class="sxs-lookup"><span data-stu-id="f8cba-436">Rule</span></span> | <span data-ttu-id="f8cba-437">Access</span><span class="sxs-lookup"><span data-stu-id="f8cba-437">Access</span></span> | <span data-ttu-id="f8cba-438">Приоритет</span><span class="sxs-lookup"><span data-stu-id="f8cba-438">Priority</span></span> | <span data-ttu-id="f8cba-439">Диапазон адресов источника</span><span class="sxs-lookup"><span data-stu-id="f8cba-439">Source address range</span></span> | <span data-ttu-id="f8cba-440">Исходный порт</span><span class="sxs-lookup"><span data-stu-id="f8cba-440">Source port</span></span> | <span data-ttu-id="f8cba-441">Диапазон адресов назначения</span><span class="sxs-lookup"><span data-stu-id="f8cba-441">Destination address range</span></span> | <span data-ttu-id="f8cba-442">Конечный порт</span><span class="sxs-lookup"><span data-stu-id="f8cba-442">Destination port</span></span> | <span data-ttu-id="f8cba-443">Протокол</span><span class="sxs-lookup"><span data-stu-id="f8cba-443">Protocol</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="f8cba-444">Allow-Inbound-RDP-Internet</span><span class="sxs-lookup"><span data-stu-id="f8cba-444">Allow-Inbound-RDP-Internet</span></span> | <span data-ttu-id="f8cba-445">РАЗРЕШИТЬ</span><span class="sxs-lookup"><span data-stu-id="f8cba-445">Allow</span></span> | <span data-ttu-id="f8cba-446">100</span><span class="sxs-lookup"><span data-stu-id="f8cba-446">100</span></span> | <span data-ttu-id="f8cba-447">Интернет</span><span class="sxs-lookup"><span data-stu-id="f8cba-447">Internet</span></span> | * | * | <span data-ttu-id="f8cba-448">3389</span><span class="sxs-lookup"><span data-stu-id="f8cba-448">3389</span></span> | <span data-ttu-id="f8cba-449">TCP</span><span class="sxs-lookup"><span data-stu-id="f8cba-449">TCP</span></span> |
| <span data-ttu-id="f8cba-450">Allow-Inbound-HTTP-Internet</span><span class="sxs-lookup"><span data-stu-id="f8cba-450">Allow-Inbound-HTTP-Internet</span></span> | <span data-ttu-id="f8cba-451">РАЗРЕШИТЬ</span><span class="sxs-lookup"><span data-stu-id="f8cba-451">Allow</span></span> | <span data-ttu-id="f8cba-452">200</span><span class="sxs-lookup"><span data-stu-id="f8cba-452">200</span></span> | <span data-ttu-id="f8cba-453">Интернет</span><span class="sxs-lookup"><span data-stu-id="f8cba-453">Internet</span></span> | * | * | <span data-ttu-id="f8cba-454">80</span><span class="sxs-lookup"><span data-stu-id="f8cba-454">80</span></span> | <span data-ttu-id="f8cba-455">TCP</span><span class="sxs-lookup"><span data-stu-id="f8cba-455">TCP</span></span> |

> [!NOTE]
> <span data-ttu-id="f8cba-456">диапазон адресов Hello источника для hello предыдущими правилами **Internet**, не hello виртуальный IP-адрес для hello подсистемы балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="f8cba-456">hello source address range for hello previous rules is **Internet**, not hello virtual IP address of for hello load balancer.</span></span> <span data-ttu-id="f8cba-457">исходный порт Hello *, не 500001.</span><span class="sxs-lookup"><span data-stu-id="f8cba-457">hello source port is *, not 500001.</span></span> <span data-ttu-id="f8cba-458">Правила NAT для подсистем балансировки нагрузки не являются hello то же, что правила безопасности NSG.</span><span class="sxs-lookup"><span data-stu-id="f8cba-458">NAT rules for load balancers are not hello same as NSG security rules.</span></span> <span data-ttu-id="f8cba-459">Правила NSG безопасности всегда являются связанные toohello исходного источника и конечной точкой назначения для трафика, **не** hello балансировки нагрузки между двумя hello.</span><span class="sxs-lookup"><span data-stu-id="f8cba-459">NSG security rules are always related toohello original source and final destination of traffic, **not** hello load balancer between hello two.</span></span> 
> 
> 

### <a name="web2"></a><span data-ttu-id="f8cba-460">WEB2</span><span class="sxs-lookup"><span data-stu-id="f8cba-460">WEB2</span></span>
<span data-ttu-id="f8cba-461">**Правила для входящего трафика**</span><span class="sxs-lookup"><span data-stu-id="f8cba-461">**Inbound rules**</span></span>

| <span data-ttu-id="f8cba-462">правило;</span><span class="sxs-lookup"><span data-stu-id="f8cba-462">Rule</span></span> | <span data-ttu-id="f8cba-463">Access</span><span class="sxs-lookup"><span data-stu-id="f8cba-463">Access</span></span> | <span data-ttu-id="f8cba-464">Приоритет</span><span class="sxs-lookup"><span data-stu-id="f8cba-464">Priority</span></span> | <span data-ttu-id="f8cba-465">Диапазон адресов источника</span><span class="sxs-lookup"><span data-stu-id="f8cba-465">Source address range</span></span> | <span data-ttu-id="f8cba-466">Исходный порт</span><span class="sxs-lookup"><span data-stu-id="f8cba-466">Source port</span></span> | <span data-ttu-id="f8cba-467">Диапазон адресов назначения</span><span class="sxs-lookup"><span data-stu-id="f8cba-467">Destination address range</span></span> | <span data-ttu-id="f8cba-468">Конечный порт</span><span class="sxs-lookup"><span data-stu-id="f8cba-468">Destination port</span></span> | <span data-ttu-id="f8cba-469">Протокол</span><span class="sxs-lookup"><span data-stu-id="f8cba-469">Protocol</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="f8cba-470">Deny-Inbound-RDP-Internet</span><span class="sxs-lookup"><span data-stu-id="f8cba-470">Deny-Inbound-RDP-Internet</span></span> | <span data-ttu-id="f8cba-471">ЗАПРЕТИТЬ</span><span class="sxs-lookup"><span data-stu-id="f8cba-471">Deny</span></span> | <span data-ttu-id="f8cba-472">100</span><span class="sxs-lookup"><span data-stu-id="f8cba-472">100</span></span> | <span data-ttu-id="f8cba-473">Интернет</span><span class="sxs-lookup"><span data-stu-id="f8cba-473">Internet</span></span> | * | * | <span data-ttu-id="f8cba-474">3389</span><span class="sxs-lookup"><span data-stu-id="f8cba-474">3389</span></span> | <span data-ttu-id="f8cba-475">TCP</span><span class="sxs-lookup"><span data-stu-id="f8cba-475">TCP</span></span> |
| <span data-ttu-id="f8cba-476">Allow-Inbound-HTTP-Internet</span><span class="sxs-lookup"><span data-stu-id="f8cba-476">Allow-Inbound-HTTP-Internet</span></span> | <span data-ttu-id="f8cba-477">РАЗРЕШИТЬ</span><span class="sxs-lookup"><span data-stu-id="f8cba-477">Allow</span></span> | <span data-ttu-id="f8cba-478">200</span><span class="sxs-lookup"><span data-stu-id="f8cba-478">200</span></span> | <span data-ttu-id="f8cba-479">Интернет</span><span class="sxs-lookup"><span data-stu-id="f8cba-479">Internet</span></span> | * | * | <span data-ttu-id="f8cba-480">80</span><span class="sxs-lookup"><span data-stu-id="f8cba-480">80</span></span> | <span data-ttu-id="f8cba-481">TCP</span><span class="sxs-lookup"><span data-stu-id="f8cba-481">TCP</span></span> |

### <a name="db-servers-management-nic"></a><span data-ttu-id="f8cba-482">Серверы баз данных (сетевой интерфейс управления)</span><span class="sxs-lookup"><span data-stu-id="f8cba-482">DB servers (Management NIC)</span></span>
<span data-ttu-id="f8cba-483">**Правила для входящего трафика**</span><span class="sxs-lookup"><span data-stu-id="f8cba-483">**Inbound rules**</span></span>

| <span data-ttu-id="f8cba-484">правило;</span><span class="sxs-lookup"><span data-stu-id="f8cba-484">Rule</span></span> | <span data-ttu-id="f8cba-485">Access</span><span class="sxs-lookup"><span data-stu-id="f8cba-485">Access</span></span> | <span data-ttu-id="f8cba-486">Приоритет</span><span class="sxs-lookup"><span data-stu-id="f8cba-486">Priority</span></span> | <span data-ttu-id="f8cba-487">Диапазон адресов источника</span><span class="sxs-lookup"><span data-stu-id="f8cba-487">Source address range</span></span> | <span data-ttu-id="f8cba-488">Исходный порт</span><span class="sxs-lookup"><span data-stu-id="f8cba-488">Source port</span></span> | <span data-ttu-id="f8cba-489">Диапазон адресов назначения</span><span class="sxs-lookup"><span data-stu-id="f8cba-489">Destination address range</span></span> | <span data-ttu-id="f8cba-490">Конечный порт</span><span class="sxs-lookup"><span data-stu-id="f8cba-490">Destination port</span></span> | <span data-ttu-id="f8cba-491">Протокол</span><span class="sxs-lookup"><span data-stu-id="f8cba-491">Protocol</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="f8cba-492">Allow-Inbound-RDP-Front-end</span><span class="sxs-lookup"><span data-stu-id="f8cba-492">Allow-Inbound-RDP-Front-end</span></span> | <span data-ttu-id="f8cba-493">РАЗРЕШИТЬ</span><span class="sxs-lookup"><span data-stu-id="f8cba-493">Allow</span></span> | <span data-ttu-id="f8cba-494">100</span><span class="sxs-lookup"><span data-stu-id="f8cba-494">100</span></span> | <span data-ttu-id="f8cba-495">192.168.1.0/24</span><span class="sxs-lookup"><span data-stu-id="f8cba-495">192.168.1.0/24</span></span> | * | * | <span data-ttu-id="f8cba-496">3389</span><span class="sxs-lookup"><span data-stu-id="f8cba-496">3389</span></span> | <span data-ttu-id="f8cba-497">TCP</span><span class="sxs-lookup"><span data-stu-id="f8cba-497">TCP</span></span> |

### <a name="db-servers-database-traffic-nic"></a><span data-ttu-id="f8cba-498">Серверы баз данных (сетевой интерфейс трафика базы данных)</span><span class="sxs-lookup"><span data-stu-id="f8cba-498">DB servers (Database traffic NIC)</span></span>
<span data-ttu-id="f8cba-499">**Правила для входящего трафика**</span><span class="sxs-lookup"><span data-stu-id="f8cba-499">**Inbound rules**</span></span>

| <span data-ttu-id="f8cba-500">правило;</span><span class="sxs-lookup"><span data-stu-id="f8cba-500">Rule</span></span> | <span data-ttu-id="f8cba-501">Access</span><span class="sxs-lookup"><span data-stu-id="f8cba-501">Access</span></span> | <span data-ttu-id="f8cba-502">Приоритет</span><span class="sxs-lookup"><span data-stu-id="f8cba-502">Priority</span></span> | <span data-ttu-id="f8cba-503">Диапазон адресов источника</span><span class="sxs-lookup"><span data-stu-id="f8cba-503">Source address range</span></span> | <span data-ttu-id="f8cba-504">Исходный порт</span><span class="sxs-lookup"><span data-stu-id="f8cba-504">Source port</span></span> | <span data-ttu-id="f8cba-505">Диапазон адресов назначения</span><span class="sxs-lookup"><span data-stu-id="f8cba-505">Destination address range</span></span> | <span data-ttu-id="f8cba-506">Конечный порт</span><span class="sxs-lookup"><span data-stu-id="f8cba-506">Destination port</span></span> | <span data-ttu-id="f8cba-507">Протокол</span><span class="sxs-lookup"><span data-stu-id="f8cba-507">Protocol</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="f8cba-508">Allow-Inbound-SQL-Front-end</span><span class="sxs-lookup"><span data-stu-id="f8cba-508">Allow-Inbound-SQL-Front-end</span></span> | <span data-ttu-id="f8cba-509">РАЗРЕШИТЬ</span><span class="sxs-lookup"><span data-stu-id="f8cba-509">Allow</span></span> | <span data-ttu-id="f8cba-510">100</span><span class="sxs-lookup"><span data-stu-id="f8cba-510">100</span></span> | <span data-ttu-id="f8cba-511">192.168.1.0/24</span><span class="sxs-lookup"><span data-stu-id="f8cba-511">192.168.1.0/24</span></span> | * | * | <span data-ttu-id="f8cba-512">1433</span><span class="sxs-lookup"><span data-stu-id="f8cba-512">1433</span></span> | <span data-ttu-id="f8cba-513">TCP</span><span class="sxs-lookup"><span data-stu-id="f8cba-513">TCP</span></span> |

<span data-ttu-id="f8cba-514">Поскольку некоторые hello Nsg связанные tooindividual сетевых адаптеров, правила hello, для ресурсов, развернутых с помощью диспетчера ресурсов.</span><span class="sxs-lookup"><span data-stu-id="f8cba-514">Since some of hello NSGs are associated tooindividual NICs, hello rules are for resources deployed through Resource Manager.</span></span> <span data-ttu-id="f8cba-515">Правила для подсетей и сетевых интерфейсов объединяются в зависимости от того, как они связаны.</span><span class="sxs-lookup"><span data-stu-id="f8cba-515">Rules are combined for subnet and NIC, depending on how they are associated.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="f8cba-516">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="f8cba-516">Next steps</span></span>
* <span data-ttu-id="f8cba-517">[Создание групп безопасности сети с помощью портала Azure](virtual-networks-create-nsg-arm-pportal.md)</span><span class="sxs-lookup"><span data-stu-id="f8cba-517">[Deploy NSGs (Resource Manager)](virtual-networks-create-nsg-arm-pportal.md).</span></span>
* <span data-ttu-id="f8cba-518">[Как создать группы безопасности сети (классические) в PowerShell](virtual-networks-create-nsg-classic-ps.md)</span><span class="sxs-lookup"><span data-stu-id="f8cba-518">[Deploy NSGs (classic)](virtual-networks-create-nsg-classic-ps.md).</span></span>
* <span data-ttu-id="f8cba-519">[Управление журналами групп безопасности сети](virtual-network-nsg-manage-log.md).</span><span class="sxs-lookup"><span data-stu-id="f8cba-519">[Manage NSG logs](virtual-network-nsg-manage-log.md).</span></span>
* <span data-ttu-id="f8cba-520">[Устранение проблем с группами безопасности сети на портале Azure] (virtual-network-nsg-troubleshoot-portal.md)</span><span class="sxs-lookup"><span data-stu-id="f8cba-520">[Troubleshoot NSGs] (virtual-network-nsg-troubleshoot-portal.md)</span></span>
