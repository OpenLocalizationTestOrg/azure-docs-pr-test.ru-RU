---
title: "aaaResolution для виртуальных машин и экземпляров ролей"
description: "Сценарии разрешения имен для Azure IaaS, гибридных решений, между различными облачными службами, Active Directory и с помощью DNS-сервера  "
services: virtual-network
documentationcenter: na
author: GarethBradshawMSFT
manager: carmonm
editor: tysonn
ms.assetid: 5d73edde-979a-470a-b28c-e103fcf07e3e
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 12/06/2016
ms.author: telmos
ms.openlocfilehash: 0ec7903cf200c1d04d75601a5b0cefe4268f3dcf
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="name-resolution-for-vms-and-role-instances"></a><span data-ttu-id="78a20-103">Разрешение имен для ВМ и экземпляров ролей</span><span class="sxs-lookup"><span data-stu-id="78a20-103">Name Resolution for VMs and Role Instances</span></span>
<span data-ttu-id="78a20-104">В зависимости от способа использования Azure toohost IaaS, PaaS и гибридных решений может потребоваться tooallow hello виртуальными машинами и экземплярами ролей, создания toocommunicate друг с другом.</span><span class="sxs-lookup"><span data-stu-id="78a20-104">Depending on how you use Azure toohost IaaS, PaaS, and hybrid solutions, you may need tooallow hello VMs and role instances that you create toocommunicate with each other.</span></span> <span data-ttu-id="78a20-105">Несмотря на то, что это взаимодействие может осуществляться с помощью IP-адресов, это гораздо проще toouse имена, которые легко запомнить и не изменяются.</span><span class="sxs-lookup"><span data-stu-id="78a20-105">Although this communication can be done by using IP addresses, it is much simpler toouse names that can be easily remembered and do not change.</span></span> 

<span data-ttu-id="78a20-106">Когда экземпляров ролей и виртуальных машин, размещенных в Azure должны tooresolve доменных имен toointernal IP-адресов, они могут использовать один из двух способов:</span><span class="sxs-lookup"><span data-stu-id="78a20-106">When role instances and VMs hosted in Azure need tooresolve domain names toointernal IP addresses, they can use one of two methods:</span></span>

* [<span data-ttu-id="78a20-107">разрешение имен Azure;</span><span class="sxs-lookup"><span data-stu-id="78a20-107">Azure-provided name resolution</span></span>](#azure-provided-name-resolution)
* <span data-ttu-id="78a20-108">[Разрешение имен с помощью DNS-сервере](#name-resolution-using-your-own-dns-server) (которого возможно перенаправление запросов toohello предоставленных системой Azure DNS-серверы)</span><span class="sxs-lookup"><span data-stu-id="78a20-108">[Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server) (which may forward queries toohello Azure-provided DNS servers)</span></span> 

<span data-ttu-id="78a20-109">Тип Hello разрешения имен, которые можно использовать, зависит от того, как виртуальные машины и экземпляры ролей требуется toocommunicate друг с другом.</span><span class="sxs-lookup"><span data-stu-id="78a20-109">hello type of name resolution you use depends on how your VMs and role instances need toocommunicate with each other.</span></span>

<span data-ttu-id="78a20-110">**Hello следующей таблице представлены сценарии и соответствующие решения для разрешения имен.**</span><span class="sxs-lookup"><span data-stu-id="78a20-110">**hello following table illustrates scenarios and corresponding name resolution solutions:**</span></span>

| <span data-ttu-id="78a20-111">**Сценарий**</span><span class="sxs-lookup"><span data-stu-id="78a20-111">**Scenario**</span></span> | <span data-ttu-id="78a20-112">**Решение**</span><span class="sxs-lookup"><span data-stu-id="78a20-112">**Solution**</span></span> | <span data-ttu-id="78a20-113">**Суффикс**</span><span class="sxs-lookup"><span data-stu-id="78a20-113">**Suffix**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="78a20-114">Разрешение имен между экземплярами ролей или виртуальных машин находятся в hello же облачной службы или виртуальной сети</span><span class="sxs-lookup"><span data-stu-id="78a20-114">Name resolution between role instances or VMs located in hello same cloud service or virtual network</span></span> |[<span data-ttu-id="78a20-115">разрешение имен Azure;</span><span class="sxs-lookup"><span data-stu-id="78a20-115">Azure-provided name resolution</span></span>](#azure-provided-name-resolution) |<span data-ttu-id="78a20-116">имя узла или полное доменное имя</span><span class="sxs-lookup"><span data-stu-id="78a20-116">hostname or FQDN</span></span> |
| <span data-ttu-id="78a20-117">Разрешение имен между экземплярами ролей или виртуальными машинами, расположенными в разных виртуальных сетях</span><span class="sxs-lookup"><span data-stu-id="78a20-117">Name resolution between role instances or VMs located in different virtual networks</span></span> |<span data-ttu-id="78a20-118">Управляемые клиентами DNS-серверы, перенаправляющие запросы между виртуальными сетями для разрешения в Azure (DNS-прокси).</span><span class="sxs-lookup"><span data-stu-id="78a20-118">Customer-managed DNS servers forwarding queries between vnets for resolution by Azure (DNS proxy).</span></span>  <span data-ttu-id="78a20-119">См. раздел [Разрешение имен с помощью собственного DNS-сервера](#name-resolution-using-your-own-dns-server).</span><span class="sxs-lookup"><span data-stu-id="78a20-119">see [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server)</span></span> |<span data-ttu-id="78a20-120">только полное доменное имя</span><span class="sxs-lookup"><span data-stu-id="78a20-120">FQDN only</span></span> |
| <span data-ttu-id="78a20-121">Разрешение имен локального компьютера и службы из экземпляров роли или виртуальных машин в Azure</span><span class="sxs-lookup"><span data-stu-id="78a20-121">Resolution of on-premises computer and service names from role instances or VMs in Azure</span></span> |<span data-ttu-id="78a20-122">Управляемые клиентами DNS-серверы (например, локальный контроллер домена, локальный контроллер домена только для чтения или DNS-сервер, вторично синхронизированный с помощью передач зоны).</span><span class="sxs-lookup"><span data-stu-id="78a20-122">Customer-managed DNS servers (e.g. on-premises domain controller, local read-only domain controller or a DNS secondary synced using zone transfers).</span></span>  <span data-ttu-id="78a20-123">См. раздел [Разрешение имен с помощью собственного DNS-сервера](#name-resolution-using-your-own-dns-server).</span><span class="sxs-lookup"><span data-stu-id="78a20-123">See [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server)</span></span> |<span data-ttu-id="78a20-124">только полное доменное имя</span><span class="sxs-lookup"><span data-stu-id="78a20-124">FQDN only</span></span> |
| <span data-ttu-id="78a20-125">Разрешение имен узлов Azure с локальных компьютеров</span><span class="sxs-lookup"><span data-stu-id="78a20-125">Resolution of Azure hostnames from on-premises computers</span></span> |<span data-ttu-id="78a20-126">Пересылки tooa под управлением прокси-сервер DNS в соответствующей виртуальной сети hello, hello прокси-сервер перенаправляет запросы tooAzure для разрешения.</span><span class="sxs-lookup"><span data-stu-id="78a20-126">Forward queries tooa customer-managed DNS proxy server in hello corresponding vnet, hello proxy server forwards queries tooAzure for resolution.</span></span> <span data-ttu-id="78a20-127">См. раздел [Разрешение имен с помощью собственного DNS-сервера](#name-resolution-using-your-own-dns-server).</span><span class="sxs-lookup"><span data-stu-id="78a20-127">See [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server)</span></span> |<span data-ttu-id="78a20-128">только полное доменное имя</span><span class="sxs-lookup"><span data-stu-id="78a20-128">FQDN only</span></span> |
| <span data-ttu-id="78a20-129">Обратный поиск DNS для внутренних IP-адресов</span><span class="sxs-lookup"><span data-stu-id="78a20-129">Reverse DNS for internal IPs</span></span> |[<span data-ttu-id="78a20-130">разрешение имен с помощью собственного DNS-сервера.</span><span class="sxs-lookup"><span data-stu-id="78a20-130">Name resolution using your own DNS server</span></span>](#name-resolution-using-your-own-dns-server) |<span data-ttu-id="78a20-131">Недоступно</span><span class="sxs-lookup"><span data-stu-id="78a20-131">n/a</span></span> |
| <span data-ttu-id="78a20-132">Разрешение имен между виртуальными машинами или экземплярами ролей, расположенными не в виртуальной сети, а в различных облачных службах</span><span class="sxs-lookup"><span data-stu-id="78a20-132">Name resolution between VMs or role instances located in different cloud services, not in a virtual network</span></span> |<span data-ttu-id="78a20-133">Не применяется</span><span class="sxs-lookup"><span data-stu-id="78a20-133">Not applicable.</span></span> <span data-ttu-id="78a20-134">Подключение между виртуальными машинами и экземплярами ролей в разных облачных службах не поддерживается за пределами виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="78a20-134">Connectivity between VMs and role instances in different cloud services is not supported outside a virtual network.</span></span> |<span data-ttu-id="78a20-135">Недоступно</span><span class="sxs-lookup"><span data-stu-id="78a20-135">n/a</span></span> |

## <a name="azure-provided-name-resolution"></a><span data-ttu-id="78a20-136">разрешение имен Azure;</span><span class="sxs-lookup"><span data-stu-id="78a20-136">Azure-provided name resolution</span></span>
<span data-ttu-id="78a20-137">Кроме разрешения общедоступные DNS-имена Azure обеспечивает разрешение внутреннего имени для виртуальных машин и экземпляров ролей, которые находятся в пределах hello одной виртуальной сети или облачной службе.</span><span class="sxs-lookup"><span data-stu-id="78a20-137">Along with resolution of public DNS names, Azure provides internal name resolution for VMs and role instances that reside within hello same virtual network or cloud service.</span></span>  <span data-ttu-id="78a20-138">Виртуальные машины и экземпляры в облачной службе совместного использования hello же DNS суффикс (то есть достаточно hello hostname сама по себе), но в разных облачных службах классические виртуальные сети имеют другие DNS-суффиксы, поэтому hello полное доменное имя необходимые tooresolve имен между разных облачных службах.</span><span class="sxs-lookup"><span data-stu-id="78a20-138">VMs/instances in a cloud service share hello same DNS suffix (so hello hostname alone is sufficient) but in classic virtual networks different cloud services have different DNS suffixes so hello FQDN is needed tooresolve names between different cloud services.</span></span>  <span data-ttu-id="78a20-139">В виртуальных сетях в модели развертывания диспетчера ресурсов hello hello DNS-суффикс является согласованным для всех виртуальных сетей hello (поэтому hello полное доменное имя не требуется) и DNS-имен можно назначить tooboth сетевых адаптеров и виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="78a20-139">In virtual networks in hello Resource Manager deployment model, hello DNS suffix is consistent across hello virtual network (so hello FQDN is not needed) and DNS names can be assigned tooboth NICs and VMs.</span></span> <span data-ttu-id="78a20-140">Несмотря на то, что разрешение имен Azure не требует какой-либо настройки, это не hello правильный выбор для всех сценариев развертывания, как показано на приведенной выше таблице hello.</span><span class="sxs-lookup"><span data-stu-id="78a20-140">Although Azure-provided name resolution does not require any configuration, it is not hello appropriate choice for all deployment scenarios, as seen on hello table above.</span></span>

> [!NOTE]
> <span data-ttu-id="78a20-141">В случае hello рабочих и веб-ролей можно также перейти hello внутренние IP-адреса экземпляров ролей на hello роли имя и номер экземпляра с помощью API REST управления службами Azure hello.</span><span class="sxs-lookup"><span data-stu-id="78a20-141">In hello case of web and worker roles, you can also access hello internal IP addresses of role instances based on hello role name and instance number using hello Azure Service Management REST API.</span></span> <span data-ttu-id="78a20-142">Дополнительные сведения см. в [справочных материалах по REST API управления службами](https://msdn.microsoft.com/library/azure/ee460799.aspx).</span><span class="sxs-lookup"><span data-stu-id="78a20-142">For more information, see [Service Management REST API Reference](https://msdn.microsoft.com/library/azure/ee460799.aspx).</span></span>
> 
> 

### <a name="features-and-considerations"></a><span data-ttu-id="78a20-143">Функции и рекомендации</span><span class="sxs-lookup"><span data-stu-id="78a20-143">Features and Considerations</span></span>
<span data-ttu-id="78a20-144">**Функции**</span><span class="sxs-lookup"><span data-stu-id="78a20-144">**Features:**</span></span>

* <span data-ttu-id="78a20-145">Простота использования: в порядке toouse разрешение имен Azure не требуется никакой настройки.</span><span class="sxs-lookup"><span data-stu-id="78a20-145">Ease of use: No configuration is required in order toouse Azure-provided name resolution.</span></span>
* <span data-ttu-id="78a20-146">Hello предоставленных системой Azure служба разрешения имен высокой надежности, сохранение hello вы должны toocreate кластеров и управление ими DNS-серверов.</span><span class="sxs-lookup"><span data-stu-id="78a20-146">hello Azure-provided name resolution service is highly available, saving you hello need toocreate and manage clusters of your own DNS servers.</span></span>
* <span data-ttu-id="78a20-147">Можно использовать в сочетании с собственного tooresolve серверами DNS как локальной, так и имена узлов Azure.</span><span class="sxs-lookup"><span data-stu-id="78a20-147">Can be used in conjunction with your own DNS servers tooresolve both on-premises and Azure hostnames.</span></span>
* <span data-ttu-id="78a20-148">Предоставляется разрешение имен между экземплярами роли или ВМ в hello же облачной службы без необходимости использования полного доменного ИМЕНИ.</span><span class="sxs-lookup"><span data-stu-id="78a20-148">Name resolution is provided between role instances/VMs within hello same cloud service without need for a FQDN.</span></span>
* <span data-ttu-id="78a20-149">Разрешение имен обеспечивается между виртуальными машинами в виртуальной сети, использовать модель развертывания диспетчера ресурсов hello без необходимости hello полное доменное имя.</span><span class="sxs-lookup"><span data-stu-id="78a20-149">Name resolution is provided between VMs in virtual networks that use hello Resource Manager deployment model, without need for hello FQDN.</span></span> <span data-ttu-id="78a20-150">Виртуальные сети в hello классической модели развертывания требуется hello полное доменное имя, при разрешении имен в разных облачных службах.</span><span class="sxs-lookup"><span data-stu-id="78a20-150">Virtual networks in hello classic deployment model require hello FQDN when resolving names in different cloud services.</span></span> 
* <span data-ttu-id="78a20-151">Вместо использования автоматически создаваемых имен узлов вы можете создавать имена, которые наиболее точно описывают ваши развертывания.</span><span class="sxs-lookup"><span data-stu-id="78a20-151">You can use hostnames that best describe your deployments, rather than working with auto-generated names.</span></span>

<span data-ttu-id="78a20-152">**Рекомендации**</span><span class="sxs-lookup"><span data-stu-id="78a20-152">**Considerations:**</span></span>

* <span data-ttu-id="78a20-153">суффикс DNS, созданный Azure Hello, нельзя изменить.</span><span class="sxs-lookup"><span data-stu-id="78a20-153">hello Azure-created DNS suffix cannot be modified.</span></span>
* <span data-ttu-id="78a20-154">Собственные записи нельзя регистрировать вручную.</span><span class="sxs-lookup"><span data-stu-id="78a20-154">You cannot manually register your own records.</span></span>
* <span data-ttu-id="78a20-155">WINS и NetBIOS не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="78a20-155">WINS and NetBIOS are not supported.</span></span> <span data-ttu-id="78a20-156">(В проводнике Windows виртуальные машины не отображаются.)</span><span class="sxs-lookup"><span data-stu-id="78a20-156">(You cannot see your VMs in Windows Explorer.)</span></span>
* <span data-ttu-id="78a20-157">Имена узлов должны быть DNS-совместимыми (они могут содержать только символы 0–9, a–z и «-» и не могут начинаться или заканчиваться на «-».</span><span class="sxs-lookup"><span data-stu-id="78a20-157">Hostnames must be DNS-compatible (They must use only 0-9, a-z and '-', and cannot start or end with a '-'.</span></span> <span data-ttu-id="78a20-158">См. раздел 2 RFC 3696.)</span><span class="sxs-lookup"><span data-stu-id="78a20-158">See RFC 3696 section 2.)</span></span>
* <span data-ttu-id="78a20-159">Трафик запросов DNS регулируется для каждой виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="78a20-159">DNS query traffic is throttled for each VM.</span></span> <span data-ttu-id="78a20-160">Это не должно влиять на большинство приложений.</span><span class="sxs-lookup"><span data-stu-id="78a20-160">This shouldn't impact most applications.</span></span>  <span data-ttu-id="78a20-161">Если наблюдается регулирование запросов, проверьте, включено ли кэширование на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="78a20-161">If request throttling is observed, ensure that client-side caching is enabled.</span></span>  <span data-ttu-id="78a20-162">Дополнительные сведения см. в разделе [начало hello большинство с разрешением имен Azure](#Getting-the-most-from-Azure-provided-name-resolution).</span><span class="sxs-lookup"><span data-stu-id="78a20-162">For more details, see [Getting hello most from Azure-provided name resolution](#Getting-the-most-from-Azure-provided-name-resolution).</span></span>
* <span data-ttu-id="78a20-163">Для каждой виртуальной сети в классической модели развертывания регистрируются только виртуальные машины в первых 180 облачных служб hello.</span><span class="sxs-lookup"><span data-stu-id="78a20-163">Only VMs in hello first 180 cloud services are registered for each virtual network in a classic deployment model.</span></span> <span data-ttu-id="78a20-164">Это не относится к сети toovirtual в модели развертывания диспетчера ресурсов.</span><span class="sxs-lookup"><span data-stu-id="78a20-164">This does not apply toovirtual networks in Resource Manager deployment models.</span></span>

### <a name="getting-hello-most-from-azure-provided-name-resolution"></a><span data-ttu-id="78a20-165">Получение hello большинство с разрешением имен Azure</span><span class="sxs-lookup"><span data-stu-id="78a20-165">Getting hello most from Azure-provided name resolution</span></span>
<span data-ttu-id="78a20-166">**Кэширование на стороне клиента**</span><span class="sxs-lookup"><span data-stu-id="78a20-166">**Client-side Caching:**</span></span>

<span data-ttu-id="78a20-167">Не все DNS-запрос должен toobe, отправляемых по сети hello.</span><span class="sxs-lookup"><span data-stu-id="78a20-167">Not every DNS query needs toobe sent across hello network.</span></span>  <span data-ttu-id="78a20-168">Кэширование на стороне клиента помогает уменьшить задержку и улучшить звуковые сигналы toonetwork устойчивости, разрешая периодические запросы DNS из локального кэша.</span><span class="sxs-lookup"><span data-stu-id="78a20-168">Client-side caching helps reduce latency and improve resilience toonetwork blips by resolving recurring DNS queries from a local cache.</span></span>  <span data-ttu-id="78a20-169">DNS-записи содержат срока жизни (TTL), обеспечивая запись hello toostore hello кэша в течение без влияния на актуальность записей, чтобы кэширование на стороне клиента подходит для большинства ситуаций.</span><span class="sxs-lookup"><span data-stu-id="78a20-169">DNS records contain a Time-To-Live (TTL) which allows hello cache toostore hello record for as long as possible without impacting record freshness, so client-side caching is suitable for most situations.</span></span>

<span data-ttu-id="78a20-170">по умолчанию Hello DNS-клиента Windows имеется встроенный кэш DNS.</span><span class="sxs-lookup"><span data-stu-id="78a20-170">hello default Windows DNS Client has a DNS cache built-in.</span></span>  <span data-ttu-id="78a20-171">Некоторые Linux, не включайте дистрибутивы кэширования по умолчанию, рекомендуется один, добавить tooeach ВМ Linux (после проверки того, что не существует локального кэша уже).</span><span class="sxs-lookup"><span data-stu-id="78a20-171">Some Linux distros do not include caching by default, it is recommended that one be added tooeach Linux VM (after checking that there isn't a local cache already).</span></span>

<span data-ttu-id="78a20-172">Существует несколько разных DNS кэширования пакетов, доступных, например dnsmasq, вот dnsmasq tooinstall действия hello в типичных дистрибутивы hello:</span><span class="sxs-lookup"><span data-stu-id="78a20-172">There are a number of different DNS caching packages available, e.g. dnsmasq, here are hello steps tooinstall dnsmasq on hello most common distros:</span></span>

* <span data-ttu-id="78a20-173">**Ubuntu (используется пакет resolvconf)**:</span><span class="sxs-lookup"><span data-stu-id="78a20-173">**Ubuntu (uses resolvconf)**:</span></span>
  * <span data-ttu-id="78a20-174">просто установите пакет dnsmasq hello («sudo установки apt get dnsmasq»).</span><span class="sxs-lookup"><span data-stu-id="78a20-174">just install hello dnsmasq package (“sudo apt-get install dnsmasq”).</span></span>
* <span data-ttu-id="78a20-175">**SUSE (используется пакет netconf)**:</span><span class="sxs-lookup"><span data-stu-id="78a20-175">**SUSE (uses netconf)**:</span></span>
  * <span data-ttu-id="78a20-176">Установите пакет dnsmasq hello («sudo zypper установки dnsmasq»)</span><span class="sxs-lookup"><span data-stu-id="78a20-176">install hello dnsmasq package (“sudo zypper install dnsmasq”)</span></span> 
  * <span data-ttu-id="78a20-177">Включите службу hello dnsmasq («systemctl enable dnsmasq.service»)</span><span class="sxs-lookup"><span data-stu-id="78a20-177">enable hello dnsmasq service (“systemctl enable dnsmasq.service”)</span></span> 
  * <span data-ttu-id="78a20-178">Запуск службы dnsmasq hello («systemctl начала dnsmasq.service»)</span><span class="sxs-lookup"><span data-stu-id="78a20-178">start hello dnsmasq service (“systemctl start dnsmasq.service”)</span></span> 
  * <span data-ttu-id="78a20-179">изменить «/ и т. д/sysconfig / / конфигурация сети» и измените NETCONFIG_DNS_FORWARDER = "» слишком «dnsmasq»</span><span class="sxs-lookup"><span data-stu-id="78a20-179">edit “/etc/sysconfig/network/config” and change NETCONFIG_DNS_FORWARDER="" too”dnsmasq”</span></span>
  * <span data-ttu-id="78a20-180">Обновление кэша hello («обновление netconfig») tooset хоста как hello локального разрешения имен DNS</span><span class="sxs-lookup"><span data-stu-id="78a20-180">update resolv.conf ("netconfig update") tooset hello cache as hello local DNS resolver</span></span>
* <span data-ttu-id="78a20-181">**OpenLogic (используется пакет NetworkManager)**:</span><span class="sxs-lookup"><span data-stu-id="78a20-181">**OpenLogic (uses NetworkManager)**:</span></span>
  * <span data-ttu-id="78a20-182">Установите пакет dnsmasq hello («sudo yum установки dnsmasq»)</span><span class="sxs-lookup"><span data-stu-id="78a20-182">install hello dnsmasq package (“sudo yum install dnsmasq”)</span></span>
  * <span data-ttu-id="78a20-183">Включите службу hello dnsmasq («systemctl enable dnsmasq.service»)</span><span class="sxs-lookup"><span data-stu-id="78a20-183">enable hello dnsmasq service (“systemctl enable dnsmasq.service”)</span></span>
  * <span data-ttu-id="78a20-184">Запуск службы dnsmasq hello («systemctl начала dnsmasq.service»)</span><span class="sxs-lookup"><span data-stu-id="78a20-184">start hello dnsmasq service (“systemctl start dnsmasq.service”)</span></span>
  * <span data-ttu-id="78a20-185">Добавьте «добавить серверы доменных имен 127.0.0.1;» too"/etc/dhclient-eth0.conf»</span><span class="sxs-lookup"><span data-stu-id="78a20-185">add “prepend domain-name-servers 127.0.0.1;” too“/etc/dhclient-eth0.conf”</span></span>
  * <span data-ttu-id="78a20-186">Перезагрузить кэш hello сетевой службы («сеть перезапуска службы») tooset hello hello локального разрешения имен DNS</span><span class="sxs-lookup"><span data-stu-id="78a20-186">restart hello network service (“service network restart”) tooset hello cache as hello local DNS resolver</span></span>

> [!NOTE]
> <span data-ttu-id="78a20-187">пакет «dnsmasq» Hello используется только одно из hello много кэша DNS для Linux.</span><span class="sxs-lookup"><span data-stu-id="78a20-187">hello 'dnsmasq' package is only one of hello many DNS caches available for Linux.</span></span>  <span data-ttu-id="78a20-188">Перед его использованием проверьте, соответствует ли он вашим потребностям, а также не установлен ли у вас другой кэш.</span><span class="sxs-lookup"><span data-stu-id="78a20-188">Before using it, please check its suitability for your particular needs and that no other cache is installed.</span></span>
> 
> 

<span data-ttu-id="78a20-189">**Повторные попытки на стороне клиента**</span><span class="sxs-lookup"><span data-stu-id="78a20-189">**Client-side Retries:**</span></span>

<span data-ttu-id="78a20-190">DNS использует преимущественно протокол UDP.</span><span class="sxs-lookup"><span data-stu-id="78a20-190">DNS is primarily a UDP protocol.</span></span>  <span data-ttu-id="78a20-191">Как hello протокол UDP не гарантирует доставку сообщений, в сам протокол DNS hello обрабатывается логику повторных попыток.</span><span class="sxs-lookup"><span data-stu-id="78a20-191">As hello UDP protocol doesn't guarantee message delivery, retry logic is handled in hello DNS protocol itself.</span></span>  <span data-ttu-id="78a20-192">Каждый клиент DNS (операционная система) можно достичь логика повторов разные в зависимости от предпочтений создатели hello:</span><span class="sxs-lookup"><span data-stu-id="78a20-192">Each DNS client (operating system) can exhibit different retry logic depending on hello creators preference:</span></span>

* <span data-ttu-id="78a20-193">ОС Windows выполняет повторную попытку через 1 с, затем через 2 и 4 с, а затем снова через 4 с.</span><span class="sxs-lookup"><span data-stu-id="78a20-193">Windows operating systems retry after 1 second and then again after another 2, 4 and another 4 seconds.</span></span> 
* <span data-ttu-id="78a20-194">Здравствуйте, повторные попытки установки Linux по умолчанию через 5 секунд.</span><span class="sxs-lookup"><span data-stu-id="78a20-194">hello default Linux setup retries after 5 seconds.</span></span>  <span data-ttu-id="78a20-195">Это рекомендуется это tooretry toochange 5 раз с интервалом 1 секунд.</span><span class="sxs-lookup"><span data-stu-id="78a20-195">It is recommended toochange this tooretry 5 times at 1 second intervals.</span></span>  

<span data-ttu-id="78a20-196">toocheck hello текущие параметры на виртуальной Машине Linux «/etc/resolv.conf cat» и найдите в строке «параметры» hello, например:</span><span class="sxs-lookup"><span data-stu-id="78a20-196">toocheck hello current settings on a Linux VM, 'cat /etc/resolv.conf' and look at hello 'options' line, e.g.:</span></span>

    options timeout:1 attempts:5

<span data-ttu-id="78a20-197">файл хоста Hello обычно автоматически создается и не следует изменять.</span><span class="sxs-lookup"><span data-stu-id="78a20-197">hello resolv.conf file is usually auto-generated and should not be edited.</span></span>  <span data-ttu-id="78a20-198">Hello конкретные шаги для добавления строки hello «параметры» зависят от дистрибутив:</span><span class="sxs-lookup"><span data-stu-id="78a20-198">hello specific steps for adding hello 'options' line vary by distro:</span></span>

* <span data-ttu-id="78a20-199">**Ubuntu** (используется пакет resolvconf):</span><span class="sxs-lookup"><span data-stu-id="78a20-199">**Ubuntu** (uses resolvconf):</span></span>
  * <span data-ttu-id="78a20-200">добавить too'/etc/resolveconf/resolv.conf.d/head строку hello параметры "</span><span class="sxs-lookup"><span data-stu-id="78a20-200">add hello options line too'/etc/resolveconf/resolv.conf.d/head'</span></span> 
  * <span data-ttu-id="78a20-201">Запустите tooupdate «resolvconf -u»</span><span class="sxs-lookup"><span data-stu-id="78a20-201">run 'resolvconf -u' tooupdate</span></span>
* <span data-ttu-id="78a20-202">**SUSE** (используется пакет netconf):</span><span class="sxs-lookup"><span data-stu-id="78a20-202">**SUSE** (uses netconf):</span></span>
  * <span data-ttu-id="78a20-203">добавить toohello 'timeout:1 попыток: 5' NETCONFIG_DNS_RESOLVER_OPTIONS = "» параметра в «/ и т. д/sysconfig / / конфигурация сети»</span><span class="sxs-lookup"><span data-stu-id="78a20-203">add 'timeout:1 attempts:5' toohello NETCONFIG_DNS_RESOLVER_OPTIONS="" parameter in '/etc/sysconfig/network/config'</span></span> 
  * <span data-ttu-id="78a20-204">Запустите tooupdate «netconfig обновления»</span><span class="sxs-lookup"><span data-stu-id="78a20-204">run 'netconfig update' tooupdate</span></span>
* <span data-ttu-id="78a20-205">**OpenLogic** (используется пакет NetworkManager):</span><span class="sxs-lookup"><span data-stu-id="78a20-205">**OpenLogic** (uses NetworkManager):</span></span>
  * <span data-ttu-id="78a20-206">добавить too'/etc/NetworkManager/dispatcher.d/11-dhclient «echo «параметры timeout:1 попыток: 5»» "</span><span class="sxs-lookup"><span data-stu-id="78a20-206">add 'echo "options timeout:1 attempts:5"' too'/etc/NetworkManager/dispatcher.d/11-dhclient'</span></span> 
  * <span data-ttu-id="78a20-207">Запустите tooupdate «перезапуск службы сети»</span><span class="sxs-lookup"><span data-stu-id="78a20-207">run 'service network restart' tooupdate</span></span>

## <a name="name-resolution-using-your-own-dns-server"></a><span data-ttu-id="78a20-208">разрешение имен с помощью собственного DNS-сервера.</span><span class="sxs-lookup"><span data-stu-id="78a20-208">Name resolution using your own DNS server</span></span>
<span data-ttu-id="78a20-209">Существует множество ситуаций, ваших потребностей разрешения имен может переход за пределы hello функции, предоставляемые Azure, например при использование доменов Active Directory, или когда требуется разрешение DNS между виртуальных сетей (vnet).</span><span class="sxs-lookup"><span data-stu-id="78a20-209">There are a number of situations where your name resolution needs may go beyond hello features provided by Azure, for example when using Active Directory domains or when you require DNS resolution between virtual networks (vnets).</span></span>  <span data-ttu-id="78a20-210">toocover эти сценарии Azure предоставляет возможность hello вы toouse DNS-серверы.</span><span class="sxs-lookup"><span data-stu-id="78a20-210">toocover these scenarios, Azure provides hello ability for you toouse your own DNS servers.</span></span>  

<span data-ttu-id="78a20-211">DNS-серверы в виртуальной сети можно переслать распознаватели рекурсивные запросы tooAzure DNS tooresolve имена узлов в этой виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="78a20-211">DNS servers within a virtual network can forward DNS queries tooAzure's recursive resolvers tooresolve hostnames within that virtual network.</span></span>  <span data-ttu-id="78a20-212">Например контроллеру домена (DC) в Azure можно реагировать tooDNS запрашивает его доменов и пересылать все другие tooAzure запросы.</span><span class="sxs-lookup"><span data-stu-id="78a20-212">For example, a Domain Controller (DC) running in Azure can respond tooDNS queries for its domains and forward all other queries tooAzure.</span></span>  <span data-ttu-id="78a20-213">Это позволяет toosee ВМ локальными ресурсами (с помощью hello контроллера домена) и имена узлов предоставленное Azure (через сервер пересылки hello).</span><span class="sxs-lookup"><span data-stu-id="78a20-213">This allows VMs toosee both your on-premises resources (via hello DC) and Azure-provided hostnames (via hello forwarder).</span></span>  <span data-ttu-id="78a20-214">TooAzure доступа рекурсивных сопоставителей обеспечивается за счет hello виртуального IP-адреса 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="78a20-214">Access tooAzure's recursive resolvers is provided via hello virtual IP 168.63.129.16.</span></span>

<span data-ttu-id="78a20-215">Перенаправление запросов DNS также позволяет разрешение DNS исходящий трафик внутри виртуальной сети и вашей локальной машины tooresolve имена узлов, предоставленное Azure.</span><span class="sxs-lookup"><span data-stu-id="78a20-215">DNS forwarding also enables inter-vnet DNS resolution and allows your on-premises machines tooresolve Azure-provided hostnames.</span></span>  <span data-ttu-id="78a20-216">Чтобы tooresolve имя узла Виртуальной машины, hello DNS-сервера виртуальной Машины должны находиться в hello же виртуальной сети и быть tooAzure запросы настроенных tooforward имя узла.</span><span class="sxs-lookup"><span data-stu-id="78a20-216">In order tooresolve a VM's hostname, hello DNS server VM must reside in hello same virtual network and be configured tooforward hostname queries tooAzure.</span></span>  <span data-ttu-id="78a20-217">DNS-суффикс hello отличается в каждой виртуальной сети, можно использовать условное перенаправление правила toosend DNS запрашивает toohello исправить виртуальной сети для разрешения.</span><span class="sxs-lookup"><span data-stu-id="78a20-217">As hello DNS suffix is different in each vnet, you can use conditional forwarding rules toosend DNS queries toohello correct vnet for resolution.</span></span>  <span data-ttu-id="78a20-218">Следующие изображения Hello показывает двух виртуальных сетей и локальной сетью, выполнив разрешение DNS исходящий трафик внутри виртуальной сети с помощью этого метода.</span><span class="sxs-lookup"><span data-stu-id="78a20-218">hello following image shows two vnets and an on-premises network doing inter-vnet DNS resolution using this method.</span></span>  <span data-ttu-id="78a20-219">DNS-сервер пересылки пример доступен в hello [коллекции шаблонов быстрый запуск Azure](https://azure.microsoft.com/documentation/templates/301-dns-forwarder/) и [GitHub](https://github.com/Azure/azure-quickstart-templates/tree/master/301-dns-forwarder).</span><span class="sxs-lookup"><span data-stu-id="78a20-219">An example DNS forwarder is available in hello [Azure Quickstart Templates gallery](https://azure.microsoft.com/documentation/templates/301-dns-forwarder/) and [GitHub](https://github.com/Azure/azure-quickstart-templates/tree/master/301-dns-forwarder).</span></span>

![Разрешение имен DNS между виртуальными сетями](./media/virtual-networks-name-resolution-for-vms-and-role-instances/inter-vnet-dns.png)

<span data-ttu-id="78a20-221">При использовании разрешения имен, предоставленное Azure, внутренние DNS-суффикс (*. internal.cloudapp.net) предоставленного tooeach виртуальной Машины с помощью DHCP.</span><span class="sxs-lookup"><span data-stu-id="78a20-221">When using Azure-provided name resolution, an Internal DNS suffix (*.internal.cloudapp.net) is provided tooeach VM using DHCP.</span></span>  <span data-ttu-id="78a20-222">Это включает разрешение имен узлов в качестве узла hello, записей в зоне internal.cloudapp.net hello.</span><span class="sxs-lookup"><span data-stu-id="78a20-222">This enables hostname resolution as hello hostname records are in hello internal.cloudapp.net zone.</span></span>  <span data-ttu-id="78a20-223">При использовании собственного решения разрешения имени, приветствия имена IDN суффикс не указано tooVMs, так как он мешает других архитектур DNS (например, сценарии, присоединенных к домену).</span><span class="sxs-lookup"><span data-stu-id="78a20-223">When using your own name resolution solution, hello IDNS suffix is not supplied tooVMs because it interferes with other DNS architectures (like domain-joined scenarios).</span></span>  <span data-ttu-id="78a20-224">Вместо этого мы предоставляем фиктивный заполнитель (reddog.microsoft.com).</span><span class="sxs-lookup"><span data-stu-id="78a20-224">Instead we provide a non-functioning placeholder (reddog.microsoft.com).</span></span>  

<span data-ttu-id="78a20-225">При необходимости hello внутренние DNS-суффикс может определяться с помощью PowerShell или hello API:</span><span class="sxs-lookup"><span data-stu-id="78a20-225">If needed, hello Internal DNS suffix can be determined using PowerShell or hello API:</span></span>

* <span data-ttu-id="78a20-226">Для виртуальных сетей в модели развертывания диспетчера ресурсов суффикс hello доступна через hello [сетевой адаптер](https://msdn.microsoft.com/library/azure/mt163668.aspx) ресурсов или с помощью hello [Get AzureRmNetworkInterface](https://msdn.microsoft.com/library/mt619434.aspx) командлета.</span><span class="sxs-lookup"><span data-stu-id="78a20-226">For virtual networks in Resource Manager deployment models, hello suffix is available via hello [network interface card](https://msdn.microsoft.com/library/azure/mt163668.aspx) resource or via hello [Get-AzureRmNetworkInterface](https://msdn.microsoft.com/library/mt619434.aspx) cmdlet.</span></span>    
* <span data-ttu-id="78a20-227">В классическом развертывании моделей, суффикс hello доступна через hello [получить API развертывания](https://msdn.microsoft.com/library/azure/ee460804.aspx) вызова или с помощью hello [Get-AzureVM-Отладка](https://msdn.microsoft.com/library/azure/dn495236.aspx) командлета.</span><span class="sxs-lookup"><span data-stu-id="78a20-227">In classic deployment models, hello suffix is available via hello [Get Deployment API](https://msdn.microsoft.com/library/azure/ee460804.aspx) call or via hello [Get-AzureVM -Debug](https://msdn.microsoft.com/library/azure/dn495236.aspx) cmdlet.</span></span>

<span data-ttu-id="78a20-228">Если пересылка запросов tooAzure не подходят, вам потребуется tooprovide собственное решение DNS.</span><span class="sxs-lookup"><span data-stu-id="78a20-228">If forwarding queries tooAzure doesn't suit your needs, you will need tooprovide your own DNS solution.</span></span>  <span data-ttu-id="78a20-229">Ваше решение DNS должно:</span><span class="sxs-lookup"><span data-stu-id="78a20-229">Your DNS solution will need to:</span></span>

* <span data-ttu-id="78a20-230">Предоставлять корректное разрешение имен, например, с помощью [DDNS](virtual-networks-name-resolution-ddns.md).</span><span class="sxs-lookup"><span data-stu-id="78a20-230">Provide appropriate hostname resolution, e.g. via [DDNS](virtual-networks-name-resolution-ddns.md).</span></span>  <span data-ttu-id="78a20-231">Обратите внимание, что если с помощью DDNS, может потребоваться toodisable DNS очистки записей аренды DHCP Azure имеют слишком большую длину и очистки может удалить службу DNS записи преждевременно.</span><span class="sxs-lookup"><span data-stu-id="78a20-231">Note, if using DDNS you may need toodisable DNS record scavenging as Azure's DHCP leases are very long and scavenging may remove DNS records prematurely.</span></span> 
* <span data-ttu-id="78a20-232">Укажите соответствующие рекурсивного разрешения tooallow разрешения внешних доменных имен.</span><span class="sxs-lookup"><span data-stu-id="78a20-232">Provide appropriate recursive resolution tooallow resolution of external domain names.</span></span>
* <span data-ttu-id="78a20-233">Быть доступны (TCP и UDP-порт 53) от клиентов hello предназначенный и tooaccess может быть hello Интернета.</span><span class="sxs-lookup"><span data-stu-id="78a20-233">Be accessible (TCP and UDP on port 53) from hello clients it serves and be able tooaccess hello internet.</span></span>
* <span data-ttu-id="78a20-234">Защищены от доступа из hello Интернет угрозы toomitigate внешних агентов.</span><span class="sxs-lookup"><span data-stu-id="78a20-234">Be secured against access from hello internet, toomitigate threats posed by external agents.</span></span>

> [!NOTE]
> <span data-ttu-id="78a20-235">Для наилучшей производительности при использовании виртуальных машин Azure в качестве DNS-серверы должны быть отключены IPv6 и [общедоступный IP-адрес уровня экземпляра](virtual-networks-instance-level-public-ip.md) следует назначать tooeach DNS-сервера виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="78a20-235">For best performance, when using Azure VMs as DNS servers, IPv6 should be disabled and an [Instance-Level Public IP](virtual-networks-instance-level-public-ip.md) should be assigned tooeach DNS server VM.</span></span>  <span data-ttu-id="78a20-236">Если выбрать toouse Windows Server в качестве DNS-сервера, [в этой статье](http://blogs.technet.com/b/networking/archive/2015/08/19/name-resolution-performance-of-a-recursive-windows-dns-server-2012-r2.aspx) предоставляет анализ производительности и оптимизации.</span><span class="sxs-lookup"><span data-stu-id="78a20-236">If you choose toouse Windows Server as your DNS server, [this article](http://blogs.technet.com/b/networking/archive/2015/08/19/name-resolution-performance-of-a-recursive-windows-dns-server-2012-r2.aspx) provides additional performance analysis and optimizations.</span></span>
> 
> 

### <a name="specifying-dns-servers"></a><span data-ttu-id="78a20-237">Указание DNS-серверов</span><span class="sxs-lookup"><span data-stu-id="78a20-237">Specifying DNS servers</span></span>
<span data-ttu-id="78a20-238">При использовании DNS-серверы, Azure предоставляет возможность toospecify hello несколько DNS-серверов для каждой виртуальной сети или в сетевой интерфейс (диспетчера ресурсов) / облачной службы (классические).</span><span class="sxs-lookup"><span data-stu-id="78a20-238">When using your own DNS servers, Azure provides hello ability toospecify multiple DNS servers per virtual network or per network interface (Resource Manager) / cloud service (classic).</span></span>  <span data-ttu-id="78a20-239">DNS-серверы, указанные для облачной службы или сетевого интерфейса получить более высокий приоритет над указанными для hello виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="78a20-239">DNS servers specified for a cloud service/network interface get precedence over those specified for hello virtual network.</span></span>

> [!NOTE]
> <span data-ttu-id="78a20-240">Свойства сетевых подключений, такие как DNS-сервером IP-адресов, не следует изменять непосредственно в ВМ Windows, они могут получить удалены во время обновления, автоматическое восстановление при возвращает замены hello виртуального сетевого адаптера.</span><span class="sxs-lookup"><span data-stu-id="78a20-240">Network connection properties, such as DNS server IPs, should not be edited directly within Windows VMs as they may get erased during service heal when hello virtual network adaptor gets replaced.</span></span> 
> 
> 

<span data-ttu-id="78a20-241">При использовании модели развертывания диспетчера ресурсов hello в hello портала API или шаблоны можно указать DNS-серверы ([vnet](https://msdn.microsoft.com/library/azure/mt163661.aspx), [сетевых](https://msdn.microsoft.com/library/azure/mt163668.aspx)) или PowerShell ([виртуальной сети](https://msdn.microsoft.com/library/mt603657.aspx), [сетевых](https://msdn.microsoft.com/library/mt619370.aspx)).</span><span class="sxs-lookup"><span data-stu-id="78a20-241">When using hello Resource Manager deployment model, DNS servers can be specified in hello Portal, API/Templates ([vnet](https://msdn.microsoft.com/library/azure/mt163661.aspx), [nic](https://msdn.microsoft.com/library/azure/mt163668.aspx)) or PowerShell ([vnet](https://msdn.microsoft.com/library/mt603657.aspx), [nic](https://msdn.microsoft.com/library/mt619370.aspx)).</span></span>

<span data-ttu-id="78a20-242">При использовании hello классической модели развертывания, DNS-серверы для hello виртуальной сети можно указать в hello портала или [hello *сетевая конфигурация* файл](https://msdn.microsoft.com/library/azure/jj157100).</span><span class="sxs-lookup"><span data-stu-id="78a20-242">When using hello classic deployment model, DNS servers for hello virtual network can be specified in hello Portal or [hello *Network Configuration* file](https://msdn.microsoft.com/library/azure/jj157100).</span></span>  <span data-ttu-id="78a20-243">Для облачных служб DNS-серверы hello задаются с помощью [hello *конфигурации службы* файл](https://msdn.microsoft.com/library/azure/ee758710) или в PowerShell ([New-AzureVM](https://msdn.microsoft.com/library/azure/dn495254.aspx)).</span><span class="sxs-lookup"><span data-stu-id="78a20-243">For cloud services, hello DNS servers are specified via [hello *Service Configuration* file](https://msdn.microsoft.com/library/azure/ee758710) or in PowerShell ([New-AzureVM](https://msdn.microsoft.com/library/azure/dn495254.aspx)).</span></span>

> [!NOTE]
> <span data-ttu-id="78a20-244">При изменении параметров hello DNS для виртуальной сети или виртуальной машины, которая уже развернута, необходимо toorestart каждой затронутых виртуальной Машины для эффекта tootake изменения hello.</span><span class="sxs-lookup"><span data-stu-id="78a20-244">If you change hello DNS settings for a virtual network/virtual machine that is already deployed, you need toorestart each affected VM for hello changes tootake effect.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="78a20-245">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="78a20-245">Next steps</span></span>
<span data-ttu-id="78a20-246">Модель развертывания Resource Manager:</span><span class="sxs-lookup"><span data-stu-id="78a20-246">Resource Manager deployment model:</span></span>

* [<span data-ttu-id="78a20-247">Создание или обновление виртуальной сети</span><span class="sxs-lookup"><span data-stu-id="78a20-247">Create or update a virtual network</span></span>](https://msdn.microsoft.com/library/azure/mt163661.aspx)
* [<span data-ttu-id="78a20-248">Создание или обновление сетевой карты</span><span class="sxs-lookup"><span data-stu-id="78a20-248">Create or update a network interface card</span></span>](https://msdn.microsoft.com/library/azure/mt163668.aspx)
* [<span data-ttu-id="78a20-249">New-AzureRmVirtualNetwork</span><span class="sxs-lookup"><span data-stu-id="78a20-249">New-AzureRmVirtualNetwork</span></span>](https://msdn.microsoft.com/library/mt603657.aspx)
* [<span data-ttu-id="78a20-250">New-AzureRmNetworkInterface</span><span class="sxs-lookup"><span data-stu-id="78a20-250">New-AzureRmNetworkInterface</span></span>](https://msdn.microsoft.com/library/mt619370.aspx)

<span data-ttu-id="78a20-251">Классическая модель развертывания:</span><span class="sxs-lookup"><span data-stu-id="78a20-251">Classic deployment model:</span></span>

* [<span data-ttu-id="78a20-252">Схема конфигурации службы Azure</span><span class="sxs-lookup"><span data-stu-id="78a20-252">Azure Service Configuration Schema</span></span>](https://msdn.microsoft.com/library/azure/ee758710)
* [<span data-ttu-id="78a20-253">Схема конфигурации виртуальной сети</span><span class="sxs-lookup"><span data-stu-id="78a20-253">Virtual Network Configuration Schema</span></span>](https://msdn.microsoft.com/library/azure/jj157100)
* [<span data-ttu-id="78a20-254">Настройка виртуальной сети с помощью файла конфигурации сети</span><span class="sxs-lookup"><span data-stu-id="78a20-254">Configure a Virtual Network by Using a Network Configuration File</span></span>](virtual-networks-using-network-configuration-file.md) 

