---
title: "aaaResolution для виртуальных машин и экземпляров ролей"
description: "Сценарии разрешения имен для Azure IaaS, гибридных решений, между различными облачными службами, Active Directory и с помощью DNS-сервера  "
services: virtual-network
documentationcenter: na
author: GarethBradshawMSFT
manager: carmonm
editor: tysonn
ms.assetid: 5d73edde-979a-470a-b28c-e103fcf07e3e
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 12/06/2016
ms.author: telmos
ms.openlocfilehash: 0ec7903cf200c1d04d75601a5b0cefe4268f3dcf
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="name-resolution-for-vms-and-role-instances"></a>Разрешение имен для ВМ и экземпляров ролей
В зависимости от способа использования Azure toohost IaaS, PaaS и гибридных решений может потребоваться tooallow hello виртуальными машинами и экземплярами ролей, создания toocommunicate друг с другом. Несмотря на то, что это взаимодействие может осуществляться с помощью IP-адресов, это гораздо проще toouse имена, которые легко запомнить и не изменяются. 

Когда экземпляров ролей и виртуальных машин, размещенных в Azure должны tooresolve доменных имен toointernal IP-адресов, они могут использовать один из двух способов:

* [разрешение имен Azure;](#azure-provided-name-resolution)
* [Разрешение имен с помощью DNS-сервере](#name-resolution-using-your-own-dns-server) (которого возможно перенаправление запросов toohello предоставленных системой Azure DNS-серверы) 

Тип Hello разрешения имен, которые можно использовать, зависит от того, как виртуальные машины и экземпляры ролей требуется toocommunicate друг с другом.

**Hello следующей таблице представлены сценарии и соответствующие решения для разрешения имен.**

| **Сценарий** | **Решение** | **Суффикс** |
| --- | --- | --- |
| Разрешение имен между экземплярами ролей или виртуальных машин находятся в hello же облачной службы или виртуальной сети |[разрешение имен Azure;](#azure-provided-name-resolution) |имя узла или полное доменное имя |
| Разрешение имен между экземплярами ролей или виртуальными машинами, расположенными в разных виртуальных сетях |Управляемые клиентами DNS-серверы, перенаправляющие запросы между виртуальными сетями для разрешения в Azure (DNS-прокси).  См. раздел [Разрешение имен с помощью собственного DNS-сервера](#name-resolution-using-your-own-dns-server). |только полное доменное имя |
| Разрешение имен локального компьютера и службы из экземпляров роли или виртуальных машин в Azure |Управляемые клиентами DNS-серверы (например, локальный контроллер домена, локальный контроллер домена только для чтения или DNS-сервер, вторично синхронизированный с помощью передач зоны).  См. раздел [Разрешение имен с помощью собственного DNS-сервера](#name-resolution-using-your-own-dns-server). |только полное доменное имя |
| Разрешение имен узлов Azure с локальных компьютеров |Пересылки tooa под управлением прокси-сервер DNS в соответствующей виртуальной сети hello, hello прокси-сервер перенаправляет запросы tooAzure для разрешения. См. раздел [Разрешение имен с помощью собственного DNS-сервера](#name-resolution-using-your-own-dns-server). |только полное доменное имя |
| Обратный поиск DNS для внутренних IP-адресов |[разрешение имен с помощью собственного DNS-сервера.](#name-resolution-using-your-own-dns-server) |Недоступно |
| Разрешение имен между виртуальными машинами или экземплярами ролей, расположенными не в виртуальной сети, а в различных облачных службах |Не применяется Подключение между виртуальными машинами и экземплярами ролей в разных облачных службах не поддерживается за пределами виртуальной сети. |Недоступно |

## <a name="azure-provided-name-resolution"></a>разрешение имен Azure;
Кроме разрешения общедоступные DNS-имена Azure обеспечивает разрешение внутреннего имени для виртуальных машин и экземпляров ролей, которые находятся в пределах hello одной виртуальной сети или облачной службе.  Виртуальные машины и экземпляры в облачной службе совместного использования hello же DNS суффикс (то есть достаточно hello hostname сама по себе), но в разных облачных службах классические виртуальные сети имеют другие DNS-суффиксы, поэтому hello полное доменное имя необходимые tooresolve имен между разных облачных службах.  В виртуальных сетях в модели развертывания диспетчера ресурсов hello hello DNS-суффикс является согласованным для всех виртуальных сетей hello (поэтому hello полное доменное имя не требуется) и DNS-имен можно назначить tooboth сетевых адаптеров и виртуальных машин. Несмотря на то, что разрешение имен Azure не требует какой-либо настройки, это не hello правильный выбор для всех сценариев развертывания, как показано на приведенной выше таблице hello.

> [!NOTE]
> В случае hello рабочих и веб-ролей можно также перейти hello внутренние IP-адреса экземпляров ролей на hello роли имя и номер экземпляра с помощью API REST управления службами Azure hello. Дополнительные сведения см. в [справочных материалах по REST API управления службами](https://msdn.microsoft.com/library/azure/ee460799.aspx).
> 
> 

### <a name="features-and-considerations"></a>Функции и рекомендации
**Функции**

* Простота использования: в порядке toouse разрешение имен Azure не требуется никакой настройки.
* Hello предоставленных системой Azure служба разрешения имен высокой надежности, сохранение hello вы должны toocreate кластеров и управление ими DNS-серверов.
* Можно использовать в сочетании с собственного tooresolve серверами DNS как локальной, так и имена узлов Azure.
* Предоставляется разрешение имен между экземплярами роли или ВМ в hello же облачной службы без необходимости использования полного доменного ИМЕНИ.
* Разрешение имен обеспечивается между виртуальными машинами в виртуальной сети, использовать модель развертывания диспетчера ресурсов hello без необходимости hello полное доменное имя. Виртуальные сети в hello классической модели развертывания требуется hello полное доменное имя, при разрешении имен в разных облачных службах. 
* Вместо использования автоматически создаваемых имен узлов вы можете создавать имена, которые наиболее точно описывают ваши развертывания.

**Рекомендации**

* суффикс DNS, созданный Azure Hello, нельзя изменить.
* Собственные записи нельзя регистрировать вручную.
* WINS и NetBIOS не поддерживаются. (В проводнике Windows виртуальные машины не отображаются.)
* Имена узлов должны быть DNS-совместимыми (они могут содержать только символы 0–9, a–z и «-» и не могут начинаться или заканчиваться на «-». См. раздел 2 RFC 3696.)
* Трафик запросов DNS регулируется для каждой виртуальной машины. Это не должно влиять на большинство приложений.  Если наблюдается регулирование запросов, проверьте, включено ли кэширование на стороне клиента.  Дополнительные сведения см. в разделе [начало hello большинство с разрешением имен Azure](#Getting-the-most-from-Azure-provided-name-resolution).
* Для каждой виртуальной сети в классической модели развертывания регистрируются только виртуальные машины в первых 180 облачных служб hello. Это не относится к сети toovirtual в модели развертывания диспетчера ресурсов.

### <a name="getting-hello-most-from-azure-provided-name-resolution"></a>Получение hello большинство с разрешением имен Azure
**Кэширование на стороне клиента**

Не все DNS-запрос должен toobe, отправляемых по сети hello.  Кэширование на стороне клиента помогает уменьшить задержку и улучшить звуковые сигналы toonetwork устойчивости, разрешая периодические запросы DNS из локального кэша.  DNS-записи содержат срока жизни (TTL), обеспечивая запись hello toostore hello кэша в течение без влияния на актуальность записей, чтобы кэширование на стороне клиента подходит для большинства ситуаций.

по умолчанию Hello DNS-клиента Windows имеется встроенный кэш DNS.  Некоторые Linux, не включайте дистрибутивы кэширования по умолчанию, рекомендуется один, добавить tooeach ВМ Linux (после проверки того, что не существует локального кэша уже).

Существует несколько разных DNS кэширования пакетов, доступных, например dnsmasq, вот dnsmasq tooinstall действия hello в типичных дистрибутивы hello:

* **Ubuntu (используется пакет resolvconf)**:
  * просто установите пакет dnsmasq hello («sudo установки apt get dnsmasq»).
* **SUSE (используется пакет netconf)**:
  * Установите пакет dnsmasq hello («sudo zypper установки dnsmasq») 
  * Включите службу hello dnsmasq («systemctl enable dnsmasq.service») 
  * Запуск службы dnsmasq hello («systemctl начала dnsmasq.service») 
  * изменить «/ и т. д/sysconfig / / конфигурация сети» и измените NETCONFIG_DNS_FORWARDER = "» слишком «dnsmasq»
  * Обновление кэша hello («обновление netconfig») tooset хоста как hello локального разрешения имен DNS
* **OpenLogic (используется пакет NetworkManager)**:
  * Установите пакет dnsmasq hello («sudo yum установки dnsmasq»)
  * Включите службу hello dnsmasq («systemctl enable dnsmasq.service»)
  * Запуск службы dnsmasq hello («systemctl начала dnsmasq.service»)
  * Добавьте «добавить серверы доменных имен 127.0.0.1;» too"/etc/dhclient-eth0.conf»
  * Перезагрузить кэш hello сетевой службы («сеть перезапуска службы») tooset hello hello локального разрешения имен DNS

> [!NOTE]
> пакет «dnsmasq» Hello используется только одно из hello много кэша DNS для Linux.  Перед его использованием проверьте, соответствует ли он вашим потребностям, а также не установлен ли у вас другой кэш.
> 
> 

**Повторные попытки на стороне клиента**

DNS использует преимущественно протокол UDP.  Как hello протокол UDP не гарантирует доставку сообщений, в сам протокол DNS hello обрабатывается логику повторных попыток.  Каждый клиент DNS (операционная система) можно достичь логика повторов разные в зависимости от предпочтений создатели hello:

* ОС Windows выполняет повторную попытку через 1 с, затем через 2 и 4 с, а затем снова через 4 с. 
* Здравствуйте, повторные попытки установки Linux по умолчанию через 5 секунд.  Это рекомендуется это tooretry toochange 5 раз с интервалом 1 секунд.  

toocheck hello текущие параметры на виртуальной Машине Linux «/etc/resolv.conf cat» и найдите в строке «параметры» hello, например:

    options timeout:1 attempts:5

файл хоста Hello обычно автоматически создается и не следует изменять.  Hello конкретные шаги для добавления строки hello «параметры» зависят от дистрибутив:

* **Ubuntu** (используется пакет resolvconf):
  * добавить too'/etc/resolveconf/resolv.conf.d/head строку hello параметры " 
  * Запустите tooupdate «resolvconf -u»
* **SUSE** (используется пакет netconf):
  * добавить toohello 'timeout:1 попыток: 5' NETCONFIG_DNS_RESOLVER_OPTIONS = "» параметра в «/ и т. д/sysconfig / / конфигурация сети» 
  * Запустите tooupdate «netconfig обновления»
* **OpenLogic** (используется пакет NetworkManager):
  * добавить too'/etc/NetworkManager/dispatcher.d/11-dhclient «echo «параметры timeout:1 попыток: 5»» " 
  * Запустите tooupdate «перезапуск службы сети»

## <a name="name-resolution-using-your-own-dns-server"></a>разрешение имен с помощью собственного DNS-сервера.
Существует множество ситуаций, ваших потребностей разрешения имен может переход за пределы hello функции, предоставляемые Azure, например при использование доменов Active Directory, или когда требуется разрешение DNS между виртуальных сетей (vnet).  toocover эти сценарии Azure предоставляет возможность hello вы toouse DNS-серверы.  

DNS-серверы в виртуальной сети можно переслать распознаватели рекурсивные запросы tooAzure DNS tooresolve имена узлов в этой виртуальной сети.  Например контроллеру домена (DC) в Azure можно реагировать tooDNS запрашивает его доменов и пересылать все другие tooAzure запросы.  Это позволяет toosee ВМ локальными ресурсами (с помощью hello контроллера домена) и имена узлов предоставленное Azure (через сервер пересылки hello).  TooAzure доступа рекурсивных сопоставителей обеспечивается за счет hello виртуального IP-адреса 168.63.129.16.

Перенаправление запросов DNS также позволяет разрешение DNS исходящий трафик внутри виртуальной сети и вашей локальной машины tooresolve имена узлов, предоставленное Azure.  Чтобы tooresolve имя узла Виртуальной машины, hello DNS-сервера виртуальной Машины должны находиться в hello же виртуальной сети и быть tooAzure запросы настроенных tooforward имя узла.  DNS-суффикс hello отличается в каждой виртуальной сети, можно использовать условное перенаправление правила toosend DNS запрашивает toohello исправить виртуальной сети для разрешения.  Следующие изображения Hello показывает двух виртуальных сетей и локальной сетью, выполнив разрешение DNS исходящий трафик внутри виртуальной сети с помощью этого метода.  DNS-сервер пересылки пример доступен в hello [коллекции шаблонов быстрый запуск Azure](https://azure.microsoft.com/documentation/templates/301-dns-forwarder/) и [GitHub](https://github.com/Azure/azure-quickstart-templates/tree/master/301-dns-forwarder).

![Разрешение имен DNS между виртуальными сетями](./media/virtual-networks-name-resolution-for-vms-and-role-instances/inter-vnet-dns.png)

При использовании разрешения имен, предоставленное Azure, внутренние DNS-суффикс (*. internal.cloudapp.net) предоставленного tooeach виртуальной Машины с помощью DHCP.  Это включает разрешение имен узлов в качестве узла hello, записей в зоне internal.cloudapp.net hello.  При использовании собственного решения разрешения имени, приветствия имена IDN суффикс не указано tooVMs, так как он мешает других архитектур DNS (например, сценарии, присоединенных к домену).  Вместо этого мы предоставляем фиктивный заполнитель (reddog.microsoft.com).  

При необходимости hello внутренние DNS-суффикс может определяться с помощью PowerShell или hello API:

* Для виртуальных сетей в модели развертывания диспетчера ресурсов суффикс hello доступна через hello [сетевой адаптер](https://msdn.microsoft.com/library/azure/mt163668.aspx) ресурсов или с помощью hello [Get AzureRmNetworkInterface](https://msdn.microsoft.com/library/mt619434.aspx) командлета.    
* В классическом развертывании моделей, суффикс hello доступна через hello [получить API развертывания](https://msdn.microsoft.com/library/azure/ee460804.aspx) вызова или с помощью hello [Get-AzureVM-Отладка](https://msdn.microsoft.com/library/azure/dn495236.aspx) командлета.

Если пересылка запросов tooAzure не подходят, вам потребуется tooprovide собственное решение DNS.  Ваше решение DNS должно:

* Предоставлять корректное разрешение имен, например, с помощью [DDNS](virtual-networks-name-resolution-ddns.md).  Обратите внимание, что если с помощью DDNS, может потребоваться toodisable DNS очистки записей аренды DHCP Azure имеют слишком большую длину и очистки может удалить службу DNS записи преждевременно. 
* Укажите соответствующие рекурсивного разрешения tooallow разрешения внешних доменных имен.
* Быть доступны (TCP и UDP-порт 53) от клиентов hello предназначенный и tooaccess может быть hello Интернета.
* Защищены от доступа из hello Интернет угрозы toomitigate внешних агентов.

> [!NOTE]
> Для наилучшей производительности при использовании виртуальных машин Azure в качестве DNS-серверы должны быть отключены IPv6 и [общедоступный IP-адрес уровня экземпляра](virtual-networks-instance-level-public-ip.md) следует назначать tooeach DNS-сервера виртуальной Машины.  Если выбрать toouse Windows Server в качестве DNS-сервера, [в этой статье](http://blogs.technet.com/b/networking/archive/2015/08/19/name-resolution-performance-of-a-recursive-windows-dns-server-2012-r2.aspx) предоставляет анализ производительности и оптимизации.
> 
> 

### <a name="specifying-dns-servers"></a>Указание DNS-серверов
При использовании DNS-серверы, Azure предоставляет возможность toospecify hello несколько DNS-серверов для каждой виртуальной сети или в сетевой интерфейс (диспетчера ресурсов) / облачной службы (классические).  DNS-серверы, указанные для облачной службы или сетевого интерфейса получить более высокий приоритет над указанными для hello виртуальной сети.

> [!NOTE]
> Свойства сетевых подключений, такие как DNS-сервером IP-адресов, не следует изменять непосредственно в ВМ Windows, они могут получить удалены во время обновления, автоматическое восстановление при возвращает замены hello виртуального сетевого адаптера. 
> 
> 

При использовании модели развертывания диспетчера ресурсов hello в hello портала API или шаблоны можно указать DNS-серверы ([vnet](https://msdn.microsoft.com/library/azure/mt163661.aspx), [сетевых](https://msdn.microsoft.com/library/azure/mt163668.aspx)) или PowerShell ([виртуальной сети](https://msdn.microsoft.com/library/mt603657.aspx), [сетевых](https://msdn.microsoft.com/library/mt619370.aspx)).

При использовании hello классической модели развертывания, DNS-серверы для hello виртуальной сети можно указать в hello портала или [hello *сетевая конфигурация* файл](https://msdn.microsoft.com/library/azure/jj157100).  Для облачных служб DNS-серверы hello задаются с помощью [hello *конфигурации службы* файл](https://msdn.microsoft.com/library/azure/ee758710) или в PowerShell ([New-AzureVM](https://msdn.microsoft.com/library/azure/dn495254.aspx)).

> [!NOTE]
> При изменении параметров hello DNS для виртуальной сети или виртуальной машины, которая уже развернута, необходимо toorestart каждой затронутых виртуальной Машины для эффекта tootake изменения hello.
> 
> 

## <a name="next-steps"></a>Дальнейшие действия
Модель развертывания Resource Manager:

* [Создание или обновление виртуальной сети](https://msdn.microsoft.com/library/azure/mt163661.aspx)
* [Создание или обновление сетевой карты](https://msdn.microsoft.com/library/azure/mt163668.aspx)
* [New-AzureRmVirtualNetwork](https://msdn.microsoft.com/library/mt603657.aspx)
* [New-AzureRmNetworkInterface](https://msdn.microsoft.com/library/mt619370.aspx)

Классическая модель развертывания:

* [Схема конфигурации службы Azure](https://msdn.microsoft.com/library/azure/ee758710)
* [Схема конфигурации виртуальной сети](https://msdn.microsoft.com/library/azure/jj157100)
* [Настройка виртуальной сети с помощью файла конфигурации сети](virtual-networks-using-network-configuration-file.md) 

