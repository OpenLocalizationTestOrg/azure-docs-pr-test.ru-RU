---
title: "Асинхронное обновление для моделей служб Analysis Services Azure | Документы Microsoft"
description: "Дополнительные сведения о код асинхронное обновление с использованием API-интерфейса REST."
services: analysis-services
documentationcenter: 
author: minewiskan
manager: kfile
editor: 
tags: 
ms.assetid: 
ms.service: analysis-services
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: na
ms.date: 12/18/2017
ms.author: owend
ms.openlocfilehash: 06d807b83f700c675c6979998dd8f74372a4845f
ms.sourcegitcommit: b5c6197f997aa6858f420302d375896360dd7ceb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/21/2017
---
# <a name="asynchronous-refresh-with-the-rest-api"></a>Асинхронное обновление с помощью API REST
С помощью любого языка программирования, поддерживающего вызовы REST, можно выполнять операции асинхронного обновления данных с табличными моделями служб Azure Analysis Services. Это включает синхронизацию реплик только для чтения для запроса масштабного развертывания. 

Операции обновления данных может занять некоторое время в зависимости от ряда факторов, включая объем данных и уровня оптимизации с помощью разделов и т. д. Эти операции обычно был вызван с существующие методы, например, с помощью [TOM](https://docs.microsoft.com/sql/analysis-services/tabular-model-programming-compatibility-level-1200/introduction-to-the-tabular-object-model-tom-in-analysis-services-amo) (табличной объектной модели), [PowerShell](https://docs.microsoft.com/sql/analysis-services/powershell/analysis-services-powershell-reference) командлетов, или [TMSL](https://docs.microsoft.com/sql/analysis-services/tabular-model-scripting-language-tmsl-reference) (табличной модели. Язык сценариев). Однако эти методы могут требовать часто ненадежным, длительные подключения по протоколу HTTP.

API-Интерфейс REST для служб Azure Analysis Services позволяют выполняться асинхронно операции обновления данных. С помощью API-интерфейса REST, длительные соединения HTTP из клиентских приложений не являются обязательными. Также существуют другие встроенные возможности для обеспечения надежности, таких как повторные попытки автоматического и фиксации в пакетном режиме.

## <a name="base-url"></a>Базовый URL-адрес

Базовый URL-адрес имеет следующий формат:

```
https://<rollout>.asazure.windows.net/servers/<serverName>/models/<resource>/
```

Например, рассмотрим модель с именем AdventureWorks, на сервере MyServer, расположенных в регионе Azure Запад США, имя сервера:

```
asazure://westus.asazure.windows.net/myserver 
```

— Базовый URL-адрес для этого имени сервера:

```
https://westus.asazure.windows.net/servers/myserver/models/AdventureWorks/ 
```

С помощью базовый URL-адрес, ресурсы и операции могут быть добавлены на основе следующих: 

![Асинхронные обновления](./media/analysis-services-async-refresh/aas-async-refresh-flow.png)

- Все, что заканчивается на **s** — это коллекция.
- Все, что заканчивается **()** является функцией.
- Нибудь представляет собой ресурс или объект.

Например можно использовать команду POST на обновляет коллекцию для выполнения операции обновления, следующим образом:

```
https://westus.asazure.windows.net/servers/myserver/models/AdventureWorks/refreshes
```

## <a name="authentication"></a>Authentication

Все вызовы должны проходить проверку подлинности с допустимым токеном Azure Active Directory (OAuth 2) в заголовке авторизации и должны соответствовать следующим требованиям:

- Токен должен быть маркер пользователя или участника службы приложения.
- Пользователь или приложение необходимо иметь достаточные разрешения, на сервере или модели для выполнения запрошенного вызова. Уровень разрешений, определяется ролей в модели или группу администраторов на сервере.
- Токен должен иметь правильный аудитории, равным `https://*.asazure.windows.net`.

## <a name="post-refreshes"></a>POST /refreshes

Для выполнения операции обновления, используйте команду POST /refreshes коллекции для добавления нового обновления элемента в коллекцию. Заголовок Location в ответе включает идентификатор обновления. Клиентское приложение может отключить и проверить состояние позже, если требуется, так как он является асинхронным.

Во время для модели принимается только одна операция обновления. Если имеется текущей выполняющейся операции обновления и другой отправляется, возвращается код состояния 409 конфликт HTTP.

Текст может выглядеть следующим образом:

```
{
    "Type": "Full",
    "CommitMode": "transactional",
    "MaxParallelism": 2,
    "RetryCount": 2,
    "Objects": [
        {
            "table": "DimCustomer",
            "partition": "DimCustomer"
        },
        {
            "table": "DimDate"
        }
    ]
}
```

### <a name="parameters"></a>Параметры
Указание параметров не требуется. Значение по умолчанию применяется.

|ИМЯ  |type  |ОПИСАНИЕ  |значение по умолчанию  |
|---------|---------|---------|---------|
|type     |  Перечисление.       |  Тип обработки. Типы используются в соответствии с TMSL [команда "Обновить"](https://docs.microsoft.com/sql/analysis-services/tabular-models-scripting-language-commands/refresh-command-tmsl) типов: полный, clearValues, вычисления, dataOnly, автоматическое, добавления и дефрагментации.       |   Автоматически      |
|CommitMode     |  Перечисление.       |  Определяет, если объекты будут зафиксированы в пакетах, или только после завершения. Включить режимы: транзакций, partialBatch по умолчанию.  |  Транзакций       |
|MaxParallelism     |   int      |  Это значение определяет максимальное количество потоков для параллельного выполнения команд обработки. Это соответствует MaxParallelism свойство, которое может быть задано в TMSL [последовательности команд](https://docs.microsoft.com/sql/analysis-services/tabular-models-scripting-language-commands/sequence-command-tmsl) или другими способами.       | 10        |
|RetryCount    |    int     |   Указывает число попыток повтора операции до сбоя.      |     0    |
|Объекты     |   Массив,      |   Массив объектов для обработки. Каждый объект включает: «table», при обработке всей таблицы или «table» и «секции», при обработке секции. Если объекты не указаны, обновляются всю модель. |   Обработка всей модели      |

CommitMode равно partialBatch. Оно используется при выполнении начальной загрузки для больших наборов данных, может занять часов. Если операция обновления завершается после успешной фиксации один или несколько пакетов, успешно зафиксированной пакетов будет остаются зафиксированными (ее откат не будет успешно зафиксирована пакетов).

> [!NOTE]
> На момент написания статьи размер пакета равен значение MaxParallelism, но это значение может изменяться.

## <a name="get-refreshesrefreshid"></a>GET /refreshes/\<refreshId >

Чтобы проверить состояние операции обновления, используйте команду GET по идентификатору обновления Ниже приведен пример текста ответа. Если операция выполняется, **inProgress** возвращается в состояние.

```
{
    "startTime": "2017-12-07T02:06:57.1838734Z",
    "endTime": "2017-12-07T02:07:00.4929675Z",
    "type": "full",
    "status": "succeeded",
    "currentRefreshType": "full",
    "objects": [
        {
            "table": "DimCustomer",
            "partition": "DimCustomer",
            "status": "succeeded"
        },
        {
            "table": "DimDate",
            "partition": "DimDate",
            "status": "succeeded"
        }
    ]
}
```

## <a name="get-refreshes"></a>ПОЛУЧИТЬ /refreshes

Чтобы получить список операций журнала обновления для модели, используйте команду GET /refreshes коллекции. Ниже приведен пример текста ответа. 

> [!NOTE]
> На момент написания статьи сохраняются и возвращаются за последние 30 дней операций обновления, но это число можно изменить.

```
[
    {
        "refreshId": "1344a272-7893-4afa-a4b3-3fb87222fdac",
        "startTime": "2017-12-09T01:58:04.76",
        "endTime": "2017-12-09T01:58:12.607",
        "status": "succeeded"
    },
    {
        "refreshId": "474fc5a0-3d69-4c5d-adb4-8a846fa5580b",
        "startTime": "2017-12-07T02:05:48.32",
        "endTime": "2017-12-07T02:05:54.913",
        "status": "succeeded"
    }
]
```

## <a name="delete-refreshesrefreshid"></a>Удаление /refreshes/\<refreshId >

Чтобы отменить операцию обновления в процессе выполнения, используйте команду удаления идентификатор обновления.

## <a name="post-sync"></a>POST/Sync

Факт выполнения операций обновления, возможно требуется синхронизировать с репликами для масштабного развертывания запроса новых данных. Чтобы выполнить операцию синхронизации для модели, используйте команду POST на функцию/Sync. Заголовок Location в ответе включает идентификатор операции синхронизации.

## <a name="get-sync-status"></a>ПОЛУЧИТЬ состояние/Sync

Чтобы проверить состояние операции синхронизации, используйте команду GET, передав в качестве параметра идентификатор операции. Ниже приведен пример текста ответа:

```
{
    "operationId": "cd5e16c6-6d4e-4347-86a0-762bdf5b4875",
    "database": "AdventureWorks2",
    "UpdatedAt": "2017-12-09T02:44:26.18",
    "StartedAt": "2017-12-09T02:44:20.743",
    "syncstate": 2,
    "details": null
}
```

Значения для состояние:

- 0: репликации. Файлы базы данных реплицируются в конечную папку.
- 1: восстановление. Базы данных является восстанавливались на экземпляры сервера только для чтения.
- 2: завершено. Операция синхронизации успешно завершена.
- 3: не удалось. Не удалось выполнить операцию синхронизации.
- 4: завершение. Завершена операция синхронизации, но выполняет действия очистки.

## <a name="code-sample"></a>Пример кода

Ниже приведен пример кода C# можно приступить к работе, [RestApiSample на GitHub](https://github.com/Microsoft/Analysis-Services/tree/master/RestApiSample).

### <a name="to-use-the-code-sample"></a>Чтобы использовать образец кода

1.  Клонировать или загрузите репозитория. Откройте решение RestApiSample.
2.  Найдите строку **клиента. BaseAddress =...** и укажите ваш [базовый URL-адрес](#base-url).

В образце кода используется интерактивный вход в систему, имя пользователя и пароль, или [участника-службы](#service-principle).

#### <a name="interactive-login-or-usernamepassword"></a>Интерактивный вход в систему или имя пользователя и пароль

Эта форма проверки подлинности требуется создать приложение Azure с необходимыми разрешениями API, которые назначены. 

1.  На портале Azure щелкните **New** > **Azure Active Directory** > **регистрации приложения** > **New Регистрация приложения**.

    ![Регистрация нового приложения](./media/analysis-services-async-refresh/aas-async-app-reg.png)


2.  В **создать**, введите имя, выберите **собственного** типа приложения. Для **URI перенаправления**, введите **urn: ietf:wg:oauth:2.0:oob**, а затем нажмите кнопку **создать**.

    ![Параметры](./media/analysis-services-async-refresh/aas-async-app-reg-name.png)

3.  Выберите приложение, затем скопируйте и сохраните **идентификатор приложения**.

    ![Скопируйте идентификатор приложения](./media/analysis-services-async-refresh/aas-async-app-id.png)

4.  В **параметры**, нажмите кнопку **разрешения, необходимые** > **добавить**.

    ![Добавить доступ через API](./media/analysis-services-async-refresh/aas-async-add.png)

5.  В **выберите API**, тип **SQL Server Analysis Services** в поле поиска, а затем выберите **Azure Analysis Services (SQL Server Analysis Services Azure)**.

    ![Выбрать API](./media/analysis-services-async-refresh/aas-async-select-api.png)

6.  Выберите **чтение и запись всех моделей**, а затем нажмите кнопку **выберите**. Если установлены оба флажка, нажмите кнопку **сделать** добавить разрешения. Он может занять несколько минут для распространения.

    ![Выберите чтение и запись всех моделей](./media/analysis-services-async-refresh/aas-async-select-read.png)

7.  В образце кода найдите **UpdateToken()** метод. Просмотрите содержимое этого метода.
8.  Найти **строка clientID =...** , а затем введите **идентификатор приложения** скопированный на шаге 3.
9.  Запустите пример.

#### <a name="service-principal"></a>Субъект-служба

В разделе [автоматизации служб Azure Analysis Services с субъектами-службами и PowerShell](https://azure.microsoft.com/blog/automation-of-azure-analysis-services-with-service-principals-and-powershell/) записи блога как настроить субъект-службу и назначить необходимые разрешения в Azure Analysis Services. После выполнения действия, описанные в записи блога, выполните следующие дополнительные действия.

1.  В образце кода найдите **строка центра =...** , замените **Общие** вашей организации клиента идентификатор.
2.  Комментарий или раскомментируйте ClientCredential класс используется для создания экземпляра объекта cred. Убедитесь, \<идентификатор приложения > и \<ключ приложения > значений осуществляется безопасным способом, или использовать проверку подлинности на основе сертификатов для участников службы.
3.  Запустите пример.


## <a name="see-also"></a>См. также

[Примеры](analysis-services-samples.md)   
[REST API](https://docs.microsoft.com/rest/api/analysisservices/servers)   


