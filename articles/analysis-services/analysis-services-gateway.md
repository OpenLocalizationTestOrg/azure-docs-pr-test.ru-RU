---
title: "aaaOn локальный шлюз данных | Документы Microsoft"
description: "Локальный шлюз необходим в том случае, если сервер служб Analysis Services в Azure будут подключаться tooon локальные источники данных."
services: analysis-services
documentationcenter: 
author: minewiskan
manager: erikre
editor: 
tags: 
ms.assetid: cd596155-b608-4a34-935e-e45c95d884a9
ms.service: analysis-services
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: na
ms.date: 08/21/2017
ms.author: owend
ms.openlocfilehash: fc7b9c69e6f81b41deb7a5d6d963225593845d84
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="connecting-tooon-premises-data-sources-with-azure-on-premises-data-gateway"></a>Соединение tooon локальные источники данных с помощью Azure на локальный шлюз данных
Hello локального шлюза данных выступает в качестве моста, обеспечивая безопасную передачу данных между локальным источникам данных и серверов в облаке hello Azure Analysis Services. В дополнение tooworking с несколькими серверами служб Azure Analysis Services в hello же регионе, hello последнюю версию шлюза hello также работает с логику приложения Azure, Power BI, приложения Power и Microsoft Flow. Можно связать несколько служб в hello совпадают с одного шлюза. 

 Azure Analysis Services требуется ресурс шлюза в hello одного региона. Например при наличии серверов служб Analysis Services Azure в регионе Восток США 2 hello необходимо ресурса шлюза в регионе Восток США 2 hello. Несколько серверов в восточная часть США 2 можно использовать hello одного шлюза.

Начало установки с hello шлюза hello первый раз процесс состоит из четырех частей.

- **Скачивание и запуск программы установки.** На этом шаге устанавливается служба шлюза на компьютер организации.

- **Зарегистрируйте свой шлюз** — на этом шаге укажите имя и восстановления ключа для шлюза и выберите регион, регистрация шлюза в облачной службе шлюза hello.

- **Создание ресурса шлюза в Azure.** На этом шаге необходимо создать ресурс шлюза в подписке Azure.

- **Подключение ресурса серверы шлюза tooyour** -после ресурсов шлюза в подписке, можно начать подключение к tooit серверов.

При наличии шлюза ресурс, настроенный для вашей подписки, можно подключить несколько серверов и других служб tooit. Только требуется tooinstall другой шлюз и создавать шлюза дополнительных ресурсов при наличии серверов или других служб в другом регионе.

tooget работу прямо сейчас. в разделе [установить и настроить локальный шлюз данных](analysis-services-gateway-install.md).

## <a name="how-it-works"> </a>Принцип работы
Hello шлюза, установить на компьютере в организации выполняется как служба Windows, **локального шлюза данных**. Это локальная служба зарегистрирована hello облачной службе шлюза через Azure Service Bus. Затем создается ресурс шлюза в службе Gateway Cloud для подписки Azure. В Azure со службами Analysis Services серверов, затем подключен tooyour ресурса шлюза. При модели на ваш сервер необходимость tooconnect tooyour локальных источников данных для запросов и обработки, запросов и данных потока перебирает hello шлюза ресурса, Azure Service Bus hello служба шлюза локальных данных и источников данных. 

![Принцип работы](./media/analysis-services-gateway/aas-gateway-how-it-works.png)

Запросы и поток данных

1. Запрос создается путем hello облачной службы с hello зашифрованные учетные данные для источника данных в локальной среде hello. Затем он отправил tooa очереди шлюза tooprocess hello.
2. облачной службе шлюза Hello анализирует запрос hello и помещает hello запроса toohello [Azure Service Bus](https://azure.microsoft.com/documentation/services/service-bus/).
3. Hello локальный шлюз данных опрашивает hello Azure Service Bus для ожидающих запросов.
4. Hello шлюз получает запрос hello, расшифровывает учетные данные hello и соединяет источники данных toohello с этими учетными данными.
5. шлюз Hello отправляет источник данных toohello hello запросов для выполнения.
6. Hello результаты отправляются из источника данных hello, шлюз toohello назад, а затем на облачную службу hello и сервера.

## <a name="windows-service-account"> </a>Учетная запись службы Windows
Hello локального шлюза данных является настроенным toouse *NT SERVICE\PBIEgwService* для учетных данных входа для службы Windows hello. По умолчанию она содержит hello правого входа как службы; в контексте hello hello компьютера, на котором вы устанавливаете hello шлюза. Эти учетные данные не hello, же учетная запись, используемая tooconnect tooon локальные источники данных или учетной записью Azure.  

При возникновении проблем с прокси-сервера из-за tooauthentication, вы можете toochange hello Windows или управляемые службы учетной записи пользователя домена tooa учетной записи службы.

## <a name="ports"> </a>Порты
Hello шлюз создает исходящее подключение tooAzure Service Bus. Он обменивается данными через исходящие порты: TCP 443 (по умолчанию), а также 5671, 5672 и 9350–9354.  Hello шлюзу не требуются входящие порты.

Мы рекомендуем белого списка hello IP-адреса для своего региона данных через брандмауэр. Вы можете загрузить hello [список IP-адресов центра обработки данных Microsoft Azure](https://www.microsoft.com/download/details.aspx?id=41653). Список обновляется раз в неделю.

> [!NOTE]
> Hello IP-адресов в списке IP-центра обработки данных Azure hello находятся в нотации CIDR. Например, 10.0.0.0/24 не означает 10.0.0.0–10.0.0.24. Дополнительные сведения о hello [в CIDR-нотации](http://whatismyipaddress.com/cidr).
>
>

Здесь представлены Hello hello полные доменные имена, используемый шлюзом hello.

| Имена доменов | Исходящие порты | Description (Описание) |
| --- | --- | --- |
| *.powerbi.com |80 |Установщик hello toodownload используется HTTP. |
| *.powerbi.com |443 |HTTPS |
| *.analysis.windows.net |443 |HTTPS |
| *.login.windows.net |443 |HTTPS |
| *.servicebus.windows.net |5671–5672 |Протокол AMQP |
| *.servicebus.windows.net |443, 9350–9354 |Прослушиватели ретрансляции служебной шины по протоколу TCP (порт 443 требуется для получения маркера контроля доступа). |
| *.frontend.clouddatahub.net |443 |HTTPS |
| *.core.windows.net |443 |HTTPS |
| login.microsoftonline.com |443 |HTTPS |
| *.msftncsi.com |443 |Подключение к Интернету tootest используется в том случае, если шлюз hello недоступен для hello службы Power BI. |
| *.microsoftonline-p.com |443 |Используется для проверки подлинности в зависимости от конфигурации. |

### <a name="force-https"></a>Принудительное взаимодействие протокола HTTPS со служебной шиной Azure
Можно принудительно toocommunicate hello шлюза с Azure Service Bus с помощью HTTPS вместо прямого TCP; Тем не менее это таким образом может значительно снизить производительность. Вы можете изменить hello *Microsoft.PowerBI.DataMovement.Pipeline.GatewayCore.dll.config* файла, изменив значение hello с `AutoDetect` слишком`Https`. Обычно этот файл находится в расположении *C:\Program Files\On-premises data gateway*.

```
<setting name="ServiceBusSystemConnectivityModeString" serializeAs="String">
    <value>Https</value>
</setting>
```

## <a name="faq"></a>Часто задаваемые вопросы

### <a name="general"></a>Общие сведения

**Q**: требуется использовать шлюз для источников данных в облаке hello, таких как базы данных SQL Azure? <br/>
**Ответ**. Нет. Шлюз соединяет локальные tooon только источники данных.

**Q**: hello шлюза имеет toobe установлен на компьютер же, как источник данных hello hello? <br/>
**Ответ**. Нет. toohello источника данных, используя сведения о соединении hello, предоставленный подключение шлюза Hello. Рассмотрим hello шлюза как клиентское приложение в этом смысле. Hello шлюз требуется только hello возможность tooconnect toohello имя сервера, предоставленный, обычно на hello же сети.

<a name="why-azure-work-school-account"></a>

**Q**: Почему требуется toouse рабочей или учебной учетной записи toosign в? <br/>
**Объект**: только можно использовать Azure на работе или рабочую учетную запись при установке hello локальный шлюз данных. Учетная запись для входа хранится в клиенте, которым управляет Azure Active Directory (Azure AD). Как правило учетной записи Azure AD имя участника-пользователя (UPN) соответствует адресу электронной почты hello.

**Вопрос**. Где хранятся мои учетные данные? <br/>
**Объект**: зашифрованы и хранятся в облачной службе шлюза hello hello учетные данные, введенные для источника данных. Hello они расшифровываются hello локальный шлюз данных.

**Вопрос**. Есть ли какие-либо требования к пропускной способности сети? <br/>
**Ответ.** Пропускная способность сети должна быть высокой. Каждая среда имеет свои и hello объем отправляемых данных влияет на результаты hello. С помощью ExpressRoute может помочь tooguarantee определенную пропускную способность между локальной и hello центрами обработки данных Azure.
Можно использовать пропускную способность hello стороннего средства Azure скорость тестирования приложения toohelp датчика.

**Q**: что такое hello задержку для выполнения запросов источника данных tooa из шлюза hello? Что такое hello оптимальная архитектура? <br/>
**Объект**: tooreduce задержку в сети и установить шлюз hello закрыть toohello источник данных как можно. При установке шлюза hello hello фактические данные источника этого выражения с учетом сводит к минимуму задержки hello, введенной. Рассмотрим слишком hello центрах обработки данных. Например если служба использует hello Запад США центра обработки данных и сервер SQL Server, размещенных на виртуальной Машине Azure, ВМ Azure должны находиться в hello Запад США слишком. Это выражение с учетом сводит к минимуму задержки и позволяет избежать расходов на исходящие данные на виртуальной Машине Azure hello.

**Q**: как являются облачной серверной toohello набор результатов? <br/>
**Объект**: результаты отправляются через hello Azure Service Bus.

**Q**: существуют шлюза toohello все входящие подключения из облака hello? <br/>
**Ответ**. Нет. шлюз Hello использует tooAzure исходящие подключения Service Bus.

**Вопрос**. Что делать, если мной заблокированы исходящие подключения? Что делать мне tooopen? <br/>
**Объект**: hello порты и узлы, которые использует шлюз hello. в разделе.

**Q**: как называется соответствующая служба Windows hello?<br/>
**Объект**: В службах, hello шлюз указан под именем локальной службы шлюза данных.

**Q**: можно запускать с учетной записью Azure Active Directory служба Windows шлюза "hello"? <br/>
**Ответ**. Нет. Служба Windows Hello должен иметь допустимую учетную запись Windows. По умолчанию hello служба запускается с hello SID службы NT SERVICE\PBIEgwService.

### <a name="high-availability"></a>Высокий уровень доступности и аварийное восстановление

**Вопрос**. Какие варианты доступны для аварийного восстановления? <br/>
**Объект**: можно использовать toorestore ключа восстановления hello или переноса шлюза. При установке шлюза hello, укажите ключ восстановления hello.

**Q**: что такое преимущество hello hello ключ восстановления? <br/>
**Объект**: hello ключ восстановления предоставляет toomigrate способом или восстановить параметры шлюза после сбоя.

## <a name="troubleshooting"> </a>Устранение неполадок

**Q**: как я могу узнать, какие запросы отправляются toohello к локальному источнику данных? <br/>
**Объект**: можно включить трассировку запроса, включая hello запросы, отправленные. Не забывайте toochange запроса отслеживания в обратном toohello исходное значение после завершения устранения неполадок. При включенной трассировке запросов создаются журналы большего размера.

Кроме того, можно рассмотреть инструменты трассировки запросов, доступные для вашего источника данных. Например, можно использовать расширенные события или SQL Profiler для SQL Server и служб Analysis Services.

**Q**: где находятся журналы шлюза hello? <br/>
**Ответ**. См. раздел "Журналы" далее в этой статье.

### <a name="update"></a>Последнюю версию обновления toohello

Многие проблемы могут возникать при устаревшей версии шлюза hello. В качестве общих рекомендаций убедитесь, что используется последняя версия hello. Hello шлюз не обновлялся в течение месяца или более, может рекомендуется установить последнюю версию шлюза hello hello и разделе, если можно воспроизвести проблему hello.

### <a name="error-failed-tooadd-user-toogroup--2147463168-pbiegwservice-performance-log-users"></a>: Ошибка toogroup tooadd пользователя. (-2147463168 PBIEgwService Performance Log Users ) (-2147463168 пользователей журналов производительности PBIEgwService)

Эту ошибку можно получить, если при попытке tooinstall hello шлюз на контроллере домена, который не поддерживается. Убедитесь, что развертывании hello шлюза на компьютере, который не контроллер домена.

## <a name="logs"></a>Журналы

Файлы журналов являются важным ресурсом при устранении неполадок.

#### <a name="enterprise-gateway-service-logs"></a>Журналы службы корпоративного шлюза

`C:\Users\PBIEgwService\AppData\Local\Microsoft\On-premises data gateway\<yyyyymmdd>.<Number>.log`

#### <a name="configuration-logs"></a>Журналы конфигурации

`C:\Users\<username>\AppData\Local\Microsoft\On-premises data gateway\GatewayConfigurator.log`




#### <a name="event-logs"></a>Журналы событий

Найти hello журналы шлюза управления данными и PowerBIGateway **журналы приложений и служб**.


## <a name="telemetry"></a>Телеметрия
Телеметрию можно использовать для мониторинга и устранения неполадок. По умолчанию

**tooturn телеметрию**

1.  Проверьте hello локальных данных шлюза клиентский каталог на компьютере hello. Обычно это каталог **%системный_диск%\Program Files\On-premises data gateway**. Или откройте консоль служб и проверьте путь tooexecutable hello: свойство службы шлюза hello локальных данных.
2.  В файле Microsoft.PowerBI.DataMovement.Pipeline.GatewayCore.dll.config hello из каталога клиента. Измените параметр tootrue hello SendTelemetry.
        
    ```
        <setting name="SendTelemetry" serializeAs="String">
                    <value>true</value>
        </setting>
    ```

3.  Сохраните изменения и перезапустите службу Windows hello: локальная служба шлюза данных.




## <a name="next-steps"></a>Дальнейшие действия
* [Управление службами Analysis Services](analysis-services-manage.md)
* [Получение данных из служб Azure Analysis Services](analysis-services-connect.md)
