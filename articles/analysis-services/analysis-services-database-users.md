---
title: "Управление ролями и пользователями базы данных в службах Azure Analysis Services | Документация Майкрософт"
description: "Узнайте, как управлять ролями и пользователями базы данных на сервере служб Analysis Services в Azure."
services: analysis-services
documentationcenter: 
author: minewiskan
manager: erikre
editor: 
tags: 
ms.assetid: 
ms.service: analysis-services
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: na
ms.date: 08/15/2017
ms.author: owend
ms.openlocfilehash: d0bc7d7514f111b4bbde33bd60ae21264bd797fc
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="manage-database-roles-and-users"></a>Управление ролями и пользователями базы данных

На уровне шаблона базы данных всем пользователям должна быть назначена роль. Роли определяют пользователей с определенными разрешениями для шаблона базы данных. Любой пользователь или группа безопасности, добавленные в роль, должны иметь учетную запись в клиенте Azure AD в одной подписке с сервером.

Способ определения ролей отличается в зависимости от используемого средства, но на результат это не влияет.

Разрешения ролей включают следующие:
*  **Администратор**. Пользователи имеют полный набор прав в отношении базы данных. Роли базы данных с разрешениями администратора и администраторы сервера — это не одно и тоже.
*  **Процесс**. Пользователи могут подключаться к базе данных и выполнять операции обработки, а также анализировать данные шаблона базы данных.
*  **Чтение**. Пользователи могут использовать клиентское приложение, чтобы подключиться к шаблону базы данных и анализировать его данные.

При создании проекта табличной модели вы можете создать роли и добавить пользователей или группы в эти роли с помощью диспетчера ролей в SSDT. При развертывании на сервере вы можете использовать SSMS, [командлеты PowerShell для служб Analysis Services](https://msdn.microsoft.com/library/hh758425.aspx) или [язык сценариев табличной модели](https://msdn.microsoft.com/library/mt614797.aspx) (TMSL), чтобы добавить или удалить роли и участников пользователей.

## <a name="to-add-or-manage-roles-and-users-in-ssdt"></a>Чтобы добавить роли и пользователей в SSDT или управлять ими, сделайте следующее:  
  
1.  Выберите в SSDT **Обозреватель табличных моделей**, а затем щелкните правой кнопкой мыши **Роли**.  
  
2.  В **диспетчере ролей** нажмите кнопку **Создать**.  
  
3.  Введите имя для роли.  
  
     По умолчанию имя стандартной роли последовательно нумеруется для каждой новой роли. Мы рекомендуем ввести имя, которое четко определяет тип участника, например "Финансовые менеджеры" или "Специалисты по кадровым вопросам".  
  
4.  Выберите одно из следующих разрешений:  
  
    |Разрешение|Описание|  
    |----------------|-----------------|  
    |**None**|Участники не могут изменять схему шаблона и запрашивать данные.|  
    |**чтение**|Участники могут запрашивать данные (на основе фильтров строк), но не могут изменять схему шаблона.|  
    |**Чтение и обработка**|Участники могут запрашивать данные (на основе фильтров на уровне строк), а также выполнять операции обработки и массовой обработки, но не могут изменять схему шаблона.|  
    |**Описание процесса**|Участники могут выполнять операции обработки и массовой обработки, но не могут изменять схему шаблона и запрашивать данные.|  
    |**Администратор**|Участники могут изменять схему шаблона и выполнять запрос всех данных.|   
  
5.  Если у роли, которую вы создаете, есть разрешения "Чтение" или "Чтение и обработка", вы можете добавить фильтры строк с помощью формулы DAX. Щелкните вкладку **Фильтры строк**, выберите таблицу, а затем щелкните поле **Фильтр DAX** и введите формулу DAX.
  
6.  Щелкните **Участники** > **Добавить внешнего участника**.  
  
8.  В разделе **Добавить внешнего участника** введите пользователей или группы в клиенте Azure AD, указав адреса электронной почты. После того как вы нажмете кнопку "ОК" и закроете диспетчер ролей, роли и участники ролей появятся в обозревателе табличных моделей. 
 
     ![Роли и пользователи в обозревателе табличных моделей](./media/analysis-services-database-users/aas-roles-tmexplorer.png)

9. Выполните развертывание на сервере Azure Analysis Services.


## <a name="to-add-or-manage-roles-and-users-in-ssms"></a>Добавление ролей и пользователей в SSDT и управление ими
Чтобы добавить роли и пользователей в развернутый шаблон базы данных, вы должны быть подключены к серверу от имени администратора сервера или роли базы данных с разрешениями администратора.

1. В обозревателе объекта щелкните правой кнопкой мыши **Роли** > **Новая роль**.

2. В области **Создание роли** введите имя и описание роли.

3. Выберите разрешение.
   |Разрешение|Описание|  
   |----------------|-----------------|  
   |**Полный доступ (администратор)**|Участники могут изменять схему шаблона, обрабатывать и запрашивать все данные.| 
   |**Обработка базы данных**|Участники могут выполнять операции обработки и массовой обработки, но не могут изменять схему шаблона и запрашивать данные.|  
   |**чтение**|Участники могут запрашивать данные (на основе фильтров строк), но не могут изменять схему шаблона.|  
  
4. Щелкните **Членство**, а затем введите пользователя или группу в клиенте Azure AD, указав адрес электронной почты.

     ![Добавить пользователя](./media/analysis-services-database-users/aas-roles-adduser-ssms.png)

5. Если у роли, которую вы создаете, есть разрешение "Чтение", вы можете добавить фильтры строк с помощью формулы DAX. Щелкните **Фильтры строк**, выберите таблицу, а затем введите формулу DAX в поле **Фильтр DAX**. 

## <a name="to-add-roles-and-users-by-using-a-tmsl-script"></a>Добавление ролей и пользователей с помощью сценария TMSL
Вы можете выполнить сценарий TMSL в окне XMLA в SSMS или с помощью PowerShell. Используйте команду [CreateOrReplace](https://docs.microsoft.com/sql/analysis-services/tabular-models-scripting-language-commands/createorreplace-command-tmsl) и объект [Роли](https://docs.microsoft.com/sql/analysis-services/tabular-models-scripting-language-objects/roles-object-tmsl).

**Пример скрипта TMSL**

В этом примере внешний пользователь B2B и группа добавляются в роль "Аналитик" с разрешениями на чтение для базы данных SalesBI. Внешний пользователь и группа должны находиться в одном клиенте Azure AD.

```
{
  "createOrReplace": {
    "object": {
      "database": "SalesBI",
      "role": "Analyst"
    },
    "role": {
      "name": "Users",
      "description": "All allowed users to query the model",
      "modelPermission": "read",
      "members": [
        {
          "memberName": "user1@contoso.com",
          "identityProvider": "AzureAD"
        },
        {
          "memberName": "group1@adventureworks.com",
          "identityProvider": "AzureAD"
        }
      ]
    }
  }
}
```

## <a name="to-add-roles-and-users-by-using-powershell"></a>Добавление ролей и пользователей с помощью PowerShell
Модуль [SqlServer](https://msdn.microsoft.com/library/hh758425.aspx) предоставляет командлеты для конкретных задач управления базой данных, а также командлет общего назначения Invoke-ASCmd, который принимает запрос TMSL или сценарий. Следующие командлеты используются для управления ролями базы данных и пользователями.
  
|Командлет|Описание|
|------------|-----------------| 
|[Add-RoleMember](https://msdn.microsoft.com/library/hh510167.aspx)|Добавление участника в роль базы данных.| 
|[Remove-RoleMember](https://msdn.microsoft.com/library/hh510173.aspx)|Удаление участника из роли базы данных.|   
|[Invoke-ASCmd](https://msdn.microsoft.com/library/hh479579.aspx)|Выполнение сценария TMSL.|

## <a name="row-filters"></a>Фильтры строк  
Фильтры строк определяют, какие строки в таблице могут запросить участники определенной роли. Фильтры строк определяются для каждой таблицы в модели с помощью формул DAX.  
  
Они могут быть определены только для ролей с разрешениями "Чтение" и "Чтение и обработка". По умолчанию если фильтр строк не определен для конкретной таблицы, участники могут запросить все строки в таблице при условии, что не применена перекрестная фильтрация из другой таблицы.
  
 Фильтрам строк требуется формула DAX, которая должна возвращать значение TRUE или FALSE, чтобы определить строки, которые могут запросить участники этой определенной роли. Строки, не включенные в формулу DAX, запросить нельзя. Например, в таблице "Заказчики" с выражением фильтров строк *=Customers [Country] = “USA”* участники роли "Продажи" могут видеть только заказчиков из США.  
  
Фильтры строк применяются к указанным строкам и связанным с ними строкам. Если таблица содержит несколько связей, фильтры применяют защиту к активной связи. Фильтры строк пересекаются с другими фильтрами строк, определенными для связанных таблиц, например:  
  
|Таблица|Выражение DAX|  
|-----------|--------------------|  
|Регион|=Region[Country]=”USA”|  
|Категория продукта|=ProductCategory[Name]=”Bicycles”|  
|Транзакции|=Transactions[Year]=2016|  
  
 В конечном результате участники могут запрашивать следующие строки данных: для региона — США, для категории продукта — велосипед, для года — 2016. Пользователи не могут запрашивать транзакции за пределами США, транзакции, не связанные с велосипедами, а также транзакции, произошедшие не в 2016 году, пока они не станут участниками другой роли, предоставляющей эти разрешения.
  
 Вы можете использовать фильтр *=FALSE()*, чтобы запретить доступ ко всем строкам для всей таблицы.

## <a name="next-steps"></a>Дальнейшие действия
  [Управление администраторами сервера](analysis-services-server-admins.md)   
  [Управление службами Azure Analysis Services с помощью PowerShell](analysis-services-powershell.md)  
  [Справочник по языку TMSL](https://docs.microsoft.com/sql/analysis-services/tabular-model-scripting-language-tmsl-reference)

