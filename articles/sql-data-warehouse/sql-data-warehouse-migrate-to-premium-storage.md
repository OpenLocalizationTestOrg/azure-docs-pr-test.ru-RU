---
title: "Перенос существующего хранилища данных Azure в хранилище класса Premium | Документация Майкрософт"
description: "Инструкции по переносу существующего хранилища данных в хранилище класса Premium"
services: sql-data-warehouse
documentationcenter: NA
author: hirokib
manager: barbkess
editor: 
ms.assetid: 04b05dea-c066-44a0-9751-0774eb84c689
ms.service: sql-data-warehouse
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-services
ms.custom: migrate
ms.date: 11/29/2016
ms.author: elbutter;barbkess
ms.openlocfilehash: 860e50b532b4b0a21d3be54f087730070b0e56bb
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="migrate-your-data-warehouse-to-premium-storage"></a>Перенос хранилища данных в хранилище класса Premium
В хранилище данных SQL Azure недавно реализована возможность использовать [хранилище класса Premium, чтобы обеспечить более предсказуемую производительность][premium storage for greater performance predictability]. Теперь хранилища данных, расположенные в хранилище класса Standard, можно перенести в хранилище класса Premium. Такой перенос будет выполнен автоматически. Также вы можете выполнить его самостоятельно, если предпочитаете выбрать точное время для переноса (необходимо учитывать время простоя).

Если у вас есть несколько хранилищ данных, используйте [расписание автоматического переноса][automatic migration schedule], чтобы определить время их переноса.

## <a name="determine-storage-type"></a>Определение типа хранилища
Если хранилище данных создано до указанных ниже дат, это значит, что вы используете хранилище класса Standard.

| **Регион** | **Хранилище данных, созданное до указанной даты** |
|:--- |:--- |
| Восточная часть Австралии |Хранилище класса Premium пока недоступно |
| Восток Китая |1 ноября 2016 г. |
| Север Китая |1 ноября 2016 г. |
| Центральная Германия |1 ноября 2016 г. |
| Северо-восточная Германия |1 ноября 2016 г. |
| Западная Индия |Хранилище класса Premium пока недоступно |
| Западная часть Японии |Хранилище класса Premium пока недоступно |
| Северо-центральный регион США |10 ноября 2016 г. |

## <a name="automatic-migration-details"></a>Сведения об автоматической миграции
По умолчанию база данных будет перенесена в период с 18:00 до 06:00 по местному (региональному) времени в рамках [расписания автоматического переноса][automatic migration schedule]. Во время переноса существующее хранилище данных будет недоступно. Для миграции хранилища потребуется около 1 часа на каждый 1 ТБ емкости. За все процессы в рамках автоматического переноса плата не взимается.

> [!NOTE]
> По завершении переноса хранилище данных снова будет доступно для использования.
>
>

При переносе корпорация Майкрософт отвечает за следующие действия (они не требуют вмешательства со стороны пользователя). В этом примере мы рассмотрим существующее хранилище данных с именем MyDW, размещенное в хранилище класса Standard.

1. Корпорация Майкрософт переименовывает MyDW в MyDW_DO_NOT_USE_[метка_времени].
2. Корпорация Майкрософт приостанавливает MyDW_DO_NOT_USE_[метка_времени]. В это время создается резервная копия. Этот процесс может быть несколько раз приостановлен и возобновлен, если возникнут какие-либо проблемы.
3. Корпорация Майкрософт создает в хранилище класса Premium новое хранилище данных MyDW, используя резервную копию, созданную на шаге 2. Хранилище MyDW не будет отображаться до завершения восстановления.
4. Когда восстановление завершится, хранилище MyDW вернется к тому же состоянию (приостановлено или активно), в котором оно пребывало до переноса, получив прежнее число единиц использования хранилища данных.
5. По завершении миграции корпорация Майкрософт удаляет MyDW_DO_NOT_USE_[метка_времени].

> [!NOTE]
> При переносе не сохраняются некоторые параметры.
>
> * Необходимо снова включить аудит на уровне базы данных.
> * Необходимо снова добавить правила брандмауэра на уровне базы данных. Правила брандмауэра на уровне сервера сохраняются.
>
>

### <a name="automatic-migration-schedule"></a>расписание автоматического переноса
Автоматический перенос осуществляется в период с 18:00 до 06:00 по местному (региональному) соответствующего региона согласно приведенному ниже расписанию простоев.

| **Регион** | **Предполагаемая дата начала** | **Предполагаемая дата окончания** |
|:--- |:--- |:--- |
| Восточная часть Австралии |Еще не определено |Еще не определено |
| Восток Китая |9 января 2017 г. |13 января 2017 г. |
| Север Китая |9 января 2017 г. |13 января 2017 г. |
| Центральная Германия |9 января 2017 г. |13 января 2017 г. |
| Северо-восточная Германия |9 января 2017 г. |13 января 2017 г. |
| Западная Индия |Еще не определено |Еще не определено |
| Западная часть Японии |Еще не определено |Еще не определено |
| Северо-центральный регион США |9 января 2017 г. |13 января 2017 г. |

## <a name="self-migration-to-premium-storage"></a>Самостоятельная миграция в хранилище класса Premium
Если вы хотите выбрать точное время для простоя хранилища, выполните следующие шаги, чтобы самостоятельно перенести существующее хранилище данных из хранилища класса Standard в хранилище класса Premium. Если вы выберете этот вариант, самостоятельную миграцию следует выполнить до начала автоматического переноса в соответствующем регионе. Это позволит избежать конфликтов с процессами автоматического переноса (см. [расписание автоматического переноса][automatic migration schedule]).

### <a name="self-migration-instructions"></a>Инструкции по самостоятельной миграции
Чтобы перенести хранилище данных самостоятельно, используйте функции резервного копирования и восстановления. При переносе следует ожидать, что на этапе восстановления потребуется около 1 часа на каждый 1 ТБ емкости хранилища данных. Если вы хотите сохранить имя хранилища, выполните следующий процесс [переименования во время переноса][steps to rename during migration].

1. [Приостановите работу][Pause] хранилища данных. При этом будет выполнено автоматическое резервное копирование.
2. [Восстановите][Restore] данные из последнего моментального снимка.
3. Удалите имеющееся хранилище данных, размещенное в хранилище класса Standard. **Если не выполнить этот шаг, с вас будет взиматься плата за оба хранилища данных.**

> [!NOTE]
> При переносе не сохраняются некоторые параметры.
>
> * Необходимо снова включить аудит на уровне базы данных.
> * Необходимо снова добавить правила брандмауэра на уровне базы данных. Правила брандмауэра на уровне сервера сохраняются.
>
>

#### <a name="rename-data-warehouse-during-migration-optional"></a>Переименуйте хранилище данных во время переноса (необязательно)
У двух баз данных на одном логическом сервере не может быть одинаковое имя. Сейчас в хранилище данных SQL поддерживается возможность переименования хранилища данных.

В этом примере мы рассмотрим существующее хранилище данных с именем MyDW, размещенное в хранилище класса Standard.

1. Переименуйте MyDW с помощью следующей команды ALTER DATABASE. (В этом примере мы присвоим ему имя MyDW_BeforeMigration.) Эта команда останавливает все существующие транзакции и ее необходимо выполнять в базе данных master.
   ```
   ALTER DATABASE CurrentDatabasename MODIFY NAME = NewDatabaseName;
   ```
2. [Приостановите работу][Pause] хранилища MyDW_BeforeMigration. При этом будет выполнено автоматическое резервное копирование.
3. [Восстановите][Restore] из последнего моментального снимка новую базу данных с прежним именем (например, MyDW).
4. Удалите хранилище данных MyDW_BeforeMigration. **Если не выполнить этот шаг, с вас будет взиматься плата за оба хранилища данных.**


## <a name="next-steps"></a>Дальнейшие действия
После перехода в хранилище класса Premium базовая архитектура хранилища данных будет поддерживать большее число файлов больших двоичных объектов базы данных. Чтобы максимально эффективно использовать это изменение, перестройте кластеризованные индексы columnstore с помощью приведенного ниже скрипта. Этот скрипт принудительно переносит часть существующих данных в дополнительные большие двоичные объекты. Если не предпринимать никаких действий, данные будут перераспределяться постепенно, по мере сохранения новых данных в таблицы хранилища данных.

**Предварительные требования:**

- Хранилище данных должно располагать минимум 1000 единицами использования хранилища данных (см. раздел [Масштабирование вычислительных ресурсов][scale compute power]).
- Пользователь, выполняющий скрипт, должен быть участником [роли mediumrc][mediumrc role] или роли более высокого уровня. Чтобы назначить пользователю эту роль, выполните следующую команду: ````EXEC sp_addrolemember 'xlargerc', 'MyUser'````

````sql
-------------------------------------------------------------------------------
-- Step 1: Create table to control index rebuild
-- Run as user in mediumrc or higher
--------------------------------------------------------------------------------
create table sql_statements
WITH (distribution = round_robin)
as select
    'alter index all on ' + s.name + '.' + t.NAME + ' rebuild;' as statement,
    row_number() over (order by s.name, t.name) as sequence
from
    sys.schemas s
    inner join sys.tables t
        on s.schema_id = t.schema_id
where
    is_external = 0
;
go

--------------------------------------------------------------------------------
-- Step 2: Execute index rebuilds. If script fails, the below can be re-run to restart where last left off.
-- Run as user in mediumrc or higher
--------------------------------------------------------------------------------

declare @nbr_statements int = (select count(*) from sql_statements)
declare @i int = 1
while(@i <= @nbr_statements)
begin
      declare @statement nvarchar(1000)= (select statement from sql_statements where sequence = @i)
      print cast(getdate() as nvarchar(1000)) + ' Executing... ' + @statement
      exec (@statement)
      delete from sql_statements where sequence = @i
      set @i += 1
end;
go
-------------------------------------------------------------------------------
-- Step 3: Clean up table created in Step 1
--------------------------------------------------------------------------------
drop table sql_statements;
go
````

Если с хранилищем данных возникнут проблемы, [создайте запрос в службу поддержки][create a support ticket] и укажите в качестве возможной причины "Миграция в хранилище класса Premium".

<!--Image references-->

<!--Article references-->
[automatic migration schedule]: #automatic-migration-schedule
[self-migration to Premium Storage]: #self-migration-to-premium-storage
[create a support ticket]: sql-data-warehouse-get-started-create-support-ticket.md
[Azure paired region]: best-practices-availability-paired-regions.md
[main documentation site]: services/sql-data-warehouse.md
[Pause]: sql-data-warehouse-manage-compute-portal.md#pause-compute
[Restore]: sql-data-warehouse-restore-database-portal.md
[steps to rename during migration]: #optional-steps-to-rename-during-migration
[scale compute power]: sql-data-warehouse-manage-compute-portal.md#scale-compute-power
[mediumrc role]: sql-data-warehouse-develop-concurrency.md

<!--MSDN references-->


<!--Other Web references-->
[Premium Storage for greater performance predictability]: https://azure.microsoft.com/en-us/blog/azure-sql-data-warehouse-introduces-premium-storage-for-greater-performance/
[Azure Portal]: https://portal.azure.com
