---
title: "Как распределенные данные обрабатываются в хранилище данных SQL Azure | Документация Майкрософт"
description: "Сведения о распределении данных для вычислений с массовым параллелизмом (MPP), а также о параметрах для распределения таблиц в хранилище данных SQL Azure и хранилище Parallel Data Warehouse."
services: sql-data-warehouse
documentationcenter: NA
author: jrowlandjones
manager: jhubbard
editor: 
ms.assetid: bae494a6-7ac5-4c38-8ca3-ab2696c63a9f
ms.service: sql-data-warehouse
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-services
ms.custom: tables
ms.date: 07/12/2017
ms.author: jrj;barbkess
ms.openlocfilehash: 3c166acb17193caae32d7bad133ec510ff679353
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="distributed-data-and-distributed-tables-for-massively-parallel-processing-mpp"></a><span data-ttu-id="78ec6-103">Распределенные данные и распределенные таблицы для вычислений с массовым параллелизмом (MPP)</span><span class="sxs-lookup"><span data-stu-id="78ec6-103">Distributed data and distributed tables for Massively Parallel Processing (MPP)</span></span>
<span data-ttu-id="78ec6-104">Сведения о распределении пользовательских данных в хранилище данных SQL Azure и хранилище Parallel Data Warehouse, системах Майкрософт для вычислений с массовым параллелизмом (MPP).</span><span class="sxs-lookup"><span data-stu-id="78ec6-104">Learn how user data is distributed in Azure SQL Data Warehouse and Parallel Data Warehouse, which are Microsoft's Massively Parallel Processing (MPP) systems.</span></span> <span data-ttu-id="78ec6-105">Проектирование хранилища данных с учетом эффективного использования распределенных данных помогает использовать преимущества архитектуры MPP при обработке запросов.</span><span class="sxs-lookup"><span data-stu-id="78ec6-105">Designing your data warehouse to use distributed data effectively helps you to achieve the query processing benefits of the MPP architecture.</span></span> <span data-ttu-id="78ec6-106">Выбор правильных вариантов при проектировании базы данных может иметь значительное влияние на повышение производительности запросов.</span><span class="sxs-lookup"><span data-stu-id="78ec6-106">A few database design choices can have a significant impact on improving query performance.</span></span>  

> [!NOTE]
> <span data-ttu-id="78ec6-107">Хранилище данных SQL Azure и хранилище Parallel Data Warehouse используют одинаковую схему вычислений с массовым параллелизмом (MPP), но есть и ряд различий, обусловленных базовой платформой.</span><span class="sxs-lookup"><span data-stu-id="78ec6-107">Azure SQL Data Warehouse and Parallel Data Warehouse use the same Massively Parallel Processing (MPP) design, but they have a few differences because of the underlying platform.</span></span> <span data-ttu-id="78ec6-108">Хранилище данных SQL — это платформа как услуга (PaaS), работающая на базе Azure.</span><span class="sxs-lookup"><span data-stu-id="78ec6-108">SQL Data Warehouse is a Platform as a Service (PaaS) that runs on Azure.</span></span> <span data-ttu-id="78ec6-109">Хранилище Parallel Data Warehouse работает на базе Analytics Platform System (APS), локального модуля на базе Windows Server.</span><span class="sxs-lookup"><span data-stu-id="78ec6-109">Parallel Data Warehouse runs on Analytics Platform System (APS) which is an on-premises appliance that runs on Windows Server.</span></span>
> 
> 

## <a name="what-is-distributed-data"></a><span data-ttu-id="78ec6-110">Что такое распределенные данные?</span><span class="sxs-lookup"><span data-stu-id="78ec6-110">What is distributed data?</span></span>
<span data-ttu-id="78ec6-111">В хранилище данных SQL и хранилище Parallel Data Warehouse понятие "распределенные данные" означает пользовательские данные, которые хранятся в нескольких расположениях в системе MPP.</span><span class="sxs-lookup"><span data-stu-id="78ec6-111">In SQL Data Warehouse and Parallel Data Warehouse, distributed data refers to user data that is stored in multiple locations across the MPP system.</span></span> <span data-ttu-id="78ec6-112">Каждое из этих расположений работает как независимое хранилище и процессор, выполняющий запросы для своей части данных.</span><span class="sxs-lookup"><span data-stu-id="78ec6-112">Each of those locations functions as an independent storage and processing unit that runs queries on its portion of the data.</span></span> <span data-ttu-id="78ec6-113">Распределенные данные являются основой для параллельного выполнения запросов и достижения их высокой производительности.</span><span class="sxs-lookup"><span data-stu-id="78ec6-113">Distributed data is fundamental to running queries in parallel to achieve high query performance.</span></span>

<span data-ttu-id="78ec6-114">Для распределения данных хранилище присваивает каждую строку пользовательской таблицы одному распределенному расположению.</span><span class="sxs-lookup"><span data-stu-id="78ec6-114">To distribute data, the data warehouse assigns each row of a user table to one distributed location.</span></span>  <span data-ttu-id="78ec6-115">Таблицы можно распределять с помощью метода хэш-распределения или метода циклического перебора.</span><span class="sxs-lookup"><span data-stu-id="78ec6-115">You can distribute tables with a hash-distribution method or a round-robin method.</span></span> <span data-ttu-id="78ec6-116">Метод распространения указывается в инструкции CREATE TABLE.</span><span class="sxs-lookup"><span data-stu-id="78ec6-116">The distribution method is specified in the CREATE TABLE statement.</span></span> 

## <a name="hash-distributed-tables"></a><span data-ttu-id="78ec6-117">Таблицы с хэш-распределением</span><span class="sxs-lookup"><span data-stu-id="78ec6-117">Hash-distributed tables</span></span>
<span data-ttu-id="78ec6-118">На следующей схеме показано, как полная (нераспределенная) таблица хранится в качестве хэш-распределенной.</span><span class="sxs-lookup"><span data-stu-id="78ec6-118">The following diagram illustrates how a full (non-distributed table) gets stored as a hash-distributed table.</span></span> <span data-ttu-id="78ec6-119">Детерминированная функция присваивает каждую строку одному распределению.</span><span class="sxs-lookup"><span data-stu-id="78ec6-119">A deterministic function assigns each row to belong to one distribution.</span></span> <span data-ttu-id="78ec6-120">В определении таблицы один из столбцов определяется как столбец распределения.</span><span class="sxs-lookup"><span data-stu-id="78ec6-120">In the table definition, one of the columns is designated as the distribution column.</span></span> <span data-ttu-id="78ec6-121">Хэш-функция использует значение в столбце распределения для присвоения каждой строки распределению.</span><span class="sxs-lookup"><span data-stu-id="78ec6-121">The hash function uses the value in the distribution column to assign each row to a distribution.</span></span>

<span data-ttu-id="78ec6-122">Существуют влияющие на производительность факторы, которые учитываются при выборе столбца распределения. Например, определенность, неравномерное смещение данных и типы запросов, выполняемых в системе.</span><span class="sxs-lookup"><span data-stu-id="78ec6-122">There are performance considerations for the selection of a distribution column, such as distinctness, data skew, and the types of queries run on the system.</span></span>

<span data-ttu-id="78ec6-123">![Распределенная таблица](media/sql-data-warehouse-distributed-data/hash-distributed-table.png "Распределенная таблица")</span><span class="sxs-lookup"><span data-stu-id="78ec6-123">![Distributed table](media/sql-data-warehouse-distributed-data/hash-distributed-table.png "Distributed table")</span></span>  

* <span data-ttu-id="78ec6-124">Каждая строка относится к одному распределению.</span><span class="sxs-lookup"><span data-stu-id="78ec6-124">Each row belongs to one distribution.</span></span>  
* <span data-ttu-id="78ec6-125">Детерминированный хэш-алгоритм присваивает каждую строку одному распределению.</span><span class="sxs-lookup"><span data-stu-id="78ec6-125">A deterministic hash algorithm assigns each row to one distribution.</span></span>  
* <span data-ttu-id="78ec6-126">Количество строк таблицы в распределении зависит от размеров таблиц (как показано на схеме).</span><span class="sxs-lookup"><span data-stu-id="78ec6-126">The number of table rows per distribution varies as shown by the different sizes of tables.</span></span>

## <a name="round-robin-distributed-tables"></a><span data-ttu-id="78ec6-127">Таблицы с распределением методом циклического перебора</span><span class="sxs-lookup"><span data-stu-id="78ec6-127">Round-robin distributed tables</span></span>
<span data-ttu-id="78ec6-128">Распределенная таблица, использующая метод циклического перебора, распределяет строки путем назначения каждой строки распределению в последовательном порядке.</span><span class="sxs-lookup"><span data-stu-id="78ec6-128">A round-robin distributed table distributes the rows by assigning each row to a distribution in a sequential manner.</span></span> <span data-ttu-id="78ec6-129">Данные в такую таблицу загружаются быстро, но выполнение запросов может быть медленным.</span><span class="sxs-lookup"><span data-stu-id="78ec6-129">It is quick to load data into a round-robin table, but query performance might be slower.</span></span>  <span data-ttu-id="78ec6-130">Для объединения таблицы с циклическим перебором обычно требуется перегруппировка строк, чтобы запрос вернул точный результат. А для этого требуется время.</span><span class="sxs-lookup"><span data-stu-id="78ec6-130">Joining a round-robin table usually requires reshuffling the rows to enable the query to produce an accurate result, which takes time.</span></span>

## <a name="distributed-storage-locations-are-called-distributions"></a><span data-ttu-id="78ec6-131">Распределенные расположения хранения называются распределениями</span><span class="sxs-lookup"><span data-stu-id="78ec6-131">Distributed storage locations are called distributions</span></span>
<span data-ttu-id="78ec6-132">Каждое распределенное расположение называется распределением.</span><span class="sxs-lookup"><span data-stu-id="78ec6-132">Each distributed location is called a distribution.</span></span> <span data-ttu-id="78ec6-133">При параллельном выполнении запроса каждое распределение выполняет запрос SQL к своей части данных.</span><span class="sxs-lookup"><span data-stu-id="78ec6-133">When a query runs in parallel, each distribution performs a SQL query on its portion of the data.</span></span> <span data-ttu-id="78ec6-134">Хранилище данных SQL использует базу данных SQL для выполнения запроса.</span><span class="sxs-lookup"><span data-stu-id="78ec6-134">SQL Data Warehouse uses SQL Database to run the query.</span></span> <span data-ttu-id="78ec6-135">Хранилище Parallel Data Warehouse использует для выполнения запроса SQL Server.</span><span class="sxs-lookup"><span data-stu-id="78ec6-135">Parallel Data Warehouse uses SQL Server to run the query.</span></span> <span data-ttu-id="78ec6-136">Такая неразделяемая архитектура является принципиальной для обеспечения масштабируемых параллельных вычислений.</span><span class="sxs-lookup"><span data-stu-id="78ec6-136">This shared-nothing architecture design is fundamental to achieving scale-out parallel computing.</span></span>

### <a name="can-i-view-the-distributions"></a><span data-ttu-id="78ec6-137">Можно ли просматривать распределения?</span><span class="sxs-lookup"><span data-stu-id="78ec6-137">Can I view the distributions?</span></span>
<span data-ttu-id="78ec6-138">У каждого распределения есть идентификатор, отображаемый в системных представлениях, которые относятся к хранилищу данных SQL и Parallel Data Warehouse.</span><span class="sxs-lookup"><span data-stu-id="78ec6-138">Each distribution has a distribution ID and is visible in system views that pertain to SQL Data Warehouse and Parallel Data Warehouse.</span></span> <span data-ttu-id="78ec6-139">Идентификатор распределения можно использовать для устранения неполадок производительности запросов и других проблем.</span><span class="sxs-lookup"><span data-stu-id="78ec6-139">You can use the distribution ID to troubleshoot query performance and other problems.</span></span> <span data-ttu-id="78ec6-140">Список системных представлений см. в [системном представление MPP](sql-data-warehouse-reference-tsql-statements.md).</span><span class="sxs-lookup"><span data-stu-id="78ec6-140">For a list of the system views, see the [MPP system view](sql-data-warehouse-reference-tsql-statements.md).</span></span>

## <a name="difference-between-a-distribution-and-a-compute-node"></a><span data-ttu-id="78ec6-141">Различия между распределением и вычислительным узлом</span><span class="sxs-lookup"><span data-stu-id="78ec6-141">Difference between a distribution and a Compute node</span></span>
<span data-ttu-id="78ec6-142">Распределение — это базовая единица хранения распределенных данных и обработки параллельных запросов.</span><span class="sxs-lookup"><span data-stu-id="78ec6-142">A distribution is the basic unit for storing distributed data and processing parallel queries.</span></span> <span data-ttu-id="78ec6-143">Распределения объединяются в вычислительные узлы.</span><span class="sxs-lookup"><span data-stu-id="78ec6-143">Distributions are grouped into Compute nodes.</span></span> <span data-ttu-id="78ec6-144">Каждый вычислительный узел отслеживает одно или несколько распределений.</span><span class="sxs-lookup"><span data-stu-id="78ec6-144">Each Compute node tracks one or more distributions.</span></span>  

* <span data-ttu-id="78ec6-145">Система Analytics Platform System использует вычислительные узлы в качестве центрального компонента аппаратной архитектуры и возможностей масштабирования.</span><span class="sxs-lookup"><span data-stu-id="78ec6-145">Analytics Platform System uses Compute nodes as a central component of the hardware architecture and scale-out capabilities.</span></span> <span data-ttu-id="78ec6-146">В ней всегда используется восемь распределений на один вычислительный узел, как показано на диаграмме для таблиц с хэш-распределением.</span><span class="sxs-lookup"><span data-stu-id="78ec6-146">It always uses eight distributions per Compute node, as shown in the diagram for hash-distributed tables.</span></span> <span data-ttu-id="78ec6-147">Количество вычислительных узлов и, следовательно, число распределений, зависит от количества вычислительных узлов, приобретенных пользователем для устройства.</span><span class="sxs-lookup"><span data-stu-id="78ec6-147">The number of Compute nodes, and therefore the number of distributions, is determined by the number of Compute nodes you purchase for the appliance.</span></span> <span data-ttu-id="78ec6-148">Например, при покупке восьми вычислительных узлов пользователь получает 64 распределения (8 вычислительных узлов x 8 распределений на узел).</span><span class="sxs-lookup"><span data-stu-id="78ec6-148">For example, if you purchase eight Compute nodes, you get 64 distributions (8 Compute nodes x 8 distributions/node).</span></span> 
* <span data-ttu-id="78ec6-149">Хранилище данных SQL использует фиксированное количество распределений, равное 60, и переменное количество вычислительных узлов.</span><span class="sxs-lookup"><span data-stu-id="78ec6-149">SQL Data Warehouse has a fixed number of 60 distributions and a flexible number of Compute nodes.</span></span> <span data-ttu-id="78ec6-150">Вычислительные узлы реализованы с использованием ресурсов вычисления и хранения Azure.</span><span class="sxs-lookup"><span data-stu-id="78ec6-150">The Compute nodes are implemented with Azure computing and storage resources.</span></span> <span data-ttu-id="78ec6-151">Количество вычислительных узлов может изменяться в зависимости от рабочей нагрузки серверной службы и вычислительной мощности (DWU), указанной для хранилища данных.</span><span class="sxs-lookup"><span data-stu-id="78ec6-151">The number of Compute nodes can change according to the backend service workload and the computing capacity (DWUs) you specify for the data warehouse.</span></span> <span data-ttu-id="78ec6-152">При изменении количества вычислительных узлов изменяется и количество распределений на один вычислительный узел.</span><span class="sxs-lookup"><span data-stu-id="78ec6-152">When the number of Compute nodes changes, the number of distributions per Compute node also changes.</span></span> 

### <a name="can-i-view-the-compute-nodes"></a><span data-ttu-id="78ec6-153">Можно ли просматривать вычислительные узлы?</span><span class="sxs-lookup"><span data-stu-id="78ec6-153">Can I view the Compute nodes?</span></span>
<span data-ttu-id="78ec6-154">У каждого вычислительного узла есть идентификатор, отображаемый в системных представлениях, которые относятся к хранилищу данных SQL и Parallel Data Warehouse.</span><span class="sxs-lookup"><span data-stu-id="78ec6-154">Each Compute node has a node ID and is visible in system views that pertain to SQL Data Warehouse and Parallel Data Warehouse.</span></span>  <span data-ttu-id="78ec6-155">Вычислительные узлы можно увидеть в столбце node_id в системных представлениях, имена которых начинаются с sys.pdw_nodes.</span><span class="sxs-lookup"><span data-stu-id="78ec6-155">You can see the Compute node by looking for the node_id column in system views whose names begin with sys.pdw_nodes.</span></span> <span data-ttu-id="78ec6-156">Список системных представлений см. в [системном представление MPP](sql-data-warehouse-reference-tsql-statements.md).</span><span class="sxs-lookup"><span data-stu-id="78ec6-156">For a list of the system views, see the [MPP system view](sql-data-warehouse-reference-tsql-statements.md).</span></span>

## <span data-ttu-id="78ec6-157"><a name="Replicated"></a>Реплицированные таблицы</span><span class="sxs-lookup"><span data-stu-id="78ec6-157"><a name="Replicated"></a>Replicated Tables</span></span>
<span data-ttu-id="78ec6-158">Полная копия реплицированной таблицы хранится на каждом вычислительном узле.</span><span class="sxs-lookup"><span data-stu-id="78ec6-158">A table that is replicated has a fully copy of the table stored on each Compute node.</span></span> <span data-ttu-id="78ec6-159">Репликация таблицы устраняет необходимость передавать данные между вычислительными узлами перед операциями соединения или агрегирования.</span><span class="sxs-lookup"><span data-stu-id="78ec6-159">Replicating a table removes the need to transfer data among Compute nodes before a join or aggregation.</span></span> <span data-ttu-id="78ec6-160">Реплицированные таблицы подходят только для работы с небольшими таблицами из-за дополнительного пространства для хранения всей таблицы на каждом вычислительном узле.</span><span class="sxs-lookup"><span data-stu-id="78ec6-160">Replicated tables are only feasible with small tables because of the extra storage required to store the full table on each compute node.</span></span>  

<span data-ttu-id="78ec6-161">На схеме ниже показана реплицированная таблица, которая хранится на каждом вычислительном узле.</span><span class="sxs-lookup"><span data-stu-id="78ec6-161">The following diagram shows a replicated table that is stored on each Compute node.</span></span> <span data-ttu-id="78ec6-162">Для хранилища данных SQL реплицируемая таблица полностью копируется в базу данных распространителя на каждом вычислительном узле.</span><span class="sxs-lookup"><span data-stu-id="78ec6-162">For SQL Data Warehouse, the replicated table is fully copied to a distribution database on each Compute node.</span></span> <span data-ttu-id="78ec6-163">Для Parallel Data Warehouse реплицированная таблица хранится на всех дисках, назначенных вычислительному узлу.</span><span class="sxs-lookup"><span data-stu-id="78ec6-163">For Parallel Data Warehouse, the replicated table is stored across all disks assigned to the Compute node.</span></span>  <span data-ttu-id="78ec6-164">Такая стратегия работы с дисками реализуется с помощью файловых групп SQL Server.</span><span class="sxs-lookup"><span data-stu-id="78ec6-164">This disk strategy is implemented by using SQL Server filegroups.</span></span>  

<span data-ttu-id="78ec6-165">![Реплицируемая таблица](media/sql-data-warehouse-distributed-data/replicated-table.png "Реплицируемая таблица")</span><span class="sxs-lookup"><span data-stu-id="78ec6-165">![Replicated table](media/sql-data-warehouse-distributed-data/replicated-table.png "Replicated table")</span></span> 

## <a name="next-steps"></a><span data-ttu-id="78ec6-166">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="78ec6-166">Next steps</span></span>
<span data-ttu-id="78ec6-167">Чтобы эффективно использовать распределенные таблицы, см. инструкции в статье [Distributing tables in SQL Data Warehouse](sql-data-warehouse-tables-distribute.md) (Распределение таблиц в хранилище данных SQL).</span><span class="sxs-lookup"><span data-stu-id="78ec6-167">To use distributed tables effectively, see [Distributing tables in SQL Data Warehouse](sql-data-warehouse-tables-distribute.md)</span></span>  

