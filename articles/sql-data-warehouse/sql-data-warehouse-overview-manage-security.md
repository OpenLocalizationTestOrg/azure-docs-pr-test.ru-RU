---
title: "Защита базы данных в хранилище данных SQL | Документация Майкрософт"
description: "Советы по защите базы данных в хранилище данных SQL для разработки решений."
services: sql-data-warehouse
documentationcenter: NA
author: ronortloff
manager: jhubbard
editor: 
ms.assetid: 8fa2f5ca-4cf5-4418-99a2-4dc745799850
ms.service: sql-data-warehouse
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-services
ms.custom: security
ms.date: 10/31/2016
ms.author: rortloff;barbkess
ms.openlocfilehash: 6ea45c40bc428282faf24b4a08f8b0d345adb3fd
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="secure-a-database-in-sql-data-warehouse"></a><span data-ttu-id="14f3d-103">Защита базы данных в хранилище данных SQL</span><span class="sxs-lookup"><span data-stu-id="14f3d-103">Secure a database in SQL Data Warehouse</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="14f3d-104">Обзор безопасности</span><span class="sxs-lookup"><span data-stu-id="14f3d-104">Security Overview</span></span>](sql-data-warehouse-overview-manage-security.md)
> * [<span data-ttu-id="14f3d-105">Аутентификация</span><span class="sxs-lookup"><span data-stu-id="14f3d-105">Authentication</span></span>](sql-data-warehouse-authentication.md)
> * [<span data-ttu-id="14f3d-106">Шифрование (портал)</span><span class="sxs-lookup"><span data-stu-id="14f3d-106">Encryption (Portal)</span></span>](sql-data-warehouse-encryption-tde.md)
> * [<span data-ttu-id="14f3d-107">Шифрование (T-SQL)</span><span class="sxs-lookup"><span data-stu-id="14f3d-107">Encryption (T-SQL)</span></span>](sql-data-warehouse-encryption-tde-tsql.md)
> 
> 

<span data-ttu-id="14f3d-108">В этой статье рассматриваются основы защиты базы данных в хранилище данных SQL.</span><span class="sxs-lookup"><span data-stu-id="14f3d-108">This article walks through the basics of securing your Azure SQL Data Warehouse database.</span></span> <span data-ttu-id="14f3d-109">В частности, эта статья содержит инструкции по началу работы с ресурсами для ограничения доступа, защиты данных и мониторинга действий с базой данных.</span><span class="sxs-lookup"><span data-stu-id="14f3d-109">In particular, this article will get you started with resources for limiting access, protecting data, and monitoring activities on a database.</span></span>

## <a name="connection-security"></a><span data-ttu-id="14f3d-110">Безопасность подключения</span><span class="sxs-lookup"><span data-stu-id="14f3d-110">Connection security</span></span>
<span data-ttu-id="14f3d-111">Под безопасностью подключения подразумеваются способы ограничения и защиты подключений к базе данных с помощью правил брандмауэра и шифрования подключения.</span><span class="sxs-lookup"><span data-stu-id="14f3d-111">Connection Security refers to how you restrict and secure connections to your database using firewall rules and connection encryption.</span></span>

<span data-ttu-id="14f3d-112">Правила брандмауэра используются как сервером, так и базой данных для отклонения попыток подключиться с IP-адресов, которые не были явно включены в белый список.</span><span class="sxs-lookup"><span data-stu-id="14f3d-112">Firewall rules are used by both the server and the database to reject connection attempts from IP addresses that have not been explicitly whitelisted.</span></span> <span data-ttu-id="14f3d-113">Чтобы разрешить подключение из своего приложения или с клиентского компьютера с общедоступным IP-адресом, сначала необходимо создать правило брандмауэра уровня сервера. Для этого воспользуйтесь порталом Azure, REST API или PowerShell.</span><span class="sxs-lookup"><span data-stu-id="14f3d-113">To allow connections from your application or client machine's public IP address, you must first create a server-level firewall rule using the Azure Portal, REST API, or PowerShell.</span></span> <span data-ttu-id="14f3d-114">В брандмауэре сервера рекомендуется максимально ограничить диапазоны разрешенных IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="14f3d-114">As a best practice, you should restrict the IP address ranges allowed through your server firewall as much as possible.</span></span>  <span data-ttu-id="14f3d-115">Для доступа к хранилищу данных SQL Azure с локального компьютера убедитесь, что брандмауэр сети и локального компьютера разрешает исходящие подключения по TCP-порту 1433.</span><span class="sxs-lookup"><span data-stu-id="14f3d-115">To access Azure SQL Data Warehouse from your local computer, ensure the firewall on your network and local computer allows outgoing communication on TCP port 1433.</span></span>  <span data-ttu-id="14f3d-116">Дополнительные сведения см. в разделах [Брандмауэр базы данных SQL Azure][Azure SQL Database firewall], [sp_set_firewall_rule][sp_set_firewall_rule] и [sp_set_database_firewall_rule][sp_set_database_firewall_rule].</span><span class="sxs-lookup"><span data-stu-id="14f3d-116">For more information, see [Azure SQL Database firewall][Azure SQL Database firewall], [sp_set_firewall_rule][sp_set_firewall_rule], and [sp_set_database_firewall_rule][sp_set_database_firewall_rule].</span></span>

<span data-ttu-id="14f3d-117">Подключения к хранилищу данных SQL шифруются по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="14f3d-117">Connections to your SQL Data Warehouse are encrypted by default.</span></span>  <span data-ttu-id="14f3d-118">Изменение параметров подключения для отключения шифрования игнорируется.</span><span class="sxs-lookup"><span data-stu-id="14f3d-118">Modifying connection settings to disable encryption are ignored.</span></span>

## <a name="authentication"></a><span data-ttu-id="14f3d-119">Аутентификация</span><span class="sxs-lookup"><span data-stu-id="14f3d-119">Authentication</span></span>
<span data-ttu-id="14f3d-120">В процессе аутентификации предлагается подтвердить личность пользователя при подключении к базе данных.</span><span class="sxs-lookup"><span data-stu-id="14f3d-120">Authentication refers to how you prove your identity when connecting to the database.</span></span> <span data-ttu-id="14f3d-121">Сейчас хранилище данных SQL поддерживает аутентификацию SQL с использованием имени пользователя и пароля, а также Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="14f3d-121">SQL Data Warehouse currently supports SQL Server Authentication with a username and password as well as a Azure Active Directory.</span></span> 

<span data-ttu-id="14f3d-122">При создании логического сервера для базы данных вы указали имя для входа "Администратор сервера" и пароль.</span><span class="sxs-lookup"><span data-stu-id="14f3d-122">When you created the logical server for your database, you specified a "server admin" login with a username and password.</span></span> <span data-ttu-id="14f3d-123">Используя эти учетные данные, можно выполнить проверку подлинности SQL Server для любой базы данных на этом сервере в качестве владельца базы данных (или dbo).</span><span class="sxs-lookup"><span data-stu-id="14f3d-123">Using these credentials, you can authenticate to any database on that server as the database owner, or "dbo" through SQL Server Authentication.</span></span>

<span data-ttu-id="14f3d-124">Но рекомендуется, чтобы пользователи вашей организации использовали для проверки подлинности другую учетную запись.</span><span class="sxs-lookup"><span data-stu-id="14f3d-124">However, as a best practice, your organization’s users should use a different account to authenticate.</span></span> <span data-ttu-id="14f3d-125">Это позволит ограничить разрешения, предоставляемые приложению, и снизить риски вредоносных действий в случае, если приложение уязвимо для атак путем внедрения кода SQL.</span><span class="sxs-lookup"><span data-stu-id="14f3d-125">This way you can limit the permissions granted to the application and reduce the risks of malicious activity in case your application code is vulnerable to a SQL injection attack.</span></span> 

<span data-ttu-id="14f3d-126">Чтобы создать пользователя, прошедшего аутентификацию SQL Server, подключитесь к базе данных **master** на сервере с именем для входа администратора сервера и создайте новое имя для входа на сервер.</span><span class="sxs-lookup"><span data-stu-id="14f3d-126">To create a SQL Server Authenticated user, connect to the **master** database on your server with your server admin login and create a new server login.</span></span>  <span data-ttu-id="14f3d-127">Кроме того, рекомендуется создать в базе данных master учетную запись для пользователей хранилища данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="14f3d-127">Additionally, it is a good idea to create a user in the master database for Azure SQL Data Warehouse users.</span></span> <span data-ttu-id="14f3d-128">Это позволит пользователям входить в систему с помощью таких инструментов, как среда SSMS, без указания имени базы данных.</span><span class="sxs-lookup"><span data-stu-id="14f3d-128">Creating a user in master allows a user to login using tools like SSMS without specifying a database name.</span></span>  <span data-ttu-id="14f3d-129">Кроме того, это позволяет использовать обозреватель объектов для просмотра всех баз данных в SQL Server.</span><span class="sxs-lookup"><span data-stu-id="14f3d-129">It also allows them to use the object explorer to view all databases on a SQL server.</span></span>

```sql
-- Connect to master database and create a login
CREATE LOGIN ApplicationLogin WITH PASSWORD = 'Str0ng_password';
CREATE USER ApplicationUser FOR LOGIN ApplicationLogin;
```

<span data-ttu-id="14f3d-130">Затем подключитесь к **базе данных хранилища данных SQL** с именем для входа администратора сервера и создайте пользователя базы данных на для только что созданного имени для входа на сервер.</span><span class="sxs-lookup"><span data-stu-id="14f3d-130">Then, connect to your **SQL Data Warehouse database** with your server admin login and create a database user based on the server login you just created.</span></span>

```sql
-- Connect to SQL DW database and create a database user
CREATE USER ApplicationUser FOR LOGIN ApplicationLogin;
```

<span data-ttu-id="14f3d-131">Если пользователь будет выполнять дополнительные операции, такие как создание имен для входа или баз данных, ему также потребуется назначить роли `Loginmanager` и `dbmanager` в базе данных master.</span><span class="sxs-lookup"><span data-stu-id="14f3d-131">If a user will be doing additional operations such as creating logins or creating new databases, they will also need to be assigned to the `Loginmanager` and `dbmanager` roles in the master database.</span></span> <span data-ttu-id="14f3d-132">Дополнительные сведения об этих дополнительных ролях и аутентификации в Базе данных SQL см. в статье [Проверка подлинности и авторизация в базе данных SQL: предоставление доступа][Managing databases and logins in Azure SQL Database].</span><span class="sxs-lookup"><span data-stu-id="14f3d-132">For more information on these additonal roles and authenticating to a SQL Database, see [Managing databases and logins in Azure SQL Database][Managing databases and logins in Azure SQL Database].</span></span>  <span data-ttu-id="14f3d-133">Дополнительные сведения об использовании Azure AD для хранилища данных SQL см. в статье [Аутентификация в хранилище данных SQL Azure][Connecting to SQL Data Warehouse By Using Azure Active Directory Authentication].</span><span class="sxs-lookup"><span data-stu-id="14f3d-133">For more details on Azure AD for SQL Data Warehouse, see [Connecting to SQL Data Warehouse By Using Azure Active Directory Authentication][Connecting to SQL Data Warehouse By Using Azure Active Directory Authentication].</span></span>

## <a name="authorization"></a><span data-ttu-id="14f3d-134">Авторизация</span><span class="sxs-lookup"><span data-stu-id="14f3d-134">Authorization</span></span>
<span data-ttu-id="14f3d-135">Авторизация подразумевает набор действий, которые можно выполнять в базе данных хранилища SQL Azure. Этот набор действий определяют разрешения учетной записи пользователя и присвоенные ей роли.</span><span class="sxs-lookup"><span data-stu-id="14f3d-135">Authorization refers to what you can do within an Azure SQL Data Warehouse database, and this is controlled by your user account's role memberships and permissions.</span></span> <span data-ttu-id="14f3d-136">Обычно пользователям рекомендуется предоставлять наименьшие необходимые привилегии.</span><span class="sxs-lookup"><span data-stu-id="14f3d-136">As a best practice, you should grant users the least privileges necessary.</span></span> <span data-ttu-id="14f3d-137">Хранилищем данных SQL Azure можно легко управлять с использованием ролей в T-SQL.</span><span class="sxs-lookup"><span data-stu-id="14f3d-137">Azure SQL Data Warehouse makes this easy to manage with roles in T-SQL:</span></span>

```sql
EXEC sp_addrolemember 'db_datareader', 'ApplicationUser'; -- allows ApplicationUser to read data
EXEC sp_addrolemember 'db_datawriter', 'ApplicationUser'; -- allows ApplicationUser to write data
```

<span data-ttu-id="14f3d-138">Учетной записи администратора сервера, которая используется для подключения, присвоена роль db_owner, обладатель которой может выполнять любые действия в базе данных.</span><span class="sxs-lookup"><span data-stu-id="14f3d-138">The server admin account you are connecting with is a member of db_owner, which has authority to do anything within the database.</span></span> <span data-ttu-id="14f3d-139">Сохраните эту учетную запись для развертывания обновлений схемы и выполнения других действий по управлению.</span><span class="sxs-lookup"><span data-stu-id="14f3d-139">Save this account for deploying schema upgrades and other management operations.</span></span> <span data-ttu-id="14f3d-140">Для подключения к базе данных из приложения с использованием наименьших привилегий, необходимых приложению, используйте учетную запись "ApplicationUser" с более ограниченными разрешениями.</span><span class="sxs-lookup"><span data-stu-id="14f3d-140">Use the "ApplicationUser" account with more limited permissions to connect from your application to the database with the least privileges needed by your application.</span></span>

<span data-ttu-id="14f3d-141">Существуют способы еще больше ограничить действия пользователя с Базой данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="14f3d-141">There are ways to further limit what a user can do with Azure SQL Database:</span></span>

* <span data-ttu-id="14f3d-142">Детальная настройка [разрешений][Permissions] позволяет указать операции, которые можно выполнять с отдельными столбцами, таблицами, представлениями, процедурами и другими объектами в базе данных.</span><span class="sxs-lookup"><span data-stu-id="14f3d-142">Granular [Permissions][Permissions] let you control which operations you can do on individual columns, tables, views, procedures, and other objects in the database.</span></span> <span data-ttu-id="14f3d-143">Используйте детализированные разрешения для обеспечения наивысшего уровня контроля и предоставления минимальных необходимых разрешений.</span><span class="sxs-lookup"><span data-stu-id="14f3d-143">Use granular permissions to have the most control and grant the minimum permissions necessary.</span></span> <span data-ttu-id="14f3d-144">Система детализированных разрешений является довольно сложной, поэтому для ее эффективного использования потребуется пройти дополнительное обучение.</span><span class="sxs-lookup"><span data-stu-id="14f3d-144">The granular permission system is somewhat complicated and will require some study to use effectively.</span></span>
* <span data-ttu-id="14f3d-145">Чтобы создать учетные записи пользователей приложения с более широкими правами или учетные записи управления с меньшим набором разрешений, можно использовать [роли базы данных][Database roles], отличные от db_datareader и db_datawriter.</span><span class="sxs-lookup"><span data-stu-id="14f3d-145">[Database roles][Database roles] other than db_datareader and db_datawriter can be used to create more powerful application user accounts or less powerful management accounts.</span></span> <span data-ttu-id="14f3d-146">С помощью встроенных фиксированных ролей базы данных можно легко присваивать разрешения, однако это может привести к предоставлению лишних разрешений.</span><span class="sxs-lookup"><span data-stu-id="14f3d-146">The built-in fixed database roles provide an easy way to grant permissions, but can result in granting more permissions than are necessary.</span></span>
* <span data-ttu-id="14f3d-147">Чтобы ограничить действия, выполняемые в базе данных, можно использовать [хранимые процедуры][Stored procedures].</span><span class="sxs-lookup"><span data-stu-id="14f3d-147">[Stored procedures][Stored procedures] can be used to limit the actions that can be taken on the database.</span></span>

<span data-ttu-id="14f3d-148">Управление базами данных и логическими серверами на классическом портале Azure или с помощью API-интерфейса диспетчера ресурсов Azure контролируется путем назначения ролей для учетной записи пользователя портала.</span><span class="sxs-lookup"><span data-stu-id="14f3d-148">Managing databases and logical servers from the Azure Classic Portal or using the Azure Resource Manager API is controlled by your portal user account's role assignments.</span></span> <span data-ttu-id="14f3d-149">Дополнительные сведения об этом см. в статье [Использование назначений ролей для управления доступом к ресурсам в подписке Azure][Role-based access control in Azure Portal].</span><span class="sxs-lookup"><span data-stu-id="14f3d-149">For more information on this topic, see [Role-based access control in Azure Portal][Role-based access control in Azure Portal].</span></span>

## <a name="encryption"></a><span data-ttu-id="14f3d-150">Шифрование</span><span class="sxs-lookup"><span data-stu-id="14f3d-150">Encryption</span></span>
<span data-ttu-id="14f3d-151">Прозрачное шифрование данных хранилища данных SQL Azure помогает защититься от вредоносных атак благодаря шифрованию и расшифровке неактивных данных в реальном времени.</span><span class="sxs-lookup"><span data-stu-id="14f3d-151">Azure SQL Data Warehouse Transparent Data Encryption (TDE) helps protect against the threat of malicious activity by performing real-time encryption and decryption of your data at rest.</span></span>  <span data-ttu-id="14f3d-152">При шифровании базы связанные резервные копии и файлы журналов транзакций шифруются без необходимости вносить изменения в приложения.</span><span class="sxs-lookup"><span data-stu-id="14f3d-152">When you encrypt your database, associated backups and transaction log files are encrypted without requiring any changes to your applications.</span></span> <span data-ttu-id="14f3d-153">При использовании TDE хранилище всей базы данных шифруется с помощью симметричного ключа, который называется ключом шифрования базы данных.</span><span class="sxs-lookup"><span data-stu-id="14f3d-153">TDE encrypts the storage of an entire database by using a symmetric key called the database encryption key.</span></span> <span data-ttu-id="14f3d-154">В Базе данных SQL ключ шифрования базы данных защищается встроенным сертификатом сервера.</span><span class="sxs-lookup"><span data-stu-id="14f3d-154">In SQL Database the database encryption key is protected by a built-in server certificate.</span></span> <span data-ttu-id="14f3d-155">Каждый сервер Базы данных SQL обладает уникальным встроенным сертификатом.</span><span class="sxs-lookup"><span data-stu-id="14f3d-155">The built-in server certificate is unique for each SQL Database server.</span></span> <span data-ttu-id="14f3d-156">Корпорация Майкрософт автоматически изменяет эти сертификаты не реже, чем раз в 90 дней.</span><span class="sxs-lookup"><span data-stu-id="14f3d-156">Microsoft automatically rotates these certificates at least every 90 days.</span></span> <span data-ttu-id="14f3d-157">Алгоритм шифрования, используемый в хранилище данных SQL, это AES-256.</span><span class="sxs-lookup"><span data-stu-id="14f3d-157">The encryption algorithm used by SQL Data Warehouse is AES-256.</span></span> <span data-ttu-id="14f3d-158">Общее описание функции TDE см. в статье [Прозрачное шифрование данных (TDE)][Transparent Data Encryption].</span><span class="sxs-lookup"><span data-stu-id="14f3d-158">For a general description of TDE, see [Transparent Data Encryption][Transparent Data Encryption].</span></span>

<span data-ttu-id="14f3d-159">Базу данных можно зашифровать с помощью [портала Azure][Encryption with Portal] или [T-SQL][Encryption with TSQL].</span><span class="sxs-lookup"><span data-stu-id="14f3d-159">You can encrypt your database using the [Azure Portal][Encryption with Portal] or [T-SQL][Encryption with TSQL].</span></span>

## <a name="next-steps"></a><span data-ttu-id="14f3d-160">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="14f3d-160">Next steps</span></span>
<span data-ttu-id="14f3d-161">Дополнительные сведения и примеры подключения к хранилищу данных SQL с различными протоколами см. в статье [Подключение к хранилищу данных SQL Azure][Connect to SQL Data Warehouse].</span><span class="sxs-lookup"><span data-stu-id="14f3d-161">For details and examples on connecting to your SQL Data Warehouse with different protocols, see [Connect to SQL Data Warehouse][Connect to SQL Data Warehouse].</span></span>

<!--Image references-->

<!--Article references-->
[Connect to SQL Data Warehouse]: ./sql-data-warehouse-connect-overview.md
[Encryption with Portal]: ./sql-data-warehouse-encryption-tde.md
[Encryption with TSQL]: ./sql-data-warehouse-encryption-tde-tsql.md
[Connecting to SQL Data Warehouse By Using Azure Active Directory Authentication]: ./sql-data-warehouse-authentication.md

<!--MSDN references-->
[Azure SQL Database firewall]: https://msdn.microsoft.com/library/ee621782.aspx
[sp_set_firewall_rule]: https://msdn.microsoft.com/library/dn270017.aspx
[sp_set_database_firewall_rule]: https://msdn.microsoft.com/library/dn270010.aspx
[Database roles]: https://msdn.microsoft.com/library/ms189121.aspx
[Managing databases and logins in Azure SQL Database]: https://msdn.microsoft.com/library/ee336235.aspx
[Permissions]: https://msdn.microsoft.com/library/ms191291.aspx
[Stored procedures]: https://msdn.microsoft.com/library/ms190782.aspx
[Transparent Data Encryption]: https://msdn.microsoft.com/library/bb934049.aspx
[Azure portal]: https://portal.azure.com/

<!--Other Web references-->
[Role-based access control in Azure Portal]: https://azure.microsoft.com/documentation/articles/role-based-access-control-configure
