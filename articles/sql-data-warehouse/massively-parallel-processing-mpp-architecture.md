---
title: "Архитектура MPP в хранилище данных SQL Azure | Документация Майкрософт"
description: "Узнайте, как в хранилище данных SQL Azure с помощью массового параллелизма (MPP) и возможностей хранилища Azure можно достичь высокой эффективности и масштабируемости."
services: sql-data-warehouse
documentationcenter: NA
author: jrowlandjones
manager: jhubbard
editor: 
ms.service: sql-data-warehouse
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-services
ms.custom: architecture
ms.date: 11/15/2017
ms.author: jrj;barbkess
ms.openlocfilehash: 4c230eb0633b2917b90a5c1f9f4176882bfd0290
ms.sourcegitcommit: afc78e4fdef08e4ef75e3456fdfe3709d3c3680b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/16/2017
---
# <a name="azure-sql-data-warehouse---massively-parallel-processing-mpp-architecture"></a>Хранилище данных SQL Azure. Архитектура обработки с массовым параллелизмом (MPP)
Узнайте, как в хранилище данных SQL Azure с помощью массового параллелизма (MPP) и возможностей хранилища Azure можно достичь высокой эффективности и масштабируемости. 

## <a name="mpp-architecture-components"></a>Компоненты архитектуры MPP
Хранилище данных SQL использует масштабируемую архитектуру для распределения вычислительной обработки данных на нескольких узлах. Единица масштабирования представляет собой абстракцию вычислительной мощности, известную как единица использования хранилища данных. Хранилище данных SQL отделяет вычислительные ресурсы от ресурсов хранилища, что дает возможность пользователю масштабировать вычислительные ресурсы независимо от данных в системе.

![Архитектура хранилища данных SQL](media/massively-parallel-processing-mpp-architecture/massively-parallel-processing-mpp-architecture.png)

В хранилище данных SQL используется архитектура на основе узла. Приложения подключаются к управляющему узлу и выполняют команды T-SQL. Этот узел представляет собой единую точку входа хранилища данных. Управляющий узел запускает механизм MPP, оптимизирующий запросы параллельной обработки, а затем перенаправляет операции на вычислительные узлы, чтобы обеспечить таким образом параллельную работу. Вычислительные узлы хранят все данные пользователей в службе хранилища Azure и выполняют параллельные запросы. Служба перемещения данных (DMS) представляет собой внутреннюю службу на уровне системы, которая перемещает данные между узлами, что необходимо для выполнения параллельных запросов и возвращения точных результатов. 

Благодаря отделению ресурсов хранилища от вычислительных ресурсов хранилище данных SQL обеспечивает следующие возможности:

* определение объема вычислительных ресурсов независимого от потребностей хранилища;
* увеличение или уменьшение масштаба вычислений без перемещения данных;
* приостановка вычислений без изменения данных (вы платите только за хранилище);
* возобновление вычислений во время рабочих часов.

### <a name="azure-storage"></a>Хранилище Azure
В хранилище данных SQL используется служба хранилища Azure для безопасного хранения данных пользователя.  Так как ваши данные хранятся в службе хранилища Azure и управляются ею, в хранилище данных SQL предусмотрена отдельная плата за использование хранилища. Для оптимизации производительности системы сами данные сегментированы в **дистрибутивы**. При определении таблицы вы можете выбрать шаблон сегментирования, который будет использоваться для распределения данных. Хранилище данных SQL поддерживает следующие шаблоны сегментирования:

* Хэш
* Циклический перебор,
* Репликация

### <a name="control-node"></a>Управляющий узел

Управляющий узел характеризует вычислительную мощность хранилища данных. Это внешний интерфейс, который взаимодействует со всеми приложениями и подключениями. Механизм MPP запускается на управляющем узле, чтобы оптимизировать и координировать параллельные запросы. При отправке T-SQL-запроса в хранилище данных SQL управляющий узел преобразует его в запросы, которые будут выполняться на каждом вычислительном узле в параллельном режиме.

### <a name="compute-nodes"></a>Вычислительные узлы

Вычислительные узлы обеспечивают вычислительную мощность. Чтобы выполнить обработку, дистрибутивы сопоставляются с вычислительными узлами. Когда вы оплачиваете использование дополнительных вычислительных ресурсов, хранилище данных SQL повторно сопоставляет дистрибутивы с доступными вычислительными узлами. Число вычислительных узлов колеблется от 1 до 60 и определяется уровнем обслуживания хранилища данных.

У каждого вычислительного узла есть идентификатор узла, который видно в представлениях системы. Идентификатор вычислительного узла можно увидеть в столбце node_id в системных представлениях, имена которых начинаются с sys.pdw_nodes. Список системных представлений см. в [системном представлении MPP](sql-data-warehouse-reference-tsql-statements.md).

### <a name="data-movement-service"></a>Служба перемещения данных
Служба перемещения данных (DMS) — это технология перемещения данных, которая координирует перемещение данных между вычислительными узлами. Некоторым запросам требуется перемещение данных, чтобы параллельные запросы вернули точные результаты. При необходимости перемещения данных DMS гарантирует, что нужные данные окажутся в нужном расположении. 

## <a name="distributions"></a>Дистрибутивы

Распределение представляет собой базовую единицу хранения и обработки параллельных запросов, выполняемых для распределенных данных. При выполнении запроса в хранилище данных SQL формируются 60 небольших запросов, которые выполняются параллельно. Каждый из этих 60 небольших запросов выполняется в одном из распределений данных. Каждый вычислительный узел управляет одним или несколькими из 60 распределений. Хранилище данных с максимальным количеством вычислительных ресурсов содержит одно распределение на одном вычислительном узле. Хранилище данных с минимальным количеством вычислительных ресурсов содержит все распределения на одном вычислительном узле.  

## <a name="hash-distributed-tables"></a>Таблицы с хэш-распределением
С помощью распределенной хэш-таблицы можно обеспечить наибольшую производительность запроса для операций объединения и агрегирования для больших таблиц. 

Чтобы сегментировать данные в распределенную хэш-таблицу, в хранилище данных SQL используется хэш-функция для детерминированного назначения каждой строки отдельному распределению. В определении таблицы один из столбцов определяется как столбец распределения. Хэш-функция использует значения в столбце распределения для присвоения каждой строки распределению.

На следующей схеме показано, как полная (нераспределенная) таблица хранится в качестве хэш-распределенной. 

![Распределенная таблица](media/sql-data-warehouse-distributed-data/hash-distributed-table.png "Распределенная таблица")  

* Каждая строка относится к одному распределению.  
* Детерминированный хэш-алгоритм присваивает каждую строку одному распределению.  
* Количество строк таблицы в распределении зависит от размеров таблиц (как показано на схеме).

Существуют влияющие на производительность факторы, которые учитываются при выборе столбца распределения. Например, определенность, неравномерное смещение данных и типы запросов, выполняемых в системе.

## <a name="round-robin-distributed-tables"></a>Таблицы с распределением методом циклического перебора
Таблица с распределением методом циклического перебора — это самая простая таблица для создания и обеспечения высокой производительности, если ее использовать как промежуточную таблицу для нагрузок.

В таблице с распределением методом циклического перебора данные распределяются равномерно, но без какой-либо последующей оптимизации. Распределение сначала выбирается случайным образом, а затем буферы строк назначаются распределениям последовательно. Вы можете быстро загрузить данные в таблицу с распределением методом циклического перебора, но производительность запроса будет лучше, если использовать распределенные хэш-таблицы. Для объединения таблиц с распределением методом циклического перебора требуется перегруппировка данных, что требует дополнительного времени.


## <a name="replicated-tables"></a>Реплицированные таблицы
Реплицированная таблица обеспечивает наилучшую производительность запросов для небольших таблиц.

Полная копия реплицированной таблицы хранится на каждом вычислительном узле. В результате репликация таблицы устраняет необходимость передавать данные между вычислительными узлами перед операциями соединения или агрегирования. Реплицированные таблицы лучше всего использовать для небольших таблиц. При записи данных требуется дополнительное хранилище и дополнительные расходы, что делает использование больших таблиц нецелесообразным.  

На схеме ниже показана реплицированная таблица. Для хранилища данных SQL реплицированная таблица кэшируется в первом распределении на каждом вычислительном узле.  

![Реплицируемая таблица](media/sql-data-warehouse-distributed-data/replicated-table.png "Реплицируемая таблица") 

## <a name="next-steps"></a>Дальнейшие действия
Теперь, когда вам уже известны некоторые сведения о хранилище данных SQL, узнайте о том, как [создать хранилище данных SQL][create a SQL Data Warehouse] и [загрузить демонстрационные данные][load sample data]. Если вы раньше не работали с Azure, используйте [глоссарий Azure][Azure glossary], чтобы узнать значение новых терминов. Или ознакомьтесь со следующими ресурсами, посвященными хранилищу данных SQL.  

* [Истории успеха клиентов]
* [Блоги]
* [Запросы функций]
* [Видеоролики]
* [Блоги группы консультирования клиентов]
* [Создание запроса в службу поддержки]
* [Форум MSDN]
* [Форум Stack Overflow]
* [Twitter]

<!--Image references-->
[1]: ./media/sql-data-warehouse-overview-what-is/dwarchitecture.png

<!--Article references-->
[Создание запроса в службу поддержки]: ./sql-data-warehouse-get-started-create-support-ticket.md
[load sample data]: ./sql-data-warehouse-load-sample-databases.md
[create a SQL Data Warehouse]: ./sql-data-warehouse-get-started-provision.md
[Migration documentation]: ./sql-data-warehouse-overview-migrate.md
[SQL Data Warehouse solution partners]: ./sql-data-warehouse-partner-business-intelligence.md
[Integrated tools overview]: ./sql-data-warehouse-overview-integrate.md
[Backup and restore overview]: ./sql-data-warehouse-restore-database-overview.md
[Azure glossary]: ../azure-glossary-cloud-terminology.md

<!--MSDN references-->

<!--Other Web references-->
[Истории успеха клиентов]: https://azure.microsoft.com/case-studies/?service=sql-data-warehouse
[Блоги]: https://azure.microsoft.com/blog/tag/azure-sql-data-warehouse/
[Блоги группы консультирования клиентов]: https://blogs.msdn.microsoft.com/sqlcat/tag/sql-dw/
[Запросы функций]: https://feedback.azure.com/forums/307516-sql-data-warehouse
[Форум MSDN]: https://social.msdn.microsoft.com/Forums/azure/home?forum=AzureSQLDataWarehouse
[Форум Stack Overflow]: http://stackoverflow.com/questions/tagged/azure-sqldw
[Twitter]: https://twitter.com/hashtag/SQLDW
[Видеоролики]: https://azure.microsoft.com/documentation/videos/index/?services=sql-data-warehouse
[SLA for SQL Data Warehouse]: https://azure.microsoft.com/support/legal/sla/sql-data-warehouse/v1_0/
[Volume Licensing]: http://www.microsoftvolumelicensing.com/DocumentSearch.aspx?Mode=3&DocumentTypeId=37
[Service Level Agreements]: https://azure.microsoft.com/support/legal/sla/
