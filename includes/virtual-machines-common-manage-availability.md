## <a name="understand-vm-reboots---maintenance-vs-downtime"></a>Общие сведения о перезагрузках виртуальной машины. Обслуживание и простой
Существует три сценария, которые могут привести toovirtual машины в Azure понижает: обслуживания незапланированных оборудования, незапланированных простоев и планового обслуживания.

* **Незапланированного события обслуживания оборудования** возникает, когда hello платформы Azure прогнозирует hello оборудования или любой платформы компонента связанного tooa физического компьютера, связана с toofail. При платформы hello прогнозирует сбоя, она будет выдавать оборудования незапланированного обслуживания событий tooreduce hello влияние toohello виртуальных машин, размещенных на этом оборудовании. Azure использует hello toomigrate технологии динамической миграции виртуальных машин из hello сбои оборудования tooa работоспособную физическую машину. Динамическая миграция — виртуальной Машины, сохраняя операции, что только пауз hello виртуальной машины в течение некоторого времени. Память, открытых файлов и сетевых подключений, сохраняются, но производительность может уменьшиться до или после события hello. В случаях, когда не может использоваться динамическая миграция hello виртуальной Машины могут возникнуть непредвиденные простои, как описано ниже.


* **Непредвиденные простои** редко происходит при сбое оборудования hello или основной виртуальной машины физической инфраструктуры hello иным образом. Это могут быть сбои локальной сети или локальных жестких дисков, а также другие ошибки на уровне стойки. При обнаружении такой сбой hello платформы Azure автоматически переносит (heals) на виртуальной машине tooa работоспособную физическую машину. Во время hello Восстанавливающая процедуры, виртуальные машины простаивать (Перезагрузка) и к некоторой потере случаях hello временный диск. Hello присоединенного ОС и дисков данных всегда сохраняются. 

* **Планового обслуживания события** периодических обновлений, внесенных Microsoft toohello базовой платформы Azure tooimprove общую надежность, производительность и безопасность инфраструктуры платформы hello, работающих виртуальных машин на. Большинство таких обновлений выполняется без какого-либо воздействия на ваши виртуальные машины или облачные службы. Дополнительные сведения см. в статье [Обслуживание с сохранением виртуальной машины посредством миграции на месте](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/preserving-maintenance). Хотя hello платформы Azure пытается toouse обслуживания сохранения виртуальной Машины в все возможные случаи, есть редких случаях, когда эти обновления требуют перезагрузки виртуальной машины tooapply hello необходимые обновления toohello базовой инфраструктуры. В этом случае можно произвести планового обслуживания Azure с операции повторного развертывания обслуживания, запуская hello обслуживания для их виртуальных машин в окне приветствия подходящее время. Дополнительные сведения см. в статье [Плановое обслуживание виртуальных машин Windows](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/planned-maintenance/).


влияние hello tooreduce время простоя из-за tooone или нескольких таких событий, рекомендуется hello рекомендаций, высокий уровень доступности для виртуальных машин.

* [Настройка нескольких виртуальных машин в группе доступности для обеспечения избыточности]
* [Использование управляемых дисков для виртуальных машин в группе доступности]
* [Использовать tooVM ответ tooproactively запланированные события, влияющие на события] (https://docs.microsoft.com/en-us/azure/virtual-machines/virtual-machines-scheduled-events)
* [Настройка каждого уровня приложений в отдельных группах доступности]
* [Объединение балансировщика нагрузки с группами доступности]

## <a name="configure-multiple-virtual-machines-in-an-availability-set-for-redundancy"></a>Настройка нескольких виртуальных машин в группе доступности для обеспечения избыточности
приложение tooyour tooprovide избыточности, мы рекомендуем сгруппировать две или несколько виртуальных машин в наборе доступности. Эта конфигурация гарантирует, что во время любого запланированного или незапланированного события обслуживания, по крайней мере одна виртуальная машина доступна и соответствует hello 99,95% соглашение об уровне ОБСЛУЖИВАНИЯ Azure. Дополнительные сведения см. в разделе hello [соглашения об уровне ОБСЛУЖИВАНИЯ для виртуальных машин](https://azure.microsoft.com/support/legal/sla/virtual-machines/).

> [!IMPORTANT]
> Не рекомендуется оставлять в группе доступности один экземпляр виртуальной машины. В такой конфигурации виртуальные машины не смогут обеспечивать уровень обслуживания, предусмотренный соглашением об уровне обслуживания, и будут простаивать во время плановых сеансов обслуживания Azure, за исключением случаев, когда отдельная виртуальная машина использует [хранилище Azure класса Premium](../articles/storage/common/storage-premium-storage.md). Для одного виртуальных машин с помощью хранилища premium применяется hello соглашения об уровне ОБСЛУЖИВАНИЯ Azure.

Каждая виртуальная машина в наборе доступности назначается **домен обновления** и **домен сбоя** по hello базовой платформы Azure. Набор доступности 5 доменами обновления без возможности настройки пользователя назначаются по умолчанию (развертывания диспетчера ресурсов можно повысить tooprovide домены обновления too20) tooindicate группы виртуальных машин и физического оборудования можно перезагрузить в hello то же время. При более пяти виртуальных машин настроены в одну группу доступности, hello шестой виртуальной машины помещается в hello же обновлений домена как первая виртуальная машина hello hello седьмой в же обновить домен hello второй виртуальной машины и поэтому hello в. порядок Hello доменов обновления, которые перезагружается может не выполняться последовательно во время планового обслуживания, но только одно обновление домена перезагружается одновременно. Домен перезагруженный обновления получает toorecover 30 минут до инициализации обслуживания в домене другое обновление.

Домены сбоя определения hello группы виртуальных машин, которые совместно используют общие выключателем источника и сети. По умолчанию hello виртуальных машин в наборе доступности должны быть разделены между toothree домены сбоя для развертывания диспетчера ресурсов (два домены отказоустойчивости для классического). Хотя размещение виртуальных машин в наборе доступности не защищает приложения от операционной системы или сбои конкретного приложения, его снизить влияние hello потенциальных сбоев физического оборудования, сбои в работе сети или прерываний питания.

<!--Image reference-->
   ![Концептуальный рисунок hello обновления домена и отказоустойчивость Конфигурация домена](./media/virtual-machines-common-manage-availability/ud-fd-configuration.png)

## <a name="use-managed-disks-for-vms-in-an-availability-set"></a>Использование управляемых дисков для виртуальных машин в группе доступности
Если вы используете виртуальные машины с дисками неуправляемые, рекомендуется [преобразования виртуальных машин в набор доступности дисков управляемых toouse](../articles/virtual-machines/windows/convert-unmanaged-to-managed-disks.md).

[Управлять дисками](../articles/virtual-machines/windows/managed-disks-overview.md) обеспечивают более высокую надежность, для группы доступности за счет того, hello диски виртуальных машин в группе доступности, достаточно отделены друг от друга tooavoid единых точек отказа. Это делается автоматически размещая hello дисков в хранилища различных кластеров. Сбой из-за toohardware или ошибок программного обеспечения кластера хранилища ошибкой hello экземпляров виртуальных Машин с дисками на эти метки.

![Управляемые диски в доменах сбоя](./media/virtual-machines-common-manage-availability/md-fd.png)

> [!IMPORTANT]
> Hello количество доменов сбоя для группы доступности управляемого зависит от региона - два или три в одном регионе. Hello следующей таблице показаны hello номер в одном регионе

[!INCLUDE [managed-disks-common-fault-domain-region-list](managed-disks-common-fault-domain-region-list.md)]

Если планируется toouse виртуальных машин с [неуправляемого дисков](../articles/virtual-machines/windows/about-disks-and-vhds.md#types-of-disks), следуйте ниже советы и рекомендации для учетных записей хранилища, где хранятся виртуальные жесткие диски (VHD) виртуальных машин в виде [страничные большие двоичные объекты](https://docs.microsoft.com/rest/api/storageservices/Understanding-Block-Blobs--Append-Blobs--and-Page-Blobs#about-page-blobs).

1. **Исключить все диски (операционной системы и данных), связанный с виртуальной Машины в hello учетную запись хранения**
2. **Просмотрите hello [ограничения](../articles/storage/common/storage-scalability-targets.md) hello количество неуправляемых дисков в учетной записи хранения** перед добавлением учетной записи хранилища дополнительные tooa виртуальных жестких дисков
3. **Используйте отдельные учетные записи хранения для каждой виртуальной машины в группе доступности.** Не используйте учетные записи хранения с несколькими виртуальными машинами в hello же группу доступности. Он допустим для виртуальных машин между разными учетными записями хранения наборов доступности tooshare выше рекомендации соблюдены ли

## <a name="configure-each-application-tier-into-separate-availability-sets"></a>Настройка каждого уровня приложений в отдельных группах доступности
Если виртуальные машины все практически идентичны и обслуживать hello же целях для вашего приложения, рекомендуется настроить группу доступности для каждого уровня приложения.  При наличии двух разных уровней в hello же группу доступности, все виртуальные машины в hello того же уровня приложения можно перезагрузить за один раз. Настроив хотя бы по две виртуальные машины в группе доступности для каждого уровня, вы обеспечите доступность хотя бы одной виртуальной машины на каждом уровне.

Например можно поместить все виртуальные машины hello в hello интерфейсной части приложения под управлением IIS, Apache Nginx в одну группу доступности. Убедитесь, что только интерфейса виртуальной машины размещаются в hello таким же группы доступности. Аналогичным образом убедитесь, что в другую группу доступности включены только виртуальные машины, относящиеся к уровню данных, например реплицированные виртуальные машины SQL Server или MySQL.

<!--Image reference-->
   ![Уровни приложений](./media/virtual-machines-common-manage-availability/application-tiers.png)

## <a name="combine-a-load-balancer-with-availability-sets"></a>Объединение подсистемы балансировки нагрузки с группами доступности
Объединение hello [подсистемы балансировки нагрузки Azure](../articles/load-balancer/load-balancer-overview.md) доступности набора tooget hello возможность быстрого восстановления большинство приложений. Hello подсистемы балансировки нагрузки Azure распределяет трафик между несколькими виртуальными машинами. Для наших стандартный уровень виртуальных машин включается hello подсистемы балансировки нагрузки Azure. Не все уровни виртуальной машины включают hello подсистемы балансировки нагрузки Azure. Дополнительные сведения о балансировке нагрузки виртуальных машин см. в статье [Балансировка нагрузки для служб инфраструктуры Azure](../articles/virtual-machines/virtual-machines-linux-load-balance.md).

Если hello балансировки нагрузки не настроена toobalance трафика между несколькими виртуальными машинами, то любое событие планового обслуживания влияет hello только обслуживающий трафик виртуальной машины, причиной сбоя tooyour уровня приложения. Размещение нескольких виртуальных машин из hello же уровня в группе hello же Подсистема балансировки нагрузки и доступности включает набор трафика toobe постоянно обслуживаемых хотя бы один экземпляр.


<!-- Link references -->
[Настройка нескольких виртуальных машин в группе доступности для обеспечения избыточности]: #configure-multiple-virtual-machines-in-an-availability-set-for-redundancy
[Настройка каждого уровня приложений в отдельных группах доступности]: #configure-each-application-tier-into-separate-availability-sets
[Объединение балансировщика нагрузки с группами доступности]: #combine-a-load-balancer-with-availability-sets
[Avoid single instance virtual machines in availability sets]: #avoid-single-instance-virtual-machines-in-availability-sets
[Использование управляемых дисков для виртуальных машин в группе доступности]: #use-managed-disks-for-vms-in-an-availability-set
