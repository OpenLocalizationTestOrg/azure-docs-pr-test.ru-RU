Управление удостоверениями столь же важно, в общедоступном облаке hello как на локальном компьютере. toohelp с этим Azure поддерживает несколько технологий различных облачных удостоверений. К ним относятся следующие:

* Windows Server Active Directory (обычно называется просто AD) можно запускать в облаке hello, с использованием виртуальных машин, созданных с помощью виртуальных машин Azure. Такой подход имеет смысл при работе с Azure tooextend локального центра обработки данных в облаке hello.
* Можно использовать Azure Active Directory toogive пользователями единого входа слишком[программное обеспечение как услуга (SaaS)](https://azure.microsoft.com/overview/what-is-saas/) приложений. Эта технология используется, например, в Microsoft Office 365, а также может использоваться в приложениях, работающих на платформе Azure и на других облачных платформах.
* Приложения, выполняющиеся в hello облачной или локальной можно использовать Azure Active Directory Access Control toolet входе с использованием идентификаторов от Facebook, Google, Microsoft и других поставщиков удостоверений.

В этой статье описываются все три варианта.

## <a name="table-of-contents"></a>Оглавление
* [Выполнение Windows Server Active Directory на виртуальных машинах](#adinvm)
* [Использование Azure Active Directory](#ad)
* [Использование службы контроля доступа Azure Active Directory](#ac)

## <a name="adinvm"></a>Выполнение Windows Server Active Directory на виртуальных машинах
Выполнение Windows Server AD на виртуальных машинах Azure очень похоже на выполнение в локальных средах. [На рисунке 1](#fig1) показан типичный пример того, как это выглядит.

![Azure Active Directory на виртуальной машине](./media/identity/identity_01_ADinVM.png)

<a name="Fig1"></a>Рисунок 1: Windows Server Active Directory можно запускать в Azure виртуальными машинами, подключенными tooan организации на локальном центре обработки данных, с помощью виртуальной сети Azure.

В приведенном здесь примере hello Windows Server AD работает на виртуальных машинах, созданных с помощью виртуальных машин Azure, технологию IaaS hello платформы. Эти виртуальные машины и некоторые другие группируются в виртуальную сеть, подключенную tooan локального центра обработки данных с помощью виртуальной сети Azure. Виртуальная сеть Hello вырезает группы облака виртуальных машин, которые взаимодействуют с локальной сетью hello посредством подключения к виртуальной частной сети (VPN). Выполнив этот позволяет эти виртуальные машины Azure выглядеть просто еще одно центра данных в локальной подсети toohello. Как показано на рисунке hello, два из этих виртуальных машин работают контроллеры домена Windows Server AD. Hello других виртуальных машин в виртуальной сети hello могут работать приложения, такие как SharePoint, или используется другим способом, например, для разработки и тестирования. Hello локального центра обработки данных также выполняется двух контроллеров домена Windows Server AD.

Существует несколько вариантов подключения контроллеры домена hello в облаке hello запущенных на локальном компьютере.

* — Включить все контроллеры в один домен Active Directory.
* Создайте отдельный AD домены локально и в облаке hello, которые являются частью hello того же леса.
* Создайте в hello облачных и локальных лесов AD, а затем соедините hello лесов, с помощью отношения доверия между лесами или Windows Server службы Active Directory федерации (AD FS), которой могут выполняться в виртуальных машинах в Azure.

Независимо от выбираете, администратору следует убедиться в том, запросы проверки подлинности от локальных пользователей перейдите toocloud контроллеры домена только при необходимости, так как облаке toohello связи hello скорее всего toobe медленнее, чем в локальной сети. Другой фактор tooconsider в подключении облачные и локальные контроллеры домена — hello трафик, созданного репликацией. Контроллеры домена в облаке hello обычно являются в собственном сайте AD, который позволяет администратору tooschedule как часто выполняется репликация. Azure взимает плату за трафик, отправленный из центра обработки данных Azure, несмотря на то, что не отправлено байт в, который может повлиять на выбор hello администратора репликации. Также следует отметить, что хотя Azure поддерживает собственную систему доменных имен (DNS), у этой службы нет компонентов, требуемых службой Active Directory (таких как поддержка динамических DNS и записей SRV). По этой причине под управлением Windows Server AD в Azure нужно настроить собственный DNS-серверов в облаке hello.

Выполнение Windows Server AD на виртуальных машинах Azure может иметь смысл в различных ситуациях. Ниже приведены некоторые примеры:

* При использовании виртуальных машин Azure в качестве расширения собственного центра обработки данных, может запускать приложения в облаке hello, для которых требуются локального домена контроллеры toohandle сущности, такие как запросы на встроенную проверку подлинности Windows или запросов LDAP. SharePoint, например, часто взаимодействует с Active Directory и поэтому хотя возможных toorun фермы SharePoint в Azure с использованием локального каталога, настройке контроллеров домена в облаке hello значительно повышают производительность. (Это важно toorealize, что это не обязательно нужно, однако достаточно приложений могут успешно выполняться в облаке hello, с использованием только контроллеры домена в локальной среде.)
* Предположим, что дальние филиале отсутствуют ресурсы toorun hello собственными контроллерами домена. В настоящее время ее пользователи должны пройти проверку подлинности контроллеров toodomain на hello другой стороне hello world — имена входа выполняются медленно. ОС Azure Active Directory в центре Microsoft ближе можно ускорить это не требует дополнительных серверов в филиале hello.
* Организации, которая использует Azure для аварийного восстановления, то можно поддерживать небольшой набор активных виртуальных машин в облаке hello, включая контроллера домена. Затем можно подготовить tooexpand этого сайта как необходимые tootake через сбоев в другом месте.

Существуют и другие возможности. Например, вы не требуется Windows Server AD в облаке tooan hello tooconnect локального центра обработки данных. При желании toorun фермы SharePoint, обработавшего определенной группы пользователей, например, каждый из которых будет вход только с использованием облачных удостоверений, можно создать автономный леса в Azure. Способ использования этой технологии зависит от целей. (Более подробное руководство по использованию Windows Server AD с Azure [см. здесь](http://msdn.microsoft.com/library/windowsazure/jj156090.aspx).)

## <a name="ad"></a>Использование Azure Active Directory
По мере роста популярности приложений SaaS возникает очевидный вопрос: какие службы каталогов должны использовать эти облачные приложения? Вопрос toothat ответов корпорации Майкрософт — Azure Active Directory.

Существует два основных варианта с помощью этой службы каталогов в облаке hello.

* — Люди и организации, использующие только приложения SaaS, могут использовать Azure Active Directory в качестве единой службы каталогов.
* Организациях, где работает Windows Server Active Directory можно подключиться их tooAzure каталогов в локальной среде Active Directory, а затем использовать его toogive своим пользователям единый вход tooSaaS приложений.

[Рис. 2](#fig2) hello показан первый из этих двух вариантов, где все, что требуется — в Azure Active Directory.

![Azure Active Directory на виртуальной машине](./media/identity/identity_02_AD.png)

<a name="fig2"></a>Рисунок 2: Azure Active Directory позволяет пользователям организации-tooSaaS приложений, включая Office 365.

Как показано на рисунке hello, Azure AD — это служба несколькими клиентами. Это значит, что она может одновременно поддерживать множество организаций и хранить каталоги пользователей для каждой из них. В этом примере пользователь в организации A пытается tooaccess приложения SaaS. Это приложение может быть частью Office 365, например SharePoint Online, или любым другим — приложения сторонних разработчиков также могут использовать эту технологию. Поскольку Azure AD поддерживает протокол SAML 2.0 hello, все, что требовал из приложения hello возможность toointeract использует этот отраслевого стандарта. (На самом деле приложения, использующие Azure AD, могут выполняться в любом центре обработки данных, а не только в центре обработки данных Azure).

Hello процесс начинается, когда hello пользователь получает доступ к приложению SaaS (шаг 1). toouse это приложение hello пользователь должен представить маркер, выданный службой Azure AD.

Этот маркер содержит информацию, определяющую пользователя hello и цифровой подписью Azure AD. токен tooget hello, hello пользователь проходит проверку себе tooAzure AD путем предоставления имени пользователя и пароля (шаг 2). Затем Azure AD возвращает маркер hello, он должен (шаг 3).

Затем этот маркер отправляется приложения SaaS toohello (шаг 4), который проверяет подпись маркера hello и использует его содержимое (шаг 5). Как правило, приложение hello будет использовать сведения об удостоверении hello hello маркер содержит toodecide hello какие сведения пользователь может быть tooaccess и может быть по-другому.

Если приложение hello необходимы дополнительные сведения о пользователе hello, чем что содержится в маркере hello, его можно запросить непосредственно из Azure AD, используя API Azure AD Graph hello (шаг 6). Hello начальной версии Azure AD, схема directory hello достаточно прост: он содержит только пользователей, группы и связи между ними. Приложения могут использовать этот toolearn сведения о соединениях между пользователями. Например предположим, что tooknow, являющийся руководителем этого пользователя toodecide, является ли он доступ toosome фрагмент данных, необходимых приложению. Его можно узнать с помощью запроса к Azure AD через Graph API hello.

Hello Graph API используется обычный RESTful протокол, который позволяет простым toouse от большинства клиентов, включая мобильные устройства. Hello API также поддерживает hello расширения, определенные в OData, добавление такие элементы, как доступ к данным клиентов toolet запросов языка полезнее способами. (Дополнительные сведения по OData см. в [этом документе](http://download.microsoft.com/download/E/5/A/E5A59052-EE48-4D64-897B-5F7C608165B8/IntroducingOData.pdf).) Поскольку hello Graph API используется toolearn о связях между пользователями, она позволяет понять hello социальных граф, который внедряется в схеме hello Azure AD для конкретной организации (что именно он вызывается hello Graph API) приложения. И tooauthenticate сам запрашивает tooAzure AD для Graph API, приложение использует OAuth 2.0.

Если организация не использует Windows Server Active Directory — он не имеет локальных серверов и доменов — и использует только облачных приложений, которые используют Azure AD, с помощью этого облачного каталога даст hello фирмы пользователи единого входа tooall из них. Хотя этот сценарий становится все более распространенным, большинство организаций по-прежнему используют локальные домены, созданные с помощью Windows Server Active Directory. Azure AD предоставляет tooplay полезно роли здесь также, как [рис. 3](#fig3) показано.

![Azure Active Directory в виртуальной машине](./media/identity/identity_03_AD.png)
<a id="fig3"></a>рис. 3: организации можно создать федерацию Windows Server Active Directory с Azure Active Directory toogive-tooSaaS приложениям пользователи.

В этом сценарии пользователь в организации B хочет tooaccess приложения SaaS. Прежде, чем она делает это, Администраторы организации hello каталога необходимо установить отношения федерации с Azure AD с помощью AD FS, как показано на рисунке hello. Эти администраторы также необходимо настроить синхронизацию данных между hello организации в локальной среде Windows Server AD и Azure AD. Это автоматически копирует пользовательской и групповой информации из tooAzure directory hello в локальной среде AD. Обратите внимание, что это позволяет: В результате организации hello расширяет его в локальный каталог в облаке hello. Комбинирование Windows Server AD и Azure AD в этом случае дает hello организации служба каталогов, в которой можно управлять как единой сущностью, сохраняя использует объем как локально, так и в облаке hello.

toouse Azure AD hello сначала входе пользователя в домене Active Directory локальной tooher обычным образом (шаг 1). Когда она пытается tooaccess hello SaaS приложения (шаг 2), hello федерации в результате Azure AD выдает свой маркер для этого приложения (шаг 3). (Дополнительные сведения о действии федерации см. в документе [Claims-Based Identity for Windows: Technologies and Scenarios](http://www.davidchappell.com/writing/white_papers/Claims-Based_Identity_for_Windows_v3.0--Chappell.docx) (Удостоверение на основе утверждений для Windows: технологии и сценарии).) Как ранее, этот маркер содержит информацию, определяющую пользователя hello и цифровой подписью Azure AD. Затем этот маркер отправляется приложения SaaS toohello (шаг 4), который проверяет подпись маркера hello и использует его содержимое (шаг 5). И в предыдущем сценарии hello, hello hello SaaS, приложение может использовать Graph API toolearn Дополнительные сведения о пользователе, если требуется (шаг 6).

Сегодня Azure AD не может полностью заменить локальную службу Windows Server AD. Как уже упоминалось hello облачного каталога имеет гораздо более простой схемы, а также отсутствует такие элементы, как групповая политика, hello возможность toostore сведения о компьютерах и поддержка LDAP. (На самом деле компьютером Windows не может быть настроенный toolet входа пользователей в tooit с помощью всего лишь Azure AD — это не поддерживается.) Вместо этого hello начальной Azure AD имеют позволяя корпоративных приложений доступ пользователей в облаке hello без сохранения отдельное имя входа и освобождение локальные администраторы каталога вручную синхронизировать свои локального каталога с Каждое приложение SaaS, который использует их организации. Со временем Однако ожидается, что этот tooaddress службы каталогов облачной более широкого круга сценариев.

## <a name="ac"></a>Использование службы контроля доступа Azure Active Directory
Удостоверение на основе облачных технологий можно toosolve используется ряд проблем. Azure Active Directory пользователям можно предоставить организации-toomultiple приложений SaaS, например. Но технологии удостоверения в облаке hello также может использоваться в других целях.

Предположим, например, что приложение желает своим пользователям вход с использованием токенов, выданных несколько toolet *Поставщики удостоверений (IdPs)*. Сегодня существует множество поставщиков удостоверений, таких как Facebook, Google, Майкрософт и другие, и приложения часто позволяют пользователям использовать их удостоверения для входа. Необходимо приложение зачем toomaintain свой собственный список пользователей и паролей при вместо этого они могут использовать идентификаторы, которые уже существуют? Принятие существующих удостоверений облегчает жизнь и пользователям, имеющим одну меньше tooremember имя пользователя и пароль, а также для людей hello, создание приложения hello, который больше не нужен toomaintain свой список имен пользователей и паролей.

Однако, хотя все поставщики удостоверений выдают маркеры, эти маркеры нестандартные — каждый поставщик использует собственный формат. Кроме того также hello сведения в этих токенов не standard. Приложение, которое желает tooaccept токенов, выданных, скажем, Facebook, Google и Microsoft столкнетесь с задачей hello написания уникальный код toohandle, каждый из этих форматов.

Но так ли это необходимо? Почему бы не создать посредника, который генерирует единый формат маркера с общим представлением сведений об удостоверении? Этот подход может упростить жизненный для hello разработчики приложений, так как теперь они должны toohandle только один тип маркера. Azure Active Directory Access Control осуществляется точно, предоставляя посредника в облаке hello для работы с различными маркерами. [На рисунке 4](#fig4) показано, как это работает

![Azure Active Directory в виртуальной машине](./media/identity/identity_04_IdentityProviders.png)
<a id="fig4"></a>рис. 4: Azure Active Directory Access Control упрощает для приложений tooaccept удостоверение маркеры, выпущенные разными поставщиками удостоверений.

Hello процесс начинается, когда пользователь пытается приложения hello tooaccess из браузера. перенаправляет свой tooan поставщика удостоверений по его выбору приложение Hello (и это приложение hello также доверяет). Она проверяет подлинность себе toothis поставщика удостоверений, например путем ввода имени пользователя и пароля (шаг 1) и hello поставщика удостоверений возвращает маркер, содержащий сведения о своей (шаг 2).

Как показано на рисунке hello, управление доступом поддерживает ряд различных облачных IdPs, включая учетные записи, созданные Google, Yahoo, Facebook, корпорация Майкрософт (которая ранее называлась Windows Live ID) и любой поставщик OpenID. Поддерживаются также удостоверения, созданные с помощью Azure Active Directory, и, посредством федерации с AD FS, с помощью Windows Server Active Directory. Hello предназначена удостоверения toocover hello чаще всего используется в настоящее время ли они выпущен IdPs в облаке hello или в локальной среде.

Когда браузер пользователя hello остается токен IdP из своей зависимости от выбранного поставщика удостоверений, он отправляет токен tooAccess управления (шаг 3). Управление доступом проверяет токен hello, убедившись, что он действительно был выдан этого поставщика удостоверений, а затем создает новый маркер toohello правила, определенные для этого приложения в соответствии с. Как Azure Active Directory управление доступом — это служба нескольких клиентов, но это hello клиентов, приложения, а не организаций-клиентов. Каждое приложение может получить собственное пространство имен, как показано на рисунке hello и можно задать различные правила авторизации и многих других.

Эти правила позволяют администратору каждого приложения определить порядок преобразования маркеров различных поставщиков в маркер Access Control. Например, если поставщики удостоверений используют разные типы для представления имен пользователей, правила Access Control могут преобразовать все эти типы в общий тип имени пользователя. Управление доступом затем отправляет этот новый маркера задней toohello браузера (шаг 4), который отправляет его toohello приложения (шаг 5). Получив токен управления доступом hello, приложение hello проверяет, что этот токен действительно был выдан контроля доступа, а затем использует сведения hello, что она содержит (шаг 6).

Хотя этот процесс может показаться немного сложным, фактически таким образом жизни значительно упрощается для hello создателя приложения hello. А не обрабатывает различные токены, содержащий различные сведения, приложение hello может принимать удостоверения, выданный различными поставщиками удостоверений, при получении один токен со знакомыми сведениями по-прежнему. Кроме того вместо требуют toobe каждого приложения настроен tootrust различные IdPs, доверительные отношения вместо поддерживаются службой управления доступом - достаточно лишь доверять приложение.

Стоит обратить внимание, что ничего не сказано о контроля доступа равноценных tooWindows - точно так же может использоваться приложением Linux, который принимается только удостоверений Google и Facebook. И, несмотря на то, что управление доступом является частью hello семейства Azure Active Directory, можно представить ее как службу полностью distinct из процесс, описанный в предыдущем разделе hello. Хотя обе технологии работают с удостоверением, они решить проблемы, совершенно другой (несмотря на то, что корпорация Майкрософт говорят, что ожидается hello toointegrate двух в некоторой точке).

Работа с удостоверениями важна практически в любом приложении. Задача Hello контроля доступа является toomake облегчить работу разработчиков toocreate приложений, которые принимать удостоверения от различных поставщиков. Поместив этой службы в облаке hello, корпорация Майкрософт предоставляет им tooany доступные приложения, запущенного на любой платформе.

## <a name="about-hello-author"></a>О hello автора
Дэвид Чаппел (David Chappell) является главой компании Chappell & Associates [www.davidchappell.com](http://www.davidchappell.com), расположенной в Сан-Франциско, штат Калифорния.

