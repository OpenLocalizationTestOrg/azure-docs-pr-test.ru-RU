### <a name="open-tcp-ports-in-the-windows-firewall-for-the-default-instance-of-the-database-engine"></a><span data-ttu-id="bbc6d-101">Откройте TCP-порты в брандмауэре Windows для экземпляра ядра СУБД по умолчанию</span><span class="sxs-lookup"><span data-stu-id="bbc6d-101">Open TCP ports in the Windows firewall for the default instance of the Database Engine</span></span>
1. <span data-ttu-id="bbc6d-102">Подключитесь к виртуальной машине через удаленный рабочий стол.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-102">Connect to the virtual machine with Remote Desktop.</span></span> <span data-ttu-id="bbc6d-103">Подробные инструкции по подключению к виртуальной машине см. в разделе [Открывать виртуальные машины с помощью удаленного рабочего стола](../articles/virtual-machines/windows/sql/virtual-machines-windows-portal-sql-server-provision.md#open-the-vm-with-remote-desktop).</span><span class="sxs-lookup"><span data-stu-id="bbc6d-103">For detailed instructions on connecting to the VM, see [Open a SQL VM with Remote Desktop](../articles/virtual-machines/windows/sql/virtual-machines-windows-portal-sql-server-provision.md#open-the-vm-with-remote-desktop).</span></span>
2. <span data-ttu-id="bbc6d-104">После входа введите **WF.msc**на начальном экране и нажмите клавишу ВВОД.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-104">Once logged in, at the Start screen, type **WF.msc**, and then hit ENTER.</span></span>
   
    ![Запустите программу брандмауэра](./media/virtual-machines-sql-server-connection-steps/12Open-WF.png)
3. <span data-ttu-id="bbc6d-106">В поле **Брандмауэр Windows в режиме повышенной безопасности** в левой области щелкните правой кнопкой мыши **Правила для входящих подключений** и нажмите кнопку **Создать правило** в области действий.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-106">In the **Windows Firewall with Advanced Security**, in the left pane, right-click **Inbound Rules**, and then click **New Rule** in the action pane.</span></span>
   
    ![Создать правило](./media/virtual-machines-sql-server-connection-steps/13New-FW-Rule.png)
4. <span data-ttu-id="bbc6d-108">В диалоговом окне **Мастер создания правила для нового входящего подключения** в области **Тип правила** выберите **Порт** и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-108">In the **New Inbound Rule Wizard** dialog box, under **Rule Type**, select **Port**, and then click **Next**.</span></span>
5. <span data-ttu-id="bbc6d-109">В диалоговом окне **Протокол и порты** используйте значение по умолчанию **TCP**.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-109">In the **Protocol and Ports** dialog, use the default **TCP**.</span></span> <span data-ttu-id="bbc6d-110">Установите переключатель **Определенные локальные порты**, а затем введите номер порта экземпляра ядра СУБД (**1433** для экземпляра по умолчанию или номер для частного порта, указанный при настройке конечной точки).</span><span class="sxs-lookup"><span data-stu-id="bbc6d-110">In the **Specific local ports** box, then type the port number of the instance of the Database Engine (**1433** for the default instance or your choice for the private port in the endpoint step).</span></span>
   
    ![TCP-порт 1433](./media/virtual-machines-sql-server-connection-steps/14Port-1433.png)
6. <span data-ttu-id="bbc6d-112">Нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-112">Click **Next**.</span></span>
7. <span data-ttu-id="bbc6d-113">В диалоговом окне **Действие** выберите **Разрешить подключение** и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-113">In the **Action** dialog box, select **Allow the connection**, and then click **Next**.</span></span>
   
    <span data-ttu-id="bbc6d-114">**Примечание по безопасности.** Выбрав вариант **Разрешить безопасное подключение**, можно обеспечить дополнительную защиту.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-114">**Security Note:** Selecting **Allow the connection if it is secure** can provide additional security.</span></span> <span data-ttu-id="bbc6d-115">Выберите этот вариант, если требуется настроить дополнительные параметры безопасности в вашей среде.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-115">Select this option if you want to configure additional security options in your environment.</span></span>
   
    ![Разрешить подключения](./media/virtual-machines-sql-server-connection-steps/15Allow-Connection.png)
8. <span data-ttu-id="bbc6d-117">В диалоговом окне **Профиль** выберите **Открытый**, **Частный** и **Доменный**.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-117">In the **Profile** dialog box, select **Public**, **Private**, and **Domain**.</span></span> <span data-ttu-id="bbc6d-118">Нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-118">Then click **Next**.</span></span>
   
    <span data-ttu-id="bbc6d-119">**Примечание по безопасности.** Выбрав вариант **Открытый**, вы получите доступ через Интернет.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-119">**Security Note:**  Selecting **Public** allows access over the internet.</span></span> <span data-ttu-id="bbc6d-120">Во всех возможных случаях выбирайте более строгий профиль.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-120">Whenever possible, select a more restrictive profile.</span></span>
   
    ![Открытый профиль](./media/virtual-machines-sql-server-connection-steps/16Public-Private-Domain-Profile.png)
9. <span data-ttu-id="bbc6d-122">В диалоговом окне **Имя** введите имя и описание правила и нажмите кнопку **Готово**.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-122">In the **Name** dialog box, type a name and description for this rule, and then click **Finish**.</span></span>
   
    ![Имя правила](./media/virtual-machines-sql-server-connection-steps/17Rule-Name.png)

<span data-ttu-id="bbc6d-124">При необходимости откройте дополнительные порты для других компонентов.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-124">Open additional ports for other components as needed.</span></span> <span data-ttu-id="bbc6d-125">Дополнительные сведения содержатся в разделе [Настройка брандмауэра Windows для разрешения доступа к SQL Server](http://msdn.microsoft.com/library/cc646023.aspx).</span><span class="sxs-lookup"><span data-stu-id="bbc6d-125">For more information, see [Configuring the Windows Firewall to Allow SQL Server Access](http://msdn.microsoft.com/library/cc646023.aspx).</span></span>

### <a name="configure-sql-server-to-listen-on-the-tcp-protocol"></a><span data-ttu-id="bbc6d-126">Настройка SQL Server для прослушивания через протокол TCP</span><span class="sxs-lookup"><span data-stu-id="bbc6d-126">Configure SQL Server to listen on the TCP protocol</span></span>

[!INCLUDE [Enable TCP](virtual-machines-sql-server-connection-tcp-protocol.md)]

### <a name="configure-sql-server-for-mixed-mode-authentication"></a><span data-ttu-id="bbc6d-127">Настройка SQL Server на проверку подлинности в смешанном режиме</span><span class="sxs-lookup"><span data-stu-id="bbc6d-127">Configure SQL Server for mixed mode authentication</span></span>
<span data-ttu-id="bbc6d-128">Компонент SQL Server Database Engine не может использовать проверку подлинности Windows без среды домена.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-128">The SQL Server Database Engine cannot use Windows Authentication without domain environment.</span></span> <span data-ttu-id="bbc6d-129">Чтобы подключиться к компоненту Database Engine с другого компьютера, необходимо настроить для SQL Server смешанный режим проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-129">To connect to the Database Engine from another computer, configure SQL Server for mixed mode authentication.</span></span> <span data-ttu-id="bbc6d-130">Смешанный режим позволяет выполнять проверку подлинности SQL Server и проверку подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-130">Mixed mode authentication allows both SQL Server Authentication and Windows Authentication.</span></span>

> [!NOTE]
> <span data-ttu-id="bbc6d-131">Настройка аутентификации в смешанном режиме может быть необязательна, если вы настроили виртуальную сеть Azure с помощью настроенной доменной среды.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-131">Configuring mixed mode authentication might not be necessary if you have configured an Azure Virtual Network with a configured domain environment.</span></span>
> 
> 

1. <span data-ttu-id="bbc6d-132">При установленном подключении к виртуальной машине на начальной странице введите **SQL Server Management Studio** и щелкните выбранный значок.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-132">While connected to the virtual machine, on the Start page, type **SQL Server Management Studio** and click the selected icon.</span></span>
   
    <span data-ttu-id="bbc6d-133">При первом открытии Management Studio необходимо создать среду пользователей Management Studio.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-133">The first time you open Management Studio it must create the users Management Studio environment.</span></span> <span data-ttu-id="bbc6d-134">Это может занять несколько минут.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-134">This may take a few moments.</span></span>
2. <span data-ttu-id="bbc6d-135">Management Studio отображает диалоговое окно **Подключение к серверу** .</span><span class="sxs-lookup"><span data-stu-id="bbc6d-135">Management Studio presents the **Connect to Server** dialog box.</span></span> <span data-ttu-id="bbc6d-136">В поле **Имя сервера** введите имя виртуальной машины для подключения к ядру СУБД с помощью обозревателя объектов (вместо имени виртуальной машины можно также использовать **(local)**, а вместо **имени сервера** — одну точку).</span><span class="sxs-lookup"><span data-stu-id="bbc6d-136">In the **Server name** box, type the name of the virtual machine to connect to the Database Engine  with the Object Explorer (Instead of the virtual machine name you can also use **(local)** or a single period as the **Server name**).</span></span> <span data-ttu-id="bbc6d-137">Выберите **Проверка подлинности Windows** и укажите ***имя_вашей_ВМ*\имя_локального_администратора** в поле **Имя пользователя**.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-137">Select **Windows Authentication**, and leave ***your_VM_name*\your_local_administrator** in the **User name** box.</span></span> <span data-ttu-id="bbc6d-138">Щелкните **Подключить**.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-138">Click **Connect**.</span></span>
   
    ![Подключение к серверу](./media/virtual-machines-sql-server-connection-steps/19Connect-to-Server.png)
3. <span data-ttu-id="bbc6d-140">В обозревателе объектов SQL Server Management Studio щелкните правой кнопкой мыши имя экземпляра SQL Server (имя виртуальной машины) и нажмите **Свойства**.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-140">In SQL Server Management Studio Object Explorer, right-click the name of the instance of SQL Server (the virtual machine name), and then click **Properties**.</span></span>
   
    ![Свойства сервера](./media/virtual-machines-sql-server-connection-steps/20Server-Properties.png)
4. <span data-ttu-id="bbc6d-142">На странице **Безопасность** в разделе **Проверка подлинности сервера** выберите **Проверка подлинности SQL Server и Windows** и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-142">On the **Security** page, under **Server authentication**, select **SQL Server and Windows Authentication mode**, and then click **OK**.</span></span>
   
    ![Выберите режим проверки подлинности](./media/virtual-machines-sql-server-connection-steps/21Mixed-Mode.png)
5. <span data-ttu-id="bbc6d-144">В диалоговом окне SQL Server Management Studio щелкните **ОК** для подтверждения необходимости перезапуска SQL Server.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-144">In the SQL Server Management Studio dialog box, click **OK** to acknowledge the requirement to restart SQL Server.</span></span>
6. <span data-ttu-id="bbc6d-145">В обозревателе объектов щелкните сервер правой кнопкой мыши и выберите **Перезагрузить**.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-145">In Object Explorer, right-click your server, and then click **Restart**.</span></span> <span data-ttu-id="bbc6d-146">(Если выполняется агент SQL Server, его также нужно перезапустить).</span><span class="sxs-lookup"><span data-stu-id="bbc6d-146">(If SQL Server Agent is running, it must also be restarted.)</span></span>
   
    ![Перезагрузить](./media/virtual-machines-sql-server-connection-steps/22Restart2.png)
7. <span data-ttu-id="bbc6d-148">В диалоговом окне SQL Server Management Studio щелкните **Да** для подтверждения перезапуска SQL Server.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-148">In the SQL Server Management Studio dialog box, click **Yes** to agree that you want to restart SQL Server.</span></span>

### <a name="create-sql-server-authentication-logins"></a><span data-ttu-id="bbc6d-149">Создание учетных записей проверки подлинности SQL Server</span><span class="sxs-lookup"><span data-stu-id="bbc6d-149">Create SQL Server authentication logins</span></span>
<span data-ttu-id="bbc6d-150">Чтобы подключиться к компоненту Database Engine с другого компьютера, необходимо создать как минимум одну учетную запись проверки подлинности SQL Server.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-150">To connect to the Database Engine from another computer, you must create at least one SQL Server authentication login.</span></span>

1. <span data-ttu-id="bbc6d-151">В обозревателе объектов SQL Server Management Studio разверните папку экземпляра сервера, на котором требуется создать новую учетную запись.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-151">In SQL Server Management Studio Object Explorer, expand the folder of the server instance in which you want to create the new login.</span></span>
2. <span data-ttu-id="bbc6d-152">Щелкните правой кнопкой мыши папку **Безопасность**, выберите **Создать** и **Имя входа...**.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-152">Right-click the **Security** folder, point to **New**, and select **Login...**.</span></span>
   
    ![Новая учетная запись](./media/virtual-machines-sql-server-connection-steps/23New-Login.png)
3. <span data-ttu-id="bbc6d-154">В диалоговом окне **Создание имени входа** на странице **Общие** введите имя нового пользователя в поле **Имя входа**.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-154">In the **Login - New** dialog box, on the **General** page, enter the name of the new user in the **Login name** box.</span></span>
4. <span data-ttu-id="bbc6d-155">Выберите **Проверка подлинности SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-155">Select **SQL Server authentication**.</span></span>
5. <span data-ttu-id="bbc6d-156">В поле **Пароль** введите пароль для нового пользователя.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-156">In the **Password** box, enter a password for the new user.</span></span> <span data-ttu-id="bbc6d-157">В поле **Подтвердите пароль** введите пароль еще раз.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-157">Enter that password again into the **Confirm Password** box.</span></span>
6. <span data-ttu-id="bbc6d-158">Выберите необходимые параметры принудительного применения паролей (**Требовать использование политики паролей**, **Задать срок окончания действия пароля** и **Пользователь должен сменить пароль при следующем входе**).</span><span class="sxs-lookup"><span data-stu-id="bbc6d-158">Select the password enforcement options required (**Enforce password policy**, **Enforce password expiration**, and **User must change password at next login**).</span></span> <span data-ttu-id="bbc6d-159">Если вы сами используете это имя пользователя, то запрашивать смену пароля при следующем входе не нужно.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-159">If you are using this login for yourself, you do not need to require a password change at the next login.</span></span>
7. <span data-ttu-id="bbc6d-160">В списке **База данных по умолчанию** выберите базу данных по умолчанию для учетной записи.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-160">From the **Default database** list, select a default database for the login.</span></span> <span data-ttu-id="bbc6d-161">**Основная** .</span><span class="sxs-lookup"><span data-stu-id="bbc6d-161">**master** is the default for this option.</span></span> <span data-ttu-id="bbc6d-162">Если пользовательская база данных еще не создана, оставьте значение **Основная**.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-162">If you have not yet created a user database, leave this set to **master**.</span></span>
   
    ![Свойства учетной записи](./media/virtual-machines-sql-server-connection-steps/24Test-Login.png)
8. <span data-ttu-id="bbc6d-164">При первом создании учетной записи может потребоваться ее назначение в качестве администратора SQL Server.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-164">If this is the first login you are creating, you may want to designate this login as a SQL Server administrator.</span></span> <span data-ttu-id="bbc6d-165">В таком случае на странице **Роли сервера** выберите **sysadmin**.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-165">If so, on the **Server Roles** page, check **sysadmin**.</span></span>
   
   > [!NOTE]
   > <span data-ttu-id="bbc6d-166">Участники фиксированной серверной роли sysadmin получают все права для управления ядром СУБД.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-166">Members of the sysadmin fixed server role have complete control of the Database Engine.</span></span> <span data-ttu-id="bbc6d-167">Количество представителей этой роли нужно ограничить.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-167">You should carefully restrict membership in this role.</span></span>
   > 
   > 
   
   ![sysadmin](./media/virtual-machines-sql-server-connection-steps/25sysadmin.png)
9. <span data-ttu-id="bbc6d-169">Нажмите кнопку ОК.</span><span class="sxs-lookup"><span data-stu-id="bbc6d-169">Click OK.</span></span>

<span data-ttu-id="bbc6d-170">Более подробные сведения об учетных записях SQL Server см. в статье [Создание имени входа](http://msdn.microsoft.com/library/aa337562.aspx).</span><span class="sxs-lookup"><span data-stu-id="bbc6d-170">For more information about SQL Server logins, see [Create a Login](http://msdn.microsoft.com/library/aa337562.aspx).</span></span>

