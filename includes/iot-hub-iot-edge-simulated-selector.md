> [!div class="op_single_selector"]
> * [<span data-ttu-id="387a2-101">Linux</span><span class="sxs-lookup"><span data-stu-id="387a2-101">Linux</span></span>](../articles/iot-hub/iot-hub-linux-iot-edge-simulated-device.md)
> * [<span data-ttu-id="387a2-102">Windows</span><span class="sxs-lookup"><span data-stu-id="387a2-102">Windows</span></span>](../articles/iot-hub/iot-hub-windows-iot-edge-simulated-device.md)

<span data-ttu-id="387a2-103">В данном пошаговом руководстве для hello [имитации устройства облака отправить образец] показано, как toouse [Azure IoT Edge] [ lnk-sdk] tooIoT toosend устройства в облако телеметрии концентратора из смоделированной устройства.</span><span class="sxs-lookup"><span data-stu-id="387a2-103">This walkthrough of hello [Simulated Device Cloud Upload sample] shows you how toouse [Azure IoT Edge][lnk-sdk] toosend device-to-cloud telemetry tooIoT Hub from simulated devices.</span></span>

<span data-ttu-id="387a2-104">В этом руководстве рассматриваются следующие темы.</span><span class="sxs-lookup"><span data-stu-id="387a2-104">This walkthrough covers:</span></span>

* <span data-ttu-id="387a2-105">**Архитектура**: сведения об hello [имитации устройства облака отправить образец].</span><span class="sxs-lookup"><span data-stu-id="387a2-105">**Architecture**: architectural information about hello [Simulated Device Cloud Upload sample].</span></span>
* <span data-ttu-id="387a2-106">**Построение и запуск**: пример hello выполнения и toobuild необходимые шаги hello.</span><span class="sxs-lookup"><span data-stu-id="387a2-106">**Build and run**: hello steps required toobuild and run hello sample.</span></span>

## <a name="architecture"></a><span data-ttu-id="387a2-107">Архитектура</span><span class="sxs-lookup"><span data-stu-id="387a2-107">Architecture</span></span>

<span data-ttu-id="387a2-108">Hello [имитации устройства облака отправить образец] показано, как шлюз, который отправляет данные телеметрии из toocreate имитируемые центра IoT tooan устройств.</span><span class="sxs-lookup"><span data-stu-id="387a2-108">hello [Simulated Device Cloud Upload sample] shows how toocreate a gateway that sends telemetry from simulated devices tooan IoT hub.</span></span> <span data-ttu-id="387a2-109">Устройство не может быть tooconnect может напрямую tooIoT концентратора поскольку hello устройства:</span><span class="sxs-lookup"><span data-stu-id="387a2-109">A device may not be able tooconnect directly tooIoT Hub because hello device:</span></span>

* <span data-ttu-id="387a2-110">не использует протокол связи, поддерживаемый Центром Интернета вещей;</span><span class="sxs-lookup"><span data-stu-id="387a2-110">Does not use a communications protocol understood by IoT Hub.</span></span>
* <span data-ttu-id="387a2-111">Не является достаточно широкими tooremember tooit идентификаторов назначен hello в IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="387a2-111">Is not smart enough tooremember hello identity assigned tooit by IoT Hub.</span></span>

<span data-ttu-id="387a2-112">IoT шлюз позволяет решить эти проблемы в hello следующих способов:</span><span class="sxs-lookup"><span data-stu-id="387a2-112">An IoT Edge gateway can solve these problems in hello following ways:</span></span>

* <span data-ttu-id="387a2-113">шлюз Hello понимает hello протокол, используемый устройством hello, получает телеметрии устройства в облако с устройства hello и передает эти сообщения tooIoT протоколу воспринимает hello центра IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="387a2-113">hello gateway understands hello protocol used by hello device, receives device-to-cloud telemetry from hello device, and forwards those messages tooIoT Hub using a protocol understood by hello IoT hub.</span></span>

* <span data-ttu-id="387a2-114">шлюз Hello сопоставляет идентификаторы toodevices центр IoT и действует как прокси-сервер, когда устройство отправляет сообщения tooIoT концентратора.</span><span class="sxs-lookup"><span data-stu-id="387a2-114">hello gateway maps IoT Hub identities toodevices and acts as a proxy when a device sends messages tooIoT Hub.</span></span>

<span data-ttu-id="387a2-115">Hello, следующая схема показывает Здравствуйте основные компоненты образца hello, включая hello IoT Edge модули:</span><span class="sxs-lookup"><span data-stu-id="387a2-115">hello following diagram shows hello main components of hello sample, including hello IoT Edge modules:</span></span>

![][1]

<span data-ttu-id="387a2-116">модули Hello не следует передавать сообщения непосредственно tooeach других.</span><span class="sxs-lookup"><span data-stu-id="387a2-116">hello modules do not pass messages directly tooeach other.</span></span> <span data-ttu-id="387a2-117">модули Hello публикации сообщений tooan внутреннего компонента broker, обеспечивающая toohello сообщений hello другие модули, используя механизм подписки.</span><span class="sxs-lookup"><span data-stu-id="387a2-117">hello modules publish messages tooan internal broker that delivers hello messages toohello other modules using a subscription mechanism.</span></span> <span data-ttu-id="387a2-118">Дополнительные сведения см. в статье [Explore Azure IoT Edge architecture on Linux][lnk-gw-getstarted] (Обзор архитектуры Edge Интернета вещей в Linux).</span><span class="sxs-lookup"><span data-stu-id="387a2-118">For more information, see [Get started with Azure IoT Edge][lnk-gw-getstarted].</span></span>

### <a name="protocol-ingestion-module"></a><span data-ttu-id="387a2-119">Модуль получения протокола</span><span class="sxs-lookup"><span data-stu-id="387a2-119">Protocol ingestion module</span></span>

<span data-ttu-id="387a2-120">Этот модуль является начальной точкой для получения данных с устройств, через шлюз hello и в облаке hello hello.</span><span class="sxs-lookup"><span data-stu-id="387a2-120">This module is hello starting point for receiving data from devices, through hello gateway, and into hello cloud.</span></span> <span data-ttu-id="387a2-121">В образце hello hello модуля:</span><span class="sxs-lookup"><span data-stu-id="387a2-121">In hello sample, hello module:</span></span>

1. <span data-ttu-id="387a2-122">моделирует данные температуры</span><span class="sxs-lookup"><span data-stu-id="387a2-122">Creates simulated temperature data.</span></span> <span data-ttu-id="387a2-123">При использовании физических устройств hello модуль считывает данные из этих физических устройств.</span><span class="sxs-lookup"><span data-stu-id="387a2-123">If you use physical devices, hello module reads data from those physical devices.</span></span>
1. <span data-ttu-id="387a2-124">создает сообщение;</span><span class="sxs-lookup"><span data-stu-id="387a2-124">Creates a message.</span></span>
1. <span data-ttu-id="387a2-125">В содержимое сообщения hello помещает hello имитируемые температур.</span><span class="sxs-lookup"><span data-stu-id="387a2-125">Places hello simulated temperature data into hello message content.</span></span>
1. <span data-ttu-id="387a2-126">Добавляет свойство с поддельное toohello сообщение MAC-адрес.</span><span class="sxs-lookup"><span data-stu-id="387a2-126">Adds a property with a fake MAC address toohello message.</span></span>
1. <span data-ttu-id="387a2-127">Делает hello сообщения доступны toohello следующий модуль в цепочке hello.</span><span class="sxs-lookup"><span data-stu-id="387a2-127">Makes hello message available toohello next module in hello chain.</span></span>

<span data-ttu-id="387a2-128">Hello модуль с именем **X протокол приема** в hello называется предыдущей диаграмме **Имитированное устройство** в исходном коде hello.</span><span class="sxs-lookup"><span data-stu-id="387a2-128">hello module called **Protocol X ingestion** in hello previous diagram is called **Simulated device** in hello source code.</span></span>

### <a name="mac-lt-gt-iot-hub-id-module"></a><span data-ttu-id="387a2-129">MAC &lt;-&gt; Модуль идентификатора центра Интернета вещей</span><span class="sxs-lookup"><span data-stu-id="387a2-129">MAC &lt;-&gt; IoT Hub ID module</span></span>

<span data-ttu-id="387a2-130">Этот модуль проверяет сообщения, которые содержат свойства MAC-адреса.</span><span class="sxs-lookup"><span data-stu-id="387a2-130">This module scans for messages that have a Mac address property.</span></span> <span data-ttu-id="387a2-131">В образце hello hello протокол приема модуль добавляет свойство адрес MAC hello.</span><span class="sxs-lookup"><span data-stu-id="387a2-131">In hello sample, hello protocol ingestion module adds hello MAC address property.</span></span> <span data-ttu-id="387a2-132">Обнаружив такое свойство hello модуля он добавляет другое свойство с сообщением ключа toohello устройства центра IoT.</span><span class="sxs-lookup"><span data-stu-id="387a2-132">If hello module finds such a property, it adds another property with an IoT Hub device key toohello message.</span></span> <span data-ttu-id="387a2-133">модуль Hello делает hello сообщения доступны toohello следующий модуль в цепочке hello.</span><span class="sxs-lookup"><span data-stu-id="387a2-133">hello module then makes hello message available toohello next module in hello chain.</span></span>

<span data-ttu-id="387a2-134">developer Привет устанавливает соответствие между MAC-адреса и центр IoT удостоверения tooassociate hello имитируемые устройства с удостоверениями устройства центра IoT.</span><span class="sxs-lookup"><span data-stu-id="387a2-134">hello developer sets up a mapping between MAC addresses and IoT Hub identities tooassociate hello simulated devices with IoT Hub device identities.</span></span> <span data-ttu-id="387a2-135">Hello разработчик добавляет сопоставление hello вручную как часть конфигурации модуля hello.</span><span class="sxs-lookup"><span data-stu-id="387a2-135">hello developer adds hello mapping manually as part of hello module configuration.</span></span>

> [!NOTE]
> <span data-ttu-id="387a2-136">В этом примере MAC-адрес используется как уникальный идентификатор устройства и сопоставляет его с удостоверением устройства в центре IoT.</span><span class="sxs-lookup"><span data-stu-id="387a2-136">This sample uses a MAC address as a unique device identifier and correlates it with an IoT Hub device identity.</span></span> <span data-ttu-id="387a2-137">В то же время вы можете написать собственный модуль, где будет использоваться другой уникальный идентификатор.</span><span class="sxs-lookup"><span data-stu-id="387a2-137">However, you can write your own module that uses a different unique identifier.</span></span> <span data-ttu-id="387a2-138">Например устройства могут иметь уникальные серийные номера или данные телеметрии hello могут включать имя уникальным встроенное устройство.</span><span class="sxs-lookup"><span data-stu-id="387a2-138">For example, your devices may have unique serial numbers or hello telemetry data may include a unique embedded device name.</span></span>

### <a name="iot-hub-communication-module"></a><span data-ttu-id="387a2-139">Модуль связи центра IoT</span><span class="sxs-lookup"><span data-stu-id="387a2-139">IoT Hub communication module</span></span>

<span data-ttu-id="387a2-140">Этот модуль принимает сообщения с центра IoT ключевого свойства устройства от предыдущего модуля hello.</span><span class="sxs-lookup"><span data-stu-id="387a2-140">This module takes messages with an IoT Hub device key property that was assigned by hello previous module.</span></span> <span data-ttu-id="387a2-141">модуль Hello отправляет сообщение hello содержимого tooIoT концентратора с помощью протокола HTTP "hello".</span><span class="sxs-lookup"><span data-stu-id="387a2-141">hello module sends hello message content tooIoT Hub using hello HTTP protocol.</span></span> <span data-ttu-id="387a2-142">HTTP является одним из hello понятны трех протоколов в IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="387a2-142">HTTP is one of hello three protocols understood by IoT Hub.</span></span>

<span data-ttu-id="387a2-143">Вместо открытия соединения для каждого устройства имитации, этот модуль открывает одиночное соединение HTTP из центра IoT toohello hello шлюза.</span><span class="sxs-lookup"><span data-stu-id="387a2-143">Instead of opening a connection for each simulated device, this module opens a single HTTP connection from hello gateway toohello IoT hub.</span></span> <span data-ttu-id="387a2-144">Затем модуль Hello multiplexes подключения от всех устройств hello имитировать через это подключение.</span><span class="sxs-lookup"><span data-stu-id="387a2-144">hello module then multiplexes connections from all hello simulated devices over that connection.</span></span> <span data-ttu-id="387a2-145">Такой подход позволяет tooconnect один шлюз другие устройства.</span><span class="sxs-lookup"><span data-stu-id="387a2-145">This approach enables a single gateway tooconnect many more devices.</span></span>

## <a name="before-you-get-started"></a><span data-ttu-id="387a2-146">Необходимые условия</span><span class="sxs-lookup"><span data-stu-id="387a2-146">Before you get started</span></span>

<span data-ttu-id="387a2-147">Перед началом работы необходимо выполнить следующие действия:</span><span class="sxs-lookup"><span data-stu-id="387a2-147">Before you get started, you must:</span></span>

* <span data-ttu-id="387a2-148">[Создать центр IoT] [ lnk-create-hub] в вашей подписке Azure необходимо имя вашей toocomplete концентратора hello в данном пошаговом руководстве.</span><span class="sxs-lookup"><span data-stu-id="387a2-148">[Create an IoT hub][lnk-create-hub] in your Azure subscription, you need hello name of your hub toocomplete this walkthrough.</span></span> <span data-ttu-id="387a2-149">Если у вас нет учетной записи, можно создать [бесплатную учетную запись][lnk-free-trial] всего за несколько минут.</span><span class="sxs-lookup"><span data-stu-id="387a2-149">If you don't have an account, you can create a [free account][lnk-free-trial] in just a couple of minutes.</span></span>
* <span data-ttu-id="387a2-150">Добавьте два центра IoT tooyour устройств и запомните или запишите их идентификаторы и ключи устройства.</span><span class="sxs-lookup"><span data-stu-id="387a2-150">Add two devices tooyour IoT hub and make a note of their ids and device keys.</span></span> <span data-ttu-id="387a2-151">Можно использовать hello [обозреватель устройств] [ lnk-device-explorer] или [explorer центром IOT] [ lnk-iothub-explorer] средства tooadd центр IoT toohello вашего устройства, вы создали в hello предыдущего шага и извлекать их ключей.</span><span class="sxs-lookup"><span data-stu-id="387a2-151">You can use hello [device explorer][lnk-device-explorer] or [iothub-explorer][lnk-iothub-explorer] tool tooadd your devices toohello IoT hub you created in hello previous step and retrieve their keys.</span></span>

![][2]

<!-- Images -->
[1]: media/iot-hub-iot-edge-simulated-selector/image1.png
[2]: media/iot-hub-iot-edge-simulated-selector/image2.png

<!-- Links -->
[имитации устройства облака отправить образец]: https://github.com/Azure/iot-edge/blob/master/samples/simulated_device_cloud_upload/README.md
[lnk-sdk]: https://github.com/Azure/iot-edge
[lnk-gw-getstarted]: ../articles/iot-hub/iot-hub-linux-iot-edge-get-started.md
[lnk-free-trial]: https://azure.microsoft.com/pricing/free-trial/
[lnk-device-explorer]: https://github.com/Azure/azure-iot-sdk-csharp/tree/master/tools/DeviceExplorer
[lnk-iothub-explorer]: https://github.com/Azure/iothub-explorer/blob/master/readme.md
[lnk-create-hub]: ../articles/iot-hub/iot-hub-create-through-portal.md