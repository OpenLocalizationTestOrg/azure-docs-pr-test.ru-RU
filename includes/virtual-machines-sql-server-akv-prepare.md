## <a name="prepare-for-akv-integration"></a><span data-ttu-id="03ef2-101">Подготовка к интеграции AKV</span><span class="sxs-lookup"><span data-stu-id="03ef2-101">Prepare for AKV Integration</span></span>
<span data-ttu-id="03ef2-102">Интеграция хранилища ключей Azure tooconfigure toouse ВМ SQL Server существует несколько предварительных требований:</span><span class="sxs-lookup"><span data-stu-id="03ef2-102">toouse Azure Key Vault Integration tooconfigure your SQL Server VM, there are several prerequisites:</span></span> 

1. [<span data-ttu-id="03ef2-103">Установите Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="03ef2-103">Install Azure Powershell</span></span>](#install-azure-powershell)
2. [<span data-ttu-id="03ef2-104">Создайте Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="03ef2-104">Create an Azure Active Directory</span></span>](#create-an-azure-active-directory)
3. [<span data-ttu-id="03ef2-105">Создайте хранилище ключей.</span><span class="sxs-lookup"><span data-stu-id="03ef2-105">Create a key vault</span></span>](#create-a-key-vault)

<span data-ttu-id="03ef2-106">Hello следующих разделах описаны эти необходимые условия и hello сведения, которые требуются командлеты PowerShell hello toocollect toolater запуска.</span><span class="sxs-lookup"><span data-stu-id="03ef2-106">hello following sections describe these prerequisites and hello information you need toocollect toolater run hello PowerShell cmdlets.</span></span>

### <a name="install-azure-powershell"></a><span data-ttu-id="03ef2-107">Установка Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="03ef2-107">Install Azure PowerShell</span></span>
<span data-ttu-id="03ef2-108">Убедитесь, что вы установили hello последнего выпуска пакета SDK Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="03ef2-108">Make sure you have installed hello latest Azure PowerShell SDK.</span></span> <span data-ttu-id="03ef2-109">Дополнительные сведения см. в разделе [как tooinstall и настройка Azure PowerShell](/powershell/azureps-cmdlets-docs).</span><span class="sxs-lookup"><span data-stu-id="03ef2-109">For more information, see [How tooinstall and configure Azure PowerShell](/powershell/azureps-cmdlets-docs).</span></span>

### <a name="create-an-azure-active-directory"></a><span data-ttu-id="03ef2-110">Создайте Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="03ef2-110">Create an Azure Active Directory</span></span>
<span data-ttu-id="03ef2-111">Во-первых, требуется toohave [Azure Active Directory](https://azure.microsoft.com/trial/get-started-active-directory/) (AAD) в вашей подписке.</span><span class="sxs-lookup"><span data-stu-id="03ef2-111">First, you need toohave an [Azure Active Directory](https://azure.microsoft.com/trial/get-started-active-directory/) (AAD) in your subscription.</span></span> <span data-ttu-id="03ef2-112">Помимо много преимуществ это позволяет toogrant разрешение tooyour хранилища ключей для определенных пользователей и приложений.</span><span class="sxs-lookup"><span data-stu-id="03ef2-112">Among many benefits, this allows you toogrant permission tooyour key vault for certain users and applications.</span></span>

<span data-ttu-id="03ef2-113">Далее необходимо зарегистрировать приложение в AAD.</span><span class="sxs-lookup"><span data-stu-id="03ef2-113">Next, register an application with AAD.</span></span> <span data-ttu-id="03ef2-114">Это позволит получить учетную запись субъекта-службы, имеющую ключа хранилища tooyour доступа, который потребуется ВМ.</span><span class="sxs-lookup"><span data-stu-id="03ef2-114">This will give you a Service Principal account that has access tooyour key vault which your VM will need.</span></span> <span data-ttu-id="03ef2-115">В статье hello хранилище ключей Azure, эти действия можно найти в hello [зарегистрировать приложение в Azure Active Directory](../articles/key-vault/key-vault-get-started.md#register) раздела, или можно в разделе hello действия с снимков экрана в hello **получение удостоверения приложения hello раздел** из [этой записи блога](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx).</span><span class="sxs-lookup"><span data-stu-id="03ef2-115">In hello Azure Key Vault article, you can find these steps in hello [Register an application with Azure Active Directory](../articles/key-vault/key-vault-get-started.md#register) section, or you can see hello steps with screen shots in hello **Get an identity for hello application section** of [this blog post](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx).</span></span> <span data-ttu-id="03ef2-116">Перед выполнением этих действий, помните, что вы должны hello toocollect следующую информацию во время этого регистрации, которая понадобится в дальнейшем при включении интеграция хранилища ключей Azure в вашей виртуальной Машине SQL.</span><span class="sxs-lookup"><span data-stu-id="03ef2-116">Before completing these steps, note that you need toocollect hello following information during this registration that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

* <span data-ttu-id="03ef2-117">После добавления приложения hello найти hello **идентификатор КЛИЕНТА** на hello **Настройка** вкладки.   ![Идентификатор клиента Azure Active Directory](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span><span class="sxs-lookup"><span data-stu-id="03ef2-117">After hello application is added, find hello **CLIENT ID**  on hello **CONFIGURE** tab.   ![Azure Active Directory Client ID](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span></span>
  
    <span data-ttu-id="03ef2-118">Идентификатор клиента Hello назначается более поздней версии toohello **$spName** параметр (имя участника-службы) в tooenable сценария PowerShell hello интеграция хранилища ключей Azure.</span><span class="sxs-lookup"><span data-stu-id="03ef2-118">hello client ID is assigned later toohello **$spName** (Service Principal name) parameter in hello PowerShell script tooenable Azure Key Vault Integration.</span></span> 
* <span data-ttu-id="03ef2-119">Кроме того при выполнении этой процедуры при создании ключа скопируйте hello секрет ключа как показано на следующий снимок экрана приветствия.</span><span class="sxs-lookup"><span data-stu-id="03ef2-119">Also, during these steps when you create your key, copy hello secret for your key as is shown in hello following screenshot.</span></span> <span data-ttu-id="03ef2-120">Этот ключ в секрете назначается более поздней версии toohello **$spSecret** (субъекта-службы секрет) параметра в скрипте PowerShell hello.</span><span class="sxs-lookup"><span data-stu-id="03ef2-120">This key secret is assigned later toohello **$spSecret** (Service Principal secret) parameter in hello PowerShell script.</span></span>  
    <span data-ttu-id="03ef2-121">![Секрет Azure Active Directory](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span><span class="sxs-lookup"><span data-stu-id="03ef2-121">![Azure Active Directory Secret](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span></span>
* <span data-ttu-id="03ef2-122">Необходимо авторизовать этот новый идентификатор toohave приветствия клиента следующие разрешения доступа: **шифрования**, **расшифровать**, **wrapKey**, **unwrapKey**, **входа**, и **проверить**.</span><span class="sxs-lookup"><span data-stu-id="03ef2-122">You must authorize this new client ID toohave hello following access permissions: **encrypt**, **decrypt**, **wrapKey**, **unwrapKey**, **sign**, and **verify**.</span></span> <span data-ttu-id="03ef2-123">Это делается с hello [Set-AzureRmKeyVaultAccessPolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) командлета.</span><span class="sxs-lookup"><span data-stu-id="03ef2-123">This is done with hello [Set-AzureRmKeyVaultAccessPolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) cmdlet.</span></span> <span data-ttu-id="03ef2-124">Дополнительные сведения см. [авторизовать hello приложения toouse hello ключа или секрета](../articles/key-vault/key-vault-get-started.md#authorize).</span><span class="sxs-lookup"><span data-stu-id="03ef2-124">For more information see [Authorize hello application toouse hello key or secret](../articles/key-vault/key-vault-get-started.md#authorize).</span></span>

### <a name="create-a-key-vault"></a><span data-ttu-id="03ef2-125">Создайте хранилище ключей.</span><span class="sxs-lookup"><span data-stu-id="03ef2-125">Create a key vault</span></span>
<span data-ttu-id="03ef2-126">В порядке toouse хранилище ключей Azure toostore hello ключи, которые будут использоваться для шифрования на виртуальной машине необходим хранилища ключей tooa доступа.</span><span class="sxs-lookup"><span data-stu-id="03ef2-126">In order toouse Azure Key Vault toostore hello keys you will use for encryption in your VM, you need access tooa key vault.</span></span> <span data-ttu-id="03ef2-127">Если вы еще не настроили копии хранилища ключей, создайте его, выполнив следующие шаги hello hello [Приступая к работе с хранилищем ключей Azure](../articles/key-vault/key-vault-get-started.md) раздела.</span><span class="sxs-lookup"><span data-stu-id="03ef2-127">If you have not already set up your key vault, create one by following hello steps in hello [Getting Started with Azure Key Vault](../articles/key-vault/key-vault-get-started.md) topic.</span></span> <span data-ttu-id="03ef2-128">Перед выполнением этих действий, обратите внимание, что есть некоторые сведения, необходимые toocollect во время этой установки, понадобится в дальнейшем при включении интеграция хранилища ключей Azure в вашей виртуальной Машине SQL.</span><span class="sxs-lookup"><span data-stu-id="03ef2-128">Before completing these steps, note that there is some information you need toocollect during this set up that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

<span data-ttu-id="03ef2-129">При получении toohello создать шаг хранилища ключей, возвращаемых hello Примечание **vaultUri** свойство, которое является URL-адрес хранилища ключей hello.</span><span class="sxs-lookup"><span data-stu-id="03ef2-129">When you get toohello Create a key vault step, note hello returned **vaultUri** property, which is hello key vault URL.</span></span> <span data-ttu-id="03ef2-130">В примере hello в этот шаг, показанный ниже имя хранилища ключей hello ContosoKeyVault, таким образом URL-адрес хранилища ключей hello будет https://contosokeyvault.vault.azure.net/.</span><span class="sxs-lookup"><span data-stu-id="03ef2-130">In hello example provided in that step, shown below, hello key vault name is ContosoKeyVault, therefore hello key vault URL would be https://contosokeyvault.vault.azure.net/.</span></span>

    New-AzureRmKeyVault -VaultName 'ContosoKeyVault' -ResourceGroupName 'ContosoResourceGroup' -Location 'East Asia'

<span data-ttu-id="03ef2-131">URL-адрес хранилища ключей Hello назначается более поздней версии toohello **$akvURL** параметр в tooenable сценария PowerShell hello интеграция хранилища ключей Azure.</span><span class="sxs-lookup"><span data-stu-id="03ef2-131">hello key vault URL is assigned later toohello **$akvURL** parameter in hello PowerShell script tooenable Azure Key Vault Integration.</span></span>

