Вы можете легко [автоматически масштабировать](../articles/monitoring-and-diagnostics/insights-autoscale-best-practices.md) свои [виртуальные машины](../articles/virtual-machines/windows/overview.md) при использовании [масштабируемых наборов виртуальных машин](../articles/virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) и [функции автоматического масштабирования Azure Monitor](../articles/monitoring-and-diagnostics/monitoring-overview-autoscale.md). Для автоматического масштабирования виртуальные машины должны входить в масштабируемый набор. Эта статья поможет вам лучше понять, как выполнять горизонтальное и вертикальное масштабирование виртуальных машин автоматически и вручную.

## <a name="horizontal-or-vertical-scaling"></a>Горизонтальное или вертикальное масштабирование

Функция автомасштабирования Azure Monitor обеспечивает только горизонтальное масштабирование, то есть увеличение или уменьшение числа виртуальных машин. Горизонтальное масштабирование больше подходит для облачной среды, так как потенциально позволяет запускать тысячи виртуальных машин для обработки нагрузки. Можно выполнять горизонтальное масштабирование, автоматически или вручную изменив емкость (либо число экземпляров) масштабируемого набора. 

При вертикальном масштабировании число виртуальных машин всегда остается неизменным, а увеличивается или уменьшается их мощность. Для оценки мощности применяются такие показатели, как память, скорость центрального процессора или место на диске. Вертикальное масштабирование зависит от доступности оборудования большого размера, что, в свою очередь, зависит от региона. К тому же, при таком масштабировании быстро достигается верхнее ограничение. Обычно при вертикальном масштабировании требуется запускать и останавливать виртуальную машину. Вертикальное масштабирование можно выполнить, задав новый размер в конфигурации виртуальных машин в масштабируемом наборе.

С помощью модулей Runbook в [службе автоматизации Azure](../articles/automation/automation-intro.md) вы можете легко [выполнять прямое или обратное масштабирование виртуальных машин в масштабируемом наборе](../articles/virtual-machine-scale-sets/virtual-machine-scale-sets-vertical-scale-reprovision.md).

## <a name="create-a-virtual-machine-scale-set"></a>создавать масштабируемый набор виртуальных машин;

Масштабируемые наборы позволяют легко развертывать идентичные виртуальные машины в виде набора и управлять ими. Вы можете создать масштабируемые наборы Linux или Windows с помощью [портала Azure](../articles/virtual-machine-scale-sets/virtual-machine-scale-sets-portal-create.md), [Azure PowerShell](../articles/virtual-machines/windows/tutorial-create-vmss.md) или [Azure CLI](../articles/virtual-machines/linux/tutorial-create-vmss.md). Кроме того, можно создавать и администрировать масштабируемые наборы с использованием пакетов SDK, таких как [Python](/develop/python) или [Node.js](/nodejs/azure), или непосредственно с использованием [REST API](/rest/api/compute/virtualmachinescalesets). Автоматическое масштабирование виртуальных машин выполняется в ходе применения метрик и правил к масштабируемому набору.

## <a name="configure-autoscale-for-a-scale-set"></a>Настройка автомасштабирования для масштабируемого набора

Автоматическое масштабирование позволяет использовать оптимальное число виртуальных машин для обработки нагрузки в приложении. Это позволяет добавлять виртуальные машины для обработки дополнительной нагрузки и удалять неиспользуемые виртуальные машины для экономии средств. Минимальное и максимальное число виртуальных машин, которые должны использоваться, указывается на основе набора правил. Если указано минимальное количество, приложение работает всегда, даже при отсутствии нагрузки. Максимальное число, в свою очередь, ограничивает общую возможную почасовую стоимость.

Вы можете включить автомасштабирование, когда создаете масштабируемый набор с помощью [Azure PowerShell](../articles/monitoring-and-diagnostics/insights-powershell-samples.md#create-and-manage-autoscale-settings) или [Azure CLI](https://docs.microsoft.com/cli/azure/monitor/autoscale-settings). Его можно включить и после создания масштабируемого набора. Вы можете создать масштабируемый набор, установить расширение и настроить автомасштабирование, воспользовавшись [шаблоном Azure Resource Manager](../articles/virtual-machine-scale-sets/virtual-machine-scale-sets-windows-autoscale.md). На портале Azure можно включить автомасштабирование в Azure Monitor или в параметрах масштабируемого набора.

![Включение автомасштабирования](./media/virtual-machines-autoscale/virtual-machines-autoscale-enable.png)
 
### <a name="metrics"></a>Метрики

Функция автоматического масштабирования Azure Monitor позволяет масштабировать определенное число работающих виртуальных машин (как увеличивать, так и уменьшать) в зависимости от [метрик](../articles/monitoring-and-diagnostics/insights-autoscale-common-metrics.md). По умолчанию виртуальные машины предоставляют базовые метрики на уровне узла для использования диска, сети и ЦП. Когда вы настраиваете сбор данных диагностики с помощью расширения, становятся доступными дополнительные счетчики производительности гостевых операционных системы для диска, ЦП и памяти.

![Критерии метрик](./media/virtual-machines-autoscale/virtual-machines-autoscale-criteria.png)

Если для приложения должно выполняться масштабирование на основе метрик, которые недоступны в узле, на виртуальных машинах в масштабируемом наборе должно быть установлено расширение диагностики для [Linux](../articles/virtual-machines/linux/diagnostic-extension.md) или [Windows](../articles/virtual-machines/windows/ps-extensions-diagnostics.md). Если вы создаете масштабируемый набор с помощью портала Azure, вам также нужно использовать Azure PowerShell или Azure CLI, чтобы установить расширение с требуемой конфигурацией диагностики.
 
### <a name="rules"></a>Правила

[Правила](../articles/monitoring-and-diagnostics/monitoring-autoscale-scale-by-custom-metric.md) объединяют метрику с действием, которое нужно выполнить. Когда условия правил выполняются, активируется одно или несколько действий автомасштабирования. Например, определяется правило, которое увеличивает число виртуальных машин на 1, если средняя загрузка ЦП превышает 85 процентов.

![Действия автомасштабирования](./media/virtual-machines-autoscale/virtual-machines-autoscale-actions.png)
 
### <a name="notifications"></a>Уведомления

Вы можете [настроить триггеры](../articles/monitoring-and-diagnostics/insights-autoscale-to-webhook-email.md) таким образом, чтобы на основе созданных вами правил автомасштабирования вызывались определенные URL-адреса в сети или отправлялись сообщения электронной почты. Объекты Webhook (веб-перехватчики) позволяют направлять уведомления об оповещениях Azure в другие системы для постобработки или отображения настраиваемых уведомлений.

## <a name="manually-scale-vms-in-a-scale-set"></a>Масштабирование виртуальных машин в масштабируемом наборе вручную

### <a name="horizontal"></a>Горизонтальное масштабирование

Можно добавлять или удалять виртуальные машины, изменяя емкость масштабируемого набора. На портале Azure можно уменьшить или увеличить число виртуальных машин (показано как **число экземпляров**) в масштабируемом наборе, передвигая ползунок в строке состояния переопределения на экране масштабирования влево или вправо.

Если вы используете Azure PowerShell, необходимо получить объект масштабируемого набора с помощью [Get AzureRmVmss](https://docs.microsoft.com/powershell/module/azurerm.compute/get-azurermvmss). Затем установите свойство **sku.capacity** для нужного числа виртуальных машин и обновите масштабируемый набор, добавив [Update-AzureRmVmss](https://docs.microsoft.com/powershell/module/azurerm.compute/update-azurermvmss). С помощью Azure CLI замените значение производительности параметром **--new-capacity** для команды [az vmss scale](https://docs.microsoft.com/cli/azure/vmss#az_vmss_scale).

### <a name="vertical"></a>Vertical

Можно вручную изменить размер виртуальных машин на портале Azure в окне размера для масштабируемого набора. Вы можете использовать Azure PowerShell с AzureRmVmss Get, задав свойство номера SKU для ссылки на образ, а затем использовав [Update-AzureRmVmss](https://docs.microsoft.com/powershell/module/azurerm.compute/update-azurermvmss) и [Update-AzureRmVmssInstance](https://docs.microsoft.com/powershell/module/azurerm.compute/update-azurermvmssinstance).

## <a name="next-steps"></a>Дальнейшие действия

- Ознакомьтесь с дополнительными сведениями о масштабируемых наборах в статье [Рекомендации по проектированию масштабируемых наборов](../articles/virtual-machine-scale-sets/virtual-machine-scale-sets-design-overview.md).

