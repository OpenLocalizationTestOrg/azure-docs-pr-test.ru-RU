Azure периодически выполняет обновления, чтобы повысить надежность, производительность и безопасность инфраструктуры узлов, в которой работают виртуальные машины. Эти обновления бывают разные: от исправлений программных компонентов в среде размещения (например, операционной системы, гипервизора и различных агентов, развернутых на узле) и обновления сетевых компонентов до вывода оборудования из эксплуатации. Большинство этих обновлений не влияют на работу размещенных виртуальных машин. Но в некоторых случаях они все же оказывают определенное воздействие:

- Если обслуживание не требует перезагрузки, Azure с помощью миграции на месте приостанавливает работу виртуальной машины во время обновления узла.

- Если для обслуживания требуется перезагрузка, вы получите уведомление во время планирования обслуживания. В таких случаях вам будет предоставлена возможность начать обслуживание самостоятельно в удобное для вас время.

На этой странице описано, как Microsoft Azure выполняет обслуживание обоих типов. Дополнительные сведения о незапланированных событиях (сбоях) см. в статьях [Управление доступностью виртуальных машин Windows в Azure] (../articles/virtual-machines/windows/manage-availability.md) и [Управление доступностью виртуальных машин Linux](../articles/virtual-machines/linux/manage-availability.md).

Приложения, работающие на виртуальной машине, могут собирать сведения о предстоящих обновлениях с помощью службы метаданных Azure для [Windows](../articles/virtual-machines/windows/instance-metadata-service.md) или [Linux] (../articles/virtual-machines/linux/instance-metadata-service.md).

## <a name="in-place-vm-migration"></a>Миграция виртуальной машины на месте

Если обновления не требуют полной перезагрузки, используется динамическая миграция на месте. Во время обновления виртуальная машина приостанавливается на 30 секунд, сохраняя память в ОЗУ, а среда размещения применяет необходимые обновления и исправления. Затем работа виртуальной машины возобновляется, а ее часы автоматически синхронизируются.

Домены обновления виртуальных машин в группах доступности обновляются поочередно. Все виртуальные машины в одном домене обновления приостанавливаются, обновляются, а затем их работа возобновляется, прежде чем плановое обслуживание переходит к следующему домену обновления.

Эти обновления могут влиять на некоторые приложения. Для приложений, которые выполняют обработку событий в режиме реального времени, перекодирование или потоковую передачу мультимедиа либо требуют высокой пропускной способности, 30-секундная пауза может быть недопустимой. <!-- sooooo, what should they do? --> 


## <a name="maintenance-requiring-a-reboot"></a>Обслуживание, требующее перезагрузки

Если виртуальные машины необходимо перезагрузить при плановом обслуживании, вы получите сообщение заранее. Плановое обслуживание выполняется в два этапа: период самообслуживания и период запланированного обслуживания.

**Период самообслуживания** позволяет вам инициировать обслуживание на виртуальных машинах. В течение этого времени вы можете отправить запрос на каждую виртуальную машину, чтобы оценить ее состояние и проверить результат последнего запроса на обслуживание.

При запуске самообслуживания виртуальная машина перемещается в узел, который уже обновлен, а затем снова включается. Так как виртуальная машина перезапускается, временный диск удаляется, а связанные с виртуальным сетевым интерфейсом динамические IP-адреса обновляются.

Если во время запуска самообслуживания происходит ошибка, операция приостанавливается, виртуальная машина не обновляется и удаляется из итерации планового обслуживания. Позднее вам сообщат о новом расписании и предложат запланировать новый период самообслуживания. 

Когда заканчивается период самообслуживания, начинается **запланированный период обслуживания**. В течение этого времени вы все еще можете запрашивать период обслуживания, но вы не сможете инициировать обслуживание самостоятельно.

## <a name="availability-considerations-during-planned-maintenance"></a>Вопросы доступности во время планового обслуживания 

Если вы решили дождаться планового периода обслуживания, чтобы обеспечивать наивысшую доступность своих виртуальных машин, нужно учесть несколько факторов. 

### <a name="paired-regions"></a>Пары регионов

Каждый регион Azure связывается с другим регионом в пределах той же географической территории, формируя пару регионов. Во время планового обслуживания Azure обновляет виртуальные машины только в одном регионе из пары. Например, при обновлении виртуальных машин в северо-центральном регионе США Azure не будет одновременно обновлять виртуальные машины в юго-центральном регионе США. Однако в других регионах, например в Северной Европе, обслуживание может происходить одновременно с обслуживанием в восточной части США. Чтобы лучше распределить виртуальные машины по регионам, ознакомьтесь с принципами работы пар регионов. Дополнительные сведения см. в статье [Непрерывность бизнес-процессов и аварийное восстановление в службах BizTalk: пары регионов Azure](https://docs.microsoft.com/azure/best-practices-availability-paired-regions).

### <a name="availability-sets-and-scale-sets"></a>Группы доступности и масштабируемые наборы

При развертывании рабочей нагрузки на виртуальных машинах Azure вы можете создать виртуальные машины в группе доступности, чтобы обеспечить высокую доступность приложения. Эта конфигурация обеспечит доступность по крайней мере одной виртуальной машины во время обслуживания или при сбое.

Отдельные виртуальные машины в группе доступности могут быть распределены максимум между 20 доменами обновления. Во время планового обслуживания в конкретный момент времени всегда затрагивается только один домен обновления. Обратите внимание, что изменения в доменах обновления не всегда происходят последовательно. 

Масштабируемые наборы виртуальных машин относятся к вычислительным ресурсам Azure, которые позволяют развертывать и администрировать идентичные виртуальные машины как единый ресурс. Масштабируемый набор автоматически развертывается в доменах обновления, как и виртуальные машины в группе доступности. Как и группа доступности, масштабируемый набор одновременно развертывается только в одном домене обновления.

Дополнительные сведения о настройке виртуальных машин для обеспечения высокой доступности см. в статьях "Управление доступностью виртуальных машин Windows в Azure" (../articles/virtual-machines/windows/manage-availability.md) и [Управление доступностью виртуальных машин Linux](../articles/virtual-machines/linux/manage-availability.md).