<span data-ttu-id="e0526-101">Azure периодически выполняет обновления, чтобы повысить надежность, производительность и безопасность инфраструктуры узлов, в которой работают виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="e0526-101">Azure periodically performs updates to improve the reliability, performance, and security of the host infrastructure for virtual machines.</span></span> <span data-ttu-id="e0526-102">Эти обновления бывают разные: от исправлений программных компонентов в среде размещения (например, операционной системы, гипервизора и различных агентов, развернутых на узле) и обновления сетевых компонентов до вывода оборудования из эксплуатации.</span><span class="sxs-lookup"><span data-stu-id="e0526-102">These updates range from patching software components in the hosting environment (like operating system, hypervisor, and various agents deployed on the host), upgrading networking components, to hardware decommissioning.</span></span> <span data-ttu-id="e0526-103">Большинство этих обновлений не влияют на работу размещенных виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="e0526-103">The majority of these updates are performed without any impact to the hosted virtual machines.</span></span> <span data-ttu-id="e0526-104">Но в некоторых случаях они все же оказывают определенное воздействие:</span><span class="sxs-lookup"><span data-stu-id="e0526-104">However, there are cases where updates do have an impact:</span></span>

- <span data-ttu-id="e0526-105">Если обслуживание не требует перезагрузки, Azure с помощью миграции на месте приостанавливает работу виртуальной машины во время обновления узла.</span><span class="sxs-lookup"><span data-stu-id="e0526-105">If the maintenance does not require a reboot, Azure uses in-place migration to pause the VM while the host is updated.</span></span>

- <span data-ttu-id="e0526-106">Если для обслуживания требуется перезагрузка, вы получите уведомление во время планирования обслуживания.</span><span class="sxs-lookup"><span data-stu-id="e0526-106">If maintenance requires a reboot, you get a notice of when the maintenance is planned.</span></span> <span data-ttu-id="e0526-107">В таких случаях вам будет предоставлена возможность начать обслуживание самостоятельно в удобное для вас время.</span><span class="sxs-lookup"><span data-stu-id="e0526-107">In these cases, you'll also be given a time window where you can start the maintenance yourself, at a time that works for you.</span></span>

<span data-ttu-id="e0526-108">На этой странице описано, как Microsoft Azure выполняет обслуживание обоих типов.</span><span class="sxs-lookup"><span data-stu-id="e0526-108">This page describes how Microsoft Azure performs both types of maintenance.</span></span> <span data-ttu-id="e0526-109">Дополнительные сведения о незапланированных событиях (сбоях) см. в статьях [Управление доступностью виртуальных машин Windows в Azure] (../articles/virtual-machines/windows/manage-availability.md) и [Управление доступностью виртуальных машин Linux](../articles/virtual-machines/linux/manage-availability.md).</span><span class="sxs-lookup"><span data-stu-id="e0526-109">For more information about unplanned events (outages), see Manage the availability of virtual machines for [Windows] (../articles/virtual-machines/windows/manage-availability.md) or [Linux](../articles/virtual-machines/linux/manage-availability.md).</span></span>

<span data-ttu-id="e0526-110">Приложения, работающие на виртуальной машине, могут собирать сведения о предстоящих обновлениях с помощью службы метаданных Azure для [Windows](../articles/virtual-machines/windows/instance-metadata-service.md) или [Linux] (../articles/virtual-machines/linux/instance-metadata-service.md).</span><span class="sxs-lookup"><span data-stu-id="e0526-110">Applications running in a virtual machine can gather information about upcoming updates by using the Azure Metadata Service for [Windows](../articles/virtual-machines/windows/instance-metadata-service.md) or [Linux] (../articles/virtual-machines/linux/instance-metadata-service.md).</span></span>

## <a name="in-place-vm-migration"></a><span data-ttu-id="e0526-111">Миграция виртуальной машины на месте</span><span class="sxs-lookup"><span data-stu-id="e0526-111">In-place VM migration</span></span>

<span data-ttu-id="e0526-112">Если обновления не требуют полной перезагрузки, используется динамическая миграция на месте.</span><span class="sxs-lookup"><span data-stu-id="e0526-112">When updates don't require a full reboot, an in-place live migration is used.</span></span> <span data-ttu-id="e0526-113">Во время обновления виртуальная машина приостанавливается на 30 секунд, сохраняя память в ОЗУ, а среда размещения применяет необходимые обновления и исправления.</span><span class="sxs-lookup"><span data-stu-id="e0526-113">During the update the virtual machine is paused for about 30 seconds, preserving the memory in RAM, while the hosting environment applies the necessary updates and patches.</span></span> <span data-ttu-id="e0526-114">Затем работа виртуальной машины возобновляется, а ее часы автоматически синхронизируются.</span><span class="sxs-lookup"><span data-stu-id="e0526-114">The virtual machine is then resumed and the clock of the virtual machine is automatically synchronized.</span></span>

<span data-ttu-id="e0526-115">Домены обновления виртуальных машин в группах доступности обновляются поочередно.</span><span class="sxs-lookup"><span data-stu-id="e0526-115">For VMs in availability sets, update domains are updated one at a time.</span></span> <span data-ttu-id="e0526-116">Все виртуальные машины в одном домене обновления приостанавливаются, обновляются, а затем их работа возобновляется, прежде чем плановое обслуживание переходит к следующему домену обновления.</span><span class="sxs-lookup"><span data-stu-id="e0526-116">All VMs in one update domain (UD) are paused, updated and then resumed before planned maintenance moves on to the next UD.</span></span>

<span data-ttu-id="e0526-117">Эти обновления могут влиять на некоторые приложения.</span><span class="sxs-lookup"><span data-stu-id="e0526-117">Some applications may be impacted by these types of updates.</span></span> <span data-ttu-id="e0526-118">Для приложений, которые выполняют обработку событий в режиме реального времени, перекодирование или потоковую передачу мультимедиа либо требуют высокой пропускной способности, 30-секундная пауза может быть недопустимой.</span><span class="sxs-lookup"><span data-stu-id="e0526-118">Applications that perform real-time event processing, like media streaming or transcoding, or high throughput networking scenarios, may not be designed to tolerate a 30 second pause.</span></span> <!-- sooooo, what should they do? --> 


## <a name="maintenance-requiring-a-reboot"></a><span data-ttu-id="e0526-119">Обслуживание, требующее перезагрузки</span><span class="sxs-lookup"><span data-stu-id="e0526-119">Maintenance requiring a reboot</span></span>

<span data-ttu-id="e0526-120">Если виртуальные машины необходимо перезагрузить при плановом обслуживании, вы получите сообщение заранее.</span><span class="sxs-lookup"><span data-stu-id="e0526-120">When VMs need to be rebooted for planned maintenance, you are notified in advance.</span></span> <span data-ttu-id="e0526-121">Плановое обслуживание выполняется в два этапа: период самообслуживания и период запланированного обслуживания.</span><span class="sxs-lookup"><span data-stu-id="e0526-121">Planned maintenance has two phases: the self-service window and a scheduled maintenance window.</span></span>

<span data-ttu-id="e0526-122">**Период самообслуживания** позволяет вам инициировать обслуживание на виртуальных машинах.</span><span class="sxs-lookup"><span data-stu-id="e0526-122">The **self-service window** lets you initiate the maintenance on your VMs.</span></span> <span data-ttu-id="e0526-123">В течение этого времени вы можете отправить запрос на каждую виртуальную машину, чтобы оценить ее состояние и проверить результат последнего запроса на обслуживание.</span><span class="sxs-lookup"><span data-stu-id="e0526-123">During this time, you can query each VM to see their status and check the result of your last maintenance request.</span></span>

<span data-ttu-id="e0526-124">При запуске самообслуживания виртуальная машина перемещается в узел, который уже обновлен, а затем снова включается.</span><span class="sxs-lookup"><span data-stu-id="e0526-124">When you start self-service maintenance, your VM is moved to a node that has already been updated and then powers it back on.</span></span> <span data-ttu-id="e0526-125">Так как виртуальная машина перезапускается, временный диск удаляется, а связанные с виртуальным сетевым интерфейсом динамические IP-адреса обновляются.</span><span class="sxs-lookup"><span data-stu-id="e0526-125">Because the VM reboots, the temporary disk is lost and dynamic IP addresses associated with virtual network interface are updated.</span></span>

<span data-ttu-id="e0526-126">Если во время запуска самообслуживания происходит ошибка, операция приостанавливается, виртуальная машина не обновляется и удаляется из итерации планового обслуживания.</span><span class="sxs-lookup"><span data-stu-id="e0526-126">If you start self-service maintenance and there is an error during the process, the operation is stopped, the VM is not updated and it is also removed from the planned maintenance iteration.</span></span> <span data-ttu-id="e0526-127">Позднее вам сообщат о новом расписании и предложат запланировать новый период самообслуживания.</span><span class="sxs-lookup"><span data-stu-id="e0526-127">You will be contacted in a later time with a new schedule and offered a new opportunity to do self-service maintenance.</span></span> 

<span data-ttu-id="e0526-128">Когда заканчивается период самообслуживания, начинается **запланированный период обслуживания**.</span><span class="sxs-lookup"><span data-stu-id="e0526-128">When the self-service window has passed, the **scheduled maintenance window** begins.</span></span> <span data-ttu-id="e0526-129">В течение этого времени вы все еще можете запрашивать период обслуживания, но вы не сможете инициировать обслуживание самостоятельно.</span><span class="sxs-lookup"><span data-stu-id="e0526-129">During this time window, you can still query for the maintenance window, but no longer be able to start the maintenance yourself.</span></span>

## <a name="availability-considerations-during-planned-maintenance"></a><span data-ttu-id="e0526-130">Вопросы доступности во время планового обслуживания</span><span class="sxs-lookup"><span data-stu-id="e0526-130">Availability Considerations during Planned Maintenance</span></span> 

<span data-ttu-id="e0526-131">Если вы решили дождаться планового периода обслуживания, чтобы обеспечивать наивысшую доступность своих виртуальных машин, нужно учесть несколько факторов.</span><span class="sxs-lookup"><span data-stu-id="e0526-131">If you decide to wait until the planned maintenance window, there are a few things to consider for maintaining the highest availabilty of your VMs.</span></span> 

### <a name="paired-regions"></a><span data-ttu-id="e0526-132">Пары регионов</span><span class="sxs-lookup"><span data-stu-id="e0526-132">Paired Regions</span></span>

<span data-ttu-id="e0526-133">Каждый регион Azure связывается с другим регионом в пределах той же географической территории, формируя пару регионов.</span><span class="sxs-lookup"><span data-stu-id="e0526-133">Each Azure region is paired with another region within the same geography, together they make a regional pair.</span></span> <span data-ttu-id="e0526-134">Во время планового обслуживания Azure обновляет виртуальные машины только в одном регионе из пары.</span><span class="sxs-lookup"><span data-stu-id="e0526-134">During planned maintenance, Azure will only update the VMs in a single region of a region pair.</span></span> <span data-ttu-id="e0526-135">Например, при обновлении виртуальных машин в северо-центральном регионе США Azure не будет одновременно обновлять виртуальные машины в юго-центральном регионе США.</span><span class="sxs-lookup"><span data-stu-id="e0526-135">For example, when updating the Virtual Machines in North Central US, Azure will not update any Virtual Machines in South Central US at the same time.</span></span> <span data-ttu-id="e0526-136">Однако в других регионах, например в Северной Европе, обслуживание может происходить одновременно с обслуживанием в восточной части США.</span><span class="sxs-lookup"><span data-stu-id="e0526-136">However, other regions such as North Europe can be under maintenance at the same time as East US.</span></span> <span data-ttu-id="e0526-137">Чтобы лучше распределить виртуальные машины по регионам, ознакомьтесь с принципами работы пар регионов.</span><span class="sxs-lookup"><span data-stu-id="e0526-137">Understanding how region pairs work can help you better distribute your VMs across regions.</span></span> <span data-ttu-id="e0526-138">Дополнительные сведения см. в статье [Непрерывность бизнес-процессов и аварийное восстановление в службах BizTalk: пары регионов Azure](https://docs.microsoft.com/azure/best-practices-availability-paired-regions).</span><span class="sxs-lookup"><span data-stu-id="e0526-138">For more information, see [Azure region pairs](https://docs.microsoft.com/azure/best-practices-availability-paired-regions).</span></span>

### <a name="availability-sets-and-scale-sets"></a><span data-ttu-id="e0526-139">Группы доступности и масштабируемые наборы</span><span class="sxs-lookup"><span data-stu-id="e0526-139">Availability sets and scale sets</span></span>

<span data-ttu-id="e0526-140">При развертывании рабочей нагрузки на виртуальных машинах Azure вы можете создать виртуальные машины в группе доступности, чтобы обеспечить высокую доступность приложения.</span><span class="sxs-lookup"><span data-stu-id="e0526-140">When deploying a workload on Azure VMs, you can create the VMs within an availability set to provide high availability to your application.</span></span> <span data-ttu-id="e0526-141">Эта конфигурация обеспечит доступность по крайней мере одной виртуальной машины во время обслуживания или при сбое.</span><span class="sxs-lookup"><span data-stu-id="e0526-141">This ensures that during either an outage or maintenance events, at least one virtual machine is available.</span></span>

<span data-ttu-id="e0526-142">Отдельные виртуальные машины в группе доступности могут быть распределены максимум между 20 доменами обновления.</span><span class="sxs-lookup"><span data-stu-id="e0526-142">Within an availability set, individual VMs are spread across up to 20 update domains (UDs).</span></span> <span data-ttu-id="e0526-143">Во время планового обслуживания в конкретный момент времени всегда затрагивается только один домен обновления.</span><span class="sxs-lookup"><span data-stu-id="e0526-143">During planned maintenance, only a single update domain is impacted at any given time.</span></span> <span data-ttu-id="e0526-144">Обратите внимание, что изменения в доменах обновления не всегда происходят последовательно.</span><span class="sxs-lookup"><span data-stu-id="e0526-144">Be aware that the order of update domains being impacted does not necessarily happen sequentially.</span></span> 

<span data-ttu-id="e0526-145">Масштабируемые наборы виртуальных машин относятся к вычислительным ресурсам Azure, которые позволяют развертывать и администрировать идентичные виртуальные машины как единый ресурс.</span><span class="sxs-lookup"><span data-stu-id="e0526-145">Virtual machine scale sets are an Azure compute resource that enables you to deploy and manage a set of identical VMs as a single resource.</span></span> <span data-ttu-id="e0526-146">Масштабируемый набор автоматически развертывается в доменах обновления, как и виртуальные машины в группе доступности.</span><span class="sxs-lookup"><span data-stu-id="e0526-146">The scale set is automatically deployed across update domains, like VMs in an availability set.</span></span> <span data-ttu-id="e0526-147">Как и группа доступности, масштабируемый набор одновременно развертывается только в одном домене обновления.</span><span class="sxs-lookup"><span data-stu-id="e0526-147">Just like with availability sets, with scale sets only a single update domain is impacted at any given time.</span></span>

<span data-ttu-id="e0526-148">Дополнительные сведения о настройке виртуальных машин для обеспечения высокой доступности см. в статьях "Управление доступностью виртуальных машин Windows в Azure" (../articles/virtual-machines/windows/manage-availability.md) и [Управление доступностью виртуальных машин Linux](../articles/virtual-machines/linux/manage-availability.md).</span><span class="sxs-lookup"><span data-stu-id="e0526-148">For more information about configuring your virtual machines for high availability, see Manage the availability of your virtual machines for Windows (../articles/virtual-machines/windows/manage-availability.md) or [Linux](../articles/virtual-machines/linux/manage-availability.md).</span></span>