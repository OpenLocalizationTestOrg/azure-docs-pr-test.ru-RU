# <a name="securing-docker-containers-in-azure-container-service"></a><span data-ttu-id="5a6e4-101">Защита контейнеров Docker в службе контейнеров Azure</span><span class="sxs-lookup"><span data-stu-id="5a6e4-101">Securing Docker containers in Azure Container Service</span></span>

<span data-ttu-id="5a6e4-102">В этой статье описываются рекомендации по защите контейнеров Docker, развернутых в службе контейнеров Azure.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-102">This article introduces considerations and recommendations for securing Docker containers deployed in Azure Container Service.</span></span> <span data-ttu-id="5a6e4-103">Многие из этих соображений обычно применяются tooDocker контейнеры, развернутых в Azure или в других средах.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-103">Many of these considerations apply generally tooDocker containers deployed in Azure or other environments.</span></span> 

## <a name="image-security"></a><span data-ttu-id="5a6e4-104">Безопасность образов</span><span class="sxs-lookup"><span data-stu-id="5a6e4-104">Image security</span></span>

<span data-ttu-id="5a6e4-105">Контейнеры состоят из образов, которые хранятся в одном или нескольких репозиториях.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-105">Containers are built from images that are stored in one or more repositories.</span></span> <span data-ttu-id="5a6e4-106">Эти репозиториев могут принадлежать toopublic или закрытого контейнера реестры.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-106">These repositories can belong toopublic or private container registries.</span></span> <span data-ttu-id="5a6e4-107">Примером общего реестра является [Docker Hub](https://hub.docker.com/).</span><span class="sxs-lookup"><span data-stu-id="5a6e4-107">An example of a public registry is [Docker Hub](https://hub.docker.com/).</span></span> <span data-ttu-id="5a6e4-108">Пример частного реестра — hello [доверенный реестр Docker](https://docs.docker.com/datacenter/dtr/2.0/), который может быть установлен локально или в частном облаке виртуальных.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-108">An example of a private registry is hello [Docker Trusted Registry](https://docs.docker.com/datacenter/dtr/2.0/), which can be installed on-premises or in a virtual private cloud.</span></span> <span data-ttu-id="5a6e4-109">Существуют также частные службы реестров контейнеров на основе облака, включая [реестр контейнеров Azure](../articles/container-registry/container-registry-intro.md).</span><span class="sxs-lookup"><span data-stu-id="5a6e4-109">There are also cloud-based private container registry services including [Azure Container Registry](../articles/container-registry/container-registry-intro.md).</span></span>

### <a name="public-and-private-images"></a><span data-ttu-id="5a6e4-110">Общие и частные образы</span><span class="sxs-lookup"><span data-stu-id="5a6e4-110">Public and private images</span></span>
<span data-ttu-id="5a6e4-111">В целом, как и любой общедоступный опубликованный программный пакет, общедоступный образ контейнера не может гарантировать безопасность.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-111">In general, as with any publicly published software package, a publicly available container image does not guarantee security.</span></span> <span data-ttu-id="5a6e4-112">Образы контейнеров состоят из нескольких программных слоев, у каждого из которых могут быть свои уязвимости.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-112">Container images consist of multiple software layers, and each software layer could have vulnerabilities.</span></span> <span data-ttu-id="5a6e4-113">Это источник ключа toounderstand hello hello образ контейнера, включая владельца hello hello изображения (toodetermine, если это надежного источника или нет), hello слоев программного обеспечения, оно содержит и hello версии программного обеспечения.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-113">It is key toounderstand hello origin of hello container image, including hello owner of hello image (toodetermine if it is a reliable source or not), hello software layers it consists of, and hello software versions.</span></span> 

<span data-ttu-id="5a6e4-114">Например, при переходе официальный toohello [nginx репозитория](https://hub.docker.com/_/nginx/) в Docker Hub и перейдите toohello **теги** вкладку, появится цветной уязвимости в каждого изображения.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-114">For example, if you go toohello official [nginx repository](https://hub.docker.com/_/nginx/) in Docker Hub and navigate toohello **Tags** tab, you see color-coded vulnerabilities in each image.</span></span> <span data-ttu-id="5a6e4-115">Каждый цвет описывается уязвимость hello слоев программного обеспечения hello изображения.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-115">Each color depicts hello vulnerability of a software layer of hello image.</span></span> <span data-ttu-id="5a6e4-116">Дополнительные сведения о сканировании уязвимостей на Docker Hub см. в записи блога, посвященной [обзору официальных репозиториев на Docker Hub](https://blog.docker.com/2015/06/understanding-official-repos-docker-hub/).</span><span class="sxs-lookup"><span data-stu-id="5a6e4-116">For more about vulnerability scanning in Docker Hub, see [Understanding official repos on Docker Hub](https://blog.docker.com/2015/06/understanding-official-repos-docker-hub/).</span></span>

![Образы Nginx на Docker Hub](./media/container-service-security/docker-hub-nginx.png)

<span data-ttu-id="5a6e4-118">Предприятиям обеспечивает глубокую о безопасности и tooprotect себя от атак системы безопасности следует сохранять и извлекать образы из частного реестра, таких как Azure контейнер реестра или доверенный реестр Docker.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-118">Enterprises care deeply about security, and tooprotect themselves from security attack should store and retrieve images from a private registry, such as Azure Container Registry or Docker Trusted Registry.</span></span> <span data-ttu-id="5a6e4-119">В управляемых частного реестра tooproviding сложения, реестр контейнера Azure поддерживает [проверки подлинности на основе субъекта-службы](../articles/container-registry/container-registry-authentication.md) через Azure Active Directory для обычной проверки подлинности потоков, включая доступ на основе ролей для только для чтения, записи и разрешений владельца.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-119">In addition tooproviding a managed private registry, Azure Container Registry supports [service principal-based authentication](../articles/container-registry/container-registry-authentication.md) through Azure Active Directory for basic authentication flows, including role-based access for read-only, write, and owner permissions.</span></span>

### <a name="image-security-scanning"></a><span data-ttu-id="5a6e4-120">Сканирование безопасности образов</span><span class="sxs-lookup"><span data-stu-id="5a6e4-120">Image security scanning</span></span>

<span data-ttu-id="5a6e4-121">Даже при использовании частного реестра, это образ toouse смысл сканирование решения для обеспечения дополнительной безопасности проверки.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-121">Even when using a private registry, it is a good idea toouse image scanning solutions for additional security validation.</span></span> <span data-ttu-id="5a6e4-122">Каждый слой программного обеспечения в образ контейнера — потенциально подвержен toovulnerabilities независимо от других слоев в образе контейнера hello.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-122">Each software layer in a container image is potentially prone toovulnerabilities independent of other layers in hello container image.</span></span> <span data-ttu-id="5a6e4-123">Как все больше компаний начать развертывание своих рабочих нагрузок на основе технологий контейнера, сканирования рисунка становится важным tooensure защиты от угроз безопасности для своей организации.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-123">As increasingly companies start deploying their production workloads based on container technologies, image scanning becomes important tooensure prevention of security threats against their organizations.</span></span> 

<span data-ttu-id="5a6e4-124">Безопасность, наблюдение и проверку решения, такие как [Twistlock](https://www.twistlock.com/2016/11/07/twistlock-supports-azure-container-registry) и [безопасности голубой](http://blog.aquasec.com/image-vulnerability-scanning-in-azure-container-registry), среди прочего, можно использовать tooscan образы контейнеров в частного реестра и идентификации потенциальных уязвимостей.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-124">Security monitoring and scanning solutions such as [Twistlock](https://www.twistlock.com/2016/11/07/twistlock-supports-azure-container-registry) and [Aqua Security](http://blog.aquasec.com/image-vulnerability-scanning-in-azure-container-registry), among others, can be used tooscan container images in a private registry and identify potential vulnerabilities.</span></span> <span data-ttu-id="5a6e4-125">Важно указать глубину hello toounderstand сканирование различные решения, hello.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-125">It is important toounderstand hello depth of scanning that hello different solutions provide.</span></span> <span data-ttu-id="5a6e4-126">Например, некоторые решения могут использовать перекрестную проверку слоев образа на наличие известных уязвимостей.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-126">For example, some solutions might only cross-verify image layers against known vulnerabilities.</span></span> <span data-ttu-id="5a6e4-127">Эти решения могут быть программы может tooverify слой образа, созданные через определенное программное обеспечение диспетчера пакетов.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-127">These solutions might not be able tooverify image-layer software built through certain package manager software.</span></span> <span data-ttu-id="5a6e4-128">Для других решений предусмотрена более глубокая интеграция сканирования, и они могут обнаружить уязвимости в любом комплекте программного обеспечения.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-128">Other solutions have deeper scanning integration and can find vulnerabilities in any packaged software.</span></span>

### <a name="production-deployment-rules-and-audit"></a><span data-ttu-id="5a6e4-129">Правила развертывания в рабочей среде и аудит</span><span class="sxs-lookup"><span data-stu-id="5a6e4-129">Production deployment rules and audit</span></span>
<span data-ttu-id="5a6e4-130">После развертывания приложения в рабочей среде это основные tooset несколько tooensure правила использования образов в рабочей среде являются безопасными и содержать не уязвимости.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-130">Once an application is deployed in production, it is essential tooset a few rules tooensure that images used in production environments are secure and contain no vulnerabilities.</span></span>

* <span data-ttu-id="5a6e4-131">Как правило с уязвимостей, даже небольшие изображения должен быть запрещен toorun в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-131">As a rule, images with vulnerabilities, even minor, should not be allowed toorun in a production environment.</span></span> <span data-ttu-id="5a6e4-132">Кроме того все образы, развернутых в рабочей среде в идеале сохраняться в инструкции select доступного tooa частного реестра лишь немногие.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-132">In addition, all images deployed in production should ideally be saved in a private registry accessible tooa select few.</span></span> <span data-ttu-id="5a6e4-133">Это также важно tookeep hello количество небольших tooensure производства изображений, ими можно управлять эффективно.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-133">It is also important tookeep hello number of production images small tooensure that they can be managed effectively.</span></span>

* <span data-ttu-id="5a6e4-134">Поскольку это источник hello жестких toopinpoint программного обеспечения с образ контейнера с общедоступным, это изображений toobuild рекомендаций из базы знаний tooensure источника происхождения hello hello слоя.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-134">Since it is hard toopinpoint hello origin of software from a publicly available container image, it is a good practice toobuild images from source tooensure knowledge of hello origin of hello layer.</span></span> <span data-ttu-id="5a6e4-135">Уязвимость рабочих областей в образе самостоятельно создать контейнер, клиенты могут найти ускорить разрешение tooa пути.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-135">When a vulnerability surfaces in a self-built container image, customers can find a quicker path tooa resolution.</span></span> <span data-ttu-id="5a6e4-136">С открытого изображения, клиентам потребуется корень hello toofind toofix открытый изображения его или получить от издателя hello другой безопасный образ.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-136">With a public image, customers would need toofind hello root of a public image toofix it or obtain another secure image from hello publisher.</span></span>

* <span data-ttu-id="5a6e4-137">Тщательно отсканированные изображения, развернутых в рабочей среде не гарантируется toobe копирование toodate hello жизненного цикла приложения hello.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-137">A thoroughly scanned image deployed in production is not guaranteed toobe up toodate for hello lifetime of hello application.</span></span> <span data-ttu-id="5a6e4-138">Уязвимости системы безопасности может быть сообщено слоев hello образа, которые ранее не были известны или были введены после hello рабочего развертывания.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-138">Security vulnerabilities might be reported for layers of hello image that were not previously known or were introduced after hello production deployment.</span></span> <span data-ttu-id="5a6e4-139">Периодических аудит изображений, развернутых в рабочей среде — необходимые tooidentify образы, которые являются устаревшими или не была обновлена в некоторое время.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-139">Periodic auditing of images deployed in production is necessary tooidentify images that are out of date or have not been updated in a while.</span></span> <span data-ttu-id="5a6e4-140">Один использовать методологий развертывания сине зеленый и последовательного обновления механизмы образы контейнеров tooupdate без простоев.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-140">One might use blue-green deployment methodologies and rolling upgrade mechanisms tooupdate container images without downtime.</span></span> <span data-ttu-id="5a6e4-141">Сканирования рисунка можно сделать с средствах, описанных в предшествующих раздел hello.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-141">Image scanning can be done with tools described in hello preceding section.</span></span> 

* <span data-ttu-id="5a6e4-142">Конвейер непрерывной интеграции (CI) toobuild изображения и сканирование встроенную безопасность можно обеспечить безопасный частных реестрах с образами безопасный контейнер.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-142">A continuous integration (CI) pipeline toobuild images and integrated security scanning can help maintain secure private registries with secure container images.</span></span> <span data-ttu-id="5a6e4-143">Hello поиск уязвимостей встроены в решение непрерывной Интеграции hello гарантирует, что образы, которые прошли все тесты hello помещаются в стек toohello частного реестра из какой рабочей среды развертывания рабочих нагрузок.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-143">hello vulnerability scanning built into hello CI solution ensures that images that pass all hello tests are pushed toohello private registry from which production workloads are deployed.</span></span> <span data-ttu-id="5a6e4-144">Сбой конвейера CI гарантирует, что уязвимым изображений не включено в hello частного реестра используются для рабочих развертываний рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-144">A CI pipeline failure ensures that vulnerable images are not pushed into hello private registry used for production workload deployments.</span></span> <span data-ttu-id="5a6e4-145">В случае значительного количества образов также запускается автоматическая проверка их безопасности.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-145">It also automates image security scanning if there are a significant number of images.</span></span> <span data-ttu-id="5a6e4-146">Выполнение аудита образов вручную для обнаружения уязвимостей системы безопасности очень долгий процесс, подверженный ошибкам.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-146">Otherwise, manually auditing images for security vulnerabilities can be painstakingly lengthy and error prone.</span></span>

## <a name="host-level-container-isolation"></a><span data-ttu-id="5a6e4-147">Изоляция контейнера на уровне узла</span><span class="sxs-lookup"><span data-stu-id="5a6e4-147">Host-level container isolation</span></span>
<span data-ttu-id="5a6e4-148">Когда клиент развертывает приложения контейнера в ресурсах Azure, они развертываются в группах ресурсов на уровне подписки и не являются мультитенантными.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-148">When a customer deploys container applications on Azure resources, they are deployed at a subscription level in resource groups and are not multi-tenant.</span></span> <span data-ttu-id="5a6e4-149">Это означает, что, если клиент использует подписки с другими пользователями, нет границ, можно создать между двумя развертываниями в hello же подписки.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-149">This means that if a customer shares a subscription with others, there are no boundaries that can be built between two deployments in hello same subscription.</span></span> <span data-ttu-id="5a6e4-150">Таким образом, безопасность на уровне контейнера не гарантируется.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-150">Therefore, container-level security is not guaranteed.</span></span> 

<span data-ttu-id="5a6e4-151">Это критическое toounderstand, что контейнеры используют ядра hello и hello ресурсы узла hello (который в службе контейнера Azure ВМ Azure в кластере).</span><span class="sxs-lookup"><span data-stu-id="5a6e4-151">It is also critical toounderstand that containers share hello kernel and hello resources of hello host (which in Azure Container Service is an Azure VM in a cluster).</span></span> <span data-ttu-id="5a6e4-152">Следовательно, контейнеры, запущенные в рабочей среде, должны запускаться в непривилегированном пользовательском режиме.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-152">Therefore, containers running in production must be run in non-privileged user mode.</span></span> <span data-ttu-id="5a6e4-153">Контейнер запускается с правами корневой могут поставить под угрозу hello всей среды.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-153">Running a container with root privileges can compromise hello entire environment.</span></span> <span data-ttu-id="5a6e4-154">С доступом на корневом уровне в контейнере злоумышленник может получить доступ права полного корневой toohello на узле hello.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-154">With root-level access in a container, a hacker can gain access toohello full root privileges on hello host.</span></span> <span data-ttu-id="5a6e4-155">Кроме того это контейнеры важные toorun только для чтения файловые системы.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-155">In addition, it is important toorun containers with read-only file systems.</span></span> <span data-ttu-id="5a6e4-156">Это предотвращает тем, кто имеет доступ toohello скомпрометированы контейнера toowrite вредоносных сценариев toohello файловой системы и получения доступа tooother файлов.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-156">This prevents someone who has access toohello compromised container toowrite malicious scripts toohello file system and gain access tooother files.</span></span> <span data-ttu-id="5a6e4-157">Аналогичным образом это ресурсы hello, важные toolimit (например, память, ЦП и пропускной способности сети) выделенные tooa контейнера.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-157">Similarly, it is important toolimit hello resources (such as memory, CPU, and network bandwidth) allocated tooa container.</span></span> <span data-ttu-id="5a6e4-158">Это помогает предотвратить хакеров занимать ресурсы и проводит незаконных действий, например мошенничества с кредитными картами или bitcoin интеллектуального анализа данных, что может помешать запущена на кластере или узле hello другие контейнеры.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-158">This helps prevent hackers from hogging resources and pursuing illegal activities such as credit card fraud or bitcoin mining, which could prevent other containers from running on hello host or cluster.</span></span>

## <a name="orchestrator-considerations"></a><span data-ttu-id="5a6e4-159">Оркестратор и вопросы безопасности</span><span class="sxs-lookup"><span data-stu-id="5a6e4-159">Orchestrator considerations</span></span>

<span data-ttu-id="5a6e4-160">Для каждого оркестратора, доступного в службе контейнеров Azure, предусмотрены свои рекомендации по безопасности.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-160">Each orchestrator available in Azure Container Service has its own security considerations.</span></span> <span data-ttu-id="5a6e4-161">Например следует ограничить прямой узлов tooorchestrator доступа SSH в контейнере службы.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-161">For example, you should limit direct SSH access tooorchestrator nodes in Container Service.</span></span> <span data-ttu-id="5a6e4-162">Вместо этого следует использовать каждый orchestrator пользовательского интерфейса или средства командной строки (такие как `kubectl` для Kubernetes) toomanage hello контейнера среде без обращения к узлам hello.</span><span class="sxs-lookup"><span data-stu-id="5a6e4-162">Instead, you should use each orchestrator's UI or command-line tools (such as `kubectl` for Kubernetes) toomanage hello container environment without accessing hello hosts.</span></span> <span data-ttu-id="5a6e4-163">Дополнительные сведения см. в разделе [создания кластера, Kubernetes, DC/OS или с помощью Docker Swarm tooa удаленного подключения](../articles/container-service/kubernetes/container-service-connect.md).</span><span class="sxs-lookup"><span data-stu-id="5a6e4-163">For more information, see [Make a remote connection tooa Kubernetes, DC/OS, or Docker Swarm cluster](../articles/container-service/kubernetes/container-service-connect.md).</span></span>

<span data-ttu-id="5a6e4-164">Безопасности orchestrator Дополнительные сведения см. в разделе hello следующие ресурсы:</span><span class="sxs-lookup"><span data-stu-id="5a6e4-164">For additional orchestrator-specific security information, see hello following resources:</span></span>

* <span data-ttu-id="5a6e4-165">**Kubernetes**: [Security Best Practices for Kubernetes Deployment](http://blog.kubernetes.io/2016/08/security-best-practices-kubernetes-deployment.html) (Рекомендации по безопасности для развертывания Kubernetes)</span><span class="sxs-lookup"><span data-stu-id="5a6e4-165">**Kubernetes**: [Security Best Practices for Kubernetes Deployment](http://blog.kubernetes.io/2016/08/security-best-practices-kubernetes-deployment.html)</span></span>

* <span data-ttu-id="5a6e4-166">**DC/OS**: [Securing Your Cluster](https://dcos.io/docs/1.8/administration/securing-your-cluster/) (Защита кластера)</span><span class="sxs-lookup"><span data-stu-id="5a6e4-166">**DC/OS**: [Securing Your Cluster](https://dcos.io/docs/1.8/administration/securing-your-cluster/)</span></span>

* <span data-ttu-id="5a6e4-167">**Docker Swarm**: [Docker Security](https://www.docker.com/docker-security) (Защита Docker)</span><span class="sxs-lookup"><span data-stu-id="5a6e4-167">**Docker Swarm**: [Docker Security](https://www.docker.com/docker-security)</span></span>

## <a name="next-steps"></a><span data-ttu-id="5a6e4-168">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="5a6e4-168">Next steps</span></span>

* <span data-ttu-id="5a6e4-169">Дополнительные сведения о безопасности архитектуры и контейнер Docker см. в разделе [tooContainer введение безопасности](https://www.docker.com/sites/default/files/WP_IntrotoContainerSecurity_08.19.2016.pdf).</span><span class="sxs-lookup"><span data-stu-id="5a6e4-169">For more about Docker architecture and container security, see [Introduction tooContainer Security](https://www.docker.com/sites/default/files/WP_IntrotoContainerSecurity_08.19.2016.pdf).</span></span>

* <span data-ttu-id="5a6e4-170">Сведения о безопасности платформы Azure см. в разделе hello [центра безопасности Azure](https://www.microsoft.com/en-us/trustcenter/cloudservices/azure).</span><span class="sxs-lookup"><span data-stu-id="5a6e4-170">For information about Azure platform security, see hello [Azure Security Center](https://www.microsoft.com/en-us/trustcenter/cloudservices/azure).</span></span>
