## <a name="os-config"></a>Добавление IP-адресов в операционную систему виртуальной машины

Подключитесь к виртуальной машине, созданной с несколькими частными IP-адресами, и войдите в нее. Все частные IP-адреса (включая основные), добавленные в виртуальную машину, необходимо добавить вручную. Выполните следующие действия в соответствии с операционной системой виртуальной машины.

### <a name="windows"></a>Windows

1. В командной строке введите *ipconfig /all*.  Отображается только *первичный* частный IP-адрес (через службу DHCP).
2. Введите *ncpa.cpl* в командной строке, чтобы открыть окно **Сетевые подключения**.
3. Откройте свойства для соответствующего адаптера: **Подключение по локальной сети**.
4. Дважды щелкните "Протокол IP версии 4 (IPv4)".
5. Выберите **Использовать следующий IP-адрес** и введите следующие значения:

    * **IP-адрес**— *первичный* частный IP-адрес.
    * **Маска подсети**— в зависимости от своей подсети. Например, если подсеть — /24, то маска подсети — 255.255.255.0.
    * **Шлюз по умолчанию**— первый IP-адрес в подсети. Если подсеть — 10.0.0.0/24, то IP-адрес шлюза по умолчанию — 10.0.0.1.
    * Щелкните **Использовать следующие адреса DNS-серверов** и введите следующие значения:
        * **Предпочитаемый DNS-сервер.** Введите 168.63.129.16, если собственный DNS-сервер не используется.  В противном случае введите IP-адрес этого DNS-сервера.
    * Нажмите кнопку **Дополнительно** и добавьте дополнительные IP-адреса. Добавьте каждый вторичный частный IP-адрес, указанный на шаге 8, для сетевого интерфейса с той же подсетью, которая указана для первичного IP-адреса.
        >[!WARNING] 
        >Если выполнить приведенные выше действия неправильно, это может привести к потере подключения к виртуальной машине. Прежде чем продолжить, убедитесь, что все значения, введенные для параметров на шаге 5, правильные.

    * Нажмите кнопку **ОК**, чтобы закрыть настройки TCP/IP, а затем нажмите кнопку **ОК** еще раз, чтобы закрыть параметры адаптера. После этого подключение к удаленному рабочему столу будет восстановлено.

6. В командной строке введите *ipconfig /all*. Отобразятся все добавленные IP-адреса, а DHCP будет отключен.
7. Настройте Windows для использования частный IP-адрес основной IP-конфигурации в Azure в качестве основной IP-адрес для Windows. В разделе [доступ к Интернету нет из виртуальной Машины Windows Azure, несколько IP-адресов](https://support.microsoft.com/help/4040882/no-internet-access-from-azure-windows-vm-that-has-multiple-ip-addresse) подробные сведения. 


### <a name="validation-windows"></a>Проверка (Windows)

Чтобы убедиться, что вы можете подключиться к Интернету с помощью дополнительной IP-конфигурации через связанный с ней общедоступный IP-адрес (если он был добавлен правильно), используйте следующую команду:

```bash
ping -S 10.0.0.5 hotmail.com
```
>[!NOTE]
>Для вторичных IP-конфигураций подключение к Интернету можно проверить, только если с конфигурацией связан общедоступный IP-адрес. В случае с первичными IP-конфигурациями для проверки связи с Интернетом общедоступный IP-адрес не требуется.

### <a name="linux-ubuntu"></a>Linux (Ubuntu)

1. Откройте окно терминала.
2. Нужно войти с правами привилегированного пользователя. В противном случае введите следующую команду:

    ```bash
    sudo -i
    ```

3. Обновите файл конфигурации сетевого интерфейса (предполагается "eth0").

    * Сохраните имеющийся элемент строки для DHCP. Основной IP-адрес остается настроенным, как и ранее.
    * Добавьте конфигурацию для дополнительного статического IP-адреса с помощью следующих команд:

        ```bash
        cd /etc/network/interfaces.d/
        ls
        ```

    Должен отобразиться CFG-файл.
4. Откройте файл. В конце этого файла будут следующие строки:

    ```bash
    auto eth0
    iface eth0 inet dhcp
    ```

5. Добавьте следующие строки после имеющихся строк в этом файле:

    ```bash
    iface eth0 inet static
    address <your private IP address here>
    netmask <your subnet mask>
    ```

6. Сохраните файл с помощью следующей команды:

    ```bash
    :wq
    ```

7. Сбросьте сетевой интерфейс, выполнив следующую команду:

    ```bash
    sudo ifdown eth0 && sudo ifup eth0
    ```

    > [!IMPORTANT]
    > Если используется удаленное подключение, запустите скрипты ifdown и ifup в одной и той же строке.
    >

8. Проверьте, добавлен ли IP-адрес к сетевому интерфейсу, с помощью следующей команды:

    ```bash
    ip addr list eth0
    ```

    Должен отобразиться IP-адрес, добавленный как часть списка.

### <a name="linux-redhat-centos-and-others"></a>Linux (Redhat, CentOS и другие)

1. Откройте окно терминала.
2. Нужно войти с правами привилегированного пользователя. В противном случае введите следующую команду:

    ```bash
    sudo -i
    ```

3. Введите пароль и следуйте инструкциям. После того как вы станете привилегированным пользователем, перейдите к сетевой папке скриптов, используя следующую команду:

    ```bash
    cd /etc/sysconfig/network-scripts
    ```

4. Выведите список связанных IFCFG-файлов, используя следующую команду:

    ```bash
    ls ifcfg-*
    ```

    В списке файлов должен быть файл *ifcfg-eth0* .

5. Чтобы добавить IP-адрес, создайте для него файл конфигурации, как показано ниже. Обратите внимание, что такой файл должен быть создан для каждой IP-конфигурации.

    ```bash
    touch ifcfg-eth0:0
    ```

6. Откройте файл *ifcfg-eth0:0*, используя следующую команду.

    ```bash
    vi ifcfg-eth0:0
    ```

7. Добавьте содержимое в файл *eth0:0* (в этом случае) с помощью следующей команды. Не забудьте обновить данные на основании IP-адреса.

    ```bash
    DEVICE=eth0:0
    BOOTPROTO=static
    ONBOOT=yes
    IPADDR=192.168.101.101
    NETMASK=255.255.255.0
    ```

8. Сохраните файл, используя следующую команду:

    ```bash
    :wq
    ```

9. Перезапустите сетевые службы и убедитесь, что изменения вступили в силу, выполнив следующие команды:

    ```bash
    /etc/init.d/network restart
    ifconfig
    ```

    В возвращенном списке должен содержаться добавленный IP-адрес — *eth0:0*.

### <a name="validation-linux"></a>Проверка (Linux)

Чтобы убедиться, что вы можете подключиться к Интернету с помощью дополнительной IP-конфигурации через связанный с ней общедоступный IP-адрес, используйте следующую команду:

```bash
ping -I 10.0.0.5 hotmail.com
```
>[!NOTE]
>Для вторичных IP-конфигураций подключение к Интернету можно проверить, только если с конфигурацией связан общедоступный IP-адрес. В случае с первичными IP-конфигурациями для проверки связи с Интернетом общедоступный IP-адрес не требуется.

При проверке исходящего подключения из дополнительной сетевой карты для виртуальных машин Linux может потребоваться добавить соответствующие маршруты. Это можно сделать несколькими способами. Дополнительные сведения по дистрибутиву Linux см. в соответствующей документации. Ниже приведен один из методов добавления маршрутов.

```bash
echo 150 custom >> /etc/iproute2/rt_tables 

ip rule add from 10.0.0.5 lookup custom
ip route add default via 10.0.0.1 dev eth2 table custom

```
- Значения, которые требуется заменить:
    - **10.0.0.5** — на частный IP-адрес, у которого есть связанный с ним общедоступный IP-адрес;
    - **10.0.0.1** — на шлюз по умолчанию;
    - **eth2** — на имя дополнительной сетевой карты.
