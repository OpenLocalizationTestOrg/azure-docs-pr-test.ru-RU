## <a name="meaning-of-migration-of-iaas-resources-from-hello-classic-deployment-model-tooresource-manager"></a>Смысл миграции IaaS ресурсов из hello классическое развертывание модели tooResource Manager
Прежде чем мы углубляться в подробности hello, давайте взглянем на hello различие между операциями информационной панели и плоскости управления ресурсами IaaS hello.

* *Плоскости управления и управление* описывает hello вызовов, приходящие в плоскости управления и управление hello или hello API для изменения ресурсов. Например операции, такие как создание виртуальной Машины, перезагрузка виртуальной Машины и обновление виртуальной сети с помощью новой подсети управлять hello ресурсов под управлением. Они непосредственно не влияют на подключения toohello экземпляров.
* *Информационной панели* (приложение) описывает hello среда выполнения самого приложения hello и включает взаимодействие с экземплярами, которые не проходят hello Azure API. Доступ к веб-сайту или извлечение данных из работающего экземпляра SQL Server или сервера MongoDB будут считаться операциями в плоскости данных или взаимодействием с приложением. Копирование большого двоичного объекта из учетной записи хранения и доступа к ним открытый IP адрес tooRDP или SSH в виртуальной машине hello также являются информационной панели. Эти операции обеспечить приложения hello через вычисления, сети и хранилища.

В фоновом hello hello информационной панели hello же между hello классической модели развертывания и стеке диспетчера ресурсов. Во время процесса миграции мы перевод hello представление ресурсов hello из toothat hello классического развертывания модели в стеке Resource Manager hello. В результате потребуется toouse новые средства, API-интерфейсы, пакеты SDK toomanage ресурсы в стеке Resource Manager hello.

![Снимок экрана, иллюстрирующий различие между плоскостью управления и плоскостью данных.](../articles/virtual-machines/media/virtual-machines-windows-migration-classic-resource-manager/data-control-plane.png)


> [!NOTE]
> В некоторых сценариях миграции останавливает hello платформы Azure, освобождает и перезапуска виртуальных машин. Это приводит к кратковременному простою плоскости данных.
>

## <a name="hello-migration-experience"></a>возможности миграции Hello
Перед началом миграции компания hello hello следующие рекомендации:

* Убедитесь, что hello ресурсов, что toomigrate не используют все неподдерживаемые функции или конфигурации. Обычно платформа hello обнаружит их и создает ошибку.
* Если имеются виртуальные машины, которые не находятся в виртуальной сети, они будет остановлен и освобожденных в рамках hello подготовки операции. Если вы не хотите toolose hello общедоступный IP-адрес, сведения о резервировании hello IP-адрес перед тем как запускать hello подготовить операции. Однако если hello виртуальных машин в виртуальной сети, они не останавливаются и освобождается.
* Планирование миграции во время tooaccommodate нерабочего времени для любого непредвиденных сбоев, которые могут происходить во время миграции.
* Загрузите hello текущей конфигурации виртуальных машин с помощью PowerShell, команды командной строки (CLI) или toomake API-интерфейс REST, это облегчает проверку после hello шаг подготовки будет выполнено.
* Обновите модель развертывания диспетчера ресурсов автоматизации и ввода в эксплуатацию сценарии toohandle hello, перед началом миграции hello. При необходимости выполнить операции GET в состояние подготовки hello периоды hello ресурсов.
* Оцените политики RBAC hello, которые настраиваются для классических ресурсов IaaS hello и планирование после завершения миграции hello.

Далее представлен рабочий процесс миграции Hello

![Снимок экрана, показывающий рабочий процесс миграции hello](../articles/virtual-machines/windows/media/migration-classic-resource-manager/migration-workflow.png)

> [!NOTE]
> Все операции hello, описанные в следующих разделах hello являются идемпотентными. Если имеются неполадки, отличные от неподдерживаемое свойство или ошибка конфигурации, рекомендуется повторить попытку hello подготовки, отмены или фиксации операции. Hello платформы Azure предпринимает попытку hello.
>
>

### <a name="validate"></a>Проверка
операции проверки Hello hello первого шага в процессе миграции hello. Цель этого этапа Hello — состояние hello tooanalyze ресурсов hello правильно toomigrate в hello классической модели развертывания и вернуть успешных завершений и сбоев, если hello ресурсы можно использовать для миграции.

При выборе hello виртуальной сети или облачной службы (не в виртуальной сети) должны toovalidate для переноса.

* Если hello ресурсов не может выполнять миграцию, hello платформы Azure перечислены причины hello почему он не поддерживается для миграции.

#### <a name="checks-not-done-in-validate"></a>Проверки, которые не выполняются на этом этапе

Проверка операции только анализирует hello состояния ресурсов hello в hello классической модели развертывания. Его можно проверять все сбои и неподдерживаемые сценарии из-за настроек toovarious hello классической модели развертывания. Это не возможные toocheck о всех проблемах, которые hello диспетчера ресурсов Azure, стек может установить hello ресурсов во время миграции. Эти проблемы проверяются только в том случае, когда ресурсы hello подвергаются преобразования в следующем шаге hello миграции, то есть подготовки. в следующей таблице Hello перечисляет все проблемы hello, не были возвращены проверки.


|Проверки сети, не выполняемые на этапе проверки|
|-|
|Наличие шлюза ER и VPN-шлюза в виртуальной сети.|
|Отсутствие подключения к шлюзу виртуальной сети.|
|Все каналы аварийного восстановления, предварительно перенесенных tooAzure диспетчера ресурсов стека|
|Проверка на наличие квот Azure Resource Manager для сетевых ресурсов, таких как статический общедоступный IP-адрес, динамические общедоступные IP-адреса, подсистема балансировки нагрузки, группы безопасности сети, таблицы маршрутов и сетевые интерфейсы. |
| Проверка на допустимость всех правил подсистемы балансировки нагрузки в среде развертывания или в виртуальной сети. |
| Проверьте конфликтующие частных IP-адресов между виртуальными машинами на останавливается освобождается в hello же виртуальной сети |

### <a name="prepare"></a>Подготовка.
Операция подготовки Hello является вторым шагом процесса миграции hello hello. Hello цель данного этапа является преобразование hello toosimulate hello IaaS ресурсы из классической модели tooResource диспетчера ресурсов развертывания и присутствия рядом друг с другом для вас toovisualize.

> [!NOTE] 
> На этом этапе ресурсы из классической модели не будут изменены. В этом случае toorun безопасном шаг, если вы пытаетесь ожидания миграции. 

При выборе hello виртуальной сети или hello облачной службы (он не является виртуальной сети) должны tooprepare для переноса.

* Если hello ресурсов не может выполнять миграцию, hello платформы Azure останавливает процесс миграции hello и перечислены hello причины, почему hello подготовка не удалось выполнить операцию.
* Если ресурс hello способен миграции, hello платформы Azure сначала блокирует hello плоскости управления операции для hello ресурсы при миграции. Например вы не могли tooadd tooa диска данных виртуальной Машины, подвергнутой миграции.

Hello платформы Azure затем запускает hello миграцию метаданных из классического развертывания модели tooResource диспетчера для миграции ресурсов hello.

После подготовки hello операция завершена, предусмотрена возможность hello визуализация hello ресурсы в классической модели развертывания и диспетчер ресурсов. Для каждой облачной службы в hello классической модели развертывания hello платформы Azure создает имя группы ресурсов, имеющий hello шаблон `cloud-service-name>-Migrated`.

> [!NOTE]
> Не возможные tooselect hello имя группы ресурсов, созданных для перенесенных ресурсов (т. е. «-миграция»), но после завершения миграции можно использовать диспетчер ресурсов Azure перемещения функция toomove ресурсы tooany группы ресурсов, необходимо. Дополнительные сведения об этом см. в разделе tooread [переместить группу ресурсов toonew ресурсов или подписку](../articles/resource-group-move-resources.md)

Ниже приведены два экрана, показывать hello результат после удачном операции подготовки. На экране показывает группы ресурсов, содержащий hello исходного облачной службы. Второй экран показывает новый hello «-перенесены» группы ресурсов, содержащей hello эквивалентные ресурсы диспетчера ресурсов Azure.

![Снимок экрана классический облачной службы на портале](../articles/virtual-machines/windows/media/migration-classic-resource-manager/portal-classic.png)

![Снимок экрана подготовки ресурсов Azure Resource Manager на портале.](../articles/virtual-machines/windows/media/migration-classic-resource-manager/portal-arm.png)

Здесь рассматривается фоновыми ресурсов после завершения фазы подготовки hello. Обратите внимание, что ресурс hello hello информационной панели hello же. Он представлен в плоскости управления hello (классической модели развертывания) и плоскости управления hello (диспетчера ресурсов).

![Фоновом hello на этапе подготовки](../articles/virtual-machines/windows/media/migration-classic-resource-manager/behind-the-scenes-prepare.png)

> [!NOTE]
> Виртуальные машины, не входящие в классическую виртуальную сеть, на этом этапе переноса останавливаются и освобождаются.
>

### <a name="check-manual-or-scripted"></a>Проверка (вручную или с помощью сценария)
На этапе проверки hello при необходимости можно использовать конфигурации hello, загруженный ранее toovalidate, что hello миграции указано правильно. Кроме того вы можете войти в toohello портала и проверьте место hello свойств и ресурсов toovalidate выглядит неплохо, миграция метаданных.

В случае переноса виртуальной сети большинство конфигураций виртуальных машин не будут перезапущены. Для приложений на этих виртуальных машин можно проверить, приложение hello находится по-прежнему запущен и работает.

Если hello виртуальные машины работают должным образом, и если правильно работают обновленные скрипты можно тестирования мониторинга автоматизации и toosee рабочих скриптов. При hello ресурсы находятся в состояние подготовки hello поддерживаются только операции GET.

Нет не задать период времени, перед которым требуется миграция toocommit hello. В этом состоянии время не ограничено. Однако плоскости управления hello заблокирован для этих ресурсов только в случае прерывания или фиксации.

При появлении проблем, всегда прерывание миграции hello и вернитесь к предыдущему окну toohello классической модели развертывания. После перехода назад hello платформы Azure будет открыть операции hello плоскости управления ресурсами hello, можно возобновить нормальную работу на этих виртуальных машин в hello классической модели развертывания.

### <a name="abort"></a>Прерывание
Прерывание — это необязательный шаг, можно использовать toorevert вашей изменения toohello классической модели развертывания и остановить миграцию hello. Эта операция удаляет hello метаданных диспетчера ресурсов для ресурсов, созданного в предыдущем шаге hello. 

![Фоновом hello на этапе прерывания процесса](../articles/virtual-machines/windows/media/migration-classic-resource-manager/behind-the-scenes-abort.png)


> [!NOTE]
> Эта операция не может выполняться после запуска операции фиксации hello.     
>

### <a name="commit"></a>Фиксация
После завершения проверки hello можно зафиксировать hello миграции. Ресурсы больше не отображаются в классической модели развертывания и доступны только в модели развертывания диспетчера ресурсов hello. Hello перенесенных ресурсов можно управлять только на новом портале hello.

> [!NOTE]
> Эта идемпотентная операция. В случае неудачи рекомендуется повторить попытку операции hello. При продолжении toofail, создайте запрос в службу поддержки или создать форум post с тегом ClassicIaaSMigration на нашем [ВМ форум](https://social.msdn.microsoft.com/Forums/azure/home?forum=WAVirtualMachinesforWindows).
>
>

![Фаза фиксации фоновом hello](../articles/virtual-machines/windows/media/migration-classic-resource-manager/behind-the-scenes-commit.png)

## <a name="where-toobegin-migration"></a>Где toobegin миграции?

Ниже приведен блок-схема показывает, каким образом tooproceed с миграцией

![Снимок экрана, показывающий шагов миграции hello](../articles/virtual-machines/windows/media/migration-classic-resource-manager/migration-flow.png)

## <a name="translation-of-classic-deployment-model-tooazure-resource-manager-resources"></a>Перевод ресурсов диспетчера ресурсов tooAzure модели классическом развертывании
В следующей таблице hello можно найти hello классической модели развертывания и представления ресурсов hello диспетчера ресурсов. Остальные функции и ресурсы в настоящий момент не поддерживаются.

| Представление классической модели | Представление Resource Manager | Подробные примечания |
| --- | --- | --- |
| Имя облачной службы |DNS-имя |Во время миграции, новая группа ресурсов создается для каждой облачной службы с шаблону именования hello `<cloudservicename>-migrated`. Эта группа ресурсов содержит все ваши ресурсы. Имя облачной службы Hello становится DNS-имени, связанный с hello общедоступный IP-адрес. |
| Виртуальная машина. |Виртуальная машина. |Свойства, относящиеся к виртуальной машине, переносятся без изменений. Некоторые osProfile данные, такие как имя компьютера, не хранятся в hello классической модели развертывания и остается пустым, после миграции. |
| Дисковые ресурсы присоединенного tooVM |TooVM неявное подключенных дисков |Диски не моделируются в виде ресурсов верхнего уровня в модели развертывания диспетчера ресурсов hello. Они переносятся как неявные диски под hello виртуальной Машины. Только для дисков, которые будут присоединены tooa ВМ в настоящее время поддерживаются. Виртуальные машины диспетчера ресурсов теперь можно использовать классические учетные записи хранения, который позволяет легко перенести toobe hello диски без обновлений. |
| Расширения виртуальных машин |Расширения виртуальных машин |Все расширения ресурсов hello, за исключением расширения XML переносятся из hello классической модели развертывания. |
| Сертификаты виртуальных машин |Сертификаты в хранилище ключей Azure |Если облачная служба содержит сертификаты службы, в новое хранилище Azure ключа каждой облачной службы и перемещает hello сертификаты в хранилище ключей hello. виртуальные машины Hello — обновленных tooreference hello сертификаты из хранилища ключей hello. <br><br> **Примечание:** не удаляйте hello keyvault как это может привести к toogo hello виртуальную Машину в неисправном состоянии. Мы работаем над повышение действия в серверном hello, хранилищами ключей можно удалены или перемещены вместе с hello ВМ tooa новую подписку. |
| Конфигурация WinRM |Конфигурация WinRM в osProfile |Перемещенные конфигурация удаленного управления Windows без изменений в ходе миграции hello. |
| Свойство группы доступности |Ресурс группы доступности | Спецификация набора доступности была свойство hello виртуальной Машины в hello классической модели развертывания. Наборы доступности стать верхнего уровня ресурсов в ходе миграции hello. Hello следующие конфигурации не поддерживаются: несколько доступности каждой облачной службы, или один или несколько доступности наборами вместе с виртуальных машин, которые не находятся в любой доступности в облачной службе. |
| Конфигурация сети в виртуальной машине |Основной сетевой интерфейс |Конфигурация сети на виртуальной Машине, представляется как hello первичный сетевой интерфейс ресурсов после миграции. Для виртуальных машин, которые не находятся в виртуальной сети hello внутренний IP-адрес изменяется во время миграции. |
| Несколько сетевых интерфейсов в виртуальной машине |Сетевые интерфейсы |Если виртуальная машина имеет несколько сетевых интерфейсов, связанных с ним, каждому сетевому интерфейсу становится верхнего уровня ресурсов в ходе миграции hello в модели развертывания диспетчера ресурсов hello наряду со всеми свойствами hello. |
| Набор конечных точек с балансировкой нагрузки |Подсистема балансировки нагрузки |Hello классической модели развертывания платформа hello назначена неявное Балансировка нагрузки для каждой облачной службы. Во время миграции создается новый ресурс балансировки нагрузки, а набор конечных точек с балансировкой нагрузки hello становится правила балансировки нагрузки. |
| Правила преобразования сетевых адресов для входящих подключений |Правила преобразования сетевых адресов для входящих подключений |Входные конечные точки, определенные для hello виртуальной Машины, преобразованный tooinbound правила преобразования сетевых адресов в рамках подсистемы балансировки нагрузки hello во время миграции hello. |
| Виртуальный IP-адрес |Общедоступный IP-адрес с DNS-именем |Hello виртуальный IP-адрес становится общедоступный IP-адрес и связан с подсистемой балансировки нагрузки hello. Виртуальный IP-адрес можно перенести только в том случае, если назначенный tooit входную конечную точку. |
| Виртуальная сеть |Виртуальная сеть |выполняется миграция Hello виртуальной сети, все свойства, toohello модели развертывания диспетчера ресурсов. Новая группа ресурсов создается с именем hello `-migrated`. |
| Зарезервированные IP-адреса |Общедоступный IP-адрес с методом статического выделения |Зарезервированные IP-адреса, связанные с подсистемой балансировки нагрузки hello переносятся вместе с миграции hello hello облачной службы или виртуальной машины hello. Перенос несвязанных зарезервированных IP-адресов в настоящее время не поддерживается. |
| Общедоступный IP-адрес для каждой виртуальной машины |Общедоступный IP-адрес с методом динамического выделения |Здравствуйте, общедоступный IP-адрес, связанный с виртуальной Машины, преобразуется в открытый ресурс IP-адреса, с помощью метода set hello выделения toostatic приветствия. |
| Группы NSG |Группы NSG |Группы безопасности сети, связанной с подсетью, будут скопированы в рамках модели развертывания диспетчера ресурсов toohello миграции hello. во время миграции hello Hello NSG в hello классической модели развертывания не удаляется. Однако hello плоскости управления операций для hello NSG блокируется во время миграции hello. |
| "Серверы DNS" |"Серверы DNS" |DNS-серверы, связанные с виртуальной сети или hello виртуальной Машины переносятся в ходе миграции соответствующего ресурса hello, наряду со всеми свойствами hello. |
| Определяемые пользователем маршруты |Определяемые пользователем маршруты |Определяемых пользователем маршрутов, связанной с подсетью, будут скопированы в рамках модели развертывания диспетчера ресурсов toohello миграции hello. во время миграции hello Hello UDR в hello классической модели развертывания не удаляется. операции управления плоскости Hello для hello UDR блокируются во время миграции hello. |
| Свойство IP-пересылки в конфигурации сети виртуальной машины |IP-пересылки свойство hello сетевого Адаптера |Hello IP-пересылки на виртуальной Машине задано свойство tooa преобразованное в сетевом интерфейсе hello во время миграции hello. |
| Балансировщик нагрузки с несколькими IP-адресами |Балансировщик нагрузки с несколькими ресурсами IP-адресов |Каждый общедоступный IP-адрес, связанный с подсистемой балансировки нагрузки hello является преобразованный tooa открытый IP-ресурс и связанные с подсистемой балансировки нагрузки hello после миграции. |
| Внутренние имена DNS на hello виртуальной Машины |Внутренние имена DNS на hello сетевого Адаптера |Во время миграции hello внутренние DNS-суффиксов для hello виртуальных машин, перенесенных tooa свойство только для чтения с именем «InternalDomainNameSuffix» на hello сетевого адаптера. суффикс Hello остается неизменным после миграции и разрешение виртуальной Машины следует продолжить toowork как раньше. |
| Шлюз виртуальной сети |Шлюз виртуальной сети |Свойства шлюза виртуальной сети переносятся без изменений. Hello виртуальных IP-адресов, связанной со шлюзом hello либо не изменяется. |
| Сайт локальной сети |Шлюз локальной сети |Свойства сайта локальной сети, новый ресурс перенесенных tooa без изменений, вызывается шлюза локальной сети. Это касается префиксов локальных адресов и IP-адреса удаленного шлюза. |
| Ссылки на подключения |Подключение |Ссылки на подключения между шлюзом и сайтом локальной сети в конфигурации сети представлены новым ресурсом Connection в Resource Manager после переноса. Все свойства подключения ссылки в файлах конфигурации сети являются копируются без изменений toohello только что созданный ресурс подключения. Подключение виртуальной сети tooVNet в классическом достигается путем создания двух туннелей IPsec toolocal сетевые сайты, представляющий hello виртуальных сетей. Это подключение tooVnet2Vnet преобразованный тип в модели диспетчер ресурсов без необходимости шлюзы локальной сети. |

## <a name="changes-tooyour-automation-and-tooling-after-migration"></a>Изменения tooyour автоматизации и инструментарий после миграции
В процессе миграции ресурсы из hello классической модели развертывания toohello диспетчера ресурсов развертывания модели у вас есть tooupdate в существующую среду автоматизации или tooensure средства, что toowork продолжается после миграции hello.
